<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>CreateClusterNotifyPort</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_wolf_createclusternotifyport"></a>CreateClusterNotifyPort</h2>
<p>
The <b>CreateClusterNotifyPort</b> function creates a notification port to handle cluster event notification.</p>
<pre><code><b>HCHANGE WINAPI CreateClusterNotifyPort(
  HCHANGE</b><i> hChange</i><b>,   </b>
<b>  HCLUSTER</b><i> hCluster</i><b>, </b>
<b>  DWORD</b><i> dwFilter</i><b>,    </b>
<b>  DWORD</b><i> dwNotifyKey  </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>hChange</i></dt>
<dd>
[in] Handle to a notification port or INVALID_HANDLE_VALUE, indicating that a new handle should be created. If <i>hChange</i> is an existing handle, the events specified in <i>dwFilter</i> are added to the notification port. </dd>
<dt>
<i>hCluster</i></dt>
<dd>
[in] Handle to the cluster to be associated with the notification port identified by <i>hChange</i>, or INVALID_HANDLE_VALUE, indicating that the notification port should not be associated with a cluster. If <i>hChange</i> is not set to INVALID_HANDLE_VALUE, <i>hCluster</i> cannot be set to INVALID_HANDLE_VALUE. </dd>
<dt>
<i>dwFilter</i></dt>
<dd>
[in] Bitmask of flags that describes the events to cause notifications to be stored in the queue. One or more of the following flags can be set using the <b>OR</b> operator:
<dl>
<dt>
CLUSTER_CHANGE_CLUSTER_PROPERTY</dt>
<dd>
Indicates that a notification should be issued when the prioritized list of internal networks has changed.</dd>
<dt>
CLUSTER_CHANGE_CLUSTER_STATE</dt>
<dd>
This notification is reserved for future use.</dd>
<dt>
CLUSTER_CHANGE_GROUP_ADDED</dt>
<dd>
Indicates that a notification should be issued when a new group is created in the cluster. Groups are created with a call to the <a href="clusapi_0z3k.htm"><b>CreateClusterGroup</b></a> function. </dd>
<dt>
CLUSTER_CHANGE_GROUP_DELETED</dt>
<dd>
Indicates that a notification should be issued when an existing group is deleted. Groups are deleted with a call to the <a href="clusapi_2wts.htm"><b>DeleteClusterGroup</b></a> function. </dd>
<dt>
CLUSTER_CHANGE_GROUP_PROPERTY</dt>
<dd>
Indicates that a notification should be issued when the properties of an existing group change. Events that can trigger this notification include calling <a href="clusapi_3yxx.htm"><b>SetClusterGroupName</b></a> to change a group's name and adding or removing a resource from a group. </dd>
<dt>
CLUSTER_CHANGE_GROUP_STATE</dt>
<dd>
Indicates that a notification should be issued when a group changes state. For a list of the possible group state values, see <a href="clusapi_14o5.htm"><b>GetClusterGroupState</b></a>.</dd>
<dt>
CLUSTER_CHANGE_HANDLE_CLOSE</dt>
<dd>
Indicates that a notification should be issued when a handle associated with a cluster object has closed.</dd>
<dt>
CLUSTER_CHANGE_NETINTERFACE_ADDED</dt>
<dd>
Indicates that a notification should be issued when a new network interface is added to a cluster node.</dd>
<dt>
CLUSTER_CHANGE_NETINTERFACE_DELETED</dt>
<dd>
Indicates that a notification should be issued when a network interface is permanently removed from a cluster node.</dd>
<dt>
CLUSTER_CHANGE_NETINTERFACE_PROPERTY</dt>
<dd>
Indicates that a notification should be issued when the properties of an existing network interface change. </dd>
<dt>
CLUSTER_CHANGE_NETINTERFACE_STATE</dt>
<dd>
Indicates that a notification should be issued when a network interface changes state. For a list of the possible network interface state values, see <a href="clusapi_8tb9.htm"><b>GetClusterNetInterfaceState</b></a>.</dd>
<dt>
CLUSTER_CHANGE_NETWORK_ADDED</dt>
<dd>
Indicates that a notification should be issued when a new network is added to the cluster environment.</dd>
<dt>
CLUSTER_CHANGE_NETWORK_DELETED</dt>
<dd>
Indicates that a notification should be issued when a network is permanently removed from the cluster environment.</dd>
<dt>
CLUSTER_CHANGE_NETWORK_PROPERTY</dt>
<dd>
Indicates that a notification should be issued when the properties of an existing network change. </dd>
<dt>
CLUSTER_CHANGE_NETWORK_STATE</dt>
<dd>
Indicates that a notification should be issued when a network changes state. For a list of the possible network state values, see <a href="clusapi_07l1.htm"><b>GetClusterNetworkState</b></a>.</dd>
<dt>
CLUSTER_CHANGE_NODE_ADDED</dt>
<dd>
Indicates that a notification should be issued when a new node is added to the cluster. A node can only be added when Cluster Server is initially installed on the node. </dd>
<dt>
CLUSTER_CHANGE_NODE_DELETED</dt>
<dd>
Indicates that a notification should be issued when a node is permanently removed from a cluster. A node can be permanently deleted from an existing cluster with a call to the <a href="clusapi_91wl.htm"><b>EvictClusterNode</b></a> function. </dd>
<dt>
CLUSTER_CHANGE_NODE_PROPERTY</dt>
<dd>
This notification is reserved for future use.</dd>
<dt>
CLUSTER_CHANGE_NODE_STATE</dt>
<dd>
Indicates that a notification should be issued when a node changes state. For a list of possible node state values, see <a href="clusapi_2mw5.htm"><b>GetClusterNodeState</b></a>.</dd>
<dt>
CLUSTER_CHANGE_QUORUM_STATE</dt>
<dd>
This notification is reserved for future use.</dd>
<dt>
CLUSTER_CHANGE_REGISTRY_ATTRIBUTES</dt>
<dd>
Indicates that a notification should be issued when a cluster database key's attributes are changed. The only currently defined cluster database key attribute is its security descriptor, which can be changed with <a href="clusapi_4fw9.htm"><b>ClusterRegSetKeySecurity</b></a>.</dd>
<dt>
CLUSTER_CHANGE_REGISTRY_NAME</dt>
<dd>
Indicates that a notification should be issued when the name of a cluster database key has changed. Name changes can occur through the <a href="clusapi_1f3t.htm"><b>ClusterRegCreateKey</b></a> function which creates a new database key and the <a href="clusapi_54u1.htm"><b>ClusterRegDeleteKey</b></a> function which deletes a key.</dd>
<dt>
CLUSTER_CHANGE_REGISTRY_SUBTREE</dt>
<dd>
Indicates that the other CLUSTER_CHANGE_REGISTRY events apply to the entire cluster database. If this flag is not included, the events apply only to the specified key. </dd>
<dt>
CLUSTER_CHANGE_REGISTRY_VALUE</dt>
<dd>
Indicates that a notification should be issued when a value of the specified cluster database key is changed or deleted. Cluster database values can be changed with the <a href="clusapi_531h.htm"><b>ClusterRegSetValue</b></a> function and deleted with the <a href="clusapi_23dx.htm"><b>ClusterRegDeleteValue</b></a> function. </dd>
<dt>
CLUSTER_CHANGE_RESOURCE_ADDED</dt>
<dd>
Indicates that a notification should be issued when a new resource is created in the cluster. Resources can be created with the <a href="clusapi_0s2t.htm"><b>CreateClusterResource</b></a> function. </dd>
<dt>
CLUSTER_CHANGE_RESOURCE_DELETED</dt>
<dd>
Indicates that a notification should be issued when a resource is deleted. Resources can be deleted with the <a href="clusapi_7gh1.htm"><b>DeleteClusterResource</b></a> function. </dd>
<dt>
CLUSTER_CHANGE_RESOURCE_PROPERTY</dt>
<dd>
Indicates that a notification should be issued when the properties of a resource change. Events that can trigger this notification include changing the name of a resource with <a href="clusapi_92xx.htm"><b>SetClusterResourceName</b></a>, changing a resource's list of possible owner nodes with <a href="clusapi_4lwl.htm"><b>AddClusterResourceNode</b></a> and <a href="clusapi_3q79.htm"><b>RemoveClusterResourceNode</b></a>, and changing a resource's dependencies with <a href="clusapi_0s6x.htm"><b>AddClusterResourceDependency</b></a><b> </b>or<b> <a href="clusapi_10hl.htm">RemoveClusterResourceDependency</a></b>.</dd>
<dt>
CLUSTER_CHANGE_RESOURCE_STATE</dt>
<dd>
Indicates that a notification should be issued when a resource changes state. For a list of the possible resource state values, see <a href="clusapi_34o5.htm"><b>GetClusterResourceState</b></a>.
<p>
This notification is also issued when a resource is moved from one group to another with <a href="clusapi_2ucw.htm"><b>ChangeClusterResourceGroup</b></a>. 
</dd>
<dt>
CLUSTER_CHANGE_RESOURCE_TYPE_ADDED</dt>
<dd>
Indicates that a notification should be issued when a new resource type is created in the cluster. Resource types can be created with the <a href="clusapi_7b6t.htm"><b>CreateClusterResourceType</b></a> function. </dd>
<dt>
CLUSTER_CHANGE_RESOURCE_TYPE_DELETED</dt>
<dd>
Indicates that a notification should be issued when an existing resource type is deleted. Resource types can be deleted with the <a href="clusapi_6351.htm"><b>DeleteClusterResourceType</b></a> function. </dd>
</dl>
</dd>
<dt>
<i>dwNotifyKey</i></dt>
<dd>
[in] Any value that is to be associated with retrieving notifications from the created notification port. The <i>dwNotifyKey</i> is returned from <b>GetClusterNotify</b> when an event of one of the types specified in <i>dwFilter</i> occurs. 
</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
NULL</dt>
<dd>
The operation was unsuccessful. For more detailed information about the error, call the Win32 function <b>GetLastError</b>.
</dd>
</dl>
<p>
If the operation was successful, <b>CreateClusterNotifyPort</b> returns a notification port handle.</p>
<h4>Remarks</h4>
<p>
A notification port stores notifications of events occurring within a cluster for applications. Applications register to store events using <b>CreateClusterNotifyPort</b>, setting <i>dwFilter</i> to one or more events of interest and <i>dwNotifyKey</i> to a value that represents the registration. For example, if an application wants to be informed when there is any change to the cluster's resource types, it would set <i>dwFilter</i> to:</p>
<pre><code>CLUSTER_CHANGE_RESOURCE_TYPE_ADDED | CLUSTER_CHANGE_RESOURCE_TYPE_DELETED
 </code></pre>
<p>
Once registered, the notification port maintains a queue of notification events. The application must call <a href="clusapi_9a49.htm"><b>GetClusterNotify</b></a> to retrieve the notifications associated with the events and the affected data. An application can have zero or more notification ports.</p>
<p>
Applications that want to add other event types after the <b>CreateClusterNotifyPort</b> function has completed can do so by calling <a href="clusapi_6cc9.htm"><b>RegisterClusterNotify</b></a>.</p>
<p>
To receive notifications of cluster database changes, one or more of the flags applicable to the cluster database must be set in the <i>dwFilter</i> parameter. Applicable flags begin with the prefix CLUSTER_CHANGE_REGISTRY. </p>
<p>
By specifying one of the cluster database flags, an application can learn of events that apply to the database root for the cluster specified by the <i>hCluster</i> parameter. </p>
<p>
The CLUSTER_CHANGE_HANDLE_CLOSE event is meant to prevent a potential race condition that can occur when one thread trying to close a notification port calls <a href="clusapi_6yus.htm"><b>CloseClusterNotifyPort</b></a> and completes while simultaneously another thread is trying to retrieve an event from this port by calling <a href="clusapi_9a49.htm"><b>GetClusterNotify</b></a>. Prevent this potential problem by having the thread calling <b>GetClusterNotify</b> watch for the CLUSTER_CHANGE_HANDLE_CLOSE notification as follows:</p>
<pre><code>do {
    Status = GetClusterNotify(hChange,...)
    if (Status == ERROR_SUCCESS) {
        if (dwFilter == CLUSTER_CHANGE_HANDLE_CLOSE) {
            //
            // Clean up and terminate
            //
            break;
        }

        // do something
    }
while (Status == ERROR_SUCCESS);
 </code></pre>
<p>
For information about the data that is returned to an application when it makes the call to retrieve a notification, see <a href="clusapi_9a49.htm"><b>GetClusterNotify</b></a>.</p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Version: </b>Use Windows NT Server Enterprise Edition 4.0.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in clusapi.h.</p>
<p>&nbsp;</p></body>
</HTML>
