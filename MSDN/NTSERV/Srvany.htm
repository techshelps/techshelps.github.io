<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text-html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>SRVANY.EXE</title>
<style>@import url(msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="msdn_ie3.css">
</HEAD>
<BODY BGCOLOR=#FFFFFF TEXT=#000000>

<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

	<!--TOOLBAR_START-->
	<!--TOOLBAR_EXEMPT-->
	<!--TOOLBAR_END-->

<h1>SRVANY.EXE</h1>
<p>
Windows NT&reg; Resource Kits</p>
<p>
Copyright © Microsoft Corp. 1995 - 1997</p>
<p>
Contents</p>
<p>
Introduction</p>
<p>
Notices</p>
<p>
Installation</p>
<p>
Specifying the application to start &amp; its parameters</p>
<p>
Starting &amp; stopping the service</p>
<p>
De-installation</p>
<p>
Programming Considerations</p>
<p>
Comments/limitations</p>
<p>
<b><u>Introduction</u></b></p>
<p>
This file describes the <b>SRVANY.EXE</b> utility. This utility allows running <b>Windows NT™</b> applications as services. The benefits include:</p>
<p>
- allow apps to survive logoff/logon sequences, hence saving the overhead of re-starting them for each new user</p>
<p>
- allow server apps to come-up and service requests even when no user is logged-on</p>
<p>
- allow apps to run and perform a task in a specific logon account, different from the currently logged-on user </p>
<p>
<b><u>Notices</u></b></p>
<p>
1.<b> </b>Some applications may terminate upon logoff, even though they were started as a service, if they don't ignore the WM_ENDSESSION message (or CTRL_LOGOFF_EVENT). See "Programming Considerations" below for more details.</p>
<p>
2.<b> </b>When using<b> SRVANY.EXE </b>with<b> Presentation Manager®</b> applications, special configuration instructions apply - please read the README.WRI file shipped on Disk#1 of the <b>Windows NT™ Add-On Subsystem for Presentation Manager®, version 3.51 </b>(a Microsoft add-on product which allows running 16-bit <b>Presentation Manager®</b> 1.x applications in addition to the OS/2 character-mode applications supported by the <b>Windows NT™</b> OS/2 Subsystem).</p>
<p>
<b><u>Installation</u></b></p>
<p>
-&gt; Copy SRVANY.EXE to your system and install it as a <b>Windows NT™</b> service, for example:</p>
<p>
INSTSRV MyService c:\tools\srvany.exe</p>
<p>
-&gt; configure via the Services applet ("Startup..." dialog) of the Control Panel as manual or automatic, as appropriate.</p>
<p>
-&gt; set via the Services applet ("Startup..." dialog) of the Control Panel the account for the service. If you need access to the screen &amp; keyboard, you must choose the LocalSystem account and click the "Allow Service to Interact with Desktop", otherwise choose any account and specify the correct logon password. Note that the LocalSystem account doesn't have network access.</p>
<p>
<b><u>Specifying the application to start &amp; its parameters</u></b></p>
<p>
Run the Registry Editor (REGEDT32.EXE):</p>
<p>
-&gt; under HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\MyService: create a 'Parameters' key</p>
<p>
-&gt; under the above key, create an 'Application' value of type REG_SZ and specify there the full path of your app executable (including the extension). For example:</p>
<p>
Application: REG_SZ: D:\TOOLS\VI.EXE</p>
<p>
-&gt; OPTIONAL: under the above key, create an 'AppParameters' value of type REG_SZ and specify the parameters for your app. For Example:</p>
<p>
AppParameters: REG_SZ: C:\TMP\FOO</p>
<p>
-&gt; OPTIONAL: under the above key, create an 'AppDirectory' value of type REG_SZ and specify the current directory to use for the app, eg:</p>
<p>
AppDirectory: REG_SZ: C:\TMP</p>
<p>
The case of all above strings is not important.</p>
<p>
There is also another way to specify the service parameters, via the Control Panel. Note that this method applies only to the case where the service is configured to be started manually (i.e. not when it is started automatically with the system):</p>
<p>
2. Via the Control Panel, Services applet:</p>
<p>
-&gt; type in the Startup Parameters box the full command-line, incl. the app name. Example:</p>
<p>
D:\\BINP\\B.EXE C:\\TMP\\FOO</p>
<p>
(note the '\\' is needed to result in '\')</p>
<p>
-&gt; if you want to specify the current working directory, use the '/D' switch before the app name, eg:</p>
<p>
/D C:\\TMP D:\\TOOLS\\VI.EXE C:\\TMP\\FOO</p>
<p>
<b>NOTICE: </b>Specifying the target application via the Control Panel is usually inconvenient because the parameters have to be typed every time the service is started. However, this may be convenient in cases where the target application is different every time the service is started.</p>
<p>
<b><u>Starting &amp; stopping the service</u></b></p>
<p>
<u>Start:</u></p>
<p>
If the service is configured as 'Automatic', the user doesn't need to start it explicitely: it is started automatically every time when the system is re-booted.</p>
<p>
For 'manual' services, the user may start services in several ways:</p>
<p>
- from the Services applet of the Control Panel</p>
<p>
or</p>
<p>
- using the SC.EXE utility, eg: SC start MyService</p>
<p>
or</p>
<p>
- NET START MyService</p>
<p>
<u>Stop:</u></p>
<p>
When you stop the service, it will terminate the application it had started. The way to stop the service is (as described above for starting):</p>
<p>
- from the Services applet of the Control Panel</p>
<p>
or</p>
<p>
- using the SC.EXE utility, eg: SC stop MyService</p>
<p>
or</p>
<p>
- NET STOP MyService</p>
<p>
<b>WARNING:</b></p>
<p>
When the service is stopped, it terminates the application via the WIN32 TerminateProcess() API: this is a drastic way to end an application. For example, it would not allow the application to prompt the user to save changes. Therefore, it is recommended to close the application BEFORE stopping the service.</p>
<p>
<b><u>De-installation</u></b></p>
<p>
If you want to prevent an instance of the SRVANY utility from running until further notice, you should configure it via the Services applet ("Startup..." dialog) of the Control Panel as 'Disabled' (rather than 'manual' or 'automatic').</p>
<p>
If you want to remove an instance of the SRVANY utility permanently:</p>
<p>
-&gt; If the service is running, stop it (see "Starting and stopping the service" above)</p>
<p>
-&gt; Run:</p>
<p>
INSTSRV MyService remove</p>
<p>
<b>NOTICE:</b> this procedure removes only one specific instance of SRVANY. Therefore, it is possible that SRVANY.EXE is still being used to start other applications as services.</p>
<p>
<b><u>Programming Considerations</u></b></p>
<p>
For WIN32 graphical applications: when the currently logged-in user is logging-off, all WIN32 top-level windows receive WM_QUERYENDSESSION and WM_ENDSESSION messages. Some WIN32 applications choose to terminate upon receipt of such messages. In order for your WIN32 application to survive logoff, it must not do that: instead, your windows procedure should call the default windows procedure on these messages.</p>
<p>
For WIN32 Console (i.e. character-mode) applications: when the currently logged-in user is logging-off, all Console applications receive a CTRL_LOGOFF_EVENT event from the Console. </p>
<p>
If your Console application has registered a Console event handler (via SetConsoleCtrlHandler), it must ignore CTRL_LOGOFF_EVENT in order  to survive the logoff.</p>
<p>
<b><u>Comments/limitations</u></b></p>
<p>
-&gt; You may install SRVANY.EXE several times with different registry parameters (i.e. running different target applications) - just use a distinct service name for each instance (e.g. MyService1, MyService2 etc.)</p>
<p>
-&gt; If SRVANY.EXE fails to start your application, try specifying as current directory the directory where your application is installed (see 'AppDirectory' registry key or '/D' above). SRVANY.EXE may be running under an account different than the currently logged-on user therefore environment variables may be set differently: as a result, for example, the system might have been unable to find a DLL required for your application and running it from the application's directory might help.</p>
<p>
-&gt; Due to a restriction enforced by <b>Windows NT™</b> on services, the application can either be interactive (have a Console, read keyboard input etc.) or have network access (not both at the same time).</p>
<p>
This limitation is less problematic than it would appear at first glance. Here is why:</p>
<p>
If you know which servers your interactive service application needs to access, it is possible to configure these servers (or selected shares on them) to allow your service (running under the LocalSystem account) to access these servers.</p>
<p>
a.To allow LocalSystem services on any machine in the domain to access a specific share on a server, use the Registry Editor to add the name of that share to:</p>
<p>
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters\NullSessionShares</p>
<p>
If named pipes on that server also need to be accessed by LocalSystem services, add them to:</p>
<p>
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters\NullSessionPipes</p>
<p>
b.To allow ALL shares &amp; pipes on the server to be accessed by LocalSystem services, add a value:</p>
<p>
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters\RestrictNullSessAccess, type DWORD, set to value 0</p>
<p>
<b>WARNING</b>: method b) effectively allows everyone in the domain to access that server - make sure this is acceptable for you.</p>

</FONT>
</BODY>
</HTML>
