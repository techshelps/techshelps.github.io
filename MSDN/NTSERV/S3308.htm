<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Restoring the DHCP Database</title>
<style>@import url(msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="msdn_ie3.css"><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"></HEAD><BODY BGCOLOR="#FFFFFF">
<H3 CLASS="h2">Restoring the DHCP Database</H3><P CLASS="t">If you determine that the DHCP services are running on both the client and server computers but the error conditions described earlier under "Troubleshooting DHCP Server" persist, then the DHCP database is not available or has become corrupted. If a DHCP server fails for any reason, you can restore the database from a backup copy.</P>
<P CLASS="t"><B>To restore a DHCP database</B></P>
<P>    1.    Before starting, make a copy of the DHCP server database files.</P>
<P>    2.    In the \s<I>ystemroot</I>\System32\Dhcp directory, delete the J50.log, J50#####.log, and Dhcp.tmp files.</P>
<P>    3.    Copy an uncorrupted backup version of the Dhcp.mdb to the \s<I>ystemroot</I>\System32\Dhcp directory.</P>
<P>    4.    Restart the Microsoft DHCP Server service.</P>
<H4 CLASS="h3"><A NAME="sec0"></A>Restarting and Rebuilding a Stopped DHCP Server</H4><P CLASS="t">In rare circumstances, the DHCP server may not start or a STOP error might occur. If the DHCP server is stopped, use the following procedure to restart it.</P>
<P CLASS="t"><B>To restart a DHCP server that is stopped</B></P>
<P>    1.    Turn off the power to the server and wait at least 15 seconds. </P>
<P>    2.    Turn on the power, start Windows&nbsp;NT Server, and then log on under an account with Administrator rights.</P>
<P>    3.    At the command prompt, type the <B>net start dhcp</B> command,<B> </B>and then press Enter.</P>
<P CLASS="t">If the hardware for the DHCP server is malfunctioning or other problems prevent you from running Windows&nbsp;NT, you must rebuild the DHCP database on another computer.</P>
<P CLASS="t"><B>To rebuild a DHCP server</B></P>
<P>    1.    If you can start the original DHCP server by using the <B>net start</B> DHCP command, use a copy command to make backup copies of the files in the \s<I>ystemroot</I>\System32\Dhcp directory. If you cannot start the computer at all, you must use the last backup version of the DHCP database files.</P>
<P>    2.    Install Windows&nbsp;NT Server and Microsoft TCP/IP to create a new DHCP server using the same hard-drive location and \s<I>ystemroot </I>directory.</P>
<P>That is, if the original server stored the DHCP files on C:\Winnt\System32\Dhcp, then the new DHCP server must use this same path to the DHCP files.</P>
<P>    3.    Make sure the Microsoft DHCP Server service on the new server is stopped, and then use the Registry Editor to restore the DHCP keys from backup files.</P>
<P>    4.    Copy the DHCP backup files to the \s<I>ystemroot</I>\System32\Dhcp directory.</P>
<P>    5.    Restart the new, rebuilt DHCP server.</P>
<H4 CLASS="h3"><A NAME="sec1"></A>Moving the DHCP Server Database</H4><P CLASS="t">You may find a situation where you need to move a DHCP database to another computer. To do this, use the following procedure.</P>
<P CLASS="t"><B>To move a DHCP database</B></P>
<P>    1.    Stop the Microsoft DHCP Server on the current computer.</P>
<P>    2.    Copy the \System32\Dhcp directory to the new computer that has been configured as a DHCP server.</P>
<P>Make sure the new directory is under exactly the same drive letter and path as on the old computer.</P>
<P>If you must copy the files to a different directory, copy Dhcp.mdb, but do not copy the .log of .chk files.</P>
<P>    3.    Start the Microsoft DHCP Server on the new computer.</P>
<P>The service automatically starts using the .mdb and .log files copied from the old computer.</P>
<P CLASS="t">When you check <B>DHCP Manager</B>, the scope still exists because the Registry holds the information on the address range of the scope, including a bitmap of the addresses in use. You need to reconcile the DHCP database to add database entries for the existing leases in the address bitmask. As clients renew, they are matched with these leases, and eventually the database is once again complete.</P>
<P CLASS="t"><B>To reconcile the DHCP database</B></P>
<P>    1.    On the <B>Scope</B> menu, click <B>Active Leases</B>.</P>
<P>    2.    In the <B>Active Leases</B> dialog box, click <B>Reconcile</B>.</P>
<P CLASS="t">Although it is not required, you can force DHCP clients to renew their leases in order to update the DHCP database as quickly as possible. To do so, type <B>ipconfig/renew </B>at the command prompt. </P></BODY></HTML>
