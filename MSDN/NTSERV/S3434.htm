<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Backup Strategy</title>
<style>@import url(msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="msdn_ie3.css"><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"></HEAD><BODY BGCOLOR="#FFFFFF">
<H3 CLASS="h2">Backup Strategy</H3><P CLASS="t">Doing regular backups of data on servers and local hard disks prevents data loss and damage caused by disk failures, power outages, virus infection, and network problems. Backup operations based on careful planning and reliable equipment make file recovery easier and less time consuming.</P>
<P CLASS="t">Windows&nbsp;NT includes the backup program, Ntbackup.exe, that enables you to use a tape drive to back up and restore files on Windows&nbsp;NT file system (NTFS) or file allocation table (FAT) volumes. The Ntbackup program also simplifies archiving. You can easily save data for legal or historical purposes and remove older, unused files, knowing that you can recover them, if necessary. </P>
<P CLASS="t">Ntbackup can perform several different kinds of backups:</P>
<UL><LI>A <I>normal</I> backup, also called a <I>full</I> backup, copies all selected files and marks each as having been backed up. With normal backups, you can restore files quickly because files on the last tape are the most current.</LI><LI>A <I>copy</I> backup copies all selected files but does not mark each file as having been backed up. Copying is useful if you want to back up files between normal and incremental backups, because copying does not invalidate these other backup operations.</LI><LI>An <I>incremental</I> backup backs up only those files created or changed since the last normal or incremental backup. It marks files as having been backed up. If you use a combination of normal and incremental backups, restoring requires starting with your last normal backup and then working through all the incremental tapes.</LI><LI>A<I> differential</I> backup copies those files created or changed since the last normal (or incremental) backup. It does not mark files as having been backed up. If you are doing normal and differential backups, restoring requires only the last normal and last differential backup tape. </LI><LI>A <I>daily</I> backup copies all selected files that have been modified the day the daily backup is performed. The backed up files are not marked as having been backed up. (This can be useful if you want to take work home and need a quick way to select the files that you worked on that day.)</LI></UL><P CLASS="t">Chapter 6, "Backing Up and Restoring Network Files," in the <I>Windows&nbsp;NT Server Concepts and Planning</I> book, describes developing your backup plan and using Ntbackup. </P>
<P CLASS="t">When developing your backup plan:</P>
<UL><LI>Be sure to have spare hardware in case of a failure in your backup device.</LI><LI>Plan to test your backed up data regularly to verify that you can rely on your backup procedures and equipment.</LI><LI>Include stress testing of your backup hardware (tape drives, optical drives, and controllers) and software (backup program and device drivers).</LI><LI>Consider security regarding your backups. If you have implemented physical security to protect your computers, but unauthorized people can get access to your backup tapes, your data are not protected.</LI></UL><P CLASS="t">This section:</P>
<UL><LI>Provides an approach for backing up computers on a small LAN and discusses backing up very large servers and ones that must be available 24 hours a day.</LI><LI>Discusses the types of data that you should regularly back up.</LI><LI>Lists questions that you should consider when planning your backup procedures.</LI></UL><H4 CLASS="h3"><A NAME="sec0"></A>Backup Approaches</H4><P CLASS="t">There are two extremes when it comes to backing up data on computers running Windows&nbsp;NT:</P>
<UL><LI>You have a small, simple network.</LI><LI>The computer that you want to back up needs to be available 24 hours a day, 7 days a week, or contains a large amount of data to back up. </LI></UL><P CLASS="t">This section discusses backup approaches for these two situations.</P>
<H5 CLASS="h4"><A NAME="sec1"></A>Small and Medium LANs</H5><P CLASS="t">This section describes an approach for backing up computers running Windows&nbsp;NT Server and Windows&nbsp;NT Workstation on a small to medium LAN. There are no backup devices connected to computers running Windows&nbsp;NT Workstation. Therefore, data from those computers needs to be backed up on computers running Windows&nbsp;NT Server. </P>
<P CLASS="t">This network has the following characteristics:</P>
<UL><LI>1 - 10 computers running Windows&nbsp;NT Server.</LI><LI>Total disk space 1 - 25 GB on each computer running Windows&nbsp;NT Server.</LI><LI>Typical daily data modifications in the range of 100-1000 MB. </LI><LI>Typically has scheduled downtime at night or on weekends.</LI><LI>There are a minimum of two backup devices on different computers running Windows&nbsp;NT Server. One should be on the primary domain controller (PDC). If you have backup domain controller (BDC), this computer should have the second backup device. </LI><LI>All computers running Windows&nbsp;NT Server are capable of hosting the backup devices. </LI></UL><P CLASS="t">These are suggested guidelines for backing up all of the computers that are running Windows&nbsp;NT, assuming that you are using Ntbackup or a similar program to back up your data to a cartridge tape:</P>
<UL><LI>If you are using tape drives that are SCSI controlled, insure that the drives will work in all of the computers. Are there spare SCSI IDs available on the chain?</LI><LI>Does each computer still function correctly after you install the tape drive?</LI><LI>Does Ntbackup work on each computer, and does a test restore work on each computer?</LI><LI>All backup devices should use the same media. Preferably, all backup devices are the same make and model.</LI><LI>Verify that the media works in all of the backup devices.</LI><LI>The backup device must be fast enough to complete a backup in the time allotted, which could be overnight, or a specified number of hours.</LI><LI>Perform a complete backup (called normal or full in NTBackup) on a regular basis, such as once a week. </LI><LI>Do an incremental backup of files on the days that you do not perform a full backup.</LI><LI>The backup media should be capable of writing a complete incremental backup on one cartridge. Preferably, a full backup fits on one cartridge.</LI><LI>Label all backup media with the date, the computer on which it was created, and the type of backup, such as full or incremental.</LI><LI>Rotate your backup media. Some suggestions are described in Chapter 6, "Backing Up and Restoring Network Files," in the <I>Windows NT Server Concepts and Planning</I> book.</LI><LI>Secure the backup media in a fireproof safe large enough for a full rotation's worth of cartridges.</LI><LI>Split nightly backups on all computers running Windows&nbsp;NT Server among the backup devices for load balancing and reliability.</LI><LI>Back up the Registry on your PDC and BDC every night.</LI><LI>Back up critical data located on computers running Windows&nbsp;NT Workstation every night. Users should copy important files from the client computers to an area on the computer(s) that do the backup.</LI></UL><H5 CLASS="h4"><A NAME="sec2"></A>Considerations for 24 Hour Operations or Very Large Backups</H5><P CLASS="t">If the data set being backed up is very large, such as a SQL database or a number of large graphics files, it is difficult to back up the data within a reasonable amount of time, given the limitations of existing tape hardware. If Windows NT has locked the file for backup, and it is still locked when the clients start trying to access the file the next morning, the procedure described in the preceding section will not work. If the time available for backups is very small because the files are needed 24 hours a day, you will need a different approach than the one previously described.</P>
<P CLASS="t">You could configure the disks that require daily backup separately from the Windows&nbsp;NT Server system disks by using Redundant Array of Inexpensive Disks (RAID) arrays. For your critical computers, you could implement a software mirror of two separate hardware-controlled RAID arrays. With this configuration, if either a disk or an entire array fails, operations can continue. If a component such as a network interface card, video device, IDE adapter, or power supply fails, it can be easily replaced. If the computer running Windows&nbsp;NT Server itself fails, you should have a spare computer with Windows&nbsp;NT Server already installed to which you can move the data disks. </P>
<P CLASS="t"><B>Note</B></P>
<P>RAID arrays provide disk fault-tolerance completely within hardware that you purchase from a vendor. In RAID arrays, the controller interface handles the creation and regeneration of redundant information that is automatically used if there is a failure in one of the disks in the array. See "Planning a Fault-Tolerant Disk Configuration," presented later in this chapter, for more information about RAID arrays.</P>
<P CLASS="t">One approach to backing up data on a critical computer running Windows&nbsp;NT Server involves logically removing the computer from the network by:</P>
<UL><LI>Disconnecting all users.</LI><LI>Pausing the Server service by using the Services option on Control Panel.</LI><LI>Ensuring that all files are closed, so that they can be accessed by the backup procedure. </LI></UL><P CLASS="t">The following methods are variations on this approach. The first two methods can be used to back up the data once you have removed the computer from the network. In these methods, we call the computer that contains the data to be backed up DATA. The computer that actually does the backup is called TARGET. The third method allows users to continue to access the data on DATA while it is being backed up.</P>
<H5 CLASS="h4"><A NAME="sec3"></A>Backup Method 1</H5><P CLASS="t">Copy the data from DATA to TARGET. When the data are on NTFS volumes, you can use the Scopy program to copy the permissions as well as the data. If you don't need permissions, you can use the<B> </B>Xcopy program to just copy the data. To copy database files, use functions in the database application. If you expect the network to be busy when you will be doing the copy, it is best to dedicate a computer-to-computer link. Once the data are on TARGET, you can bring DATA online and back up the files from TARGET. Copying the data to TARGET minimizes the amount of time that DATA is not available to users. </P>
<P CLASS="t"><B>Note</B></P>
<P>The Scopy program (on the <I>Windows&nbsp;NT Server Resource Kit</I> CD) does not support copying only the files that have been modified. The Xcopy program (on the Windows&nbsp;NT Server product CD) does support copying only modified files, but does not copy the file permissions. You need to decide whether Scopy or Xcopy works best for your situation, or whether you need to use a different program to copy the files.</P>
<P CLASS="t">Ideally, you should do a complete file comparison between the data on DATA and TARGET to verify the transferred data. However, comparing the data will take about twice as long as it takes to copy the data. Typical Ethernet or Token Ring transfer speeds are 1 MB per second, if the network is not busy. Use this transfer rate and the total amount of data to transfer to determine the expected transfer time. If you do not have enough time, you will need to use a faster network connection, or a different backup method.</P>
<H5 CLASS="h4"><A NAME="sec4"></A>Backup Method 2</H5><P CLASS="t">Copy the data that you want to back up to another disk or disks on DATA. This process is usually faster than copying to another computer over the network because it occurs within the same computer. You can now bring DATA online. The copy of the data can then be backed up by using a backup device connected to DATA. If you do not want run the backup program on DATA, you can transfer the copy of the data to TARGET, from which you do the backup. </P>
<P CLASS="t">You need to decide whether to do the backup on DATA or TARGET. This decision depends on factors such as:</P>
<UL><LI>Availability of a computer to use as TARGET.</LI><LI>Your overall backup strategy, which might specify that all backups be performed on a few central computers.</LI><LI>Whether the processing overhead of doing the backup on DATA is more than the cost and processing overhead associated with transferring the files over the network to TARGET.</LI><LI>How long you expect the backup to take.</LI></UL><H5 CLASS="h4"><A NAME="sec5"></A>Backup Method 3</H5><P CLASS="t">There are also third-party utilities that mirror the data onto another computer running Windows&nbsp;NT Server across the network while the files are still being used on DATA. This approach is best when you absolutely cannot take a chance of losing data because a disk or RAID array fails. While there might be some down-time associated with moving data from the mirror computer to the DATA computer after a failure on DATA is fixed, this approach is preferable to losing all data created or changed since the last backup of any kind. Again, performance is better if a network link is dedicated to this task. The other advantage of this approach is that the files being backed up are still available, and there is no downtime required to make copies.</P>
<H4 CLASS="h3"><A NAME="sec6"></A>What Data to Back Up</H4><P CLASS="t">There are different kinds of data that you should back up. This section describes the types of data and why you should back them up.</P>
<H5 CLASS="h4"><A NAME="sec7"></A>Registry</H5><P CLASS="t">The Registry is the most critical set of files on the computer as far as day-to-day operations are concerned. As a user, you would know fairly quickly if a system file is missing or corrupt — the computer would crash or fail to execute the command. The Registry is different. The computer might start, but then hang at the logon screen because all the security settings are missing or some required service did not started. On a computer running Windows&nbsp;NT Server, you need to have a current backup of the Registry. Otherwise, you have to rebuild information about all your users, groups and permissions, and you can never be certain that it is just the way it was before. There are several methods that you can use to back up all or part of the Registry, which are described in Chapter 5, "Preparing for and Performing Recovery." You should develop backup procedures specifically for the Registry to make sure people know who should be doing the backup.</P>
<H5 CLASS="h4"><A NAME="sec8"></A>Logon Scripts</H5><P CLASS="t">Logon scripts are files that can be assigned to user accounts. Each time a user logs on, the assigned logon script is run. You can use logon scripts to configure user working environments by creating network connections and starting applications. Logon scripts are useful when you want to affect the user work environment without managing all aspects of it. A logon script runs automatically whenever a user logs on to a computer running either Windows&nbsp;NT Server or Windows NT Workstation. A logon script is always downloaded from the computer running Windows&nbsp;NT Server that validates a user's logon request.</P>
<P CLASS="t">For users with accounts on Windows&nbsp;NT Server domains that have one or more BDCs, any one of the domain controllers can authorize a user's logon attempt. To ensure that logon scripts always work for users, you should be sure that logon scripts for all user accounts in a domain exist on every PDC and BDC in the domain.</P>
<P CLASS="t">The best way to ensure that logon scripts are always available and consistent is to use the Replicator service. In replication, actual copies of the files are sent across the network to other computers. In the case of logon scripts, you would decide which domain controller should be the sending computer. The receiving computers would be all of the other domain controllers.</P>
<P CLASS="t">You can also replicate information other than Logon scripts, but replication should only be used for critical information that must be available, even if the computer running Windows&nbsp;NT Server it is normally on is unavailable. Replicating files unnecessarily can put a large load on the network and slow it considerably. </P>
<P CLASS="t"><B>Note</B></P>
<P>You should use replication for such critical data as the DHCP and WINS databases. For more information, see Chapter 7, "Using Microsoft DHCP Servers," and Chapter 8, "Managing Microsoft WINS Servers," in the <I>Windows&nbsp;NT Server Networking Guide</I>. </P>
<P CLASS="t">See Chapter 3, "Managing User Work Environments," in the <I>Windows&nbsp;NT Server Concepts and Planning</I> book, for more information about logon scripts.</P>
<H5 CLASS="h4"><A NAME="sec9"></A>Application Programs </H5><P CLASS="t">Application programs, such as Microsoft Word for Windows, are typically what network users are involved with on a daily basis. You can always reinstall the executable files themselves from the original distribution media, but the down time and lost productivity make this approach less than ideal. Additionally, you might have customized the application programs to suit the needs of your organization. The difficulty of reproducing those settings can be greater than reloading the programs themselves. Fortunately, since the files rarely change, backing up the files are part of your backup procedure insures that the latest version is quickly available, and it does not use a lot of offline storage space. For example, using Ntbackup with the Incremental option insures that any changes made are easily recoverable. Or, you could do a complete backup of the volumes that contain your application programs when you make changes.</P>
<H5 CLASS="h4"><A NAME="sec10"></A>User Data</H5><P CLASS="t">The greatest amount of change on any server is in the users' folders. Users constantly add, modify, or delete files from the computer. You should do daily backups of changes to users' folders. </P>
<P CLASS="t">Some of your users will keep most of the files that they want backed up on file servers. Other users will do most of their work on their own workstation and want that data backed up. Your backup procedures need to cover both situations.</P>
<H4 CLASS="h3"><A NAME="sec11"></A>Questions to Consider in Developing Backup Procedures</H4><P CLASS="t">The critical nature of backups requires complete verification of the entire backup and restore process. Because backup programs vary in their specifics and procedures, this section identifies some of the questions that you should ask, and answer, concerning the process.</P>
<H5 CLASS="h4"><A NAME="sec12"></A>Who</H5><P CLASS="t">These are questions to consider when you are deciding who should be doing certain tasks:</P>
<UL><LI>Who determines what files and computers will be backed up, and how will the policy be published?</LI><LI>Who is responsible for doing the backup? Is this responsibility formally part of their job description?</LI><LI>To whom is the success or failure of the backup reported?</LI><LI>If the designated backup operator(s) are unavailable, who is the alternate?</LI><LI>How are users notified if the backup fails?</LI><LI>If the backup takes place unattended, but in a location that has off-shift personnel, are they trained to monitor the backup?</LI><LI>Should they intervene in case of failure?</LI><LI>Who do they notify of a problem?</LI><LI>What is the process they should follow?</LI><LI>Do they have some way to contact the responsible individual(s)?</LI><LI>Are these individuals required to be available by telephone or wear pagers?</LI><LI>If trained personnel are to monitor the backup, how are they scheduled for the next day?</LI><LI>Is there coverage for their other duties if there are problems with doing the backup, or they need to do a lengthy restore?</LI><LI>During vacations, sickness, or other absences, who will do the backup?</LI><LI>If a backup fails because of a hardware problem, who is the contact point with the vendor or manufacturer?</LI><LI>If the backup fails because of software problems, who do you contact?</LI></UL><H5 CLASS="h4"><A NAME="sec13"></A>When</H5><P CLASS="t">You also need to consider when and how often the backups should take place:</P>
<UL><LI>If you want to back up as many files as possible, the backup will probably occur after-hours. Will this be true only for full backups or all backups?</LI><LI>How often do you do full backups and incremental backups?</LI><LI>At what time should the backup occur, immediately after hours or before business hours early the next day?</LI><LI>If the backup fails because of hardware problems, is there standby hardware, or can a loaner be obtained from the vendor?</LI><LI>Will the vendor guarantee availability of a loaner?</LI><LI>How long will it take to replace the failed hardware?</LI><LI>Is the vendor's technical support available at all times?</LI><LI>Is software technical support available at all times?</LI><LI>Do you have a configuration book that contains information about the computers running Windows&nbsp;NT Server that any technical support person might need?</LI><LI>If not, how long will it take to create this information when you have a problem?</LI><LI>What are the policies of the hardware or software vendor concerning fixes and how long they might take?</LI><LI>How long will it take to retrieve the backups or copies from a local or remote storage area?</LI><LI>Can the remote copies be obtained at any time or only during business hours?</LI><LI>How long will it take to do a full restore if the computer totally fails?</LI></UL><H5 CLASS="h4"><A NAME="sec14"></A>Where</H5><P CLASS="t">Where you do the backups and where you store the backup media are also important questions:</P>
<UL><LI>Is the backup taking place in a secure area?</LI><LI>If so, how is it monitored?</LI><LI>Where are the backup tapes stored?</LI><LI>Is the storage location secure?</LI><LI>Is it fireproof, waterproof, and otherwise protected from disasters?</LI><LI>Are the tapes that are stored on site accessible at all times to the people who might need them?</LI><LI>Are there copies, and where are they stored?</LI><LI>Is the offsite location secure?</LI><LI>Is it fireproof, waterproof, and otherwise protected from disasters?</LI><LI>Is it bonded?</LI><LI>Will the backup be done to a local tape drive, remotely over the LAN, or remotely over the WAN?</LI><LI>How is the connection verified before the backup begins?</LI><LI>How are computers equipped for power outages if operators are not present and backups are taking place?</LI></UL><H5 CLASS="h4"><A NAME="sec15"></A>What</H5><P CLASS="t">You need to decide what to back up:</P>
<UL><LI>What is the backup plan?</LI><LI>Are all modified files to be backed up, or will there be a policy regarding specific users, groups, departments, divisions, or company-critical files?</LI><LI>Will there be disks or volumes on the computer running Windows&nbsp;NT Server that are not backed up?</LI><LI>Will users be responsible for backup of their individual client systems?</LI><LI>Will there be a chargeback system for the amount of storage used?</LI></UL><H5 CLASS="h4"><A NAME="sec16"></A>How</H5><P CLASS="t">You also need to determine how you will do the backups and how to determine if backups work correctly:</P>
<UL><LI>How is the backup process certified?</LI><LI>Has every option that you expect to use been tested?</LI><LI>Do the scripts work?</LI><LI>Do the logs get created and are they correct?</LI><LI>If the path is long, the filename odd, the file size very large, or the number of files is large, does the backup still work? Can you restore files that have these chacteristics?</LI><LI>How is the backup started: from the command line, an icon, or by batch?</LI><LI>Do these methods all work the same?</LI><LI>If you schedule your backups, do they occur as scheduled?</LI><LI>Is the tape actually verifying the data?</LI><LI>Does a test restore work?</LI><LI>Does the system have to be in a certain condition before the backup starts?</LI><LI>What is the typical or expected state of the system before, during, and after the backup?</LI><LI>What is the actual condition?</LI><LI>Are there any unforeseen behaviors?</LI><LI>When you make changes to the operating system (such as installing a service pack), or the backup program, do you recertify the backup/restore process?</LI><LI>If you make hardware changes on the computer, such as installing a new controller or tape drive, or changing the BIOS on the motherboard, do you recertify the backup/restore process?</LI><LI>How do you certify that you can use your old tapes when you have changed hardware of software involved in the backup?</LI></UL></BODY></HTML>
