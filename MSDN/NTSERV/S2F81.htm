<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Modifying FTP Ports</title>
<style>@import url(msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="msdn_ie3.css"><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"></HEAD><BODY BGCOLOR="#FFFFFF">
<H3 CLASS="h2">Modifying FTP Ports</H3><P CLASS="t">It is easy to modify the Well Known Port Number for FTP. However, to allow FTP clients access to your site, keep the FTP server port number set at 21 for most installations of Internet Information Server.</P>
<P CLASS="t">If you want to limit access to your FTP server, you can change the control connection (port 21) to a TCP port number greater than 1023 to "hide" your site.</P>
<P CLASS="t">You can change FTP server TCP port numbers by modifying the <I>Systemroot</I>\System32\Drivers\Etc\Services file or by changing their values in the Registry. The setting in the Services file takes precedence over the Registry setting in all cases. That is, by changing the Services file, you affect both the FTP client and the FTP server. By changing the Registry, you affect only the FTP server.</P>
<H4 CLASS="h4"><A NAME="sec0"></A>To change the TCP port in the Services file</H4><OL><LI>At a command prompt, change directories to <I>Systemroot</I>\System32\Drivers\Etc.</LI><LI>Use a text editor to search the Services file for the following two entries:</li><P>ftp-data           20/tcp<BR>ftp                21/tcp</P>
<li>Modify port 21 to a number greater than 1023. See the following example.</LI><P>ftp-data           20/tcp         # The # sign designates a comment.<BR>ftp                1234/tcp       # FTP port changed to 1234, was 21.</P>
<LI>Save and close the file. To implement the change, stop, then restart the FTP service.</LI></OL><P><B>Note</B>   This affects the default TCP ports on both the FTP client and the FTP server.</P>
<P CLASS="t">Your FTP server now waits at port 1234 for all FTP client requests and your FTP client connects only to an FTP server at port 1234. </P>
<H4 CLASS="h4"><A NAME="sec1"></A>To verify the new FTP port settings</H4><OL><LI>At a command prompt, type the command <B>ftp</B>.</LI><P>The ftp&gt; prompt appears.</P>
<LI>Type the command <B>open 127.0.0.1  21</B> and then press enter.</LI><P>The IP address 127.0.0.1 is the loopback address for your computer. You are specifying 21 as the destination port address. The following message appears:</P>
<P>-&gt; ftp: connect:Connection refused</P>
<LI>Type the command <B>open 127.0.0.1 </B>and then press enter.</LI></OL><P>The port now reverts to the default number specified in the Services file: 1234. You are prompted with the following logon message:</P>
<P>User &lt;127.0.0.1:&lt;none&gt;&gt;:</P>
<P>This verifies that both the FTP client and FTP server are using port 1234.</P>
<H4 CLASS="h4"><A NAME="sec2"></A>To change the Registry entry for FTP</H4><OL><LI>Start the Registry Editor, <B>Regedt32.exe</B>. </LI><LI>Click the HKEY_LOCAL_MACHINE window and locate the following key:</LI></OL><P>\System</P>
<P>  \CurrentControlSet</P>
<P>    \Control</P>
<P>      \ServiceProvider</P>
<P>        \ServiceTypes</P>
<P>          \MSFTPSVC</P>
<OL><LI>Click MSFTPSVC and then double-click the <B>TcpPort</B> value.</LI></OL><P>The <B>DWORD Editor </B>dialog box appears.</P>
<OL><LI>Click <B>Decimal </B>and enter <B>5678</B> in the <B>Data </B>box.</LI><LI>Click <B>OK</B> and close the Registry Editor.</LI><LI>At the command prompt, type the following information:</LI></OL><P><B>cd %systemroot%\system32\drivers\etc</B></P>
<P>ren services services.ok</P>
<P>This prevents the FTP server from using the port address in the Services file after it has been restarted.</P>
<OL><LI>To implement the change, stop and restart the FTP service.</LI></OL><P><B>Note</B>   This situation affects the default port only on the FTP server.</P>
<P CLASS="t">If you have completed the preceding steps, your FTP server now monitors port 5678 for all FTP client requests and your FTP client connects to an FTP server at port 1234 only.</P>
<H4 CLASS="h4"><A NAME="sec3"></A>To verify the new FTP port settings</H4><OL><LI>At a command prompt, type <B>ftp</B>, then press enter. </LI><P>The ftp&gt; prompt appears.</P>
<LI>Type the following commands:</LI></OL><P><B>open 127.0.0.1   </B></P>
<P>open 127.0.0.1  21</P>
<P>open 127.0.0.1  1234</P>
<P>The following message appears:</P>
<P>-&gt; ftp: connect: Connection refused</P>
<OL><LI>Type the command <B>open 127.0.0.1  5678</B> and then press enter.</LI></OL><P>The port defaults to the number specified in the Registry: 5678. You are prompted with the following logon message:</P>
<P>User &lt;127.0.0.1:&lt;none&gt;&gt;:</P>
<P>This procedure verifies that both the FTP client and FTP server are using port 5678.</P></BODY></HTML>
