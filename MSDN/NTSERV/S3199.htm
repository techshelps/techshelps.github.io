<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Backup of the DHCP Directory and Files</title>
<style>@import url(msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="msdn_ie3.css"><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"></HEAD><BODY BGCOLOR="#FFFFFF">
<H3 CLASS="h2">Backup of the DHCP Directory and Files</H3><P CLASS="t">Replication of the WINS and DNS databases is an automatic feature of both the Windows&nbsp;NT Server WINS and DNS services and is configured during the installation process of WINS and DNS. At Terra Flora, replication of these databases has been configured to replicate on different servers in the network. The DHCP service, while it does provide a backup of the database and files in the System32\DHCP\Backup directory, cannot automatically be configured to replicate to different servers. An additional step is required. </P>
<P CLASS="t">The System 32\DHCP\ Backup directory is stored on the same physical drive as the DHCP database directory. At Terra Flora, the plan is to backup the DHCP directory to a different physical device on the same computer running the Windows&nbsp;NT Server DHCP service and then replicate the backup to another server. This plan provides a backup DHCP database copy should either the physical drive on which the DHCP database is stored or the computer running Windows NT Server DHCP service fail. The backup plan for the DHCP servers is as follows:</P>
<P>    1.    The Registry will be edited to allow backup of the DHCP database to another physical drive on the DHCP server.</P>
<P>    2.    Additionally, each DHCP database and associated files will be replicated to an Enterprise/Enterprise level server that is not running DHCP.</P>
<P>    3.    The Replicator service will be used to back up the necessary file stored in the System32\DHCP\Backup directory to an Enterprise/Enterprise Remote server which is not running the DHCP service. </P>
<P CLASS="t">Refer to Terra Flora's network diagram, one DHCP database directory on the server named CANTS40ENT03 will be replicated to CANT40ENT01 and the other DHCP directory on the server named CANT40ENT02 will be replicated on CANT40ENT05.</P>
<H4 CLASS="h3"><A NAME="sec0"></A>Editing the Registry</H4><P CLASS="t">At Terra Flora, the Registry Editor will be changed to ensure that backup is made to a different physical device on the DHCP server that stores the database and files. </P>
<P CLASS="t"><B>To edit the registry</B></P>
<P>    1.    At the command prompt, type <B>Regedt32</B>, and press enter.</P>
<P>    2.    Double-click HKEY_LOCAL_MACHINE.</P>
<P>    3.    Double-click System.</P>
<P>    4.    Double-click CurrentControlSet.</P>
<P>    5.    Double-click Services.</P>
<P>    6.    Double-click DHCP Server.</P>
<P>    7.    Double-click Parameters.</P>
<P>    8.    Double-click Backup Database Path. </P>
<P>    9.    Change the first part of the line to indicate a different physical drive on the server, such as<B>D:\System32\dhcp\backup</B>. </P>
<P>The information will then be backed up to the physical drive indicated. </P>
<P CLASS="t">You can now use the Replicator Service to copy that directory to a backup server. </P>
<H4 CLASS="h3"><A NAME="sec1"></A>Managing Directory Replication </H4><P CLASS="t">Backing up a directory to a different server is a task performed by Windows&nbsp;NT Server Directory Replicator service. The server on which the DHCP directory is stored will be configured as an export server. The server which will store the backup copy of the DHCP directory and files is the import server.</P>
<P CLASS="t">When you update a file in the directory tree on one server (the export server), the updated file is automatically copied to all the other computers (the import computers). Only servers running Windows&nbsp;NT Server can be export servers; import computers can run either Windows&nbsp;NT Server or Windows&nbsp;NT Workstation.</P>
<H4 CLASS="h3"><A NAME="sec2"></A>How Directory Replication Works</H4><P CLASS="t">Directory replication is initiated and carried out by the Directory Replicator service. This service operates on each export server and import computer that participates in replication. The service on each computer logs on to the same user account, which you create for this purpose. </P>
<P CLASS="t">You set up an export server and import computers to send and receive updated files. An export directory on the export server contains all the directories and subdirectories of files to be replicated, and when changes are saved to files in these directories, the files automatically replace the existing files on all the import computers.</P>
<P CLASS="t">You can also specify whether to have the export server send changes out as soon as a file has changed or, to prevent exporting partially changed trees, to wait until one export subdirectory has been stable before exporting. See "Managing Exported Subdirectories," later in this chapter.</P>
<P CLASS="t">In addition, you can lock a particular export or import directory, when needed. Changes to the locked directory are not exported or imported until you unlock the directory.</P>
<P CLASS="t">On the export server, you also designate which computers or domains are to receive replicated copies of the directories this server is exporting.</P>
<P CLASS="t">An export server has a default export path: </P>
<P>C:\<I>systemroot</I>\SYSTEM32\repl\EXPort </P>
<P CLASS="t">All directories to be replicated are exported as subdirectories in the export path. Subdirectories created in the export path, and files placed in those subdirectories, are automatically exported. Export servers can replicate any number of subdirectories (limited only by available memory), with each exported subdirectory having up to 32 subdirectory levels in its tree.</P>
<P CLASS="t">An import computer has a default import path:</P>
<P>c:\<I>systemroot</I>\SYSTEM32\repl\IMPort. </P>
<P CLASS="t">Imported subdirectories and their files are automatically placed here. You do not need to create these import subdirectories. They are created automatically when replication occurs.</P>
<H4 CLASS="h3"><A NAME="sec3"></A>Replication Prerequisites</H4><P CLASS="t">Before a computer can participate in replication, you must create a special user account. Then for each computer in a domain that will participate in replication, configure its Directory Replicator service to log on using that special account:</P>
<UL><LI>In User Manager for Domains, create a domain user account for the Directory Replicator service to use when logging on. Be sure the user account has the <B>Password Never Expires</B> option selected, all logon hours allowed, and membership in the domain's Backup Operators group. See online Help and Microsoft Windows&nbsp;NT Server 4.0 Concepts and Planning, Chapter 2, "Working with User and Group Accounts" and Chapter 3, "Managing User Work Environments" for details.</LI><LI>After the user account is created for each computer that will be configured as an export server or an import computer, use Server Manager to configure the Directory Replicator service to start up automatically and to log on under that user account. Be sure the password for that user account is typed correctly. See online Help for details.</LI></UL><H4 CLASS="h3"><A NAME="sec4"></A>Setting Up an Export Server</H4><P CLASS="t">Any computer running Windows&nbsp;NT Server can be set up as an export server. (A computer running Windows&nbsp;NT Workstation cannot.)</P>
<P CLASS="t">Before you set up an export server, you must perform these tasks on the export server:</P>
<UL><LI>Assign a logon account to the Directory Replicator service of the export server.</LI><LI>Create the directories to be exported. They must be subdirectories of the replication export path (usually C:\<I>systemroot</I>\ SYSTEM32\REPL\EXPORT).</LI></UL><P CLASS="t">Use the Directory Replication dialog box to set up an export server.</P>
<H5 CLASS="h4"><A NAME="sec5"></A>Managing Exported Subdirectories</H5><P CLASS="t">By clicking <B>Manage</B> under <B>Export Directories</B> in the <B>Directory Replication</B> dialog box, you can manage certain features of subdirectory replication by the export server:</P>
<UL><LI>You can lock a subdirectory to prevent it from being exported to any import computers. For example, if you know a directory will be receiving a series of changes that you do not want partially replicated, you can put one or more locks on the subdirectory in the export path. Until you remove the lock or locks, the subdirectory will not be replicated. The date and time the lock was placed is displayed so that you know how long a lock has been in force.</LI><LI>When you stabilize a subdirectory, the export server waits two minutes after changes before exporting the subdirectory. The waiting period allows time for subsequent changes to take place so that all intended changes are recorded before being replicated.</LI><LI>You specify whether the entire subtree (the export subdirectory and all of its subdirectories) or just the first-level subdirectory in the export directory path is exported. </LI></UL><H4 CLASS="h3"><A NAME="sec6"></A>Setting Up an Import Computer</H4><P CLASS="t">Both Windows&nbsp;NT Server and Windows&nbsp;NT Workstation computers can be set up as import computers. A computer running Windows&nbsp;NT Server that is configured as an export server can also be configured as an import computer.</P>
<P CLASS="t">Before you set up an import computer, you must assign a logon account to the Directory Replicator service of the import computer. </P>
<P CLASS="t">On the import computer you do not need to create the imported subdirectories. A subdirectory is automatically created the first time it is imported.</P>
<P CLASS="t">Use the <B>Directory Replication</B> dialog box to set up an import computer. The Windows&nbsp;NT Server version of the<B> Directory Replication</B> dialog box is slightly different from the Windows&nbsp;NT Workstation version of this dialog box. The Windows&nbsp;NT Workstation version contains only the items related to imported directories. </P>
<P CLASS="t"><B>Tip</B></P>
<P>You can set up a server to replicate a directory tree to itself (from its export directory to its import directory). This replication can provide a local backup of the files, or you can use the import version of these files as another source for users to access, while preserving the export version of the files as a source master.</P>
<H4 CLASS="h3"><A NAME="sec7"></A>Managing Locks and Viewing Import Subdirectory Status</H4><P CLASS="t">You can use locks to prevent imports to subdirectories on an import computer. Import of a locked subdirectory to that import computer is prevented until the lock is removed. Locking a subdirectory on an import computer affects replication to only that computer, not to other import computers. </P>
<P CLASS="t">You can manage locks on subdirectories and also view the status of each subdirectory by clicking <B>Manage</B> under <B>Import Directories</B> in the <B>Directory Replication</B> dialog box. </P>
<P CLASS="t">The <B>Status</B> column can have one of four entries:</P>
<UL><LI>OK indicates that the subdirectory is receiving regular updates from an export server and that the imported data is identical to that exported.</LI><LI>No Master indicates that the subdirectory is not receiving updates. The export server might not be running, or a lock might be in effect on the export server.</LI><LI>No Sync indicates that although the subdirectory has received updates the data is <I>not</I> up-to-date. This could be due to a communications failure, open files on the import computer or export server, the import computer not having access permissions at the export server, or an export server malfunction.</LI><LI>No entry (blank) indicates that replication never occurred for that subdirectory. Replication may not be properly configured for this import computer, for the export server, or both.</LI></UL><P CLASS="t">The<B> Last Update</B> column shows the date and time of the latest change to the import subdirectory or to any of its subdirectories.</P></BODY></HTML>
