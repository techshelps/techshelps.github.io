<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Configuring the System Partition on a Mirror Set</title>
<style>@import url(msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="msdn_ie3.css"><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"></HEAD><BODY BGCOLOR="#FFFFFF">
<H3 CLASS="h2">Configuring the System Partition on a Mirror Set</H3><P CLASS="t">If you want to upgrade an existing Windows&nbsp;NT installation on a mirror set, you have to break the mirror set before starting Windows&nbsp;NT Setup. This means that you have to recreate the mirror set of the boot partition to have the Windows&nbsp;NT installation copied to the shadow partition.</P>
<P CLASS="t">The term duplexed mirror set means that each disk in the mirror set has its own disk controller. The controllers in a duplexed mirror set should be the same manufacturer and model</P>
<P CLASS="t">On x86-based computers, if your system partition is on a SCSI disk, you must have the BIOS enabled on its SCSI controller. Otherwise, the system BIOS will not be able to find Master Boot Record. </P>
<P CLASS="t">If you have created a mirror set of your system partition by using two SCSI controllers, you must make sure that you are using the same translation on the two controllers. If you are using different translations on your original disk and shadow disk, you will have to use the Windows&nbsp;NT startup floppy disk to start from the system partition on the shadow disk if the original disk fails. In addition, if you reconstruct the system partition on the original disk from the one on the shadow disk, you will not be able to start from either hard disk, and will always have to use the Windows&nbsp;NT startup floppy disk to start Windows&nbsp;NT.</P>
<P CLASS="t">You use the translation feature on SCSI controllers to set the translation mode. Because you have to disable the BIOS on the second controller, Windows NT always translates the geometry of the shadow partition to 32 sector per track and 64 heads per cylinder. Therefore, it is important to make sure the SCSI controller for the original disk is using the same translation. When their BIOS is enabled, most SCSI controllers default to a large disk translation scheme if the disk is larger than 1&nbsp;GB. The geometry for this translation is 255 heads and 63 sectors. Most SCSI controllers have some method to manually configure the controller to use the 32 sectors, 64 heads translation. Using 32 sectors and 64 heads on the controller for the original disk insures that both disks are as close to a true sector by sector mirror image as possible. Recovery from failures of the original disk or its controller is much easier if the geometry of both disks is the same. The only disadvantage is that the system partition must be within the first 1&nbsp;GB, or 1024 cylinders, of the disk.</P>
<P CLASS="t">Disabling the controller BIOS is different than turning off translation. Problems occur on x86-based computers because you need to have the BIOS enabled on the first controller in order to start the computer from the hard disk. If you do not turn off translation on both controllers, and the first controller fails, you need to enable the BIOS on the second controller. The translation on the second disk is now different than when you low-level formatted it, and you cannot use the disk. If your controller does not have the option to turn off translation, you can always leave the BIOS disabled, and use the Windows&nbsp;NT startup floppy disk to startup from the second controller.</P>
<P CLASS="t"><B>Note</B></P>
<P>If you disable the BIOS on both controllers, it does not matter if translation is enabled or disabled. However, you will not be able to start up from the hard disk if the BIOS is disabled.</P>
<P CLASS="t">If you get a message "drive is too small" when you try to reconstruct the mirror set after the failure of the original disk, the translation is not consistent.</P>
<P CLASS="t">Having two different SCSI controllers makes a trouble-free system restart in the event of a hardware failure far more difficult. If you use two different SCSI controllers in your mirror set, you need to have a different SCSI device driver for each controller. When you create your Windows&nbsp;NT startup floppy disk, you need to copy both device drivers to the disk. Then, when you use the Windows&nbsp;NT startup floppy disk, you need to rename the one for the controller that you will be using to Ntbootdd.sys. Alternatively, you can create two separate Windows&nbsp;NT startup floppy disks, copy the appropriate driver to each one, and rename it to Ntbootdd.sys.</P>
<P CLASS="t">You can use EIDE controllers for a mirror set of the system partition, and using them is less complex than using SCSI controllers on x86-based computers. EIDE disks usually require motherboard BIOS support for logical block addressing (LBA), and each motherboard usually does the LBA in the same way for all EIDE disks. </P>
<P CLASS="t">If you are going to mirror an IDE or EIDI disk with a SCSI disk, you should not mirror your system partition. You will probably have problems with incompatible geometry, and will always have to use the Windows&nbsp;NT startup floppy disk to restart after a failure of your original system partition. However, you can safely mirror your boot partition.</P>
<P CLASS="t">Recovering from the failure of the original system partition can be difficult if you do not plan your configuration and recovery procedure carefully. Following the procedures in this section give you the easiest and most reliable recovery process.</P>
<H4 CLASS="h4"><A NAME="sec0"></A>To create a mirror set of the system partition</H4><P>    1.    Enable the BIOS on the controller for the disk with the system partition, but make sure that translation is turned off if the disk is larger than 1<B>&nbsp;</B>GB. Use the SCSI setup program to turn off translation and set the geometry to use.</P>
<P>    2.    Disable the BIOS on all other SCSI controllers.</P>
<P>    3.    Make sure that the two disks you are mirroring are identical models.</P>
<P>    4.    Low-level format both disks by using the controller that has the BIOS enabled.</P>
<P>    5.    Make sure the partition layout on the two disks is the same, and that the cluster size is the same on both partitions.</P>
<P>    6.    Install Windows&nbsp;NT on the original disk.</P>
<P>    7.    Create the mirror set.</P>
<P>    8.    When the mirror set has finished initializing, set the Boot Indicator flag for the shadow disk. Disk Administrator does not set this flag. You can use the DiskProbe program, described in Chapter 7, "Disk, File System, and Backup Utilities," to set this flag.</P>
<P CLASS="t">When the shadow disk or controller fails, recovery is basically the same as recovering from the failure of any mirror set. You should follow the same guidelines for having identical disks and controllers as described earlier in this chapter. You can use the procedures in "Recovering a Mirror Set," presented later in this chapter, to rebuild the mirror set when you have the replacement hardware.</P>
<P CLASS="t">When the original disk or controller fails, Windows&nbsp;NT automatically starts using the shadow disk for all accesses. However, sometimes a problem is not detected until you try to start the computer. In this case, you can use the Windows&nbsp;NT startup floppy disk to start from your shadow partition. This method minimizes the amount of time that you are down, and allows you to schedule the reconstruction of the mirror set for a less busy time. You might need to power down the failed disk or remove it from the SCSI bus before attempting to start from the shadow partition.</P>
<P CLASS="t">When you can schedule down time on the computer, use one of the following two methods to reconstruct the mirror set.</P>
<H4 CLASS="h4"><A NAME="sec1"></A>Simplest method to reconstruct the mirror set</H4><P>    1.    While running Windows&nbsp;NT Server:</P>
<UL><LI>Break the mirror set, if you did not break it earlier. You can break the mirror set at any time after the failure, but you need to break it before you can start from your shadow disk without using the Windows&nbsp;NT startup floppy disk. The procedure to break the mirror set is described in the section titled "Recovering a Mirror Set," presented later in this chapter.</LI><LI>If you did not set the Boot Indicator flag in the System ID field of the system partition on the shadow disk, you can set it now by using Disk Administrator, because you have broken the mirror set. See Chapter 3, "Disk Management Basics," for information about this flag.</LI><LI>Shutdown the computer.</LI></UL><P CLASS="t"><B>Note</B></P>
<P>If you do not break the mirror set, you might get a Stop error 0xC000021A. This error occurs when there is an inconsistency in the Registry key HKEY_LOCAL_MACHINE\SYSTEM. When you get this error after a failure of the mirrored system partition, it is usually because the FT bit is set in the Master Boot Record, but the HKEY_LOCAL_MACHINE\SYSTEM\DISK Registry subkey does not have information about the mirror set. Your only recovery in this situation is to use a third-party low-level disk editor to clear the high order two bits of the Boot Indicator field for this partition. You will still have to break the mirror set after you startup Windows&nbsp;NT.</P>
<P>    2.    Remove the old original disk.</P>
<P>    3.    Replace the original disk with the shadow disk, changing SCSI IDs, if necessary.</P>
<P>    4.    Restart the computer. You might get a STOP 0x7b, a missing operating system error message, or similar errors that indicate there is something wrong with the Master Boot Record or the system partition on the shadow disk. You can do the following things to try to start from the shadow disk: </P>
<UL><LI>On x86-based computers, start the computer from your MS-DOS bootable floppy disk and replace the Master Boot Record by entering <B>fdisk /mbr</B> at the MS-DOS prompt. See the caution about using this switch in the section titled "Replacing the Master Boot Record," presented earlier in this chapter.</LI><LI>To replace the Windows&nbsp;NT files on the system partition, use Windows&nbsp;NT Setup, and select repair. Select the options to <B>Inspect boot sector</B> and <B>Inspect startup environment</B>, but do not select <B>Inspect Registry files</B> or <B>Verify Windows&nbsp;NT system files</B>. </LI></UL><P>    5.    If you cannot start from the shadow disk, move the shadow disk back to its old position. Use the next procedure described in this section to reconstruct the mirror set.</P>
<P>    6.    If you can start from the shadow disk:</P>
<UL><LI>Shut down the computer.</LI><LI>Install a new disk in the shadow disk's previous location.</LI><LI>Low-level format the new shadow disk, if necessary. If you have a duplexed mirror set, and the disk is larger than 1&nbsp;GB, be sure to use the same translation (32 sectors, 64 heads) on the two disks. </LI><LI>Start up the computer.</LI><LI>Use Disk Administrator to recreate the mirror set. Make sure to set the Boot Indicator flag on your newly created shadow disk by using DiskProbe.</LI></UL><P CLASS="t">There are times when the preceding procedure will not work, such as when you are using a Compaq computer with the EISA configuration partition as the first partition on the system disk.</P>
<P CLASS="t">The next procedure always works to recover from a failure of the original system partition if you set up your configuration as described earlier in this section, and if the shadow disk was not also damaged by the failure. You will need to schedule some down time for the computer when you are ready to replace the original disk.</P>
<P CLASS="t">The next procedure takes longer than simply swapping the original disk for the shadow disk and making the shadow disk the new original, but it guarantees that you have a stable system. After you have had one disk failure on the computer, you might not want to rely on the remaining disk as the original disk, because it might have been affected in some way. This procedure is much safer from a hardware as well as a software standpoint.</P>
<H4 CLASS="h4"><A NAME="sec2"></A>Most reliable method to reconstruct the mirror set</H4><P>    1.    While running Windows&nbsp;NT Server:</P>
<UL><LI>Break the mirror set, if you did not break it earlier. You can break the mirror set at any time after the failure, but you need to break it before you can start from your shadow disk without using the Windows&nbsp;NT startup floppy disk. The procedure to break the mirror set is described in the section titled "Recovering a Mirror Set," presented later in this chapter.</LI><LI>If you did not set the Boot Indicator flag in the System ID field of the system partition on the shadow disk, you can set it now by using Disk Administrator, because you have broken the mirror set. See Chapter 3, "Disk Management Basics," for information about this flag.</LI><LI>Back up the entire shadow disk, including the Registry.</LI><LI>Shutdown the computer.</LI></UL><P>    2.    Replace the original disk with a new disk of the same make and model. (If you had to move the shadow disk or change its SCSI ID because of the failure, change it back to the original configuration.)</P>
<P>    3.    Low-level format the replacement disk, if necessary. If you have a duplexed mirror set, and the disk is larger than 1&nbsp;GB, be sure to use the same translation for the two disks (32 sectors, 64 heads). </P>
<P>    4.    Install Windows&nbsp;NT on the new disk, creating and logically formatting partitions, as necessary. Make sure you install Windows&nbsp;NT into the same folder as your previous installation was in.</P>
<P>    5.    Start the new installation of Windows&nbsp;NT. Restore the backup, including the Registry.</P>
<P>    6.    Restart the computer from the original disk, and verify that the restore recovered all of the information on the disk.</P>
<P>    7.    Use Disk Administrator to delete the partitions on the shadow disk, and re-create the mirror. You might need to create other partitions on the shadow disk so you have the same layout on the two disks. Make sure to set the Boot Indicator flag on your newly created shadow system partition by using the DiskProbe program, as described in Chapter 7, "Disk, File System, and Backup Utilities."</P></BODY></HTML>
