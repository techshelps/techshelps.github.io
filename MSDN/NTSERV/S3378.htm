<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>NetBIOS Interface</title>
<style>@import url(msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="msdn_ie3.css"><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"></HEAD><BODY BGCOLOR="#FFFFFF">
<H3 CLASS="h2">NetBIOS Interface</H3><P CLASS="t">Network Basic Input/Output System (NetBIOS) defines a software interface and a naming convention, not a protocol. The NetBEUI protocol, introduced by IBM in 1985, provided a protocol for programs designed around the NetBIOS interface. However, NetBEUI is a small protocol with no networking layer and because of this, it is not a routable protocol suitable for medium-to-large intranets.</P>
<P CLASS="t">NetBIOS over TCP/IP (NetBT) provides the NetBIOS programming interface over the TCP/IP protocol, extending the reach of NetBIOS client/server programs to the WAN and providing interoperability with various other operating systems. NetBT and NetBIOS are illustrated in the following figure.</P>
<P><img src="XNG_K05.gif"></P>
<P CLASS="cap"><B>Figure 6.4    NetBIOS over TCP/IP (NetBT) Component</B></P>
<P CLASS="t">The Windows NT Workstation service, Server service, Browser, Messenger, and Netlogon services are all direct NetBT clients that use the TDI to communicate with NetBT. Windows NT also includes a NetBIOS emulator. The emulator takes standard NetBIOS requests from NetBIOS programs and translates them to equivalent TDI primitives.</P>
<H4 CLASS="h3"><A NAME="sec0"></A>NetBIOS Names</H4><P CLASS="t">The NetBIOS namespace is flat, meaning that all names within a network must be unique. NetBIOS names are 16 characters in length. Resources are identified by NetBIOS names that are registered dynamically when computers start, services start, or users log on. Names can be registered as unique (one owner) or as group (multiple owner) names. A NetBIOS Name Query is used to locate a resource by resolving the name to an IP address. </P>
<P CLASS="t">Microsoft networking components, such as Windows NT Workstation and Windows&nbsp;NT Server services, allow the first 15 characters of a NetBIOS name to be specified by the user or administrator, but reserve the 16th character of the NetBIOS name to indicate a resource type (00-FF hex). See Appendix G, "NetBIOS Names."</P>
<P CLASS="t"><B>To identify the names registered on your local computer</B></P>
<P>    1.    Click <B>Start</B>, and then click <B>Run</B>.</P>
<P>    2.    In <B>Open</B>, type <B>nbtstat</B><I> -n</I>.</P>
<H4 CLASS="h3"><A NAME="sec1"></A>NetBIOS Scope</H4><P CLASS="t">NetBIOS Scope, also known as TCP/IP Scope, provides a method for adding a second element to the single-element NetBIOS computer name. The scope ID is a character string value that is appended to the NetBIOS name and is used for all NetBT communications from that computer. The character string can be multi-part<FONT FACE="Symbol">¾</FONT>for example, "mydomain.mycompany.com".</P>
<P CLASS="t"><B>Note</B></P>
<P>Use of NetBIOS Scope is strongly discouraged if you are not already using it, or if you use Domain Name System (DNS) on your network.</P>
<P CLASS="t">By installation default, the NetBIOS Scope value is NULL. You can change the default value by entering a character string in the <B>Scope ID</B> on the <B>WINS Address </B>tab  on the <B>Microsoft TCP/IP Properties page</B>. Note that the maximum length of the combined NetBIOS name and NetBIOS Scope ID is limited to 256 characters.</P>
<P CLASS="t"><B>Note</B></P>
<P>NetBIOS Scope should not be confused with DHCP Scope, which defines the group of IP addresses that the DHCP server can lease to client computers.</P>
<P CLASS="t">The effect of using a NetBIOS Scope ID, other than the default NULL value, is to isolate a group of computers on the network that can communicate only with other computers that are configured with the identical NetBIOS Scope ID.<I> Use NetBIOS Scope only when it is necessary to isolate a group of computers that cannot communicate with other computers on the intranet.</I></P>
<P CLASS="t">Once configured on the local computer, NetBIOS Scope is automatically attached to all NetBIOS commands on that local computer. In other words, NetBIOS programs started on a computer using NetBIOS Scope ID cannot "see" (receive or send messages) NetBIOS programs started by a process on a computer configured with a different NetBIOS Scope ID.</P>
<P CLASS="t">Several Windows NT-based programs, such as net logon and domain controller pass-through authentication, use NetBIOS names. Therefore, consider the effect of NetBIOS Scope ID if you decide to change the default NetBIOS Scope ID. Use the following guidelines:</P>
<P>    1.    All Windows NT Workstation, Windows NT Server, and Windows 95 computers in the same Windows NT domain that are using the same NetBIOS Scope ID can communicate and connect with each other.</P>
<P>    2.    However, no pass-through authentication can occur between domains that are configured with different NetBIOS Scope IDs. In other words, using NetBIOS Scope ID can break the trust between domains.</P>
<P>    3.    Users cannot log on to their assigned domain from Windows 95 and Windows&nbsp;NT Workstation computers if the scope on the computer is different from the NetBIOS Scope configured on the domain controller in the user's assigned domain.</P>
<P>    4.    Users cannot log on to any computer on which the configured NetBIOS scope is not the same as the NetBIOS Scope ID configured on the domain controller for the selected domain.  </P>
<P>    5.    Users cannot connect, either by the command window or by using a program that issues a <B>net use</B> command, to a server whose NetBIOS Scope is different from the scope assigned to the domain controllers in the domain the user is logged on to, or the domain specified in the <B>Connect</B> dialog box.</P>
<H4 CLASS="h3"><A NAME="sec2"></A>NetBIOS Name Registration and Resolution</H4><P CLASS="t">Windows&nbsp;NT versions 4.0 and 3.5<I>x</I> computers use several methods for locating NetBIOS resources:</P>
<UL><LI>NetBIOS name cache</LI><LI>NetBIOS name server</LI><LI>IP subnet broadcasts</LI><LI>Static LMHOSTS files</LI><LI>Static HOSTS files</LI><LI>DNS servers</LI></UL><P CLASS="t">Earlier implementations used only cache, broadcasts, and LMHOSTS files; however, in Windows&nbsp;NT versions 4.0 and 3.5<I>x</I>, a NetBIOS name server<FONT FACE="Symbol">¾</FONT>the WINS server<FONT FACE="Symbol">¾</FONT>was implemented, and modifications were made to allow NetBIOS programs to query the DNS namespace by appending configurable domain suffixes to a NetBIOS name.</P>
<P CLASS="t">NetBIOS name resolution order depends on the node type and computer configuration. The following node types are supported:</P>
<UL><LI>b-node — uses broadcasts for name registration and resolution.</LI><LI>p-node — uses only point-to-point name queries to a NetBIOS name server (in this case WINS servers) for name registration and resolution.</LI><LI>m-node — uses broadcasts for name registration; for name resolution, tries broadcasts first, but switches to p-node if no answer is received.</LI><LI>h-node — uses NetBIOS name server for both registration and resolution; however, if no name server can be located, it switches to b-node. Continues to poll for nameserver and switches back to p-node when one becomes available. By default, WINS clients are configured as h-node.</LI><LI>Microsoft-enhanced — local LMHOSTS files or WINS proxies plus Windows Sockets gethostbyname() calls (using standard DNS and local HOSTS files) in addition to standard node types.</LI></UL><P CLASS="t">The many configurable options sometimes make it difficult to determine what name resolution methods to choose, and what name resolution order each configuration will use. The following flowcharts illustrate name resolution for the various node types and the relationships between the different Windows NT name resolution services. </P>
<P><img src="XNG_K15.gif"></P>
<P CLASS="cap"><B>Figure 6.5    NetBIOS Name Resolution Flowchart (part 1 of 3)</B></P>
<P><img src="XNG_K16.gif"></P>
<P CLASS="cap"><B>Figure 6.6    NetBIOS Name Resolution Flowchart (part 2 of 3)</B></P>
<P><img src="XNG_K17.gif"></P>
<P CLASS="cap"><B>Figure 6.7    NetBIOS Name Resolution Flowchart (part 3 of 3)</B></P>
<P CLASS="t">The NetBIOS name server provided with Windows NT Server is the Windows Internet Name Service (WINS) server. Most WINS clients are set up as h-nodes; in other words, they first attempt to register and resolve names by a using WINS server, and if that fails they try local subnet broadcasts. Using a name server to locate resources is generally preferable to broadcasting, for two reasons:</P>
<UL><LI>Broadcasts are not usually forwarded over routers.</LI><LI>Broadcasts are received by all computers on a subnet, requiring processing time at each one.</LI></UL><H4 CLASS="h3"><A NAME="sec3"></A>NetBT and DNS</H4><P CLASS="t">It has always been possible to connect from one Windows NT computer to another using NetBT over the Internet and other TCP/IP networks. To do so, some means of <I>name resolution</I> (associating a name with the appropriate IP address) is used because an IP address is required to establish a connection. </P>
<P CLASS="t">NetBT is the name resolution service for Windows-based networking in TCP/IP. DNS is the traditional and widely used name resolution service for the Internet and other TCP/IP networks. Windows NT Server version 4.0 has expanded support for DNS by implementing a DNS server.</P>
<P CLASS="t">A DNS name is similar to a NetBIOS name in that it is a "friendly" name for a computer or other network device. However, the DNS name is based on a hierarchical naming structure (also known as the name space) that is more flexible than the flat structure of NetBIOS names. DNS computer names consist of two parts: a <I>host name </I>and a <I>domain name</I>,<I> </I>which when combined, form the <I>fully qualified domain name (FQDN)</I>.</P>
<P CLASS="t">NetBIOS computer names are analogous to DNS host names, however a DNS name can be as long as 255 characters while the NetBIOS name is limited to 15 user-definable characters.</P>
<P CLASS="t"><B>Note</B></P>
<P>Under Windows NT, the DNS host name defaults to the NetBIOS computer name. Windows NT combines the NetBIOS computer name with the DNS domain name to form a FQDN by removing the 16<SUP>th</SUP> character in the NetBIOS name and appending a dot and the DNS domain name. If you want to change the default host name from the NetBIOS computer name, reconfigure TCP/IP by selecting the <B>DNS</B> page on the <B>Microsoft TCP/IP</B> <B>Properties</B> dialog box and changing the host name displayed on the <B>DNS</B> page.</P>
<P CLASS="t">It is now possible, in Windows NT 4.0,  to connect to a NetBT resource by using an IP address, FQDN, or NetBIOS computer name. For example, if using the Event Viewer, when prompted to "select computer," you now can choose to enter an FQDN or IP address or NetBIOS computer name.</P>
<H4 CLASS="h3"><A NAME="sec4"></A>NetBIOS Name Registration and Resolution for Multihomed Computers</H4><P CLASS="t">As mentioned earlier, NetBT only binds to one IP address per physical network interface. From the NetBT viewpoint, then, a computer is multihomed only when it has more than one NIC installed. When a name registration packet is sent from a multihomed computer, it is flagged as a "multihomed name registration" so that it will not conflict with the same name being registered by another interface in the same computer. </P>
<P CLASS="t">When a broadcast name query is received by a multihomed computer, all NetBT interface bindings receiving the query will respond with their address and, by default, the client will choose the first response and connect to the address supplied by it. This behavior can be controlled by the <B>RandomAdapter</B> registry parameter described in online Registry Help. </P>
<P CLASS="t">When a directed name query is sent to a WINS server, the WINS server will respond with a list of all IP addresses that were registered with WINS by a multihomed computer.</P>
<P CLASS="t">Choosing the "best" IP address to connect to on a multihomed computer is a client function. Currently, the following algorithm is employed, in the order listed:</P>
<P>    1.    If one of the IP addresses in the name query response list is on the same logical subnet as the<I> calling binding of NetBT</I> on the local computer, then that address is selected. If more than one of the addresses meet this criteria, one is picked at random from those that match. </P>
<P>    2.    If one of the IP addresses in the list is on the same logical subnet as any binding of NetBT on the local computer, then that address is selected. If more than one of the addresses meet this criteria, one is picked at random from those that match.</P>
<P>    3.    If none of the IP addresses in the list is on the same subnet as any binding of NetBT on the local computer, then an address is selected at random from the list.</P>
<P CLASS="t">This algorithm provides a reasonably good way of balancing connections to a server across multiple NICs, while still favoring direct connections when they are available. </P>
<P CLASS="t"><B>Note</B></P>
<P>The current implementation of NetBT does not attempt to "walk the list" of returned addresses if a connection attempt to the first choice fails. This enhancement has been requested and is under review.</P>
<H4 CLASS="h3"><A NAME="sec5"></A>NetBT Sessions</H4><P CLASS="t">NetBIOS sessions are established between two names. For example, when a Windows&nbsp;NT Workstation makes a file sharing connection to a server, the following sequence of events takes place:</P>
<P>    1.    The NetBIOS name for the server is resolved to an IP address.</P>
<P>    2.    A TCP connection is established from the workstation to the server, using port 139.</P>
<P>    3.    The workstation sends a NetBIOS session request to the server name over the TCP connection. Assuming the server is listening on that name, it will respond affirmatively and a session is established. </P>
<P CLASS="t">Once the NetBIOS session has been established, the workstation and server negotiate a higher level protocol to use over it. Microsoft networking uses only one NetBIOS session between two names at any point in time. Any additional file or print sharing connections made after the first one are multiplexed over that same NetBIOS session.</P>
<P CLASS="t">NetBIOS keepalives are used on each connection to verify that the server and workstation are both still up and able to maintain their session. This way, if a workstation is shut down ungracefully, the server will eventually clean up the connection and associated resources, and vice versa. NetBIOS keepalives are controlled by the <B>SessionKeepAlive </B>registry parameter and default to once per hour.</P>
<P CLASS="t">If LMHOSTS files are used and an entry is misspelled, it is possible to attempt to connect to a server using the correct IP address but an incorrect name. In this case, a TCP connection will still be established to the server. However, the NetBIOS session request (using the wrong name) will be rejected by the server, because there is no listen posted on that name. Error 51, "remote computer not listening," will be returned.</P>
<H4 CLASS="h3"><A NAME="sec6"></A>NetBT Datagram Services</H4><P CLASS="t">Datagrams are sent from one NetBIOS name to another over UDP port 138. The datagram service provides the ability to send a message to a unique name or to a group name. Group names may resolve to a list of IP addresses or to a broadcast. For example, the command <B>net send</B><I> /d:mydomain test</I> would send a datagram containing the text "test" to the group name &lt;mydomain&gt;[03]. The &lt;mydomain&gt;[03] name would resolve to an IP subnet broadcast, and so the datagram would be sent with the following characteristics:</P>
<UL><LI>Destination MAC address: broadcast (255.255.255.255)</LI><LI>Source MAC address: The NIC address of the local computer</LI><LI>Destination IP address: The local subnet broadcast address</LI><LI>Source IP address: The IP address of the local computer</LI><LI>Destination name: &lt;mydomain&gt;[03] (the Messenger service on the remote computers)</LI><LI>Source name: &lt;localcomputer&gt;[03] (the Messenger service on the local computer)</LI></UL><P CLASS="t">All hosts on the subnet would pick up the datagram and process it at least to the UDP protocol. On hosts running a NetBIOS datagram service, UDP would hand the datagram to NetBT on port 138. NetBT would check the destination name to see if any program had posted a datagram receive on it, and if so would pass the datagram up. If no receive is posted, the datagram is discarded.</P></BODY></HTML>
