<HTML><head><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Secondary Site</TITLE><BODY BGCOLOR="#FFFFFF">


<H3 CLASS="h2">Secondary Site</H3><P CLASS="t">A secondary site does not have a SQL&nbsp;Server database to store its system, package, inventory, and status information. Instead, it forwards inventory and status information to its primary site for processing and storage. It also does not have administrative tools since a secondary site must be administered through one of its parent sites. You create a secondary site from a primary site using the SMS&nbsp;Administrator. This primary site is known as the parent site for the secondary site. The secondary site appears directly beneath the parent site in the site hierarchy.</P>
<P CLASS="t">To create a secondary site, SMS needs an account that has specific privileges at the secondary site and the primary site must have a valid address for the secondary site. Each site must have a common protocol and connectivity.</P>
<P CLASS="t">A secondary site cannot be a parent site and you cannot attach sites beneath it. You also cannot move a secondary site to another position in the site hierarchy nor can you change its parent site. Once the secondary site is created, you can add new domains and clients to the site. Domains and clients are added to a secondary site the same way they are added to a primary site.</P>
<P CLASS="t">SMS services at the primary site connect to the secondary site and install a Bootstrap service to initiate its setup. When the services are started at the secondary site, they manage the installation of SMS components at that site. You can install a secondary site over a LAN or by using RAS from the primary site, but you cannot create a secondary site across an SNA backbone entirely from the primary site. To complete a secondary site installation over SNA, you must install the SNA Receiver and Bootstrap services on the site server for the secondary site.</P>
<H4 CLASS="h3"><A NAME="sec0"></A>Installing a Secondary Site</H4><P CLASS="t">This section describes what happens after you add a secondary site using the SMS&nbsp;Administrator. This process is summarized in Figure 3.1, Secondary Site Installation.</P>
<P CLASS="t">After you have confirmed the secondary site installation and the Success message box displays the message Site creation has been initiated, the secondary site's configuration is added to the database of the current site (the parent site of the secondary site). The Hierarchy Manager detects the new secondary site in the site database and updates the addressing for the parent site so that the addressing for the new secondary site is available for use by the sender. </P>
<P CLASS="t">The Hierarchy Manager then initiates a special send request, which is sent to the Scheduler. The Scheduler creates a send request file that gives the sender instructions to install the installation directory, to install the Bootstrap service to that directory, and to start the Bootstrap service on the site server for the secondary site. The sender connects to the site server for the secondary site and carries out the actions specified by the send request.</P>
<P CLASS="t">After the Bootstrap service has confirmed that it has started at the secondary site, the Hierarchy Manager at the parent site then creates another job to send the SMS site package, which contains all the SMS site components. This job uses the regular Scheduler/sender mechanism to transfer the package to the secondary site. The Hierarchy Manager uses the SYSTEM.MAP file to determine which files to copy to the secondary site.</P>
<P CLASS="t">When the Bootstrap service receives the package, it places the package in the SMS root directory as BOOTSTRP.PK1.</P>
<P><img src="srk_c01.gif"></P>
<P>Figure 3.1    Secondary Site Installation</P>
<P CLASS="t">After the Bootstrap service has confirmed that it has started at the secondary site, the Hierarchy Manager at the parent site then creates another job to send the SMS site package, which contains all the SMS site components. This job uses the regular Scheduler/sender mechanism to transfer the package to the secondary site. The Hierarchy Manager uses the SYSTEM.MAP file to determine which files to copy to the secondary site.</P>
<P CLASS="t">When the Bootstrap service receives the package, it places the package in the SMS root directory as BOOTSTRP.PK1.</P>
<P CLASS="t">At the parent site, the Hierarchy Manager creates a job to send a site control file (_INIT.CT1) to the secondary site. The site control file contains the configuration information for the secondary site.</P>
<P CLASS="t">When the Bootstrap service receives the package for the site control file, it places the package in the SMS root directory as BOOTSTRP.PK2. The Bootstrap service then verifies the integrity of the packages.</P>
<P CLASS="t">If the package files are corrupted, the Bootstrap service reports the problem to the trace log and Windows&nbsp;NT event log and then stops the installation process.</P>
<P CLASS="t">If the package files are valid, the Bootstrap service checks to make sure that there is enough free disk space to install the site server components.</P>
<P CLASS="t">If there is not enough disk space, the Bootstrap service reports the problem to the trace log and the Windows&nbsp;NT event log and then stops the installation process.</P>
<P CLASS="t">If there is enough free disk space and the package files are valid, the Bootstrap service decompresses the packages, creates the site directory structure on the site server, and places the components in the appropriate directories</P>
<P CLASS="t">The Bootstrap service then starts the Site Configuration Manager. After the Site Configuration Manager has started, the Bootstrap service stops. The Site Configuration Manager uses the site control file to complete the secondary site's installation and configuration.</P>
<P CLASS="t">As part of site configuration, the Site Configuration Manager starts all SMS services at the site.</P>
<P CLASS="t">After the site services have been started, the Site Configuration Manager creates another temporary site control file (*.CT2) that contains the actual configuration at the secondary site. The Site Configuration Manager creates a job to send the site control file back to the parent site. This job uses the regular Scheduler/sender mechanism to transfer the site control file to the parent site (for more information on how the Scheduler and sender interact, see "Collecting Inventory at a Secondary Site" later in this chapter). This process repeats each time you modify the configuration of a secondary site.</P>
<P CLASS="t">At the parent site, the Despooler places the site control file in the SITE.SRV\SITECFG.BOX directory of the SMS_SHR<I>x</I> share on the site server. The Hierarchy Manager at the parent site updates the site database with the actual configuration at the secondary site. When you refresh the SMS&nbsp;Administrator, the secondary site appears as an installed site in the Sites window. Using the Properties command from the File menu, you can view (and modify) the properties for the new secondary site.</P>
<H4 CLASS="h3"><A NAME="sec1"></A>Modifying Properties at a Secondary Site</H4><P CLASS="t">Modifications of the secondary site's properties are initiated from the SMS&nbsp;Administrator and then carried out by the Hierarchy Manager at the parent site and the Site Configuration Manager at the secondary site. The Hierarchy Manager creates a job to send a site control file to the secondary site. This job uses the regular Scheduler/sender mechanism to transfer the site control file package to the secondary site.</P>
<P CLASS="t">At the secondary site, the Site Configuration Manager uses the site control file to update the secondary site's configuration. After the configuration is complete, the Site Configuration Manager creates a site control file that contains the actual configuration at the secondary site. The Site Configuration Manager creates a job to send the site control file back to the parent site. This job uses the regular Scheduler/sender mechanism to transfer the site control file to the parent site. At the parent site, the Hierarchy Manager updates the parent site's database.</P>
<P CLASS="t">Note that during primary and secondary site installation, the Hierarchy Manager and Site Configuration Manager create files called _INIT.CT1 and *.CT2, respectively. When site properties are later modified, these files are recreated using random numerical names. </P>
<H4 CLASS="h3"><A NAME="sec2"></A>Installing an SNA-linked Secondary Site</H4><P CLASS="t">If the secondary site is connected through an SNA link (summarized in Figure 3.2, SNA-linked Secondary Site Installation), installation differs from the regular secondary site installation (summarized in Figure 3.1, Secondary Site installation), as follows:</P>
<UL><LI>You must run the SMS Setup program at the secondary site prior to adding the secondary site to its parent site. SNA Setup starts the Bootstrap and SNA Receiver services at the target site.</LI></UL><UL><LI>The Hierarchy Manager does not send a job to start the Bootstrap service at the secondary site (because the SNA Setup program starts it).</LI></UL><UL><LI>Incoming packages at both primary and secondary sites go through the SNA Receiver. The SNA Receiver at the secondary site acknowledges receipt of incoming packages, but does not check to confirm that they have been processed correctly by the Bootstrap service.</LI></UL><H4 CLASS="h3"><A NAME="sec3"></A>Secondary Site Component Upgrade</H4><P CLASS="t">This section describes what happens after you add a component or upgrade the primary site directly above the secondary site, using the SMS Setup program. This process is summarized in Figure 3.3, Secondary Site Component Upgrade.</P>
<P CLASS="t">After you have confirmed the secondary site update, the SMS Setup program adds an upgrade instruction in the site database for all secondary sites directly beneath the current site. The Hierarchy Manager service detects this instruction and waits for all these secondary sites to be in the active state. The Hierarchy Manager will not begin the upgrade process if any secondary sites are still in the process of being created or deleted.</P>
<P CLASS="t">When all secondary sites are active, the Hierarchy Manager creates a system job<I> </I>for each site. The Hierarchy Manager creates a job (a system job with the comment Bootstrap Job for &lt;<I>sitecode</I>&gt; where <I>sitecode</I> is the site code for the secondary site to be upgraded) to send to each secondary site to install and start the SMS Upgrade Bootstrap service at each secondary site. The bootstrap job is phase 1 of the upgrade.</P>
<P CLASS="t"><B>Note</B></P>
<P>For a secondary site connected to its parent site using the SNA Sender, the bootstrap job also installs and starts an Upgrade SNA Receiver service. This service is used temporarily so that the primary site can continue to send site upgrade jobs to the site during the removal and upgrade of the existing SNA Receiver service.</P>
<P><img src="srk_c03.gif"></P>
<P>Figure 3.2    SNA-linked Secondary Site Installation</P>
<P><img src="srk_c04.gif"></P>
<P>Figure 3.3    Secondary Site Component Upgrade</P>
<P CLASS="t">At each secondary site server, the Upgrade Bootstrap service shuts down the site in preparation for the upgrade. All SMS services are stopped except the Upgrade Bootstrap service. At the primary site, you will not be able to edit Site Properties dialog box for these sites while they are in upgrade status (in the Sites window, the sites will have an under construction icon and their Site Properties dialog boxes will display the site upgrade phase).</P>
<P CLASS="t">After the Upgrade Bootstrap service has confirmed that it has started at the secondary site, the Hierarchy Manager at the parent site then creates another job (a system job with the comment Site Install Job for &lt;<I>sitecode</I>&gt; where <I>sitecode</I> is the site code for the secondary site to be upgraded) to send the SMS site package, which contains all the SMS site components. This job uses the regular Scheduler/sender mechanism to transfer the package to the secondary site. The Hierarchy Manager uses the SYSTEM.MAP file to determine which files to copy to the secondary site. The site install job is phase 2 of the upgrade.</P>
<P CLASS="t">When the Upgrade Bootstrap service receives the package, it places the package in the SMS root directory as BOOTSTRP.PK1.</P>
<P CLASS="t">At the parent site, the Hierarchy Manager creates a job (a system job with the comment Site Control Job for &lt;<I>sitecode</I>&gt; where <I>sitecode</I> is the site code for the secondary site to be upgraded) to send a site control file (_INIT.CT1) to the secondary site. The site control file contains the configuration information for the secondary site. The site control job is phase 3 of the upgrade.</P>
<P CLASS="t">When the Upgrade Bootstrap service receives the package for the site control file, it places the package in the SMS root directory as BOOTSTRP.PK2. The Upgrade Bootstrap service then verifies the integrity of the packages.</P>
<P CLASS="t">If the package files are corrupted, the Upgrade Bootstrap service reports the problem to the trace log and the Windows&nbsp;NT event log and then stops the installation process.</P>
<P CLASS="t">If the package files are valid, the Upgrade Bootstrap service checks to make sure that there is enough free disk space to install the site server components.</P>
<P CLASS="t">If there is not enough disk space, the Upgrade Bootstrap service reports the problem to the trace log and the Windows&nbsp;NT event log and then stops the installation process.</P>
<P CLASS="t">If there is enough free disk space and the package files are valid, the Upgrade Bootstrap service decompresses the packages, creates the site directory structure on the site server, and places the components in the appropriate directories.</P>
<P CLASS="t">If the Upgrade Bootstrap service does not receive valid packages or cannot decompress the packages within 48 hours, it will attempt to restart the site with the original site components. After the site's SMS services have been restarted, the Hierarchy Manager will report its configuration back to the parent site. If the site upgrade has taken longer than 48 hours, you should verify that the site has been updated or that the components have been added to the site. If the upgrade has failed, you can try again by upgrading the primary site or installing the new software component using the SMS Setup program. You can also use the PREINST program (the executable version of the Hierarchy Manager) to force an upgrade of a specific secondary site.</P>
<P CLASS="t">Then Upgrade Bootstrap service starts the Site Configuration Manager. After the Site Configuration Manager has started, the Upgrade Bootstrap service stops. The Site Configuration Manager uses the site control file to complete the secondary site's installation and configuration.</P>
<P CLASS="t">As part of the site configuration, the Site Configuration Manager starts all SMS services at the site.</P>
<P CLASS="t">After the site services have been started, the Site Configuration Manager creates another temporary site control file (*.CT2) that contains the actual configuration at the secondary site. The Site Configuration Manager creates a job to send the site control file back to the parent site. This job uses the regular Scheduler/sender mechanism to transfer the site control file to the parent site (for more information on how the Scheduler and Sender interact, see "Collecting Inventory at a Secondary Site" later in this chapter). This job is phase 4 of the upgrade.</P>
<P CLASS="t">At the parent site, the Despooler places the site control file in the SITE.SRV\SITECFG.BOX directory of the SMS_SHR<I>x</I> share on the site server. The Hierarchy Manager at the parent site updates the site database with the actual configuration at the secondary site. When you refresh the SMS&nbsp;Administrator, the secondary site appears as an installed site in the Sites window. Using the Properties command from the File menu, you can view (and modify) the properties for the new secondary site.</P>
<H4 CLASS="h3"><A NAME="sec4"></A>Secondary Site Removal</H4><P CLASS="t">This section describes what happens after you delete a secondary site using the SMS&nbsp;Administrator. This process is summarized in Figure 3.4, Secondary Site Removal.</P>
<P CLASS="t">After you have confirmed the secondary site deletion and the Success message box displays the message Site creation has been initiated, the SMS&nbsp;Administrator adds a deletion instruction in the site database for the secondary site.</P>
<P CLASS="t">When the Hierarchy Manager detects this instruction, it creates a job (a system job with the comment Bootstrap Job for &lt;<I>sitecode</I>&gt; where <I>sitecode</I> is the site code for the secondary site to be removed) to send to the secondary site to install and start the Bootstrap service at that secondary site.</P>
<P CLASS="t">At the secondary site, the Site Configuration Manager installs the Bootstrap service, which then takes over removal of the site.</P>
<P CLASS="t">At the primary site, when the bootstrap job has completed, the Hierarchy Manager removes the site from the site database.</P>
<P CLASS="t">The Hierarchy Manager then forwards the site deletion information to its own parent site, which removes the site from its database. The site deletion information is then forwarded to its parent site, and so on. The site deletion is reported all the way up to the central site.</P>
<P CLASS="t">If the secondary site removal has failed, the site may reappear at the parent site, since it may continue reporting. If this happens, you can delete it again. Or you can use the SMS Setup program at the secondary site server.</P>
<P CLASS="t">At the secondary site server, you can view the BOOTSTRP.LOG file (in the root of the drive containing the SMS root directory) for a record of the actions and errors reported by the Bootstrap service.</P>
<P CLASS="t"><B>Note</B></P>
<P>If you delete the site icon twice in the Sites window of the SMS&nbsp;Administrator and the site has already been removed, the second bootstrap job will not be able to complete, because the secondary site no longer exists. If this happens, you can cancel or delete the second bootstrap job and the Hierarchy Manager will remove the site from the site database.</P>
<P><img src="srk_c05.gif"></P>
<P>Figure 3.4    Secondary Site Removal</P></BODY></HTML>
