<HTML><head><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Using System Flow</TITLE><BODY BGCOLOR="#FFFFFF">


<H3 CLASS="h2">Using System Flow</H3><P CLASS="t">A Run Command On Workstation job runs a command defined for a package at specified clients. You can use a Run Command On Workstation job to install a package or to run a command on individual clients. After the job is created, it is added to the site database.</P>
<P CLASS="t">To troubleshoot a job using system flow, you monitor the files that are created, modified, copied, and deleted during the job process. In order to know which files should be created or modified, you need to reference the system flow descriptions in Chapter 3, "System Flow." The following section describes the basic system flow for a Run Command On Workstation job, and then lists the files and directories to check to make sure that the process has completed successfully, or to find where the process has stalled.</P>
<H4 CLASS="h3"><A NAME="sec0"></A>System Flow for a Run Command On Workstations Job</H4><P CLASS="t">The basic system flow for a Run Command On Workstations job is as follows:</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;1.    The job is created and stored in the SMS database.</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;2.    The Scheduler monitors the database for new jobs. When it is time to process a job, the Scheduler compresses the job package and determines the sites and clients that should receive the job. It then creates the send request files and the despooler instruction files needed to complete the job at the target sites.</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;3.    The sender sends the compressed package and instruction files to all target sites. The sender starts processing the send request file as soon as the Scheduler places the file in its directory. (The sender does not use polling; it receives a Windows&nbsp;NT message whenever a file is placed in its directory.) </P>
<P>If for any reason sending is interrupted, when it resumes it continues from where it left off. If the connection cannot be reestablished, the sender reports this to the Scheduler. The Scheduler postpones the send and tries again later. The Scheduler tries repeatedly to send the job over several days before reporting the job as failed.</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;4.    The Despooler decompresses the package and places it on the specified distribution servers. The Despooler also uses the job's despooler instruction file to create workstation instruction files (WIFs) for each target client.</P>
<P>Normally, the Despooler does not use polling cycles; it receives notification from Windows&nbsp;NT whenever a file is placed in its directory. It then wakes up and begins processing the file. It also wakes up periodically to retry any failed jobs.</P>
<P>While the Despooler is processing the instruction files, it sends job status MIF files back to the site where the job originated. As soon as the Despooler successfully decompresses the package, it sends a site arrival MIF file. After it has successfully distributed the package to a distribution server, the Despooler sends a server MIF file. When the package has been completely distributed, it sends a completion MIF file.</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;5.    The Maintenance Manager replicates the WIFs from the site server to the SMS logon servers. The Maintenance Manager also sends package location MIF files back to the site where the job originated. Like the Scheduler, the Maintenance Manager runs on a polling cycle that is controlled by the Service Response speed that is set in the Site Properties dialog box.</P>
<H5 CLASS="h4"><A NAME="sec1"></A>To verify that the Scheduler has processed the job properly</H5><p>&nbsp;&nbsp;&nbsp;&nbsp;1.    Look for the compressed package file and the despooler instruction files, which the Scheduler places in the SITE.SRV\SENDER.BOX\TOSEND directory in the SMS root directory after the job's Start After time elapses. </P>
<P>The file name for the compressed package is <I>packageid</I>.W* where <I>packageid</I> is the eight character package ID for the package used by the job. </P>
<P>The file name for the despooler instruction file is <I>instructionid</I>.I*, where <I>instructionid</I> is the five character unique ID in the job ID followed by the site code for the target site. The despooler instruction files contain instructions for completing the job at each target site. The Scheduler creates a despooler instruction file for each target site. </P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;2.    Look for the send request (*.SRQ) files on the site server. </P>
<P>The Scheduler creates a send request file for each target site specified for the job. A send request file contains instructions for sending the compressed package and the despooler instruction file to the target site. </P>
<P>Initially, the *.SRQ file is placed in the appropriate outbox directory (SITE.SRV\SENDER.BOX\ REQUESTS\<I>sender</I>.000 where <I>sender</I>.000 is the specific sender's outbox directory name, such as LAN_DEFA.000, SNA_BATC.000, or RAS_ISDN.000) for the type of sender being used to send the job to the target site. For example, if a package is sent to the target site using the LAN Sender, the SRQ file would be placed in the LAN_DEFA.000 directory of the REQUESTS directory.</P>
<H5 CLASS="h4"><A NAME="sec2"></A>To verify that the sender has processed the job properly</H5><p>&nbsp;&nbsp;&nbsp;&nbsp;1.    Look for the sender status (*.SRS) file. </P>
<P>The sender monitors its outbox for a valid send request. When it detects a send request, it renames it to *.SRS to indicate the send is in progress and to report status.</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;2.    At the receiving site, look in the SITE.SRV\DESPOOLR.BOX\RECEIVE directory for the compressed package file and the despooler instruction file. </P>
<P>The sender connects to the target site and transfers the compressed package file and the despooler instruction file from the SITE.SRV\SENDER.BOX \TOSEND directory on the site server to the SITE.SRV\DESPOOLR.BOX \RECEIVE directory on the target site server. The Despooler renames the compressed package to *.PCK. When the instruction file is being transferred, it is named *.TMP; once the package and instruction file are received and verified, the instruction file is renamed to *.INS.</P>
<H5 CLASS="h4"><A NAME="sec3"></A>To verify that the Despooler has processed the job properly</H5><p>&nbsp;&nbsp;&nbsp;&nbsp;1.    Monitor the SITE.SRV\ DESPOOLR.BOX\STORE directory on the site server for the target site. </P>
<P>The Despooler monitors the SITE.SRV\DESPOOLR.BOX\RECEIVE directory for instruction files and then processes the files. The Despooler moves the compressed package to the SITE.SRV\ DESPOOLR.BOX\STORE directory. Workstation packages are saved as <I>packageID</I>.WKS (shared packages are saved as <I>packageID</I>.SRV).</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;2.    Check for a temporary decompressed copy of the package. </P>
<P>The Despooler recreates the original package by decompressing the .WKS (or .SRV) file at the specified servers. The Despooler decompresses the package directory into a temporary directory located on the local drive's root directory with the most space. </P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;3.    Confirm that the Despooler has distributed the package to the distribution servers in the site.</P>
<P>On computers running Windows&nbsp;NT and LAN&nbsp;Manager, the Despooler creates an SMS_PKG<I>x</I> share on each distribution server, where <I>x </I>is the drive where the package is placed. Then the Despooler creates a subdirectory and places the package in that subdirectory.</P>
<P>On NetWare servers, the package is placed beneath the LOGON.SRV \PCMPKG.SRC directory on the volume containing the SMS logon server components. The name of this subdirectory is the package ID name.</P>
<P>For more information about how the Despooler places packages on distribution servers, see Chapter 3, "System Flow."</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;4.    Check WIFs in the master domain box on the site server.</P>
<P>For a Run Command On Workstation job, the Despooler uses the job's despooler instruction file to create a WIF for each target client in the site's domains. WIFs contain package installation instructions for individual clients. For each domain in the site, WIFs are placed in a domain master box. The domain master box directory is SITE.SRV\ MAINCFG.BOX\PCMDOM.BOX\<I>domain_name</I>.000. The WIFs are named with the client SMS ID, and an extension of INS (<I>SMS_ID</I>.INS).</P>
<H5 CLASS="h4"><A NAME="sec4"></A>To verify that the Maintenance Manager has processed the job properly</H5><OL><LI>Confirm that the Maintenance Manager has replicated the WIFs from the site server to the SMS logon servers.</LI></OL><P>The Maintenance Manager replicates the WIFs from the SITE.SRV \MAINCFG.BOX\PCMDOM.BOX\<I>domain_name</I>.000 directories on the site server to the LOGON.SRV\PCMINS.BOX directory on all the SMS logon servers in the target SMS domains.</P>
<P CLASS="t">When all of these processes have completed, the package should be available to the appropriate SMS clients. </P></BODY></HTML>
