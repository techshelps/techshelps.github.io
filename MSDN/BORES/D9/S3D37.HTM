<HTML><head><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Resynchronizing Inventory Information</TITLE><BODY BGCOLOR="#FFFFFF">


<H3 CLASS="h2">Resynchronizing Inventory Information</H3><P CLASS="t">Whenever the Inventory Data Loader receives a Binary MIF file that does not correspond with information already existing in the site database, it issues a resynchronization (<B>resync</B>) command to update the site inventory. </P>
<P CLASS="t">Each Binary MIF file contains a series of group entries that describe some aspect of the computer they are associated with. MIF groups may contain an entry (called a <I>pragma</I>) that indicates the relationship of the group information to the information in the database. The pragma can be ADD, UPDATE, or DELETE (if a pragma statement is missing, it is assumed to be ADD). When a MIF file contains instructions to update or delete a group that is missing from the database, the Inventory Data Loader starts the resynchronization process. This process results in a full scan of the computer that generated the Binary MIF file.</P>
<P CLASS="t">For example, if you delete a computer from the inventory and do not change its reporting status, the Inventory Data Loader initiates a <B>resync</B> when it receives a MIF file for that computer. During the <B>resync</B>, it is likely that only the Identification group for that computer is available in the Personal Computer Properties - [<I>computername</I>] window. In this case, the event log contains an entry indicating that a <B>resync</B> is in progress. </P>
<P CLASS="t">Note that when a child site is attached to a parent site for the first time, a <B>resync</B> is not necessary. Instead, the Hierarchy Manager automatically sends up the inventory files when it detects attachment to the parent site.</P>
<P CLASS="t">The resynchronization process, also summarized in Figure 3.7, Resynchronizing Inventory Information, is as follows: </P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;1.    The Inventory Data Loader creates a system job that contains a command for the specific computer. </P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;2.    The job is passed to the Scheduler, which creates a resynchronization instruction and passes it to the sender to send to the target computer. </P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;3.    The target site Despooler runs the resynchronization instruction, which in turn creates a domain resynchronization instruction. (Because the Inventory Data Loader only sends a <B>resync</B> command for one computer at a time, only one domain is involved.) </P>
<P CLASS="t">When the Despooler runs the domain instruction, it writes a <B>resync</B> command to the master inventory command file (RESYNC.CFG) for the computer's domain. Any existing <B>resync</B> command for the computer is overwritten.</P>
<P CLASS="t">RESYNC.CFG is located in the SITE.SRV\MAINCFG.BOX\INVDOM.BOX \<I>domain</I>.000 directory on the site server. One copy of the file exists for each SMS domain.</P>
<P CLASS="t">The Maintenance Manager replicates RESYNC.CFG to the LOGON.SRV directory on all SMS logon servers. The Maintenance Manager also creates separate resync files for use by computers that are running Windows&nbsp;NT, have the Inventory Agent service installed, and do not have a role of SMS logon server. For each computer running Windows&nbsp;NT, the Maintenance Manager creates a resync file with only the <B>resync</B> command for that particular computer (in fact, the Maintenance Manager creates a file for each <B>resync</B> command in the RESYNC.CFG file but the individual files are only used by the specific type for each computer running Windows&nbsp;NT, as mentioned earlier). The Maintenance Manager places these resync files in the LOGON.SRV\INVENCFG.BOX. The files are named <I>sms_id</I>.CFG where <I>sms_id</I> is the SMS ID for the computer for which the <B>resync</B> command is intended.</P>
<P CLASS="t">At computers that are running Windows&nbsp;NT, have the Inventory Agent service installed, and do not have a role of SMS logon server, the Client Monitor service polls its current SMS logon server for the resync file for that particular computer every 8 hours. The Client Monitor compares the date/time and size of the resync file on the SMS logon server with the resync file on the local computer. If either of these attributes have changed or a resync file does not exist, the Client Monitor copies the resync file to the MS\SMS\INVDATA directory. If the user runs the SMS Client Setup program (either manually or via a logon script), SMS Client Setup will also compare the local and SMS logon server resync files and copies over the resync file if necessary. The Inventory Agent service wakes up every 24 hours to check if the hardware and software scan intervals have changed or elapsed. At this time, the Inventory Agent service also reads the resync file. If the file contains a pending <B>resync</B> command, it performs a full software and hardware scan.</P>
<P CLASS="t">At all other types of computers, RESYNC.CFG is read by the Inventory Agent program the next time the program runs. On the SMS client computer, the Inventory Agent runs manually via a RUNSMS batch file or automatically via a logon script. On SMS logon servers, the Inventory Agent service wakes up every 24 hours to check if the hardware and software scan intervals have changed or elapsed. The Inventory Agent reads the file and looks for the SMS ID of the local computer. On that computer, it checks the history file (CMNDHIS.*) to see if a <B>resync</B> command with a time later than the present <B>resync</B> command has already run. If not, the Inventory Agent performs a complete hardware and software inventory of the computer and sends the resulting *.RAW file (or *.MIF file for Macintosh or OS/2 computers) to its current SMS logon server.</P>
<P><img src="srk_c10.gif"></P>
<P>Figure 3.7    Resynchronizing Inventory Information</P>
<P CLASS="t">The Maintenance Manager collects the *.RAW file from the SMS logon servers and places them on the site server in the same way that it collects *.RAW files from a normal inventory report. For more information about how inventory is processed, see "Collecting Inventory at a Primary Site" earlier in this chapter.</P>
<P CLASS="t">The Inventory Processor creates a Binary MIF file from the RAW file and places a pragma:resync<B> </B>attribute in the Binary MIF to indicate that it represents a resynchronization. Then the Inventory Data Loader updates the database (and forwards the Binary MIF file to its parent site) and the computer's full inventory appears in the Sites window. </P>
<P CLASS="t">Note that the Inventory Processor deletes a computer's history file if the RAW file indicates that a resynchronization has taken place. The Inventory Processor then creates a new history file.</P></BODY></HTML>
