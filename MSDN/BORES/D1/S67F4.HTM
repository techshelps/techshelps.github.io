<HTML><head><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Update in Place</TITLE><BODY BGCOLOR="#FFFFFF">


<H3 CLASS="h2">Update in Place </H3><P CLASS="t">When an update is performed in-place, a log record of type MODIFY is recorded in the log. This record contains only the differences between the old and new row values, not their actual values, and it cannot handle changes in row length. For in-place updates, the following restrictions apply:</P>
<SPAN CLASS="list"><UL><LI CLASS="ULI1">The table cannot contain an UPDATE trigger.</LI><LI CLASS="ULI1">The table cannot be marked for replication.</LI><LI CLASS="ULI1">There can only be one table involved in the UPDATE statement. Primary/foreign key references automatically mean that more than one table is involved. This rule includes any subselect in the update query including a self-join. Whenever more than one table is involved, a deferred update takes place.</LI><LI CLASS="ULI1">The column being updated cannot be part of a clustered index.</LI><LI CLASS="ULI1">The column being updated can be of variable length, but the new row length must be exactly the same as the old row length.</LI><LI CLASS="ULI1">The new row cannot be too different from the old one. The number of differing bytes cannot be more than one half the total row size, and the total number of discontiguous differing blocks cannot be more than three. Differing blocks within 8 bytes are considered a single block.
<P CLASS="lt1">Consider the following code sample:</P></LI></UL></SPAN><P>create table t1 (col1 int, col2 char(60))</P>
<P>go</P>
<P>insert t1 values</P>
<P>(1,'abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz')</P>
<P>insert t1 values</P>
<P>(2,'abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz')</P>
<P>— continue for 1000 rows —</P>
<P>go</P>
<P>create unique index idx1 on t1 (col1)</P>
<P>go</P>
<P></P>
<P CLASS="ls2">If you try to change more than one half of the row size—do not confuse this with one half of the column length—delete/insert is performed instead of in-place. Since this example changes 33 bytes of a 64-byte row size, delete/insert is performed.</P>
<P>update t1 set col2 =</P>
<P>'zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzhijklmnopqrstuvwxyz'</P>
<P>where col1 = 1</P>
<P>go</P>
<P></P>
<P CLASS="ls2">If you have more than three differing blocks within the column being updated, delete/insert is performed. Since this example changes 4 bytes, each in a separate block, delete/insert is performed.</P>
<P>   update t1 set col2 =</P>
<P>   'ZbcdefghijZlmnopqrstuvZxyzabcdefghijkZmnopqrstuvwxyz'</P>
<P>   where col1 = 2</P>
<P>   go</P>
<P></P>
<P CLASS="lt1">For single-row, in-place updates, the optimizer must be able to determine ahead of time that only one row will qualify. That is, there must be a unique index, and that index must be used to drive the search. The column being updated can be a nonclustered index key, and that index may also be used to drive the search.</P>
<P CLASS="lt1">Multiple rows can be updated in-place but only if the following conditions apply:</P>
<SPAN CLASS="list"><UL><LI CLASS="ULI2">The updated column is fixed length.</LI><LI CLASS="ULI2">The clustered index is not updated.</LI><LI CLASS="ULI2">The updated column cannot be a nonclustered index column used to drive the search. However, other nonclustered index columns can be updated.</LI></UL></SPAN></BODY></HTML>
