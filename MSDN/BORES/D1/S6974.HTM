<HTML><head><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Using Average Sizes for Variable Fields</TITLE><BODY BGCOLOR="#FFFFFF">


<H3 CLASS="h2">Using Average Sizes for Variable Fields</H3><P CLASS="t">The preceding calculations use the maximum size of the variable-length fields. If you know the average size of the fields, you can use this value in Steps 1 and 4 for calculating table size, and the value in Step 1 for calculating the nonclustered index size. You'll need slightly different formulas for clustered and nonclustered indexes.</P>
<H4 CLASS="h5"><A NAME="sec0"></A>For Clustered Indexes</H4><P CLASS="ls">In "Step 1: Calculate the Data Row Size," to determine the average data row size, use the sum of the average length of the variable-length columns instead of the sum of the defined length of the variable-length columns.</P>
<P CLASS="lt1">+ (sum of bytes in all fixed-length columns) + (sum of bytes of the average length of variable-length columns) = Subtotal</P>
<P CLASS="ls">In "Step 2: Calculate the Number of Data Pages," use the average data row size from the first formula.</P>
<P CLASS="lt1">(average data row size) = number of data rows per page</P>
<P CLASS="ls">In "Step 3: Calculate the Size of Clustered Index Rows," perform the addition twice.</P>
<SPAN CLASS="list"><UL><LI CLASS="ULI2">The first time, calculate the maximum index row size, using the given formula:
<P CLASS="lt1">5 + (sum of bytes in the fixed-length index keys) + (sum of bytes in variable-length keys) = Subtotal</P>

<P CLASS="lt1">Subtotal + ((Subtotal/256) + 1) + 2 = maximum index row size</P></LI><LI CLASS="ULI2">The second time, calculate the average index row size, substituting the sum of the average number of bytes in the variable-length index keys for the sum of the defined number of bytes in the variable-length index keys.</LI></UL></SPAN><P CLASS="ls">In "Step 4: Calculate the Number of Clustered Index Pages," substitute the following formula for the first formula, using the two different length values you calculated in the previous equation.</P>
<P CLASS="lt1">(2,016 - (2 * maximum index row size))/average index row size = number of clustered index rows per page.</P>
<H4 CLASS="h5"><A NAME="sec1"></A>For Nonclustered Indexes</H4><P CLASS="ls">In "Step 1: Calculate the Size of the Leaf Index Row," perform the addition twice.</P>
<SPAN CLASS="list"><UL><LI CLASS="ULI2">The first time, calculate the maximum leaf index row size, using the given formula:
<P CLASS="lt1">5 + (sum of bytes in the fixed-length index keys) + (sum of the average number of bytes in variable-length index keys) = Subtotal</P>

<P CLASS="lt1">Subtotal + ((Subtotal/256) + 1) + 2 = maximum index row size</P></LI><LI CLASS="ULI2">The second time, calculate the average leaf index row size, substituting the average number of bytes in the variable-length index keys for the sum of bytes in the variable-length index keys.</LI></UL></SPAN><P CLASS="ls">In "Step 2: Calculate the Number of Leaf Pages in the Index," use the average leaf index row size in the first division procedure.</P>
<P CLASS="lt1">2,016/(average leaf index row size) = number of leaf rows per page</P>
<P CLASS="ls">In "Step 3: Calculate the Size of the Nonleaf Rows," use the average leaf index row size.</P>
<P CLASS="lt1">(average leaf index row) + 4 = size of nonleaf row</P>
<P CLASS="ls">In "Step 4: Calculate the Number of Nonleaf Pages," substitute the following formula for the first formula, using the maximum and average row sizes calculated in Step 1.</P>
<P CLASS="lt1">(2,016 - (2 * maximum index row size))/average index row size = number of nonleaf index rows per page</P></BODY></HTML>
