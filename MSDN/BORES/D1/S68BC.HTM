<HTML><head><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>USE Statement in EXECUTE Resets on Completion</TITLE><BODY BGCOLOR="#FFFFFF">


<H3 CLASS="h2">USE Statement in EXECUTE Resets on Completion</H3><H4 CLASS="h5"><A NAME="sec0"></A>SQL Server 6.5 </H4><P CLASS="t">After executing a string that contains a USE statement, the "current database" will automatically be reset to the database that was being used before the EXECUTE. To obtain the same behavior as in SQL Server 6.0, each statement that should be executed in the used database must be executed as a string with the USE statement preceding it.</P>
<P CLASS="t">To obtain SQL Server 6.0 behavior, use this batch:</P>

<PRE>USE master
GO
DECLARE @mydb VARCHAR(30)
SELECT @mydb = 'pubs'EXECUTE('USE ' + @mydb + 'SELECT db_name()')
go
</PRE>
<P CLASS="t">This batch carries out the SELECT in the used database, but returns to the <B>master</B> database upon completion.</P>
<H4 CLASS="h5"><A NAME="sec1"></A>SQL Server 6.0</H4><P CLASS="t">The "current database" setting persists after the EXECUTE.</P>
<P CLASS="t">This batch will output <B>pubs</B> in 6.0; in SQL Server 6.5, it outputs <B>master</B>:</P>

<PRE>USE master
GO
DECLARE @mydb VARCHAR(30)
SELECT @mydb = 'pubs'
EXECUTE('USE ' + @mydb)
go
SELECT db_name()
go
</PRE></BODY></HTML>
