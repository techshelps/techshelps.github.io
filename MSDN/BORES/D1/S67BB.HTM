<HTML><head><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Transaction Log Sequencing</TITLE><BODY BGCOLOR="#FFFFFF">


<H3 CLASS="h2">Transaction Log Sequencing</H3><P CLASS="t">SQL Server keeps track of the order of transaction log dumps by using a method that can be thought of as similar to a sequence number. The sequence number is incremented every time a DUMP TRANSACTION statement is issued, regardless of whether the log is being dumped to a physical dump device, or whether it is being truncated by using either the WITH TRUNCATE_ONLY or WITH NO_LOG clauses. When you restore transaction logs, they must be loaded in the same order in which they were dumped, and their sequence numbers must increase monotonically.</P>
<P CLASS="t">In the following example, assume that a database is dumped at midnight each night, and transaction log dumps are performed every hour from 8 A.M. to 5 P.M. The 8 A.M. dump would have a sequence number of 1, the 9 A.M. dump would have a sequence number of 2, and so on. Suppose that the transaction log completely fills up at 9:30 A.M. and that it must be dumped or truncated using the WITH NO_LOG option and that the remaining hourly dumps continue as scheduled. If the hard disk fails at 3 P.M. that day, the previous night's database dump could be loaded, followed by the 8 A.M., sequence number 1, and 9 A.M., sequence number 2, transaction log dumps. </P>
<P CLASS="a"><img src="bok428.gif"></P>
<P CLASS="t">However, attempting to load the 10 A.M. log dump would result in SQL Server error 4305:</P>

<PRE>Specified file 'dumpfile' is out of sequence. Current time stamp is 'some_date_and_time' while dump was from 'some_other_date_and_time'.
</PRE>
<P CLASS="t">Error 4305 would be encountered because the 9:30 A.M. truncation of the log would have been given a sequence number of 3, and the 10 A.M. dump has a sequence number of 4. Since the truncation of the log does not produce a physical dump file, it cannot be loaded. The net effect is an attempt to go from sequence number 2 to sequence number 4, which, as stated earlier, is prohibited because the sequence numbers must increase monotonically. Therefore, the transactions that took place after 9 A.M. cannot be recovered. To avoid this situation, it is imperative that a full database dump be issued immediately after the transaction log is truncated, so that the sequence number in the database is reset.</P></BODY></HTML>
