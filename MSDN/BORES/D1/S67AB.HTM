<HTML><head><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Distributed Transactions</TITLE><BODY BGCOLOR="#FFFFFF">


<H2 CLASS="h1">Distributed Transactions</H2><P CLASS="t">The discussion so far has assumed that all the applications and resource managers were on a single computer. MS DTC also supports transactions distributed across two or more Windows systems. Each system has a local transaction manager. All applications and resource managers talk to their local transaction managers. The transaction managers cooperate to manage transactions that span systems.</P>
<P CLASS="t">When a transaction first visits a new system (when the first request tagged with the transaction arrives at that system), the two systems involved in the request establish a relationship. The system making the request<B> </B>informs its local transaction manager that the transaction has an <I>outgoing</I> relationship to the transaction manager on the second system. Similarly, the system receiving the request informs its local transaction manager that the transaction has an <I>incoming</I> relationship with the transaction manager on the first system.</P>
<P CLASS="t">These outgoing-incoming relationships form a tree of transaction manager relationships called the transaction's <I>commit tree</I>. The enlisted resource managers are also members of this commit tree; they have an outgoing-incoming relationship to their local transaction manager.</P>
<P CLASS="t">When a distributed transaction commits or aborts, the prepare, commit, and abort messages flow outward on the commit tree. Any node of the tree can unilaterally abort a transaction anytime before it agrees to the prepare request sent at phase one. Once a node has prepared, it remains prepared and in doubt until the commit coordinator tells it to commit or abort the transaction. The root transaction<B> </B>manager of the commit tree is the global <I>commit coordinator</I>. It makes the decision to commit or abort the transaction and is never in doubt.</P>
<P CLASS="t">If a computer fails and then restarts, the transaction manager at that computer will determine the outcome of all in-doubt transactions. The transaction manager reads its log file to determine the outcome of transactions for which it was the commit coordinator. For incoming transactions from other systems, the transaction manager reads the log file to determine if it was previously notified of the transaction's outcome. For incoming transactions that remain in doubt, the transaction manager queries the incoming transaction manager to learn the transaction's outcome. The transaction manager also responds to queries from other transaction managers regarding in-doubt outgoing transactions sent to them. </P>
<P CLASS="t">This is similar to the protocol that transaction managers and resource managers follow at restart. The transaction manager determines the outcome of each in-doubt transaction and, when asked, tells the resource managers the transaction's outcome.</P>
<P CLASS="t">In-doubt transactions are especially troublesome for distributed transactions. System or communication failures can leave transactions in doubt for a long time. While the transaction is in doubt, the resources modified by the transaction remain locked and unavailable to others. MS DTC provides a way for the system operator to resolve transactions that remain in doubt for too long. The operator can use a graphical management interface at the commit coordinator system to determine the transaction's outcome. The operator also can use the graphical management interface at the in-doubt system to force the in-doubt transaction to commit or abort. When the systems reconnect, MS DTC detects these operator actions and it flags inconsistent actions.</P></BODY></HTML>
