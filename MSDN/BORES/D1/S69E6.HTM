<HTML><head><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Implementing Sqlhdtst</TITLE><BODY BGCOLOR="#FFFFFF">


<H3 CLASS="h2">Implementing Sqlhdtst</H3><P CLASS="t">Sqlhdtst can be run either by clicking on its icon or from the command prompt. This version of Sqlhdtst accepts command-prompt arguments, making it easier to run the utility from command files that fire off several simultaneous instances of Sqlhdtst.</P>
<H4 CLASS="h3"><A NAME="sec0"></A>Usage</H4><P CLASS="t">When you run Sqlhdtst from the command prompt, it accepts the following options:</P>
<P CLASS="t"><B>sqlhdtst</B> [<B>/D</B><I>testfile</I>] [<B>/S</B><I>size</I>] [<B>/I</B><I>iterations</I>] [<B>/W</B><I>nmbrwrites</I>] [<B>/T</B><I>threads</I>] [<B>/M</B><I>maxasync</I>] [<B>/Q</B><I>threadasync</I>] [<B>/O</B><I>outfile</I>] [<B>/B</B><I>boost</I>] [<B>/R</B><I>readaheadthreads</I>] [<B>/E</B><I>readaheadextents</I>]</P>
<P CLASS="t">where:</P>
<P CLASS="term1"><B>/D</B><I>testfile</I></P>
<P CLASS="dt1">Is the full path to the file that Sqlhdtst will create for testing.</P>
<P CLASS="term1"><B>/S</B><I>size</I></P>
<P CLASS="dt1">Is the size of the test file, specified in 2K pages.</P>
<P CLASS="term1"><B>/I</B><I>iterations</I></P>
<P CLASS="dt1">Is the number of test iterations to run.</P>
<P CLASS="term1"><B>/W</B><I>nmbrwrites</I></P>
<P CLASS="dt1">Is the number of writes to make in each iteration.</P>
<P CLASS="term1"><B>/T</B><I>threads</I></P>
<P CLASS="dt1">Is the number of threads to use.</P>
<P CLASS="term1"><B>/M</B><I>maxasync</I></P>
<P CLASS="dt1">Is the maximum number of asynchronous I/Os to have outstanding at any time.</P>
<P CLASS="term1"><B>/Q</B><I>threadasync</I></P>
<P CLASS="dt1">Is the maximum number of asynchronous I/Os any individual thread can have outstanding at any time.</P>
<P CLASS="term1"><B>/O</B><I>outfile</I></P>
<P CLASS="dt1">Is the name of a file to hold an output report.</P>
<P CLASS="term1"><B>/B</B><I>boost</I></P>
<P CLASS="dt1">Indicates whether or not Sqlhdtst should run with boost priority on (1) or off (0). The default is off (0).</P>
<P CLASS="term1"><B>/R</B><I>readaheadthreads</I></P>
<P CLASS="dt1">Is the number of readahead threads Sqlhdtst should use.</P>
<P CLASS="term1"><B>/E</B><I>readaheadextents</I></P>
<P CLASS="dt1">Is the number of readahead extents each readahead thread should use.</P>
<P CLASS="t">When you run Sqlhdtst from an icon, you use a dialog box to fill in the above parameters. The dialog box appears when you click <B>DiskTest/Run Test</B>.</P>
<H4 CLASS="h3"><A NAME="sec1"></A>Remarks</H4><P CLASS="t">If an error is detected, contact your system support provider.</P>
<P CLASS="t">If Sqlhdtst runs without reporting any errors, this does not mean the system is free of problems. It simply means Sqlhdtst did not encounter a problem. Problems could still exist that were not triggered by Sqlhdtst.</P>
<P CLASS="t">For meaningful results, run Sqlhdtst as follows:</P>
<SPAN CLASS="list"><UL><LI CLASS="ULI1">Run at least four simultaneous instances of the program. Each instance will need to specify a unique file name.</LI><LI CLASS="ULI1">Use a large file size. What constitutes a large file varies depending on your server and available free disk space. Try to use test files more than 50 MB in size, use much larger files when the space is available.</LI><LI CLASS="ULI1">If you have multiple drives and/or disk controllers, ensure that at least one instance of Sqlhdtst places its file on each one.</LI><LI CLASS="ULI1">While the disk tests are running, also run at least one instance, and preferably more, against network-based drives. For example, use as the test file path:</LI></UL></SPAN><P>\\<I>servername</I>\c$\ftest.fil</P>
<P></P>
<P CLASS="lt1">where <I>servername</I> is the name of a network file server to which the Windows NT box being tested has access.</P>
<SPAN CLASS="list"><UL><LI CLASS="ULI1">At a minimum, run the test overnight. Running the test for a few days, such as over a weekend, is best. Adjust parameters to ensure the test will run for the entire test period.</LI><LI CLASS="ULI1">Because of the high resource load Sqlhdtst places on the system, you should not have the system in production nor be running SQL Server.</LI><LI CLASS="ULI1">Because of the high CPU load Sqlhdtst places on the system, you may want to start Sqlhdtst from the command prompt, running in the IDLE priority class. This will not reduce the effectiveness of the test; however, it will help prevent the test from dominating the system to the point where a command session is unresponsive. For example:</LI></UL></SPAN><P>start /low sqlhdtst</P>
<P></P>
<P CLASS="lt1">The test is also usually run without boost priority enabled.</P>
<SPAN CLASS="list"><UL><LI CLASS="ULI1">When running Sqlhdtst from an icon, the dialog box presents small, medium, and large options to quickly configure tests. Using medium is a good choice for small server machines; this uses a 100 MB test file.</LI><LI CLASS="ULI1">To effectively test a large server, use conditions such as:

<UL><LI CLASS="ULI2">Run at least four simultaneous instances of Sqlhdtst for the disk subsystem.</LI><LI CLASS="ULI2">Concurrently run at least two instances of Sqlhdtst against network-based drives on a remote file server, if possible.</LI><LI CLASS="ULI2">Start each instance using the START /LOW command.</LI><LI CLASS="ULI2">Select a nonconflicting file name for each test file.</LI><LI CLASS="ULI2">Place a separate test file on each disk or disk controller.</LI><LI CLASS="ULI2">Select a file size greater than 100 MB. Make file sizes as large as possible.</LI><LI CLASS="ULI2">For <B>Number of Iterations</B> <B>of the test</B>, select <B>2000</B>.</LI><LI CLASS="ULI2">For <B>Number of Random Writes/iteration</B>, select <B>10000</B>.</LI><LI CLASS="ULI2">For <B>Number of Worker Threads</B>, select <B>50</B>.</LI><LI CLASS="ULI2">For <B>Max Async IO</B>, select <B>255</B>.</LI><LI CLASS="ULI2">For <B>Max Async IO per Thread</B>, select <B>4</B>.</LI></UL></LI></UL></SPAN><H4 CLASS="h3"><A NAME="sec2"></A>Samples</H4><P CLASS="ls">To run a single test on a small server:</P>
<P>start /LOW sqlhdtst /Dc:\sqlhdtst\testfile.dat /S512 /I20 /W20 /T5 /M20 /Q4 /R3 /E3</P>
<P></P>
<P CLASS="ls">To run a single test on a medium server:</P>
<P>start /LOW sqlhdtst /Dc:\sqlhdtst\testfile.dat /S51200 /I100 /W500 /T25 /M20 /Q4 /R6 /E6</P>
<P></P>
<P CLASS="ls">To run a single test on a large server:</P>
<P>start /LOW sqlhdtst /Dc:\sqlhdtst\testfile.dat /S512000 /I2000 /W10000 /T100 /M20 /Q4 /R12 /E12</P>
<P></P>
<P CLASS="ls">To seriously stress test a large server that has c:, d:, e:, and f: physical disk drives:</P>
<P>start /LOW sqlhdtst /Dc:\testfil1.dat /S512000 /I2000 /W10000 /T100 /M20 /Q4 /R12 /E12<BR>start /LOW sqlhdtst /Dd:\testfil2.dat /S512000 /I2000 /W10000 /T100 /M20 /Q4 /R12 /E12<BR>start /LOW sqlhdtst /De:\testfil3.dat /S512000 /I2000 /W10000 /T100 /M20 /Q4 /R12 /E12<BR>start /LOW sqlhdtst /Df:\testfil4.dat /S512000 /I2000 /W10000 /T100 /M20 /Q4 /R12 /E12<BR>start /LOW sqlhdtst /D\\FileSrvr1\sharenm\testfil5.dat /S512000 /I2000 /W10000 /T100 /M20 /Q4 /R12 /E12<BR>start /LOW sqlhdtst /D\\FileSrvr2\sharenm\testfil5.dat /S512000 /I2000 /W10000 /T100 /M20 /Q4 /R12 /E12</P>
<P CLASS="t"></P></BODY></HTML>
