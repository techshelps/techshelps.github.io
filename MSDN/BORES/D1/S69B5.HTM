<HTML><head><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Implementing sp_drop_fkeys</TITLE><BODY BGCOLOR="#FFFFFF">


<H3 CLASS="h2">Implementing sp_drop_fkeys</H3><P CLASS="t"><B>sp_drop_fkeys</B> can be used to drop all, or some, of the foreign keys referencing one or more tables.</P>
<H4 CLASS="h3"><A NAME="sec0"></A>Usage</H4><P CLASS="t"><B>sp_drop_fkeys</B> [@parent_tb_name = <I>prntname</I>]<BR> [, @child_tb_name = <I>chldname</I>]<BR> [, @fk_cns_name = <I>consname</I>]<BR> [,@diagnostics_option = <I>diagopt</I>]<BR> [,@num_targeted_fkeys= <I>@ScriptVar</I> OUTPUT]<BR><BR>where:</P>
<P CLASS="term1"><I>prntname</I></P>
<P CLASS="dt1">Is the name of the parent table for which the foreign keys will be dropped. If <I>prntname</I> is a Transact-SQL wildcard pattern, the foreign keys for all tables whose names match the pattern will be dropped. <I>Prntname</I> is a required parameter.</P>
<P CLASS="term1"><I>chldname</I></P>
<P CLASS="dt1">Is the name of the referencing table whose references constraints will be dropped. If <I>chldname</I> is a Transact-SQL wildcard pattern, the references constraints referring back to <I>prntname</I> from all child tables whose names match the pattern will be dropped.</P>
<P CLASS="term1"><I>consname</I></P>
<P CLASS="dt1">Is the name of the references constraint to be dropped. If <I>consname</I> is a Transact-SQL wildcard pattern, all references constraints whose name matches the pattern will be dropped.</P>
<P CLASS="term1"><I>diagopt</I></P>
<P CLASS="dt1">Controls the production of a diagnostic report. The values are 'yes', 'no', or 'only'; 'yes' is the default if <I>diagopt</I> is not specified.</P>
<P CLASS="term1">@num_targeted_fkeys<I>= @ScriptVar</I> OUTPUT<I> </I></P>
<P CLASS="dt1">This parameter returns the number of constraints affected by each execution of <B>sp_drop_fkeys</B>. <I>@ScriptVar</I> should be declared as an integer.</P>
<H4 CLASS="h3"><A NAME="sec1"></A>Remarks</H4><P CLASS="t">If <I>prntname</I> is the name of a table, then all the references constraints which refer back to that table will be dropped. If <I>chldname</I> or <I>consname</I> are also specified, then only the subset of references constraints that qualify for all three parameters will be dropped. If <I>prntname</I> is a LIKE wildcard pattern, all tables whose names match the pattern will have their references constraints dropped.</P>
<P CLASS="t">If <I>chldname</I> is the name of a table, all of its references constraints back to the table or tables named in <I>prntname</I> are dropped. If <I>chldname</I> is a LIKE wildcard pattern, all tables whose names match the pattern will have their constraints dropped.</P>
<P CLASS="t">If <I>consname</I> is the name of a constraint, that constraint will be dropped. If <I>consname</I> is a LIKE wildcard pattern, then all constraints whose names match the pattern will be dropped.</P>
<P CLASS="t">If <I>diagopt</I> is 'yes', all qualifying constraints are dropped and a diagnostic report indicating which constraints were dropped is produced. If <I>diagopt</I> is 'no', the constraints will be dropped without a report. If <I>diagopt</I> is 'only', then no constraints are dropped, and only the diagnostic report is produced.</P>
<H4 CLASS="h3"><A NAME="sec2"></A>Samples</H4><P CLASS="ls">To drop all the references constraints that refer back to a specific table:</P>
<P>sp_drop_fkeys PriTab</P>
<P></P>
<P CLASS="ls">To drop all the references constrains on tables whose name contain a specific string and refer back to a specific parent table:</P>
<P>sp_drop_fkeys PriTab, '%RefTab%'</P>
<P></P>
<P CLASS="ls">To drop a specific constraint that refers back to a specific table:</P>
<P>sp_drop_fkeys @parent_tb_name='PriTab', @fk_cns_name='RefCon1'</P>
<P></P>
<P CLASS="ls">To report how many constraints would be dropped on all child tables whose names match a string, and also to retrieve the count of constraints affected:</P>
<P>declare @OutKeyCount int<BR>declare @Msg char(50)<BR>exec sp_drop_fkeys @parent_tb_name='PriTab',<BR>    @child_tb_name='RefTab%',<BR>    @diagnostics_option = 'ONLY',<BR>    @num_targeted_fkeys = @OutKeyCount OUTPUT<BR>select @Msg = 'Output keycount = ' + convert(char(3), @OutKeyCount)<BR>print @Msg<BR></P></BODY></HTML>
