<HTML><head><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>System Table Mappings</TITLE><BODY BGCOLOR="#FFFFFF">


<H3 CLASS="h2">System Table Mappings</H3><P CLASS="t">This section tells how the preceding components are represented in the system tables. This section assumes that SQL Server is setup with all default settings and that the following statements have been executed:</P>

<PRE>DISK INIT NAME = 'SampleData', PHYSNAME='c:\mssql\data\smpldata.dat', VDEVNO=1, SIZE = 20480<BR>GO<BR>DISK INIT NAME = 'SampleLog', PHYSNAME='c:\mssql\data\smpllog.dat', VDEVNO=2, SIZE = 10240<BR>GO<BR>CREATE DATABASE sample ON SampleData = 10 LOG ON SampleLog = 10<BR>GO<BR>ALTER DATABASE sample on SampleData = 10<BR>GO<BR></PRE>
<H4 CLASS="h3"><A NAME="sec0"></A>Devices</H4><P CLASS="t">The <B>master.dbo.sysdevices</B> table records the information for each device. The following SELECT statement returns the data that helps to understand how the database devices are structured:</P>

<PRE>SELECT low, high, vdevno = low / 16777216, name, phyname<BR>FROM sysdevices<BR>WHERE status &lt; 16<BR>ORDER BY low
</PRE>
<P CLASS="t">When this query is executed on the sample system, here is the result set:</P>

<TABLE COLS="5" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="65pt" VALIGN="TOP"><COL WIDTH="60pt" VALIGN="TOP"><COL WIDTH="35pt" VALIGN="TOP"><COL WIDTH="55pt" VALIGN="TOP"><COL WIDTH="130pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><PRE>LOW</PRE></TD><TD VALIGN="TOP"><PRE>HIGH</PRE></TD><TD VALIGN="TOP"><PRE>VDEVNO</PRE></TD><TD VALIGN="TOP"><PRE>NAME</PRE></TD><TD VALIGN="TOP"><PRE>PHYNAME</PRE></TD></TR><TR><TD COLSPAN="5" VALIGN="TOP"><P CLASS="tr"></P></TD></TR><TR><TD VALIGN="TOP"><PRE></PRE></TD><TD VALIGN="TOP"><PRE></PRE></TD><TD VALIGN="TOP"><PRE></PRE></TD><TD VALIGN="TOP"><PRE></PRE></TD><TD VALIGN="TOP"><PRE></PRE></TD></TR><TR><TD VALIGN="TOP"><PRE>0</PRE></TD><TD VALIGN="TOP"><PRE>12799</PRE></TD><TD VALIGN="TOP"><PRE>0</PRE></TD><TD VALIGN="TOP"><PRE>master</PRE></TD><TD VALIGN="TOP"><PRE>c:\mssql\data\master.dat</PRE></TD></TR><TR><TD VALIGN="TOP"><PRE>16777216</PRE></TD><TD VALIGN="TOP"><PRE>167797695</PRE></TD><TD VALIGN="TOP"><PRE>1</PRE></TD><TD VALIGN="TOP"><PRE>SampleData</PRE></TD><TD VALIGN="TOP"><PRE>c:\mssql\data\smpldata.dat</PRE></TD></TR><TR><TD VALIGN="TOP"><PRE>33554432</PRE></TD><TD VALIGN="TOP"><PRE>33564671</PRE></TD><TD VALIGN="TOP"><PRE>2</PRE></TD><TD VALIGN="TOP"><PRE>SampleLog</PRE></TD><TD VALIGN="TOP"><PRE>c:\mssql\data\smpllog.dat</PRE></TD></TR><TR><TD VALIGN="TOP"><PRE>2113929216</PRE></TD><TD VALIGN="TOP"><PRE>2113930239</PRE></TD><TD VALIGN="TOP"><PRE>126</PRE></TD><TD VALIGN="TOP"><PRE>MSDBLog</PRE></TD><TD VALIGN="TOP"><PRE>c:\mssql\data\msdblog.dat</PRE></TD></TR><TR><TD VALIGN="TOP"><PRE>2130706432</PRE></TD><TD VALIGN="TOP"><PRE>2130709503</PRE></TD><TD VALIGN="TOP"><PRE>127</PRE></TD><TD VALIGN="TOP"><PRE>MSDBData</PRE></TD><TD VALIGN="TOP"><PRE>c:\mssql\data\msdb.dat</PRE></TD></TR></TBODY></TABLE>
<P CLASS="spacing"><BR></P><PRE NM="Ex"></PRE><P CLASS="t">Interpreting this based on the discussion of <B>sysdevices </B>and fragments above, these results show that SQL Server Setup created three system devices: <B>master</B>, <B>MSDBLog</B>, and <B>MSDBData</B> and that the script shown earlier created two user-defined devices: <B>SampleData</B> and <B>SampleLog</B>. The<B> low</B> and <B>high</B> columns list the range of virtual page numbers for each device, while the <B>vdevno</B> column calculates the <B>vdevno</B> specified for each device DISK INIT.</P>
<H4 CLASS="h3"><A NAME="sec1"></A>Databases</H4><P CLASS="t">The <B>master.dbo.sysdatabases</B> table contains the information for each database. The only information in <B>sysdatabases</B> that is important for mapping databases to devices is the unique database identifier (DBID) assigned to each database as shown by the following query and result set:</P>

<PRE>SELECT name, dbid<BR>FROM sysdatabases<BR>ORDER BY dbid
NAME    DBID</PRE>
<P CLASS="tr"></P>

<PRE>master    1
tempdb    2
model    3
pubs    4
msdb    5
sample    6
</PRE>
<P CLASS="t">The result set shows that Setup created the four system databases: <B>master</B>, <B>tempdb</B>, <B>model</B>, and <B>msdb</B>, and installed the <B>pubs</B> example database and that the script shown earlier created the <B>sample</B> database.</P>
<H4 CLASS="h3"><A NAME="sec2"></A>Fragments</H4><P CLASS="t"><B>master.dbo.sysusages</B> maps each database to the underlying devices. Each database fragment has one row in <B>sysusages</B>. The following query retrieves information about how the databases map to the devices:</P>

<PRE>SELECT dbname = sd.name, su.*<BR>FROM sysusages su, sysdatabases sd<BR>WHERE su.dbid = sd.dbid<BR>ORDER BY su.dbid, su.lstart
</PRE>
<P CLASS="t">Here is the result set for the preceding query on the sample system:</P>

<TABLE COLS="6" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="48pt" VALIGN="TOP"><COL WIDTH="60pt" VALIGN="TOP"><COL WIDTH="60pt" VALIGN="TOP"><COL WIDTH="60pt" VALIGN="TOP"><COL WIDTH="60pt" VALIGN="TOP"><COL WIDTH="62pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><PRE>DBNAME</PRE></TD><TD VALIGN="TOP"><PRE>DBID</PRE></TD><TD VALIGN="TOP"><PRE>SEGMAP</PRE></TD><TD VALIGN="TOP"><PRE>LSTART</PRE></TD><TD VALIGN="TOP"><PRE>SIZE</PRE></TD><TD VALIGN="TOP"><PRE>VSTART</PRE></TD></TR><TR><TD COLSPAN="6" VALIGN="TOP"><P CLASS="tr"></P></TD></TR><TR><TD COLSPAN="6" VALIGN="TOP"><PRE></PRE></TD></TR><TR><TD VALIGN="TOP"><PRE>master</PRE></TD><TD VALIGN="TOP"><PRE>1</PRE></TD><TD VALIGN="TOP"><PRE>7</PRE></TD><TD VALIGN="TOP"><PRE>0</PRE></TD><TD VALIGN="TOP"><PRE>1536</PRE></TD><TD VALIGN="TOP"><PRE>4</PRE></TD></TR><TR><TD VALIGN="TOP"><PRE>master</PRE></TD><TD VALIGN="TOP"><PRE>1</PRE></TD><TD VALIGN="TOP"><PRE>7</PRE></TD><TD VALIGN="TOP"><PRE>1536</PRE></TD><TD VALIGN="TOP"><PRE>7168</PRE></TD><TD VALIGN="TOP"><PRE>3588</PRE></TD></TR><TR><TD VALIGN="TOP"><PRE></PRE></TD><TD VALIGN="TOP"><PRE></PRE></TD><TD VALIGN="TOP"><PRE></PRE></TD><TD VALIGN="TOP"><PRE></PRE></TD><TD VALIGN="TOP"><PRE></PRE></TD><TD VALIGN="TOP"><PRE></PRE></TD></TR><TR><TD VALIGN="TOP"><PRE>tempdb</PRE></TD><TD VALIGN="TOP"><PRE>2</PRE></TD><TD VALIGN="TOP"><PRE>7</PRE></TD><TD VALIGN="TOP"><PRE>0</PRE></TD><TD VALIGN="TOP"><PRE>1024</PRE></TD><TD VALIGN="TOP"><PRE>2564</PRE></TD></TR><TR><TD VALIGN="TOP"><PRE>model</PRE></TD><TD VALIGN="TOP"><PRE>3</PRE></TD><TD VALIGN="TOP"><PRE>7</PRE></TD><TD VALIGN="TOP"><PRE>0</PRE></TD><TD VALIGN="TOP"><PRE>512</PRE></TD><TD VALIGN="TOP"><PRE>1540</PRE></TD></TR><TR><TD VALIGN="TOP"><PRE>pubs</PRE></TD><TD VALIGN="TOP"><PRE>4</PRE></TD><TD VALIGN="TOP"><PRE>7</PRE></TD><TD VALIGN="TOP"><PRE>0</PRE></TD><TD VALIGN="TOP"><PRE>512</PRE></TD><TD VALIGN="TOP"><PRE>2052</PRE></TD></TR><TR><TD VALIGN="TOP"><PRE>pubs</PRE></TD><TD VALIGN="TOP"><PRE>4</PRE></TD><TD VALIGN="TOP"><PRE>7</PRE></TD><TD VALIGN="TOP"><PRE>512</PRE></TD><TD VALIGN="TOP"><PRE>1024</PRE></TD><TD VALIGN="TOP"><PRE>10756</PRE></TD></TR><TR><TD VALIGN="TOP"><PRE>msdb</PRE></TD><TD VALIGN="TOP"><PRE>5</PRE></TD><TD VALIGN="TOP"><PRE>3</PRE></TD><TD VALIGN="TOP"><PRE>0</PRE></TD><TD VALIGN="TOP"><PRE>3072</PRE></TD><TD VALIGN="TOP"><PRE>2130706432</PRE></TD></TR><TR><TD VALIGN="TOP"><PRE>msdb</PRE></TD><TD VALIGN="TOP"><PRE>5</PRE></TD><TD VALIGN="TOP"><PRE>4</PRE></TD><TD VALIGN="TOP"><PRE>3072</PRE></TD><TD VALIGN="TOP"><PRE>1024</PRE></TD><TD VALIGN="TOP"><PRE>2113929216</PRE></TD></TR><TR><TD VALIGN="TOP"><PRE>sample</PRE></TD><TD VALIGN="TOP"><PRE>6</PRE></TD><TD VALIGN="TOP"><PRE>3</PRE></TD><TD VALIGN="TOP"><PRE>0</PRE></TD><TD VALIGN="TOP"><PRE>5120</PRE></TD><TD VALIGN="TOP"><PRE>16777216</PRE></TD></TR><TR><TD VALIGN="TOP"><PRE>sample</PRE></TD><TD VALIGN="TOP"><PRE>6</PRE></TD><TD VALIGN="TOP"><PRE>4</PRE></TD><TD VALIGN="TOP"><PRE>5120</PRE></TD><TD VALIGN="TOP"><PRE>5120</PRE></TD><TD VALIGN="TOP"><PRE>33554432</PRE></TD></TR><TR><TD VALIGN="TOP"><PRE>sample</PRE></TD><TD VALIGN="TOP"><PRE>6</PRE></TD><TD VALIGN="TOP"><PRE>3</PRE></TD><TD VALIGN="TOP"><PRE>10240</PRE></TD><TD VALIGN="TOP"><PRE>5120</PRE></TD><TD VALIGN="TOP"><PRE>16782336</PRE></TD></TR></TBODY></TABLE>
<P CLASS="spacing"><BR></P><PRE NM="Ex"></PRE><P CLASS="t">The <B>segmap</B> column indicates what segments map to what fragment. All segments are assigned a segment number in the <B>syssegments</B> table in each database. The system segment is always segment 0, the default segment is always segment 1, and the logsegment segment is always segment 2. The system maps these into <B>segmap</B> by turning on a bit. If segment 0 (system) maps to the fragment, the system turns on the low order (or 1 bit) in the <B>segmap</B> column. If segment 1 (default) maps to the fragment, the second lowest order bit (the 2 bit) is turned on. If segment 3 (logsegment) maps to the fragment, the third lowest order bit (the 4 bit) is turned on.</P>

<TABLE COLS="3" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="60pt" VALIGN="TOP"><COL WIDTH="75pt" VALIGN="TOP"><COL WIDTH="200pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P CLASS="thf">Segmap value</P></TD><TD VALIGN="TOP"><P CLASS="th">Bits turned on</P></TD><TD VALIGN="TOP"><P CLASS="th">Segments applied</P></TD></TR><TR><TD COLSPAN="3" VALIGN="TOP"><P CLASS="tr"></P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">7</P></TD><TD VALIGN="TOP"><P CLASS="tt">1 + 2 + 4</P></TD><TD VALIGN="TOP"><P CLASS="tt">System + default + logsegment (data + log)</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">4</P></TD><TD VALIGN="TOP"><P CLASS="tt">4</P></TD><TD VALIGN="TOP"><P CLASS="tt">Logsegment (log only)</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">3</P></TD><TD VALIGN="TOP"><P CLASS="tt">1 + 2</P></TD><TD VALIGN="TOP"><P CLASS="tt">System + default (data only)</P></TD></TR></TBODY></TABLE>
<P CLASS="spacing"><BR></P><P CLASS="t">In most current systems and where all fragments are in one of these three states (data only, log only, or data log), all the <B>segmap</B> values in <B>sysusages</B> will be either 3, 4, or 7. In systems containing user-defined segments, or where you may have been working with the segments, there may be other <B>segmap</B> values present. For information about how to map the <B>segmap</B> values back to the user-defined segments, see Knowledge Base Article Q101241.</P>
<P CLASS="t">The <B>sysusages.lstart</B> column indicates the logical page number within the database at which the fragment starts. The <B>size</B> column indicates how many pages are in that fragment. From the combination of the <B>segmap</B>, <B>lstart</B>, and <B>size</B> columns, you can tell that the <B>sample</B> database has three fragments. Each fragment is 10 MB in size (<B>size</B>/512). The first fragment starts at logical page 0 and is a data-only segment (<B>segmap</B> equals 3), the second fragment starts at logical page 5120 and is a log-only statement (<B>segmap</B> equals 4), while the last segment starts at logical page 10240 and is another data-only segment. This information relates to the logical ordering of the database fragments within the database but indicates nothing about their physical location in the devices.</P>
<P CLASS="t">The <B>vstart</B> column indicates the physical location of each fragment. <B>vstart</B> is the virtual page number within a device of the first page in each fragment. The location of the fragment can be found by mapping the <B>vstart </B>value back to the <B>low</B> and <B>high</B> columns in <B>sysdevices</B>. For example, the <B>vstart</B> of the first fragment in the <B>sample</B> database is 16777216. When that is matched against <B>sysdevices.low</B>, it is the same as the <B>low</B> value for the <B>SampleData</B> device. This indicates that this fragment starts on the first page in the <B>SampleData</B> device. The <B>vstart </B>of the second fragment in the <B>sample</B> database is 33554432, which maps to the first page of the <B>SampleLog </B>device. The <B>vstart </B>of the third fragment in the <B>sample</B> database is 16782336. Looking at <B>sysdevices</B>, we find that this value is larger than the <B>low</B> value for the <B>SampleData</B> device but smaller than the <B>high</B> value for <B>SampleData</B>, so the fragment is contained in the <B>SampleData</B> device.</P>
<P CLASS="t">One thing to note is that the lowest <B>vstart</B>, for the <B>master </B>database, is 4. This is because the first three pages of the <B>master </B>device are used internally by the system and are never allocated to a database.</P></BODY></HTML>
