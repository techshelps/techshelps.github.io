<HTML><head><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Application Design Techniques to Avoid a Blocking Problem</TITLE><BODY BGCOLOR="#FFFFFF">


<H2 CLASS="h1">Application Design Techniques to Avoid a Blocking Problem</H2>
<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="50%" VALIGN="TOP"><COL WIDTH="50%" VALIGN="TOP"></COLGROUP><TBODY><TR><TD COLSPAN="2" VALIGN="TOP"><P CLASS="tr"></P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="thf">Never do</P></TD><TD VALIGN="TOP"><P CLASS="th">Always do</P></TD></TR><TR><TD COLSPAN="2" VALIGN="TOP"><P CLASS="tr"></P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">Fail to immediately fetch all result rows to completion.</P></TD><TD VALIGN="TOP"><P CLASS="tt">Allow for query cancellation by using <B>dbcancel</B>, <B>sqlcancel</B>, or an equivalent.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">Design a large scale OLTP system using an application development tool that doesn't allow explicit control over connections, transactions, and the SQL syntax sent to the server.</P></TD><TD VALIGN="TOP"><P CLASS="tt">Use a query time-out by using <B>dbsetltime</B> or <B>SQLSetStmtOption</B> to prevent a runaway query and avoid distributed deadlocks.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">Use or design a client application that allows users to fill in edit boxes that generate a long-running query. Such an application may prompt you for inputs but allow you to leave certain fields blank or enter a wildcard for those blanks. This, in turn, can cause the application to submit a query with an excessive running time, causing blocking.</P></TD><TD VALIGN="TOP"><P CLASS="tt">Immediately fetch all result rows to completion.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">Use or design an application that allows for user input within a transaction.</P></TD><TD VALIGN="TOP"><P CLASS="tt">Keep transactions as short as possible.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt"></P></TD><TD VALIGN="TOP"><P CLASS="tt">Explicitly control connection management.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt"></P></TD><TD VALIGN="TOP"><P CLASS="tt">Stress test application at full projected concurrent-user load.</P></TD></TR></TBODY></TABLE>
<P CLASS="spacing"><BR></P><P CLASS="t">It's vital that great care be exercised during the design and construction phase of the database and application. In particular, the resource consumption, isolation level, and transaction path length should be evaluated for each query. Each query and transaction should be as lightweight as possible. Good connection management discipline must be exercised. If this is not done, it's possible the application may appear to have acceptable performance at low numbers of users, but the performance could degrade badly as the users scale upward.</P>
<P CLASS="t">With proper application and query design, Microsoft SQL Server is capable of supporting many thousands of simultaneous users on a single server, with little blocking. The successful sites that reach this level typically use the techniques mentioned in this article.</P>
<P CLASS="t"></P></BODY></HTML>
