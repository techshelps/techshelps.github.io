<HTML><head><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Using IMC Sample Extension DLL</TITLE><BODY BGCOLOR="#FFFFFF">


<H3 CLASS="h2">Using IMC Sample Extension DLL</H3><P CLASS="t">When initialized, IMC Sample Extension DLL loads a table named Imcroute.cfg from the configuration file you created. This file is in the directory specified in the RootDir IMC registry value.</P>
<H4 CLASS="h3"><A NAME="sec0"></A>Comparing Domain Names</H4><P CLASS="t">The table contains a list of domain names and associated SMTP hosts. For each recipient of every inbound message the Internet Mail Connector receives, the IMC Sample Extension DLL must compare the domain name on the address to the list of domain names in the table. If a match is found, the message for that particular recipient is rerouted to the associated host.</P>
<P CLASS="t">The match is compared to the rightmost part of the domain name on the recipient address. For example, if the domain name in the table is sea.com, it matches an address of x.sea.com as well as sea.com. The list is searched from top to bottom, and the first match is used. Note that it's best to list more specific patterns before general ones to ensure that the names are found.</P>
<P CLASS="t">In cases where the associated SMTP host is localhost, domain names in the list represent names that should be handled by the Internet Mail Connector. If the recipient address matches one of these domain names, the Internet Mail Connector processes the recipient normally and attempts to deliver the message to the Microsoft Exchange Server. If no match is found, the IMC Sample Extension DLL reroutes the outbound message to the domain name in the recipient's address. For this reason, it is important to ensure that any domain names that must be routed to the Microsoft Exchange Server are listed in the configuration file. In particular, any domain names used in SMTP addresses for Microsoft Exchange users must be defined in the configuration file. Otherwise, reports and replies will not be deliverable and could cause routing loops.</P>
<P CLASS="t">It is possible to introduce a message routing loop if the configuration file contains incorrect or incomplete information. It is recommended that you enable the DisableLoopbackConnections Internet Mail Connector registry value to reduce the chance of a message routing loop occurring.</P>
<H4 CLASS="h3"><A NAME="sec1"></A>Configuration File Example</H4><P CLASS="t">The following is an example of a configuration file.</P>
<P CLASS="spacing"><BR></P>
<PRE>! IMC Extension DLL Configuration File
! Event log parameters</PRE>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="148pt" VALIGN="TOP"><COL WIDTH="144pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P CLASS="spacing"><BR></P>
<PRE>EL_EventLogging</PRE></TD><TD VALIGN="TOP"><P CLASS="spacing"><BR></P>
<PRE>ReRouted</PRE></TD></TR><TR><TD VALIGN="TOP"><P CLASS="spacing"><BR></P>
<PRE>EL_EventLogging</PRE></TD><TD VALIGN="TOP"><P CLASS="spacing"><BR></P>
<PRE>NotRouted</PRE></TD></TR><TR><TD VALIGN="TOP"><P CLASS="spacing"><BR></P>
<PRE>Listserv.granite.com</PRE></TD><TD VALIGN="TOP"><P CLASS="spacing"><BR></P>
<PRE>listserv.granite.com</PRE></TD></TR><TR><TD VALIGN="TOP"><P CLASS="spacing"><BR></P>
<PRE>granite.sea.com</PRE></TD><TD VALIGN="TOP"><P CLASS="spacing"><BR></P>
<PRE>localhost</PRE></TD></TR><TR><TD VALIGN="TOP"><P CLASS="spacing"><BR></P>
<PRE>sea.com</PRE></TD><TD VALIGN="TOP"><P CLASS="spacing"><BR></P>
<PRE>mail.sea.com</PRE></TD></TR><TR><TD VALIGN="TOP"><P CLASS="spacing"><BR></P>
<PRE>granite.com</PRE></TD><TD VALIGN="TOP"><P CLASS="spacing"><BR></P>
<PRE>localhost</PRE></TD></TR></TBODY></TABLE>
<P CLASS="spacing"><BR></P><P></P>
<P CLASS="t">Lines beginning with an exclamation point (!) or a blank line are comments and are ignored. The keyword <B>EL_EventLogging</B> controls whether events are recorded to the Windows NT Workstation Event Log for messages that are processed. <B>EL_EventLogging</B> must be followed with <B>ReRouted</B> or <B>NotRouted</B>. <B>ReRouted</B> indicates that an event is recorded whenever an outbound message is rerouted. <B>NotRouted</B> indicates that an event is recorded whenever a message is not rerouted.</P>
<H4 CLASS="h3"><A NAME="sec2"></A>Message Routing Example</H4><P CLASS="t">Given the previous configuration file, the following are examples of message routing based on matching the domain name in the recipient's address:</P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="168pt" VALIGN="TOP"><COL WIDTH="180pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P CLASS="th"><B>Recipient</B></P></TD><TD VALIGN="TOP"><P CLASS="th"><B>Routed to</B></P></TD></TR><TR><TD COLSPAN="2" VALIGN="TOP"><P></P></TD></TR><TR><TD VALIGN="TOP"><P>user@listserv.granite.com</P></TD><TD VALIGN="TOP"><P>listserv.granite.com</P></TD></TR><TR><TD VALIGN="TOP"><P>user@granite.sea.com</P></TD><TD VALIGN="TOP"><P>localhost</P></TD></TR><TR><TD VALIGN="TOP"><P>user@sea.com</P></TD><TD VALIGN="TOP"><P>mail.sea.com</P></TD></TR><TR><TD VALIGN="TOP"><P>user@granite.com</P></TD><TD VALIGN="TOP"><P>localhost</P></TD></TR><TR><TD VALIGN="TOP"><P>user@pike.granite.com</P></TD><TD VALIGN="TOP"><P>localhost</P></TD></TR><TR><TD VALIGN="TOP"><P>user@anything.else.com</P></TD><TD VALIGN="TOP"><P>anything.else.com</P></TD></TR></TBODY></TABLE>
<P CLASS="spacing"><BR></P><P></P></BODY></HTML>
