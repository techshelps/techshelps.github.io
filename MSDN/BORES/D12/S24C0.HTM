<HTML><head><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Replicating Messages</TITLE><BODY BGCOLOR="#FFFFFF">


<H3 CLASS="h2">Replicating Messages</H3><P CLASS="t">When more than one instance of a public folder has been configured, the public folder replication agent (PFRA) — a component of the information store — monitors changes, additions, and deletions to the original public folder and other replicated public folders. These public folders are configured to have replicas on the information store. They are also configured for sending change messages to other information stores on which replicated instances have been configured.</P>
<P CLASS="t">The replicated messages are transported as embedded messages in message database encoding format (MDBEF), which is the file format used by the Microsoft Exchange Server information store. Each replicated message includes a change number that identifies it in relationship to existing replication messages.</P>
<H4 CLASS="h3"><A NAME="sec0"></A>Tracking of Modified Messages</H4><P CLASS="t">The PFRA maintains the following information about the state of each message in each folder.</P>
<UL><LI>A monotomically increasing, information store-specific <I>change number.</I></LI><LI>A list of <I>predecessor change numbers </I>(all previous change numbers for an information store)</LI></UL><P CLASS="t">The change number is made up of a unique identifier and a <I>change counter</I>, so the change numbers are information store-specific.</P>
<P CLASS="t">The change counter is assigned a number by the PFRA for each message change that occurs on a server. When a message on an information store is modified, the PFRA for that information store assigns a new change number to the message so that the change counter is greater than the previous one.</P>
<P CLASS="t">By using the predecessor change number list, the PRFA tracks which version of a message is the most current.</P>
<H4 CLASS="h3"><A NAME="sec1"></A>Replication of Modified Messages</H4><P CLASS="t">When you edit a message in a replicated public folder, the PFRA for that information store updates the state information for that message. It then sends a replication message containing the modified message and its attachments to the other information stores that maintain replicas. The list of information stores that maintain these replicas is a property of the folder.</P>
<P CLASS="t">When an information store receives a new replication message, the new message replaces the existing message on the local computer if the original message modification was made to the same version or a later version of the existing message. In other words, if the new message is more current than the existing message, then the new message replaces the existing message.</P>
<P CLASS="t">The message that contains the most recent information is determined by the change number and the predecessor change list. If the change number of the existing message is included in the predecessor change list of the new message, the new message replaces the existing message.</P>
<P CLASS="t">The following illustration shows how replication occurs when there are no conflicts.</P>
<P><img src="xerk_d08.gif"></P>
<H4 CLASS="h3"><A NAME="sec2"></A>Replication Conflicts</H4><P CLASS="t">Conflicts occur when a message is modified in two different replicas, where each modification is made before the other can replicate. For example, if the change number of the current message is not included in the predecessor list of the new message, the new message is older than the existing message. In this case, a change was made to a message that had not incorporated a previous change from another information store. As shown in the following illustration, a conflict has occurred.</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<img src="xerk_d09.gif"></P>
<P></P>
<P CLASS="t">When a conflict occurs, the information store alerts the folder contacts of the conflict by attaching the conflicting messages to a <I>conflict notification</I>. This is shown in the following illustration.</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<img src="xerk_d10.gif"></P>
<P></P>
<P CLASS="t">The folder contact can resolve the conflict at any of the instances. As shown in the following illustration, the resolved message replicates to the other folder instances.</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<img src="xerk_d11.gif"></P>
<P CLASS="t"></P>
<H4 CLASS="h3"><A NAME="sec3"></A>Replication of New and Deleted Messages</H4><P CLASS="t">When a new message is created in a public folder, the information store assigns a change counter number to the message and sends a replication message to all other information stores maintaining instances of the public folder. Information stores receiving the replication message create the message in their replica of the public folder, using the change number assigned by the information store the message was created on.</P>
<P CLASS="t">When a message is deleted, the information store from which the message is deleted sends a replication message to all other information stores maintaining instances of the public folder. This message indicates that the message has been deleted. Each receiving information store then deletes its instance of the message and maintains a tombstone for the deleted message.</P>
<H4 CLASS="h3"><A NAME="sec4"></A>Replication Frequency</H4><P CLASS="t">Because public folder replication is e-mail-based, the time for messages to replicate from one information store to a particular replica depends on the underlying messaging system and topology, as well as administrator-specified MTA connection parameters.</P>
<P CLASS="t">Scheduling for replication is configured in the Administrator program on a per-folder and per-information store basis. A <B>Replication Schedule</B> property page on the public folder object permits replication scheduling in 15-minute intervals. The same property page exists on the public information store object. If a schedule is set on the folder level, it overrides the schedule set at the information store level.</P></BODY></HTML>
