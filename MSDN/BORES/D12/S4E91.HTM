<HTML><head><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Locating Folders by Using Affinities</TITLE><BODY BGCOLOR="#FFFFFF">


<H3 CLASS="h2">Locating Folders by Using Affinities</H3><P CLASS="t">When you select a public folder to view its contents, the information store must decide where that folder is located and which location it should connect to. The information store looks for the public folder in the following places in the order indicated.</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;1.    The user's public folder hierarchy server.</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;2.    A <I>random number</I> server in the site. If there are multiple replicas in the site, the store provider uses an algorithm based on the user's domain name to determine the next location to search. The resulting number is divided by the number of servers that contain that public folder in the site. A connection is then made to the server assigned to that number. Because the number is random, this method distributes connections across all the available replicas in the site.</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;3.    An <I>existing connection</I> server in the site. If the information store cannot connect to the random number server, the remaining servers in the site are tried. Servers that already have remote procedure call (RPC) connections established are tried first.</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;4.    Other sites. If public folder replicas are not available in the site but there is at least one other site available with replicas, the <I>affinity number</I> is used to determine the order in which connections are attempted.</P>
<P>The affinity number is set in the site's <B>Public Folder Affinity</B> property page. This setting allows an administrator to set a cost for each of the other sites in the organization. The cost determines the order in which the information store attempts to connect to those sites. The site with the lowest cost is attempted first.</P>
<P>After the site is determined, the servers within that site or group of sites are tried in random order. If two sites have the same cost, the servers in those sites are pooled together and tried in random order. Any sites without an affinity setting are not attempted.</P>
<P CLASS="t">In the following illustration, a user in Site 1 wants to connect to a public folder. Every server shown has a replica of the desired public folder. The numbers in the servers indicate the order in which the connections are attempted.</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<img src="xerk_d06.gif"></P></BODY></HTML>
