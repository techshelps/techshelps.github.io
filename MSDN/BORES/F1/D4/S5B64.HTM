<HTML><head><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Troubleshooting Difficulties Locating the Client</TITLE><BODY BGCOLOR="#FFFFFF">


<H2 CLASS="h2">Troubleshooting Difficulties Locating the Client</H2><P CLASS="t">To successfully locate a client computer, three conditions must be met:</P>
<SPAN CLASS="list"><UL><LI CLASS="ULI1">The computer must be inventoried correctly.</LI><LI CLASS="ULI1">The computer's Remote Control Agent must be "listening" for this session.</LI><LI CLASS="ULI1">The intervening network must be able to establish and maintain the session.</LI><LI CLASS="ULI1">The proper options must be selected in the Help Desk Options section in the SMS client group on the client, and the Remote Control Agent must be loaded (minimized on the screen) at the client computer. These are <I>not</I> configured by default. </LI></UL></SPAN><H3 CLASS="h3"><A NAME="sec0"></A>Troubleshooting Inventory Problems Related to Remote Control</H3><P CLASS="t">Remote control is initiated in the SMS Administrator by double-clicking the Help Desk icon in the properties of an inventoried computer. The SMS Administrator uses SIGHTNT.DLL to attempt to initiate a session with the Remote Control Agent of the client by querying for the computer name (client name, IP address, or IPX address) and the address type (NetBIOS name, IP address, or IPX address) recorded in the inventory in the SQL database. In SMS 1.2, Service Pack 2, SIGHTNT.DLL also queries by the host name, in case the IP address listed in the database is out of syncwith the WINS database. The inventory information regarding the computer's network information and SMSID must correctly match an SMS client computer whose Remote Control Agent is currently "listening" on the network.</P>
<P CLASS="t">SIGHTNT.DLL looks in the SMS database to find the computer name and address. If the computer is not listed in the inventory, it will not be located and, therefore, cannot be remotely controlled.</P>
<P CLASS="t">Common inventory problems include:</P>
<SPAN CLASS="list"><UL><LI CLASS="ULI1">The client has not been inventoried at all.</LI><LI CLASS="ULI1">The client shares a computer name or address with another computer, and has an invalid SMSID (duplicate computer name or address)</LI><LI CLASS="ULI1">The client shares an SMSID with another client (duplicate SMSID).</LI><LI CLASS="ULI1">The client is running the Windows&reg; for Workgroups operating system version 3.11, and has been inventoried with a computer name in lowercase letters.</LI><LI CLASS="ULI1">The client's network address has not been correctly inventoried.</LI></UL></SPAN><P CLASS="t">These problems are discussed in the following sections.</P>
<H4 CLASS="h4"><A NAME="sec1"></A>The Client Has Not Been Inventoried</H4><H5 CLASS="h5"><A NAME="sec2"></A>Symptom:</H5><P CLASS="t">The client computer name does not appear in the inventory. It may or may not have the SMS client files installed.</P>
<H5 CLASS="h5"><A NAME="sec3"></A>Troubleshooting:</H5><SPAN CLASS="list"><UL><LI CLASS="ULI1">Install the SMS client files on the computer by invoking SMSLS.BAT or RUNSMS.BAT.</LI><LI CLASS="ULI1">If the client has the SMS client files on it, but does not appear in inventory, remove and reinstall the client.</LI><LI CLASS="ULI1">Follow the steps listed in Microsoft Knowledge Base article Q126642, "Troubleshooting SMS Inventory Collection Problems," to track down any further problems.</LI></UL></SPAN><H4 CLASS="h4"><A NAME="sec4"></A>Client Is a Duplicate with an Old, Invalid SMSID</H4><H5 CLASS="h5"><A NAME="sec5"></A>Symptoms:</H5><SPAN CLASS="list"><UL><LI CLASS="ULI1">The same computer name appears next to different SMSIDs in the Sites window.</LI><LI CLASS="ULI1">The message "Unable to Locate <I>clientname</I>" appears after "Trying Additional Protocols" (this message can indicate other problems, as well).</LI></UL></SPAN><H5 CLASS="h5"><A NAME="sec6"></A>Troubleshooting:</H5><SPAN CLASS="list"><UL><LI CLASS="ULI1">Select the most recent occurrence of the computer name and see if SMS can locate it. If so, delete the older occurrence of the computer name. If SMS cannot locate the most recent occurrence of the computer name, you have additional problems. However, you should still remove or merge your duplicate inventory, using DBCLEAN.</LI><LI CLASS="ULI1">If the problem persists, check to see why the SMS.INI file is being deleted, or why it is being locked during the verification process. 
<P CLASS="lt1"><B>Note   </B>Some MSTest scripts invoke INVDOS.EXE after installing a program to check to see if the program was installed correctly. If the SMS.INI file is locked, SMS Server cannot read it, and will respond as though the SMS.INI file did not exist at all – by reinstalling the SMS client. When the client is reinstalled, a new SMSID is assigned.</P></LI></UL></SPAN><H4 CLASS="h4"><A NAME="sec7"></A>Client Shares an SMSID with Another Client</H4><H5 CLASS="h5"><A NAME="sec8"></A>Symptoms:</H5><SPAN CLASS="list"><UL><LI CLASS="ULI1">The Help Desk icon and other icons may be missing in the affected client computer's properties.</LI><LI CLASS="ULI1">The network is functioning correctly; other clients on the same subnet can be remotely controlled.</LI></UL></SPAN><H5 CLASS="h5"><A NAME="sec9"></A>Troubleshooting:</H5><SPAN CLASS="list"><UL><LI CLASS="ULI1">If two computers share the same SMSID, delete the SMS.INI file on one of them. SMS will then create a new SMS.INI file, with a new SMSID.</LI><LI CLASS="ULI1">Check to see if the clients have been "cloned"—preloaded with the SMS client files. If so, all these clones will have the same SMSID assigned. Delete the SMS.INI file from all the clones. SMS will then create a new SMS.INI file with a new SMSID.</LI><LI CLASS="ULI1">Check to see if the .UID files on two logon servers overlap, or whether there are multiple .UID files on a logon server. Synchronize the site server with the *.UID files on the logon servers, as described under "Restoring a Primary Site" in Chapter 15, "System Maintenance," of the <I>Administrator's Guide</I> for SMS 1.2. If there are multiple .UID files, find the incorrect .UID file and rename or move it. See Microsoft Knowledge Base article Q127052. "SMS Unique ID (SMSID) Allocation," for information on how UIDs are assigned. </LI></UL></SPAN><H4 CLASS="h4"><A NAME="sec10"></A>Windows for Workgroups 3.11–based Clients Inventoried with a Computer Name in Lowercase Letters</H4><H5 CLASS="h5"><A NAME="sec11"></A>Symptoms:</H5><SPAN CLASS="list"><UL><LI CLASS="ULI1">The computer name of a Windows for Workgroups 3.11 client appears in lowercase letters, often the result of manually configuring the SYSTEM.INI file on the client.</LI><LI CLASS="ULI1">The message "Unable To Locate <I>Clientname</I>" appears after "Trying Additional Protocols." (This error message can indicate other problems, as well.)</LI></UL></SPAN><H5 CLASS="h5"><A NAME="sec12"></A>Troubleshooting:</H5><P CLASS="t">This problem appears if you are using a version of SMS earlier than 1.2; usually when you use custom batch processes to assign names to Windows for Workgroups–based computers. Windows versions 3.11 and later automatically convert the computer name to uppercase when writing to the SYSTEM.INI file.</P>
<P CLASS="t">The best solution is to upgrade to SMS 1.2. See Microsoft Knowledge Base article Q149495, "Remote Control Fails with Lower Case Computer Name," for a work-around for sites using earlier versions of SMS.</P>
<H4 CLASS="h4"><A NAME="sec13"></A>The Client's Network Address Has Not Been Correctly Inventoried</H4><H5 CLASS="h5"><A NAME="sec14"></A>Symptoms:</H5><SPAN CLASS="list"><UL><LI CLASS="ULI1">The TCP/IP or IPX address of the client is either wrong or missing in the Network section of the Personal Computer Properties window.</LI><LI CLASS="ULI1">The message "Unable To Locate <I>Clientname</I>" appears after "Trying Additional Protocols." (This error message can indicate other problems, as well.)</LI></UL></SPAN><H5 CLASS="h5"><A NAME="sec15"></A>Troubleshooting:</H5><SPAN CLASS="list"><UL><LI CLASS="ULI1">Upgrade to Service Pack 2 for SMS 1.2.</LI><LI CLASS="ULI1">If no address appears, check to see if the computer has a dial-up adapter, and if the dial-up adapter is first in the bindings for the protocol in question. If the dial-up adapter is first, SMS returns the address of the dial-up adapter (which should be 0.0.0.0). 
<P CLASS="lt1">For Windows NT–based clients, click <B>Network</B> in the Control Panel and then click <B>Bindings</B> to move the binding for the network adapter to the first position. </P>

<P CLASS="lt1">For Windows&nbsp;95-based clients, click <B>Network</B> in the Control Panel and choose the adapter for which you want to change the bindings. Then choose the <B>Bindings</B> tab to set the bindings.</P></LI><LI CLASS="ULI1">If the wrong IP address appears, check for reasons that the IP address might have changed. If you are using DHCP, the lease times for IP addresses must be longer than the inventory period. If the lease time is too short, the IP address in the inventory may be out of date. Reinventory the client to get current address information. To avoid this problem, make sure the DHCP lease time is considerably longer than the inventory interval (ideally by lengthening the lease time rather than shortening the inventory interval). A similar situation occurs if the WINS database has not been replicated; this problem is fixed in SMS 1.2 Service Pack 2.</LI><LI CLASS="ULI1">If you are attempting to use remote control using SMS 1.2, TCP/IP sockets, and Windows for Workgroups 3.11, see Microsoft Knowledge Base article Q156372, "TCP/IP Inventory Is Not Collected on SMS 1.2 WFW 3.11 Clients." This problem is fixed in SMS 1.2, Service Pack 1.</LI><LI CLASS="ULI1">If the client computer has two network adapter cards that are using different subnets, and you are not using Service Pack 2 with SMS 1.2, SMS inventories only one IP address for use with remote control. If WUSER or WUSER32 is monitoring the other IP address, it will not respond and remote control cannot find the computer. </LI></UL></SPAN><H3 CLASS="h3"><A NAME="sec16"></A>Troubleshooting Client Remote Control Agent Configuration Problems</H3><P CLASS="t">Improper or unsupported client configurations are perhaps the most frequent cause of the "Unable to locate" message. The server side (SIGHTNT.DLL on the SMS site server) calls the client side (WUSER.EXE for 16-bit clients or WUSER32.EXE for Windows&nbsp;NT or Windows&nbsp;95). If anything interferes with WUSER.EXE loading properly, the client will not be "listening" for SIGHTNT.DLL's call. This can happen if the Remote Control Agent is not loaded, or if a third-party TSR is preventing the call from being received. If SIGHTNT.DLL's call is accepted by another component (such as a third-party protocol stack) before WUSER.EXE or WUSER32.EXE can respond to it, the client cannot respond.</P>
<P CLASS="t">Common client configuration issues include:</P>
<SPAN CLASS="list"><UL><LI CLASS="ULI1">Other TSRs conflicting with THE supporting TSRs for WUSER.EXE or WUSER32.EXE (USERTSR.EXE or USERIPX.EXE) 
<P CLASS="lt1"><B>Note   </B>Neither USERTSR.EXE or USERIPX.EXE is used with SMS 1.2 clients running Windows.</P></LI><LI CLASS="ULI1">Failure to configure remote viewer options or load the Remote Control Agent/service </LI><LI CLASS="ULI1">Hardware problems</LI></UL></SPAN><H4 CLASS="h4"><A NAME="sec17"></A>Other TSRs Conflicting with WUSER.EXE's Supporting TSRs</H4><H5 CLASS="h5"><A NAME="sec18"></A>Symptoms:</H5><SPAN CLASS="list"><UL><LI CLASS="ULI1">The Help Desk Options and/or Remote Control Agent icons may be missing from the SMS program group on the client. </LI><LI CLASS="ULI1">The client may experience a general protection fault during remote control.</LI></UL></SPAN><H5 CLASS="h5"><A NAME="sec19"></A>Troubleshooting:</H5><SPAN CLASS="list"><UL><LI CLASS="ULI1">Remove all TSRs (such as virus scanners and virtual memory managers) from the AUTOEXEC.BAT file and the load line of the WIN.INI file, and reinstall the SMS client software.</LI><LI CLASS="ULI1">If the client can now be successfully remotely controlled, add each TSR back in, one at a time, until the conflict reoccurs. Query the Knowledge Base on "Remote Control," "SMS," and the name of the TSR in question for any possible workarounds. If a virus scanner is in conflict, consider using a daily SMS job to scan for viruses. </LI><LI CLASS="ULI1">The SMS client for Windows 95 causes a general protection fault in Microsoft Office when you attempt to establish a remote control session without the shortcut bar and then enable the shortcut bar. Should you experience this problem, upgrade to SMS 1.2, or call technical support for the fix.</LI></UL></SPAN><H4 CLASS="h4"><A NAME="sec20"></A>Failure to Configure Remote Viewer Options or Load the Remote Control Agent/Service</H4><H5 CLASS="h5"><A NAME="sec21"></A>Symptoms:</H5><SPAN CLASS="list"><UL><LI CLASS="ULI1">WUSER.EXE (for 16-bit clients) or WUSER32.EXE (for Windows&nbsp;NT or Windows&nbsp;95) does not appear minimized on the Windows–based client workstation.</LI><LI CLASS="ULI1">The remote control service does not load on Windows NT–based clients.</LI></UL></SPAN><H5 CLASS="h5"><A NAME="sec22"></A>Troubleshooting:</H5><SPAN CLASS="list"><UL><LI CLASS="ULI1">Make sure the <B>Remote Troubleshooting</B> check box is selected (checked) in the <B>Clients</B> dialog box for the site properties.</LI><LI CLASS="ULI1">Make sure the <B>Allow Remote Control</B> option is selected in the Help Desk Options in the SMS Client program group on the client computer. This can be verified remotely by looking in the client's SMS.INI file for the entry Allow Remote Takeover=yes.</LI><LI CLASS="ULI1">Make sure the Remote Control Agent has been loaded on the client computer. The Remote Control Agent icon will be minimized. You can verify that the Remote Control Agent is loaded by typing mem /c at the command prompt on the client computer, and looking for USERTSR (if using NetBEUI, NWLINK, or IP), or USERIPX (if using NetWare's IPX clients). (These TSRs are not required for clients based on Windows&nbsp;95, Windows&nbsp;NT, or Windows for Workgroups, but they are required for clients based on other Windows-based clients.)</LI><LI CLASS="ULI1">SMS 1.2 provides the added functionality of remote control as a service for the Windows NT operating system. Usually the only additional problem that may surface is that the SMS service account, under whose context the remote control service is installed, does not have "administrator" rights, nor does it have "log on as a service" rights for the workstation. If this is the case, the SMS client files will be installed, but neither the inventory agent service nor the remote control service will start. (To see if the remote control service is started, click Services in the Control Panel, or type <B>net start</B> at the command prompt of the Windows NT–based client). This lack of rights will show up in the CLICFG.LOG file on the SMS site server. Make sure the domain administrators are part of the local administrators group on the client, and that the SMS service account is a member of the domain admins group. Verify that the service account has "log on as a service" rights.</LI></UL></SPAN><H4 CLASS="h4"><A NAME="sec23"></A>Hardware Problems</H4><P CLASS="t">Sometimes a bad network adapter or other hardware problems can cause remote control to fail. If everything else checks out, try swapping out the network adapter, or try an identical hardware configuration with a fresh installation of the network operating system. If you can isolate the problem to a particular piece of hardware, try querying the Knowledge Base on "Remote Control," "SMS," and the name of the offending hardware.</P>
<H3 CLASS="h3"><A NAME="sec24"></A>Troubleshooting Network Problems</H3><P CLASS="t">SMS allows remote control over a variety of networking configurations using Microsoft's NetBIOS-capable protocols (NetBEUI, Microsoft TCP/IP-32, and NWLINK), and using sockets with NetWare's IPX (NETX and VLM) protocols. SMS 1.2 supports remote control using IP sockets for the Windows operating systems.</P>
<P CLASS="t">For SMS 1.2, in the <B>Client</B> section of the <B>Site Properties</B> dialog box, the <B>Options</B> section contains three choices: <B>NetBIOS LANA</B>, <B>Windows</B> <B>Sockets over TCP/IP</B>, or <B>IPX</B>. These options are not just for Windows NT. They take effect for all of the Windows operating system family. Selecting one of these options causes the corresponding entry to be written to all the SMS.INI files on your site: NetBIOS, IP (for sockets), or IPX. </P>
<P CLASS="t"><B>Note   </B>For NetWare clients, if you select <B>Windows</B> <B>Sockets over TCP/IP</B> and the remote protocol specified in the SMS.INI file is not present on the client, SMS tries to bind to the next available protocol on the client. Thus it finds NetWare's IPX, and binds to it automatically.</P>
<P CLASS="t">In order for the remote control session to be established, the network must be functioning properly. As appropriate, protocols must be initialized, and name resolution, packet sequencing, session establishment, messaging, routing, and bandwidth availability must all be working properly.</P>
<P CLASS="t">Common network-related problems include the following:</P>
<SPAN CLASS="list"><UL><LI CLASS="ULI1">Unsupported or corrupted network client </LI><LI CLASS="ULI1">Protocol configuration or binding order problems</LI><LI CLASS="ULI1">Wrong LANA number configured</LI><LI CLASS="ULI1">NetBIOS name resolution problems</LI><LI CLASS="ULI1">Insufficient routing configurations</LI><LI CLASS="ULI1">Insufficient bandwidth</LI><LI CLASS="ULI1">Insufficient NetHeapSize on the client</LI></UL></SPAN><P CLASS="t">There are also special considerations for remote control over RAS. These issues are discussed in the following sections. </P>
<H4 CLASS="h4"><A NAME="sec25"></A>The Network Client Is Unsupported/Corrupted</H4><H5 CLASS="h5"><A NAME="sec26"></A>Symptoms:</H5><SPAN CLASS="list"><UL><LI CLASS="ULI1">The message "Unable to locate <I>clientname</I>" appears after "Trying Additional Protocols." (This message can indicate other problems, as well.) </LI><LI CLASS="ULI1">The message "Unable to initialize...." may appear on the client when the computer is restarted.</LI></UL></SPAN><H5 CLASS="h5"><A NAME="sec27"></A>Troubleshooting:</H5><SPAN CLASS="list"><UL><LI CLASS="ULI1">Check your network client against the list of supported clients in the SMS documentation and release notes. </LI><LI CLASS="ULI1">If the client's network operating system is unsupported, upgrade to a supported client. This includes upgrading to the latest Windows for Workgroups redirector, and the Microsoft TCP/IP-32 stack (both found on your Windows&nbsp;NT Server CD-ROM).</LI><LI CLASS="ULI1">If you have any third-party network client software or protocol stacks, remove them. Then add them back in, one at a time, until the offending stack is identified. If you must run the third-party stack, try a different load order, or try using a different protocol for remote control (for example, Windows Sockets over TCP/IP with SMS 1.2).</LI><LI CLASS="ULI1">Occasionally, a network client can become corrupted, particularly when using specially configured "images" or "clones" that are stored on the network for administrative installations. Try a fresh installation from the manufacturer's <I>original</I> source media.</LI></UL></SPAN><H4 CLASS="h4"><A NAME="sec28"></A>Protocol Configuration or Binding Order Problems</H4><H5 CLASS="h5"><A NAME="sec29"></A>Symptoms:</H5><SPAN CLASS="list"><UL><LI CLASS="ULI1">The message "Unable to locate <I>clientname</I>" appears after "Trying Additional Protocols." (This message can indicate other problems, as well.) </LI><LI CLASS="ULI1">The message "Unable to initialize <I>protocol</I>" may appear during the boot process on the client.</LI><LI CLASS="ULI1">The message "NetBIOS is not loaded on this workstation...." may appear during the boot process on the client.</LI></UL></SPAN><H5 CLASS="h5"><A NAME="sec30"></A>Troubleshooting:</H5><SPAN CLASS="list"><UL><LI CLASS="ULI1">The message "Unable to initialize...." on client boot can occur if unsupported protocol stacks are present. In this case, completely remove the unsupported protocols from the client (don't just remark them in the AUTOEXEC.BAT file). You can verify which protocol is in use by selecting the Remote Control Agent icon while it is minimized. You can also check the Default Protocol in the [Sight] section of the SMS.INI file.</LI><LI CLASS="ULI1">If you receive the message "NetBIOS is not loaded...," verify that the SMS client has been installed properly. In particular, check to see which operating system SMS detects for the client. You can check this by looking at the OS entry in the [SMS] section of the SMS.INI file. (1=MS-DOS, 2=16-bit Windows, 3=OS/2, 4=Windows NT, 5=Windows 95.)
<P CLASS="lt1">If the operating system on the client is Windows, but SMS has an OS entry indicating that it is an MS-DOS–based client, the Windows directory may be too far down in the path in your AUTOEXEC.BAT file. (This problem only occurs when running versions of SMS earlier than 1.2.) Move the Windows directory to the beginning of the path, and reinstall the SMS client. See Microsoft Knowledge Base article Q138829, "SMS Incorrectly Identifies Windows Clients as MS-DOS Clients," for more information on this problem.</P></LI><LI CLASS="ULI1">Problems with IPX and NWLINK

<UL><LI CLASS="ULI2">If Windows for Workgroups is configured to use both the NetWare shell and the NWLINK protocol, NWLINK grabs the IPX packets, but does not pass them on to WUSER.EXE or WUSER32.EXE. The solution is to remove NWLINK from the client. For more information, see Microsoft Knowledge Base article Q128145, "Cannot Remote Control Windows IPX/NetBIOS Client." </LI><LI CLASS="ULI2">If a Windows 95–based client receives the message "IPX is not loaded for this workstation. Would you like to load the drivers for Win95?" use the <B>cliopts </B>utility to configure USERIPX as described in Chapter 10, "Remote Troubleshooting," of the SMS 1.2 Administrator's Guide.</LI><LI CLASS="ULI2">If you receive the message "Unable to initialize IPX protocol" on a client running Windows 95, see Microsoft Knowledge Base article Q154411, "SMS Err Msg: Unable to Initialize IPX Protocol." For Windows clients, be sure to remove any unsupported protocol stacks completely; don't just remark them.</LI></UL></LI><LI CLASS="ULI1">Problems with NetBIOS over TCP/IP

<UL><LI CLASS="ULI2">Remote control is not supported on any third-party TCP/IP stack. Always update clients running Windows for Workgroups or Windows&nbsp;95 to the latest redirector and Microsoft TCP/IP-32 (found on the Windows NT Server CD-ROM).</LI><LI CLASS="ULI2">Typing <B>nbtstat -n </B>in a command window is a quick way to verify that the TCP/IP stack is properly bound and that the Remote Control Agent is running. If everything is working properly, <B>nbtstat -n </B>should return a &lt;43&gt; extension next to the computer name. If the &lt;43&gt; service does not show up, and no TSRs are conflicting, check for a dial-up adapter configured for TCP/IP, and remove the binding for TCP/IP to the adapter. </LI></UL></LI></UL></SPAN><H4 CLASS="h4"><A NAME="sec31"></A>Wrong LANA Number Configured</H4><P CLASS="t">NetBIOS is an interface between an application and a protocol. It consists of a set of function calls. NetBIOS network applications such as the SMS remote control program set up logical network sessions between two computers by riding on top of a transport protocol that supports NetBIOS (NetBEUI, TCP/IP, NWLink). Each NetBIOS-capable protocol binding can support one NetBIOS session at a time. If five pairs of NetBIOS network applications were communicating at a time, each would establish its own logical network session. Each computer running the network applications would need five distinct bindings of any protocols that support NetBIOS. </P>
<P CLASS="t">In order for a network application to know on which logical network session to send and receive its function calls, each is assigned a LAN Adapter number (LANA number). The two network applications sharing a NetBIOS logical network session must be configured to send and receive on the same LANA number. If they are not configured to the same LANA number, you will get the "Trying additional protocols" message. Each binding is then tried in turn, and when the proper binding is tried, the client will be located. Setting LANA numbers is usually necessary only to speed up the location process. </P>
<H5 CLASS="h5"><A NAME="sec32"></A>Symptom:</H5><P CLASS="t">The "Trying Additional Protocols" message appears. The client will probably be located, but you should avoid this message and delay.</P>
<H5 CLASS="h5"><A NAME="sec33"></A>Troubleshooting:</H5><P CLASS="t">The following is an example of how to set the LANA number for both the client and the server using NetBIOS over TCP/IP.</P>
<P CLASS="ls">Double-click the server's NetBIOS interface by activating the Network icon in the Control Panel, and set NetBT to LANA 0. (If another protocol is on LANA 0, set it to the LANA number NetBT had.)</P>
<P CLASS="ls">For Windows for Workgroups–based clients, check the [NBT] section in SYSTEM.INI, and make sure LANABASE=0.</P>
<P CLASS="ls">For Windows 95–based clients, set TCP/IP as the default protocol.</P>
<P CLASS="ls">For MS-DOS 3.0–based clients, check the [NETWORK.SETUP] section in PROTOCOL.INI, and make sure LANABASE=0. </P>
<P CLASS="ls">For LAN Manager 2.2c–based clients, check the [TCPIP_XIF] section in PROTOCOL.INI, and make sure LANABASE=0. </P>
<P CLASS="t">See the "Remote Troubleshooting" Chapter of the SMS <I>Administrator's Guide </I>for more information on configuring the LANA number.</P>
<H4 CLASS="h4"><A NAME="sec34"></A>NetBIOS Name Resolution Problems</H4><P CLASS="t">The NetBIOS application program interface permits the use of computer names, rather than alphanumeric computer addresses, to identify computers on a network. TCP/IP internetworks require a name resolution service to convert computer names to IP addresses and IP addresses to computer names. If the name resolution is not working properly, remote control may be unable to function.</P>
<H5 CLASS="h5"><A NAME="sec35"></A>Symptoms:</H5><SPAN CLASS="list"><UL><LI CLASS="ULI1">Remote control works locally, but not across a router.</LI><LI CLASS="ULI1">Remote control may work only for those computers that share a primary WINS server with the computer running SMSAdmin.</LI><LI CLASS="ULI1">You can ping the IP address, but not the NetBIOS name.</LI><LI CLASS="ULI1">A captured Network Monitor trace shows that the "<I>CLIENTNAME</I> C" name query is failing.</LI></UL></SPAN><H5 CLASS="h5"><A NAME="sec36"></A>Troubleshooting:</H5><SPAN CLASS="list"><UL><LI CLASS="ULI1">Name resolution and routers

<UL><LI CLASS="ULI2">Verify that UDP Ports 137 and 139 are enabled by trying a <B>net use</B> from the server to the client, or to other clients on the same segment. </LI><LI CLASS="ULI2">Verify that UDP Port 138 is enabled by trying a <B>net send</B> from the server to the client, or to other clients on the same segment.</LI><LI CLASS="ULI2">For NWLINK networks, verify that the router is configured to pass type 20 packets for NWLINK NetBIOS support. If not, reconfigure the router to pass these packets.</LI></UL></LI><LI CLASS="ULI1">Name resolution and WINS
<P CLASS="ls2">From a command window at a server, type <B>nbtstat -a </B><I>clientname</I>, then look for the <I>clientname</I> &lt;43&gt; entry, which is the WINS registration of the remote control agent's extension.</P>

<P CLASS="ls2">If no &lt;43&gt; service registration appears at the server, type <B>nbtstat -n </B>on the client itself and check for the &lt;43&gt; service. </P>

<P CLASS="ls2">If the &lt;43&gt; service is present on the client, but cannot be seen from the server when you type <B>nbtstat -a </B><I>clientname</I>, either look for problems with WINS or make sure that UDP Ports 137, 138, and 139 are not disabled on your routers. Check all relevant WINS databases for the &lt;43&gt; service by <I>clientname</I>. This is especially pertinent if WINS database replication is configured. See Microsoft Knowledge Base article Q155744, "SMS: WINS Replication Causes Remote Control Delay," for more information. This problem has been fixed in SMS 1.2, Service Pack 2.</P>

<P CLASS="ls2">If the &lt;43&gt; service is not present on the client, there is a configuration problem on the client. Check for a modem on the client and, if present, disable the NBT binding on the modem. </P>

<P CLASS="ls2">Try reinstalling TCP/IP. For Windows for Workgroups–based clients, use the updated redirector and the Microsoft TCP/IP-32 3.11b stack. Check also for third-party TSRs and protocol stacks and, if found, remove them and try again.</P>

<P CLASS="ls2">If the computer running SMS Admin and the client computer have different primary WINS servers, make sure WINS replication is not the cause of the problem. Check for the <I>clientname</I> &lt;43&gt; entry in<I> </I>both WINS databases. See Microsoft Knowledge Base article Q155744, "SMS: WINS Replication Causes Remote Control Delay," for more information.</P></LI><LI CLASS="ULI1">Name resolution and LMHOSTS
<P CLASS="ls2">Verify that the LMHOSTS file is configured properly. For information on configuring the LMHOSTS file see "Configuring Remote Support Across a Router" in Chapter 10, "Remote Troubleshooting," of the SMS 1.2 <I>Administrator's Guide</I>.</P>

<P CLASS="lt1"><B>Note   </B>Only the server's LMHOSTS file needs to be configured with the remote extensions. </P>

<P CLASS="ls2">Verify that the IP address is correct.</P>

<P CLASS="ls2">Verify that the computer name is spelled correctly, and that <B>C</B> is in the 16th position.</P>

<P CLASS="ls2">Verify that there are no multiple entries for "<I>CLIENTNAME</I> C."</P>

<P CLASS="ls2">If another copy of the LMHOSTS file is on another working server, rename the local copy, and copy the file to the server that is not working. Type <B>nbstat -R</B> to reload the cache.</P>

<P CLASS="ls2">Try creating a new LMHOSTS file, and type <B>nbtstat -R</B> to reload the cache.</P>

<P CLASS="ls2">Make sure there is a blank line on the last entry of the LMHOSTS file.</P></LI></UL></SPAN><H4 CLASS="h4"><A NAME="sec37"></A>Insufficient Routing Configurations</H4><P CLASS="t">For all networking configurations, routers must be functioning properly to support remote control. If your routers are dropping packets or corrupting the data portion of the packets, you may see symptoms like dropped sessions or general protection faults on the clients during a remote-control session. Limit remote control sessions to three hops. Because remote control occurs in real time, too many hops can seriously impair performance. </P>
<P CLASS="t">For remote control to function properly, certain ports must be enabled on the routers. </P>
<P CLASS="t"><B>Note   </B>Enabling a port on a router is not necessarily the same thing as bridging a protocol. For example, for NetBIOS over TCP/IP name resolution to work, routers must have UDP Port 137 enabled. Thus any packet specifically sent to this port will be forwarded. Only name queries, such as requests for name resolution to WINS servers, are sent to this port. NetBEUI is not being bridged.</P>
<P CLASS="t">To use NetBIOS over TCP/IP, UDP Ports 137, 138, and 139 must be enabled. Port 137 is for name resolution, Port 138 is for messaging (sending the screen image), and Port 139 is for sessions.</P>
<P CLASS="t">To use NetBIOS over NWLINK, Type 20 packets must be forwarded. Type 20 packets are the packets that provide NetBIOS support, and forwarding these can cause more traffic than is desired in some environments.</P>
<P CLASS="t">For TCP/IP sockets and IPX, no special configuration is required.</P>
<H5 CLASS="h5"><A NAME="sec38"></A>Symptom:</H5><P CLASS="t">Clients can be located on the local segment, but not across the router.</P>
<H5 CLASS="h5"><A NAME="sec39"></A>Troubleshooting:</H5><SPAN CLASS="list"><UL><LI CLASS="ULI1">Verify that UDP Ports 137 and 139 are enabled: Enable only the TCP/IP bindings to the network card and then try a <B>net use </B>from the server to the client, or to other clients on the remote segment. </LI><LI CLASS="ULI1">Verify that UDP Port 138 is enabled: Make sure that Winpopup is enabled on the client, and that only TCP/IP bindings are enabled. Then try a <B>net send </B>from the server to the client, or to other clients on the same segment. </LI><LI CLASS="ULI1">Check the number of hops on a TCP/IP network by using the TRACERT command. (TRACERT is installed when the TCP/IP protocol is installed on the client computer.) </LI><LI CLASS="ULI1">Verify that Type 20 packets are being forwarded: With only the NWLINK protocol bindings enabled, try a <B>net use </B>to a computer across the router.</LI><LI CLASS="ULI1"> In some cases, if the computer from which SMS Admin is being run is not on the same ring as the SMS Server, remote control does not work. See Microsoft Knowledge Base article Q142045, "Remote Control Fails Over IPX Token-Ring Wide Area Network," for more information.</LI><LI CLASS="ULI1">Troubleshooting dropped packets or corrupted data is beyond the scope of this Guide. Call Microsoft Product Support for technical support. </LI></UL></SPAN><H4 CLASS="h4"><A NAME="sec40"></A>Insufficient Bandwidth</H4><P CLASS="t">A minimum transfer rate of 14,400 bits per second is recommended for remote control.</P>
<H5 CLASS="h5"><A NAME="sec41"></A>Symptoms:</H5><SPAN CLASS="list"><UL><LI CLASS="ULI1">Completely inadequate bandwidth will return "Unable to locate <I>computername</I>" during times of peak usage, but will locate the client successfully during low usage.</LI><LI CLASS="ULI1">If bandwidth is marginally adequate, the remote control session may start successfully, but the screen fails to draw correctly—producing no icons, very poor redraw of program groups, and other screen problems. All other remote troubleshooting utilities may work correctly. </LI></UL></SPAN><H5 CLASS="h5"><A NAME="sec42"></A>Troubleshooting:</H5><P CLASS="t">Perform a ping test from the Diagnostics utility in SMS (not the TCP/IP command-line ping test) on both a successful computer and an unsuccessful computer. If bandwidth is a consideration, you should see a significant difference. For a rough calculation of the bandwidth on TCP/IP networks, multiply Average Packets/Second by 72 (the UDP packet size) to get the bytes per second. This result must be greater than or equal to 14,400 to meet the recommended bandwidth.</P>
<H4 CLASS="h4"><A NAME="sec43"></A>Insufficient NetHeapSize on Client Causes Dropped Sessions</H4><H5 CLASS="h5"><A NAME="sec44"></A>Symptoms:</H5><P CLASS="t">Remote control may initialize, but the session terminates unexpectedly. (This is a very rare problem.)</P>
<H5 CLASS="h5"><A NAME="sec45"></A>Troubleshooting:</H5><P CLASS="t">Session failures can occur because of network problems. Try setting the NetHeapSize value to a setting greater than 24 in the [386ENH] Section of the SYSTEM.INI file. </P>
<H4 CLASS="h4"><A NAME="sec46"></A>Special Considerations for Remote Control Over RAS</H4><H5 CLASS="h5"><A NAME="sec47"></A>Symptoms:</H5><P CLASS="t">The "Unable to locate <I>computername</I>" message only appears for RAS clients that seem to be otherwise configured correctly.</P>
<H5 CLASS="h5"><A NAME="sec48"></A>Troubleshooting:</H5><SPAN CLASS="list"><UL><LI CLASS="ULI1">SMS cannot access the remote client because the Remote Access Service is not configured to allow listens to be posted for all NetBIOS names. By default, RAS will only allow NCB.LISTENs to be posted for Server and Messenger service NetBIOS names. See Microsoft Knowledge Base article Q129603, "Using Systems Management Server Remote Control over a RAS Server," for more information.</LI><LI CLASS="ULI1">If the computer is running Windows for Workgroups and uses both via RAS and local network connections, the problem may be that the computer was added to the inventory while logged on locally. In this case, the inventory uses the adapter information rather than the RAS adapter information. Because SMS uses the inventoried address to find the computer, it does not find the computer when it is logged on via RAS. This problem has been fixed in SMS 1.2 Service Pack 2.</LI></UL></SPAN></BODY></HTML>
