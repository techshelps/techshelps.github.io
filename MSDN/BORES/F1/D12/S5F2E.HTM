<HTML><head><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Using MAPIsend</TITLE><BODY BGCOLOR="#FFFFFF">


<H3 CLASS="h2">Using MAPIsend</H3><P CLASS="t">The following steps explain how to use the Mapisend.exe program with the Windows NT AT scheduler.</P>
<P CLASS="t"><B>Note   </B>To have AT scheduler successfully run the Mapisend.exe program, you must be logged on to Windows NT as a DOMAIN\USER. Also, this user must be the account that starts the Schedule service. It too, must have access to the mailbox that Mapisend.exe logs on to.</P>
<P CLASS="proch">To run the MAPIsend tool</P>
<P CLASS="ls">Log on to Windows NT with a domain account, for example DOMAIN\USER.</P>
<P CLASS="ls">In Control Panel, double-click the <B>Services</B> icon.</P>
<P CLASS="ls">Select the<B> Schedule </B>service from the list, and then choose <B>Startup</B>.</P>
<P CLASS="ls">In the <B>Log On As</B> section, select <B>This Account</B>, and then left-click the ellipsis to display a list of domain users. </P>
<P CLASS="ls">Select <B>DOMAIN\USER</B>.</P>
<P CLASS="ls">Type the password for DOMAIN\USER in the <B>Password</B> dialog box, and then type it again in the <B>Confirm</B> <B>Password</B> field.</P>
<P CLASS="ls">In the <B>Startup Type</B> section, select <B>Automatic</B>. This starts the service automatically when the computer is restarted.</P>
<P CLASS="ls">Choose <B>OK</B>, and then close the <B>Services</B> dialog box.</P>
<P CLASS="ls">In Control Panel, double-click the <B>Mail and Fax</B> icon.</P>
<P CLASS="ls">Create a profile with the name SENDMAIL. Add the Microsoft Exchange Server service to the profile. Make sure that the Windows NT account DOMAIN\USER that was specified to start the Schedule service has permissions to open the Microsoft Exchange mailbox specified in the profile. </P>
<P CLASS="ls">In the Administrator program, assign SendAs permissions to the mailbox you selected in Step 10. Make sure that you select the correct options when you choose <B>Options</B> from the <B>Tools</B> menu, and then select the <B>Permissions</B> property page. If you have chosen the correct options, the <B>Permissions</B> property page appears for each mailbox object, along with its corresponding user rights.</P>
<H4 CLASS="h3"><A NAME="sec0"></A>Command-Line Syntax</H4><P CLASS="t">The following command can then be used with the AT scheduler or the Winat.exe program:</P>
<P CLASS="t"><B>MAPISEND.EXE -u &lt;profile name&gt; -p &lt;password&gt; -r &lt;recipients&gt; -s &lt;subject&gt;</B></P>
<P CLASS="t">Where &lt;<I>profile name</I>&gt; is the name of the SENDMAIL profile you created in step 10. The MAPIsend tool requires double quotation marks around its parameters if there are spaces in the names. </P>
<P CLASS="t"><B>Note   </B>You must also specify the profile, password of the account running the Scheduler service, and the recipient. There is no off switch that saves a copy of messages sent to the Sent Items log. Also, Mapisend.exe requires a password. The password specified with the <B>-p</B> option is only to prevent the Mapisend.exe program from failing. </P>
<P CLASS="t">For more information on the command-line switches available with Mapisend.exe, see the documentation that accompanies this tool.</P>
<H4 CLASS="h3"><A NAME="sec1"></A>How MAPIsend Works</H4><P CLASS="t">MAPIsend takes the command-line arguments you pass it and calls three basic MAPI functions: <B>Logon</B>, <B>SendMail</B>, and <B>Logoff</B>. The tool then pauses for one second and lets other MAPI threads, namely the Spooler, deliver your message before it quits. This is done so that the client does not need to be loaded to use the MAPIsend tool, and the message is delivered before MAPIsend stops.</P>
<H4 CLASS="h3"><A NAME="sec2"></A>Example</H4><P CLASS="t">In this example, a message from user RISNT01 is sent to Technicians 1, 2, and 3 with a copy to local area network (LAN) Support. The subject is "[411] Server Alert" with a message "Disk is 90% full." The two log files are attached to the end of the message.</P>
<P CLASS="t">Instead of hard-coding the subject line and message text, you can retrieve specific details from the Performance Monitor alert with the command-line arguments %0, %1, %2, and so on, to construct a meaningful MAPIsend message.</P>
<P CLASS="ls">Run the Srvany.exe tool in the Windows NT Resource Kit to set up Performance Monitor to run as a service. </P>
<P CLASS="ls">Add an alert that starts when the disk drive is more than 90 percent full. </P>
<P CLASS="ls">In the Alert Send window, run MAPIsend by typing the following in the <B>Run Program on Alert</B> box:</P>
<P CLASS="lt1"><B>MAPISEND -u RISNT01 -p -r tech1;tech2tech3 -c "LAN Support" -s "[411] ServerAlert" -m "Disk is 90% full" -f c:\temp\diruse.log;c:\temp\status.log</B></P>
<H4 CLASS="h3"><A NAME="sec3"></A>Avoiding Recipient Ambiguity Problems</H4><P CLASS="t">Recipient ambiguity problems can occur when using MAPIsend. For this reason, recipient names entered in the <B>To</B> and <B>Cc</B> boxes must not be ambiguous; otherwise, MAPIsend will fail.</P>
<P CLASS="proch">To test for ambiguity of names</P>
<P CLASS="ls">Type the recipient names in the <B>To</B> box of a Microsoft Exchange Client standard Send form. </P>
<P CLASS="ls">Choose <B>To</B>, or press CTRL+K. </P>
<P CLASS="lt1">If the names are immediately resolved without any prompting, they are not ambiguous.</P>
<P CLASS="ls">Repeat this test each time the Address Book is changed, and run the test from the computer where MAPIsend runs.</P></BODY></HTML>
