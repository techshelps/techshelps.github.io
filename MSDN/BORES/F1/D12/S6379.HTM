<HTML><head><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Recovery Procedure</TITLE><BODY BGCOLOR="#FFFFFF">


<H3 CLASS="h2">Recovery Procedure</H3><P CLASS="t">This section describes the procedure used to repair the information store. </P>
<P CLASS="t"><B>Note   </B>This example is provided for informational purposes; you should implement the procedures described <I>only </I>with the assistance of Microsoft Technical Support. You should also note that the procedure was performed strictly in a test lab prior to being implemented in production. It is strongly recommended that you pursue the same strategy and perform all repair testing in a lab environment prior to implementing this procedure in a production environment.</P>
<P CLASS="t">The information store Prov.edb file was repaired with the EDBUTIL utility. The procedure was run on an IBM 720 server with 8-GB disk capacity and mirrored drives. The Priv.edb file was 3.4 GB. </P>
<P CLASS="t"><B>Warning   </B>If you run the EDBUTIL utility, note that the edbutil /d /r command will delete messages. Therefore you should use this command only as a last resort. </P>
<P CLASS="t">The <B>EDBUTIL /D</B> command, however, does not delete messages and is used for offline defragmenting and reducing .edb file size. When running EDBUTIL with the /d (defragment) option, you will need available disk space up to one times the size of the .edb files you are running against (or a disk two times the size of the EDB). For example, if your Priv.edb file is 3.4 GB and there is no empty space in the file, you will need 3.4 GB of available space for the defragment operation. This does not include any swap file growth that can temporarily occur. If there is 4 GB of empty space in the Priv.edb file, you will need 3 GB of available space. </P>
<P CLASS="t">By default, the Tempdfrg.edb file will be used to rebuild the .edb file. When running EDBUTIL, you can use the <B>/t</B> option to redirect the Tempdfrg.edb file to a non-default location or to rename it. You cannot however, redirect this temporary file to a LAN-connected drive.</P>
<P CLASS="t">The following table provides estimated times for the backup actions that were performed, and a description of each action.</P>

<TABLE COLS="3" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="87pt" VALIGN="TOP"><COL WIDTH="61pt" VALIGN="TOP"><COL WIDTH="218pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P CLASS="th">Action</P></TD><TD VALIGN="TOP"><P CLASS="th">Time</P></TD><TD VALIGN="TOP"><P CLASS="th">Description </P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tr"></P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">Ntbackup.exe</P></TD><TD VALIGN="TOP"><P CLASS="tt">2.5 hours</P></TD><TD VALIGN="TOP"><P CLASS="tt">All Microsoft Exchange Server services were stopped. A file-based restore of Pub.edb and Priv.edb was performed from a recent production backup. The approach taken was to establish the production problem in a test environment. A server was built with the same organization and site name as in the production environment, but a different server name was used. The computer was also set up on a separate domain. This enabled a restore of an information store from a different computer (the production computer).<BR>Org=XYZ <BR>Site = NJ1<BR>Server = SERVER2</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">Ran the following ISINTEG command:<BR><B>isinteg -patch</B></P></TD><TD VALIGN="TOP"><P CLASS="tt">5 minutes</P></TD><TD VALIGN="TOP"><P CLASS="tt">After restore, the<B> isinteg -patch</B> command was used to complete an offline information store backup. The directory service and system attendant were started prior to running this command.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">Started all Microsoft Exchange Services</P></TD><TD VALIGN="TOP"><P CLASS="tt">3 minutes</P></TD><TD VALIGN="TOP"><P CLASS="tt"></P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">Ran the DS/IS consistency adjuster</P></TD><TD VALIGN="TOP"><P CLASS="tt">5 minutes</P></TD><TD VALIGN="TOP"><P CLASS="tt">The information store needed to be synchronized with the directory service on the test server because only the information store files had been restored, and not the directory.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">Associated Windows NT account to test mailbox</P></TD><TD VALIGN="TOP"><P CLASS="tt">5 minutes</P></TD><TD VALIGN="TOP"><P CLASS="tt">After the DS/IS consistency adjuster was used, a valid Windows NT ID needed to be assigned to a recovered mailbox. The Administrator program was used to associate the Windows NT account.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">Tested messaging functionality</P></TD><TD VALIGN="TOP"><P CLASS="tt">10 minutes</P></TD><TD VALIGN="TOP"><P CLASS="tt">Sent and received several messages in the Microsoft Exchange Client to test basic messaging functionality.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">Ran Windows NT Ntbackup.exe program</P></TD><TD VALIGN="TOP"><P CLASS="tt">1.5 hours</P></TD><TD VALIGN="TOP"><P CLASS="tt">Ran an online Ntbackup.exe job to test whether the production failure could be duplicated. At 1.5 hours, the information store backup failed 2.2 GB into the job, with an event ID 8010 error. This verified that testing was for a failing information store. The production problem was reproduced in a test environment with a copy of the production information store.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">Stop Microsoft Exchange Services</P></TD><TD VALIGN="TOP"><P CLASS="tt">3 minutes</P></TD><TD VALIGN="TOP"><P CLASS="tt"></P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">Ran the following EDBUTIL command<BR><B>edbutil /ispriv /d /r /n</B></P></TD><TD VALIGN="TOP"><P CLASS="tt">2 hrs 30 minutes</P></TD><TD VALIGN="TOP"><P CLASS="tt">Ran this command from the D:\Exchsrvr\Mdbdata directory to determine whether the corrupt information store could be repaired.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">Ran the following ISINTEG command:<BR> <B>Isinteg -pri -fix -verbose -l isinteg.log</B></P></TD><TD VALIGN="TOP"><P CLASS="tt">1 hr 10 min</P></TD><TD VALIGN="TOP"><P CLASS="tt">Ran this command against the Priv.edb and Pub.edb files. </P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">Start Microsoft Exchange Services</P></TD><TD VALIGN="TOP"><P CLASS="tt">~3 minutes</P></TD><TD VALIGN="TOP"><P CLASS="tt"></P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">Test Messaging</P></TD><TD VALIGN="TOP"><P CLASS="tt">~10 minutes</P></TD><TD VALIGN="TOP"><P CLASS="tt"></P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">Ran the Ntbackup.exe program again</P></TD><TD VALIGN="TOP"><P CLASS="tt">~2.5 hours</P></TD><TD VALIGN="TOP"><P CLASS="tt">Performed another online backup to determine whether the problem still remained. The online backup of the information store and directory service completed successfully.</P></TD></TR></TBODY></TABLE>
<P CLASS="spacing"><BR></P></BODY></HTML>
