<HTML><head><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Recovering Space Used by Log Files</TITLE><BODY BGCOLOR="#FFFFFF">


<H3 CLASS="h2">Recovering Space Used by Log Files</H3><P CLASS="t">Increasing log files can cause the information store or directory to run out of operating space. To prevent this, do one of the following:</P>
<SPAN CLASS="list"><UL><LI CLASS="ULI1">Write the log files to a different drive.</LI><LI CLASS="ULI1">Change the location where the information store or directory store transaction logs are written. To do so, select the server object. From the <B>File </B>menu, choose <B>Properties</B>, and then select the<B> Database Paths</B> tab. Change the path names for the information store and directory transaction logs, and then choose<B> OK</B>.</LI><LI CLASS="ULI1">Back up the Microsoft Exchange Server computer.</LI><LI CLASS="ULI1">Use Ntbackup.exe to perform a normal (full) or incremental online backup of the server. This utility automatically deletes transaction logs that are no longer needed (they have been committed to disk). If you do not run Ntbackup.exe, the log files will continue to grow.</LI><LI CLASS="ULI1">Circular logging writes log files, but after the checkpoint has been advanced, the inactive portion of the transaction logs are discarded. Typically, this represents the majority of the potential log data. The total size of the active transactions are less than the total amount of RAM on a given computer. Therefore, with circular logging enabled, the system has complete recoverability with respect to hard and soft crashes. The element that is sacrificed is the protection against media failure. These methods are not supported on servers where circular logging is enabled, because the transaction logs are used for incremental and differential backups.</LI><LI CLASS="ULI1">If possible, delete any sample applications to free additional disk space.</LI></UL></SPAN><P CLASS="t"><B>Q</B>: Why do I need to run the isinteg -patch command after running an offline information store restore and before starting the information store service?</P>
<P CLASS="lt1"><B>A:</B> To guarantee that GUIDs are unique. If a copy of the information store (Pub.edb and Priv.edb) is restored from an offline backup and <B>isinteg -patch</B> has not been run, when the service is restarted, it will fail, and a -1011 error will be generated. The -1011 error will produce an entry in the Windows NT Event Viewer Application Log with source ID 2048. The error message will read as follows:</P>
<P CLASS="lt1">The information store was restored from an offline backup. Run <B>isinteg -patch</B> before restarting the information store.</P>
<P CLASS="lt1">This error occurs because the GUIDs used by the information store that was restored are old and matching GUID may already exist. The GUID for this restored information store needs to be replaced to ensure that it is unique.</P>
<P CLASS="lt1">A command prompt error ("DS_E_COMMUNICATIONS ERROR") will also appear.</P>
<H4 CLASS="h4"><A NAME="sec0"></A>Procedure for patching the information store</H4><P CLASS="t">To replace the GUIDs used by the restored information store, you need to run <B>isinteg -patch. </B>This command enables the ISINTEG utility to run in patch mode against the entire information store (Pub.edb and Priv.edb) and generate new GUIDs. Replication information will also be patched to prevent incorrect backfilling.</P>
<P CLASS="t">To run the <B>isinteg -patch</B> command, do the following:</P>
<SPAN CLASS="list"><UL><LI CLASS="ULI1">Ensure that the directory and system attendant services are running. If these services are not running, ISINTEG will fail (with a DS_COMMUNICATIONS_ERROR message).</LI><LI CLASS="ULI1">At the command prompt, switch to the Exchsrvr\Bin directory, and then type <B>isinteg -patch</B>. </LI></UL></SPAN><P CLASS="t">The GUIDs will be replaced and the ISINTEG will report that the information store has been updated. At this point, you need to restart the information store service.</P>
<P CLASS="term1"><B>Q:</B> When restoring a server in a site, if I do not have a backup of the directory (Dir.edb) for the server, can I backfill the directory from a replica on another server in the site?</P>
<P CLASS="dt1"><B>A:</B> No. It is critical that you have a backup of the directory for each Microsoft Exchange Server computer because the directory is unique for each computer. Even if you only have the original directory backup, you can restore this backup and then backfill changes from another server in the site.</P>
<P CLASS="term1"><B>Q</B>: What is the Microsoft Exchange Server setup /r command used for?</P>
<P CLASS="dt1"><B>A:</B> The <B>setup /r</B> command enables recovery of an existing Microsoft Exchange Server computer to new hardware. Restoration of a valid database backup is also required. Run the <B>setup /r </B>command when you want to move a server installation to a different computer or if you are restoring data to a new computer. </P>
<P CLASS="dt1">The figure below shows the message that appears when you run the <B>setup /r</B> command.</P>
<P CLASS="dt1"><img src="xerk_d12.gif"></P>
<P CLASS="term1"><B>Q:</B> Is a differential backup required only when both the transaction drive and the .edb drive need to be recovered?</P>
<P CLASS="dt1"><B>A:</B> Yes. If circular logging is disabled and the transaction logs are intact, you can restore the last full backup. When the service is started, logs from the point of the full backup will be played through the current Edb.log file to bring the database up-to-date. In this case, do<I> not </I>select <B>Erase all existing data</B> during the restore, or the transaction logs will be erased and you will need to restore the differential tape. </P>
<P CLASS="term1"><B>Q:</B> Why can't I start services between restoring a full tape and a differential or incremental tape, or between sequential tapes being restored?</P>
<P CLASS="dt1"><B>A:</B> This is because at the end of a restore, Microsoft Exchange Server plays back all logs in sequential order. After this is done, the database is set to a new state. For example, if the services are started between a Monday incremental tape restore and a Tuesday incremental tape restore, a new state will be set. When you attempt to perform the Tuesday incremental restore, the restore will not be possible because the state of the database is expected to be exactly what it was at the point of the Tuesday backup. This behavior prevents overwriting new operations that have occurred on the database after services have been started.</P></BODY></HTML>
