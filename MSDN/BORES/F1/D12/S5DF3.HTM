<HTML><head><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Full Server Recovery</TITLE><BODY BGCOLOR="#FFFFFF">


<H3 CLASS="h2">Full Server Recovery</H3><P CLASS="t">You can <I>restore data</I> from one full Microsoft Exchange Server to a different computer, and you can also <I>move </I>Microsoft Exchange Server data from one computer to a new computer. This section describes how to restore data from one Microsoft Exchange Server computer to a different computer. </P>
<P CLASS="t">A full server recover is a special case because Windows NT is reinstalled and a new registry is created. In this situation, a new Windows NT security identifier (SID) must be created for the recovery computer in the domain, as outlined below. </P>
<P CLASS="t"><B>Note   </B>The information in this section is also useful for moving a Microsoft Exchange Server installation to a more powerful server for a hardware upgrade. Keep in mind that the Windows NT registry can be restored to the same physical computer. This may be useful when a hard drive is being replaced on the same computer. In this case, if you restore the Windows NT registry, the computer maintains its unique SID, so you do not need to create a new SID by using the procedures below.</P>
<P CLASS="t">In addition to performing a full restore of the Microsoft Exchange Server databases (information store/directory service), it may also be necessary to restore the Windows NT Security Accounts Manager (SAM) database. Microsoft Exchange Server automatically adds two accounts upon initial installation: the Windows NT service account and the Windows NT account that were logged on to during the initial installation of the software. Although both accounts receive special privileges during installation, to restore the Microsoft Exchange Server directory service, you only need the Windows NT account SID that was originally used during the installation. The Microsoft Exchange directory service will not be accessible unless this SID exists in the Windows NT environment. If no domain controllers of the original domain are available, you must restore the Windows&nbsp;NT primary domain controller SAM.</P>
<P CLASS="t">Following are the requirements for a full server recovery.</P>
<SPAN CLASS="list"><UL><LI CLASS="ULI1">A full backup of the information store and directory.</LI><LI CLASS="ULI1">A replacement computer with the same hardware capacity as the production server.</LI><LI CLASS="ULI1">Access to the original Windows NT SAM.</LI><LI CLASS="ULI1">Production server configuration sheet.</LI><LI CLASS="ULI1">Microsoft Exchange Server installation code.</LI><LI CLASS="ULI1">Windows NT Server and the latest Windows NT Service Pack installation code.</LI><LI CLASS="ULI1">Microsoft Exchange Production Server configuration sheet.</LI></UL></SPAN><P CLASS="t">A full server recovery is more complex than a single mailbox recovery. A <I>full server recovery</I> is defined as the ability to restore an original production Microsoft Exchange Server such that all Windows NT security and configuration information is recovered, as well as Microsoft Exchange Server configuration information and other data. A full server recovery enables users to use their current passwords to log on to their mailboxes when a recovery server is deployed.</P>
<P CLASS="t">Where a single mailbox recovery requires that only the information store be restored, a full server recovery requires that both the information store and directory service be restored. Microsoft Exchange Server relies on Windows NT security for providing access to mailbox data. Microsoft Exchange Server uses Windows NT account SID information in object properties within the Microsoft Exchange Server directory. </P>
<P CLASS="t">For a successful directory service recovery, two key conditions must be met: </P>
<SPAN CLASS="list"><UL><LI CLASS="ULI1">The directory service must be restored to a Windows NT Server computer that has the same site, organization, and server name as the production server.</LI><LI CLASS="ULI1">The recovery server must have access from the domain in which Microsoft Exchange Server was originally installed.</LI></UL></SPAN><P CLASS="t">A full-server disaster recovery involves three computers<I>. </I>Two computers will be in production; one is a non-production or non-essential computer (meaning that such a computer can be in production performing some other task, but will be available at any time for recovery). One computer is a PDC. A second computer, usually a Microsoft Exchange Server computer, is configured as a BDC. The third computer is designated as a recovery server. </P>
<P CLASS="t">The requirement for a configuration that incorporates a PDC, BDC, and recovery server is due to the way in which Microsoft Exchange Server uses the Windows&nbsp;NT SAM database to provide authentication to directory objects. A full-server restore including the information store and directory requires access to the SAM from the domain in which the Microsoft Exchange Server computer was first installed.</P>
<P CLASS="t">For example, if you have one Microsoft Exchange Server computer in a site, and this server also acts as a PDC, you can have a recovery server offline. The Microsoft Exchange information store and directory are backed up nightly. If this server fails, a backup PDC with Microsoft Exchange Server can be built from scratch and the information store can be restored. When the Microsoft Exchange Server directory is restored, it expects the security properties of all directory objects to match the Windows NT SAM for the respective accounts. </P>
<P CLASS="t"><B>Caution   </B>Because the backup computer was rebuilt as a PDC, a new Windows NT SAM is created. The restored Microsoft Exchange directory objects will not match the SAM objects, you will not be able to log on to the Microsoft Exchange Server Administrator program, and the Microsoft Exchange Server services will not be able to start. All restored data will be inaccessible if the Microsoft Exchange directory is restored in this case. Although you can restore the information store without the directory to access the data for each mailbox, this will only provide administrator access to mailbox data, and it is not considered full server recovery. The original Microsoft Exchange Server directory information will be lost from the production server.</P>
<P CLASS="t">As an example, suppose that there is a dedicated PDC, a production Microsoft Exchange Server computer that acts as a BDC, and a recovery server. The production Microsoft Exchange Server computer fails. You can build a Windows&nbsp;NT domain controller from the recovery server with the same computer name as the Microsoft Exchange Server computer that failed. </P>
<P CLASS="t">You can connect this to the domain as a BDC, which provides you with a copy of the SAM from the domain in which the production Microsoft Exchange Server computer resided. Using Server Manager, you first delete the original computer name, the BDC definition, from the PDC. Add it again during the BDC installation. </P>
<P CLASS="t">This procedure is necessary because each computer name receives a unique SID when it is added to the domain, and you will need a new SID for the recovery computer. After you have done this, install Microsoft Exchange Server using the same site and organization name. By default, the same server name will be used because Microsoft Exchange Server uses the computer name to create the Microsoft Exchange Server name. If you are recovering a server and joining an existing site during this reinstallation, see the <I>Microsoft Exchange Server Administrator's Guide</I>.</P>
<H4 CLASS="h3"><A NAME="sec0"></A>Creating a New SID for the Recovery Server </H4><P CLASS="ls">Install Microsoft Exchange Server on the new or repaired server, but do not replicate it with the existing organization.</P>
<P CLASS="ls">Give the server its original organization and site name.</P>
<P CLASS="ls">Run<B> </B>Setup. Do not join an existing site. </P>
<P CLASS="ls">Create a new site with the same organization and site name.</P>
<P CLASS="ls">After Setup is complete, upgrade the recovery server to the same Microsoft Exchange Service Pack as the production server. </P>
<P CLASS="t">Now you can restore the information store and directory from the last Microsoft Exchange Server production computer. Note that you could have added the recovery server to the production domain as a member server instead of a BDC.</P>
<H4 CLASS="h3"><A NAME="sec1"></A>Using a Backup Tape of the Information Store and Directory Service for a Server Recovery</H4><P CLASS="t">The following is an example of a server recovery using a backup tape of the production server information store and directory service. Note that a normal (full) online backup of the information store and directory was performed. During the Microsoft Exchange Server software installation, do not join the site. Instead, select <B>Create New Site</B>. This is because you have a backup copy of the Microsoft Exchange Server directory database. Even though you chosen to create a new site, when you restart the server, it will synchronize automatically with other servers in the site because the knowledge of being in a site is stored in the directory database.</P>
<H4 CLASS="h3"><A NAME="sec2"></A>Preparing the Recovery Computer</H4><P CLASS="t">When you prepare the recovery computer, note that you need to install Windows&nbsp;NT with the same computer name as the Microsoft Exchange Server computer that failed. If the production Microsoft Exchange-based server is a BDC, add the recovery server to the production domain as a BDC. As mentioned earlier, you need to first delete and then re-add the computer name on the PDC to create a new SID for the recovery computer. The recovery server should have a version of the Windows NT Service Pack installed that matches the configuration of the production server. Also, make sure that there is enough disk space for restoring the entire information store and directory from your backup tape. This computer should also be equipped with a tape drive that is compatible with the tape drives deployed on production servers. To expedite the restore process, maintain a copy of the Windows NT installation code and Service Pack on the hard drive of the recovery computer. For information on settings for protocol addresses, partitioning information, protocols, options, tuning, and other options, see your production Windows NT Server configuration data.</P>
<H4 CLASS="h3"><A NAME="sec3"></A>Creating a New Site But Not Joining the Existing Site</H4><P CLASS="t">The following process will enable you to create a new site without joining the existing site.</P>
<P CLASS="ls">Log on to Windows NT as an administrator and install Microsoft Exchange Server using the same site and organization name that was used on the server from which you are restoring the mailbox. </P>
<P CLASS="ls">Use the Setup command to install Microsoft Exchange Server. Do not type <B>Setup /R</B>. This creates a problem that you will encounter when attempting to upgrade this recovery server to the latest Microsoft Exchange Service Pack.</P>
<P CLASS="ls">When prompted, select <B>Create New Site</B>. Note that the server name of the recovery server matches that of the production computer. </P>
<P CLASS="ls">Select the same service account that you used for the production server.</P>
<P CLASS="ls">Run the Microsoft Exchange Performance Optimizer to optimize Microsoft Exchange Server for the same configuration that was used on the production server. For more information, see your production server configuration documentation.</P>
<P CLASS="ls">After Microsoft Exchange is installed, upgrade this recovery server to the same Microsoft Exchange Service Pack as the production server.</P>
<P CLASS="ls">Install Microsoft Exchange Client on the recovery server.</P>
<H4 CLASS="h3"><A NAME="sec4"></A>Performing the Restore </H4><P CLASS="t">This procedure assumes that you are using an online backup tape for the restore (the backup was performed while Microsoft Exchange Server services were running). If an offline tape is used, do not choose to start the services after the restore. </P>
<P CLASS="t">After the restore, at the command prompt, type <B>isinteg -patch</B> to run the ISINTEG tool. Make sure that the directory service is started first, and then start the information store service.</P>
<P CLASS="proch">To perform the restore</P>
<P CLASS="ls">Insert the restore tape.</P>
<P CLASS="ls">In the <B>Administrative Tools</B> group, double-click the <B>Backup</B> icon.</P>
<P CLASS="ls">Double-click the <B>Tapes</B> icon.</P>
<P CLASS="ls">Double-click <B>Full Backup Tape</B>.</P>
<P CLASS="ls">In the right pane, select the directory and information store that you want to restore.</P>
<P CLASS="ls">Choose <B>Restore</B>.</P>
<P CLASS="ls">In the <B>Restore Information</B> dialog box, select the following check boxes: <B>Erase all existing data</B>, <B>Verify After Restore</B>, and <B>Start Service After Restore</B>. </P>
<P CLASS="lt1"><B>Note   </B>If the public information store is on a separate computer, do not select the <B>Erase all existing data</B> check box. Instead, select the following check boxes: <B>Private</B>, <B>Public</B>, <B>Verify After Restore</B>, and <B>Start Services After Restore</B>. If you erase the public store inadvertently, contact Microsoft Technical Support.</P>
<P CLASS="ls">Type the name of the destination server in the <B>Destination Server</B> box.</P>
<P CLASS="ls">Choose<B> OK</B>.</P>
<P CLASS="ls">If the directory service and information store were backed up using separate backup jobs, do not start these services until both have been restored.</P>
<P CLASS="ls">When the restore prompt appears, choose <B>OK</B>. This opens the <B>Restore Status</B> dialog box.</P>
<P CLASS="ls">After the restore is completed, choose <B>OK</B>.</P>
<P CLASS="ls">Close the Backup program.</P>
<H4 CLASS="h3"><A NAME="sec5"></A>Reviewing Mailboxes for Windows NT Account Association</H4><P CLASS="t">To verify that your users' mailboxes have a Windows NT account associated with them, follow these steps.</P>
<P CLASS="ls">In the Microsoft Exchange Administrator program, select a server, and then choose <B>Recipients</B>.</P>
<P CLASS="ls">Double-click a user's name.</P>
<P CLASS="ls">Review the <B>Primary Windows NT Account</B> box to verify that the Windows&nbsp;NT account matches the mailbox.</P>
<P CLASS="t">Repeat this procedure as needed for each user.</P>
<H4 CLASS="h3"><A NAME="sec6"></A>Testing a User's Logon from a Client Workstation</H4><P CLASS="t">To test a user's logon from a Microsoft Exchange Client workstation, follow these two steps.</P>
<P CLASS="ls">Start the Microsoft Exchange Client.</P>
<P CLASS="ls">Verify that the user's password is accepted.</P>
<H4 CLASS="h3"><A NAME="sec7"></A>Authoritative Restore </H4><P CLASS="t">If directory information on the restored server changes or automatically gets purged, you may be experiencing an undesired backfill state. </P>
<P CLASS="t">When previous replicated changes from the restored server are replicating back from another server, the other server may have a change record that is more up-to-date than what is reflected in the restored database. In this case, <I>backfilling</I> has occurred.</P>
<P CLASS="t">The Authoritative Restore tool (Authrest.exe) available on the Microsoft Exchange Server compact disc enables you to force a restored directory database to replicate to other servers after restoring from a backup. For assistance on using this tool, contact Microsoft Technical Support.</P>
<P CLASS="t">Normally, a restored database is assumed to be more out-of-date than the collective information held on all other directory replicas in the organization. A restored directory normally replaces its information with more recent data held by other servers. This functionality is appropriate when the reason for the restore is that a database or server was destroyed, but it is not appropriate in all cases. For example, if an administrative error deleted thousands of mailboxes or vital configuration information, the goal of restoring from backup is not to restore one server to functionality, but to move the entire system back to where it was before the undesired changes were made. </P>
<P CLASS="t">Without the Authoritative Restore tool, you would need to restore every server in the organization from a backup that predates the error, or else you would have to restore every server in the site, and then force all bridgeheads in other sites to resynchronize from scratch. If only one server was restored, or if servers were restored one at a time, the restored server would quickly overwrite its restored data with the more recent (incorrect) information held by all other servers in the site.</P>
<P CLASS="t">The Authoritative Restore tool enables you to restore one server (presumably the server with the most recent pre-mistake backup) rather than all servers. Normal replication then causes the restored information to spread to all servers throughout the organization. </P>
<P CLASS="t">The Authrest.exe file is available from the Support\Utils\&lt;<I>platform</I>&gt; directory on the Microsoft Exchange Server compact disc.</P></BODY></HTML>
