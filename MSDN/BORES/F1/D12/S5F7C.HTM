<HTML><head><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Roving User Profile Generation Program</TITLE><BODY BGCOLOR="#FFFFFF">


<H3 CLASS="h2">Roving User Profile Generation Program</H3><P CLASS="t">The Microsoft Exchange Roving User Profile Generation Program (Profgen.exe) is a program that simplifies the creation of Microsoft Exchange profiles. It works in conjunction with the Automatic Profile Generator program (Newprof.exe) to create profiles.</P>
<H4 CLASS="h3"><A NAME="sec0"></A>Using the Roving User Profile Generation Program</H4><P CLASS="proch">To run Profgen</P>
<SPAN CLASS="list"><UL><LI CLASS="ULI1">Use the following command-line syntax:
<P CLASS="lt1"><B>Profgen.exe &lt;</B><B><I>path</I></B><B>&gt;\Newprof.exe -P &lt;</B><B><I>path</I></B><B>&gt;\Default.Prf [-S] [-X] [-L] [-U]</B></P>

<P CLASS="lt1">The following table lists the command-line options available in Profgen, and their descriptions:</P></LI></UL></SPAN><P></P>

<TABLE COLS="3" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="98pt" VALIGN="TOP"><COL WIDTH="235pt" VALIGN="TOP"><COL WIDTH="0pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P CLASS="th">Option</P></TD><TD VALIGN="TOP"><P CLASS="th">Description</P></TD></TR><TR><TD COLSPAN="3" VALIGN="TOP"><P CLASS="tr"></P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt"><B>&lt;</B><B><I>path</I></B><B>&gt;\Newprof.exe</B></P></TD><TD VALIGN="TOP"><P CLASS="tt">The name of the Newprof.exe file with the complete path.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt"><B>-P &lt;</B><B><I>path</I></B><B>&gt;\Default.prf</B></P></TD><TD VALIGN="TOP"><P CLASS="tt">The name of the .prf file to be used.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt"><B>-S</B></P></TD><TD VALIGN="TOP"><P CLASS="tt">Displays Newprof.exe with the <B>-S</B> option.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt"><B>-X</B></P></TD><TD VALIGN="TOP"><P CLASS="tt">Displays Newprof.exe with the <B>-X </B>option.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt"><B>-L</B></P></TD><TD VALIGN="TOP"><P CLASS="tt">Creates a log file (C:\Profgen.log).</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt"><B>-U</B></P></TD><TD VALIGN="TOP"><P CLASS="tt">Updates the MailboxName= entry in the .prf file specified with the -P option, even if it already contains a value. By default, if the entry contains a value, it will not be updated and that value will be used.</P></TD></TR></TBODY></TABLE>
<P CLASS="spacing"><BR></P><P CLASS="t">Profgen.exe performs the following tasks:</P>
<P CLASS="ls">Verifies whether the .prf file specified with the<B> -P</B> option is present. If it is not present, the program stops.</P>
<P CLASS="ls">If the .prf file is present and accessible, the program obtains the currently logged-on Windows NT domain logon ID.</P>
<P CLASS="ls">It then modifies the MailboxName= entry in the [Service2] section of the .prf file specified with the <B>-P</B> command-line option, by adding the currently logged-on user ID as the value of the MailboxName= entry.</P>
<P CLASS="ls">If the<B> -U</B> option is not used, and the MailboxName= entry already contains a value, then the MailboxName= entry will not be modified with the current logon ID.</P>
<P CLASS="ls">The modified .prf file is then copied to a temp file called C:\Profgen.tmp.</P>
<P CLASS="ls">The program uses the following command: </P>
<P CLASS="lt1">&lt;<I>path</I>&gt;Newprof.exe -P C:\Profgen.tmp [-S] [-X].</P>
<P CLASS="lt1"><B>Note   </B>The <B>-S</B> and<B> -X</B> options are only added to the command line for Newprof.exe if they were specified on the Profgen.exe command line or in the Profgen.ini file. The Profgen.ini file is described below.</P>
<H5 CLASS="h4"><A NAME="sec1"></A>Setting up roving users across platforms</H5><P CLASS="t">You can enable Microsoft Exchange users to work from any computer and access their mailbox, regardless of their operating system (be it Windows NT, Windows&nbsp;95, or Windows 3.<I>x</I>). You should not have to create a Microsoft Exchange profile on any of the computers used to access a Microsoft Exchange mailbox.</P>
<P CLASS="proch">To set up roving users</P>
<P CLASS="ls">Set up the operating system to allow for roving users.</P>
<SPAN CLASS="list"><UL><LI CLASS="ULI2">For Windows NT, create a User Profile for each user, by using User Manager for Domains.</LI><LI CLASS="ULI2">For Windows 95, you must enable <B>User Profiles</B> on each computer.  From Control Panel, choose <B>Passwords</B>,<B> </B>then <B>User Profiles</B>.</LI><LI CLASS="ULI2">For Windows 3.<I>x</I>, add the ProfileDirectory16= line to the [MAPI] section of the Win.ini file.</LI></UL></SPAN><P CLASS="ls">Assign Windows NT Domain logon scripts for each domain user.</P>
<P CLASS="ls">For each user, create a home directory using User Manager for Domains, or the logon script.</P>
<P CLASS="ls">Copy three .prf files in each user's home directory: one for each platform (WinNT, Win95 and Win16). For example, Win95.prf, Winnt.prf, and Win16.prf.</P>
<H5 CLASS="h4"><A NAME="sec2"></A>Creating a .prf file</H5><P CLASS="t">To create a .prf file, run the Microsoft Exchange Setup Editor from any client installation point. Make sure that the Home Server field is entered on the <B>Home Server</B> tab of the <B>User Options</B> property page. This creates a file called Default.prf in the client installation directory. This file can be copied to Win95.prf, Winnt.prf and Win16.prf. These .prf files can be identical, and must contain all the information to be added to the user profile, except the MailboxName field. This is automatically entered by the Profgen.exe program.</P>
<P CLASS="t">You can move computers on different platforms, and the profile will be automatically created for the user, without any user intervention. The profile will be created the first time the user logs on, regardless of the platform. The profile should be saved in the user's home directory so that it is available the next time the user logs on to a computer with the same operating system.Note that you cannot set up roving users with the MS–DOS client. Microsoft Exchange user profiles for this environment must be manually created.</P>
<H4 CLASS="h3"><A NAME="sec3"></A>Roving Users with Windows NT Mandatory Profiles</H4><P CLASS="t">With Mandatory Profiles, no changes to the Windows NT user profile are saved. Each time a user logs on, the default Windows NT profile overwrites the local Windows NT profile. The Microsoft Exchange profiles created during one Windows NT logon session are available the next time the user logs on. This problem can be resolved by using Profgen.exe to automatically recreate the user's Microsoft Exchange profile each time he or she logs on to the Windows NT Domain.</P>
<H5 CLASS="h4"><A NAME="sec4"></A>Creating roving users with Mandatory Profiles</H5><P CLASS="proch">To set up roving users with a mandatory profile</P>
<P CLASS="ls">Modify the Windows NT logon script to copy a .prf file into the user's home directory.</P>
<P CLASS="ls">Copy \\&lt;Server Name&gt;\&lt;Share&gt;\Default.prf H:\Winnt.prf</P>
<P CLASS="lt1">where H:\ is the user's home directory.</P>
<P CLASS="lt1">The program renames the .prf specified. The renamed file has the same name as the original .prf file specified, except that the last character of the file name is changed to ~. This prevents the program from trying to recreate a profile the next time it is run with the same command-line options.</P>
<P CLASS="lt1"><B>Note   </B>Automatic creation of profiles for roving users with Profgen.exe works only if the user's Microsoft Exchange mailbox has the same name as his or her Windows NT Domain logon ID.</P>
<H4 CLASS="h3"><A NAME="sec5"></A>Using Profgen.ini</H4><P CLASS="t">If no command-line options are specified, Profgen.exe searches for a file called Profgen.ini and reads data from that file. Following are the .ini settings for this file:</P>
<SPAN CLASS="list"><UL><LI CLASS="ULI1"><B> [NEWPROF]</B> — Provides the path to the Newprof.exe file. The entry should read:
<P CLASS="lt1">PathToExeFile=c:\exchange\win95\newprof.exe </P>

<P CLASS="lt1">You need to provide the path to the .prf file to be used to create the profile. If this entry is empty, the program searches for the Default.prf file in the Windows directory: </P>

<P CLASS="lt1">PathToPRFFile= c:\default.prf</P>

<P CLASS="lt1">If a file is specified, and this file does not exist, the program will stop and no profile will be created. </P></LI><LI CLASS="ULI1"><B> [PROFGEN]</B> — If this entry is set to 1, a log called Profgen.log is created in drive C.</LI><LI CLASS="ULI1"><B>Logging=1</B> — If this entry is set to 1, the program will not update the MailboxName= entry in the .prf file with the current Windows NT logon ID. This entry will work only if the MailboxName= entry in the .prf file is not missing or blank.</LI><LI CLASS="ULI1"><B>UpdateMailboxName=1</B> — If this entry is set to 1, the mailbox name is updated.</LI></UL></SPAN><H4 CLASS="h3"><A NAME="sec6"></A>Preventing Roving Users from Creating Local .Pst Files</H4><P CLASS="t">To prevent users from being able to create personal folders, you can install the client on the computer without the Personal Folders service. Without this service, users will not be able to add personal folders to their Microsoft Exchange profile.</P>
<P CLASS="proch">To install the client without the Personal Folders service</P>
<P CLASS="ls">Run the Microsoft Exchange Setup Editor against a client installation share point.</P>
<P CLASS="ls">From the <B>File</B> menu, choose <B>Select Client Installation Point</B>.</P>
<P CLASS="ls">Select the <B>Services </B>tab.</P>
<P CLASS="ls">Select the <B>Personal Folders</B> service from the <B>To be installed on the client</B> list, and then choose <B>Remove</B>.</P>
<P CLASS="ls">Choose <B>OK </B>to quit the program.</P>
<P CLASS="ls">Run the client Setup.exe program from the modified installation share point. The client installed will not have the Personal Folders service available.</P>
<P CLASS="t">Note that the above steps will work only if the client has never been installed on the computer in question. If the client was previously installed on the computer with the Personal Folders service, that service will be available even if the client was removed by selecting the <B>Remove All</B> option of the client setup program.</P>
<P CLASS="t">This is because the Personal Folders service is added to the Mapisvc.inf file in the Windows\System subdirectory. Even if the client is removed from the computer, the entry in the Mapisvc.inf file is not removed. Reinstalling the client with a different set of services only adds the new services to the Mapisvc.inf file; it does not remove any services from the .inf file. This is by design. With Windows 95, the Inbox client has many services that are not available with the Microsoft Exchange Server product. This includes the Internet Mail service, the Microsoft Network service and the Fax service. To prevent these services from being lost when upgrading to the full retail Microsoft Exchange Client, the client setup does not remove any services from the local computer.</P>
<P CLASS="t">The workaround to this problem is to manually edit the Mapisvc.inf file.</P>
<P CLASS="proch">To manually edit Mapisvc.inf</P>
<SPAN CLASS="list"><UL><LI CLASS="ULI1">Remove the following line from the [Services] section of the file:
<P CLASS="lt1">MSPST MS=Personal Folders</P>

<P CLASS="lt1">Now when users choose <B>Tools</B>, <B>Services</B>, <B>Add </B>from the Microsoft Exchange Client, the Personal Folders service will not be available.</P></LI></UL></SPAN></BODY></HTML>
