<HTML><head><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Disaster Recovery Frequently Asked Questions (FAQs)</TITLE><BODY BGCOLOR="#FFFFFF">


<H2 CLASS="h1">Disaster Recovery Frequently Asked Questions (FAQs)</H2><P CLASS="t">This section provides answers to frequently asked questions regarding disaster recovery and Microsoft Exchange Server.</P>
<P CLASS="term1"><B>Q:</B> If I have a good backup of the directory and information store and I am restoring a server to an existing site by reinstalling Microsoft Exchange Server, should I create a new site or join an existing site during the Microsoft Exchange Server installation?</P>
<P CLASS="dt1"><B>A:</B> Create a new site. Do not select <B>Join Existing Site</B>. If you attempt to join the existing site, an error will occur because other servers in the site already have knowledge of the server you are restoring. When the server is restarted after the restoration of the databases, the restored server automatically synchronizes with existing servers in the site, even though you selected <B>Create a New Site</B> during the server installation.</P>
<P CLASS="term1"><B>Q:</B> If I want to keep a spare server online for performing single mailbox restores, should I select <B>Join Existing Site</B> or <B>Create a New Site</B> during the installation of Microsoft Exchange Server?</P>
<P CLASS="dt1"><B>A:</B> Do not select <B>Join Existing Site</B>. When maintaining a single mailbox restore server, you must configure the server with the same organization and site name as the site from which you plan to recover single mailbox data. However, it is important to repeat that you should not select<B> Join Existing Site</B> during the installation. Select <B>Create a New Site</B>. Also, use a unique computer name when installing Microsoft Windows NT. If you inadvertently join a site and then complete the single mailbox restore procedures as outlined earlier, undesired replication behavior will result after you run the DS/IS consistency adjuster because you will have two sets of mailbox data for the same users within the site after restoring a Priv.edb.</P>
<P CLASS="term1"><B>Q:</B> I have some users that use .pst files and remain logged on at night. How can I back up their .pst files?</P>
<P CLASS="dt1"><B>A:</B> The client will automatically disconnect from the .pst file after 30 minutes of inactivity. Upon activity, the client will automatically reconnect to the .pst. Because of this feature, you can back up .pst files during periods of inactivity (usually at night) while the client is logged on to Microsoft Exchange Server.</P>
<P CLASS="term1"><B>Q:</B> I know that I need to run<B> isinteg -patch</B> after restoring an offline information store backup to patch the globally unique identifiers (GUIDs), but what is a GUID?</P>
<P CLASS="dt1"><B>A:</B> A GUID is a 64-bit hexadecimal string. It uniquely tags an object in time and space. Within the information store, the private and public information stores have base GUIDs that they use to generate GUIDs for all other objects in the stores, including folders, messages, attachments, and so on. The patch that the ISINTEG tool performs changes the base GUIDs in the information store. The reason the patch must be run is because when you restore an information store, you are essentially rolling back time on that server. If you roll back the server and don't change the base GUID, new objects created in that information store could have GUIDs that are identical to other existing objects in the organization. This would cause problems in referencing objects, because they could no longer be uniquely identified. If you only have one server in your organization, this is not a problem, because when you restore, there are no other objects in the organization that have IDs that might be generated again for new objects.</P>
<P CLASS="term1"><B>Q:</B> What is the tradeoff regarding location of log files? I have computers with a total of five disk drives. The first two drives are mirrored and the other three are set up in a RAID 5 stripe set? Should I not mirror the operating system and use one of those drives to dedicate for transaction log files to gain performance?</P>
<P CLASS="dt1"><B>A:</B> In Microsoft Exchange Server, the best performance is gained through dedicating a physical drive for transaction log files. This is because transaction log files are written to sequentially and on a dedicated drive, the disk read/write head will not have to contend with other processes. However, it may not be worth sacrificing operating system drive redundancy by not using a mirror set for the first two drives. In this case, it is best to maintain the Windows NT swap file and the Microsoft Exchange database files on the three-disk stripe set (RAID 5) and to maintain the transaction log files on the mirror set. With enough RAM in the system, there should be little disk head contention on the operating system drives and transaction log performance should be high. </P>
<P CLASS="term1"><B>Q:</B> How important is transaction log file redundancy?</P>
<P CLASS="dt1"><B>A:</B> In general, transactions are committed to the databases quickly. However, on a very busy system, transactions written to log files can accumulate before being committed to the database files. If the transaction log drive crashes before transactions are written, this data will be lost.</P>
<P CLASS="term1"><B>Q:</B> How can I shut down Microsoft Exchange Services without using Control Panel? Sometimes these services take a long time to shut down.</P>
<P CLASS="dt1"><B>A:</B> You can issue commands from the command line to shut down services or you can follow the batch file example shown below. If you want to shut down the entire system from a batch file, use the shutdown command, which is available on the Windows NT Resource Kit compact disc. The purpose of this command is to shut down services in reverse dependency order. To shut down an MTA service that includes spaces in the name, use quotation marks.</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;REM // stop all services</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;echo Stopping Services...</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;net stop MSExchangeMSMI</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;net stop MSExchangePCMTA</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;net stop MSExchangeFB</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;net stop MSExchangeDX</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;net stop MSExchangeIMC</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;net stop MSExchangeMTA</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;net stop MSExchangeIS</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;net stop MSExchangeDS</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;net stop MSExchangeSA</P>
<p>&nbsp;&nbsp;&nbsp;&nbsp;REM - call the shutdown command here. (Remember, this command requires that you have the Windows NT Resource Kit compact disc.)</P>
<P CLASS="term1"><B>Q:</B> My tape drive is dead, but I need to back up the databases. How can I do this?</P>
<P CLASS="dt1"><B>A:</B> If you have enough disk space, shut down services and copy the Priv.edb and Pub.edb files from the Exchsrvr\Mdbdata directory (the default installation point). Also copy the Dir.edb file from Exchsrvr\Dsadata (the default installation point). You do not need to copy the transaction log files, because when services are shut down normally, all transactions are resolved. If you need to restore from this backup method, remove the log files and Edb.chk from their respective directories, copy the .edb files back in, and follow the procedure for running <B>isinteg -patch</B>. When the services start up, a new Edb.chk file is created, along with new transaction log files. Make sure to back up any files before you purge them. If you need additional assistance with these procedures, it is recommended that you contact Microsoft Technical Support.</P>
<P CLASS="term1"><B>Q:</B> How long does it take to defragment a database using the EDBUTIL utility?</P>
<P CLASS="dt1"><B>A:</B> The databases are defragmented automatically as a background process, so unless the file size of the databases needs to be reduced, you should not have to run offline compaction (defrag with file size reduction).</P>
<P CLASS="term1"><B>Q:</B> Do I need a backup of the directory database to recover a server?</P>
<P CLASS="dt1"><B>A:</B> You need at least one backup of the directory service for each computer. Regardless of how old the backup is, the directory service will rebuild itself on that computer and become current from the other directory services in the site after the restore. After you have installed a new server in a site and it is replicated and current, the best thing to do is to make a backup of the directory service. </P>
<P CLASS="dt1">After a restore, run a DS/IS consistency check after the directory service has came back in sync. This ensures that all objects in the information store on that computer are restored back into the directory service. If you don't have a backup of the directory service for a server to restore from, your only option is to delete the server from the site and then reinstall it. This option is not advisable because you lose all your information store data.</P>
<P CLASS="dt1">Instead, make a backup of the directory service as soon as possible after installing a new server, and then lock the backup in a safe place. Replace the backup with more up-to-date backups on a regular basis. This way, you don't have to wait long for the directory service to come back into sync after a restore.</P>
<P CLASS="term1"><B>Q:</B> Why do I need to back up the system following the migration of users to the server? Also, why do I need to back up the system after running an offline EDBUTIL operation?</P>
<P CLASS="dt1"><B>A:</B> If a server crashes after a migration and you have not backed up the system data, you must perform the migration again. This can be time-consuming. After you run an offline EDBUTIL operation, the database is in a new state. If your system experiences a crash, you must perform the operation again. This can also be time-consuming.</P>
<P CLASS="term1"><B>Q:</B> When I shut down services, they keep trying to restart. Why does this happen and what can I do?</P>
<P CLASS="dt1"><B>A:</B> This problem is most likely caused by a server monitor session configured for the server in which you are trying to shut down services. By running the Administrator program <B>admin/t</B> (maintenance mode) command at least one polling interval before stopping services, you ensure that the server monitor is notified that subsequent polls of the server in maintenance mode will not result in alerts or alarms. After running this command, you can stop services and perform maintenance. When the maintenance is completed, rerun <B>admin /t</B> to re-enable monitoring. For command-line Help on Administrator program command-line switches, switch to the Exchsrvr\Bin directory and type <B>admin /?</B>.</P>
<P CLASS="term1"><B>Q:</B> What backup strategies and solutions are being created by third parties, and what value do their solutions add?</P>
<P CLASS="dt1"><B>A:</B> To learn more about third-party solutions, visit http://www.microsoft.com/exchange/exisv/. Then perform a search on all products that use the keyword "backup". This will provide links to third-party solutions. </P>
<P CLASS="term1"><B>Q:</B> Is it a good idea to periodically perform a directory export ?</P>
<P CLASS="dt1"><B>A:</B> Yes. It is a quick operation and will save you time if you are unable to restore your directory database in the future. You should never have to rely on this procedure, but it is an extra safety measure that will enable you to quickly add users if necessary.</P>
<P CLASS="term1"><B>Q:</B> Where can I find more information on information store startup problems?</P>
<P CLASS="dt1"><B>A:</B> Articles in the Microsoft Knowledge Base can be provide additional information on information store startup problems, and other issues. To access the Knowledge Base, visit http://www.microsoft.com/kb. Perform a search on "Microsoft Exchange," and then enter relevant keywords. </P>
<P CLASS="term1"><B>Q:</B> What are "lazy" commits and "non-lazy" commits, and how does Microsoft Exchange Server use them?</P>
<P CLASS="dt1"><B>A:</B> After transaction logs are flushed to disk, the transaction is durable. If your system crashes, these logs can be restored and nothing will be lost. <I>Non-lazy</I> commits retain data on the hard drive, while <I>lazy commits</I> indicate that the transaction logs have not been saved.</P>
<P CLASS="term1"><B>Q:</B> Should I disable the SCSI controller write cache?</P>
<P CLASS="dt1"><B>A:</B> Yes. Doing so enables you to avoid the potential for data loss. At a programming level, if the write through flag is set, Windows NT will not use buffers. Therefore, when a program receives a write complete signal from Windows NT, it is guaranteed that the write was completed to disk. This is critical to the Microsoft Exchange Server transaction logging process. If write cache is enabled, Windows NT thinks that a write has made it to disk and will inform the calling application of this "false" information. This could result in data corruption if a crash is experienced before this lazy write operation makes it to disk.</P>
<P CLASS="term1"><B>Q:</B> When is a transaction committed to the database and how does this work? Is it first cached in memory so that it is virtually available, or is it necessary to read back from log files before writing to the database files?</P>
<P CLASS="dt1"><B>A:</B> Transactions are on both log files and fast memory pages. Log disk heads are never moved back to read old data, so only sequential writes occur on log files. After transactions are written to a log file, an operation is considered complete. The transaction is immediately available in server memory before it is actually committed to the database files. Remember that an operation is not complete (that is, the Client does not receive an acknowledgment) until all transactions are written to the transaction log (on disk).</P>
<P CLASS="term1"><B>Q:</B> How can I measure how the transaction logging process is doing?</P>
<P CLASS="dt1"><B>A:</B> Use Performance Monitor and select the MSExchangeDB object. Configure the following counters:</P>
<SPAN CLASS="list"><UL><LI CLASS="ULI1"><B>Log Bytes Write/sec </B>— The rate at which bytes are written to the log.</LI><LI CLASS="ULI1"><B>Log Checkpoint Depth </B>— This is proportional to the time that recovery will take after a system crash, depending on the performance of the individual system. A data page may be cached and not flushed to the .edb file for a long time. The earliest logged operations on the page can date back a significant time. To ensure that your system recovers from a crash, do not restore too many logs, and set the checkpoint depth to determine how many logs you can expect to replay during recovery. </LI><LI CLASS="ULI1"><B>Log Sessions Waiting </B>— The number of sessions waiting on a log commit in order to complete a transaction.</LI></UL></SPAN><P CLASS="term1"><B>Q:</B> What is the advantage of disabling circular logging?</P>
<P CLASS="dt1"><B>A:</B> Disabling circular logging provides for additional recoverability. This is because a history of transaction logs will be maintained for all transactions. These log files are only purged when a full or incremental online backup is performed. </P>
<P CLASS="dt1">They are purged because they are no longer needed after all transactions are committed to the databases and the databases are backed up. For example, suppose your last good backup occurred on Monday and on Thursday your database drive crashes. If you disabled circular logging and your transaction log files are configured on a separate physical drive from the drive that crashed, you can restore the Monday backup. In this case, you should <I>not</I> erase existing data, and you should verify that the log files created since the Monday backup have been restored back into the database. This process will restore your data to the point immediately before the crash.</P>
<P CLASS="term1"><B>Q:</B> When I try to run the <B>isinteg -patch</B> command, it does not run and I receive the following error message: DS_E_COMMUNICATIONS_ERROR. How do I solve this problem?</P>
<P CLASS="dt1"><B>A:</B> Make sure the directory service is started before running the command.</P>
<P CLASS="term1"><B>Q:</B> How can I back up Microsoft Exchange Server computers from a Windows&nbsp;NT Server backup computer that does not have Microsoft Exchange Server or the Microsoft Exchange Administrator program installed?</P>
<P CLASS="dt1"><B>A:</B> If you are copying files from an existing Microsoft Exchange Server computer, do one of the following:</P>
<SPAN CLASS="list"><UL><LI CLASS="ULI1">In the Winnt Root\System32 directory on the Windows&nbsp;NT Server backup computer, rename or delete Ntbackup.exe.</LI><LI CLASS="ULI1">From the Winnt Root\System32 directory on a Microsoft Exchange Server computer, copy the Ntbackup.exe, Edbbcli.dll, and Msvcrt40.dll files to the Winnt- Root\System32 directory on the Windows&nbsp;NT backup server.</LI><LI CLASS="ULI1">From the Exchsrvr\Bin directory on the Microsoft Exchange Server computer, copy Edbback.dll to the Winnt Root\System32 directory on the Windows&nbsp;NT Server backup computer.
<P CLASS="lt1">Or, if you are copying files from the Microsoft Exchange Server compact disc:</P></LI><LI CLASS="ULI1">In the Winnt-Winnt-Root\System32 directory on the Windows NT Server backup computer, rename or delete the Ntbackup.exe file.</LI><LI CLASS="ULI1">From the Setup\&lt;platform&gt; directory on the Microsoft Exchange Server compact disc, copy the Ntbackup.exe, Edbbcli.dll, Edbback.dll, and Msvcrt40.dll files to the Winnt-Root\System32 directory on the Windows&nbsp;NT Server backup computer.</LI></UL></SPAN><P CLASS="term1"><B>Q:</B> Do I need to run the DS/IS consistency adjuster after restoring the directory and information store?</P>
<P CLASS="dt1"><B>A:</B> No. You only need to run the DS/IS consistency adjuster if you can only restore the information store. The consistency adjuster scans the information store and ensures that a directory service object exists for each information store object. If not, the directory service object is created. The consistency adjuster also scans the directory service and ensures that a corresponding information store object exists. If it does not, the directory service object is deleted. Finally, the consistency adjuster also verifies the access control list (ACL) for each object and strips any invalid entries from the list. You can also set the DS/MDB Sync diagnostic logging level to maximum and then check the application log.</P>
<P CLASS="term1"><B>Q:</B> Should I avoid running the DS/IS consistency adjuster?</P>
<P CLASS="dt1"><B>A:</B> If you only restore the information store and must run the DS/IS consistency adjuster to re-create the directory service object for the mailboxes in the store, this sets the HOME-MDB attribute on all public folders in the hierarchy (replicas or not) to this server . In addition, it strips the public folder ACLs of any invalid entries (that is, users who do not exist in the current directory). </P>
<P CLASS="dt1">If you do this and then re-create a replication connector into the organization, there will be a conflict. The new server will probably win the conflict because it has newer changes to the public folder property. Accordingly, the public folder will be homed on the new server, and the new server's ACL will most likely be the ACL that is kept. This will result in lost permissions for some users. </P>
<P CLASS="term1"><B>Q:</B> I cannot find the backup set on my tape. What might cause this?</P>
<P CLASS="dt1"><B>A:</B> Make sure that you catalog the tape before restoring any data. This process enables you to gather information on the files available on the tape, and it enables the restore process to take place. After the catalog is completed, you can start the restore process. To load a catalog of the backup sets on a tape: </P>
<SPAN CLASS="list"><UL><LI CLASS="ULI1">In the Tapes window, select the tape whose catalog you want loaded.</LI><LI CLASS="ULI1">Choose Catalog in one of three ways: Double-click the icon for the appropriate tape, or choose the Catalog button, or choose Catalog from the Operations menu.
<P CLASS="lt1">After you search the tape, a complete list of backup sets appears in the Tapes window. Question marks are displayed in each icon to indicate that their individual catalogs have not been loaded.</P></LI></UL></SPAN><P CLASS="term1"><B>Q:</B> If you delete and re-add a computer name to the domain, and then restore the Windows NT registry from tape, is it true that the local SID from the restored Windows NT registry will not match the new SID created in the domain?</P>
<P CLASS="dt1"><B>A:</B> Yes. You should delete and re-add the name of a Microsoft Exchange Server computer in the domain only if a new server is required for recovery. The Windows NT registry should only be restored to the same physical computer because the Windows NT registry contains computer-specific data. This situation may occur if only the operating system hard disk was replaced and a Windows NT restore is performed.</P>
<P CLASS="dt1">Another issue to consider is that the Microsoft Exchange Server directory database maintains information about Windows NT IDs in the domain, such as ACL information. If you cannot access the SAM from the original domain and you create a new SAM by installing a new domain, and then restore the directory service, you will have a disconnect between the object security in the directory service (such as the Microsoft Exchange service account, user mailboxes, and administrator's account) and the new domain SAM. As a result, you will not be able to access any object in the Microsoft Exchange Server directory.</P>
<P CLASS="term1"><B>Q:</B> What is the impact of configuring Microsoft Exchange Server computers as BDCs?</P>
<P CLASS="dt1"><B>A:</B> Configuring Microsoft Exchange Server computers as BDCs can provide increased recoverability and reduced costs. However, the memory requirements for these computers are also increased.</P>
<P CLASS="dt1">For example, suppose that a Microsoft Exchange Server computer configured as a PDC needs to be replaced. Although the Windows NT domain controller can be rebuilt and the information store can be restored, but the directory service cannot be successfully restored to a domain that does not have the original SAM. </P>
<P CLASS="term1"><B>Q:</B> Does a full server restore to a different physical computer require the recovery server to be configured as a BDC or PDC?</P>
<P CLASS="dt1"><B>A:</B> No. The important thing is that the computer account is deleted and then re-added to the production domain so that the recovery computer can obtain a new SID that uses the same name as the original production server.</P>
<P CLASS="term1"><B>Q:</B> How do you compact the information store databases?</P>
<P CLASS="dt1"><B>A:</B> Microsoft Exchange Server automatically compacts the information store and directory databases without interruption to messaging. Online compaction takes place in the background, marking items for deletion and defragmenting the database files. </P>
<P CLASS="dt1">You can also use the EDBUTIL utility to compact the information store databases. Running the <B>EDBUTIL /D</B> command reduces the size of the information store database files and defragments the database. In contrast, online compaction defragments the database files, but does not decrease their size. Note that if you use the<B> /D</B> (defragment) command-line option when running EDBUTIL, you must first stop the information store service. </P>
<P CLASS="term1"><B>Q:</B> What is the difference between compaction, defragmentation, and information store maintenance?</P>
<P CLASS="dt1"><B>A:</B> By default, <I>information store maintenance</I> occurs between 1:00 a.m. and 6:00 a.m. The following tasks are typically completed during information store maintenance: tombstone compression, column aging, index aging, clean per user read, and message expiration. To view these settings from within the Microsoft Exchange Administrator program, select the appropriate server under <B>Org</B>,<B> Site</B>,<B> Configuration</B>. Choose <B>Properties</B> from the <B>File</B> menu, and then select the information store <B>Maintenance</B> tab. </P>
<P CLASS="dt1"><I>Compaction</I> is the the process of online defragmentation and reclaim of disk space. </P>
<P CLASS="dt1"><I>Defragmentation</I> is the offline process of reclaiming disk space and defragmenting the database files. Defragmentation is accomplished through the <B>EDBUTIL /D</B> command and will reclaim space, as well as reduce the size of the database files.</P>
<P CLASS="term1"><B>Q:</B> At what point do log files wrap around when database circular logging is used?</P>
<P CLASS="dt1"><B>A:</B> This is usually kept to four files, but if there is a heavy load on the server, such as during a large import/migration operation or a public folder backfill, the checkpoint and window will grow greater than four log files. This does not decrease until the information store or directory service is stopped and then restarted. After the respective services are stopped and restarted, the window returns to four log files. </P>
<P CLASS="term1"><B>Q:</B> What is the Temp.edb file and why does it get created?</P>
<P CLASS="dt1"><B>A:</B> If long-term transactions are taking place, the Temp.edb file is used to store transactions that are in progress. This file is also used for transient storage during online compaction.</P>
<P CLASS="term1"><B>Q:</B> When should the <B>edbutil /d /r</B> command be used?</P>
<P CLASS="dt1"><B>A:</B> Only as a last resort should you use this command to repair databases. Note that this command can delete data. Before running <B>Edbutil /d /r</B>, you should always attempt a restore.</P>
<P CLASS="term1"><B>Q:</B> What are the Res1.log and Res2.log files used for?</P>
<P CLASS="dt1"><B>A:</B> These are reserve log files that are not used unless the transaction log hard disk fills up. They are reserved for transactions that may be required to shut down the information store if the disk fills up. This way, even if the hard disk fills up, there is reserved space to record transactions from memory to disk. Note that these files are 5 MB each, regardless of the number of transactions in the log files.</P>
<P CLASS="term1"><B>Q:</B> If an information store is in recovery after a system crash, will Microsoft Exchange Server be smart enough not to duplicate preexisting transactions in the database and only play back uncommitted transactions?</P>
<P CLASS="dt1"><B>A:</B> Yes. Log files are read and this is a very fast operation. If the transaction version number is already in the database, the transaction will not be recommitted.</P>
<P CLASS="term1"><B>Q:</B> Will Microsoft Exchange Server automatically play back uncommitted transactions from logs when the services come up the first time following a crash? </P>
<P CLASS="dt1"><B>A:</B> Yes. If the database shut down was not clean, Microsoft Exchange Server records that and replays all transactions from the checkpoint forward at startup.</P>
<P CLASS="term1"><B>Q:</B> If circular logging is enabled, is it true that you cannot play back logs (those that are present within the circular window)?</P>
<P CLASS="dt1"><B>A:</B> Yes. With circular logging enabled, you cannot restore from a backup and play forward. You can only restore from backup at the point the backup was taken. By default, Microsoft Exchange Server is configured with circular logging enabled.</P>
<P CLASS="term1"><B>Q:</B> If circular logging is disabled, how can you play back transaction log files if required?</P>
<P CLASS="dt1"><B>A:</B> With circular logging disabled, you can play back logs from the last full backup. It will depend on how you are performing backups. For example, suppose that you perform a full weekly backup on Sunday and incremental backups Monday through Saturday. If you lose a hard drive or other data on Thursday, you need to restore tapes in the following order:</P>
<SPAN CLASS="list"><UL><LI CLASS="ULI1">Sunday: Full restore. Don't start services.</LI><LI CLASS="ULI1">Monday: Incremental restore. Don't start services.</LI><LI CLASS="ULI1">Tuesday: Incremental restore. Don't start services.</LI><LI CLASS="ULI1">Wednesday: Incremental restore. Don't start services.</LI></UL></SPAN><P CLASS="dt1">After these restore operations are completed, start the information store service. Note that you can restore all of these backup sets in one job, and then select <B>Start Services</B> after the restore. When you do so, Ntbackup.exe will not start services until the files from all sets are restored. Ntbackup.exe will restore the data and log files from Sunday, and add the log files for Monday through Wednesday when the services restart. Finally, Ntbackup.exe will replay all log files from after the point of the full backup on Sunday until the present time (that is, Monday through Wednesday, plus any log files created after the Wednesday backup).</P>
<P CLASS="dt1">Incremental backups delete log files after a backup is completed. Differential backups do not delete log files; instead these files are written to tape. If you were performing differential backups, you would not need to restore the Monday through Wednesday backup because you would still have those log files on the system.</P>
<P CLASS="dt1">Incremental and differential backups back up all log files since the last backup, as well as the Edb.chk file. The difference between these two backup types is that differential backups do not delete log files from the system.</P>
<P CLASS="term1"><B>Q:</B> What is the difference between running the <B>isinteg - fix</B> command and the <B>edbutil /d /r</B> command?</P>
<P CLASS="dt1"><B>A:</B> The <B>edbutil /d /r</B> command should only be run as a last resort in order to repair a database file. The <B>isinteg - fix</B> command repairs high-level objects, while <B>edbutil /d /r</B> repairs low-level database corruption. The <B>isinteg - fix</B> command repairs any "scheme" and other high level data/structure problems. If you need to run both commands, run <B>edbutil /d /r</B> first and then run <B>isinteg - fix</B>. Note that you should only run both commands if you don't have a backup to restore from and log files to play forward. </P>
<P CLASS="dt1">Restoring data from a backup and then playing logs forward is the recommended way to restore a corrupted database due to hardware failure. These procedures are recommended because they enable you to recover all your data. If you do not have a backup to restore and run the <B>edbutil /d/r </B>and <B>isinteg - fix</B> commands instead, you will lose all your data.</P>
<P CLASS="term1"><B>Q:</B> Can Microsoft Exchange Server perform information store compression on the fly? Should administrators perform manual compression on a periodic basis?</P>
<P CLASS="dt1"><B>A:</B> Microsoft Exchange Server can perform online <I>compactio</I>n, which is different than compression. </P>
<P CLASS="dt1">Microsoft Exchange Server reuses the space before growing the file. So, database defragmentation takes place in the background on a running server. The only time you should have to shut down a server for offline compaction is if you want to physically recover the free space on the disk. To reduce .edb file size, stop Microsoft Exchange services and then run the <B>edbutil /d </B>command.</P>
<P CLASS="term1"><B>Q:</B> What is the purpose of log files? </P>
<P CLASS="dt1"><B>A:</B> On a Microsoft Exchange Server computer, the public information store, private information store, and the directory service each have log files. These files are the transaction logs for all transactions that occur on the database. In the event of a system crash, hard drive failure, power failure, or another disaster, these files can be used for soft and hard recovery and for restore after backup. The Priv.edb file on a running server is always inconsistent, due to the database cache that is in RAM on the server. The consistent state of a server is made up of the data in the .edb file and the data in the memory cache on the server. If a server computer crashes and you don't replay the logs, this will result in a corrupt database. </P>
<P CLASS="lt1">The log files permit automatic playback of transactions that have occurred on the database but are not yet committed to the .edb file. There is a check point (Edb.chk) that contains the current transaction point in the log files that have been committed to disk. </P>
<P CLASS="lt1">Log files continue to consume disk space until you do one of the following:</P>
<SPAN CLASS="list"><UL><LI CLASS="ULI1">Back up the server (by performing a full backup or an incremental backup). This writes all logs to the tape up to the check point and then deletes the logs written to tape from the hard drive. If you have to restore the database, the backup copies the database file from the tape, replays the logs on the tape, and then replays all the logs on the disk.</LI><LI CLASS="ULI1">Run with circular logging enabled. </LI></UL></SPAN><P CLASS="dt1">If you browse the .edb file directories, note that you will also see *.pat files. These files are created when a backup is performed and contain all the changes (patches) since the backup started. You can write the patch file when performing a backup and be completely current. The following table lists files that you would see in the Exchsrvr\Mdbdata directory.</P>
<P></P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="115pt" VALIGN="TOP"><COL WIDTH="213pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P CLASS="th">File</P></TD><TD VALIGN="TOP"><P CLASS="th">Description</P></TD></TR><TR><TD COLSPAN="2" VALIGN="TOP"><P CLASS="tr"></P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">Priv.edb</P></TD><TD VALIGN="TOP"><P CLASS="tt">Private database file.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">Pub.edb</P></TD><TD VALIGN="TOP"><P CLASS="tt">Public database file.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">Edb.log</P></TD><TD VALIGN="TOP"><P CLASS="tt">Current latest log file being written to.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">Edbxxxxx.log</P></TD><TD VALIGN="TOP"><P CLASS="tt">Previous log files no longer opened or being used; new .log file every 5 MB.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">Res1.log</P>
<P CLASS="tt">Res2.log</P></TD><TD VALIGN="TOP"><P CLASS="tt">Two log files are reserved in case the database or log file drive fills up the server. </P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">Priv.pat</P></TD><TD VALIGN="TOP"><P CLASS="tt">Backup patch file for Priv.edb.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">Pub.pat</P></TD><TD VALIGN="TOP"><P CLASS="tt">Backup patch file for Pub.edb.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">Edb.chk</P></TD><TD VALIGN="TOP"><P CLASS="tt">Checkpoint file.</P></TD></TR></TBODY></TABLE>
<P CLASS="spacing"><BR></P></BODY></HTML>
