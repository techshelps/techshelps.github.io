<HTML><head><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Examples of Online Backup Automation for IS/DS</TITLE><BODY BGCOLOR="#FFFFFF">


<H2 CLASS="h1">Examples of Online Backup Automation for IS/DS</H2><P CLASS="t">Use the following procedure to automate online backups of the information store and directory service.</P>
<P CLASS="ls">From the Windows NT Resource Kit compact disc, install the Winat.exe program on the local Windows NT directory of your local computer (for example, on the Winnt35 directory).</P>
<P CLASS="ls">Create a Windows NT common group called Microsoft Exchange Server Backup.</P>
<P CLASS="ls">Create an icon for the Winnt35\Backup.log file. This provides quick access to review the backup log.</P>
<P CLASS="ls">Copy the Ntbackup.exe icon from the Administrative Tools group to the Microsoft Exchange Server Backup group.</P>
<P CLASS="ls">Create an icon for Winat.exe in the Microsoft Exchange Server Backup group.</P>
<P CLASS="ls">In Control Panel, double-click the <B>Services</B> icon.</P>
<P CLASS="ls">Select the Schedule service and choose<B> Startup</B>. Configure for automatic startup and assign an ID that is a member of the Windows NT Backup Operators group. Make sure to enter the correct password. If the administrator ID password changes, you must change the password for the Schedule service. </P>
<P CLASS="ls">Start the Schedule service.</P>
<P CLASS="ls">Create the backup batch file. Name this file Back.bat and save it in the Winnt35 subdirectory.</P>
<P CLASS="ls">Run the Winat.exe program and schedule the Back.bat file. You do not need to have a logon session on the computer in which Winat.exe is running because the Schedule service will log on to perform the operation under the defined security context. Set the batch job for interactive mode.</P>
<H3 CLASS="h3"><A NAME="sec0"></A>Sample Batch File for Online Backup</H3><P CLASS="t">Following is a sample batch file you can use for backing up your files while the server remains online.</P>
<P>rem ** 3/7/96  Backup Written by &lt;<I>name</I>&gt;</P>
<P>rem ** This will back up the information store and directory service on &lt;<I>server_name</I> 1&gt; and &lt;<I>server_name</I> 2&gt;.</P>
<P>ntbackup backup DS \\Server_name1 IS \\Server_name1 /v /d "Server-name1 IS-DS" /b /t Normal /l c:\winnt35\backup.log /e</P>
<P>ntbackup backup DS \\Server_name1 IS \\Server_name1 /a /v /d "Server_name1 IS-DS" /b /t Normal /l c:\winnt35\backup.log /e</P>
<P>exit</P>
<P></P>
<H3 CLASS="h3"><A NAME="sec1"></A>Sample Batch File for Offline Backup: Example 1</H3><P CLASS="t">You may need to experiment with the order in which you stop the services, so that you are not prompted when a service is dependent upon the one you are stopping.</P>
<P>rem ** Stop Microsoft Exchange services.</P>
<P>rem ** You can stop Microsoft Exchange services and restart them automatically to backup.</P>
<P>rem ** Files that a particular service may hold open</P>
<P></P>
<P>REM // stop all services</P>
<P>echo Stopping Services...</P>
<P>net stop MSExchangeMSMI</P>
<P>net stop MSExchangePCMTA</P>
<P>net stop MSExchangeFB</P>
<P>net stop MSExchangeDX</P>
<P>net stop MSExchangeIMC</P>
<P>net stop MSExchangeMTA</P>
<P>net stop MSExchangeIS</P>
<P>net stop MSExchangeDS</P>
<P>net stop MSExchangeSA</P>
<P>ntbackup backup c:\ d:\ /a /v /d "Full File Based Backup" /b /l c:\winnt35\backup.log /e</P>
<P>REM edbutil OPTIONS</P>
<P>net start MSExchangeSA</P>
<P>net start MSExchangeDS</P>
<P>net start MSExchangeIS</P>
<P>net start MSExchangeMTA</P>
<P>net start MSExchangeIMC</P>
<P>net start MSExchangeDX</P>
<P>net start MSExchangeFB</P>
<P>net start MSExchangePCMTA</P>
<P>net start MSExchangeMSMI</P>
<P></P>
<H3 CLASS="h3"><A NAME="sec2"></A>Sample Batch File for Offline Backup: Example 2</H3><P CLASS="t">You can start and stop PCMTA services by enclosing the service name in quotation marks. You can determine the service names from the Microsoft Exchange Server Administrator program, the Windows NT Control Panel, or by viewing the Windows NT registry. </P>
<P CLASS="t">If you are viewing the Windows NT registry, select</P>
<P CLASS="t"><B>HKEY_LOCAL_MACHINE</B>,<B> SYSTEM</B>,<B> CurrentControlSet</B>,<B> Services</B>. </P>
<P CLASS="t">All services are listed in alphabetical order.</P>
<P>rem Batch File To Stop and Restart Microsoft Exchange Services</P>
<P>rem For File Based Backup</P>
<P>echo Stopping Services ...</P>
<P>net stop MSExchangeMSMI</P>
<P>net stop MSExchangePCMTA</P>
<P>net stop MSExchangeFB</P>
<P>net stop MSExchangeDX</P>
<P>net stop MSExchangeMTA</P>
<P>net stop MSExchangeIMC</P>
<P>net stop MSExchangeIS</P>
<P>net stop MSExchangeDS</P>
<P></P>
<P>net stop "PC MTA - HUB"</P>
<P>net stop MSExchangeSA</P>
<P>ntbackup BACKUP d:\exchsrvr\mdbdata /v /d "File Based Backup" /b /l c:\winnt35\backup.log /e</P>
<P>net start MSExchangeSA</P>
<P>net start MSExchangeDS</P>
<P>net start MSExchangeIS</P>
<P>net start MSExchangeMTA</P>
<P>net start MSExchangeIMC</P>
<P>net start MSExchangeDX</P>
<P>net start MSExchangeFB</P>
<P>net start MSExchangePCMTA</P>
<P>net start MSExchangeMSMI</P>
<P>net start "PC MTA - HUB"</P></BODY></HTML>
