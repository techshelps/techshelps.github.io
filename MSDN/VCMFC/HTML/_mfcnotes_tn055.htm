<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>TN055: Migrating MFC ODBC Database Class Applications to MFC DAO Classes</title>
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY>
<font face="verdana,arial,helvetica" size="2">
<h1><a name="_mfcnotes_tn055"></a>TN055: Migrating MFC ODBC Database Class Applications to MFC DAO Classes</h1>
<p class=label>
<b>Overview</b></p>
<p>
In many situations it may be desirable to migrate applications that use MFC’s ODBC database classes to MFC’s DAO database classes. This technical note will detail most of the differences between the MFC ODBC and DAO classes. With the differences in mind, it should not be overly difficult to migrate applications from the ODBC classes to the MFC classes if desired.</p>
<p class=label>
<b>Why Migrate from ODBC to DAO?</b></p>
<p>
There are a number of reasons why you might want to migrate applications from the ODBC Database Classes to the DAO Database Classes, but the decision is not necessarily simple or obvious. One thing to keep in mind is that the Microsoft Jet database engine that is used by DAO can read any ODBC data source for which you have an ODBC driver. It may be more efficient to use the ODBC Database Classes or call ODBC directly yourself, but the Microsoft Jet database engine can read ODBC data.</p>
<p>
There are some simple cases that make the ODBC/DAO decision easy. For instance, when you only need access to data in a format that the Microsoft Jet engine can read directly (Access format, FoxPro format, Excel format, and so on) the obvious choice is to use the DAO Database Classes. </p>
<p>
More complex cases arise when your data exists on a server or on a variety of different servers. In this case, the decision to use the ODBC Database classes or the DAO Database classes is a difficult one. If you want to do things like heterogeneous joins (join data from servers in multiple formats like SQL Server and Oracle), then the Microsoft Jet database engine will perform the join for you rather than forcing you to do the work necessary if you used the ODBC Database Classes or called ODBC directly. If you are using an ODBC driver that supports driver cursors, your best choice might be the ODBC Database classes. </p>
<p>
The choice can be complicated, so you might want to write some sample code to test the performance of various methods given your special needs. This technical note assumes that you have made the decision to migrate from the ODBC Database Classes to the DAO Database classes.</p>
<p class=label>
<b>Similarities Between ODBC Database Classes and MFC DAO Database Classes</b></p>
<p>
The original design of the MFC ODBC classes was based on the DAO object model that has been in use in Microsoft Access and Microsoft Visual Basic. This means that there are many common features of the ODBC and DAO MFC classes, which will not all be listed in this section. In general, the programming models are the same.</p>
<p>
To highlight a few similarities:
<ul type=disc>
<li>
Both the ODBC and DAO classes have database objects that manage using the underlying database management system (DBMS).<br><br></li>
<li>
Both have recordset objects representing a set of results returned from that DBMS. <br><br></li>
<li>
The DAO database and recordset objects have members nearly identical to the ODBC classes. <br><br></li>
<li>
With both sets of classes, the code to retrieve data is identical except for some object and member name changes. Changes will be required, but usually the process is a straightforward name change when switching from the ODBC classes to DAO classes.</li>
</ul>
<p>
For example in both models the procedure to retrieve data is to create and open a database object, create and open a recordset object, and navigate (move) though the data performing some operation. </p>
<p class=label>
<b>Differences Between ODBC and DAO MFC Classes</b></p>
<p>
The DAO classes include more objects and a richer set of methods, but this section will only detail the differences in similar classes and functionality. </p>
<p>
Probably the most obvious differences between the classes are the name changes for similar classes and global functions. The following list shows the name changes of&nbsp; the objects, methods and global functions associated with the database classes:</p>
<table border=1 cellpadding=5 cols=2 frame=below rules=rows>
<tr valign=top>
<td class=label width=50%><b>Class or Function</b></td>
<td class=label width=50%><b>Equivalent in MFC DAO Classes</b></td>
</tr>
<tr valign=top>
<td width=50%><b>CDatabase</b></td>
<td width=50%><b>CDaoDatabase</b></td>
</tr>
<tr valign=top>
<td width=50%><b>CDatabase::ExecuteSQL</b></td>
<td width=50%><b>CDaoDatabase::Execute</b></td>
</tr>
<tr valign=top>
<td width=50%><b>CRecordset</b></td>
<td width=50%><b>CDaoRecordset</b></td>
</tr>
<tr valign=top>
<td width=50%><b>CRecordset::GetDefaultConnect</b></td>
<td width=50%><b>CDaoRecordset::GetDefaultDBName</b></td>
</tr>
<tr valign=top>
<td width=50%><b>CFieldExchange</b></td>
<td width=50%><b>CDaoFieldExchange</b></td>
</tr>
<tr valign=top>
<td width=50%><b>RFX_Bool</b></td>
<td width=50%><b>DFX_Bool</b></td>
</tr>
<tr valign=top>
<td width=50%><b>RFX_Byte</b></td>
<td width=50%><b>DFX_Byte</b></td>
</tr>
<tr valign=top>
<td width=50%><b>RFX_Int</b></td>
<td width=50%><b>DFX_Short</b></td>
</tr>
<tr valign=top>
<td width=50%><b>RFX_Long</b></td>
<td width=50%><b>DFX_Long</b></td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><b>DFX_Currency</b></td>
</tr>
<tr valign=top>
<td width=50%><b>RFX_Single</b></td>
<td width=50%><b>DFX_Single</b></td>
</tr>
<tr valign=top>
<td width=50%><b>RFX_Double</b></td>
<td width=50%><b>DFX_Double</b></td>
</tr>
<tr valign=top>
<td width=50%><b>RFX_Date *</b></td>
<td width=50%><b>DFX_Date</b> (<b>COleDateTime</b>-based)</td>
</tr>
<tr valign=top>
<td width=50%><b>RFX_Text</b></td>
<td width=50%><b>DFX_Text</b></td>
</tr>
<tr valign=top>
<td width=50%><b>RFX_Binary</b></td>
<td width=50%><b>DFX_Binary</b></td>
</tr>
<tr valign=top>
<td width=50%><b>RFX_LongBinary</b></td>
<td width=50%><b>DFX_LongBinary</b></td>
</tr>
</table><br>
<p class=mini>
* The <b>RFX_Date</b> function is based on <b>CTime</b> and <b>TIMESTAMP_STRUCT</b>.</p>
<p>
The major changes to functionality which may affect your application and require more than simple name changes are listed below.
<ol>
<li>
The constants and macros used to specify things like recordset open type and recordset open options have been changed. <p class=tl>
With the ODBC classes MFC needed to define these options via macros or enumerated types. </P><p class=tl>
With the DAO classes, DAO provides the definition of these options in a header file (DBDAOINT.H). Thus the recordset type is an enumerated member of <b>CRecordset</b>, but with DAO it is a constant instead. For example you would use <b>snapshot</b> when specifying the type of <b>CRecordset</b> in ODBC but <b>DB_OPEN_SNAPSHOT</b> when specifying the type of <b>CDaoRecordset</b>.</P></li>
<li>
The default recordset type for <b>CRecordset</b> is <b>snapshot</b> while the default recordset type for <b>CDaoRecordset</b> is <b>dynaset</b> (see the Note below for an additional issue about ODBC class snapshots).<br><br></li>
<li>
The ODBC <b>CRecordset</b> class has an option to create a forward-only recordset type. In the <b>CDaoRecordset</b> class, forward-only is not a recordset type, but rather a property (or option) of certain types of recordsets.<br><br></li>
<li>
An append-only recordset when opening a <b>CRecordset</b> object meant that the recordset’s data could be read and appended. With <b>CDaoRecordset</b> object, the append-only option means literally that the recordset’s data can only be appended (and not read).<br><br></li>
<li>
The ODBC classes’ transaction member functions are members of <b>CDatabase</b> and act at the database level. In the DAO classes, the transaction member functions are members of a higher level class (<b>CDaoWorkspace</b>) and thus may impact multiple <b>CDaoDatabase</b> objects sharing the same workspace (transaction space).<br><br></li>
<li>
The exception class has been changed. <b>CDBExceptions</b> are thrown in the ODBC classes and <b>CDaoExceptions</b> in the DAO classes.<br><br></li>
<li>
<b>RFX_Date</b> uses <b>CTime</b> and <b>TIMESTAMP_STRUCT</b> objects while <b>DFX_Date</b> uses <b>COleDateTime</b>. The <b>COleDateTime</b> is nearly identical to <b>CTime</b>, but is based on a 8-byte OLE<b> DATE</b> rather than a 4-byte <b>time_t</b> so it can hold a much bigger range of data.</li>
</ol>
<p class=indent>
<B><b>Note</b></B>&nbsp;&nbsp;&nbsp;DAO (<b>CDaoRecordset</b>) snapshots are read-only while ODBC (<b>CRecordset</b>) snapshots may be updatable depending on the driver and use of the ODBC cursor library. If you are using the cursor library, <b>CRecordset</b> snapshots are updatable. If you are using any of the Microsoft drivers from Desktop Driver Pack 3.0 without the ODBC cursor library, the <b>CRecordset</b> snapshots are read-only. If you are using another driver, check the driver’s documentation to see if snapshots (<b>STATIC_CURSORS</b>) are read-only.</p>
<p>
<a href="_mfcnotes_technical_notes_by_number.htm">Technical Notes by Number</a>  |&nbsp; <a href="_mfcnotes_technical_notes_by_category.htm">Technical Notes by Category</a></p>
</font></BODY>
</HTML>
