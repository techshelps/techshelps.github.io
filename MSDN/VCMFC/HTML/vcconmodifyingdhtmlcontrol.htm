<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Modifying the ATL DHTML Control</title>
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY>
<font face="verdana,arial,helvetica" size="2">
<h1><a name="vcconmodifyingdhtmlcontrol"></a>Modifying the ATL DHTML Control</h1>
<p>
The ATL Object Wizard provides starter code so you can build and run the control, and so you can see how the methods are written in the project files and how the DHTML calls into the control's C++ code using the dispatch methods. You can add any dispatch method to the interface. Then, you can call the methods in the HTML resource.</p>
<p class=label>
<b>To modify the ATL DHTML control</b>
<ol>
<li>
In ClassView, expand the control project. <p class=tl>
Note that the interface that ends in "UI" has one method, <code>OnClick</code>. The interface that does not end in "UI" does not have any methods.</P></li>
<li>
Add a method called <code>MethodInvoked </code>to the interface that does not end in "UI."<p class=tl>
This method will be added to the interface that is used in the control container for container interaction, not to the interface used by DHTML to interact with the control. Only the container can invoke this method.</P></li>
<li>
Find the stubbed-out method in the .cpp file and add code to display a message box, for example:<pre><code>::MessageBox(NULL, "I'm invoked", "Your Container Message", MB_OK);
</code></pre>
</li>
<li>
Add another method called <code>HelloHTML</code>, only this time, add it to the interface that ends in "UI." Find the stubbed-out <code>HelloHTML</code> method in the .cpp file and add code to display a message box, for example:<pre><code>::MessageBox(NULL, "Here's your message", "HelloHTML", MB_OK);
</code></pre>
</li>
<li>
Add a third method, <code>GoToURL</code>, also to the interface ending in "UI." Implement this method by calling <object id=alink_1 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="DefaultTopic" value="_topic_not_found.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_win32_iwebbrowser2_navigate">
</object><a href=JavaScript:alink_1.Click()>IWebBrowser2::Navigate</a>, as follows:<pre><code>m_spBrowser-&gt;Navigate(CComBSTR("www.microsoft.com"), NULL, NULL, NULL, NULL);
</code></pre>
<p class=tl>
You can use the <b>IWebBrowser2</b> methods because ATL provides a pointer to that interface for you in your .h file. </P></li>
</ol>
<p>
Next, modify the HTML resource to invoke the methods you created. You will add three buttons for invoking these methods.</p>
<p class=label>
<b>To modify the HTML resource</b>
<ol>
<li>
In FileView, double-click the .htm file to display the HTML resource. <p class=tl>
Examine the HTML, especially the calls to the external Windows dispatch methods. The HTML calls the project's <code>OnClick</code> method, and the parameters indicate the body of the control (<code>theBody</code>) and the color to assign ("<code>red</code>"). The text following the method call is the label that appears on the button. </P></li>
<li>
Add another <code>OnClick</code> method, only change the color. For example:<pre><code>&lt;br&gt;
&lt;br&gt;
&lt;BUTTON onclick='window.external.OnClick(theBody, "white");'&gt;Refresh&lt;/BUTTON&gt;
</code></pre>
<p class=tl>
This method will create a button, labeled <b>Refresh</b>, that the user can click to return the control to the original, white background.</P></li>
<li>
Add the call to the <code>HelloHTML</code> method you created. For example:<pre><code>&lt;br&gt;
&lt;br&gt;
&lt;BUTTON onclick='window.external.HelloHTML();'&gt;HelloHTML&lt;/BUTTON&gt;
</code></pre>
<p class=tl>
This method will create a button, labeled <b>HelloHTML</b>, that the user can click to display the <code>HelloHTML</code> message box.</P></li>
<li>
Finally, add the call to the <code>GoToURL</code> method you created. For example:<pre><code>&lt;br&gt;
&lt;br&gt;
&lt;BUTTON onclick='window.external.GoToURL();'&gt;WWW&lt;/BUTTON&gt;
</code></pre>
<p class=tl>
This method will create a button, labeled <b>WWW</b>, that the user can click to display the Microsoft Web page in the control.</P></li>
</ol>
<p>
You can now build and <a href="vccontestingaltereddhtmlcontrol.htm">test the modified DHTML control</a>.</p>
<p>
<a href="vcconatlsupportfordhtmlcontrols.htm">ATL Support for DHTML Controls</a></p>
</font></BODY>
</HTML>
