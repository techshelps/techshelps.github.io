<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>AfxOleRegisterControlClass</title>
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY>
<font face="verdana,arial,helvetica" size="2">
<h1><a name="_mfc_afxoleregistercontrolclass"></a><sup></sup>AfxOleRegisterControlClass</h1>
<p>
<b>BOOL AFXAPI AfxOleRegisterControlClass( HINSTANCE </b><i>hInstance</i><b>, REFCLSID </b><i>clsid</i><b>, LPCTSTR </b><i>pszProgID</i><b>, UINT </b><i>idTypeName</i><b>, UINT </b><i>idBitmap</i><b>, int </b><i>nRegFlags</i><b>, DWORD </b><i>dwMiscStatus</i><b>, REFGUID </b><i>tlid</i><b>, WORD </b><i>wVerMajor</i><b>, WORD </b><i>wVerMinor</i><b> );</b></p>
<p>
<b>#include &lt;afxctl.h&gt;</b></p>
<p class=label>
<b>Return Value</b></p>
<p>
Nonzero if the control class was registered; otherwise 0.</p>
<p class=label>
<b>Parameters</b></p>
<p class=dt>
<i>hInstance</i></p>
<p class=indent>
The instance handle of the module associated with the control class.</p>
<p class=dt>
<i>clsid</i></p>
<p class=indent>
The unique class ID of the control.</p>
<p class=dt>
<i>pszProgID</i></p>
<p class=indent>
The unique program ID of the control.</p>
<p class=dt>
<i>idTypeName</i></p>
<p class=indent>
The resource ID of the string that contains a user-readable type name for the control.</p>
<p class=dt>
<i>idBitmap</i></p>
<p class=indent>
The resource ID of the bitmap used to represent the OLE control in a toolbar or palette.</p>
<p class=dt>
<i>nRegFlags</i></p>
<p class=indent>
Contains one or more of the following flags:
<ul type=disc>
<li>
<b>afxRegInsertable</b>&nbsp;&nbsp;&nbsp;Allows the control to appear in the Insert Object dialog box for OLE objects.<br><br></li>
<li>
<b>afxRegApartmentThreading</b>&nbsp;&nbsp;&nbsp;Sets the threading model in the registry to ThreadingModel=Apartment.</li>
</ul>
<p class=indent>
<B><b>Note</b></B>&nbsp;&nbsp;&nbsp;In MFC versions prior to MFC 4.2, the <b>int</b> <i>nRegFlags </i>parameter was a <b>BOOL</b> parameter, <i>bInsertable</i>, that allowed or disallowed the control to be inserted from the Insert Object dialog box. </p>
<p class=dt>
<i>dwMiscStatus</i></p>
<p class=indent>
Contains one or more of the following status flags (for a description of the flags, see <b>OLEMISC</b> enumeration in the <i>OLE Programmer's Reference</i>): 
<ul type=disc>
<li>
OLEMISC_RECOMPOSEONRESIZE<br><br></li>
<li>
OLEMISC_ONLYICONIC<br><br></li>
<li>
OLEMISC_INSERTNOTREPLACE<br><br></li>
<li>
OLEMISC_STATIC<br><br></li>
<li>
OLEMISC_CANTLINKINSIDE<br><br></li>
<li>
OLEMISC_CANLINKBYOLE1<br><br></li>
<li>
OLEMISC_ISLINKOBJECT<br><br></li>
<li>
OLEMISC_INSIDEOUT<br><br></li>
<li>
OLEMISC_ACTIVATEWHENVISIBLE<br><br></li>
<li>
OLEMISC_RENDERINGISDEVICEINDEPENDENT<br><br></li>
<li>
OLEMISC_INVISIBLEATRUNTIME<br><br></li>
<li>
OLEMISC_ALWAYSRUN<br><br></li>
<li>
OLEMISC_ACTSLIKEBUTTON<br><br></li>
<li>
OLEMISC_ACTSLIKELABEL<br><br></li>
<li>
OLEMISC_NOUIACTIVATE<br><br></li>
<li>
OLEMISC_ALIGNABLE<br><br></li>
<li>
OLEMISC_IMEMODE<br><br></li>
<li>
OLEMISC_SIMPLEFRAME<br><br></li>
<li>
OLEMISC_SETCLIENTSITEFIRST</li>
</ul>
<p class=dt>
<i>tlid</i></p>
<p class=indent>
The unique ID of the control class.</p>
<p class=dt>
<i>wVerMajor</i></p>
<p class=indent>
The major version number of the control class.</p>
<p class=dt>
<i>wVerMinor</i></p>
<p class=indent>
The minor version number of the control class.</p>
<p class=label>
<b>Remarks</b></p>
<p>
Registers the control class with the Windows registration database. This allows the control to be used by containers that are OLE-control aware. <b>AfxOleRegisterControlClass</b> updates the registry with the control’s name and location on the system and also sets the threading model that the control supports in the registry. For more information, see <a href="_mfcnotes_tn064.htm">Technical Note 64</a>, "Apartment-Model Threading in OLE Controls," and <object id=alink_1 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="DefaultTopic" value="_topic_not_found.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_win32_About_Processes_and_Threads">
</object><a href=JavaScript:alink_1.Click()>About Processes and Threads</a> in the Win32 SDK.</p>
<p class=label>
<b>Example</b></p>
<pre><code>// Member function implementation of class COleObjectFactory::UpdateRegistry 
//
BOOL CMyApartmentAwareCtrl::CApartmentCtrlFactory::UpdateRegistry(BOOL bRegister)
{
// TODO: Verify that your control follows 
// apartment-model threading rules.
// Refer to MFC TechNote 64 for more information.
// If your control does not conform to the 
// apartment-model rules, then you must modify the
// code below, changing the 6th parameter from
// afxRegInsertable | afxRegApartmentThreading to
// afxRegInsertable.

 &nbsp; if (bRegister)
 &nbsp;&nbsp;&nbsp;&nbsp; return AfxOleRegisterControlClass()
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AfxGetInstanceHandle(),
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m_clsid,
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m_lpszProgID,
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IDS_APARTMENT,
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IDB_APARTMENT,
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; afxRegInsertable | afxRegApartmentThreading,
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _dwApartmentOleMisc,
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _tlid,
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _wVerMajor,
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _wVerMinor);
 &nbsp; else
 &nbsp;&nbsp;&nbsp;&nbsp; return AfxOleUnregisterClass(m_clsid, m_lpszProgID);
</code></pre>
<p>
The above example demonstrates how <b>AfxOleRegisterControlClass</b> is called with the flag for insertable and the flag for apartment model ORed together to create the sixth parameter:</p>
<pre><code>   afxRegInsertable | afxRegApartmentThreading,
</code></pre>
<p>
The control will show up in the Insert Object dialog box for enabled containers, and it will be apartment model-aware. Apartment model-aware controls must ensure that static class data is protected by locks, so that while a control in one apartment is accessing the static data, it isn’t disabled by the scheduler before it is finished, and another instance of the same class starts using the same static data. Any accesses to the static data will be surrounded by critical section code.</p>
<p>
<b>See Also</b>&nbsp;&nbsp;&nbsp;<a href="_mfc_afxoleregisterpropertypageclass.htm">AfxOleRegisterPropertyPageClass</a>, <a href="_mfc_afxoleregistertypelib.htm">AfxOleRegisterTypeLib</a>, <a href="_mfc_afxoleunregisterclass.htm">AfxOleUnregisterClass</a>, <a href="_mfc_afxoleunregistertypelib.htm">AfxOleUnregisterTypeLib</a></p>
</font></BODY>
</HTML>
