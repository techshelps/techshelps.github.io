<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>CAsyncSocket::SetSockOpt</title>
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY>
<font face="verdana,arial,helvetica" size="2">
<h1><a name="_mfc_casyncsocket.3a3a.setsockopt"></a><sup></sup>CAsyncSocket::SetSockOpt</h1>
<p>
<b>BOOL</b> <b>SetSockOpt(</b> <b>int</b> <i>nOptionName</i><b>,</b> <b>const</b> <b>void*</b> <i>lpOptionValue</i><b>,</b> <b>int</b> <i>nOptionLen</i><b>,</b> <b>int</b> <i>nLevel</i> <b>=</b> <b>SOL_SOCKET</b> <b>);</b></p>
<p class=label>
<b>Return Value</b></p>
<p>
Nonzero if the function is successful; otherwise 0, and a specific error code can be retrieved by calling <a href="_mfc_casyncsocket.3a3a.getlasterror.htm">GetLastError</a>. The following errors apply to this member function:
<ul type=disc>
<li>
<b>WSANOTINITIALISED</b>&nbsp;&nbsp;&nbsp;A successful <a href="_mfc_afxsocketinit.htm">AfxSocketInit</a> must occur before using this API.<br><br></li>
<li>
<b>WSAENETDOWN</b>&nbsp;&nbsp;&nbsp;The Windows Sockets implementation detected that the network subsystem failed.<br><br></li>
<li>
<b>WSAEFAULT</b>&nbsp;&nbsp;&nbsp;<i>lpOptionValue</i> is not in a valid part of the process address space.<br><br></li>
<li>
<b>WSAEINPROGRESS</b>&nbsp;&nbsp;&nbsp;A blocking Windows Sockets operation is in progress.<br><br></li>
<li>
<b>WSAEINVAL</b>&nbsp;&nbsp;&nbsp;<i>nLevel</i> is not valid, or the information in <i>lpOptionValue</i> is not valid.<br><br></li>
<li>
<b>WSAENETRESET</b>&nbsp;&nbsp;&nbsp;Connection has timed out when <b>SO_KEEPALIVE</b> is set.<br><br></li>
<li>
<b>WSAENOPROTOOPT</b>&nbsp;&nbsp;&nbsp;The option is unknown or unsupported. In particular, <b>SO_BROADCAST</b> is not supported on sockets of type <b>SOCK_STREAM</b>, while <b>SO_DONTLINGER</b>, <b>SO_KEEPALIVE</b>, <b>SO_LINGER</b>, and <b>SO_OOBINLINE</b> are not supported on sockets of type <b>SOCK_DGRAM</b>.<br><br></li>
<li>
<b>WSAENOTCONN</b>&nbsp;&nbsp;&nbsp;Connection has been reset when <b>SO_KEEPALIVE</b> is set.<br><br></li>
<li>
<b>WSAENOTSOCK</b>&nbsp;&nbsp;&nbsp;The descriptor is not a socket.</li>
</ul>
<p class=label>
<b>Parameters</b></p>
<p class=dt>
<i>nOptionName</i></p>
<p class=indent>
The socket option for which the value is to be set.</p>
<p class=dt>
<i>lpOptionValue</i></p>
<p class=indent>
A pointer to the buffer in which the value for the requested option is supplied.</p>
<p class=dt>
<i>nOptionLen</i></p>
<p class=indent>
The size of the <i>lpOptionValue</i> buffer in bytes.</p>
<p class=dt>
<i>nLevel</i></p>
<p class=indent>
The level at which the option is defined; the only supported levels are <b>SOL_SOCKET</b> and <b>IPPROTO_TCP</b>.</p>
<p class=label>
<b>Remarks</b></p>
<p>
Call this member function to set a socket option. <b>SetSockOpt</b> sets the current value for a socket option associated with a socket of any type, in any state. Although options can exist at multiple protocol levels, this specification only defines options that exist at the uppermost “socket” level. Options affect socket operations, such as whether expedited data is received in the normal data stream, whether broadcast messages can be sent on the socket, and so on. </p>
<p>
There are two types of socket options: Boolean options that enable or disable a feature or behavior, and options which require an integer value or structure. To enable a Boolean option, <i>lpOptionValue</i> points to a nonzero integer. To disable the option <i>lpOptionValue</i> points to an integer equal to zero. <i>nOptionLen</i> should be equal to <b>sizeof(BOOL)</b> for Boolean options. For other options, <i>lpOptionValue</i> points to the integer or structure that contains the desired value for the option, and <i>nOptionLen</i> is the length of the integer or structure.</p>
<p>
<b>SO_LINGER</b> controls the action taken when unsent data is queued on a socket and the <b>Close</b> function is called to close the socket. For more information, see <object id=alink_1 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="DefaultTopic" value="_topic_not_found.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_win32_Windows_Sockets_Programming_Considerations_2">
</object><a href=JavaScript:alink_1.Click()>Windows Sockets Programming Considerations</a> in the Win32 SDK documentation. </p>
<p>
By default, a socket cannot be bound (see <a href="_mfc_casyncsocket.3a3a.bind.htm">Bind</a>) to a local address which is already in use. On occasion, however, it may be desirable to “reuse” an address in this way. Since every connection is uniquely identified by the combination of local and remote addresses, there is no problem with having two sockets bound to the same local address as long as the remote addresses are different. </p>
<p>
To inform the Windows Sockets implementation that a <b>Bind</b> call on a socket should not be disallowed because the desired address is already in use by another socket, the application should set the <b>SO_REUSEADDR</b> socket option for the socket before issuing the <b>Bind</b> call. Note that the option is interpreted only at the time of the <b>Bind</b> call: it is therefore unnecessary (but harmless) to set the option on a socket which is not to be bound to an existing address, and setting or resetting the option after the <b>Bind</b> call has no effect on this or any other socket.</p>
<p>
An application can request that the Windows Sockets implementation enable the use of “keep-alive” packets on Transmission Control Protocol (TCP) connections by turning on the <b>SO_KEEPALIVE</b> socket option. (For information about “keep-alive” packets, see <object id=alink_2 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="DefaultTopic" value="_topic_not_found.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_win32_Windows_Sockets_Programming_Considerations_2">
</object><a href=JavaScript:alink_2.Click()>Windows Sockets Programming Considerations</a> in the Win32 SDK documentation.) A Windows Sockets implementation need not support the use of keep-alives: if it does, the precise semantics are implementation-specific but should conform to section 4.2.3.6 of RFC 1122: “Requirements for Internet Hosts — Communication Layers.” If a connection is dropped as the result of “keep-alives” the error code <b>WSAENETRESET</b> is returned to any calls in progress on the socket, and any subsequent calls will fail with <b>WSAENOTCONN</b>. </p>
<p>
The <b>TCP_NODELAY</b> option disables the Nagle algorithm. The Nagle algorithm is used to reduce the number of small packets sent by a host by buffering unacknowledged send data until a full-size packet can be sent. However, for some applications this algorithm can impede performance, and <b>TCP_NODELAY</b> can be used to turn it off. Application writers should not set <b>TCP_NODELAY</b> unless the impact of doing so is well-understood and desired, since setting <b>TCP_NODELAY</b> can have a significant negative impact on network performance. <b>TCP_NODELAY</b> is the only supported socket option which uses level <b>IPPROTO_TCP</b>; all other options use level <b>SOL_SOCKET</b>.</p>
<p>
Some implementations of Windows Sockets supply output debug information if the <b>SO_DEBUG</b> option is set by an application.</p>
<p>
The following options are supported for <b>SetSockOpt</b>. The Type identifies the type of data addressed by <i>lpOptionValue</i>.</p>
<table border=1 cellpadding=5 cols=3 frame=below rules=rows>
<tr valign=top>
<td class=label width=29%><b>Value</b></td>
<td class=label width=21%><b>Type</b></td>
<td class=label width=50%><b>Meaning</b></td>
</tr>
<tr valign=top>
<td width=29%><b>SO_BROADCAST</b></td>
<td width=21%><b>BOOL</b></td>
<td width=50%>Allow transmission of broadcast messages on the socket.</td>
</tr>
<tr valign=top>
<td width=29%><b>SO_DEBUG</b></td>
<td width=21%><b>BOOL</b></td>
<td width=50%>Record debugging information. </td>
</tr>
<tr valign=top>
<td width=29%><b>SO_DONTLINGER</b></td>
<td width=21%><b>BOOL</b></td>
<td width=50%>Don't block <b>Close</b> waiting for unsent data to be sent. Setting this option is equivalent to setting <b>SO_LINGER</b> with <b>l_onoff</b> set to zero.</td>
</tr>
<tr valign=top>
<td width=29%><b>SO_DONTROUTE</b></td>
<td width=21%><b>BOOL</b></td>
<td width=50%>Don't route: send directly to interface.</td>
</tr>
<tr valign=top>
<td width=29%><b>SO_KEEPALIVE</b></td>
<td width=21%><b>BOOL</b></td>
<td width=50%>Send keep-alives.</td>
</tr>
<tr valign=top>
<td width=29%><b>SO_LINGER</b></td>
<td width=21%><b>struct LINGER</b></td>
<td width=50%>Linger on <b>Close</b> if unsent data is present.</td>
</tr>
<tr valign=top>
<td width=29%><b>SO_OOBINLINE</b></td>
<td width=21%><b>BOOL</b></td>
<td width=50%>Receive out-of-band data in the normal data stream.</td>
</tr>
<tr valign=top>
<td width=29%><b>SO_RCVBUF</b></td>
<td width=21%><b>int</b></td>
<td width=50%>Specify buffer size for receives.</td>
</tr>
<tr valign=top>
<td width=29%><b>SO_REUSEADDR</b></td>
<td width=21%><b>BOOL</b></td>
<td width=50%>Allow the socket to be bound to an address which is already in use. (See <a href="_mfc_casyncsocket.3a3a.bind.htm">Bind</a>.)</td>
</tr>
<tr valign=top>
<td width=29%><b>SO_SNDBUF</b></td>
<td width=21%><b>int</b></td>
<td width=50%>Specify buffer size for sends.</td>
</tr>
<tr valign=top>
<td width=29%><b>TCP_NODELAY</b></td>
<td width=21%><b>BOOL</b></td>
<td width=50%>Disables the Nagle algorithm for send coalescing.</td>
</tr>
</table><br>
<p>
Berkeley Software Distribution (BSD) options not supported for <b>SetSockOpt</b> are:</p>
<table border=1 cellpadding=5 cols=3 frame=below rules=rows>
<tr valign=top>
<td class=label width=29%><b>Value</b></td>
<td class=label width=21%><b>Type</b></td>
<td class=label width=50%><b>Meaning</b></td>
</tr>
<tr valign=top>
<td width=29%><b>SO_ACCEPTCONN</b></td>
<td width=21%><b>BOOL</b></td>
<td width=50%>Socket is listening</td>
</tr>
<tr valign=top>
<td width=29%><b>SO_ERROR</b></td>
<td width=21%><b>int</b></td>
<td width=50%>Get error status and clear.</td>
</tr>
<tr valign=top>
<td width=29%><b>SO_RCVLOWAT</b></td>
<td width=21%><b>int</b></td>
<td width=50%>Receive low water mark.</td>
</tr>
<tr valign=top>
<td width=29%><b>SO_RCVTIMEO</b></td>
<td width=21%><b>int</b></td>
<td width=50%>Receive timeout</td>
</tr>
<tr valign=top>
<td width=29%><b>SO_SNDLOWAT</b></td>
<td width=21%><b>int</b></td>
<td width=50%>Send low water mark.</td>
</tr>
<tr valign=top>
<td width=29%><b>SO_SNDTIMEO</b></td>
<td width=21%><b>int</b></td>
<td width=50%>Send timeout.</td>
</tr>
<tr valign=top>
<td width=29%><b>SO_TYPE</b></td>
<td width=21%><b>int</b></td>
<td width=50%>Type of the socket.</td>
</tr>
<tr valign=top>
<td width=29%><b>IP_OPTIONS</b></td>
<td width=21%></td>
<td width=50%>Set options field in IP header.</td>
</tr>
</table><br>
<p>
<a href="_mfc_casyncsocket.htm">CAsyncSocket Overview</a>  |&nbsp; <a href="_mfc_casyncsocket_class_members.htm">Class Members</a>  |&nbsp; <a href="_mfc_hierarchy_chart.htm">Hierarchy Chart</a></p>
<p>
<b>See Also</b>&nbsp;&nbsp;&nbsp;<a href="_mfc_casyncsocket.3a3a.asyncselect.htm">CAsyncSocket::AsyncSelect</a>, <a href="_mfc_casyncsocket.3a3a.bind.htm">CAsyncSocket::Bind</a>, <a href="_mfc_casyncsocket.3a3a.create.htm">CAsyncSocket::Create</a>, <a href="_mfc_casyncsocket.3a3a.getsockopt.htm">CAsyncSocket::GetSockOpt</a>, <a href="_mfc_casyncsocket.3a3a.ioctl.htm">CAsyncSocket::IOCtl</a></p>
</font></BODY>
</HTML>
