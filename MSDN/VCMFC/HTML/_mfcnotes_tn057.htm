<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>TN057: Localization of MFC Components</title>
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY>
<font face="verdana,arial,helvetica" size="2">
<h1><a name="_mfcnotes_tn057"></a>TN057: Localization of MFC Components</h1>
<p>
This note describes some of the designs and procedures you can use to localize your component, be it an application or an OLE control, or a DLL which uses MFC.</p>
<p class=label>
<b>Overview</b></p>
<p>
There are really two issues to resolve when localizing a component which uses MFC. First of all, you must localize your own resources – strings, dialogs, and other resources that are specific to your component. Most components built using MFC also include and use a number of resources that are defined by MFC. You must provide localized MFC resources as well. Fortunately, several languages are already provided by MFC itself.</p>
<p>
In addition, your component should be prepared to run in its target environment (European, or DBCS enabled environment). For the most part, this depends on your application treating characters with the high bit set correctly and handling strings with double byte characters. MFC is enabled, by default, for both of these environments, such that it is possible to have a single “world wide” binary that is used on all platforms with just different resources plugged in at setup time.</p>
<p class=label>
<b>Localizing your Component’s Resources</b></p>
<p>
Localizing your application or DLL should involve simply replacing the resources with resources that match the target language. For your own resources, this is relatively simple: edit the resources in the resource editor and build your application. If your code is written properly there will be no strings or text that you wish to localize hard-coded into your C++ source code – all localization can be done by simply modifying resources. In fact, you can implement your component such that all providing a localized version does not even involve a build of the original code. This is more complex, but is well worth it and is the mechanism chosen for MFC itself. It is also possible to localize an application by loading the EXE or DLL file into the resource editor and editing the resources directly. While this is possible, it is requires re-application of those changes each time you build a new version of your application.</p>
<p>
One way to avoid that is to locate all resources in a separate DLL, sometimes called a satellite DLL. This DLL is then loaded dynamically at runtime and the resources are loaded from that DLL instead of from the main module with all your code. MFC directly supports this approach. Consider an application called MYAPP.EXE; it could have all of its resources located in a DLL called MYRES.DLL. In the application’s <b>InitInstance</b> it would perform the following to load that DLL and cause MFC to load resources from that location:</p>
<pre><code>CMyApp::InitInstance()
{
// one of the first things in the init code
HINSTANCE hInst = LoadLibrary(“myres.dll”);
if (hInst != NULL)
AfxSetResourceHandle(hInst);

// other initialization code would follow
.
.
.
}
</code></pre>
<p>
From then on, MFC will load resources from that DLL instead of from myapp.exe. All resources, however, must be present in that DLL – MFC will not search the application’s instance in search of a given resource. This technique applies equally well to regular DLLs as well as OLE Controls. Your setup program would copy the appropriate version of MYRES.DLL depending upon which resource locale the user would like.</p>
<p>
It is relatively easy to create a resource only DLL. You create a DLL project, add your .RC file to it, and add the necessary resources. If you have an existing project that does not use this technique, you can copy the resources from that project. After adding the resource file to the project you are almost ready to build the project. The only thing you must do is set the linker options to include<b> /NOENTRY</b>. This tells the linker that the DLL has no entry point – since it has no code, it has no entry point.</p>
<p class=indent>
<B><b>Note</b></B>&nbsp;&nbsp;&nbsp;The resource editor in Visual C++ 4.0 and later supports multiple languages per .RC file. This can make it very easy to manage your localization in a single project. The resources for each language is controlled by preprocessor directives generated by the resource editor.</p>
<p class=label>
<b>Using the Provided MFC Localized Resources</b></p>
<p>
Any MFC application that you build re-uses two things from MFC: code and resources. That is, MFC has various error messages, built-in dialogs, and other resources that are used by the MFC classes. In order to completely localize your application, you need to localize not only your application’s resources, but also the resources which come directly from MFC. MFC provides a number of different language resource files automatically, so that if the language you are targeting is one of the languages MFC already supports, you just need to make sure you use those localized resources. </p>
<p>
As of this writing MFC supports: Chinese, German, Spanish, French, Italian, Japanese, and Korean. The files which contain these localized versions are in the MFC\INCLUDE\L.* (the ‘L’ stands for localized) directories. The German files are in MFC\INCLUDE\L.DEU, for example. In order to cause your application to use these RC files instead of the files located in MFC\INCLUDE, simply add a <code>/IC:\PROGRAM FILES\DEVSTUDIO\VC\MFC\INCLUDE\L.DEU</code> to your RC command line (this is just an example – you would need to substitute your locale of choice as well as the directory into which you installed Visual C++).</p>
<p>
The above instructions will work if your application links statically with MFC. Most applications link dynamically (because that is the AppWizard default). In this scenario, not only the code is dynamically linked – so are the resources. As a result, you can localize your resources in your application, but the MFC implementation resources will still be loaded from the MFC4x.DLL (or a later version) or from MFC4xLOC.DLL if it exists. You can approach this from two different angles.</p>
<p class=indent>
<B><b>Feature Only in Professional and Enterprise Editions</b></B>&nbsp;&nbsp;&nbsp;Static linking to MFC is supported only in Visual C++ Professional and Enterprise Editions. For more information, see <object id=alink_1 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="DefaultTopic" value="_topic_not_found.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="vceditions">
</object><a href=JavaScript:alink_1.Click()>Visual C++ Editions</a>.</p>
<p>
The more complex approach is to ship one of the localized MFC4xLOC.DLLs (such as MFC4xDEU, for German, MFC4xESP.DLL for Spanish, etc.), or a later version, and install the appropriate MFC4xLOC.DLL into the system directory when the user installs your application. This can be very complex for both the developer and the end user and as such is not recommended. See <a href="_mfcnotes_tn056.htm">Technical Note 56</a> for more information on this technique and its caveats.</p>
<p>
The simplest and safest approach is to include the localized MFC resources in your application or DLL itself (or its satellite DLL if you are using one). This avoids the problems of installing MFC4xLOC.DLL properly. To do so, you follow the same instructions for the static case given above (setting the RC command line properly to point to the localized resources), except that you must also remove the <code>/D_AFXDLL</code> define that was added by AppWizard. When <code>/D_AFXDLL</code> is defined, AFXRES.H (and the other MFC RC files) don’t actually define any resources (because they will be pulled from the MFC DLLs instead).</p>
<p>
<a href="_mfcnotes_technical_notes_by_number.htm">Technical Notes by Number</a>  |&nbsp; <a href="_mfcnotes_technical_notes_by_category.htm">Technical Notes by Category</a></p>
</font></BODY>
</HTML>
