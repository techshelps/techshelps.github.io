<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>EXTENSION_CONTROL_BLOCK Structure</title>
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY>
<font face="verdana,arial,helvetica" size="2">
<h1><a name="_mfc_extension_control_block_structure"></a>EXTENSION_CONTROL_BLOCK Structure</h1>
<p>
The <b>EXTENSION_CONTROL_BLOCK</b> structure has the following form:</p>
<pre><code>typedef struct _EXTENSION_CONTROL_BLOCK {

 &nbsp;&nbsp; DWORD&nbsp;&nbsp;&nbsp;&nbsp; cbSize;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //IN
 &nbsp;&nbsp; DWORD&nbsp;&nbsp;&nbsp;&nbsp; dwVersion&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //IN
 &nbsp;&nbsp; HCONN&nbsp;&nbsp;&nbsp;&nbsp; ConnID;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //IN
 &nbsp;&nbsp; DWORD&nbsp;&nbsp;&nbsp;&nbsp; dwHttpStatusCode;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //OUT
 &nbsp;&nbsp; CHAR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lpszLogData[HSE_LOG_BUFFER_LEN];&nbsp;&nbsp;&nbsp; //OUT
 &nbsp;&nbsp; LPSTR&nbsp;&nbsp;&nbsp;&nbsp; lpszMethod;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //IN
 &nbsp;&nbsp; LPSTR&nbsp;&nbsp;&nbsp;&nbsp; lpszQueryString;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //IN
 &nbsp;&nbsp; LPSTR&nbsp;&nbsp;&nbsp;&nbsp; lpszPathInfo;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //IN
 &nbsp;&nbsp; LPSTR&nbsp;&nbsp;&nbsp;&nbsp; lpszPathTranslated;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //IN
 &nbsp;&nbsp; DWORD&nbsp;&nbsp;&nbsp;&nbsp; cbTotalBytes;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //IN
 &nbsp;&nbsp; DWORD&nbsp;&nbsp;&nbsp;&nbsp; cbAvailable;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //IN
 &nbsp;&nbsp; LPBYTE&nbsp;&nbsp;&nbsp; lpbData;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //IN
 &nbsp;&nbsp; LPSTR&nbsp;&nbsp;&nbsp;&nbsp; lpszContentType;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //IN

 &nbsp;&nbsp; BOOL ( WINAPI * GetServerVariable )
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ( HCONN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hConn,
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LPSTR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lpszVariableName,
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LPVOID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lpvBuffer,
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LPDWORD&nbsp;&nbsp;&nbsp;&nbsp; lpdwSize );

 &nbsp;&nbsp; BOOL ( WINAPI * WriteClient )
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ( HCONN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ConnID,
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LPVOID&nbsp;&nbsp;&nbsp;&nbsp; Buffer,
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LPDWORD&nbsp;&nbsp;&nbsp; lpdwBytes,
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dwReserved );

 &nbsp;&nbsp; BOOL ( WINAPI * ReadClient )
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ( HCONN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ConnID,
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LPVOID&nbsp;&nbsp;&nbsp;&nbsp; lpvBuffer,
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LPDWORD&nbsp;&nbsp;&nbsp; lpdwSize );

 &nbsp;&nbsp; BOOL ( WINAPI * ServerSupportFunction )
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ( HCONN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hConn,
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dwHSERRequest,
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LPVOID&nbsp;&nbsp;&nbsp;&nbsp; lpvBuffer,
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LPDWORD&nbsp;&nbsp;&nbsp; lpdwSize,
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LPDWORD&nbsp;&nbsp;&nbsp; lpdwDataType );

} EXTENSION_CONTROL_BLOCK, *LPEXTENSION_CONTROL_BLOCK;
</code></pre>
<p>
The server communicates with the ISA via the <b>EXTENSION_CONTROL_BLOCK</b>.</p>
<p>
The references to IN and OUT above indicates whether the member applies to messages to the extension (IN) or from the extension (OUT). </p>
<p class=label>
<b>Members</b></p>
<p>
The <b>EXTENSION_CONTROL_BLOCK</b> structure contains the following fields:</p>
<p class=dt>
<b>cbSize</b></p>
<p class=indent>
The size of this structure.</p>
<p class=dt>
<b>dwVersion</b></p>
<p class=indent>
The version information of&nbsp; <b>HTTP_FILTER_REVISION</b>. The <b>HIWORD</b> has the major version number and the <b>LOWORD</b> has the minor version number.</p>
<p class=dt>
<b>ConnID</b></p>
<p class=indent>
<b>&nbsp;</b>A unique number assigned by the HTTP server. It must not be modified.</p>
<p class=dt>
<b>dwHttpStatusCode</b></p>
<p class=indent>
The status of the current transaction when the request is completed. Can be one of the following:
<ul type=disc>
<li>
<b>HTTP_STATUS_BAD_REQUEST</b><br><br></li>
<li>
<b>HTTP_STATUS_AUTH_REQUIRED</b><br><br></li>
<li>
<b>HTTP_STATUS_FORBIDDEN</b><br><br></li>
<li>
<b>HTTP_STATUS_NOT_FOUND</b><br><br></li>
<li>
<b>HTTP_STATUS_SERVER_ERROR</b><br><br></li>
<li>
<b>HTTP_STATUS_NOT_IMPLEMENTED</b></li>
</ul>
<p class=dt>
<b>lpszLogData</b></p>
<p class=indent>
Buffer of size <b>HSE_LOG_BUFFER_LEN</b>. Contains a null-terminated log information string, specific to the ISA, of the current transaction. This log information will be entered in the HTTP server log. Maintaining a single log file with both HTTP server and ISA transactions is very useful for administration purposes.</p>
<p class=dt>
<b>lpszMethod</b></p>
<p class=indent>
The method with which the request was made. This is equivalent to the CGI variable <b>REQUEST_METHOD</b>.</p>
<p class=dt>
<b>lpszQueryString</b></p>
<p class=indent>
<b>&nbsp;</b>Null-terminated string containing the query information. This is equivalent to the CGI variable <b>QUERY_STRING</b>.</p>
<p class=dt>
<b>lpszPathInfo</b></p>
<p class=indent>
Null-terminated string containing extra path information given by the client. This is equivalent to the CGI variable <b>PATH_INFO</b>.</p>
<p class=dt>
<b>lpszPathTranslated</b></p>
<p class=indent>
Null-terminated string containing the translated path. This is equivalent to the CGI variable <b>PATH_TRANSLATED</b>.</p>
<p class=dt>
<b>cbTotalBytes</b></p>
<p class=indent>
The total number of bytes to be received from the client. This is equivalent to the CGI variable <b>CONTENT_LENGTH</b>. If this value is 0xffffffff, then there are four gigabytes or more of available data.&nbsp; In this case, <a href="_mfc_chttpservercontext.3a3a.readclient.htm">CHttpServerContext::ReadClient</a> should be called until no more data is returned.</p>
<p class=dt>
<b>cbAvailable</b></p>
<p class=indent>
The available number of bytes (out of a total of <b>cbTotalBytes</b>) in the buffer pointed to by <b>lpbData</b>. If <b>cbTotalBytes</b> is the same as <b>cbAvailable</b> the variable <b>lpbData</b> will point to a buffer which contains all the data sent by the client. Otherwise <b>cbTotalBytes</b> will contain the total number of bytes of data received. The ISA will then need to use the callback function <b>CHttpServerContext::ReadClient </b>to read the rest of the data (starting from an offset of <b>cbAvailable</b>).</p>
<p class=dt>
<b>lpbData</b></p>
<p class=indent>
Points to a buffer of size <b>cbAvailable</b> that has the data sent by the client.</p>
<p class=dt>
<b>lpszContentType</b></p>
<p class=indent>
Null-terminated string containing the content type of the data sent by the client. This is equivalent to the CGI variable <b>CONTENT_TYPE</b>.</p>
<p class=dt>
<b>GetServerVariable</b></p>
<p class=indent>
This function copies information (including CGI variables) relating to an HTTP connection, or to the server itself, into a buffer. <b>GetServerVariable</b> takes the following parameters:
<ul type=disc>
<li>
<i>hConn</i>&nbsp;&nbsp;&nbsp;A handle to a connection.<br><br></li>
<li>
<i>lpszVariableName</i>&nbsp;&nbsp;&nbsp;Null-terminated string indicating which variable is being requested. Variable names are:<table border=1 cellpadding=5 cols=2 frame=below rules=rows>
<tr valign=top>
<td class=label width=38%><b>Variable Name</b></td>
<td class=label width=62%><b>Description</b></td>
</tr>
<tr valign=top>
<td width=38%><b>ALL_HTTP</b></td>
<td width=62%>All HTTP headers that were not already parsed into one of the above variables. These variables are of the form HTTP_&lt;header field name&gt;.</td>
</tr>
<tr valign=top>
<td width=38%><b>AUTH_PASS</b></td>
<td width=62%>This will retrieve the password corresponding to <b>REMOTE_USER</b> as supplied by the client. It will be a null-terminated string.</td>
</tr>
<tr valign=top>
<td width=38%><b>AUTH_TYPE</b></td>
<td width=62%>Contains the type of authentication used.&nbsp; For example, if Basic authentication is used, the string will be "Basic". For Windows NT Challenge-response, it will be "NTLM". Other authentication schemes will have other strings. Because new authentication types can be added to Internet Server, it is not possible to list all possible strings. If the string is empty then no authentication is used.</td>
</tr>
<tr valign=top>
<td width=38%><b>CONTENT_LENGTH</b></td>
<td width=62%>The number of bytes which the script can expect to receive from the client.</td>
</tr>
<tr valign=top>
<td width=38%><b>CONTENT_TYPE</b></td>
<td width=62%>The content type of the information supplied in the body of a POST request.</td>
</tr>
<tr valign=top>
<td width=38%><b>GATEWAY_INTERFACE</b></td>
<td width=62%>The revision of the CGI specification to which this server complies. The current version is CGI/1.1.</td>
</tr>
<tr valign=top>
<td width=38%><b>HTTP_ACCEPT</b></td>
<td width=62%>Special case HTTP header. Values of the Accept: fields are concatenated, separated by ", ". For example, if the following lines are part of the HTTP header:<pre><code>accept: */*; q=0.1
accept: text/html
accept: image/jpeg</code></pre>
<p>
then the <b>HTTP_ACCEPT</b> variable will have a value of:</p>
<pre><code>*/*; q=0.1, text/html, image/jpeg</code></pre>
</td>
</tr>
<tr valign=top>
<td width=38%><b>PATH_INFO</b></td>
<td width=62%>Additional path information, as given by the client. This comprises the trailing part of the URL after the script name but before the query string (if any).</td>
</tr>
<tr valign=top>
<td width=38%><b>PATH_TRANSLATED</b></td>
<td width=62%>This is the value of PATH_INFO, but with any virtual path name expanded into a directory specification.</td>
</tr>
<tr valign=top>
<td width=38%><b>QUERY_STRING</b></td>
<td width=62%>The information which follows the <b>?</b> in the URL that referenced this script.</td>
</tr>
<tr valign=top>
<td width=38%><b>REMOTE_ADDR</b></td>
<td width=62%>The IP address of the client.</td>
</tr>
<tr valign=top>
<td width=38%><b>REMOTE_HOST</b></td>
<td width=62%>The hostname of the client.</td>
</tr>
<tr valign=top>
<td width=38%><b>REMOTE_USER</b></td>
<td width=62%>This contains the username supplied by the client and authenticated by the server.</td>
</tr>
<tr valign=top>
<td width=38%><b>REQUEST_METHOD</b></td>
<td width=62%>The HTTP request method.</td>
</tr>
<tr valign=top>
<td width=38%><b>SCRIPT_NAME</b></td>
<td width=62%>The name of the script program being executed.</td>
</tr>
<tr valign=top>
<td width=38%><b>SERVER_NAME</b></td>
<td width=62%>The server's hostname (or IP address) as it should appear in self-referencing URLs.</td>
</tr>
<tr valign=top>
<td width=38%><b>SERVER_PORT</b></td>
<td width=62%>The TCP/IP port on which the request was received.</td>
</tr>
<tr valign=top>
<td width=38%><b>SERVER_PROTOCOL</b></td>
<td width=62%>The name and version of the information retrieval protocol relating to this request. Normally HTTP/1.0.</td>
</tr>
<tr valign=top>
<td width=38%><b>SERVER_SOFTWARE</b></td>
<td width=62%>The name and version of the web server under which the CGI program is running.</td>
</tr>
</table><br>
</li>
<li>
<i>lpvBuffer</i>&nbsp;&nbsp;&nbsp;Pointer to buffer to receive the requested information.<br><br></li>
<li>
<i>lpdwSize</i>&nbsp;&nbsp;&nbsp;Pointer to <b>DWORD</b> indicating the number of bytes available in the buffer. On successful completion the <b>DWORD</b> contains the number of bytes transferred into the buffer (including the null terminating byte).</li>
</ul>
<p class=dt>
<b>WriteClient</b></p>
<p class=indent>
Sends information to the client from the indicated buffer. <b>WriteClient</b> takes the following parameters:
<ul type=disc>
<li>
<i>ConnID</i>&nbsp;&nbsp;&nbsp;A unique connection number assigned by the HTTP server.<br><br></li>
<li>
<i>Buffer</i>&nbsp;&nbsp;&nbsp;Pointer to the buffer where the data is to be written.<br><br></li>
<li>
<i>lpdwBytes</i>&nbsp;&nbsp;&nbsp;Pointer to the data to be written.<br><br></li>
<li>
<i>dwReserved</i>&nbsp;&nbsp;&nbsp;Reserved for future use.</li>
</ul>
<p class=dt>
<b>ReadClient</b></p>
<p class=indent>
Reads information from the body of the Web client's HTTP request into the buffer supplied by the caller. <b>ReadClient</b> takes the following parameters:
<ul type=disc>
<li>
<i>ConnID</i>&nbsp;&nbsp;&nbsp;A unique connection number assigned by the HTTP server.<br><br></li>
<li>
<i>lpvBuffer</i>&nbsp;&nbsp;&nbsp;Pointer to the buffer area to receive the requested information.<br><br></li>
<li>
<i>lpdwSize</i>&nbsp;&nbsp;&nbsp;Pointer to <b>DWORD</b> indicating the number of bytes available in the buffer. On return *<i>lpdwSize</i> will contain the number of bytes actually transferred into the buffer.</li>
</ul>
<p class=dt>
<b>ServerSupportFunction</b></p>
<p class=indent>
Provide the ISAs with some general-purpose functions as well as functions that are specific to HTTP server implementation. <b>ServerSupportFunction</b> takes the following parameters:
<ul type=disc>
<li>
<i>hConn</i>&nbsp;&nbsp;&nbsp;A handle to a connection.<br><br></li>
<li>
<i>dwHSERRequest</i>&nbsp;&nbsp;&nbsp;An HTTP Server Extension value. See <a href="_mfc_chttpservercontext.3a3a.serversupportfunction.htm">CHttpServerContext::ServerSupportFunction</a> for a list of possible values and related parameters.<br><br></li>
<li>
<i>lpvBuffer</i>&nbsp;&nbsp;&nbsp;When used with <b>HSE_REQ_SEND_RESPONSE_HEADER</b>, it points to a null-terminated optional status string (i.e., "401 Access Denied"). If this buffer is null, a default response of "200 Ok" will be sent by this function. When used with <b>HSE_REQ_DONE_WITH_SESSION</b>, it points to a <b>DWORD</b> indicating the status code of the request.<br><br></li>
<li>
<i>lpdwSize</i>&nbsp;&nbsp;&nbsp;When used with <b>HSE_REQ_SEND_RESPONSE_HEADER</b>, it points to the size of the buffer <i>lpdwDataType</i>.<br><br></li>
<li>
<i>lpdwDataType</i>&nbsp;&nbsp;&nbsp;A null-terminated string pointing to optional headers or data to be appended and sent with the header. If&nbsp; <b>NULL</b>, the header will be terminated by a “\r\n” pair.</li>
</ul>
<p class=label>
<b>Comments</b></p>
<p>
A server identifies files with the extensions&nbsp; .EXE and .BAT as CGI (Common Gateway Interface) executables. In addition, a server will identify a file with a DLL extension as a script to execute. </p>
<p>
When the server loads the DLL, it calls the DLL at the entry point <a href="_mfc_chttpserver.3a3a.getextensionversion.htm">CHttpServer::GetExtensionVersion</a> to get the version number of the&nbsp; <b>HTTP_FILTER_REVISION</b> the ISA is based on and a short text description for server administrators. For every client request, the <a href="_mfc_chttpserver.3a3a.httpextensionproc.htm">CHttpServer::HttpExtensionProc</a> entry point is called. The extension receives the commonly-needed information such as the query string, path info, method name, and the translated path. </p>
<p>
<b>See Also</b>&nbsp;&nbsp;&nbsp;<a href="_mfc_chttpservercontext.3a3a.readclient.htm">CHttpServerContext::ReadClient</a>, <a href="_mfc_chttpserver.3a3a.getextensionversion.htm">CHttpServer::GetExtensionVersion</a>, <a href="_mfc_chttpserver.3a3a.httpextensionproc.htm">CHttpServer::HttpExtensionProc</a></p>
</font></BODY>
</HTML>
