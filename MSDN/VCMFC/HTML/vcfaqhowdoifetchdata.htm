<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>How Do I Fetch Data?</title>
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY>
<font face="verdana,arial,helvetica" size="2">
<h1><a name="vcfaqhowdoifetchdata"></a>How Do I Fetch Data?</h1>
<p>
After you open the data source, session, and rowset objects, you can fetch data. Depending upon the type of accessor you are using, you may need to bind columns. To fetch data, follow these steps:
<ol>
<li>
Open the rowset using the appropriate <b>Open</b> command.<br><br></li>
<li>
If you are using <b>CManualAccessor</b>, bind the output columns if you have not already done so. To bind the columns, call <b>GetColumnInfo</b>, then create an accessor with the bindings, as shown here:<pre><code>// From the DBViewer Sample CDBTreeView::OnQueryEdit
// Get the column information
ULONG ulColumns&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 0;
DBCOLUMNINFO* pColumnInfo&nbsp; = NULL;
LPOLESTR pStrings&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = NULL;
if (rs.GetColumnInfo(&amp;ulColumns, &amp;pColumnInfo, &amp;pStrings) != S_OK)
AfxThrowOLEDBException(rs.m_pRowset, IID_IColumnsInfo);
struct MYBIND* pBind = new MYBIND[ulColumns];
rs.CreateAccessor(ulColumns, &amp;pBind[0], sizeof(MYBIND)*ulColumns);
for (ULONG l=0; l&lt;ulColumns; l++)
rs.AddBindEntry(l+1, DBTYPE_STR, sizeof(TCHAR)*40, &amp;pBind[l].szValue, NULL, &amp;pBind[l].dwStatus);
rs.Bind();
</code></pre>
</li>
<li>
Write a <b>while</b> loop to retrieve the data. In the loop, call <b>MoveNext</b> to advance the cursor and test the return value against <b>S_OK</b>, as shown in the following example:<pre><code>while (rs.MoveNext() == S_OK)
{
 &nbsp; // Add code to fetch data here
 &nbsp; // If you are not using an auto accessor, call rs.GetData()
}
</code></pre>
</li>
<li>
Within the <b>while</b> loop, you can fetch the data according to your accessor type. <ul type=disc>
<li>
If you use the <a href="vcrefcaccessor.htm">CAccessor</a> class, you should have a user record that contains data members. You can access your data using those data members, as shown here:<pre><code>while (rs.MoveNext() == S_OK)
{
 &nbsp; // Use the data members directly. In this case, m_nFooID
 &nbsp; // is declared in a user record that derives from
 &nbsp; // CAccessor
 &nbsp; wsprintf("%d", rs.m_nFooID); 
}
</code></pre>
</li>
<li>
If you use the <b>CDynamicAccessor</b> or <b>CDynamicParameterAccessor</b> class, you can fetch data by using the accessing functions <b>GetValue</b> and <b>GetColumn</b>, as shown in the following code. If you want to determine the type of data you are using, use <b>GetType</b>.<pre><code>while (rs.MoveNext() == S_OK)
{
 &nbsp; // Use the dynamic accessor functions to retrieve your
 &nbsp; // data

 &nbsp; ULONG ulColumns = rs.GetColumnCount();
 &nbsp; for (ULONG i=0; i&lt;ulColumns; i++)
 &nbsp; {
 &nbsp;&nbsp;&nbsp; rs.GetValue(i);
 &nbsp; }
}
</code></pre>
</li>
<li>
If you use <b>CManualAccessor</b>, you must specify your own data members, bind them yourself, and access them directly, as shown here:<pre><code>while (rs.MoveNext() == S_OK)
{
 &nbsp; // Use the data members you specified in the calls to
 &nbsp; // AddBindEntry.

 &nbsp; wsprintf("%s", szFoo);
}
</code></pre>
</li>
</ul>
</li>
</ol>
</font></BODY>
</HTML>
