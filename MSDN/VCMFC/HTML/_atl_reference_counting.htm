<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Reference Counting</title>
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY>
<font face="verdana,arial,helvetica" size="2">
<h1><a name="_atl_reference_counting"></a>Reference Counting</h1>
<p>
COM itself does not automatically try to remove an object from memory when it thinks the object is no longer being used. Instead, the object programmer must remove the unused object. The programmer determines whether an object can be removed based on a reference count.</p>
<p>
COM uses the <b>IUnknown</b> methods, <object id=alink_1 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="DefaultTopic" value="_topic_not_found.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_com_IUnknown_AddRef">
</object><a href=JavaScript:alink_1.Click()>AddRef</a> and <object id=alink_2 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="DefaultTopic" value="_topic_not_found.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_com_IUnknown_Release">
</object><a href=JavaScript:alink_2.Click()>Release</a>, to manage the reference count of interfaces on an object. The general rules for calling these methods are:
<ul type=disc>
<li>
Whenever a client receives an interface pointer, <b>AddRef</b> must be called on the interface.<br><br></li>
<li>
Whenever the client has finished using the interface pointer, it must call <b>Release</b>.</li>
</ul>
<p>
In a simple implementation, each <b>AddRef</b> call increments and each <b>Release</b> call decrements a counter variable inside the object. When the count returns to zero, the interface no longer has any users and is free to remove itself from memory.</p>
<p>
Reference counting can also be implemented so that each reference to the object (not to an individual interface) is counted. In this case, each <b>AddRef</b> and <b>Release</b> call delegates to a central implementation on the object, and <b>Release</b> frees the entire object when its reference count reaches zero.</p>
<p>
<a href="_atl_introduction_to_com.htm">Introduction to COM</a></p>
<p>
<b>See Also</b>&nbsp;&nbsp;&nbsp;<object id=alink_3 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="DefaultTopic" value="_topic_not_found.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_com_Managing_Object_Lifetimes_through_Reference_Counting">
</object><a href=JavaScript:alink_3.Click()>Managing Object Lifetimes through Reference Counting</a> in the <i>Win32 SDK</i></p>
</font></BODY>
</HTML>
