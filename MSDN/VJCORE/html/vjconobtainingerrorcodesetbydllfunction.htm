<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Obtaining the Error Code Set by a DLL Function</title>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<h1><a name="vjconobtainingerrorcodesetbydllfunction"></a>Obtaining the Error Code Set by a DLL Function</h1>
<p>
Do not invoke the Win32 function GetLastError to obtain an error code set by another DLL call. Because the Microsoft VM may execute function calls of its own in the process of executing Java code, the error code may have been overwritten by the time you get to it. </p>
<p>
To reliably access the error code set by a DLL function, you must use the <i>setLastError</i> modifier to instruct the VM to capture the error code immediately after invoking that method. For performance reasons, this is not done by default. You can then invoke the com.ms.dll.DllLib.getLastWin32Error method to retrieve the error code. Each Java thread maintains separate storage for this value. </p>
<p>
For example, the FindNextFile function returns status information through the error code. FindNextFile would be declared as follows:</p>
<pre><code>/** @dll.import("KERNEL32",setLastError) */
  static native boolean FindNextFile(int hFindFile,
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WIN32_FIND_DATA wfd);
</code></pre>
<p>
A typical call would appear as:</p>
<pre><code>import com.ms.dll.DllLib;
   
boolean f = FindNextFile(hFindFile, wfd);
if (!f) {
  int errorcode = DllLib.getLastWin32Error();
}
</code></pre>
</BODY>
</HTML>
