<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>AddressOf Operator Example</title>
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY>

<h2><a name="vaopraddressofx"></a>AddressOf Operator Example</h2>
<p>
The following example creates a form with a list box containing an alphabetically sorted list of the fonts in your system.</p>
<p>
To run this example, create a form with a list box on it. The code for the form is as follows:</p>
<pre><code>Option Explicit

Private Sub Form_Load()
 &nbsp;&nbsp; Module1.FillListWithFonts List1
End Sub
</code></pre>
<p>
Place the following code in a module. The third argument in the definition of the EnumFontFamilies function is a <b>Long</b> that represents a procedure. The argument must contain the address of the procedure, rather than the value that the procedure returns. In the call to EnumFontFamilies, the third argument requires the <b>AddressOf</b> operator to return the address of the EnumFontFamProc procedure, which is the name of the callback procedure you supply when calling the Windows API function, <b>EnumFontFamilies</b>. Windows calls EnumFontFamProc once for each of the font families on the system when you pass <b>AddressOf</b> EnumFontFamProc to <b>EnumFontFamilies</b>. The last argument passed to <b>EnumFontFamilies</b> specifies the list box in which the information is displayed.</p>
<pre><code>'Font enumeration types
Public Const LF_FACESIZE = 32
Public Const LF_FULLFACESIZE = 64

Type LOGFONT
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lfHeight As Long
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lfWidth As Long
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lfEscapement As Long
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lfOrientation As Long
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lfWeight As Long
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lfItalic As Byte
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lfUnderline As Byte
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lfStrikeOut As Byte
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lfCharSet As Byte
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lfOutPrecision As Byte
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lfClipPrecision As Byte
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lfQuality As Byte
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lfPitchAndFamily As Byte
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lfFaceName(LF_FACESIZE) As Byte
End Type

Type NEWTEXTMETRIC
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmHeight As Long
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmAscent As Long
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmDescent As Long
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmInternalLeading As Long
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmExternalLeading As Long
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmAveCharWidth As Long
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmMaxCharWidth As Long
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmWeight As Long
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmOverhang As Long
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmDigitizedAspectX As Long
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmDigitizedAspectY As Long
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmFirstChar As Byte
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmLastChar As Byte
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmDefaultChar As Byte
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmBreakChar As Byte
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmItalic As Byte
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmUnderlined As Byte
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmStruckOut As Byte
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmPitchAndFamily As Byte
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmCharSet As Byte
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ntmFlags As Long
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ntmSizeEM As Long
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ntmCellHeight As Long
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ntmAveWidth As Long
End Type

' ntmFlags field flags
Public Const NTM_REGULAR = &amp;H40&amp;
Public Const NTM_BOLD = &amp;H20&amp;
Public Const NTM_ITALIC = &amp;H1&amp;

'&nbsp; tmPitchAndFamily flags
Public Const TMPF_FIXED_PITCH = &amp;H1
Public Const TMPF_VECTOR = &amp;H2
Public Const TMPF_DEVICE = &amp;H8
Public Const TMPF_TRUETYPE = &amp;H4

Public Const ELF_VERSION = 0
Public Const ELF_CULTURE_LATIN = 0

'&nbsp; EnumFonts Masks
Public Const RASTER_FONTTYPE = &amp;H1
Public Const DEVICE_FONTTYPE = &amp;H2
Public Const TRUETYPE_FONTTYPE = &amp;H4

Declare Function EnumFontFamilies Lib "gdi32" Alias _
    "EnumFontFamiliesA" _
    (ByVal hDC As Long, ByVal lpszFamily As String, _ 
    ByVal lpEnumFontFamProc As Long, LParam As Any) As Long
Declare Function GetDC Lib "user32" (ByVal hWnd As Long) As Long
Declare Function ReleaseDC Lib "user32" (ByVal hWnd As Long, _
    ByVal hDC As Long) As Long

Function EnumFontFamProc(lpNLF As LOGFONT, lpNTM As NEWTEXTMETRIC, _ 
    ByVal FontType As Long, LParam As ListBox) As Long
Dim FaceName As String
Dim FullName As String
 &nbsp;&nbsp; FaceName = StrConv(lpNLF.lfFaceName, vbUnicode)
 &nbsp;&nbsp; LParam.AddItem Left$(FaceName, InStr(FaceName, vbNullChar) - 1)
 &nbsp;&nbsp; EnumFontFamProc = 1
End Function

Sub FillListWithFonts(LB As ListBox)
Dim hDC As Long
 &nbsp;&nbsp; LB.Clear
 &nbsp;&nbsp; hDC = GetDC(LB.hWnd)
 &nbsp;&nbsp; EnumFontFamilies hDC, vbNullString, <span class=cfe><b>AddressOf</b></span> EnumFontFamProc, LB
 &nbsp;&nbsp; ReleaseDC LB.hWnd, hDC
End Sub
</code></pre>
</BODY>
</HTML>
