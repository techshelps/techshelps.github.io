<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<HEAD>
<meta name="PREMIUM" content="MSDN">
<meta http-equiv="Content-Type" content="text/html; charset=iso8859-1">
<meta name="MS.LOCALE" content="EN-US">
<meta name="DESCRIPTION" content="This page is from the Microsoft Proxy Server book, found in the Tools and Technologies Section in the MSDN Library">



<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>CHAPTER 7, Configuring the WinSock Proxy Service</title>
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>


<BODY bgcolor="#FFFFFF" link=#003399 vlink=#996699>


<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

	<!--TOOLBAR_START-->
	<!--TOOLBAR_EXEMPT-->
	<!--TOOLBAR_END-->

<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

<p align="left"><a name="Top"><font size="2"
face="Verdana, Arial, Helvetica"><img src="onepix.gif" alt="Space"
align="top" width="1" height="1"></font></a></p>

<hr>

<h1><a name="ConfiguringtheWSPService"><font size="6"
face="Verdana, Arial, Helvetica">Configuring the WinSock Proxy Service</font></a></h1>

<blockquote>
    <p><a href="#07100h1"><font size="2" face="Verdana, Arial, Helvetica">Overview
    of WinSock Proxy Service Configuration<br>
    </font></a><a href="#07200h1"><font size="2"
    face="Verdana, Arial, Helvetica">Configuring WinSock Proxy Protocols
    and Ports<br>
    </font></a><a href="#07300h1"><font size="2"
    face="Verdana, Arial, Helvetica">Setting Up WinSock Proxy Users<br>
    </font></a><a href="#07400h1"><font size="2"
    face="Verdana, Arial, Helvetica">Controlling WinSock Proxy User Access
    to Internet Sites<br>
    </font></a><a href="#07500h1"><font size="2"
    face="Verdana, Arial, Helvetica">Logging WinSock Proxy Service
    Activity</font></a><font size="2" face="Verdana, Arial, Helvetica"><br>
    </font><a href="#07777h1"><font size="2"
    face="Verdana, Arial, Helvetica">Setting WinSock Proxy Access Control</font></a></p>
</blockquote>

<hr>

<h1><a href="#Top"><font size="2" face="Verdana, Arial, Helvetica"><img
src="up.gif" alt="To Top" align="middle" border="0" width="14"
height="11"></font></a><a name="07100h1"><font size="2"
face="Verdana, Arial, Helvetica">Overview of WinSock Proxy Service
Configuration</font></a></h1>

<p><font size="2" face="Verdana, Arial, Helvetica">After you have
installed Microsoft Proxy Server, you will usually perform the
following steps to configure the WinSock Proxy service:</font></p>

<ul>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Set
        up protocols and ports, to determine which Windows
        Sockets applications are allowed to access the Internet
        by using the WinSock Proxy service. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Set
        up permissions, to determine which Windows&nbsp;NT groups
        or users are granted the ability to use each of the
        Internet protocols supported by the WinSock Proxy
        service. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Set
        up filtering, to determine the specific Internet sites
        that all users of the WinSock Proxy service are allowed
        to access. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Set
        up logging, to determine how WinSock Proxy service
        activity information is saved in the WinSock Proxy
        service log. </font></p>
    </li>
</ul>

<p><font size="2" face="Verdana, Arial, Helvetica">These steps are
described in this chapter.</font></p>

<p><font size="2" face="Verdana, Arial, Helvetica"><strong>Note</strong>&nbsp;&nbsp;&nbsp;If
the WinSock Proxy service is stopped, you can use Internet
Service Manager to change its configuration settings but the
changes will not take effect until you restart the service.</font></p>

<hr>

<h1><a href="#Top"><font size="2" face="Verdana, Arial, Helvetica"><img
src="up.gif" alt="To Top" align="middle" border="0" width="14"
height="11"></font></a><a name="07200h1"><font size="2"
face="Verdana, Arial, Helvetica">Configuring WinSock Proxy Protocols and
Ports</font></a></h1>

<blockquote>
    <p><a href="#07940h1"><font size="2" face="Verdana, Arial, Helvetica">Setting
    Up Protocol Configurations<br>
    </font></a><a href="#07941h1"><font size="2"
    face="Verdana, Arial, Helvetica">About the Predefined Protocol
    Configurations</font></a></p>
</blockquote>

<h2><a href="#Top"><font size="2" face="Verdana, Arial, Helvetica"><img
src="up.gif" alt="To Top" align="middle" border="0" width="14"
height="11"></font></a><a name="07940h1"><font size="2"
face="Verdana, Arial, Helvetica">Setting Up Protocol Configurations</font></a></h2>

<p><font size="2" face="Verdana, Arial, Helvetica">Protocol configurations
determine which Windows Sockets applications can be used to
access the Internet through the WinSock Proxy service on a
server, and for each protocol configuration, which ports can be
used for outbound and inbound connections. You create, modify,
and delete protocol configurations by using the <strong>Protocols</strong>
property sheet in the <strong>WinSock Proxy Service Properties</strong>
window.</font></p>

<p><font size="2" face="Verdana, Arial, Helvetica">When Microsoft Proxy
Server is installed, some default protocol configurations are
created by the Setup program. These are described in </font><a
href="#07941h1"><font size="2" face="Verdana, Arial, Helvetica">Default
Protocol Configurations,</font></a><font size="2"
face="Verdana, Arial, Helvetica"> later in this chapter.</font></p>

<h4><a name="Tosetupprotocolconfigurations"><font size="2"
face="Verdana, Arial, Helvetica"><strong>To set up protocol configurations</strong></font></a></h4>

<ol>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">From
        Internet Service Manager, open the <strong>WinSock Proxy
        Service Properties</strong> window for the server to be
        administered, and click the <strong>Protocols</strong>
        tab. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">To
        create a protocol configuration and add it to the list of
        protocols that can be used to access the Internet through
        the WinSock Proxy service on the server, click <strong>Add</strong>
        and complete the <strong>Protocol Definition</strong>
        dialog box. </font></p>
        <p align="left"><font size="2" face="Verdana, Arial, Helvetica">See
        the next procedure for instructions on how to complete
        the <strong>Protocol Definition</strong> dialog box. </font></p>
        <p align="left"><font size="2" face="Verdana, Arial, Helvetica">When
        the <strong>Protocol Definition</strong> dialog is
        completed and you click <strong>OK</strong>, the WinSock
        Proxy <strong>Protocols</strong> property sheet returns
        and the protocol is added to the <strong>Protocol
        Definitions</strong> list. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">To
        modify the settings for a configured protocol, select a
        protocol from the <strong>Protocol Definitions</strong>
        list, click <strong>Edit</strong>, and modify the
        settings in the <strong>Protocol Definition</strong>
        dialog box. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">To
        delete a protocol configuration, select it from the <strong>Protocol
        Definitions</strong> list and click <strong>Remove</strong>.
        </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Repeat
        steps 2-4 until all protocol configurations are defined
        appropriately for the WinSock Proxy service on this
        server. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Click
        <strong>OK</strong> to save the settings. </font></p>
    </li>
</ol>

<p><font size="2" face="Verdana, Arial, Helvetica">The preceding procedure
sets protocol configurations for one server. If your network has
more than one server running the WinSock Proxy service, repeat
the procedure for each server.</font></p>

<h4><a name="TodefineaprotocolintheProtocolDefinitiondialogbox"><font
size="2" face="Verdana, Arial, Helvetica"><strong>To define a protocol in
the Protocol Definition dialog box</strong></font></a></h4>

<ol>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">From
        the WinSock Proxy <strong>Protocols</strong> property
        sheet, open the <strong>Protocol Definition</strong>
        dialog box as described in the preceding procedure. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">In
        the <strong>Protocol Name</strong> box, type a name for
        this protocol configuration. </font></p>
        <p align="left"><font size="2" face="Verdana, Arial, Helvetica">This
        name will appear in lists of protocol configurations, in
        the WinSock Proxy <strong>Protocols</strong> and <strong>Permissions</strong>
        property sheets when this server is administered. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">In
        the <strong>Port</strong> box, type the number of the
        port on the server that will be used for the initial
        connection. </font></p>
        <p align="left"><font size="2" face="Verdana, Arial, Helvetica">For
        a discussion of ports, see </font><a
        href="05_msp.htm#Top"><font size="2"
        face="Verdana, Arial, Helvetica">&#147;Server
        Administration.&#148;</font></a><font size="2"
        face="Verdana, Arial, Helvetica"> </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Under
        <strong>Type</strong>, specify the protocol type used for
        initial connections. Select <strong>TCP</strong> (for
        Transmission Control Protocol) or <strong>UDP</strong>
        (for User Datagram Protocol). </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Under
        <strong>Direction</strong>, specify whether the initial
        connection port will be configured for <strong>Outbound</strong>
        or <strong>Inbound</strong>. </font></p>
        <ul>
            <li><p align="left"><font size="2"
                face="Verdana, Arial, Helvetica">If you selected <strong>TCP</strong>
                as the <strong>Type</strong>, select <strong>Outbound</strong>
                to allow clients to initiate connections to
                external sites through this port. Select <strong>Inbound</strong>
                to allow external sites to initiate connections
                to clients through the port. </font></p>
            </li>
            <li><p align="left"><font size="2"
                face="Verdana, Arial, Helvetica">If you selected <strong>UDP</strong>
                as the <strong>Type</strong>, select <strong>Outbound</strong>
                to allow the port to pass packets sent from a
                client to an external site. Select <strong>Inbound</strong>
                to allow the port to pass packets sent from an
                external site to a client. </font></p>
            </li>
        </ul>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Use
        the <strong>Port Ranges for Subsequent Connections</strong>
        options to define how to handle connections or packets
        that originate as a result of requests or packets sent on
        the initial connection&#146;s port number. The list under
        <strong>Port Ranges for Subsequent Connections</strong>
        displays the port, packet type, and direction for each
        subsequent connection configuration (if any exist). There
        can be one or more configurations for subsequent
        connections in this list. </font></p>
        <p align="left"><font size="2" face="Verdana, Arial, Helvetica"><strong>Note</strong>&nbsp;&nbsp;&nbsp;A
        port range setting of 0 for inbound connections indicates
        <strong>Port_Any</strong>, which allows the server to
        select the port from the range 1024-5000. </font></p>
        <ul>
            <li><p align="left"><font size="2"
                face="Verdana, Arial, Helvetica">To specify a port or port
                range that will be used for subsequent
                connections, click <strong>Add</strong>, and
                complete the <strong>Port Range Definition</strong>
                dialog box. See the next procedure for
                instructions on how to complete the <strong>Port
                Range Definition</strong> dialog box. </font></p>
            </li>
            <li><p align="left"><font size="2"
                face="Verdana, Arial, Helvetica">To modify the settings
                for a port range for a subsequent connection,
                select the port range from the <strong>Port
                Ranges for Subsequent Connections</strong> list,
                click <strong>Edit</strong>, and complete the <strong>Port
                Range Definition</strong> dialog box. </font></p>
            </li>
            <li><p align="left"><font size="2"
                face="Verdana, Arial, Helvetica">To remove a port or port
                range from the list of those that will be used
                for subsequent connections, select the port range
                from the <strong>Port Ranges for Subsequent
                Connections</strong> list and click <strong>Remove</strong>.
                </font></p>
            </li>
        </ul>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Click
        <strong>OK</strong>. The WinSock Proxy <strong>Protocols</strong>
        property sheet returns. The new or modified protocol
        configuration appears in the <strong>Protocol Definitions
        </strong>list. </font></p>
    </li>
</ol>

<p><font size="2" face="Verdana, Arial, Helvetica">Subsequent connections
are those that originate as a result of requests or packets sent
on the initial connection&#146;s port number. The subsequent
connection parameters include the port number or range, the
protocol type, and the direction. </font></p>

<h4><a name="Todefineparametersforsubsequentconnections"><font
size="2" face="Verdana, Arial, Helvetica"><strong>To define parameters for
subsequent connections</strong></font></a></h4>

<ol>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">From
        the <strong>Protocol Definition</strong> dialog box open
        the <strong>Port Range Definition</strong> dialog box, as
        described in the preceding procedure. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">In
        the <strong>Port or Range</strong> boxes, type a single
        port or a range of port numbers to use to receive
        connections or packets that originate as a result of
        requests or packets sent on the initial connection&#146;s
        port number. Note that you can type 0 to indicate <strong>Any</strong>,
        which allows connections to ports 1024-5000. </font></p>
        <p align="left"><font size="2" face="Verdana, Arial, Helvetica">For
        a discussion of ports, see </font><a
        href="05_msp.htm#Top"><font size="2"
        face="Verdana, Arial, Helvetica">&#147;Server
        Administration.&#148;</font></a><font size="2"
        face="Verdana, Arial, Helvetica"> </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Under
        <strong>Type</strong>, specify the protocol type that
        will be used for subsequent connections. Select <strong>TCP</strong>
        (for Transmission Control Protocol) or <strong>UDP</strong>
        (for User Datagram Protocol). </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Under
        <strong>Direction</strong>, specify whether the
        subsequent connection ports will be configured for <strong>Inbound</strong>
        or <strong>Outbound</strong>. </font></p>
        <ul>
            <li><p align="left"><font size="2"
                face="Verdana, Arial, Helvetica">If you selected <strong>TCP</strong>
                as the <strong>Type</strong>, select <strong>Inbound</strong>
                to allow external sites to initiate connections
                to clients through the ports. Select <strong>Outbound</strong>
                to allow clients to initiate connections to
                external sites through the port. </font></p>
            </li>
            <li><p align="left"><font size="2"
                face="Verdana, Arial, Helvetica">If you selected <strong>UDP</strong>
                as the <strong>Type</strong>, select <strong>Outbound</strong>
                to allow the ports to pass packets sent from a
                client to an external site. Select <strong>Inbound</strong>
                to allow the ports to pass packets sent from an
                external site to a client. </font></p>
            </li>
        </ul>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Click
        <strong>OK</strong>. The <strong>Protocol Definition</strong>
        dialog box returns. The new or modified subsequent
        connection configuration appears in the <strong>Port
        Ranges for Subsequent Connections</strong> list. </font></p>
    </li>
</ol>

<p align="left"><font size="2" face="Verdana, Arial, Helvetica">When a new
protocol configuration is created it does not have any
permissions granted. To allow users to use the protocol to access
the Internet, permissions must be granted as described in </font><a
href="#07300h1"><font size="2" face="Verdana, Arial, Helvetica">Setting Up
WinSock Proxy Users,</font></a><font size="2"
face="Verdana, Arial, Helvetica"> later in this chapter.</font></p>

<h2><a href="#Top"><font size="2" face="Verdana, Arial, Helvetica"><img
src="up.gif" alt="To Top" align="middle" border="0" width="14"
height="11"></font></a><a name="07941h1"><font size="2"
face="Verdana, Arial, Helvetica">About the Predefined Protocol
Configurations</font></a></h2>

<p><font size="2" face="Verdana, Arial, Helvetica">Microsoft Proxy Server
Setup installs a default set of predefined WinSock Proxy protocol
configurations on the server. These appear in the <strong>Protocols</strong>
lists in the WinSock Proxy <strong>Protocols</strong> and <strong>Permissions</strong>
properties sheets. You are not limited to these predefined
protocol configurations, nor are you restricted to Windows
Sockets applications that work with these predefined protocol
configurations. Use the WinSock Proxy Protocols property sheet to
add additional protocol configurations that support additional
Windows Sockets applications.</font></p>

<h4><a
name="Toreviewthedefaultparameterssetforapredefinedprotocolconfiguration"><font
size="2" face="Verdana, Arial, Helvetica"><strong>To review the default
parameters set for a predefined protocol configuration</strong></font></a></h4>

<ol>
    <li><font size="2" face="Verdana, Arial, Helvetica">Select a protocol
        from the list in the WinSock Proxy <strong>Protocols</strong>
        property sheet.</font></li>
    <li><font size="2" face="Verdana, Arial, Helvetica">Click <strong>Edit</strong>.</font></li>
</ol>

<hr>

<h1><a href="#Top"><font size="2" face="Verdana, Arial, Helvetica"><img
src="up.gif" alt="To Top" align="middle" border="0" width="14"
height="11"></font></a><a name="07300h1"><font size="2"
face="Verdana, Arial, Helvetica">Setting Up WinSock Proxy Users</font></a></h1>

<p><font size="2" face="Verdana, Arial, Helvetica">WinSock Proxy
permissions determine which users or groups of users can access
the Internet by using a particular protocol configuration through
the WinSock Proxy service on a server. Permissions are granted
separately for each protocol configuration. </font></p>

<p><font size="2" face="Verdana, Arial, Helvetica">When Microsoft Proxy
Server is installed, by default there are no WinSock Proxy
permissions granted. You must grant permissions before users can
access the Internet by using the WinSock Proxy service.</font></p>

<p><font size="2" face="Verdana, Arial, Helvetica">Before assigning
WinSock Proxy permissions it is a good idea to use User Manager
for Domains to create user groups containing the user accounts of
users who need access to a particular protocol or sets of
protocols. Then you can apply permissions to groups, rather than
to individual users. For more information about user groups and
about User Manager for Domains, see </font><a
href="05_msp.htm#Top"><font size="2" face="Verdana, Arial, Helvetica">&#147;Server Administration.&#148;</font></a><font size="2"
face="Verdana, Arial, Helvetica"> Also see your documentation for
Windows&nbsp;NT. </font></p>

<h4><a name="Tosetpermissionstouseprotocols"><font size="2"
face="Verdana, Arial, Helvetica"><strong>To set permissions to use
protocols</strong></font></a></h4>

<ol>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">From
        Internet Service Manager, open the <strong>WinSock Proxy
        Service Properties</strong> window for the server to be
        administered, and click the <strong>Permissions</strong>
        tab. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">To
        grant a user or group the right to use a protocol to
        access the Internet through the WinSock Proxy service on
        this server, select the protocol from the list in the <strong>Protocol</strong>
        box, choose <strong>Add</strong>, and complete the <strong>Add
        Users and Groups</strong> dialog box that appears. </font></p>
        <ul>
            <li><p align="left"><font size="2"
                face="Verdana, Arial, Helvetica">A special selection in
                the <strong>Protocol</strong> list, <strong>Unlimited
                Access</strong>, allows access to all protocols
                and all ports of this server. This includes ports
                not defined in any protocol configuration. Also,
                users granted <strong>Unlimited Access</strong>
                are not affected by WinSock Proxy domain
                filtering. Grant permission to <strong>Unlimited
                Access</strong> only to users who should have
                such access. </font></p>
            </li>
            <li><p align="left"><font size="2"
                face="Verdana, Arial, Helvetica">When you select a
                protocol from the list, the <strong>Grant Access
                To</strong> box lists the users and groups that
                are already granted permissions for that
                protocol. </font></p>
            </li>
        </ul>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">To
        remove a user or group from the list of those granted the
        right to use a protocol to access the Internet through
        the WinSock Proxy service on the server, select the
        protocol from the <strong>Protocol</strong> box, select
        the user or group from the <strong>Grant Access To</strong>
        list, and choose <strong>Remove</strong>. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">When
        permissions are set appropriately for the selected
        protocol, select another protocol from the list, and
        grant or remove permissions as necessary. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">When
        all protocols have their permissions set appropriately,
        click <strong>OK</strong>. </font></p>
    </li>
</ol>

<p><font size="2" face="Verdana, Arial, Helvetica">This procedure sets
permissions for one server. If your network has more than one
server running the WinSock Proxy service, repeat the procedure
for each server.</font></p>

<p><font size="2" face="Verdana, Arial, Helvetica">For convenience, you
can copy user permissions from one protocol to one or more other
protocols. You can also remove user permissions from several
protocols at once.</font></p>

<h4><a name="Tomodifyseveralprotocolsatonce"><font size="2"
face="Verdana, Arial, Helvetica"><strong>To modify several protocols at
once</strong></font></a></h4>

<ol>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">From
        Internet Service Manager, open the <strong>WinSock Proxy
        Service Properties</strong> window for the server to be
        administered, and click the <strong>Permissions</strong>
        tab. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Select
        a protocol from the <strong>Protocol</strong> list, then
        select one more users and groups from <strong>Grant
        Access To</strong> list. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Choose
        either <strong>Copy To</strong> or <strong>Remove From</strong>.
        </font></p>
        <ul>
            <li><p align="left"><font size="2"
                face="Verdana, Arial, Helvetica">To grant those users and
                groups permissions to use several protocols,
                click <strong>Copy To</strong> and complete the <strong>Protocol
                Selection</strong> dialog box that appears. </font></p>
            </li>
            <li><p align="left"><font size="2"
                face="Verdana, Arial, Helvetica">To remove permissions for
                those users and groups to use several protocols,
                click <strong>Remove From</strong>, and complete
                the <strong>Protocol Selection</strong> dialog
                box that appears. </font></p>
            </li>
        </ul>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">When
        permissions are set appropriately for the users of the
        selected protocol, repeat steps 2 and 3 as necessary. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">When
        all protocols and users have their permissions set
        appropriately, click <strong>OK</strong>. </font></p>
    </li>
</ol>

<p><font size="2" face="Verdana, Arial, Helvetica">The protocol
configurations that appear in the <strong>Protocol</strong> list
in the <strong>Permissions</strong> property sheet are added,
removed, and modified by using the <strong>Protocols</strong>
property sheet, as described in </font><a href="#07200h1"><font
size="2" face="Verdana, Arial, Helvetica">Configuring WinSock Proxy
Protocols and Ports,</font></a><font size="2"
face="Verdana, Arial, Helvetica"> earlier in this chapter.</font></p>

<hr>

<h1><a href="#Top"><font size="2" face="Verdana, Arial, Helvetica"><img
src="up.gif" alt="To Top" align="middle" border="0" width="14"
height="11"></font></a><a name="07400h1"><font size="2"
face="Verdana, Arial, Helvetica">Controlling WinSock Proxy User Access to
Internet Sites</font></a></h1>

<p><font size="2" face="Verdana, Arial, Helvetica">You can allow or
prevent client access to specific Internet sites. This is called
filtering, and is accomplished on per-server basis. It applies to
all users who access the Internet by using either service (Web
Proxy or WinSock Proxy) on that server.</font></p>

<p><font size="2" face="Verdana, Arial, Helvetica">You can allow or
prevent access to a single computer, a group of computers, or an
Internet domain. You can control access by IP address, subnet
mask, and domain name.</font></p>

<p><font size="2" face="Verdana, Arial, Helvetica">Note that for the
WinSock Proxy service, filtering by domain name does not affect
Internet requests where the client application accesses a site by
using an IP address. To effectively filter a site you may find it
useful to create filters both on the domain name and the IP
address.</font></p>

<h4><a name="TocontroluseraccesstoInternetsites"><font size="2"
face="Verdana, Arial, Helvetica"><strong>To control user access to
Internet sites</strong></font></a></h4>

<ol>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">From
        Internet Service Manager, open the <strong>WinSock Proxy
        Service Properties</strong> window for the server to be
        administered, and click the <strong>Filters</strong> tab.
        </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Select
        the <strong>Enable Filtering</strong> option. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Select
        the filtering mode. Set an overall policy first, then
        specify exceptions to that policy. </font></p>
        <ul>
            <li><p align="left"><font size="2"
                face="Verdana, Arial, Helvetica">To deny access to
                specific Internet sites, select <strong>Granted</strong>.
                </font></p>
                <p align="left"><font size="2"
                face="Verdana, Arial, Helvetica">Users will be denied
                access to those Internet sites that appear in the
                <strong>Except to those listed below</strong>
                list, and will be allowed access to all other
                Internet sites. </font></p>
            </li>
            <li><p align="left"><font size="2"
                face="Verdana, Arial, Helvetica">Select <strong>Denied</strong>
                to allow access to specific Internet sites. </font></p>
                <p align="left"><font size="2"
                face="Verdana, Arial, Helvetica">Users will be allowed
                access to specific Internet sites that appear in
                the <strong>Except to those listed below</strong>
                list, and will be denied access to all other
                Internet sites. </font></p>
            </li>
        </ul>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">To
        create a filter, click <strong>Add</strong> and complete
        the dialog box that appears. </font></p>
        <ul>
            <li><p align="left"><font size="2"
                face="Verdana, Arial, Helvetica">Select <strong>Single
                Computer</strong> to filter a single computer. If
                you select this option, you must also enter that
                computer&#146;s IP address in the <strong>IP
                Address</strong> box. </font></p>
            </li>
            <li><p align="left"><font size="2"
                face="Verdana, Arial, Helvetica">Select <strong>Group of
                Computers</strong> to filter a group of
                computers. If you select this option you must
                enter an IP address in the <strong>IP Address</strong>
                box, and a subnet mask in the <strong>Subnet Mask</strong>
                box. </font></p>
            </li>
            <li><p align="left"><font size="2"
                face="Verdana, Arial, Helvetica">Select <strong>Domain</strong>
                to filter a domain. If you select this option,
                enter a domain name in the <strong>Domain</strong>
                box. </font></p>
            </li>
            <li><p align="left"><font size="2"
                face="Verdana, Arial, Helvetica">When you have completed
                the dialog box, click <strong>OK</strong>. The <strong>Filters</strong>
                tab returns, with the new filter added to the <strong>Except
                to those listed below</strong> list. </font></p>
            </li>
        </ul>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Repeat
        step 4 until all needed filters are defined for this
        server. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">To
        alter a listed filter, select it from the list, click <strong>Edit</strong>,
        and modify the settings in the dialog box that appears. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">To
        remove a filter from the list, select the item and click <strong>Remove</strong>.
        </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Click
        <strong>OK</strong>. </font></p>
    </li>
</ol>

<p><font size="2" face="Verdana, Arial, Helvetica"><strong>Note</strong>&nbsp;&nbsp;&nbsp;Only
the selected mode, <strong>Granted</strong> or <strong>Denied</strong>,
is in effect. If you switch between modes, filters created for
the deselected mode are retained, but are not in effect.</font></p>

<p><font size="2" face="Verdana, Arial, Helvetica">This procedure sets up
filtering for one server. If your network has more than one
server running Microsoft Proxy Server, repeat the procedure for
each server.</font></p>

<hr>

<h1><a href="#Top"><font size="2" face="Verdana, Arial, Helvetica"><img
src="up.gif" alt="To Top" align="middle" border="0" width="14"
height="11"></font></a><a name="07500h1"><font size="2"
face="Verdana, Arial, Helvetica">Logging WinSock Proxy Service Activity</font></a></h1>

<p><font size="2" face="Verdana, Arial, Helvetica">Microsoft Proxy Server
can log information about all Internet requests made by WinSock
Proxy service clients. It can log to a text file or to a table in
an ODBC-compliant database (such as Microsoft Access or Microsoft
SQL Server). </font></p>

<p><font size="2" face="Verdana, Arial, Helvetica">By default, WinSock
Proxy service information is logged to a text file. After
installing Microsoft Proxy Server, you can set the configuration
parameters for text file logging, or you can set up logging to an
ODBC-compliant database.</font></p>

<h4><a
name="TologWinSockProxyserviceinformationtoatextfileandsettheloggingparameters"><font
size="2" face="Verdana, Arial, Helvetica"><strong>To log WinSock Proxy
service information to a text file and set the logging parameters</strong></font></a></h4>

<ol>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">From
        Internet Service Manager, open the <strong>WinSock Proxy
        Service Properties</strong> window for the server to be
        administered, and click the <strong>Logging</strong> tab.
        </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Make
        sure the <strong>Enable Logging</strong> option is
        selected. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Select
        either <strong>Regular Logging</strong> or <strong>Verbose
        Logging</strong>. </font></p>
        <p align="left"><font size="2" face="Verdana, Arial, Helvetica"><strong>Regular
        Logging</strong> records only a subset of all available
        information for each Internet access. This option reduces
        the disk space needed for a log file. <strong>Verbose
        Logging</strong> records all available information for
        each Internet access. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Make
        sure the <strong>Log to File</strong> option is selected.
        </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Select
        or clear the <strong>Automatically open new log</strong>
        option. </font></p>
        <p align="left"><font size="2" face="Verdana, Arial, Helvetica">Select
        this option to periodically create a new WinSock Proxy
        service log file, using the interval specified by the <strong>Daily,
        Weekly, Monthly,</strong> or <strong>When File Size
        Reaches</strong> options. When a new log file is started,
        the old log file is closed (and can optionally be
        archived on other storage media). </font></p>
        <p align="left"><font size="2" face="Verdana, Arial, Helvetica">Clear
        this option to use the same WinSock Proxy log file
        continuously. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">If
        you select the <strong>Automatically open new log</strong>
        option, specify the interval used to open a new log file.
        Select <strong>Daily, Weekly, Monthly,</strong> or <strong>When
        File Size Reaches</strong>. If you select <strong>When
        File Size Reaches</strong>, also enter a value in the <strong>MB</strong>
        box. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Review
        and if appropriate change the log file directory. </font></p>
        <p align="left"><font size="2" face="Verdana, Arial, Helvetica">To
        change this location, type a new path in the <strong>Log
        File Directory</strong> box, or click <strong>Browse</strong>
        and complete the dialog box that appears. It is possible
        to log to a local or remote drive, but in general it is
        recommended that you store your WinSock Proxy log file on
        a local disk. </font></p>
        <p><font size="2" face="Verdana, Arial, Helvetica"><strong>Note</strong>&nbsp;&nbsp;&nbsp;To
        help prevent the disk filling up, it is a good idea to
        store the logs and the Web Proxy service cache on
        different volumes. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Click
        <strong>OK</strong>. </font></p>
        <p align="left"><font size="2" face="Verdana, Arial, Helvetica">The
        log settings are saved. </font></p>
    </li>
</ol>

<p><font size="2" face="Verdana, Arial, Helvetica">For more information
about logging to a text file, including detailed information
about the data that is logged and the difference between regular
and verbose logging, see </font><a href="10_msp.htm#Top"><font
size="2" face="Verdana, Arial, Helvetica">&#147;Monitoring.&#148;</font></a></p>

<p><font size="2" face="Verdana, Arial, Helvetica">The following procedure
shows you the basic steps you will perform to log WinSock Proxy
service information to an ODBC-compliant database. For detailed
instructions about how to accomplish each of these steps, see </font><a
href="10_msp.htm#Top"><font size="2" face="Verdana, Arial, Helvetica">&#147;Monitoring.&#148;</font></a><font size="2"
face="Verdana, Arial, Helvetica"><strong> </strong></font></p>

<h4><a
name="TologWinSockProxyserviceinformationtoanODBC-compliantdatabase"><font
size="2" face="Verdana, Arial, Helvetica"><strong>To log WinSock Proxy
service information to an ODBC-compliant database</strong></font></a></h4>

<ol>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Install
        the database. The database can be installed on the local
        computer or a remote computer. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Create
        a table in the database, creating the fields necessary to
        support WinSock Proxy service log data. The required
        fields are described in detail in </font><a
        href="10_msp.htm#Top"><font size="2"
        face="Verdana, Arial, Helvetica">&#147;Monitoring.&#148;</font></a><font size="2"
        face="Verdana, Arial, Helvetica"> </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Install
        the ODBC driver for the database you are using. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">Create
        a System Data Source Name (system DSN) for the database
        that will receive the log data. </font></p>
    </li>
    <li><font size="2" face="Verdana, Arial, Helvetica">In Internet
        Service Manager, click the <strong>Logging</strong> tab
        of the <strong>WinSock Proxy Service Properties</strong>
        window. Make sure the <strong>Enable Logging</strong>
        option is selected, select the <strong>Log to SQL/ODBC
        Database</strong> option, and configure the logging
        options.</font><p><font size="2" face="Verdana, Arial, Helvetica">Detailed
        instructions are provided in </font><a
        href="10_msp.htm#Top"><font size="2"
        face="Verdana, Arial, Helvetica">&#147;Monitoring.&#148;</font></a><font size="2"
        face="Verdana, Arial, Helvetica"> </font></p>
    </li>
</ol>

<hr>

<h1><a href="#Top"><font size="2" face="Verdana, Arial, Helvetica"><img
src="up.gif" alt="To Top" align="middle" border="0" width="14"
height="11"></font></a><a name="07777h1"><font size="2"
face="Verdana, Arial, Helvetica">Setting WinSock Proxy Access Control</font></a></h1>

<p><font size="2" face="Verdana, Arial, Helvetica">When Microsoft Proxy
Server is installed the Setup program presents an option to
enable or disable access control for the WinSock Proxy service.
If access control is enabled, only users who are granted WinSock
Proxy permissions can use WinSock Proxy protocols to access the
Internet through the WinSock Proxy service. If access control is
disabled, any client can access the Internet through the WinSock
Proxy service; this is the WinSock Proxy equivalent of Anonymous
access.</font></p>

<h4><a name="TochangetheWinSockProxyaccesscontrolsetting"><font
size="2" face="Verdana, Arial, Helvetica"><strong>To change the WinSock
Proxy access control setting </strong></font></a></h4>

<ol>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">From
        Internet Service Manager, open the <strong>WinSock Proxy
        Service Properties</strong> window for the server to be
        administered, and click the <strong>Permissions</strong>
        tab. </font></p>
    </li>
    <li><p align="left"><font size="2" face="Verdana, Arial, Helvetica">To
        enable access control, select the <strong>Enable Access
        Control</strong> check box. To disable access control,
        clear the check box. </font></p>
    </li>
</ol>

<hr>

<p align="center"><font size="2" face="Verdana, Arial, Helvetica"><i>©
1996 by Microsoft Corporation. All rights reserved.</i> </font></p>
</FONT>
</FONT>
</BODY>
</html>
