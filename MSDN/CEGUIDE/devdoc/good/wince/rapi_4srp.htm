<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Initializing and Terminating Remote Application Programming Interface</TITLE>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_CeRapiInit">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_CeRapiInitEx">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_CeRapiUninit">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_Win32_WaitForSingleObject">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_Win32_WaitForMultipleObjects">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_RAPIINIT">
</OBJECT>
<OBJECT ID="hhobj_7" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_CeRapiUninit">
</OBJECT>
<OBJECT ID="hhobj_8" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_CeRapiInitEx">
</OBJECT>
<OBJECT ID="hhobj_9" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_RAPIINIT">
</OBJECT>
</TD></TR></TABLE>



<H1>

<A NAME="_initializing_and_terminating_remote_application_programming_interface"></A>Initializing and Terminating Remote Application Programming Interface</H1>

<P>Before making RAPI calls, you must call the <A HREF="JavaScript:hhobj_1.Click()"><B>CeRapiInit</B></A> or <A HREF="JavaScript:hhobj_2.Click()"><B>CeRapiInitEx</B></A> function. These functions perform routine initialization and set up the communications link between the desktop computer and the platform. </P>

<P><B>The CeRapiInit </B>call is a synchronous operation. It does not return control to the application until a connection is made or an error occurs. In contrast, the <B>CeRapiInitEx</B> call is an asynchronous operation and it returns immediately. <B>CeRapiInitEx</B> continues the initialization until a connection is made, an error occurs, or there is a call to <A HREF="JavaScript:hhobj_3.Click()"><B>CeRapiUninit</B></A>. Although <B>CeRapiInitEx</B> avoids blocking any threads, it is a more complicated method of initialization.</P>

<H5><IMG SRC="../../images/wedge.gif" ALT="" BORDER=0>&nbsp;&nbsp;&nbsp;&nbsp;To initialize RAPI using CeRapiInitEx</H5>

<OL>
	<LI>Call <B>CeRapiInitEx</B>.</LI>

	<LI>If an error is returned, exit.</LI>

	<LI>If successful, call <A HREF="JavaScript:hhobj_4.Click()"><B>WaitForSingleObject</B></A> or <A HREF="JavaScript:hhobj_5.Click()"><B>WaitForMultipleObjects</B></A> to wait on the event handle passed back in the <B>heRapiInit</B> member of <A HREF="JavaScript:hhobj_6.Click()"><B>RAPIINIT</B></A>.</LI>

	<LI>When <B>heRapiInit</B> is signaled, check for a successful connection or an error value. </LI>

	<LI>Check the <B>hrRapiInit</B> member of the <B>RAPIINIT</B> structure for the final return value.</LI>
</OL>

<P>When you are finished with RAPI, call <A HREF="JavaScript:hhobj_7.Click()"><B>CeRapiUninit</B></A> to terminate the connection and perform any necessary cleanup. Because creating and terminating connections are fairly expensive operations, establish and terminate the link only once per session, not on a per-call basis.</P>

<P>The following code example shows how to use the <A HREF="JavaScript:hhobj_8.Click()"><B>CeRapiInitEx</B></A> function. Following the <B>CeRapiInitEx</B> call, the <B>MsgWaitForMultipleObjects</B> function is used to wait on one of two events. The first event is when the event handle is passed back through the <B>heRapiInit</B> member of the <A HREF="JavaScript:hhobj_9.Click()"><B>RAPIINIT</B></A> structure. The second event is when a user terminates a connection.</P>

<PRE><CODE>HRESULT InitRapi(HEVENT hExit)
{
   RAPIINIT ri = { sizeof(RAPIINIT) };
   HRESULT hr = CeRapiInitEx(&amp;ri);
   if ( FAILED( hr ) )
   {
      return(hr);
   }

   HANDLE ahWait[] = { hExit                  , ri.heRapiInit };
   enum              { WAIT_EXIT=WAIT_OBJECT_0, WAIT_INIT     };

   DWORD dwObj = WaitAndDispatch(ARRAYSIZE(ahWait), ahWait);

   if (WAIT_INIT == dwObj)            //Event signaled by RAPI
   {
      if (FAILED(ri.hrRapiInit))      //Connection failed
      {
         CeRapiUninit();
      }

      return(ri.hrRapiInit);
   }

                           //Event signaled by user or timeout occurred
      CeRapiUninit();

      if (WAIT_EXIT == dwObj)
      {
         return(HRESULT_FROM_WIN32(ERROR_CANCELLED));
      }

      return(E_FAIL);
}

enum
{
   WAD_ALLINPUT    = 0x0000,
   WAD_SENDMESSAGE = 0x0001,
} ;

DWORD WaitAndDispatch(DWORD nCount, HANDLE *phWait, DWORD dwTimeout, UINT uFlags)
{
   DWORD dwObj;
   DWORD dwStart = GetTickCount();
   DWORD dwTimeLeft = dwTimeout;

   for ( ; ; )
   {
      dwObj = MsgWaitForMultipleObjects(nCount, phWait, FALSE,
         dwTimeLeft, (uFlags&amp;WAD_SENDMESSAGE) ? QS_SENDMESSAGE : QS_ALLINPUT);
      if (dwObj == (DWORD)-1)
      {
         dwObj = WaitForMultipleObjects(nCount, phWait, FALSE, 100);
         if (dwObj == (DWORD)-1)
         {
            break;
         }
        }
        else if (dwObj == WAIT_TIMEOUT)
        {
            break;
        }

      if ((UINT)(dwObj-WAIT_OBJECT_0) &lt; nCount)
      {
         break;
      }

      MSG msg;
      if (uFlags &amp; WAD_SENDMESSAGE)
      {
         PeekMessage(&amp;msg, NULL, 0, 0, PM_NOREMOVE);
      }
      else
      {
         while (PeekMessage(&amp;msg, NULL, 0, 0, PM_REMOVE))
         {
            DispatchMessage(&amp;msg);
         }
      }

      if (INFINITE != dwTimeout)
      {
         dwTimeLeft = dwTimeout - (GetTickCount() - dwStart);
         if ((int)dwTimeLeft &lt; 0)
         {
            break;
         }
      }
   }

   return(dwObj);
}
</CODE></PRE>

</BODY>
</HTML>
