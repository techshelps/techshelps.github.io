<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Implementing and Using a File Filter</TITLE>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_Lists_of_Functions_and_Interfaces">
</OBJECT>
</TD></TR></TABLE>



<H1>

<A NAME="_implementing_and_using_a_file_filter"></A>Implementing and Using a File Filter</H1>

<P>The Windows CE SDK includes a sample file filter named Copyfilt that imports a binary file (.bin) from a desktop computer to a binary file (.pbn) on a Windows CE-based device. The Copyfilt sample file filter demonstrates basic operations for implementing a file filter, which are described in the following procedure. </P>

<H5><IMG SRC="../../images/wedge.gif" ALT="" BORDER=0>&nbsp;&nbsp;&nbsp;&nbsp;To implement a file filter</H5>

<OL>
	<LI>Register the file filter DLL. 
<P>See <A HREF="filter_9auq.htm">Registering a File Filter</A>. 
</LI>

	<LI>Implement the <B>ICeFileFilter</B> interface and methods. 
<P>For a list of file filter interfaces, see <A HREF="JavaScript:hhobj_1.Click()">Lists of Functions and Interfaces</A>. 
</LI>

	<LI>Windows CE Services calls the <B>QueryInterface</B> method for the file filter's <B>ICeFileFilterOptions </B>interface. If this interface is available, it then calls the <B>ICeFileFilterOptions::SetFilterOptions</B> method with a correctly initialized <B>CFF_CONVERTOPTIONS</B> structure. The <B>bNoModalUI</B> member specifies whether the converter is allowed to bring up modal UI while performing the conversion.
<P>For a file filter that includes selectable conversion options, the <B>ICeFileFilter::FilterOptions</B> method should be implemented. This allows a user to select among the conversion options supported by the file filter.
</LI>
</OL>

<H5><IMG SRC="../../images/wedge.gif" ALT="" BORDER=0>&nbsp;&nbsp;&nbsp;&nbsp;To use a file filter</H5>

<OL>
	<LI>The user uses the drag-and-drop method to transfer a file between Windows CE Explorer on the desktop and on the device.</LI>

	<LI>Windows CE Services prompts the user for a conversion type, using the <B>File Conversion Properties</B> dialog box.</LI>

	<LI>Windows CE Services calls the file filter's <B>ICeFileFilter::NextConvertFile</B> method to perform the custom file conversion. Information about the file conversion and about the source and destination files is passed by pointers to the <B>CFF_CONVERTINFO</B>, <B>CFF_DESTINATIONFILE</B>, and <B>CFF_SOURCEFILE</B> structures. 
<P>Within the <B>ICeFileFilter::NextConvertFile</B> method: 

<OL type=a>
	<LI>Call <B>ICeFileFilterSite::OpenSourceFile</B> to open the source file.</LI>

	<LI>Call <B>ICeFileFilterSite::OpenDestinationFile</B> to open the destination file. </LI>

	<LI>Read data from the stream file that was opened using the <B>OpenSourceFile</B> method.</LI>

	<LI>Convert the data. This can include ISV-developed code and remote application programming interface (RAPI) calls.</LI>

	<LI>Check on the status of the <B>NextConvertFile</B> <I>pbCancel</I> parameter occasionally to ensure that the user has not aborted the conversion process. If the conversion has been aborted, perform all cleanup operations and exit.</LI>

	<LI>Write the converted data to the stream file that was opened using the <B>OpenDestinationFile</B> method.</LI>

	<LI>Report the progress of the file conversion by occasionally calling the <B>ICeFileFilterSite::ReportProgress</B> method. Windows CE Services uses this information to update a status bar showing the percentage completion of the conversion. You should limit your use of this method because it can add substantially to the conversion time.</LI>

	<LI>Report data that is intentionally discarded during conversion by calling the <B>ICeFileFilterSite::ReportLoss</B> method. Windows CE Services displays a message with this information when the file conversion is complete. Depending on the error format passed in the call, Windows CE Services may call the file filter's <B>ICeFileFilter::FormatMessage</B> method, in order to properly format the message.</LI>

	<LI>Close the source file, using the <B>ICeFileFilterSite::CloseSourceFile</B> method, and then close the destination file, using the <B>ICeFileFilterSite::CloseDestinationFile</B> method.</LI>
</OL>
</LI>
</OL>

</BODY>
</HTML>
