<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Application Hibernation</TITLE>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_WM_HIBERNATE">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_win32_VirtualAlloc">
</OBJECT>
</TD></TR></TABLE>



<H1>

<A NAME="_application_hibernation"></A>Application Hibernation</H1>

<P>Windows CE uses the <A HREF="JavaScript:hhobj_1.Click()">WM_HIBERNATE</A> message as its primary mechanism for asking applications to free memory. When freeing memory is required, the system posts the message to one or more applications, beginning with the application that has been inactive the longest. It requests memory from the active application last and does not send WM_HIBERNATE messages to invisible windows.</P>

<P><B>Note</B>  In Windows CE, hibernating is vital. All properly constructed Windows CE-based applications must have a handler for WM_HIBERNATE. </P>

<P>When the system brings an application to the foreground, it sends an WM_ACTIVATE message. If the hibernating application had released memory previously, the system does not restore its memory resources to the pre-hibernation state. Applications should have a WM_ACTIVATE handler that can deal with the restoration of memory resources following hibernation.</P>

<P>An application must take the following actions when it receives a WM_HIBERNATE message: 

<UL>
	<LI>Free any large blocks of memory that were allocated by <A HREF="JavaScript:hhobj_2.Click()"><B>VirtualAlloc</B></A>, for example, a cache. </LI>

	<LI>Free as many Graphics Windowing and Event Subsystem (GWES) objects as possible, including windows, bitmaps, and device contexts, because they use large amounts of memory.</LI>

	<LI>Save the state of the heap in order to restore it later, and then free the entire heap. </LI>
</UL>

<P>As the amount of available memory drops, the system posts WM_HIBERNATE messages at an increasing rate. If the system reaches a situation where a call to <B>VirtualAlloc</B> is about to fail, it tries to free pages by shrinking stacks. The system shrinks stacks in first-in, first-out order to minimize the risk of a stack fault, which causes an application to fail. If the system cannot free any stack pages, <B>VirtualAlloc</B> fails and the function is returned to the application as a failed function call. </P>

</BODY>
</HTML>
