<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Certificate Authentication</TITLE>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">



<H3>

<A NAME="_certificate_authentication"></A>Certificate Authentication</H3>

<P>Authentication is the process of determining whether or not a remote host can be trusted. To establish its trustworthiness, the remote host must provide an acceptable authentication certificate based on public-key cryptography. Windows CE supports X.509-style certificates.</P>

<P>Remote hosts establish their trustworthiness by obtaining a certificate from a Certificate Authority (CA). The CA may, in turn, have certification from a higher authority, and so on, creating a chain of trust. To determine whether a certificate is trustworthy, an application must determine the identity of the root CA, and then decide if it can be trusted.</P>

<P>Windows CE maintains a database of trusted CAs. When a secure connection is attempted by an application, Windows CE extracts the root certificate from the certification chain and checks it against the CA database. It delivers the root certificate to the application through a certificate validation callback function, along with the results of the comparison against the CA database.</P>

<P>Applications bear ultimate responsibility for deciding whether or not the certificate is acceptable. They are free to accept or reject any certificate, based on whatever criteria are appropriate. If the certificate is rejected, the connection is not completed. At a minimum, a certificate should meet the following two requirements: It should be current, and the identity contained within the certificate should match the identity of the root CA.</P>

<P>The certificate validation callback function must be implemented by all client applications that use secure sockets. The value it returns determines whether or not the connection will be completed by Winsock. It must have the following syntax:</P>

<PRE><CODE><B>int</B> <B>SslValidate</B> (
         DWORD      <I>dwType</I>
         LPVOID     <I>pvArg</I>
         DWORD      <I>dwChainLen</I>
         LPBLOB     <I>pCertChain</I>
         DWORD      <I>dwFlags</I>
);
</CODE></PRE>

<P>The parameters contain the following information:

<UL>
	<LI>The <I>dwType</I> parameter specifies the type of data pointed to by <I>pCertChain</I>. This must be SSL_CERT_X.509, specifying that <I>pCertChain</I> is a pointer to an X509 style certificate.</LI>

	<LI>The <I>pvArg</I> parameter is the application-defined context, passed by the SSLVALIDATECERTHOOK structure.</LI>

	<LI>The <I>dwChainLen</I> parameter is the number of certificates pointed to by <I>pCertChain</I>. It will always be equal to one.</LI>

	<LI>The <I>pCertChain</I> parameter is a pointer to the root certificate.</LI>

	<LI>If the root issuer of the certificate could not be found in the CA database, the <I>dwFlags</I> parameter will contain SSL_CERT_FLAG_ISSUER_UNKNOWN. The application can either attempt to verify the issuer itself, or return SSL_ERR_CERT_UNKNOWN.</LI>
</UL>

<P>The values returned by the callback function are described in the following table.</P>

<TABLE cols=2>

<TR VALIGN="top">
<TH align=left width=38%>Return value</TH>
<TH align=left width=62%>Description</TH>
</TR>

<TR VALIGN="top">
<TD width=38%>SSL_ERR_BAD_DATA</TD>
<TD width=62%>The certificate is not properly formatted.</TD>
</TR>

<TR VALIGN="top">
<TD width=38%>SSL_ERR_BAD_SIG</TD>
<TD width=62%>The signature check failed.</TD>
</TR>

<TR VALIGN="top">
<TD width=38%>SSL_ERR_CERT_EXPIRED</TD>
<TD width=62%>The certificate has expired.</TD>
</TR>

<TR VALIGN="top">
<TD width=38%>SSL_ERR_CERT_REVOKED</TD>
<TD width=62%>The certificate has been revoked by its issuer.</TD>
</TR>

<TR VALIGN="top">
<TD width=38%>SSL_ERR_CERT_UNKNOWN</TD>
<TD width=62%>The issuer is unknown, or some unspecified problem arose in the processing of the certificate, rendering it unacceptable</TD>
</TR>

<TR VALIGN="top">
<TD width=38%>SSL_ERR_OKAY</TD>
<TD width=62%>The certificate is acceptable.</TD>
</TR>
</TABLE><BR>

</BODY>
</HTML>
