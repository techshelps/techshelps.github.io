<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Registering a File Filter</TITLE>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">



<H2>

<A NAME="_registering_a_file_filter"></A>Registering a File Filter</H2>

<P>A file filter is registered by placing its CLSID in two locations. The first place is under the file type's extension key in the <B>InstalledFilters</B> subkey. This registration associates the file filter with the file type it converts. The other place to register a file filter is under the <B>HKEY_CLASSES_ROOT\CLSID</B> key. This registration provides information on the file filter's capabilities and its DLL. </P>

<P>Optionally, a file filter can be registered under the file type's extension key as the <B>DefaultImport</B> or <B>DefaultExport</B> named value. As the names imply, these values define the default file filters for the file type.</P>

<P>Each key under <B>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\<BR>
Windows CE Services\Filters </B>is the name of a file extension. This is called the file type's <I>extension key</I>. Under each extension key is the <B>InstalledFilters</B> subkey, which contains the CLSID of each file filter that can convert this file type. The CLSID must identify an OLE Component Object Model (COM) object that is used for the conversion. The filters that are registered under the <B>InstalledFilters </B>subkey will be listed in the Windows CE Services user interface as filter options. Whichever file filter is also listed under the extension key as the <B>DefaultImport</B> or <B>DefaultExport</B> value will be shown as the default. </P>

<P><B>Note</B>  Any filter defined as the <B>DefaultImport</B> or <B>DefaultExport</B> named value must be an <B>InstalledFilters</B> value also.</P>

<P>The following is the structure of the <B>Filters</B> key and the <B>InstalledFilters</B> subkey.</P>

<PRE><CODE>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows CE Services\Filters

   \.&lt;file extension&gt;
      [DefaultImport = &lt;Default import filter CLSID&gt;]
      [DefaultExport = &lt;Default export filter CLSID&gt;]
      \InstalledFilters
         [&lt;clsid1&gt;]
         . . .
         [more CLSID's for this extension]
    . . .
    [more extensions]
</CODE></PRE>

<P>The HKEY_CLASSES_ROOT\CLSID key gives basic information concerning file filters. Each file filter that has been identified in the <B>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows CE Services\Filters</B> key must be registered in this key. The following is the key's structure and its subkeys.</P>

<PRE><CODE>HKEY_CLASSES_ROOT\CLSID

   \&lt;<I>clsid</I>&gt;
      \(Default) = &lt;Description in "Edit Conversion Settings" listbox&gt;
      \DefaultIcon = &lt;filename,index for the icon for this type&gt;
      \InProcServer32 = &lt;filename of the DLL that handles his type&gt;
         ThreadingModel = Apartment
      \PegasusFilter
         [Import]
         [HasOptions]
         Description = &lt;String to display in the conversion dialog&gt;
         NewExtension = &lt;extension of converted file&gt;
   \. . . [<I>more clsids for filters</I>]
</CODE></PRE>

<P>The <I>clsid</I> key is a named value that is the CLSID of the registered file filter. This key contains the following subkeys:

<UL>
	<LI><B>DefaultIcon</B>
<P class=indent1>Defines the icon name string or icon resource identifier for the icon associated with the file filter DLL. </P>
</LI>

	<LI><B>InProcServer32</B>
<P class=indent1>Identifies the file filter DLL using the default value, and defines the Apartment model capabilities of the file filter in the <B>ThreadingModel</B> named value. </P>
</LI>

	<LI><B>PegasusFilter</B>
<P class=indent1>Provides information on the specific capabilities of the file filer. Possible named values for this key are described in the following table.</P>
</LI>
</UL>

<TABLE cols=2>

<TR VALIGN="top">
<TH align=left width=23%>Named Value </TH>
<TH align=left width=77%>Description </TH>
</TR>

<TR VALIGN="top">
<TD width=23%><B>Import</B></TD>
<TD width=77%>If this named value exists, the conversion type is for importing files from the desktop computer to the Windows CE-based device. Otherwise, the conversion type is for exporting files from the desktop computer to the Windows CE-based device. </TD>
</TR>

<TR VALIGN="top">
<TD width=23%><B>HasOptions</B></TD>
<TD width=77%>If this named value exists, the file filter supports the <B>ICeFileFilter::FilterOptions</B> method.</TD>
</TR>

<TR VALIGN="top">
<TD width=23%><B>Description</B></TD>
<TD width=77%>The data for this named value is a string that describes the conversion. Windows CE Services displays this text on the property sheets displayed by selecting the <B>DeviceDesktop</B> or <B>DesktopDevice</B> tab control selections from the <B>File Conversion Properties</B> dialog box and then clicking the <B>Edit</B> button to display the <B>Edit Conversion Settings</B> dialog box. 
<P>For example, if the <B>Import</B> named value exists, then, on the <B>DesktopDevice</B> property sheet, the data value defined by the <B>Description</B> named value will be displayed under the file conversions details "Convert to HPC files of the type." </P>
</TD>
</TR>

<TR VALIGN="top">
<TD width=23%><B>NewExtension</B></TD>
<TD width=77%>Defines the extension of the file that will be created on the destination device. </TD>
</TR>
</TABLE><BR>

</BODY>
</HTML>
