<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Managing Memory for Mail Allocations</TITLE>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">



<H2>

<A NAME="_managing_memory_for_mail_allocations"></A>Managing Memory for Mail Allocations</H2>

<P>Inbox uses <B>HeapCreate</B> and <B>HeapAlloc</B> to allocate a private heap for each mail message; however, Inbox opens only one mail message at a time, in order to conserve memory. When Inbox is finished working with a message, it frees the allocated memory by calling <B>HeapDestroy</B>. If a service or application needs to create a memory heap, following this method can help to minimize memory fragmentation. </P>

<P>When working with a mail message, if Inbox has already allocated a heap for a message, then the service can reallocate memory on the existing heap. For example, if the handle <B>hHeap</B> in the <B>MailMsg</B> structure is not NULL, that is, if the handle exists, the service can allocate additional memory to this existing heap. In this way, Inbox takes care of freeing memory when it calls the <B>MailFree</B> function.</P>

<P>When following the method just described, the <B>TransportRecv</B> routine should create a private heap using <B>HeapCreate</B> for each mail message. A good initial size is 2 Kb. <B>TransportRecv</B> should store this heap handle in the <B>hHeap </B>member of the <B>MailMsg</B> structure. All dynamic storage in the <B>MailMsg</B> structure will use this private heap. Heap allocated storage should include the <B>szSvcId</B>, <B>szSvcNam</B>, <B>pwcHeaders</B>, and <B>szBody</B> members of the <B>MailMsg</B> structure.</P>

<P>The <B>TransportFreeMsg</B> routine should check for a NULL heap handle, delete the heap, and set the <B>hHeap</B> member of the <B>MailMsg</B> structure to NULL.</P>

<P></P>

</BODY>
</HTML>
