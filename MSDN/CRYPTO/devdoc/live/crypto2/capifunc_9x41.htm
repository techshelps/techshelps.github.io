<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>CryptUnprotectData</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_crypto2_cryptunprotectdata"></a>CryptUnprotectData</h1>
<p>
<span style=color:#FF0000>[This is preliminary documentation and subject to change.]</span> </p>
<p>
<b>CryptUnprotectData</b> performs a decryption and integrity check of the data in a DATA_BLOB. Normally, only a user with the same login credential as the encrypter can decrypt the data. In addition, the encryption and decryption must be done on the same computer. See "Remarks" in <a href="capifunc_0lwh.htm"><b>CryptProtectData</b></a> for information about exceptions.</p>
<pre><code><b>BOOL WINAPI CryptUnprotectData(
  DATA_BLOB </b><i>*DataIn</i>,                         // in
<b>  LPWSTR </b><i>*ppszDataDescr</i>,                     // out optional
<b>  DATA_BLOB </b><i>*pOptionalEntropy</i>,               // in optional
<b>  PVOID </b><i>*pvReserved</i>,                         // reserved
<b>  CRYPTPROTECT_PROMPTSTRUCT </b><i>*pPromptStruct</i>,  // in optional
<b>  DWORD </b><i>dwFlags</i>                              // in
<b>  DATA_BLOB </b><i>*pDataOut</i>;                       // out
<b>);</b>
<b> </b></code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>DataIn</i></dt>
<dd>
Pointer to a DATA_BLOB that holds the encrypted data. The DATA_BLOB's cbData member holds the length of the pbData byte string that contains the text to be encrypted.</dd>
<dt>
<i>ppszDataDescr</i></dt>
<dd>
Pointer to an address where a readable description of the encrypted data included with the encrypted data will be placed. This parameter is optional and may be set to NULL.</dd>
<dt>
<i>pOptionalEntropy</i></dt>
<dd>
Pointer to a string that holds a password or other additional entropy used when the data was encrypted. This parameter is optional and may be set to NULL; however, if optional entropy was used in the encryption phase, that same entropy must be used for decryption phase.</dd>
<dt>
<i>pvReserved</i></dt>
<dd>
Currently not used. Must be set to NULL.</dd>
<dt>
<i>pPromptStruct</i></dt>
<dd>
Pointer to a data structure that provides information about where and when prompts are displayed and what the content of those prompts will be. This parameter is optional and may be set to NULL.</dd>
<dt>
<i>dwFlags</i></dt>
<dd>

<dl>
<dt>
CRYPTPROTECT_UI_FORBIDDEN is used for remote situations where the user interface (UI) is not an option. When this flag is set and UI is specified for either the protect or unprotect operation, the operation fails and <b>GetLastError</b> returns ERROR_PASSWORD_RESTRICTION.</dt>
</dl>
</dd>
<dt>
<i>pDataOut</i></dt>
<dd>
Pointer to a DATA_BLOB where the function stores the decrypted data.</dd>
</dl>
<h4>Return Values</h4>
<p>
The function returns TRUE if the function succeeded, FALSE if it failed. <b>GetLastError </b>returns the code for the cause of any failure. The pbData of the DATA_BLOB allocated and a non NULL <i>ppszDataDescr</i> must be freed using <b>LocalFree</b>.</p>
<h4>Remarks</h4>
<p>
The <b>CryptProtectData</b> function creates a session key when the data is encrypted. That key is re-derived and used to decrypt the data blob.</p>
<p>
The MAC hash added to the encrypted data can be used to determine whether the encrypted data was altered in any way. Any tampering results in a ERROR_INVALID_DATA return.</p>
<h4>Example</h4>
<p>
See example using <a href="capifunc_0lwh.htm"><b>CryptProtectData</b></a>.</p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 5.0 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in wincrypt.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use crypt32.lib.</p>
<h4>See Also</h4>
<p>
<a href="capifunc_0lwh.htm"><b>CryptProtectData</b></a></p>
<p>&nbsp;</p></body>
</HTML>
