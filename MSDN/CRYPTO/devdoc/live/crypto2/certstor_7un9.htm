<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>CertAddCTLLinkToStore</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_crypto2_certaddctllinktostore"></a>CertAddCTLLinkToStore</h1>
<p>
<span style=color:#FF0000>[This is preliminary documentation and subject to change.]</span> </p>
<p>
The <b>CertAddCTLLinkToStore</b> function adds a link in a store to a CTL context in a different store. Instead of creating and adding a duplicate of a CTL context, this function adds a link to the original CTL context wherever it may be. Since the link provides access to the original CTL context, setting an extended property in the linked CTL context changes that property as seen in the original CTL's location and by any other links to that CTL. .</p>
<pre><code><b>#include &lt;wincrypt.h&gt;
BOOL WINAPI CertAddCTLLinkToStore(
  HCERTSTORE</b><i> hCertStore</i><b>,                   </b>// in
<b>  PCTL_CONTEXT </b><i>pCTLContext,</i>                // in
<b>  DWORD</b><i> dwAddDisposition</i><b>,                  </b>// in
<b>  PCCTL_CONTEXT </b><i>*ppStoreContext            </i>// out optional
<b>);</b> 
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>hCertStore</i></dt>
<dd>
Handle to the certificate store where the link is to be added.</dd>
<dt>
<i>pCTLContext</i></dt>
<dd>
Pointer to the CTL context that is to be linked.</dd>
<dt>
<i>dwAddDisposition</i></dt>
<dd>
Value that specifies the action to take if a matching CTL or a link to a matching CTL already exists in the store. Currently defined disposition values and their uses are:
<dl>
<dt>
CERT_STORE_ADD_NEW</dt>
<dd>
If a matching CTL or a link to a matching CTL exists, the operation fails. <b>GetLastError</b> returns CRYPT_E_EXISTS.</dd>
<dt>
CERT_STORE_ADD_USE_EXISTING</dt>
<dd>
If a matching CTL or a link to a matching CTL exists that existing link is used. The function does not fail, but no new link is added. If a matching CTL or link to a CTL does not exist, a new link is added. </dd>
<dt>
CERT_STORE_ADD_REPLACE_EXISTING</dt>
<dd>
If a link to the matching CTL exists, that existing link is deleted and a new link is created and added to the store. If a matching CTL or a link to a matching CTL does not exist, a new link is added.</dd>
<dt>
CERT_STORE_ADD_ALWAYS</dt>
<dd>
Makes no check for an existing matching CTL or link to a matching CTL. A new link is always added to the store. This may lead to duplicates in a store.</dd>
<dt>
CERT_STORE_ADD_NEWER</dt>
<dd>
If a matching CTL or a link to a matching CTL exists, the ThisUpdate times on the CTLs are compared. If the existing CTL has a ThisUpdate time less than the ThisUpdate time on the new CTL, the old link is replaced just as with CERT_STORE_ADD_REPLACE_EXISTING. If the existing CTL has a ThisUpdate time greater than or equal to the ThisUpdate time on the CTL to be added, the function fails with <b>GetLastError</b> returning CRYPT_E_EXISTS.
<p>
If a matching CTL or a link to a matching CTL is not found in the store, a new link is added to the store.
</dd>
</dl>
</dd>
<dt>
<i>ppStoreContext </i></dt>
<dd>
Pointer to a pointer to a copy of the link created. <i>ppStoreContext </i>can be NULL to indicate that a copy of the link is not needed. If a copy of the link is created, that copy must be freed using <a href="certstor_3gc4.htm"><b>CertFreeCTLContext</b></a>.
</dd>
</dl>
<h4>Return Values</h4>
<p>
TRUE if the function succeeded. FALSE if the function failed.</p>
<p>
<b>GetLastError</b> returns the code for any failures using the following error codes:</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=40%>Error code</th>
<th align=left width=60%>Description</th>
</tr>
<tr valign=top>
<td width=40%>CRYPT_E_EXISTS</td>
<td width=60%>For a <i>dwAddDisposition</i> of CERT_STORE_ADD_NEW, the CTL already exists in the store.</td>
</tr>
<tr valign=top>
<td width=40%>E_INVALIDARG </td>
<td width=60%>Invalid add disposition specified by the <i>dwAddDisposition</i> argument.</td>
</tr>
</table><br>
<h4>Remarks</h4>
<p>
Links cannot be added to a store that is opened as a collection. Stores opened as collections include all stores opened with <a href="certstor_27s5.htm"><b>CertOpenSystemStore</b></a><b> </b>or <a href="certstor_12sl.htm"><b>CertOpenStore</b></a> using CERT_STORE_PROV_SYSTEM or CERT_STORE_PROV_COLLECTION. Also see <a href="certstor_2uni.htm"><b>CertAddStoreToCollection</b></a>. </p>
<p>
When links are used and <a href="certstor_9vqd.htm"><b>CertCloseStore</b></a> is called with CERT_CLOSE_STORE_FORCE_FLAG, the store using links must be closed before the store containing the original contexts is closed. If CERT_CLOSE_STORE_FORCE_FLAG is not used, the two stores may be closed in either order.</p>
<h4>Example</h4>
<p>
See the example with <a href="certstor_5qed.htm"><b>CertAddCertificateLinkToStore</b></a>. This example will hold for <b>CertAddCTLLinkToStore</b> if all the references to "certificate" are changed to "CTL."</p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 5.0 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in wincrypt.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use crypt32.lib.</p>
<h4>See Also</h4>
<p>
<a href="certstor_27s5.htm"><b>CertOpenSystemStore</b></a>, <a href="certstor_2uni.htm"><b>CertAddStoreToCollection</b></a>, <a href="certstor_723p.htm"><b>CertAddCRLLinkToStore</b></a>, <a href="certstor_5qed.htm"><b>CertAddCertificateLinkToStore</b></a>, <a href="certstor_3gc4.htm"><b>CertFreeCTLContext</b></a></p>
<p>&nbsp;</p></body>
</HTML>
