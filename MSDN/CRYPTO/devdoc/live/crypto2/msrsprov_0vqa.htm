<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>The RSA/Schannel Provider Private Key Blob</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_crypto2_the_rsa_schannel_provider_private_key_blob"></a>The RSA/Schannel Provider Private Key Blob</h2>
<p>
Private-key blobs (type PRIVATEKEYBLOB) are used to store public/private key pairs. They have the following format:</p>
<pre><code>BLOBHEADER blobheader;
RSAPUBKEY rsapubkey;
BYTE modulus[rsapubkey.bitlen/8];
BYTE prime1[rsapubkey.bitlen/16];
BYTE prime2[rsapubkey.bitlen/16];
BYTE exponent1[rsapubkey.bitlen/16];
BYTE exponent2[rsapubkey.bitlen/16];
BYTE coefficient[rsapubkey.bitlen/16];
BYTE privateExponent[rsapubkey.bitlen/8];
 </code></pre>
<p>
If the key blob is encrypted, then everything but the <a href="structs_7aya.htm"><b>BLOBHEADER</b></a> portion of the blob is encrypted. Note that the encryption algorithm and encryption key parameters are not stored along with the private key blob. It is the responsibility of the application to manage this information.</p>
<p>
The following table describes each private-key blob components. Note that these fields largely correspond to the ones described in section 7.2 of Public-Key Cryptography Standards (PKCS) #1.</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=25%>Field</th>
<th align=left width=75%>Description</th>
</tr>
<tr valign=top>
<td width=25%>blobheader</td>
<td width=75%>A <a href="structs_7aya.htm"><b>BLOBHEADER</b></a> structure. The <b>bType</b> member must have a value of PRIVATEKEYBLOB.</td>
</tr>
<tr valign=top>
<td width=25%>rsapubkey</td>
<td width=75%>A <a href="structs_3r95.htm"><b>RSAPUBKEY</b></a><b> </b>structure. The <b>magic</b> field must always have a value of 0x32415352 ("RSA2").<p>
Notice that the hex value is just an ASCII encoding of "RSA2."</p>
</td>
</tr>
<tr valign=top>
<td width=25%>Modulus</td>
<td width=75%>The modulus. This has a value of "<i>prime1</i> * <i>prime2</i>" and is often known as "n".</td>
</tr>
<tr valign=top>
<td width=25%>prime1</td>
<td width=75%>Prime number 1, often known as "p".</td>
</tr>
<tr valign=top>
<td width=25%>prime2</td>
<td width=75%>Prime number 2, often known as "q".</td>
</tr>
<tr valign=top>
<td width=25%>exponent1</td>
<td width=75%>Exponent 1. This has a numeric value of "d mod (p - 1)".</td>
</tr>
<tr valign=top>
<td width=25%>exponent2</td>
<td width=75%>Exponent 2. This has a numeric value of "d mod (q - 1)".</td>
</tr>
<tr valign=top>
<td width=25%>coefficient</td>
<td width=75%>Coefficient. This has a numeric value of "(inverse of q) mod p".</td>
</tr>
<tr valign=top>
<td width=25%>privateExponent</td>
<td width=75%>Private exponent, often known as "d".</td>
</tr>
</table><br>
<p>
Notice that private-key blobs are not encrypted, but contain private keys in plaintext form.</p>
<p>
When calling <a href="capifunc_9y9l.htm"><b>CryptExportKey</b></a> the developer can choose whether or not to encrypt the key. The PRIVATEKEYBLOB is encrypted if the <i>hExpKey</i> parameter contains a valid handle to a session key. Everything but the <a href="structs_7aya.htm"><b>BLOBHEADER</b></a> portion of the blob is encrypted. Note that the encryption algorithm and encryption key parameters are not stored along with the private-key blob. The application must manage and store this information. If zero is passed for <i>hExpKey</i>, the private key is exported without encryption.</p>
<p>
<b>Warning</b>&nbsp;&nbsp;It is very dangerous to export private keys without encryption, since they are then vulnerable to interception and use by unauthorized entities.</p>
<p>&nbsp;</p></body>
</HTML>
