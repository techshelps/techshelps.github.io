<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Storing Session Keys</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_crypto2_storing_session_keys"></a>Storing Session Keys</h1>
<p>
This section discusses how you use the CryptoAPI to store a session key for later use. This is useful in those situations where you have encrypted a file and want to decrypt the file at a later time. Another possible situation is one in which you have shared the session key with another user and you want to use the key at a later time to send the other user encrypted messages.</p>
<p>
In either case, your application will have to store the session key outside of the CSP for a certain period. Following is the procedure for storing a session key.</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To store a session key</h5>
<ol>
<li>
Create a simple key blob by using the <a href="capifunc_9y9l.htm"><b>CryptExportKey</b></a> function. This will transfer the session key from the CSP to your application's memory space. Specify that your own key exchange public key be used to sign the key blob.</li>
<li>
Store the signed key blob to disk. The assumption is made here that all disks are nonsecure.</li>
<li>
Later, when you need to use the key, read the key blob from disk.</li>
<li>
Import the key blob back into the CSP by using the <a href="capifunc_5np5.htm"><b>CryptImportKey</b></a> function.</li>
</ol>
<p>
If the session key is to be bundled with an encrypted file only (so that you can later decrypt the file), and the key is not going to be used to encrypt any more data, then the preceding procedure provides adequate security.</p>
<p>
If you plan to use the session key for encryption at a later time, then the key blob should be signed with your key exchange private key before the key blob is stored to disk. When you later read the key blob back from disk, you should validate the signature to make sure the key blob is intact. If these steps are omitted, then someone with access to your storage media can create a new session key, encrypt it with your key exchange public key, and substitute it for your key blob. You could then unknowingly use the substituted session key to encrypt files and messages, which the unscrupulous user could then easily decrypt. Digital signatures are discussed in detail in <a href="hashsig_9b8z.htm">Hashes and Digital Signatures</a>. </p>
<p>&nbsp;</p></body>
</HTML>
