<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Using the CryptSignMessage Function and Associated Structures</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_crypto2_using_the_cryptsignmessage_function_and_associated_structures"></a>Using the CryptSignMessage Function and Associated Structures</h3>
<p>
A single function, <a href="sca_8skl.htm"><b>CryptSignMessage</b></a>, is provided to accomplish all of the tasks listed in the previous section. However, initialization of structures and other data is necessary first. The following illustration shows the relationship between those function parameters that point to structures or arrays and their initialized data. The illustration shows only the function parameters and structure members that are derived from other structures or functions. The rest of the parameters are straightforward initializations.</p>
<p>
<img src="images/crypsign.gif" border=0></p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To sign data by using <a href="sca_8skl.htm">CryptSignMessage</a></h5>
<ol>
<li>
Get a pointer to the data that is to be signed.</li>
<li>
Assign the pointer to the data to index zero of a "data to be signed" array.</li>
<li>
Get a handle to the cryptographic provider.</li>
<li>
Open a certificate store that contains the signer's certificate.</li>
<li>
Get an address to the signer's certificate.</li>
<li>
Assign the address of the certificate to index zero of the <i>MsgCert</i> array.</li>
<li>
Assign the addresses of any other certificates to be included with the message to the <i>MsgCert</i> array.</li>
<li>
Initialize the <a href="structs_8rea.htm"><b>CRYPT_ALGORITHM_IDENTIFIER</b></a> structure, initializing the <b>pszObjId</b> member to the desired hash algorithm, and the other members as appropriate.</li>
<li>
Initialize the <a href="structs_568x.htm"><b>CRYPT_SIGN_MESSAGE_PARA</b></a> structure, initializing the <i>pSigningCert</i> member to the address of the signer's certificate and the <i>MsgCert</i> array member to the address of the signer's and other's certificates, the <i>HashAlgorithm</i> member to the address of the <b>CRYPT_ALGORITHM_IDENTIFIER</b> structure, and the other members as appropriate.</li>
<li>
Call the <a href="sca_8skl.htm"><b>CryptSignMessage</b></a> function, passing the <b>CRYPT_SIGN_MESSAGE_PARA</b> structure for the <i>pSignPara</i> parameter, the address of the "data to be signed" array for the <i>rgpbToBeSigned</i> parameter, an address for the <i>pbSignedBlob</i> output parameter, and values for the other parameters as appropriate.</li>
</ol>
<p>&nbsp;</p></body>
</HTML>
