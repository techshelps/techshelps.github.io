<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>CryptEncryptMessage</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_crypto2_cryptencryptmessage"></a>CryptEncryptMessage</h1>
<p>
The <b>CryptEncryptMessage</b> function encrypts and encodes a message.</p>
<pre><code><b>#include &lt;wincrypt.h&gt;
BOOL WINAPI CryptEncryptMessage(
  PCRYPT_ENCRYPT_MESSAGE_PARA</b><i> pEncryptPara</i><b>, </b>// in
<b>  DWORD</b><i> cRecipientCert</i><b>,                     </b>// in
<b>  PCCERT_CONTEXT </b><i>rgpRecipientCert[ ]</i><b>,       </b>// in
<b>  const BYTE </b><i>*pbToBeEncrypted</i><b>,              </b>// in
<b>  DWORD</b><i> cbToBeEncrypted</i><b>,                    </b>// in
<b>  BYTE </b><i>*pbEncryptedBlob</i><b>,                    </b>// out
<b>  DWORD </b><i>*pcbEncryptedBlob                   </i>// in/out
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>pEncryptPara</i></dt>
<dd>
Pointer to the encryption parameters. For details, see <a href="structs_3noz.htm">Simplified Message Data Structures</a>.</dd>
<dt>
<i>cRecipientCert</i></dt>
<dd>
Number of elements in the <i>rgpRecipientCert</i>[] array.</dd>
<dt>
<i>rgpRecipientCert</i>[]</dt>
<dd>
Array of pointers to certificate contexts for the intended recipients of the message.</dd>
<dt>
<i>pbToBeEncrypted</i></dt>
<dd>
Pointer to an application's content (message) that is to be encrypted.</dd>
<dt>
<i>cbToBeEncrypted</i></dt>
<dd>
Size, in bytes, of the message that is to be encrypted.</dd>
<dt>
<i>pbEncryptedBlob</i></dt>
<dd>
Pointer to a buffer that receives the encrypted and encoded message. 
<p>
This parameter can be NULL to set the size of this information for memory allocation purposes. For more information, see <a href="refoview_46pf.htm">Common In/Out Parameter Conventions</a>. 
</dd>
<dt>
<i>pcbEncryptedBlob</i></dt>
<dd>
Pointer to a variable that specifies the size, in bytes, of the buffer pointed to by the <i>pbEncryptedBlob</i> parameter. When the function returns, this variable contains the size, in bytes, of the encrypted and encoded message copied to *<i>pbEncryptedBlob</i>.
<p>
Note that when processing the data returned in the buffer, applications need to use the actual size of the data returned. The actual size may be slightly smaller than the size of the buffer specified on input. (On input, buffer sizes are usually specified large enough to insure that the largest possible output data will fit in the buffer.) On output, the variable pointed to by this parameter is updated to reflect the actual size of the data copied to the buffer.

</dd>
</dl>
<h4>Return Values</h4>
<p>
TRUE if the function succeeded. FALSE if the function failed. </p>
<p>
Call <b>GetLastError</b> to see the reason for any failures. Note that errors from the called functions <a href="capifunc_4ptl.htm"><b>CryptGenKey</b></a>,<b> <a href="capifunc_9tdg.htm">CryptEncrypt</a></b>,<b> <a href="capifunc_5np5.htm">CryptImportKey</a></b>,<b> </b>and <a href="capifunc_9y9l.htm"><b>CryptExportKey</b></a> may be propagated to this function. This function has the following error codes.</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=40%>Error code</th>
<th align=left width=60%>Description</th>
</tr>
<tr valign=top>
<td width=40%>ERROR_MORE_DATA</td>
<td width=60%>If the buffer specified by the <i>pbEncryptedBlob</i> parameter is not large enough to hold the returned data, the function sets the ERROR_MORE_DATA code, and stores the required buffer size, in bytes, into the variable pointed to by <i>pcbEncryptedBlob</i>.</td>
</tr>
<tr valign=top>
<td width=40%>E_INVALIDARG </td>
<td width=60%>Invalid message encoding type. Currently only PKCS_7_ASN_ENCODING is supported. Invalid <b>cbSize</b> in *<i>pEncryptPara</i>.</td>
</tr>
<tr valign=top>
<td width=40%>CRYPT_E_OSS_ERROR </td>
<td width=60%>Message ASN.1 decoding error. Note, to get the OSS error subtract CRYPT_E_OSS_ERROR from the returned error and see asn1code.h for details on the error.</td>
</tr>
</table><br>
<h4>Example</h4>
<p>
See <a href="smf_1jtx.htm">Example Code Using CryptEncryptMessage</a>. </p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 4.0 SP3 or later. Available also in IE 3.02 and later.<br>
<b>&nbsp;&nbsp;Windows: </b>Requires Windows 98 (or Windows 95 with IE 3.02 or later).<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in wincrypt.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use crypt32.lib.</p>
<p>&nbsp;</p></body>
</HTML>
