<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Closing a Certificate Store</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_crypto2_closing_a_certificate_store"></a>Closing a Certificate Store</h2>
<p>
<a href="certstor_9vqd.htm"><b>CertCloseStore</b></a> closes a certificate store.</p>
<p>
When a certificate store is closed, each of the certificate contexts in that store has its reference count reduced by one. Memory is automatically freed for certificates whose reference count goes to zero. </p>
<p>
Setting CERT_CLOSE_STORE_FORCE_FLAG with <b>CertCloseStore </b>closes the certificate store and frees all of its certificate contexts regardless of their reference count. In some cases, such as in multithreaded programs, this may not be desirable. If CERT_CLOSE_STORE_CHECK_FLAG is set, the store is closed, but a warning value is returned by the function if memory is still allocated for certificates whose reference counts have not been reduced to zero. If a certificates reference count is greater than zero, one or more duplicates of that certificate contexts have not been freed. Use <a href="certstor_1tv8.htm"><b>CertFreeCertificateContext</b></a>, <a href="certstor_9kok.htm"><b>CertFreeCRLContext</b></a>, and <a href="certstor_3gc4.htm"><b>CertFreeCTLContext</b></a> to free any certificates left open.</p>
<p>
<b>Note</b>&nbsp;&nbsp;A <i>certificate context</i> is a data structure of type <a href="structs_7uno.htm"><b>CERT_CONTEXT</b></a> that has, among other members, a pointer to the encoded certificate blob and a pointer to a <a href="structs_3k33.htm"><b>CERT_INFO</b></a> data structure. The <b>CERT_INFO</b> structure contains the most significant certificate data. For more information about certificate, CRL and CTL context data structures, see <a href="certe_d_93zb.htm">Certificate Encoding/Decoding</a>. </p>
<p>
Each certificate context also contains a reference count indicating the number of copies of the context's address that have been assigned. Each time a certificate context is duplicated, its reference count in incremented by one. Each time a pointer to a certificate context is freed, the reference count in the certificate context is decremented by one. When the reference count on a certificate context reaches zero, the memory holding the context is de-allocated. Memory allocated for a certificate context is also de-allocated when that context is in a store and the store is closed using CERT_CLOSE_STORE_FORCE_FLAG. If the memory for a context is de-allocated and pointers to that context are still in use, those pointers become invalid.</p>
<p>&nbsp;</p></body>
</HTML>
