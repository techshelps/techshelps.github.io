<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Using the CryptEncryptMessage Function and Associated Structures</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_crypto2_using_the_cryptencryptmessage_function_and_associated_structures"></a>Using the CryptEncryptMessage Function and Associated Structures</h3>
<p>
<a href="sca_11d1.htm"><b>CryptEncryptMessage</b></a>, is the only function call necessary to accomplish all of the tasks listed in the previous section. Here again, initialization of structures and other data is necessary first. The following illustration shows the relationship between those function parameters that point to structures or arrays and their initialized data. </p>
<p>
<img src="images/crypenc.gif" border=0></p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To encrypt data</h5>
<ol>
<li>
Get a pointer to the content to be encrypted.</li>
<li>
Get the size of the content to be encrypted.</li>
<li>
Get a handle on a cryptographic provider.</li>
<li>
Open a certificate store.</li>
<li>
Get the recipient certificate.</li>
<li>
Create the "recipient cert" array.</li>
<li>
Initialize the <a href="structs_8rea.htm"><b>CRYPT_ALGORITHM_IDENTIFIER</b></a> structure.</li>
<li>
Initialize the <a href="structs_40dd.htm"><b>CRYPT_ENCRYPT_MESSAGE_PARA</b></a> structure.</li>
<li>
Call <a href="sca_11d1.htm"><b>CryptEncryptMessage</b></a> to encrypt the content and create a digitally enveloped message.</li>
</ol>
<p>&nbsp;</p></body>
</HTML>
