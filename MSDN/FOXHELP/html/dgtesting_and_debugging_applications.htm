<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Testing and Debugging Applications</title>
<style>
<link disabled rel=stylesheet href=/stylesheets/msdn_ie3.css>
<style type="text/css">
@import url(/stylesheets/msdn_ie4.css);
</style></HEAD>
<BODY>

<h1><a name="dgtesting_and_debugging_applications"></a><sup></sup>Chapter 14: Testing and Debugging Applications</h1>
<p>
Testing involves finding problems in your code; debugging consists of isolating and fixing the problems. Testing and debugging are necessary stages in the development cycle, and they are best incorporated early in the cycle. Thoroughly testing and debugging individual components makes testing and debugging integrated applications much easier.</p>
<p>
For more information about creating an application, see Chapter 2, <a href="dgdeveloping_an_application.htm">Developing an Application</a>, and Chapter 13, <a href="dgcompiling_an_application.htm">Compiling an Application</a>.</p>
<p>
This chapter discusses:</p>
<ul type=disc>
<li>
<a href="#dgplanning_to_test_and_debug">Planning to Test and Debug</a></li>
<li>
<a href="#dgdebugging_before_you_have_bugs">Debugging Before You Have Bugs</a></li>
<li>
<a href="#dgisolating_problems">Isolating Problems</a></li>
<li>
<a href="#dgdisplaying_output">Displaying Output</a></li>
<li>
<a href="#dglogging_code_coverage">Logging Code Coverage</a></li>
<li>
<a href="#dghandling_run_time_errors">Handling Run-Time Errors</a></li>
</ul>

<h2><a name="dgplanning_to_test_and_debug"></a>Planning to Test and Debug</h2>
<p>
Typically, developers look for different levels of robustness as they are testing and debugging their applications:
<ol>
<li>
Running without crashing or generating error messages.<br><br></li>
<li>
Appropriate action in common scenarios.<br><br></li>
<li>
Reasonable action or error messages in a range of scenarios.<br><br></li>
<li>
Graceful recovery from unexpected user interactions.</li>
</ol>
<p>
Visual FoxPro provides a rich set of tools to help you isolate and identify the problems in your code so that you can fix them effectively. However, one of the best ways to create a robust application is to look for potential problems before they occur.</p>

<h2><a name="dgdebugging_before_you_have_bugs"></a>Debugging Before You Have Bugs</h2>
<p>
Studies have shown that good coding practices (using white space, including comments, adhering to naming conventions, and so on) automatically tend to reduce the number of bugs in your code. In addition, there are some steps you can take early in the development process to make testing and debugging easier later on, including:</p>
<ul type=disc>
<li>
Creating a Test Environment</li>
<li>
Setting Asserts</li>
<li>
Seeing Event Sequences</li>
</ul>
<h3>Creating a Test Environment</h3>
<p>
The system environment that you expect an application to run in is as important as the data environment you have set up for the application itself. To ensure portability and to create an appropriate context for testing and debugging, you need to consider the following:</p>
<ul type=disc>
<li>
Hardware and software</li>
<li>
System paths and file properties</li>
<li>
Directory structure and file locations</li>
</ul>
<h4>Hardware and Software</h4>
<p>
For maximum portability, you should develop applications on the lowest common platform you expect them to run on. To establish a baseline platform:</p>
<ul type=disc>
<li>
Develop your applications using the lowest common video mode.</li>
<li>
Determine base requirements for RAM and media storage space, including any necessary drivers or concurrently running software.</li>
<li>
Consider special memory, file, and record-locking scenarios for network versus stand-alone versions of applications.</li>
</ul>
<h4>System Paths and File Properties</h4>
<p>
To ensure all necessary program files are readily accessible on each machine that will run your application, you might also require a baseline file configuration. To help you define a configuration baseline, answer the following questions:</p>
<ul type=disc>
<li>
Does your application require common system paths?</li>
<li>
Have you set appropriate file access properties?</li>
<li>
Are network permissions set correctly for each user?</li>
</ul>
<p>
<b>Directory Structure and File Locations</b></p>
<p>
If your source code references absolute paths or file names, those exact paths and files must exist when your application is installed on any other computer. To avoid this scenario, you can:</p>
<ul type=disc>
<li>
Use Visual FoxPro configuration files. For additional information on using configuration files, see Chapter 3, <a href="igconfiguring_visual_foxpro.htm">Configuring Visual FoxPro</a>, in the <i>Installation Guide.</i></li>
<li>
Create a separate directory or directory structure to keep source files apart from the generated application files. This way, you can test the references of the completed application and know exactly which files to distribute.</li>
<li>
Use relative paths.</li>
</ul>
<h3>Setting Asserts</h3>
<p>
You can include asserts in your code to verify assumptions you have about the run-time environment for the code.</p>
<p class=label>
<b>To set an assert</b>
<ul type=disc>
<li>
Use the <a href="lngassertcommand.htm">ASSERT</a> command to identify assumptions in your program.<p class=tl>
When the condition stipulated in the ASSERT command evaluates to false (.F.), an assert message box is displayed and echoed to the <b>Debug Output</b> window.</P></li>
</ul>
<p>
For example, you could be writing a function that expects a non-zero parameter value. The following line of code in the function alerts you if the value of the parameter is 0:</p>
<pre><code>ASSERT nParm != 0 MESSAGE "Received a parameter of 0"
</code></pre>
<p>
You can specify whether assert messages are displayed with the <a href="lngset_asserts.htm">SET ASSERTS</a> command. By default, assert messages are not displayed.</p>
<h3>Seeing Event Sequences</h3>
<p>
When you see events occur in relation to other events, you can determine the most efficient place to include your code.</p>
<p class=label>
<b>To track events</b>
<ul type=disc>
<li>
From the <b>Tools</b> menu in the <a href="wnddebugger_window.htm">Debugger</a> window, choose <b>Event Tracking</b>.<p class=tl>
-or-</P></li>
<li>
Use the <a href="lngset_eventtracking.htm">SET EVENTTRACKING</a> command.</li>
</ul>
<p>
The Event Tracking Dialog Box allows you to select the events that you want to see.</p>
<p class=label>
<b>Event Tracking Dialog Box</b></p>
<p>
<img src="afd04005.gif" border=0></p>
<p class=indent>
<B><b>Note</b></B>&nbsp;&nbsp;&nbsp;In this example, the MouseMove and Paint events have been removed from the Events to track list because these events occur so frequently that they make it more difficult to see the sequences of the other events.</p>
<p>
When event tracking is enabled, every time a system event in the Events to track list occurs, the name of the event is displayed in the <a href="wnddebug_output_window.htm">Debug Output</a> window or written to a file. If you choose to have the events displayed in the Debug Output window, you can still save them to a file as described in <a href="#dgdisplaying_output">Displaying Output</a> later in this chapter.</p>
<p class=indent>
<B><b>Note</b></B>&nbsp;&nbsp;&nbsp;If the Debug Output window is not open, events will not be listed, even if the Debugger Output Window box is set.</p>

<h2><a name="dgisolating_problems"></a>Isolating Problems</h2>
<p>
Once your testing has identified problems, you can use the Visual FoxPro debugging environment to isolate those problems by:</p>
<ul type=disc>
<li>
Starting a debugging session</li>
<li>
Tracing through code</li>
<li>
Suspending program execution</li>
<li>
Seeing stored values</li>
<li>
Displaying output</li>
</ul>
<h3>Starting a Debugging Session</h3>
<p>
You start a debugging session by opening the debugging environment.</p>
<p class=label>
<b>To open the debugger</b>
<ul type=disc>
<li>
From the <b>Tools</b> menu, choose <b>Debugger</b>.<p class=atl>
<B><b>Note</b></B>&nbsp;&nbsp;&nbsp;If you're debugging in the Visual FoxPro environment, choose the debugging tool you want to open from the Tools menu.</p></li>
</ul>
<p>
You can also open the debugger with any of the following commands:</p>
<p>
<a href="lngdebug.htm">DEBUG</a></p>
<p>
<a href="lngset_step.htm">SET STEP ON</a></p>
<p>
<a href="lngset_echo.htm">SET ECHO ON</a></p>
<pre></pre>
<p>
The debugger opens automatically whenever a breakpoint condition is met.</p>
<h3>Tracing Through Code</h3>
<p>
One of the most useful debugging strategies at your disposal is the ability to trace through code, see each line of code as it executes, and check the values of all variables, properties, and environment settings.</p>
<p class=label>
<b>Code in the Trace window</b></p>
<p>
<img src="afd14001.gif" border=0></p>
<p class=label>
<b>To trace through code</b>
<ol>
<li>
Start a debugging session.<br><br></li>
<li>
If no program is open in the <a href="wndtrace_window.htm">Trace</a> window, choose <b>Do</b> from the <b>Debug</b> menu.<br><br></li>
<li>
Choose <b>Step Into</b> from the <b>Debug</b> menu or click the <b>Step Into</b> toolbar button.</li>
</ol>
<p>
An arrow in the gray area to the left of the code indicates the next line to execute.</p>
<p class=indent>
<B><b>Tips</b></B>&nbsp;&nbsp;&nbsp;The following tips apply:
<ul type=disc>
<li>
Set breakpoints to narrow the range of code you need to step through.<br><br></li>
<li>
You can skip a line of code you know will generate an error by placing the cursor on the line of code after the problem line and choosing <b>Set Next Statement</b> from the <b>Debug</b> menu.<br><br></li>
<li>
If you have much code associated with Timer events, you can avoid tracing through this code by clearing <b>Display Timer Event</b> in the <b>Debugging</b> tab of the <b>Options</b> dialog box.</li>
</ul>
<p>
If you isolate a problem when you're debugging a program or object code, you can immediately fix it.</p>
<p class=label>
<b>To fix problems encountered while tracing code</b>
<ul type=disc>
<li>
From the <b>Debug</b> menu, choose <b>Fix</b>.</li>
</ul>
<p>
When you choose Fix from the Debug menu, program execution is canceled and the code editor is opened to the location of the cursor in the Trace window.</p>
<h2>Suspending Program Execution</h2>
<p>
Breakpoints allow you to suspend program execution. Once program execution has been suspended, you can check the values of variables and properties, see environment settings, and examine sections of code line by line without having to step through all your code.</p>
<p class=indent>
<B><b>Tip</b></B>&nbsp;&nbsp;&nbsp;You can also suspend execution of a program running in the Trace window by pressing ESC.</p>
<h3>Suspending Execution at a Line of Code</h3>
<p>
You can set breakpoints in your code to suspend program execution in several different ways. If you know where you want to suspend program execution, you can set a breakpoint directly on that line of code.</p>
<p class=label>
<b>To set a breakpoint on a particular line of code</b></p>
<p>
In the <a href="wndtrace_window.htm">Trace</a> window, locate the line of code you want to set the breakpoint on and do one of the following:
<ol>
<li>
Position the cursor on the line of code.<br><br></li>
<li>
Press F9 or click the <b>Toggle Breakpoints</b> button in the <b>Debugger</b> toolbar.<p class=tl>
-or-</P></li>
</ol>
<ul type=disc>
<li>
Double-click in the gray area to the left of the line of code.</li>
</ul>
<p>
A solid dot is displayed in the gray area to the left of the line of code to indicate that a breakpoint has been set on that line.</p>
<p class=indent>
<B><b>Tip</b></B>&nbsp;&nbsp;&nbsp;If you are debugging objects, you can locate particular lines of code in the Trace window by choosing the object from the Object list and the method or event from the Procedure list.</p>
<p>
You can also set breakpoints by specifying locations and files in the Breakpoints dialog box.</p>
<p class=label>
<b>Breaking at a location</b></p>
<p>
<img src="afd14003.gif" border=0></p>
<p class=label>
<b>Examples of Locations and Files for Breakpoints</b></p>
<table border=1 cellpadding=5 cols=3 frame=below rules=rows>
<tr valign=top>
<td class=label width=29%><b>Location</b></td>
<td class=label width=30%><b>File</b></td>
<td class=label width=41%><b>Where execution suspends</b></td>
</tr>
<tr valign=top>
<td width=29%><pre><code>ErrHandler</code></pre>
</td>
<td width=30%>C:\Myapp\Main.prg</td>
<td width=41%>The first executable line in a procedure named <code>ErrHandler</code> in Main.prg.</td>
</tr>
<tr valign=top>
<td width=29%><pre><code>Main,10</code></pre>
</td>
<td width=30%>C:\Myapp\Main.prg</td>
<td width=41%>The tenth line in the program named <code>Main</code>.</td>
</tr>
<tr valign=top>
<td width=29%><pre><code>Click</code></pre>
</td>
<td width=30%>C:\Myapp\Form.scx</td>
<td width=41%>The first executable line of any procedure, function, method or event named <code>Click</code> in Form.scx.</td>
</tr>
<tr valign=top>
<td width=29%><pre><code>cmdNext.Click</code></pre>
</td>
<td width=30%>C:\Myapp\Form.scx</td>
<td width=41%>The first executable line associated with the Click event of <code>cmdNext</code> in Form.scx.</td>
</tr>
<tr valign=top>
<td width=29%><pre><code>cmdNext::Click</code></pre>
</td>
<td width=30%></td>
<td width=41%>The first executable line in the Click event of any control whose ParentClass is <code>cmdNext</code> in any file.</td>
</tr>
</table><br>
<h3>Suspending Execution When Values Change</h3>
<p>
If you want to know when the value of a variable or property changes, or when a run-time condition changes, you can set a breakpoint on an expression.</p>
<p class=label>
<b>Breaking when an expression changes</b></p>
<p>
<img src="afd14004.gif" border=0></p>
<p class=label>
<b>To suspend program execution when the value of an expression changes</b>
<ol>
<li>
From the <b>Tools</b> menu in the <a href="wnddebugger_window.htm">Debugger</a> window, choose <b>Breakpoints </b>to open the <a href="cmdbreakpoints_dialog_box.htm">Breakpoints</a> dialog box.<br><br></li>
<li>
From the <b>Type</b> list, choose <b>Break when expression has changed</b>.<br><br></li>
<li>
Enter the expression in the <b>Expression</b> box.</li>
</ol>
<p class=label>
<b>Examples of breakpoint expressions</b></p>
<table border=1 cellpadding=5 cols=2 frame=below rules=rows>
<tr valign=top>
<td class=label width=50%><b>Expression</b></td>
<td class=label width=50%><b>Use</b></td>
</tr>
<tr valign=top>
<td width=50%><pre><code>RECNO(&nbsp;)</code></pre>
</td>
<td width=50%>Suspend execution when the record pointer moves in the table.</td>
</tr>
<tr valign=top>
<td width=50%><pre><code>PROGRAM(&nbsp;)</code></pre>
</td>
<td width=50%>Suspend execution on the first line of any new program, procedure, method, or event.</td>
</tr>
<tr valign=top>
<td width=50%><pre><code>myform.Text1.Value</code></pre>
</td>
<td width=50%>Suspend execution any time the value of this property is changed interactively or programmatically.</td>
</tr>
</table><br>
<h3>Suspending Execution Conditionally</h3>
<p>
Often you’ll want to suspend program execution, not at a particular line, but when a certain condition is true.</p>
<p class=label>
<b>Breaking on an expression</b></p>
<p>
<img src="afd14005.gif" border=0></p>
<p class=label>
<b>To suspend program execution when an expression evaluates to true</b>
<ol>
<li>
From the <b>Tools</b> menu in the <a href="wnddebugger_window.htm">Debugger</a> window, choose <b>Breakpoints </b>to open the <a href="cmdbreakpoints_dialog_box.htm">Breakpoints</a> dialog box.<br><br></li>
<li>
From the <b>Type</b> list, choose <b>Break when expression is true</b>.<br><br></li>
<li>
Enter the expression in the <b>Expression</b> box.<br><br></li>
<li>
Choose <b>Add</b> to add the breakpoint to the <b>Breakpoints</b> list.</li>
</ol>
<p class=label>
<b>Examples of breakpoint expressions</b></p>
<table border=1 cellpadding=5 cols=2 frame=below rules=rows>
<tr valign=top>
<td class=label width=36%><b>Expression</b></td>
<td class=label width=64%><b>Use</b></td>
</tr>
<tr valign=top>
<td width=36%><pre><code>EOF(&nbsp;)</code></pre>
</td>
<td width=64%>Suspend execution when the record pointer has moved past the last record in a table.</td>
</tr>
<tr valign=top>
<td width=36%><pre><code>'CLICK'$PROGRAM(&nbsp;)</code></pre>
</td>
<td width=64%>Suspend execution on the first line of code associated with a Click or DblClick event.</td>
</tr>
<tr valign=top>
<td width=36%><pre><code>nReturnValue = 6</code></pre>
</td>
<td width=64%>If the return value of a message box is stored to <code>nReturnValue</code>, suspend execution when a user chooses <b>Yes</b> in the message box.</td>
</tr>
</table><br>
<h3>Suspending Execution Conditionally at a Line of Code</h3>
<p>
You can specify that program execution be suspended at a particular line only when a particular condition is true.</p>
<p class=label>
<b>Breaking when an expression is true</b></p>
<p>
<img src="afd14006.gif" border=0></p>
<p class=label>
<b>To suspend program execution at a particular line when an expression evaluates to true</b>
<ol>
<li>
From the <b>Tools</b> menu in the <a href="wnddebugger_window.htm">Debugger</a> window, choose <b>Breakpoints </b>to open the <a href="cmdbreakpoints_dialog_box.htm">Breakpoints</a> dialog box.<br><br></li>
<li>
From the <b>Type</b> list, choose <b>Break at location if expression is true</b>.<br><br></li>
<li>
Enter the location in the <b>Location</b> box.<br><br></li>
<li>
Enter the expression in the <b>Expression</b> box.<br><br></li>
<li>
Choose <b>Add</b> to add the breakpoint to the <b>Breakpoints</b> list.<br><br></li>
<li>
Choose <b>OK</b>.<p class=atl>
<B><b>Tip</b></B>&nbsp;&nbsp;&nbsp;It is sometimes easier to locate the line of code in the Trace window, set a breakpoint, and then edit that breakpoint in the Breakpoints dialog box. To do this, change the <b>Type</b> from <b>Break at location</b> to <b>Break at location if expression is true</b> and then add the expression.</p></li>
</ol>
<h3>Removing Breakpoints</h3>
<p>
You can disable breakpoints without removing them in the Breakpoints dialog box. You can delete “break at location” breakpoints in the Trace window.</p>
<p class=label>
<b>To remove a breakpoint from a line of code</b></p>
<p>
In the <a href="wndtrace_window.htm">Trace</a> window, locate the breakpoint and do one of the following:
<ul type=disc>
<li>
Position the cursor on the line of code, and then choose <b>Toggle Breakpoints</b> from the <b>Debugger</b> toolbar.<p class=tl>
-or-</P></li>
<li>
Double-click the gray area to the left of the line of code.</li>
</ul>
<h3>Seeing Stored Values</h3>
<p>
In the Debugger window, you can easily see the run-time values of variables, array elements, properties, and expressions in the following windows:</p>
<ul type=disc>
<li>
Locals Window</li>
<li>
Watch Window</li>
<li>
Trace Window</li>
</ul>
<h4>Seeing Stored Values in the Locals Window</h4>
<p>
The Locals window displays all the variables, arrays, objects, and object members that are visible in any program, procedure, or method on the call stack. By default, values for the currently executing program are displayed in the Locals window. You can see these values for other programs or procedures on the call stack by choosing the programs or procedures from the Locals For list.</p>
<p class=label>
<b>Locals window</b></p>
<p>
<img src="afd14007.gif" border=0></p>
<p>
You can drill down into arrays or objects by clicking the plus (+) beside the array or object name in the Locals and Watch windows. When you drill down, you can see the values of all the elements in the arrays and all the property settings in objects.</p>
<p>
You can even change the values in variables, array elements, and properties in the Locals and Watch windows by selecting the variable, array element, or property, clicking in the Value column, and typing a new value.</p>
<h4>Seeing Stored Values in the Watch Window</h4>
<p>
In the Watch box of the Watch window, type any valid Visual FoxPro expression and press ENTER. The value and type of the expression appears in the Watch window list.</p>
<p class=label>
<b>Watch window</b></p>
<p>
<img src="afd14008.gif" border=0></p>
<p class=indent>
<B><b>Note</b></B>&nbsp;&nbsp;&nbsp;You can’t enter expressions in the Watch window that create objects.</p>
<p>
You can also select variables or expressions in the Trace window or other Debugger windows and drag them into the Watch window.</p>
<p>
Values that have changed are displayed in red in the Watch window.</p>
<p class=label>
<b>To remove an item from the Watch window list</b></p>
<p>
Select the item and choose one of the following:
<ul type=disc>
<li>
Press DEL.<p class=tl>
-or-</P></li>
<li>
From the shortcut menu, choose <b>Delete Watch</b>.</li>
</ul>
<p class=label>
<b>To edit a watch</b>
<ul type=disc>
<li>
Double-click the watch in the <b>Watch</b> window and edit in place.</li>
</ul>
<h4>Seeing Stored Values in the Trace Window</h4>
<p>
Position the cursor over any variable, array element, or property in the Trace window to display its current value in a value tip.</p>
<p class=label>
<b>A value tip in the Trace window</b></p>
<p>
<img src="afd14009.gif" border=0></p>

<h2><a name="dgdisplaying_output"></a>Displaying Output</h2>
<p>
The <a href="lngdebugout.htm">DEBUGOUT</a> command allows you to write values in the Debug<b> </b>Output window to a text file log. Alternatively, you can use the <a href="lngset_debugout.htm">SET DEBUGOUT TO</a> command or the <a href="cmddebug_tab_options_dialog_box.htm">Debug</a> tab of the Options dialog box.</p>
<p>
If you aren't writing DEBUGOUT commands to a text file, the <a href="wnddebug_output_window.htm">Debug Output</a> window must be open in order for the DEBUGOUT values to be written. The following line of code prints in the Debug Output<b> </b>window at the time that the line of code executes:</p>
<pre><code>DEBUGOUT DATETIME(&nbsp;)
</code></pre>
<p>
In addition, you can enable event tracking, described earlier in this chapter, and choose to have the name and parameters of each event that occurs displayed in the Debug Output window.</p>

<h2><a name="dglogging_code_coverage"></a>Logging Code Coverage</h2>
<p>
Later in the development process, you might want to refine your code for performance and ensure that you've adequately tested the code by logging code coverage information.</p>
<p>
Code coverage gives you information about which lines of code have been executed and how long it took to execute them. This information can help you identify areas of code that aren’t being executed and therefore aren’t being tested, as well as areas of the code that you may want to fine tune for performance.</p>
<p>
<img src="coverage.gif" border=0></p>
<p>
You can toggle code coverage on and off by clicking the Code Coverage toolbar button in the <a href="wnddebugger_window.htm">Debugger</a> window. If you toggle code coverage on, the <a href="cmdcoverage_dialog_box.htm">Coverage</a> dialog box opens so that you can specify a file to save the coverage information to.</p>
<p class=label>
<b>Coverage Dialog Box</b></p>
<p>
<img src="afd14010.gif" border=0></p>
<p>
You can also toggle coverage logging on and off programmatically by using the <a href="lngset_coverage.htm">SET COVERAGE TO</a> command. You could, for example, include the following command in your application just before a piece of code you want to investigate:</p>
<pre><code>SET COVERAGE TO mylog.log
</code></pre>
<p>
After the section of code you want to log coverage for, you could include the following command to set code coverage off:</p>
<pre><code>SET COVERAGE TO
</code></pre>
<p>
When you've specified a file for the coverage information, switch to the main Visual FoxPro window and run your program, form, or application. For every line of code that is executed, the following information is written to the log file:</p>
<ul type=disc>
<li>
How long in seconds the line took to execute.</li>
<li>
The class, if any, that the code belongs to.</li>
<li>
The method or procedure the line of code is in.</li>
<li>
The number of the line of code.</li>
<li>
The file that the code is in.</li>
</ul>
<p>
The easiest way to extract information from the log file is to convert it into a table so that you can set filters, run queries and reports, execute commands, and manipulate the table in other ways.</p>
<p>
The <a href="dgapplication_development_and_developer_productivity.htm#newcoverage_profiler_application">Coverage Profiler application</a> creates a cursor from the data generated in coverage logging and uses this cursor in a window for easy analysis.</p>
<p>
The following program converts the text file created by the coverage log into a table:</p>
<pre><code>cFileName = GETFILE('DBF')
IF EMPTY(cFileName)
 &nbsp; RETURN
ENDIF

CREATE TABLE (cFileName) ;
 &nbsp; (duration n(7,3), ;
 &nbsp; class c(30), ;
 &nbsp; procedure c(60), ;
 &nbsp; line i, ;
 &nbsp; file c(100))
 &nbsp; 
APPEND FROM GETFILE('log') TYPE DELIMITED
</code></pre>

<h2><a name="dghandling_run_time_errors"></a>Handling Run-Time Errors</h2>
<p>
Run-time errors occur after the application starts to execute. Actions that would generate run-time errors include: writing to a file that doesn’t exist, attempting to open a table that is already open, trying to select a table that has been closed, encountering a data conflict, dividing a value by zero, and so on.</p>
<p>
The following commands and functions are useful when anticipating and managing run-time errors.</p>
<table border=1 cellpadding=5 cols=2 frame=below rules=rows>
<tr valign=top>
<td class=label width=57%><b>To</b></td>
<td class=label width=43%><b>Use</b></td>
</tr>
<tr valign=top>
<td width=57%>Fill an array with error information</td>
<td width=43%><a href="lngaerrorlp_rp.htm">AERROR(&nbsp;)</a></td>
</tr>
<tr valign=top>
<td width=57%>Open the Debugger or Trace window</td>
<td width=43%><a href="lngdebug.htm">DEBUG</a> or <a href="lngset_step.htm">SET STEP</a> ON</td>
</tr>
<tr valign=top>
<td width=57%>Generate a specific error to test your error handling</td>
<td width=43%><a href="lngerror.htm">ERROR</a></td>
</tr>
<tr valign=top>
<td width=57%>Return an error number</td>
<td width=43%><a href="lngerrorlp_rp.htm">ERROR(&nbsp;)</a></td>
</tr>
<tr valign=top>
<td width=57%>Return an executing program line</td>
<td width=43%><a href="lnglinenolp_rp.htm">LINENO(&nbsp;)</a></td>
</tr>
<tr valign=top>
<td width=57%>Return an error message string</td>
<td width=43%><a href="lngmessagelp_rp.htm">MESSAGE(&nbsp;)</a></td>
</tr>
<tr valign=top>
<td width=57%>Execute a command when an error occurs</td>
<td width=43%><a href="lngon_error.htm">ON ERROR</a></td>
</tr>
<tr valign=top>
<td width=57%>Return commands assigned to error handling commands</td>
<td width=43%><a href="lngonlp_rp.htm">ON(&nbsp;)</a></td>
</tr>
<tr valign=top>
<td width=57%>Return the name of the currently executing program</td>
<td width=43%><a href="lngprogramlp_rp.htm">PROGRAM(&nbsp;)</a> OR <a href="lngsyslp16rp___executing_program_file_name.htm">SYS(16)</a></td>
</tr>
<tr valign=top>
<td width=57%>Re-execute the previous command</td>
<td width=43%><a href="lngretry.htm">RETRY</a></td>
</tr>
<tr valign=top>
<td width=57%>Return any current error message parameter</td>
<td width=43%><a href="lngsyslp2018rp___error_message_parameter.htm">SYS(2018)</a></td>
</tr>
</table><br>
<h3>Anticipating Errors</h3>
<p>
The first line of defense against run-time errors is anticipating where they could occur and coding around them. For example, the following line of code moves the record pointer to the next record in the table:</p>
<pre><code>SKIP
</code></pre>
<p>
This code works unless the record pointer is already past the last record in the table, at which point an error will occur.</p>
<p>
The following lines of code anticipate this error and avoid it:</p>
<pre><code>IF !EOF()
 &nbsp; SKIP
 &nbsp;&nbsp;&nbsp;&nbsp; IF EOF()
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GO BOTTOM
 &nbsp;&nbsp;&nbsp;&nbsp; ENDIF
ENDIF
</code></pre>
<p>
As another example, the following line of code displays the Open dialog box to allow a user to open a table in a new work area:</p>
<pre><code>USE GETFILE('DBF') IN 0
</code></pre>
<p>
The problem is that the user could choose Cancel in the Open dialog box or type the name of a file that doesn’t exist. The following code anticipates this by making sure that the file exists before the user tries to use it:</p>
<pre><code>cNewTable = GETFILE('DBF')
IF FILE(cNewTable)
 &nbsp; USE (cNewTable) IN 0
ENDIF
</code></pre>
<p>
Your end user may also type the name of a file that isn’t a Visual FoxPro table. To circumvent this problem, you could open the file with low-level file I/O functions, parse the binary header, and make sure that the file is indeed a valid table. However, this would be a bit of work and it might noticeably slow down your application. You would be better off handling the situation at run time by displaying a message like “Please open another file. This one is not a table” when error 15, “Not a table,” occurs.</p>
<p>
You can’t, and probably don’t want to, anticipate all possible errors, so you'll need to trap some by writing code to be executed in the event of a run time error.</p>
<h3>Handling Procedural Errors</h3>
<p>
When an error occurs in procedural code, Visual FoxPro checks for error-handling code associated with an <a href="lngon_error.htm">ON ERROR</a> routine. If no ON ERROR routine exists, Visual FoxPro displays the default Visual FoxPro error message. For a complete list of Visual FoxPro error messages and error numbers, see Help.</p>
<h4>Creating an ON ERROR routine</h4>
<p>
You can include any valid FoxPro command or expression after ON ERROR, but normally you call an error-handling procedure or program.</p>
<p>
To see how ON ERROR works, you can type an unrecognizable command in the Command window, such as:</p>
<pre><code>qxy
</code></pre>
<p>
You’ll get a standard Visual FoxPro error message dialog box saying “Unrecognized command verb.” But if you execute the following lines of code, you’ll see the error number, 16, printed on the active output window instead of the standard error message displayed in a dialog box:</p>
<pre><code>ON ERROR ?ERROR()
qxy
</code></pre>
<p>
Issuing ON ERROR with nothing after it resets the built-in Visual FoxPro error messaging:</p>
<pre><code>ON ERROR
</code></pre>
<p>
In skeletal form, the following code illustrates an ON ERROR error handler:</p>
<pre><code>LOCAL lcOldOnError

* Save the original error handler
lcOldOnError = ON("ERROR")

* Issue ON ERROR with the name of a procedure
ON ERROR DO errhandler WITH ERROR(), MESSAGE()

* code to which the error handling routine applies

* Reset the original error handler
ON ERROR &amp;lcOldOnError

PROCEDURE errhandler
LOCAL aErrInfo[1]
AERROR(aErrInfo)
DO CASE
 &nbsp; CASE aErrInfo[1] = 1 &amp;&amp; File Does Not Exist
 &nbsp;&nbsp;&nbsp;&nbsp; * display an appropriate message
 &nbsp;&nbsp;&nbsp;&nbsp; * and take some action to fix the problem.
 &nbsp; OTHERWISE
 &nbsp;&nbsp;&nbsp;&nbsp; * display a generic message, maybe
 &nbsp;&nbsp;&nbsp;&nbsp; * send high priority mail to an administrator
ENDPROC
</code></pre>
<h3>Handling Errors in Classes and Objects</h3>
<p>
When an error occurs in method code, Visual FoxPro checks for error-handling code associated with the Error event of the object. If no code has been written at the object level for the Error event, the Error event code inherited from the parent class, or another class up the class hierarchy, is executed. If no code has been written for the Error event anywhere in the class hierarchy, Visual FoxPro checks for an ON ERROR routine. If no ON ERROR routine exists, Visual FoxPro displays the default Visual FoxPro error message.</p>
<p>
The beauty of classes is that you can encapsulate everything a control needs, including error handling, so that you can use the control in a variety of environments. Later, if you discover another error the control might encounter, you can add handling for that error to the class, and all objects based on your class will automatically inherit the new error handling.</p>
<p>
For example, the <code>vcr</code> class in the Buttons.vcx class library, located in the Visual Studio …\Samples\Vfp98\Classes directory, is based on the Visual FoxPro container class.</p>
<p>
<img src="afd14011.gif" border=0></p>
<p>
Four command buttons in the container manage table navigation, moving the record pointer in a table with the following commands:</p>
<pre><code>GO TOP
SKIP - 1
SKIP 1
GO BOTTOM.
</code></pre>
<p>
An error could occur when a user chooses one of the buttons and no table is open. Visual FoxPro attempts to write buffered values to a table when the record pointer moves. So an error could also occur if optimistic row buffering is enabled and another user has changed a value in the buffered record.</p>
<p>
These errors could occur when the user chooses any one of the buttons; therefore, it doesn’t make sense to have four separate error handling methods. The following code associated with the Error event of each of the command buttons passes the error information to the single error-handling routine of the class:</p>
<pre><code>LPARAMETERS nError, cMethod, nLine
THIS.Parent.Error(nError, cMethod, nLine)
</code></pre>
<p>
The following code is associated with the Error event of the <code>vcr</code> class. The actual code differs because of coding requirements for localization.</p>
<pre><code>Parameters nError, cMethod, nLine
DO CASE
CASE nError = 13 &amp;&amp; Alias not found
 &nbsp; cNewTable = GETFILE('DBF')
 &nbsp; IF FILE(cNewTable)
 &nbsp;&nbsp;&nbsp;&nbsp; SELECT 0
 &nbsp;&nbsp;&nbsp;&nbsp; USE (cNewTable)
 &nbsp;&nbsp;&nbsp;&nbsp; This.SkipTable = ALIAS()
 &nbsp; ELSE
 &nbsp;&nbsp;&nbsp;&nbsp; This.SkipTable = ""
 &nbsp; ENDIF
CASE nError = 1585 &amp;&amp; Data Conflict
* Update conflict handled by a datachecker class 
 &nbsp; nConflictStatus = ;
 &nbsp;&nbsp;&nbsp;&nbsp; THIS.DataChecker1.CheckConflicts()
 &nbsp; IF nConflictStatus = 2
 &nbsp;&nbsp;&nbsp;&nbsp; MESSAGEBOX "Can't resolve a data conflict."
 &nbsp; ENDIF
OTHERWISE
* Display information about other errors.

 &nbsp; cMsg="Error:" + ALLTRIM(STR(nError)) + CHR(13) ;
 &nbsp;&nbsp;&nbsp;&nbsp; + MESSAGE()+CHR(13)+"Program:"+PROGRAM()

 &nbsp; nAnswer = MESSAGEBOX(cMsg, 2+48+512, "Error")
 &nbsp; DO CASE
 &nbsp;&nbsp;&nbsp;&nbsp; CASE nAnswer = 3&nbsp;&nbsp; &amp;&amp;Abort
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CANCEL
 &nbsp;&nbsp;&nbsp;&nbsp; CASE nAnswer = 4&nbsp;&nbsp; &amp;&amp;Retry
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RETRY
 &nbsp;&nbsp;&nbsp;&nbsp; OTHERWISE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;&amp; Ignore
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RETURN
 &nbsp; ENDCASE
ENDCASE
</code></pre>
<p>
You want to make sure that you supply information for an error that you haven’t handled. Otherwise, the error event code will execute but won’t take any actions, and the default Visual FoxPro error message will no longer be displayed. You, as well as the user, won’t know what happened.</p>
<p>
Depending on your target users, you might want to supply more information in the case of an unhandled error, such as the name and phone number of someone to call for help.</p>
<h3>Returning from Error Handling Code</h3>
<p>
After the error handling code executes, the line of code following the one that caused the error is executed. If you want to re-execute the line of code that caused the error after you've changed the situation that caused the error, use the <a href="lngretry.htm">RETRY</a> command.</p>
<p class=indent>
<B><b>Note</b></B>&nbsp;&nbsp;&nbsp;The Error event can be called when the error encountered wasn’t associated with a line of your code. For example, if you call a data environment’s CloseTables method in code when AutoCloseTables is set to true (.T.) and then release the form, an internal error is generated when Visual FoxPro tries to close the tables again. You can trap for this error, but there is no line of code to RETRY.</p>
</BODY>
</HTML>
