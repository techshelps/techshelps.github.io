<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Updating Data with Views</title>
<style>
<link disabled rel=stylesheet href=/stylesheets/msdn_ie3.css>
<style type="text/css">
@import url(/stylesheets/msdn_ie4.css);
</style></HEAD>
<BODY>

<h1><a name="ugupdating_data_with_views"></a><sup></sup>Chapter 5: Updating Data with Views</h1>
<p>
To extract a set of records from a table,<b> </b>make changes to those records, and send the updates to the source tables, you can use a <a href="glsview.htm">view</a>. You can create views from local tables, from other views, from tables stored on a server, or from remote data sources, such as Microsoft<sup>®</sup> SQL Server, via ODBC. You can even have Visual FoxPro send updates to the source table when you update or change the set of records in the view.</p>
<p>
This chapter covers creating simple, single-table local and remote views. For information about creating complex views and combining local and remote data in a single view, see Chapter 6, <a href="ugquerying_and_updating_multiple_tables.htm">Querying and Updating Multiple Tables</a>.</p>
<p>
This chapter discusses:</p>
<ul type=disc>
<li>
<a href="#ugcreating_views">Creating Views</a></li>
<li>
<a href="#ugconnecting_to_remote_data">Connecting to Remote Data</a></li>
<li>
<a href="#ugupdating_data">Updating Data</a></li>
<li>
<a href="#ugcustomizing_views">Customizing Views</a></li>
</ul>

<h2><a name="ugcreating_views"></a>Creating Views</h2>
<p>
Creating queries and views are similar processes. The main difference is that views can be updatable, while queries are not. Use queries when you want to display a set of records that are read-only. Queries are a SQL - SELECT statement saved as text in a .qpr file; use views when you want to extract an updatable set of data from local or remote tables.</p>
<p class=label>
<b>Queries, views, and remote views</b></p>
<p>
<img src="afu05013.gif" border=0></p>
<p>
For example, you can display, but not update, the records retrieved by a query. But when you edit the records in a view, you can have the changes sent to the source table, updating it.</p>
<p>
Views are a feature of Visual FoxPro databases. You can only use views when their parent database is open.</p>
<h3>Using a View Wizard</h3>
<p>
You can create local and remote views with a view wizard. To set up an updatable view using tables on an ODBC data source, use the <a href="wizremote_view_wizard.htm">Remote View Wizard</a>.</p>
<p class=label>
<b>To create a view with a wizard</b>
<ol>
<li>
In the <b>Project Manager</b>, select a database.<br><br></li>
<li>
Select <b>Local Views</b> or <b>Remote Views</b>, and choose <b>New</b>.<br><br></li>
<li>
Choose <b>View Wizard</b>.<br><br></li>
<li>
Follow the instructions on the wizard screens.</li>
</ol>
<h3>Starting the View Designer</h3>
<p>
To create a view of a local table, use the View Designer. Local tables can include native Visual FoxPro tables, any tables in a .dbf format, and tables stored on local servers.</p>
<p>
To use the View Designer, first create or open a database. When you expand the plus sign next to the name of a database in the Project Manager, the Data tab shows you the components of the database. </p>
<p class=label>
<b>Local views are stored in the database.</b></p>
<p>
<img src="afu05001.gif" border=0></p>
<p class=label>
<b>To create a local view</b>
<ol>
<li>
From the <b>Project Manager</b>, select a database.<br><br></li>
<li>
Click the plus sign next to the <b>Databases</b> symbol.<br><br></li>
<li>
Under <b>Databases</b>, select <b>Local Views</b> and choose <b>New</b>.<br><br></li>
<li>
Choose <b>New View</b>.<br><br></li>
<li>
In the <b>Add Table or View </b>dialog box, select the table or view you want to use, then choose <b>Add</b>.<br><br></li>
<li>
After choosing the tables you want in your view, choose <b>Close</b>.<p class=tl>
The <a href="wndquery_designer.htm">View Designer</a> appears, showing the table or view you selected.</P></li>
<li>
In the <b>Fields</b> tab, select the fields you want to see in your view results.<br><br></li>
<li>
To view the results of your view, choose the <b>Run</b> button.</li>
</ol>
<p>
You can also start a view by choosing New from the File menu and choosing View.</p>
<p class=label>
<b>View Designer for a local view</b></p>
<p>
<img src="afu05002.gif" border=0></p>
<p>
Using the View Designer is essentially the same as using the Query Designer. However, the View Designer has an extra tab — the Update Criteria tab — where you can control how updates are made. For more information about using the Update Criteria tab, see <a href="#ugupdating_data">Updating Data</a> later in this chapter. For more information about using the Query Designer, see Chapter 4, <a href="ugretrieving_data.htm">Retrieving Data</a>.</p>

<h2><a name="ugconnecting_to_remote_data"></a>Connecting to Remote Data</h2>
<p>
With remote views, you can extract a subset of the data on a remote ODBC server without having to download all the records to your local computer. You can work on the selected records locally, then send the changes or additions you make back to the remote data source.</p>
<p>
You can connect to a remote data source in one of two ways. You can directly access any ODBC data sources registered on your computer or you can design custom connection using the <a href="wndconnection_designer.htm">Connection Designer</a>.</p>
<p>
ODBC is installed on your system when you choose the Complete or Custom installation option of Visual FoxPro. For more information about registering ODBC data sources, see Chapter 1, <a href="iginstalling_visual_foxpro.htm">Installing Visual FoxPro</a>, in the <i>Installation Guide</i>.</p>
<h3>Creating a Connection</h3>
<p>
If you want to create a customized connection for a server, use the <a href="wndconnection_designer.htm">Connection Designer</a> to create or customize a connection. The connections you create are saved as part of the database and contain information about how to access a specific data source.</p>
<p class=label>
<b>Connection Designer</b></p>
<p>
<img src="afu05003.gif" border=0></p>
<p>
You can set connection options to save and name the connection for future use. You might have to consult your system administrator or server documentation to find the right settings for connecting to your particular server. Connection Designer settings are described in more detail in Chapter 8, <a href="dgcreating_views.htm">Creating Views</a>, in the <i>Programmer’s Guide</i>.</p>
<p class=indent>
<B><b>Note</b></B>&nbsp;&nbsp;&nbsp;Before you can create a connection, you must have a database open.</p>
<p class=label>
<b>To create a new connection</b>
<ol>
<li>
In the <b>Project Manager</b>, select a database.<br><br></li>
<li>
Select <b>Connections</b> and choose <b>New</b>.<br><br></li>
<li>
In the <b>Connection Designer</b>, enter the options that correspond to your server requirements.<br><br></li>
<li>
From the <b>File </b>menu, choose <b>Save</b>.<br><br></li>
<li>
In the <b>Save</b> dialog box, enter a name for the connection in the <b>Connection Name</b> box.<br><br></li>
<li>
Choose <b>OK</b>.</li>
</ol>
<p>
You can also create a connection by choosing New from the File menu and selecting the Connection option.</p>
<h3>Creating a New Remote View</h3>
<p>
To gain access to your remote data in a view, you can use an existing connection or create a connection to use with your new view.</p>
<p class=label>
<b>To create a new remote view</b>
<ol>
<li>
In the <b>Project Manager</b>, select <b>Remote Views</b> and choose <b>New</b>.<br><br></li>
<li>
Choose <b>New View</b>.<br><br></li>
<li>
In the <b>Select Connection or Data Source</b> dialog box, select the <b>Available data sources</b> option.<p class=tl>
-or-</P><p class=tl>
If you have previously defined and saved a connection, select the <b>Connections</b> option.</P></li>
<li>
Select a data source or connection and choose <b>OK</b>.<br><br></li>
<li>
If required, in the Microsoft SQL Server or other login dialog box, enter your login ID and password.</li>
</ol>
<p>
You can also choose New from the File menu and select the Remote View option.</p>
<p>
Once the connection is established, the Open dialog box appears so you can select a table on the remote server.</p>
<p class=label>
<b>Tables on a remote server</b></p>
<p>
<img src="afu05004.gif" border=0></p>
<p>
After you select a table, the <a href="wndquery_designer.htm">View Designer</a> appears.</p>
<p class=label>
<b>View Designer for a remote view</b></p>
<p>
<img src="afu05005.gif" border=0></p>
<p>
To continue creating your remote view, you can select output fields and set filters just as you would a local view.</p>

<h2><a name="ugupdating_data"></a>Updating Data</h2>
<p>
You can use either local or remote views to update your tables.</p>
<h3>Sending Updates to Tables</h3>
<p>
In the View Designer, the Update Criteria tab allows you to control how the changes you make to remote data (updates, deletes, and inserts) are sent back to the remote data source. You can also enable and disable updating for specific fields in the tables and set the SQL update method appropriate to your server.</p>
<h4>Making a Table Updatable</h4>
<p>
If you want to have the changes you make to the local version of a table sent back to the source table, you need to set the Send SQL Updates option. You must set at least one key field to use this option. If the table you select has a primary key field defined and you have selected it in the Fields tab, the View Designer automatically uses the primary key field for the table as a key field for the view.</p>
<p class=label>
<b>To enable updating of source tables</b>
<ul type=disc>
<li>
In the <b>Update Criteria</b> tab, set the <b>Send SQL updates</b> option.</li>
</ul>
<h3>Setting Key Fields</h3>
<p>
When you first open a table in the View Designer, the Update Criteria tab shows which fields in the table are defined as key fields. Visual FoxPro uses key fields to uniquely identify the update records in remote tables that you have modified locally.</p>
<p class=label>
<b>To set a key field</b>
<ul type=disc>
<li>
In the <b>Update Criteria</b> tab, click the key column next to the name of the field.</li>
</ul>
<p class=label>
<b>Setting key fields in the Update Criteria tab</b></p>
<p>
<img src="afu05006.gif" border=0></p>
<p>
If you have changed the key fields and want to restore them to the original setting in the source table, choose Reset Key. Visual FoxPro will check the remote tables and use the key fields from those tables.</p>
<h3>Updating Specific Fields</h3>
<p>
You can specify that only certain fields in any given table are updatable. You must have a key field defined for a table in order to make any fields in that table updatable. If fields are not marked as updatable, users can make changes to the field in a form or Browse window, but these changes are not sent to the remote table.</p>
<p class=label>
<b>To make a field updatable</b>
<ul type=disc>
<li>
In the <a href="cmdquery_and_view_designers_update_criteria_tab.htm">Update Criteria tab</a>, click the updatable (“pencil”) column next to the name of the field.<p class=label>
<b>Making a field updatable in the Update Criteria tab</b>
<p>
<img src="afu05007.gif" border=0></P></li>
</ul>
<h3>Updating All Fields</h3>
<p>
If you want to be able to make changes to all the fields in a table, you can set all the fields in a table as updatable.</p>
<p class=label>
<b>To make all fields updatable</b>
<ul type=disc>
<li>
In the <b>Update Criteria</b> tab, choose <b>Update All</b>.<p class=atl>
<B><b>Note</b></B>&nbsp;&nbsp;&nbsp;You must have a key field defined in a table in order to use Update All. Key fields are not affected by Update All.</p></li>
</ul>
<h3>Controlling How Update Conflicts are Detected</h3>
<p>
If you are working in a multiuser environment and using data accessible to others on a server, it is possible that others are attempting to make changes to the records on the remote server at the same time you are. To have Visual FoxPro check if data you are working with in a view has been changed by another user before you attempt to update it, use the options in the <a href="cmdquery_and_view_designers_update_criteria_tab.htm">Update Criteria tab</a>.</p>
<p>
The options in the SQL WHERE Clause Includes box in the Update Criteria tab help you manage how records will be updated when multiple users might be accessing the same data. Before an update is allowed, Visual FoxPro checks specified fields in the remote data source table to see if they have changed since the record was retrieved into the view. If the records in the data source have changed, the update is not allowed.</p>
<p class=label>
<b>Setting the SQL WHERE clause in the Update Criteria tab</b></p>
<p>
<img src="afu05008.gif" border=0></p>
<p>
These options determine which fields are included in the WHERE clause in the UPDATE or DELETE statement that Visual FoxPro sends to the remote data source or source table when you make changes to or delete records in the view. The WHERE clause serves to check if the data on the server has changed since you retrieved the record for use in your view.</p>
<table border=1 cellpadding=5 cols=2 frame=below rules=rows>
<tr valign=top>
<td class=label width=35%><b>To…</b></td>
<td class=label width=65%><b>Choose this SQL WHERE option…</b></td>
</tr>
<tr valign=top>
<td width=35%>Have the update fail if a key field has been changed in the source table</td>
<td width=65%>Key fields only</td>
</tr>
<tr valign=top>
<td width=35%>Have the update fail if any of the fields marked as updatable have been changed on the remote table</td>
<td width=65%>Key and updatable fields</td>
</tr>
<tr valign=top>
<td width=35%>Have the update fail if any fields you change locally have been changed on the source table</td>
<td width=65%>Key and modified fields</td>
</tr>
<tr valign=top>
<td width=35%>Have the update fail if the timestamp of the record on the remote table has changed since you first retrieved it (only available if the remote table has a timestamp column)</td>
<td width=65%>Key and timestamp</td>
</tr>
</table><br>
<p>
For more information about detecting and resolving update conflicts, see Chapter 17, <a href="dgprogramming_for_shared_access.htm">Programming for Shared Access</a>, in the <i>Programmer’s Guide</i>.</p>

<h2><a name="ugcustomizing_views"></a>Customizing Views</h2>
<p>
You can customize views by defining how a field in a view displays, by controlling field display and data entry, by using expressions in views, by setting views up to prompt for values, and by setting advanced options to fine tune how data is exchanged with a server.</p>
<h3>Controlling Field Display and Data Entry</h3>
<p>
Because your view is part of a database, you can take advantage of some of the same properties that a database provides for fields in a table. For example, you can assign captions, enter comments, or set validation rules to control data entry.</p>
<p class=label>
<b>To control field display and data entry</b>
<ol>
<li>
Create or modify a view in the <b>View Designer</b>.<br><br></li>
<li>
In the <b>Fields </b>tab, select a field in the <b>Selected fields</b> list.<br><br></li>
<li>
Choose <b>Properties</b>.<p class=label>
<b>View Field Properties dialog box</b>
<p>
<img src="afu05009.gif" border=0></P></li>
<li>
In the <b>View Field Properties</b> dialog box, enter validation, display, and field type settings.</li>
</ol>
<p>
For more information about field validation, display, and mapping, see Chapter 7, <a href="dgworking_with_tables.htm">Working with Tables</a>, in the <i>Programmer’s Guide</i>.</p>
<h3>Controlling the Update Method</h3>
<p>
To control how information in key fields is actually updated on the server, use the options in the Update Using option group. These options determine what SQL command is used in the update statement sent to the server or source tables when key fields in records are updated.</p>
<p class=label>
<b>Update settings in the Update Criteria tab</b></p>
<p>
<img src="afu05010.gif" border=0></p>
<p>
You can specify that records be deleted and then replaced with the new values entered in the view (SQL DELETE then INSERT), or that server records be changed via the SQL UPDATE function supported by the server.</p>
<h3>Adding Expressions to Remote Views</h3>
<p>
As with queries, you can include functions and expressions as filters in views.</p>
<p class=label>
<b>To add an expression to a view</b>
<ul type=disc>
<li>
In the <b>Filter tab</b>, select <b>Expression</b> from the <b>Field Name</b> box.</li>
</ul>
<p>
If you are basing a view on a remote data source, the functions shown in the Expression Builder reflect the functions supported by that server. Check your server documentation for a listing of the functions your server supports. Visual FoxPro does not attempt to parse the expressions you build; instead, it passes them on to the remote server.</p>
<h3>Prompting for Parameters</h3>
<p>
You can set up views that prompt for the entry of a value to complete the query. For example, suppose you want to create a query to find customers located in a specific country. To do this, you need to define a filter on the country field and specify a <a href="glsparameter.htm">parameter</a> as the example in the filter. Parameter names can be any combination of alphabetic characters, numbers, and single quotes.</p>
<p class=label>
<b>To set up a parameter for a view</b>
<ol>
<li>
In the <b>View Designer</b>, add a new filter or select an existing filter in the <b>Filter </b>tab.<br><br></li>
<li>
In the <b>Example</b> box, type a question mark (<b>?</b>) and the name of the parameter.<p class=label>
<b>Parameter value entered as part of a filter for a view</b>
<p>
<img src="afu05011.gif" border=0></P></li>
</ol>
<p>
When you use the view, a message box appears prompting for a value to include in the filter.</p>
<h3>Setting Timeout Intervals</h3>
<p>
If you need to adjust how Visual FoxPro interacts with your server, you can set timing options.</p>
<p class=label>
<b>To set timeout intervals</b>
<ol>
<li>
In the <b>Project Manager</b>, select a connection and choose <b>Modify</b>.<br><br></li>
<li>
In the <b>Timeout intervals</b> area, set the options you need.<br><br></li>
<li>
From the <b>File</b> menu, choose <b>Save</b>.</li>
</ol>
<p>
For more information on setting timing options, see <a href="wndconnection_designer.htm">Connection Designer</a>.</p>
<h3>Optimizing Performance</h3>
<p>
You can optimize your views by setting data fetching and performance options. Use the <a href="cmdadvanced_options_dialog_box.htm">Advanced Options</a> dialog box to fine tune how records are retrieved in a view or how updates are made to the server or source tables.</p>
<p class=label>
<b>Advanced Options dialog box</b></p>
<p>
<img src="afu05012.gif" border=0></p>
<p class=label>
<b>To set advanced options</b>
<ol>
<li>
From the <b>Query</b> menu, choose <b>Advanced Options</b>.<br><br></li>
<li>
In the <a href="cmdadvanced_options_dialog_box.htm">Advanced Options</a> dialog box, set the connection information and data fetching options you need.<br><br></li>
<li>
Choose <b>OK</b>.</li>
</ol>
<p>
For more information about optimizing your views, see Chapter 8, <a href="dgcreating_views.htm">Creating Views</a>, in the <i>Programmer’s Guide.</i></p>
</BODY>
</HTML>
