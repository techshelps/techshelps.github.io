<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Licensing in the Run-Time Object</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">


<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<H3>Licensing in the Run-Time Object</H3><P>The run-time verification process is illustrated below:</P>
<P>    <img src="abdes024.gif"></P>
<P>When the application is started, the ActiveX designer's run-time object typically needs to be created. Before doing so, the application must verify that the ActiveX designer is licensed for the machine. It calls <B>CreateInstanceLic</B>, passing the embedded license key as a parameter. </P>
<P><B>CreateInstanceLic </B>compares the embedded string with the ActiveX designer's copy saved with the run-time object's class factory. If the strings match, <B>CreateInstanceLic </B>creates an instance of the  run-time object; the returned status reflects the success or failure of the instance creation. If the strings do not match, <B>CreateInstanceLic </B>returns CLASS_E_NOTLICENSED.</P>
<P>The following sample shows an implementation of <B>CreateInstanceLic</B>:</P>

<PRE><FONT FACE="COURIER, COURIER NEW" SIZE="2">STDMETHODIMP CClassFactory::CreateInstanceLic
(
    IUnknown *pUnkOuter,
    IUnknown *pUnkReserved,
    REFIID    riid,
    BSTR      bstrKey,
    void    **ppvObjOut
)
{
    BOOL  fMatch;

    *ppvObjOut = NULL;

    // See if the key given matches.
    fMatch = ( 0 == lstrcmpW(g_wszLicenseKey, bstrKey));
    if (!fMatch)
        return CLASS_E_NOTLICENSED;

    // If it does, create the object. 
    return CreateOleObjectFromIndex(pUnkOuter, m_iIndex, 
            ppvObjOut, riid);
}
</font></pre>
<P><B>CreateInstanceLic</B> is similar to <B>IClassFactory::CreateInstance</B>, except that it adds the license key verification. </P>
<P>If the host passes a key that indicates more restricted capabilities than the user or machine license allows, the ActiveX designer should provide only the limited capabilities for the newly created instance, as if the user or machine license had not been previously verified. </P></FONT>
</BODY>
</HTML>
