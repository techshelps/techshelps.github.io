<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Finding a Service</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">


<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<H3>Finding a Service</H3><P>To locate a service, an ActiveX designer calls the <B>IServiceProvider</B> interface, implemented by its site. The interface has the following definition:</P>

<PRE><FONT FACE="COURIER, COURIER NEW" SIZE="2">interface IServiceProvider : IUnknown
{
    HRESULT QueryService ( REFGUID rsid, REFIID iid, void ** ppvObj) 
};
</font></pre>
<P>The input parameters to the <B>QueryService</B> method are the SID of the service being requested and the IID of the interface you want to use. In return, you receive a pointer to the requested interface if the host implements the service, or E_NOTIMPL if the host does not implement it. </P>
<P>For example, the following code fragment queries for the <B>SCodeNavigate</B> service. (Error handling has been omitted for brevity.)</P>

<PRE><FONT FACE="COURIER, COURIER NEW" SIZE="2">hr = pClientSite-&gt;QueryInterface(IID_IServiceProvider, &amp;pISP); 
hr = pISP-&gt;QueryService(SID_SCodeNavigate, IID_ICodeNavigate, &amp;pICN);
</font></pre>
<P>The example calls <B>QueryInterface</B> on the site to get a pointer to the site's <B>IServiceProvider</B> interface. Using the returned pointer, it passes the SID of the <B>SCodeNavigate</B> service and the IID of the <B>ICodeNavigate</B> interface to <B>QueryService</B>. If the call is successful, <B>QueryService</B> returns a pointer to the <B>ICodeNavigate</B> interface. Through this pointer, the ActiveX designer can invoke the methods defined for <B>ICodeNavigate</B>. </P>
<P>In effect, the site performs the equivalent of the following for each call to <B>QueryService</B>:</P>

<PRE><FONT FACE="COURIER, COURIER NEW" SIZE="2">pSite-&gt;QueryService (SID_SCodeNavigate, IID_IUnknown, &amp;pUnk);
pUnk-&gt;QueryInterface (IID_ICodeNavigate, &amp;pICN);
pUnk-&gt;Release();
</font></pre>
<P>The ActiveX designer receives a pointer through which it can directly access the requested interface. The site does not have to delegate each individual method call.</P></FONT>
</BODY>
</HTML>
