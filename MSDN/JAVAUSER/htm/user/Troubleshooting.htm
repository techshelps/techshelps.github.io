<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Troubleshooting Tips</TITLE>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">
</HEAD>
<BODY BGCOLOR="White" TOPMARGIN=0 LEFTMARGIN=0 VLINK="#006699" ALINK="#006699">
<A NAME="top"></A>
<!--TOOLBAR_START-->
<!--TOOLBAR_END-->

<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="98%">
<TR>
<TD ROWSPAN=2 WIDTH=114 ALIGN="LEFT" VALIGN="TOP">
<IMG SRC="art/title_x3.gif" WIDTH="112" HEIGHT="108"  BORDER=0 ALT="JDirect"><TABLE CELLPADDING=0 CELLSPACING=0 BORDER=0 WIDTH="100%">
<TR><TD WIDTH=10>&nbsp;</TD><TD VALIGN="top"><FONT FACE="Verdana,Arial,Helvetica" SIZE=1><B STYLE="color:#006699">In this topic</B><P><IMG SRC="art/linkbull.gif" WIDTH="10" HEIGHT="8"  BORDER=0 ALT="*"><A STYLE="color: #333366;text-decoration:none" HREF="Troubleshooting.htm#jdirect_000700020e010000">UnsatisfiedLinkError When Calling a Method</A>
<P><IMG SRC="art/linkbull.gif" WIDTH="10" HEIGHT="8"  BORDER=0 ALT="*"><A STYLE="color: #333366;text-decoration:none" HREF="Troubleshooting.htm#jdirect_000700020e020000">Getting SecurityException When Calling a DLL Method or Using an @dll.struct Class</A>
<P><IMG SRC="art/linkbull.gif" WIDTH="10" HEIGHT="8"  BORDER=0 ALT="*"><A STYLE="color: #333366;text-decoration:none" HREF="Troubleshooting.htm#jdirect_000700020e030000">StringBuffers Truncated on Return From DLL Function</A>
<P><IMG SRC="art/linkbull.gif" WIDTH="10" HEIGHT="8"  BORDER=0 ALT="*"><A STYLE="color: #333366;text-decoration:none" HREF="Troubleshooting.htm#jdirect_000700020e040000">Mysterious Syntax Errors Within @dll Directives</A>
<P><IMG SRC="art/linkbull.gif" WIDTH="10" HEIGHT="8"  BORDER=0 ALT="*"><A STYLE="color: #333366;text-decoration:none" HREF="Troubleshooting.htm#jdirect_000700020e050000">Compiler Cannot Find Basic System Packages Like java.lang</A>
<P><IMG SRC="art/linkbull.gif" WIDTH="10" HEIGHT="8"  BORDER=0 ALT="*"><A STYLE="color: #333366;text-decoration:none" HREF="Troubleshooting.htm#jdirect_000700020e060000">Compiler Cannot Find the com.ms.dll Package</A>
<P><IMG SRC="art/linkbull.gif" WIDTH="10" HEIGHT="8"  BORDER=0 ALT="*"><A STYLE="color: #333366;text-decoration:none" HREF="Troubleshooting.htm#jdirect_000700020e070000">Syntax Errors When Using J/Direct with Inner Classes</A>
<P><IMG SRC="art/linkbull.gif" WIDTH="10" HEIGHT="8"  BORDER=0 ALT="*"><A STYLE="color: #333366;text-decoration:none" HREF="Troubleshooting.htm#jdirect_000700020e080000">@dll Directives Do Not Work on Applets (or Only Works Within the Microsoft Visual J++ Environment)</A>
<P><IMG SRC="art/linkbull.gif" WIDTH="10" HEIGHT="8"  BORDER=0 ALT="*"><A STYLE="color: #333366;text-decoration:none" HREF="Troubleshooting.htm#jdirect_000700020e090000">Using J/Direct Makes Class Unusable</A>
<P><IMG SRC="art/linkbull.gif" WIDTH="10" HEIGHT="8"  BORDER=0 ALT="*"><A STYLE="color: #333366;text-decoration:none" HREF="Troubleshooting.htm#jdirect_000700020e0a0000">J/Direct Throws a ParameterCountMismatchError After Calling a Native Function</A>
<P><IMG SRC="art/linkbull.gif" WIDTH="10" HEIGHT="8"  BORDER=0 ALT="*"><A STYLE="color: #333366;text-decoration:none" HREF="Troubleshooting.htm#jdirect_000700020e0b0000">J/Direct Does Not Unload a DLL</A>
</FONT></TD></TR></TABLE>
</TD>
<TD WIDTH=20>&nbsp;</TD>
<TD ALIGN="LEFT" VALIGN="TOP">
<P>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0">
<TR>
<TD WIDTH="365" VALIGN="bottom"><IMG SRC="art/jdirect2.gif" WIDTH="365" HEIGHT="27"  BORDER=0 ALT="JDirect"></TD>
<TD WIDTH=20>&nbsp;</TD>
<TD ALIGN="center" VALIGN="bottom">&nbsp;</TD><TD ALIGN="center" VALIGN="bottom"><A HREF="Error_Messages.htm"><IMG SRC="art/prevnrm.gif" WIDTH="51" HEIGHT="38"  BORDER=0 ALT="Previous"></A></TD><TD ALIGN="center" VALIGN="bottom"><A HREF="jdirect.htm"><IMG SRC="art/homenrm.gif" WIDTH="51" HEIGHT="38"  BORDER=0 ALT="JDirect"></A></TD><TD ALIGN="center" VALIGN="bottom"><A HREF="FAQ.htm"><IMG SRC="art/nextnrm.gif" WIDTH="51" HEIGHT="38"  BORDER=0 ALT="Next"></A></TD></TR>
<TR>
<TD WIDTH="365" ALIGN="right" VALIGN="top"><FONT COLOR="#006699" SIZE="4" FACE="VERDANA,ARIAL,HELVETICA"><B>About J/Direct</B></FONT></TD>
<TD WIDTH=20>&nbsp;</TD>
<TD ALIGN="center" VALIGN="top"><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="1">&nbsp;</FONT></TD>
<TD ALIGN="center" VALIGN="top"><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="1">Previous</FONT></TD>
<TD ALIGN="center" VALIGN="top"><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="1">JDirect</FONT></TD>
<TD ALIGN="center" VALIGN="top"><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="1">Next</FONT></TD>
</TR>
</TABLE>
</TD>
</TR>
<TR>
<TD WIDTH=20>&nbsp;</TD>
<TD>
<BR>
<FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">
<BR><BR><H2 STYLE="color:#333366">Troubleshooting Tips</H2>
<P>The following topics describe problems that you might encounter when using Microsoft&#174; J/Direct&#153;. For each situation, possible solutions are provided.
<TABLE BORDER=0>
<TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="Troubleshooting.htm#jdirect_000700020e010000">UnsatisfiedLinkError When Calling a Method</A>
</FONT></TD><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="Troubleshooting.htm#jdirect_000700020e020000">Getting SecurityException When Calling a DLL Method or Using an @dll.struct Class</A>
</FONT></TD><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="Troubleshooting.htm#jdirect_000700020e030000">StringBuffers Truncated on Return From DLL Function</A>
</FONT></TD><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="Troubleshooting.htm#jdirect_000700020e040000">Mysterious Syntax Errors Within @dll Directives</A>
</FONT></TD><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="Troubleshooting.htm#jdirect_000700020e050000">Compiler Cannot Find Basic System Packages Like java.lang</A>
</FONT></TD><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="Troubleshooting.htm#jdirect_000700020e060000">Compiler Cannot Find the com.ms.dll Package</A>
</FONT></TD><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="Troubleshooting.htm#jdirect_000700020e070000">Syntax Errors When Using J/Direct with Inner Classes</A>
</FONT></TD><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="Troubleshooting.htm#jdirect_000700020e080000">@dll Directives Do Not Work on Applets (or Only Works Within the Microsoft Visual J++ Environment)</A>
</FONT></TD><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="Troubleshooting.htm#jdirect_000700020e090000">Using J/Direct Makes Class Unusable</A>
</FONT></TD><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="Troubleshooting.htm#jdirect_000700020e0a0000">J/Direct Throws a ParameterCountMismatchError After Calling a Native Function</A>
</FONT></TD><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="Troubleshooting.htm#jdirect_000700020e0b0000">J/Direct Does Not Unload a DLL</A>
</FONT></TD></TABLE>
<H3 STYLE="color:#333366"><A NAME="jdirect_000700020e010000">UnsatisfiedLinkError When Calling a Method</A></H3><UL><LI>Check the version of your compiler to see that you have a compatible compiler. (To display the version number, execute jvc with no arguments on the command line.) The Microsoft SDK for Java supplies a version of the compiler that supports J/Direct. See the SDK release notes for the version number that corresponds to that release. If your compiler does not support J/Direct, the Microsoft Win32 VM for Java will attempt to link native methods using the Raw Native Interface and will not succeed. 
 
 <LI>Make sure your DLL is visible on the system path. DLLs are searched for in the following locations (in order):
 <OL><LI> The directory from which the application (typically jview) loaded.
 <LI> The current directory.
 <LI> The Windows system directory.
 <LI> The Windows directory.
 <LI> The directories listed in the PATH environment variable.
 </OL>
<P>The Microsoft VM will not attempt to load the DLL until a method requiring it is actually called. Therefore, do not assume that the DLL load was successful simply because the Java class loaded successfully. 
 <LI>Check the method qualifiers. Methods declared with the <B>@dll.import</B> directive must be native and static. They can have any level of access (public, private, and so on) supported by the Java language.
 <LI>Make sure that your method name matches the DLL export name exactly, including capitalization. The DLL linking mechanism in Win32 is case-sensitive.
 <LI>If you still have trouble linking to a method, use a utility such as <B>dumpbin/exports</B> (Visual C++) to verify that the DLL exports the method by the name you are using. Some DLLs may require you to link to exports by <I>ordinal</I> (an integer) rather than a name. In such a case, use the entrypoint override on the method using the "#<I>ordinal</I>" syntax as in the following example.
<PRE><FONT FACE="Courier" SIZE="2">
  // This method is exported as ordinal #34.
  /** @dll.import("MyDll",entrypoint="#34") */
  public static native void MySample();
</FONT></PRE>
<LI>Be aware that some so-called functions are actually C macros and the actual DLL export name may be quite different from the name of the macro. 
</UL>
<H3 STYLE="color:#333366"><A NAME="jdirect_000700020e020000">Getting SecurityException When Calling a DLL Method or Using an @dll.struct Class</A></H3><P>DLL calling and the use of <B>@dll.struct</B> classes is restricted to Java applications and signed Java applets. For more information about signing applets, see the article on <A href="signcode.htm">Signing a Cabinet File with Java Permissions</A>.

<H3 STYLE="color:#333366"><A NAME="jdirect_000700020e030000">StringBuffers Truncated on Return From DLL Function</A></H3><P>You must ensure that the <B>StringBuffer</B>'s capacity is sufficient to contain the string you need before you invoke the DLL function. You can specify the capacity in the <B>StringBuffer</B>'s constructor, and you can use the <B>StringBuffer.ensureCapacity</B> method to guarantee a minimum capacity prior to the DLL call.

<H3 STYLE="color:#333366"><A NAME="jdirect_000700020e040000">Mysterious Syntax Errors Within @dll Directives</A></H3><P>Extra white space within <B>@dll.import</B> and <B>@dll.struct</B> directives can cause syntax errors. Avoid using white space inside @dll constructs.

<H3 STYLE="color:#333366"><A NAME="jdirect_000700020e050000">Compiler Cannot Find Basic System Packages Like java.lang</A></H3><P>The compiler shipped with SDK for Java looks for system packages in the classes.zip file. This conflicts with the new Package Management scheme used by the Microsoft VM, which stores system packages as .zip files with obfuscated names under the %WINDIR%\java\packages directory. Unfortunately, the Java Language Compiler has not yet been updated to recognize this new scheme. To compile Java programs against the new VM, you must create an old-style .zip file and ensure that it is included in the CLASSPATH. 
<P>Normally, the SDK installation program does this for you. If, however, you installed the SDK by some other method, or if your configuration has been corrupted since the installation, you may need to recreate CLASSES.ZIP. The easiest way to do this is to type <FONT FACE="Courier New">clspack -auto</FONT> at the MS-DOS&#174; command prompt. This will create a single CLASSES.ZIP in your %WINDIR%\java\Classes directory that contains all classes stored in the package manager. The Microsoft compiler for Java looks for classes in this location by default, so there is no need to set your CLASSPATH environment variable.

<H3 STYLE="color:#333366"><A NAME="jdirect_000700020e060000">Compiler Cannot Find the com.ms.dll Package</A></H3><P>An older version of classes.zip is being used. Try renaming all older versions of classes.zip on your disk drive and follow the instructions under <A HREF="Troubleshooting.htm#jdirect_000700020e050000">Compiler Cannot Find Basic System Packages Like java.lang</A> for creating a new classes.zip file.

<H3 STYLE="color:#333366"><A NAME="jdirect_000700020e070000">Syntax Errors When Using J/Direct with Inner Classes</A></H3><P>The version of the Java compiler that ships with the SDK for Java  does not correctly handle @dll directives on inner classes or classes that contain inner class declarations.

<H3 STYLE="color:#333366"><A NAME="jdirect_000700020e080000">@dll Directives Do Not Work on Applets (or Only Works Within the Microsoft Visual J++ Environment)</A></H3><P>Because the use of J/Direct can compromise security, its use is restricted to Java applications and signed Java applets. See <A href="signcode.htm">Signing a Cabinet File with Java Permissions</A> 
for more information about signing applets.

<H3 STYLE="color:#333366"><A NAME="jdirect_000700020e090000">Using J/Direct Makes Class Unusable</A></H3><P>Any use of J/Direct within a class marks that class as unsafe and unusable by untrusted code, even if the J/Direct methods are not actually invoked.

<H3 STYLE="color:#333366"><A NAME="jdirect_000700020e0a0000">J/Direct Throws a ParameterCountMismatchError After Calling a Native Function</A></H3><P>The <A HREF="ParameterCountMismatchError.htm">ParameterCountMismatchError</A> exception alerts you to the fact that the called function consumed (popped off the stack) more or fewer parameters than was passed by J/Direct. This error normally indicates that the parameters in the Java method declaration do not match up with the parameters expected by the DLL function. 
<P>If the function pops off no arguments, it is assumed to be using the cdecl calling convention and an exception is not thrown, even if the Java method declares a non-zero number of arguments. 
<P><B>Caution</B> You should not attempt to catch and deal with the <A HREF="ParameterCountMismatchError.htm">ParameterCountMismatchError</A> exception. This exception was designed to assist developers in catching bugs during the development stage. For performance reasons, parameter count checking is performed only when the application is running under a Java debugger. It is also important to note that J/Direct performs this check after the function call has been completed. Because this exception indicates that one or more invalid parameters might have been passed to the function call, it cannot be guaranteed that the process can recover. 

<H3 STYLE="color:#333366"><A NAME="jdirect_000700020e0b0000">J/Direct Does Not Unload a DLL</A></H3><P>J/Direct unloads a DLL when the Microsoft VM discards the Java class that imported the DLL. For a Java application running under jview, this does not occur until the process exits. For a trusted Java applet, this happens at some undetermined time after the browser has left the page containing the applet. The Microsoft VM attempts to keep Java classes loaded for several pages afterward in order to optimize applet refresh time in case the page is revisited.
<P>If you need explicit control over the loading and unloading of DLLs, you need to call the Windows loader explicitly and use the call entrypoint to invoke functions dynamically. For more information on how to do this, see the section in this article on <A HREF="Dynamic_Loading.htm">Dynamically Loading and Invoking DLLs</A>. 

<P>
</FONT>
</TD>
</TR>
</TABLE>
<CENTER>
<P><TABLE WIDTH="95%"><TR><TD HEIGHT=1 BGCOLOR="RED"></TD></TR></TABLE>
<TABLE WIDTH="100%"><TR>
<TD ALIGN="left"><A HREF="#top"><IMG SRC="art/upnrm.gif" WIDTH="51" HEIGHT="38"  BORDER=0 ALT="Top"></A></TD>
<TD ALIGN="right">
<FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="1"><A HREF="cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of use.</A></FONT></TD></TR></TABLE>
</CENTER>
</BODY></HTML>
