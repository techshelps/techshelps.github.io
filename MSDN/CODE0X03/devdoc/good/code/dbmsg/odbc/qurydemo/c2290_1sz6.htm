<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>QURYDEMO.H</title>
<link disabled rel=stylesheet href=../../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>
<h2><a name="_code_context2292"></a>QURYDEMO.H</h2>
<pre><code>/* <br>    Header File for QURYDEMO application <br>    Created by Microsoft Corporation. <br>*/ <br>#ifdef WIN32 <br>#define CONSTSTR(name, str) const char name[]=str <br>#else <br>#define CONSTSTR(name, str) const char FAR * name=str <br>#endif <br> <br> <br>#ifdef RC_INVOKED <br>#define ID(id) id <br>#else <br>#define ID(id) MAKEINTRESOURCE(id) <br>#endif <br> <br>/* Resource Identifiers */ <br> <br>#define BMP_NEWQUERY        ID(10)  // new window button bitmap <br>#define BMP_RUNQUERY        ID(20)  // exec query button bitmap <br>#define APPICON             ID(30)  // application icon <br>#define QUERYWINDOWICON     ID(40)  // MDI Child window icon <br>#define QURYDEMOMENU        ID(50)  // Application menu <br>#define CONNECTDIALOG       ID(60)  // connect modal dialog box <br>#define DISCONNECTDIALOG    ID(70)  // disconnect modal dialog box <br>#define ABOUTDIALOG         ID(80)  // about modal dialog box <br>#define MDICHILDDIALOG      ID(90)  // MDI Child modeless dialog box <br>#define APPACCELERATOR      ID(100) // Accelerator table for the app <br> <br>/* Menu Identifiers */ <br> <br>#define IDM_POPUPAPPSYS     10  // Placeholder, used by status bar <br>#define IDM_POPUPMDISYS     20  // Placeholder, used by status bar <br>#define IDM_POPUPLOGIN      100 // Placeholder, used by status bar <br>#define IDM_CONNECT         110 <br>#define IDM_DRIVERCONNECT   120 <br>#define IDM_DISCONNECT      130  <br>#define IDM_EXIT            140 <br>#define IDM_POPUPQUERY      150 // Placeholder, used by status bar <br>#define IDM_QUERY           160 <br>#define IDM_NEW             170 <br>#define IDM_POPUPWINDOW     180     // Placeholder, used by status bar <br>#define IDM_TILE            190 <br>#define IDM_CASCADE         200 <br>#define IDM_ICONS           210 <br>#define IDM_CLOSEALL        220 <br>#define IDM_POPUPHELP       230 // Placeholder, used by status bar <br>#define IDM_APPHELP         240 <br>#define IDM_ABOUT           250 <br> <br>#define IDM_MDICHILD        260 <br> <br>/* child window ids */ <br> <br>#define IDW_TOOLBAR         10 <br>#define IDW_STATUSBAR       20 <br>#define IDW_MDICLIENT       30 <br> <br>#define IDW_CRSRLIST        10  // toolbar comboboxes <br>#define IDW_STMTLIST        20 <br> <br>#define IDCOMBO_DATASOURCE  10  // connect dialog box controls <br>#define IDTEXT_USERNAME     20 <br>#define IDTEXT_PASSWORD     30 <br> <br>#define IDLIST_HDBC         10  // disconnect dialog box controls <br>#define IDLIST_STMT         20 <br>#define IDCLOSE_ACTVTY      30 <br>#define IDDISCONNECT        40 <br>#define IDICON_WARN         50 <br> <br>#define IDTEXT_PRMPT        10  // MDI child's modeless dialog controls <br>#define IDTEXT_SQL          20 <br>#define IDLIST_RSLT         30 <br> <br>/* MDI Child Window Offsets */ <br> <br>#define CBWNDEXTRA          4   // storage in MDI Child Window <br>#define GWLAPP_HDLG         0   // child dialog handle <br> <br>/* Help File */ <br> <br>#define SAMPLESHELPFILE     "..\\doc\\odbcsmpl.hlp" <br>#define HLP_QURYDEMO        30 <br> <br>/* Other Constants */ <br> <br>#define MAXCHILDWNDS        10          //maximum child windows allowed <br>#define MAXBUFLEN           256         //display buffer size <br>#define MAX_COL             15          //maximum column in result set <br>#define MAX_ROW             100         //maximum number of rows <br>#define MAXDATALEN          25          //maximum data length per column <br>#define MAXDISPLAYSIZE      MAX_COL*(MAXDATALEN+1) <br>#define MINWIDTH            415         //minimum width of app window <br>#define MINHEIGHT           350         //minimum height of app window <br>#define LISTTABSTOP         100         //tabstop in the display listbox <br>#define LISTHORZSCROLL      (LISTTABSTOP*2)     //horizontal scroll for the listbox <br>#define LISTHORZEXT         0           //horizontal extent inthe list box <br>#define WINDOWMENUPLACE     2           //Window menu place for adding MDI child windows <br>#define IDT_STATUSTIMER     1           //timer id <br>#define TIMERDELAY          60000           //timer duration <br>#define BTTNX               345         //first toolbar button location <br>#define BTTNY               2           //button y position <br>#define BTTNWIDTH           25                      //button width <br>#define BTTNHEIGHT          23                      //button height <br>#define BTTNMARGIN          5           //distance between toolbar buttons <br>#define TOOLBARMARGINY      5           //fixed margin w/o combobox height <br>#define STATUSBARMARGINY    8           //fixed margin w/o textbox height <br> <br>/* String Constants */ <br> <br>#define POPUPLOGIN          "&amp;Login" <br>#define MENUITEMCONNECT     "&amp;Connect... \aCtrl+C" <br>#define MENUITEMDRIVERCONNECT   "D&amp;river Connect... \aCtrl+R" <br>#define MENUITEMDISCONNECT  "&amp;Disconnect... \aCtrl+D" <br>#define MENUITEMEXIT        "E&amp;xit" <br>#define POPUPQUERY          "&amp;Query" <br>#define MENUITEMQUERY       "&amp;Execute SQL \aCtrl+E" <br>#define MENUITEMNEW         "&amp;New Query \aCtrl+N" <br>#define POPUPWINDOW         "&amp;Window" <br>#define MENUITEMTILE        "&amp;Tile" <br>#define MENUITEMCASCADE     "&amp;Cascade" <br>#define MENUITEMICONS       "Arrange &amp;Icons" <br>#define MENUITEMCLOSEALL    "Close &amp;All" <br>#define POPUPHELP           "&amp;Help" <br>#define MENUITEMAPPHELP     "&amp;Help on Qurydemo" <br>#define MENUITEMABOUT       "&amp;About Qurydemo..." <br> <br>#ifdef WIN32 <br>#define ODBCFRAMECLASS      "QDEMO32MAIN" <br>#else <br>#define ODBCFRAMECLASS      "QDEMOMAIN" <br>#endif <br> <br>#define ODBCTOOLCLASS       "QDEMOTool" <br>#define ODBCSTATUSCLASS     "QDEMOStatus" <br>#define ODBCMDICLASS        "QDEMOMDI" <br>#define COMBOBOXCLASS       "COMBOBOX" <br>#define MDICLIENTCLASS      "MDICLIENT" <br>#define UNTITLED            "Untitled" <br>#define APPTITLE            "ODBC Sample Program" <br>#define EXECERROR           "Execution Error" <br>#define INITERROR           "Failed to initialize ODBC interface" <br>#define CLASSERROR          "Failed to register application class" <br>#define CREATEMAINERR       "Failed to create application main window" <br>#define CREATECHILDERR      "Failed to create a new window" <br>#define ALPHABETS           "abcdefghijklmnopqrstuvwxyz" <br>#define TIMETEXT            "MM:MM MM" <br>#define DATETEXT            "MMM-MM" <br>#define TIMEFORMAT          " %I:%M %p" <br>#define DATEFORMAT          " %b-%d" <br>#define NODSNERR            "Please provide a Data Source" <br>#define MOREINFO            "Incomplete Information" <br>#define STATUSPOPUPAPPSYS   " Control menu for the application " <br>#define STATUSPOPUPMDISYS   " Control menu for the window " <br>#define STATUSRESTORE       " Restore window to normal " <br>#define STATUSMOVE          " Move window " <br>#define STATUSSIZE          " Size window " <br>#define STATUSMINIMIZE      " Minimize window " <br>#define STATUSMAXIMIZE      " Maximize window " <br>#define STATUSCLOSE         " Close window " <br>#define STATUSNEXTWINDOW    " Switch to next window " <br>#define STATUSPREVWINDOW    " Switch to previous window " <br>#define STATUSTASKLIST      " Bring up task list " <br>#define STATUSPOPUPLOGIN    " Login and logout commands " <br>#define STATUSCONNECT       " Connect with default parameters... " <br>#define STATUSDRIVERCONNECT " Connect with driver dialogs... " <br>#define STATUSDISCONNECT    " Close open connections... " <br>#define STATUSEXIT          " Exit application " <br>#define STATUSPOPUPQUERY    " Query commands " <br>#define STATUSQUERY         " Execute SQL statement... " <br>#define STATUSNEW           " New window on current connection... " <br>#define STATUSPOPUPWINDOW   " Window management commands " <br>#define STATUSTILE          " Tile all normal child windows " <br>#define STATUSCASCADE       " Cascade all normal child windows " <br>#define STATUSICONS         " Arrange iconic child windows " <br>#define STATUSCLOSEALL      " Close all child windows " <br>#define STATUSMDICHILD      " Activate the window marked as %d" <br>#define STATUSPOPUPHELP     " Help commands " <br>#define STATUSAPPHELP       " Display help on application " <br>#define STATUSABOUT         " About application " <br>#define STATUSDEFAULT       " Ready " <br> <br>#define DEFDBNAME               "?" <br>#define DSN_HDBC_FORMAT         "%s!%lX" <br>#define DSN_HDBC_HSTMT_FORMAT   "DSN=%s!HDBC=%lX!HSTMT=%lX" <br>#define SCANDSNHDBC_FORMAT      "%[^!]!%lX" <br>#define SCANHDBC_FORMAT         "%*[^!]!%lX" <br>#define SCANHDBC_TITLEFORMAT    "DSN=%*[^!]!HDBC=%lX" <br>#define SCANHDBCHSTMT_FORMAT    "DSN=%*[^!]!HDBC=%lX!HSTMT=%lX" <br>#define SCANHSTMT_TITLEFORMAT   "DSN=%*[^!]!HDBC=%*lX!HSTMT=%lX" <br>#define SCAN_HDBC_FORMAT"%*c%lX" <br>#define SCAN_HDBC_TITLEFORMAT"DSN=%*cHDBC=%lX" <br> <br> <br>#define CUR_MARK            "&lt;-" <br>#define CURQUERY_STRING     "Query!%lX&lt;-" <br>#define QUERY_STRING        "Query!%lX" <br>#define MAKECONNECT         "Please connect to a data source using Login menu." <br>#define OPENWINDOW          "Please open a window from Query menu." <br>#define NOHDBCERROR         "No Connection Available" <br>#define NOHSTMTERROR        "No Query Window Available" <br>#define MAXCHILDEXCEEDED    "Please close a child window and try again." <br>#define MAXCHLDERR          "Error - Too many Child Windows" <br>#define COLTRUNC_WARNG      "Number of columns in display truncated to %u" <br>#define ROWTRUNC_WARNG      "Number of rows in display truncated to %u" <br>#define TRUNCERR            "Data Truncation" <br>#define CLOSEALLHDBC        "All open connections have been closed." <br>#define LOGOUTINFO          "Log Out Information" <br>#define SQLERR_FORMAT       "SQL Error State:%s, Native Error Code: %lX, ODBC Error: %s" <br>#define SQLERRMSGTITLE      "SQL_ERROR results" <br>#define SQLERRCNTDTITLE     "SQL_ERROR results continued" <br>#define SQLWRNMSGTITLE      "SQL_SUCCESS_WITH_INFO results" <br>#define SQLWRNCNTDTITLE     "SQL_SUCCESS_WITH_INFO results continued" <br>#define NULLDATASTRING      "SQL_NULL_DATA" <br> <br> <br> <br>/* Globals */ <br> <br>HWND        hWndFrame;      // Main Frame Window handle <br>HWND        hWndToolbar;    // Toolbar window handle <br>HWND        hWndCrsrList;   // hdbc(s) combobox on the tool bar <br>HWND        hWndStmtList;   // hstmt(s) combobox on the tool bar <br>HWND        hWndStatusbar;  // status bar handle <br>HWND        hWndMDIClient;  // MDI Client window handle <br>HWND        hWndActiveChild;// Current active MDI Child window <br>HINSTANCE   hAppInstance;   // Application instance <br>WORD        wStatusText;    // Status text state <br>int         iTimex;         // Time box (on the status bar) width <br>int         iDatex;         // Date box (on the status bar) width <br>RECT        rectStatusText; // Text box on the status bar <br> <br> <br> <br> <br>#ifdef __SQL    // internal to query.c <br> <br>int         nChildCount;            // Number of child windows currently open <br>SQLHENV     henv;                   // Environment Handle <br>char        szDispBuffer[MAXDISPLAYSIZE+1]; // Display Buffer <br>UCHAR       rgbData[MAX_COL][MAXDATALEN];   // Results Data Array <br>SDWORD      dwDataLen[MAX_COL];     // Results Data Length Array <br> <br>#endif <br> <br>/* Macros and Function Prototypes */ <br> <br>#ifdef WIN32 <br>#define     ACTIVATEWINDOW(h)   SetForegroundWindow(h) <br>#else <br>#define     ACTIVATEWINDOW(h)   SetFocus(h) <br>#endif <br> <br>#define DRAWBTTNRECT(h,x,y,cx,cy)   MoveToEx(h,x+1,y,NULL);\ <br>                    LineTo(h,x+cx,y);\ <br>                    MoveToEx(h,x+cx,y+1,NULL);\ <br>                    LineTo(h,x+cx,y+cy);\ <br>                    MoveToEx(h,x+cx-1,y+cy,NULL);\ <br>                    LineTo(h,x,y+cy);\ <br>                    MoveToEx(h,x,y+cy-1,NULL);\ <br>                    LineTo(h,x,y); <br> <br>#define DRAWBTTNLIFT1(h,x,y,cx,cy)  MoveToEx(h,x+1,y+cy-1,NULL);\ <br>                    LineTo(h,x+1,y+1);\ <br>                    LineTo(h,x+cx-1,y+1); <br> <br>#define DRAWBTTNLIFT2(h,x,y,cx,cy)  MoveToEx(h,x+1,y+cy-1,NULL);\ <br>                    LineTo(h,x+cx-1,y+cy-1);\ <br>                    LineTo(h,x+cx-1,y);\ <br>                    MoveToEx(h,x+2,y+cy-2,NULL);\ <br>                    LineTo(h,x+cx-2,y+cy-2);\ <br>                    LineTo(h,x+cx-2,y+1); <br> <br>int PASCAL      WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow); <br>long    CALLBACK    MainWndProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam); <br>long    CALLBACK    ToolbarProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam); <br>long    CALLBACK    StatusbarProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam); <br>long    CALLBACK    MDIChildProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam); <br>BOOL    CALLBACK    ConnectDlgProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam); <br>BOOL    CALLBACK    DisconnectDlgProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam); <br>BOOL    CALLBACK    AboutDlgProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam); <br>BOOL    CALLBACK    MDIChildDlgProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam); <br>VOID    FAR PASCAL  DrawBitmap(HDC hDC, int iLeft, int iTop, HBITMAP hBitmap); <br> <br>BOOL    FAR PASCAL  InitSQLEnvironment(); <br>void    FAR PASCAL  DisplayDatabases(HWND hWnd); <br>BOOL    FAR PASCAL  ConnectDatabase(HWND hWnd); <br>BOOL    FAR PASCAL  DriverConnectDatabase(HWND hWnd); <br>void    FAR PASCAL  DisplayConnections(HWND hWndhdbc); <br>void    FAR PASCAL  DisplayQueries(HWND hWndhstmt, HWND hWndhdbc, int nCrsrIndex); <br>void    FAR PASCAL  NewQueryWindow(); <br>void    FAR PASCAL  ChangeCurrentQuery(HWND hWndStmtList); <br>void    FAR PASCAL  ChangeCurrentCursor(HWND hWndCrsrList); <br>void    FAR PASCAL  DisplayNewCrsrAndStmt(); <br>void    FAR PASCAL  FreeConnect(HWND hWndhdbc); <br>void    FAR PASCAL  FreeQuery(HWND hWndhstmt, HWND hWndhdbc, int nIndex); <br>void    FAR PASCAL  CloseQueryWindow(HWND hWnd); <br>BOOL    FAR PASCAL  FreeSQLEnvironment(); <br>void    FAR PASCAL  ExecuteQuery(); <br>BOOL    FAR PASCAL  CloseDatabases(); <br> <br>#ifdef __SQL    // internal to query.c <br> <br>void    FAR PASCAL  DisplayError(SQLRETURN nResult, HWND hWnd, SWORD fHandleType, SQLHANDLE handle); <br> <br>#endif <br>/******************************* End of File ********************************/ <br></code></pre>
<p>&nbsp;</p></body>
</HTML>
