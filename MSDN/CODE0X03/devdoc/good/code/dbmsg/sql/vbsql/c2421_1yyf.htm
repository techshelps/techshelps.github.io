<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>AUTHORS.BAS</title>
<link disabled rel=stylesheet href=../../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>
<h2><a name="_code_context2427"></a>AUTHORS.BAS</h2>
<pre><code>Option Explicit <br> <br>Function AlterAuthors (pChannel As Integer) <br>' <br>' This routine alters the Authors table with <br>' a TIMESTAMP column. Then it sends a 'dummy' update <br>' statement so that every row in the table <br>' gets a value in the TIMESTAMP column. <br> <br>Dim lCmd$, lRetValue As Integer, lInfoText As String, Res% <br> <br>    lRetValue = False <br>    lInfoText = mdiMA.panInfo.Caption <br>    mdiMA.panInfo.Caption = " Altering the authors table with a TIMESTAMP column." <br>    lCmd$ = "alter table authors add timestamp timestamp NULL " <br>    Res% = SQLComm%(pChannel, lCmd$) <br>    If Res% = SUCCEED% Then <br>        mdiMA.panInfo.Caption = " Every row in the authors table is now being updated." <br>        lCmd$ = "update authors set au_fname = au_fname" <br>        Res% = SQLComm%(pChannel, lCmd$) <br>        If Res% = SUCCEED% Then lRetValue = True <br>    End If <br>    mdiMA.panInfo.Caption = lInfoText <br>    AlterAuthors = lRetValue <br> <br>End Function <br> <br>Function AskifAlter () <br>' <br>' This routine asks if the user wants to <br>' alter the Authors table with a TIMESTAMP <br>' column. <br> <br>Dim lMsg$, Res%, lRetValue As Integer <br> <br>    lMsg$ = "This sample application needs a column with " <br>    lMsg$ = lMsg$ + " the name TIMESTAMP and the datatype " <br>    lMsg$ = lMsg$ + " TIMESTAMP in the authors table." + NEWLINE$ <br>    lMsg$ = lMsg$ + NEWLINE$ + "The reason is that this application " <br>    lMsg$ = lMsg$ + "uses Browse Mode and Optimistic Concurrency " <br>    lMsg$ = lMsg$ + "Control." + NEWLINE$ + NEWLINE$ <br>    lMsg$ = lMsg$ + "There is no TIMESTAMP column in your authors " <br>    lMsg$ = lMsg$ + "table at this moment!" + NEWLINE$ + NEWLINE$ <br>    lMsg$ = lMsg$ + "If you click on the OK button the application " <br>    lMsg$ = lMsg$ + "will create the column for you. If you click " <br>    lMsg$ = lMsg$ + "on the cancel button you won't be able to run " <br>    lMsg$ = lMsg$ + "this sample until the column is there." <br>    Beep <br>    Res% = MsgBox(lMsg$, 17, "Alter table authors") <br>    If Res% = IDOK Then <br>        lRetValue = True <br>    Else <br>        lRetValue = False <br>    End If <br>    AskifAlter = lRetValue <br> <br>End Function <br> <br>Function CheckifTimestamp (pChannel As Integer) <br>' <br>' This routine checks if there is a TIMESTAMP column <br>' for the table Authors. <br> <br>Dim lCmd$, lRetValue As Integer, Res% <br> <br>    lRetValue = False <br>    lCmd$ = "select count(*) from sysobjects so, syscolumns " <br>    lCmd$ = lCmd$ + "sc where so.id = sc.id " <br>    lCmd$ = lCmd$ + "and so.name = 'authors' " <br>    lCmd$ = lCmd$ + "and sc.name = 'timestamp' " <br>    lCmd$ = lCmd$ + "and sc.type = 37" <br>    Res% = SQLComm%(pChannel, lCmd$) <br>    If Res% = SUCCEED% Then <br>        Res% = SQLNextRow(pChannel) <br>        If Res% = REGROW Then <br>            If Val(SQLData(pChannel, 1)) &gt; 0 Then <br>                lRetValue = True <br>            End If <br>        End If <br>    End If <br>    CheckifTimestamp = lRetValue <br> <br>End Function <br> <br>Function EmptyQualString () <br>' <br>' This routine lets the user know that some condition <br>' for using Concurrency Control with Browse Mode is <br>' not fullfilled. <br> <br>Dim lRetValue As String <br> <br>    lRetValue = "The qual string is empty, which is not acceptable." <br>    lRetValue = lRetValue + NEWLINE$ + NEWLINE$ <br>    lRetValue = lRetValue + "There are three mandatory preconditions for using " <br>    lRetValue = lRetValue + "Concurrency Control with Browse Mode." <br>    lRetValue = lRetValue + NEWLINE$ + NEWLINE$ <br>    lRetValue = lRetValue + "1 - You must have a unique index." <br>    lRetValue = lRetValue + NEWLINE$ + NEWLINE$ <br>    lRetValue = lRetValue + "2 - You must have a column named TIMESTAMP with the " <br>    lRetValue = lRetValue + " datatype TIMESTAMP in the specific table." <br>    lRetValue = lRetValue + NEWLINE$ + NEWLINE$ <br>    lRetValue = lRetValue + "3 - You must add 'FOR BROWSE' to your SQL select statement " <br>    lRetValue = lRetValue + NEWLINE$ + NEWLINE$ <br>    lRetValue = lRetValue + "Check to see if the unique index on the authors table " <br>    lRetValue = lRetValue + "has been dropped. That might be the problem." <br>    lRetValue = lRetValue + NEWLINE$ + NEWLINE$ <br>    lRetValue = lRetValue + "This operation will not go through to SQL Server." <br>    EmptyQualString = lRetValue <br>     <br>End Function <br> </code></pre>
<p>&nbsp;</p></body>
</HTML>
