<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IMAGE.FRM</title>
<link disabled rel=stylesheet href=../../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>
<h2><a name="_code_context2437"></a>IMAGE.FRM</h2>
<pre><code>VERSION 2.00 <br>Begin Form PrimaryWindow  <br>   BackColor       =   &amp;H00C0C0C0&amp; <br>   BorderStyle     =   1  'Fixed Single <br>   Caption         =   "Image" <br>   ControlBox      =   0   'False <br>   ForeColor       =   &amp;H00000000&amp; <br>   Height          =   7035 <br>   Icon            =   IMAGE.FRX:0000 <br>   Left            =   615 <br>   LinkMode        =   1  'Source <br>   LinkTopic       =   "Form1" <br>   MaxButton       =   0   'False <br>   ScaleHeight     =   6345 <br>   ScaleWidth      =   6990 <br>   Top             =   75 <br>   Width           =   7110 <br>   Begin PictureBox Image_Control  <br>      Height          =   3495 <br>      Left            =   120 <br>      ScaleHeight     =   3465 <br>      ScaleWidth      =   6705 <br>      TabIndex        =   12 <br>      Top             =   2760 <br>      Width           =   6735 <br>   End <br>   Begin VBSQL VBSQL1  <br>      Caption         =   "SQL Err/Msg" <br>      Height          =   272 <br>      Left            =   4800 <br>      Top             =   2505 <br>      Visible         =   0   'False <br>      Width           =   2055 <br>   End <br>   Begin ListBox Titles_List  <br>      Height          =   810 <br>      Left            =   135 <br>      TabIndex        =   8 <br>      Top             =   1440 <br>      Width           =   2055 <br>   End <br>   Begin DirListBox Dir_Tree_Combo  <br>      Height          =   1275 <br>      Left            =   2520 <br>      TabIndex        =   4 <br>      Top             =   1170 <br>      Width           =   2055 <br>   End <br>   Begin FileListBox Image_File_List  <br>      Height          =   1590 <br>      Left            =   4800 <br>      Pattern         =   "*.bmp" <br>      TabIndex        =   5 <br>      Top             =   855 <br>      Width           =   2055 <br>   End <br>   Begin DriveListBox Drive_Combo  <br>      Height          =   357 <br>      Left            =   2528 <br>      TabIndex        =   3 <br>      Top             =   833 <br>      Width           =   2048 <br>   End <br>   Begin ListBox Database_List  <br>      Height          =   420 <br>      Left            =   135 <br>      TabIndex        =   10 <br>      Top             =   360 <br>      Width           =   2055 <br>   End <br>   Begin TextBox Title_Edit  <br>      Height          =   323 <br>      Left            =   3855 <br>      TabIndex        =   1 <br>      Top             =   75 <br>      Width           =   3000 <br>   End <br>   Begin Label Label5  <br>      BackColor       =   &amp;H00C0C0C0&amp; <br>      Caption         =   "Image in database:" <br>      Height          =   225 <br>      Left            =   120 <br>      TabIndex        =   11 <br>      Top             =   2520 <br>      Width           =   2055 <br>   End <br>   Begin Label Label4  <br>      BackColor       =   &amp;H00C0C0C0&amp; <br>      Caption         =   "Titles in database:" <br>      Height          =   225 <br>      Left            =   120 <br>      TabIndex        =   9 <br>      Top             =   1200 <br>      Width           =   2055 <br>   End <br>   Begin Label Image_File_Label  <br>      BackColor       =   &amp;H00C0C0C0&amp; <br>      Caption         =   "(none)" <br>      Height          =   255 <br>      Left            =   3000 <br>      TabIndex        =   7 <br>      Top             =   500 <br>      Width           =   3840 <br>   End <br>   Begin Label Label3  <br>      BackColor       =   &amp;H00C0C0C0&amp; <br>      Caption         =   "File:" <br>      Height          =   255 <br>      Left            =   2520 <br>      TabIndex        =   6 <br>      Top             =   500 <br>      Width           =   375 <br>   End <br>   Begin Label Label2  <br>      BackColor       =   &amp;H00C0C0C0&amp; <br>      Caption         =   "Image file title:" <br>      ForeColor       =   &amp;H00000000&amp; <br>      Height          =   225 <br>      Left            =   2520 <br>      TabIndex        =   2 <br>      Top             =   120 <br>      Width           =   1335 <br>   End <br>   Begin Label Label1  <br>      BackColor       =   &amp;H00C0C0C0&amp; <br>      Caption         =   "Databases:" <br>      Height          =   210 <br>      Left            =   120 <br>      TabIndex        =   0 <br>      Top             =   120 <br>      Width           =   2085 <br>   End <br>   Begin Menu Menu_File  <br>      Caption         =   "&amp;File" <br>      Begin Menu Logon_Selection  <br>         Caption         =   "&amp;Logon" <br>      End <br>      Begin Menu Log_Off_Selection  <br>         Caption         =   "Log &amp;Off" <br>      End <br>      Begin Menu Exit_Selection  <br>         Caption         =   "&amp;Exit" <br>      End <br>   End <br>   Begin Menu Options_Menu  <br>      Caption         =   "&amp;Options" <br>      Begin Menu View_Selection  <br>         Caption         =   "&amp;View Image" <br>      End <br>      Begin Menu Insert_Selection  <br>         Caption         =   "&amp;Insert Image" <br>      End <br>      Begin Menu Delete_Selection  <br>         Caption         =   "&amp;Delete Image" <br>      End <br>   End <br>   Begin Menu About_Menu  <br>      Caption         =   "&amp;About" <br>   End <br>End <br> <br>Sub About_Menu_Click () <br> <br>    About_Form.Show 1 <br> <br>End Sub <br> <br>Function CheckForImageTable () As Integer <br> <br>Rem <br>Rem Check to see if sample table exits <br>Rem If it's not there, then see if they want to create it <br>Rem <br> <br>    Results% = ExecuteSQLCommand("Select count(*) from sysobjects where name = 'image_table'") <br>    Do While (SqlResults%(SqlConn%) &lt;&gt; NOMORERESULTS) <br>Do While (SqlNextRow(SqlConn%) &lt;&gt; NOMOREROWS) <br>    Table_Found$ = Sqldata(SqlConn%, 1) <br>Loop <br>    Loop <br> <br>    If Val(Table_Found$) = 0 Then <br>Results% = MsgBox("Text table not found in " + Database$ + " database." + Chr$(13) + Chr$(10) + "Do you wish to create the table?", 52) <br>If Results% = 7 Then <br>    CheckForImageTable = FAIL <br>    Exit Function <br>Else <br>    Cmd$ = "create table image_table (title varchar(30) not null, image_col image null)" <br>    Results% = SqlCmd(SqlConn%, Cmd$) <br>    Results% = SqlExec(SqlConn%) <br>    Do While (SqlResults%(SqlConn%) &lt;&gt; NOMORERESULTS) <br>Do While (SqlNextRow(SqlConn%) &lt;&gt; NOMOREROWS) <br>Loop <br>    Loop <br>    CheckForImageTable = SUCCEED <br>End If <br>    Else <br>CheckForImageTable = SUCCEED <br>    End If <br> <br>End Function <br> <br>Sub ClearImageTitles () <br> <br>    Rem Clear all text titles out of list box <br>    Do While Titles_List.ListCount <br>Titles_List.RemoveItem 0 <br>    Loop <br> <br>End Sub <br> <br>Sub Database_List_Click () <br> <br>Rem <br>Rem This procedure gets the chosen database. <br>Rem Checks to see if the image table is there <br>Rem If it's not, then clear the images field, and disable other fields <br>Rem If it is, then get the list of images, display the list and enable other fields. <br>Rem <br> <br>    DatabaseSelection$ = Database_List.Text <br>    Results% = SqlUse(SqlConn%, DatabaseSelection$) <br>    Results% = CheckForImageTable() <br>    If Results% = SUCCEED Then <br>PrimaryWindow.MousePointer = 11 <br>RetrieveImageTitles <br>View_Selection.Enabled = True <br>Insert_Selection.Enabled = True <br>Delete_Selection.Enabled = True <br>PrimaryWindow.MousePointer = 0 <br>    Else <br>ClearImageTitles <br>View_Selection.Enabled = False <br>Insert_Selection.Enabled = False <br>Delete_Selection.Enabled = False <br>    End If <br> <br>Rem <br>Rem Change the primary window title to show the database name <br>Rem Clear the image control <br>Rem <br> <br>    DatabaseName$ = SQLName(SqlConn%) <br>    ChangePrimaryWindowCaption <br>    Image_Control.Picture = LoadPicture() <br> <br>End Sub <br> <br>Sub Delete_Selection_Click () <br> <br>    Image_Title$ = Titles_List.Text <br> <br>    If Image_Title$ = "" Then <br>Beep <br>MsgBox "You must first select a title." <br>    Else <br>Response% = MsgBox("Delete " + Image_Title$ + "?", 49) <br>If Response% = 1 Then <br>    PrimaryWindow.MousePointer = 11 <br>    Results% = ExecuteSQLCommand("Delete from image_table where title = '" + Image_Title$ + "'") <br>    Results% = SqlResults%(SqlConn%) <br>    Do While (SqlNextRow(SqlConn%) &lt;&gt; NOMOREROWS) <br>    Loop <br>    Image_Control.Picture = LoadPicture() <br>    RetrieveImageTitles <br>    PrimaryWindow.MousePointer = 0 <br>Else <br>    MsgBox "Delete aborted." <br>End If <br>    End If <br> <br>End Sub <br> <br>Sub Dir_Tree_Combo_Change () <br> <br>    Image_File_Label.Caption = "(none)" <br>    Image_File_List.Path = Dir_Tree_Combo.Path <br> <br>End Sub <br> <br>Sub Drive_Combo_Change () <br> <br>    Image_File_Label.Caption = "(none)" <br>    Dir_Tree_Combo.Path = Drive_Combo.Drive <br> <br>End Sub <br> <br>Sub Exit_Selection_Click () <br> <br>    ExitApplication <br>    End <br> <br>End Sub <br> <br>Sub Form_Load () <br> <br>   Temp_Image_File = "c:\image.tmp" <br> <br>    PrimaryWindowTitle = "Image Example" <br>    ChangePrimaryWindowCaption <br> <br>    InitializeApplication <br>    MsgBox DBLIB_VERSION$ <br> <br>    Logon_Selection.Enabled = True <br>    Log_Off_Selection.Enabled = False <br>    Exit_Selection.Enabled = True <br>    View_Selection.Enabled = False <br>    Insert_Selection.Enabled = False <br>    Delete_Selection.Enabled = False <br> <br>End Sub <br> <br>Sub Image_File_List_Click () <br> <br>    If Right$(Dir_Tree_Combo.Path, 1) = "\" Then <br>Image_File_Label.Caption = Dir_Tree_Combo.Path + Image_File_List.FileName <br>    Else <br>Image_File_Label.Caption = Dir_Tree_Combo.Path + "\" + Image_File_List.FileName <br>    End If <br> <br>End Sub <br> <br>Sub Insert_Selection_Click () <br> <br>Rem <br>Rem This routine will insert the image from the file into the database <br>Rem <br> <br>    Image_File$ = Image_File_Label.Caption <br>    Title$ = Title_Edit.Text <br>    Title$ = PrepareString(Title$) <br> <br>    If Image_File$ = "(none)" Then <br>Beep <br>MsgBox "Please select a bitmap to insert." <br>    ElseIf Title$ = "" Then <br>Beep <br>MsgBox "Please enter a title for the bitmap you wish to insert." <br>    Else <br>PrimaryWindow.MousePointer = 11 <br>InsertImage Title$, Image_File$ <br>Title_Edit.Text = "" <br>Image_File_List.ListIndex = -1 <br>Image_File_Label.Caption = "" <br>RetrieveImageTitles <br>PrimaryWindow.MousePointer = 0 <br>    End If <br> <br>End Sub <br> <br>Sub InsertImage (Title As String, Bitmap_File As String) <br>     <br>Rem <br>Rem This routine inserts an image into the SQL Server <br>Rem Insert new row with title and image token data <br>Rem <br> <br>    Results% = ExecuteSQLCommand("Insert into image_table values ('" + Title + "',0x80)") <br>    Do While SqlResults(SqlConn%) &lt;&gt; NOMORERESULTS% <br>Do While SqlNextRow(SqlConn%) &lt;&gt; NOMOREROWS% <br>Loop <br>    Loop <br> <br>Rem Get identifier for image column in current row <br> <br>    Results% = ExecuteSQLCommand("select image_col from image_table where title = '" + Title + "'") <br>    Do While SqlResults(SqlConn%) &lt;&gt; NOMORERESULTS% <br>Do While SqlNextRow(SqlConn%) &lt;&gt; NOMOREROWS% <br>    SqlPointer$ = SqlTxPtr(SqlConn%, 1) <br>    SqlTimestamp$ = SqlTxTimeStamp(SqlConn%, 1) <br>Loop <br>    Loop <br> <br>Rem Open bitmap file to load into SQL Server table <br> <br>    Open Bitmap_File For Binary As #1 <br>    FileLength&amp; = LOF(1) <br>     <br>Rem Begin inserting bitmap into image column in DatePartLimit&amp; size chunks <br> <br>    Table$ = "image_table.image_col" <br>    DataPartLimit&amp; = 4096 <br>    DataPartSize&amp; = 0 <br>    If SqlWriteText(SqlConn%, Table$, SqlPointer$, SQLTXPLEN%, SqlTimestamp$, 1, FileLength&amp;, "") &lt;&gt; FAIL% Then <br>If SqlOk(SqlConn%) &lt;&gt; FAIL% Then <br>    Results% = SqlResults(SqlConn%) <br>    Done% = False <br>    Do While Not Done% <br>DataPart$ = Input$(DataPartLimit&amp;, 1) <br>DataPartSize&amp; = DataPartSize&amp; + Len(DataPart$) <br>Results% = SqlMoreText%(SqlConn%, Len(DataPart$), DataPart$) <br>If DataPartSize&amp; = FileLength&amp; Then <br>    Done% = True <br>End If <br>    Loop <br>    If SqlOk(SqlConn%) &lt;&gt; FAIL% Then <br>If SqlResults(SqlConn%) &lt;&gt; FAIL% Then <br>    MsgBox "Image inserted." <br>End If <br>    End If <br>End If <br>    End If <br> <br>Close 1 <br> <br>End Sub <br> <br>Sub LoadImage (Title As String) <br>     <br>Rem <br>Rem This routine reads an image from the SQL Server <br>Rem Get length of bitmap image in image column <br>Rem <br> <br>    Results% = ExecuteSQLCommand("select datalength(image_col) from image_table where title = '" + Title + "'") <br>    Do While SqlResults(SqlConn%) &lt;&gt; NOMORERESULTS <br>Do While SqlNextRow(SqlConn%) &lt;&gt; NOMOREROWS <br>    ImageLen&amp; = Val(Sqldata(SqlConn%, 1)) <br>Loop <br>    Loop <br> <br>    Offset&amp; = 0 <br> <br>Rem Set LoadSizeLimit to 8K <br> <br>    LoadSizeLimit&amp; = 4096 <br>    If LoadSizeLimit&amp; &gt; ImageLen&amp; Then <br>LoadSizeLimit&amp; = ImageLen&amp; <br>    End If <br>     <br>    LoadSize&amp; = LoadSizeLimit&amp; <br> <br>Rem Set size of image returned to LoadSizeLimit&amp; <br> <br>    Results% = ExecuteSQLCommand("set textsize " + Str$(LoadSizeLimit&amp;)) <br>    Do While SqlResults(SqlConn%) &lt;&gt; NOMORERESULTS <br>Do While SqlNextRow(SqlConn%) &lt;&gt; NOMOREROWS <br>Loop <br>    Loop <br> <br>Rem Begin reading image column in LoadSizeLimit&amp; size chunks <br> <br>    Cmd$ = "Declare @val varbinary(30)" <br>    Results% = SqlCmd(SqlConn%, Cmd$) <br>    Cmd$ = "Select @val = textptr(image_col) from image_table where title = '" + Title + "'" <br>    Results% = SqlCmd(SqlConn%, Cmd$) <br>    Table$ = "image_table.image_col" <br>    Done% = False <br>    Do While Not Done% <br>Cmd$ = "READTEXT " + Table$ + " @val " + Str$(Offset&amp;) + " " + Str$(LoadSize&amp;) <br>Results% = SqlCmd(SqlConn%, Cmd$) <br>If Offset&amp; + LoadSize&amp; = ImageLen&amp; Then <br>    Done% = True <br>Else <br>    Offset&amp; = Offset&amp; + LoadSizeLimit&amp; <br>    If Offset&amp; + LoadSizeLimit&amp; &gt; ImageLen&amp; Then <br>LoadSize&amp; = ImageLen&amp; - Offset&amp; <br>    End If <br>End If <br>    Loop <br> <br>Rem Retrieve image data in result rows and write to temporary bitmap file <br>     <br>    If SqlExec(SqlConn%) &lt;&gt; FAIL% Then <br>Open Temp_Image_File For Binary As #1 <br>filepos&amp; = 1 <br>Do While SqlResults(SqlConn%) &lt;&gt; NOMORERESULTS <br>    Do While SqlNextRow(SqlConn%) &lt;&gt; NOMOREROWS <br>in$ = Sqldata(SqlConn%, 1) <br>Put 1, filepos&amp;, in$ <br>filepos&amp; = filepos&amp; + Len(in$) <br>    Loop <br>Loop <br>Close 1 <br>    End If <br> <br>End Sub <br> <br>Sub Log_Off_Selection_Click () <br> <br>    Logoff <br> <br>    Logon_Selection.Enabled = True <br>    Log_Off_Selection.Enabled = False <br>    Exit_Selection.Enabled = True <br>    View_Selection.Enabled = False <br>    Insert_Selection.Enabled = False <br>    Delete_Selection.Enabled = False <br> <br>End Sub <br> <br>Sub Logon_Selection_Click () <br> <br>    Login.Show 1 <br>    PrimaryWindow.MousePointer = 11 <br>    If CheckServerConnection() = 1 Then <br>Results% = GetDatabases(Database_List) <br>ChangePrimaryWindowCaption <br>Logon_Selection.Enabled = False <br>Log_Off_Selection.Enabled = True <br>    End If <br>    PrimaryWindow.MousePointer = 0 <br> <br>End Sub <br> <br>Function PrepareString (String_In As String) As String <br> <br>    String_Out$ = "" <br> <br>    For I% = 1 To Len(String_In) <br>If Mid$(String_In, I%, 1) = Chr$(39) Then <br>    String_Out$ = String_Out$ + Chr$(39) + Chr$(39) <br>Else <br>    String_Out$ = String_Out$ + Mid$(String_In, I%, 1) <br>End If <br>    Next <br> <br>    PrepareString = String_Out$ <br> <br>End Function <br> <br>Sub RetrieveImageTitles () <br> <br>    ClearImageTitles <br>    Rem Retrieve text titles from SQL Server into list box <br>    Results% = ExecuteSQLCommand("Select title from image_table") <br>    Do While (SqlResults%(SqlConn%) &lt;&gt; NOMORERESULTS) <br>Do While (SqlNextRow(SqlConn%) &lt;&gt; NOMOREROWS) <br>    Titles_List.AddItem Sqldata(SqlConn%, 1) <br>Loop <br>    Loop <br> <br>End Sub <br> <br>Sub Title_Edit_KeyPress (KeyAscii As Integer) <br> <br>    If Len(Title_Edit.Text) = 30 Then <br>If KeyAscii &lt;&gt; 8 Then <br>    KeyAscii = 0 <br>End If <br>    End If <br>     <br>End Sub <br> <br>Sub Titles_List_Click () <br> <br>Rem <br>Rem Clear the picture <br>Rem <br> <br>    Image_Control.Picture = LoadPicture() <br> <br>End Sub <br> <br>Sub Titles_List_DblClick () <br> <br>Rem <br>Rem Get the image image selected from the server <br>Rem Display the image <br>Rem <br> <br> <br>    Image_Title$ = Titles_List.Text <br>    PrimaryWindow.MousePointer = 11 <br>    LoadImage Image_Title$ <br>    Image_Control.Picture = LoadPicture(Temp_Image_File) <br>    PrimaryWindow.MousePointer = 0 <br> <br>End Sub <br> <br>Sub VBSQL1_Error (SqlConn As Integer, Severity As Integer, ErrorNum As Integer, ErrorStr As String, RetCode As Integer) <br>' Call the required VBSQL error-handling function <br>' OSErr and OSErrStr not used in VBSQL for Windows, but DOS interprets <br>' anything other than -1 as an OS error <br>    OsErr% = -1 <br> <br>    RetCode% = UserSqlErrorHandler%(SqlConn, Severity%, ErrorNum%, OsErr%, ErrorStr$, OsErrStr$) <br> <br>End Sub <br> <br>Sub VBSQL1_Message (SqlConn As Integer, Message As Long, State As Integer, Severity As Integer, MsgStr As String) <br> <br>    UserSqlMsgHandler SqlConn, Message&amp;, State%, Severity%, MsgStr$ <br> <br>End Sub <br> <br>Sub View_Selection_Click () <br> <br>    Image_Title$ = Titles_List.Text <br>    If Image_Title$ = "" Then <br>Beep <br>MsgBox "You must first select a title." <br>    Else <br>PrimaryWindow.MousePointer = 11 <br>LoadImage Image_Title$ <br>Image_Control.Picture = LoadPicture(Temp_Image_File) <br>PrimaryWindow.MousePointer = 0 <br>    End If <br> <br>End Sub <br> </code></pre>
<p>&nbsp;</p></body>
</HTML>
