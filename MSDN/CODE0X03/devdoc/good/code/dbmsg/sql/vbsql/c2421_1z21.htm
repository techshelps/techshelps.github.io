<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>VBQUERY.FRM</title>
<link disabled rel=stylesheet href=../../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>
<h2><a name="_code_context2449"></a>VBQUERY.FRM</h2>
<pre><code>VERSION 2.00 <br>Begin Form PrimaryWindow  <br>   BackColor       =   &amp;H00808000&amp; <br>   Caption         =   "VBSQL Sample Query Tool - [No Server]" <br>   ForeColor       =   &amp;H00000000&amp; <br>   Height          =   6120 <br>   Left            =   240 <br>   ScaleHeight     =   5430 <br>   ScaleWidth      =   8760 <br>   Top             =   660 <br>   Width           =   8880 <br>   Begin VBSQL VBSQL1  <br>      Caption         =   "Errors" <br>      Height          =   375 <br>      Left            =   2640 <br>      Top             =   0 <br>      Visible         =   0   'False <br>      Width           =   1815 <br>   End <br>   Begin CommandButton SEND_QUERY_BUTTON  <br>      BackColor       =   &amp;H00C0C0C0&amp; <br>      Caption         =   "&amp;Send Query" <br>      Enabled         =   0   'False <br>      Height          =   480 <br>      Left            =   7080 <br>      TabIndex        =   5 <br>      Top             =   960 <br>      Width           =   1440 <br>   End <br>   Begin CommandButton NEW_QUERY_BUTTON  <br>      BackColor       =   &amp;H00C0C0C0&amp; <br>      Caption         =   "&amp;New Query" <br>      Enabled         =   0   'False <br>      Height          =   480 <br>      Left            =   7080 <br>      TabIndex        =   4 <br>      Top             =   240 <br>      Width           =   1440 <br>   End <br>   Begin TextBox RESULT_FIELD  <br>      BackColor       =   &amp;H00FFFFFF&amp; <br>      FontBold        =   -1  'True <br>      FontItalic      =   0   'False <br>      FontName        =   "Courier" <br>      FontSize        =   9.75 <br>      FontStrikethru  =   0   'False <br>      FontUnderline   =   0   'False <br>      ForeColor       =   &amp;H00000000&amp; <br>      Height          =   3120 <br>      Left            =   120 <br>      MultiLine       =   -1  'True <br>      ScrollBars      =   3  'Both <br>      TabIndex        =   3 <br>      Top             =   1920 <br>      Width           =   8520 <br>   End <br>   Begin TextBox QUERY_FIELD  <br>      BackColor       =   &amp;H00FFFFFF&amp; <br>      ForeColor       =   &amp;H00000000&amp; <br>      Height          =   960 <br>      Left            =   120 <br>      MultiLine       =   -1  'True <br>      ScrollBars      =   3  'Both <br>      TabIndex        =   1 <br>      Top             =   480 <br>      Width           =   6480 <br>   End <br>   Begin Label Label2  <br>      BackColor       =   &amp;H00808000&amp; <br>      Caption         =   "&amp;Results:" <br>      ForeColor       =   &amp;H00000000&amp; <br>      Height          =   240 <br>      Left            =   120 <br>      TabIndex        =   2 <br>      Top             =   1680 <br>      Width           =   720 <br>   End <br>   Begin Label Label1  <br>      BackColor       =   &amp;H00808000&amp; <br>      Caption         =   "&amp;Query:" <br>      ForeColor       =   &amp;H00000000&amp; <br>      Height          =   240 <br>      Left            =   120 <br>      TabIndex        =   0 <br>      Top             =   240 <br>      Width           =   720 <br>   End <br>   Begin Menu CONNECT_MENU  <br>      Caption         =   "&amp;Connection" <br>      Begin Menu LOGIN_MENU  <br>         Caption         =   "&amp;Login" <br>      End <br>      Begin Menu DATABASE_MENU  <br>         Caption         =   "Change &amp;Database" <br>      End <br>      Begin Menu EXIT_MENU  <br>         Caption         =   "E&amp;xit" <br>      End <br>   End <br>   Begin Menu HELP_MENU  <br>      Caption         =   "&amp;Help" <br>      Begin Menu ABOUT_MENU  <br>         Caption         =   "&amp;About..." <br>      End <br>   End <br>End <br>'$INCLUDE: 'VBQUERY.BI' <br>'$INCLUDE: 'VBDSQL.BI' <br> <br>Sub ABOUT_MENU_Click () <br>    About_Form.Show 1 <br>End Sub <br> <br>Sub ClearFields () <br>QUERY_FIELD.Text = "" <br>RESULT_FIELD.Text = "" <br>End Sub <br> <br>Sub DATABASE_MENU_Click () <br>If SqlConn = 0 Then <br>MsgBox "Must login first" <br>Exit Sub <br>End If <br>CHNGDB.Show 1 <br>End Sub <br> <br>Sub EXIT_MENU_Click () <br> <br>ExitApplication <br>End Sub <br> <br>Sub Form_Load () <br> <br>Rem <br>Rem Initialize the connection to SQL Server <br>Rem <br>InitializeApplication <br>MsgBox DBLIB_VERSION$ <br>PrimaryWindowTitle = "VBSQL Sample Query Tool" <br>End Sub <br> <br>Sub LOGIN_MENU_Click () <br> <br>Login.Show 1 <br>NEW_QUERY_BUTTON.Enabled = -1 <br>SEND_QUERY_BUTTON.Enabled = -1 <br> <br>End Sub <br> <br>Sub NEW_QUERY_BUTTON_Click () <br>ClearFields <br>QUERY_FIELD.SetFocus <br>End Sub <br> <br>Sub SEND_QUERY_BUTTON_Click () <br> <br>On Error GoTo OutofRoom <br> <br>Static OutputData() As String <br>ReDim Preserve OutputData(500) As String <br> <br>Rem <br>Rem Get the query.  Make sure there is one <br>Rem <br> <br>CRLF$ = Chr$(13) + Chr$(10) <br> <br>cmd$ = QUERY_FIELD.Text <br> <br>If cmd$ = "" Then <br>MsgBox "There is no query in the Query field" <br>Exit Sub <br>End If <br> <br>Rem <br>Rem Clear the result array, and result controls first <br>Rem <br> <br>i% = 0 <br>For i% = 0 To 499 <br>OutputData(i%) = "" <br>Next <br> <br>Rem <br>Rem Fill the result array with the data <br>Rem Fill the results field <br>Rem <br> <br>RESULT_FIELD.Text = "" <br>numrows&amp; = Process_SQL_query(cmd$, OutputData()) <br> <br> <br>'fill temporary string first, to avoid flashing with every row <br> <br>For i% = 0 To numrows&amp; - 1 <br>DataLine$ = DataLine$ + OutputData(i%) + CRLF$ <br> <br>Next i% <br> <br>RESULT_FIELD.Text = DataLine$ <br>QUERY_FIELD.SetFocus <br> <br>Exit Sub <br> <br>OutofRoom: <br>'can run out of space filling strings.  If so, try just 20 rows <br>DataLine$ = "" <br>If numrows&amp; &gt; 20 Then <br>numrows&amp; = 20 <br> <br>For i% = 0 To numrows&amp; - 1 <br>DataLine$ = DataLine$ + OutputData(i%) + CRLF$ <br>Next i% <br> <br>RESULT_FIELD.Text = DataLine$ <br>End If <br>MsgBox "Out of room, output truncated" <br>QUERY_FIELD.SetFocus <br>Exit Sub <br> <br>End Sub <br> <br>Sub VBSQL1_Error (SqlConn As Integer, Severity As Integer, ErrorNum As Integer, ErrorStr As String, RetCode As Integer) <br>' Call the required VBSQL error-handling function <br>' OSErr and OSErrStr not used in VBSQL for Windows, but DOS interprets <br>' anything other than -1 as an OS error <br>    OsErr% = -1 <br> <br>    RetCode% = UserSqlErrorHandler%(SqlConn, Severity%, ErrorNum%, OsErr%, ErrorStr$, OsErrStr$) <br> <br>End Sub <br> <br>Sub VBSQL1_Message (SqlConn As Integer, Message As Long, State As Integer, Severity As Integer, MsgStr As String) <br>    UserSqlMsgHandler SqlConn, Message&amp;, State%, Severity%, MsgStr$ <br>End Sub <br> </code></pre>
<p>&nbsp;</p></body>
</HTML>
