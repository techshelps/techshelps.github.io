<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>TEXT.FRM</title>
<link disabled rel=stylesheet href=../../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>
<h2><a name="_code_context2446"></a>TEXT.FRM</h2>
<pre><code>VERSION 2.00 <br>Begin Form PrimaryWindow  <br>   BackColor       =   &amp;H00C0C0C0&amp; <br>   BorderStyle     =   1  'Fixed Single <br>   Caption         =   "Text" <br>   ControlBox      =   0   'False <br>   ForeColor       =   &amp;H00000000&amp; <br>   Height          =   6585 <br>   Icon            =   TEXT.FRX:0000 <br>   Left            =   630 <br>   LinkMode        =   1  'Source <br>   LinkTopic       =   "Form1" <br>   MaxButton       =   0   'False <br>   ScaleHeight     =   5895 <br>   ScaleWidth      =   7815 <br>   Top             =   75 <br>   Width           =   7935 <br>   Begin TextBox Text_Edit  <br>      BackColor       =   &amp;H00FFFFFF&amp; <br>      ForeColor       =   &amp;H00000000&amp; <br>      Height          =   2775 <br>      Left            =   120 <br>      MultiLine       =   -1  'True <br>      ScrollBars      =   3  'Both <br>      TabIndex        =   0 <br>      Top             =   2760 <br>      Width           =   7575 <br>   End <br>   Begin VBSQL VBSQL1  <br>      Caption         =   "SQL Err/Msg" <br>      Height          =   272 <br>      Left            =   5580 <br>      Top             =   2430 <br>      Visible         =   0   'False <br>      Width           =   2055 <br>   End <br>   Begin ListBox Titles_List  <br>      Height          =   810 <br>      Left            =   135 <br>      TabIndex        =   9 <br>      Top             =   1410 <br>      Width           =   2415 <br>   End <br>   Begin DirListBox Dir_Tree_Combo  <br>      Height          =   1275 <br>      Left            =   3360 <br>      TabIndex        =   5 <br>      Top             =   1155 <br>      Width           =   2055 <br>   End <br>   Begin FileListBox Text_File_List  <br>      Height          =   1590 <br>      Left            =   5580 <br>      Pattern         =   "*.txt" <br>      TabIndex        =   6 <br>      Top             =   840 <br>      Width           =   2055 <br>   End <br>   Begin DriveListBox Drive_Combo  <br>      Height          =   357 <br>      Left            =   3360 <br>      TabIndex        =   4 <br>      Top             =   833 <br>      Width           =   2048 <br>   End <br>   Begin ListBox Database_List  <br>      Height          =   420 <br>      Left            =   135 <br>      TabIndex        =   11 <br>      Top             =   360 <br>      Width           =   2415 <br>   End <br>   Begin TextBox Title_Edit  <br>      Height          =   323 <br>      Left            =   4605 <br>      TabIndex        =   2 <br>      Top             =   75 <br>      Width           =   3075 <br>   End <br>   Begin Label Label5  <br>      BackColor       =   &amp;H00C0C0C0&amp; <br>      Caption         =   "Text in database:" <br>      Height          =   225 <br>      Left            =   120 <br>      TabIndex        =   12 <br>      Top             =   2520 <br>      Width           =   2055 <br>   End <br>   Begin Label Label4  <br>      BackColor       =   &amp;H00C0C0C0&amp; <br>      Caption         =   "Titles in database:" <br>      Height          =   225 <br>      Left            =   120 <br>      TabIndex        =   10 <br>      Top             =   1185 <br>      Width           =   2055 <br>   End <br>   Begin Label Text_File_Label  <br>      BackColor       =   &amp;H00C0C0C0&amp; <br>      Caption         =   "(none)" <br>      Height          =   255 <br>      Left            =   3855 <br>      TabIndex        =   8 <br>      Top             =   480 <br>      Width           =   3870 <br>   End <br>   Begin Label Label3  <br>      BackColor       =   &amp;H00C0C0C0&amp; <br>      Caption         =   "File:" <br>      Height          =   255 <br>      Left            =   3360 <br>      TabIndex        =   7 <br>      Top             =   480 <br>      Width           =   375 <br>   End <br>   Begin Label Label2  <br>      BackColor       =   &amp;H00C0C0C0&amp; <br>      Caption         =   "Text file title:" <br>      ForeColor       =   &amp;H00000000&amp; <br>      Height          =   255 <br>      Left            =   3360 <br>      TabIndex        =   3 <br>      Top             =   120 <br>      Width           =   1245 <br>   End <br>   Begin Label Label1  <br>      BackColor       =   &amp;H00C0C0C0&amp; <br>      Caption         =   "Databases:" <br>      Height          =   210 <br>      Left            =   120 <br>      TabIndex        =   1 <br>      Top             =   120 <br>      Width           =   1005 <br>   End <br>   Begin Menu Menu_File  <br>      Caption         =   "&amp;File" <br>      Begin Menu Logon_Selection  <br>         Caption         =   "&amp;Logon" <br>      End <br>      Begin Menu Log_Off_Selection  <br>         Caption         =   "Log &amp;Off" <br>      End <br>      Begin Menu Exit_Selection  <br>         Caption         =   "&amp;Exit" <br>      End <br>   End <br>   Begin Menu Options_Menu  <br>      Caption         =   "&amp;Options" <br>      Begin Menu View_Selection  <br>         Caption         =   "&amp;View Text" <br>      End <br>      Begin Menu Insert_Selection  <br>         Caption         =   "&amp;Insert Text" <br>      End <br>      Begin Menu Delete_Selection  <br>         Caption         =   "&amp;Delete Text" <br>      End <br>   End <br>   Begin Menu About_Menu  <br>      Caption         =   "&amp;About" <br>   End <br>End <br> <br>Sub About_Menu_Click () <br> <br>    About_Form.Show 1 <br> <br>End Sub <br> <br>Function CheckForTextTable () As Integer <br> <br>    Rem Check to see if sample table exits <br>    Cmd$ = "Select count(*) from sysobjects where name = 'text_table'" <br>    Results% = SqlCmd(SqlConn%, Cmd$) <br>    Results% = SqlExec(SqlConn%) <br>    Do While (SqlResults%(SqlConn%) &lt;&gt; NOMORERESULTS) <br>Do While (SqlNextRow(SqlConn%) &lt;&gt; NOMOREROWS) <br>    Table_Found$ = Sqldata(SqlConn%, 1) <br>Loop <br>    Loop <br> <br>    If Val(Table_Found$) = 0 Then <br>Results% = MsgBox("Text table not found in " + Database$ + " database." + Chr$(13) + Chr$(10) + "Do you wish to create the table?", 52) <br>If Results% = 7 Then <br>    CheckForTextTable = FAIL <br>    Exit Function <br>Else <br>    Rem If sample table does not exist, create it <br>    Cmd$ = "create table text_table (title varchar(30) not null, text_col text null)" <br>    Results% = SqlCmd(SqlConn%, Cmd$) <br>    Results% = SqlExec(SqlConn%) <br>    Do While (SqlResults%(SqlConn%) &lt;&gt; NOMORERESULTS) <br>Do While (SqlNextRow(SqlConn%) &lt;&gt; NOMOREROWS) <br>Loop <br>    Loop <br>    CheckForTextTable = SUCCEED <br>End If <br>    Else <br>CheckForTextTable = SUCCEED <br>    End If <br> <br>End Function <br> <br>Sub ClearTextTitles () <br> <br>Rem Clear all text titles out of list box <br>Do While Titles_List.ListCount <br>    Titles_List.RemoveItem 0 <br>Loop <br> <br>End Sub <br> <br>Sub Database_List_Click () <br> <br>Rem <br>Rem Get the database user wants to open <br>Rem If it doesn't have the text table in it, see if user wants to create one <br>Rem If it does exist, get all the text titles <br>Rem <br>    <br>    DatabaseSelection$ = Database_list.Text <br>    Results% = SqlUse(SqlConn%, DatabaseSelection$) <br>    Results% = CheckForTextTable() <br>    If Results% = SUCCEED Then <br>PrimaryWindow.MousePointer = 11 <br>RetrieveTextTitles <br>View_Selection.Enabled = True <br>Insert_Selection.Enabled = True <br>Delete_Selection.Enabled = True <br>PrimaryWindow.MousePointer = 0 <br>    Else <br>ClearTextTitles <br>View_Selection.Enabled = False <br>Insert_Selection.Enabled = False <br>Delete_Selection.Enabled = False <br>    End If <br> <br>Rem <br>Rem Display the current database in the title window <br>Rem clear the text field <br>Rem <br> <br>    DatabaseName$ = SqlName(SqlConn%) <br>    ChangePrimaryWindowCaption <br>    Text_Edit.Text = "" <br> <br>End Sub <br> <br>Sub Delete_Selection_Click () <br> <br>    Text_Title$ = Titles_List.Text <br> <br>    If Text_Title$ = "" Then <br>Beep <br>MsgBox "You must first select a title." <br>    Else <br>Response% = MsgBox("Delete " + Text_Title$ + "?", 49) <br>If Response% = 1 Then <br>    PrimaryWindow.MousePointer = 11 <br>    Results% = ExecuteSQLCommand("Delete from text_table where title = '" + Text_Title$ + "'") <br>    Results% = SqlResults%(SqlConn%) <br>    Do While (SqlNextRow(SqlConn%) &lt;&gt; NOMOREROWS) <br>    Loop <br>    PrimaryWindow.Text_Edit.Text = "" <br>    RetrieveTextTitles <br>    PrimaryWindow.MousePointer = 0 <br>Else <br>    MsgBox "Delete aborted." <br>End If <br>    End If <br> <br>End Sub <br> <br>Sub Dir_Tree_Combo_Change () <br> <br>    Text_File_Label.Caption = "(none)" <br>    Text_File_List.Path = Dir_Tree_Combo.Path <br> <br>End Sub <br> <br>Sub Drive_Combo_Change () <br> <br>    Text_File_Label.Caption = "(none)" <br>    Dir_Tree_Combo.Path = Drive_Combo.Drive <br> <br>End Sub <br> <br>Sub Exit_Selection_Click () <br> <br>    ExitApplication <br>    End <br> <br>End Sub <br> <br>Sub Form_Load () <br> <br>    PrimaryWindowTitle = "Text Example" <br>    ChangePrimaryWindowCaption <br> <br>    InitializeApplication <br>    MsgBox DBLIB_VERSION$ <br> <br>    Logon_Selection.Enabled = True <br>    Log_Off_Selection.Enabled = False <br>    Exit_Selection.Enabled = True <br>    View_Selection.Enabled = False <br>    Insert_Selection.Enabled = False <br>    Delete_Selection.Enabled = False <br> <br>End Sub <br> <br>Sub Insert_Selection_Click () <br> <br>    Text_File$ = Text_File_Label.Caption <br>    Title$ = Title_Edit.Text <br>    Title$ = PrepareString(Title$) <br> <br>    If Text_File$ = "(none)" Then <br>Beep <br>MsgBox "Please select a text file to insert." <br>    ElseIf Title$ = "" Then <br>Beep <br>MsgBox "Please enter a title for the text file you wish to insert." <br>    Else <br>PrimaryWindow.MousePointer = 11 <br>InsertText Title$, Text_File$ <br>Title_Edit.Text = "" <br>Text_File_List.ListIndex = -1 <br>Text_File_Label.Caption = "" <br>RetrieveTextTitles <br>PrimaryWindow.MousePointer = 0 <br>    End If <br> <br>End Sub <br> <br>Sub InsertText (Title As String, Text_File As String) <br>     <br>Rem <br>Rem This routine will insert the text data into the table <br>Rem Insert new row with title and token text value <br>Rem <br> <br>    Results% = ExecuteSQLCommand("Insert into text_table values ('" + Title + "','none')") <br>    Do While SqlResults(SqlConn%) &lt;&gt; NOMORERESULTS% <br>Do While SqlNextRow(SqlConn%) &lt;&gt; NOMOREROWS% <br>Loop <br>    Loop <br> <br>Rem Get identifier for text column in current row <br> <br>    Results% = ExecuteSQLCommand("select text_col from text_table where title = '" + Title + "'") <br>    Do While SqlResults(SqlConn%) &lt;&gt; NOMORERESULTS% <br>Do While SqlNextRow(SqlConn%) &lt;&gt; NOMOREROWS% <br>    SqlPointer$ = SqlTxPtr(SqlConn%, 1) <br>    SqlTimestamp$ = SqlTxTimeStamp(SqlConn%, 1) <br>Loop <br>    Loop <br> <br>Rem Open text file to load into SQL Server table <br> <br>    DataPartLimit&amp; = 8192 <br>    Done% = False <br>     <br>    Open Text_File For Input As #1 <br> <br>    FileLength&amp; = LOF(1) <br>    If FileLength&amp; &gt; 65536 Then <br>MsgBox "This application cannot display text files greater than 64K." <br>    Else <br>FileData$ = "" <br>Do While Not EOF(1) <br>    Input #1, DataPart$ <br>    If Right$(DataPart$, 2) &lt;&gt; Chr$(13) + Chr$(10) Then <br>If Right$(DataPart$, 1) = Chr$(13) Then <br>    FileData$ = FileData$ + Left$(DataPart$, Len(DataPart$) - 1) + Chr$(13) + Chr$(10) <br>ElseIf Right$(DataPart$, 1) = Chr$(10) Then <br>    FileData$ = FileData$ + Left$(DataPart$, Len(DataPart$) - 1) + Chr$(13) + Chr$(10) <br>Else <br>    FileData$ = FileData$ + DataPart$ + Chr$(13) + Chr$(10) <br>End If <br>    Else <br>FileData$ = FileData$ + DataPart$ <br>    End If <br>Loop <br> <br>Rem Begin inserting text into text column in DatePartLimit&amp; size chunks <br> <br>Table$ = "text_table.text_col" <br>DataPos&amp; = 1 <br>DataLen&amp; = Len(FileData$) <br> <br>If SqlWriteText(SqlConn%, Table$, SqlPointer$, SQLTXPLEN%, SqlTimestamp$, 1, DataLen&amp;, "") &lt;&gt; FAIL% Then <br>    If SqlOk(SqlConn%) &lt;&gt; FAIL% Then <br>Results% = SqlResults(SqlConn%) <br>Do While Not Done% <br>    If DataPos&amp; + DataPartLimit&amp; - 1 &lt; DataLen&amp; Then <br>DataPart$ = Mid$(FileData$, DataPos&amp;, DataPartLimit&amp;) <br>DataPos&amp; = DataPos&amp; + Len(DataPart$) <br>    Else <br>DataPart$ = Mid$(FileData$, DataPos&amp;, DataLen&amp; - DataPos&amp; + 1) <br>Done% = True <br>    End If <br>Results% = SqlMoreText%(SqlConn%, Len(DataPart$), DataPart$) <br>Loop <br>If SqlOk(SqlConn%) &lt;&gt; FAIL% Then <br>    If SqlResults(SqlConn%) &lt;&gt; FAIL% Then <br>    MsgBox "Text inserted." <br>    End If <br>End If <br>    End If <br>End If <br>    End If <br>Close 1 <br> <br>End Sub <br> <br>Sub LoadText (Title As String) <br>     <br>Rem <br>Rem This routine will read the text field from the table <br>Rem Clear Text_Edit box on primary window <br>Rem <br> <br>    Text_Edit.Text = "" <br> <br>Rem Get length of text in text column <br> <br>    Results% = ExecuteSQLCommand("select datalength(text_col) from text_table where title = '" + Title + "'") <br>    Do While SqlResults(SqlConn%) &lt;&gt; NOMORERESULTS <br>Do While SqlNextRow(SqlConn%) &lt;&gt; NOMOREROWS <br>    TextLen&amp; = Val(Sqldata(SqlConn%, 1)) <br>Loop <br>    Loop <br> <br>    Offset&amp; = 0 <br> <br>Rem Set size limit on chunks of text data <br> <br>    LoadSizeLimit&amp; = 8192 <br>    If LoadSizeLimit&amp; &gt; TextLen&amp; Then <br>LoadSizeLimit&amp; = TextLen&amp; <br>    End If <br>     <br>    LoadSize&amp; = LoadSizeLimit&amp; <br> <br>Rem Set size of text returned to LoadSizeLimit&amp; <br> <br>    Results% = ExecuteSQLCommand("set textsize " + Str$(LoadSizeLimit&amp;)) <br>    Do While SqlResults(SqlConn%) &lt;&gt; NOMORERESULTS <br>Do While SqlNextRow(SqlConn%) &lt;&gt; NOMOREROWS <br>Loop <br>    Loop <br> <br>Rem Begin reading text column in LoadSizeLimit&amp; size chunks <br> <br>    Cmd$ = "Declare @val varbinary(30)" <br>    Results% = SqlCmd(SqlConn%, Cmd$) <br>    Cmd$ = "Select @val = textptr(text_col) from text_table where title = '" + Title + "'" <br>    Results% = SqlCmd(SqlConn%, Cmd$) <br>    Done% = False <br>Do While Not Done% <br>    Cmd$ = "READTEXT text_table.text_col @val " + Str$(Offset&amp;) + " " + Str$(LoadSize&amp;) <br>    Results% = SqlCmd(SqlConn%, Cmd$) <br>    If Offset&amp; + LoadSize&amp; = TextLen&amp; Then <br>Done% = True <br>    Else <br>Offset&amp; = Offset&amp; + LoadSizeLimit&amp; <br>If Offset&amp; + LoadSizeLimit&amp; &gt; TextLen&amp; Then <br>    LoadSize&amp; = TextLen&amp; - Offset&amp; <br>End If <br>    End If <br>Loop <br> <br>Rem Retrieve text data in result rows and place in text_edit box <br>     <br>    FileData$ = "" <br>    If SqlExec(SqlConn%) &lt;&gt; FAIL% Then <br>Do While SqlResults(SqlConn%) &lt;&gt; NOMORERESULTS <br>    Do While SqlNextRow(SqlConn%) &lt;&gt; NOMOREROWS <br>FileData$ = FileData$ + Sqldata(SqlConn%, 1) <br>    Loop <br>Loop <br>    End If <br> <br>Rem Load text data into edit box on primary window <br>    Text_Edit.Text = FileData$ <br> <br>End Sub <br> <br>Sub Log_Off_Selection_Click () <br> <br>    Logoff <br> <br>    Logon_Selection.Enabled = True <br>    Log_Off_Selection.Enabled = False <br>    Exit_Selection.Enabled = True <br>    View_Selection.Enabled = False <br>    Insert_Selection.Enabled = False <br>    Delete_Selection.Enabled = False <br> <br>End Sub <br> <br>Sub Logon_Selection_Click () <br> <br>    Login.Show 1 <br>    PrimaryWindow.MousePointer = 11 <br>    If CheckServerConnection() = 1 Then <br>Results% = GetDatabases(Database_list) <br>ChangePrimaryWindowCaption <br>Logon_Selection.Enabled = False <br>Log_Off_Selection.Enabled = True <br>    End If <br>    PrimaryWindow.MousePointer = 0 <br> <br>End Sub <br> <br>Function PrepareString (String_In As String) As String <br> <br>Rem <br>Rem This routine will double up the single quotation mark to <br>Rem avoid syntax errors <br>Rem <br> <br>    String_Out$ = "" <br> <br>    For I% = 1 To Len(String_In) <br>If Mid$(String_In, I%, 1) = Chr$(39) Then <br>    String_Out$ = String_Out$ + Chr$(39) + Chr$(39) <br>Else <br>    String_Out$ = String_Out$ + Mid$(String_In, I%, 1) <br>End If <br>    Next <br> <br>    PrepareString = String_Out$ <br> <br>End Function <br> <br>Sub RetrieveTextTitles () <br> <br>Rem <br>Rem This routine will get all the text titles from the table <br>Rem Put them in the list box as they are retrieved. <br>Rem <br> <br>    ClearTextTitles <br>    Results% = ExecuteSQLCommand("Select title from text_table") <br>    Do While (SqlResults%(SqlConn%) &lt;&gt; NOMORERESULTS) <br>Do While (SqlNextRow(SqlConn%) &lt;&gt; NOMOREROWS) <br>    Titles_List.AddItem Sqldata(SqlConn%, 1) <br>Loop <br>    Loop <br> <br>End Sub <br> <br>Sub Text_Edit_KeyPress (KeyAscii As Integer) <br> <br>    If KeyAscii &lt;&gt; 0 Then <br>KeyAscii = 0 <br>    End If <br> <br>End Sub <br> <br>Sub Text_File_List_Click () <br> <br>    If Right$(Dir_Tree_Combo.Path, 1) = "\" Then <br>Text_File_Label.Caption = Dir_Tree_Combo.Path + Text_File_List.FileName <br>    Else <br>Text_File_Label.Caption = Dir_Tree_Combo.Path + "\" + Text_File_List.FileName <br>    End If <br> <br>End Sub <br> <br>Sub Title_Edit_KeyPress (KeyAscii As Integer) <br> <br>    If Len(Title_Edit.Text) = 30 Then <br>If KeyAscii &lt;&gt; 8 Then <br>    KeyAscii = 0 <br>End If <br>    End If <br>     <br>End Sub <br> <br>Sub Titles_List_Click () <br> <br>    Text_Edit.Text = "" <br> <br>End Sub <br> <br>Sub Titles_List_DblClick () <br> <br>    Text_Title$ = Titles_List.Text <br>    PrimaryWindow.MousePointer = 11 <br>    LoadText Text_Title$ <br>    PrimaryWindow.MousePointer = 0 <br> <br>End Sub <br> <br>Sub VBSQL1_Error (SqlConn As Integer, Severity As Integer, ErrorNum As Integer, ErrorStr As String, RetCode As Integer) <br>' Call the required VBSQL error-handling function <br>' OSErr and OSErrStr not used in VBSQL for Windows, but DOS interprets <br>' anything other than -1 as an OS error <br>    OsErr% = -1 <br> <br>    RetCode% = UserSqlErrorHandler%(SqlConn, Severity%, ErrorNum%, OsErr%, ErrorStr$, OsErrStr$) <br>End Sub <br> <br>Sub VBSQL1_Message (SqlConn As Integer, Message As Long, State As Integer, Severity As Integer, MsgStr As String) <br> <br>    UserSqlMsgHandler SqlConn, Message&amp;, State%, Severity%, MsgStr$ <br> <br>End Sub <br> <br>Sub View_Selection_Click () <br> <br>    Text_Title$ = Titles_List.Text <br>    If Text_Title$ = "" Then <br>Beep <br>MsgBox "You must first select a title." <br>    Else <br>PrimaryWindow.MousePointer = 11 <br>LoadText Text_Title$ <br>PrimaryWindow.MousePointer = 0 <br>    End If <br> <br>End Sub <br> </code></pre>
<p>&nbsp;</p></body>
</HTML>
