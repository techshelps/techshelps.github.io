<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>MISCGDI.CPP</title>
<link disabled rel=stylesheet href=../../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>
<h2><a name="_code_context1906"></a>MISCGDI.CPP</h2>
<pre><code>//--miscdgi.cpp--------------------------------------------------------------- <br>// <br>// implementation of the DrawItem <br>// <br>// Copyright (C) Microsoft Corp. 1986-1996.  All Rights Reserved. <br>//---------------------------------------------------------------------------- <br> <br>#include "stdafx.h" <br>#include "miscgdi.h"  <br>#include "oditem.h" <br> <br>#define EXTRA_X 5 <br> <br>void DrawItem(LPDRAWITEMSTRUCT lpDIS) <br>{ <br>    CDC* pDC = CDC::FromHandle(lpDIS-&gt;hDC); <br>    COwnerDrawItem *pODI = (COwnerDrawItem *)lpDIS-&gt;itemData; <br> <br>    if ((pODI == NULL) || (pODI == (COwnerDrawItem*)0xFFFFFFFF)) <br>    {    <br>        TRACE ("COwnerDrawListBox::DrawItem - Got invalid data\n"); <br>        return; <br>    } <br>     <br>    COLORREF crOldTextColor; <br>    COLORREF crOldBkColor; <br> <br>    CString strText (pODI-&gt;m_strDescription); <br> <br>    CFont fnBold; <br>CFont * pOldFont = NULL; <br>if (pODI-&gt;m_dwFlags &amp; ODI_BOLDTEXT) <br>{ <br>TEXTMETRIC tm; <br>LOGFONT lf; <br>CString strFont; <br> <br>memset (&amp;lf, 0, sizeof (LOGFONT)); <br> <br>pDC-&gt;GetTextMetrics (&amp;tm); <br>lf.lfHeight = tm.tmHeight; <br>lf.lfWeight = 700; <br> <br> <br>pDC-&gt;GetTextFace(strFont); <br>strncpy (lf.lfFaceName, strFont, 32); <br>fnBold.CreateFontIndirect(&amp;lf); <br> <br>pOldFont = pDC-&gt;SelectObject (&amp;fnBold); <br>} <br> <br>// rcSelection is to move the selection rect over to the right  <br>CRect rcSelection (lpDIS-&gt;rcItem); <br> <br>    if ( (lpDIS-&gt;itemAction &amp; ODA_DRAWENTIRE) || (lpDIS-&gt;itemAction &amp; ODA_SELECT) ) <br>    { <br>        if (lpDIS-&gt;itemState &amp; ODS_SELECTED) <br>        { <br>            // item is selected <br>            COLORREF crHighlight= GetSysColor (COLOR_HIGHLIGHT); <br>COLORREF crHighlightText= GetSysColor (COLOR_HIGHLIGHTTEXT); <br>            crOldTextColor = pDC-&gt;SetTextColor (crHighlightText); <br>            crOldBkColor = pDC-&gt;SetBkColor (crHighlight);   // For DrawText below <br>            CBrush br(crHighlight); <br>            CBrush bk(GetSysColor (COLOR_WINDOW)); <br>            pDC-&gt;FillRect(&amp;lpDIS-&gt;rcItem, &amp;bk); <br>pDC-&gt;FillRect(rcSelection, &amp;br); <br>        } <br>     <br>        if (!lpDIS-&gt;itemState &amp; ODS_SELECTED) <br>        { <br>            // Item has been de-selected -- remove frame <br>            crOldTextColor = pDC-&gt;SetTextColor (pODI-&gt;m_crText); <br>            CBrush br(GetSysColor (COLOR_WINDOW)); <br>            pDC-&gt;FillRect(&amp;lpDIS-&gt;rcItem, &amp;br); <br>        }             <br>         <br>        CRect rcText (lpDIS-&gt;rcItem); <br> <br>rcText.left += EXTRA_X; <br>        pDC-&gt;DrawText (strText, -1, rcText, DT_LEFT); <br>    } <br>     <br>    if ((lpDIS-&gt;itemState &amp; ODS_FOCUS) &amp;&amp; <br>        (lpDIS-&gt;itemAction &amp; (ODA_FOCUS | ODA_DRAWENTIRE))) <br>    { <br>        // Item has gotten the focus <br>        // DrawFocusRect (lpDIS-&gt;hDC, &amp;lpDIS-&gt;rcItem); <br>DrawFocusRect (lpDIS-&gt;hDC, rcSelection); <br>    } <br>     <br>    if (!(lpDIS-&gt;itemState &amp; ODS_FOCUS) &amp;&amp; <br>        (lpDIS-&gt;itemAction &amp; ODA_FOCUS)) <br>    { <br>        // Item has lost focus <br>        // DrawFocusRect (lpDIS-&gt;hDC, &amp;lpDIS-&gt;rcItem); <br>DrawFocusRect (lpDIS-&gt;hDC, rcSelection); <br>    } <br>                               <br>// Cleanup <br>if (pODI-&gt;m_dwFlags &amp; ODI_BOLDTEXT) <br>{ <br>pDC-&gt;SelectObject (pOldFont); <br>fnBold.DeleteObject(); <br>} <br> <br>    if ( (lpDIS-&gt;itemAction &amp; ODA_DRAWENTIRE) || (lpDIS-&gt;itemAction &amp; ODA_SELECT) ) <br>    { <br>        if (lpDIS-&gt;itemState &amp; ODS_SELECTED) <br>        {                               <br>            pDC -&gt; SetBkColor(crOldBkColor); <br>            pDC -&gt; SetTextColor(crOldTextColor); <br>        } <br>        else <br>        { <br>            // Item has been de-selected -- remove frame <br>            pDC -&gt; SetTextColor(crOldTextColor); <br>        } <br>    }        <br>} <br> </code></pre>
<p>&nbsp;</p></body>
</HTML>
