<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Device Driver Loading</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>Device Driver Loading </H3><P>The IOS loads and initializes port drivers, miniport drivers, and value-added drivers. The IOS requires the files for these drivers to be located in the SYSTEM\IOSUBSYS directory and to have the following filename extensions: </P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="144pt" VALIGN="TOP"><COL WIDTH="204pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P><B>Extension </B></P></TD><TD VALIGN="TOP"><P><B>Description </B></P></TD></TR><TR><TD VALIGN="TOP"><P>PDR </P></TD><TD VALIGN="TOP"><P>Port drivers, such as SCSIPORT, ESDI_506, and NEC </P></TD></TR><TR><TD VALIGN="TOP"><P>MPD </P></TD><TD VALIGN="TOP"><P>SCSI miniport drivers </P></TD></TR><TR><TD VALIGN="TOP"><P>VXD </P></TD><TD VALIGN="TOP"><P>Value-added drivers, such as the volume tracker and vendor-supplied drivers </P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>
<P>The SYSTEM\IOSUBSYS directory is reserved for device drivers that are specifically designed for use with the IOS. Clients or virtual devices that use IOS services but are not specifically designed for the IOS should be stored in other directories and explicitly loaded using <B>device</B> entries in the SYSTEM.INI file. </P>
<P>The IOS loads a given port or miniport driver only if the configuration manager sends a request to load that driver. The configuration manager sends a request if its hardware detection code locates an adapter. Currently, the configuration manager can detect the IDE and AHA154x SCSI adapters only. To support other adapters, the configuration manager forces the IOS to load all remaining miniport drivers. These drivers remain loaded only if they locate an adapter they can support. In general, any port driver that fails to locate hardware that it can support will be unloaded. </P>
<P>When the IOS loads a port driver, it carries out these steps: </P>
<P>    1    Loads and initializes the port driver. The port driver must be present in the SYSTEM\IOSUBSYS directory. </P>
<P>    2    Loads all value-added drivers (files having the .VXD extension) that are not already loaded from the SYSTEM\IOSUBSYS directory. </P>
<P>    3    Initializes and configures the value-added drivers. If a value-added driver has not been previously loaded, the IOS initializes it by sending the SYS_DYNAMIC_DEVICE_INIT message. Otherwise, the IOS sends the driver an AEP_CONFIG_DCB function for each <B>DCB</B> created by the corresponding port driver. </P>
<P></P>
<P>To load a port or value-added driver, the IOS calls the <B>VXDLDR_LoadDriver</B> service (provided by the VxD loader) to load the driver. The IOS extracts the address of the driver's <B>DRP</B> structure from the <B>DDB_Reference_Data</B> member of the <B>VxD_Desc_Block</B> structure returned by this service. (You set this member when writing the device driver by specifying the <B>DRP</B> structure in the <B>Declare_Virtual_Device</B> statement.) The IOS uses the load group value (in the <B>DRP_LGN</B> member) to prepare for initialization of the driver. The load group identifies the layer at which the driver operates and needs initialization for. For example, the load group number (lgn) specifies the order in which the IOS initializes and configures the value-added drivers. In most cases, a driver sets a single bit in this member, but some drivers operate at several layers and must set multiple bits. </P>
<P>Although the <B>DRP_eyecatch_str</B>, <B>DRP_ascii_name</B>, <B>DRP_create_date</B>, and <B>DRP_create_time</B> members are not used during driver loading, a driver should set these members to valid values. Most drivers set all other members in the structure to zero. </P>
<P>See also <B>DRP</B> </P></FONT></BODY></HTML>
