<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Run-Time Dynamic Device Loading</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>Run-Time Dynamic Device Loading </H3><P>Plug and Play permits devices to be loaded dynamically after the system is already running. The following list shows how this process occurs: </P>
<P>    1.      An enumerator detects the addition of a device to the system and calls Configuration Manger to reenumerate its own device node, using <B>CONFIGMG_Reenumerate_DevNode</B> as follows: </P>
<P><BR></P>
<PRE>CM_Reenumerate_DevNode(DevNode, 0);
</PRE>
<P>    2    <B>CONFIGMG_Reenumerate_DevNode</B> causes Configuration Manager to call back the enumerator at application time. When called back, the enumerator detects the new hardware and constructs a device ID (for example, PCMCIA\3C08AF\0). The enumerator creates a new child device node with this ID and returns from the enumeration function. </P>
<P>    3    Configuration Manager uses the device ID to determine which key in the registry to inspect. In this example, Configuration Manager will look in HARDWARE\ENUM\PCMCIA\3C08AF\0\DRV\, where it will find DEVLOADER=NetWrap.386. If this VxD is not already loaded, Configuration Manager dynamically loads NetWrap.386. </P>
<P>    4    Once the device loader is available, Configuration Manager sends a system control call to the network wrapper, passing it the device node for which it is the device loader, as follows: </P>
<P><BR></P>
<PRE>DirectedSysCtrl("NetWrap", PNP_NEW_DEVNODE, DEVLOADER, pdnNew)
</PRE>
<P>    5    NetWrap registers as the enumerator for this node, and then examines the registry to find the appropriate NDIS driver to load. In our example, NetWrap would find </P>
<P><BR></P>
<PRE>SYSTEM\CurrentControlSet\Services\Class\PCMCIA
&lt; NdisDriver=XYZ.VXD
</PRE>
<P>    6    Once loaded, XYZ.VXD registers as the device driver for the device node, forcing Configuration Manager to assign resources to it. Configuration Manager informs the NDIS driver of the assigned configuration, thus enabling the network adapter. </P>
<P></P></FONT></BODY></HTML>
