<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Call_Priority_VM_Event</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>Call_Priority_VM_Event </H3><P><BR></P>
<PRE>include vmm.inc

mov     eax, PriorityBoost
mov     ebx, VMHandle
mov     ecx, Flags
mov     edx, RefData
mov     esi, OFFSET32 PriorityEventCallback
mov     edi, TimeOut
VMMcall Call_Priority_VM_Event
mov     [EventHandle], esi
</PRE>
<P>Calls the callback function immediately or schedules a priority event for the specified virtual machine. This is an asynchronous service. Uses Flags and ESI. </P>
<UL><LI>     Returns zero in ESI if the callback function was called immediately. Otherwise, returns the event handle in ESI. The handle can be used in a subsequent call to the Cancel_Priority_VM_Event service to cancel the event. </LI></UL><P></P>
<P><I>PriorityBoost</I> </P>
<P>Priority boost for the virtual machine. This parameter must be a value such that when added to the current execution priority, the result is within the range Reserved_Low_Boost to Reserved_High_Boost. This parameter can be 0 if no boost is necessary. Common priority boost values, from lowest to highest, are as follows: </P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="144pt" VALIGN="TOP"><COL WIDTH="190pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P><B>Value </B></P></TD><TD VALIGN="TOP"><P><B>Meaning </B></P></TD></TR><TR><TD VALIGN="TOP"><P>Reserved_Low_Boost </P></TD><TD VALIGN="TOP"><P>Reserved for use by system. </P></TD></TR><TR><TD VALIGN="TOP"><P>Cur_Run_VM_Boost </P></TD><TD VALIGN="TOP"><P>Use to boost the priority of each virtual machine, in turn, forcing them to run for their allotted time slices. </P></TD></TR><TR><TD VALIGN="TOP"><P>Low_Pri_Device_Boost </P></TD><TD VALIGN="TOP"><P>Use for operations that need timely processing but are not time critical. </P></TD></TR><TR><TD VALIGN="TOP"><P>High_Pri_Device_Boost </P></TD><TD VALIGN="TOP"><P>Use for time-critical operations that should not circumvent the critical section boost. </P></TD></TR><TR><TD VALIGN="TOP"><P>Critical_Section_Boost </P></TD><TD VALIGN="TOP"><P>Use to boost the priority of the virtual machine whenever it enters a critical section (calls <B>Begin_Critical_Section)</B>. </P></TD></TR><TR><TD VALIGN="TOP"><P>Time_Critical_Boost </P></TD><TD VALIGN="TOP"><P>Use for operations that require immediate processing, even when another virtual machine is in a critical section. For example, VPICD uses this when simulating hardware interrupts. </P></TD></TR><TR><TD VALIGN="TOP"><P>Reserved_High_Boost </P></TD><TD VALIGN="TOP"><P>Reserved for use by system. </P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>
<P>Forgetting to pass a priority value in the EAX register is a common error. </P>
<P><I>VMHandle</I> </P>
<P>Handle of the virtual machine to process the event. This value must be a valid VM handle. </P>
<P><I>Flags</I> </P>
<P>A combination of these action flags: </P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="144pt" VALIGN="TOP"><COL WIDTH="190pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P><B>Value </B></P></TD><TD VALIGN="TOP"><P><B>Meaning </B></P></TD></TR><TR><TD VALIGN="TOP"><P>PEF_Always_Sched </P></TD><TD VALIGN="TOP"><P>Event is always scheduled, meaning the callback function is never called immediately. </P></TD></TR><TR><TD VALIGN="TOP"><P>PEF_Dont_Unboost </P></TD><TD VALIGN="TOP"><P>Priority of the virtual machine is not reduced after return from callback function. </P></TD></TR><TR><TD VALIGN="TOP"><P>PEF_Time_Out </P></TD><TD VALIGN="TOP"><P>Specifies that time-out value in the EDI register should be used. Available in Windows version 3.1 or later. </P></TD></TR><TR><TD VALIGN="TOP"><P>PEF_Wait_For_STI </P></TD><TD VALIGN="TOP"><P>Callback function is not called until the virtual machine enables interrupts in all threads. </P></TD></TR><TR><TD VALIGN="TOP"><P>PEF_Wait_Not_Crit </P></TD><TD VALIGN="TOP"><P>Callback function is not called until the virtual machine is not in a critical section or time-critical operation. </P></TD></TR><TR><TD VALIGN="TOP"><P>PEF_Wait_Not_Time_Crit, PEF_Wait_Not_HW_Int </P></TD><TD VALIGN="TOP"><P>Callback function is not called until the thread priority is below TIME_CRITICAL_BOOST. Useful to prevent an event from occurring while an interrupt is being simulated into a VM. </P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>
<P>All other values are reserved. </P>
<P><I>RefData</I> </P>
<P>Reference data to pass to the callback function. </P>
<P><I>EventCallback</I> </P>
<P>Address of the callback function to install. For more information about the callback function, see <B>PriorityEventCallback</B>. </P>
<P><I>TimeOut</I> </P>
<P>Number of milliseconds until the event times out. The service uses this parameter only if the PEF_Time_Out value is specified by <I>Flags</I>. </P>
<P>The system carries out a task switch to the specified virtual machine if it is not the current virtual machine. If <I>PriorityBoost</I> is not zero, the service boosts the priority of the virtual machine before calling the callback function. </P>
<P>If the amount of time specified by <I>TimeOut</I> elapses before the system can switch to the virtual machine, the system sets the carry flag and calls the callback function immediately regardless of which virtual machine is currently running. In this case, any requested priority boost is canceled even if <I>Flags</I> specified the PEF_Dont_Unboost value. The callback function should always check the carry flag to determine whether a time out occurred. </P>
<P>For additional information about event callbacks, see <I>Event Callbacks</I>. </P>
<P>See also <B>Adjust_Exec_Priority</B>, <B>Begin_Critical_Section</B>, <B>Call_When_Not_Critical</B>, <B>Call_VM_Event</B>, <B>Cancel_Priority_VM_Event</B>, <B>PriorityEventCallback</B> </P>
<P></P>
<P></P></FONT></BODY></HTML>
