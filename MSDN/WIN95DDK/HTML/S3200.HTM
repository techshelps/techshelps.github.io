<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>_MapPhysToLinear</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>_MapPhysToLinear </H3><P><BR></P>
<PRE>include vmm.inc

VMMcall _MapPhysToLinear, &lt;PhysAddr, nBytes, flags&gt;

cmp     eax, 0FFFFFFFFh     ; 0FFFFFFFFh if not addressable
je      not_addressable
mov     [Address], eax      ; address of first byte
</PRE>
<P>Returns the linear address of the first byte in the specified range of physical addresses. Uses EAX, ECX, EDX and Flags. </P>
<UL><LI>     Returns the ring-0 linear address of the first byte of the physical region, if successful. The EAX register contains 0FFFFFFFFh if the specified range is not addressable. </LI></UL><P></P>
<P><I>PhysAddr</I> </P>
<P>32-bit physical address of the start of the region to examine. Physical addresses start at 0, thus the address of physical page 0A0h is 0A0000h. </P>
<P><I>nBytes</I> </P>
<P>Length of the physical region, in bytes. The service uses this parameter to verify that the entire range is addressable. </P>
<P><I>flags</I> </P>
<P>Operation flags. Must be zero. </P>
<P>This service is intended to be used to examine device-specific physical memory. Virtual devices must <I>not</I> use this service for any other purpose. </P>
<P>Because physical addresses do not move, the linear address returned by this service remains valid until the system is shut down. Virtual devices should be careful not to use this service in a manner that wastes linear address space. </P>
<P>The following example returns a linear address for 64 kilobytes of memory starting at the physical page 0A0h: </P>
<P><BR></P>
<PRE>VMMcall _MapPhysToLinear,&lt;0A0000h,10000h,0&gt;
</PRE>
<P>Since physical memory is mapped contiguously, the linear address for page 0A1h is 4096 bytes beyond the return linear address. Note, however, that no information can be concluded about the linear addresses for physical pages 9Fh or 0B0h, because they lie outside the 64KB range requested. If a virtual device needs linear address aliases for those pages, it must call <B>_MapPhysToLinear</B> separately for those pages. </P>
<P></P>
<P></P></FONT></BODY></HTML>
