<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Using the Message Buffer</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>Using the Message Buffer </H3><P>The following example shows how to use the message buffer: </P>
<P><BR></P>
<PRE>MyGenerateMesage(HIMC hIMC, UINT msg, WPARAM wParam, LPARAMlParam)
{
    LPINPUTCONTEXT lpIMC;
    HGLOBAL hTemp;
    LPDWORD lpdwMsgBuf;
    DWORD dwMyNumMsg = 1;

    // Lock the input context.
    lpIMC = ImmLockIMC(hIMC);
    if (!lpIMC)
        // Error!

    // re-allocate the memory bloack for the message buffer.
    hTemp = ImmReSizeIMCC(lpIMC-&gt;hMsgBuf, 
        (lpIMC-&gt;dwNumMsgBuf + dwMyNumMsg) * sizeof(DWORD) * 3);
    if (!hTemp)
        // Error!

    lpIMC-&gt;hMsgBuf = hTemp;

    // Lock the memory for the message buffer.
    lpdwMsgBuf = ImmLockIMCC(lpIMC-&gt;hMsgBuf);
    if (!lpdwMsgBuf)
        // Error!

    lpdwNumMsgBuf += 3 * lpIMC-&gt;dwNumMsgBuf.
    // Set the number of the messages.
    lpIMC-&gt;dwNumMsgBuf += dwMyNumMsg;

    // Set the messages that the IME needs to generate.
    *lpdwMsgBuf++ = (DWORD) msg;
    *lpdwMsgBuf++ = (DWORD) wParam;
    *lpdwMsgBuf++ = (DWORD) lParam;

    // Unlock the memory for the message buffer and the input context.
    ImmUnlockIMCC(lpIMC-&gt;hMsgBuf);
    ImmLockIMC(hIMC);

    // Call ImmGenerateMessage function.
    ImmGenerateMessage(hIMC);
}
</PRE></FONT></BODY></HTML>
