<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Initialization</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>Initialization </H3><P>Dynamically loadable VxDs do not receive SYS_CRITICAL_INIT, DEVICE_INIT, or INIT_COMPLETE messages. Instead, their control procedure is sent a SYS_DYNAMIC_DEVICE_INIT message when the device is being initialized and a SYS_DYNAMIC_DEVICE_EXIT message when the VxD is being unloaded. (The control procedure has the option of rejecting either the load or the unload request.) </P>
<P>A VxD that processes all 5 of these messages can be both dynamically loadable and static. </P>
<P>When a dynamically loadable VxD receives the SYS_DYNAMIC_DEVICE_EXIT message it should release any resources and hooks it has acquired. No cleanup is performed by the services that unload the device. For example, if the VxD is using the <B>Hook_V86_Int_Chain</B> and <B>Call_When_Idle</B> VMM services, it should call the <B>Unhook_V86_Int_Chain</B> and <B>Cancel_Call_When_Idle</B> services when it receives SYS_DYNAMIC_DEVICE_EXIT. </P>
<P>If a VxD or its initialization module specifies zero for the <I>Flags</I> parameter of the <B>VXDLDR_LoadDevice</B> function it must handle its own initialization. In this case, it should use the <B>VXDLDR_DevInitSucceeded</B> or <B>VXDLDR_DevInitFailed</B> service to inform the system of the initialization's outcome. If the initialization succeeds, the initialization module should send the SYS_DYNAMIC_DEVICE_INIT message to the VxD. (If VXDLDR_INIT_DEVICE is specified for the <I>Flags</I> parameter, the system does this work for you.) </P>
<P>When creating a dynamically loadable VxD, the InitOrder parameter of the <B>Declare_Virtual_Device</B> macro specifies the position of the VxD in the VMM's internal list of loaded devices. </P></FONT></BODY></HTML>
