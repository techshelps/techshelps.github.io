<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Log_Fault_Call_Out</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>Log_Fault_Call_Out </H3><P><BR></P>
<PRE>include vmm.inc

mov     edi, ThreadHandle
mov     esi, FaultNumber
mov     eax, OFFSET32 EventProc
mov     edx, UpperStackLimit
mov     ebp, FrameClient_Regs
VMMcall Log_Fault_Call_Out
jnc     not_handled
</PRE>
<P>This is a callout service that the VMM calls when it is about to report a fault to the user. It is provided so that a supplemental VxD can hook this service and log faults that are reported. The supplemental VxD can also handle the fault notification itself and indicate to the VMM that it shouldn't duplicate the notification. Virtual deices should not call this service directly. </P>
<UL><LI>     Sets the carry flag if the notification has been handled, indicating that the VMM should not do its own notification. </LI></UL><P></P>
<P><I>VMHandle</I> </P>
<P>Handle of the current virtual machine. </P>
<P><I>FaultNumber</I> </P>
<P>Number of the fault to report. </P>
<P><I>FrameClient_Regs</I> </P>
<P>Ring 0 client registers of the fault stack frame. </P>
<P><I>EventProc</I> </P>
<P>Address of the event procedure for the event being processed, address of the timeout procedure associated with the timeout being processed, or zero if neither an event nor a timeout was processed. </P>
<P><I>UpperStackLimit</I> </P>
<P>Upper limit of stack used by event being processed, or garbage if neither an event nor a timeout was processed. </P>
<P>Before calling this service (that is, on entry to the hook procedure), the stack looks like this: </P>
<P><BR></P>
<PRE>esp    &lt;undefined area between the current ESP and EBP-16&gt;
ebp-16  -&gt; saved gs
ebp-12  -&gt; saved fs
ebp-8   -&gt; saved es
ebp-4   -&gt; saved ds
ebp     -&gt; pushad frame
        -&gt; error code
        -&gt; faulting eip
        -&gt; faulting cs
        -&gt; flags
edx     -&gt; upper limit of stack used by event being processed
</PRE>
<P>Notifications can not be suppressed if the fault was not caused by an event or timeout. </P>
<P>This service can modify any of the registers </P>
<P></P>
<P></P></FONT></BODY></HTML>
