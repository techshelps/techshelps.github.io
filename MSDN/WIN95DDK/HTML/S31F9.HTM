<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Simulate_IO</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>Simulate_IO </H3><P><BR></P>
<PRE>include vmm.inc

mov     eax, Data          ; data for output operations
mov     ebx, VM            ; current VM handle
mov     ecx, IOType        ; type of I/O operation
mov     edx, Port          ; I/O port number
mov     ebp, OFFSET32 crs  ; address of Client_Reg_Struc
VMMjmp  Simulate_IO

mov     [Data], eax        ; data for input operation
</PRE>
<P>Reduces complex I/O instructions to simpler I/O operations. An I/O callback procedure typically jumps to this service whenever the procedure receives a type of I/O that it does not directly support. Uses EAX, EBX, ECX, EDI, EDX, ESI, Flags. </P>
<UL><LI>     Returns with the input data in the EAX register, if the IOType parameter specifies an input operation. The size of the value in the EAX register is implied by the operation type. </LI></UL><P></P>
<P><I>Data</I> </P>
<P>Data for an output operation. This parameter is used only if the <I>IOType</I> parameter specifies an output operation. </P>
<P><I>VM</I> </P>
<P>Handle of the current virtual machine. </P>
<P><I>IOType</I> </P>
<P>Type of I/O operation, as specified in a call to an I/O trap procedure. Can be one or more of these values: </P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="144pt" VALIGN="TOP"><COL WIDTH="190pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P><B>Value </B></P></TD><TD VALIGN="TOP"><P><B>Meaning </B></P></TD></TR><TR><TD VALIGN="TOP"><P>Addr_32_IO </P></TD><TD VALIGN="TOP"><P>Uses 32-bit address offsets for input or output string operations. If this value is not given, the 16-bit offsets are used. </P></TD></TR><TR><TD VALIGN="TOP"><P>Byte_Input </P></TD><TD VALIGN="TOP"><P>Inputs a single byte; place in AL if String_IO is not given. </P></TD></TR><TR><TD VALIGN="TOP"><P>Byte_Output </P></TD><TD VALIGN="TOP"><P>Outputs a single byte from AL if String_IO is not given. </P></TD></TR><TR><TD VALIGN="TOP"><P>Dword_Input </P></TD><TD VALIGN="TOP"><P>Inputs a doubleword; place in EAX if String_IO is not given. </P></TD></TR><TR><TD VALIGN="TOP"><P>Dword_Output </P></TD><TD VALIGN="TOP"><P>Outputs a doubleword from EAX if String_IO is not given. </P></TD></TR><TR><TD VALIGN="TOP"><P>Rep_IO </P></TD><TD VALIGN="TOP"><P>Repeats the input or output string operation the number of times specified by the <B>Client_CX</B> field in the <B>Client_Reg_Struc</B> structure. (The number of repetitions is stored in the <B>Client_ECX</B> field if Addr_32_IO is also set.) </P></TD></TR><TR><TD VALIGN="TOP"><P>Reverse_IO </P></TD><TD VALIGN="TOP"><P>Decrements string address on each input or output operation. If this value is not given, the string address is incremented on each operation. </P></TD></TR><TR><TD VALIGN="TOP"><P>String_IO </P></TD><TD VALIGN="TOP"><P>Inputs or outputs a string. The high 16-bits specifies the segment address of the buffer containing the string to output, or to receive the string input. </P></TD></TR><TR><TD VALIGN="TOP"><P>Word_Input </P></TD><TD VALIGN="TOP"><P>Inputs a word; place in AX if String_IO is not given. </P></TD></TR><TR><TD VALIGN="TOP"><P>Word_Output </P></TD><TD VALIGN="TOP"><P>Outputs a word from AX if String_IO is not given. </P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>
<P><I>Port</I> </P>
<P>Number of the I/O port through which to carry out the operation. If word I/O is requested, then Port+1 is also used. If dword I/O is requested, then Port+1 through Port+3 are also used. </P>
<P><I>crs</I> </P>
<P>Address of a <B>Client_Reg_Struc</B> structure containing the register contents for the current virtual machine. </P>
<P>The parameters to this service are identical to the parameters passed to an I/O callback procedure. A callback procedure should jump to this service, using the <B>VMMjmp</B> macro, with all of the registers in the same state as when the procedure was called. The procedure may modify the ESI and EDI register before jumping, if necessary. </P>
<P>See also <B>Dispatch_Byte_IO</B>, <B>Emulate_Non_Byte_IO</B> </P>
<P></P>
<P></P></FONT></BODY></HTML>
