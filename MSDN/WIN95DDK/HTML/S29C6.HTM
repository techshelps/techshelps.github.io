<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Adding Speaker Phone Support</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>Adding Speaker Phone Support </H3><P>If your voice modem offers speaker phone support, you can add up to six different keys to the registry to direct the way Unimodem/V uses the speaker phone built into your modem. For example, here are the six keys from SMPVOICE.INF: </P>
<P><BR></P>
<PRE>   HKR,, SpeakerPhoneSpecs,       1, 00,00,00,00,  0f,00,00,00,  03,00,00,00,  00,00,00,00
   HKR, SpeakerPhoneEnable,       1,, "at#vls=5cr"
   HKR, SpeakerPhoneDisable,      1,, "at#vls=0cr"
   HKR, SpeakerPhoneMute,         1,, "at#spk=0,,,cr"
   HKR, SpeakerPhoneUnMute,       1,, "at#spk=1,,,cr"
   HKR, SpeakerPhoneSetVolumeGain,1,, "at#spk=,&lt;Vol&gt;,&lt;Gain&gt;cr"

</PRE>
<P>You must add a SpeakerPhoneSpecs key, even if all four values are 0. Unimodem/V uses the four values in the SpeakerPhoneSpecs key to determine the minimum and maximum speaker phone volumes, as well as the minimum and maximum gain, to use with your speaker phone hardware. Details of the four values to put in the key are in REG.DOC. The example values used in SMPVOICE.INF is </P>
<P><BR></P>
<PRE>   HKR,, SpeakerPhoneSpecs,       1, 00,00,00,00,  0f,00,00,00,  03,00,00,00,  00,00,00,00

</PRE>
<P>Unimodem/V uses the SpeakerSetVolumeGain key values to scale the speaker phone volume and gain when TAPI passes Unimodem/V a speaker volume setting, based on the values you put in the SpeakerPhoneSpecs key. Notice in the example SpeakerPhoneSpecs value above, the speaker gain values show an attenuation method, because the minimum speaker gain value (0x00000003) is greater than the maximum speaker gain value (0x00000000). Note also that both speaker volume and gain get reset each time Unimodem/V uses SpeakerPhoneSetVolumeGain command. </P>
<P>Set the values of the SpeakerPhoneEnable, SpeakerPhoneDisable, SpeakerPhoneMute, and SpeakerPhoneUnMute keys to the command strings Unimodem/V can send to your voice modem to accomplish those functions. </P>
<P>The relationship between the speaker phone commands you put into the registry for Unimodem/V to use is shown in the following state transition diagram. The Voice Connected (VCON) state can be entered when Unimodem/V sends to the modem either the command string in the VoiceAnswer key or the command string in the VoiceDialNumberSetup key. </P>
<P>The following conventions are used in the illustration: </P>
<P> Italics = Registry key </P>
<P> Bold caps = State name </P>
<P> Underline = TAPI or MMSystem function called to cause state change </P>
<P> Non-bold caps = Parameters for TAPI functions </P>
<P>The state transition diagram shows the TAPI functions called, and their parameters, when Unimodem/V performs the commands stored in the SpeakerPhoneSetVolumeGain, SpeakerPhoneMute, and SpeakerPhoneUnmute registry keys. The TAPI and MMSystem functions Unimodem/V calls when it performs the other commands shown in the state transition diagram are summarized in the following table. </P>

<TABLE COLS="3" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="100pt" VALIGN="TOP"><COL WIDTH="115pt" VALIGN="TOP"><COL WIDTH="129pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P><B>Registry Key Holding Command </B></P></TD><TD VALIGN="TOP"><P><B>TAPI or MMSystem Function Called </B></P></TD><TD VALIGN="TOP"><P><B>Parameter(s) </B></P></TD></TR><TR><TD VALIGN="TOP"><P>SpeakerPhoneEnable </P></TD><TD VALIGN="TOP"><P>phoneSetHookSwitchState </P></TD><TD VALIGN="TOP"><P>PHONESETHOOKSWITCHDEV_SPEAKER PHONESETHOOKSWITCHMODE_MICSPEAKER or PHONESETHOOKSWITCHMODE_SPEAKER </P></TD></TR><TR><TD VALIGN="TOP"><P>LineSetPlayFormat then StartPlay </P></TD><TD VALIGN="TOP"><P>waveOutOpen </P></TD><TD VALIGN="TOP"><P></P></TD></TR><TR><TD VALIGN="TOP"><P>SpeakerPhoneDisable </P></TD><TD VALIGN="TOP"><P>phoneSetHookSwitchState </P></TD><TD VALIGN="TOP"><P>PHONESETHOOKSWITCHDEV_SPEAKER PHONESETHOOKSWITCHMODE_ONHOOK </P></TD></TR><TR><TD VALIGN="TOP"><P>TerminatePlay </P></TD><TD VALIGN="TOP"><P>WaveOutClose </P></TD><TD VALIGN="TOP"><P></P></TD></TR><TR><TD VALIGN="TOP"><P>AbortPlay then StopPlay </P></TD><TD VALIGN="TOP"><P>WaveOutClose </P></TD><TD VALIGN="TOP"><P></P></TD></TR><TR><TD VALIGN="TOP"><P>HangUp </P></TD><TD VALIGN="TOP"><P>lineDrop </P></TD><TD VALIGN="TOP"><P></P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P></FONT></BODY></HTML>
