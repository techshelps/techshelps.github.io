<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>WNetUseConnection</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>WNetUseConnection </H3><P>This function is used to establish a connection to a network object, especially for browsing . The function may optionally prompt the user for login or authentication. The connection is usually on a redirected local drive or a reference counted session (in which case this call increments the reference count to the session), although for some networks it may be on a non-reference counted session that does not have a local device redirection. See <B>WNetCancelConnection2</B> for details on cancelling the connection </P>
<P>In addition, for file and disk resources, this API can return a name for the connection that can be pre-pended to file system requests on the network resource (e.g. "\\server\share" or "F:"). This enables directory service lookup. The API can also auto-pick a local device for redirecting local devices to networks that require local device redirection. </P>
<P><BR></P>
<PRE>DWORD WNetUseConnection(
    HWND hwndOwner,
    LPNETRESOURCE lpNetResource,
    LPTSTR lpPassword,
    LPTSTR lpUserID,
    DWORD dwFlags,
    LPTSTR lpAccessName,
    LPDWORD lpBufferSize,
    LPDWORD lpResult
    );
</PRE>
<P><I>hwndOwner</I> </P>
<P>A handle to a window which should be the owner for any messages or dialogs the network provider might display. This is used if CONNECT_INTERACTIVE is set. </P>
<P><I>lpNetResource</I> </P>
<P>Specifies the network resource to connect to. This structure is defined the section describing Enumeration APIs. The following fields must be set when making a connection, the others are ignored. </P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="144pt" VALIGN="TOP"><COL WIDTH="190pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P><I>lpRemoteName</I> </P></TD><TD VALIGN="TOP"><P>Specifies the network resource to connect to. </P></TD></TR><TR><TD VALIGN="TOP"><P><I>lpLocalName</I> </P></TD><TD VALIGN="TOP"><P>Pointer to a buffer that specifies the local device name that is to be redirected, such as "F:" or "LPT1". </P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>The string is treated in a case insensitive manner, and may be the empty string (or NULL) in which case either a connection to the network resource is made without making a redirection or, if CONNECT_REDIRECT is set or the network requires a redirected local device and none is specified a redirection is picked by the system which is returned in <I>lpAccessName</I>. </P></TD></TR><TR><TD VALIGN="TOP"><P><I>lpProvider</I> </P></TD><TD VALIGN="TOP"><P>Specifies the NP to connect to. If NULL or empty string, Windows will try each NP in turn. The caller should set <I>lpProvider </I>only if it knows for sure which network it wants. Otherwise, it is preferable to let Windows determine which NP the network name maps to. If this is non NULL, Windows will try the named NP and no other. </P></TD></TR><TR><TD VALIGN="TOP"><P><I>dwType</I> </P></TD><TD VALIGN="TOP"><P>Specifies the type of resource to connect to. It is most efficient to use a specific resource type (RESOURCETYPE_DISK or RESOURCETYPE_PRINT). It may be RESOURCETYPE_ANY if <I>lpLocalName</I> is the empty string and CONNECT_REDIRECT is not set. </P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>
<P><I>lpPassword</I> </P>
<P>Specifies the password to be used in making the connection, normally the password associated with <I>lpUserID</I>. A NULL value or string may be passed in to not specify the password. If the password is invalid or not specified, then the function tries to use the current default password. If this fails and CONNECT_INTERACTIVE is set, the function posts an appropriate dialog asking the user to type/retype the password. </P>
<P><I>lpUserID</I> </P>
<P>This specifies the identity of the user needed to make the connection. If NULL, a default will be applied. This is used when the user wishes to connect to a resource, but has a different user name or account assigned to him for that resource. This identification represents a security context, and is NP specific. </P>
<P>This user specific information is stored to be subsequently used in re-establishing the connection (using a non-default username or telephone number, for example). </P>
<P><I>dwFlags</I> </P>
<P>Any combination of the following bit values: </P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="144pt" VALIGN="TOP"><COL WIDTH="190pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>CONNECT_TEMPORARY </P></TD><TD VALIGN="TOP"><P>The connection is being established for browsing purposes. </P></TD></TR><TR><TD VALIGN="TOP"><P>CONNECT_INTERACTIVE </P></TD><TD VALIGN="TOP"><P>May have interaction with the user for authentication purposes. </P></TD></TR><TR><TD VALIGN="TOP"><P>CONNECT_PROMPT </P></TD><TD VALIGN="TOP"><P>Do no use any defaults for usernames or passwords without offering user the chance to supply an alternative. This flag is only valid if CONNECT_INTERACTIVE is set. </P></TD></TR><TR><TD VALIGN="TOP"><P>CONNECT_UPDATE_PROFILE </P></TD><TD VALIGN="TOP"><P>If the connection should be made persistent. If set, the connection is automatically restored every time the user starts up and logs on to the network. A connection is only made persistent if the connection was successful. This flag is only valid if <I>lpLocalName</I> specifies a local device to redirect, as otherwise it is ignored. </P></TD></TR><TR><TD VALIGN="TOP"><P>CONNECT_UPDATE_RECENT </P></TD><TD VALIGN="TOP"><P>If the connection should be put in the recent connection list. If set, and the connection is successfully added, it will be put in the recent connection list only if it has a redirected local device associated with it. </P></TD></TR><TR><TD VALIGN="TOP"><P>CONNECT_REDIRECT </P></TD><TD VALIGN="TOP"><P>If set, force the auto-picking of a local device for redirection when making the connection, otherwise only auto-pick a local device for redirection if the network requires it to make a connection. </P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>This flag is ignored if <I>lpLocalName</I> specifies a local device to redirect (since a redirection will always be attempted to the local device name specified in <I>lpLocalName</I>). Otherwise, setting this flag is invalid if either <I>lpAccessName</I> does not point to a return buffer (since the caller will not readily know how to access the resource) or <I>dwType</I> is RESOURCETYPE_ANY. </P></TD></TR><TR><TD VALIGN="TOP"><P>CONNECT_CURRENT_MEDIA </P></TD><TD VALIGN="TOP"><P>If set, then do not start to use a new media to try to establish the connection (for example, do not initiate a new dial up connection). </P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>
<P><I>lpAccessName</I> </P>
<P>Points to a buffer to receive the name that can be used to make system requests on the connection. This conversion is useful for adding connections to aliased resources, such as through a directory service, and for autopicking of local devices for redirection. </P>
<P>If <I>lpLocalName</I> specifies a local device, then this buffer is optional, and if specified will have the local device name copied into it.Otherwise, if the network requires a local device redirection, or CONNECT_REDIRECT is set, then this buffer is required and the redirected local device is returned here. Otherwise, the name copied into the buffer is that of a remote resource, and if specified, this buffer must be at least as large as the string pointed to by <I>lpRemoteName</I>. </P>
<P><I>lpBufferSize</I> </P>
<P>This is used to specify the size of the <I>lpAccessName</I> buffer passed in. If the call fails because the buffer is not big enough, this location will be used to return the required buffer size. </P>
<P><I>lpResult</I> </P>
<P>Pointer to a DWORD in which is returned additional information about the connection. Currently has the following bit value: </P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="144pt" VALIGN="TOP"><COL WIDTH="190pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>CONNECT_REFCOUNT </P></TD><TD VALIGN="TOP"><P>The connection was made without using a local device redirection and is to a network that understands reference counted sessions. If this bit is not set, then calling <B>WNetCancelConnection2</B> will end the session and possibly interfere with other threads or processes that may be using the session. If this bit is set then calling <B>WNetCancelConnection2 </B>with CONNECT_REFCOUNT set in the <I>dwFlags</I> parameter will decrement the reference count to the connection and not interfere with other threads that are using the session. </P></TD></TR><TR><TD VALIGN="TOP"><P>CONNECT_LOCALDRIVE </P></TD><TD VALIGN="TOP"><P>If set, the connection was made using a local drive redirection. If <I>lpAccessName</I> points to a buffer then the local drive is copied to the buffer. </P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>
<UL><LI>     WN_SUCCESS if the call is successful. </LI></UL>
<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="144pt" VALIGN="TOP"><COL WIDTH="190pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>WN_CANCEL </P></TD><TD VALIGN="TOP"><P>the user cancelled the add connection attempt through some user interface. </P></TD></TR><TR><TD VALIGN="TOP"><P>WN_BAD_PROVIDER </P></TD><TD VALIGN="TOP"><P><I>lpProvider</I> does not match any NP. </P></TD></TR><TR><TD VALIGN="TOP"><P>WN_BAD_NETNAME </P></TD><TD VALIGN="TOP"><P><I>lpRemoteName</I> is not acceptable to any NP. </P></TD></TR><TR><TD VALIGN="TOP"><P>WN_BAD_LOCALNAME </P></TD><TD VALIGN="TOP"><P><I>lpLocalName</I> is invalid. </P></TD></TR><TR><TD VALIGN="TOP"><P>WN_BAD_PASSWORD </P></TD><TD VALIGN="TOP"><P>bad password and CONNECT_INTERACTIVE is not set. </P></TD></TR><TR><TD VALIGN="TOP"><P>WN_BAD_VALUE </P></TD><TD VALIGN="TOP"><P>one of the following: <I>lpRemoteName</I> is NULL; <I>lpRemoteName</I> is not NULL, and <I>lpBufferSize</I> is either NULL or points to zero; <I>dwType</I> is neither RESOURCETYPE_DISK nor RESOURCETYPE_PRINT, and either CONNECT_REDIRECT is set in <I>dwFlags</I> or <I>lpLocalName</I> is not NULL or the connection is to a network that requires a local device redirection to make a connection; </P></TD></TR><TR><TD VALIGN="TOP"><P>WN_BAD_POINTER </P></TD><TD VALIGN="TOP"><P><I>lpAccessName</I> does not point to a buffer and either CONNECT_REDIRECT is set in <I>dwFlags</I> or a connection is being attempted to a network that requires a local device redirection which is not specified in <I>lpLocalName</I>. </P></TD></TR><TR><TD VALIGN="TOP"><P>WN_MORE_DATA </P></TD><TD VALIGN="TOP"><P>the <I>lpAccessName </I>buffer is too small. If a local device is redirected, the buffer needs to large enough to contain the local device name. Otherwise the buffer needs to be large enough to contain either the string pointed to by <I>lpRemoteName</I> or the name of the connectable resource whose alias is pointed to by <I>lpRemoteName</I>. If this status is returned, then no connection has been made. </P></TD></TR><TR><TD VALIGN="TOP"><P>WN_NO_MORE_ENTRIES </P></TD><TD VALIGN="TOP"><P>a local redirection cannot be auto-picked because all of the valid local devices for the network are in use. </P></TD></TR><TR><TD VALIGN="TOP"><P>WN_NOT_AUTHENTICATED </P></TD><TD VALIGN="TOP"><P>the call failed because the connection requires additional authentication information (e.g., a username or a password), not provided by the caller or the user through a dialog. </P></TD></TR><TR><TD VALIGN="TOP"><P>WN_NOT_LOGGED_ON </P></TD><TD VALIGN="TOP"><P>a system logon needs to occur before a network connection can be added. </P></TD></TR><TR><TD VALIGN="TOP"><P>WN_ALREADY_CONNECTED </P></TD><TD VALIGN="TOP"><P><I>lpLocalName</I> is already connected to a network drive or is to a local drive that is already in use locally (e.g. is used for a hard drive or RAM drive). </P></TD></TR><TR><TD VALIGN="TOP"><P>WN_ACCESS_DENIED </P></TD><TD VALIGN="TOP"><P>access denied. </P></TD></TR><TR><TD VALIGN="TOP"><P>WN_CANNOT_OPEN_PROFILE </P></TD><TD VALIGN="TOP"><P>Unable to open the user profile to process persistent connections. </P></TD></TR><TR><TD VALIGN="TOP"><P>WN_BAD_PROFILE </P></TD><TD VALIGN="TOP"><P>The user profile is in an incorrect format. </P></TD></TR><TR><TD VALIGN="TOP"><P>WN_FUNCTION_BUSY </P></TD><TD VALIGN="TOP"><P>The MPR or NP is busy (possibly initializing). The caller should retry. </P></TD></TR><TR><TD VALIGN="TOP"><P>WN_NO_NETWORK </P></TD><TD VALIGN="TOP"><P>network is not present. </P></TD></TR><TR><TD VALIGN="TOP"><P>WN_NO_NET_OR_BAD_PATH </P></TD><TD VALIGN="TOP"><P>the operation could not be handled either because a network component is not started or the specified name could not be handled. </P></TD></TR><TR><TD VALIGN="TOP"><P>WN_EXTENDED_ERROR </P></TD><TD VALIGN="TOP"><P>a network specific error occurred. <B>WNetGetLastError</B> should be called to obtain a description of the error. </P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>
<P></P>
<P>See also <B>WNetCancelConnection2</B> </P>
<P></P>
<P></P></FONT></BODY></HTML>
