<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Floppy Disk Controller Arbitration in Windows95</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H2>Floppy Disk Controller Arbitration in Windows95 </H2><P>Another special topic in the block device documentation is floppy disk controller arbitration. Two floppy disk controller arbitration services are available to developers of backup software. </P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="174pt" VALIGN="TOP"><COL WIDTH="174pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P><B>Service </B></P></TD><TD VALIGN="TOP"><P><B>Description </B></P></TD></TR><TR><TD VALIGN="TOP"><P>VFBACKUP_Lock_NEC </P></TD><TD VALIGN="TOP"><P>This service is called by VxDs to obtain exclusive control of the system floppy controller. </P></TD></TR><TR><TD VALIGN="TOP"><P>VFBACKUP_Unlock_NEC </P></TD><TD VALIGN="TOP"><P>This service is called by VxDs to release exclusive control of the system floppy controller. </P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>
<P>Without using these services, real mode access gets detected by port access or DMA access from a VM When the system floppy controller sees real mode access, the VM that attempts direct access is locked. If another VM is already locked on, the system floppy controller ignores the latest attempt to lock. </P>
<P>The services <B>VFBACKUP_Lock_Nec</B> and <B>VFBACKUP_Unlock_Nec</B> claim and release the system floppy controller for a given VM. Unlike the case where the system floppy controller detects port access and gives the floppy to a VM, when these services are used, there will not be a timeout, and the floppy can only be released when the lock fails, or a Terminate VM comes for the locking VM. Note that when a VM is locked on, the application causing the lock is responsible for dealing with the BIOS Motor Off command. </P>
<P>Do not attempt to use the <B>VFBACKUP_Lock_Nec</B> service before the system floppy controller driver is initialized. Note that if the system floppy controller driver is not loaded and a Windows backup application (such as Fastback.386 and others) is loaded, then the VFBACKUP system is unloaded and the <B>VFBACKUP_Lock_Nec</B> and <B>VFBACKUP_Unlock_Nec</B> service requests will fail. The way to check whether the VFBACKUP system is loaded is to use a <B>VFBACKUP_GetVersion</B> service request. </P>
<P></P>
<P></P></FONT></BODY></HTML>
