<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Interrupt 2Fh Function 4000h</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>Interrupt 2Fh Function 4000h </H3><P><BR></P>
<PRE>mov ax, 4000h             ; Enable VM-Assisted Save/Restore
int 2fh

mov [ModesSupported], al  ; video modes supported while in background
</PRE>
<P>Enable VM-Assisted Save/Restore directs the virtual-display device (VDD) to notify the virtual machine (VM) application whenever the VDD needs to access the video hardware registers. The VDD returns a value specifying the number and type of video modes the VDD supports when the VM application is in the background. </P>
<P>A VM application calls this function during its initialization. </P>
<P>This function has no parameters. </P>
<UL><LI>     The return value is one of the following values, if successful. </LI></UL>
<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="144pt" VALIGN="TOP"><COL WIDTH="190pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P><B>Value </B></P></TD><TD VALIGN="TOP"><P><B>Meaning </B></P></TD></TR><TR><TD VALIGN="TOP"><P>01h </P></TD><TD VALIGN="TOP"><P>No modes virtualized in background. </P></TD></TR><TR><TD VALIGN="TOP"><P>02h </P></TD><TD VALIGN="TOP"><P>Only text modes virtualized in background. </P></TD></TR><TR><TD VALIGN="TOP"><P>03h </P></TD><TD VALIGN="TOP"><P>Only text and single-plane graphics modes virtualized. </P></TD></TR><TR><TD VALIGN="TOP"><P>04h </P></TD><TD VALIGN="TOP"><P>Only text, single-plane, and VGA multiplane graphics modes virtualized. </P></TD></TR><TR><TD VALIGN="TOP"><P>0FFh </P></TD><TD VALIGN="TOP"><P>All supported video modes virtualized. </P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>
<P>Otherwise, the function returns zero in the AL register if virtualization is not supported. </P>
<P></P>
<P>When a VM application calls this function, the VDD disables I/O trapping of unreadable registers. Thereafter, the VDD calls Save Video Register State and Restore Video Register State (Interrupt 2Fh Functions 4005h and 4006h) if it needs to access the video registers. The VM application must provide an appropriate interrupt handler to process these functions. </P>
<P>When an VM application calls this function, the VDD saves the current state of the video registers. The VDD uses this saved state later to restore video registers before it calls Notify Foreground Switch and Restore Video Register State (Interrupt 2Fh Functions 4002h and 4006h). </P>
<P>After a VM application calls Enable VM-Assisted Save/Restore, the VDD no longer saves video memory across screen switches; it becomes the application's responsibility to completely reinitialize video memory after a Notify Foreground Switch request. </P>
<P>See also Interrupt 2Fh Functions 4002h Notify Foreground Switch </P>
<P>See also Interrupt 2Fh Functions 4005h Save Video Register State </P>
<P>See also Interrupt 2Fh Functions 4006h Restore Video Register State </P>
<P></P>
<P></P></FONT></BODY></HTML>
