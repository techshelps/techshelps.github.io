<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>DOSMGR_Begin_V86_App</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>DOSMGR_Begin_V86_App </H3><P><BR></P>
<PRE>include vmm.inc
include dosmgr.inc

; Install a hook procedure
GetVxDServiceOrdinal eax, DOSMGR_Begin_V86_App
mov esi, OFFSET32 HookProc
VMMcall Hook_Device_Service

jc error
</PRE>
<P>This service is called internally by DOSMGR when a V86-mode application is about to begin execution. The application has been loaded and relocated, but its code has not yet been run. VxDs which wish to be notified of this activity must hook this service. VxDs must not call this service directly. The hook procedure must be a 4.0 Hook_Proc style procedure. </P>
<P>VxDs which monitor resources may wish to hook this service (and the corresponding <B>DOSMGR_End_V86_App</B>) in order to allocate and free resources for each MS-DOS-based application. To monitor Windows-based applications, VxDs should monitor the system control calls related to threads. </P>
<P>The system calls the hook procedure as follows: </P>
<P><BR></P>
<PRE>mov ebx, VMHandle
mov esi, HighLinearPSP
mov dx,  AppPSP
call HookProc
</PRE>
<P><I>VMHandle</I> </P>
<P>VM that performed the int 21h. </P>
<P><I>HighLinearPSP</I> </P>
<P>High linear address of the program segment prefix (PSP) of the application which is about to run. </P>
<P><I>AppPSP</I> </P>
<P>Segment value of the PSP of the application which is about to be run. </P>
<P>Any VxD which hooks this service must pass the call down to the previously-installed hook, preserving all registers (except Flags), even registers reserved for future use. </P>
<P>Do not assume that the high word of the EDX register will be zero. </P>
<P></P>
<P></P></FONT></BODY></HTML>
