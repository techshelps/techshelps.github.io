<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Protected-Mode Application Programming Interface</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>Protected-Mode Application Programming Interface </H3><P>The VCOMM protected-mode API (PM API) provides a set of functions that COMM.DRV calls to access communications resources. In general, Windows-based applications should use the communications functions in the Windows API. </P>
<P>Before calling any VxD's PM API, an application must determine the address to call by using Interrupt 2Fh Function 1684h (Get Device API Entry Point Address). The following example retrieves the calling address for the VCOMM PM API, and saves it in the 32-bit variable <B>_VCOMMCallAddr</B>. </P>
<P><BR></P>
<PRE>xor     di, di                           ;zero in DI
mov     es, di                           ;zero in ES
mov     ax, 1684h                        ;function number
mov     bx, VCOMM_Device_ID              ;device ID
int     2Fh                              ;get API entry point
mov     word ptr [_VCOMMCallAddr], di    ;segment in high-order word
mov     word ptr [_VCOMMCallAddr+2], es  ;offset in low-order word
</PRE>
<P>To call a PM API function, place the function number in AX and call the API entry point address. Parameters are placed in other registers or on the stack. Most of the PM API functions thunk to a corresponding client VxD service. </P>
<P>For PM API functions that return an error value, the error value is the low 16 bits of the error that would be returned by the <B>_VCOMM_GetLastError</B> service. That is, it is the low 16 bits of the <B>dwLastError</B> field of <B>_PortData</B>. </P>
<P>See also <B>_VCOMM_GetLastError</B>, <B>VCOMM_PM_API_cevt</B>, <B>VCOMM_PM_API_cevtget</B>, <B>VCOMM_PM_API_cextnfcn</B>, <B>VCOMM_PM_API_cFlush</B>, <B>VCOMM_PM_API_ctx</B>, <B>VCOMM_PM_API_EnableNotify</B>, <B>VCOMM_PM_API_OPENCOM</B>, <B>VCOMM_PM_API_ReadString</B>, <B>VCOMM_PM_API_SetCom</B>, <B>VCOMM_PM_API_SetMSRShadow</B>, <B>VCOMM_PM_API_Setup</B>, <B>VCOMM_PM_API_StaCom</B>, <B>VCOMM_PM_API_TrmCom</B>, <B>VCOMM_PM_API_WriteString</B> </P></FONT></BODY></HTML>
