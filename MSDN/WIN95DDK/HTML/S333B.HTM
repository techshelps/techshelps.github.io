<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Creating and Terminating Threads</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>Creating and Terminating Threads </H3><P>A virtual device can use the <B>VMMCreateThread</B> service to create a new thread in the system virtual machine. The new thread runs in protected mode at ring three. <B>VMMCreateThread</B> returns a handle identifying the new thread. The virtual device can use the handle in subsequent services which control the execution of the thread, such as <B>Adjust_Thread_Exec_Priority</B>. </P>
<P>Before creating the new thread, <B>VMMCreateThread</B> broadcasts the <B>Create_Thread</B> control message to all virtual devices in the system. A virtual device typically responds by allocating any structures it needs to support the thread. By setting the carry flag, a virtual device that cannot support the new thread can prevent the thread from being created. </P>
<P>After the new thread is created, <B>VMMCreateThread</B> broadcasts the <B>Thread_Init</B> control message to all virtual devices. This message passes the handle of the new thread to the virtual devices, and gives the devices an opportunity to perform initialization procedures that must take place in the context of the new thread. </P>
<P>A virtual device can use the <B>VMMTerminateThread</B> service to destroy a thread created by a previous call to <B>VMMCreateThread</B>. The <B>VMMTerminateThread</B> service will not destroy the initial thread of a virtual machine, nor will it destroy the currently executing thread. </P>
<P>Before terminating a thread, <B>VMMTerminateThread</B> broadcasts the <B>Terminate_Thread</B> control message to all virtual devices. When the thread is no longer being scheduled, the <B>Thread_Not_Executeable</B> control message is broadcast to all virtual devices. Finally, the <B>Destroy_Thread</B> control message is broadcast, signaling that it is safe for virtual devices to free resources associated with the thread. </P>
<P>See also <B>Adjust_Thread_Exec_Priority</B>, <B>Create_Thread</B>, <B>Destroy_Thread</B>, <B>Terminate_Thread</B>, <B>Thread_Not_Executeable</B>, <B>VMMCreateThread</B>, <B>VMMTerminateThread</B> </P></FONT></BODY></HTML>
