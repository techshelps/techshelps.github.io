<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>_SHELL_HookSystemBroadcast</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>_SHELL_HookSystemBroadcast </H3><P><BR></P>
<PRE>include shell.inc
VxDcall SHELL_HookSystemBroadcast, &lt;&lt;OFFSET32 pfnHandler&gt;, \
    dwRef, dwCallOrder&gt;
mov [Handle], eax  ; handle of broadcast callback procedure
</PRE>
<P>Installs a callback procedure into the broadcast notification chain. The chain monitors calls to the <B>_SHELL_BroadcastSystemMessage</B> service and to the Windows <B>BroadcastSystemMessage</B> function. Uses C calling conventions. </P>
<UL><LI>     Returns the handle of the installed callback procedure in the EAX register if successful. Otherwise, returns zero. </LI></UL><P></P>
<P><I>pfnHandler</I> </P>
<P>Address of the callback procedure. For more information about the procedure, see the comments below. </P>
<P><I>dwRef</I> </P>
<P>Reference data for the callback procedure. </P>
<P><I>dwCallOrder</I> </P>
<P>Call order. Must be zero for non-zero virtual devices. If more than one callback procedure is installed to monitor the broadcast service, the call order specifies the order in which the given callback procedure is called relative to the other callback procedures. Procedures with equal call orders are called in an unspecified (but consistent) order. </P>
<P>The system calls the callback procedure whenever a VxD calls the <B>_SHELL_BroadcastSystemMessage</B> service. The system calls the procedure using the C calling conventions as follows: </P>
<P><BR></P>
<PRE>VxDcall [pfnHandler], &lt;uMsg, wParam, lParam, dwRef&gt;
</PRE>
<P>The <I>uMsg</I> parameter is the message number and <I>wParam</I> is the 16-bit message parameter. For both <I>uMsg</I> and <I>wParam</I>, the low 16 bits contain the parameter value and the high 16 bits are reserved. The <I>lParam</I> parameter is the 32-bit message parameter and <I>dwRef</I> is the same reference data value passed to <B>_SHELL_HookSystemBroadcast</B>. </P>
<P>The return value from the callback procedure is ignored if the broadcast is not a BSF_QUERY. Otherwise, the procedure should return a nonzero value to allow the broadcast to continue, or zero to fail the message and halt the broadcast. The procedure should return 1 for any messages it does not understand. </P>
<P>If the callback procedure is installed while a broadcast in progress, it is unspecified whether the hook will receive that broadcast. It will, regardless, receive all subsequent broadcasts. </P>
<P></P>
<P></P></FONT></BODY></HTML>
