<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Get SCSI Disk Information Command</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>Get SCSI Disk Information Command </H3><P>Prototype: DWORD SendASPI32Command(LPSRB) </P>
<P>Declaration: LPSRB lpSRB; </P>
<P>The SendASPI32Command function with command code SC_GET_DISK_INFO is used to obtain information about a disk type SCSI device. The information returned includes BIOS Int 13h control and accessibility of the device, the drive's Int 13h physical drive number, and the geometry used by the Int 13h services for the drive. </P>
<P></P>
<P><B>Note: </B></P>
<P>This command is not valid for Windows NT, which does not use the Int 13 interface. </P>
<P></P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="108pt" VALIGN="TOP"><COL WIDTH="240pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P><B>Parameter </B></P></TD><TD VALIGN="TOP"><P><B>Description </B></P></TD></TR><TR><TD VALIGN="TOP"><P>lpSRB </P></TD><TD VALIGN="TOP"><P>Points to the following SCSI request block </P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>
<P><BR></P>
<PRE>typedef struct {
 BYTE  SRB_Cmd;     // ASPI command code = SC_EXEC_SCSI_CMD
 BYTE  SRB_Status;    // ASPI command status byte
 BYTE  SRB_HaId;     // ASPI host adapter number
 BYTE  SRB_Flags;    // Reserved
 DWORD  SRB_Hdr_Rsvd;   // Reserved
 BYTE  SRB_Target;    // Target's SCSI ID
 BYTE  SRB_Lun;     // Target's LUN number
 BYTE  SRB_DriveFlags;   // Driver flags
 BYTE  SRB_Int13HDriveInfo; // Host Adapter Status
 BYTE  SRB_Heads;    // Preferred number of heads translation
 BYTE  SRB_Sectors;    // Preferred number of sectors translation
 BYTE  SRB_Rsvd1[10];   // Reserved

} SRB_GetDiskInfo, *PSRB_GetDiskInfo; 
</PRE>
<P>Table 4-12. Get SCSI Disk Information Command </P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="108pt" VALIGN="TOP"><COL WIDTH="240pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P><B>Member </B></P></TD><TD VALIGN="TOP"><P><B>Description </B></P></TD></TR><TR><TD VALIGN="TOP"><P>SRB_Cmd </P></TD><TD VALIGN="TOP"><P>[IN] This field must contain SC_GET_DISK_INFO. </P></TD></TR><TR><TD VALIGN="TOP"><P>SRB_Status </P></TD><TD VALIGN="TOP"><P>[OUT] On return, this field will be the same as the return status defined below. </P></TD></TR><TR><TD VALIGN="TOP"><P>SRB_HaId </P></TD><TD VALIGN="TOP"><P>[IN] This field specifies which installed host adapter the request is intended for. Host adapter numbers are always assigned by the ASPI manager layer beginning with zero. </P></TD></TR><TR><TD VALIGN="TOP"><P>SRB_Flags </P></TD><TD VALIGN="TOP"><P>[IN] Reserved = 0 </P></TD></TR><TR><TD VALIGN="TOP"><P>SRB_Hdr_Rsvd </P></TD><TD VALIGN="TOP"><P>Reserved = 0 </P></TD></TR><TR><TD VALIGN="TOP"><P>SRB_Target </P></TD><TD VALIGN="TOP"><P>[IN] SCSI ID of target device. </P></TD></TR><TR><TD VALIGN="TOP"><P>SRB_Lun </P></TD><TD VALIGN="TOP"><P>[IN] Logical Unit Number (LUN) of device. This field is ignored by ASPI for Win32, since SCSI Bus Device resets are done on a per-target basis only. </P></TD></TR><TR><TD VALIGN="TOP"><P>SRB_DriveFlags </P></TD><TD VALIGN="TOP"><P>[OUT] Upon completion of the SCSI command, the ASPI manager sets this field as follows: </P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="120pt" VALIGN="TOP"><COL WIDTH="120pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>Bit 7-2 </P></TD><TD VALIGN="TOP"><P>Reserved </P></TD></TR><TR><TD VALIGN="TOP"><P>Bit 1-0 </P></TD><TD VALIGN="TOP"><P>These bits are encoded to reflect Int 13h control and accessibility to the device. Bit 1 is the most significant bit. DISK_NOT_INT13 Device is not controlled by Int 13h services DISK_INT13_AND_DOS Device is under Int 13h control and is claimed by DOS DISK_INT1 Device is under Int 13h control but not claimed by DOS </P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="108pt" VALIGN="TOP"><COL WIDTH="240pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD></TR><TR><TD VALIGN="TOP"><P>SRB_Int13DriveInfo </P></TD><TD VALIGN="TOP"><P>[OUT] Upon completion of the SCSI command, the ASPI manager sets this field with the physical drive number that Int 13h services assigned to the device. The valid drive numbers are 0x00 to 0xFF. This field is only valid if bits 1-0 of the SRB_DriveFlags were set to DISK_INT13_AND_DOS or DISK_INT13. </P></TD></TR><TR><TD VALIGN="TOP"><P>SRB_Heads </P></TD><TD VALIGN="TOP"><P>[OUT] Upon completion of the SCSI command, the ASPI manager sets this field to the number of heads the Int13h services is using for this device's geometry. The valid drive numbers are 0x00 to 0xFF. This field is only valid if bits 1-0 of the SRB_DriveFlags were set to DISK_INT13_AND_DOS or DISK_INT13. </P></TD></TR><TR><TD VALIGN="TOP"><P>SRB_Sectors </P></TD><TD VALIGN="TOP"><P>[OUT] Upon completion of the SCSI command, the ASPI manager sets this field to the number of sectors the Int 13h services is using for this device's geometry. The valid drive numbers are 0x00 to 0xFF. This field is only valid if bits 1-0 of the SRB_DriveFlags were set to DISK_INT13_AND_DOS or DISK_INT13. </P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>
<P>Table 4-13. Return Values from Get SCSI Disk Information Command </P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="108pt" VALIGN="TOP"><COL WIDTH="240pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P><B>Value </B></P></TD><TD VALIGN="TOP"><P><B>Meaning </B></P></TD></TR><TR><TD VALIGN="TOP"><P>SS_COMP </P></TD><TD VALIGN="TOP"><P>SCSI/ASPI request has completed without error. </P></TD></TR><TR><TD VALIGN="TOP"><P>SS_INVALID_HA </P></TD><TD VALIGN="TOP"><P>Invalid host adapter number. </P></TD></TR><TR><TD VALIGN="TOP"><P>SS_INVALID_SRB </P></TD><TD VALIGN="TOP"><P>One or more parameters in the SCSI Request Block (SRB) are set incorrectly. </P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>
<P><B>Example</B> </P>
<P>This example obtains disk information from device LUN 0, SCSI ID 2, attached to host adapter #0. </P>
<P><BR></P>
<PRE> SRB_GetDiskInfo MySRB;
 DWORD ASPIStatus;   
  .
  .
 MySRB.SRB_Header.SRB_Cmd = SC_GET_DISK_INFO;
 MySRB.SRB_HaId    = 0;
 MySRB.SRB_Flags    = 0;
 MySRB.SRB_Hdr_Rsvd   = 0;
 MySRB.SRB_Target    = 2;
 MySRB.SRB_Lun    = 0;
 ASPIStatus     = SendASPI32Command ( (LPSRB) &amp;MySRB );
  .
  .
</PRE></FONT></BODY></HTML>
