<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Adding Registry Keys to Support Phone Message Recording and Playback</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>Adding Registry Keys to Support Phone Message Recording and Playback </H3><P>To support the telephone answering machine functions of recording incoming phone messages and playing the messages back through the handset when there is no active call, you must use your modem INF file to put values in fourteen different registry keys: </P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="144pt" VALIGN="TOP"><COL WIDTH="204pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P><B>Registry Key </B></P></TD><TD VALIGN="TOP"><P><B>Value </B></P></TD></TR><TR><TD VALIGN="TOP"><P>AbortPlay </P></TD><TD VALIGN="TOP"><P>Command that stops playing audio data immediately (does not play the rest of the audio buffer contents). This command is not used for modems that are not using a serial wave device. </P></TD></TR><TR><TD VALIGN="TOP"><P>CloseHandset </P></TD><TD VALIGN="TOP"><P>Command that resets the modem to Class 0. </P></TD></TR><TR><TD VALIGN="TOP"><P>HandsetSetPlayFormat </P></TD><TD VALIGN="TOP"><P>Command that sets the modem's handset playback format. </P></TD></TR><TR><TD VALIGN="TOP"><P>HandsetSetRecordFormat </P></TD><TD VALIGN="TOP"><P>Command that sets the modem's handset recording format. </P></TD></TR><TR><TD VALIGN="TOP"><P>LineSetPlayFormat </P></TD><TD VALIGN="TOP"><P>Command that sets the modem's line playback format. </P></TD></TR><TR><TD VALIGN="TOP"><P>LineSetRecordFormat </P></TD><TD VALIGN="TOP"><P>Command that sets the modem's line recording format. </P></TD></TR><TR><TD VALIGN="TOP"><P>OpenHandset </P></TD><TD VALIGN="TOP"><P>Command that puts modem in a mode that enables audio to be played back through the handset when there is no active call. </P></TD></TR><TR><TD VALIGN="TOP"><P>StartPlay </P></TD><TD VALIGN="TOP"><P>Command that starts playing audio (wave files) out of the modem. If a serial wave driver is being used, a bit in the VoiceProfile key controls whether the baud rate is set prior to the StartPlay command or after the StartPlay command. </P></TD></TR><TR><TD VALIGN="TOP"><P>StartRecord </P></TD><TD VALIGN="TOP"><P>Command that starts recording audio (wave files) from the modem. If a serial wave driver is being used, a bit in the VoiceProfile key controls whether the baud rate is set prior to the StartRecord command or after the StartRecord command. </P></TD></TR><TR><TD VALIGN="TOP"><P>StopPlay </P></TD><TD VALIGN="TOP"><P>Command that can be used to reset the modem's baudrate after an AbortPlay or TerminatePlay command. A bit in the VoiceProfile key indicates whether Unimodem/V has to reset the UART's baudrate. </P></TD></TR><TR><TD VALIGN="TOP"><P>StopRecord </P></TD><TD VALIGN="TOP"><P>Command that stops recording audio (wave files) from the modem. If a serial wave driver is being used, a bit in the VoiceProfile key controls whether the baud rate is set prior to the StopRecord command or after the StopRecord command. </P></TD></TR><TR><TD VALIGN="TOP"><P>TerminateRecord </P></TD><TD VALIGN="TOP"><P>Command that causes the modem to finish recording its local buffer and stop recording audio data. This command is not used for modems that are not using a serial wave device. </P></TD></TR><TR><TD VALIGN="TOP"><P>TerminatePlay </P></TD><TD VALIGN="TOP"><P>Command that causes the modem to finish playing the contents of its local buffer and stop playing audio data after that. This command is not used for modems that are not using a serial wave device. </P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>
<P>The relationship between these commands and the way they are used in sequence by Unimodem/V is shown in the following state transition diagram. </P>
<P>The following conventions are used in the illustration: </P>
<P> Italics = Registry key </P>
<P> Bold caps = State name </P>
<P> Underline = TAPI or MMSystem function called to cause state change </P>
<P> Non-bold caps = Parameters for TAPI functions </P>
<P>SMPVOICE.INF is a sample INF file in the MDK for a voice modem that uses the serial wave driver for playing audio to the handset and line. The example values from SMPVOICE.INF for the fourteen keys listed in the table above are: </P>
<P><BR></P>
<PRE>   HKR, CloseHandset,            1,, "at#cls=0cr"
   HKR, StartPlay,               1,, "at#vtxcr"
   HKR, StopPlay,                1,, "None"
   HKR, StopPlay,                2,, "NoResponse"
   HKR, StartRecord,             1,, "at#vrxcr"
   HKR, StopRecord,              1,, "None"
   HKR, StopRecord,              2,, "NoResponse"
   HKR,, TerminateRecord,,       "
&lt;h10&gt;Ecratcr"
   HKR,, TerminatePlay,,         "
&lt;h10&gt;
&lt;h03&gt;atcr"
   HKR,, AbortPlay,,             "
&lt;h10&gt;
&lt;h18&gt;atcr"
   HKR, LineSetPlayFormat,       1,, "at#vls=0cr"
   HKR, LineSetRecordFormat,     1,, "None"
   HKR, LineSetRecordFormat,     2,, "NoResponse"
   HKR, HandsetSetRecordFormat,  1,,"at#vsr=7200cr"
   HKR, HandsetSetRecordFormat,  2,,"at#vbs=4cr"
   HKR, HandsetSetPlayFormat,    1,,"at#vsr=7200cr"
   HKR, HandsetSetPlayFormat,    2,,"at#vbs=4cr"
   HKR, OpenHandset,             1,, "at#cls=8cr"
   HKR, OpenHandset,             2,, "at#vls=2cr"

</PRE></FONT></BODY></HTML>
