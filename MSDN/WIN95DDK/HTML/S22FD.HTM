<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Virtual Device Initialization</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H2>Virtual Device Initialization </H2><P>The VMM initializes a virtual device by doing the following: </P>
<P>    1.     Loads the real-mode initialization segment and calls the real-mode initialization procedure. The procedure can prevent the virtual device from being loaded, prevent Windows from starting, specify instance data for the device, and select pages in memory for its exclusive use. </P>
<P>    2.    Loads the rest of the virtual device segments in 32-bit, flat-model protected-mode memory and discards the real-mode initialization segment. </P>
<P>    3.    Sends a <B>Sys_Critical_Init</B> message to the device control procedure. Hardware interrupts are disabled, so the virtual device should spend as little time as possible initializing itself. </P>
<P>    4.    Sends a <B>Device_Init</B> message to the device control procedure. Hardware interrupts are enabled, so the virtual device must be prepared to manage interrupts from its own device. </P>
<P>    5.    Sends a <B>Init_Complete</B> message to the device control procedure. </P>
<P>    6.    Discards the initialization code and data segments, freeing this memory for other uses. The virtual device must not attempt to access the procedures and data in these segments after it has processed the <B>Init_Complete</B> message. </P>
<P></P>
<P>At any time during initialization, a virtual device can set the carry flag and return to the VMM to prevent the virtual device from loading. Some VMM services, such as the Initialization Information services, are available only during initialization. </P></FONT></BODY></HTML>
