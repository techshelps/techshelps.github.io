<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>_Allocate_Global_V86_Data_Area</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>_Allocate_Global_V86_Data_Area </H3><P><BR></P>
<PRE>include vmm.inc

VMMcall _Allocate_Global_V86_Data_Area, &lt;nBytes, flags&gt;

or      eax, eax        ; zero if error
jz      error
mov     [Address], eax  ; ring-0 linear address of block
</PRE>
<P>Allocates a block of memory from the global V86 data area. The block is for exclusive use by the virtual device. Virtual devices use this service to allocate memory for device-specific objects which must be accessible to both the virtual device and software running in the virtual machine. This service is only available during initialization. Uses EAX, ECX, EDX, and Flags. </P>
<UL><LI>     Returns the ring-0 linear address of the block in the EAX register if successful, zero otherwise. 
<P>If GVDAInquire is given, EAX contains the size in bytes of the largest block that satisfies the request, but that does not move the first V86 page. EAX contains zero if all such requests move the first V86 page. </P></LI></UL><P></P>
<P><I>nBytes</I> </P>
<P>Number of bytes to allocate. This parameter should be a multiple of 4096. </P>
<P><I>flags</I> </P>
<P>Operation flags. Can be zero or more of these values: </P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="144pt" VALIGN="TOP"><COL WIDTH="190pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P><B>Value </B></P></TD><TD VALIGN="TOP"><P><B>Meaning </B></P></TD></TR><TR><TD VALIGN="TOP"><P>GVDADWordAlign </P></TD><TD VALIGN="TOP"><P>Aligns block on a doubleword boundary. If no alignment value is given, the service aligns the block on a byte boundary. </P></TD></TR><TR><TD VALIGN="TOP"><P>GVDAHighSysCritOK </P></TD><TD VALIGN="TOP"><P>Informs the service that the virtual device can manage a block that resides in high MS-DOS memory. The service allocates from high MS-DOS memory only if such memory is available (for example, implemented as XMS UMBs) and the virtual device specifies this value. A virtual device can use this value only while processing the <B>Sys_Critical_Init</B> message. </P>
<P>n first allocated, a block in high MS-DOS memory may not be immediately usable since memory supporting the area may not yet have been mapped. The system maps the memory for the area at some time during the <B>Sys_Critical_Init</B> message, but there is no guarantee as to when. </P>
<P> GVDAHighSysCritOK value is only available for Windows version 3.1 or later. </P></TD></TR><TR><TD VALIGN="TOP"><P>GVDAInquire </P></TD><TD VALIGN="TOP"><P>Returns the size in bytes of the largest block that satisfies the requested alignment but does not require the first V86 page to be moved. The <I>nBytes</I> parameter is not used if this value is specified. </P>
<P>irtual device typically uses this value, while processing the <B>Init_Complete</B> message, to allocate portions of the global V86 data area that might otherwise go unused. The GVDAInquire value is only available for Windows version 3.1 or later. </P></TD></TR><TR><TD VALIGN="TOP"><P>GVDAInstance </P></TD><TD VALIGN="TOP"><P>Creates an instance data block allowing the virtual device to maintain different values in the block for each virtual machine. If this value is not given, the service creates a global block in which the same data is available to all virtual machines. </P></TD></TR><TR><TD VALIGN="TOP"><P>GVDAOptInstance </P></TD><TD VALIGN="TOP"><P>Allows the virtual machine manager to determine whether to create an instance data block or a global data block. </P></TD></TR><TR><TD VALIGN="TOP"><P>GVDAPageAlign </P></TD><TD VALIGN="TOP"><P>Aligns block on a page (4 kilobyte) boundary. If no alignment value is given, the service aligns the block on a byte boundary. </P>
<P> GVDAWordAlign, GVDADWordAlign, GVDAParaAlign, and GVDAPageAlign values are mutually exclusive. </P></TD></TR><TR><TD VALIGN="TOP"><P>GVDAParaAlign </P></TD><TD VALIGN="TOP"><P>Aligns block on a paragraph (16-byte) boundary. If no alignment value is given, the service aligns the block on a byte boundary. </P></TD></TR><TR><TD VALIGN="TOP"><P>GVDAReclaim </P></TD><TD VALIGN="TOP"><P>Unmaps any physical pages in the block while mapping the system nul page into the block. The service places unmapped physical pages in the free list. This value only applies if the GVDAPageAlign value is also given. If this value is not given, the service ignores any physical pages it unmaps. It is up to the virtual device to reclaim these pages. </P>
<P> GVDAReclaim and GVDAInstance values are mutually exclusive. </P></TD></TR><TR><TD VALIGN="TOP"><P>GVDAWordAlign </P></TD><TD VALIGN="TOP"><P>Aligns block on a word boundary. If no alignment value is given, the service aligns the block on a byte boundary. </P></TD></TR><TR><TD VALIGN="TOP"><P>GVDAZeroInit </P></TD><TD VALIGN="TOP"><P>Fills the block with zeros. If this value is not given, the initial content of the block is undefined. </P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>
<P>All other values are reserved. </P>
<P>If this service returns an error, the virtual device should consider this a fatal error and respond accordingly. </P>
<P>The size returned when the GVDAInquire value is given may be less than a reasonable minimum. For instance, if GVDAPageAlign is specified, the return size may be less than 4096. It is up to the virtual device to check for this. </P>
<P>For blocks allocated with GVDAInstance, this service calls automatically calls the <B>_AddInstanceItem</B> service. </P>
<P>The <B>_Allocate_Global_V86_Data_Area</B> service is not available and must not be called if the virtual device has allocated a temporary block using the <B>_Allocate_Temp_V86_Data_Area</B> service. The virtual device must free the block before it can call the <B>_Allocate_Global_V86_Data_Area</B> service. </P>
<P>If GVDAReclaim is not given, the virtual device should reclaim the physical addresses of any unmapped physical pages, and map the pages to other addresses. A virtual device reclaims the physical addresses by using the <B>_CopyPageTable</B> service to retrieve the page-table entries for the system virtual machine. The virtual device can then use the <B>_PhysIntoV86</B> service to map the physical pages into the V86 address space. </P>
<P>See also <B>_CopyPageTable</B>, <B>_PhysIntoV86</B> </P>
<P></P>
<P></P></FONT></BODY></HTML>
