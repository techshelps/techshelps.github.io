<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Return Value, Instanced Data, and Excluded Pages</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>Return Value, Instanced Data, and Excluded Pages </H3><P>The real-mode initialization procedure uses return values to direct the VMM to carry out specific actions, such as instancing data items and reserving physical pages. The procedure must return values in each of the following registers: </P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="144pt" VALIGN="TOP"><COL WIDTH="204pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P><B>Register </B></P></TD><TD VALIGN="TOP"><P><B>Description </B></P></TD></TR><TR><TD VALIGN="TOP"><P>AX </P></TD><TD VALIGN="TOP"><P>Contains the return value. It can be one of the following values: </P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="102pt" VALIGN="TOP"><COL WIDTH="102pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>Abort_Device_Load </P></TD><TD VALIGN="TOP"><P>Directs the VMM to prevent the virtual device from loading. This does not affect the loading of other the virtual devices. </P></TD></TR><TR><TD VALIGN="TOP"><P>Abort_Win386_Load </P></TD><TD VALIGN="TOP"><P>Specifies a fatal error and directs the VMM to end Windows. </P></TD></TR><TR><TD VALIGN="TOP"><P>Device_Load_Ok </P></TD><TD VALIGN="TOP"><P>Directs the VMM to load and initialize the rest of the virtual device. </P></TD></TR><TR><TD VALIGN="TOP"><P>No_Fail_Message </P></TD><TD VALIGN="TOP"><P>When combined with the Abort_Device_Load or Abort_Win386_Load value, directs the VMM to carry out its error handling without displaying a message. If this value is not given, the VMM displays an error message when a virtual device fails. </P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="144pt" VALIGN="TOP"><COL WIDTH="204pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>BX </P></TD><TD VALIGN="TOP"><P>Points to a null-terminated array of page numbers specifying the physical pages to reserve for exclusive use by the virtual device. The pages must be in low memory (that is, page numbers must be in the range 0 through 100h). This register must be set to 0 if the virtual device does not reserve pages. </P></TD></TR><TR><TD VALIGN="TOP"><P>EDX </P></TD><TD VALIGN="TOP"><P>Specifies a 32-bit value representing reference data to be passed through the EDX register to the virtual device's device control procedure when the VMM sends the <B>Sys_Critical_Init</B> message. This value can be a linear address to ROM BIOS data, a constant, or some other value. For example, an EBIOS device can pass the EBIOS page number, so that the procedure that processes the message does not need to look for the page again. </P></TD></TR><TR><TD VALIGN="TOP"><P>SI </P></TD><TD VALIGN="TOP"><P>Points to a null-terminated array of instance data items. Each element in the array has the following form: </P>
<P>ItemAddress dd ? ; segment:offset of item to instance </P>
<P>Length dw ? ; length in bytes of data item </P>
<P>The VMM allocates a unique copy of the instanced data for each virtual machine. This register must be set to 0 if the virtual device does not instance data. Note that the virtual device must not attempt to instance the interrupt vector table; the VMM automatically instances this table. </P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>
<P>In some rare cases, a virtual device consists of nothing more than a real-mode initialization procedure that reserves exclusive pages and declares instance data. Such a virtual device always returns 8001h to prevent the VMM from loading any other portion of the virtual device, or displaying an error message. </P></FONT></BODY></HTML>
