<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Host Adapter Inquiry Command</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>Host Adapter Inquiry Command </H3><P>Prototype: DWORD SendASPI32Command(LPSRB) </P>
<P>Declaration: LPSRB lpSRB; </P>
<P>The SendASPI32Command function with command code SC_HA_INQUIRY is used to get information on the installed host adapter hardware, including the number of host adapters installed. The number of host adapters returned represents the logical bus count instead of the true physical adapter count. For host adapters that support single bus only, the host adapter count and logical bus count are identical. For host adapters that support multiple buses, the host adapter count represents the total logical bus count. </P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="108pt" VALIGN="TOP"><COL WIDTH="240pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P><B>Parameter </B></P></TD><TD VALIGN="TOP"><P><B>Description </B></P></TD></TR><TR><TD VALIGN="TOP"><P>lpSRB </P></TD><TD VALIGN="TOP"><P>Points to the following SCSI request block </P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>
<P><BR></P>
<PRE>typedef struct {
 
 BYTE  SRB_Cmd;            // ASPI command code = SC_HA_INQUIRY
 BYTE  SRB_Status;         // ASPI command status byte
 BYTE  SRB_HaId;           // ASPI host adapter number
 BYTE  SRB_Flags;          // ASPI request flags
 DWORD SRB_Hdr_Rsvd;       // Reserved, MUST = 0
 BYTE  HA_Count;           // Number of host adapters present
 BYTE  HA_SCSI_ID;         // SCSI ID of host adapter
 BYTE  HA_ManagerId[16];   // String describing the manager
 BYTE  HA_Identifier[16];  // String describing the host adapter
 BYTE  HA_Unique[16];      // Host Adapter Unique parameters
 WORD  HA_Rsvd1;           // Reserved

} SRB_HAInquiry, *PSRB_HAInquiry; 
</PRE>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="144pt" VALIGN="TOP"><COL WIDTH="204pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P><B>Member </B></P></TD><TD VALIGN="TOP"><P><B>Description </B></P></TD></TR><TR><TD VALIGN="TOP"><P>SRB_Cmd </P></TD><TD VALIGN="TOP"><P>[IN] This field must contain SC_HA_INQUIRY. </P></TD></TR><TR><TD VALIGN="TOP"><P>SRB_Status </P></TD><TD VALIGN="TOP"><P>[OUT] On return, this field is the same as the return status defined below. </P></TD></TR><TR><TD VALIGN="TOP"><P>SRB_HaId </P></TD><TD VALIGN="TOP"><P>[IN] This field specifies which installed host adapter the request is intended for. Host adapter numbers are always assigned by the SCSI manager layer, beginning with zero. </P></TD></TR><TR><TD VALIGN="TOP"><P>SRB_Flags </P></TD><TD VALIGN="TOP"><P>[IN] Reserved = 0 </P></TD></TR><TR><TD VALIGN="TOP"><P>SRB_Hdr_Rsvd </P></TD><TD VALIGN="TOP"><P>Reserved = 0 </P></TD></TR><TR><TD VALIGN="TOP"><P>HA_Count </P></TD><TD VALIGN="TOP"><P>[OUT] The ASPI manager sets this field with the number of host adapters installed under ASPI. For example, a return value of 2 indicates that host adapters #0 and #1 are valid. To determine the total number of host adapters in the system, the SRB_HaId field should be set to zero, or GetASPI32SupportInfo can be used. The number of host adapters returned represents the logical bus count instead of the true physical adapter count. For host adapters that support single bus only, the host adapter count and logical bus count are identical. </P></TD></TR><TR><TD VALIGN="TOP"><P>HA_SCSI_ID </P></TD><TD VALIGN="TOP"><P>[OUT] The ASPI manager sets this field with the SCSI ID of the given host adapter. </P></TD></TR><TR><TD VALIGN="TOP"><P>HA_ManagerId[..] </P></TD><TD VALIGN="TOP"><P>[OUT] The ASPI manager fills this 16-character buffer with an ASCII string describing the ASPI manager. For ASPI for WIN32, the string "ASPI for WIN32" is returned. </P></TD></TR><TR><TD VALIGN="TOP"><P>HA_Identifier[..] </P></TD><TD VALIGN="TOP"><P>[OUT] The ASPI manager fills this 16-character buffer with a string describing the host adapter. </P></TD></TR><TR><TD VALIGN="TOP"><P>HA_Unique[..] </P></TD><TD VALIGN="TOP"><P>[OUT] The ASPI manager fills this 16-byte buffer with host adapter unique parameters. The returned buffer is encoded as follows: </P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="102pt" VALIGN="TOP"><COL WIDTH="102pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>Byte 15-8 </P></TD><TD VALIGN="TOP"><P>Reserved = 0 </P></TD></TR><TR><TD VALIGN="TOP"><P>Byte 7-4 </P></TD><TD VALIGN="TOP"><P>Maximum Transfer Length. </P></TD></TR><TR><TD VALIGN="TOP"><P>Byte 3 </P></TD><TD VALIGN="TOP"><P>Maximum SCSI Targets. Indicates the maximum number of targets (SCSI IDs) the adapter supports. If this value is not set, it is assumed that there are 8 targets. (SCSI IDs 0-7). </P></TD></TR><TR><TD VALIGN="TOP"><P>Byte 2 </P></TD><TD VALIGN="TOP"><P>Adapter Unique Flags: Bits 7-2 and Bit 0 are reserved. If Bit 1 is 1, residual byte count reporting is supported; if Bit 1 is 0, residual byte count reporting is not supported. </P></TD></TR><TR><TD VALIGN="TOP"><P>Byte 1-0 </P></TD><TD VALIGN="TOP"><P>Buffer Alignment Mask. The host adapter requires data buffer alignment specified by the 16-bit value. A value of 0x0000 indicates no boundary requirements (e.g. byte), 0x0001 word alignment, 0x0003 double-word, 0x0007 8-byte alignment, etc. The 16-bit value allows data buffer alignments of up to 65536-byte boundaries. Byte 1 is the most significant byte. </P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="144pt" VALIGN="TOP"><COL WIDTH="204pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="102pt" VALIGN="TOP"><COL WIDTH="102pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P><B>Value </B></P></TD><TD VALIGN="TOP"><P><B>Meaning </B></P></TD></TR><TR><TD VALIGN="TOP"><P>SS_COMP </P></TD><TD VALIGN="TOP"><P>SCSI/ASPI request has completed without error. </P></TD></TR><TR><TD VALIGN="TOP"><P>SS_INVALID_HA </P></TD><TD VALIGN="TOP"><P>Invalid host adapter number. </P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="144pt" VALIGN="TOP"><COL WIDTH="204pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>
<H4><A NAME="sec0"></A>Residual Byte Length </H4><P>Residual byte length is the number of bytes not transferred to, or received from, the target SCSI device. For example, if the ASPI buffer length for a SCSI Inquiry command is set for 100 bytes, but the target only returns 36 bytes; the residual length is 64 bytes. If the ASPI buffer length for a SCSI Write command is set for 514 bytes but the target only takes 512 bytes, the residual length is 2 bytes. ASPI modules can determine if the loaded ASPI manager supports residual byte length by issuing an Extended Host Adapter Inquiry command, as described in the previous section. </P>
<P><B>Example</B> </P>
<P>This example of the Host Adapter Inquiry command gets host adapter hardware information from adapter #0. </P>
<P><BR></P>
<PRE> SRB_HAInquiry MySRB;
 DWORD ASPIStatus;   
  .
  .
 MySRB.SRB_Cmd     = SC_HA_INQUIRY;
 MySRB.SRB_HaId    = 0;
 MySRB.SRB_Flags    = 0;
 MySRB.SRB_Hdr_Rsvd   = 0;
 ASPIStatus     = SendASPI32Command ( (LPSRB) &amp;MySRB );
  .
  .
</PRE></FONT></BODY></HTML>
