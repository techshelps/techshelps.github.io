<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Map_Lin_To_VM_Addr</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>Map_Lin_To_VM_Addr </H3><P><BR></P>
<PRE>include vmm.inc

mov     eax, LineAddr   ; linear address to convert
mov     ecx, Limit      ; segment limit in bytes
VMMcall Map_Lin_To_VM_Addr

jc      error           ; carry flag set if error
mov     [SegSel], cx    ; segment or selector
mov     [Offset], edx   ; address offset
</PRE>
<P>Converts a 32-bit ring-0 linear address into an V86 or protected-mode address. This service converts the address for use with the current execution mode of the current virtual machine. Uses ECX, EDX, Flags. </P>
<UL><LI>     Returns with the carry flag clear if successful, set otherwise. If the carry flag is clear, the CX register contains the segment address or selector, and the EDX register contains the offset address. The offset is always zero if the virtual machine is running a protected-mode application. </LI></UL><P></P>
<P><I>LinAddr</I> </P>
<P>Linear address to convert. </P>
<P><I>Limit</I> </P>
<P>Zero-based segment limit (0 specifies a one-byte segment, 1 is a two-byte segment, and so on). This parameter is used only if the service creates an LDT selector. </P>
<P>If the virtual machine is running in V86 mode, the <I>LineAddr</I> parameter must specify a linear address that is within the 1 megabyte V86 address space of the current virtual machine. The service returns a segment:offset pair. </P>
<P>If the virtual machine is running a protected-mode application, the service returns a selector:offset pair. This service creates a new selector in the current virtual machine's LDT if the specified base and limit values do not match a selector the service previously allocated. The service returns an error if no LDT is available. </P>
<P>A virtual device must <I>never</I> free a selector that is returned by this service. For this reason, this service should be used sparingly. </P>
<P>See also <B>Map_Flat</B> </P>
<P></P>
<P></P></FONT></BODY></HTML>
