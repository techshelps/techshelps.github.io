<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Using an Input Context</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>Using an Input Context </H3><P>When the application or system creates new input context, the system prepares the new input context. The new input context already includes IMCC, the components of IMC consisting of <B>hCompStr</B>, <B>hCandInfo</B>, <B>hGuideLine</B>, <B>hPrivate</B> and <B>hMsgBuf</B>. Basically, the IME does not need to create the input context and the components of the input context. The IME can change their size, and can retrieve a pointer to the components by locking them. </P>
<H4><A NAME="sec0"></A>Access HIMC </H4><P>To access the input context, an IME must call <B>ImmLockIMC</B> to retrieve a pointer to the input context. <B>ImmLockIMC</B> increments the imm lock count for IMC, and <B>ImmUnlockIMC</B> decrements it. </P>
<H4><A NAME="sec1"></A>Access HIMCC </H4><P>To access one component of the input context, an IME must call <B>ImmLockIMCC</B> to get a pointer to IMCC. <B>ImmLockIMCC</B> increments the imm lock count for IMCC, and <B>ImmUnlockIMC</B> decrements it. <B>ImmReSizeIMCC</B> may resize IMCC to the specified size. </P>
<P>Occasionally, an IME may need to create one component of the input context by itself. In this case, the IME can call the <B>ImmCreateIMCC</B> function and obtain the handle of IMCC. This IMCC can be members of the <B>INPUTCONTEXT</B> structure (<B>hCompStr</B>, <B>hCandInfo</B>, <B>hGuideLine</B>, <B>hPrivate</B> or <B>hMsgBuf</B>). </P>
<P><B>ImmDestroyIMCC</B> destroys one component of the input context. </P>
<H4><A NAME="sec2"></A>How to Use an Input Context </H4><P>The following example shows how to use an input context: </P>
<P><BR></P>
<PRE>LPINPUTCONTEXT lpIMC;
LPCOMOSITIONSTRING lpCompStr;
HIMCC hMyCompStr;

if (hIMC) { // It is not NULL context.
    lpIMC = ImmLockIMC(hIMC);

    if (!lpIMC) {
        MyError( "Can not lock hIMC");
        return FALSE;
    }

    // Use lpIMC-&gt;hCompStr.
    lpCompStr = (LPCOMPOSITIONSTRING) ImmLockIMCC(lpIMC-&gt;hCompStr);

    // Access lpCompStr.
    ImmUnlockIMCC(lpIMC-&gt;hCompStr);

    // ReSize lpIMC-&gt;hCompStr.
    if (!(hMyCompStr = ImmReSizeIMCC(lpIMC-&gt;hCompStr,dwNewSize)) {
        MyError("Can not resize hCompStr");
        ImmUnlockIMC(hIMC);
        return FALSE;
    }
    lpIMC-&gt;hCompStr = hMyCompStr;
    ImmUnlockIMC(hIMC);
}</PRE></FONT></BODY></HTML>
