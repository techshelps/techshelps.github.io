<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Call_When_Not_Critical</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>Call_When_Not_Critical </H3><P><BR></P>
<PRE>include vmm.inc

mov     esi, CritSecCallback
mov     edx, RefData
VMMcall Call_When_Not_Critical
</PRE>
<P>Installs a critical-section callback function. The system calls this function when a virtual device releases the critical section. Uses Flags. </P>
<UL><LI>     No return value. </LI></UL><P></P>
<P><I>CritSecCallback</I> </P>
<P>Address of the callback function to install. For more information, see <B>CritSecCallback.</B> </P>
<P><I>RefData</I> </P>
<P>Address of reference data to pass to the callback function. </P>
<P>The system does not execute the callback until the current virtual machine's execution priority is less than the Critical_Section_Boost value even if the current virtual machine is <I>not</I> in a critical section. This allows a virtual device to release the critical section and process any simulated interrupts before the system calls the callback function. </P>
<P>Virtual devices can install any number of callback functions, but the system calls only the most recent function on the list when the critical section is released. The system removes the callback function from the list as it calls the function. This is a common point of confusion. Unlike services like <B>Call_When_Task_Switched</B>, which install a hook permanently, the <B>Call_When_Not_Critical</B> service removes the callback once it is dispatched. </P>
<P>It is more convenient to use the <B>Call_Priority_VM_Event</B> service than to call this service directly. </P>
<P>See also <B>Call_When_Idle</B>, <B>Call_When_Task_Switched</B>, <B>CritSecCallback</B> </P>
<P></P>
<P></P></FONT></BODY></HTML>
