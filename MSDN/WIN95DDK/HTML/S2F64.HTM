<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Callbacks</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>Callbacks </H3><P>While processing an I/O request, a driver can perform post-processing on the request by inserting the address of a callback routine in the <B>IOP_callback_table</B> member of the <B>IOP</B> and updating the <B>IOP_callback_ptr</B> member: </P>
<P><BR></P>
<PRE>; get callback pointer
mov eax, [esi.IOP_callback_ptr]
; save callback address in table
mov [eax.IOP_callback_table], offset32 vol_completion
; move down to next entry
add [esi.IOP_callback_ptr], size IOP_callback_entry
</PRE>
<P>When calling back a request after completion or termination, each driver performs any necessary preprocessing, places the <B>IOP</B> address on the stack, and calls the next higher layer: </P>
<P><BR></P>
<PRE>sub [ebx].IOP_callback_ptr, size IOP_callback_entry
                                  ; point to next available cb entry
mov eax, [ebx].IOP_callback_ptr   ; get pointer to next entry
push ebx                          ; place *IOP on stack
call [eax].IOP_cb_address         ; call back request
add esp, 4                        ; restore stack
</PRE>
<P>See also <B>IOP</B> </P></FONT></BODY></HTML>
