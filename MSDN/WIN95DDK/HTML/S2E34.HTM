<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Unloading the Pen Device Driver</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>Unloading the Pen Device Driver </H3><P>The device driver's unloading process should ideally comply with the Plug and Play specifications. The Unidriver's exit code currently consists of only the function <B>cVpenD_Device_Exit</B>, which forms a shell for the exit procedure. The virtual pen driver receives a Sys_Critical_Exit message when the system unloads it. In handling this message, the virtual pen driver should place the hardware in a stable state and free any resources it holds. </P>
<P>The unloading process for the pen driver is also quite simple and straight forward. When the system unloads the pen driver, it sends the following three messages in the given order: DRV_CLOSE, DRV_DISABLE, and DRV_FREE. In processing the DRV_DISABLE message, the pen driver calls the virtual driver so it can turn off interrupts. The pen driver should return DRV_SUCCESS for all three messages. </P>
<P>As part of unloading the driver, the system sends a DRV_RemoveEntryPoints message so the system will receive no more pen packets. </P></FONT></BODY></HTML>
