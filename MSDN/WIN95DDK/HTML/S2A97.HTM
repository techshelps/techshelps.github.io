<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Initializing and Configuring Multimedia Device Drivers</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2">
<H3>Initializing and Configuring Multimedia Device Drivers </H3><P>To activate an installed driver, the multimedia driver must receive an initialization message, DRV_OPEN. The DRV_OPEN message sets up an initial session in which the instance information is NULL. This session keeps the driver active as long as it is installed. Because this session remains open for a long time, it is important that no critical resources be allocated and left allocated for the life of the session. </P>
<P>If your device driver supports more than one interrupt-level or port assignment, it should allow user configuration through the Multimedia option in the Control Panel. Through the DRV_CONFIGURE message, installable drivers can supply a configuration dialog box for this purpose. The dialog box should display the name and version number of your device driver. </P>
<P>In addition to the DRV_CONFIGURE message, device drivers might support driver-specific messages. For example, video-capture drivers also use the DVM_DIALOG message to display dialog boxes for configuring various channels. For more information about the messages for displaying additional dialog boxes, see the main topics describing specific device drivers. </P>
<P>Installable drivers can supply a configuration dialog box for users to access through the Drivers option in the Control Panel. The Multimedia option sends the DRV_CONFIGURE message to your driver to display the dialog box. The dialog box should display the name and version number of your device driver. If your device driver supports different interrupt-level and port assignments, it should also support user configuration through the Multimedia option in the Control Panel. </P>
<H4><A NAME="sec0"></A>Introduction </H4><P>This topic contains information that pertains to non-Plug and Play devices. Configuration and loading information for Plug and Play devices is stored in the registry. </P>
<P>The SYSTEM.INI file contains information for loading and configuring device drivers. Your device driver must be identified in the [drivers] section. Your device driver might also have entries in the [386enh] section if it requires any VxDs for operation. Your driver might also reserve a device-specific section in the SYSTEM.INI to store configuration information. When you install or remove a device, the installation program updates the [drivers] and [386enh] sections. </P>
<H4><A NAME="sec1"></A>Interrupt-Level and Port Assignments </H4><P>Interrupt-level and port assignments, and any other hardware-related settings, can be stored in a section with the same name as the driver in the user's SYSTEM.INI file. (Alternatively, your driver might use its own .INI file for this information.) </P>
<P>For example, the following SYSTEM.INI section, created by the Bravado driver, specifies interrupt level 9 and memory base E: </P>
<P><BR></P>
<PRE>[Bravado.drv]
Interrupt=9
MemoryBase=E
</PRE>
<P>To conform to other Windows drivers, use the keynames <B>int</B> and <B>port</B> to specify interrupt-level and port assignments. For example, the following SYSTEM.INI section specifies interrupt level 3 and port 0x220 for the Sound Blaster(tm) driver: </P>
<P><BR></P>
<PRE>[Sound Blaster]
int=3
port=220
</PRE>
<P></P>
<P><B>Note </B></P>
<P>Software-only codecs do not require interrupt and port settings, but hardware-assisted codecs do. Interrupt and port settings for hardware-assisted codecs are similar to those used by wave and capture drivers. The ACM is like software-only codecs in that it does not require specific interrupt and port settings. The installation program for any audio hardware in a system should create the appropriate entries for that hardware. </P>
<P></P>
<H4><A NAME="sec2"></A>Support for Driver Installation </H4><P>The Multimedia option in the Control Panel is the preferred method for installing device drivers. The Multimedia option uses information in the OEMSETUP.INF file for your driver to add the entries in the [drivers] section, as well as entries in the [386enh] section, to install any VxDs you require. </P>
<P>The entry that identifies your driver in the [drivers] section lets Windows load the driver. If this entry is absent, your driver won't be recognized. While installation programs usually add the necessary entry for completed device drivers, you might have to manually add it while you are developing your device driver. You might also have to manually add any [386enh] entries you need. The final version of your device driver should use an installation program to create and delete the entries in these two sections. The following table identifies the keynames for various multimedia drivers. </P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="144pt" VALIGN="TOP"><COL WIDTH="204pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P><B>Use this keyname </B></P></TD><TD VALIGN="TOP"><P><B>For the following driver types </B></P></TD></TR><TR><TD VALIGN="TOP"><P><B>MSVideo</B> </P></TD><TD VALIGN="TOP"><P>Video-capture device drivers. </P></TD></TR><TR><TD VALIGN="TOP"><P><B>wave</B> </P></TD><TD VALIGN="TOP"><P>Waveform device drivers. </P></TD></TR><TR><TD VALIGN="TOP"><P><B>midi</B> </P></TD><TD VALIGN="TOP"><P>MIDI device drivers. </P></TD></TR><TR><TD VALIGN="TOP"><P><B>vidc</B>.<B>nnnn</B> </P></TD><TD VALIGN="TOP"><P>Video compression or decompression device driver. In this case, <I>nnnn</I> represents the four-character code for the driver. </P></TD></TR><TR><TD VALIGN="TOP"><P><B>msacm</B>.<B>nnnn</B> </P></TD><TD VALIGN="TOP"><P>Audio compression or decompression device driver. In this case, <I>nnnn</I> represents the four-character code for the driver. </P></TD></TR><TR><TD VALIGN="TOP"><P><B>vids</B>.<B>nnnn</B> </P></TD><TD VALIGN="TOP"><P>Video stream compression driver. In this case, <I>nnnn</I> represents the four-character code for the driver. </P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>
<P>If there is more than one wave or MIDI driver, append a number from 1 to 9 after the keyname. When you have multiple drivers, use sequential numbers to identify them. </P>
<P>For example, the following [drivers] section extract identifies one waveform device driver named SNDBLST2.DRV, two MIDI device drivers named ADLIB.DRV and MPU401.DRV, and one video-capture device driver named BRAVADO.DRV. </P>
<P><BR></P>
<PRE>[drivers]
timer=timer.drv
joystick=ibmjoy.drv
wave=*.drv
midi=*.drv
midimapper=midimap.drv
wavemapper=msacm.drv
MSVideo=bravado.drv
</PRE>
<P></P>
<P><B>Note </B></P>
<P>After installing an audio driver with the Multimedia option in the Control Panel, Windows must be restarted to load the driver. </P>
<P></P>
<H4><A NAME="sec3"></A>Video-Capture Drivers </H4><P>You can have more than one driver of the MSVideo type in the [drivers] section. The following example shows a [drivers] section with entries for five video-capture drivers: </P>
<P><BR></P>
<PRE>[drivers] 
MSVideo=targa16.drv 
MSVideo1=testdrv.drv 
MSVideo2=bravado.drv 
MSVideo3=vblaster.drv 
MSVideo4=MYDRVR.DRV
</PRE>
<P>If you are using the VidCap video-capture application, you can select the video-capture driver it uses with the <B>-d</B> command-line option. The integer specified after the <B>-d</B> corresponds to the video-capture driver entry. For example, the command <B>VidCap -d0</B> uses the TARGA16.DRV driver associated with the MSVideo entry. <B>VidCap -d3</B> uses the VBLASTER.DRV associated with the MSVideo3 entry. </P>
<P></P>
<P><B>Note </B></P>
<P>Video-capture device drivers are loaded only when needed by an application. </P>
<P></P>
<H4><A NAME="sec4"></A>Video Compression and Decompression Drivers </H4><P>Video compression and decompression drivers can use an entry in the [Installable Compressors] section of the SYSTEM.INI file for loading and configuring the driver. Identify your driver in the [drivers] section if you want to use the Multimedia option of the Control Panel to install or configure it. Identify your driver in the [Installable Compressors] section if you want to use a custom-installation application. If you use a custom-installation application, it should update the [Installable Compressors] section when your driver is installed or removed. </P>
<P>Video compression and decompression drivers are identified by the keyname VIDC., followed by its four-character code identifier. For example, the following [Installable Compressors] section of SYSTEM.INI identifies one video compression and decompression driver: </P>
<P><BR></P>
<PRE>[Installable Compressors] 
VIDC.SAMP = ICSAMPLE.DRV
</PRE>
<P>SAMP is the four-character code identifier of the compressor. This driver has a file name of ICSAMPLE.DRV. </P>
<P>The four-character code identifier must be unique. If you want to create a new four-character code identifier, register it with Microsoft to set up a standard definition and avoid any conflicts with other codes that might be defined. To register a code for a compression and decompression driver, request a <I>Multimedia Developer Registration Kit</I> from the following group: </P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="144pt" VALIGN="TOP"><COL WIDTH="204pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>Microsoft Corporation </P></TD><TD VALIGN="TOP"><P></P></TD></TR><TR><TD VALIGN="TOP"><P>Advanced Consumer Technology Group </P></TD><TD VALIGN="TOP"><P></P></TD></TR><TR><TD VALIGN="TOP"><P>Product Marketing </P></TD><TD VALIGN="TOP"><P></P></TD></TR><TR><TD VALIGN="TOP"><P>One Microsoft Way </P></TD><TD VALIGN="TOP"><P></P></TD></TR><TR><TD VALIGN="TOP"><P>Redmond, WA 98052-6399 </P></TD><TD VALIGN="TOP"><P></P></TD></TR></TBODY></TABLE>
<P><BR></P><P></P>
<P>For more information about four-character codes, see the <I>Microsoft Windows Programmer's Reference</I>. </P></FONT></BODY></HTML>
