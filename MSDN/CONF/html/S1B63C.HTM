<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Implementing Directory Services Using Microsoft Windows NT Server: Part 2</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>	<BODY bgcolor="#FFFFFF" link=#003399 vlink=#996699>



	<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

	<!--TOOLBAR_START-->
	<!--TOOLBAR_EXEMPT-->
	<!--TOOLBAR_END-->

<H1>Implementing Directory Services Using Microsoft Windows NT Server: Part 2</H1><H2>Looking Ahead for Part 2</H2><p><img src="59361.gif"></P>
<p>To implement directory services, a network designer will need to perform the following tasks:</P>
<ul><li>Design and implement the appropriate Windows NT Server domain model for a given network design.</LI><li>Establish and maintain trust relationships, thereby making possible the concept of one user, one account.</LI><li>Determine the optimum number and location of servers.</LI></UL></SPAN><p>As the slide indicates, the rest of the session provides the concepts, components, and hands-on experience to prepare network planners and administrators to use Windows NT Server Directory Services to meet these challenges.</P>
<H2>Overview of Section 3</H2><p><img src="59362.gif"></P>
<H3>Objectives</H3><p>At the end of this section, you will be able to:</P>
<ul><li>Describe the role of domains in Windows NT Server Directory Services</LI><li>Describe the planning considerations before implementing any domain model.</LI><li>Implement and administer a single domain model.</LI><li>Implement and administer a master domain model.</LI><li>Implement and administer a multiple master domain model.</LI><li>Implement and administer a complete trust model.</LI></UL></SPAN><H2> </A>Domains in Windows NT Server Directory Services</H2><p><img src="59363.gif"></P>
<p>Domains act as the building blocks for Windows NT Server Directory Services by supporting communications and administration across an enterprise network.</P>
<p>Because domains provide the foundation for directory services, it is essential for network planners to understand their functions in the directory services environment.</P>
<h3> </A>Four Directory Service Structures</H3><p>Windows NT Server Directory Services can be implemented in four different domain structures:</P>
<ul><li>The single domain model
<P CLASS="lp1">As the name implies, there is only one domain.</P></LI><li>The master domain model
<P CLASS="lp1">This involves one domain for accounts (the master) and any number of resource domains.</P></LI><li>The multiple master domain model
<P CLASS="lp1">This model includes more than one master domain along with any number of resource domains.</P></LI><li>The complete trust domain model
<P CLASS="lp1">Trusts connect every domain in this model with every other domain in the model.</P></LI></UL></SPAN><p>This module discusses the details of each domain structure and the considerations involved in implementing the appropriate structure as part of Windows NT Server Directory Services installation.</P>
<H2> </A>Considerations in Implementing Directory Services</H2><p><img src="59364.gif"></P>
<p>The network planner should keep the following considerations in mind while planning a directory services domain structure:</P>
<ul><li>The number of people who will use the network&mdash;different directory services structures accommodate large numbers of accounts differently..</LI><li>The organization of the business&mdash;Windows NT Server Directory Services should be structured to map to the organization of a business. It is important to remember that domains are not limited by geographical area. For example, a sales domain for an international corporation may include resources from different continents.</LI><li>The type, number, location, and management of resources users will need to access&mdash;this will affect the domain structure and the implementation of trusts.</LI><li>The location of the people who need to use the network&mdash;resources can be located anywhere in the structure, but user accounts should be centralized..
<P CLASS="nt"><B>Caution</B>   Remember, a user account should be defined only once in the network. If this rule is not followed, the same user account name will have two or more different SIDs. This can cause administrative inconsistencies when assigning permissions or user rights. It can also cause problems for users having to maintain duplicate accounts in order to access resources. </P>

<P CLASS="nt"><B>Note</B>   Module four, Planning Your Directory Services Structure, examines planning a Windows NT Server Directory Services installation in extensive detail.</P></LI></UL></SPAN><H2> </A>The Single Domain Model</H2><p><img src="59365.gif"></P>
<p>In the single domain model, Windows NT Server Directory Services assure the "one user, one account" concept by bringing all the accounts and resources together into one administrative unit. Any user, logging on only once, will be able to access any resource for which he or she has appropriate permissions. Administrators that have the appropriate permissions will be able to manage any resource, no matter which resource it is or where in the domain it is located. </P>
<h3> </A>The Single Domain Structure</H3><p>The single domain model consists of only one domain, with one primary domain controller and one or more backup domain controllers. A single domain model is most appropriate in the following situations:</P>
<ul><li>Domains consisting of up to 40,000 users.</LI><li>Centralized administration of accounts and resources.</LI></UL></SPAN><p>In this implementation of directory services, the number of users and groups depends on the number of servers in the domain and the server hardware.</P>
<p>The single domain model does not use trust relationships; all users and groups reside in the one domain.</P>
<p>The following table summarizes the single domain model:</P>

<TABLE COLS="2" BORDER="1" CELLPADDING="7"><COLGROUP><COL WIDTH="168pt" VALIGN="TOP"><COL WIDTH="169pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Advantages</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Disadvantages</P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Best model for many companies.</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Poor performance if the domain has too many users and groups for the domain controller's hardware.</P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Centralized management of user accounts.</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>No groupings of users into departments.</P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Centralized management of resources.</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>No grouping of resources.</P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>No management of trust relationships necessary.</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Browsing is slow if domain has a large number of servers. </P></TD>

</TR></TBODY></TABLE>
<P CLASS="spacing"><BR></P><H2> </A>The Master Domain Model</H2><p><img src="59366.gif"></P>
<p>In the master domain model, Windows NT Server Directory Services use trusts to implement seamless communication between domains, thereby making the "one user, one account" concept a reality even between domains.</P>
<h3> </A>The Master Domain Structure</H3><p>The master domain model consists of at least two domains. Each domain has its own domain controllers, but all account information is kept on the master domain controllers. The master domain model offers the following benefits:</P>
<ul><li>Multiple domains</LI><li>Centralized account administration</LI><li>Decentralized resource administration</LI><li>A single logon for each user account</LI></UL></SPAN><p>The master domain model would be appropriate in a situation where a company has developed a complex assortment of divisions and departments, each wanting its own separate resource management, but still requiring centralized account management.</P>
<H4 CLASS="h4"> </A>Master Domain Summary</H4><p>The following table summarizes the master domain model:</P>

<TABLE COLS="2" BORDER="1" CELLPADDING="7"><COLGROUP><COL WIDTH="168pt" VALIGN="TOP"><COL WIDTH="174pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TH VALIGN="TOP"><P>Advantages</P></TH><TH VALIGN="TOP"><P>Disadvantages</P></TH></TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Best choice for companies that do not have too many users relative to the hardware and must have shared resources split into groups for management purposes.</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Poor performance if the domain has too many users and groups for the hardware.</P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>User accounts can be centrally located.</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Local groups must be defined in each domain where they are to be used. </P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Resources are grouped logically in resource domains.</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Local administrators of trusting domains rely on master-domain administration to supply current and secure global groups.</P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Resource domains can have their own administrators who manage the resources in the domain.</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P></P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Global groups need to be defined only once (in the master domain).</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P></P></TD>

</TR></TBODY></TABLE>
<P CLASS="spacing"><BR></P><H2> </A>Trust Relationships in a Master Domain Model</H2><p><img src="59367.gif"></P>
<p>The master domain is a trusted domain. All other domains are trusting domains linked to the master by one-way trust relationships.</P>
<p>The master domain model splits the network into two different areas of administration:</P>
<ul><li>User accounts&mdash;Located and maintained in the master (trusted) domain</LI><li>Resources&mdash;Located and maintained in the resource (trusting) domains</LI></UL></SPAN><p>Only the domain controllers in the master domain have copies of the master domain account database. In addition to the primary domain controller, there should be at least one backup domain controller in case the primary domain controller goes off-line.</P>
<h3> </A>Groups in a Master Domain Model</H3><p><img src="59368.gif"></P>
<p>Windows NT Server Directory Services use groups in the master domain model for efficiency in communications between domains.</P>
<h3> </A>Local and Global Groups</H3><p>Local and global groups are part of the master domain model. Global groups are important in the master domain model because they are the only groups which can be accessed outside of the domain where they were created.</P>
<p>To simplify administration, a resource domain administrator can place global groups from the master domain into local groups in the trusting domains. When global groups have been added to local groups, the master domain administrator has to add a user to only the global group to give the user access to the local groups' domain resources. </P>
<h3> </A>Groups in Master Domain Model Management</H3><p>To illustrate how global and local groups work together in the master domain model, suppose an SNA Server administrator wants to simplify the task of assigning permissions to SNA Server which is in a trusting domain. The Windows NT Server administrator can create a global group in the master domain called SNAUsers. Then, the administrator could add to this group all the users that need access to SNA Server. </P>
<p>The administrator can add the SNAUsers global group to a local group in each trusting domain and then grant the local group permissions to SNA Server. </P>
<p>Because SNAUsers is a global group, not only is it available across trusts, but all the accounts that need access to the SNA Server can be managed from one global group in a master domain rather than in multiple local groups in each trusting domain.</P>
<p>This example illustrates how the entire network and all its domains and groups can be managed from one computer.</P>
<H2> </A>The Multiple Master Domain Model</H2><p><img src="59369.gif"></P>
<p>Windows NT Server Directory Services are able to maintain one account for each user in the multiple master domain model by extending the concepts of the Master Domain model to several master domains. In this model, accounts are distributed among more than one master domain, and the directory services use trusts to support communications between them. If the trusts are implemented correctly, a user can log on from any domain because pass-through authentication will send the request to the user's home domain for validation.</P>
<h3> </A>The Most Scalable Model</H3><p>For large companies that want centralized administration, the multiple master domain model might be the best choice because it is the most scalable.</P>
<p>Each network user account is created in one of the master domains. Other domains in the network are resource domains, which are typically created at the department level.</P>
<h3> </A>Support for Multiple Administrative Units</H3><p>The multiple master domain model is the best choice for large companies that require multiple administration units spread across the company. With this model, each administrative unit has control of its own accounts. Administrators for each domain can create users and groups and manage those accounts within their own domain. </P>
<p>In a large corporation, for example, Marketing, Sales, Manufacturing, Finance, and other major departments, may want their own administrators to manage the users and groups in their own departments. A multiple master domain model will support this type of corporate structure. </P>
<H4 CLASS="h4"> </A>Multiple Master Domain Summary</H4><p>The following table summarizes the multiple master domain model.</P>

<TABLE COLS="2" BORDER="1" CELLPADDING="7"><COLGROUP><COL WIDTH="168pt" VALIGN="TOP"><COL WIDTH="180pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Advantages</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Disadvantages</P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>This might be the best choice for companies with many users and a centralized MIS department for accounts.</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Both local and global groups might have to be defined multiple times.</P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Scaleable to networks with any number of users.</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>More trust relationships to manage.</P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Resources are grouped logically.</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Not all user accounts are located in one domain.</P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Department domains can have their own administrators who manage the resources in the department.</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P></P></TD>

</TR></TBODY></TABLE>
<P CLASS="spacing"><BR></P><h3> </A>Trust Relationships in a Multiple Master Domain Model</H3><p><img src="59370.gif"></P>
<p>Each master domain is linked to every other master domain by two-way trusts. All of the resource domains trust each of the master domains, but they do not have to trust other resource domains. With this approach, a single administrator is still able to manage the entire network from one location.</P>
<p>As in the other models, each user account is defined only once. Because every user account in the model exists in only one of the master domains and all domains in the model trust every master domain, every user account in the model is available to all domains.</P>
<p>Users log on to the master domain that contains their account. Each master domain should contain two or more Windows&nbsp;NT Server domain controllers (for redundancy) to validate user logons. After logging on to their master domain, users can access any resource for which they have permissions. This extends to any domain in the network because all resource domains trust all master domains.</P>
<h3> </A>Determining the Number of Trusts</H3><p>The following formula can be used to find the number of trusts in a multiple master domain model.</P>
<p>M*(M-1)+(R*M) where M is the number of master domains and R is the number of resource domains. </P>
<p>Using the network pictured in the slide as an example, with two master domains and three resource domains, the formula would be filled out as follows: 2*(2-1)+(3*2). This would equal 2*1+6 which would equal 8. This is the number of trusts in the network pictured in the slide when it is understood that the two-way trust connecting the two master domains is actually two one-way trusts.</P>
<p>The number of trusts can be a factor in determining an appropriate domain structure, because structures with the fewest number of trusts are generally considered to be the most efficient and easiest to maintain.</P>
<h3> </A>Groups in a Multiple Master Domain Model</H3><p><img src="59371.gif"></P>
<p>Global groups require more planning in this model than in the master domain model. For example, if a local group needs to contain groups from two or more master domains, a global group must be created in each master domain. These global groups are then made members of the local group. </P>
<h3> </A>Groups in Multiple Master Domain Model Management</H3><p>To illustrate how global and local groups work together in the multiple master domain model, an SQL Server administrator will use groups to assign access to resources on an SQL Server in a trusting domain. </P>
<p>First, the domain administrator creates a global group for SQL in each master domain. The names of the global groups indicate their purpose and the master domain in which they were created, such as DomASQL, for the SQL group in Domain A. The administrator adds all the users from Domain A needing access to the SQL Servers to the DomASQL global group. Then, the administrator adds the DomASQL global group to the appropriate local group in the trusting domains. The administrator repeats the process for each master domain.</P>
<p>New accounts that need access to SQL Server can simply be added to the SQL global group in their home domain.</P>
<h3> </A>Simplifying the Process</H3><p>To simplify implementing a multiple master domain model:</P>
<ul><li>Distribute users among the master domains by organizational function within the company (instead of distributing users alphabetically).</LI><li>Create local groups in the resource domains, and make global groups (from the account domains) members of the local groups.</LI></UL></SPAN><h3> </A>The Complete Trust Domain Model</H3><p><img src="59372.gif"></P>
<p>The Complete Trust model makes more extensive use of Windows NT Server Directory Services than any other model because this model uses trusts to implement two-way communication among all the domains in the network.</P>
<p>If you want the management of users and resources to be distributed among different departments, rather than be centralized, you might want to use the complete trust model. With this model, every domain on the network trusts every other domain; no single domain exerts control over the others. The complete trust model distributes the administration of users, groups, domains, and resources among different departments rather than centralizing it.</P>
<h3> </A>Complete Trust Summary</H3><p>The following table summarizes the complete trust model:</P>

<TABLE COLS="2" BORDER="1" CELLPADDING="7"><COLGROUP><COL WIDTH="162pt" VALIGN="TOP"><COL WIDTH="175pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Advantages</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Disadvantages</P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Best for companies with no central MIS group.</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Because there is no central management of users, this model is not practical for companies with central MIS departments.</P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Scalable to networks with any number of users.</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Very large number of trust relationships to manage.</P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Each department has full control over its user accounts and resources.</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Each department must trust that the other departments will not put inappropriate users into global groups.</P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Both resources and user accounts are grouped into departmental units.</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P></P></TD>

</TR></TBODY></TABLE>
<P CLASS="spacing"><BR></P><h3> </A>Trust Relationships in a Complete Trust Domain Model</H3><p><img src="59373.gif"></P>
<p>In the complete trust model, every domain in the network trusts every other domain. Each department manages its own domain and defines its own users and global groups. These users and global groups can be used on all domains in the complete trust model. For example, a global group created in Domain D is available to Domains A, B and C when using complete trust model.</P>
<h3> </A>Determining the Number of Trusts</H3><p>The following formula will produce the number of trust relationships required to implement a complete trust:</P>
<P CLASS="i"><I>n</I> * (<I>n</I>–1)     Where <I>n</I> is the number of domains.</P>
<p>For example, 4 domains require 12 trust relationships (4 x [4 – 1]), and 10 domains require 90 trust relationships. Adding a new domain to an existing network of 10 domains requires establishing 20 new trust relationships.</P>
<p>As mentioned earlier, the number of trusts can be a factor in enterprise management, because structures with the fewest number of trusts are generally considered to be the most efficient and easiest to maintain.</P>
<P CLASS="nt"><B>Caution</B>  Because there is no central administration in the complete trust model, users from other domains with access to resources could pose a security risk. This model requires a high degree of confidence in global groups from other trusted domains. When you give permissions to a global group from another domain (or place that global group in a local group in your domain), you are trusting the administrator of the other domain not to add any unauthorized or inappropriate users to that global group.</P>
<H2> </A>Section 4 Overview</H2><p><img src="59374.gif"></P>
<h3> </A>Objectives</H3><p>By the end of this section, you will be able to:</P>
<ul><li>Identify the primary problem areas in implementing servers to achieve an efficient directory structure.</LI><li>Determine the optimum number of domain controllers.</LI><li>Determine effective server locations in a domain.</LI><li>Identify the role of the Net Logon Service in Windows NT Server Directory Services operation.</LI><li>Implement domain controllers to effectively accommodate synchronization.</LI><li>Implement domain controllers to achieve efficient pass-through authentication.</LI></UL></SPAN><H2> </A>Building an Effective Directory Services Structure</H2><p><img src="59375.gif"></P>
<p>Achieving efficient network operations requires more than simply installing Windows NT Server and indicating whether a server is going to be a domain's PDC or a BDC. The network designer must also consider communication between:</P>
<ul><li>Users and servers</LI><li>PDCs and BDCs</LI></UL></SPAN><p>In order to achieve optimum communication among servers and users, the network designer needs to create a system with the following characteristics:</P>

<TABLE COLS="2" BORDER="1" CELLPADDING="7"><COLGROUP><COL WIDTH="95pt" VALIGN="TOP"><COL WIDTH="245pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Characteristic</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Details</P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>The appropriate number of controllers</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>If the network does not have enough controllers (PDCs and BDCs), it won't be able to accommodate its accounts properly. Too many controllers, on the other hand, simply wastes resources.</P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>The appropriate location of the servers</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Knowing where to put servers can make the difference between an efficient network that serves its users as an effective business tool or an inefficient, assemblage of servers and workstations that has the potential to hinder business rather than help.</P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Efficient Synchronization</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Synchronization makes wide-area network operations possible, but it has the potential to interfere with network operations at inconvenient times. Therefore, knowing how to implement the network so synchronization can take place as efficiently as possible is essential if the network is going to support users properly.</P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Efficient Pass-Through Authentication</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Because authentication requests generate network traffic, they must be validated as efficiently as possible so as not to interfere with business communication.</P></TD>

</TR></TBODY></TABLE>
<P CLASS="spacing"><BR></P><p>This module explores each of these areas and draws on concepts already presented to prepare a network designer to implement servers properly. This phase of implementing Windows NT Server Directory Services will produce the most efficient network possible.</P>
<H2> </A>Determining the Optimum Number of Domain Controllers</H2><p><img src="59376.gif"></P>
<p>In domain planning, determining the proper number of controllers (PDCs and BDCs) is a major issue. Considerations and questions a network designer will have to address include:</P>
<ul><li>Number of Accounts
<P CLASS="lp1">How many accounts can a domain store efficiently? </P></LI><li>Size and Speed of Domain Controllers
<P CLASS="lp1">How should the domain controllers be configured?</P></LI><li>Number and location of Master Domains
<P CLASS="lp1">What is the optimum number of master domains and where should they be located? Will there be one master domain or multiple master domains?</P></LI><li>Number and location of Resource Domains
<P CLASS="lp1">What is the optimum number of resource domains, and where should they be located?</P></LI><li>Number of Backup Domain Controllers
<P CLASS="lp1">What contributes to validation traffic?</P></LI></UL></SPAN><h3> </A>The Number of Accounts</H3><p><img src="59377.gif"></P>
<p>A domain's accounts include:</P>
<ul><li>User accounts</LI><li>Computer accounts</LI><li>Group accounts (built-in and custom)
<P CLASS="nt"><B>Note:</B>  Only NT-based machines are entered into the database.</P></LI></UL></SPAN><p>Each account is stored in the SAM (Security Accounts Manager) file as an object. A domain can support 40,000 accounts. This is a major criteria in choosing a domain model because it is involved in determining how many domains the network will need. </P>
<h3> </A>Directory Database Limits</H3><p><img src="59378.gif"></P>
<p>The practical limit for the size of the directory database depends on:</P>
<ul><li>The type of computer processor
<P CLASS="lp1">A 486/33 can not process as many simultaneous logon requests as a Pentium or RISC processor.</P></LI><li>The amount of memory available in the machine being used to administer the domain
<P CLASS="lp1">A machine with 16 MB can not effectively support as many users as a machine with 128 MB or more memory.</P></LI></UL></SPAN><h3> </A>The 40 MB Limit</H3><p>Although SAM files larger than 40 MB have been tested, Microsoft recommends an upper limit of 40 MB because SAM files larger than 40 MB may take several minutes to load into memory.</P>
<h3> </A>Space in the SAM File</H3><p>As the slide shows, different types of objects require different amounts of space in the SAM file.</P>
<h3> </A>Objects in the Directory Database</H3><p><img src="59379.gif"></P>
<p>The slide contains some examples of how objects might be distributed in a single domain.</P>
<p>A network designer can use the tables in this and the previous slide to determine the approximate size of the directory database. This is extremely useful when planning the number of Master Domains. If the SAM file will exceed 40MB, the network will probably need a multiple master domain model. </P>
<P CLASS="nt"><B>Note:</B>  The numbers in the table can be applied to domains that comprise a single master and multiple master domain</P>
<h3> </A>Calculating Space Used by Group Accounts</H3><p><img src="59380.gif"></P>
<p>Use the following job aid to determine the amount of space used by groups. Complete for all groups in a domain: Local, Global and Built In.</P>
<h3> </A>Domain Controller Size and Speed</H3><p><img src="59381.gif"></P>
<p>Factors that affect the number of users a PDC can support include:</P>
<ul><li>The amount of disk space</LI><li>Memory</LI><li>CPU type and speed</LI></UL></SPAN><p>For example, a 486/33 with 16MB of memory can not effectively support the number of users that a Pentium, MIPS, Alpha&nbsp;AXP, or PowerPC with 128 MB of memory can support.</P>
<h3> </A>CPU Guidelines</H3><p>When selecting a computer for a PDC or BDC, use the guidelines presented in the slide:</P>
<P>PDC/BDC Hardware Requirements</P>

<TABLE COLS="6" BORDER="1" CELLPADDING="7"><COLGROUP><COL WIDTH="85pt" VALIGN="TOP"><COL WIDTH="94pt" VALIGN="TOP"><COL WIDTH="4pt" VALIGN="TOP"><COL WIDTH="139pt" VALIGN="TOP"><COL WIDTH="6pt" VALIGN="TOP"><COL WIDTH="70pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>SAM file size</P></TD>

<TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>Number of User accounts*</P></TD>

<TD COLSPAN="2" VALIGN="TOP"><P>Minimum CPU Needed</P></TD>

<TD COLSPAN="3" VALIGN="TOP"><P>Recommended RAM+</P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>5 MB</P></TD>

<TD COLSPAN="2" VALIGN="TOP"><P>up to 3,000</P></TD>

<TD COLSPAN="3" VALIGN="TOP"><P>486DX/33</P></TD>

<TD COLSPAN="3" VALIGN="TOP"><P>32 MB</P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>10 MB</P></TD>

<TD COLSPAN="2" VALIGN="TOP"><P>7,500</P></TD>

<TD COLSPAN="3" VALIGN="TOP"><P>486DX/66</P></TD>

<TD COLSPAN="3" VALIGN="TOP"><P>32 MB</P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>15 MB</P></TD>

<TD COLSPAN="2" VALIGN="TOP"><P>10,000</P></TD>

<TD COLSPAN="3" VALIGN="TOP"><P>Pentium, MIPS, Alpha&nbsp;AXP</P></TD>

<TD COLSPAN="3" VALIGN="TOP"><P>48 MB</P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>20 MB</P></TD>

<TD COLSPAN="2" VALIGN="TOP"><P>15,000</P></TD>

<TD COLSPAN="3" VALIGN="TOP"><P>Pentium, MIPS, Alpha&nbsp;AXP</P></TD>

<TD COLSPAN="3" VALIGN="TOP"><P>64 MB</P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>30 MB</P></TD>

<TD COLSPAN="2" VALIGN="TOP"><P>20,000 - 30,000</P></TD>

<TD COLSPAN="3" VALIGN="TOP"><P>Pentium, MIPS, Alpha&nbsp;AXP</P></TD>

<TD COLSPAN="3" VALIGN="TOP"><P>96 MB</P></TD>

</TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><P>40 MB</P></TD>

<TD COLSPAN="2" VALIGN="TOP"><P>30,000 - 40,000</P></TD>

<TD COLSPAN="3" VALIGN="TOP"><P>Pentium, MIPS, Alpha&nbsp;AXP</P></TD>

<TD COLSPAN="3" VALIGN="TOP"><P>128 MB</P></TD>

</TR></TBODY></TABLE>
<P CLASS="spacing"><BR></P><p>*User account numbers are approximate. The exact SAM file size is dependent on the number of user accounts, computer accounts, and group accounts. </P>
<h3> </A>The Number of Master Domains</H3><p><img src="59382.gif"></P>
<p>The number of Master Domains to configure for a network is based almost entirely on two items:</P>
<ul><li>The total number of users
<P CLASS="lp1">The total number of users impacts the number of master domains because domains are generally limited to 40,000 users. A network that must accommodate 50,000 users, for example, will need more than one master domain.</P></LI><li>The number of administrative units in the organization</LI></UL></SPAN><h3> </A>A Master Domain Scenario</H3><p>To illustrate how planning for master domains should focus on administrative units, suppose a company wants to implement a master domain model with administrative units located in the following areas:</P>
<ul><li>North America</LI><li>Europe</LI><li>Asia</LI></UL></SPAN><p>The simplest design would incorporate three Master Domains, one for each administrative unit. This would give each administrative unit control of user accounts in a particular area unless one of the domains had more than 40,000 users, in which case the crowded domain could be split into two master domains.</P>
<h3> </A>Determining the Correct Number of Master Domains</H3><p><img src="59383.gif"></P>
<p>The job aid in the slide will help determine the correct number of master domains for a network. Notice that the number of users in a domain is a function of the size of the SAM database.</P>
<P CLASS="nt"><B>Note</B>   The single domain model and the single master domain model can accommodate at least 26,000 user accounts if both user accounts and computer accounts are stored in the database. Only NT-based computers count in these calculations.</P>
<h3> </A>Locating the Master Domains</H3><p><img src="59384.gif"></P>
<p>Illustrate how domains are created to reflect a company's organization: a large company might have domains for research, marketing, human resources. The key is the administrative structure of the organization.</P>
<p>The planning and implementation of Master Domains depends on the administrative structure of the organization being networked rather than physical locations.</P>
<p>In a large company, for example, the following departments, regardless of where they are physically located, might have their own domains:</P>
<ul><li>Finance</LI><li>Human resources</LI><li>Marketing</LI><li>Support</LI></UL></SPAN><h3> </A>Location of the PDC</H3><p>Within a domain, the PDC should be situated in or near the heaviest network administrative and support activity so it can accommodate this traffic with the fewest delays.</P>
<h3> </A>Size of the PDC and BDC</H3><p>In certain circumstances, you may choose to install the PDC on a smaller, less powerful computer than the BDCs. For example, your company's MIS department controls all user accounts. For management and backup purposes, MIS wants the PDCs to be located at headquarters in Europe. </P>
<p>The domain structure is based on geographical locations with master domains located in Asia, Europe, and North America. The BDCs located in Asia and North America will process almost all of the logon and validation requests from the resource domains. Because the BDCs in this environment do more work than the PDC, they should be faster, more powerful machines than the PDC.</P>
<h3> </A>Resource Domains</H3><p><img src="59385.gif"></P>
<p>The administrator will have to determine whether each department will be a separate resource domain. If a department has resources over which it wants to retain administrative control, then it may need its own domain. This approach, however, may create a network with a large number of resource domains. The alternative would be a network with a large master domain at the division or business unit level and fewer numbers of resource domains.</P>
<h3> </A>Determining the Number of Domain Controllers in Resource Domains</H3><p>Each resource domain will require its own Primary Domain Controller. Additional servers within a resource domain may be configured as Backup Domain Controllers, but they can also be used as resource servers.</P>
<h3> </A>Determining the Location of Master Domain BDCs</H3><p>When a user accesses a resource domain, the PDC or a BDC in the resource domain contacts the master domain to validate the user. Therefore, placing Master Domain BDCs close to where users are located will decrease the amount of time it takes for the Master Domain to validate users accessing resource domains. </P>
<h3> </A>The Number of Backup Domain Controllers</H3><p><img src="59386.gif"></P>
<p>A BDC with the following configuration will support approximately 2,000 users:</P>
<ul><li>CPU    486/66</LI><li>RAM    32 MB of RAM</LI><li>OS        Windows&nbsp;NT Server.</LI></UL></SPAN><h3> </A>A Guide to BDCs</H3><p>The table in the slide is a guide to the number of BDCs required to provide logon validation of user accounts in Master Domains.</P>
<P CLASS="nt"><B>Note</B>   The table assumes there are no special demands on the BDCs which would require specifications other than those listed. In determining the number of BDCs a domain needs, the network designer should take into account the fact that BDCs can also be used as resource servers.</P>
<h3> </A>Determining Effective Server Locations</H3><p><img src="59387.gif"></P>
<p>Some of the factors involved in determining the physical distribution of BDCs include: </P>
<ul><li>Line speed</LI><li>Link reliability</LI><li>Administrative access</LI><li>Protocol</LI><li>User authentication requirements</LI><li>The number of users to be supported at a site</LI><li>Locally available resources</LI></UL></SPAN><h3> </A>A Network's Sites</H3><p>A network designer should think of the networked organization in terms of sites. A site is a well-connected LAN&mdash;it may be divided into parts that are connected by fast links such as bridges and routers, but not asynchronous WAN links (slow links) such as T1, 56K, or ISDN.</P>
<p>Network sites often correspond to geographical locations such as London, Paris, or New York. As part of planning, a network designer should determine whether the networked organization is:</P>
<ul><li>One location (a well-connected LAN)</LI><li>Several locations connected by WAN links</LI></UL></SPAN><p>If different parts of the organization are connected by WAN links, the network designer will have to determine the effects of the links on network performance.</P>
<H4> </A>WAN Links</H4><p><img src="59388.gif"></P>
<p>The speed and quality of WAN links may dictate the creation of domains and the placement of backup domain controllers.</P>
<h3> </A>Traffic Across a Link</H3><p>When a WAN link is involved, a network planner needs to answer two questions to determine where to place a domain's BDCs.</P>
<ul><li>What is the current volume of traffic across the WAN link?</LI><li>What will the volume of traffic across the WAN link be in 6 or 12 months?</LI></UL></SPAN><h3> </A>Planning to Avoid the Effect of Slow Links</H3><p>A network designer's primary BDC planning considerations are:</P>
<ul><li>The location of BDCs that will act as account log-on servers</LI><li>The volume of account synchronization traffic across WAN links</LI></UL></SPAN><p>Most users will need the fastest possible logon service and will also need efficient access to resources even if the resources are across a WAN link. </P>
<h3> </A>BDC Locations</H3><p>When links degrade network performance noticeably, the network planner should eliminate logon traffic across them by moving the BDCs to the location where most of the logons are taking place. A practical solution is for the network planner to place a BDC on each side of the WAN link so the pass through validation traffic is kept off the WAN link.</P>
<h3> </A>Bandwidth Considerations</H3><p>The network planner has to consider the cost of quick logons versus synchronization time across the WAN link. The planner needs to determine how much of the WAN link bandwidth is used for processing logon requests locally. If a BDC is placed at the remote site, how much of the bandwidth will be used by synchronizing the directory services database?</P>
<h3> </A>The NetLogon Service</H3><p><img src="59389.gif"></P>
<p>The communication that occurs between domains is governed by the NetLogon service. It is responsible for three functions which affect network performance:</P>
<ul><li>Logon validation&mdash;When a user logs on to a Windows&nbsp;NT Server domain, the Net Logon service validates that user.</LI><li>Synchronization of BDC(s) with PDC&mdash;Keeps the directory services databases synchronized between the primary domain controller and the backup domain controller(s).</LI><li>Pass-through authentication&mdash;This occurs when a user account must be validated, but the local computer or domain cannot validate the account. In this case, the user name and password are forwarded to a Windows&nbsp;NT Server domain controller that can validate the user, and the user's information is returned to the requesting computer.
<P CLASS="nt"><B>Note</B>   Each Windows&nbsp;NT–based computer participating in the domain must be running the NetLogon and Workstation services.</P></LI></UL></SPAN><h3> </A>Starting and Stopping the NetLogon Service</H3><p>A Microsoft Windows&nbsp;NT Server starts the NetLogon service by default. However, a network administrator can use the Server Manager or the Control Panel Services option to start or stop the NetLogon service.</P>
<H2> </A>Implementing Effective Synchronization</H2><p><img src="59390.gif"></P>
<p>Directory services database synchronization (replication) occurs when a PDC copies, or replicates, its directory database to the BDCs within a domain. The NetLogon Service controls the directory database synchronization process.</P>
<h3> </A>The Synchronization Process</H3><p>When synchronization occurs, the PDC announces that a change in the directory services database has taken place. A BDC then calls the PDC and requests the changes.</P>
<h3> </A>Full Synchronization</H3><p>Full synchronization occurs when the PDC sends its entire directory services database to a BDC. Full synchronization occurs when bringing a new PDC online. </P>
<h3> </A>Initiating Full Synchronization</H3><p>The change log controls whether a full or partial synchronization takes place. Each change entry is typically 32 bytes. The default size for the change log is 64K, which means it will hold approximately 2,000 changes. Each change will be represented by a version or serial number in the change log. When the change log becomes full, the change log wraps and overwrites existing version numbers. If the BDC sees that the last change it received has been overwritten, the BDC will initiate a full synchronization. </P>
<h3> </A>Partial Synchronization</H3><p>A partial synchronization occurs when the PDC sends only the changes in the directory services database that have occurred since the last synchronization. A full synchronization of the directory services database is not necessary when a PDC changes. The PDC keeps track of the synchronization level of each BDC, which allows the PDC to control the rate of partial synchronization.</P>
<h3> </A>Regulating Partial Synchronization</H3><p>The PDC sends a message announcing a change in the directory services database to only the domain's BDCs that need the changes instead of to all BDCs. These messages are sent to a subset of a domain's controllers in each pulse (the subset is defined by the PulseConcurrency parameter). This prevents all BDCs from responding simultaneously, which helps to reduce network traffic and also ensures that the PDC does not become overloaded by the BDCs.</P>
<h3> </A>Synchronization over WAN and RAS Links</H3><p>Consideration should be given to the amount of traffic that account synchronization places on a WAN or RAS dial-up line. In particular, the network should avoid full synchronization across WAN links because the slow speed across the link will affect total network performance. </P>
<h3> </A>Controlling Aspects of Synchronization</H3><p>The network administrator can control different aspects of synchronization and, therefore, network performance, through several items in the Windows NT Server Registry.</P>
<P CLASS="nt"><B>Note</B>   The Registry items are summarized in Appendix A.<BR>For more information on synchronization parameters, see Appendix B, "Registry Value Entries," in Volume 4 of the <I>Microsoft Windows&nbsp;NT Resource Kit</I>.</P>
<h3> </A>Calculating Replication Times</H3><p><img src="59391.gif"></P>
<p>An important aspect of network administration is managing the amount of network traffic so that response time remains acceptable. </P>
<h3> </A>Estimating Replication Time</H3><p>When the PDC is separated from BDCs by a WAN or modem link, the administrator can use the table to estimate the amount of data and time needed to replicate directory database changes.</P>
<H4> </A>Job Aid 3 Calculate Amount of Data to be Replicated</H4><p><img src="59392.gif"></P>
<H4> </A>Job Aid 4 Calculate Monthly Replication Time</H4><p><img src="59393.gif"></P>
<h3> </A>Adjusting Synchronization Over a Slow WAN Link</H3><p><img src="59394.gif"></P>
<p>A BDC uses the ReplicationGovernor parameter in the Windows NT Registry to increase the performance of domain synchronization over a slow WAN link. This requires both the BDC(s) and PDC to be running Windows&nbsp;NT Server 3.5<I>x</I>.</P>
<h3> </A>Adjusting the Replication Governor</H3><p>Adjusting the ReplicationGovernor is important because for each Windows&nbsp;NT Server 3.5<I>x</I> BDC, the ReplicationGovernor parameter defines:</P>
<ul><li>The size of the data transferred on each call to the PDC.</LI><li>The frequency of those calls.</LI></UL></SPAN><p>Adjusting the ReplicationGovernor parameter has the following effects:</P>
<ul><li>It reduces the size of the buffer used on each call from the BDC to the PDC, ensuring that a single call does not consume the WAN link for too long. </LI><li>It causes NetLogon to essentially "sleep" between calls, allowing other applications to access the WAN link between calls to the PDC.</LI></UL></SPAN><h3> </A>Adding the Replication Governor to the Registry</H3><p>The ReplicationGovernor parameter can be added to the Registry of a BDC under the following key:</P>

<pre><FONT FACE="Courier New" SIZE="3">\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters</font></pre>
<p>To add this parameter, assign a type of REG_DWORD and a value from zero to 100 (the default is 100). This value defines a percentage for both the amount of the data transferred on each call to the PDC and the frequency of those calls. For instance, setting the ReplicationGovernor value to 50 will use a 64K buffer rather than the default 128K buffer. In addition, the BDC will have an outstanding synchronization call on the network for only a maximum of 50 percent of the time.</P>
<P CLASS="nt"><B>Caution</B>   Care must be taken in setting this value. If the ReplicationGovernor is set too low, synchronization might never complete. A value of zero will cause NetLogon never to synchronize, and the directory database can become completely out of synchronization. This parameter must be set individually on each BDC and should only be used when the PDC is a computer running Windows&nbsp;NT Server 3.5<I>x</I>.</P>
<h3> </A>Implementing Different Replication Rates</H3><p>It is theoretically possible to have different replication rates at different times throughout the day. A network administrator can implement this by adjusting the ReplicationGovernor parameter in the Registry and then restarting the NetLogon service from within a batch file that is scheduled by means of the AT command. Such a batch file could be created using the REGINI.EXE command from the Windows&nbsp;NT Resource Kit and would, for example, contain:</P>

<pre><FONT FACE="Courier New" SIZE="3">    regini <I>scriptfile</I>
    net stop netlogon
    net start netlogon</font></pre>
<p>The <I>scriptfile</I> would contain the full path in the Registry to the ReplicationGovernor parameter and the new value selected for it.</P>
<P CLASS="nt"><B>Note</B>   For more information, see the "Resource Kit Tools Help" (RKTOOLS.HLP) Help file of the<I> Microsoft Windows&nbsp;NT Resource Kit</I> regarding REGINI.EXE and creating script files for REGINI.EXE.</P>
<H2> </A>Implementing Efficient Pass-Through Authentication</H2><p><img src="59395.gif"></P>
<p>When a user attempts to access a resource in a trusting domain, one of the domain controllers from the trusting domain passes the request through a trust to the trusted domain to verify the user.</P>
<h3> </A>The Impact of Pass-Through Authentication</H3><p>Because a validation request travels on the network cable, pass through authentication generates additional network traffic. If the domains are broken up geographically, and the validation request must cross links, the validation may also generate an increased number of time outs and retries. If the request must cross a slow link, network performance will suffer.</P>
<h3> </A>Implementing Local Validation</H3><p>To reduce the amount of network traffic across WAN links, the administrator can place additional BDCs in strategic locations in the domains from which requests originate. This way, users can avoid links and be validated locally. Local validation is a good option for organizations that have large numbers of users who travel between the different locations.</P>
<h3> </A>Modifying Authentication</H3><p>Authentication can be modified to meet organizational needs. If most of the users will be accessing only one other domain on a regular basis, the network designer should consider placing BDCs in that domain only.</P>
<h3> </A>Performance Considerations</H3><p>Synchronizing changes in the accounts database to BDCs will generate additional traffic across links. However, occasional synchronizing will not affect network performance as much as frequent log on and validation requests across the same links.</P></BODY></HTML>
