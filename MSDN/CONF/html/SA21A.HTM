<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>How it Works</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>	<BODY bgcolor="#FFFFFF" link=#003399 vlink=#996699>


	<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

	<!--TOOLBAR_START-->
	<!--TOOLBAR_EXEMPT-->
	<!--TOOLBAR_END-->

<h3>How it Works</H3><H4> </A>Distributing a Section</H4><p>Sections are actually stored as Word subdocuments. The following are the key bits of code to distribute a section.</P>
<p>Open the subdocument</P>
<P CLASS="spacing"><BR></P>
<pre><FONT FACE="Courier New" SIZE="3">    ViewMasterDocument
    OpenSubdocument
    ScreenRefresh</font></pre>
<p>Store the owner name and address in the subdocument (this is used to know where to return the document later)</P>
<P CLASS="spacing"><BR></P>
<pre><FONT FACE="Courier New" SIZE="3">    EditGoTo "\headinglevel"
    CharLeft
    LineDown 1, 1
    ReportTitle$ = Selection$()
    result = Constants.fCurrentUser(OwnerName$, OwnerAddress$)
    result = SetDocumentVar("OwnerName", OwnerName$)
    result = SetDocumentVar("OwnerAddress", OwnerAddress$)
    result = SetDocumentVar("ReportTitle", ReportTitle$)    </font></pre>
<p>Send the document via calls to MAPISetAttachment and MAPISendMail</P>
<P CLASS="spacing"><BR></P>
<pre><FONT FACE="Courier New" SIZE="3">If SendMailDialog(ReportTitle$, FName$) = - 1 Then

Function SendMailDialog(Subject$, Attachment$)
    MAPI_LOGON_UI = 1
    MAPI_DIALOG = 8
    Session = MAPILogon(0, "", "", MAPI_LOGON_UI, 0)
    result = MAPISetAttachment("", Attachment$, - 1, 0, 0)
    result = MAPISendMail(Session, 0, Subject$, \
        "Please complete this report.", MAPI_DIALOG, 0)
    SendMailDialog = result
    result = MAPILogoff(Session, 0, 0, 0)
End Function</font></pre>
<H4> </A>Returning a Section</H4><p>Returning a section involves automatically determining where to send it from entries in document variables. The following are the key bits of code to return a section.</P>
<p>Get Address to return to</P>
<P CLASS="spacing"><BR></P>
<pre><FONT FACE="Courier New" SIZE="3">        OwnerName$ = GetDocumentVar$("OwnerName")
        OwnerAddress$ = GetDocumentVar$("OwnerAddress")</font></pre>
<p>Log on to MAPI</P>
<P CLASS="spacing"><BR></P>
<pre><FONT FACE="Courier New" SIZE="3">        Session = MAPILogon(0, "", "", MAPI_LOGON_UI, 0)</font></pre>
<p>Set the recipient and attachment</P>
<P CLASS="spacing"><BR></P>
<pre><FONT FACE="Courier New" SIZE="3">        result = MAPISetRecipient(1, OwnerName$, OwnerAddress$)
        result = MAPISetMessageType(MessageType$)
        result = MAPISetAttachment("", fName$, - 1, 0, 0)</font></pre>
<p>Call MAPISendMail to send the document</P>
<P CLASS="spacing"><BR></P>
<pre><FONT FACE="Courier New" SIZE="3">        result = MAPISendMail(session, 0, Subject$, "", 0, 0)
        If result &gt;= 0 Then
            MsgBox "Section sent to " + Ownername$ + ".", 64
        End If</font></pre>
<p>Log off MAPI</P>
<P CLASS="spacing"><BR></P>
<pre><FONT FACE="Courier New" SIZE="3">        result = MAPILogoff(Session, 0, 0, 0)</font></pre></BODY></HTML>
