

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>BUG: Set-Cookie Is Ignored in CGI When Combined With Location </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q176113">
<META NAME="KBModify" CONTENT="1997/11/07">
<META NAME="KBCreate" CONTENT="1997/11/03">
<META NAME="Keywords" CONTENT="">
<META NAME="KBArea" CONTENT="Support; KB; ISAPI">
<META NAME="Description" CONTENT="  When a CGI application sends a Set-Cookie header with  302 Object Moved  response and Location header, Internet Information Server (IIS) ignores the cookie header.  RESOLUTION  This behavior is in violation of the CGI specification, which states,  ...">
<META NAME="Product" CONTENT="ISAPI">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBXP,QA3N,QA5W,QAH4,QAVZ,QAQW,QAF8,QABA,QABI,QBVV,QA9N,QAUD,QANJ,QAEF,QABB V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Set-Cookie Is Ignored in CGI When Combined With Location</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 7, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q176113</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Internet Information Server versions 3.0, 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When a CGI application sends a Set-Cookie header with "302 Object Moved"
response and Location header, Internet Information Server (IIS) ignores the
cookie header.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
This behavior is in violation of the CGI specification, which states, "Any
headers that are not server directives are sent directly back to the
client. Currently, this specification defines three server directives..."
<P>
As a workaround, make sure the file name of the EXE begins with "nph-" and
manually create all HTTP headers in your program. "nph-" indicates to the
server that the CGI program is to be run in non-parsed headers mode. CGI
has two modes. In normal mode (parsed headers), you must send one of the
CGI directives to standard output (Content-type, Location, or Status). CGI
formats a valid HTTP response line based on the directive you sent. It
formats other standard HTTP headers for you, and it should include any
other headers that you have specified.
<P>
The other mode is non-parsed header mode. In this mode CGI does not set any
headers itself. The CGI program must format a full HTTP response including
the response line and all headers. The server will not add or modify any
headers for you in this mode.
<P>
The convention is that a CGI program whose name begins with "nph-" is run
in non-parsed header mode; otherwise, CGI programs are run in parsed header
mode.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article. We are researching this bug and will post
new information here in the Microsoft Knowledge Base as it becomes
available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 
<P>
Compile this CGI program as a Win32 Console Application and place it in a
folder on your IIS server where it can be executed:
<P>
<PRE>   #include &lt;stdio.h&gt;
   int main()
   {
     printf("Location: %s\r\n", "<B>http://www.yahoo.com</B>");
     printf("Set-Cookie: Name1=Value1; path=/;
       expires=Fri, 22 May 1998 21:00:00 GMT\r\n\r\n");
     return 0;
   }

</PRE>Call the CGI program from your browser and observe its output (via Network
Monitor, for example). It will be similar to this:
<P>
<PRE>   HTTP/1.0 302 Object moved
   Location: <B>http://www.yahoo.com</B>
   Server: Microsoft-IIS/2.0
   Content-Type: text/html
   Content-Length: 145

   &lt;head&gt;&lt;title&gt;Document moved&lt;/title&gt;&lt;/head&gt;
   &lt;body&gt;&lt;h1&gt;Object Moved&lt;/h1&gt;This document may be found
   &lt;a HREF="<B>http://www.yahoo.com</B>"&gt;here&lt;/a&gt;&lt;/body&gt;

</PRE>Note that the Set-Cookie header has not been sent by IIS. If you have
cookie warnings turned on in your browser, no warning appears.
<P>
To allow a cookie to be set in a 302 response, use code similar to the
following, and prefix "nph-" to the name of the executable file:
<P>
<PRE>   #include &lt;stdio.h&gt;
   int main()
   {
     printf("HTTP/1.0 302 Redirect\r\n");
     printf("Location: %s\r\n", "<B>http://www.yahoo.com</B>");
     printf("Set-Cookie: Foo=Bar; path=/; expires=Fri, 22 May 1998 21:00:00
      GMT\r\n\r\n");
     return 0;
   }

</PRE>The output is similar to the following. Note that the cookie is now sent,
and no headers are added by the server.
<P>
<PRE>   HTTP/1.0 302 Redirect
   Location: <B>http://www.yahoo.com</B>
   Set-Cookie: Foo=Bar; path=/; expires=Fri, 22 May 1998 21:00:00 GMT

</PRE><h2>REFERENCES</h2>
 
<P>
CGI specification:  <B><A HREF="http://hoohoo.ncsa.uiuc.edu/cgi/">http://hoohoo.ncsa.uiuc.edu/cgi/</A></B>
<P>
(c) Microsoft Corporation 1997, All Rights Reserved. Contributions by Leon
Braginski, Microsoft Corporation
 
<PRE>Technology        : kbInetDev
Version           : WINNT:3.0,4.0
Platform          : winnt
Issue type        : kbbug</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 7, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
