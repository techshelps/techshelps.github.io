

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>CountDirectories() Fails on Novell NetWare Server Drive </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q122309">
<META NAME="KBModify" CONTENT="1997/08/05">
<META NAME="KBCreate" CONTENT="1994/11/01">
<META NAME="Keywords" CONTENT="kbmacroexample">
<META NAME="KBArea" CONTENT="Support; KB; word, convert, crossnet, odbc, winprint, setup">
<META NAME="Description" CONTENT="  The Microsoft WordBasic CountDirectories() function does not include subdirectories in empty directories on a Novell NetWare server drive. Consider the following directory structure:     F:\DOCS    F:\DOCS\1995    F:\DOCS\Plan  If the current direc...">
<META NAME="Product" CONTENT="Word">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA4Q,QBXB,QATJ,QAFI,QAY5,QAIH,QBV8,QAB9,QAUD,QAI4,QAH4,QAGU,QA5F,QA8Y,QDMG V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>CountDirectories() Fails on Novell NetWare Server Drive</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  August 5, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q122309</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Word for Windows, versions 6.0, 6.0a, 6.0c
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The Microsoft WordBasic CountDirectories() function does not include
subdirectories in empty directories on a Novell NetWare server drive.
Consider the following directory structure:
<P>
<PRE>   F:\DOCS
   F:\DOCS\1995
   F:\DOCS\Plan

</PRE>If the current directory is F:\DOCS, the CountDirectories() function should
return 2 in order to indicate that there are two directories in the DOCS
directory. However, if the DOCS directory doesn't contain any files, the
CountDirectories() function returns zero (0) when the current drive is a
Novell NetWare server drive.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
The following WordBasic function uses Windows API calls to determine how
many directories stem from the current directory.
<P>
WARNING: ANY USE BY YOU OF THE CODE PROVIDED IN THIS ARTICLE IS AT YOUR OWN
RISK. Microsoft provides this macro code "as is" without warranty of any
kind, either expressed or implied, including but not limited to the implied
warranties of merchantability and/or fitness for a particular purpose.
<P>
<PRE>Declare Function GetModuleHandle Lib "kernel"(lpModuleName$) As Integer
Declare Function GetActiveWindow Lib "User" As Integer
Declare Function CreateWindow Lib "User"(lpClassname$, lpWindowName$, \
 dwStyle As Long, X As Integer, Y As  Integer, nWidth As Integer, \
 Height As Integer, hWndParent As Integer, hMenu As Integer, hInstance \
 As Integer, lpParam$) As Integer
Declare Sub DestroyWindow Lib "User"(hWnd As Integer)
Declare Function SendMsgString Lib "user"(hWnd As Integer, wMsg As \
</PRE>Integer, wParam As Integer, lParam$) Alias "SendMessage" As Integer
<PRE>Declare Function SendMsgVal Lib "user"(hWnd As Integer, wMsg As \
 Integer, wParam As Integer, lParam As Long) Alias  "SendMessage" \
 As Integer

Sub MAIN
a$=Files$(".")                         ' stores current directory in a$
chdir "F:\DOCS\Plan"                   ' specify your parent directory here
</PRE>MsgBox "Directories = " + Str$(GetDirs)
<PRE>chdir a$                               ' changes path to stored directory
End Sub

</PRE>Function GetDirs
<P>
Dirs = CountDirectories()
If Dirs = 0 Then  '*** only if countdirs returns 0
LB_RESETCONTENT = 1029
LB_DIR = 1038
<P>
DirList = CreateWindow("ListBox", "", 1073741954, 0, 0, 0, 0, \
<PRE> GetActiveWindow, 0, GetModuleHandle("winword"), "")

</PRE>r = SendMsgVal(DirList, LB_RESETCONTENT, 0, 0)
Dirs = SendMsgString(DirList, LB_DIR, 16 - 32768, "*.*")
If Dirs = - 1 Then
<PRE>   MsgBox "LB_DIR Error"'shouldn't get this
   Goto bye :
</PRE>End If
<P>
If InStr(DefaultDir$(14), "\") &lt;&gt; 0 And Len(DefaultDir$(14)) &lt; 4  Then
<PRE> Dirs = Dirs + 1
</PRE>End If
<P>
DestroyWindow DirList
bye:
End If
GetDirs = Dirs
End Function
<P>
<P><h2>REFERENCES</h2>
 
<P>
"Microsoft Word Developer's Kit," version 6.0, pages 128-130
<P>
Kbcategory: kbusage kbmacro
KBSubcategory: kbmacroexample

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 6.0 6.0a 6.0c winword Subdirectory<BR>
word6 directory CountDirectories novell empty files network<BR>
Keywords          : kbmacroexample<BR>
Version           : 6.0 6.0a 6.0c<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  August 5, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
