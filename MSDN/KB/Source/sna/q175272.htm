

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Windows 3.x CPIC or APPC Fails; Host Sends Sense Code 10086040 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q175272">
<META NAME="KBModify" CONTENT="1998/02/03">
<META NAME="KBCreate" CONTENT="1997/10/16">
<META NAME="Keywords" CONTENT="kbbug2.11 kbbug2.11.sp1 kbbug2.11.sp2 kbbug3.00 kbbug3.00.sp1 snaappc snacpic snaprog s">
<META NAME="KBArea" CONTENT="Support; KB; sna">
<META NAME="Description" CONTENT="  After you upgrade an SNA Server Windows 3.x client from version 2.11 or version 2.11 Service Pack 1 (SP1) to version 2.11 SP2 or version 3.0 (including 3.0 SP1 or SP2), the Windows 3.x APPC and CPIC applications no longer work.  SNA Server traces i...">
<META NAME="Product" CONTENT="SNA Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDO3,QBWN,QDL9,QBWQ,QBWO,QAAD,QBE7,QBE6,QAGI,QA39,QABT,QBVV,QAR4,QAH4,QAK7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Windows 3.x CPIC or APPC Fails; Host Sends Sense Code 10086040</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 3, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q175272</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SNA Server, versions 2.11, 2.11 Service Pack 1 (SP1), 2.11
   Service Pack 2 (SP2), 3.0, 3.0 Service Pack 1 (SP1), and 3.0 Service
   Pack 2 (SP2)
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
After you upgrade an SNA Server Windows 3.x client from version 2.11 or
version 2.11 Service Pack 1 (SP1) to version 2.11 SP2 or version 3.0
(including 3.0 SP1 or SP2), the Windows 3.x APPC and CPIC applications no
longer work.
<P>
SNA Server traces indicate the following sequence of events:
<P>
- The Windows 3.x CPIC or APPC application attempts to allocate a
<PRE>   conversation using the AP_SAME security option.

</PRE>- The SNA Server Windows 3.x APPC DLL issues an allocate, adding the
<PRE>   Windows 3.x username in a user ID subvector of the FMH-5 attach request.

</PRE>- The host may have already negotiated the LU6.2 BIND to indicate that
<PRE>   security information will not be accepted on FMH-5 attach requests (that
   is, Byte 23, bit 3 = 0 in the BIND request).

</PRE>- When SNA Server sends the FMH-5 attach (containing the user ID), the host
<PRE>   rejects the attach with an FMH-7 error, with the following sense code:

   10086040 = Invalid FM Header: The FM header was not understood or
   translated by the receiver, or an FM header was expected but not
   present. 6040 = Invalid attach parameter: A parameter in the FMH-5
   Attach command conflicts with the statement of LU capabilities
   previously provided in the BIND negotiation.

</PRE><h2>CAUSE</h2>
 
<P>
The SNA Server Windows 3.x APPC interface (Winappc.dll) is incorrectly
enabling the special AP_SAMENosUser setting, which causes the user ID to be
added to the FMH-5 attach message when applications request the AP_SAME
security option.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
This problem can be resolved if the Windows 3.x APPC or CPIC application
does not specify the AP_SAME security option prior to calling the
[MC_]ALLOCATE or CMALLC functions to allocate a conversation.
<P>
Note: If a CPIC application is being used, and a blank CPIC symbolic
destination name is passed to the CMINIT function, then the default
symbolic destination name specifies a security option of AP_SAME. To
correct this problem, the CPIC application should specify a CPIC symbolic
destination name that is configured in the SNA Server configuration, where
the security option is not using Conversation Security: Same. The CPIC
security information is configured within SNA Server Administrator or
Manager, under the CPIC Symbolic Names option.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the SNA Server Windows 3.x
clients, versions 2.11, 2.11 SP1, 2.11 SP2, 3.0, 3.0 SP1, and 3.0 SP2.
A supported fix is now available, but has not been fully regression tested
and should be applied only to systems experiencing this specific problem.
Unless you are severely impacted by this specific problem, Microsoft
recommends that you wait for the next Service Pack that contains this fix.
Contact Microsoft Technical Support for more information.
 
<PRE>Keywords          : kbbug2.11 kbbug2.11.sp1 kbbug2.11.sp2 kbbug3.00 kbbug3.00.sp1 snaappc snacpic snaprog snawin3x kbbug3.00.sp2 kbfixlist
Version           : WINDOWS:2.11,2.11SP1,2.11SP2,3.0,3.0SP1,3.0SP2
Platform          : WINDOWS
Issue type        : kbbug
Solution Type     : kbfix kbservicepack</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 3, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
