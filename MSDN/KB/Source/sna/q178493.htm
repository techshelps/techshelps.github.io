

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>SNA Server Status Shows "Off Line" Even Though It's Active </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q178493">
<META NAME="KBModify" CONTENT="1998/02/03">
<META NAME="KBCreate" CONTENT="1997/12/23">
<META NAME="Keywords" CONTENT="prodsna snamanager snaprintservice snaserverservice snatn3270 snatn5250 kbbug3.00.sp2">
<META NAME="KBArea" CONTENT="Support; KB; sna">
<META NAME="Description" CONTENT="  After upgrading to SNA Server 3.0 Service Pack 2, SNA Manager may show the  SNA Server (or TN3270, TN5250 or Print Service) status as  Off Line  even  though the service(s) may be running correctly.  The onset of the  Off Line  status normally coin...">
<META NAME="Product" CONTENT="SNA Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDO3,QAR4,QACK,QAM1,QAL2,QBW7,QAI5,QAKP,QBW2,QAYA,QBWG,QAI4,QDIX,QBWS,QAGR V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>SNA Server Status Shows "Off Line" Even Though It's Active</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 3, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q178493</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SNA Server, version 3.0 SP2
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
After upgrading to SNA Server 3.0 Service Pack 2, SNA Manager may show the 
SNA Server (or TN3270, TN5250 or Print Service) status as "Off Line" even 
though the service(s) may be running correctly.
<P>
The onset of the "Off Line" status normally coincides with an access 
violation in the SNA Manage Agent service (mngagent.exe), though sometimes 
the service does appear to be running, the service fails to stop. When the 
service fails with an access violation, the following symptoms occur:
<P>
- The SNA Manage Agent service may no longer be running
<P>
- The following entry may appear in the &lt;ntroot&gt;\drwtsn32.log file:
<P>
<PRE>  Application exception occurred:
          App: exe\mngagent.dbg (&lt;process id&gt;)
         Exception number: c0000005 (access violation)

  [...]

  function: RtlDestroyHeap
        77f7d339 83c40c           add     esp,0xc
        77f7d33c 57               push    edi
        77f7d33d e83af00000       call    RtlpNtEnumerateSubKey+0x312a 
        77f7d342 c6451400         mov     byte ptr [ebp+0x14],0x0      
        77f7d346 8b4d08           mov     ecx,[ebp+0x8]          
        77f7d349 0fb707           movzx   eax,word ptr [edi]         
        77f7d34c 294128           sub     [ecx+0x28],eax         
        77f7d34f 8b4e08           mov     ecx,[esi+0x8]          
        77f7d352 8b460c           mov     eax,[esi+0xc]          
        77f7d355 3bc8             cmp     ecx,eax
FAULT -&gt;77f7d357 8908             mov     [eax],ecx 

</PRE>*----&gt; Stack Back Trace &lt;----*
<P>
<PRE>   Function Name
   ntdll!RtlDestroyHeap 
   ntdll!LdrGetDllHandle 
   ntdll!RtlAllocateHeap 
   msvcrt!realloc 
   ws2_32!getservbyname 
   ws2_32!gethostname 
   snaip!BuildNosBlock  
   snadmod!BuildActiveNosBlocks  
   snadmod!SendDatagramTo  
   snamanag!SendDomainMailslot  
   snamanag!SNAStopService  
   mngsna!CNodeServe::OnCommand  
   mngbase!CNotifyQueue::Dispatch  
   mngbase!CNotifyQueue::ProcessWait  
   mngsna!DoMngSna

</PRE><h2>CAUSE</h2>
 
<P>
In some cases, the SNA Manage Agent was not allocating sufficient memory 
to hold management status information, causing internal buffers to be 
overwritten. This problem was causing memory heap corruption within the 
Manage Agent service which could cause the service to deadlock or fail 
with an access violation.
<P>
<P><h2>STATUS</h2>
 
<P>
Obtain the following fix or wait for the next SNA Server 3.0 Service Pack.
<P>
This fix should have the following timestamp:
<PRE>  12/05/97  04:02p            97,104 &lt;snaroot&gt;\system\mngagent.exe
  12/05/97  04:02p           136,764 &lt;ntroot&gt;\symbols\exe\mngagent.dbg
  11/21/97  05:45p           362,128 &lt;snaroot&gt;\system\mngbase.dll

</PRE>NOTE: SNA Server 3.0 Service Pack 2 must be applied prior to applying
this fix.
<P>
Microsoft has confirmed this to be a problem in SNA Server 3.0 Service 
Pack 2. This problem is fixed in SNA Server 4.0.
<P>
A supported fix is now available, but has not been fully regression-tested 
and should be applied only to systems experiencing this specific problem. 
Unless you are severely impacted by this specific problem, Microsoft 
recommends that you wait for the next Service Pack that contains this fix. 
Contact Microsoft Technical Support for more information. 
 
<PRE>Keywords          : prodsna snamanager snaprintservice snaserverservice snatn3270 snatn5250 kbbug3.00.sp2
Version           : WINDOWS:3.0SP2
Platform          : WINDOWS
Issue type        : kbbug
Solution Type     : kbfix kbpatch</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 3, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
