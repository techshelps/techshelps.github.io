

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>SNA Server Processes Show Huge Virtual Byte Size in PerfMon </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q142497">
<META NAME="KBModify" CONTENT="1997/11/25">
<META NAME="KBCreate" CONTENT="1996/01/15">
<META NAME="Keywords" CONTENT="ntnetserv kbnetwork kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; sna">
<META NAME="Description" CONTENT="  When viewing the virtual byte size of any SNA Server service or Win32 application which uses the SNA Server API's, Windows NT Performance Monitor shows the Win32 process' virtual byte size to be larger than 154MB.  SNA Server reserves a 154MB conti...">
<META NAME="Product" CONTENT="SNA Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QAPN,QAO4,QBW6,QACJ,QAHT,QALQ,QALG,QDH9,QBWS,QAL3,QABO,QANY,QAJG,QDMH V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>SNA Server Processes Show Huge Virtual Byte Size in PerfMon</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 25, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q142497</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SNA Server for Windows NT, versions 2.0, 2.1, 2.11, and 3.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
When viewing the virtual byte size of any SNA Server service or Win32
application which uses the SNA Server API's, Windows NT Performance Monitor
shows the Win32 process' virtual byte size to be larger than 154MB.
<P>
SNA Server reserves a 154MB contiguous region in the process' virtual
address space, though only 64KB of physical memory is initially allocated
or committed. Additional physical memory is allocated only when needed.
Also, this memory is shared between all SNA Server processes running on the
computer, and only one copy is allocated even if there are several SNA
applications running.
<P>
Since this large virtual memory area is not actually allocated out of
available physical memory, other processes running on the computer are not
be affected, nor does it affect the Windows NT page file. The committed
memory can be found by viewing the "working set" size of each process.
<P>
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
SNA Server processes running locally on a Windows NT computer communicate
with each other using a shared memory region. Each SNA Server process (that
is, SnaBase, SNA Server, link services, and applications which use the SNA
API's) communicate with other SNA Server processes on the computer by
writing to buffers in this memory region which is then available for other
SNA Server processes to access.
<P>
When SnaBase is started, it reserves this shared memory region as a Windows
NT virtual memory mapped file. The size of this file is determined by the
size of all possible SNA Server internal communication buffers which can
potentially be allocated (on SNA Server 2.11, this is 154,300,416 bytes).
However, out of this large potential size, the initial allocation size is
less than 64KB (16KB for process headers, 32KB for elements and 8KB for
headers).
<P>
SNA Server logs event 684 and 685 to indicate changes in the buffer pool
memory allocation. Event 684 is logged when over half of the maximum number
of buffer pools has been allocated. Event 685 is logged if Windows NT has
returned an error to our VirtualAlloc call, or if the maximum number of
buffer pool extensions have been allocated. Full internal tracing on the
component logging these events indicates the cause of the 685 error. The
text for these events are included below:
<P>
<PRE>   Event 684
   A buffer pool audit has been triggered by a pool extension.

   EXPLANATION

   This audit contains information about the size of the buffer pool,
   how many headers and elements each process is using, etc.

                   Pool      Free     Alloced      Max

   Trusted Hdrs
   Trusted Elts
   Non-Trusted Hdrs
   Non-Trusted Elts

   Comname    Pid    Trusted   Hdrs   Elts

   SnaBase
   SnaServr
   SnaDlc1
   ...


   ACTION

   None, unless there is some other problem. In that case, report
   this log along with any others.



   Event 685

   An attempt was made to extend a buffer pool, but the related pool
   had reached its maximum size. The affected component is terminating,
   and an audit of the buffer pools just before termination is attached

   EXPLANATION
   This error is almost always due to either an SNA component (including
   possibly an emulator) losing buffers or a slow emulator (or RUI
   application) using a session without pacing.

   ACTION
   Contact your support personnel.

   Excessive logging of this event may indicate that an SNA Server process
   running on the machine is not releasing buffers properly, which could
   indicate a potential memory leak.
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodsna<BR>
Keywords          : ntnetserv kbnetwork kbnetwork<BR>
Version           : 2.0 2. 2.11 3.0<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 25, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
