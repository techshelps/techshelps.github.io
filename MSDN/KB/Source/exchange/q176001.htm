

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>XFOR: Accessing the Contents Table of Non-Replicated PF Fails </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q176001">
<META NAME="KBModify" CONTENT="1997/10/30">
<META NAME="KBCreate" CONTENT="1997/10/30">
<META NAME="Keywords" CONTENT="XFOR kbprb">
<META NAME="KBArea" CONTENT="Support; KB; exchange">
<META NAME="Description" CONTENT="  Any attempt, by an application, to access the contents table of a non- replicated Public Folder (PF) will fail and return an error code  80004005 when using the Microsoft Exchange Software Development Kit  (SDK) sample gateway code (and perhaps oth...">
<META NAME="Product" CONTENT="Exchange">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QBRU,QAUD,QAGI,QA6A,QAI5,QAK9,QABC,QAKP,QBW7,QAFI,QALW,QBWG,QBVV,QBG2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XFOR: Accessing the Contents Table of Non-Replicated PF Fails</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 30, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q176001</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Exchange Server, version 5.0 
<LI>Microsoft Exchange Server, version 4.0 
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Any attempt, by an application, to access the contents table of a non-
replicated Public Folder (PF) will fail and return an error code 
80004005 when using the Microsoft Exchange Software Development Kit 
(SDK) sample gateway code (and perhaps other components as well). 
<P>
An example of the call might be:
<P>
<PRE>   MAPICALL(lpFBSiteFolder)-&gt;GetContentsTAble(lpFBSiteFolder, 
                                              MAPI_DEFERRED_ERROR, 
                                              &amp;lpTableCont);

</PRE><h2>CAUSE</h2>
 
<P>
Enumerating the local folder hierarchy table will result in success 
because of the public folder heirarchy replication, however, when 
the application makes the call to lpfolder-&gt;GetcontentsTable() to 
retrieve a table containing the messages in the folder, the Microsoft
Exchange Server will return a failure meaning that the content hasn't 
been replicated. In some cases, where public folder affinity is 
enabled, the local Server will attempt to return the content from 
another Server. If the account that the application (or connector) is 
using does not have permissions to access the folder, this call will 
fail as well. This is the case with the GWSample code that creates an 
account that will not be able to access the resource.
<P>
The actual return code from this function in case of failure should be 
MAPI_E_NO_SUPPORT, indicating that the contents table cannot be 
returned. However, this is not seen from the GWSample code because it 
throws away the return code in the cleanup section and uses 
ERROR_INTERNAL_ERROR. 
<P>
<P><h2>RESOLUTION</h2>
 
<P>
The problem can be resolved by replicating the folder on the local 
store. If you need to access a PF on a remote Server, the problem can 
also be resolved by writing a MAPI application that uses a normal 
user's profile and perform these functions as a Windows NT service.
<P>
If you are not using the GWSample code and are experiencing this 
problem, verify that you are using the correct account permissions 
with public folder affinity. The mysterious error condition can 
also be improved by writing a MAPI application that uses the return 
value of the GetContentsTable() call to accurately explain the 
condition in the event logs so that the problem may be fixed. 
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words:  replica PF<BR>
Keywords          : XFOR kbprb<BR>
Version           : 5.0<BR>
Platform          : winnt<BR>
Issue type        : kbprb<BR>
Solution Type     : kbworkaround<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 30, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
