

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>XADM: Intrasite Directory Replication Fails with Error 1720 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q180795">
<META NAME="KBModify" CONTENT="1998/02/12">
<META NAME="KBCreate" CONTENT="1998/02/10">
<META NAME="Keywords" CONTENT="XADM kbusage">
<META NAME="KBArea" CONTENT="Support; KB; exchange">
<META NAME="Description" CONTENT="  One or more servers within the site fail to notify other site servers of replica updates, and other site servers fail in their attempt to communicate with the affected server or servers.  The problem servers log the following Directory event in the...">
<META NAME="Product" CONTENT="Exchange">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAKG,QDJP,QBXB,QACK,QABA,QAB4,QATJ,QA5E,QAFI,QDIV,QA63,QAO4,QAAP,QAKJ,QBWP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XADM: Intrasite Directory Replication Fails with Error 1720</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 12, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q180795</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Exchange Server, versions 4.0, 5.0, 5.5
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
One or more servers within the site fail to notify other site servers of
replica updates, and other site servers fail in their attempt to
communicate with the affected server or servers.
<P>
The problem servers log the following Directory event in the Application
Event Log during startup:
<P>
<PRE>   1166
   Error 1720 has occurred (Internal ID 3230203). Contact Microsoft
   Technical Support for assistance.

</PRE>Additionally, other site servers may log the following Directory events
when attempting to communicate with the problem servers:
<P>
<PRE>   1083
   Replication warning: The directory replication agent (DRA) couldn't
   synchronize naming context /o=&lt;some-naming-context&gt; with naming context
   on directory &lt;some-servername-or-DSA-Signature&gt;

   1059
   Internal error: The directory replication agent (DRA) call returned
   error 13.

</PRE><h2>CAUSE</h2>
 
<P>
During directory service startup, the RPC endpoint mapper failed in its
attempt to register an endpoint on behalf of the directory service for a
specific protocol. This can occur for the ncacn_ip_tcp protocol when the
following conditions are true:
<P>
- The directory service has had a registry setting applied to force the use
<PRE>   of a specific TCP port for directory service communication. (For more
   information, see Microsoft Knowledge Base article <B><A HREF="../EXCHANGE/Q155831.htm">Q155831</A></B>, "XCLN: How to
   Force Static Mapping of Sockets").
</PRE>- That port has already been assigned to some other process by Winsock or
<PRE>   RPC by the time the directory service starts.


</PRE><h2>RESOLUTION</h2>
 
<P>
If the network environment requires that the Exchange Services have fixed
ports assigned to them, carefully plan port assignments to ensure that the
ports are not already in use. See MORE INFORMATION, below. Also see the
following Microsoft Knowledge Base articles:
<P>
ARTICLE ID: <B><A HREF="../EXCHANGE/Q155831.htm">Q155831</A></B>
<PRE>TITLE     : XCLN: How to Force Static Mapping of Sockets

</PRE>ARTICLE ID: <B><A HREF="../EXCHANGE/Q176466.htm">Q176466</A></B>
<PRE>TITLE     : XGEN: TCP Ports and Microsoft Exchange: In-depth Discussion

</PRE><h2>MORE INFORMATION</h2>
 
<P>
The Exchange Services' default behavior is to allow the RPC endpoint mapper
to dynamically assign a TCP port from the pool of ephemeral (short-lived)
ports during service initialization. On Windows NT, by default, this pool
begins with port 1024. The result is that the port assigned to a service
can be different every time the service starts.
<P>
Clients attempting to contact a service first query the RPC endpoint mapper
(at port 135) to determine at what port the Exchange Service can be
contacted (see <B><A HREF="../EXCHANGE/Q176466.htm">Q176466</A></B>).
<P>
Some network environments (typically involving firewalls) require that the
ports used by services remain within a fixed range, or in the extreme, also
that they remain consistent every time the service executes.
<P>
<P>
<P><h3>Port Assignment Options and Strategy</h3>
 
<P>
NOTE: The UDP protocol also has pools of port numbers. These are separate
from the TCP pools.
<P>
There are two pools of TCP port numbers to draw from for forcing an
Exchange Service to use a particular TCP port: the Well-known Ports pool (0
- 1023); and the Ephemeral pool (1024 and above). Either is satisfactory,
and a firewall's configuration may dictate which pool to use. When using
either pool, adhere to the following:
<P>
- Assign ports not already in use in the environment.
- Document those choices (the \winnt\system32\drivers\etc\services file is
<PRE>   a logical place for such documentation).

</PRE>Well-known (TCP) Ports (0 - 1023):
<P>
By convention and for interoperability of standard network services, this
pool of addresses was set aside per RFC 1060, and many of these ports are
reserved for use by specific services, such as echo, ftp, smtp, ldap, pop3,
finger, nntp, snmp, and so on. There are 1024 ports in this pool (not all
of them assigned yet), and typically only a small fraction of these
services is actually implemented within a particular computing environment.
It is acceptable to use ports that are not currently (nor ever will be)
hosting the service that the port was originally reserved for, or using
unassigned ports.
<P>
Ephemeral (TCP) Ports:
<P>
DO NOT pick the first ports within this range (1024 – 65535). Winsock and
RPC assign these ports starting at the lowest in the range. By the time the
Exchange Services starts up, some of the first ports may have been already
assigned (hence the SYMPTOMS above). Unfortunately there is no
comprehensive diagnostic that can report which ports have been assigned by
either Winsock or RPC. Running "NETSTAT -a" lists all connections and
listening ports, but this may not reveal all assigned ports.
Experimentation may be required. If in doubt, consider assigning from the
Well-known ports pool, or selecting port numbers above 1023 (for instance,
the 1200 range).
<P>
<P>
Other Core Exchange Services:
<P>
Neither the Exchange System Attendant nor the Exchange Information Store
service logs an event if an RPC endpoint creation fails during service
initialization. The operating behavior and performance of these services
without the ncacn_ip_tcp protocol enabled is unpredictable and could vary
widely from environment to environment. The MTA logs:
<P>
<PRE>   9321 - Interface
   An RPC communications error occurred. An attempt to listen over RPC has
   failed. NT Error: 1720. [ncacn_ip_tcp BASE IL MAIN BASE 1 504] (14)

</PRE> 
<PRE>Keywords          : XADM kbusage
Version           : 4.0,5.0,5.5
Platform          : winnt
Issue type        : kbprb</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 12, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
