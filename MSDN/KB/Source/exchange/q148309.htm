

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>XFOR: Manual Dir-Sync with Exchange as Dir-Sync Requestor </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q148309">
<META NAME="KBModify" CONTENT="1998/01/29">
<META NAME="KBCreate" CONTENT="1996/03/08">
<META NAME="Keywords" CONTENT="XFOR kbenv">
<META NAME="KBArea" CONTENT="Support; KB; exchange">
<META NAME="Description" CONTENT="  This article explains how to perform manual directory synchronization (dirsync) between Microsoft PC Mail postoffices and Microsoft Exchange Server as the dirsync requestor. This article assumes you have already  configured directory synchronizatio...">
<META NAME="Product" CONTENT="Exchange">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAYC,QATJ,QBXB,QAD2,QAY2,QAFI,QBWS,QBWP,QADN,QAXB,QACK,QBV8,QBSO,QAC9,QAPN V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XFOR: Manual Dir-Sync with Exchange as Dir-Sync Requestor</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 29, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q148309</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft Exchange Server, version 4.0, 5.0, 5.5
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article explains how to perform manual directory synchronization
(dirsync) between Microsoft PC Mail postoffices and Microsoft Exchange
Server as the dirsync requestor. This article assumes you have already 
configured directory synchronization.
<P>
<P><h2>I. Preparations Before Manual Directory Synchronization</h2>
 
<P>
You need to do the following:
<P>
A. For Microsoft Exchange Server version 4.0, enable the Pause button 
<PRE>   for the Microsoft Exchange Directory Synchronization (Dir-Sync) in 
   the Windows NT Server Registry. For Microsoft Exchange Server 
   versions 5.0 and 5.5, the Pause button is enabled by default and 
   does not require editing the registry.

</PRE>B. Increase diagnostic logging to assist you in troubleshooting the manual
<PRE>   directory synchronization process.

</PRE>A. Configure Windows NT Server Registry to Enable
the Pause Button for the Exchange Directory Synchronization Service
 
<P>
WARNING: Using Registry Editor incorrectly can cause serious, system-wide
problems that may require you to reinstall Windows NT to correct them.
Microsoft cannot guarantee that any problems resulting from the use of
Registry Editor can be solved. Use this tool at your own risk.

<OL><P><LI>Run the Registry Editor (REGEDT32.EXE).

<P><LI>Under the HKEY_LOCAL_MACHINE subtree, go to the following subkey:
<P>
       SYSTEM\CurrentControlSet\Services\MSExchangeDX

<P><LI>Select Edit.

<P><LI>Choose Add Value.

<P><LI>In the Value name box, type:
<P>
       PauseKicksDX

<P><LI>From the Data type box, select REG_DWORD.

<P><LI>Choose OK.

<P><LI>In the DWORD editor box, type: 1

<P><LI>Choose OK.

<P><LI>Run Control Panel and choose Services to stop and restart the Microsoft
    Exchange Directory Synchronization service in order for the service to
    recognize this value.
<P>
</OL>B. Increase Diagnostic Logging to Assist You
<P><h3>in Troubleshooting the Manual Directory Synchronization Process</h3>
 

<OL><P><LI>Run Microsoft Exchange Administrator.

<P><LI>From the Container window select the appropriate site Configuration,
   Connections container:
<P>
<P><PRE>      a. Double-click the Microsoft Mail Connector.
</PRE><P>
<P><PRE>      b. From the Diagnostics Logging property page, highlight the
<PRE></PRE>         MSExchangePCMTA and set the Logging level to Maximum.

</PRE></OL><h3>II. How to Do a Manual Directory Synchronization</h3>
 
<P>
NOTE: If the Microsoft Mail executables are run from a command prompt under
Microsoft Windows NT, preface the commands with FORCEDOS. For example, the
first command run for T1 would be:
<P>
<PRE>   forcedos reqmain -d&lt;drive&gt; -t

</PRE>where &lt;drive&gt; refers to the drive letter connected to the mail database.
<P>
NOTE: Commands must be run from the direcory where the execuatble is 
located or you will receive the error "FORCEDOS: Program file 
not found."  Most commonly, the directory \MAILEXE will contain all
the Microsoft Mail executable files.

<OL><P><LI>(T1) On every Microsoft Mail Postoffice involved in Dirsync as a
   requestor, including the postoffice defined as the Dirsync server, type
   the following command from the Microsoft Mail executables directory:
<P>
<P><PRE>      reqmain -d&lt;drive&gt; -t
</PRE><P>
   where &lt;drive&gt; refers to the drive letter connected to the mail database.
<P>
   This generates the outgoing Dirsync mail messages and places them in
   the P1 directory.

<P><LI>(T1) On every Exchange Server involved in Dirsync as a
   requestor, use Control Panel, Services to pause the
   Microsoft Exchange Directory Synchronization service.
   After the Pause button has been selected the
   administrator will receive the following error message which can
   be ignored:
<P>
<P><PRE>      Could not pause the Microsoft Exchange Directory
      Synchronization service on \\&lt;server&gt;.
      Error 2140: An internal Windows NT error occurred.
      Click on OK.
</PRE><P>
   The Dirsync messages are delivered by the Microsoft
   Mail Connector to the Microsoft Mail Dirsync Server
   and queued in the SYSTEM.MBG to await T2 events.

<P><LI>Using the Event Viewer Application Log, verify the
   Dirsync message has been transferred to the Microsoft
   Mail Dirsync Server. You should see the following two
   entries:
<P>
<P><PRE>      * Event ID: 4395
<PRE></PRE>        Category: Sent
        Description:
           Mail sent from \\&lt;Requestor Server&gt;\MAILDAT$
           FROM:  &lt;DXA Requestor Organization&gt;/&lt;DXA Requestor Site&gt;/SYSTEM1
           TO:    &lt;Dirsync Server Network&gt;/&lt;Dirsync Server PO&gt;/$SYSTEM

      * Event ID: 4355
        Category: Moved In
        Description:
           Mail received on \\&lt;Dirsync Server&gt;\MAILDATA
           FROM:  &lt;DXA Requestor Organization&gt;/&lt;DXA Requestor Site&gt;/SYSTEM1
           TO:    &lt;Dirsync Server Network&gt;/&lt;Dirsync Server PO&gt;/$SYSTEM

   NOTE:  You can modify the Polling Frequency to check
   for mail every minute to ensure mail is transferred
   quickly. To change the Polling Frequency, use the
   Microsoft Exchange Administrator program to do the
   following:

      a. From the Container window, select the
         appropriate site's Configuration, Connections
         container.

      b. Open the Microsoft Mail Connector and select
         the Connector MTAs property page.

      c. Highlight the appropriate Microsoft Mail
         Connector (PC) MTA Service and select the
         Configure button.

      d. Change the value of "Check for mail every __
         minute" to 1.

      e. Be sure to stop and start the service for the
         change to take affect.

</PRE><P><LI>(T2) On the Microsoft Mail Dirsync Server, type the
   following commands from the Microsoft Mail executables
   directory:
<P>
<P><PRE>      srvmain -r -d&lt;drive&gt;
</PRE><P>
<P><PRE>      srvmain -t -d&lt;drive&gt;
</PRE><P>
   where &lt;drive&gt; refers to the drive letter
   connected to the mail database.
<P>
   The SRVMAIN -R command receives and places updates in
   the MSTTRANS.GLB file. The SRVMAIN -T command reads
   the SRVCONF.GLB file, determines which updates need to
   be sent to each requestor, reads the MSTTRANS.GLB file
   to create the updates, generates a mail message back to
   each requestor that sent a request to the server and
   finally places the outgoing mail in the P1 directory.

<P><LI>Using the Event Viewer Application Log, verify the
   Dirsync message has been transferred to the Exchange
   Requestor. You should see the following two entries:
<P>
<P><PRE>      * Event ID: 4395
<PRE></PRE>        Category: Moved Out
        Description:
           Mail sent from \\&lt;Dirsync Server Server&gt;\MAILDATA
           FROM: &lt;Dirsync Server Network&gt;/&lt;Dirsync Server PO&gt;/$SYSTEM
           TO:  &lt;DXA Requestor Organization&gt;/&lt;DXA Requestor Site&gt;/SYSTEM1

      * Event ID: 4355
        Category: Received
        Description:
           Mail received on \\&lt;Requestor Server&gt;\MAILDAT$
           FROM: &lt;Dirsync Server Network&gt;/&lt;Dirsync Server PO&gt;/$SYSTEM
           TO:  &lt;DXA Requestor Organization&gt;/&lt;DXA Requestor Site&gt;/SYSTEM1

</PRE><P><LI>(T3) On every Exchange Server involved in Dirsync as a
   requestor, the DXA Requestor dynamically applies the
   changes as soon as they arrive. The DXA Requestor does
   not need to be configured with a scheduled T3 time.

<P><LI>(T3) On every Microsoft Mail Postoffice involved in Dir-
   Sync as a requestor, type the following commands from
   the Microsoft Mail executables directory:
<P>
<P><PRE>      reqmain -d&lt;drive&gt; -r
</PRE><P>
<P><PRE>      import -d&lt;drive&gt; admin -p&lt;password&gt; -q -y
</PRE><P>
<P><PRE>      rebuild -d&lt;drive&gt; -f
</PRE><P>
   where &lt;drive&gt; refers to the drive letter connected
   to the mail database.
<P>
   The REQMAIN -R command receives the updates and moves
   them into the SRVTRANS.GLB file.
<P>
   The import command takes the SRVTRANS.GLB records and
   moves them into the temporary transaction files
   depending on what types of addresses they contain. Then
   the Import command moves the names into the .USR and
   .NME files. The -Q option tells Import to use the
   SRVTRANS.GLB file for the update, and the -Y option
   tells Import to run without asking for permission to
   continue.
<P>
   The rebuild -F command takes the network names, the
   .NME files, and the .USR files to build the GAL and the
   GAL index file. The -F option is the same as the -Y
   option for import.
<P>
</OL>This concludes the manual Dirsync process.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For more information on Microsoft Mail for PC Networks Directory
Synchronization, please refer to Product Support Services Application Note:
<P>
<PRE>   WA0725.

</PRE></OL>For additional instructions on Microsoft Exchange Directory
Synchronization, please refer to Chapter 14 of the Microsoft Exchange
Server Administrator's Guide.
<P>
For additional information on how to perform manual directory
synchronization between Microsoft PC Mail Postoffices and Microsoft
Exchange Server, please see the following article in the Microsoft
Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../EXCHANGE/Q147464.htm">Q147464</A></B>
   TITLE     : Manual Dirsync with Exchange as Dirsync Server
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: dir-sync dirsynch faq<BR>
Keywords          : XFOR kbenv<BR>
Version           : 4.0 5.0<BR>
Platform          : MS-DOS WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 29, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
