

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: Causes and Resolutions for Error RW4005 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q123989">
<META NAME="KBModify" CONTENT="1997/07/22">
<META NAME="KBCreate" CONTENT="1994/12/14">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; utilities">
<META NAME="Description" CONTENT="  The following error is generated by the resource compiler (RC):     warning RW4005: Segment XX (offset XXXX) contains a       relocation record pointing to the automatic data segment.       This will cause the program to crash if the instruction be...">
<META NAME="Product" CONTENT="Programming Utilities">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QAB4,QAKR,QAHE,QBFY,QAOT,QAR4,QAYY,QAJQ,QA5V,QAKJ,QAJH,QAAP,QAF3,QAKP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Causes and Resolutions for Error RW4005</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 22, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q123989</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
1.00 1.50 | 7.00
<PRE>WINDOWS   | MS-DOS
</PRE>kbtool kberrmsg kbprb
<P>
 
The information in this article applies to:
<P>
<PRE>   The Resource Compiler (RC.EXE) included with:
    - Microsoft C/C++ for MS-DOS, version 7.0
    - Microsoft Visual C++ for Windows, versions 1.0 and 1.5
</PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The following error is generated by the resource compiler (RC):
<P>
<PRE>   warning RW4005: Segment XX (offset XXXX) contains a
      relocation record pointing to the automatic data segment.
      This will cause the program to crash if the instruction being
      fixed up is executed in a multi-instance application. If this
      fixup is necessary, the program should be restricted to run
      only a single instance.

</PRE><h2>CAUSE</h2>
 
<P>
This error results when a fix-up record attempts to fix DGROUP, the data
segment created by the C run-time, in the code segment of an application
that might have multiple instances. Because Windows version 3.1 cannot fix
locations that are different from instance to instance in shared code
segments, this error is generated.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Here are five possible causes and solutions:

<OL><P><LI>Your program is not suitable for running multiple instances. The
   program has a fix-up record that references the data segment or DGROUP.
   In a multiple instance application, this causes problems because every
   instance of the application references that same data segment.
   Typically, there are no fix-ups from the data segment because DS will
   contain the data segment value.
<P>
   Remember that there is no guarantee that you will be able to create
   multiple instance large model applications by using the /Gx compiler
   switch, especially if you have global C++ class objects. See the
   documentation for this compiler switch for more information.

<P><LI>This warning has been reported to be caused by a reference to '__fac'
   made by the C/C++ version 7.0 compiler. The code does not make a
   reference to DS to access static data but to a constant value that is
   fixed-up when the code is loaded. No such reports have connected the
   same problem with Visual C++.
<P>
   If DS can be loaded with a different value when a second instance
   of an application is run, the code can be reused without crashing.
   In the version of the code which uses the constant value for
   referencing data, the second instance of an application might
   write over the first instance's data.
<P>
   The reported solution to this problem is to turn off the fast compile
   option. (Use the /f- switch to specify the full optimizing compiler
   instead.) This should stop the compiler from referencing the
   constant.

<P><LI>The /GD compile switch optimizes prolog and epilog code for functions in
   DLL files and is inappropriate for use when compiling modules for
   applications (EXE files). Removing the /GD compiler switch should
   correct the problem.

<P><LI>This warning can be reproduced by creating a function that uses the
   __loadds keyword or some inline assembly code that loads the segment of
   DGROUP into a register.

<P><LI>If you have a DATA MULTIPLE statement in your .DEF file, change it to
   DATA SINGLE. This will allow only one copy of the data segment to
   exist. NOTE: Putting the code into a DLL would have the same effect.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 1.00 1.50 3.10 7.00 errmsg err msg<BR>
KBCategory: kbtool kbprb kberrmsg<BR>
KBSubcategory: TlsMisc<BR>
Keywords            : kb16bitonly<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 22, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
