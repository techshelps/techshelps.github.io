

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Stepping Through Self-Modifying Code in CodeView </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q80379 ">
<META NAME="KBModify" CONTENT="1997/07/17">
<META NAME="KBCreate" CONTENT="1992/01/28">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; utilities">
<META NAME="Description" CONTENT="  Code that is written to modify its own contents may run differently when run one line at a time in the Microsoft CodeView Debugger (CV). This occurs because of the the way the 80x86 processors fetch instructions. Because this is a limitation of how...">
<META NAME="Product" CONTENT="Programming Utilities">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QASR,QATS,QBV8,QBWS,QAB9,QABG,QA7R,QAZB,QAYA,QAL3,QAEF,QALF V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Stepping Through Self-Modifying Code in CodeView</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 17, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q80379 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
2.20 3.00 3.11 3.14 4.00 4.01 4.05 4.10
MS-DOS
kbtool kbcode
<P>
 
The information in this article applies to:

<UL><LI>Microsoft CodeView for MS-DOS, versions 2.20, 3.0, 3.11, 3.14,
   4.0, 4.01, 4.05, and 4.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Code that is written to modify its own contents may run differently
when run one line at a time in the Microsoft CodeView Debugger (CV).
This occurs because of the the way the 80x86 processors fetch
instructions. Because this is a limitation of how CodeView works, care
should be used when debugging self-modifying code.
<P>
The code may run one way outside of CodeView, and another way from
within CodeView. Also, running the program by using the go (F5)
command instead of the step (F10) or trace (F8) command may affect the
program's execution. Different processors can also affect this
behavior.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The 80x86 processor will try to pre-fetch the next instruction from
memory while processing the current instruction. If the code being
modified is already waiting in the instruction queue, then the
processor will run the unmodified code. However, a jump instruction
will invalidate the queue, causing the next instruction to be fetched
before execution. In self-modifying code, this will cause the modified
instruction to be run. When stepping through a program in CodeView,
the instruction queue is always marked invalid, so all modified
instructions are run. The code below demonstrates this behavior.
<P>
If you step through the sample code in CodeView it will output "Num =
1". If you run straight though the code, allowing the processor to
pre-fetch instructions, it will output "Num = 0".
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>/* Compile options needed: /Zi
*/

#include&lt;stdio.h&gt;

void main(void)
</PRE>{
<PRE>unsigned int Num;

</PRE>_asm {
<PRE>     mov ax, cs
     push ds
     mov ds, ax
     inc byte ptr [cnt + 1]    /* Adding a "jmp cnt" between the  */
cnt: mov ax, 0                 /* INC and the MOV will cause the  */
     mov Num, ax               /* modified code to be run         */
     pop ds
     }
   printf("Num = %d",Num);
</PRE>}
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: kbinf 2.20 3.00 4.00 4.10<BR>
KBCategory: kbtool kbcode<BR>
KBSubcategory: CvwIss<BR>
Keywords            : kb16bitonly<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 17, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
