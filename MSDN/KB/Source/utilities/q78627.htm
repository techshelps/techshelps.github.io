

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>FIX: Address Label Offset Incorrect in USE32 Data Segment </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q78627 ">
<META NAME="KBModify" CONTENT="1997/09/16">
<META NAME="KBCreate" CONTENT="1991/11/24">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; utilities">
<META NAME="Description" CONTENT="  When a label corresponds to an absolute address and the label is defined in a USE32 data segment, LINK generates the incorrect offset for the label. As a result, the application accesses incorrect data through the label.  STATUS ======  Microsoft h...">
<META NAME="Product" CONTENT="Programming Utilities">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAC2,QAMB,QBE7,QBE6,QAIJ,QAAP,QAVS,QAR4,QDIV,QA96,QADF,QAH4,QAI4,QAE2,QAYY V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Address Label Offset Incorrect in USE32 Data Segment</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 16, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q78627 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.x 4.x 5.0x 5.1x 5.20 | 5.0x 5.10 5.11 5.13 5.15
<PRE>MS-DOS                 | OS/2
</PRE>kbtool kbcode kbbuglist kbfixlist
<P>
 
The information in this article applies to:

<UL><LI>Microsoft LINK for MS-DOS, versions 3.x, 4.x, 5.0x, 5.1x, and 5.2
<LI>Microsoft LINK for OS/2, versions 5.0x, 5.1, 5.11, 5.13, and 5.15
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When a label corresponds to an absolute address and the label is defined in
a USE32 data segment, LINK generates the incorrect offset for the label. As
a result, the application accesses incorrect data through the label.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in LINK versions 3.6, 3.61,
3.64, 3.65, 3.69, 5.01, 5.1, 5.11, 5.13, 5.15 and 5.2 for MS-DOS and
versions 5.01, 5.11, 5.13, and 5.15 for OS/2. This problem was corrected in
LINK version 5.3 for MS-DOS.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
A label can represent an absolute address XXXX:YYYY by placing the
label in a segment with the type "at XXXX" and after an org directive
"org YYYY."
<P>
The following code example demonstrates this problem. The Microsoft
Macro Assembler (MASM) generated the first listing. Note that the
offset of Vector is 20h, as it should be. The CodeView debugger
generated the second listing. Note that the offset of Vector is 28h,
which is incorrect.
<P>
<P><h3>Sample Code</h3>
 
<P>
; Assemble options needed: none
<P>
<PRE>                          .model small,c
                          .386

 0000                     Zero segment use32 at 0
                            org 32
 0020                       Vector label dword
 0020                     Zero ends

 0000                     .code
                          assume es:Zero
 0000                     start:
 0000  67&amp; 66| 26: A3         mov [Vector], eax
       00000020 R
                          end start


</PRE>; CodeView listing
<P>
<PRE>1:      .model small,c
2:      .386
3:
4:      Zero segment use32 at 0
5:      org 32
6:
7:          Vector label dword
8:
9:      Zero ends
10:
11:     .code
12:
13:     assume es:Zero
14:
15:     start:
16:
17:         mov [Vector], eax
6A8F:0000 676626A32800000MOV       DWord Ptr ES:[00000028],EAX
18:
19:         end start
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.60 3.61 3.64 3.65 3.69 5.01.20 5.01.21<BR>
buglist5.11 buglist5.13 buglist5.15 buglist5.20 fixlist5.30<BR>
5.02 5.03 5.05 5.10 5.20<BR>
KBCategory: kbtool kbcode kbbuglist kbfixlist<BR>
KBSubcategory: LinkIss<BR>
Keywords          : kb16bitonly<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 16, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
