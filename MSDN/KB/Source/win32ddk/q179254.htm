

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>INFO: Why Is My deviceObject-&gt;currentIrp == NULL in My ISR? </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q179254">
<META NAME="KBModify" CONTENT="1998/01/15">
<META NAME="KBCreate" CONTENT="1998/01/13">
<META NAME="Keywords" CONTENT="NTDDKKMode kbcode">
<META NAME="KBArea" CONTENT="Support; KB; win32ddk">
<META NAME="Description" CONTENT="  This article explains why it is possible for deviceObject-&gt;currentIrp == NULL in an ISR.  MORE INFORMATION  The only routines in the system that change deviceObject-&gt;currentIrp are IoStartPacket and IoStartNextPacket.  Following code demonstrates a...">
<META NAME="Product" CONTENT="Win32 DDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAEF,QBWP,QAGI,QAGB,QAI4,QAX6,QAB5,QDMW,QDIJ,QA9N,QA7O,QA7N,QAO3,QAO2,QALQ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INFO: Why Is My deviceObject-&gt;currentIrp == NULL in My ISR?</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 15, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q179254</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Win32 Device Driver Kit (DDK) for Windows NT, version 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article explains why it is possible for deviceObject-&gt;currentIrp ==
NULL in an ISR.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The only routines in the system that change deviceObject-&gt;currentIrp are
IoStartPacket and IoStartNextPacket.
<P>
Following code demonstrates approximately what these routines do (ignoring
details of cancels, spinlocks, the Key argument, and so on):
<P>
<PRE>   IoStartPacket(dvcObj, Irp)
   {
      if (dvcObj-&gt;DeviceQueue.Busy) {
         insert IRP on device queue
      } else {
         dvcObj-&gt;DeviceQueue.Busy = TRUE;
         dvcObj-&gt;CurrentIrp = Irp;
         call StartIo routine (dvcObj, newIrp);
      }
   }

   IoStartNextPacket(dvcObj)
   {
      dvcObj-&gt;CurrentIrp = NULL;
      remove IRP from head of queue, store addr in newIrp
      if (queue was empty) {
         dvcObj-&gt;DeviceQueue.Busy = FALSE;
      } else {
         dvcObj-&gt;CurrentIrp = newIrp;
         call StartIo routine (dvcObj, newIrp);
      }
   }

</PRE>If you don't use IoStart[Next]Packet, this field will always be NULL unless
you change it yourself. There is probably no real reason to change it
because if you aren't using IoStart[Next]Packet, it's probably because you
support more than one "current" IRP. Therefore, having a single pointer to
"the current IRP" is unnecessary.
<P>
If you are using IoStart[Next]Packet and you find that this field is NULL
in your ISR, it means that you have already called IoStartNextPacket before
the ISR was invoked and IoStartNextPacket did not find any more IRPs on the
DeviceQueue. Along with clearing the DeviceQueue-&gt;Busy bit,
IoStartNextPacket NULLs the CurrentIrp pointer when the device queue is
empty.
<P>
These are the only two things in the system that manipulate the dvcObj-
&gt;DeviceQueue.Busy or dvcObj-&gt;CurrentIrp.
 
<PRE>Keywords          : NTDDKKMode kbcode
Version           : WINNT:4.0
Platform          : winnt
Issue type        : kbinfo</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 15, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
