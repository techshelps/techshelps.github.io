

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: "Invalid Cursor Position" Using UserConnection to GetChunk </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q170368">
<META NAME="KBModify" CONTENT="1997/07/14">
<META NAME="KBCreate" CONTENT="1997/06/18">
<META NAME="Keywords" CONTENT="kberrmsg vb5all VBKBDB VBKBNet">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  When you use the UserConnection Designer to establish a connection and retrieve an RDO result set, you will encounter the following error:      Run-Time error '40002'    S1109:[Microsoft][ODBC SQL Server Driver] Invalid Cursor Position   if the RDO...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAPN,QBXS,QACI,QBS0,QAO2,QBCF,QBWS,QABA,QABI,QAH4,QBG2,QAUR,QAI5,QBXN,QAW6 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: "Invalid Cursor Position" Using UserConnection to GetChunk</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 14, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q170368</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Enterprise Edition for Windows, version 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you use the UserConnection Designer to establish a connection and
retrieve an RDO result set, you will encounter the following error:
<P>
<PRE>   "Run-Time error '40002'
   S1109:[Microsoft][ODBC SQL Server Driver] Invalid Cursor Position"

</PRE>if the RDO result set includes a BLOB (Binary Large Object) column and you
do not change any default values.
<P>
This error occurs at the GetChunk method.
<P>
<P><h2>CAUSE</h2>
 
<P>
Due to the ODBC limitation, GetChunk fails when you use a Forward only
cursor with Rowset Size &gt; 1. Using UserConnection Designer, the default
cursor is Forward only, and Rowset Size is 500. This causes "Invalid Cursor
Position" error.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To get BLOB data using a Forward-only cursor, you can:

<UL><LI>Set the Rowset Size to 1 on the Advanced tab of UserConnection Queryset
   object Properties page.
<P>
   -and-

<LI>Set Cursor Library to "Use server-side cursors" or "Use None" on the
   Miscellaneous tab of UserConnection object Properties page.
<P>
</UL>You could also open a Keyset type resultset in code by setting the
CursorType property of your RdoQuery object before executing the query,
such as the following:
<P>
<PRE>   Dim cn As New UserConnection1
   Dim rs as rdoResultset

   cn.EstablishConnection                            'establish connection
   cn.rdoQueries("Query1").CursorType = rdOpenKeyset 'define cursortype
   cn.Query1                                         'execute the query
   Set rs = cn.LastQueryResults

</PRE><h2>MORE INFORMATION</h2>
 
<P>
The following example uses pub_info table in Pubs database, because
pub_info has a TEXT column, pr_info.
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 
<P>
Task One: Create the UserConnection

<OL><P><LI>Start a new project in Visual Basic and choose "Standard EXE." Form1 is
   created by default.

<P><LI>On the Project menu, click Components, click the Designer tab, and then
   place a check next to Microsoft UserConnection.

<P><LI>On the Project menu, click Add ActiveX Designer, and then click
   Microsoft UserConnection. This will bring up a dialog titled
   UserConnection1 Properties.

<P><LI>On the Connection tab, select either a DSN or DSN-less connection and
   fill in the appropriate information. If you select DSN-less, make sure
   you specify a database in the Other ODBC Attributes area with
   database=Pubs. On the Authentication tab, fill in your username and
   password, and place a check next to Save Connection Information for
   Design Time.

<P><LI>Click OK to save this information, and return to the Designer window.

<P><LI>Insert a new Query by right-clicking on UserConnection1 and choosing
<P><PRE>    Insert Query or by clicking on the Insert Query toolbar icon.
</PRE>
<P><LI>From the Source of Query, choose Based on User-Defined SQL. Then type
   the following SQL into the TextBox:
<P>
<P><PRE>      Select pub_id, pr_info From pub_info
</PRE>
<P><LI>Click OK to save this information.
<P>
</OL>Task Two: Build the Visual Basic Code

<OL><P><LI>Add a CommandButton, Command1, to Form1.

<P><LI>Add a TextBox, Text1, to Form1. Set the MultiLine property to True;
   ScrollBars property to 3 - Both.

<P><LI>In the Command1_Click() event, paste the following code:
<P>
<P><PRE>      Private Sub Command1_Click()
<PRE></PRE>         Dim cn As New UserConnection1
         Dim rs As rdoResultset
         Dim ColSize As Long
         With cn
            .EstablishConnection       'Establish connection

    ' **** Un-comment the following line to change default cursor to Keyset
    '       .rdoQueries("Query1").CursorType = rdOpenKeyset
    ' ****
            .Query1
         End With

         Set rs = cn.LastQueryResults
         If rs!pr_Info.ChunkRequired Then
            ColSize = rs!pr_info.ColumnSize
            Text1.Text = rs!pr_info.GetChunk(ColSize)
         Else
            Text1.Text = rs!pr_info
         End If

         rs.Close
         cn.Close
      End Sub

</PRE><P><LI>Start the program or press the F5 key.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
For additional information, please see the following articles in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../VBWIN/Q166281.htm">Q166281</A></B>
   TITLE     : HOWTO: Create and Implement a UserConnection

   ARTILCE-ID: <B><A HREF="../VBWIN/Q153238.htm">Q153238</A></B>
   TITLE     : How to Use GetChunk and AppendChunk Methods of RDO Object

</PRE></OL>(c) Microsoft Corporation 1997, All Rights Reserved.
Contributions by Adrian Chiang, Microsoft Corporation
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : kberrmsg vb5all VBKBDB VBKBNet<BR>
Version             : 5.0<BR>
Platform            : WINDOWS<BR>
Issue type          : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 14, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
