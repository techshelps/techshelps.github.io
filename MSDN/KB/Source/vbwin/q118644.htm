

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: No Trappable Error on Shell to Nonexistent .BAT File </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q118644">
<META NAME="KBModify" CONTENT="1995/06/21">
<META NAME="KBCreate" CONTENT="1994/07/26">
<META NAME="Keywords" CONTENT="kbprg kbcode kbprb">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  When you execute the Shell command to run a batch (.BAT) file, no error message is generated if the batch file specified does not exist.  MORE INFORMATION  The following is from the Help topic  Shell :     The Visual Basic Shell command runs an exe...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QAH4,QAB4,QBIC,QBWS,QAUD,QBE7,QBE6,QAAP,QA5F,QAMA,QAIJ,QAY2,QABI,QBVV V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: No Trappable Error on Shell to Nonexistent .BAT File</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 21, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q118644</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic for Windows, versions 2.0 and 3.0, Standard
   and Professional Editions
<LI>Microsoft Visual Basic Programming System for Windows, version 1.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you execute the Shell command to run a batch (.BAT) file, no error
message is generated if the batch file specified does not exist.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following is from the Help topic "Shell":
<P>
<PRE>   The Visual Basic Shell command runs an executable program. If the
   Shell() function successfully executes the named program, it returns
   the instance handle of the started program. If the Shell() function
   can't start the named program, an error occurs.

</PRE>However, if you use Shell to run a batch file that does not exist, a modal
dialog box inclusing the following text is generated:
<P>
<PRE>     Cannot find file.
     Check to make sure the path and filename are correct.

</PRE>In this case, Visual Basic continues to run, no error message is generated,
and the return value from Shell() has a legitimate Windows instance handle.
<P>
<P><h2>CAUSE</h2>
 
<P>
This is by design and is the same behavior you see when using the Windows
API WinExec. "Shelling" to a batch program generates a handle to the
command processor, which runs the batch program. This handle is returned to
Visual Basic. When the command processor determines that there is no such
batch file, it is a process independent from Visual Basic and the error is
therefore not reported to Visual Basic.
<P>
<P><h3>Steps to Reproduce the Problem</h3>
 

<OL><P><LI>Start Visual Basic; or, if Visual Basic is already running, choose New
   Project (ALT + F, N) from the File menu. Form1 is created by default.

<P><LI>Add a text box (Text1) to Form1 and type "Bogus.Bat" (without the
   quotes) in the Text property.

<P><LI>Add the following code to the Form_Click event for Form1:
<P>
<PRE>      Sub Form_Click()
      Dim X As Integer
        X = Shell((Text1.Text))
        Print X, Err
        'returns a valid process handle in x and err = 0
      End Sub

</PRE><P><LI>From the Run menu, choose Start (ALT + R, S), or press the F5 key to run
   the program. Click the form.
<P>
</OL>The program attempts to run a nonexistent batch file and generates an error
outside the control of Visual Basic. If you enter a .EXE filename that does
not exist, Visual Basic correctly generates an error 53, "File Not Found".
<P>
<P><h3>Workaround</h3>
 
<P>
Replace the code from the above example with the following code:
<P>
<PRE>      Sub Form_Click()
      Dim X As Integer

        If Len(Dir((Text1.Text))) &gt; 0 Then
          X = Shell((Text1.Text))
          Print X, Err
          'returns a valid process handle in x and err = 0
        Else
          MsgBox "No such file exists."
        End If
      End Sub
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 2.00 3.00<BR>
KBCategory: kbprg kbcode kbprb<BR>
KBSubCategory: PrgOther<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 21, 1995</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
