

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>HOWTO: Connect to a Network Printer with the Win32 API </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q154007">
<META NAME="KBModify" CONTENT="1998/01/07">
<META NAME="KBCreate" CONTENT="1996/07/25">
<META NAME="Keywords" CONTENT="PrgOther vb432 VB4WIN">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  Using the Win32 API, it is possible to bring up a predefined Windows Dialog box for connecting to a network printer. The ConnectToPrinterDlg Win32 API works under Windows NT. However, it is not accessible by Visual Basic programs running under Wind...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QDIR,QBWQ,QAH4,QDL9,QBWO,QBWN,QDIT,QBWP,QAFF,QBWS,QA01,QAVZ,QANF,QAK7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Connect to a Network Printer with the Win32 API</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 7, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q154007</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Standard, Professional, and Enterprise Editions of Microsoft
   Visual Basic, 32-bit only, for Windows, version 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Using the Win32 API, it is possible to bring up a predefined Windows
Dialog box for connecting to a network printer. The ConnectToPrinterDlg
Win32 API works under Windows NT. However, it is not accessible by
Visual Basic programs running under Windows 95 because the user interface
is so different. Therefore, you must use a Command line equivalent
statement to invoke the "Add Printer Wizard" under Windows 95. Below is
a code sample showing how to implement both methods of displaying the
Dialog.
<P>
<P><h2>MORE INFORMATION</h2>
 

<OL><P><LI>Create a new project with Visual Basic. Form1 is created by default.

<P><LI>Add a CommandButton, Command1, to the form.

<P><LI>Add the following code to the General Declarations section of Form1:
<P>
   Option Explicit
<P>
   Private Type OSVERSIONINFO
<P><PRE>     dwOSVersionInfoSize As Long
     dwMajorVersion As Long
     dwMinorVersion As Long
     dwBuildNumber As Long
     dwPlatformId As Long
     szCSDVersion As String * 128
</PRE>   End Type
<P>
<PRE>   Private Declare Function GetVersionExA Lib "kernel32" _
      (lpVersionInformation As OSVERSIONINFO) As Integer
   Private Declare Function ConnectToPrinterDlg Lib "winspool.drv" (ByVal _
      hwnd As Long, ByVal flags As Long) As Long

   Private Sub Form_Load()
     Command1.Caption = "Press Me"
   End Sub

   Private Sub Command1_Click()
     Dim osinfo As OSVERSIONINFO
     Dim iReturn As Integer
     Dim lReturn As Long
     osinfo.dwOSVersionInfoSize = 148
     osinfo.szCSDVersion = Space$(128)
     iReturn = GetVersionExA(osinfo)
     If osinfo.dwMajorVersion = 3 And osinfo.dwMinorVersion = 51 And _
       osinfo.dwBuildNumber = 1057 And osinfo.dwPlatformId = 2 Then
       lReturn = ConnectToPrinterDlg(Form1.hwnd, 0)
     ElseIf osinfo.dwMajorVersion = 4 And osinfo.dwMinorVersion = 0 And _
       osinfo.dwBuildNumber = 67109814 And osinfo.dwPlatformId = 1 Then
       Shell "rundll32.exe shell32.dll,SHHelpShortcuts_RunDLL AddPrinter"
     Else
       MsgBox "Your Operating System has not been detected successfully !"
     End If
   End Sub

</PRE><P><LI>Press the F5 key to run the project. Click the buttons to see the
   results. Depending on which operating system you are running, you will
   see that one dialog works and one doesn't:
<P>
<PRE>                          NT 3.51          Win95
      ---------------------------------------------

      dwMajorVersion           3              4
      dwMinorVersion          51              0
      dwBuildNumber         1057       67109814
      dwPlatformId             2              1

</PRE></OL><h2>REFERENCES</h2>
 
<P>
The Win32 SDK.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: ConnectToPrinterDlg<BR>
Keywords          : PrgOther vb432 VB4WIN<BR>
Version           : 4.0<BR>
Platform          : NT WINDOWS<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 7, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
