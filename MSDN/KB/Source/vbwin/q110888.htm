

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Example of NPV and IRR Financial Functions in VB for Windows </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q110888">
<META NAME="KBModify" CONTENT="1995/06/21">
<META NAME="KBCreate" CONTENT="1994/02/01">
<META NAME="Keywords" CONTENT="kbprg kbcode">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  This article explains the NPV and IRR financial functions and gives a sample program.  MORE INFORMATION  The NPV, IRR, and MIRR functions are used for investments that are a series of nonconstant cash payments made at equal intervals. You pass the ...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAUD,QAKD,QAY5,QBS0,QAHH,QAB9,QBV8,QALE,QALA,QAK9,QALW,QANY,QAJQ,QAV1,QAV0 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Example of NPV and IRR Financial Functions in VB for Windows</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 21, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q110888</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:
<P>
- Professional Edition of Microsoft Visual Basic programming system
<PRE>  for Windows, version 3.0
</PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article explains the NPV and IRR financial functions and gives a
sample program.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The NPV, IRR, and MIRR functions are used for investments that are a series
of nonconstant cash payments made at equal intervals. You pass the series
of nonconstant payments in an array.
<P>
The nonconstant-payment functions (NPV, IRR, and MIRR) are in a different
category than the financial functions for annuity investments (FV, IPmt,
Rate, NPer, PV, Pmt, and PPmt). In an annuity, each cash payment is the
same constant amount, made at equal intervals.
<P>
The present value (PV) of a future cash receipt is the amount of money
that, if received today, would be considered equivalent to the future
receipt, at a given interest rate. The present value is less than the
future receipt because you can earn interest on money received today. NPV
(Net Present Value) compares (subtracts) the current value of a series of
future cash flows with an amount invested today.
<P>
NPV is useful to compare investment opportunities at a given discount
(interest) rate. The discount rate (found with the Rate function) can be
viewed as the rate of return you want out of your investment. If NPV is
greater than or equal to 0, the investment equals or exceeds your interest
(discount) rate requirement; if NPV is less than 0, the investment does not
meet your interest rate requirement.
<P>
The IRR function returns Internal Rate of Return. IRR returns the discount
rate at which NPV would return 0 (zero). For a given array of cash flow
values, IRR can be thought of as an average interest rate (which compounds
at each period). If IRR is lower than the interest rate you desire for this
investment, then it is not a good investment.
<P>
The first element of the input cash-flow array should usually be negative,
indicating your initial investment. A high (positive) income early in the
value array will make IRR higher than if the same high income instead
occurred later in the array. This is an example of the time value of money.
<P>
Please refer to an Accounting textbook for more information about these
standard Accounting functions.
<P>
<P><h3>Step-by-Step Example with Code</h3>
 

<OL><P><LI>Start a new project in Visual Basic. Form1 is created by default.

<P><LI>Add the following code to the General Declarations section of Form1:
<P>
   DefDbl A-Z
<PRE>   ' Enter each Declare statement on one, single line:
   Declare Function NPVC Lib "MSAFINx.DLL" (ByVal Rate1#, values#,
      ByVal cvalues%) As Double
   Declare Function IRRC Lib "MSAFINx.DLL" (values#, ByVal cvalues%,
      ByVal Guess#) As Double

   Function IRR (values() As Double, ByVal Guess As Double) As Double
      On Error GoTo IrrErr
      iArgMin% = LBound(values)
      cArg% = UBound(values) - iArgMin%
      IRR = IRRC#(values(iArgMin%), cArg%, Guess)
      Exit Function
   IrrErr:
      MsgBox "Error " &amp; (Str$(Err))
      Exit Function
   End Function

   Function NPV (ByVal Rate1 As Double, values() As Double) As Double
      On Error GoTo NpvErr
      iArgMin% = LBound(values)
      cArg% = UBound(values) - iArgMin%
      NPV = NPVC#(Rate1, values(iArgMin%), cArg%)
      Exit Function
   NpvErr:
      MsgBox "Error " &amp; (Str$(Err))
      Exit Function
   End Function

</PRE><P><LI>Add the following code to the form Load event:
<P>
<PRE>   Sub Form_Load ()

      form1.Show  ' Must Show form in Load event for Print to work.
      ' Array holds cash flow values, one value per period (such as year):
      ReDim valuearray(5) As Double
      guess = .05        ' Guess the IRR (use .1 if in doubt).

      valuearray(0) = -70000 ' 0. First value negative initial investment
      valuearray(1) = 22000  ' 1. Return on investment after 1 period.
      valuearray(2) = 25000  ' 2. (Pos value is return on investment.)
      valuearray(3) = 28000  ' 3. (Neg value is additional investment.)
      valuearray(4) = 31000  ' 4. Return on investment after 4 periods.
      ' For the above values, IRR returns 17.7% return per period

      irreturn = IRR(valuearray(), guess)

      discountrate = 0  ' If discountrate = 0,
                        ' NPV returns sum of valuearray().
      netpresval = NPV(discountrate, valuearray())
      ' Notes for NPV() function:
      ' If discountrate = value returned by IRR(), then NPV returns zero.
      ' If discountrate = zero, NPV returns sum of values in valuearray().
      ' If discountrate &gt; zero, NPV returns an amount smaller than sum of
      ' values in valuearray() due to the discount effect at each period.
      ' If discountrate &lt; zero, NPV returns an amount larger than the sum
      ' of the values in valuearray().

      Print "IRR (fractional return on investment per period) = "; irreturn
      Print "NPV = "; Format$(netpresval, "Standard")

   End Sub

</PRE><P><LI>Press the F5 key to run the program.
<P>
</OL>For the above values, IRR returns .177 (17.7% return per period).
<P>
NOTE: By definition, IRR returns the discount rate at which NPV returns 0.
<P>
<P><h3>NPV, IRR, MIRR: Reference to Undefined Function or Array</h3>
 
<P>
For more information, see the following article in the Microsoft Knowledge
Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../VBWIN/Q101245.htm">Q101245</A></B>
   TITLE     : BUG: Ref to NPV / IRR / MIRR Gives Undefined Functions Error

</PRE></OL>If you try to run an application that contains a reference to the NPV, IRR,
or MIRR financial function, Visual Basic for Windows generates this error:
<P>
<PRE>   Reference to undefined Function or Array

</PRE>Visual Basic does not recognized these as Visual Basic functions because
they were incorrectly referenced in the financial DLL file (MSAFINX.DLL)
that ships with Visual Basic version 3.0.
<P>
To work around the problem, you can declare the NPVC, IRRC, and MIRRC
functions located in MSAFINX.DLL and alias them as NPV, IRR, and MIRR
respectively, as shown farther above.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00<BR>
KBCategory: kbprg kbcode<BR>
KBSubcategory: PrgOther<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 21, 1995</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
