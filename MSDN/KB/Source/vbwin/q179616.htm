

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: Rollback Causes DAO Recordset Editmode To Be Set Back to 0 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q179616">
<META NAME="KBModify" CONTENT="1998/01/21">
<META NAME="KBCreate" CONTENT="1998/01/20">
<META NAME="Keywords" CONTENT="vb5all">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  If the edit command is issued for a recordset, and an unrelated transaction is rolled back before the update command, the following error is returned when the update command is issued:     run-time Error 3020 --  Update or CancelUpdate Without Addn...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAXB,QAMB,QBXS,QAPN,QAIJ,QDKW,QAC1,QBD2,QAO4,QAH4,QAAP,QAB4,QBS0,QBQU,QBWS V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Rollback Causes DAO Recordset Editmode To Be Set Back to 0</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 21, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q179616</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Enterprise Edition for Windows, version 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If the edit command is issued for a recordset, and an unrelated transaction
is rolled back before the update command, the following error is returned
when the update command is issued:
<P>
<PRE>   run-time Error 3020 -- "Update or CancelUpdate Without Addnew or Edit"

</PRE>If the transaction is committed, this error does not occur.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To work around this problem, move the rs.Update method statement so that it
is executed before the transaction is started, as shown in the MORE
INFORMATION section below. To implement this workaround, change the code
that has two update commands, one of which is commented. Uncomment that one
and comment the one that is not commented.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft is researching this problem and will post new information here in
the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Start a new Standard Exe VB project. Form1 is created by default.

<P><LI>Check the reference to the DAO 3.5 object library.

<P><LI>Add a new form, and then add a CommandButton to the form.

<P><LI>Paste the code below into the CommandButton Click event.

<P><LI>Change the OpenDatabase method so that it points to the Northwinds
   database on your local machine, and then run the project:
<P>
<P><PRE>      Private Sub Command1_Click()
</PRE>   
<P><PRE>       Dim rs As Recordset
       Dim db As Database
</PRE>   
<P><PRE>       Set db = OpenDatabase("c:\mikework\dbs\nwind.mdb", 0, False, "")
</PRE>   
<P><PRE>       Set rs = db.OpenRecordset("SELECT ContactName FROM Customers", _
       dbOpenDynaset, 0, dbPessimistic)
</PRE>   
<PRE>       rs.Edit     'This sets the editmode to 1.
       rs!ContactName = rs!ContactName &amp; "H"
       Debug.Print rs.EditMode  'This will be 1.
       'rs.Update   'Uncomment this line for workaround.
   
       'Start the transaction.
       BeginTrans
          'The processing that occurs in this transaction is unrelated
          'to the above recordset.
       Rollback
   
       Debug.Print rs.EditMode  'Editmode is now 0.
       rs.Update  '&lt;&lt;Error will occur on this line.
   
       rs.Close
       db.Close
   
      End Sub
</PRE></OL> 
<PRE>Keywords          : vb5all
Component         : dao
Version           : WINDOWS:5.0
Platform          : WINDOWS
Issue type        : kbprb</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 21, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
