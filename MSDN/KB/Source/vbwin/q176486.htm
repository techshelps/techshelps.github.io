

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>BUG: Bookmark for Unbound DBGrid is Incorrect for the Last Row </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q176486">
<META NAME="KBModify" CONTENT="1997/11/10">
<META NAME="KBCreate" CONTENT="1997/11/07">
<META NAME="Keywords" CONTENT="vb5all VBKBAX VBKBComp VBKBCtrl VBKBDB VBKBStd">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  The Bookmark property of the DBGrid control can be used to save a reference to the current row. By setting the Bookmark property, the current row can be updated as well.  If the Bookmark property of an unbound DBGrid control is saved while the last...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAML,QA5V,QAPP,QAFF,QAUR,QAH4,QBS0,QBWR,QAPN,QAAP,QAU7,QAB4,QAC1,QAKP,QA7O V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Bookmark for Unbound DBGrid is Incorrect for the Last Row</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 10, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q176486</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Control Creation, Learning, Professional, and
   Enterprise Editions for Windows, version 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The Bookmark property of the DBGrid control can be used to save a reference
to the current row. By setting the Bookmark property, the current row can
be updated as well.
<P>
If the Bookmark property of an unbound DBGrid control is saved while the
last row is selected, setting the Bookmark property back to the saved value
will update the current row to be the first row, rather than the last.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
As a workaround, use the RowBookmark method of the DBGrid control when
saving the Bookmark of the current row:
<P>
<PRE>   Private MyBookmark

   Private Sub cmdSaveBookmark_Click()

       MyBookmark = DBGrid1.RowBookmark(DBGrid1.Row)

   End Sub

</PRE>Also, the following error handling code will need to be included when
updating the current row:
<P>
<PRE>   Private Sub cmdRestoreBookmark_Click()
   On Error GoTo err_handler

       DBGrid1.Bookmark = MyBookmark

   Exit Sub

   err_handler:
   Dim r

       If Err.Number = 6149 Then
           For r = 0 To DBGrid1.VisibleRows - 1
               DBGrid1.Row = r
           Next r
           Resume
       Else
           Err.Raise Err.Number
       End If

   End Sub

</PRE>The above error handling code is necessary because the bug associated with
the Bookmark property for the last row will also cause run-time error 6149.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products
listed at the beginning of this article. We are researching this
bug and will post new information here in the Microsoft Knowledge
Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Open the sample project, UnBndGrd.vbp, in the Visual Basic samples
   directory (such as C:\Program
   Files\DevStudio\VB\samples\Misc\UnBndGrd\UnBndGrd.vbp).

<P><LI>Add two CommandButtons to Form1 and name them cmdSaveBookmark and
   cmdRestoreBookmark.

<P><LI>Add the following code to the General Declarations section of Form1:
<P>
<P><PRE>      Private MyBookmark
</PRE><P>
<P><PRE>      Private Sub cmdSaveBookmark_Click()
</PRE><P>
<PRE>          MyBookmark = DBGrid1.Bookmark

      End Sub

      Private Sub cmdRestoreBookmark_Click()

          DBGrid1.Bookmark = MyBookmark

      End Sub

</PRE><P><LI>Run the project.

<P><LI>Select a row in the DBGrid (not the last row) and click on
   cmdSaveBookmark to save the Bookmark. Move to another row and click on
   cmdRestoreBookmark to return to the original row.

<P><LI>Repeat step 5 with the last row and notice that the DBGrid does not
   return to the last row but to the first row instead.
</OL> 
<PRE>Keywords          : vb5all VBKBAX VBKBComp VBKBCtrl VBKBDB VBKBStd
Version           : WINDOWS:5.0
Platform          : WINDOWS
Issue type        : kbbug</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 10, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
