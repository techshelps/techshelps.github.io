

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>HOWTO: Populate DBGrid from Crosstab Parameter Query </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q172593">
<META NAME="KBModify" CONTENT="1997/08/13">
<META NAME="KBCreate" CONTENT="1997/08/11">
<META NAME="Keywords" CONTENT="VB4ALL VB4WIN vb5all kbhowto">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  This article demonstrates how to create a Parameter Crosstab Query using the sample Nwind.mdb Access database file. It also explains how to create a recordset in Visual Basic by running the query, passing the necessary parameters to it, and then po...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QABM,QAHE,QAB5,QAUD,QBMW,QA7O,QA5F,QAOE,QAMN,QAMA,QBWS,QDNC,QDNA,QDPA V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Populate DBGrid from Crosstab Parameter Query</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  August 13, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q172593</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Professional and Enterprise Editions for
   Windows, version 5.0
<LI>Microsoft Visual Basic Professional and Enterprise Editions, 16-bit and
   32-bit, for Windows, version 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article demonstrates how to create a Parameter Crosstab Query using
the sample Nwind.mdb Access database file. It also explains how to create a
recordset in Visual Basic by running the query, passing the necessary
parameters to it, and then populating a Visual Basic DBGrid with the
resultant recordset.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following example uses the sample Nwind database that ships with Visual
Basic. Note that it is recommended to explicitly declare the parameters
when creating and running Crosstab Parameter Queries. See the REFERENCES
section of this article for more information.

<OL><P><LI>Create a new Project in Visual Basic.

<P><LI>From the menu, select Project - References and make a reference to
   Microsoft DAO 3.5 Object Library. In Visual Basic 4.0, under Tools
   references make, a reference to DAO 3.0 object library.

<P><LI>From the menu, select Project - Components and select a Data Bound Grid
   control. In Visual Basic 4.0, this is under Tools - Custom Controls.

<P><LI>Add a CommandButton, a Data Control and a DBGrid Control to the new
   Form.

<P><LI>Accept the default Names for the Command Button, DBGrid, and Data
   Control.

<P><LI>Enter the sample code below into the General Declarations of the
   Form.

<P><LI>In the properties Window, set the DataSource property of the DBGrid to
   Data1 to bind the DBGrid to the Data control.

<P><LI>Run the application and click the CommandButton.
<P>
   Sample code:
<P>
<P><PRE>      Private Sub Command1_Click()
<PRE></PRE>        Dim Sql As String
        Dim DatabaseFile As String
        Dim MyDB As Database
        Dim RS As Recordset
        Dim QD As QueryDef
   
      On Error GoTo errorHand
   
      'This is the Path &amp; Database filename.
      'Change to match your path and filename.
      DatabaseFile = "C:\VB5\Nwind.mdb"
   
      'Create the querydef SQL string
      Sql = "Parameters [Enter first date] DateTime, " _
         &amp; "[Enter second date] DateTime;"
      Sql = Sql &amp; " TRANSFORM Sum(CCur([Order Details].[UnitPrice]" _
         &amp; " *[Quantity]*(1-[Discount])/100)*100) AS ProductAmount"
      Sql = Sql &amp; " SELECT Products.ProductName, Orders.CustomerID," _
         &amp; " Year([OrderDate]) AS OrderYear"
      Sql = Sql &amp; " FROM Products INNER JOIN (Orders INNER JOIN" _
         &amp; " [Order Details] ON Orders.OrderID ="
      Sql = Sql &amp; " [Order Details].OrderID) ON" _
         &amp; " Products.ProductID = [Order Details].ProductID"
      Sql = Sql &amp; " WHERE (((Orders.OrderDate) Between" _
         &amp; " [Enter first date] And [Enter second date]))"
      Sql = Sql &amp; " GROUP BY Products.ProductName, Orders.CustomerID," _
         &amp; " Year([OrderDate])"
      Sql = Sql &amp; " PIVOT 'Qtr ' &amp; DatePart('q',[OrderDate],1,0) In" _
         &amp; " ('Qtr 1','Qtr 2','Qtr 3','Qtr 4');"

      'This code creates the parameter query
   
      Set MyDB = DBEngine(0).OpenDatabase(DatabaseFile)
      Set QD = MyDB.CreateQueryDef("CrossTabParamQuery")
      With QD
          .Sql = Sql
          .Parameters("[Enter first date]") = #1/1/95#
          .Parameters("[Enter second date]") = #1/1/96#
      End With
      Set Rs = QD.OpenRecordset(dbOpenDynaset)
      Set Data1.Recordset = Rs
      Exit Sub
   
      errorHand:
      If Err.Number = 3012 Then   ' The querydef exists
          MyDB.QueryDefs.Delete "CrossTabParamQuery"
          Resume
      Else
          MsgBox Err.Number &amp; "  " &amp; Err.Description
      End If
      End Sub
   
      Private Sub Form_Unload(Cancel As Integer)
         RS.Close
         QD.Close
         MyDB.Close
      End Sub

</PRE></OL><h2>REFERENCES</h2>
 
<P>
Visual Basic Help topic "PARAMETERS Declaration"
<P>
For more information, please see the following article in the Microsoft
Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../ACCESS/Q91710.htm">Q91710</A></B>
   TITLE     : Can't Bind Name '[XXX]'" Error with Crosstab Query
</PRE> 
<PRE>Keywords          : VB4ALL VB4WIN vb5all kbhowto
Component         : jet
Version           : WINDOWS:4.0,5.0
Platform          : WINDOWS
Issue type        : kbhowto</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  August 13, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
