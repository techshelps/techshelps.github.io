

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>BUG: Mouse Captured After Clicking DBGrid Column Header </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q149487">
<META NAME="KBModify" CONTENT="1997/03/26">
<META NAME="KBCreate" CONTENT="1996/04/03">
<META NAME="Keywords" CONTENT="PrgCtrlsCus vb4all vb4win kbbuglist">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  Clicking a column header in a DBGrid control of a Visual Basic program causes the mouse to remain inside the borders of the column headers. The program only responds to keyboard commands when the mouse cursor is trapped in the column header.  WORKA...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QBS0,QA4Q,QAE1,QBWS,QA7O,QAY5,QAOE,QAMN,QAIJ,QAB5,QAO2,QDMN,QAK7,QANF V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Mouse Captured After Clicking DBGrid Column Header</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 26, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q149487</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Standard, Professional, and Enterprise Editions of Microsoft Visual
   Basic, 16-bit and 32-bit, for Windows, version 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Clicking a column header in a DBGrid control of a Visual Basic program
causes the mouse to remain inside the borders of the column headers. The
program only responds to keyboard commands when the mouse cursor is trapped
in the column header.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
In order to work around the problem it is possible to add the following
code to the project. Because this problem should not affect the compiled
executable, it is possible to remove the workaround before debugging.

<OL><P><LI>Add the following code to the General Declaration section of the form:
<P>
<P><PRE>      #If Win32 Then
      Private Declare Function GetWindowRect Lib "user32" _
      (ByVal hWnd As Long, lpRect As RECT) As Long
      Private Declare Function ClipCursor Lib "user32" (lpRect As Any) _
      As Long
      Private Declare Function GetDesktopWindow Lib "user32" () As Long
      
      Private Type RECT
<PRE></PRE>          left As Long
          top As Long
          right As Long
          bottom As Long
      End Type
      
      #Else
      Private Declare Sub GetWindowRect Lib "user" _
      (ByVal hWnd As Integer,lpRect As RECT)
      Private Declare Sub ClipCursor Lib "user" (lpRect As Any)
      Private Declare Function GetDesktopHwnd Lib "user" () As Integer
      
      Private Type RECT
          left As Integer
          top As Integer
          right As Integer
          bottom As Integer
      End Type

</PRE><P><LI>Add the following code to the click event before the Stop:
<P>
<P><PRE>      Dim winrect As RECT
      #If Win32 Then
<PRE></PRE>          Dim dskhwnd As Long
          Dim suc As Long
          dskhwnd = GetDesktopWindow()
          suc = GetWindowRect(dskhwnd, winrect)
          suc = ClipCursor(winrect)
      #Else
          Dim dskhwnd As Integer
          Dim suc As Integer
          dskhwnd = GetDesktopHwnd()
          Call GetWindowRect(dskhwnd, winrect)
          Call ClipCursor(winrect)
      #End If
      'Stop and/or all other code goes here

</PRE></OL>NOTE: All code should follow this patch code in the subroutine.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be an issue in the Microsoft products
listed at the beginning of this article. Microsoft is researching this
problem and will post new information here in the Microsoft Knowledge Base
as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
To reproduce this behavior, add a DBGrid control to a form. In the click
event of the DBGrid control, stop the program by adding the stop keyword.
When you run the program and click the column headers of the DBGrid
control, the mouse pointer cannot be moved outside the borders of the
DBGrid column headers.
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Start Visual Basic or if it is already running, click New Project on
   the File menu.

<P><LI>Add a DBGrid control to the Form1 form.

<P><LI>Copy the following code sample to the Form1 code window.
<P>
<P><PRE>      Private Sub DBGrid1_Click()
<PRE></PRE>         Stop
      End Sub

</PRE><P><LI>On the Run menu, click start, or press the F5 key to start the program.

<P><LI>Click the column head of the DBGrid control. The cursor remains within
   the boundaries of the column headers.
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : PrgCtrlsCus vb4all vb4win kbbuglist<BR>
Version             : 4.0<BR>
Platform            : NT WINDOWS<BR>
Issue type          : kbbug<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 26, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
