

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>HOWTO: Determine File Type from Registered CLSID </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q174050">
<META NAME="KBModify" CONTENT="1997/09/19">
<META NAME="KBCreate" CONTENT="1997/09/18">
<META NAME="Keywords" CONTENT="vb432 VB4WIN vb5all vb5howto">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  You can use the Windows API to retrieve the CLSID (class ID) associated with a given file and use this value to determine the product and version of its format.  MORE INFORMATION  The CLSID for a product or component can be found in the Windows Reg...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QBVP,QAIH,QATX,QAH4,QDL9,QBWQ,QBWO,QBWN,QAGX,QAPF,QBWS,QA5B,QAY5,QAY2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Determine File Type from Registered CLSID</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 19, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q174050</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Control Creation, Learning, Professional, and
   Enterprise Editions for Windows, version 5.0
<LI>Microsoft Visual Basic Standard, Professional, and Enterprise Editions,
   32-bit only, for Windows, version 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
You can use the Windows API to retrieve the CLSID (class ID) associated
with a given file and use this value to determine the product and version
of its format.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The CLSID for a product or component can be found in the Windows Registry
under HKEY_CLASSES_ROOT. For example:
<P>
<PRE>   MyComputer\HKEY_CLASSES_ROOT\Excel.Sheet.8\CLSID

</PRE>The following example creates a Visual Basic project that shows how to
retrieve and use the CLSID associated with a given file. Constants are only
defined for two versions of Microsoft Excel and two versions of Microsoft
Word to demonstrate this technique. This example can be modified to work
for any file format with a unique CLSID associated with it.
<P>
NOTE: In order to identify a file on a given system, the appropriate CLSID
must be registered on the system running this code. Also, this sample does
not include any error trapping, which should be added for any production
use of this technique.
<P>
<P><h3>Step-by-Step Example</h3>
 

<OL><P><LI>Start a new project. Form1 is created by default.

<P><LI>Add a Command button, a TextBox, and two Labels to Form1.

<P><LI>Set the AutoSize property of each Label to True.

<P><LI>Copy the following code into the Form's module:
<P>
<P><PRE>      Private Sub Command1_Click()
      Dim FileCLSID As String
</PRE><P>
<P><PRE>      FileCLSID = GetCLSID(Text1.Text)
      Label2.Caption = FileCLSID
      Select Case FileCLSID
<PRE></PRE>        Case EXCEL97
          Label1.Caption = "Excel 97"
        Case EXCEL95
          Label1.Caption = "Excel 95"
        Case WORD97
          Label1.Caption = "Word 97"
        Case WORD95
          Label1.Caption = "Word 95"
        Case Else
          Label1.Caption = "Unknown File Version"
      End Select
      End Sub

</PRE><P><LI>Add a Module to the project. In Visual Basic 4, choose "Module" from the
   "Insert" menu. In Visual Basic 5, choose "Add Module" from the "Project"
   menu.

<P><LI>Copy the following code into Module1:
<P>
<P><PRE>      Type GUID
<PRE></PRE>        B(16) As Byte
      End Type

      Declare Function GetClassFile Lib "Ole32.DLL" (ByVal lpszFileName _
      As String, ByRef pclsid As GUID) As Long

      Declare Function StringFromGUID2 Lib "Ole32.DLL" (ByRef rguid _
      As GUID, ByVal lpsz As String, ByVal cbMax As Long) As Long

      Public Const EXCEL97 As String = _
         "{00020820-0000-0000-C000-000000000046}"
      Public Const EXCEL95 As String = _
         "{00020810-0000-0000-C000-000000000046}"
      Public Const WORD97 As String = _
         "{00020906-0000-0000-C000-000000000046}"
      Public Const WORD95 As String = _
         "{00020900-0000-0000-C000-000000000046}"

      Function GetCLSID(FileName As String) As String
         Dim g As GUID
         Dim RetVal As Long
         Dim strGUID As String

         RetVal = GetClassFile(StrConv(FileName, vbUnicode), g)
         strGUID = Space(255)
         RetVal = StringFromGUID2(g, strGUID, 255)
         strGUID = StrConv(strGUID, vbFromUnicode)
         If (InStr(strGUID, Chr(0)) &gt; 0) Then
            strGUID = Left(strGUID, InStr(strGUID, Chr(0)) - 1)
         End If
         GetCLSID = strGUID
      End Function

</PRE><P><LI>Run the project and enter a path and filename for a Word 97 or Word 95
   document, or an Excel 97 or Excel 95 Worksheet into Text1. Click on
   Command1 and the type of file will be displayed in Label1 and the actual
   CLSID will be displayed in Label2.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
For more information, please Search on the following topics in either the
Win32 Programmer's Reference or The Microsoft Developer Network (MSDN)
Library CD:

<UL><LI>GetClassFile
<LI>StringFromGUID2
<LI>CLSID (class ID)
</UL> 
<PRE>Keywords          : vb432 VB4WIN vb5all vb5howto
Version           : WINDOWS:4.0,5.0
Platform          : WINDOWS
Issue type        : kbhowto</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 19, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
