

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>BUG: Error When Closing a Program Through the Control Box </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q143046">
<META NAME="KBModify" CONTENT="1996/10/14">
<META NAME="KBCreate" CONTENT="1996/01/24">
<META NAME="Keywords" CONTENT="kbprg kbbuglist">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  An application error occurs when you close a Visual Basic program through the control box if the Visual Basic program executes a command after an object created from a class module is set to nothing. This problem occurs only in the 32-bit edition o...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QBS0,QAPN,QBXS,QAAP,QAB4,QBJZ,QBWS,QAO4,QAJH,QAKP,QAI4,QA7O,QA5F,QAOE V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Error When Closing a Program Through the Control Box</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 14, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q143046</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Standard, Professional, and Enterprise Editions of Microsoft Visual
   Basic for Windows, 32-bit only, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
An application error occurs when you close a Visual Basic program through
the control box if the Visual Basic program executes a command after an
object created from a class module is set to nothing. This problem occurs
only in the 32-bit edition of Visual Basic 4.0.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
The workaround to this issue is execute all the code in the event before
setting the object to nothing. The statement to set the object to nothing
should be the last line in the event procedure.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be an issue in the Microsoft products
listed at the beginning of this article. Microsoft is researching this
problem and will post new information here in the Microsoft Knowledge Base
as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Issue</h3>
 

<OL><P><LI>Start the 32-bit version of Visual Basic 4.0 or if it is already
   running, click New Project on the File menu.

<P><LI>Use the following steps to create a class module.
<P>
<P><PRE>    - Click Class Module on the Insert Menu. The code window for the class
      module appears.
</PRE><P>
<P><PRE>    - In the Properties window of the Class1 class module, set the
      Instancing Property to 2-Createable MultiUse, and the Public property
      to True.
</PRE><P>
<P><PRE>    - Add the following code to the Class1 code window:
</PRE><P>
<P><PRE>      Option Explicit
      Public Name As String
      Private Sub Class_Terminate()
<PRE></PRE>         Form1.Print Name
      End Sub

</PRE><P><LI>Add the following code to the Form1 code window.
<P>
<P><PRE>      Option Explicit
      Public A As New Class1
</PRE><P>
<P><PRE>      Private Sub Form_Load()
<PRE></PRE>         Show
         Set A = New Class1
         A.Name = "A"

         'To workaround this bug, cut the next line
         Set A = Nothing

         Print "A Is " &amp; IIf(A Is Nothing, "Nothing", "Something")
         'And uncomment this next line.
         'Set A = Nothing
      End Sub

</PRE><P><LI>Press the F5 key or click Start on the Run menu to run the program.

<P><LI>Click Close from the Control Bar menu on the form. One of the following
   application error displays and Visual Basic ends:
<P>
   Windows NT 32-bit:
<P>
<P><PRE>      An application error has occurred and an application
      error log is being generated, VB32.exe Exception: access
      violation (0xc0000005), Address: 0x001d02d7.
</PRE><P>
<P><PRE>      -or-
</PRE><P>
<P><PRE>      VB32.EXE-Application Error dialog box. The instruction
      at "0x001aaff8" referenced memory at "0x007dbd6b". The
      memory could not be "written".
</PRE><P>
   Windows 95 32-bit:
<P>
<P><PRE>     VB32 caused an invalid page fault in module &lt;unknown&gt; at
     0000:a0000001.
<P></BLOCKQUOTE>
</OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.00 vb4win vb432<BR>
KBCategory: kbprg kbbuglist<BR>
KBSubcategory: IAPOLE PrgCtrls<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 14, 1996</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
