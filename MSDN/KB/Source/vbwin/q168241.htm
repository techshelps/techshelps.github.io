

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>HOWTO: Query the Top N or N% Records in Visual Basic </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q168241">
<META NAME="KBModify" CONTENT="1997/05/08">
<META NAME="KBCreate" CONTENT="1997/05/08">
<META NAME="Keywords" CONTENT="APrgData kbcode vb4all vb4win VBKBDAO VBKBDB VBKBJet VBKBObj kbhowto">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  This article describes how to use the TOP predicate to return the top N number of records that meet the conditions of a query.  With the release of Microsoft Access version 2.0, the TOP predicate was introduced in Microsoft Access SQL syntax. Visua...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QA1S,QABM,QA5V,QA5F,QAMB,QAMA,QDN9,QAZV,QAPN,QBXS,QBE7,QBE6,QAUD,QAW6 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Query the Top N or N% Records in Visual Basic</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 8, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q168241</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Learning, Professional, and Enterprise Editions
   for Windows, version 5.0
<LI>Microsoft Visual Basic Standard, Professional, and Enterprise Editions,
   16-bit and 32-bit, for Windows, version 4.0
<LI>Microsoft Visual Basic Standard and Professional Editions for Windows,
   versions 3.0, 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article describes how to use the TOP predicate to return the top N
number of records that meet the conditions of a query.
<P>
With the release of Microsoft Access version 2.0, the TOP predicate was
introduced in Microsoft Access SQL syntax. Visual Basic version 3.0 itself
will not accept the TOP predicate directly, but it is possible to use the
TOP predicate with Visual Basic version 3.0 if you are using the Microsoft
Jet 2.x engine that ships with Microsoft Access version 2.0.
<P>
The TOP predicate is now accepted syntax in Visual Basic version 4.0.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
You can use the TOP predicate to return the first N records that match the
conditions of a query, where N is a number less than or equal to the total
records returned by the query. For example, the following query returns the
first 10 records in the Titles table:
<P>
<PRE>   SELECT TOP 10 Titles.* FROM Titles;

</PRE>You can use TOP with the PERCENT keyword to return the first N% records
matching the conditions of a query, where N% is between 0% and 100%. For
example, the following query returns the first 10% of all the records in
the Titles table:
<P>
<PRE>   SELECT TOP 10 PERCENT Titles.* FROM Titles;

</PRE>The text below describes how to use the TOP predicate with the different
versions of Visual Basic and Microsoft Access database formats.
<P>
<P><h3>Using TOP Predicate in Visual Basic 3.0 with Microsoft Access 1.x Database</h3>
 
<P>
To use the TOP predicate with Visual Basic version 3.0 in Titles, you will
need Microsoft Access version 2.0 and the Microsoft Jet 2.0/Visual Basic
3.0 Compatibility Layer in addition to Visual Basic, even if the target
database is in Microsoft Access version 1.x format.
<P>
Visual Basic version 3.0 was released with the Microsoft Access version 1.x
database, so TOP is not supported directly. This is demonstrated by trying
to create a querydef using the TOP predicate as shown here:
<P>
<PRE>   Dim mydb As Database, MyQuery As QueryDef
   Dim Sql$

   Sql$ = "SELECT TOP 10 Titles.* FROM Titles;"
   Set mydb = OpenDatabase("C:\VB\BIBLIO.MDB")
   Set MyQuery = mydb.CreateQueryDef("TopQuery", Sql$)

</PRE>The last line of this code sample will generate the following error
message:
<P>
<PRE>   "Invalid SQL Statement: expected 'DELETE', 'INSERT', 'PROCEDURE',
      'SELECT', or 'UPDATE'"

</PRE>This error message occurs because Visual Basic itself is trying to parse
the SQL syntax given in the CreateQueryDef object in the context of the
version of the database being used. This parsing or validation of the SQL
Syntax, however, is not performed when setting a Data Control RecordSource
property, a Dynaset object, or a Snapshot object for a 1.x database.
<P>
The following code works with Visual Basic version 3.0 and a Microsoft
Access version 1.x database:
<P>
<PRE>   Dim Sql$
   Dim MyDynaset as Dynaset
   Dim MySnapshot as Snapshot
   Sql$ = "SELECT TOP 10 Titles.* FROM Titles;"

   data1.recordSource = Sql$
   ' -or-
   MyDynaset = MyDb.CreateDynaset( Sql$ )
   ' -or-
   MySnapshot = MyDb.CreateSnapshot( Sql$ )

</PRE><h3>Using TOP Predicate in Visual Basic 3.0 with Microsoft Access 2.X Database</h3>
 
<P>
You can use the TOP predicate with Visual Basic version 3.0 and databases
in Microsoft Access version 2.x format. This includes use within:

<UL><LI>A QueryDef object.
<LI>A Snapshot object.
<LI>A Dynaset object.
<LI>A Data Control.
<P>
</UL>While Visual Basic itself still does not recognize the syntax, the
Microsoft Jet 2.0 database engine takes over the parsing and validation,
even for the QueryDef object. Therefore, Visual Basic can use the following
code without producing an error:
<P>
<PRE>   Dim mydb As Database, MyQuery As QueryDef
   Dim Sql$

   Sql$ = "SELECT TOP 10 Titles.* FROM Titles;"
   Set mydb = OpenDatabase("C:\VB\BIBLIO.MDB")
   Set MyQuery = mydb.CreateQueryDef("TopQuery", Sql$)

</PRE>Using TOP Predicate in Visual Basic 4.0+ with Microsoft Access 2.x or 3.x
Database
 
<P>
Visual Basic version 4.0+ recognizes the TOP predicate as valid SQL Syntax.
Although the TOP predicate itself is not listed as a index entry in the
Visual Basic version 4.0+ Help menu, you can use the Find feature found
under Windows 95 and Windows NT version 3.51 to create a search index and
query on TOP, or search for this Help topic:
<P>
<PRE>   ALL predicate

</PRE>This Help topic discusses the proper syntax for the ALL, DISTINCT,
DISTINCTROW, and TOP predicates.
<P>
<P><h3>Step-by-Step Example</h3>
 
<P>
The following example shows how to use the TOP predicate with a Querydef
using the new syntax for Data Microsoft Access Objects within Visual Basic
version 4.0+:

<OL><P><LI>Start a new project in Visual Basic version 4.0+. Form1 is created by
   default.

<P><LI>Establish a reference to the Microsoft DAO 3.x Object Library
   using the Tools menu in Visual Basic 4.0 or the Project menu in
   Visual Basic 5.0.

<P><LI>Add a Command Button (Command1) to the form.

<P><LI>Add the following code to the click event for Command1:
<P>
<P><PRE>      Private Sub Command1_Click()
<PRE></PRE>         Dim MyDB As Database, MyQuery As QueryDef, MySet As Recordset
         Dim Sql$, QueryDefName$
         QueryDefName$ = "TopTitles"
         Sql$ = "SELECT TOP 10 Titles.* FROM Titles;"
   
         ' Open Database, and create querydef:
         Set MyDB = Workspaces(0).OpenDatabase("C:\VB4\BIBLIO.MDB")
         Set MyQuery = MyDB.CreateQueryDef(QueryDefName$, Sql$)
   
         ' Create Recordset from query and load list with results:
         Set MySet = MyDB.OpenRecordset(QueryDefName$)
         MySet.MoveFirst
         While MySet.EOF = False
            debug.print MySet(0)
            MySet.MoveNext
         Wend
   
         ' Clean up -- close objects and remove querydef:
         MyDB.QueryDefs.Delete QueryDefName$
         MyQuery.Close
         MySet.Close
         MyDB.Close
         Set MyQuery = Nothing
         Set MySet = Nothing
         Set MyDB = Nothing
      End Sub

</PRE><P><LI>Run the program and press the Command1 button.

<P><LI>Change the line defining SQL$ to be:
<P>
<P><PRE>      Sql$ = "SELECT TOP 10 PERCENT Titles.* FROM Titles;"
</PRE>
<P><LI>Run the program again, and note the difference in results.
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : APrgData kbcode vb4all vb4win VBKBDAO VBKBDB VBKBJet VBKBObj kbhowto<BR>
Version             : 3.0 4.0 5.0<BR>
Platform            : WINDOWS<BR>
Issue type          : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 8, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
