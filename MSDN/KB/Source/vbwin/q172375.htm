

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>HOWTO: Undo Updates for a Single Row with CancelBatch </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q172375">
<META NAME="KBModify" CONTENT="1997/08/06">
<META NAME="KBCreate" CONTENT="1997/08/04">
<META NAME="Keywords" CONTENT="VBKBDB VBKBError VBKBHelpFile VBKBNet VBKBObj VBKBRDO VBKBBooksOnline VBKBDocs VBKBRDOR">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  The Visual Basic documentation states that the Status property of an rdoResultset object can be modified to arrange whether the current row will be updated and if it is updated, how it will be updated. It is a common desire to set the Status to rdR...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGC,QAPN,QA5V,QBS0,QBXS,QAGB,QAXB,QAFF,QAC1,QBD2,QAEF,QAAP,QAB4,QBCT,QAW6 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Undo Updates for a Single Row with CancelBatch</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  August 6, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q172375</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Enterprise Edition for Windows, version 5.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The Visual Basic documentation states that the Status property of an
rdoResultset object can be modified to arrange whether the current row will
be updated and if it is updated, how it will be updated. It is a common
desire to set the Status to rdRowUnmodified so that no updates are made to
the current row. However, this is an error in the documentation because the
Status property is read-only and cannot be modified at run-time.
<P>
Although less intuitive, undoing changes for the current row of an
rdoResultset object can be accomplished with the CancelBatch method using
the optional parameter, SingleRow.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
When you use the optimistic batch cursor library, the CancelBatch method of
the rdoResultset object cancels all uncommitted changes in the local
cursor. By using the optional parameter, SingleRow, you can cancel a change
to a particular row only.
<P>
<P><h3>Step-by-step example</h3>
 

<OL><P><LI>Start Visual Basic and create a standard EXE.  Form1 is added by
   default.

<P><LI>Add a reference to "Microsoft Remote Data Object 2.0" in Project/
   References.

<P><LI>Add two CommandButtons, called Command1 and Command2, to Form1.

<P><LI>Set the Caption property of Command1 to "Edit and Undo" and the Caption
   property of Command2 to "Delete and Undo".

<P><LI>Copy and paste the following code to the General Declarations section of
   Form1:
<P>
<P><PRE>     Dim cn As New rdoConnection
     Dim rs As rdoResultset
</PRE><P>
<P><PRE>     Private Sub Form_Load()
</PRE><P>
<PRE>         cn.CursorDriver = rdUseClientBatch
         cn.Connect = "dsn=my_pubs_server;uid=sa;pwd="
         cn.EstablishConnection rdDriverNoPrompt, False
         Set rs = cn.OpenResultset("select * from authors", rdOpenStatic, _
                                   rdConcurBatch)

     End Sub

     Private Sub Command1_Click()

         rs.MoveFirst
         rs.Edit
         rs(1) = "New Value"
         rs.Update

         MsgBox "Status before CancelBatch: " &amp; rs.Status
         rs.CancelBatch SingleRow:=True
         MsgBox "Status after CancelBatch: " &amp; rs.Status

     End Sub

     Private Sub Command2_Click()

         rs.MoveFirst
         rs.Delete
         rs.MoveNext

         On Error Resume Next
         rs.AbsolutePosition = 1
         MsgBox "Status before CancelBatch: " &amp; rs.Status
         rs.CancelBatch SingleRow:=True
         MsgBox "Status after CancelBatch: " &amp; rs.Status

     End Sub

     Private Sub Form_Unload(Cancel As Integer)

         rs.Close
         cn.Close

         Set rs = Nothing
         Set cn = Nothing

     End Sub

</PRE><P><LI>Finally, press the F5 key to run.
<P>
</OL>NOTE: In Command2_Click, the Move methods do not recognize deleted rows.
Therefore, the AbsolutePosition property was used to position the current
row to the deleted row. Also, run-time error "40056" occurs when the
current row positions to a deleted row. By using "On Error Resume Next",
this error can be trapped and ignored.
 
<PRE>Keywords          : VBKBDB VBKBError VBKBHelpFile VBKBNet VBKBObj VBKBRDO VBKBBooksOnline VBKBDocs VBKBRDOResultSet
Technology        : odbc
Version           : WINDOWS:5.0
Platform          : WINDOWS
Issue type        : kbhowto</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  August 6, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
