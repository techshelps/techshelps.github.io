

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>CDK 16-Bit OCX Loaded in Memory on Windows Exit Hangs Machine </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q149531">
<META NAME="KBModify" CONTENT="1996/04/04">
<META NAME="KBCreate" CONTENT="1996/04/04">
<META NAME="Keywords" CONTENT="kbusage">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  If you have any .OCX, .VBX, or .DLL that was created by the Control Developer's Kit (CDK) loaded in memory when you exit Windows 3.1, Windows will hang trying to call the WEP in the .OCX.  Visual Basic 3.0 or 4.0 (16-bit) application contains a con...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB5,QDL9,QBWQ,QBWO,QBWN,QA7O,QAMN,QBS0,QDKA,QAGI,QAOE,QAGB,QAHV,QDJO,QA4Q V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>CDK 16-Bit OCX Loaded in Memory on Windows Exit Hangs Machine</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 4, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q149531</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Professional and Enterprise Editions of Microsoft Visual Basic,
   16-bit only, for Windows version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If you have any .OCX, .VBX, or .DLL that was created by the Control
Developer's Kit (CDK) loaded in memory when you exit Windows 3.1, Windows
will hang trying to call the WEP in the .OCX.
<P>
Visual Basic 3.0 or 4.0 (16-bit) application contains a control created by
the CDK (for example, CIRC3). When the application is still running, and
you exit Windows 3.1, the system hangs.
<P>
<P><h2>CAUSE</h2>
 
<P>
The cause of this hanging is that the CDK-provided WEP calls into other
.DLLs. During Windows shutdown, those .DLLs may have already been unloaded.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the 16-bit version of the
Control Development Kit.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
The solution is for the control to implement a custom WEP and only call the
CDK's WEP when Windows isn't shutting down. In the case where Windows is
shutting down, the control's custom WEP shouldn't do anything.
<P>
The following code may be used as a control's custom WEP procedure. Place
these statements in the main .CPP file of the control. For example,
CIRC3.CPP.
<P>
<PRE>   extern "C" int CALLBACK WEP(int);

   extern "C" int CALLBACK CTLWEP(int nExitType)
   {
      if (nExitType == WEP_SYSTEM_EXIT)
         return 0;

      return WEP(nExitType);
   }

</PRE>In the 16-bit .DEF file (for example, CIRC3.DEF), change the following line
<P>
<PRE>   WEP                 @1  RESIDENTNAME

to:

   WEP=CTLWEP          @1  RESIDENTNAME

</PRE><h2>MORE INFORMATION</h2>
 
<P>
This is a problem with how the CDK has implemented their WEP. For end
users, this will happen if they try to exit Windows with an application
that has a CDK .OCX, .VBX, or .DLL loaded.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.00 vb4win vb416 3.00<BR>
KBCategory: kbusage<BR>
KBSubcategory: tlscdk
<P>


</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 4, 1996</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
