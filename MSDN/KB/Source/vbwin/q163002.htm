

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>HOWTO: Open an Access Database with User Security </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q163002">
<META NAME="KBModify" CONTENT="1997/02/03">
<META NAME="KBCreate" CONTENT="1997/01/31">
<META NAME="Keywords" CONTENT="kbusage kbhowto">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  This article demonstrates how to open and view the contents of a secured Access database using Visual Basic. The steps below outline this process:  1. Secure the database: From Microsoft Access, set the appropriate user and    group permissions to ...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA1S,QAZV,QBS0,QAPN,QAK7,QDKY,QAMB,QAH4,QBXS,QBWS,QABT,QAVY,QAB4,QAAD,QAWK V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Open an Access Database with User Security</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 3, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q163002</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Standard, Professional, and Enterprise Editions,
   32-bit only, for Windows, version 4.0
<LI>Microsoft Access versions 7.0, 97
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article demonstrates how to open and view the contents of a secured
Access database using Visual Basic. The steps below outline this process:

<OL><P><LI>Secure the database: From Microsoft Access, set the appropriate user and
   group permissions to secure the database. For more information about
   securing a Microsoft Access database, see the REFERENCES section later
   in this article.

<P><LI>In your Visual Basic code, indicate where system database, system.mdw,
   is located. You can either set the SystemDB property of the DBEngine
   object or set the IniPath property to the registry location of the
   system database. For example:
<P>
   DbEngine.SystemDB="C:\MyApplication\system.mdw"

<P><LI>Open the database.
<P>
</OL>Note that opening a secured Access database is different from opening a
database that is secured with the Microsoft Access user-level security
feature.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
This section demonstrates how to create a sample Visual Basic program to
open a secured Access database. To use this sample program, you will need a
secured database with the following attributes:
<P>
<PRE>   Database Name:  Secure AccessDB.mda
   Database Table: Name
   Table Field:    Last Name
   User Name:      NewAdmin
   Password:       NewAdmin
   Member of:      Admins Group
   Permissions:    All

</PRE></OL>To create this secured database, refer to the chapter in the Access
documentation listed in the REFERENCES section of this article.
Alternatively, you could secure one of the sample applications using the
same instructions and make the appropriate changes in the code.
<P>
<P><h3>Steps To Reproduce</h3>
 

<OL><P><LI>Start Visual Basic, or if it is already running, click New Project from
   the File menu.

<P><LI>Place the following objects on the Form1 form and set the appropriate
   properties:
<P>
<PRE>   Control             Name              Property         Value
   ---------------------------------------------------------------------

   Label               Label1            Caption          User Name:
                                         Height           255
                                         Left             120
                                         Top              120
                                         Width            855

   Text Box            Text1             Caption          &lt;Blank&gt;
                                         Height           285
                                         Left             1080
                                         Top              120
                                         Width            1455

   Command Button      Command1          Height           372
                                         Left             2760
                                         Top              120
                                         Width            1572

   Label               Label2            Caption          Password:
                                         Height           255
                                         Left             120
                                         Top              480
                                         Width            855

   Text Box            Text2             Caption          &lt;Blank&gt;
                                         Height           285
                                         Left             1080
                                         Top              480
                                         Width            1455

   Label               Label3            Caption          &lt;Blank&gt;
                                         Height           255
                                         Left             120
                                         Top              840
                                         Width            4335

</PRE><P><LI>Copy and paste the following code to the Form1 Code Window:
<P>
<PRE>   Private Sub Command1_Click()
      Dim MyWorkspace As Workspace
      Dim SecuredDB As String
      Dim slUserName As String
      Dim slPassword As String
      Dim db As Database
      Dim rs As Recordset

      'Set the location of the system database
      DBEngine.SystemDB = _
              "C:\Projects\Secured Database Article\system.mdw"

      'Create a new workspace object
      slUserName = Text1.Text
      slPassword = Text2.Text
      Set MyWorkspace = DBEngine.CreateWorkspace("New", _
                                                  slUserName, _
                                                  slPassword)

      'Open the database
      SecuredDB = _
             "C:\Projects\Secured Database Article\Secure AccessDB.mdb"
      Set db = DBEngine.Workspaces("New").OpenDatabase(SecuredDB)

      Set rs = db.OpenRecordset("Name", dbOpenDynaset)
      rs.MoveFirst
      Label3.Caption = _
                 "The first record is " &amp; rs.Fields("LastName").Value

      'Close the recordset and the database
      rs.Close
      db.Close
   End Sub

</PRE><P><LI>Press the F5 key to run the project or, from the Tools menu, click Run
   Project. Enter a valid User Name and Password, and then click the
   command button. The first record in the Last Name field is displayed in
   the Label. If you enter an invalid User Name or an invalid Password, a
   run-time error (3029) occurs.
<P>
</OL><h3>Possible Errors</h3>
 
<P>
The following is a list of possible errors you may encounter when you write
a program to open a secured database. The error message is shown first,
followed by the code that is highlighted when you click the debug button.
The possible cause and then the solution is shown for each line of code:
<P>
Error: Run-time error '3028'
<PRE>       Can't start your application. The system database is missing or
       opened exclusively another user.

       Debug: Set My Workspace =  DBEngine.CreateWorkspace("New", _
                                                           "Admin", _
                                                           "")

       Cause: You are setting the workspace using the global administrator
              user name and password. The global administrator may not have
              the necessary permissions to open the secured database.

       Solution: Change the parameters to a valid user and password as
                 specified in the system database.

       Debug: DBEngine.IniPath = &lt;path and file name of an initialization
                                   file specifying the location of the
                                   system database&gt;

       Cause: In 32-bit Visual Basic, this property requires the registry
              entry of the system database.

       Solution: Set the property to the system database registry location
                 or use the SystemDB property of the DBEngine object. Set
                 the SystemDB property to the location and file name of the
                 system database.

</PRE></OL>Error: Run-time error '3029'
<PRE>       Not a valid account name or password

       Debug: Set MyWorkspace = DBEngine.CreateWorkspace("New",
                                                         "UserName", _
                                                         "Password")

       Cause: User name or password is not in the system database.

       Solution: Add the user name and password to the system database.
                 Refer to the chapter in the Access documentation listed in
                 the references section of this article on how to add users
                 to the system database.

</PRE>Error: Run-time Error '3265'
<PRE>       Item not found in this collection.

       Debug: Set db = DBEngine.Workspaces("New").OpenDatabase("SecuredDB")

       Cause: New workspace was not appended to the workspace object of the
              DBEngine object.

       Solution: Use the Append method of the DBEngine.Workspaces object to
                 append the new workspace object to the DBEngine object.
                 For more information, see the Append method in the Visual
                 Basic online Help.

</PRE><h2>REFERENCES</h2>
 
<P>
Chapter 14 - Securing and Delivering Your Application, Building
Applications with Microsoft Access for Windows 95.
<P>
Visual Basic Online Help - search on IniPath property, and then select the
topic: DBEngine IniPath Now Uses Registry Entry (ReadMe)
<P>
For additional information, please see the following article in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../vbapps/Q161016.htm">Q161016</A></B>
   TITLE     : INF: Using DAO to Open Password-Protected Database (7.0/97)
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbusage kbhowto<BR>
KBSubcategory: IAPVBA APrgDataAcc<BR>
Additional reference words: 4.00 7.00 97 Access
<P>

<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 3, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
