

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>VB ver 3.0 CDK TN002.TXT: Custom Control Version Management </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q107873">
<META NAME="KBModify" CONTENT="1995/06/21">
<META NAME="KBCreate" CONTENT="1993/11/30">
<META NAME="Keywords" CONTENT="kbprg">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  The following article contains the complete contents of the TN002.TXT file installed in the CDK directory of the Professional Edition of Visual Basic version 3.0 for Windows.  MORE INFORMATION  TN002.TXT ---------  Microsoft Visual Basic version 3....">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QA7O,QAB5,QAMN,QAOE,QA5F,QAMA,QARW,QAHV,QAC1,QAKC,QATJ,QAKD V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>VB ver 3.0 CDK TN002.TXT: Custom Control Version Management</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 21, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q107873</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:
<P>
- Professional Edition of Microsoft Visual Basic for Windows, version 3.0
 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The following article contains the complete contents of the TN002.TXT file
installed in the CDK directory of the Professional Edition of Visual
Basic version 3.0 for Windows.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>TN002.TXT</h3>
 
<P>
Microsoft Visual Basic version 3.00 for Windows
Microsoft Corporation Technical Notes
<P>
TN002.TXT:  Custom Control Version Management
<P>
This note describes how to use the version management functionality for
custom controls.
<P>
 
<P>
 
<P><h3>Introduction</h3>
 
Visual Basic provides upward compatibility for custom controls. This means
that a custom control created for Visual Basic version 1.0 will run in
Visual Basic versions 2.0 and 3.0. If a custom control uses version-
specific features, a custom control can always explicitly test for a
specific version during initialization and thereby determine whether or not
to load.
<P>
There are cases, however, when a Visual Basic application created with
a new version of a custom control runs on a system with an older version
of the custom control. Depending on the features and implementation
of the custom control, the application may not work correctly -- or worse,
may cause VB.EXE or VBRUNx00.DLL to crash.
<P>
The following sections describe Visual Basic version 3.0's custom control
version management system, which can help avoid potential application
failure.
<P>
 
<P><h3>MODEL Structure</h3>
 
<P>
This is the definition of the MODEL structure used in Visual Basic version
3.0. Note the addition of the last field (USHORT usCtlVersion).
<P>
typedef struct tagMODEL
<PRE>    {
    USHORT      usVersion;           // VB version used by control
    FLONG       fl;                  // Bitfield structure
    PCTLPROC    pctlproc;            // The control procedure
    FSHORT      fsClassStyle;        // Window class style
    FLONG       flWndStyle;          // Default window style
    USHORT      cbCtlExtra;          // Number of bytes allocated
                                     // for control structure
    USHORT      idBmpPalette;        // BITMAP ID for tool palette
    PSTR        npszDefCtlName;      // Default control name prefix
    PSTR        npszClassName;       // Visual Basic class name
    PSTR        npszParentClassName; // Parent window class, if subclassed
    NPPROPLIST  npproplist;          // Property list
    NPEVENTLIST npeventlist;         // Event list
    BYTE        nDefProp;            // Index of default property
    BYTE        nDefEvent;           // Index of default event
    BYTE        nValueProp;          // Index of control value property
    USHORT      usCtlVersion;        // Identifies current version of the
                                     // custom control. The values 1 and
                                     // 2 are reserved for custom controls
                                     // created with VB1.0 and VB2.0
</PRE>} MODEL;
<P>
 
<P><h3>Control Version</h3>
 
<P>
A custom control developer who wants to take advantage of the version
management feature in Visual Basic version 3.0 needs to provide a valid
version number in the usCtlVersion field. This value must be an unsigned
integer (USHORT), and it should be changed any time the custom control
changes its backward compatibility with previous versions.
<P>
Although any nonzero value is valid, the values 1 and 2 should not be used.
Because Visual Basic versions 1.0 and 2.0 do not support version
management, Visual Basic automatically assigns values 1 and 2 to any custom
control that has the usVersion field in the control's MODEL structure set
to VB100_VERSION and VB200_VERSION, respectively.
<P>
In order to take advantage of version management, you must set the
usVersion field of the control's MODEL structure to VB300_VERSION or
greater, or use VB_VERSION defined in a Visual Basic version 3.0 VBAPI.H
file. This allows Visual Basic to determine whether the usCtlVersion field
is defined in the MODEL structure of a given custom control.
<P>
If the custom control contains a value of 0 in the usCtlVersion field,
no version control checks are made on this custom control.
<P>
 
<P><h3>How the System Works</h3>
 
<P>
When you create a Visual Basic executable (.EXE) file that uses a custom
control, Visual Basic retrieves the control version number (usCtlVersion)
for that control and stores it in a special section of the .EXE file.
<P>
When you execute the application, the Visual Basic run-time support file
(VBRUN300.DLL or greater) checks the control version number recorded
in the .EXE file against the version number found in the custom control
when it is loaded into the system. If the version found in the .EXE file
is greater than the version of the control loaded into the system,
Visual Basic displays a notification that the particular custom control
(.VBX file) is out of date and will not load, consequently forcing
the application to terminate.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00<BR>
KBCategory: kbprg<BR>
KBSubcategory: PrgCtrlsCus<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 21, 1995</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
