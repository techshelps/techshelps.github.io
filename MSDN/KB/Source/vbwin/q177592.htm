

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: User Connection Object Connect Property Remains Populated </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q177592">
<META NAME="KBModify" CONTENT="1997/12/08">
<META NAME="KBCreate" CONTENT="1997/12/03">
<META NAME="Keywords" CONTENT="vb5all">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  When a UserConnection object is declared at the global level, the userid and password stored in the Connect property remains populated after the connection is closed.  RESOLUTION  To make sure the userid and password in Connect property is cleared ...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAI5,QBG2,QAPN,QBS0,QAGB,QAFF,QAH4,QABI,QAAW,QBWS,QBXS,QA2Q,QANE,QAG2,QAGU V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: User Connection Object Connect Property Remains Populated</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 8, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q177592</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Enterprise Edition for Windows, version 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When a UserConnection object is declared at the global level, the userid
and password stored in the Connect property remains populated after the
connection is closed.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To make sure the userid and password in Connect property is cleared after
closing the connection, you can set the user connection object to Nothing
right after closing the connection, such as:
<P>
<PRE>   uc.close
   SET uc = Nothing

</PRE>You could also store the initial value of the Connect property to a
variable, and replace the Connect property with that value after the
connection is closed, such as the following:
<P>
<PRE>   Dim myConnect As String
   myConnect = uc.Connect
   uc.EstablishConnection
   uc.Close
   uc.Connect = myConnect

</PRE><h2>STATUS</h2>
 
<P>
Microsoft is researching this problem and will post new information here in
the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 
<P>
Task 1: Create the UserConnection
 

<OL><P><LI>Start a new project in Visual Basic and choose "Standard EXE." Form1
   is created by default.

<P><LI>From the Project menu, select Components, select the Designers tab, and
   then place a check next to Microsoft UserConnection.

<P><LI>From the Project menu, select Add ActiveX Designer, and then select
   Microsoft UserConnection. This will bring up a dialog titled
   "UserConnection1 Properties."

<P><LI>On the Connection tab, select either a DSN or DSN-less connection and
   fill in the appropriate information. On the Authentication tab, leave
   User Name and Password blank. At ODBC Prompt Behavior dropdown box,
   choose "Only when needed."

<P><LI>Click OK to save this information and return to the Designer window.
<P>
</OL><h3>Task 21: Build the Visual Basic Code</h3>
 

<OL><P><LI>Add two CommandButtons, Command1 and Command2, to Form1. Command1
   establishes the connection; Command2 closes it Both display the Connect
   property in the debug window.

<P><LI>Paste the following code in the General Declaration section of Form1:
<P>
<P><PRE>      ' *** To workaround the problem:
      ' *** Uncomment the 2 lines of VB code to re-set
      ' *** Connect property using variable myConnect
      ' ***
</PRE>   
<P><PRE>      Dim uc As New UserConnection1
      Dim myConnect As String
</PRE>   
<P><PRE>      Private Sub Command1_Click()
<PRE></PRE>         '  myConnect = uc.Connect
         Debug.Print uc.Connect
         uc.EstablishConnection
      End Sub
   
      Private Sub Command2_Click()
         uc.Close
         '  uc.Connect = myConnect
         Debug.Print uc.Connect
      End Sub
   
      Private Sub Form_Load()
         Command1.Caption = "Establish Connection"
         Command2.Caption = "Close Connection"
      End Sub
   
      Private Sub Form_Unload(Cancel As Integer)
         Set uc = Nothing
      End Sub

</PRE><P><LI>Press F5 key to start the program.
<P>
</OL>NOTE: Because the userid and password remain populated in the Connect
property after closing the connection, you are only prompted once for the
authentication information after the first connection is established.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For additional information about User Connection Designer, please see the
following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../VBWIN/Q166281.htm">Q166281</A></B>
   TITLE     : HOWTO: Create and Implement a UserConnection

</PRE></OL>(c) Microsoft Corporation 1997, All Rights Reserved.
Contributions by Adrian Chiang, Microsoft Corporation
 
<PRE>Keywords          : vb5all
Version           : WINDOWS:5.0
Platform          : WINDOWS
Issue type        : kbprb</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 8, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
