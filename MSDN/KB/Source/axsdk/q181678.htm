

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>HOWTO: Retrieve the URL of a Web Page from an ActiveX Control </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q181678">
<META NAME="KBModify" CONTENT="1998/02/25">
<META NAME="KBCreate" CONTENT="1998/02/24">
<META NAME="Keywords" CONTENT="AXSDKControls">
<META NAME="KBArea" CONTENT="Support; KB; axsdk">
<META NAME="Description" CONTENT="  This article demonstrates how an ActiveX control can retrieve the Uniform Resource Locator (URL) of the Web page (document) on which it is being hosted.  This may be useful for restricting usage of an ActiveX control to a particular domain/site or ...">
<META NAME="Product" CONTENT="ActiveX SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ActiveX ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWA,QAHV,QAOE,QAW6,QA7O,QAY2,QAMN,QAB5,QAH6,QAGI,QBV9,QBRJ,QDOT,QARL,QAPN V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Retrieve the URL of a Web Page from an ActiveX Control</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 25, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q181678</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Internet Client SDK, versions 4.0, 4.01
<LI>Microsoft ActiveX SDK, version 1.0
<LI>Microsoft Internet Explorer (Programming), versions 3.0, 3.01, 3.02,
   4.0, 4.01
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article demonstrates how an ActiveX control can retrieve the Uniform
Resource Locator (URL) of the Web page (document) on which it is being
hosted.
<P>
This may be useful for restricting usage of an ActiveX control to a
particular domain/site or accessing files when supplied a relative path.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
During the initialization of an embedded ActiveX control, Internet Explorer
(IE) passes a pointer to its client site by calling
IOleObject::SetClientSite(). This process can be used to either retrieve a
moniker for the container or access the document object model to retrieve
the URL for the hosting Web page.
<P>
This article demonstrates how to retrieve the current URL from the
container moniker. For more information on how to obtain the URL from the
document object model, please refer to the following article in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../IE_DEV/Q172763.htm">Q172763</A></B>
   TITLE     : INFO: Accessing the Object Model from Within an ActiveX
   Control

</PRE>Follow these steps to retrieve the current URL from the container moniker:

<OL><P><LI>Obtain the client site (IOleClientSite) interface pointer. The container
   calls IOleObject::SetClientSite() to pass a pointer to the client site.
   Override this method to cache this pointer.

<P><LI>Obtain a moniker to the client site by calling
   IOleClientSite::GetMoniker().

<P><LI>Call IMoniker::GetDisplayName() to obtain the URL for the current
   document.
<P>
</OL>The following sample code demonstrates how to perform the above steps by
overriding the IOleObject::SetClientSite() method in an Active Template
Library (ATL) ActiveX control:
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>   STDMETHOD(SetClientSite)(IOleClientSite *pClientSite)
   {
      if (pClientSite != NULL)
      {
         // Obtain URL from container moniker.
         CComPtr&lt;IMoniker&gt; spmk;
         LPOLESTR pszDisplayName;

         if (SUCCEEDED(pClientSite-&gt;GetMoniker(
                                       OLEGETMONIKER_TEMPFORUSER,
                                       OLEWHICHMK_CONTAINER,
                                       &amp;spmk)))
         {
            if (SUCCEEDED(spmk-&gt;GetDisplayName(
                                    NULL, NULL, &amp;pszDisplayName)))
            {
               USES_CONVERSION;

               CComBSTR bstrURL;
               bstrURL = pszDisplayName;

               ATLTRACE("The current URL is %s\n", OLE2T(bstrURL));
               CoTaskMemFree((LPVOID)pszDisplayName);
            }
         }
      }

      return IOleObject_SetClientSite(pClientSite);
   }

</PRE></OL><h2>REFERENCES</h2>
 
<P>
For more information on the IOleObject, IoleClientSite, and IOleContainer
interfaces, please refer to the Microsoft Visual C++ online help.
<P>
(c) Microsoft Corporation 1998, All Rights Reserved. Contributions by Mark
Davis, Microsoft Corporation
 
<PRE>Keywords          : AXSDKControls
Technology        : internet ole
Version           : WINDOWS:1.0,3.0,3.01,3.02,4.0,4.01
Platform          : WINDOWS
Issue type        : kbhowto</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 25, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
