

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>HOWTO: Open a SourceSafe Database with OLE Automation in C++ </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q169928">
<META NAME="KBModify" CONTENT="1997/06/12">
<META NAME="KBCreate" CONTENT="1997/06/11">
<META NAME="Keywords" CONTENT="ssusage">
<META NAME="KBArea" CONTENT="Support; KB; ssafe">
<META NAME="Description" CONTENT="  This article contains sample C++ code along with an explanation of how to get a pointer to a SourceSafe database object and execute the Open method to start a session with a SourceSafe database.  MORE INFORMATION  Visual SourceSafe must be register...">
<META NAME="Product" CONTENT="Visual SourceSafe">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDML,QAPN,QAH4,QA9Q,QAZV,QAMB,QAGI,QBWS,QAPF,QBWA,QAYK,QAW6,QBFY,QA2K,QAI4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Open a SourceSafe Database with OLE Automation in C++</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 12, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q169928</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual SourceSafe, 32-bit, for Windows, version 5.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article contains sample C++ code along with an explanation of how to
get a pointer to a SourceSafe database object and execute the Open method
to start a session with a SourceSafe database.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Visual SourceSafe must be registered before you can use its OLE Automation
Model. The following CLSID should be found in HKEY_CLASSES_ROOT/CLSID:
{783CD4E4-9D54-11CF-B8EE-00608CC9A71F}. Registration occurs by default when
you install the SourceSafe Client.
<P>
To work with the objects in the SourceSafe OLE Model, first you must have
access to a VSSDatabase object, and call its Open method.

<OL><P><LI>Use the CLSIDFromProgID function to obtain the CLSID from the registry
   as shown in the example below.

<P><LI>Call CoGetClassObject with the CLSID obtained in Step 1 asking for a
   pointer to the IClassFactory Interface.

<P><LI>Use the CreateInstance Method from the IClassFactory interface to obtain
   a pointer to an IVSSDatabase object.

<P><LI>Call the open method of the IVSSDatabase object passing in the path to
   the srcsafe.ini, a valid User Name and password as BSTRs.
<P>
</OL>NOTE: You can use the SysAllocString function to convert an OLECHAR* to a
BSTR.
<P>
Use the MultiByteToWide function to convert an LPSTR to OLECHAR* as shown
in the following code fragment:
<P>
<PRE>   if((x=MultiByteToWideChar(CP_ACP,0,path,-1,svalue,0)) != 1)
   {
     svalue = (OLECHAR*)malloc( x*sizeof(wchar_t) );
     if(MultiByteToWideChar(CP_ACP, 0, path, -1, svalue, x ) == 0)
       MessageBox( NULL, "Error in Conversion", "Multibytetowide", MB_OK );
   }
   else
     svalue = L"";

</PRE></OL>MultiByteToWide counts the characters and determines the size of the buffer
needed to hold the BSTR. The appropriate size buffer is then allocated and
the conversion is done. In the example above svalue is an OLECHAR*, and
path is an LPSTR.
<P>
<P><h3>Sample Code</h3>
 
<P>
The following sample code demonstrates how to open a SourceSafe database as
described above:
<P>
<PRE>   // Be sure to link with the following libraries:
   // user32.lib uuid.lib oleaut32.lib ole32.lib
   #define INITGUID
   #include &lt;windows.h&gt;
   #include &lt;ocidl.h&gt;
   #include "ssauto.h"

   int main () {
     CLSID clsid;
     IClassFactory *pClf;
     IVSSDatabase *pVdb;
     BSTR bstrPath = SysAllocString(L"c:\\VSSclient\\srcsafe.ini");
     BSTR bstrUName = SysAllocString(L"guest");
     BSTR bstrUPass = SysAllocString(L"");

     CoInitialize(0);
     if(S_OK == CLSIDFromProgID(L"SourceSafe", &amp;clsid ))
     {
       if(S_OK == CoGetClassObject( clsid, CLSCTX_ALL, NULL,
         IID_IClassFactory, (void**)&amp;pClf ))
       {
         if(S_OK == pClf-&gt;CreateInstance( NULL, IID_IVSSDatabase,
           (void **) &amp;pVdb ))
         {
           if(S_OK == pVdb-&gt;Open(bstrPath, bstrUName, bstrUPass))
           {
             //Database Successfully Opened!
             //Add code here to use the open database.
           }
           pVdb-&gt;Release();
         }
         pClf-&gt;Release();
       }
     }
     CoUninitialize();

     SysFreeString(bstrPath);
     SysFreeString(bstrUName);
     SysFreeString(bstrUPass);
     return 0;
   }

</PRE><h2>REFERENCES</h2>
 
<P>
TITLE: SysAllocString
<PRE>  URL: mk:@ivt:pdobj/native/sdk/ole/auto/src/chap7_27.htm

</PRE>TITLE: SysFreeString
<PRE>  URL: mk:@ivt:pdobj/native/sdk/ole/auto/src/chap7_30.htm

</PRE>TITLE: CLSIDFromProgID
<PRE>  URL: mk:@ivt:pdobj/native/activex/src/api1_1.htm

</PRE>TITLE: IClassFactory
<PRE>  URL: mk:@ivt:pdobj/native/activex/src/if_a2e_68.htm

</PRE>TITLE: CoGetClassObject
<PRE>  URL: mk:@ivt:pdobj/native/activex/src/api1_19.htm

</PRE>TITLE: Visual SourceSafe OLE Automation
<PRE>  URL: <B><A HREF="http://www.microsoft.com/SSAFE/download/oleauto.doc">http://www.microsoft.com/SSAFE/download/oleauto.doc</A></B>

</PRE>The header file ssauto.h can be downloaded from
<B><A HREF="http://www.microsoft.com/SSAFE/download/ssauto.h">http://www.microsoft.com/SSAFE/download/ssauto.h.</A></B>
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : ssusage<BR>
Version             : 5.0<BR>
Platform            : WINDOWS<BR>
Issue type          : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 12, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
