

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Relative Addresses (Relocatables) and the Minus Operator </TITLE>

<!--STYLE_BEGIN-->
<LINK REL="STYLESHEET" HREF="/support/kbstyle.css" TYPE="text/css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q80381 ">
<META NAME="KBModify" CONTENT="1995/01/23">
<META NAME="KBCreate" CONTENT="1992/01/28">
<META NAME="Keywords" CONTENT="kbprg">
<META NAME="KBArea" CONTENT="Support; KB; masm">
<META NAME="Description" CONTENT="  The Microsoft Macro Assembler does not support using the minus operator (-) to negate a relative address, as in the following statement:     lea ax, [bx - offset Table]  Under MASM 5.1 and 5.1a, the error generated for this statement is:     A2040:...">
<META NAME="Product" CONTENT="Macro Assembler">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAC2,QA5V,QAR5,QAKM,QDMW,QAM1,QAJQ,QBW4,QBWD,QBVV,QBDA,QAPN,QAH4,QAEF,QAAP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Relative Addresses (Relocatables) and the Minus Operator</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 23, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q80381 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Macro Assembler for MS-DOS, versions 5.0, 5.1, 5.1a, 6.0,
   6.0a, and 6.0b
<LI>Microsoft Macro Assembler for OS/2, versions 5.0, 5.1, 5.1a, 6.0,
   6.0a, and 6.0b
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The Microsoft Macro Assembler does not support using the minus
operator (-) to negate a relative address, as in the following
statement:
<P>
<PRE>   lea ax, [bx - offset Table]

</PRE>Under MASM 5.1 and 5.1a, the error generated for this statement is:
<P>
<PRE>   A2040: operands must be in same segment, or one must be constant

</PRE>Under MASM 6.0, the error generated is:
<P>
<PRE>   A2094: operand must be relocatable

</PRE><h2>MORE INFORMATION</h2>
 
<P>
Relocatable means not having an absolute address. Relocatables are
often referred to as "relative addresses." The assembler does not know
where the label, data, or code will be located in memory. The linker
provides the address.
<P>
The assembler generates a fixup record (FIXUPP) for each address it
cannot determine at assembly time, which contains the information the
linker will need to determine the address. The FIXUPP record contains
the LOCATION of the address to be fixed up, the TARGET address to
which the fixup refers, and the FRAME relative to which the address
computation is performed. These fields are explained in detail on
pages 682-693 in "The MS-DOS Encyclopedia." The FIXUPP record follows
the data record that link needs to update.
<P>
Note that an address that needs to be fixed up is indicated in the
source listing produced by the assembler by an R following the
instruction. This is a handy way to observe some of the common fixups.
<P>
A statement such as the following
<P>
<PRE>   lea ax, [offset Table1 - offset Table]

</PRE>(where Table1 and Table are in the same segment) includes a difference
of relocatables and will be an immediate value. The assembler will
perform the computation. This is one of the recommendations in the
A2040 error shown in the summary.
<P>
A statement like such as the following
<P>
<PRE>   lea ax, [bx + offset Table]

</PRE>is equivalent to lea ax, Table[bx]. The offset of Table is known by
the assembler, stored in a data record, fixed up, and added to bx at
run time.
<P>
In the following statement introduced in the summary
<P>
<PRE>   lea ax, [bx - offset Table]

</PRE>the offset of Table is known, but the negation of an address is not
defined for any language. The assembler could merely toggle the bits,
but how would the linker interpret the new, negated address and
perform the fixup?  What would happen at run time? As it stands, the
value produced would have no meaning. Since this fixup is not
supported, an error is generated.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: kbinf 5.00 5.10 5.10a 6.00 6.00a 6.00b<BR>
KBCategory: kbprg<BR>
KBSubCategory: MASMLngIss<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 23, 1995</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
