

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>FIX: Bad Object File Generated with MASM 5.1 and 5.1a </TITLE>

<!--STYLE_BEGIN-->
<LINK REL="STYLESHEET" HREF="/support/kbstyle.css" TYPE="text/css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q67760 ">
<META NAME="KBModify" CONTENT="1997/09/11">
<META NAME="KBCreate" CONTENT="1990/12/14">
<META NAME="Keywords" CONTENT="">
<META NAME="KBArea" CONTENT="Support; KB; masm">
<META NAME="Description" CONTENT="  The following mixed-language program does not assemble properly under the Microsoft Macro Assembler (MASM) version 5.1 and 5.1a.  CAUSE =====  The assembler does not generate the correct .OBJ record for the linker to resolve the reference properly....">
<META NAME="Product" CONTENT="Macro Assembler">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QAR4,QATO,QAPN,QAEF,QBVV,QAKP,QBXH,QBFY,QBE7,QBE6,QA5V,QAYL,QAW6,QAVX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Bad Object File Generated with MASM 5.1 and 5.1a</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 11, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q67760 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
5.10 5.10a | 5.10 5.10a
<PRE>MS-DOS     | OS/2
</PRE>kbtool kbfixlist kbbuglist
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Macro Assembler for MS-DOS, versions 5.1 and 5.1a
<LI>Microsoft Macro Assembler for OS/2, versions 5.1 and 5.1a
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The following mixed-language program does not assemble properly under the
Microsoft Macro Assembler (MASM) version 5.1 and 5.1a.
<P>
<P><h2>CAUSE</h2>
 
<P>
The assembler does not generate the correct .OBJ record for the linker to
resolve the reference properly. When the .EXE is built, the _test variable
is located in the NULL segment instead of the _DATA segment; therefore,
instead of the residing 1 byte apart, they are actually 42h bytes apart.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Removing the ASSUME statements from the assembly code eliminates the
problem. These ASSUME statements are not necessary.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in MASM versions 5.1
and 5.1a. This problem was corrected in MASM version 6.0.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Sample Code #1</h3>
 
<P>
; Assemble options needed: none
<P>
<PRE>        .model small, c

        .data
       ASSUME ds: nothing
</PRE>PUBLIC xxx
xxx    DB 1
<PRE>       ASSUME ds: @data
</PRE>PUBLIC yyy
yyy    DB 2
<P>
<PRE>       .code
</PRE>PUBLIC func
func   PROC
<PRE>       MOV ax, OFFSET yyy
       SUB ax, OFFSET xxx
       RET
</PRE>func   ENDP
<P>
<PRE>       END

</PRE><h3>Sample Code #2</h3>
 
<P>
<PRE>/* Compile options needed: none
*/

#include &lt;stdio.h&gt;
</PRE>extern char xxx;
extern char yyy;
<P>
<PRE>void main ()
</PRE>{
<PRE>   printf( "C distance of yyy - xxx = %X\n", &amp;yyy - &amp;xxx );
   printf( "MASM distance of yyy - xxx = %X\n", func () );
</PRE>}
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 5.10 5.10a 6.00 buglist5.10 buglist5.10a<BR>
fixlist6.00<BR>
KBCategory: kbtool kbfixlist kbbuglist<BR>
KBSubCategory: MLIss<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 11, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
