

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Creating 32-Bit Flat Memory Model MASM Code for OS/2 2.0 </TITLE>

<!--STYLE_BEGIN-->
<LINK REL="STYLESHEET" HREF="/support/kbstyle.css" TYPE="text/css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q94577 ">
<META NAME="KBModify" CONTENT="1997/07/31">
<META NAME="KBCreate" CONTENT="1993/01/11">
<META NAME="Keywords" CONTENT="">
<META NAME="KBArea" CONTENT="Support; KB; masm">
<META NAME="Description" CONTENT="  Versions 6.0, 6.0a, and 6.0b of the Microsoft Macro Assembler (MASM) provide the .MODEL flat directive to support generating 32-bit flat memory model applications. When combined with the LINK386 utility and DOSCALLS.LIB library provided with OS/2 v...">
<META NAME="Product" CONTENT="Macro Assembler">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QAGI,QAPF,QBVV,QAJH,QDIR,QBHQ,QAA3,QAIF,QBW6,QBBI,QAIJ,QAH6,QAB4,QAA1 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Creating 32-Bit Flat Memory Model MASM Code for OS/2 2.0</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 31, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q94577 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
6.00 6.00A 6.00B
OS/2
kbprg
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Macro Assembler for MS-DOS and OS/2, versions 6.0, 6.0a,
   6.0b
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Versions 6.0, 6.0a, and 6.0b of the Microsoft Macro Assembler (MASM)
provide the .MODEL flat directive to support generating 32-bit flat memory
model applications. When combined with the LINK386 utility and DOSCALLS.LIB
library provided with OS/2 version 2.0, you can generate a 32-bit flat
memory model application for the OS/2 version 2.0 environment.
<P>
To build a 32-bit flat memory model application for OS/2 2.0, perform the
following four steps:

<OL><P><LI>Place the INCLUDELIB DOSCALLS.LIB directive in each source module that
   contains a call into the OS/2 2.0 application programming interface
   (API). DOSCALLS.LIB is the OS/2 2.0 import library that supports
   application calls to the operating system.

<P><LI>Place the .386 or .486 directive before the .MODEL flat, syscall
   directive to ensure that your code and data segments are set up
   correctly for a 32-bit flat memory model application. The order in which
   these two directives appear in the source code is important.

<P><LI>Specify the /c assembler option flag on the assembler command line to
   prevent MASM from invoking its 16-bit linker.

<P><LI>Link the object files using LINK386 distributed with OS/2 2.0. If
   LINK386 cannot find the DOSCALLS.LIB file, specify the path to the
   library.
<P>
</OL><h2>MORE INFORMATION</h2>
 
<P>
The LINK386 utility and DOSCALLS.LIB library are provided by IBM with OS/2
version 2.0. MASM versions 6.0, 6.0a, and 6.0b does not include either the
required library support for OS/2 operating system calls or a linker
capable of producing flat memory model applications. For more information
on LINK386, DOSCALLS.LIB, or the functions of the OS/2 2.0 API, please
contact IBM.
<P>
LINK386 may generate two warnings that can be safely ignored:
<P>
<PRE>   LINK386: warning L4071: application type not specified:
      assuming WINDOWCOMPAT
   LINK386: warning L4071: no automatic data segment

</PRE></OL>MASM version 6.1 does not run with any version of OS/2 including a DOS
window under OS/2. Microsoft does not support using MASM 6.1 for OS/2. Even
though code generated by MASM 6.1 running with MS-DOS may link with
LINK386, Microsoft does not support generating code in this manner.
<P>
Some of the products included here are manufactured by vendors independent
of Microsoft; we make no warranty, implied or otherwise, regarding these
products' performance or reliability.
<P>
<P><h3>Sample Code</h3>
 
<P>
; Assemble options needed: /c
<P>
INCLUDELIB DOSCALLS.LIB
<P>
.386
.MODEL flat, syscall
<P>
Dos32Write PROTO NEAR32 syscall,
<PRE>    hf:WORD, pvBuf:NEAR32, cbBuf:WORD, pcbBytesWritten:NEAR32

</PRE>Dos32Exit PROTO NEAR32 syscall,
<PRE>    fTerminate:WORD, ulExitCode:WORD

</PRE>.STACK 4096
<P>
.DATA
<P>
msg DB "Hello, world.", 13, 10
written DW 0
<P>
.CODE
_start:
<PRE>    INVOKE  Dos32Write,        ; OS/2 system call
        1,                     ; File handle for screen
        NEAR32 PTR msg,        ; Address of string
        LENGTHOF msg,          ; Length of string
        NEAR32 PTR written     ; Bytes written

    INVOKE  Dos32Exit,         ; OS/2 system call
        0,                     ; Terminate all threads
        0                      ; Result code for parent process

</PRE>END _start
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: kbinf 6.00 6.00a 6.00b 6.10<BR>
KBCategory: kbprg<BR>
KBSubCategory: MASMLngIss<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 31, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
