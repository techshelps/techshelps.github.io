

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>BUG: Macro Expansion May Occur Before Macro Call in Listing File </TITLE>

<!--STYLE_BEGIN-->
<LINK REL="STYLESHEET" HREF="/support/kbstyle.css" TYPE="text/css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q73036 ">
<META NAME="KBModify" CONTENT="1994/10/21">
<META NAME="KBCreate" CONTENT="1991/06/15">
<META NAME="Keywords" CONTENT="kbtool kbbuglist">
<META NAME="KBArea" CONTENT="Support; KB; masm">
<META NAME="Description" CONTENT="  With the Microsoft Macro Assembler (MASM), if the .NOLIST directive is the first statement in a file and it is later followed by a .LISTALL directive, then the macro expansion in the listing file will occur before the macro call instead of after it...">
<META NAME="Product" CONTENT="Macro Assembler">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QAGI,QAVX,QAVW,QBVV,QAIF,QBXT,QA5V,QAIJ,QAIB,QAE1,QAYA V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Macro Expansion May Occur Before Macro Call in Listing File</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 21, 1994</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q73036 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Macro Assembler for MS-DOS, versions 6.0, 6.0a, 6.0b,
   6.1, 6.1a, and 6.11
<LI>Microsoft Macro Assembler for OS/2, versions 6.0, 6.0a, and 6.0b
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
With the Microsoft Macro Assembler (MASM), if the .NOLIST directive is
the first statement in a file and it is later followed by a .LISTALL
directive, then the macro expansion in the listing file will occur
before the macro call instead of after it.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
This problem can be eliminated by placing either a blank line or a
comment before the .NOLIST directive, so that .NOLIST is not on the
first line of the file.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in MASM version 6.0,
6.0a, 6.0b, 6.1, 6.1a, and 6.11. We are researching this problem and
will post new information here in the Microsoft Knowledge Base as it
becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The .NOLIST directive prevents the macro expansion of all macro calls
in the listing file. This option shows the macro call, but it does not
display the corresponding code. The .NOLIST directive also prevents a
complete listing of every macro in each file that is included with the
.INCLUDE directive. The .LISTALL directive lists all source lines,
including false conditionals and generated code for each macro.
<P>
In the sample code below, the placement of the .NOLIST directive
before the .INCLUDE directive prevents a general listing of every
macro in that include file. Placing the .LISTALL after the .INCLUDE
directive should cause the corresponding code for each macro to be
listed after that macro appears in the source code. For example, the
correct listing for TEST_MACRO should appear as follows:
<P>
<PRE>                  TEST_MACRO
   0000  55              1       PUSH  BP
   0001  8B EC           1       MOV   BP, SP

</PRE>However, if .NOLIST is the first statement on the first line in the
file, then this order is reversed and the macro expansion appears
before the macro call. The incorrect macro expansion actually appears
as follows:
<P>
<PRE>   0000  55              1       PUSH  BP
   0001  8B EC           1       MOV   BP, SP
                  TEST_MACRO

</PRE><h3>Sample Code</h3>
 
<P>
<P><h3>TEST.ASM</h3>
 
; Assemble options needed: /Fl
<P>
.NOLIST
INCLUDE test.inc
.LISTALL
<P>
.MODEL small
.STACK 4096
<P>
.CODE
start:
<PRE>   test_macro
   mov ax, 4C00h
   int 21h
</PRE>END start
<P>
<P><h3>TEST.INC</h3>
 
; Include file for TEST.ASM
<P>
test_macro MACRO
<PRE>   push bp
   mov bp, sp
</PRE>ENDM
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 6.00 6.00a 6.00b 6.10 6.10a buglist6.00a<BR>
buglist6.00b buglist6.10 buglist6.10a buglist6.11<BR>
KBCategory: kbtool kbbuglist<BR>
KBSubCategory: MLIss<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 21, 1994</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
