

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>BUG: EXTERNDEF ABS Fails with Span Dependent Value </TITLE>

<!--STYLE_BEGIN-->
<LINK REL="STYLESHEET" HREF="/support/kbstyle.css" TYPE="text/css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q94941 ">
<META NAME="KBModify" CONTENT="1995/02/21">
<META NAME="KBCreate" CONTENT="1993/01/25">
<META NAME="Keywords" CONTENT="kbtool kbbuglist">
<META NAME="KBArea" CONTENT="Support; KB; masm">
<META NAME="Description" CONTENT="  In an application developed with the Microsoft Macro Assembler (MASM), an attempt to export a constant value with the EXTERNDEF directive fails.  CAUSE =====  The exported value is defined in a macro as the difference between the values of two labe...">
<META NAME="Product" CONTENT="Macro Assembler">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QAMB,QAC2,QAKD,QA3P,QAKJ,QAKP,QDKW,QBVV,QAYV,QAIJ,QAEF,QAVS,QACI,QA4F V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: EXTERNDEF ABS Fails with Span Dependent Value</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 21, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q94941 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Macro Assembler for MS-DOS, versions 6.0, 6.0a, 6.0b,
   6.1, 6.1a, and 6.11
<LI>Microsoft Macro Assembler for OS/2, versions 6.0, 6.0a, and 6.0b
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
In an application developed with the Microsoft Macro Assembler (MASM),
an attempt to export a constant value with the EXTERNDEF directive
fails.
<P>
<P><h2>CAUSE</h2>
 
<P>
The exported value is defined in a macro as the difference between the
values of two labels (a span-dependent value).
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To work around this problem, perform one of the following two steps:

<UL><LI>Modify the source code to specify the PUBLIC directive instead of
   the EXTERNDEF directive

<LI>Modify the source code of the macro to place a label before the
   value definition
<P>
</UL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in MASM versions 6.0,
6.0a, 6.0b, 6.1, 6.1a, and 6.11. We are researching this problem and
will post new information here in the Microsoft Knowledge Base as it
becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following information is part of the README.TXT file distributed
with MASM version 6.1.
<P>
<PRE>   Span-Dependent Equates in Macros and EXTERNDEF ABS
   --------------------------------------------------

   The ABS operator causes an identifier to be exported as a relocatable
   unsized constant (see Programmer's Guide page 220). If ABS is used with
   EXTERNDEF within a macro, and the constant being exported depends on the
   difference between two addresses, the constant may not be exported
   correctly. In some cases, the listing file will show the correct value,
   but the value in the resulting .OBJ will be incorrect. For example, the
   following code will not evaluate correctly:

      EXTERNDEF TableSize:ABS  ; Will not be exported correctly

      MAKETABLE MACRO
      Table1 LABEL BYTE
         DB 0, 1, 2
      TableSize EQU $-Table1
      ENDM

      SEG1 SEGMENT
      MAKETABLE
      SEG1 ENDS

   To avoid this problem, either use the 'PUBLIC' directive in place of
   'EXTERNDEF', or put a label before the equate, within the macro.

</PRE>The code example below demonstrates this behavior. To see the problem,
build both modules with CodeView information and link them together.
Stepping through the program in the debugger to see the incorrect
TableSize value.
<P>
<P><h3>Sample Code Part 1</h3>
 
<P>
; Assemble options needed: /Zi
; link part 1 and part 2 together with /CO link option
<P>
EXTERNDEF TableSize:ABS
<P>
_text SEGMENT para public 'CODE'
ASSUME cs:_text
start:
<PRE>   mov ax, TableSize
   mov ax, 4C00h
   int 21h
</PRE>_text ENDS
<P>
END start
<P>
<P><h3>Sample Code Part 2</h3>
 
<P>
; Assemble options needed: /Zi
<P>
EXTERNDEF TableSize:ABS ; Will not export correctly
<P>
MakeTable MACRO
<PRE>   Table1 LABEL BYTE
      DB 0, 1
   ;Table2 LABEL BYTE  ; Remove comment character to work around problem
   TableSize EQU $-Table1
</PRE>ENDM
<P>
_data SEGMENT para public 'DATA'
<PRE>   MakeTable
</PRE>_data ENDS
<P>
END
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 6.00 6.00a 6.00b 6.10 6.10a buglist6.00a<BR>
buglist6.00b buglist6.10 buglist6.10a buglist6.11<BR>
KBCategory: kbtool kbbuglist<BR>
KBSubCategory: MLIss<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 21, 1995</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
