

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>FIX: MASM 6.0 ALIGN Directive Requires Patch to Work Correctly </TITLE>

<!--STYLE_BEGIN-->
<LINK REL="STYLESHEET" HREF="/support/kbstyle.css" TYPE="text/css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q73190 ">
<META NAME="KBModify" CONTENT="1997/09/11">
<META NAME="KBCreate" CONTENT="1991/06/18">
<META NAME="Keywords" CONTENT="">
<META NAME="KBArea" CONTENT="Support; KB; masm">
<META NAME="Description" CONTENT="  The Microsoft Macro Assembler (MASM) version 6.0 may generate incorrect code with respect to the ALIGN directive. If the alignment value specified is larger than 2, the padding generated by the assembler may consist of incorrect instructions. Inste...">
<META NAME="Product" CONTENT="Macro Assembler">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QDNQ,QAR4,QAEB,QAEF,QATS,QASR,QBV8,QAB9,QBBI,QAYA,QAVX,QAIJ,QAIB,QAAP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: MASM 6.0 ALIGN Directive Requires Patch to Work Correctly</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 11, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q73190 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
6.00   | 6.00
MS-DOS | OS/2
kbtool kbfixlist kbbuglist
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Macro Assembler for MS-DOS, versions 6.0
<LI>Microsoft Macro Assembler for OS/2, versions 6.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The Microsoft Macro Assembler (MASM) version 6.0 may generate
incorrect code with respect to the ALIGN directive. If the alignment
value specified is larger than 2, the padding generated by the
assembler may consist of incorrect instructions. Instead of generating
an opcode for a no-operation "mov ax, ax" instruction (8Bh C0h), the
assembler may reverse the bytes that are output (C0h 8Bh), resulting
in code that fails to run correctly.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
This problem may be corrected by patching ML.EXE with one of the
following debug scripts. Before performing this operation on your EXE
files, you might want to make a backup copy.
<P>
<PRE>   Debug Script for DOS
   --------------------

   1: a 7d8a
   2: mov ax, ax
   3:
   4: w
   5: q

   Debug Script for OS/2
   ---------------------

   1: a 325a
   2: mov ax, ax
   3:
   4: w
   5: q

</PRE>To utilize one of these scripts, type the specified commands (without
the line numbers) into a file called PATCH.SCR. Note that line 3 in
both scripts should be left blank as indicated. Next, create and run
a batch file that contains the following commands:
<P>
<PRE>   REN ML.EXE ML.DAT
   DEBUG ML.DAT &lt; PATCH.SCR
   REN ML.DAT ML.EXE

</PRE><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in MASM version 6.0.
This problem was corrected in MASM version 6.0a.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The ALIGN instruction is used to indicate the boundary on which to
start the next instruction. For example, a statement such as
<P>
<PRE>   ALIGN 4

</PRE>indicates that the next instruction should start on a 4-byte boundary.
<P>
MASM version 6.0 may use a 2-byte instruction (that has no effect) to
pad the code. In this case, the opcode may be reversed as described
above. This problem may be illustrated by assembling the sample code
below.
<P>
<P><h3>Sample Code</h3>
 
<P>
; Assemble options needed: none
<P>
.MODEL large
.STACK 4096
<P>
.DATA
_data ENDS
<P>
_CodeSeg SEGMENT para public 'code'
main PROC
<PRE>   mov ax, dx
   ALIGN 8
   mov ax, 0
</PRE>main ENDP
_CodeSeg ENDS
END main
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 6.00 buglist6.00 fixlist6.00a<BR>
KBCategory: kbtool kbfixlist kbbuglist<BR>
KBSubCategory: MLIss<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 11, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
