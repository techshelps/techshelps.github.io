

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>FIX: LogReader Can Fail On sp_repldone Using Partitioning </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q138825">
<META NAME="KBModify" CONTENT="1997/05/02">
<META NAME="KBCreate" CONTENT="1995/10/29">
<META NAME="Keywords" CONTENT="kbbug6.00 kbfix6.00.sp2 kbprg SSrvProg">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG# NT: 11636 (6.00)   Under certain conditions using horizontal or vertical partitioning, the LogReader task for replication can fail with the following error:     The replicated transaction (xxx, yyy) no longer exists in the log.    Unable to exec...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QAIJ,QBWS,QAKP,QABI,QAB4,QAAP,QAR4,QAL4,QAXB,QAKD,QAAL,QAYG,QDMH,QBVV V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: LogReader Can Fail On sp_repldone Using Partitioning</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 2, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q138825</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, version 6.0
</UL> 
BUG# NT: 11636 (6.00)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Under certain conditions using horizontal or vertical partitioning, the
LogReader task for replication can fail with the following error:
<P>
<PRE>   The replicated transaction (xxx, yyy) no longer exists in the log.
   Unable to execute sp_repldone on &lt;server&gt;.

</PRE>where xxx = the value of xactid_page and yyy = the value of xactid_row
in the MSjobs table in the distribution database.
<P>
<P><h2>CAUSE</h2>
 
<P>
This problem can occur if a transaction is run against a published article
that does not meet the criteria of a horizontal or vertical partition. The
LogReader task will fail and be shutdown in this situation. No replication
transactions for the published database will be processed until the error
is corrected. Since the log cannot be truncated past the oldest
unreplicated transaction, the log may fill to a point where Msg 1105 will
be encountered.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Find the row in MSjob in the distribution database whose xactid_page
and xactid_row match the values listed in the error message above. This row
should contain the maximum job_id value for the table. Then update the
values for xactid_page and xactid_row for this row to 0. It is recommended
that you run the UPDATE statement with a BEGIN TRAN command so that you can
rollback changes if you make a mistake.
<P>
Make sure to execute COMMIT TRAN if the statement is successfully applied.
If the LogReader is setup as "Autostart," restart SQLExecutive. Otherwise,
you may choose to execute the task "On Demand" to make sure it can run
successfully. If the problem is resolved, the LogReader task will show up
as a "Running Task" under SQL Enterprise Manager. However, it will not show
a successful status in the Task History if you restarted SQLExecutive.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft SQL Server
6.0. This problem was corrected in Service Pack 2 for SQL Server version
6.0. For more information, contact your primary support provider.
<P>
MORE INFORMATION
 
<P>
This problem has been observed only when the transaction reported in
the error above has been truncated from the log and the LogReader
task is restarted. If the LogReader task is never restarted, then the
error may not occur. The problem can only occur under these conditions if a
transaction is executed that will fail the criteria of a horizontal or
vertical partition (that is, implemented by a replication "filter
procedure"). For more information on horizontal or vertical partitions,
consult the SQL Server 6.0 "Administrator's Companion."
<P>
Remember that the LogReader can be "restarted" by restarting SQLExecutive
if the task is set to "Autostart." It can also be restarted by scheduling
the task to run "Recurring" or executing it "On Demand." The problem can be
encountered under any of these scheduled frequencies.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: sql6 sp_MSget_last_trans<BR>
Keywords            : kbbug6.00 kbfix6.00.sp2 kbprg SSrvProg<BR>
Version             : 6.0<BR>
Platform            : WINDOWS<BR>
Issue type          : kberrmsg<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 2, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
