

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>INF: Using DB-Library Functions From a Windows DLL </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q105346">
<META NAME="KBModify" CONTENT="1997/04/03">
<META NAME="KBCreate" CONTENT="1993/10/20">
<META NAME="Keywords" CONTENT="kbprg SSrvDB_Lib SSrvProg">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  Writing a user-defined dynamic link library (DLL) for Windows to access DB-Library functions requires special considerations. One consideration that is specific to DB-Library is that a DLL cannot share DBPROCESS connections or error and message han...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGI,QAIF,QAY5,QAJH,QDNN,QBV8,QAH6,QAI5,QABM,QDL9,QBWQ,QBWO,QBWN,QAH7,QAD7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: Using DB-Library Functions From a Windows DLL</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 3, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q105346</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:
<P>
<PRE>  - Microsoft SQL Server Programmer's Toolkit, version 4.2
</PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Writing a user-defined dynamic link library (DLL) for Windows to access
DB-Library functions requires special considerations. One consideration
that is specific to DB-Library is that a DLL cannot share DBPROCESS
connections or error and message handlers between applications. This is
because a DLL can be called from many different concurrently running
applications.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
A DLL runs under the context of the program that called it. This is
important because DB-Library tracks data for each active application
separately. This per-process data includes DBPROCESS connections and
pointers to the error and message handlers. DB-Library does this by
registering the calling application's Windows task handle when
dbinit() is called, and uses that to identify all of the DB-Library data
associated with that application. The dbwinexit() function "unregisters"
the application, and de-allocates the data associated with the process.
<P>
In addition, DB-Library for Windows validates each DBPROCESS connection
before using it, using the Windows task handle of the calling application.
<P>
If you try to share a DBPROCESS between multiple applications, the
following occurs:
<P>
- Suppose application APPONE calls your DLL. You do a dbinit(), use
<PRE>  dbopen() to get a DBPROCESS connection, and start accessing SQL
  Server.

</PRE>- Now suppose application APPTWO calls your DLL, and your DLL attempts
<PRE>  to use the same DBPROCESS (the one your DLL got while running under
  APPONE) in a call to dbcmd() or any other DB-Library function.

</PRE>- Since your DLL is running under APPTWO's context, DB-Library will
<PRE>  search for the registration of APPTWO, and not finding it will return
  FAIL.

</PRE>There are many approaches to handling DB-Library calls in a DLL. Some
of the most common are covered below:
<P>
One way is to have each application do its own dbinit() and dbopen(),
register its own error and message handlers, and pass the DBPROCESS
pointer as a parameter to the DLL functions. When the application is
done, it will call dbwinexit().
<P>
A second option is to have each of your DLL's functions call dbinit(),
register the error and message handlers, call dbopen(), use the
DBPROCESS, then call dbwinexit().
<P>
Another option is for your DLL to provide a dll_init() and dll_exit()
function, which are called by each application that wants to use your
DLL. The dll_init() function would call dbinit() and dbopen(), install
the error and message handlers, and return the dbproc to the calling
routine. Then the dll_exit() function would call dbwinexit(). The
calling application would pass back the dbproc on each call to your DLL.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 4.20 DB-Library dblib Dynamic Link Library<BR>
Keywords            : kbprg SSrvDB_Lib SSrvProg<BR>
Version             : 4.2<BR>
Platform            : Windows<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 3, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
