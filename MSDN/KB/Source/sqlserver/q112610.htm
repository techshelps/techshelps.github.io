

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: Performance Monitor for SQL Performance Counters Missing </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q112610">
<META NAME="KBModify" CONTENT="1997/04/29">
<META NAME="KBCreate" CONTENT="1994/03/15">
<META NAME="Keywords" CONTENT="kbtool SSrvWinNT">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  The SQL Server for Windows NT performance counters may, under some conditions, not be visible when PERFMON.EXE (Performance Monitor) is run from a Windows NT network client. This is most frequently seen following a restart of the server machine.  C...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QABM,QBWS,QAY5,QAU3,QAMR,QAVZ,QAM9,QALX,QARL,QAIJ,QAY2,QDKA,QAI5,QAPN V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Performance Monitor for SQL Performance Counters Missing</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 29, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q112610</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:
<P>
<PRE>  - Microsoft SQL Server version 4.2
</PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The SQL Server for Windows NT performance counters may, under some
conditions, not be visible when PERFMON.EXE (Performance Monitor) is run
from a Windows NT network client. This is most frequently seen following a
restart of the server machine.
<P>
<P><h2>CAUSE</h2>
 
<P>
SQL NT monitors a wide variety of SQL-specific performance counters. These
counters are visible as objects in the Performance Monitor (perfmon)
program. If a Windows NT network client is monitoring either SQL or non-SQL
performance counters, and if the server machine is restarted, thereafter,
the SQL performance counters may not be visible. They will be visible if
perfmon is run locally on the server machine.
<P>
The extensible SQLCTRS.DLL acts as the interface between SQL Server and
perfmon and is what exports the counters. If perfmon is run locally, the
ADVAPI32.DLL process is responsible for loading any perfmon extensible DLL.
If perfmon is run from a network client, SCREG.EXE is responsible for
loading any perfmon extensible DLL. ADVAPI32 and SCREG are not part of SQL
Server, but are Windows NT components.
<P>
SCREG.EXE can become unable to load the SQLCTRS.DLL if perfmon sessions are
running on network clients and if the server machine is restarted. You may
see one or both of these errors in the Windows NT application event log:
<P>
<PRE>   Event ID 4005:
   Load of a required DLL failed. Make sure the DLL file is in
   the PATH. DOS Error number is returned in the data.

   Event ID 2:
   OpenSQLPerformanceData: Cannot Connect to
   SQL Server - SERVERNAME

   where SERVERNAME is the name of your SQL Server.

</PRE><h2>WORKAROUND</h2>
 
<P>
Following a restart of the server machine, if any perfmon sessions are
running against it from network clients, you may need to momentarily
discontinue these sessions until SQL NT starts. If SQL NT has already
started, you can simply momentarily shut down any perfmon sessions running
on network clients. This will immediately restore the ability to monitor
SQL NT performance counters, and further perfmon use can continue as
before.
<P>
The perfmon sessions running on network clients can be shut down manually,
or remotely via several ways.

<OL><P><LI>From the server, run the NET FILE command. Current perfmon
   connections can be identified as having open the file \PIPE\winreg.
   Close each such session with the NET FILE /close command. See your
   Windows NT documentation for more information on this command.

<P><LI>From the server, run Control Panel server applet, and press the
   "In Use" button. Identify and close each perfmon connection.

<P><LI>From a Windows NT network client, run the Server Manager program,
   SRVMGR.EXE. Connect to the server machine and close any existing
   perfmon connection. Server Manager comes with Windows NT Advanced
   Server, and is also available in the Windows NT Resource Kit.
   See these sources for more information on Server Manager.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: Windows NT<BR>
Keywords            : kbtool SSrvWinNT<BR>
Version             : 4.2<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 29, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
