

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>FIX: SELECT INTO Locking Behavior </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q153441">
<META NAME="KBModify" CONTENT="1997/08/12">
<META NAME="KBCreate" CONTENT="1996/07/29">
<META NAME="Keywords" CONTENT="kbfix6.50.sp1 SSrvLock SSrvTran_SQL kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG #: 14818 (DCR, 6.50)   In SQL Server 6.5, SELECT INTO wraps within a transaction. Tables created by using SELECT INTO hold to the ACID (atomicity, consistency, isolation, durability) transaction properties. This also means that system resources, ...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA2Q,QAY4,QAG2,QABM,QBWS,QAY5,QAPN,QAHE,QABT,QAB9,QAR4,QAL2,QAGU,QBXJ,QBSO V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: SELECT INTO Locking Behavior</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  August 12, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q153441</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, version 6.5
</UL> 
BUG #: 14818 (DCR, 6.50)
<P>
<P><h2>SUMMARY</h2>
 
<P>
In SQL Server 6.5, SELECT INTO wraps within a transaction. Tables created
by using SELECT INTO hold to the ACID (atomicity, consistency, isolation,
durability) transaction properties. This also means that system resources,
such as pages, extents, and locks, are held for the duration of the SELECT
INTO statement. With larger system objects, this leads to the condition
where many internal tasks can be blocked by other users performing SELECT
INTO statements. For example, on high-activity servers, many users running
the SQL Enterprise Manager tool to monitor system processes can block on
each other, which leads to a condition where the SEM application appears to
stop responding.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
When you upgrade to SQL Server 6.5 Service Pack 1, SELECT INTO locking
characteristics is a system settable feature. Wrapping the SELECT INTO with
a transaction remains the default behavior. For users wishing not to hold
system catalog locks on the activity, a trace flag has been added to allow
for such operations. To apply the trace flag, start the server with the
-T5302 command line parameter, or from within a query window, use the
following commands:
<P>
&gt; dbcc traceon (3604)
&gt; go
&gt; dbcc traceon (5302)
&gt; go
<P>
When the 5302 trace flag is applied and a SELECT INTO fails, the table is
still created. Note that the locking behavior you select is applied for all
databases within the server.
<P>
It is important to understand that even with trace flag 5302 enabled, if a
SELECT INTO is executed in SQL Server 6.5 within the context of an explicit
transaction (i.e. BEGIN TRAN), the system tables will still be locked until
the transaction completes. This is because even though the trace flag
allows the server to perform the SELECT INTO in 2 operations, the creation
of the target table phase is in effect a DDL statement within a
transaction.
<P>
Any CREATE TABLE statement within a transaction will hold EX_PAGE locks on
sysobjects, sysindexes, and syscolumns. SQL Server 6.0 did not allow SELECT
INTO to be executed as part of a user-defined explicit transaction.
Attempting to do this would result in Msg 226, "SELECT INTO command not
allowed within multi-statement transaction".
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: sp1 TSQL<BR>
Keywords          : kbfix6.50.sp1 SSrvLock SSrvTran_SQL kbnetwork<BR>
Version           : 6.5<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  August 12, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
