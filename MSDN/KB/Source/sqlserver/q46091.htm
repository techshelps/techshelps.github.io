

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>INF: Using Hard Disk Controller Caching with SQL Server </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q46091 ">
<META NAME="KBModify" CONTENT="1997/04/25">
<META NAME="KBCreate" CONTENT="1989/06/24">
<META NAME="Keywords" CONTENT="kbhw SSrvServer">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  The following information describes the effects of using SQL Server with a hard-disk controller card with caching memory on the controller card (up to 16 MB). Using this type of card provides the benefit of disk caching without requiring the memory...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QBF0,QAC9,QDJN,QAWH,QBBI,QAIJ,QAHE,QBVV,QDMH,QAYY,QADP,QBW6,QAKC,QBXS V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: Using Hard Disk Controller Caching with SQL Server</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 25, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q46091 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:
<P>
<PRE>  - Microsoft SQL Server version 4.2 for OS/2
</PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The following information describes the effects of using SQL Server
with a hard-disk controller card with caching memory on the controller
card (up to 16 MB). Using this type of card provides the benefit of
disk caching without requiring the memory tradeoffs normally
associated with disk caching. The caching algorithm includes write
caching and "elevator sorting" during write-back, when the data to be
written is sorted to minimize head movement.
<P>
<P><h2>MORE INFORMATION</h2>
 

<PRE>1. Q. Are there any problems when using this type of controller caused
      by SQL Server assuming the server is on a UPS to avoid data
      corruption due to a power failure?

   A. If the disk controller ever fails to write out data intended
      for the SQL Server transaction log, SQL Server recovery will
      not work correctly.

2. Q. What effect does this type of caching controller have on the
      performance of SQL Server?

   A. If the cache controller never fails to write to disk what has
      been entrusted to it (even if the keyboard sticks, OS/2 GP
      faults in the kernel, or the hard disk crashes), there will be
      no problem. On the other hand, if the disk controller delays
      the writing of some SQL Server log data and chooses to
      physically apply other log data (because of the "elevator"
      sorting) and fails to write the rest of it for some reason,
      SQL Server has no way of knowing that some of the log is
      missing. A warm start or even rolling forward from a snapshot
      backup might not restore the database correctly. In the worst
      case, there would be no failure during recovery and data
      corruption would be discovered much later.

      If the disk controller is a robust design, it will allow
      selective write-through. The device containing the SQL Server
      transaction logs must always be write-through. In addition, if
      automatic warm start is to work properly, all SQL Server
      devices must be flushed at checkpoint time. If the disk
      controller does not allow selective write-through, the only
      alternative is to make frequent backups and never rely on warm
      start or rolling the transaction log forward.

3. Q. Should SQL Server do the caching, or should the disk controller
      do the caching?

   A. The answer depends on which method is faster. Our experiments
      have shown that the SQL Server cache is more efficient than the
      OS/2 disk cache. However, we have no way of knowing whether or
      not it is more efficient than the caching used by a particular
      type of disk controller. The SQL Server cache probably does not
      work as fast as a hardware cache; however, it has "inside
      knowledge" and can work smarter.

      Run a representative workload with the SQL Server memory
      parameter set to the minimum value that will support the number
      of users required (with the disk controller cache active) for
      your installation. Then try it with the memory parameter set to
      that value plus the amount of RAM in the disk controller cache
      (with the disk controller cache deactivated). For a truly
      accurate comparison, the number of pages in the procedure cache
      should be equal in both cases. This takes some juggling because
      the size of the procedure cache is specified in percent of the
      total cache size, while the size of the total cache is specified
      by the memory parameter and the number of user connections
      parameter. The total cache size is whatever is left after the 42K
      per user connection has been carved out of the space specified
      by the memory parameter. The remainder is divided between the
      procedure and data page cache according to the procedure cache
      parameter.
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: GP-fault<BR>
Keywords            : kbhw SSrvServer<BR>
Version             : 4.2<BR>
Platform            : OS/2<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 25, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
