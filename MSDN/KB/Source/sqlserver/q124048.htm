

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: Outgoing SQLMail Messages Blocked and Not Sent </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q124048">
<META NAME="KBModify" CONTENT="1997/04/30">
<META NAME="KBCreate" CONTENT="1994/12/15">
<META NAME="Keywords" CONTENT="kbinterop kbprg SSrvProg">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  When you send a mail message using the xp_sendmail extended stored procedure, SQL Server returns the message  Mail sent.  No errors occur, however, the mail message gets blocked and is not spooled or sent to the recipients.  CAUSE =====  This probl...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAYC,QBWP,QBWS,QABM,QDKA,QBVV,QAGU,QBG2,QAEV,QA0J,QBV0,QA7K,QARL,QAO4,QAI5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Outgoing SQLMail Messages Blocked and Not Sent</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 30, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q124048</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, versions 4.20x and 6.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you send a mail message using the xp_sendmail extended stored
procedure, SQL Server returns the message "Mail sent." No errors occur,
however, the mail message gets blocked and is not spooled or sent to the
recipients.
<P>
<P><h2>CAUSE</h2>
 
<P>
This problem occurs if there is a problem with the mail spooler process.
With SQLMail, there are two main situations that can cause the mail spooler
process to stop running:

<OL><P><LI>The SQLServer or MSSQLServer service is running in the context of the
   System account with permission to interact with the desktop, and a user
   logs off the Windows NT computer while SQLMail is running. This causes
   the mail spooler process to be shut down because it is running  on
   the user's desktop.
<P>
   In SQL Server versions 4.2x, this can cause an error message to appear
   stating that "SQLSERVER.EXE did not respond to the End Task request."
   This message occurs when Windows NT attempts to shut down the mail
   spooler. Choosing "End Task" in the dialog box will shut down the mail
   spooler, but not SQL Server. In SQL Server 6.0, the message does not
   occur and the mail spooler process is shut down.

<P><LI>The MSSQLServer service is running in the context of a user account and
   the MS-Mail client (MSMAIL32.EXE), or any MAPI-enabled application, is
   being run on the SQL Server computer.
<P>
</OL><h2>WORKAROUND</h2>
 
<P>
The following can be used as workarounds for situation number one mentioned
earlier:
<P>
- Stop and restart SQLMail after a user has logged off the Windows NT
<PRE>  computer.

</PRE></OL>- Use a password-protected screen saver so that you do not have to log on
<PRE>  and off of the server.

</PRE>- In SQL Server 6.0, you have the option to run SQL Server in the context
<PRE>  of a user account instead of the System account and still run SQLMail. If
  you do this, do not run the MS-Mail client on the same computer.

</PRE>Situation number two has the following workarounds:
<P>
- Do not run the MS-Mail client or any MAPI-enabled applications on the
<PRE>  server when SQLMail is running.

</PRE>- Run SQL Server in the context of the System account with permission to
<PRE>  interact with the desktop and prevent users from logging on and off the
  server.

</PRE><h2>MORE INFORMATION</h2>
 
<P>
With MAPI 0, the mail spooler process runs as an icon on the Windows NT
desktop. If the SQLServer or MSSQLServer service has permission to interact
with the desktop, that icon will appear on the server when a user is logged
into Windows NT and SQLMail is running. If the user then attempts to log
off Windows NT, all programs on the desktop (including the mail spooler)
are shut down by Windows NT which prevents subsequent mail from being
spooled.
<P>
If the MSSQLServer service is running in the context of a user account, the
mail spooler does not have permission to interact with the desktop and
therefore the spooler icon does not appear on the desktop. If SQLMail is
started after the MS-Mail client is already running, a conflict occurs
because SQLMail does not have permission to interact with the MS-Mail
client and the spooler which are already running on the desktop.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: sql6 sqlmapi mapi<BR>
Keywords            : kbinterop kbprg SSrvProg<BR>
Version             : 4.2 4.2x 4.21a 6.0<BR>
Platform            : WINDOWS<BR>
Issue type          : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 30, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
