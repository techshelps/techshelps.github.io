

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>INF: How to Correlate Spid, Kpid, and Thread Instance </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q117559">
<META NAME="KBModify" CONTENT="1997/04/29">
<META NAME="KBCreate" CONTENT="1994/06/30">
<META NAME="Keywords" CONTENT="kbtool SSrvAdmin SSrvWinNT">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  When you debug certain types of problems, it is periodically necessary to correlate a particular spid number with its corresponding kpid and/or thread instance number. This article explains how to do this.  MORE INFORMATION  Definitions:   Spid  is...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAUQ,QAKC,QBC6,QBWP,QAG8,QABM,QA4H,QBSO,QBKX,QAM9,QALX,QAWN,QAIJ,QAF3,QA2Q V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: How to Correlate Spid, Kpid, and Thread Instance</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 29, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q117559</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:
<P>
<PRE>  - Microsoft SQL Server, version 4.2x and 6.0
</PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
When you debug certain types of problems, it is periodically necessary to
correlate a particular spid number with its corresponding kpid and/or
thread instance number. This article explains how to do this.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Definitions:
<P>
"Spid" is the SQL Server process ID number and is assigned by SQL Server to
each new connection. It starts with one and is globally unique. It is seen
as the spid column of master..sysprocesses, as the spid column from sp_who,
or the "Proc ID" column when you select Manage/System in SQL Administrator.
<P>
"Kpid" is the kernel-process ID. Under SQL Server for Windows NT this is
the thread ID number, also known as "ID thread," and is assigned by Windows
NT when the thread is created. The thread ID number is a system-wide
identifier that uniquely identifies the thread and is available by calling
the Win32 API GetCurrentThreadID().
<P>
Kpid is visible by querying the kpid column of master..sysprocesses. It is
only filled in for spid numbers four and higher. The Windows NT Performance
Monitor (Perfmon) object "ID Thread," and the Windows NT Resource Kit
Utility PSTAT display thread ID numbers (note PSTATs are in hexadecimal).
<P>
The "Thread instance number" is a monotonically incrementing number
starting at zero, that identifies the threads within a process. Thread
instance numbers are used by the NTSD and WINDBG debuggers' "~" command,
the Windows NT Perfmon object "thread," and Windows NT Resource Kit Utility
Pviewer.
<P>
When debugging a variety of problems, the need to correlate spid, kpid, and
thread instance number can arise. For example:
<P>
<PRE>   When you are monitoring SQL Server with sp_who, and note a
   particular spid's query is taking inordinately long to complete, you
   want independent verification of the CPU resources it is consuming.

   Repeat the approximate equivalent of sp_who, by issuing this
   query:

       select spid, kpid, status, hostname, dbid, cmd

       from master..sysprocesses

   Monitor the SQL threads' CPU consumption by selecting the "thread"
   object, and all of the "sqlservr" instances in Perfmon. This will
   display %Processor Time by thread instance number, which is different
   from spid number.

   To correlate a Perfmon thread instance to a spid number, start
   another copy of Perfmon, and select View/Report. Then Edit/Add the
   object "thread," and the counter "ID Thread."

   Select all of the "sqlservr" instances to add. This will appear as
   a tabular report for which a thread ID number is listed below the
   corresponding thread instance number. The thread ID number is the key
   that ties the a thread instance number to a corresponding spid number
   obtained previously.

</PRE>A practical reason for wanting to do this is because the existing
sysprocesses.physical_io counter is only accumulated for actual physical
I/O, not logical I/O. During some types of long-running queries, most of
the I/O can be logical because of the efficient SQL cache. Also, under some
conditions, the sysprocesses.cpu counter may not accurately reflect
resource consumption, necessitating external verification.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: sql6 windows nt perfmon reskit<BR>
Keywords            : kbtool SSrvAdmin SSrvWinNT<BR>
Version             : 4.2 6.0<BR>
Platform            : WINDOWS<BR>
Issue type          : kbtshoot<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 29, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
