

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>BUG: Query UPDATE Fails with IGNORE_DUP_KEY Set </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q105337">
<META NAME="KBModify" CONTENT="1997/04/08">
<META NAME="KBCreate" CONTENT="1993/10/20">
<META NAME="Keywords" CONTENT="kbprg SSrvServer SSrvWinNT">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG# OS/2: 1777 (4.2a)        NT: 505 (4.2), 14895 (6.0/6.5)   On page 226 of the  Transact-SQL Reference  for SQL Server for Windows NT (or page 69 of the  Language Reference Guide  for OS/2), it states:     If IGNORE_DUP_KEY is set and you give an ...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QAXB,QAC1,QBD2,QA5V,QAFO,QDIX,QAA5,QAKP,QBXS,QBWP,QAVX,QAVW,QAUJ,QBVV V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Query UPDATE Fails with IGNORE_DUP_KEY Set</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 8, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q105337</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server version 4.2a for OS/2
<LI>Microsoft SQL Server, versions 4.2, 6.0, and 6.5
</UL> 
BUG# OS/2: 1777 (4.2a)
<PRE>       NT: 505 (4.2), 14895 (6.0/6.5)

</PRE><h2>SYMPTOMS</h2>
 
<P>
On page 226 of the "Transact-SQL Reference" for SQL Server for Windows NT
(or page 69 of the "Language Reference Guide" for OS/2), it states:
<P>
<PRE>   If IGNORE_DUP_KEY is set and you give an UPDATE or INSERT statement
   that creates duplicate keys, the row that causes the duplicates is
   not added or changed. In fact, in the case of UPDATE , the row is
   discarded.
   ...However, if the UPDATE or INSERT attempt affects multiple rows,
   the other rows are added or changed as usual.

</PRE>When an UPDATE is performed, SQL Server does not behave as explained above.
Instead, the UPDATE will fail if it will cause a duplicate row in the
table.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in SQL Server version 4.2 for
OS/2 and Microsoft SQL Server versions 4.2, 6.0 and 6.5. We are researching
this problem and will post new information here in the Microsoft Knowledge
Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
For example, table test (name char(10), age int NULL) has a unique
clustered key with IGNORE_DUP_KEY on column age:
<P>
<PRE>Name               Age
</PRE> 
<PRE>karl               19
smith              20
johns              24
mary               25

</PRE>The following query:
<P>
<PRE>     update test
     set age=age+4
     where name not like "%johns%"

</PRE>will fail with the errors:
<P>
<PRE>   duplicate key was ignored

</PRE>and
<P>
<PRE>   0 rows affected.

</PRE>According to the manual, it should discard the row smith and update
the other two rows (karl and mary) as in the following:
<P>
<PRE>name             age
</PRE> 
<PRE>karl             23
johns            24
mary             29
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: update duplicates Windows NT<BR>
Keywords            : kbprg SSrvServer SSrvWinNT<BR>
Version             : 4.2a | 4.2 6.0 6.5<BR>
Platform            : OS/2 WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 8, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
