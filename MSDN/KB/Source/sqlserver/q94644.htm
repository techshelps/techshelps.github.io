

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>BUG: Problems Inserting NULL Text Data Using BCP API </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q94644 ">
<META NAME="KBModify" CONTENT="1997/04/28">
<META NAME="KBCreate" CONTENT="1993/01/12">
<META NAME="Keywords" CONTENT="kbprg kbtool SSrvBCP SSrvDB_Lib">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG# 8175 (4.2)   When inserting NULL data into a TEXT column using the BCP DB-Library API, one of the following symptoms occurs:   - bcp_sendrow fails and the row is not inserted.     -or-   - bcp_sendrow succeeds and the row is inserted into SQL Se...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QATX,QAMB,QA9N,QACI,QABM,QBXS,QAYY,QAKP,QAI4,QACJ,QA5E,QAXB,QATB,QAHT,QAGI V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Problems Inserting NULL Text Data Using BCP API</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 28, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q94644 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server Programmer's Toolkit, version 4.2
</UL> 
BUG# 8175 (4.2)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When inserting NULL data into a TEXT column using the BCP DB-Library
API, one of the following symptoms occurs:

<UL><LI>bcp_sendrow fails and the row is not inserted.
<P>
   -or-

<LI>bcp_sendrow succeeds and the row is inserted into SQL Server, but you
   see extra text pages allocated for the TEXT column.
<P>
</UL><h2>CAUSE</h2>
 
<P>
The bcp_bind function is not correctly handling the insertion of text
data when the buffer for the text data is initialized/set to null.
<P>
In the example below, the buffer that holds the text data is defined in
the program as:
<P>
<PRE>   DBCHAR text_buffer[8000] = "";

</PRE><h3>Symptom 1</h3>
 
<P>
bcp_sendrow fails if you attempt to insert NULL data by specifying
"varlen" as -1 along with an appropriate "terminator" and "termlen."
Note that these parameters are part of the bcp_bind call. Even when
varlen is set to 0, along with a terminator of NULL and termlen of 0,
bcp_sendrow fails. The row is not inserted into the SQL Server table
when bcp_sendrow is called.
<P>
<P><h3>Symptom 2</h3>
 
<P>
bcp_sendrow succeeds if you attempt to insert data by specifying varlen
as the allocated buffer length, along with a terminator and termlen.
<P>
However, when the "dbcc checktable" command is run on the inserted
table, you will see that extra pages have been allocated, and that the
number of pages allocated is equal to varlen/1968 (rounding off the
integer to the next highest number).
<P>
In the above example, if bcp_bind is called with varlen set at 8000 for
the 8000-character buffer with termlen set to 1 and terminator set to ""
(signifying a null string), BCP will incorrectly allocate four pages for
the data (8000/1968 rounded off to 5).
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To insert NULL text data, follow the steps that lead to Symptom 2. Next,
update the text column to NULL by issuing the following query:
<P>
<PRE>   update my_table
   set text_column = NULL
   where text_column like " ".

</PRE>This query will deallocate the text pages.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in DB-Library version 4.20.00
and 4.2a. We are researching this problem and will post new information
here in the Microsoft Knowledge Base as it becomes available.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: DB-Library dblib<BR>
Keywords            : kbprg kbtool SSrvBCP SSrvDB_Lib<BR>
Version             : 4.2 4.2a | 4.2 4.2a<BR>
Platform            : MS-DOS WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 28, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
