

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>INF: Processing Procedures and Batches with Multiple SELECTS </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q156500">
<META NAME="KBModify" CONTENT="1997/04/09">
<META NAME="KBCreate" CONTENT="1996/09/24">
<META NAME="Keywords" CONTENT="kbusage SSrvGen">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  This article discusses how to process procedures or batches with multiple select statements using the Microsoft SQL Server ODBC driver.  MORE INFORMATION  The Microsoft SQL Server ODBC drivers that shipped with Microsoft SQL Server 4.21a or earlier...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QA9E,QAU9,QAO2,QAB9,QBWS,QA2Q,QAPN,QABA,QAG2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: Processing Procedures and Batches with Multiple SELECTS</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 9, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q156500</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, version 6.5
<LI>Microsoft Open Database Connectivity driver, version 2.5
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article discusses how to process procedures or batches with multiple
select statements using the Microsoft SQL Server ODBC driver.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The Microsoft SQL Server ODBC drivers that shipped with Microsoft SQL
Server 4.21a or earlier only supported the following default settings for
the ODBC SQLSetStmtOption() cursor parameters:
<P>
<PRE>   SQL_CURSOR_TYPE = SQL_CURSOR_FORWARD_ONLY
   SQL_CONCURRENCY = SQL_CONCUR_READ_ONLY
   SQL_ROWSET_SIZE = 1

</PRE>Starting with driver that shipped with SQL Server 6.0, the Microsoft SQL
Server ODBC drivers added support for all of the ODBC cursor type options.
The Microsoft ODBC drivers do this by implementing the cursors through the
server cursors introduced in SQL Server 6.0. Any time an ODBC application
changes any of the three parameters listed above from their default
settings, the driver uses server cursors to support all calls to
SQLPrepare(), SQLExecute(), or SQLExecDirect().
<P>
The server cursors in SQL Server 6.0 and later have a restriction in that
they do not support multiple result sets. This means that an application
cannot use server cursors to run a stored procedure containing multiple
select statements, nor can it run a batch containing multiple commands. For
example, the following statement would not be supported on a server cursor:
<P>
<PRE>   SQLExecDirect(hstmt,
                 "select * from authors; select * from titles",
                 SQL_NTS);

</PRE>ODBC applications using the Microsoft SQL Server ODBC driver that want to
run multiple statement procedures or batches must first set the
SQLSetStmtOption cursor parameters back to their default values (listed
above) so that the driver will not attempt to open a server cursor.
Applications running multiple statement procedures or batches while using
server cursors may produce the following errors:
<P>
<PRE>   SQLState: 37000
   pfNative: 16937
   szErrorMsg: [Microsoft][ODBC SQL Server Driver][SQL Server]
               Cannot open a cursor on a stored procedure that
               has anything other than a single select statement
               in it.

   -or-

   SQLState: 37000
   pfNative: 16938
   szErrorMsg: [Microsoft][ODBC SQL Server Driver][SQL Server]
               sp_cursoropen.  The statement parameter can only
               be a single select or a single stored procedure.

</PRE>Starting with the driver that shipped with SQL Server 6.5, the Microsoft
SQL Server ODBC drivers may sometimes detect this condition themselves. The
driver can change the cursor settings back to their default values, and
then process the command without using a server cursor. If the driver does
this, it returns a SQL_SUCCESS_WITH_INFO on the SQLExecute() or
SQLExecDirect() commands, along with the following message:
<P>
<PRE>   SQLState: 01S02
   pfNative: 0
   szErrorMsg: [Microsoft][ODBC SQL Server Driver]
               Cursor type changed.

</PRE>ODBC applications getting any of these errors when attempting to use server
cursors with multiple statement batches or stored procedures should be
changed to use the default values for the SQLSetStmtOptions listed above.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: TDS<BR>
Keywords            : kbusage SSrvGen<BR>
Version             : 2.5 6.5<BR>
Platform            : WINDOWS<BR>
Issue type          : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 9, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
