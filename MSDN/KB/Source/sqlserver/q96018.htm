

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: Building Clustered Index on Empty Table Does Not Move </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q96018 ">
<META NAME="KBModify" CONTENT="1997/04/28">
<META NAME="KBCreate" CONTENT="1993/03/04">
<META NAME="Keywords" CONTENT="kbprg SSrvServer">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  One technique of moving an object onto a new segment within a database is to create a clustered index on the object. Creation of a clustered index will force a rebuild of the table, thus moving the table to whatever segment the clustered index was ...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QATJ,QA28,QAEF,QANJ,QA9N,QACI,QBVV,QAS1,QABM,QARR,QAW6,QAPN,QDIJ,QAGB,QADX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Building Clustered Index on Empty Table Does Not Move</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 28, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q96018 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:
<P>
<PRE>  - Microsoft SQL Server version 4.2 for OS/2
</PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
One technique of moving an object onto a new segment within a database
is to create a clustered index on the object. Creation of a clustered
index will force a rebuild of the table, thus moving the table to
whatever segment the clustered index was specified to be built on.
However, creating a clustered index on a table containing no data will
not result in the underlying table being rebuilt.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Consider the following scenario:
<P>
CREATE DATABASE TEST_DB ON TESTDEV1 = 2, TESTDEV2 = 2,
TESTDEV3 = 2
go
USE TEST_DB
go
SP_ADDSEGMENT TEST_SEG1, TESTDEV2
go
SP_ADDSEGMENT TEST_SEG2, TESTDEV3
go
CREATE TABLE TEST_TABLE ( COL1 INT NOT NULL ) ON TEST_SEG1
go
CREATE CLUSTERED INDEX CINDEX ON TEST_TABLE( COL1 ) ON
TEST_SEG2
go
<P>
SP_HELPSEGMENT will now show TEST_TABLE to be on TEST_SEG2. However,
executing a DBCC CHECKALLOC against TEST_DB will result in message 2558
<P>
<PRE>   Extent not within segment: Object &lt;object ID of TEST_TABLE&gt;, indid
   1 includes extents on allocation page &lt;allocation page in
   TEST_SEG1&gt; which is not in segment &lt;segment number of TEST_SEG2&gt;.

</PRE>Examination of SYSINDEXES in TEST_DB will show the ROOT of the
clustered index to be located in TEST_SEG2, while the FIRST entry will
refer to a page within TEST_SEG1.
<P>
If one row of data is added to the table, and the clustered index is
dropped and rebuilt on TEST_SEG2, the table will be moved to TEST_SEG2
and the 2558 errors corrected.
<P>
To move an empty table to a new segment, either drop and recreate the
table on the desired segment, or add one row of data, build a
clustered index on the table and the desired segment, and subsequently
truncate the table.
<P>
Should the table already contain data, dropping and rebuilding the
clustered index will cause the table to be moved to the proper segment
and eliminate the 2558 errors.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: segments<BR>
Keywords            : kbprg SSrvServer<BR>
Version             : 4.2<BR>
Platform            : OS/2<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 28, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
