

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>INF: SQL Server 6.0 ODBC Driver Changes Tempdb Usage </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q135532">
<META NAME="KBModify" CONTENT="1998/02/25">
<META NAME="KBCreate" CONTENT="1995/08/23">
<META NAME="Keywords" CONTENT="SSrvProg kbinterop kbprg">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  The usage of tempdb is affected by two changes in behavior when you upgrade from the Microsoft ODBC SQL Server driver that shipped with SQL Server version 4.21a to the one that ships with SQL Server version 6.0 or 6.5.  MORE INFORMATION  You can co...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QAU9,QA9E,QAB9,QAGI,QBVV,QBF0,QAPN,QAO2,QABA,QBG2,QAYZ,QADX,QAC1,QBVX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: SQL Server 6.0 ODBC Driver Changes Tempdb Usage</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 25, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q135532</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, versions 4.21a, 6.0, &amp; 6.5
<LI>Microsoft Open Data Base Connectivity, version 2.5
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The usage of tempdb is affected by two changes in behavior when you upgrade
from the Microsoft ODBC SQL Server driver that shipped with SQL Server
version 4.21a to the one that ships with SQL Server version 6.0 or 6.5.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
You can configure the Microsoft SQL Server driver to generate stored
procedures to support the ODBC SQLPrepare statement. One of the problems
with older Microsoft ODBC SQL Server drivers was that if an ODBC client's
connection with SQL Server was broken for some reason, the ODBC driver
would not get a chance to clean-up these procedures.
<P>
One change made in SQL Server version 6.0 is the introduction of temporary
stored procedures, which are now used by the ODBC driver when it creates
its procedures for prepared statements. These temporary stored procedures
are automatically cleaned-up by SQL Server if a client connection is broken
before the application finishes processing. This eliminates the problem
with orphaned stored procedures seen with earlier SQL Server versions. The
temporary stored procedures are located in tempdb, while the regular stored
procedures used in previous SQL Servers were located in the user database,
so you will see a change in the distribution of these stored procedures.
<P>
The current Microsoft ODBC drivers do not generate these temporary stored
procedures when they are also using server cursors. The drivers do not use
server cursors when the following statement options are set:
<P>
<PRE>   SQL_CONCURRENCY = SQL_CONCUR_READ_ONLY
   SQL_CURSOR_TYPE = SQL_CURSOR_FORWARD_ONLY
   SQL_ROWSET_SIZE = 1

</PRE>The ODBC driver does use server-side cursors for all other ODBC cursor
types when executing a single SELECT statement, or a stored procedure that
contains only a single SELECT statement. If the SQL command being executed
does not fit this profile, the driver will not use server cursors.
<P>
The second change is in the driver specific SQLSetConnectOption of
SQL_USE_PROCEDURE_FOR_PREPARE. The version 2.00.1912 ODBC driver had two
options for this: SQL_UP_OFF, and the default of SQL_UP_ON. When SQL_UP_ON
was specified, the driver would create a stored procedure when SQLPrepare
was called, and then drop the stored procedure on either a
SQLFreeStmt(SQL_DROP), SQLDisconnect, or on the next call to SQLPrepare.
<P>
The version 2.50.0121 ODBC driver has changed so that there are now three
options: SQL_UP_OFF, SQL_UP_ON, and SQL_UP_ON_DROP. In the new driver,
SQL_UP_ON_DROP behaves the way SQL_UP_ON behaved in the 2.00.1912 driver.
SQL_UP_ON has had its behavior changed so that it no longer drops the
generated procedures on a call to SQLFreeStmt(SQL_DROP) or the next
SQLPrepare, it only drops them on a call to SQLDisconnect. SQL_UP_ON
remains the default for the driver. This means some long running
applications which maintain one or more connections for long periods may
see a buildup of temporary stored procedures in tempdb when using the
2.50.0121 driver. The applications can eliminate the problem by calling
SQLSetConnectOption to set SQL_USE_PROCEDURE_FOR_PREPARE to SQL_UP_ON_DROP
instead of SQL_UP_ON. This is documented in the SQL Server 6.0 ODBC Driver
help file DRVSSRVR.HLP, and in the ODBC driver chapter of the SQL Server
6.0 Books Online, "ODBC SQL Server Driver."
<P>
SQL_UP_ON and other options are defined in SQL Server ODBC driver
help file as follows:
<PRE>  
   #define SQL_UP_OFF      0L
   #define SQL_UP_ON       1L
   #defineSQL_UP_ON_DROP   2L
   #define SQL_UP_DEFAULT  SQL_UP_ON
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: sql6<BR>
Keywords          : SSrvProg kbinterop kbprg<BR>
Version           : 2.50.0121 4.21a 6.0 6.5<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 25, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
