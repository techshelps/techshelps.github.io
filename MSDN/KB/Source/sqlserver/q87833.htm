

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>FIX: Two-Phase Commit build_xact_string Documentation </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q87833 ">
<META NAME="KBModify" CONTENT="1997/04/28">
<META NAME="KBCreate" CONTENT="1992/08/06">
<META NAME="Keywords" CONTENT="kbbug4.20 kbother kbusage SSrvServer">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG# NT: 4260 (4.20)   When SQL Server is started, recovery runs for as long as one hour before completing. When recovery is complete, the SQL Server error log contains the following messages:     Spawn of probe failed. Error = 2.    Error: 3429, Sev...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QACK,QAAP,QAR4,QAH6,QAB4,QBWP,QAZV,QAH7,QAD7,QAKP,QBWD,QAUJ,QBVV,QBB0 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Two-Phase Commit build_xact_string Documentation</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 28, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q87833 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server version 4.2 for OS/2
</UL> 
BUG# NT: 4260 (4.20)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When SQL Server is started, recovery runs for as long as one hour before
completing. When recovery is complete, the SQL Server error log contains
the following messages:
<P>
<PRE>   Spawn of probe failed. Error = 2.
   Error: 3429, Severity: 21, State: 3
   Error recovering database '%.*s' - could not connect to commit
   service to check completion status of xact: %S_RID.
   Error: 3414, Severity: 21, State: 1
   Database '%.*s' (dbid %d): Recovery failed. Please contact
   Technical Support for further instructions.

</PRE>The database marked as suspect is not usable.
<P>
<P><h2>CAUSE</h2>
 
<P>
SQL Server spawns PROBE.EXE for any server that must recover a transaction
involved in a two-phase commit. PROBE.EXE attempts to connect to the commit
service, but eventually fails.
<P>
PROBE.EXE uses the value for service_name, submitted to the DB-LIBRARY (db-
lib) build_xact_string function, for the name of the commit service server.
<P>
The SQL Server documentation for build_xact_string does not clearly state
that "service_name" should be the name of the server acting as the commit
service for the two-phase commit.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To recover the database marked as suspect, rename the server acting as the
commit service to whatever value was passed to build_xact_string for
"service_name." This allows PROBE.EXE to connect to the commit service to
complete the recovery.
<P>
Also, calls to build_xact_string should provide the server name for the
server acting as the commit service. Pass this value in the "service_name"
parameter.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft SQL Server
version 4.2 for OS/2. This problem was corrected in SQL Server version 4.2
for Windows NT. For more information, contact your primary support
provider.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: dblib os/2 winnt<BR>
Keywords            : kbbug4.20 kbother kbusage SSrvServer<BR>
Version             : 4.2<BR>
Platform            : OS/2<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 28, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
