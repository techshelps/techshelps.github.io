

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>BUG: Writelog Timeout When Replicating Cross-DB Transactions </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q181557">
<META NAME="KBModify" CONTENT="1998/03/13">
<META NAME="KBCreate" CONTENT="1998/02/20">
<META NAME="Keywords" CONTENT="SSrvAdmin SSrvErr_Log SSrvProg SSrvRep">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG #: 17830 (NT: 6.5)   If a published table is modified as part of a two-phase commit transaction, SQL Server may become sluggish or begin to log writelog timeout messages to the SQL Server errorlog. The writelog timeout message will look like:    ...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QAEV,QAKP,QAX6,QAR4,QDKW,QBWS,QAYC,QBXJ,QAMR,QDMH,QDIX,QDIO,QBXN,QBVV V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Writelog Timeout When Replicating Cross-DB Transactions</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 13, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q181557</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, version 6.5
</UL> 
BUG #: 17830 (NT: 6.5)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If a published table is modified as part of a two-phase commit transaction,
SQL Server may become sluggish or begin to log writelog timeout messages to
the SQL Server errorlog. The writelog timeout message will look like:
<P>
<PRE>   writelog: timeout, dbid 7, dbstat2 0x100002(0x100002), q1/q2 0/0,
   owner=17, waittype=0

</PRE>The problem is more likely to occur on a computer with a single or dual
processors, where the default 'SMP Concurrency' option would throttle SQL
Server to using only a single processor. Computers with more processors may
still exhibit short bottlenecks, but will be much less likely to see the
writelog timeout messages.
<P>
Internally, SQL Server uses two-phase commit protocol when performing any
cross-database transactions. Two-phase commit may also be done
programmatically through DB-Library applications, or applications using
Microsoft Transaction Server (MTS).
<P>
<P><h2>CAUSE</h2>
 
<P>
When the logreader task runs sp_repldone and finds a pending two-phase
commit transaction, it waits for a short period of time to allow the
transaction to complete. During this time, it holds an internal resource
used for synchronization, thus preventing other processes from running.
Processes attempting to write log records may therefore see timeout
messages.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To work around this problem, change the logreader to a Recurring task,
rather than Auto Start. Even if the task is run every minute, the frequency
with which sp_repldone is run will decrease, thereby minimizing the chance
of stalling on a transaction in a prepared state.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in SQL Server version 6.5.
A supported fix is now available, but has not been fully regression-tested
and should be applied only to systems experiencing this specific problem.
Unless you are severely impacted by this specific problem, Microsoft
recommends that you wait for the next Service Pack that contains this fix.
Contact Microsoft Technical Support for more information.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Writelog timeout messages occur when SQL Server waits for longer than the
configured 'resource timeout' period for a log write operation to complete.
These timeouts typically indicate an I/O bottleneck. If this particular
scenario is being encountered, the disk subsystem will essentially be idle.
For detailed information about troubleshooting scenarios where the disk
subsystem is busy during these timeout errors, see the following article in
the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../SQLSERVER/Q167711.htm">Q167711</A></B>
   TITLE     : INF: Understanding Bufwait and Writelog Timeout Messages
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: slow timeouts 2pc performance<BR>
Keywords          : SSrvAdmin SSrvErr_Log SSrvProg SSrvRep<BR>
Version           : WINNT:6.5<BR>
Platform          : winnt<BR>
Issue type        : kbbug<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 13, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
