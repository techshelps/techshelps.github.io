

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>FIX: Cursor w/ Union May Cause Errors if Not First in Batch </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q138746">
<META NAME="KBModify" CONTENT="1997/05/02">
<META NAME="KBCreate" CONTENT="1995/10/26">
<META NAME="Keywords" CONTENT="kbbug6.00 kbfix6.00.sp2 kbprg SSrvProg">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG# NT: 11237 (6.00)   If a cursor is opened that contains a union between two queries, you may receive errors such as:    DB-Library: Possible network error: Bad token from SQL Server:   Datastream processing out of sync.   Net-Library error 0:   D...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAAP,QABM,QAB4,QAO2,QAKP,QAR4,QBWP,QBVV,QBG2,QAY2,QAO4,QAI5,QAEF,QDMR,QBXH V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Cursor w/ Union May Cause Errors if Not First in Batch</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 2, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q138746</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, version 6.0
</UL> 
BUG# NT: 11237 (6.00)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If a cursor is opened that contains a union between two queries, you may
receive errors such as:
<P>
<PRE>  DB-Library: Possible network error: Bad token from SQL Server:
  Datastream processing out of sync.
  Net-Library error 0:
  DB-Library: Possible network error: Bad token from SQL Server:
  Datastream processing out of sync.  Connection broken.
  &lt;above is repeated many times&gt;
  Net-Library error 6: ConnectionClose (CloseHandle()).
  Msg 533, Level 20, State 4
  Can't find a range table entry for range 5.
  DB-Library Process Dead - Connection Broken

</PRE>And in some cases, the following message may also occur:
<P>
<PRE>  Msg 16942, Level 16, State 2
  Asyncronous keyset generation failed, the cursor has been deallocated

</PRE><h2>WORKAROUND</h2>
 
<P>
This generally occurs when there are other Transact-SQL statements
preceding the declaration of the cursor. Moving the cursor to the beginning
of the batch may prevent the errors from occurring.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in SQL Server for Windows NT
version 6.0. This problem was corrected in Service Pack 2 for SQL Server
version 6.0. For more information, contact your primary support provider.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Changing the UNION to a UNION ALL can cause the problem seemingly to
disappear. However, in some cases, the batch runs without any error in the
errorlog or to the client, but the connection is broken and the dbproc is
dead.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: sql6 cursor union dropped<BR>
Keywords            : kbbug6.00 kbfix6.00.sp2 kbprg SSrvProg<BR>
Version             : 6.0<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 2, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
