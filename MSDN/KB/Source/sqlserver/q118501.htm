

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>INF: Troubleshooting SQLMail with Post Offices </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q118501">
<META NAME="KBModify" CONTENT="1997/04/08">
<META NAME="KBCreate" CONTENT="1994/07/20">
<META NAME="Keywords" CONTENT="kbprg SSrvProg SSrvStProc">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  You can use certain basic troubleshooting techniques to diagnose and resolve most SQLMail problems. Typically, errors in starting a mail session or sending mail fall into two categories: permissions problems when accessing Shared File System (SFS) ...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QALZ,QBWP,QAI5,QABM,QBWS,QBG2,QAYC,QA3A,QACK,QAGU,QAFZ,QABI,QBW7,QBWG,QAA1 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: Troubleshooting SQLMail with Post Offices</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 8, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q118501</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, versions 4.2, 4.21, 6.0 and 6.5
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
You can use certain basic troubleshooting techniques to diagnose and
resolve most SQLMail problems. Typically, errors in starting a mail session
or sending mail fall into two categories: permissions problems when
accessing Shared File System (SFS) shares being used as a post office, and
registry setup problems. SQLMail functionality is documented in the Release
Notes help file for version 4.2x, or in "Books Online" for version 6.x.
These should be thoroughly reviewed before using SQLMail functionality.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
You should examine the following checklist of items, preferably in the
order given:

<OL><P><LI>Confirm that a mail session can be started and mail can be sent using
   the Win32 mail client, MSMAIL32.EXE.

<P><LI>With SQL Server 4.2x, SQLMail requires that the SQLServer service is
   run under the system account (sometimes called the LocalSystem
   account). You can determine this by opening the Services application
   in Control Panel, selecting the SQLServer service and clicking the
   Startup button. In addition, the service must have the option
   "Allow service to Interact with Desktop" selected.
<P>
   With SQL Server version 6.x, it is suggested that the MSSQLServer
   service is run under a user account, however, SQLMail will work when
   the MSSQLServer is run under the system account and the option
   "Allow service to Interact with Desktop" is not selected.
<P>
   IMPORTANT NOTE: A service running under the system account has no user
   account information associated with it. This will prevent certain
   network server software from allowing the Windows NT service to access
   resources. Microsoft LAN Manager user-level security servers and Novell
   NetWare Servers will not allow a Windows NT service running under the
   system account to access their file shares.
<P>
   For additional information on running SQL Server as the system account
   when the post office resides on a Novel NetWare server, please see the
   following article in the Microsoft Knowledge Base:
<P>
<P><PRE>      ARTICLE-ID: <B><A HREF="../SQLSERVER/Q126726.htm">Q126726</A></B>
<PRE></PRE>      TITLE     : Using SQLMail with a NetWare Post Office

</PRE><P><LI>   Confirm that the SQLMail user name and password are correct. To do
  this,
   run SQL Server Setup. Select Set Server Options and click Mail Login.
   Make sure that the password is not null. If it is null, SQLMail does not
   start. Before you click Continue, do step number four and five below.

<P><LI>If SQL Server is running under a user account, skip to step number
   seven.

<P><LI>When starting a mail session, Mail uses information in the Windows NT
   registry in order to determine startup information, such as the share
   name serving as a post office for the user logging in. This registry
   information is configured for the current user. To make this
   information available to SQL Server, run SQL Server Setup, select Set
   Server Options, select the Mail Login button, and ensure that the
   option box "Copy SQLMail Configuration from Current User Account" is
   selected.
<P>
   This option will create the following registry key, which is used by
   SQLMail:
<P>
   HKEY_USERS\.DEFAULT\Software\Microsoft\Mail
<P>
   If this registry key is not set up properly, confirm that the ability to
   start a mail session using the account with which you are currently
   logged into Windows NT is possible, and re-run SQL Server setup,
   ensuring that the "Copy SQLMail Configuration from Current User Account"
   is selected.

<P><LI>   If the post office resides on a Windows NT version 3.5 (or later)
   server, you need to add the post office share to the list of shares that
   can be accessed by services running under the system account. You can do
   this by adding the share name to the following registry value on the
   Windows NT computer where the post office is located using the Registry
   Editor (REGEDT32.EXE):
<P>
   HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\LanmanServer
   \Parameters\NullSessionShares
<P>
   For example, if the post office was running on a computer with the name
   "NTServer" and the post office directory is shared as "WGPO", the value
   "WGPO" must be added to the NullSessionShares value.
<P>
   Because the NullSessionShares value is of the type REG_MULTI_SZ, each
   share name must be on a separate line from the other share names.
<P>
   In order for this registry change to take effect, the post office
   computer must be rebooted.

<P><LI>If SQL Server is running under a user account instead of the system
   account, confirm that step one was performed while logged into Windows
   NT with the same user account that SQL Server is using.

<P><LI>Confirm that the SQL Server service has Change access permissions or
   RWCD access permissions to the post office share. If the SQL Server is
   running under the system account, this will require the post office
   share grant these rights to the Everyone group.
<P>
   Additionally, if the post office is located on a NTFS partition,
   Everyone must be granted the same rights as the share permissions on
   the post office directory, including all subdirectories as well as all
   existing files in the post office directory.

<P><LI>Test SQL Server access permissions on the post office share. You can
   do this by using the XP_CMDSHELL extended stored procedure, which runs
   with the same permissions as SQLMail.
<P>
   You can use the following commands to test read and write access to the
   server, assuming the post office is located on a computer named
   "NTServer" and the post office directory is shared as "WGPO":
<P>
<P><PRE>      xp_cmdshell "dir \\NTServer\WGPO"
</PRE><P>
<P><PRE>      xp_cmdshell "echo 'hello' &gt; \\NTServer\WGPO\test.txt"
</PRE><P>
   If either of the above commands fail, either step three, five, six, or
   seven has not been completed correctly.

<P><LI>  Make sure that you have the proper version of MAPI32.DLL. When you
<P><PRE>    install the Exchange client, the MAPI32.DLL file is over 640 KB. The
    proper version of the file is 16 KB.
</PRE>
<P><LI>  Access Violation and MAPI Exception error messages appear if you run
<P><PRE>    SQLMail and other MAPI client software or Mail blocking at the same
    time. For additional information on SQLMail messages being blocked,
    please see the following article in the Microsoft Knowledge Base:
</PRE><P>
<P><PRE>       ARTICLE-ID: <B><A HREF="../SQLSERVER/Q124048.htm">Q124048</A></B>
<PRE></PRE>       TITLE     : PRB: Outgoing SQLMail Messages Blocked and Not Sent
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: sql6 mapi mapi32 mail32 windows nt<BR>
Keywords            : kbprg SSrvProg SSrvStProc<BR>
Version             : 4.2 4.21 6.0 6.5<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 8, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
