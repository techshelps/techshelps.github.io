

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>INF: SQL Server Update Transaction Log Information </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q67174 ">
<META NAME="KBModify" CONTENT="1997/04/25">
<META NAME="KBCreate" CONTENT="1990/11/22">
<META NAME="Keywords" CONTENT="kbother SSrvServer">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  The following information discusses how the transaction log file is updated.  MORE INFORMATION  Each transaction log record is composed of a 16-byte header, plus a variable length row for the type of transaction.  When an update is performed and a ...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA5V,QATJ,QA28,QACI,QAXB,QDMH,QA9N,QBCT,QAGC,QAGB,QAEF,QBD2,QAC1,QDKD,QABM V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: SQL Server Update Transaction Log Information</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 25, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q67174 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:
<P>
<PRE>  - Microsoft SQL Server version 4.2 for OS/2
</PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The following information discusses how the transaction log file
is updated.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Each transaction log record is composed of a 16-byte header, plus a
variable length row for the type of transaction.
<P>
When an update is performed and a nonclustered index is used on the
table, SQL Server will delete the old version of the row, and then
insert the new version of the row. This is true for both data rows and
index rows. Please note that SQL Server will perform an "update in
place" under certain restrictions. For an outline of these
restrictions, query on the following words:
<P>
<PRE>   SQL Server and criteria and insert and update

</PRE>The update is treated as a complete transaction. In the case of a
table with a nonclustered index, records are logged to indicate an
intent to update. One record is logged with the data to insert, and
one record is logged with the location of the data to delete. Next, a
record is logged for each data row and index row that is deleted. As
each insert is processed, the location of the updated row is
determined. A record is then logged with this location and a pointer
to the log record that contains the data. Finally, for each index
entry inserted, a record is logged.
<P>
For example, an update of two records would be logged as follows:
<P>
<PRE>   Begin transaction
   CMD
   Intent to delete record 0
   Intent to insert data "hello world" log record (2054, 12)
   Intent to delete record 1
   Intent to insert data "hello work"  log record (2054, 14)
   Delete index #1
   Delete index #2
   Delete record data "good bye world"
   Delete index #1
   Delete index #2
   Delete record data "good bye work"
   Insert index #1
   Insert Index #2
   Insert data from (2054,12) to page 40
   Insert index #1
   Insert Index #2
   Insert data from (2054,14) to page 41
   End Transaction

</PRE>In summary:

<OL><P><LI>The intent to delete and insert the data is logged.

<P><LI>All the deletes are logged.

<P><LI>All the inserts are logged.
<P>
</OL>Given the above information, the minimum size of the log for this type
of update is as follows:
<P>
<PRE>   For each update assuming that there are two indexes:

   2 Rows for Index Deletes
   2 Rows for Index Inserts
   1 Row for data Delete
   1 Row for deferred insert
   -
   6 x 16 bytes = 96 bytes

   1 Row for deferred delete with a fixed length of 24 bytes
   1 Row for location of insert with a fixed length of 52 bytes
   ------------------------------------------------------------

   Total 172 bytes x #rows to be updated

   + 2 x the size of data
   + 2 x the size of index

</PRE></OL>In addition to the inserts and deletes, there are also log records for
both the begin and end transactions, and a log record for the command.
This also does not take into consideration potential page splits,
allocation and deallocation of pages, extent allocation, and
deallocation, which also generate log records in the transaction log.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: Database repair<BR>
Keywords            : kbother SSrvServer<BR>
Version             : 4.2<BR>
Platform            : OS/2<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 25, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
