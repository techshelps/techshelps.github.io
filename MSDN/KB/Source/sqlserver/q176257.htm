

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: Client Login Does Not Time Out If the Server Is Offline </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q176257">
<META NAME="KBModify" CONTENT="1997/11/06">
<META NAME="KBCreate" CONTENT="1997/11/04">
<META NAME="Keywords" CONTENT="SSrvGen SSrvLan kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  A SQL Server client application may not correctly time out according to the set timeout value in the application if the server it tries to connect to is shut down or otherwise offline. For example, if the timeout value is set to 10 seconds, the app...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWD,QABM,QDNT,QBVV,QAU3,QAMR,QACE,QAEF,QADN,QAUJ,QAFH,QAWH,QARL,QAJH,QAUD V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Client Login Does Not Time Out If the Server Is Offline</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 6, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q176257</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server versions 4.2x, 6.0, and 6.5
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
A SQL Server client application may not correctly time out according to the
set timeout value in the application if the server it tries to connect to
is shut down or otherwise offline. For example, if the timeout value is set
to 10 seconds, the application may not time out until 90 seconds later.
This can happen under either Named Pipes or TCP/IP sockets Net-Libraries,
although the delay may be shorter under TCP/IP sockets.
<P>
<P><h2>CAUSE</h2>
 
<P>
By default, when a SQL Server client application tries to connect to SQL
Server through TCP/IP sockets or Named Pipes with TCP/IP as the transport,
the TCP transport layer must resolve the server name to its IP address
through WINS. Even if a server has been offline for a while, the server
name and IP address can still exist in the WINS database, due to the long
refresh rate in WINS. As a result, the corresponding IP address is returned
to the client successfully. The next step is to resolve the IP address to
the machine address of the server through Address Resolution Protocol (ARP)
broadcast packets. Because the server computer is really offline now, such
ARP broadcasts eventually fail after a few retries. By default, these
retries cause a delay of about 45 to 50 seconds. In the case of Named
Pipes, the redirector retries the entire address resolution sequence,
starting with querying the WINS database, one more time. As a result, the
total delay is doubled to 90 to 100 seconds. For socket connections, the
delay is 45 to 50 seconds.
<P>
Thus, even if the application login timeout is set to a short period of
time, say 30 seconds, it does not time out until the underlying IPC returns
the control back to the Net-Library. In this situation, the IPC does not
return the control back to Net-Library until 45 seconds (for TCP/IP
sockets) or 90 seconds (for named pipes) later. Therefore, the application
timeout can be delayed for up to 45 or 90 seconds.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
The only adjustable parameter affecting this behavior is
TcpMaxConnectRetransmissions, which controls how many times ARP packets are
retransmitted. The default is three retries, for a total of four
transmissions. Because each retransmission timeout is doubled with each
successive retransmission in a given connection, reducing the number of
retries by one can cut the total timeout length by half. For information on
how to change this parameter, please refer to the following article in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../WINNT/Q120642.htm">Q120642</A></B>
   TITLE     : TCP/IP &amp; NBT Configuration Parameters for Windows NT

</PRE><h2>MORE INFORMATION</h2>
 
<P>
This timeout behavior can occur with both ODBC and DB-Library applications,
and it is totally independent of the application or the application
programming interfaces (APIs) used. This delay is directly caused by the
behaviors of the underlying transport protocols and IPCs used for the
client connections. The same IPC, like Named Pipes, can exhibit different
behaviors with different transport protocols. For example, Named Pipes over
NetBEUI may not have this delay problem because TCP/IP, which is
responsible for most of the delay, is not used.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: dblib netlib MAC<BR>
Keywords          : SSrvGen SSrvLan kbnetwork<BR>
Version           : WINNT:4.2x 6.0 6.5<BR>
Platform          : WINDOWS<BR>
Issue type        : kbprb<BR>
Solution Type     : kbworkaround<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 6, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
