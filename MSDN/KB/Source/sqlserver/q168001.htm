

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: User Logon and/or Permission Errors After Restoring Dump </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q168001">
<META NAME="KBModify" CONTENT="1997/05/28">
<META NAME="KBCreate" CONTENT="1997/05/02">
<META NAME="Keywords" CONTENT="kbusage SSrvAdmin">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  If a dump of a SQL Server user database is restored to a different SQL Server (such as a hot backup server) or to the same SQL Server after either rebuilding or reloading an old version of the master database, user logons and permissions on the dat...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGU,QAZV,QABM,QAMA,QAI5,QAOE,QBWG,QAAP,QBW7,QAB4,QBWF,QAK7,QALW,QAJQ,QDNQ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: User Logon and/or Permission Errors After Restoring Dump</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 28, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q168001</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, versions 6.0 and 6.5
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If a dump of a SQL Server user database is restored to a different SQL
Server (such as a hot backup server) or to the same SQL Server after either
rebuilding or reloading an old version of the master database, user logons
and permissions on the database may be incorrect.
<P>
This problem may reveal itself in several ways:

<UL><LI>While logging on to the server, users may receive the following error:
<P>
<P><PRE>      Msg 4002, Level 14, State 1, Server Microsoft SQL Server, Line 0
      Login failed
      DB-Library: Login incorrect.
</PRE>
<LI>While trying to access objects within the database, users may receive
   the following error:
<P>
<P><PRE>      Msg 229, Level 14, State 1
      %s permission denied on object %.*s, database %.*s, owner %.*s
</PRE>
<LI>Users may have permissions on objects for which they previously did not.
<P>
</UL><h2>CAUSE</h2>
 
<P>
User logon information is stored in the syslogins table in the master
database. By changing servers, or by altering this information by
rebuilding or restoring an old version of the master database, the
information may be different from when the user database dump was created.
If logons do not exist for the users, they will receive error 4002 "Login
failed" while attempting to log on to the server. If the user logons do
exist, but the SUID values in master..syslogins and the sysusers table in
the user database differ, the users may have different permissions than
expected in the user database.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To work around this problem, do any of the following:

<UL><LI>If current scripts are available to add logons, users, and permissions,
   drop and re-create them from scripts.

<LI>In SQL Server 6.5, you can use the sp_change_users_login stored
   procedure re-associate relationships between the syslogins, sysusers and
   sysalternates tables. However, the procedure makes best estimates on
   links, and may allow a user more access privileges than intended.
   Running the procedure with the Report option first will generate a list
   of users that will be altered. Afterwards, you should check to ensure
   that the affected users have the appropriate permissions. Also, be aware
   that the sp_change_users_login procedure does not fix permission
   problems derived from logons and users created in a different order on
   the database where the backup is restored.

<LI>Restore a dump of the master database from the time of the user database
   dump to the server before loading the user database. Doing this ensures
   that all user information in the user database matches correctly with
   the syslogins table in master.
<P>
   WARNING: The master database contains server-wide information, and
   affects all databases on the server. By restoring the master database,
   you may encounter additional user IDs and/or databases that are lost or
   have incorrect permissions. Any changes to the master that have occurred
   since the time of the backup will be lost. Only use this method if you
   are certain that the backup version of the master database contains
   accurate information for the user database in question and all other
   databases on the server.

<LI>Contact your primary support provider.
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : kbusage SSrvAdmin<BR>
Version             : 6.0 6.5<BR>
Platform            : WINDOWS<BR>
Issue type          : kbprb<BR>
Resolution Type     : kbworkaround<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 28, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
