

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: SQL Server Connections Not Closed from Visual Basic </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q77181 ">
<META NAME="KBModify" CONTENT="1997/04/25">
<META NAME="KBCreate" CONTENT="1991/10/08">
<META NAME="Keywords" CONTENT="kbinterop SSrvVisB">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  When developing programs with the Visual Basic Library for SQL Server (VBSQL), there are several problems that can occur when connections to SQL Server are not closed properly. This article describes the symptoms of these problems and provides info...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QABM,QAI5,QAH4,QAGB,QAB4,QBG2,QAAP,QBVV,QAKP,QAUR,QA5F,QAMA,QBWS,QAY2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: SQL Server Connections Not Closed from Visual Basic</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 25, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q77181 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:
<P>
<PRE>  - Microsoft SQL Server Programmer's Toolkit, version 4.2
</PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When developing programs with the Visual Basic Library for SQL Server
(VBSQL), there are several problems that can occur when connections to SQL
Server are not closed properly. This article describes the symptoms of
these problems and provides information on how to avoid them.

<OL><P><LI>The following Visual Basic error is returned when the maximum number of
   open files that MS-DOS can access has been exceeded:
<P>
<P><PRE>      Error:  Too many files
</PRE>
<P><LI>The following VBSQL error message is returned when an attempt is
   made to log in to a SQL server that has no available user
   connections:
<P>
<P><PRE>      Error 10010:  Read from SQL Server Failed
</PRE><P>
</OL><h2>CAUSE</h2>
 

<OL><P><LI>This error can occur when developing programs with VBSQL because
   each connection to SQL Server requires an MS-DOS file handle. When
   connections are not closed properly, these file handles are not
   released.

<P><LI>This error can occur when developing programs with VBSQL because
   connections that are not closed properly will remain on the server
   as "sleeping processes." While present, these processes consume
   valuable user connections and can prevent additional users from
   logging on to the server.
<P>
</OL><h2>WORKAROUND</h2>
 
<P>
Both of the problems mentioned above can result when running
programs in the Visual Basic interpretive mode. The problems can be
quickly resolved by closing Visual Basic itself because when Visual
Basic is closed, it frees up any existing MS-DOS file handles that
were left open. In addition, SQL Server removes any associated
"sleeping processes." While this method will resolve the problems
if they occur, there can be negative consequences. For example, if
the "Too many files" error is received, it may be difficult to save
changes made since the last time the project was saved.
<P>
Eliminating these problems can be difficult, if not impossible,
because there are many times during the development and debugging
process when the program may have to be terminated prematurely.
However, it is possible to reduce the frequency at which these
types of problems occur. The following precautions will help to
achieve this goal:

<UL><LI>Always call SqlClose() for every connection opened with SqlOpen()
   or SqlOpenConnection() prior to exiting the program. Be aware
   that there may be a number of ways in which the program can exit
   (for example, by using custom buttons or menu options that run
   the End statement, by using the Close option on the program
   control menu, and/or by using user-defined error handlers).

<LI>Test the program in interpretive mode only when it is necessary
   to take advantage of Visual Basic's debugging tools. For general
   usability testing, compile the program into an .EXE file and run
   directly from Windows.

<LI>During the debugging process, periodically save the project,
   close Visual Basic, and restart.

<LI>Always save the project prior to running the program in
   interpretive mode. This will help eliminate lost work due to the
   "Too many files" error.

<LI>It may be necessary to increase the MS-DOS file handles by
   adjusting the "files=" statement in the CONFIG.SYS file.
<P></UL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words:<BR>
Keywords            : kbinterop SSrvVisB<BR>
Version             : 4.2<BR>
Platform            : OS/2<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 25, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
