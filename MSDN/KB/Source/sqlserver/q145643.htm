

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>INF: Processing DBCC Commands in ODBC applications </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q145643">
<META NAME="KBModify" CONTENT="1997/04/08">
<META NAME="KBCreate" CONTENT="1996/02/05">
<META NAME="Keywords" CONTENT="kbinterop kbprg SSrvProg SSrvTran_SQL">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  This article discusses how the ODBC applications that use the Microsoft SQL Server ODBC Driver can process the output of DBCC commands. SQL Server drivers from other vendors may return DBCC information differently, and you should refer to the docum...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QAUD,QA9E,QAGI,QA5A,QAHE,QALW,QBV8,QAJH,QAU9,QAB9,QAN0,QAOX,QAIF,QA5V V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: Processing DBCC Commands in ODBC applications</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 8, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q145643</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, versions 6.0 &amp; 6.5
<LI>Microsoft Open Database Connectivity
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article discusses how the ODBC applications that use the Microsoft SQL
Server ODBC Driver can process the output of DBCC commands. SQL Server
drivers from other vendors may return DBCC information differently, and you
should refer to the documentation for those drivers.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Microsoft SQL Server applications can use the Transact-SQL DBCC commands to
get additional information from the server, such as information on the
choices made by the server's optimizer, locking information, table
consistency, and so forth.
<P>
All the information returned to applications from DBCC commands does not
come back in a result set. In DB-library applications, the output comes
back to the application's message handler. The Microsoft SQL Server ODBC
driver returns the output by returning SQL_SUCCESS_WITH_INFO on the ODBC
function that executes the command. The application can then retrieve the
DBCC output by calling the SQLError() function. There are two main classes
of DBCC commands with regard to the time at which the application should
expect SQL_SUCCESS_WITH_INFO and call SQLError().
<P>
The first class is the DBCC output generated through the DBCC TRACEON trace
flags. Some of the DBCC trace flags generate trace information whenever
the server processes an SQL command. For example, the 4032 flag traces each
SQL command as it is received at the server, and the 310 flag shows
information about the join order used. The output destination of the trace
flags is controlled with the 3605/3604 trace flags. If the 3604 flag is
turned on, then trace flag output is returned to the application; if the
3605 flag is on, then trace output is sent to the SQL Server errorlog.
<P>
When an ODBC application sets the 3604 flag in conjunction with a trace
flag that generates (like 4032 or 310), then SQLExecute or SQLExecDirect
for each SQL command will return SQL_SUCCESS_WITH_INFO. When the
application then calls SQLError(), each call to SQLError() will return a
line of the trace output. Many of the flags will return multiple lines of
output, so the application should call SQLError() until it returns
SQL_NO_DATA_FOUND.
<P>
For example, if an ODBC application does:
<P>
<PRE>  SQLExecDirect(hstmt, "dbcc traceon(3604, 4032)", SQL_NTS);
  SQLExecDirect(hstmt, "select * from authors", SQL_NTS);

</PRE>The second SQLExecDirect will return SQL_SUCCESS_WITH_INFO, and a call to
SQLError() will then return one line of trace output:
<P>
<PRE>   szSqlState = "01000", *pfNativeError = 0,
   szErrorMsg="[Microsoft][ODBC SQL Server Driver][SQL Server]
         96/02/02 11:08:45.26 10 LangExec: 'select * from authors"

</PRE>All of the other DBCC commands fall into the second class regarding the way
they return output. All of the other DBCC commands return
SQL_SUCCESS_WITH_INFO when the DBCC command is executed, and the
application can retrieve the output by calling SQLError() until it returns
SQL_NO_DATA_FOUND. For example, if an ODBC application does:
<P>
<PRE>   SQLExecDirect(hstmt, "dbcc checktable(authors)", SQL_NTS);

</PRE>This SQLExecDirect will return SQL_SUCCESS_WITH_INFO and calls to
SQLError() will return the following lines:
<P>
<PRE>   szSqlState = "01000", *pfNativeError = 2536,
   szErrorMsg="[Microsoft][ODBC SQL Server Driver][SQL Server]
         Checking authors"
   szSqlState = "01000", *pfNativeError = 2579,
   szErrorMsg="[Microsoft][ODBC SQL Server Driver][SQL Server]
         The total number of data pages in this table is 1."
   szSqlState = "01000", *pfNativeError = 7929,
   szErrorMsg="[Microsoft][ODBC SQL Server Driver][SQL Server]
         Table has 23 data rows."
   szSqlState = "01000", *pfNativeError = 2528
   szErrorMsg="[Microsoft][ODBC SQL Server Driver][SQL Server]
         DBCC execution completed. If DBCC printed error messages,
         see your System Administrator."
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: sql65 odbc debug<BR>
Keywords            : kbinterop kbprg SSrvProg SSrvTran_SQL<BR>
Version             : 6.0 6.5<BR>
Platform            : WINDOWS<BR>
Issue type          : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 8, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
