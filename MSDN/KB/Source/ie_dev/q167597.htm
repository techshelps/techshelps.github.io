

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>FILE: Specifying FileVersion and #Version for Component Download </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q167597">
<META NAME="KBModify" CONTENT="1997/07/30">
<META NAME="KBCreate" CONTENT="1997/04/27">
<META NAME="Keywords" CONTENT="AXSDKCompDownload">
<META NAME="KBArea" CONTENT="Support; KB; ie_dev">
<META NAME="Description" CONTENT="  Update of components over the Web is usually controlled by the component's file version. This file version can be specified either by the #Version in the CODEBASE attribute of the          tag or the FileVersion keyword in the .inf file. Determinin...">
<META NAME="Product" CONTENT="Internet Explorer (Programming)">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAC1,QBBI,QAUD,QAPN,QAW6,QAO0,QAMB,QAA1,QBVV,QDI2,QBWA,QAOE,QAJG,QBWS,QAY2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FILE: Specifying FileVersion and #Version for Component Download</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 30, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q167597</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Internet Explorer (Programming), versions 3.0, 3.01, 3.02,
   4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Update of components over the Web is usually controlled by the component's
file version. This file version can be specified either by the #Version in
the CODEBASE attribute of the &lt;OBJECT&gt; tag or the FileVersion keyword in
the .inf file. Determining the file version can be confusing, and if not
specified correctly, could cause the component to download incorrectly.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
For the &lt;OBJECT&gt; tag, specify the file version using the CODEBASE attribute
in this manner:
<P>
<PRE>   &lt;OBJECT ID="BoomButton" WIDTH=225 HEIGHT=35
    CLASSID="CLSID:56F1BF40-B2D0-11d0-A6D6-00AA00A70FC2"
    CODEBASE="<B><A HREF="http://example.microsoft.com/AControl.cab#Version=1,0,0,1">http://example.microsoft.com/AControl.cab#Version=1,0,0,1</A></B>"&gt;
   ...

</PRE>In pseudo-code, here's how component download is controlled for the
&lt;OBJECT&gt; tag:
<P>
<PRE>   Check the Registry for CLSID
   If CLSID of OBJECT is NOT found in the registry
      Download OBJECT
   Else If no #Version specified in CODEBASE tag
      Use OBJECT installed on system
   Else
      Check InprocServer32 key for location of installed component
      If File version of installed component &lt; CODEBASE #Version Tag
         Download OBJECT

</PRE>There are a couple of exceptions to the above sequence. If an [AppID] key
is found under the CLSID, the component is usually registered to run via
DCOM and is not updated. Also, an [Installed Version] key takes precedence
over the file version. This is used for Java classes and non PE (portable
executable) files.
<P>
Update of components installed via an .inf file is controlled by the
FileVersion keyword in the .inf file. For example, the following syntax
controls the installation of mfc42.dll for the VC 4.2b control above:
<P>
<PRE>   [mfc42.dll]
   FileVersion=4,2,0,6256
   hook=mfc42installer

</PRE>In pseudo-code, here's how the Mfc42.dll download is controlled by this
.inf file:
<P>
<PRE>   Search for mfc42.dll in the system (first looking at the same directory
   as the previous version of the control being installed; if not found,
   the file is searched for via the standard search path for DLLs)
   If mfc42.dll is not found,
      install mfc42.dll
   Else
    Compare the file version of the DLL with the FileVersion keyword
    specified in the .inf file

</PRE>What is confusing for both the &lt;OBJECT&gt; tag and the .inf file is what to
specify for the file version. Unfortunately, the file version reported by
the Windows shell (from Windows explorer, right-click on the file, select
Properties and click the Version tab) is not always the same as that
required for the &lt;OBJECT&gt; tag or an .inf file. For example, these are the
reported file versions and correct versions to use for several VC 5.0 DLLs:
<P>
<PRE>   Mfc42.dll:     reported - 4.21.7022  use - 4,21,0,7022
   Msvcrt.dll:    reported - 5.00.7022  use - 5,0,0,7022
   Olepro32.dll:  reported - 5.0.4055   use - 5,0,4055,1

</PRE>If you have access to Microsoft Developer Studio, you can open the
resources for a file and obtain the correct version in this manner:

<OL><P><LI>From the Developer Studio File menu, select Open, click Open as, and
   click Resources.

<P><LI>Open the version resource and you will find a FILEVERSION key.
   This is the proper version to use in the &lt;OBJECT&gt; tag or in the .inf
   file.

<P><LI>Notice that there is another "FileVersion" key following the Block
   Header portion of the version resource. This is the version displayed
   by the Windows shell, and may be different in some cases from the
   FILEVERSION value in #2 above.
<P>
</OL>If you do not have access to Microsoft Developer Studio or an environment
capable of opening file resources, you can use the program pointed to by
this article to obtain the necessary version.  To use the program, simply
download it and type:
<P>
<PRE>   GetVers &lt;filename&gt;

</PRE></OL>The following file is available for download from the Microsoft
Software Library:
<P>
<PRE> ~ <A HREF="http://support.microsoft.com/download/support/mslfiles/Getvers.exe">Getvers.exe</A> <I>(size: 40960 bytes)</I> 

</PRE>For more information about downloading files from the Microsoft Software
Library, please see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../zMiscellaneous/Q119591.htm">Q119591</A></B>
   TITLE     : How to Obtain Microsoft Support Files from Online Services


</PRE>This is the source code for the GetVer program:
<P>
<PRE>   void reportError()
   {
       LPVOID lpMsgBuf;

       FormatMessage(
           FORMAT_MESSAGE_ALLOCATE_BUFFER | FORMAT_MESSAGE_FROM_SYSTEM,
           NULL,
           GetLastError(),
           MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT), // Default language
           (LPTSTR) &amp;lpMsgBuf,
           0,
           NULL );

       cout &lt;&lt; (char*)lpMsgBuf &lt;&lt; "\n";

       // Free the buffer.
       LocalFree( lpMsgBuf );
   }

   void main( int argc, char *argv[ ], char *envp[ ] )
   {
       cout &lt;&lt; "\n";

       if(2 != argc)
       {
           cout &lt;&lt; "Syntax: GetVer &lt;File Name&gt;\n";
           return;
       }

       DWORD dwArg;
       DWORD dwInfoSize = GetFileVersionInfoSize(argv[1], &amp;dwArg;);

       if(0 == dwInfoSize)
       {
           cout &lt;&lt; "No version info available\n";
           reportError();
           return;
       }

       BYTE* lpBuff = new BYTE[dwInfoSize];

       if(!lpBuff)
       {
           cout &lt;&lt; "Out of Memory\n";
           return;
       }

       if(0 == GetFileVersionInfo(argv[1], 0, dwInfoSize, lpBuff))
       {
           cout &lt;&lt; "Error retrieving version info\n";
           reportError();
           return;
       }

       VS_FIXEDFILEINFO *vInfo;

       UINT uInfoSize;

       if(0 == VerQueryValue(lpBuff, TEXT("\\"),
               (LPVOID*)&amp;vInfo,
               &amp;uInfoSize))
       {
           cout &lt;&lt; "Version information not available\n";
           delete lpBuff;
           return;
       }

       if(0 == uInfoSize)
       {
           cout &lt;&lt; "Version information not available\n";
           delete lpBuff;
           return;
       }

       cout &lt;&lt; argv[1]
           &lt;&lt; " Version: "
           &lt;&lt; HIWORD(vInfo-&gt;dwFileVersionMS) &lt;&lt; ","
           &lt;&lt; LOWORD(vInfo-&gt;dwFileVersionMS) &lt;&lt; ","
           &lt;&lt; HIWORD(vInfo-&gt;dwFileVersionLS) &lt;&lt; ","
           &lt;&lt; LOWORD(vInfo-&gt;dwFileVersionLS) &lt;&lt; "\n";

       delete lpBuff;
   }
</PRE> 
<PRE>Keywords          : AXSDKCompDownload
Version           : 3.0 3.01 3.02 4.0
Platform          : WINDOWS</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 30, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
