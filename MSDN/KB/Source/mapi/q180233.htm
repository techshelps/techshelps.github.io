

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>HOWTO: Programmatically Find the Default MAPI Profile </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q180233">
<META NAME="KBModify" CONTENT="1998/02/03">
<META NAME="KBCreate" CONTENT="1998/01/30">
<META NAME="Keywords" CONTENT="EMAPI">
<META NAME="KBArea" CONTENT="Support; KB; mapi">
<META NAME="Description" CONTENT="  This article describes the steps needed to find the name of the default MAPI Profile for your account.  MORE INFORMATION  The default profile is the profile used if you do not explicitly specify one in the call to MAPILogonEx and instead set the MA...">
<META NAME="Product" CONTENT="mapi">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDJ2,QAGI,QABA,QBW4,QAL7,QAK9,QAIF,QAI4,QBBS,QA5V,QASR,QABN,QAA8,QDMW,QAUJ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Programmatically Find the Default MAPI Profile</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 3, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q180233</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Extended Messaging Application Programming Interface (MAPI), version 1.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article describes the steps needed to find the name of the default
MAPI Profile for your account.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The default profile is the profile used if you do not explicitly specify
one in the call to MAPILogonEx and instead set the MAPI_USE_DEFAULT flag.
<P>
<P><h3>Steps to Find the Default Profile</h3>
 

<OL><P><LI>Call the MAPIAdminProfiles() function to retrieve an IprofAdmin
   interface pointer.

<P><LI>Call IProfAdmin::GetProfileTable() to retrieve a table of all profiles.
   This table has one row for every available profile. There are only two
   columns in each row; the profile's display name and a flag that
   indicates whether the profile is the default.

<P><LI>Create a restriction on the table where PR_DEFAULT_PROFILE = TRUE and
   call FindRow() to execute restriction.

<P><LI>Call QueryRows() to retrieve the row containing the default profile.
<P>
   Here is a code sample that implements the steps to find the default
   profile:
<P>
<PRE>      HRESULT        hr;

      SRestriction   sres;
      SPropValue     spvDefaultProfile;
      LPSRowSet      pRow = NULL;

      LPSTR          lpDisplayName = NULL;

      // Get a IProfAdmin Interface.
      hr = MAPIAdminProfiles(0, &amp;lpProfAdmin);

      LPMAPITABLE    lpProfileTable;

      // Get the Table of Profiles
      hr = lpProfAdmin-&gt;GetProfileTable(0, &amp;lpProfileTable);

      // build a restriction where PR_DEFAULT_PROFILE = TRUE
      spvDefaultProfile.ulPropTag = PR_DEFAULT_PROFILE;
      spvDefaultProfile.Value.b = TRUE;

      sres.rt = RES_PROPERTY;
      sres.res.resProperty.relop = RELOP_EQ;
      sres.res.resProperty.ulPropTag = PR_DEFAULT_PROFILE;
      sres.res.resProperty.lpProp = &amp;spvDefaultProfile;

      hr = lpProfileTable-&gt;Restrict(&amp;sres, TBL_BATCH);

      hr = lpProfileTable-&gt;FindRow(&amp;sres, BOOKMARK_BEGINNING, 0);

      // we have a match
      hr = lpProfileTable-&gt;QueryRows(1,0,&amp;pRow);
      if (SUCCEEDED(hr))
      {
         lpDisplayName = pRow-&gt;aRow[0].lpProps[0].Value.lpszA;
      }
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: Default Profile MAPILogonEx<BR>
Keywords          : EMAPI<BR>
Version           : WINDOWS:1.0<BR>
Platform          : WINDOWS<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 3, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
