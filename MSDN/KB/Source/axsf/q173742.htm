

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>BUG: Global.asa Not Executed If Restricting Web Access </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q173742">
<META NAME="KBModify" CONTENT="1997/12/11">
<META NAME="KBCreate" CONTENT="1997/09/11">
<META NAME="Keywords" CONTENT="VIASP kbcode">
<META NAME="KBArea" CONTENT="Support; KB; axsf">
<META NAME="Description" CONTENT="  Session variables initialized in Global.asa's Session_onStart are empty when access to the Web requires authentication, even though the user has sufficient permissions to access the Web site. There are many possible error messages associated with t...">
<META NAME="Product" CONTENT="Active Server Pages">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ActiveX ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDH9,QA9N,QDNQ,QANG,QA7H,QAVZ,QBWA,QBVV,QASB,QBWG,QBWP,QABI,QAK7,QA56,QA55 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Global.asa Not Executed If Restricting Web Access</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 11, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q173742</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Active Server Pages, versions 1.0, 1.0b
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Session variables initialized in Global.asa's Session_onStart are empty
when access to the Web requires authentication, even though the user has
sufficient permissions to access the Web site. There are many possible
error messages associated with this behavior; however, here's the most
common:
<P>
<PRE>   Microsoft OLE DB Provider for ODBC Drivers error '80004005'

   [Microsoft][ODBC Driver Manager] Data source name not found and no
   default driver specified

   /&lt;web name&gt;/&lt;asp filename&gt;.asp, line xx

</PRE>NOTE: This problem applies to Microsoft Internet Information Server on
Windows NT with NTFS. This does not apply to virtual roots hosted on an FAT
partition or Personal Web Server on Windows 95.
<P>
<P><h2>CAUSE</h2>
 
<P>
Active Server Pages (ASP) requires Anonymous access to Global.asa
regardless of the authentication process.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To fix this behavior, change the NTFS permissions on the Global.asa file to
give the Anonymous Logon account -- as defined in the "Internet Service
Manager" -- Read (RX) permissions. For instructions on setting file
permissions, see Windows NT Help.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article. We are researching this bug and will post
new information here in the Microsoft Knowledge Base as it becomes
available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Create a new project in Visual InterDev. If you are not using Visual
   InterDev, create a new virtual root in the "Internet Service Manager."

<P><LI>Create a new .asp file and copy the following code into the file. Save
   the file. If you are not using Visual InterDev, copy the file to your
   virtual root folder.
<P>
<P><PRE>      ========Copy below this line==================
      &lt;%@ LANGUAGE="VBSCRIPT" %&gt;
</PRE><P>
<P><PRE>      &lt;HTML&gt;
      &lt;HEAD&gt;
      &lt;META NAME="GENERATOR" Content="Microsoft Visual InterDev 1.0"&gt;
      &lt;META HTTP-EQUIV="Content-Type" content="text/html;
       charset=iso-8859-1"&gt;
      &lt;TITLE&gt;Document Title&lt;/TITLE&gt;
      &lt;/HEAD&gt;
      &lt;BODY&gt;
</PRE><P>
<P><PRE>      &lt;%x=Session("session_var")
      if x &lt;&gt;"" then
<PRE></PRE>         response.write "Global.asa was executed.&lt;br&gt; Session_var="&amp;x
      else
         response.write "Global.asa was NOT executed.&lt;br&gt; Session_var="&amp;x
      end if%&gt;

      &lt;/BODY&gt;
      &lt;/HTML&gt;
      ======Copy above this line============

</PRE><P><LI>Copy the following code into your "Global.asa" file. Save the file. If
   you are not using Visual InterDev, create a new file named "Global.asa."
   Copy and paste the following code into the file, and copy the file to
   the virtual root folder. Save the file.
<P>
<P><PRE>      ========Copy below this line==================
      SCRIPT LANGUAGE="VBScript" RUNAT="Server"&gt;
<PRE></PRE>      Sub Session_OnStart

         Session("session_var")="Hello"

      End Sub
      &lt;/SCRIPT&gt;

      ======Copy above this line============

</PRE><P><LI>Restrict permissions on the Web. To do this, first explore out to your
   virtual root folder. Next, right-click the folder and click "Properties"
   from the Shortcut menu. Next, click the Security tab and click
   Permissions. From the Directory Permissions dialog box, remove
   "Everyone" (if present) and the "Internet Guest Account" from the Name
   list. Next, make sure the "Replace Permissions on Existing Files" check
   box is selected. Finally, click OK.

<P><LI> Preview the file -- in a browser -- created in step 2.
<P>
</OL>Result: The Web page does not display the value of the session variable
initialized in Global.asa.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For the latest Knowledge Base artices and other support information on
Visual InterDev and Active Server Pages, see the following page on the
Microsoft Technical Support site:
<P>
<PRE>   <B><A HREF="http://support.microsoft.com/support/vinterdev/">http://support.microsoft.com/support/vinterdev/</A></B>

</PRE></OL> 
<PRE>Keywords          : VIASP kbcode
Technology        : kbInetDev
Version           : WINNT:1.0,1.0b
Platform          : winnt
Issue type        : kbbug</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 11, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
