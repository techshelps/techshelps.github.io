

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>BUG: JavaTLB Generates Invalid Classes for MFC Server </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q165550">
<META NAME="KBModify" CONTENT="1998/01/29">
<META NAME="KBCreate" CONTENT="1997/03/21">
<META NAME="Keywords" CONTENT="JCOM kbbuglist">
<META NAME="KBArea" CONTENT="Support; KB; java">
<META NAME="Description" CONTENT="  Using JavaTLB on the TLB files created from MFC ClassWizard generated ODL code generates class files that give the following run-time error:     ERROR:java.lang.ClassFormatError  CAUSE =====  This happens only when you add automation methods to you...">
<META NAME="Product" CONTENT="java">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBXF,QAPN,QA2K,QAH4,QAY2,QBWS,QABO,QAVX,QAVW,QAGI,QABA,QBS0,QA9Q,QATX,QAP2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: JavaTLB Generates Invalid Classes for MFC Server</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 29, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q165550</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual J++, version 1.0, 1.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Using JavaTLB on the TLB files created from MFC ClassWizard generated ODL
code generates class files that give the following run-time error:
<P>
<PRE>   ERROR:java.lang.ClassFormatError

</PRE><h2>CAUSE</h2>
 
<P>
This happens only when you add automation methods to your MFC Automation
Server (via ClassWizard) that take parameters of pointer type like BSTR*,
long*.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
The workaround is to modify the generated .odl file with [in,out]
attributes on the automation methods that take pointer type arguments:
<P>
<PRE>   methods:
   // NOTE - ClassWizard will maintain method information here.

   // Use extreme caution when editing this section.

   //{{AFX_ODL_METHOD(PtrTest)
      [id(1)] void TestBstr([in,out]BSTR* arg1);
      [id(2)] void TestLong([in,out]long* arg1);
   //}}AFX_ODL_METHOD

</PRE>This allows JavaTlb to generate a valid class file, and the server works as
expected when called from Java or Visual Basic.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the Microsoft products
listed at the beginning of this article. We are researching this problem
and will post new information here in the Microsoft Knowledge Base as it
becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Generate a default MFC AppWizard application, selecting OLE automation
   support.

<P><LI>Add an Automation method (using Class Wizard, OLE Automation tab) that
   takes a parameter of type "BSTR *" or "long *".

<P><LI>Build the MFC project, and run it once to register.

<P><LI>From the command-line, run JAVATLB /U:T on the .TLB file for the
   Server. This creates Java class files with information about the
   COM interfaces and methods. You need to run JAVATLB from the
   command-line, because running Java Type Library wizard doesn't list MFC
   Automation Server's Type Library, from within the IDE.

<P><LI>Create a Java project and include the following code to call into OLE
   server:
<P>
<PRE>      import server.*;    //this is generated by running JAVATLB on the
                            server's .TLB.

      class test
      {
        public static void main(String args[])
        {
      System.out.println("\nStarting test...\n");
           IPtrTest ptrTest = (IPtrTest) new PTRTEST();

      String[] strParam = new String[1];
      //int[] intParam = new int[1];
      ptrTest.TestBstr(strParam);   //Calling the automation method
      }
      }

</PRE><P><LI>Build the Java code and execute the application.

<P><LI>If this is the first time you have run the application, Developer Studio
   prompts you for the name of the class.

<P><LI>This Java code gives the ClassFormatError as soon as it tries to
   load.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
For the latest Knowledge Base articles and other support information on
Visual J++ and the SDK for Java, see the following page on the Microsoft
Technical Support site:
<P>
<PRE>   <B><A HREF="http://support.microsoft.com/support/visualj/">http://support.microsoft.com/support/visualj/</A></B>
   <B><A HREF="http://support.microsoft.com/support/java/">http://support.microsoft.com/support/java/</A></B>
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: bstr* COM
<P>

Keywords          : JCOM kbbuglist<BR>
Technology        : kbInetDevkbole<BR>
Version           : 1.0 1.1<BR>
Platform          : WINDOWS<BR>
Issue type        : kbbug<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 29, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
