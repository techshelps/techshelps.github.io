

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>SMS Despooler Does Not Support Forced Installation and Upgrade </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q128458">
<META NAME="KBModify" CONTENT="1997/04/23">
<META NAME="KBCreate" CONTENT="1995/11/14">
<META NAME="Keywords" CONTENT="kbbug1.10 kbfix1.20 kbnetwork smsdespooler">
<META NAME="KBArea" CONTENT="Support; KB; sms">
<META NAME="Description" CONTENT=" SYMPTOM  The Systems Management Server Despooler does not support forced installation and upgrade of package directories on Windows NT distribution servers.  STATUS ======  Microsoft has confirmed this to be a problem in Systems Management Server ve...">
<META NAME="Product" CONTENT="Systems Management Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA63,QAH6,QBXB,QATJ,QAFI,QAXB,QAKC,QADN,QAA1,QBWP,QAGU,QABA,QACE,QAC1,QAU3 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>SMS Despooler Does Not Support Forced Installation and Upgrade</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 23, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q128458</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft Systems Management Server version 1.1
</UL> 
<P>
<P><h2>SYMPTOM</h2>
 
<P>
The Systems Management Server Despooler does not support forced
installation and upgrade of package directories on Windows NT distribution
servers.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Systems Management Server
version 1.1. This problem has been corrected in Systems Management Server
version 1.2.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The Systems Management Server Despooler now supports forced installation
and upgrade of package directories on Windows NT distribution servers.
<P>
At each Systems Management Server site, the Systems Management Server
Despooler installs and updates package directories on distribution servers
that are specified in the Distribution Phase of Run Command On Workstation
and Share Package On Server jobs. When a package is distributed using these
types of jobs, the Despooler installs the files for the package on a shared
directory on each distribution server specified by the job. If the some or
all of the files already exist in the package directory (that is, the files
were installed by the Despooler during a previous job or the files simply
already existed in the shared directory), the Despooler attempts to update
those files.
<P>
In Systems Management Server 1.0 and 1.1, the Systems Management Server
Despooler copied each file in the package to the package directory on each
distribution server. If any of the files within the package directory were
locked by a user accessing the file, the Despooler would stop the file
copying process at that particular file and then retry at a set time
interval for a set number of retries. In this case, the package directory
would contain some files that have been updated but the locked file would
block the rest of the files from being updated. If one or more files
continued to be locked when the Despooler reached the retry limit, then the
package directory would not be updated completely and the Despooler would
report the servers installation status as failed. Even if the package
directory was successfully updated over time, this delay may be
unacceptable.
<P>
With Systems Management Server 1.2, you can enable forced delivery of the
package files on Windows NT distribution servers--even if one or more files
in the package directory are locked. You enable this feature through the
Windows NT registry of the site server. By default, this feature is
disabled.
<P>
If the forced delivery feature is enabled, the Despooler checks for any
open files in the package directory (as well as any subdirectories within
the package directory) on the distribution server. If one or more files are
open, the Despooler determines whether it should force the installation of
the package files--based on the Number of Retries Before Forced
Disconnection entry in the registry. If the count of retries is less than
the Number of Retries Before Forced Disconnection entry, the Despooler
waits for the time specified by the retry interval (retry interval is 24
times the Despooler polling interval).
<P>
If the Despooler detects that current count of retries has exceeded the
Number of Retries Before Forced Disconnection entry in the registry, the
Despooler revokes access to the package directory from all users except the
Systems Management Server service account (this allows current users who
are connected to maintain access but prevents new users from connecting to
the package directory) and sends a a disconnection warning message to all
users who have files open in the package directory.
<P>
This message tells the user that they should close all applications running
from the package directory and close all files open on the package
directory and that Systems Management Server will close access to the
package directory after the length time specified in the Forced
Disconnection Delay In Minutes entry. After the Forced Disconnection Delay
In Minutes time has elapsed, the Despooler closes the package directory for
all users who still have files open. The Despooler then copies the package
files and restores access to the package directory. Finally, the Despooler
sends a message to the users who were previously sent the disconnection
warning message. This message informs the users that the package directory
is ready for access again.
<P>
The following rules apply to the forced delivery setting:

<UL><LI>Settings for forced delivery apply only to the sites whose site server
   registries you have configured for forced delivery. For example, if you
   have five sites and you want to enable forced delivery on each site, you
   must set the forced delivery settings in the registry of the site
   servers in each of the five sites.

<LI>Settings for forced delivery apply to target sites (that is, sites that
   receive the package). For example, if you created a job at Site A to
   distribute a package to Site B and Site A had forced delivery enabled
   and Site B did not, forced delivery would have no effect on that job.
   However, if you created the same job and Site A did not have forced
   delivery enabled and Site B did, forced delivery would be effect in
   effect on that job.

<LI>Settings for forced delivery apply to all Run Command On Workstation and
   Share Package On Server jobs at target sites where forced delivery is
   enabled. Forced delivery does not affect Remove Package From Server jobs
   or System jobs.
<P>
</UL>To set forced delivery:

<OL><P><LI>At the site server of the site where you want to set forced delivery,
   start the Windows NT Registry Editor.

<P><LI>Open the following key under the HKEY_LOCAL_MACHINE subtree:
<P>
<P><PRE>      \SOFTWARE\Microsoft\SMS\Components\SMS_Despooler
</PRE>
<P><LI>Turn on forced delivery by setting Use Forced Disconnect to 1.
<P>
   Use Forced Disconnect enables you to turn forced delivery on or off for
   the site. Note that 0 (zero) is off and 1 (or any other non-zero value)
   is on.

<P><LI>Set the number of retries after which the Despooler forces the package
   delivery by setting Number Of Retries Before Forced Disconnection.
<P>
   Number Of Retries Before Forced Disconnection enables you to specify the
   number of times after which the Despooler will force user to disconnect
   from the package directory and then update the package files. This value
   specifies the number of retries. The default is 12.

<P><LI>Set the number of minutes after which the Despooler forces all users to
   disconnect from the package directory by setting Forced Disconnection
   Delay In Minutes.
<P>
   Forced Disconnection Delay In Minutes enables you to specify the number
   of minutes after which the Despooler will force all users to disconnect
   from the package directory. The default is 5.

<P><LI>To force the Despooler to use the new settings, use the Systems
   Management Server Service Manager to pause and continue the
   SMS_DESPOOLER component.
<P>
</OL><h3>Calculating the Forced Delivery Time</h3>
 
<P>
Use the following formula to calculate how much time will elapse after the
first failed attempt to update a package directory on a distribution
server:
<P>
<PRE>   ForceDeliveryTime = (x * (y + 1))+ z
   x = Despooler Retry Interval
   y = Number Of Retries Before Forced Disconnection
   z = Forced Disconnection Delay In Minutes

</PRE></OL>Note that Despooler Retry Interval is based on the Response setting for the
services at the site:
<P>
<PRE>   Response     Retry Interval(Minutes)
   ------------------------------------
   Very Fast     24
   Fast         120
   Medium       360
   Slow         720

</PRE>For Example, suppose your site was running at Fast Response mode and you
made the following settings:
<P>
<PRE>   Use Forced Disconnect equal to 1.
   Number Of Retries Before Forced Disconnection equal to 10.
   Forced Disconnection Delay In Minutes equal to 5.

</PRE>This means that after the Despooler retries updating a package 10 times, it
sends a message to users with open files on the package directory. After 5
minutes, the Despooler disconnects all users and updates the package.
The total time elapsed from the first attempt to update the package is
approximately 22 hours and 5 minutes. 22 hours and 5 minutes = (120 minutes
* (10 retries + 1)) + 5 minutes.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodsms sms<BR>
Keywords            : kbbug1.10 kbfix1.20 kbnetwork smsdespooler<BR>
Version             : 1.1 1.2<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 23, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
