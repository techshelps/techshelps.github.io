

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>SMS: Dos4gw.exe Causes Memory Inventory Inaccuracy </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q160000">
<META NAME="KBModify" CONTENT="1997/04/15">
<META NAME="KBCreate" CONTENT="1996/11/26">
<META NAME="Keywords" CONTENT="kb3rdparty kbenv kbinterop kbusage smsgeneral">
<META NAME="KBArea" CONTENT="Support; KB; sms">
<META NAME="Description" CONTENT="  MS-DOS clients that run the DOS extender Dos4gw.exe before Systems Management Server hardware inventory is collected may result in unlikely extended memory values in client inventory. For example, an MS-DOS client with 32 MB of memory that runs Dos...">
<META NAME="Product" CONTENT="Systems Management Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAI4,QBW6,QDJD,QAWH,QAGB,QARL,QADP,QDKW,QBWS,QAGF,QBVV,QAAW,QBW7,QAI5,QAFY V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>SMS: Dos4gw.exe Causes Memory Inventory Inaccuracy</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 15, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q160000</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Systems Management Server, versions 1.0 and 1.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
MS-DOS clients that run the DOS extender Dos4gw.exe before Systems
Management Server hardware inventory is collected may result in unlikely
extended memory values in client inventory. For example, an MS-DOS client
with 32 MB of memory that runs Dos4gw.exe in the Autoexec.bat (before
hardware inventory is collected) may report 64 MB of extended memory in
client inventory.
<P>
<P><h2>CAUSE</h2>
 
<P>
Memory inventory is incorrect because Dos4gw.exe is not closing high memory
area (HMA) handles it uses to access XMS memory. Dos4gw.exe opens HMA
handles to access XMS memory managed by the resident A20 handler (such as
Himem.sys).
<P>
Systems Management Server memory inventory is collected by summing the
total amount of memory in use by the available HMA memory handles. In this
case, Dos4gw.exe is not closing some HMA handles when it quits, leaving two
handles still allocated. In the 32 MB client example Dos4gw.exe opens a
handle for 516K, and another for 30,440K. When Dos4gw.exe exits, it does
not close its HMA handles; when Systems Management Server inventory sums
them with the default handles in use (totaling 31,680K), the extended
memory value is reported incorrectly as 62,636K.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To work around this problem, run Dos4gw.exe after the Systems Management
Server hardware inventory has been collected.
<P>
<P><h2>STATUS</h2>
 
<P>
The products included here are manufactured by vendors independent of
Microsoft; we make no warranty, implied or otherwise, regarding these
products' performance or reliability.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following table is the combined results of a test application, showing
Dos4gw.exe failing to close HMA handles 11 and 12 after closing:
<P>
<PRE>Before Dos4gw     After Dos4gw
</PRE> 
<PRE>Handle  0 = 344   Handle 0 = 344
Handle  1 = 1     Handle 1 = 1
Handle  2 = 8     Handle 2 = 8
Handle  3 = 7     Handle 3 = 7
Handle  4 = 10    Handle 4 = 10
Handle  5 = 5     Handle 5 = 5
Handle  6 = 6     Handle 6 = 6
Handle  7 = 12    Handle 7 = 12
Handle  8 = 6     Handle 8 = 6
Handle  9 = 65    Handle 9 = 65
</PRE>Handle 10 = 31216 Handle 10 = 31216
<PRE>Handle 11 = 0     Handle 11 = 516
Handle 12 = 0     Handle 12 = 30440
Handle 13 = 0     Handle 13 = 0
Handle 14 = 0     Handle 14 = 0
Handle 15 = 0     Handle 15 = 0
Handle 16 = 0     Handle 16 = 0
Handle 17 = 0     Handle 17 = 0
Handle 18 = 0     Handle 18 = 0
Handle 19 = 0     Handle 19 = 0
Handle 20 = 0     Handle 20 = 0
Handle 21 = 0     Handle 21 = 0
Handle 22 = 0     Handle 22 = 0
Handle 23 = 0     Handle 23 = 0
Handle 24 = 0     Handle 24 = 0
Handle 25 = 0     Handle 25 = 0
Handle 26 = 0     Handle 26 = 0
Handle 27 = 0     Handle 27 = 0
Handle 28 = 0     Handle 28 = 0
Handle 29 = 0     Handle 29 = 0
Handle 30 = 0     Handle 30 = 0
Handle 31 = 0     Handle 31 = 0
Total     = 31680 Total     = 62636
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words:<BR>
Keywords            : kb3rdparty kbenv kbinterop kbusage smsgeneral<BR>
Version             : 1.0 1.1<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 15, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
