

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>MSMAIL32 Error Occurs When Data is Cached Across Bad Link </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q143413">
<META NAME="KBModify" CONTENT="1997/11/12">
<META NAME="KBCreate" CONTENT="1996/02/01">
<META NAME="Keywords" CONTENT="ntutil kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  When you send a mail message using MSMAIL32.EXE in Windows NT, the following error message appears:     [023] Message was not delivered: message file was corrupted.  CAUSE =====  This problem occurs due if the following conditions are met:   - The ...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QAYC,QAB4,QAYY,QAAP,QAXB,QAO4,QANN,QAAW,QAH6,QAVZ,QAR4,QAL0,QAK0,QAGI V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>MSMAIL32 Error Occurs When Data is Cached Across Bad Link</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 12, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q143413</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Server versions 3.5 and 3.51
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you send a mail message using MSMAIL32.EXE in Windows NT, the
following error message appears:
<P>
<PRE>   [023] Message was not delivered: message file was corrupted.

</PRE><h2>CAUSE</h2>
 
<P>
This problem occurs due if the following conditions are met:

<UL><LI>The Windows NT redirector write-behind caching mechanism is enabled.

<LI>The network connection is across an inconsistent WAN link.
<P>
</UL><h2>RESOLUTION</h2>
 
<P>
To correct this problem:
<P>
WARNING: Using Registry Editor incorrectly can cause serious, system-wide
problems that may require you to reinstall Windows NT to correct them.
Microsoft cannot guarantee that any problems resulting from the use of
Registry Editor can be solved. Use this tool at your own risk.

<OL><P><LI>Start Registry Editor (REGEDT32.EXE) and locate the following Registry
   subkey in the HKEY_LOCAL_MACHINE subtree:
<P>
   \SYSTEM\CurrentControlSet\Services\Rdr\Parameters

<P><LI>From the Edit menu, select Add Value.

<P><LI>Enter the following:
<P>
<P><PRE>      Value Name: UseWriteBehind
      Data Type:  REG_DWORD
<PRE></PRE>      String:     0

</PRE><P><LI>Choose OK and quit the Registry Editor.

<P><LI>Shut down and restart Windows NT.
<P>
</OL><h2>MORE INFORMATION</h2>
 
<P>
If the Windows NT caching mechanism is enabled and a file is open with
read and write privileges, the Windows NT redirector and Windows NT Cache
Manager performs a file write-behind caching. During this process, data is
copied from the buffer to the local cache and the application (MSMAIL32)
is notified that the writing is complete. When Cache Manager flushes the
cached data (after 1 to 3 seconds), the redirector uses the data to write
Server Message Block (SMB) requests.
<P>
The redirector sends the write-behind cached data if one of the following
conditions are met:

<UL><LI>The application closes the file

<LI>The file can no longer be cached

<LI>The application calls the FlushFileBuffers command

<LI>The redirector uses 3 write-behind buffers for the file
<P>
</UL>When the MSMAIL32 sends mail across an inconsistent WAN link, the
following occurs:

<OL><P><LI>MSMAIL32 locks the local mailbag file.

<P><LI>MSMAIL32 reads the local key and *.MBG file.

<P><LI>MSMAIL32 opens the remote INQUEUE3.MBG and INQUEUE3.KEY files.

<P><LI>MSMAIL32 writes to the remote Postoffice file.

<P><LI>MSMAIL32 updates INQUEUE3.MBG and INQUEUE3.KEY and closes them.

<P><LI>MSMAIL32 updates the local *.KEY and *.MBG files.

<P><LI>MSMAIL32 removes locks for the local mailbag file.
<P>
</OL>Since the redirector uses the write-behind-cached data, it returns to
application before the data is completely written to the remote postoffice
file. This closes the remote INQUEUE3.KEY file, which enables the remote
MSMAIL32 application to check for new mail. However, the postoffice file
is still open due to the incomplete transfer of data. This occurs when
there is an inconsistent WAN link.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodnt<BR>
Keywords          : ntutil kbnetwork<BR>
Version           : 3.5 3.51<BR>
Platform          : winnt<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 12, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
