

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Service Packs on Compaq MPS Systems May Cause System Hangs </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q162250">
<META NAME="KBModify" CONTENT="1997/11/26">
<META NAME="KBCreate" CONTENT="1997/01/16">
<META NAME="Keywords" CONTENT="nthw NTSrvWkst kb3rdparty kbhw">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  After you install a Windows NT 4.0 Service Pack on a Dual Processor Compaq System with a Compaq SSD installed, the computer may stop responding at the Windows NT logon screen, without displaying any error messages.  CAUSE =====  The Compaq SSD was ...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QAA1,QDI2,QDO3,QAY2,QDNN,QAIJ,QDIZ,QBXT,QA5V,QAR4,QAIB,QBXB,QATJ,QAM0 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Service Packs on Compaq MPS Systems May Cause System Hangs</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 26, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q162250</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation version 4.0
<LI>Microsoft Windows NT Server version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
After you install a Windows NT 4.0 Service Pack on a Dual Processor Compaq
System with a Compaq SSD installed, the computer may stop responding at the
Windows NT logon screen, without displaying any error messages.
<P>
<P><h2>CAUSE</h2>
 
<P>
The Compaq SSD was used to upgrade the system to a multiprocessor system.
The SSD correctly installs the files required for multiprocessing support,
but incorrectly modifies the line in the Setup.log file that refers to the
Hal.dll file. The Hal.dll line references the single processor version of
the Hal.dll file, while the NTOSKRNL line references the multiprocessor
version of the kernel. As a result, the Windows NT service pack installs
the multiprocessor kernel file, and the single processor version of the
Hal.dll file. When the system restarts after the service pack installation,
the Windows NT kernel load screen reports 1 system processor;
Multiprocessor Kernel. Windows NT continues loading, but will stop
responding at the logon screen without any errors.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Prior to installing the service pack:
<P>
Manually edit the Setup.log file located in %SystemRoot%\Repair to reflect
the following changes:
<P>
On a Compaq Proliant 4500 or other System Pro Compatible System
<PRE>   Original Line
   \winnt\system32\hal.dll = "\HAL.DLL","f337"

</PRE>Modify this line to the following:
<PRE>   \winnt\system32\hal.dll = "halsp.dll"."f337"

</PRE>On a Compaq Proliant 1500, 5000 or other MPS Compatible System
<PRE>   Original Line
   \winnt\system32\hal.dll = "\HAL.DLL","1a01c"

</PRE>Modify this line to the following:
<PRE>   \winnt\system32\hal.dll = "halmps.dll"."1a01c"

</PRE>After installing the service pack, perform the following steps:
<P>
<P><h3>If Windows NT is installed on a FAT Partition</h3>
 

<OL><P><LI>Start the computer with a DOS disk.

<P><LI>On a Proliant 4500 or other System Pro Compatible computer, manually
   copy the Halsp.dll file from Service Pack 2 to
   %SystemRoot%\System32\Hal.dll.
<P>
   On a Proliant 1500, 5000, or other MPS Compatible computer, manually
   copy the Halmps.dll file from Service Pack 2 to
   %SystemRoot%\System32\Hal.dll.

<P><LI>The computer should start normally now.

<P><LI>To prevent the problem from happening in the future, follow the
   earlier steps to modify the Setup.log in the repair directory. You must
   also change the file checksum from f337 to 1b36e, or from 1a01c to
   125d8.
<P>
</OL><h3>If Windows NT is installed on an NTFS partition</h3>
 

<OL><P><LI>Perform a second installation of Windows NT in a different
   directory.

<P><LI>After the installation is complete, start the second installation and
<P>
   On a Proliant 4500 or other System Pro compatible computer, manually
   copy the Halsp.dll file from Service Pack 2 to the original
   %SystemRoot%\System32\Hal.dll directory.
<P>
   On a Proliant 1500, 5000, or other MPS compatible computer, manually
   copy the Halmps.dll file from Service Pack 2 to the original
   %SystemRoot%\System32\Hal.dll directory.

<P><LI>Restart the original installation of Windows NT.

<P><LI>Delete the second installation of Windows NT.

<P><LI>To prevent the problem from happening in the future, follow the
   earlier steps to edit the Setup.log file in the repair directory. You
   must also change the file checksum from f337 to 1b36e, or from 1a01c to
   125d8.
<P>
</OL>As an alternative to a second installation, you can modify the contents of
the emergency repair disk (ERD) by performing the following steps:

<OL><P><LI>Remove the attributes from the Setup.log file by typing the
   following at the command-line prompt:
<P>
<P><PRE>      attrib -r -h -s a:\SETUP.LOG
</PRE>
<P><LI>In the Setup.log file, add the following line to the files.WinNt
   section:
<P>
<P><PRE>      On a Proliant 4500 or other System Pro compatible computer:
      \Winnt\System32\hal.dll = "halsp.dll","f337","\",
      (continued line)  "nt351 repair disk","halsp.dll"
</PRE><P>
<P><PRE>      On a Proliant 1500, 5000, or other MPS compatible computer:
      \Winnt\System32\hal.dll = "halmps.dll","1a01c","\",
      (continued line)  "nt351 repair disk","halmps.dll"
</PRE><P>
   NOTE: \Winnt represents the directory where Windows NT is installed.

<P><LI>Copy the Halmps.dll or Halsp.dll file from the Windows NT 4.0 service
   pack source media to the root directory of the ERD.

<P><LI>Restart your computer with the three Windows NT 3.51 Setup disks.

<P><LI>Select R to Repair your Windows NT.

<P><LI>Select only "Verify Windows NT System Files" and continue.

<P><LI>If prompted to insert Windows NT setup disk #4, press ESC to
   continue with the Repair process.

<P><LI>After you replace the Hal.dll file with the file from the Windows NT 4.0
   service pack, press F3 to exit Repair. Restart the computer, and
   then restart Windows NT.

<P><LI>To prevent the problem from happening in the future, follow the earlier
   steps to edit the Setup.log file in the repair directory. Also, you must
   change the file checksum from "f337" to "1b36e" for Halsp.dll, or from
   "1a01c" to "125d8" for Halmps.dll.
<P>
</OL>The third-party products discussed here are manufactured by Compaq, a
vendor independent of Microsoft; we make no warranty, implied or
otherwise, regarding these products' performance or reliability.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: compaq hang complete frozen freeze<BR>
Keywords          : nthw NTSrvWkst kb3rdparty kbhw<BR>
Version           : WinNT:4.0<BR>
Platform          : winnt<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 26, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
