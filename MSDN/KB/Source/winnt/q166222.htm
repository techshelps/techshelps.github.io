

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Dlc.sys Sends Frame Reject (FRMR) and Drops Connection </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q166222">
<META NAME="KBModify" CONTENT="1997/05/20">
<META NAME="KBCreate" CONTENT="1997/04/01">
<META NAME="Keywords" CONTENT="kbbug4.00 kbfix4.00 kbfix4.00.sp2 NTSrvWkst prodsna kbnetwork kbbuglist kbfixlist">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  On Windows NT, when you run an application that uses Dlc.sys to communicate to a remote system using DLC/802.2 over Token Ring, Ethernet, or FDDI, Windows NT may erroneously send a frame reject (FRMR) and drop the connection.  If SNA Server is bein...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QAI4,QDN1,QBFY,QBG2,QAI5,QAIA,QAIB,QA3S,QAH6,QDO3,QAM9,QALX,QAPN,QAO4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Dlc.sys Sends Frame Reject (FRMR) and Drops Connection</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 20, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q166222</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT 3.51 (SP1-SP5)
<LI>Microsoft Windows NT 4.0  (SP1, SP2)
<LI>Microsoft SNA Server for Windows NT, versions 2.0, 2.1, 2.11, 3.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
On Windows NT, when you run an application that uses Dlc.sys to communicate
to a remote system using DLC/802.2 over Token Ring, Ethernet, or FDDI,
Windows NT may erroneously send a frame reject (FRMR) and drop the
connection.
<P>
If SNA Server is being used, this will cause an SNA Server connection
failure with the following Windows NT application event log entries:
<P>
<PRE>   Event 228: SNA Server
   FRMR sent (0x03) = invalid or unsupported command/response received

   Event 238: SNA Server
   Connection &lt;name&gt; statistics

   Event 23, SNA Server
   Connection &lt;name&gt; using Link Service &lt;SNADLCx&gt; failed Qualifier = 00AC

</PRE>When this occurs, all SNA sessions using this connection will be lost.
<P>
The following excerpt from a network monitor trace illustrates the
reproduction scenario:
<P>
Frame Src MAC  Dst MAC  Description
<P>
<PRE>1     SNASRV   HOST     I DSAP=0x04 SSAP=0x04 C N(S) = 0x07, N(R) = 0x1A
2     SNASRV   HOST     I DSAP=0x04 SSAP=0x04 C N(S) = 0x08, N(R) = 0x1A
3     SNASRV   HOST     I DSAP=0x04 SSAP=0x04 C N(S) = 0x09, N(R) = 0x1A
4     SNASRV   HOST     I DSAP=0x04 SSAP=0x04 C N(S) = 0x0A, N(R) = 0x1A
5     SNASRV   HOST     I DSAP=0x04 SSAP=0x04 C N(S) = 0x0B, N(R) = 0x1A
6     SNASRV   HOST     I DSAP=0x04 SSAP=0x04 C N(S) = 0x0C, N(R) = 0x1A
7     SNASRV   HOST     I DSAP=0x04 SSAP=0x04 C N(S) = 0x0D, N(R) = 0x1A
8     SNASRV   HOST     I DSAP=0x04 SSAP=0x04 C N(S) = 0x0E, N(R) = 0x1B
POLL
9     HOST     SNASRV   RR DSAP=0x04 SSAP=0x05 R N(R) = 0x07 FINAL
10    SNASRV   HOST     I DSAP=0x04 SSAP=0x04 C N(S) = 0x07, N(R) = 0x1B
POLL
11    HOST     SNASRV   I DSAP=0x04 SSAP=0x04 C N(S) = 0x1B, N(R) = 0x07
12    HOST     SNASRV   RR DSAP=0x04 SSAP=0x05 R N(R) = 0x08
13    HOST     SNASRV   RR DSAP=0x04 SSAP=0x05 R N(R) = 0x09
14    SNASRV   HOST     FRMR DSAP=0x04 SSAP=0x05 R

</PRE><h2>CAUSE</h2>
 
<P>
Windows NT Dlc.sys was incorrectly handling acknowledgements for I-frames
when the t1 send timer has expired on a DLC connection.
<P>
In the above trace of LLC frames, SNA Server sends a window of I-frames to
the host from frame 1-8, with the N(S) counter incremented from 0x07-0x0E.
The host then replies with a N(R) of 0x07, causing SNA Server to reset its
N(S) counter and begin resending the I-frames again. However, SNA Server
then receives host acknowledgments for later frames (sending N(R) = 0x08
and 0x09 in frame 12 and 13 above). Because the Windows NT DLC driver
detects that the N(S) is now 0x07, DLC sends a frame reject (FRMR) to the
host, causing the connection to drop.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
It is possible to work around this problem by increasing the DLC t1 timer
so that it will never expire. If SNA Server is being used, the t1 timer can
be increased to a maximum value of 10 within the connection properties
dialog or folder within SNA Server 2.x Admin or SNA Server 3.x Manager.
<P>
An update to Dlc.sys is available to correct this problem. The Dlc.sys
driver now keeps track of a new maximum N(S) counter sent value and
validates I-frame acknowledgements based on this value
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Windows NT version 3.51
(SP1-SP5) and Windows NT 4.0 (SP1, SP2).
This problem was corrected in the latest Microsoft Windows NT 4.0 U.S. Service
Pack. For information on obtaining the service pack, query on the following word
in the Microsoft Knowledge Base (without the spaces):
<P>
<PRE>   S E R V P A C K
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 2.0 2.1 2.11 3.0 4.00 3.51 prodnt<BR>
Keywords          : kbbug4.00 kbfix4.00 kbfix4.00.sp2 NTSrvWkst prodsna kbnetwork kbbuglist kbfixlist<BR>
Version           : 3.51 4.0<BR>
Platform          : winnt<BR>
Issue type        : kbbug<BR>
Solution Type     : kbservicepack<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 20, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
