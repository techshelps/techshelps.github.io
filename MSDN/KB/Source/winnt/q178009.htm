

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Renaming a Domain: Process and Side Effects </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q178009">
<META NAME="KBModify" CONTENT="1998/01/28">
<META NAME="KBCreate" CONTENT="1997/12/11">
<META NAME="Keywords" CONTENT="NTSrv">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT=" WARNING: The information in this article has not been confirmed or tested by Microsoft. ANY USE BY YOU OF THE INFORMAITON PROVIDED IN THIS ARTICLE IS AT YOUR OWN RISK. Microsoft provides this information  as is  without warranty of any kind, either ...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA9A,QAUJ,QBWP,QBW3,QACK,QBVV,QBG2,QARM,QAA1,QBWO,QAK7,QAEF,QATQ,QAGU,QBWD V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Renaming a Domain: Process and Side Effects</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 28, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q178009</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Server versions 3.51 and 4.0
</UL> 
<P>
WARNING: The information in this article has not been confirmed or tested
by Microsoft. ANY USE BY YOU OF THE INFORMAITON PROVIDED IN THIS ARTICLE IS
AT YOUR OWN RISK. Microsoft provides this information "as is" without
warranty of any kind, either express or implied, including but not limited
to the implied warranties of merchantability and/or fitness for a
particular purpose.
<P>
<P><h2>SUMMARY</h2>
 
<P>
In Windows NT, a domain is uniquely identified by both a NetBIOS name and
by a Security Identifier (SID). Most Access Control Lists (ACLs) and other
security features of Windows NT identify the domain by a SID; therefore, it
is possible to change the name of the domain with little disruption to
network services.
<P>
The following procedure describes how to safely rename a Windows NT domain.
This will work for a single domain, or for an accounts domain or resource
domain in a network using the master domain model.
<P>
Please read this article in its entirety before attempting to rename your
domain. Some BackOffice products are adversely affected by renaming a
domain; these products are detailed later in this article.
<P>
Microsoft cannot guarantee that any third-party software that is installed
will function after changing the domain name. You should work with
third-party application vendors to ensure you understand how their product
will react to a domain name change.
<P>
Microsoft strongly recommends that you thoroughly test, outside of a
production environment, the effects of renaming your domain, before you
actually change the domain name on your production computers. This article
does not attempt to address every issue that might arise as a consequence
of renaming your domain.
<P>
Use this procedure at your own risk.
<P>
Important notes:

<UL><LI>Do not install any primary domain controller (PDC) or backup domain
   controller (BDC) during this procedure, under either the old or new
   domain name.

<LI>Do not promote any BDC to PDC during this procedure.

<LI>This procedure should only be undertaken during a time when ALL network
   services related to this domain can be disrupted. All clients should log
   off and remain logged off until the rename is complete and all computers
   involved have been restarted.

<LI>Perform a full backup on all computers involved immediately before
   beginning this process.

<LI>Create separate, updated Emergency Repair Disks for each computer
   involved immediately before and after the update.

<LI>Have a copy of the Windows NT Server compact disc, the latest service
   pack, and Windows NT boot disks (appropriate to your version of Windows
   NT) available during the procedure.

<LI>The NETDOM utility in the Windows NT Server Resource Kit, Supplement 2,
   can be used to change the domain name remotely on some computers,
   preventing a visit to each computer involved.
<P>
</UL><h2>MORE INFORMATION</h2>
 
<P>
To change a domain name, follow these steps:

<OL><P><LI>Document and then break all trust relationships between the domain whose
   name you will be changing and all other domains. Be sure to remove the
   trust entry on both sides of the trust (in User Manager for Domains for
   both domains in the trust).

<P><LI>Stop all BackOffice services such as Microsoft Exchange Server, SQL
   Server, and Internet Information Server. Set startup to manual on all
   these services.

<P><LI>Change the domain name on the PDC.

<P><LI>Restart the PDC. This will cause the &lt;1Bh&gt; entry for the new domain to
   appear in the WINS server.

<P><LI>If you are using WINS for NetBIOS over TCP/IP name resolution, force
   replication from the PDC's primary WINS server to all other WINS servers
   to propagate the &lt;1Bh&gt; entry for the new domain. Name resolution to the
   PDC is necessary for each BDC to successfully change to the new domain
   name. If you are using TCP/IP without using WINS, create an LMHOSTS file
   with a &lt;1Bh&gt; entry for the new domain and put it on each BDC.
<P>
   For additional information on this process, please see the following
   article in the Microsoft Knowledge Base:
<P>
<P><PRE>      Article-ID: <B><A HREF="../WINNT/Q129218.htm">Q129218</A></B>
<PRE></PRE>      Title     : How to Statically Initialize WINS with 0x1B for the PDC

</PRE><P><LI>On each BDC, change the domain name and restart. The restart is
   necessary for the BDC to correctly register its &lt;1Ch&gt; entry with WINS.
<P>
   For additional information if the BDC refuses the domain name change,
   please see the following article in the Microsoft Knowledge Base:
<P>
<P><PRE>      Article-ID: <B><A HREF="../WINNT/Q139471.htm">Q139471</A></B>
<PRE></PRE>      Title     : Unable to Change Domain Name of Windows NT BDC

</PRE><P><LI>Force replication from all WINS servers to propagate the &lt;1Ch&gt; entry.

<P><LI>Reestablish the trust relationships. Using Server Manager, synchronize
   both domains involved in each trust.

<P><LI>In the Services tool in Control Panel, re-enter the service account for
   each of the BackOffice services that were stopped in step 2. Pick the
   account by using the Startup button rather than typing in the account
   name. Set the services back to Automatic startup, if appropriate.
   Restart the services in the correct order.

<P><LI>Make any necessary service-specific changes, as detailed elsewhere in
   this article.

<P><LI>Change the domain name on each member server or workstation. For
   downlevel clients such as Windows 95 or Windows for Workgroups, change
   the workgroup name to the new domain name.

<P><LI>Synchronize the entire domain.
<P>
</OL><h3>Troubleshooting</h3>
 
<P>
If you encounter errors on any of the BDCs after the name change is
completed, the most likely causes will be either name resolution or
accounts database synchronization problems. The first thing you should do
to troubleshoot is to open Server Manager on the computer that has problems
and synchronize it with the PDC. For name resolution issues, make sure that
WINS has replicated or that your LMHOSTS files are correct.
<P>
You may encounter some errors in batch files and so on, with the old domain
name embedded. For this reason, you should check all such files. They are
likely to be found in the NETLOGON share on your domain controllers,
referenced by the Scheduler service where it is installed, and in any other
scripting or automation tools that you use.
<P>
You can find out more information about specific error events by searching
the Microsoft Knowledge Base for "event id XXXX" where XXXX is the event id
number of the error event. The Microsoft Knowledge Base is available on the
WWW at:
<P>
<PRE>   <B><A HREF="http://support.microsoft.com/support">http://support.microsoft.com/support</A></B>

</PRE></OL>If you encounter any problems after the domain name change, they are likely
related to the name change, especially if you see any of the following
errors:
<P>
<PRE>   Network name not found

</PRE>-or-
<P>
<PRE>   Error 53

</PRE>Typically, these are name resolution issues that are specific to one
computer. Check for the COMPUTERNAME&lt;00h&gt;, COMPUTERNAME&lt;03h&gt;, and
COMPUTERNAME&lt;20h&gt; entries in WINS, and replicate if necessary.
<P>
<PRE>   A domain controller for this domain could not be found.

</PRE>-or-
<P>
<PRE>   Unable to contact the domain controller for this domain.

</PRE>Typically, these are name resolution issues specific to the domain. Look
for the DOMAIN&lt;1Bh&gt; and DOMAIN&lt;1Ch&gt; entries in WINS, and replicate if
necessary.
<P>
<PRE>   The trust relationship failed.

</PRE>Typically, this is either a trust relationship with another domain that was
not re-established, or an invalid machine account. Reestablish the trust,
or delete and re-create the machine account for the computer and remove and
re-add the computer to the domain.
<P>
<P><h3>Possible Side Effects of a Domain Name Change</h3>
 

<UL><LI>Service accounts are stored textually, not as SIDs, in the Service
   Control Manager database. Therefore, any services, on any computer, that
   use domain user accounts as their service account will have to be
   manually adjusted. The Sc.exe utility from the Windows NT Server
   Resource Kit may be useful for making this change on remote computers.

<LI>If you are using integrated security in SQL Server, you will need to
   reset the "Default Domain" field in SQL Security Manager. Additionally,
   if the users are not part of the "Default Domain" you may need to remove
   and re-add users and groups from the renamed domain or local groups
   containing groups from the renamed domain.

<LI>Microsoft Exchange Server service accounts will need to be reassociated
   with the new domain name, as described earlier. Additionally, in the
   Exchange Administrator program, select Tools, select Options, and then
   click the Permissions tab, you will need to change the default Windows
   NT domain name to the new domain name.

<LI>Security settings on all Exchange Server public folders will be lost.
   Before renaming the domain, use the command line utility Pfadmin.exe to
   export the public folder security settings to a text file to make
   reconstruction of the permissions easier.

<LI>If Systems Management Server primary or secondary sites exist in the
   domain that is being renamed, Systems Management Server will have to be
   uninstalled and then reinstalled with the new domain name. You will not
   be able to restore the existing Systems Management Server database after
   reinstallation; you will have to start with a clean database.

<LI>If the domain being renamed is part of an Systems Management Server site
   but has no primary or secondary sites located in it (only logon servers
   and clients), the domain should be removed from the site prior to the
   name change and added back into the site after the change. Please refer
   to the Systems Management Server Installation and Configuration Manual,
   Chapter 3, "Adding Domains, Servers, and Clients."

<LI>If you are running Internet Information Server, you may need to change
   the account specified in virtual paths.
</UL> 
<PRE>Keywords          : NTSrv
Version           : WinNT:3.51,4.0
Platform          : winnt
Issue type        : kbinfo</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 28, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
