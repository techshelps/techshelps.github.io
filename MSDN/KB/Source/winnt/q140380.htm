

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>User Account Database Fails to Shrink after Deleting Accounts </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q140380">
<META NAME="KBModify" CONTENT="1997/03/18">
<META NAME="KBCreate" CONTENT="1995/11/29">
<META NAME="Keywords" CONTENT="kbsecurity kbusage">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  If a large number of users are added to a Windows NT User Account Database, and later deleted, the size of the User Account Database or Security Account Manager (SAM) does not shrink in size.  Windows NT does not have a mechanism to compress this e...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QA3W,QA9A,QDIU,QAUR,QA5V,QAGU,QBG2,QBW3,QAPN,QAMA,QAA1,QBFY,QAZV,QAJQ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>User Account Database Fails to Shrink after Deleting Accounts</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 18, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q140380</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.10 3.50 3.51
WINDOWS
kbusage
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT operating system version 3.1
<LI>Microsoft Windows NT Advanced Server version 3.1
<LI>Microsoft Windows NT Workstation versions 3.5, 3.51, and 4.0
<LI>Microsoft Windows NT Server versions 3.5, 3.51 and 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
If a large number of users are added to a Windows NT User Account
Database,
and later deleted, the size of the User Account Database or Security
Account Manager (SAM) does not shrink in size.
<P>
Windows NT does not have a mechanism to compress this empty space, but it
is reclaimed when new user or group accounts are created. When the Windows
primary domain controller synchronizes the SAM with the backup domain
controllers, the new records, or changes in existing records are sent. The
SAM is located in %SYSTEMROOT%\SYSTEM32\CONFIG\SAM.
<P>
If the SAM file grows too large, additional memory and PagedPoolSize is
needed to load the file at system boot, and to load applications such as
User Manager. For guidelines and additional information, please see the
following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../WINNT/Q130914.htm">Q130914</A></B>
   TITLE     : Number of Users and Groups Affects SAM Size of Domain

</PRE><h2>MORE INFORMATION</h2>
 
<P>
Although Windows NT has no built-in method of compressing the SAM
database,
there are three methods that can be used to effectively compress the SAM
on
a certain domain controller. The compressed SAM is NOT replicated to
backup
domain controllers since only new records, or changes in the records are
replicated. Therefore, measures will need to be applied at each Domain
Controller.
<P>
Method 1:  This method must be performed on a backup domain controller.
Use the ERD (Emergency Repair Disk) and select "Inspect registry files."
When prompted, choose "SECURITY (SecurityPolicy) and SAM (User Accounts
Database). This replaces the large SAM with the original one that was
created when Windows NT was installed on this machine. This requires the
Administrator password that was used when Windows NT was installed, or
when
RDISK -s was last used. After replacing the SAM, synchronize with the
primary domain controller. Promote a backup domain controller to become
primary domain controller to apply the above fix to the original primary
domain controller.
<P>
Method 2:  This is the most invasive method, and requires any services or
applications to be reinstalled. Install Windows NT onto the same machine
of
a backup domain controller as a "New Install".
<P>
This overwrites the large SAM, creating a new file and downloading the
accounts from the primary domain controller. This can be done to all of
the backup domain controllers. To re-install the primary domain
controller,
promote a backup to primary, and perform the same operation.
<P>
Method 3:  This method can be done on a backup or primary domain
controller. This method uses the utilities REGBACK and REGREST from the
Windows NT Resource Kit. Using REGBACK will copy the records from the SAM
into a new file. Restoring the SAM copies this new file over the old SAM.
You must reboot the computer after using REGREST to have the restore take
effect.
<P>
NOTE: After you back up the SAM using REGBACK, you can compare the two
files and determine the size of free space or extraneous information.
<P>
The net result is a compressed SAM database. As an example, the following
command lines could be used. These assume the BACKUP directory already
exists on drive C, and Windows NT is also installed on drive C (Windows NT
and the BACKUP directory must reside on the same logical disk):
<P>
<PRE>   C:\&gt;regback c:\backup\sam.bak machine sam

   -or-

   C:\&gt;regrest c:\backup\sam.bak c:\backup\sam.old machine sam
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbusage<BR>
KBSubcategory: kbsecurity<BR>
Additional reference words: prodnt 3.10 3.50 3.51<BR>
Keywords            : kbsecurity kbusage<BR>
Version             : 3.10 3.50 3.51<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 18, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
