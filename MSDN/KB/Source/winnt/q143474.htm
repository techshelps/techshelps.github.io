

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Restricting Information Available to Anonymous Logon Users </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q143474">
<META NAME="KBModify" CONTENT="1998/01/20">
<META NAME="KBCreate" CONTENT="1996/02/01">
<META NAME="Keywords" CONTENT="ntsecurity NTSrvWkst kbenv kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  Windows NT has a feature where anonymous logon users can list domain user names and enumerate share names. Customers who want enhanced security have requested the ability to optionally restrict this functionality. Windows NT 4.0 Service Pack 3 and ...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QAI5,QBG2,QAGU,QA9A,QBW7,QBW3,QATQ,QAUJ,QAE1,QBWG,QABO,QDO3,QAIM,QAY2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Restricting Information Available to Anonymous Logon Users</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 20, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q143474</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation version 4.0 Service Pack 3
<LI>Microsoft Windows NT Server version 4.0 Service Pack 3
<LI>Microsoft Windows NT Workstation version 3.51
<LI>Microsoft Windows NT Server version 3.51
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Windows NT has a feature where anonymous logon users can list domain user
names and enumerate share names. Customers who want enhanced security have
requested the ability to optionally restrict this functionality. Windows
NT 4.0 Service Pack 3 and a hotfix for Windows NT 3.51 provide a mechanism
for administrators to restrict the ability for anonymous logon users (also
known as NULL session connections) to list account names and enumerate
share names. Listing account names from Domain Controllers is required by
the Windows NT ACL editor, for example, to obtain the list of users and
groups to select who a user wants to grant access rights. Listing account
names is also used by Windows NT Explorer to select from list of users and
groups to grant access to a share.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Windows NT networks based on a single Windows NT domain will always be
able to authenticate connections to list domain account information.
Windows NT networks that use multiple domains may require anonymous user
logon to list account information. A brief example shows how anonymous
connections are used. Consider two Windows NT domains, an account domain
and a resource domain. The resource domain has a one-way trust
relationship with the account domain. That is, the resource domain
"trusts" the account domain, but the account domain does not trust the
resource domain. Users from the account domain can authenticate and access
resources in the resource domain based on the one-way trust. Suppose an
administrator in the resource domain wants to grant access to a file to a
user from the account domain. They will want to obtain the list of users
and groups from the account domain to select a user/group to grant access
rights. Since the account domain does not trust the resource domain, the
administrator request to obtain the list of users and groups from the
resource domain cannot be authenticated. The connection is made using a
NULL session to obtain the list of account domain users.
<P>
There are similar situations where obtaining account names using an
anonymous connection allows the user interface tools, including Windows NT
Explorer, User Manager, and ACL editor, to administer and manage access
control information across multiple Windows NT domains. Another example is
using User Manager in the resource domain to add users from the trusted
account domain to a local group. One way to add the account domain user to
a local group in the resource domain is to manually enter a known
domain\username to add access without getting the complete list of names
from the account domain. Another approach is to logon to the system in the
resource domain using an account in the trusted account domain.
<P>
Windows NT environments that want to restrict anonymous connections from
listing account names can control this operation after installing Windows
NT 4.0 Service Pack 3 or the Windows NT 3.51 hotfix.
<P>
After installation of Windows NT 4.0 Service Pack 3 or the Windows NT 3.51
hotfix, administrators who want to require only authenticated users to
list account names, and exclude anonymous connections from doing so, need
to make the following change to the registry:
<P>
WARNING: Using Registry Editor incorrectly can cause serious, system-wide
problems that may require you to reinstall Windows NT to correct them.
Microsoft cannot guarantee that any problems resulting from the use of
Registry Editor can be solved. Use this tool at your own risk.

<OL><P><LI>Run Registry Editor (Regedt32.exe).

<P><LI>Go to the following key in the registry:
<P>
<P><PRE>      HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\LSA
</PRE>
<P><LI>On the Edit menu, click Add Value and use the following entry:
<P>
<P><PRE>      Value Name: RestrictAnonymous
      Data Type:  REG_DWORD
<PRE></PRE>      Value:      1

</PRE><P><LI>Exit the Registry Editor and restart the computer for the change to
   take effect.
<P>
</OL>The purpose of the registry value is to configure local system policy for
whether authentication is required to perform common enumeration
functions. Requiring authentication to obtain the account name list is an
optional feature. When the RestrictAnonymous value is set to 1, anonymous
connections from the Graphical User Interface tools for security
management will receive an access denied error when attempting to get the
list of account names. When the RestrictAnonymous value is set to 0, or
the value is not defined, anonymous connections will be able to list
account names and enumerate share names. It should be noted that even with
the value of RestrictAnonymous set to 1, although the user interface tools
with the system will not list account names, there are Win32 programming
interfaces to support individual name lookup that do not restrict
anonymous connections.
<P>
Windows NT networks using a multiple domain model can restrict anonymous
connections without loss of functionality. The initial steps in planning
to disable anonymous connections is for administrators in resource domains
to add members of trusted account domains to specific local groups as
needed before changing the value for the LSA RestrictAnonymous registry
entry. Users logged on using accounts from trusted account domains will
continue to use authenticated connections to obtain list of account names
to manage security access control.
<P>
<P><h3>Restricting Anonymous List of Share Names</h3>
 
<P>
The Server service that provides remote file access to share resources
will also use the LSA registry value, RestrictAnonymous, to control
whether anonymous connections can obtain a list of share names. Therefore,
administrators can set the value of a single registry configuration entry
to define how the system responds to enumeration requests by anonymous
logons.
<P>
<P><h3>Restricting Anonymous Remote Registry Access</h3>
 
<P>
Installation of Windows NT 4.0 Service Pack 3 or the Windows NT 3.51
hotfix removes the ability for anonymous users to connect to the registry
remotely. Anonymous users cannot connect to the registry and cannot read
or write any registry data. As a reminder, Windows NT 4.0 restricts remote
access to the registry by domain users using the access control list on
the registry key:
<P>
<PRE>   "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet
   \SecurePipeServers\winreg"

</PRE></OL>The ACL on this key identifies the authenticated users allowed to remotely
connect to the registry. Windows NT 4.0 Server, by default, only allows
Administrators remote registry access. The winreg\AllowedPaths subkey
identifies specific portions of the registry that authenticated users who
are not explicitly granted access by the winreg ACL can use for printer
access and other system operations. The winreg key may be defined on
Windows NT 4.0 Workstations to restrict remote registry access to those
systems. For more information on the winreg key, please see the following
article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../WIN32SDK/Q155363.htm">Q155363</A></B>
   TITLE     : How To Regulate Network Access to the Windows NT Registry

</PRE><h3>Authenticated Users Built-in Group</h3>
 
<P>
A new built-in group is created when installing Windows NT 4.0 Service
Pack 3 or the Windows NT 3.51 hotfix known as "Authenticated Users." The
Authenticated Users group is similar to the "Everyone" group, except for
one important difference: anonymous logon users (or NULL session
connections) are never members of the Authenticated Users group. The
built-in Security Identifier for Authenticated Users is S-1-5-11.
Authenticated network connections from any account in the server's Windows
NT domain, or any domain trusted by the server's domain, is identified as
an Authenticated User. The Authenticated Users group is available for
granting access rights to resources in the security ACL editor. Windows NT
4.0 Service Pack 3 and the Windows NT 3.51 hotfix do not modify any access
control lists to change access rights granted to Everyone to use
Authenticated Users.
<P>
<P><h3>Windows NT 3.51 Hotfix</h3>
 
<P>
The Windows NT 3.51 hotfix has been posted to the following Internet
location:
<P>
<PRE>   <B><A HREF="ftp://ftp.microsoft.com/bussys/winnt/winnt-public/fixes/usa/NT351/">ftp://ftp.microsoft.com/bussys/winnt/winnt-public/fixes/usa/NT351/</A></B>
   hotfixes-postSP5/sec-fix
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 4.00 3.51 prodnt sp3 sid<BR>
Keywords          : ntsecurity NTSrvWkst kbenv kbnetwork<BR>
Version           : 3.51 4.0<BR>
Platform          : winnt<BR>
Issue type        : kbinfo<BR>
Solution Type     : kbservicepack<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 20, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
