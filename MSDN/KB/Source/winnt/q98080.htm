

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>1024 Cylinder Limit, How Windows NT Gets Drive Geometry </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q98080 ">
<META NAME="KBModify" CONTENT="1997/12/29">
<META NAME="KBCreate" CONTENT="1993/04/28">
<META NAME="Keywords" CONTENT="ntfilesys kbother">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  Windows NT can take advantage of hard drives with more than 1024 cylinders if your computer hardware permits. While Windows NT does not have an internal limit to the number of cylinders it can address, there are some hardware configurations where W...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QAC9,QAHE,QAU9,QAHC,QABN,QA4F,QAZS,QBQU,QBJQ,QAYY,QAML,QADN,QAKC,QDL9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>1024 Cylinder Limit, How Windows NT Gets Drive Geometry</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 29, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q98080 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT operating system version 3.1
<LI>Microsoft Windows NT Advanced Server version 3.1
<LI>Microsoft Windows NT Workstation versions 3.5, 3.51, and 4.0
<LI>Microsoft Windows NT Server versions 3.5, 3.51, and 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Windows NT can take advantage of hard drives with more than 1024
cylinders if your computer hardware permits. While Windows NT does not
have an internal limit to the number of cylinders it can address,
there are some hardware configurations where Windows NT must contend
with a 10 bit (1024 cylinder) limitation, imposed by the supporting
hardware (the hard drive controller or system BIOS in most cases).
<P>
The following section describes how the ATDISK driver determines drive
geometry. Other hard disk drivers are not included here, as the 1024
cylinder limitation usually doesn't apply. The other drivers,
including SCSI disk drivers, use absolute block addressing.
<P>
<P><h3>How the ATDISK Driver Determines Drive Geometry</h3>
 
<P>
All hard disk drivers report drive geometry (CHS or number of
cylinders, heads, and sectors per track) so that Windows NT can write
structures in the file system boot sectors, information such as
partition table entries in the MBR (master boot record) and the BPB
(BIOS parameter block). Although Windows NT does not actually use CHS
values in either of these structures, WinDisk and Format
(respectively) must write them so that MS-DOS can understand the disk
structures Windows NT creates.
<P>
ATDISK supports up to two hard drive controllers and up to two disks
per controller. Drive geometry information is available in the drive
parameter table in the BIOS. The BIOS may consist of more than one
component (system ROM and an option ROM on a disk controller, for
example). The BIOS typically keeps information on the first two disks
in a system.
<P>
There are a couple of ways to get the geometry information from the
drive parameter tables. The first (which Windows NT does not use
except in a special case noted later) is to read the CMOS locations
defined for computers that contain a drive type for the first and
second disk in the system. A drive type is used as an index into the
drive parameter table to point to an entry that describes disks of
that type. In addition, the BIOS typically keeps two vectors that
point to the two geometry entries for the first two disks as a bit of
housekeeping to keep from having to read CMOS and index into the
table.
<P>
Because Interrupt 13H uses CHS addressing and only defines 10 bits for
the cylinder count, only 1024 cylinders can be addressed. Because
larger disks may have more than 1024 cylinders, there are several
drive translation algorithms that increase the other two parameters to
reduce the cylinder count. The most common one is called head
doubling. The number of heads are doubled and the number of cylinders
are halved. These translated or logical parameters are called
"apparent geometry." The physical geometry is called "actual
geometry." A drive parameter table has reserved areas for the apparent
geometry. These fields are valid only if the high bit of the vendor
signature is set in the driver parameter table entry. (Compaq and
Ultrastor use this mechanism for describing translation.)
<P>
On some systems (IBM PS/1s and ValuePoints for example), the drive
parameter table is not available. On these systems, Windows NT relies
on Interrupt 13H function 8H, GetDriveParameter, information
collected during the boot process by NTDETECT.COM (executed by NTLDR).
If this information is available, it is used for both the apparent
and actual parameters.
<P>
If neither drive parameter tables nor Interrupt 13H information is
available (which is typically the case with disks attached to second
and subsequent controllers), then ATDISK calls the IDENTIFY command to
ask the disk directly what its parameters are. In these cases the
IDENTIFY data is used for both actual and apparent geometry. IDENTIFY
data is the last choice for geometry information, as it describes the
raw disk. Often disk controllers translate parameters; for example,
they might use spare sector pooling (for hot-fixing) or reserve the
last cylinder for diagnostics and configuration information. (Both IBM
and Compaq do this.)
<P>
Compaq has defined special CMOS locations for the third and fourth
disk in Compaq systems. Although this special code is in Windows NT
drivers, Compaq is the only company known to do this.
<P>
The Registry contains information describing disks serviced by the
ATDISK driver. The path is as follows:
<P>
<PRE>   HKEY_LOCAL_MACHINE\hardware\devicemap\atdisk\&lt;controller#&gt;\&lt;disk#&gt;

</PRE>The vendor identification from the IDENTIFY command, the geometry
parameters, and the apparent and actual geometry are available.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodnt<BR>
Keywords          : ntfilesys kbother<BR>
Version           : 3.1<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 29, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
