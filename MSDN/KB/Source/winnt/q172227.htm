

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Network Address Translators Can Block Netlogon Traffic </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q172227">
<META NAME="KBModify" CONTENT="1998/02/16">
<META NAME="KBCreate" CONTENT="1997/07/31">
<META NAME="Keywords" CONTENT="ntdomain ntgeneral NTSrvWkst kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  When you have a Network Address Translator (NAT) separating a Windows NT domain controller from its domain members or other trusted domains, Netlogon communication may fail. You will still be able to successfully redirect a drive across the NAT, an...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWD,QAVZ,QA9A,QAC2,QAB4,QAY2,QBW3,QAR5,QBWP,QBVV,QA5E,QA4S,QA4R,QAYC,QBW4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Network Address Translators Can Block Netlogon Traffic</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 16, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q172227</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT operating system version 3.1
<LI>Microsoft Windows NT Advanced Server version 3.1
<LI>Microsoft Windows NT Workstation versions 3.5, 3.51, and 4.0
<LI>Microsoft Windows NT Server versions 3.5, 3.51, and 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you have a Network Address Translator (NAT) separating a Windows NT
domain controller from its domain members or other trusted domains,
Netlogon communication may fail. You will still be able to successfully
redirect a drive across the NAT, and  browse across the NAT, but logons
attempts and trusts may fail. For example:

<UL><LI>When a client attempts to logon to the domain across the NAT, it may
   receive an error message similar to the following:
<P>
<P><PRE>      A domain controller for your domain could not be contacted. You have
      been logged on using cached account information. Changes to your
      profile since you last logged on may not be available.
</PRE><P>
   -or-

<LI>When you attempt to establish a trust relationship between domains, you
   may receive an error message similar to the following:
<P>
<P><PRE>      Could not find domain controller for this domain.
</PRE><P>
</UL>NOTE: The error messages and conditions may differ from the above, but it
will always be Netlogon communications that fail.
<P>
<P><h2>CAUSE</h2>
 
<P>
Your NAT is not translating the source IP address from the NetBIOS header
in your network traffic.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To successfully implement a Windows NT domain structure using a NAT, the
NAT will have to translate the addresses in NetBIOS datagram headers.
Please consult the vendor of your NAT for information on this issue.
<P>
<P><h2>STATUS</h2>
 
<P>
The third-party products discussed here are manufactured by vendors
independent of Microsoft; we make no warranty, implied or otherwise,
regarding these products' performance or reliability.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
NATs are used in IP networks to translate addresses from one network to
another. For example, if an internal network used one of the non-routeable,
private network IDs from RFC1597, such as 10.0.0.0, you could use
a NAT to translate these addresses into a public IP address and route them
onto the Internet. When a packet comes back to the NAT, it retranslates the
address back to the private address of the originating host.
<P>
If you send a NetBIOS datagram, as the Netlogon process does, the NetBIOS
header contains the source IP address. The reply to this NetBIOS datagram
will be sent directly to this IP address that is found in the NetBIOS
header as defined in RFC1002, section 4.4. If the NAT only translates
addresses in the IP header, and not in the NetBIOS header, the packet may
be sent to the wrong address. In this example, the packet would be sent
back to the computer on the 10.0.0.0 network, which is a private address
and not routeable.
<P>
The following NetBIOS headers contain an Owner IP address field which may
require translation:
<P>
<P><h3>NetBIOS Name Management</h3>
 

<UL><LI>Name Registration/Refresh/Release Request

<LI>Name Registration/Refresh/Release Response

<LI>Positive Name Query Response
<P>
</UL><h3>NetBIOS Datagram</h3>
 

<UL><LI>Datagram Service Header

<LI>Directed and Broadcast Datagram

<LI>Datagram Error Packet
<P>
</UL>NetBIOS datagrams are used for the following purposes:

<UL><LI>Locating a logon server

<LI>Sending a logon request

<LI>Performing domain synchronization

<LI>Browser host name announcements

<LI>Browser workgroup/domain announcements

<LI>NetBIOS Master Browser Existence and Election Packets

<LI>NET SEND /d:&lt;Domain&gt; "Message"
<P>
</UL><h2>REFERENCES</h2>
 
<P>
For more information on NATs, see RFC1631.
<P>
RFCs may be obtained via the Internet as follows:
<P>
Paper copies of all RFCs are available from the NIC, either individually or
on a subscription basis (for more information, contact NIC@NIC.DDN.MIL).
Online copies are available through FTP or Kermit from NIC.DDN.MIL as
rfc/rfc####.txt or rfc/rfc####.PS (#### is the RFC number without leading
zeroes).
<P>
Additionally, RFCs may be requested through electronic mail from the
automated NIC mail server by sending a message to SERVICE@NIC.DDN.MIL with
a subject line of "rfc ####" for text versions or a subject line of "rfc
####.PS" for PostScript versions. To obtain the RFC index, the subject line
of your message should read "rfc index".
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: validation<BR>
Keywords          : ntdomain ntgeneral NTSrvWkst kbnetwork<BR>
Version           : WinNT:3.5,3.51,4.0<BR>
Platform          : winnt<BR>
Issue type        : kbinfo<BR>
Solution Type     : Info_Provided<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 16, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
