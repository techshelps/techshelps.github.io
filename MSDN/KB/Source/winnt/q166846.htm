

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Cannot Reconnect to TN3270 Server with Close Listen Sockets </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q166846">
<META NAME="KBModify" CONTENT="1997/12/31">
<META NAME="KBCreate" CONTENT="1997/04/11">
<META NAME="Keywords" CONTENT="kbbug4.00 kbfix4.00 kbfix4.00.sp2 NTPROTOCOL NTSrvWkst nttcp kbbuglist kbfixlist">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  When you configure the Microsoft SNA Server 2.11 or SNA Server 3.0 TN3270 Server to use the Close Listen Socket option, TN3270 clients are unable to reconnect to the TN3270 server even though LUA sessions are available.  When the Close Listen Socke...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QAI5,QAKG,QARL,QAGI,QDO3,QAR4,QAPN,QAHS,QAHR,QA59,QACK,QAGB,QBWD,QDNT V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Cannot Reconnect to TN3270 Server with Close Listen Sockets</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 31, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q166846</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Server versions 3.51 and 4.0
<LI>Microsoft SNA Server for Windows NT, versions 2.11 SP1, SP2 and 3.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you configure the Microsoft SNA Server 2.11 or SNA Server 3.0 TN3270
Server to use the Close Listen Socket option, TN3270 clients are unable to
reconnect to the TN3270 server even though LUA sessions are available.
<P>
When the Close Listen Socket option is enabled, the TN3270 service performs
a CloseSocket() call when all SNA sessions are in use. The TN3270 service
indicates this by logging the following Windows NT event:
<P>
<PRE>   Event ID: 207
   Source: TN3270 Server
   Description:
   The TN3270E Server has closed the socket which listens for clients

</PRE>While existing TN3270 client sessions continue to work normally, new TN3270
client connection requests are rejected immediately with a TCP/IP Reset.
This allows the TN3270 client emulator to be notified of a connection
failure so it can try a different TN3270 service for a session.
<P>
When a TN3270 client disconnects causing an SNA session to become
available, the TN3270 service reopens the listen socket again and logs the
following event:
<P>
<PRE>   Event ID: 206
   Source: TN3270 Server
   Description:
   The TN3270E Server has opened a socket to listen for clients

</PRE>However, TN3270 clients are still unable to reconnect until the TN3270
server is stopped and restarted or if all users disconnect from the TN3270
server.
<P>
<P><h2>CAUSE</h2>
 
<P>
When the TN3270 server calls the CloseSocket() function, the Windows NT
TCP/IP address object connect handler address is set to NULL, which causes
TCP/IP to send a TCP/IP Reset when clients attempt to connect to the TN3270
port number.
<P>
When an SNA session becomes available, the TN3270 Server reopens the listen
socket by calling the socket() function. This causes the Windows NT TCP/IP
driver to create a duplicate address object with a valid connect handler
address. However, connection requests are validated against the old TCP/IP
address object, which still has a NULL connect handler.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
A hotfix for Windows NT 3.51 and 4.0 is available to correct this problem.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Windows NT version 4.0.
This problem was corrected in the latest Microsoft Windows NT 4.0 U.S.
Service Pack. For information on obtaining the service pack, query on the
following word in the Microsoft Knowledge Base (without the spaces):
<P>
<PRE>   S E R V P A C K

</PRE>Microsoft has confirmed this to be a problem in Windows NT version 3.51. A
supported fix is now available, but has not been fully regression-tested
and should be applied only to systems experiencing this specific problem.
Unless you are severely impacted by this specific problem, Microsoft
recommends that you wait for the next Service Pack that contains this fix.
Contact Microsoft Technical Support for more information.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: closelistensocket prodsna snatn3270<BR>
Keywords          : kbbug4.00 kbfix4.00 kbfix4.00.sp2 NTPROTOCOL NTSrvWkst nttcp kbbuglist kbfixlist<BR>
Version           : 4.0<BR>
Platform          : winnt<BR>
Issue type        : kbbug<BR>
Solution Type     : kbservicepack<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 31, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
