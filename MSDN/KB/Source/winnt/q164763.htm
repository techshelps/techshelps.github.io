

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>CSNW Fails to Connect to Preferred Server </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q164763">
<META NAME="KBModify" CONTENT="1998/01/30">
<META NAME="KBCreate" CONTENT="1997/03/06">
<META NAME="Keywords" CONTENT="kbbug3.51 kbbug4.00 ntprint NTSrvWkst kbprint">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  Client Services for NetWare (CSNW) clients may fail to connect to their preferred server with the following error:     NetWare Authentication Failure     You cannot be authenticated on          due to the following reason:    A connection to the se...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QAI5,QDKA,QAOX,QAKP,QBWS,QAGU,QBG2,QASR,QARL,QAIJ,QDMH,QACT,QDK2,QAXB V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>CSNW Fails to Connect to Preferred Server</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 30, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q164763</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation versions 3.51 and 4.0
<LI>Microsoft Windows NT Server version 3.51 and 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Client Services for NetWare (CSNW) clients may fail to connect to their
preferred server with the following error:
<P>
<PRE>   NetWare Authentication Failure

   You cannot be authenticated on &lt;server&gt; due to the following reason:
   A connection to the server could not be made because the limit on the
   number of concurrent connections for this account has been reached.

   Do you want to select another preferred server?

</PRE><h2>CAUSE</h2>
 
<P>
This problem only occurs if the following steps are used:

<OL><P><LI>A CSNW client creates a new printer, or prints to an existing printer
   during a logon session.

<P><LI>The CSNW client logs out.

<P><LI>The CSNW client immediately logs back on as the same user without
   restarting the workstation.
<P>
</OL>The problem occurs because the previous preferred server connection is
never closed. It may fail to close if the Logon User ID (LUID) for the
previous logon session was not released after a new printer was created or
if an existing printer was used.
<P>
The previous logon session was not released because its LUID, which is
maintained by the kernel, has a reference counter that is incremented when
the user's credentials are impersonated (used) and decremented when the
impersonation is released.
<P>
When the reference counter for an LUID reaches 0, the kernel notifies the
Local Security Authority (LSA) that the user has logged out. The LSA then
notifies CSNW to disconnect the user's preferred connection to the NetWare
server. In this case, the LUID for the user who is currently logged on is
never decremented to 0, so the LSA is never notified, which causes CSNW to
never be notified of the logout to disconnect from the preferred server.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Currently, only a workaround exists for this problem. To enable the
workaround, use the following steps:
<P>
<P><h3>For Windows NT 4.0</h3>
 

<OL><P><LI>Whenever a new printer is created, shut down and restart the workstation
   at the end of the day instead of logging out.

<P><LI>Disable all spooler event logging using the following steps:
<P>
   a. Open Printers in Control Panel.
<P>
   b. Click File and select Server Properties.
<P>
   c. Click the Advanced tab on the Print Server Properties page.
<P>
   d. Disable all Log Spooler options.
<P>
   e. Click Ok, and then shut down and restart.
<P>
</OL><h3>For Windows NT 3.51</h3>
 

<OL><P><LI>Whenever a new printer is created, shut down and restart the workstation
   at the end of the day instead of logging out.

<P><LI>Disable all spooler event logging using the following steps:
<P>
   WARNING: Using Registry Editor incorrectly can cause serious, system-
   wide problems that may require you to reinstall Windows NT to correct
   them. Microsoft cannot guarantee that any problems resulting from the
   use of Registry Editor can be solved. Use this tool at your own risk.
<P>
   a. Run Registry Editor (regedt32.exe).
<P>
   b. Go to the following key:
<P>
<P><PRE>      HKEY_Local_Machine\System\CurrentControlSet\Control\Print\Providers
</PRE><P>
   c. Add the following value:
<P>
<P><PRE>      EventLog = REG_DWORD 0x00000000
</PRE><P>
   d. Close Registry Editor, and then shut down and restart.
<P>
</OL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Windows NT versions 3.51
and 4.0. We are researching this problem and will post new information here
in the Microsoft Knowledge Base as it becomes available.
 
<PRE>Keywords          : kbbug3.51 kbbug4.00 ntprint NTSrvWkst kbprint
Version           : WinNT:3.51,4.0
Platform          : winnt
Hardware          : ALPHA x86
Issue type        : kbbug</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 30, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
