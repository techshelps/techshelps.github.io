

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>SNMP Counter Values Are Unreliable in SMP Computers </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q146004">
<META NAME="KBModify" CONTENT="1997/11/13">
<META NAME="KBCreate" CONTENT="1996/02/12">
<META NAME="Keywords" CONTENT="kbbug3.51 NTSrv nttcp kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  Windows NT simple network management protocol (SNMP) counters, such as output queue length, may yield unlikely results in symmetric multiprocessor (SMP) computers. The SNMP counters can be viewed using Snmputil.exe from the Windows NT Resource Kit,...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QALX,QAM9,QBWP,QAY5,QAH4,QAKD,QBVV,QAUD,QBKX,QAKJ,QAU3,QAMR,QDNT,QA5A,QAL3 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>SNMP Counter Values Are Unreliable in SMP Computers</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 13, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q146004</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Server versions 3.5, 3.51, and 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Windows NT simple network management protocol (SNMP) counters, such as
output queue length, may yield unlikely results in symmetric multiprocessor
(SMP) computers. The SNMP counters can be viewed using Snmputil.exe from
the Windows NT Resource Kit, or Performance Monitor using the Network
Interface object. For example:
<P>
<PRE>   snmputil getnext &lt;server&gt; public 2.2.1.21.1
   Variable = interfaces.ifTable.ifEntry.ifOutQLen.2
   Value    = Gauge - 3749

</PRE>NOTE: In normal operation, the output queue length counter should rarely
rise above zero, when it does, it should return to zero very quickly.
<P>
<P><h2>CAUSE</h2>
 
<P>
This problem occurs because Windows NT TCP/IP does not use interlocked
operations to maintain its statistics counters. The SNMP counters are
maintained in the TCP/IP code.
<P>
In the case of output queue length, the counter is incremented every time a
packet is indicated to NdisSend(), and decremented when NDIS completes the
send successfully by returning a status of success, or returning status
pending and later calling ARPSendComplete().
<P>
Because spinlocks are not used in this code to guarantee the integrity of
the counters, SMP computers can affect the counter values during retrieval,
causing unlikely values to be reported.
<P>
The decision to not implement spinlocks to guarantee the integrity of the
SNMP counters is based on performance concerns and will not be changed.
<P>
<P><h2>STATUS</h2>
 
<P>
Spinlocks were left out of the TCP/IP code for counter operations
intentionally for performance reasons. This will not be fixed.
 
<PRE>Keywords          : kbbug3.51 NTSrv nttcp kbnetwork
Version           : WinNT:3.5,3.51,4.0
Platform          : winnt
Issue type        : kbbug</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 13, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
