

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Transaction Log Supports NTFS Recoverability </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q101670">
<META NAME="KBModify" CONTENT="1997/09/17">
<META NAME="KBCreate" CONTENT="1993/07/20">
<META NAME="Keywords" CONTENT="ntfilesys kbother">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  The Windows NT file system (NTFS) provided by Microsoft Windows NT and Windows NT Advanced Server use transaction logging to ensure recoverability. The text below details how Windows NT implements this feature.  MORE INFORMATION  The file system pr...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH6,QAH7,QAD7,QA5V,QDMH,QBWP,QAML,QAXB,QACK,QBXJ,QAU5,QAHI,QA7T,QBXS,QAGC V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Transaction Log Supports NTFS Recoverability</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 17, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q101670</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT operating system, version 3.1
<LI>Microsoft Windows NT Advanced Server, version 3.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The Windows NT file system (NTFS) provided by Microsoft Windows NT and
Windows NT Advanced Server use transaction logging to ensure
recoverability. The text below details how Windows NT implements this
feature.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The file system processes each I/O operation that modifies a file on
an NTFS volume as a transaction. Each file on an NTFS volume is listed
as a record in a special file called the Master File Table (MFT). The
first record in the table describes the MFT itself and the second
record is an MFT "mirror" record. If the first MFT record is
corrupted, NTFS uses the second record to find the MFT mirror file,
the first record of which is identical to the first record of the MFT.
The boot sector records the locations of the MFT and MFT mirror file.
Windows NT stores a duplicate copy of the boot sector at the logical
center of the disk.
<P>
The third record in the MFT is the log file which records all file
transaction information. NTFS and the Log File Service use the DATA
attribute of the log file to implement file system recoverability. The
Log File Service is a component of the Windows NT Executive and the
text below describes it in greater detail. Because the log file is a
system file, it can be found early in the boot process and used to
recover the disk volume, if necessary. When a user updates a file, the
Log File Service records all redo and undo information for the
transaction. For recoverability, redo information allows NTFS to roll
the transaction forward (repeat the transaction if necessary), and
undo allows NTFS to roll the transaction back if an error occurs.
<P>
If a transaction completes successfully, NTFS commits the file update
to disk. If the transaction is not complete, NTFS ends or rolls back
the transaction according to the undo information. If NTFS detects an
error in the transaction, it rolls back the transaction. If NTFS
cannot guarantee that a transaction completed successfully, it rolls
the transaction back. Incomplete modifications to the volume are not
allowed.
<P>
If the system crashes (due to power failure or other cause), NTFS
performs three passes through the data on the disk: an analysis pass,
a redo pass, and an undo pass. During the analysis pass, NTFS
appraises the damage, if any, and determines which clusters it must
update using the information in the log file. The redo pass performs
any steps logged from the last checkpoint. Then the undo pass rolls
back any incomplete (uncommitted) transactions.
<P>
The NTFS recovery pass involves the following six steps:

<OL><P><LI>When Windows NT recognizes an NTFS volume, it reads the MFT.

<P><LI>NTFS calls the Log File Service to open the log file. This causes
   the Log File Service Recovery to take place.

<P><LI>NTFS calls the Log File Service to read its restart area and reads
   all the data from the last checkpoint operation. This data
   initializes the transaction table, dirty pages table, and open file
   table so they can be used in the recovery process.

<P><LI>NTFS performs an analysis pass on its last checkpoint record. At
   the end of this pass, the transaction table contains only
   transactions that were active when the crash occurred.

<P><LI>NTFS performs a redo pass. At the end of this pass, the cache
   reflects the state of the volume when the crash occurred.

<P><LI>NTFS performs an undo pass. At the end of this pass, the volume is
   recovered to a stable state.
<P>
</OL>The Log File Service maintains two objects to support its functions:

<UL><LI>The restart area. A status area used to transfer information about
   a client's last checkpoint operation before a crash to the client's
   recovery procedure. The Log File Service maintains two restart
   areas to guarantee that at least one valid area is always
   available.

<LI>The infinite log file. The Log File is a circularly reused file.
   When a new record is added, it is appended to the end of the file.
   When the Log File reaches its capacity, the Log File Service waits
   for writes to occur and frees space for new entries.
<P></UL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodnt chkdsk recover damage hard drive<BR>
Keywords          : ntfilesys kbother<BR>
Version           : 3.1<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 17, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
