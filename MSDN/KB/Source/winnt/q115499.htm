

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>NBT SessionAlive and TCP/IP Session Termination </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q115499">
<META NAME="KBModify" CONTENT="1997/05/15">
<META NAME="KBCreate" CONTENT="1994/05/29">
<META NAME="Keywords" CONTENT="kbnetwork NTSrvWkst nttcp">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  On Windows NT build 528, if TCP/IP protocol is the transport used, then NetBIOS over TCP/IP (NBT) KeepAlive frames maintain an idle session by default. The session is terminated if the other end does not respond to these frames. This article descri...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB7,QAIB,QBWP,QAIA,QA5E,QDNT,QBWD,QAI4,QAKC,QATK,QAKD,QAJX,QAEF,QADR,QACE V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>NBT SessionAlive and TCP/IP Session Termination</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 15, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q115499</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT operating system version 3.1
<LI>Microsoft Windows NT Advanced Server version 3.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
On Windows NT build 528, if TCP/IP protocol is the transport used, then
NetBIOS over TCP/IP (NBT) KeepAlive frames maintain an idle session by
default. The session is terminated if the other end does not respond to
these frames. This article describes NBT session termination.
<P>
NOTE: This information applies only to NetBIOS over TCP/IP on Windows NT
build 528. To determine which build of Windows NT you have installed:
<P>
<PRE>   1. In the Program Manager window, choose Run from the File menu.

   2. In the Command Line field, type "winver" (without the quotation
      marks), and then choose the OK button.

   The Windows Version dialog box appears with the version number and build
   number of Windows NT.

</PRE><h2>MORE INFORMATION</h2>
 
<P>
The default value for NbtKeepAlive is 60 seconds
(KEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NBT\Parameters). This
means that if there is no activity for 60 seconds, NBT generates a
SessionAlive frame to probe the connection. It is the function of TCP/IP to
attempt to deliver these SessionAlive frames. The number of attempts made
by TCP/IP to deliver the frame is governed by
"TcpMaxRetransmissionAttempts" which has a default of 7
(KEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\TCPIP\Parameters).
<P>
The Retransmission (RETX) timer depends on the Smooth Round Trip Time
(SRTT); it is a dynamic timer and varies between any two stations; it also
cannot be set or tuned in any way.
<P>
The current RETX timer (whatever it is at that moment) is used for the
first RETX attempt (of the seven). The RETX timer (t) is increased for
subsequent retransmissions based on the formula: t=2t. Therefore, if the
initial RETX value is 1 sec, then subsequent RETX timers would expire at 2,
4, 8, 16, 32, 64, 128 intervals.
<P>
In the above example, assuming there is no response, TCP/IP would report
failure to the above layer after 255 seconds (1+2+4...+128, including the
time until the seventh attempt expires), then the redirector would clear
the session.
<P>
One point to note is that NBT would submit NEW SessionAlive Frames at 60
second intervals, which TCP/IP does not attempt to retransmit. In the above
example, four new SessionAlive frames may be submitted by NBT in this 255
second period.
<P>
If there is a need to clear the session quicker, reducing
MaxRetransmissionAttempts even by one to a value of 6 would make it
dramatically quicker (two minutes less, as per the example above). Reducing
NbtKeepAlive from a value of 60 seconds to a lesser value will also
contribute to clearing the session quicker.
<P>
The following is a network trace illustrating the above:
<P>
<PRE>#  DeltaT  Src MAC   Dst MAC   Ntprotocol  Description
</PRE> 
<P>
<PRE>2  0.225   MOHAK01   Mohaksta  TCP   ACK seq:0x20131
3  59.850  Mohaksta  MOHAK01   NBT   Session Keep Alive seq:0x3EE4BF
4  0.936   Mohaksta  MOHAK01   NBT   Session Keep Alive seq:0x3EE4BF
5  1.975   Mohaksta  MOHAK01   NBT   Session Keep Alive seq:0x3EE4BF
6  3.957   Mohaksta  MOHAK01   NBT   Session Keep Alive seq:0x3EE4BF
7  7.941   Mohaksta  MOHAK01   NBT   Session Keep Alive seq:0x3EE4BF
8  15.883  Mohaksta  MOHAK01   NBT   Session Keep Alive seq:0x3EE4BF
9  29.613  Mohaksta  MOHAK01   NBT   Session Keep Alive seq:0x3EE4C3
10 2.082   Mohaksta  MOHAK01   NBT   Session Keep Alive seq:0x3EE4BF
11 58.217  Mohaksta  MOHAK01   NBT   Session Keep Alive seq:0x3EE4C7
12 5.171   Mohaksta  MOHAK01   NBT   Session Keep Alive seq:0x3EE4BF
13 55.150  Mohaksta  MOHAK01   NBT   Session Keep Alive seq:0x3EE4CB
14 60.291  Mohaksta  MOHAK01   NBT   Session Keep Alive seq:0x3EE4CF

</PRE>In the above trace, frame 2 is the last frame from MOHAK01. NBT initiates
Session Alive Frames starting at #3. Frames 9,11,13,14 are "New" Session
Alive Frames submitted by NBT which are not retransmitted by TCPIP.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodnt Hang session end disconnect<BR>
Keywords            : kbnetwork NTSrvWkst nttcp<BR>
Version             : 3.1<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 15, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
