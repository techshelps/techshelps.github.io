

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>NetLogon Service Fails when Secure Channel Not Functioning </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q150518">
<META NAME="KBModify" CONTENT="1997/10/10">
<META NAME="KBCreate" CONTENT="1996/05/01">
<META NAME="Keywords" CONTENT="nthowto ntnetserv NTSrv ntutil kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  The NetLogon service fails to start on a backup domain controller (BDC) with NetLogon error 3210 or 5721, whereas, in the system event logs of the primary domain controller (PDC,) the NetLogon service logs errors 5722 or 5723. At the same time, the...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAAD,QAK7,QA9A,QABT,QAVY,QAB4,QABG,QBG2,QACK,QBW3,QBWP,QBII,QAO4,QAPN,QAIJ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>NetLogon Service Fails when Secure Channel Not Functioning</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 10, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q150518</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Server version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The NetLogon service fails to start on a backup domain controller (BDC)
with NetLogon error 3210 or 5721, whereas, in the system event logs of the
primary domain controller (PDC,) the NetLogon service logs errors 5722 or
5723. At the same time, the Service Control Manager logs error 7023 on the
BDC because the NetLogon service could not be started.
<P>
For each BDC, there is a discrete communication channel (the secure
channel) with the PDC. The secure channel is used by the NetLogon service
on the BDC and on the PDC in order to communicate.
<P>
The procedure described below resets the BDC secure channel using a single
command line instead of many operations within the Server Manager. It
requires the NETDOM utility provided with Windows NT 4.0 Resource Kit
Supplement 2.
<P>
<P><h2>CAUSE</h2>
 
<P>
For the purpose of this article assume the following configuration:
<P>
<PRE>   Domain = DOMAIN
   PDC    = DOMAINPDC
   BDC    = DOMAINBDC

</PRE>When a BDC is part of a domain, a computer account is created (the computer
account can be seen with Server Manager.) A default password is given to
the computer account and the BDC stores the password in LSA secret storage
$machine.acc. The password is then changed every seven days.
<P>
Each BDC maintains such an LSA secret, which is used by the NetLogon
service in order to establish a secure channel. If the computer account's
password and the LSA secret are not synchronized, the NetLogon service
fails to start on the BDC with the following error message:
<P>
<PRE>   NETLOGON Event 3210

   Failed to authenticate with \\DOMAINPDC, a Windows NT domain controller
   for domain DOMAIN.

</PRE>If the computer account has been deleted, one of the following error
messages are logged by the BDC NetLogon service:

<UL><LI>NETLOGON Event 5721
<P>
   The session setup to the Windows NT Domain Controller \\DOMAINPDC for
   the domain DOMAIN failed because the Windows NT Domain Controller does
   not have an account for the computer DOMAINBDC.
<P>
   -or-

<LI>NETLOGON Event 5723
<P>
   The session setup from the computer DOMAINBDC failed because there is no
   trust account in the security database for this computer. The name of
   the account referenced in the security database is DOMAINBDC$.
<P>
</UL>Similarly, the NetLogon service on the PDC logs the following error message
when the password is not synchronized:
<P>
<PRE>   NETLOGON Event 5722

   The session setup from the computer DOMAINBDC failed to authenticate.
   The name of the account referenced in the security database is
   DOMAINBDC$. The following error occurred:

   Access is denied.

</PRE>In all cases, the event data contains the error. For example, the error
0xC0000022 means the computer account's password is invalid, while the
error 0xC000018B means the computer account has been deleted, and so on.
<P>
For more information on secure channels, please see the following
article(s) in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../WINNT/Q131366.htm">Q131366</A></B>
   TITLE     : Event Error 5712 with Status Access

   ARTICLE-ID: <B><A HREF="../WINNT/Q142869.htm">Q142869</A></B>
   TITLE     : Event ID 3210 and 5722 Appear When Synchronizing Entire
               Domain

   ARTICLE-ID: <B><A HREF="../WINNT/Q149664.htm">Q149664</A></B>
   TITLE     : Verifying Domain Netlogon

   ARTICLE-ID: <B><A HREF="../WINNT/Q158148.htm">Q158148</A></B>
   TITLE     : Domain Secure Channel Utility -- NLTEST.EXE

   ARTICLE-ID: <B><A HREF="../WINNT/Q160324.htm">Q160324</A></B>
   TITLE     : Event ID 5721 After Deleting Computer

</PRE><h2>RESOLUTION</h2>
 
<P>
WARNING: The solution included in this article has not been extensively
tested in large installations. Microsoft cannot guarantee that
modifications of domains as recommended herein will accomplish the
objective described in this article under all circumstances and in all
configurations.
<P>
The NETDOM command line utility makes it possible to reset the secure
channel of the BDC. This can be very useful when the NetLogon service on
the BDC cannot start due to a secure channel problem.
<P>
The BDC secure channel can be reset as follows:
<P>
<PRE>   NETDOM BDC mybdc /RESET

</PRE>The command above may be run on the PDC, BDC, or any member of the domain,
provided that you are logged on with as administrator. The output looks
similar to the following:
<P>
<PRE>   NetDom 1.2 @1997.
   Querying domain information on computer \\MYBDC ...
   The computer \\MYBDC is a domain controller of THEDOMAIN.
   Searching PDC for domain THEDOMAIN ...
   Found PDC \\THEPDC
   Verifying secure channel on \\MYBDC ...
   Verifying the computer account on the PDC \\THEPDC ...
   The computer account for \\MYBDC doesn't exist or has an invalid
   password.
   Resetting secure channel ...
   Changing computer account on PDC \\THEPDC ...
   Stopping service NETLOGON on \\MYBDC .... stopped.
   Starting service NETLOGON on \\MYBDC .... started.
   The BDC \\MYBDC secure channel was reset successfully.
   Logoff/Logon \\MYBDC to take modifications into effect.

</PRE>The command above resets BDC secure channels only if required. If the
password for the BDC secure channel was good, then you receive a message
silimar to the following:
<P>
<PRE>   NetDom 1.2 @1997.
   Querying domain information on computer \\MYBDC ...
   The computer \\MYBDC is a domain controller of THEDOMAIN.
   Searching PDC for domain THEDOMAIN ...
   Found PDC \\THEPDC
   Verifying secure channel on \\MYBDC ...
   Verifying the computer account on the PDC \\THEPDC ...
   Secure channel checked successfully.
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 4.00 prodnt<BR>
Keywords          : nthowto ntnetserv NTSrv ntutil kbnetwork<BR>
Version           : 4.0<BR>
Platform          : winnt<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 10, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
