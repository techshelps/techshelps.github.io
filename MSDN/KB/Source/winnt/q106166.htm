

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Windows NT Backup and Hard Links </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q106166">
<META NAME="KBModify" CONTENT="1997/05/12">
<META NAME="KBCreate" CONTENT="1993/11/02">
<META NAME="Keywords" CONTENT="kbother ntfault">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT=" You may experience problems when you use the Backup program to back up files that are  hard linked  to each other. Note that hard links can only be created with POSIX applications; therefore, this will not be of concern for most users.  MORE INFORMA...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA3W,QAE2,QBFY,QDIU,QAUR,QAX3,QABE,QANY,QBWP,QBVV,QA5V,QALW,QBXA,QAHT,QATJ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Windows NT Backup and Hard Links</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 12, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q106166</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT operating system version 3.1
<LI>Microsoft Windows NT Advanced Server version 3.1
</UL> 
<P>
You may experience problems when you use the Backup program to back up
files that are "hard linked" to each other. Note that hard links can
only be created with POSIX applications; therefore, this will not be
of concern for most users.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
NTFS supports hard linked files for compliance with the POSIX
specification. Applications other than POSIX applications may not
handle hard linked files correctly in all situations.
<P>
Once two files are linked together, you cannot determine which is the
original file and which is the copy. This is because both file records
will point to the same data on disk, and the pointer is a one-way
link. The only information you can get about a linked file is  the
link count for that file, and the file index number, which is a 64-bit
value that uniquely identifies that file on that volume.
<P>
When the Backup program reads a file, it can determine that there are
other links to that data, but it can't tell what the other filenames
are.
<P>
NTBackup keeps a list of all files that it backed up with link counts
greater than one, and it stores the file index number for each one of
these files. While it is backing up, when it comes across another file
that has a link count greater than one, it searches its list of files,
looking for a match of file indices. If it finds one, instead of
writing the data streams out to the tape drive, it creates a stream of
type BACKUP_LINK and puts information about the filename in this
stream. It does NOT write the contents of the file to the backup tape
more than once.
<P>
When BackupWrite comes across a BACKUP_LINK stream when restoring to
disk, it will get the information about the other filename from the
stream and then it will set up the link. This means that if the first
instance of a file with hard links that was encountered during the
backup operation is no longer present during the restore operation,
the Backup program will fail to restore the subsequent, linked
instances of the file.
<P>
<P><h3>Example</h3>
 
<P>
Suppose C:\FILE1.TXT is linked with C:\SUBDIR\FILE2.TXT. If you back
up drive C and then reformat and restore the entire drive, there will
be no problems. The Backup program will record the contents of
C:\FILE1.TXT and then record a link pointer for C:\SUBDIR\FILE2.TXT.
So on restore, C:\FILE1.TXT will be written out to the disk, and
C:\SUBDIRE\FILE2.TXT will be recreated as a link to C:\FILE1.TXT.
<P>
If you were to restore only the C:\SUBDIR directory after reformatting
drive C, however, the restore operation would find only the link
information when it came to C:\SUBDIR\FILE2.TXT and attempt to create
a link to C:\FILE1.TXT which does not exist, because it has not been
restored. Therefore, the file would not be restored and an error would
be registered in the log file for the restore operation.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodnt<BR>
Keywords            : kbother ntfault<BR>
Version             : 3.1<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 12, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
