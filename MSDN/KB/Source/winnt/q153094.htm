

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Restoring Default Permissions to Windows NT System Files </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q153094">
<META NAME="KBModify" CONTENT="1997/09/19">
<META NAME="KBCreate" CONTENT="1996/06/28">
<META NAME="Keywords" CONTENT="ntfilesys nthowto ntsetup NTSrvWkst kbother">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  When an administrator attempts to secure the Microsoft Windows NT system by changing the default Windows NT file system (NTFS) file and directory permissions set up on the                and/or the default system directories and subdirectories, som...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QAI5,QAFI,QBW7,QBWG,QABA,QAIJ,QDIV,QBXB,QATJ,QAGU,QAA1,QAK7,QDI2,QA9N V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Restoring Default Permissions to Windows NT System Files</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 19, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q153094</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation versions 3.5, 3.51, and 4.0
<LI>Microsoft Windows NT Server versions 3.5, 3.51, and 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
When an administrator attempts to secure the Microsoft Windows NT system by
changing the default Windows NT file system (NTFS) file and directory
permissions set up on the &lt;%winnt_root%&gt; and/or the default system
directories and subdirectories, some functions, such as users' ability to
log on to the network, may be impaired. In extreme cases the system may
blue screen on startup. If the system starts, the default permissions can
be restored. If the system blue screens, the original system can be
restored by installing a second copy of Windows NT.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following procedure does not work in Windows NT 4.0.  For additional
information, please see the following article in the Microsoft Knowledge
Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../WINNT/Q157963.htm">Q157963</A></B>
   TITLE     : SETACL.EXE not available in Windows NT 4.0

</PRE>If the System Starts
 
<P>
Use the following procedures to restore the default permissions on the
system files in the &lt;winnt_root&gt; and all default subdirectories.
<P>
WARNING: Using Registry Editor incorrectly can cause serious, system-wide
problems that may require you to reinstall Windows NT to correct them.
Microsoft cannot guarantee that any problems resulting from the use of
Registry Editor can be solved. Use this tool at your own risk.

<OL><P><LI>Logon as administrator.

<P><LI>The built-in SYSTEM account needs access to the Windows NT default
   directories and subdirectories. To get this access, do the following:
<P>
   a. In File Manager use Security/Permissions to grant the SYSTEM account
   FULL CONTROL to the root directory of the NTFS volume that contains
   Windows NT.
<P>
</OL>b. Next, either select the option to Replace Permissions on
<PRE>   Subdirectories, which gives SYSTEM access to the entire volume,

</PRE></OL>-or-
<P>
<PRE>   go to the system's root directory (typically, WINNT35) and give
   SYSTEM full control of that directory and all subdirectories. SYSTEM
   should always have full control of all system files.

</PRE><P><LI>Start Registry Editor (Regedt32.exe).

<P><LI>Go to the following registry location:
<P>
<P><PRE>      HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\SessionManager
</PRE>
<P><LI>   Double-click the value BootExecute.

<P><LI>Under BootExecute, you may find a few entries, such as:
<P>
<P><PRE>      autocheck autochk *
</PRE><P>
   After any entries, add on a separate line:
<P>
<P><PRE>      setacl /a \DosDevices\&lt;systemdrive&gt;:\&lt;winnt_root&gt;
</OL></PRE>\System32\winperms.txt \DosDevices\&lt;systemdrive&gt;:
<P>
NOTE that this added entry should all be on the same line under the
autocheck entry.
<P>
Here &lt;systemdrive&gt; is the drive that Windows NT is installed on
and &lt;winnt_root&gt; is the Windows NT root directory on that drive.
<P>
After adding the change on a typical system, the BootExecute entry
looks like this while in the reged32 multi-string editor:
<P>
<PRE>   autocheck autochk *
   setacl /a \DosDevices\c:\winnt35\system32\winperms.txt \DosDevices\c:

</PRE><P><LI>Save changes by clicking OK.

<P><LI>Exit the registry editor and restart the computer.
<P>
<P>
</OL>On restart, the system will set security on the system files just as it
does when converting from FAT to NTFS file systems.
<P>
No Additional file security needs to be placed on the Windows NT system
files if they are residing on NTFS. Any further restrictions may curtail
the ability of users to log on to the individual computer or the domain.
<P>
However, it is possible to restrict user access to system files.
As long as the SYSTEM account has full control of all system files,
user access (usually through the group EVERYONE) can be restricted.
<P>
NOTE: Microsoft recommends using the default permissions for Windows NT.
Changing these permissions may make it impossible for users to log on,
print, access logon scripts, or gain access to other necessary functions.
As with using the Registry Editor, make these changes at your own risk.
Always have a recovery plan in case you need to revert to a previous setup.
<P>
The MINIMUM PERMISSIONS necessary to log on (again, assuming
SYSTEM has full control of the volume root and all system directories
and files) are:
<P>
<PRE>     System_root (e.g. c:\winnt35) ------------ Everyone - READ
     System_root\system32 --------------------- Everyone - READ/EXECUTE
     System_root\system32\repl\import\scripts - Everyone - READ/EXECUTE
          (only if your users have logon scripts)

</PRE></OL>Depending on your environment, additional permissions may be necessary.
<P>
<P><h3>If The System Does Not Start (Blue Screen with STOP 21A)</h3>
 
<P>
If the administrator has modified permissions, rebooted the computer,
and now receives a blue screen, then the most likely cause is that
the SYSTEM account does not have adequate access to the system files
and directories.
<P>
To restore access:

<OL><P><LI>Install a new copy of Windows NT INTO A NEW DIRECTORY on the same volume
   as the existing copy. Of course, you will need to start up with the boot
   disks.
<P>
</OL>WARNING: If you install a new copy of NT in the same directory as the
existing copy, you will erase the existing copy, all existing accounts, and
so on.

<OL><P><LI>Boot to the new copy of Windows NT.

<P><LI>Use File Manager to give the System account Full Control of
   the volume root and all system files and directories.
<P>
</OL>You should now be able to boot to the original copy of Windows NT. Follow
the instructions above (under "If the System Starts")to restore default
permissions on your system.
<P>
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodnt security<BR>
Keywords          : ntfilesys nthowto ntsetup NTSrvWkst kbother<BR>
Version           : 3.5 3.51 4.0<BR>
Platform          : winnt<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 19, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
