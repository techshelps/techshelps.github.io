

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>MPS: Writes to User Property Database Do Not Occur </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q174296">
<META NAME="KBModify" CONTENT="1998/02/17">
<META NAME="KBCreate" CONTENT="1997/09/24">
<META NAME="Keywords" CONTENT="cismps">
<META NAME="KBArea" CONTENT="Support; KB; sitemcis">
<META NAME="Description" CONTENT=" IMPORTANT: This article contains information about editing the registry. Before you edit the registry, make sure you understand how to restore it if a problem occurs. For information about how to do this, view the  Restoring the Registry  Help topic...">
<META NAME="Product" CONTENT="sitemcis">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGU,QAI5,QBWP,QA3A,QBVV,QA6A,QAL0,QBWS,QDNQ,QDJ3,QDIZ,QBG2,QAPN,QAO4,QAKP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>MPS: Writes to User Property Database Do Not Occur</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 17, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q174296</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Commercial Internet System version 1.0
   - Microsoft Personalization System
<LI>Microsoft Site Server version 2.0
   - Microsoft Personalization System
</UL> 
<P>
IMPORTANT: This article contains information about editing the registry.
Before you edit the registry, make sure you understand how to restore it if
a problem occurs. For information about how to do this, view the "Restoring
the Registry" Help topic in Regedit.exe or the "Restoring a
Registry Key" Help topic in Regedt32.exe.
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The Message Personalization System (MPS) may not be able to write to the
user property database when Windows NT Challenge/Response (NTLM) is the
only configured authentication method on the Microsoft Internet Information
Server (IIS).
<P>
<P><h2>CAUSE</h2>
 
<P>
MPS runs in the context of IIS, so when MPS attempts to write to the
propdb, it does not impersonate the remote HTTP client when it is only
configured for NTLM Challenge/Response. It impersonates the client when IIS
is configured for basic authentication. Instead it uses a NULL username,
because the configured service account is the local system account.
<P>
When the MPS calls the Win32 API CreateFile to write to the propdb, it does
not pass any credential information with it. The MPS computer tries to
connect to the file share where the propdb is located and fails, because
NULL sessions are disallowed by default by the Windows NT Server service,
even if the guest account is enabled. In a network trace, the
SessionSetupAndX will have a NULL username, which results in the Access
Denied response from the server.
<P>
The best way to see this problem is to use the Installation Verification
script included with MPS. If a user is added to the propdb and the screen
simply refreshes, then this problem is occurring. Run the script on a
computer other than the one running MPS. A button to remove the user is
displayed when the add is successful.
<P>
One caveat is if the HTTP client is local to the MPS box, then the security
context of the logged-on user will be used, and the connection will succeed
if the user has permissions to access the share.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
WARNING: Using Registry Editor incorrectly can cause serious problems that
may require you to reinstall your operating system. Microsoft cannot
guarantee that problems resulting from the incorrect use of Registry Editor
can be solved. Use Registry Editor at your own risk.
<P>
For information about how to edit the registry, view the "Changing Keys And
Values" Help topic in Registry Editor (Regedit.exe) or the "Add and Delete
Information in the Registry" and "Edit Registry Data" Help topics in
Regedt32.exe. Note that you should back up the registry before you edit it.
<P>
Create a NULL session share for the location of the propdb. On the file
server that is hosting the propdb share, run REGEDT32.EXE and make the
following changes:

<OL><P><LI>Open the Registry Editor, Regedt32.exe.

<P><LI>From the HKEY_LOCAL_MACHINE subtree, go to the key:
<P>
<P><PRE>      \System
<PRE></PRE>        \CurrentControlSet
          \Services
            \LanmanServer
              \Parameters
                \NullSessionShares

   NOTE: NullSessionShares is type REG_MULTI_SZ.

</PRE><P><LI>Create a new line within the NullSessionShares key, type in the share
   you want to access with a null session.
<P>
   On NullSessionsShares add the name of the share on the local box for the
   Propdb. For example, if your propdb is at "\\TheServer\PropDB", you
   would add "PropDB".

<P><LI>Stop and restart the server.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: personalization personalisation<BR>
Keywords          : cismps<BR>
Version           : 1.00, 2.00<BR>
Platform          : WINDOWS winnt<BR>
Issue type        : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 17, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
