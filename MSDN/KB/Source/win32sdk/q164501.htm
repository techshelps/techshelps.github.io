

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>INFO: Windows NT Uses KnownDLLs Registry Entry to Find DLLs </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q164501">
<META NAME="KBModify" CONTENT="1997/03/04">
<META NAME="KBCreate" CONTENT="1997/03/03">
<META NAME="Keywords" CONTENT="BseDll BseRegistry kbprg">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  Windows NT uses the KnownDLLs registry entries to search for either 32-bit or 16-bit DLLs when loading the DLL. For 32-bit DLLs the KnownDLLs registry entry only affects the search for implicitly loaded DLLs. For 16-bit DLLs the KnownDLLs registry ...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QBXB,QATJ,QAFI,QDNN,QAL3,QDL9,QBWQ,QBWO,QBWN,QAKD,QACI,QAUJ,QBVV,QAYL V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INFO: Windows NT Uses KnownDLLs Registry Entry to Find DLLs</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 4, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q164501</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Win32 Application Programming Interface (API) included with:
   - Microsoft Windows NT version 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Windows NT uses the KnownDLLs registry entries to search for either 32-bit
or 16-bit DLLs when loading the DLL. For 32-bit DLLs the KnownDLLs
registry entry only affects the search for implicitly loaded DLLs.
For 16-bit DLLs the KnownDLLs registry entry affects the search for both
implicitly and explicitly loaded DLLs. If you incorrectly include a DLL
name in the KnownDLLs registry entry, the LoadLibrary in Windows NT WOW
fails to load a DLL located in the application's current directory.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Windows NT uses the KnownDLLs registry entry to determine which DLL an
application will use. There are two different KnownDLLs registry entries:
one that affects the loading of 32-bit DLLs, and one that affects the
loading of 16-bit DLLs. A DLL listed in the KnownDLLs registry entry is
sometimes referred to as a "KnownDLL" in this article.
<P>
<P><h3>DLLs: 16-bit</h3>
 
<P>
For 16-bit DLLs, the KnownDLLs registry value is found in the following
key:
<P>
<PRE>   HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\WOW

</PRE>The KnownDLLs registry value is a REG_SZ string with DLL names in 8.3
format, separated by a space. The KnownDLLs value affects both implicitly
and explicitly loaded DLLs.
<P>
Without the KnownDLLs registry value, Windows NT WOW uses the following
search order to locate the DLL:

<OL><P><LI>The current directory of the task that is using the DLL.

<P><LI>The \WINNT directory.

<P><LI>The \WINNT\SYSTEM directory.

<P><LI>The \WINNT\SYSTEM32 directory.

<P><LI>The directory of the executable for the task that is using the DLL.

<P><LI>A directory listed in the PATH environment variable.
<P>
</OL>With the KnownDLLs registry value, Windows NT WOW only looks in the
\WINNT\SYSTEM32 directory to locate the DLL. If KnownDLLs includes an
entry for a DLL that is not located in the \WINNT\SYSTEM32 directory,
LoadLibrary fails to load the DLL even if the DLL is located at any of
the 5 other locations above.
<P>
If Windows NT WOW fails to locate the DLL, LoadLibrary returns error
code 2 (File Not Found), or the implicit linking causes the parent
module to fail to load.
<P>
For information about how Windows 95 registers 16-Bit DLLs as KnownDLLs
see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../WIN32SDK/Q141969.htm">Q141969</A></B>
   TITLE     : Windows 95 Uses Known16DLLs Registry Key to Find 16-bit
               DLLs

</PRE></OL><h3>DLLs: 32-bit</h3>
 
<P>
For 32-bit DLLs the KnownDLLs registry key is found at:
<P>
<PRE>   HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\SessionManager

</PRE>The REG_SZ registry value name is the name of the DLL without the
extension. The registry value data is the name of the DLL with the
extension. This entry affects only implicitly loaded DLLs, not DLLs loaded
using the LoadLibrary() API.
<P>
Without this entry, Windows NT uses the following search order to
locate the DLL:

<OL><P><LI>The directory of the executable for the process that is loading
   the DLL.

<P><LI>The current directory of the process that is loading the DLL.

<P><LI>The \WINNT\SYSTEM32 directory.

<P><LI>The \WINNT directory.

<P><LI>A directory listed in the path environment variable.
<P>
</OL>With the KnownDLLs registry entry, Windows NT uses the following search
order to locate the DLL:

<OL><P><LI>The \WINNT\SYSTEM32 directory.

<P><LI>The directory of the executable for the process that is loading
   the DLL.

<P><LI>The current directory of the process that is loading the DLL.

<P><LI>The \WINNT directory.

<P><LI>A directory listed in the PATH environment variable.
<P>
</OL>If the DLL is not located in any of the locations mentioned above, the
implicit linking causes the parent module to fail to load.
<P>
A DLL is treated as a KnownDLL if a KnownDLL implicitly links to it. For
example, MAIN.DLL uses functions from CHILD.DLL. If MAIN.DLL is listed in
the KnownDLLs registry key, then Windows NT also treats CHILD.DLL as a
KnownDLL. Another application or DLL that uses CHILD.DLL will use the DLL
that was linked to MAIN.DLL.
<P>
Windows NT maps 32-bit KnownDLLs at boot time. Renaming or moving the DLL
does not have any effect on which DLL an application will load; it still
uses the one that was in \WINNT\SYSTEM32 at boot time.
<P>
To alter how Windows NT loads KnownDLLs use the ExcludeFromKnownDlls
registry value located at:
<P>
<PRE>   HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\SessionManager

</PRE></OL>This REG_MULTI_SZ registry value contains names of DLLs in 8.3 format, one
DLL per string. If a DLL is listed in ExcludeFromKnownDlls, then Windows NT
does not treat the DLL as a KnownDLL, even if it is listed in the
KnownDLLs registry key. This is useful when you develop a DLL that is used
by a lot of other KnownDLLs and it is important to replace and test new
builds without rebooting Windows NT.
<P>
Making changes to the aforementioned registry keys requires administrative
privileges to the local machine. The use of KnownDLLs secures the system
from someone deceptively replacing APIs by placing a rogue DLL in the
application directory.
<P>
For information about how Windows 95 registers 32-Bit DLLs as KnownDLLs
see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../WIN32SDK/Q151646.htm">Q151646</A></B>
   TITLE     : Windows 95 Uses KnownDLLs Registry Key to Find 32-bit DLLs


 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : BseDll BseRegistry kbprg<BR>
Version             : 4.00<BR>
Platform            : NT WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 4, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
