

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: Error Message Box Returned When DLL Load Fails </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q117330">
<META NAME="KBModify" CONTENT="1996/12/17">
<META NAME="KBCreate" CONTENT="1994/06/26">
<META NAME="Keywords" CONTENT="kbprg">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  Under Windows NT, when you load a DLL, a message box titled  Invalid DLL Entrypoint  is displayed and has the following text:     The dynamic link library        is not written correctly.    The stack pointer has been left in an inconsistent state....">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA01,QBWP,QAB4,QDNN,QBC9,QBC8,QANO,QAAP,QDL9,QBWO,QBWN,QAJ6,QBFY,QBVV,QA2Q V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Error Message Box Returned When DLL Load Fails</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 17, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q117330</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Win32 Application Programming Interface (API) included with:
<P>
<P><PRE>    - Microsoft Windows NT versions 3.5, 3.51, and 4.00
    - Microsoft Windows 95 version 4.0
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Under Windows NT, when you load a DLL, a message box titled "Invalid DLL
Entrypoint" is displayed and has the following text:
<P>
<PRE>   The dynamic link library &lt;name&gt; is not written correctly.
   The stack pointer has been left in an inconsistent state.
   The entry point should be declared as WINAPI or STDCALL.
   Select YES to fail the DLL load. Select NO to continue
   execution. Selecting NO may cause the application to operate
   incorrectly.

</PRE>Under Windows 95, the message box is titled "Error starting program" and
the text is:
<P>
<PRE>   The &lt;dll file name&gt; file cannot start. Check the file to
   determine the problem.

</PRE>The user is not given a choice to continue, only an OK button. Pressing the
OK button fails program load.
<P>
<P><h2>CAUSE</h2>
 
<P>
The system expects DLL entrypoints to use the _stdcall convention. If you
use the _cdecl convention, the stack is not properly restored and
subsequent calls into the DLL can cause a general protection fault (GPF).
<P>
This error message is new to Windows NT, version 3.5. Under Windows NT,
version 3.1, the DLL is loaded without an error message, but the
application usually causes a GPF when calling a DLL routine.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Correct the prototype of your entrypoint. For example, if your entrypoint
is as follows:
<P>
<PRE>   BOOL DllMain( HANDLE hDLL, DWORD dwReason, LPVOID lpReserved)

</PRE>change it to the following:
<P>
<PRE>   BOOL WINAPI DllMain( HANDLE hDLL, DWORD dwReason, LPVOID lpReserved)

</PRE>Then, link with the following linker option to specify the entry point if
you are using the C run-time:
<P>
<PRE>   -entry:_DllMainCRTStartup$(DLLENTRY)

</PRE><h2>MORE INFORMATION</h2>
 
<P>
If you are using the Microsoft C run-time, you need to use the entry point
given in the RESOLUTION section in order to properly initialize the C run-
time. For additional information, please see the following article in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../WIN32SDK/Q94248.htm">Q94248</A></B>
   TITLE     : Using the C Run Time

</PRE><h2>REFERENCES</h2>
 
<P>
For more information on the DLL entrypoint, please search on the topic
"DllEntryPoint" (without the quotes) in the Win32 API help file.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbprg kbprb<BR>
KBSubcategory: BseDll<BR>
Additional reference words: 3.50 3.51 4.00 libmain<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 17, 1996</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
