

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>How to use ExitExecRestart to Install System Files </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q114606">
<META NAME="KBModify" CONTENT="1995/05/25">
<META NAME="KBCreate" CONTENT="1994/05/08">
<META NAME="Keywords" CONTENT="kbtool kbsetup kbprg kbcode">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  Some installation procedures require the installation of files (such as CTL3D.DLL, COMMDLG.DLL, and fonts) that may be in use by Windows at the time the setup program is run. Windows is likely to have these files open, so they cannot be installed w...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAA1,QDI2,QDL9,QBWO,QBWN,QDNQ,QBWQ,QDIZ,QABI,QABH,QBXB,QATJ,QAIJ,QAFI,QBWS V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to use ExitExecRestart to Install System Files</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 25, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q114606</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) version 3.1
<LI>Microsoft Win32 SDK, version 3.5
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Some installation procedures require the installation of files (such as
CTL3D.DLL, COMMDLG.DLL, and fonts) that may be in use by Windows at the
time the setup program is run. Windows is likely to have these files open,
so they cannot be installed without causing sharing violations. The Setup
Toolkit provides features to exit Windows, install these files, and then
restart Windows when complete.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The Setup Toolkit accomplishes the installation of system files as
follows:

<OL><P><LI>Before the Setup Toolkit copies a system file, it checks to see if the
   file is currently open. If it is, it copies the file to the destination
   directory, but under a different file name. It then adds this file to
   the "restart list".

<P><LI>When CopyFilesInCopyList() is complete, the Setup Toolkit checks the
   "restart list" and generates a .BAT file (named _MSSETUP.BAT) in the
   "restart directory". This .BAT file contains commands which delete the
   system files which were open (in step #1) and rename the new versions to
   their correct names.

<P><LI>Windows is exited, the .BAT file executed, then Windows restarted.

<P><LI>The .BAT file is then deleted.
<P>
   NOTE: The "restart directory" is not deleted. Hence, you should use your
   application's installation directory as your restart directory.
<P>
</OL>Hence, to install system files, perform the following steps:

<OL><P><LI>Mark the system files as "system" in the DSKLAYT program. This is
   accomplished by highlighting all the system files (clicking with the
   CTRL key down) and placing a check in the "System File" check box under
   "File Attributes".

<P><LI>Before calling CopyFilesInCopyList() specify the name of your "restart
   directory". Assuming the target directory for your application is stored
   in DEST$ (as in the samples), use the following line:
<P>
<P><PRE>      SetRestartDir DEST$
</PRE><P>
   The specified directory does not need to exist. It will be created
   if necessary.

<P><LI>After your installation is complete, execute the following code before
   exiting your setup script. Normally this code will be placed at the
   end of the Install subroutine.
<P>
<P><PRE>      if RestartListEmpty ()=0 then
<PRE></PRE>          '' The following two lines must go on one line.
          MessageBox hwndFrame (), "Windows will now be exited and
          restarted.", "Sample Setup Script", MB_OK+MB_ICONINFORMATION
      eer:
          i%=ExitExecRestart ()
          '' The following three lines must go on one line.
          MessageBox hwndFrame (), "Windows cannot be restared because
          MS-DOS-based applications are active. Close all MS-DOS-based
          applications, and then click OK.", "Sample Setup Script",
          MB_OK+MB_ICONSTOP
          goto eer
      end if

   NOTE: In order to use the MessageBox() function you must add the
   following lines at the beginning of your setup script:

      const MB_ICONINFORMATION = 64
      '' The following two lines must go on one line.
      declare sub MessageBox lib "user.exe" (hwnd%, message$,
      title$, options%)

</PRE><P><LI>Add the file _MSSETUP.EXE to your source directory and lay it out on
   Disk #1 in DSKLAYT.

<P><LI>Add a reference to _MSSETUP.EXE to the [files] section of your .LST
   file. For example,
<P>
<P><PRE>    if you marked _MSSETUP.EXE to be compressed,
</PRE><P>
<P><PRE>    [files]
<PRE></PRE>        _mssetup.ex_ = _mssetup.exe

    if you did not mark it as compressed,

    [files]
        _mssetup.exe = _mssetup.exe

</PRE></OL>NOTES:

<OL><P><LI>If ExitExecRestart () is successful, your script will be exited. That
   is, ExitExecRestart () will not return. If it does return, an error
   has occurred.

<P><LI>This functionality is not available under Windows 3.0. If the user runs
   the above setup script on Windows 3.0, they will receive the message
   that MS-DOS-based applications are running and they will not be able to
   complete the setup. If this is a concern, check the version of Windows
   before executing the above code.

<P><LI>If _MSSETUP.EXE is not in your .LST file or not laid out in DSKLAYT,
   you will receive an "assertion failure" message when calling
   ExitExecRestart ().
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.10 3.50 setup toolkit mssetup<BR>
KBCategory: kbtool kbsetup kbprg kbcode<BR>
KBSubcategory: TlsMss<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 25, 1995</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
