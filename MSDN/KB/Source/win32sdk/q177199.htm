

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>BUG: ReadEventLog Fails with Error 87 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q177199">
<META NAME="KBModify" CONTENT="1997/11/24">
<META NAME="KBCreate" CONTENT="1997/11/21">
<META NAME="Keywords" CONTENT="BseEvtLog">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  The ReadEventLog() Win32 API function might fail and GetLastError() returns 87 (ERROR_INVALID_PARAMETERS) while having all valid parameters passed to ReadEventLog().  CAUSE =====  The Event Logging Service fails to process the read operation when a...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDMH,QA5V,QAPN,QAO4,QAHE,QAKP,QAU5,QAHI,QBVV,QABA,QAJH,QBFN,QAY5,QAPF,QALZ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: ReadEventLog Fails with Error 87</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 24, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q177199</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Win32 Application Programming Interface (API) included with:
   - Microsoft Windows NT versions 3.50, 3.51, 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The ReadEventLog() Win32 API function might fail and GetLastError() returns
87 (ERROR_INVALID_PARAMETERS) while having all valid parameters passed to
ReadEventLog().
<P>
<P><h2>CAUSE</h2>
 
<P>
The Event Logging Service fails to process the read operation when an
application uses the ReadEventLog() function with the EVENTLOG_SEEK_READ
flag to read large event log file.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
The calling application should not use the EVENTLOG_SEEK_READ flag with
ReadEventLog if the size of the event log file is not determined. Instead,
use the EVENTLOG_SEQUENTIAL_READ flag and use repeated calls to
ReadEventLog to implement code to scan to the record of interest.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article. We are researching this bug and will post
new information here in the Microsoft Knowledge Base as it becomes
available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
This problem is only encountered when the .EVT file is 2MB in size or
larger. The event log file is found in the %SystemRoot%\system32\config
directory. For example, the .EVT file for the Application log is
AppEvent.evt.
<P>
If the log file has been configured not to exceed 2MB - 64K, an application
can expect the EVENTLOG_SEEK_READ flag to work properly without any
problem. To configure the log file size, use Event Viewer and select the
Log Settings menu item from the Log Menu.
<P>
If the log file is 2MB or larger, the seek method of reading the event log
will fail to read the earlier records in the file. For example, expect
ReadEventLog to fail when reading records with the dwRecordOffset parameter
set to 1 or 2 or maybe 11 or 12, depending on how full the log file is.
ReadEventLog may continue to succeed and work properly for seeking to later
records, for example dwRecordOffset set to 100 or 200.
<P>
The problem with ReadEventLog using the EVENTLOG_SEEK_READ flag is related
to the file size and not the number of records.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For more information about ReadEventLog see:
<P>
Platform SDK: Windows Base Services; Debugging and Error Handling; Event
Logging; Event Logging Reference
 
<PRE>Keywords          : BseEvtLog
Version           : WINNT:3.5,3.51,4.0
Platform          : winnt
Issue type        : kbbug</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 24, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
