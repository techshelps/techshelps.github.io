

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: Controls Do Not Receive Expected Messages </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q121094">
<META NAME="KBModify" CONTENT="1994/11/28">
<META NAME="KBCreate" CONTENT="1994/09/26">
<META NAME="Keywords" CONTENT="kbprg kbprb">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  A Win32-based application works as expected under Windows NT, but under Win32s, control messages are not received by the application as expected.  Here are some possible scenarios symptomatic of this problem:   - Sending LB_GETSELITEMS to a supercl...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAEV,QA7O,QAOE,QAMN,QAB5,QAYC,QBVV,QDL9,QBWQ,QBWO,QBWN,QAH6,QBWP,QAXC,QAHV V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Controls Do Not Receive Expected Messages</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 28, 1994</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q121094</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Win32s, versions 1.1, 1.15, and 1.2
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
A Win32-based application works as expected under Windows NT, but under
Win32s, control messages are not received by the application as expected.
<P>
Here are some possible scenarios symptomatic of this problem:

<UL><LI>Sending LB_GETSELITEMS to a superclassed list box does not work.

<LI>The custom control procedure does not receive messages such as
   CB_ADDSTRING, CB_INSERTSTRING, or CB_SHOWDROPDOWN.

<LI>The wrong control message is received.
<P>
</UL><h2>CAUSE</h2>
 
<P>
This is a Win32s limitation. When a Win32-based application sends a
message, Win32s processes the message and passes it to Windows. Windows is
responsible for delivering the message. Win32s truncates wParam from a
DWORD to a WORD. Most messages do not use the high word of wParam, however,
if you do use the high word of wParam, be aware that it will be lost under
Win32s.
<P>
In the course of processing known messages (messages that are not user-
defined), Win32s translates any pointers in lParam. In addition, if a
message is new to Win32, the corresponding Windows message is used instead.
For example, the Windows WM_CTLCOLOR was replaced in Win32 with
WM_CTLCOLORBTN, WM_CTRLCOLORDLG, WM_CTLCOLOREDIT, and so on. Therefore, if
a Win32-based application uses WM_CTRLCOLORBTN, Win32s passes WM_CTLCOLOR
to Windows with a type of CTLCOLOR_BTN.
<P>
Control messages are not unique on Windows version 3.1 as they are on
Windows NT. Control messages on Windows have values above WM_USER, however,
messages for one control may share the same number as a message of another
control. For example, both CB_ADDSTRING and LB_DELETESTRING are defined as
WM_USER+3. Therefore, when Win32s receives the WM_USER+3 message, it needs
to determine the correct control message. Win32s looks at the window class
of the window that will receive the message and maps the message
accordingly. If the window class is not a recognized control class, as in
the case of a superclassed control, the message is not mapped, which
results in unexpected behavior.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
In order to get the desired behavior under Win32s, make the custom control
use a recognized control class (such as "combobox") and subclass the window
procedure instead of superclassing. If you need to subclass before the
WM_CREATE/WM_NCCREATE messages, use a CBT hook. You will not be able to
change the class icon and cursor, but the messages will be handled
correctly.
<P>
If you need to use a custom control, create and use user-defined messages
instead of the control messages.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 1.10 1.15 1.20<BR>
KBCategory: kbprg kbprb<BR>
KBSubCategory: W32s<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 28, 1994</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
