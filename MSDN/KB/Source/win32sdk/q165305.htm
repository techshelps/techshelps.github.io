

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>BUG: DDEML: Advise Stop Causes Disconnect </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q165305">
<META NAME="KBModify" CONTENT="1997/03/18">
<META NAME="KBCreate" CONTENT="1997/03/18">
<META NAME="Keywords" CONTENT="kbprg UsrDde kbbuglist">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  The Dynamic Data Exchange Management Library (DDEML) may unexpectedly terminate an existing conversation when the client attempts to end an advise loop by calling DdeClientTransaction with the wType parameter set to XTYP_ADVSTOP.  CAUSE =====  This...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAML,QARL,QALZ,QAXB,QAA7,QAO4,QAKP,QAYY,QAHE,QAGB,QBUG,QBUF,QAEV,QAC1,QDIX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: DDEML: Advise Stop Causes Disconnect</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 18, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q165305</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Win32 Software Development Kit (SDK)
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The Dynamic Data Exchange Management Library (DDEML) may unexpectedly
terminate an existing conversation when the client attempts to end an
advise loop by calling DdeClientTransaction with the wType parameter set to
XTYP_ADVSTOP.
<P>
<P><h2>CAUSE</h2>
 
<P>
This behavior might occur when a server is maintaining a hot-link advise
loop with a client and is sending updates very rapidly. In addition, the
client must initiate the advise loop by requesting that the server wait for
acknowledgements before posting the next data item. (This is done by ORing
the XTYPF_ACKREQ flag with the XTYP_ADVSTART flag in the wType parameter of
DdeClientTransaction.)
<P>
If the above situation exists, it is possible for a client to stop the
advise loop before it has acknowledged the receipt of the last data item.
If this happens, the DDEML receives notification to end the advise loop
before it receives the final acknowledgement from the last data update that
it sent. In this situation, DDEML responds to the notification to end the
advise loop by cleaning up the internal data structures that it was using
to keep track of the conversation. The problem occurs when, after cleaning
up the internal data structures, it receives the final acknowledgement for
the last data update. Since it has just destroyed all records of the
conversation that the acknowledgement belongs to, it treats this message as
a spontaneous message generated by the client. Because a spontaneous
message violates the DDE protocol, it terminates the conversation.
<P>
This problem is a race condition and, therefore, this behavior may not
occur all of the time. The problem may also surface after you make minor
changes to the application code or after you upgrade an operating system
(such as adding a service pack).
<P>
<P><h2>RESOLUTION</h2>
 
<P>
This problem only occurs if the XTYPF_ACKREQ flag is used to request that
the client wait for acknowledgements before sending the next data update.
If the client is capable of keeping up with the server, this problem can be
avoided by not using this flag.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article. We are researching this bug and will post
new information here in the Microsoft Knowledge Base as it becomes
available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following sequence of messages occur if the problem arises (these could
be viewed using Spy++):
<P>
<PRE> ...
 WM_DDE_DATA          &lt;Server posts Data&gt;
 WM_DDE_ACK           &lt;Client acknowledges receipt&gt;
 WM_DDE_DATA          &lt;Server posts Data&gt;
 WM_DDE_UNADVISE      &lt;Client posts a notification to stop the advise loop&gt;
 WM_DDE_ACK           &lt;Client acknowledges receipt of last data&gt;

</PRE>If this problem does not occur, the last two messages would take place in
reverse order, with the WM_DDE_ACK occurring prior to the WM_DDE_UNADVISE.
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : kbprg UsrDde kbbuglist<BR>
Platform            : NT WINDOWS<BR>
Issue type          : kbbug<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 18, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
