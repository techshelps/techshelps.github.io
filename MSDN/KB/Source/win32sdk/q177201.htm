

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: Changes to CryptoAPI Enveloped Data Generation and Parsing </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q177201">
<META NAME="KBModify" CONTENT="1997/11/24">
<META NAME="KBCreate" CONTENT="1997/11/21">
<META NAME="Keywords" CONTENT="BseCrypt">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  Enveloped data messages generated with the initial release of CryptoAPI 2.0 are illegible to the release of CryptoAPI 2.0, which shipped as part of Internet Explorer 4.0. Likewise, enveloped data messages generated via the CryptoAPI on Windows NT 4...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QAEV,QAVZ,QBV9,QBIC,QDO3,QAYC,QBNY,QAYY,QDL9,QBWO,QBWN,QAM6,QBSO,QAY5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Changes to CryptoAPI Enveloped Data Generation and Parsing</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 24, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q177201</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Win32 Application Programming Interface (API) included with:
   - Microsoft Windows NT 4.0
   - Microsoft Windows 95
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Enveloped data messages generated with the initial release of CryptoAPI 2.0
are illegible to the release of CryptoAPI 2.0, which shipped as part of
Internet Explorer 4.0. Likewise, enveloped data messages generated via the
CryptoAPI on Windows NT 4.0 Service Pack 3 and Internet Explorer 3.02 Auth2
are not successfully interpreted by Internet Explorer 4.0's CryptoAPI
implementation. Note that CryptoAPI 2.0 originally shipped as part of
Windows NT 4.0 Service Pack 3 and Internet Explorer 3.02 Auth2.
<P>
<P><h2>CAUSE</h2>
 
<P>
In the interest of improved S/MIME compatibility, changes to the way the
CryptoAPI generates and parses enveloped data messages were introduced with
Internet Explorer version 4.0. A detailed description of these changes can
be found in the "Remarks" section of the CryptoAPI 2.0 SDK documentation
for the function CryptMsgOpenToEncode.
<P>
RESOLUTION
<P>
 
<P>
Versions of the CryptoAPI that shipped after the release of Internet
Explorer 4.0 automatically detect, and parse appropriately, enveloped data
messages that were formatted by versions of the CryptoAPI prior to Internet
Explorer 4.0. Versions of the CryptoAPI that shipped after the release of
Internet Explorer 4.0 also write out the data with the new formatting
introduced with Internet Explorer 4.0. Furthermore, for backward
compatibility, these future versions of the CryptoAPI also expose a flag
for explicitly producing enveloped data messages in the old format produced
by the CryptoAPI as part of Windows NT 4.0 Service Pack 3 and Internet
Explorer 3.02 Auth2. This same backward compatible functionality slated for
versions of the CryptoAPI after Internet Explorer 4.0 is available today to
applications calling to the CryptoAPI provided by Internet Explorer 4.0,
but via a separate, re-distributable DLL, Sp3crmsg.dll.
<P>
If you simply load Sp3crmsg.dll dynamically prior to executing any of the
affected Internet Explorer 4.0 CryptoAPI functions (for example,
CryptMsgOpenToEncode, CryptEncryptMessage, CryptSignAndEncryptMessage,
etc.), it automatically causes these functions to detect and decode
enveloped data messages that have been formatted by versions of the
CryptoAPI prior to Internet Explorer 4.0. If enveloped data messages with
the characteristic formatting are not detected, processing will default to
Internet Explorer 4.0's original CryptoAPI functionality. In addition (in a
manner similar to releases of the CryptoAPI to come after Internet Explorer
4.0), this DLL allows Internet Explorer 4.0 to generate messages compatible
with the earlier versions of the CryptoAPI, but only if an application
developer explicitly chooses to do so.
<P>
This DLL, along with additional details, installation instructions, and
sample code, are in the file Sp3crmsg.zip, which can be found at the
following Internet location:
<P>
<PRE>  <B><A HREF="http://drg.microsoft.com/cryptoext">http://drg.microsoft.com/cryptoext</A></B>

</PRE>When prompted for credentials enter the string "crypto" for both the
username and the password fields. Then download Sp3crmsg.zip, unpack it
using your favorite ZIP file utility, and read the enclosed Readme.txt file
for more details.
<P>
An Alpha version of Sp3crmsg.dll is also available upon request; please
send email to Cryptoapi@listserv.msn.com.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: CRYPT_E_OSS_ERROR NTE_BAD_DATA<BR>
Keywords          : BseCrypt<BR>
Version           : WINNT:4.0<BR>
Platform          : Win95 winnt<BR>
Issue type        : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 24, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
