

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Instance-Specific String Handles (HSZs) in DDEML </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q94953 ">
<META NAME="KBModify" CONTENT="1995/11/02">
<META NAME="KBCreate" CONTENT="1993/01/26">
<META NAME="Keywords" CONTENT="kbui">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  Instance-specific string handles in DDEML may be used in DdeConnect() or DdeConnectList() in order to connect to a particular instance of a server. These string handles are received by a DDEML callback as the HSZ2 parameter to the XTYP_REGISTER/XTY...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QATX,QAJQ,QDL9,QBWO,QBWN,QA4F,QAY2,QAUD,QAI4,QBWQ,QBVV,QAY5,QABA,QALW,QDMW V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Instance-Specific String Handles (HSZs) in DDEML</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 2, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q94953 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) versions 3.1

<LI>Microsoft Win32 Application Programming Interface (API) included with:
<P>
<P><PRE>    - Microsoft Windows NT versions 3.5 and 3.51
    - Microsoft Windows 95 version 4.0
</UL></PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Instance-specific string handles in DDEML may be used in DdeConnect()
or DdeConnectList() in order to connect to a particular instance of a
server. These string handles are received by a DDEML callback as the
HSZ2 parameter to the XTYP_REGISTER/XTYP_UNREGISTER transactions
whenever a server application registers or unregisters the service
name it supports.
<P>
This article explains how instance-specific HSZs are internally
implemented in the Windows 3.1 DDEML; however, this is for purposes of
illustration only because the implementation may change in future versions
of DDEML, particularly in Win32. However, the behavior will be the same.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Currently, instance-specific string handles contain two pieces of
information: the original service name string plus the handle to a
hidden window created by DDEML, which is associated with that string.
These two pieces of information are then merged [that is, MAKELONG
(SvcNameAtom, hWnd)] into an HSZ.
<P>
It is important to underscore what the documents on
DdeCreateStringHandle() say in reference to instance-specific HSZs
(see the Comments section of the Windows 3.1 Software Development Kit
(SDK) "Programmer's Reference, Volume 2: Functions," page 169):
<P>
<PRE>   An instance-specific string handle is not mappable from string
   handle to string to string handle again. The DdeQueryString()
   function creates a string from a string handle and then
   DdeCreateStringHandle() creates a string handle from that string,
   but the two handles are not the same.

</PRE>This might be better explained as follows:

<OL><P><LI>Server registers itself:
<P>
<P><PRE>      0x0000C18F = DdeCreateStringHandle (,"SERVER",);
      DdeNameService (,0x0000C18F,,);
</PRE>
<P><LI>Callbacks receive two HSZs in XTYP_REGISTER:
<P>
<P><PRE>      HSZ1 = 0x0000C18F  (normal HSZ)
      HSZ2 = 0x56F8C18F  (instance-specific HSZ)
</PRE>
<P><LI>Client does a DdeQueryString() on the HSZ2 returned above, and
   creates a string handle with the string returned.
<P>
<P><PRE>      DdeQueryString (,0x56F8C18F, myLpstr,,,);
<PRE></PRE>            // where myLpstr returned = "SERVER:(56F8)"

      0x0000C193= DdeCreateStringHandle (,myLpstr,);

   Note how instance-specific 0x56F8C18F passed in to DdeQueryString()
   is not the same as the HSZ returned (0x0000C193) from the
   DdeCreateStringHandle() on the same string; whereas regular string
   handles (that is, non-instance-specific HSZs) would have mapped to
   the same string handle.
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.10 3.50 4.00 95<BR>
KBCategory: kbui<BR>
KBSubcategory: UsrDde<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 2, 1995</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
