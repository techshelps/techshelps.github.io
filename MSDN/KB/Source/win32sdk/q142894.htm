

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>BUG: MCI Open of MIDI File with Installable I/O Proc Fails </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q142894">
<META NAME="KBModify" CONTENT="1996/01/23">
<META NAME="KBCreate" CONTENT="1996/01/22">
<META NAME="Keywords" CONTENT="kbmm kbbuglist">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  On various Windows platforms, using MCI to open a MIDI file element with the FOURCC of an installed I/O procedure as part of the element name fails according to the following table:  Platform          EXE             MCI Open Results Windows 3.1   ...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWN,QDL9,QBWO,QBWQ,QBWP,QAAP,QAB4,QAKP,QAL3,QAH4,QABI,QAA1,QDI2,QAR4,QAB9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: MCI Open of MIDI File with Installable I/O Proc Fails</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 23, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q142894</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows
   version 3.1

<LI>Microsoft Win32 Software Development Kit (SDK) for:
<P>
<P><PRE>    - Windows NT versions 3.5 and 3.51
    - Windows 95
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
On various Windows platforms, using MCI to open a MIDI file element with
the FOURCC of an installed I/O procedure as part of the element name fails
according to the following table:
<P>
<PRE>Platform          EXE             MCI Open Results
</PRE> 
<PRE>Windows 3.1       16-bit          fails, error #1
Win32s            32-bit          fails, error #1
Windows 95        16-bit          ok
Windows 95        32-bit          fails, error #2
Windows NT 3.51   16-bit          fails, error #1
Windows NT 3.51   32-bit          fails, error #1

</PRE>error #1  "MCI Error: Cannot find the specified file. Make
<PRE>          sure the path and filename are correct."

</PRE>error #2  "MMTask caused an invalid page fault in module
<PRE>           &lt;unknown&gt; at 0000:1000100A"

</PRE><h2>CAUSE</h2>
 
<P>
MCI uses the Sequencer device to open and play MIDI file elements.
Mciseq.drv is the system component that contains the MCI MIDI sequencer
functionality. In Windows 3.1 and Windows NT 3.51, Mciseq.drv has a bug
that causes the user-supplied FOURCC to be overriden. Mciseq.drv always
sets the fccIOProc field of the MMIOINFO structure that it passes to
mmioOpen() to FOURCC_DOS instead of the user-supplied FOURCC. This causes
mmioOpen() to use the built-in MS-DOS file system I/O procedure instead of
the user-installed I/O procedure. The result is the error "MCI Error:
Cannot find the specified file. Make sure the path and filename are
correct."
<P>
Although this bug is fixed for 16-bit applications in Windows 95, a
limitation in the Windows 95 system architecture affects 32-bit application
code that attempts this operation. In the 32-bit case, attempting to play a
MIDI file using MCISEQ.DRV and an installed I/O procedure results in the
error "MMTask caused an invalid page fault in module &lt;unknown&gt; at
0000:1000100A".
<P>
<P><h2>RESOLUTION</h2>
 
<P>
There is no workaround in Windows 3.1 or Windows NT 3.51 that will allow
MCI to open and play a MIDI file element using an installed I/O procedure.
Therefore alternative solutions should be pursued on these platforms. For
example, in the case of playing a MIDI application resource using MCI, you
can work around the installed I/O procedure problem by first copying the
MIDI resource to a temporary file and then using MCI to play the file
element from disk with the default I/O procedure.
<P>
Because 16-bit application code in Windows 95 is not affected by the system
architecture limitation that does affect 32-bit code in Windows 95, a
32-bit application based on Windows 95 can thunk to a 16-bit DLL to play
back a MIDI file using MCI and an installed I/O procedure.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed these problems as bugs in the Microsoft products
listed at the beginning of this article. We are researching these problems
and will post new information here in the Microsoft Knowledge Base as it
becomes available.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.10 3.50 4.00 mmio ioproc<BR>
KBCategory: kbmm kbbuglist<BR>
KBSubcategory: MMMidi<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 23, 1996</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
