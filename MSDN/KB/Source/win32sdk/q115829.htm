

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>How to Gracefully Fail at Service Start </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q115829">
<META NAME="KBModify" CONTENT="1996/12/16">
<META NAME="KBCreate" CONTENT="1994/06/05">
<META NAME="Keywords" CONTENT="kbprg">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  If an error occurs while your service is running or initializing (SERVICE_START_PENDING) and you need to stop the service process, do the following:  1. Clean up any resources that are being used (threads, memory, and so    forth). You should start...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QACK,QAUD,QAGI,QAML,QAIJ,QAGB,QAB4,QAUQ,QBWP,QAAP,QDIV,QBXS,QA7O,QALW,QAKD V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to Gracefully Fail at Service Start</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 16, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q115829</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Win32 Application Programming Interface (API) included with:
<P>
<P><PRE>    - Microsoft Windows NT versions 3.5, 3.51, and 4.00
</UL></PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
If an error occurs while your service is running or initializing
(SERVICE_START_PENDING) and you need to stop the service process, do the
following:

<OL><P><LI>Clean up any resources that are being used (threads, memory, and so
   forth). You should start sending a SERVICE_STOP_PENDING status if the
   clean up process is lengthy. Be sure to update the Service Control
   Manager as demonstrated in the Win32 SDK SERVICE sample.

<P><LI>Send out a SERVICE_STOPPED status from the last thread to terminate
   before it calls ExitThread().

<P><LI>Set SERVICE_STATUS.dwWin32ExitCode and/or
   SERVICE_STATUS.dwServiceSpecificExitCode to values that indicate why the
   service is stopping. If you return a value for the
   dwServiceSpecificErrorCode field, then the dwWin32ExitCode field should
   be set to ERROR_SERVICE_SPECIFIC_ERROR.
<P>
   The reason for setting these values is that if a service fails its
   operation, but returns an exit code of 0, the following error message is
   returned by default:
<P>
<P><PRE>      Error 2140: An internal Windows NT error occurred
</PRE><P>
</OL><h2>MORE INFORMATION</h2>
 
<P>
When the last service in the process has terminated (you may have multiple
services in the service process), the StartServiceCtrlDispatcher() call in
the main thread returns. The main routine should call ExitProcess() because
all of the services have terminated.
<P>
<P><h2>REFERENCES</h2>
 
<P>
There is a termination sample in the "Win32 Programmer's Reference," in the
"Services" overview section, "Writing a ServiceMain Function." This is a
simple situation where the service process only consists of one thread.
This thread returns when it is ready to terminate, instead of calling
ExitThread().
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.50 3.51 4.00<BR>
KBCategory: kbprg<BR>
KBSubcategory: BseService<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 16, 1996</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
