

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>BUG: RPC Encoding API MyType_Encode() Causes Access Violation </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q181651">
<META NAME="KBModify" CONTENT="1998/02/25">
<META NAME="KBCreate" CONTENT="1998/02/23">
<META NAME="Keywords" CONTENT="NtwkRpc">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  If you define MyType as a structure with a union that has structures as union_arms in your IDL file, the Midl generated type encoding function, MyType_Encode(), may fail with the following error code:     0xC0000005 Access Violation  CAUSE =====  I...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA1S,QDN9,QABG,QALZ,QAGX,QAH4,QDIX,QAIC,QAKP,QDIT,QAO3,QAO2,QAGI,QAAP,QAP2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: RPC Encoding API MyType_Encode() Causes Access Violation</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 25, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q181651</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT, version 4.0 on the following platform:
<P><PRE>    - x86
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If you define MyType as a structure with a union that has structures as
union_arms in your IDL file, the Midl generated type encoding function,
MyType_Encode(), may fail with the following error code:
<P>
<PRE>   0xC0000005 Access Violation

</PRE><h2>CAUSE</h2>
 
<P>
In some specific cases, a union that contains structures may cause Midl to
produce incorrect offset for the description of the structure. As a result,
the Midl generated stub routine crashes in the marshaling engine.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Change your union member inside MyType from a flat member to a pointer
type.
<P>
<P><h3>Sample Code</h3>
 
<P>
For example, given the following type definitions:
<P>
<PRE>   typedef enum _MyStructEnum {
      MyStructEnum1, MyStructEnum2
   } MyStructEnum;

   typedef struct _MyStruct1 {
      char   foo;
   } MyStruct1;

   typedef struct _MyStruct2 {
      long   length;
      [size_is(length)] char* bytes;
   } MyStruct2;

   // A union with structs as arms.
   typedef [switch_type(MyStructEnum)] union {
      [case(MyStructEnum1)]     MyStruct1 myStruct1;
      [case(MyStructEnum2)]     MyStruct2 myStruct2;
   } MyUnion;


</PRE>Change the myUnion field of MyType listed below:
<P>
<PRE>   typedef struct _MyType {
      long                        someData;
      MyStructEnum                whichStruct;
      [switch_is(whichStruct)]    MyUnion myUnion;
   } MyType;


</PRE>to a pointer to MyUnion as follows:
<P>
<PRE>   typedef struct _MyType {
      long                        someData;
      MyStructEnum                whichStruct;
      [switch_is(whichStruct)]    MyUnion *myUnion;
   } MyType;

</PRE><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article. We are researching this bug and will post
new information here in the Microsoft Knowledge Base as it becomes
available.
<P>
<P><h2>REFERENCES</h2>
 
<P>
X/Open DCE: Remote Procedure Call
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: Type, Encoding, Midl, union_arms<BR>
Keywords          : NtwkRpc<BR>
Version           : WINNT:4.0<BR>
Platform          : winnt<BR>
Hardware          : x86<BR>
Issue type        : kbbug<BR>
Solution Type     : kbpending<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 25, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
