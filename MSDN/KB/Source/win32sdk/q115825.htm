

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Accessing the Application Desktop from a Service </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q115825">
<META NAME="KBModify" CONTENT="1995/09/25">
<META NAME="KBCreate" CONTENT="1994/06/05">
<META NAME="Keywords" CONTENT="kbprg">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  Under Windows NT, version 3.1, if you want a service to have access to the application desktop, you must run the service in the LocalSystem account. A service process running in the LocalSystem account (or a process started from such a service) can...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QACK,QBWP,QAI5,QBG2,QAGU,QBWS,QAGI,QA0J,QAJH,QBW7,QAY2,QAL3,QA01,QBVV,QANE V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Accessing the Application Desktop from a Service</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 25, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q115825</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Win32 Application Programming Interface (API) included with:
<P>
<P><PRE>    - Microsoft Windows NT versions 3.5 and 3.51
</UL></PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Under Windows NT, version 3.1, if you want a service to have access to the
application desktop, you must run the service in the LocalSystem account. A
service process running in the LocalSystem account (or a process started
from such a service) can display message boxes, windows, and dialog boxes.
Processes that are running in the LocalSystem account are not terminated by
the system during logoff. A number of changes were made to Windows NT,
version 3.5, that affect the way Windows NT interacts with these services.
In addition, Windows NT 3.51 has a richer set of desktop APIs.
<P>
NOTE: Running interactive services under the system account is a VERY
dangerous practice. This is especially true of the command processor and
batch files. A user who wants to control the system can just hit CTRL+C
to get an interactive system command prompt.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following are new features of Windows NT, version 3.5, that affect
services:

<UL><LI>The account of the logged in user is the only account granted access to
   the application desktop. The LocalSystem no longer has access.
   Therefore, it is possible to get access to the desktop by impersonating
   the user before making any USER or GDI calls.

<LI>Console and GUI applications started from a service process during a
   particular logon session are run on an invisible window station and
   desktop that are unique to that session. The window station and desktop
   are created automatically when the first application in the session
   starts; they are destroyed when the last application exits. There is no
   way to make these invisible desktops visible.

<LI>If you want a service in the localsystem account to interact with the
   logged-on user, specify the SERVICE_INTERACTIVE_PROCESS flag in the call
   to CreateService(). For example:
<P>
<P><PRE>      schService = CreateService(
<PRE></PRE>         schSCManager,
         serviceName,
         serviceName,
         SERVICE_ALL_ACCESS,
         SERVICE_INTERACTIVE_PROCESS | SERVICE_WIN32_OWN_PROCESS,
         SERVICE_DEMAND_START,
         SERVICE_ERROR_NORMAL,
         lpszBinaryPathName,
         NULL,
         NULL,
         NULL,
         NULL,
         NULL );

   If you specify an account other than localsystem when using
   SERVICE_INTERACTIVE_PROCESS, you will get error INVALID_PARAMETER (87).

</PRE><LI>If you use CreateProcess() to launch your process and you want your
   service to log onto the users desktop, assign the lpdesktop parameter of
   the STARTUPINFO struct with "WinSta0\\Default".

<LI>Services that simply need a visible user notification can do this by
   calling MessageBox() with the MB_SERVICE_NOTIFICATION flag. Using the
   MB_DEFAULT_DESKTOP_ONLY flag works as well, but only if the user's
   desktop is active. If the workstation is locked or a screen saver is
   running, the call will fail.
<P>
   NOTE: If you are writing code for an application that can be run as
   either a service or an executable, you can't use MB_SERVICE_NOTIFICATION
   as well as a non-NULL hwndOwner.

<LI>Any output done to a window is not displayed or made available to  the
   application in any way. Attempts to read bits from the display results
   in a failure.

<LI>GUI services do not receive WM_QUERYENDSESSION/WM_ENDSESSION messages
   at logoff and shutdown; instead, they receive CTRL_LOGOFF_EVENT
   and CTRL_SHUTDOWN_EVENT events. These services are not terminated by the
   system at logoff.
<P></UL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.50<BR>
KBCategory: kbprg<BR>
KBSubcategory: BseService<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 25, 1995</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
