

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Validating User Accounts (Impersonation) </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q96005 ">
<META NAME="KBModify" CONTENT="1995/11/02">
<META NAME="KBCreate" CONTENT="1993/03/03">
<META NAME="Keywords" CONTENT="kbprg">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  Some applications need the ability to execute processes in the context of another user. This impersonation restricts (or expands) the permissions of the account in which the application was executed (file access, permission to change system time, p...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAI5,QBWP,QAGU,QBW7,QBG2,QARL,QAK9,QBWG,QAVZ,QAK7,QBUG,QBUF,QAAD,QA5C,QAPN V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Validating User Accounts (Impersonation)</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 2, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q96005 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Win32 Application Programming Interface (API) included with:
<P>
<P><PRE>    - Microsoft Windows NT versions 3.1, 3.5, and 3.51
</UL></PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Some applications need the ability to execute processes in the context of
another user. This impersonation restricts (or expands) the permissions of
the account in which the application was executed (file access, permission
to change system time, permission to shut down the system, and so forth).
<P>
For example, an administrator executes a network server program that allows
remote users to log on to the system and perform actions, as if they were
logged on to the system locally. Because the administrator initiated the
server program and is currently logged on, all actions the server program
performs will be in the security context of the administrator. If a guest
user logs on remotely, he/she will have all the permissions the
administrator account has.
<P>
With the Win32 API under Windows NT 3.1 and 3.5, impersonating a remote
client is possible only via the ImpersonateDDEClientWindow(),
ImpersonateNamedPipeClient() and RpcImpersonateClient() APIs.
<P>
Windows NT 3.51 introduces new Win32 APIs (Logon Support APIs) to deal with
this problem:
<P>
<PRE>   LogonUser
   ImpersonateLoggedOnUser
   CreateProcessAsUser

</PRE><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>For versions of Windows NT prior to 3.51</h3>
 
<P>
A common application of impersonation is network server programs (daemons).
For example, a remote login daemon needs a user to be able to to log in to
a remote host and have the host impose all restrictions of the client login
account.
<P>
If the daemon is using named pipes, dynamic data exchange (DDE), or a
remote procedure call (RPC) (using the named pipes transport), the client
account may be impersonated on the server daemon, which will impose all the
restrictions of the client's user account.
<P>
Using other network interfaces (such as Windows sockets--network
programming interfaces), security cannot be monitored by the system. A
workaround would be to impose password-level security on "login" to the
application. The passwords would be maintained by the application in a
private accounts database. However, none of the user actions are performed
in the security context of the actual client user's account. Therefore,
after the server/daemon has validated the client, the server must be
careful to only perform actions on behalf of the client that the server
knows the client should be allowed to do.
<P>
Another option is to create a network share with restricted access. The
WNetAddConnection2() API can verify access to this system resources [disk
or printer network resource (share)]. If the network share was set up to
allow access by a restricted group of people, the WNetAddConnection2()
could validate actual user accounts, maintained by Windows NT. As with the
previous option, the daemon must be careful to perform only restricted
actions on behalf of the client. This option could be used for file server
daemons.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.10 3.50<BR>
KBCategory: kbprg<BR>
KBSubcategory: BseSecurity<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 2, 1995</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
