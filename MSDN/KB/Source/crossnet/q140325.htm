

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>How to Determine Loss of Client/Server Connection </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q140325">
<META NAME="KBModify" CONTENT="1997/09/10">
<META NAME="KBCreate" CONTENT="1995/11/29">
<META NAME="Keywords" CONTENT="nttcp kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; crossnet">
<META NAME="Description" CONTENT="  This article explains how to use keepalive probes to determine loss of stream connection.  MORE INFORMATION  In the context of this article, the  client  is the peer computer requesting a connection, and the  server  is the peer computer accepting ...">
<META NAME="Product" CONTENT="Networking Issues">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAI5,QBG2,QDL9,QBWO,QBWN,QBWP,QAHE,QBWQ,QARL,QBJZ,QBVV,QDNT,QBDM,QAH6,QADK V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to Determine Loss of Client/Server Connection</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 10, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q140325</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.50 3.51 95
WINDOWS
kbnetwork
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation, versions 3.5 and 3.51
<LI>Microsoft Windows NT Server, versions 3.5 and 3.51
<LI>Microsoft Windows 95
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article explains how to use keepalive probes to determine loss of
stream connection.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
In the context of this article, the "client" is the peer computer
requesting a connection, and the "server" is the peer computer accepting a
connection. This notation does not reflect Client/Server relationships as
an architectural principal.
<P>
Consider the following scenario (half-close connection):
<P>
The client has established stream connection with the server. If client
crashes or a network error occurs (for example, intermediate router goes
down), the server has no way of knowing this, unless it tries to use
send(). In this case, send fails with the WSAECONNRESET error. If the
server does not try to send data to a client, the connection is kept open
on the server side for infinite amount of time.
<P>
Even if WSAAsyncSelect() with the FD_CLOSE parameter is used to determine
loss of connection, event notification is not triggered. No events get
posted because virtual circuit never go to a FIN WAIT or CLOSE WAIT state
(crashed client never called shutdown or closesocket).
<P>
This situation can be avoided if keepalive probe packets are used. Note
that keepalive probe packets are not a required part of the TCP
specification. Keepalive packets are used to probe a connection that has
been inactive for a long time. The peer initiates a disconnect when the
probes do not get through. Keepalive packets for TCP connection can be
turned on by using setsockopt() call with SO_KEEPALIVE option.
<P>
The following registry entries control keepalive probe packet parameters on
computers running Windows NT or Windows 95 (note that not all of the
entries can be found in the registry by default). Changing registry
parameters affects all TCP/IP stream connections on the system.
<P>
KeepAliveInterval - This parameter determines the interval separating keep
alive retransmissions until a response is received.
<P>
KeepAliveTime - This parameter controls how often TCP attempts to verify
that an idle connection is still intact by sending a keep alive packet.
<P>
TcpMaxDataRetransmissions - This parameter controls the number of times TCP
will retransmit an individual data segment (non-connect segment) before
aborting the connection.
<P>
NOTE:  The TcpMaxDataRetransmission parameter is NOT a valid setting under
Windows 95.  See <B><A HREF="../zMiscellaneous/Q158474.htm">Q158474</A></B> for valid TCP/IP registry parameters in
Windows 95.
<P>
The above entries are found in following registry locations:
<P>
<P><h3>Windows 95</h3>
 
<P>
<PRE>   \HKEY_LOCAL_MACHINE
    \System
     \CurrentControlSet
      \Services
       \VxD
        \MSTCP

</PRE>NOTE: To make the appropriate changes to the value above in the registry
under Windows 95, go to the above location, click the Edit menu, point to
New, and click String Value.
<P>
<P><h3>Windows NT</h3>
 
<P>
<PRE>   \HKEY_LOCAL_MACHINE
    \System
     \CurrentControlSet
      \Services
       \TCPIP
        \Parameters

</PRE>NOTE: To make the appropriate changes to the values above in the registry
under Windows NT, go to the above location, click Add Value on the Edit
menu. The Data Type should be REG_DWORD.
<P>
For information on how to configure above entries, please see the following
article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../WINNT/Q102973.htm">Q102973</A></B>
   TITLE     : REG: TCP/IP Transport Entries, PART 1
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbnetwork<BR>
KBSubcategory: nttcp<BR>
Additional reference words: prodnt 3.50 3.51 95<BR>
Keywords          : nttcp kbnetwork<BR>
Version           : 3.50 3.51 95<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 10, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
