

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>XL: Cannot Use MS-DOS Core Commands From Shell Function </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q149570">
<META NAME="KBModify" CONTENT="1998/02/27">
<META NAME="KBCreate" CONTENT="1996/04/04">
<META NAME="Keywords" CONTENT="kbprg xlwin">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  In the versions of Microsoft Excel listed at the beginning of this article, when you use the Shell function in a Visual Basic for Applications macro to execute an external MS-DOS call, if you use commands contained only in the MS-DOS core, you rece...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBVP,QAB9,QBV8,QBS0,QAFI,QAVI,QBIC,QAY5,QATJ,QAB4,QDL9,QBXB,QBWQ,QBWO,QBWN P1 P2 P3 P4 P5 P6 T2 P7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XL: Cannot Use MS-DOS Core Commands From Shell Function</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 27, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q149570</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft Excel for Windows, version 5.0
<LI>Microsoft Excel for Windows 95, version 7.0
<LI>Microsoft Excel 97 for Windows
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
In the versions of Microsoft Excel listed at the beginning of this
article, when you use the Shell function in a Visual Basic for
Applications macro to execute an external MS-DOS call, if you use
commands contained only in the MS-DOS core, you receive the following
error message:
<P>
<PRE>   Invalid Procedure Call

</PRE>The commands that return this error message are the following:
<P>
<PRE>   DIR, CLS, DEL, CD, MD, RD, MKDIR, RMDIR, COPY

</PRE><h2>CAUSE</h2>
 
<P>
This problem occurs because the Shell function in Microsoft Excel does
not start a specific instance of the MS-DOS command interpreter
(Command.com). Therefore, the MS-DOS core commands are not present. Only
files that have an .exe, .com or .bat extension can be executed through
the Shell function.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To work around this problem, perform the commands that cause the error
message from within Microsoft Excel.
<P>
You can perform most of the functions that are provided by Command.com
through commands included in Microsoft Excel Visual Basic for
Applications. Some common core MS-DOS commands and their Microsoft Excel
equivalents are listed below.
<P>
<PRE>MS-DOS command                       Microsoft Excel command
</PRE> 
<PRE>DEL [drive][path]filename            Kill "[drive][path]filename"
CD [drive][path]                     ChDir "[drive][path]"
MD [drive][path]directory name       MkDir "[drive][path]directory name"
RD [drive][path]directory name       RmDir "[drive][path]directory name"
COPY [source] [destination]          FileCopy "[source]","[destination]"
DIR [path]                           Dir("[path]",[attributes])

</PRE>NOTE: The Visual Basic for Applications Dir command does not function
identically to its MS-DOS equivalent, and requires extra code to
retrieve an entire directory.
<P>
For more information about the Dir command in Visual Basic for
Applications, click the Index tab in Microsoft Excel Help, type the
following text
<P>
<PRE>   dir

</PRE>and then double-click the selected text to go to the "Dir function"
topic.
<P>
In cases where it is absolutely essential to use one of the MS-DOS core
commands, it is possible to invoke an instance of the command
interpreter manually and pass it the desired command. To do this, use
the following syntax:
<P>
<PRE>   a = Shell("command.com /c [command]", [WindowStyle])

</PRE>NOTE: you must include /c for the command to be executed correctly. For
example, to perform a directory command of all hidden files in the root
directory, use the following syntax:
<P>
<PRE>   Shell("command.com /c dir c:\ /ah", 1)

</PRE><h2>MORE INFORMATION</h2>
 
<P>
In a normal MS-DOS session when you are using Windows 3.1 or Windows 95,
the MS-DOS command interpreter, Command.com, is present to handle core
commands. To show that the MS-DOS command interpreter, Command.com, is
not in memory, use the following Visual Basic for Applications command:
<P>
<PRE>   a = Shell("MEM /C /P", 1)

</PRE>Compare this to the output of the MEM command when you run it from an MS-
DOS session under Windows or Windows 95. The only difference is that
Command.com is not in memory within the environment created by the
Visual Basic for Applications Shell function.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 5.00 5.00c 7.00 97 8.00 XL97<BR>
Keywords          : kbprg xlwin<BR>
Version           : WINDOWS:5.x,7.0,97<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 27, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
