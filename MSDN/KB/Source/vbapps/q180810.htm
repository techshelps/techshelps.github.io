

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>VBA: Run-Time Error 3085 Using DAO </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q180810">
<META NAME="KBModify" CONTENT="1998/02/16">
<META NAME="KBCreate" CONTENT="1998/02/10">
<META NAME="Keywords" CONTENT="kbcode kbprg">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  Advanced: Requires expert coding, interoperability, and multiuser skills.  When you use data access objects (DAO) in a Microsoft Office program to open a Microsoft Access query, you receive the following error message:     Run-time error '3085':   ...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA1S,QBS0,QBJZ,QAH4,QAB4,QDN9,QDKX,QAY5,QBWS,QBVP,QAPF,QAB9,QDNJ,QDKY,QAZV P1 P2 P3 P4 P5 P6 T2 P7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>VBA: Run-Time Error 3085 Using DAO</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 16, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q180810</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic for Applications version 5.0
<LI>Microsoft Access versions 7.0, 97
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Advanced: Requires expert coding, interoperability, and multiuser skills.
<P>
When you use data access objects (DAO) in a Microsoft Office program to
open a Microsoft Access query, you receive the following error message:
<P>
<PRE>   Run-time error '3085':
   Undefined function &lt;function name&gt; in expression.

</PRE><h2>CAUSE</h2>
 
<P>
You are using DAO to open a query in Microsoft Access that contains a user-
defined function.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
You can only refer to Microsoft Jet objects that are only dependent on
other Microsoft Jet objects when using DAO in other Microsoft Office
programs.
<P>
The following steps demonstrate this problem by creating a query in
Microsoft Access that calls a user-defined function and then attempting to
open a recordset on that query using DAO in Microsoft Excel.
<P>
Steps to Reproduce Behavior
 
<P>
CAUTION: Following the steps in this example will modify the sample
database Northwind.mdb. You may want to back up the Northwind.mdb file and
perform these steps on a copy of the database.

<OL><P><LI>Open the sample database Northwind.mdb in Microsoft Access.

<P><LI>Create a module and type the following procedure:
<P>
<P><PRE>      Function IsInternational(strCountry As String) As String
<PRE></PRE>         If strCountry = "USA" Then
            IsInternational = "Local"
         Else
            IsInternational = "Intl"
         End If
      End Function

</PRE><P><LI>Create a new query based on the Customers table as follows:
<P>
<P><PRE>      Query: qryExcelTest
      ---------------------------------------------------------
      Type: Select Query
</PRE><P>
<P><PRE>      Field: CompanyName
<PRE></PRE>         Table: Customers
      Field: Country
         Table: Customers
      Field: Expr1: IsInternational([Country])

</PRE><P><LI>Quit Microsoft Access.

<P><LI>In Microsoft Excel, create a new workbook.

<P><LI>On the Tools menu, point to Macros, and then click Visual Basic Editor.
   In the Visual Basic Editor, insert a new module sheet by clicking
   Module on the Insert menu. Type the following sample macro (Sub
   procedure).
<P>
<PRE>      Sub xlTest()
         Dim db As Database, rs1 As Recordset
         Dim qry As QueryDef
         Set db = Workspaces(0).OpenDatabase _
         ("C:\Program Files\Microsoft Office\Office\Samples\Northwind.mdb")
            ' Replace the above path with the correct path to the
            ' sample Northwind.mdb database on your computer.
         Set qry = db.QueryDefs("qryExcelTest")
         Set rs1 = qry.OpenRecordset
         rs1.MoveLast
         rs1.Close
         db.Close
      End Sub

</PRE><P><LI>On the Tools menu, click References. Click to select the "Microsoft DAO
   3.5 Object Library" check box, and then click OK.

<P><LI>Run the macro titled "xlTest."
<P>
   Note that you receive the error message noted in the "Symptoms" section
   of this article.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prb<BR>
Keywords          : kbcode kbprg<BR>
Version           : WINDOWS:5.0,7.0,97<BR>
Platform          : WINDOWS<BR>
Issue type        : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 16, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
