

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>XL: "Formula Not Valid" Converting or Assigning Valid Formula </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q124886">
<META NAME="KBModify" CONTENT="1998/02/03">
<META NAME="KBCreate" CONTENT="1995/01/15">
<META NAME="Keywords" CONTENT="kbprg PgmOthr">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  In Microsoft Excel, when you use the Formula property or the ConvertFormula  method in a Visual Basic for Applications procedure, you may receive the  one of the following error messages when you run the procedure, even if the  formula that you ass...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBVP,QAB9,QAPN,QAB4,QBS0,QAB3,QABN,QAAP,QBFM,QAJQ,QAWN,QBFY V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XL: "Formula Not Valid" Converting or Assigning Valid Formula</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 3, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q124886</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Excel for Windows, versions 5.0, 5.0c
<LI>Microsoft Excel for the Macintosh, versions 5.0, 5.0a
<LI>Microsoft Excel for Windows NT, version 5.0
<LI>Microsoft Excel for Windows 95, version 7.0, 7.0a
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
In Microsoft Excel, when you use the Formula property or the ConvertFormula 
method in a Visual Basic for Applications procedure, you may receive the 
one of the following error messages when you run the procedure, even if the 
formula that you assign or convert is valid: 
<P>
<PRE>   Microsoft Excel, version 7.0
   ----------------------------

   Run-time error '1005':
   Error in formula

   Microsoft Excel, version 5.0
   ----------------------------

   Run-time error '1005':
   Formula is not valid

</PRE><h2>CAUSE</h2>
 
<P>
This problem occurs when you assign a formula using the Formula property,
because Microsoft Excel converts the A1-style notation formula to R1C1-
style notation. The error message appears if the resulting formula in the
R1C1-style notation exceeds 255 characters, the character limit for a cell
in Microsoft Excel. Note that a formula in R1C1 notation generally contains
more characters than the same formula in A1 notation.
<P>
When you use the ConvertFormula method to convert a formula from A1 to R1C1
reference styles, from relative to absolute references, or both, you may
also receive this error message because the converted formula exceeds the
255 character limit.
<P>
When you assign a formula using the FormulaR1C1 property, the 255 character
limit applies as expected. However, when you assign a formula using the
Formula property, the 255 character limit applies to the size of the
resulting R1C1 formula, not just the size of the A1-style notation formula
itself.
<P>
When Microsoft Excel converts a formula from A1-style notation to R1C1-
style notation (note that this occurs when you use the Formula property or
the ConvertFormula method), the length of the R1C1 reference is assumed to
be equal to the number of characters used for the column and row numbers
plus six (for the letters "r" and "c" and two pairs of square brackets).
This is generally correct for relative references. For example, a formula
in cell A1 that references cell B2 is written as R[1]C[1]. However, this
assumption adds unnecessary characters in some cases. For example, a
formula in cell A1 that references cell A2 uses as many characters as the
reference R[1]C[0], instead of using only the necessary characters in the
reference R[1]C.
<P>
When you use an absolute reference, the length of the formula may also be
larger than it needs to be. For example, $A$2 is converted to R2C1,
requiring the same number of characters. However, the Formula property and
the ConvertFormula method will assume that 8 characters are required.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To avoid this error when you use the Formula property or the
ConvertFormula method with a long A1 style formulas, especially using
absolute references, use any of the following methods.
<P>
<P><h3>Method 1</h3>
 
<P>
Use R1C1-style references in your formula instead of A1-style references so 
that you can count on the expected limit of 255 characters.
<P>
NOTE: If possible, you should also use absolute references rather than 
relative references. 
<P>
<P><h3>Method 2</h3>
 
<P>
Use shorter formulas when possible.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the versions of Microsoft
Excel listed at the beginning of this article. This problem was corrected 
in Microsoft Excel 97 for Windows and Microsoft Excel 98 Macintosh Edition.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For more information about the Formula Property, choose the Search
button in the Visual Basic Reference and type:
<P>
<PRE>    Formula Property

</PRE>For more information about the ConvertFormula Method, choose the
Search button in the Visual Basic Reference and type:
<P>
<PRE>    ConvertFormula Method
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 5.00 5.00a 5.00c 7.00 7.00a XL5 XL7<BR>
Keywords          : kbprg PgmOthr<BR>
Version           : WINDOWS:5.0,5.0c,7.0,7.0a; MACINTOSH:5.0,5.0a<BR>
Platform          : MACINTOSH WINDOWS<BR>
Issue type        : kbbug<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 3, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
