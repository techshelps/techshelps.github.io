

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>XL7: How to Create a Form Letter with a Visual Basic Macro </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q138283">
<META NAME="KBModify" CONTENT="1997/09/02">
<META NAME="KBCreate" CONTENT="1995/10/16">
<META NAME="Keywords" CONTENT="kbprg PgmHowTo xlwin kbinterop kbole kbprg">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  When you use OLE Automation to communicate from one program to another, you can complete many useful tasks without having to leave the client program. For example, perhaps you store data in Microsoft Excel, but you would like to create form letters...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBVP,QAIH,QAH4,QBS0,QDME,QBTS,QBTO,QAUR,QA4B,QAUJ,QAYY,QAPF,QALI,QAUD,QBFY V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XL7: How to Create a Form Letter with a Visual Basic Macro</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 2, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q138283</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Excel for Windows 95, version 7.0
<LI>Microsoft Word for Windows 95, version 7.0
</UL> 
<P>
SUMMARY
 
<P>
When you use OLE Automation to communicate from one program to another, you
can complete many useful tasks without having to leave the client program.
For example, perhaps you store data in Microsoft Excel, but you would like
to create form letters in Microsoft Word using this data. The example
provided in the "More Information" section of this article shows how you
can perform this task programmatically.
<P>
Note that you may experience problems running a macro in Microsoft Excel if
you are using a Microsoft Excel data source to perform a mail merge in
Microsoft Word. The resolution to this problem is to save the Microsoft
Excel file as a Word document and to use the Word document as the source of
the data. In the macro example provided below, the macro saves the
Microsoft Excel data file to a Word document.
<P>
For additional information about this problem, please see the following
article in the Microsoft Knowledge Base:
<P>
<PRE>    ARTICLE-ID: <B><A HREF="../vbapps/Q138289.htm">Q138289</A></B>
    TITLE     : XL7: Error Using OLE Automation with Microsoft
                Word 7.0

</PRE><h2>MORE INFORMATION</h2>
 
<P>
Microsoft provides examples of Visual Basic for Applications procedures for
illustration only, without warranty either expressed or implied, including,
but not limited to the implied warranties of merchantability and/or fitness
for a particular purpose. The Visual Basic procedures in this article are
provided 'as is' and Microsoft does not guarantee that they can be used in
all situations. While Microsoft Product Support Services (PSS) Engineers
can help explain the functionality of a particular macro, they will not
modify these examples to provide added functionality, nor will they help
you construct macros to meet your specific needs. If you have limited
programming experience, you may want to consult one of the Microsoft
Solution Providers. Solution Providers offer a wide range of fee-based
services, including creating custom macros. For more information about
Microsoft Solution Providers, call Microsoft Customer Information Service
at (800) 426-9400.
<P>
To use the following macro, you will need to set up the data source in
Microsoft Excel. To do so, perform the following steps:

<OL><P><LI>Create a new, blank Microsoft Excel workbook.

<P><LI>Enter the following data on the worksheet:
<P>
<PRE>   A1: NAME        B1: ADDRESS      C1: CITY    D1: STATE    E1: ZIP_CODE
   A2: John Smith  B2: 1 Way Avenue C2: Kent    D2: NC       E2: 11111
   A3: Mary Lynn   B3: Do Drive     C3: Poluk   D3: SC       E3: 22222
   A4: Peter Paul  B4: Fest Drive   C4: Low     D4: FL       E4: 33333

</PRE><P><LI>Save the file as Testdata.xls in the root directory of the C drive,
   and then close the workbook.

<P><LI>In another workbook, type the following macro code on a module sheet:
<P>
<PRE>      Sub Do_It_All_Form_Letter()
      Dim word As Object

      Set word = CreateObject("word.basic") 'creates the word object

         With word
            .AppShow ' Makes Word Visible

            'Sends keystrokes to the Open Worksheet dialog box
            SendKeys "{TAB}{TAB}{TAB}{ENTER}"

            'Opens the Microsoft Excel file
            .FileOpen Name:="c:\testdata.xls"

            'Saves the file as a Microsoft Word document
            .FileSaveAs Name:="c:\testdata.doc", Format:=0

            .FileClose 'Closes the file
            .FileNewDefault ' Opens up blank Word document

            'Makes the active window a main document
            .MailMergeMainDocumentType 0

            'Open the data source
            .MailMergeOpenDataSource Name:="c:\testdata.doc", _
            LinkToSource:=0

            'Activates the mail merge main document
            .MailMergeEditMainDocument

   'The following Insert commands place text into the Word
   'document. You could change these commands to place any text in
   'the document. This example uses a typical business letter
   'format.

            .Insert "3454 Blindside St."    'Inserts a string
            .InsertPara                     'Inserts a carriage return
            .Insert "Columbia, GA 23287"
            .InsertPara
            .InsertPara

      'the mergefields are the same as the column headings in the Excel
      'workbook
      .InsertMergeField MergeField:="NAME"
           .InsertPara
           .InsertMergeField MergeField:="ADDRESS"
           .InsertPara
           .InsertMergeField MergeField:="CITY"
           .Insert ", "
           .InsertMergeField MergeField:="STATE"
           .Insert " "
           .InsertMergeField MergeField:="ZIP_CODE"
           .InsertPara
           .InsertPara
           .InsertPara
           .Insert "Dear "
           .InsertMergeField MergeField:="NAME"
           .Insert ","
           .InsertPara
           .InsertPara
           .Insert "Thank You For Your Support."
           .InsertPara
           .InsertPara
           .InsertPara
           .Insert "Sincerely,"
           .InsertPara
           .InsertPara
           .InsertPara
           .Insert "John M. Doe"
           .MailMergeToDoc 'Merges data records with the main document
           ' Saves the active document with the specified name
      .FileSaveAs Name:="c:\letters.doc"

      End With

   Set word = Nothing 'clears the object variable

   End Sub

</PRE><P><LI>Run the macro.
<P>
</OL>The sample file Letters.doc is now available on the root directory of the
computer's C drive.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For more information about OLE Automation, click the Index tab in
Microsoft Excel Help, and type the following text:
<P>
<PRE>   OLE
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 7.00 mail merge<BR>
Keywords          : kbprg PgmHowTo xlwin kbinterop kbole kbprg<BR>
Version           : 7.00<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 2, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
