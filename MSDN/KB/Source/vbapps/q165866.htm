

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>XL97: How to Use File DSNs and DSN-less Connections </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q165866">
<META NAME="KBModify" CONTENT="1998/02/27">
<META NAME="KBCreate" CONTENT="1997/03/26">
<META NAME="Keywords" CONTENT="kbprg kbualink97">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  When you use a connection string that does not use a data source name (a DSN-less connection string) to connect to an external data source in Microsoft Excel 97, information that is required to connect to the external data source is stored in the f...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBI0,QAK6,QBVP,QA9E,QAYY,QAI5,QAU9,QBG2,QAC9,QDKX,QBWS,QBWD,QAUJ,QAFI,QAGT P1 P2 P3 P4 P5 P6 T2 P7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XL97: How to Use File DSNs and DSN-less Connections</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 27, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q165866</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Excel 97 for Windows
<LI>Microsoft Query 97 for Windows
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
When you use a connection string that does not use a data source name (a
DSN-less connection string) to connect to an external data source in
Microsoft Excel 97, information that is required to connect to the external
data source is stored in the file structure of the workbook instead of in
the data source name. Microsoft Query 97 and Microsoft Excel 97 use this
kind of DSN-less connection; earlier versions of Microsoft Query and
Microsoft Excel do not.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Why Are DSN-less Connections Important?</h3>
 
<P>
In earlier versions of Microsoft Excel, retrieving external data requires
that you create a data source. The data source name and other information
that is required to connect to the data are stored in hidden names in the
worksheet. Therefore, when a workbook that contains references to external
data is shared among multiple users, the data source name that is
referenced in the connection string must exist on each user's computer.
Otherwise, you may receive an error message when you update or edit the
external data.
<P>
In Microsoft Excel 97, once the data is returned to a worksheet, the
Structured Query Language  (SQL) statement and driver information that is
generated from the initial data source (not the data source name) is stored
with the worksheet in the file structure of the workbook. These DSN-less
connections resolve the issue of maintaining data sources on several
computers. All of the necessary information is stored in the workbook
itself. However, a copy of the appropriate Open Database Connectivity
(ODBC) driver must be installed on each computer for the queries to
function.
<P>
<P><h3>What Does a DSN-less Connection String Look Like?</h3>
 
<P>
The following is an example of a DSN-less connection string:
<P>
<PRE>   DBQ=C:\TEST\QUERY FILES;DefaultDir=C:\TEST\QUERY FILES; _
   Deleted=1;Driver={Microsoft dBase Driver (*.dbf)}; _
   DriverId=277;FIL=dBase IV;PageTimeout=600;Statistics=0

</PRE>Note that there are no references to the DSN keyword in the text.
<P>
<P><h3>More About Data Source Files</h3>
 
<P>
Microsoft Query version 2.0 stores data source information in the registry.
Microsoft Query 97 does not use the registry to store data source
information. Instead, when you create a new data source, the connection
information is stored in a text file with a .dsn file name extension. This
file is also known as a File DSN.
<P>
Each File DSN contains an ODBC section and an optional Microsoft Office
section that may contain information, such as the default table, password,
and user ID for a given data source. The following is the default folder
that is used when you save a File DSN:
<P>
<PRE>   C:\Program Files\Common Files\ODBC\Data Sources

</PRE>The following is the default folder that is used when you save a query:
<P>
<PRE>   C:\Program Files\Microsoft Office\Queries

</PRE>You can specify which folders are included in the search for File DSNs,
including network locations.
<P>
The following is an example File DSN that uses the Microsoft Access 7.0
Database driver (an ODBC driver included with Microsoft Office 97):
<P>
<PRE>   [ODBC]
   DSN=MS Access 7.0 Database

</PRE>When you create a File DSN that references a file that is located on the
network and you map the network drive to a specific drive letter, that
drive letter is specified in the File DSN. This behavior may cause problems
if you want to share the File DSN with multiple users across the network
and you want to maintain the File DSN on a server where all users can
access it. To work around this problem, use either of the following
methods.
<P>
<P><h3>Method 1</h3>
 
<P>
Whenever possible, use a universal naming convention (UNC) reference
instead of a mapped drive.
<P>
<P><h3>Method 2</h3>
 
<P>
Open the File DSN in Notepad and modify the references to the drive letter
to use a UNC reference. Consider the following example:
<P>
<PRE>   [ODBC]
   DRIVER=Microsoft Excel Driver (*.xls)
   UID=admin
   UserCommitSync=Yes
   Threads=3
   SafeTransactions=0
   ReadOnly=1
   PageTimeout=5
      MaxScanRows=8
   MaxBufferSize=512
   ImplicitCommitSync=Yes
   FIL=excel 5.0
   DriverId=790
   DefaultDir=&lt;drive letter&gt;:\
   DBQ=&lt;drive letter&gt;:\&lt;source filename&gt;

</PRE>In this example, &lt;drive letter&gt; is the mapped drive and &lt;source filename&gt;
is the source data file.
<P>
Change the last two lines to the following
<P>
<PRE>   DefaultDir=\\&lt;server name&gt;\&lt;share&gt;
   DBQ=\\&lt;server name&gt;\&lt;share&gt;\&lt;source filename&gt;

</PRE>Where &lt;server name&gt; is the network server, &lt;share&gt; is the share on the
network server, and &lt;source filename&gt; is the source data file.
<P>
After you modify the file, all users can successfully use the File DSN.
<P>
For more information about the driver information in the File DSN, please
see the Help file that is specific to the ODBC driver you are using.
<P>
You can also use the 32-bit ODBC Control Panel icon to create a File DSN.
To do this, use the following steps:

<OL><P><LI>On the Start menu, point to Settings, and click Control Panel. Then,
   double-click 32bit ODBC.

<P><LI>Click the File DSN tab.

<P><LI>Click Add.

<P><LI>In the Create New Data Source dialog box, click the driver for which
   you want to create the data source. Click Next.

<P><LI>Enter the full path and file name for your new data source (for
   example, C:\Program Files\Common Files\ODBC\Data Sources\Test.dsn).
   Then, click Next.

<P><LI>Click Finish.
<P>
   The ODBC Setup dialog box for the ODBC driver you selected in step 4
   appears.

<P><LI>In the dialog box, enter the appropriate information.
<P>
   NOTE: If you do not want a specific drive letter to be included in the
   File DSN, enter the UNC path in the Database Name box in the Select
   Database dialog box.

<P><LI>Click OK.

<P><LI>Click OK to close the ODBC Data Source Administrator dialog box.
<P>
</OL>The File DSN is available for use by Microsoft Query.
<P>
<P><h3>Microsoft Query 97 Information in the Registry</h3>
 
<P>
Microsoft Query 97 automatically registers itself if the path value for
Query is missing in the registry key, or if path value specifies a folder
that that does not contain the file. You can reset the location for
Microsoft Query 97 in the registry by starting Microsoft Query 97. In
Microsoft Windows 95, you can locate Microsoft Query 97 by looking in the
following registry key:
<P>
<PRE>   HKEY_LOCAL_MACHINE\Software\Microsoft\Shared Tools\MSQuery

</PRE></OL>When you install Microsoft Office 97, the Setup program creates a registry
key that points to the default location for DSN files. This location is
stored in the following registry key:
<P>
<PRE>   HKEY_LOCAL_MACHINE\Software\ODBC\odbc.ini\ODBC File DSN\DefaultDSNDir

</PRE>You can specify an alternative location for the DSN files by adding the
following registry key.
<P>
<PRE>   HKEY_CURRENT_USER\Software\ODBC\odbc.ini\ODBC File DSN\DefaultDSNDir

</PRE>After you create this key, the key under HKEY_LOCAL_MACHINE is ignored.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For more information about retrieving data, click the Office Assistant,
type "data sources," click Search, and then click to view "Ways to retrieve
data from an external database."
<P>
NOTE: If the Assistant is hidden, click the Office Assistant button on the
Standard toolbar. If Microsoft Excel Help is not installed on your
computer, please see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../OFFICE/Q120802.htm">Q120802</A></B>
   TITLE     : Office: How to Add/Remove a Single Office Program or
               Component

</PRE>For additional information, please see the following article in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../vbapps/Q159557.htm">Q159557</A></B>
   TITLE     : XL97: Using System, User, and File Data Sources
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: XL97 xl97vbmigrate<BR>
Keywords          : kbprg kbualink97<BR>
Version           : WINDOWS:97<BR>
Platform          : WINDOWS<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 27, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
