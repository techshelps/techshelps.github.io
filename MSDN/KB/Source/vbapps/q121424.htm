

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>How to Install Simple MAPI in Your VBApp Application </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q121424">
<META NAME="KBModify" CONTENT="1997/09/17">
<META NAME="KBCreate" CONTENT="1994/10/04">
<META NAME="Keywords" CONTENT="kbcode kbfile kbinterop kbprg">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  This article contains information on how to implement Simple MAPI in your Visual Basic for Applications application. Note that this information is not needed for using MAPI in Visual Basic version 3.0. Users of Microsoft Visual Basic should use eit...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QAL7,QAX3,QBVP,QAYC,QAJH,QAY5,QAH4,QA5F,QAMA,QAPN,QAV5,QBV8,QAB9,QDL9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to Install Simple MAPI in Your VBApp Application</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 17, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q121424</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Programming System, Applications Edition,
   version 1.0
<LI>Microsoft Excel for Windows, versions 5.0, 5.0c
<LI>Microsoft Project for Windows, version 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article contains information on how to implement Simple MAPI in your
Visual Basic for Applications application. Note that this information is
not needed for using MAPI in Visual Basic version 3.0. Users of Microsoft
Visual Basic should use either the MSMAPI.VBX custom controls, or refer to
the Microsoft Mail Technical Reference.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The Simple Messaging Application Programming Interface (MAPI) is a set of
messaging functions that help you create messaging-enabled applications. It
is a subset of MAPI, which provides complete access to messaging and
information exchange systems.
<P>
With Simple MAPI, you can:

<UL><LI>Log on and off the messaging system.

<LI>Find and read messages.

<LI>Address new messages by adding recipients to the messages.

<LI>Add attachments to messages.

<LI>Save and send messages.
<P>
</UL>Simple MAPI functions are available for Microsoft C languages and Microsoft
Visual Basic. This article discusses extensions to the Visual Basic
implementation to support Visual Basic for Applications. The Simple MAPI
function names, parameters, and return values are identical for both
Visual Basic and Visual Basic for Applications.
<P>
NOTE: For information on the C or Visual Basic implementations of Simple
MAPI, please see the Microsoft Mail Technical Reference.
<P>
<P><h3>Requirements for Simple MAPI for Visual Basic for Applications</h3>
 
<P>
To use Simple MAPI for Visual Basic for Applications, you need:

<UL><LI>An application that includes Visual Basic for Applications, such as:
<P>
<P><PRE>    - Microsoft Excel for Windows version 5.0 or later
    - Microsoft Project for Windows version 4.0 or later
    - Microsoft Windows for Workgroups version 3.1 or later
</PRE><P>
   -or-

<LI>Microsoft Windows version 3.1 or later and Microsoft Mail for PC
   Networks version 3.0 or later.
<P>
</UL>You can use the Mail client application from Microsoft Windows for
Workgroups with the Microsoft Windows for Workgroups post office, the
Microsoft Mail for PC Networks post office, Microsoft Mail Remote, or with
a variety of MAPI-compatible messaging service providers.
<P>
NOTE: To use Simple MAPI with earlier versions of Microsoft Excel or
Microsoft Project, use the Workgroup Extensions for Microsoft Excel or the
Workgroup Extensions for Microsoft Project. These extension libraries are
available in Microsoft Office Developer's Kit.
<P>
<P><h3>Components of Simple MAPI for Visual Basic for Applications</h3>
 
<P>
The Simple MAPI for Visual Basic for Applications library includes the
following four files:
<P>
<PRE> VBAMAPI.DLL    Simple MAPI for Visual Basic for Applications run-time
                library

 VBAMAPI.TXT    Simple MAPI function and variable declarations

 VBAMAPI2.TXT   Additional function declarations for logon, logoff, and
                error checking

 MAPIVB.HLP     Documentation for Simple MAPI functions for Visual Basic
                and Visual Basic for Applications

</PRE>The following file is available for download from the Microsoft
Software Library:
<P>
<PRE> ~ <A HREF="http://support.microsoft.com/download/support/mslfiles/VBAMAPI.EXE">VBAMAPI.EXE</A> <I>(size: 69050 bytes)</I> 

</PRE>For more information about downloading files from the Microsoft Software
Library, please see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../zMiscellaneous/Q119591.htm">Q119591</A></B>
   TITLE     : How to Obtain Microsoft Support Files from Online Services

</PRE><h3>Installing Simple MAPI for Visual Basic for Applications</h3>
 
<P>
To use Simple MAPI for Visual Basic for Applications, copy VBAMAPI.DLL to
the Windows System directory (usually C:\WINDOWS\SYSTEM). All users require
this file. VBAMAPI.DLL is a run-time library that you can freely copy to
any system. Your users may require client, node, or end-user licenses for
the messaging system you use.
<P>
Only developers require the other files. You can copy them to any
directory.
<P>
<P><h3>Developing Applications with Simple MAPI for Visual Basic for Applications</h3>
 
<P>
To develop messaging applications with Simple MAPI for Visual Basic for
Applications:

<OL><P><LI>Include the Simple MAPI for Visual Basic for Applications declarations
   in your module.

<P><LI>Include correct logon and logoff functions in your module.

<P><LI>Refer to the Simple MAPI documentation for information about Simple
   MAPI data types and functions.
<P>
</OL><h3>Including Simple MAPI Declarations</h3>
 
<P>
VBAMAPI.TXT includes the required declarations for Simple MAPI data types,
functions and constants. You must include these declarations in your module
to use Simple MAPI.
<P>
Microsoft Project version 4.0 already includes these declarations in the
global file (GLOBAL.MPT). For Microsoft Excel version 5.0, you must add a
module for the Simple MAPI declarations.
<P>
To add a module in Microsoft Excel:

<OL><P><LI>Open a new or existing workbook.

<P><LI>From the Insert menu, choose Macro Module.

<P><LI>Move the insertion point to the end of the new module (after any
   Option statements), and choose File from the Insert menu.

<P><LI>In the Insert File dialog box, choose VBAMAPI.TXT.
<P>
</OL><h3>Logging On and Off Mail Sessions</h3>
 
<P>
Microsoft Excel and Microsoft Project both include MailLogon and MailLogoff
methods, so you should use these methods instead of the Simple MAPI
MAPILogon and MAPILogoff functions.
<P>
In addition, Microsoft Excel and Microsoft Project provide a MailSession
property that maintains the application's mail session, and the MailSystem
property that identifies the current messaging system.
<P>
The file VBAMAPI2.TXT includes functions that use these built-in mail
methods and properties. You can insert the example code listed in this
section into your macro.
<P>
<P><h3>Logging On a Mail Session</h3>
 
<P>
You should add the following DoMailLogon function to your macro to log on a
mail session. Because the MailLogon method logs off any existing session
before logging on the new session, the function first checks to see whether
a valid session already exists.
<P>
<PRE>'********************************************************************
'DoMailLogon() uses the application's mail logon method
'rather than MAPILogon()
'********************************************************************
</PRE></OL>Function DoMailLogon() As Long
<PRE>   ' Log on to Mail if not logged on already:
   If IsNull(Application.MailSession) Then
      Application.MailLogon
   End If
   ' Convert the hex string session handle to a long integer:
   DoMailLogon = CLng("&amp;h" &amp; Application.MailSession)
</PRE>End Function
<P>
<P><h3>Logging Off a Mail Session</h3>
 
<P>
Add the following DoMailLogoff function to your macro to log off the mail
session. This function only logs off if a valid mail session actually
exists.
<P>
<PRE>'********************************************************************
'DoMailLogoff uses the application's mail logoff method
'rather than MAPILogoff()
'********************************************************************
Sub DoMailLogoff()
   ' Logoff from Mail if logged on:
   If Not IsNull(Application.MailSession) Then
      Application.MailLogoff
   End If
End Sub

</PRE><h3>Simple MAPI Documentation</h3>
 
<P>
The MAPIVB.HLP file provides documentation for Simple MAPI for both Visual
Basic and Visual Basic for Applications. This documentation is also
available in the Microsoft Mail Technical Reference. You can refer to this
documentation to see what MAPI functions you need to use in your own macros
and how to call them.
<P>
<P><h3>How to Determine if MAPI Is Available</h3>
 
<P>
If you plan to distribute your macro to users of diverse messaging systems,
your macro should determine if MAPI is available before using any Simple
MAPI functions. In Microsoft Excel and Microsoft Project, the MailSystem
property identifies the user's current messaging system.
<P>
<P><h3>How to Display Simple MAPI Errors</h3>
 
<P>
The file VBAMAPI2.TXT includes the GetMAPIErrorText function, which you can
use to convert MAPI integer error codes to strings.
<P>
<P><h3>Alternatives to Simple MAPI</h3>
 
<P>
Not all applications need the full functionality of Simple MAPI. Microsoft
Excel and Microsoft Project provide built-in messaging functionality that
is easier to use for less complicated tasks. In Excel, you can use the
SendMail method of the Workbook object and the RoutingSlip object to send
files to users. In Microsoft Project, the MailSend and MailRoutingSlip
methods of the Application object offer similar functionality.
<P>
Microsoft Excel and Microsoft Project have built-in messaging functionality
that works with MAPI and with Vendor Independent Messaging (VIM) systems;
while the Simple MAPI functions require a MAPI-compatible messaging system.
<P>
Finding Sample Code
 
<P>
Sample applications are available in Microsoft Office Developer's Kit.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: softlib<BR>
Keywords          : kbcode kbfile kbinterop kbprg<BR>
Version           : 1.0<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 17, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
