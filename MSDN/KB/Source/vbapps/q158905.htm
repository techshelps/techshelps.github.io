

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>XL97: "Bad DLL Calling Convention" When Running a Macro </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q158905">
<META NAME="KBModify" CONTENT="1998/02/27">
<META NAME="KBCreate" CONTENT="1996/11/07">
<META NAME="Keywords" CONTENT="kberrmsg xlvbainfo xl97vbmigrate">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  When you run a Visual Basic for Applications macro in Microsoft Excel 97, you may receive the following error message:     Run-time error '49':    Bad DLL calling convention  CAUSE =====  This problem may occur when all of the following conditions ...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGI,QBVP,QBS0,QAY5,QAH4,QBC7,QAIF,QAB9,QDL9,QBWO,QBWN,QBV8,QAB4,QAMA,QBXH P1 P2 P3 P4 P5 P6 T2 P7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XL97: "Bad DLL Calling Convention" When Running a Macro</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 27, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q158905</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Excel 97 for Windows
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you run a Visual Basic for Applications macro in Microsoft Excel 97,
you may receive the following error message:
<P>
<PRE>   Run-time error '49':
   Bad DLL calling convention

</PRE><h2>CAUSE</h2>
 
<P>
This problem may occur when all of the following conditions are true:

<UL><LI>The Visual Basic macro code contains one or more Declare Function
   statements.
<P>
<P><PRE>    -and-
</PRE>
<LI>One of the Declare Function statements refers to a function in a
   dynamic-link library file (DLL) that uses the _cdecl calling
   convention.
<P>
<P><PRE>    -and-
</PRE>
<LI>Within the code, you make a call to the declared function.
<P>
</UL>In Microsoft Excel 97, Visual Basic macros can only call functions that use
the _stdcall calling convention. Functions that use the _cdecl calling
convention are not supported.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
DLLs in Microsoft Windows support two main calling conventions:
_cdecl and _stdcall. Most 32-bit DLLs that are included with Microsoft
Windows 95 and Microsoft Windows NT support the _stdcall calling
convention; the _cdecl calling convention is generally used by older DLLs.
<P>
If a DLL supports only the _cdecl calling convention, you cannot call
functions in that DLL from a Visual Basic macro in Microsoft Excel 97. For
example, if your code includes the following function declaration:
<P>
<PRE>   Declare Function memcpy&amp; Lib "Crtdll" (ByRef Dest&amp;, ByVal Src&amp;, _
       ByVal Count&amp;)

</PRE>and then attempts to call the memcpy&amp; function, you will receive the error
message described in this article. This behavior occurs because macros in
Microsoft Excel 97 cannot call functions that use the _cdecl calling
convention.
<P>
NOTE: In earlier versions of Microsoft Excel, you can make calls to
functions that use the _cdecl calling convention.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: XL97<BR>
Keywords          : kberrmsg xlvbainfo xl97vbmigrate<BR>
Version           : WINDOWS:97<BR>
Platform          : WINDOWS<BR>
Issue type        : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 27, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
