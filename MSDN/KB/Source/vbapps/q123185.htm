

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>GP Fault Using MAPI.DLL Calls in Visual Basic Procedure </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q123185">
<META NAME="KBModify" CONTENT="1997/07/29">
<META NAME="KBCreate" CONTENT="1994/11/23">
<META NAME="Keywords" CONTENT="kbprg">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  In a Microsoft Visual Basic, Applications Edition, procedure, when you call the MAPI.DLL in a Visual Basic procedure, you receive a general protection (GP) fault.  CAUSE =====  Although it is possible to declare and call the Visual Basic MAPI funct...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QBVP,QBKN,QAGI,QAPN,QA5F,QAMA,QAL7,QAYC,QAB9,QAIF,QDKW V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>GP Fault Using MAPI.DLL Calls in Visual Basic Procedure</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 29, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q123185</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Programming System, Applications Edition,
   version 1.0
<LI>Microsoft Excel for Windows, versions 5.0, 5.0c
<LI>Microsoft Project for Windows, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
In a Microsoft Visual Basic, Applications Edition, procedure, when you call
the MAPI.DLL in a Visual Basic procedure, you receive a general protection
(GP) fault.
<P>
<P><h2>CAUSE</h2>
 
<P>
Although it is possible to declare and call the Visual Basic MAPI functions
from a Visual Basic procedure in Microsoft Excel or Microsoft Project, the
calls usually cause a GP Fault.
<P>
You cannot use MAPI functions from a Visual Basic procedure in
Microsoft Excel or Microsoft Project in the form that is documented
for use with Visual Basic version 3.0.
<P>
NOTE: The MAPI calls that fail are the calls that use custom Type
definitions (MAPIMessage, MAPIRecip, or MAPIFile). Other calls that
don't use a custom Type (such as MAPILogon and MAPISendDocuments)
may work correctly.
<P>
<P><h2>WORKAROUNDS</h2>
 
<P>
<P><h3>Microsoft Project</h3>
 
<P>
To work around this problem, you can use the VBAMAPI.DLL file that is
provided with Microsoft Project. This file provides the same Visual
Basic interfaces to MAPI in a form that is compatible with Visual
Basic, Applications Edition.
<P>
Note that you can also use the built-in mail functionality provided in
Microsoft Project. For example, you can use the following in a Visual Basic
procedure:
<P>
<PRE>   MailLogOff method
   MailLogOn method
   MailRoutingSlip method
   MailSend method
   MailSendProjectMail method
   MailSendScheduleNote method
   MailSession property
   MailSystem property
   MailUpdateProject method

</PRE><h3>Microsoft Excel</h3>
 
<P>
To work around this problem, use the built-in mail functionality
provided in Microsoft Excel. For example, you can use the following
in a Visual Basic procedure:
<P>
<PRE>   MailLogoff method
   MailLogon method
   MailSession property
   MailSystem property
   SendMail method

</PRE><h2>MORE INFORMATION</h2>
 
<P>
Messaging Application Programming Interface (MAPI) is the standard
programming interface proposed and supported by Microsoft for
accessing electronic messaging.
<P>
The following MAPI.DLL functions do not cause a GP fault when you use
them in a Visual Basic, Applications Edition, procedure:
<P>
<PRE>   MAPILogon
   MAPILogoff
   MAPIDetails
   MAPISendDocuments
   MAPIDeleteMail

</PRE>You receive a GP fault when you call any of the following MAPI.DLL
functions in a Visual Basic, Applications Edition, procedure:
<P>
<PRE>   MAPIResolveName
   MAPIFindNext
   MAPIAddress
   MAPISaveMail
   MAPISendMail
   MAPIReadMail

</PRE>For additional information, please see the following articles in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../vbapps/Q125854.htm">Q125854</A></B>
   TITLE     : XL: Sending Mail From Microsoft Excel using VBAMAPI.DLL
               (Part 1)

   ARTICLE-ID: <B><A HREF="../vbapps/Q125853.htm">Q125853</A></B>
   TITLE     : XL: Sending Mail From Microsoft Excel using VBAMAPI.DLL
               (Part 2)

</PRE><h2>REFERENCES</h2>
 
<P>
For more information about the MailLogon Method or the MailLogoff Method,
choose the Search button in the Visual Basic Reference (Excel) and type:
<P>
<PRE>   MAPI mail sessions

</PRE>For more information about the MailLogon Method, choose the Search button
in the Visual Basic Reference (Project) and type:
<P>
<PRE>   MailLogOn
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: gpf vba_pj.hlp<BR>
Keywords          : kbprg<BR>
Version           : 1.00<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 29, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
