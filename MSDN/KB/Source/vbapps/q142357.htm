

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>XL: Visual Basic Example Using BuildSQL </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q142357">
<META NAME="KBModify" CONTENT="1998/02/27">
<META NAME="KBCreate" CONTENT="1996/01/10">
<META NAME="Keywords" CONTENT="kbcode kbprg kbhowto">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  In Microsoft Excel, DDE (dynamic data exchange) can be used in Visual Basic for Applications to communicate with Microsoft Query. The BuildSQL command allows the creation of SQL statements greater than 255 characters.  MORE INFORMATION  When you us...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBVP,QBI0,QBS0,QBUG,QBUF,QAB9,QAPN,QABM,QAUD,QANY,QAGI,QBWS,QAPF,QAH4,QBJZ P1 P2 P3 P4 P5 P6 T2 P7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XL: Visual Basic Example Using BuildSQL</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 27, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q142357</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Excel 97 for Windows
<LI>Microsoft Excel for Windows 95, version 7.0
<LI>Microsoft Excel for Windows, versions 5.0, 5.0c
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
In Microsoft Excel, DDE (dynamic data exchange) can be used in Visual
Basic for Applications to communicate with Microsoft Query. The
BuildSQL command allows the creation of SQL statements greater than 255
characters.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
When you use the BuildSQL command with an SQL statement that is greater
than 255 characters, you can send smaller pieces of information to a
Microsoft Excel macro to build the complete SQL statement. The BuildSQL
command is available only on the System channel.
<P>
The following example runs a query, returns the query string in pieces
to an array, builds the SQL statement, runs the new query, and returns
the result set to Sheet1. To use the following macro, Microsoft Query
must be running when you start the macro. When you use the following
macro in Microsoft Excel 7.0, you must create a data source with the
name "NWind" using the dBASE files in the MSQuery directory.
<P>
Microsoft provides examples of Visual Basic for applications procedures
for illustration only, without warranty either expressed or implied,
including but not limited to the implied warranties of merchantability
and/or fitness for a particular purpose. This Visual Basic procedure is
provided 'as is' and Microsoft does not guarantee that it can be used
in all situations. Microsoft does not support modifications of this
procedure to suit customer requirements for a particular purpose.
<P>
<PRE>Sub UsingBuildSQL()

   ' Dimension the variables.
   Dim s As Variant
   Dim myrequest As Variant
   Dim chan As Integer

   ' Initiate a channel to MSQuery.
   chan = DDEInitiate("MSQuery", "System")

   ' Log on to the Nwind datasource.
   DDEExecute chan, "[Logon('NWind')]"

   ' Execute a SQL statement.
   DDEExecute chan, "[Open('Select * From Employee')]"

   ' Request the ODBC SQL statement in strings of 120 characters
   ' and places it into an array.
   myrequest = DDERequest(chan, "ODBCSQLStatement/120")

   ' Execute the BuildSQL statement for each element returned.
   For Each s In myrequest
      DDEExecute chan, "[Buildsql('" &amp; s &amp; "')]"
   Next

   ' Execute the SQL statement built by BuildSQL.
   DDEExecute chan, "[QueryNow()]"

   ' Request the number of rows.
   NumRows = DDERequest(chan, "NumRows")

   ' Request the number of columns.
   NumCols = DDERequest(chan, "NumCols")

   ' Return the data to Sheet1.
   DDEExecute chan, "[Fetch('Excel','Sheet1','R1C1:R" &amp; NumRows(1) &amp; _
      "C" &amp; NumCols(1) &amp; "','All/Headers')]"

   ' Terminate the DDE channel.
   DDETerminate chan

End Sub

</PRE><h2>REFERENCES</h2>
 
<P>
"Microsoft Query User's Guide," version 1.0, Chapter 9, "Using Dynamic
Data Exchange with Microsoft Query"
<P>
For more information about BuildSQL, click Search on the Help menu in
Microsoft Query and type:
<P>
<PRE>   BuildSQL
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 5.00 5.00c 7.00 8.00 97 interoperability<BR>
Keywords          : kbcode kbprg kbhowto<BR>
Version           : WINDOWS:5.0,5.0c,7.0,97<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 27, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
