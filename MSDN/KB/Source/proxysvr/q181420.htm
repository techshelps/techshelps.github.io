

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>How to Configure Exchange or Other SMTP with Proxy Server </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q181420">
<META NAME="KBModify" CONTENT="1998/02/19">
<META NAME="KBCreate" CONTENT="1998/02/19">
<META NAME="Keywords" CONTENT="">
<META NAME="KBArea" CONTENT="Support; KB; proxysvr, axsf, winnt, iis, mcis">
<META NAME="Description" CONTENT="  This step by step guide is intended to be an addendum to the Microsoft Proxy Server 2.0 release notes.  The Server Proxy feature allows you to place a server, such as a Microsoft Exchange Server computer using the Internet Mail Service (Internet Ma...">
<META NAME="Product" CONTENT="Proxy Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDKF,QBWD,QAYC,QA5V,QAI5,QBVW,QAPP,QAVZ,QACK,QAHT,QDIZ,QBVV,QAA1,QBG2,QARL V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to Configure Exchange or Other SMTP with Proxy Server</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 19, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q181420</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Proxy Server, version 2.0
<LI>Microsoft Exchange Server, versions 4.0, 5.0, 5.5
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This step by step guide is intended to be an addendum to the Microsoft
Proxy Server 2.0 release notes.
<P>
The Server Proxy feature allows you to place a server, such as a Microsoft
Exchange Server computer using the Internet Mail Service (Internet Mail
Connector in Exchange version 4.0) on your private network behind Microsoft
Proxy Server. With this configuration, an Exchange Server computer can
provide Internet mail service by using the WinSock Proxy client and relying
on features of Proxy Server 2.0 for protection. In addition, the Exchange
Server computer will not require an additional registered Internet IP
address.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>How Server Proxy Works</h3>
 
<P>
The WinSock Proxy client allows you to bind services or applications to the
external network interface of the server computer running Microsoft Proxy
Server. After a service or application is bound on the external network
interface, it is then available to hosts on the Internet. The Proxy Server
compouter will then "listen" for connections on behalf of the service or
application.
<P>
For example, if you bind an internal SMTP/POP mail server to the proxy
server, mail clients or SMTP servers on the Internet can contact this mail
server by connecting to the proxy server's Internet IP address. To remote
computers on the Internet, these services will appear to be running on the
proxy server computer.
<P>
To Set Up the Server Proxy Feature
for Exchange Server 4.0 - 5.5
 
<P>
These instructions must be followed exactly as stated, otherwise Exchange
will not function with the Server Proxy feature.

<OL><P><LI>Install and configure the Microsoft Proxy Server.

<P><LI>In the Winsock Proxy properties, choose CLIENT CONFIGURATION. Find the
   "Client Connects to Microsoft Winsock Proxy Server by.." option, and set
   this to "IP ADDRESS".

<P><LI>Install the WinSock Proxy (WSP) client on the Exchange Server computer.
   If the WSP client is already installed, REINSTALL IT. This can be done
   by connecting to the MSPCLNT share on the proxy server and executing
   Setup.exe from the root directory.

<P><LI>Change the Domain Name Service (DNS) settings on the Exchange Server
   computer. An Internet DNS server address MUST BE DEFINED on the Exchange
   Server computer, or the Exchange Server computer will not be able to
   send mail correctly.
<P>
   Open Control Panel/Network/TCPIP and click the DNS tab. Add your
   Internet Service Provider's DNS server address(es) here. If your DNS
   server is does not seem to function properly, try using the Microsoft
   Network DNS servers to test name resolution:
<P>
<P><PRE>      204.255.246.17
      204.255.246.18
</PRE><P>

<P><LI>Test the WSP client on the Exchange Server compouter. Open an MS-DOS
   prompt window and type:
<P>
<P><PRE>      FTP FTP.MICROSOFT.COM
</PRE><P>
   You should see a response similar to this if the WSP client is
   functioning:
<P>
<P><PRE>     Connected to ftp.microsoft.com.
     220 ftp Microsoft FTP Service (Version 3.0).
     User (ftp.microsoft.com:(none)):
</PRE>
<P><LI>After the WSP client is working, additional settings are required for
   server proxy on the Exchange Server computer. You will have to create
   *two* Wspcfg.ini files for the Exchange Server computer.
<P>
<P>
   Create the first Wspcfg.ini file for use with the Exchange SMTP service.
   Copy/Paste the four lines of information below to Notepad (DO NOT
   MANUALLY TYPE THE INFORMATION) and save this file as Wspcfg.ini in the
   directory where Msexcimc.exe is located.
<P>
<P>
<P><PRE>      [MSEXCIMC]
      ServerBindTcpPorts=25
      Persistent=1
      KillOldSession=1
</PRE><P>
   Note: The SMTP port (25) on the Exchange Server computer will then be
   bound to the proxy server's port 25.
<P>
   Create the second Wspcfg.ini file for use with the Exchange information
   store (Store.exe). Copy/Paste the four lines of information below to
   Notepad (DO NOT MANUALLY TYPE THE INFORMATION) and save this file as
   Wspcfg.ini in the directory where Store.exe is located.
<P>
<P>
<P><PRE>      [STORE]
      ServerBindTcpPorts=110,119,143
      Persistent=1
      KillOldSession=1
</PRE><P>
<P>
<P><PRE>    Note: Additional ports, such as ports 119 and 143 shown above, can
    be listed because Store.exe provides Network News Transfer Protocol
    (NNTP) on port 119, POP mail on port 110, and so on.
</PRE>
<P><LI>Verify that the two Wspcfg.ini files do NOT have a .txt extension
   appended. This will occur if your Internet Explorer interface settings
   are set to default values. The file may appear as Wspcfg.ini.txt. Rename
   the file if needed.

<P><LI>If you are NOT using ACCESS CONTROL on the Winsock Proxy service, go to
   step 10.
   If ACCESS CONTROL is ENABLED on the Winsock Proxy service, you must
   grant the user account that starts the Exchange service's access to the
   Proxy server.
<P>
   This must be a domain user account, not a local account on the Exchange
   Server computer. If it is a local account, create a NEW user account on
   the domain. In Start/Control Panel/Services, grant the new domain user
   account logon rights to all of the Exchange services.
<P>

<P><LI>Give the new domain user account access to the proxy server. In the
   Winsock Proxy properties, choose PERMISSIONS and give the new account
   the UNLIMITED ACCESS right.

<P><LI>Restart the Exchange Server computer.

<P><LI>After the Exchange Server computer has restarted, it should
   automatically be listening on the external interface of the Proxy Server
   computer.

<P><LI>To test connectivity to the Exchange services from a computer that is
   DIRECTLY CONNECTED to the Internet, do the following:
<P>
   a. Open Telnet.exe from START/RUN on the test computer.
   
   b. Choose CONNECT/REMOTE SYSTEM.
<P>
<PRE>        HOST NAME: External IP address of the proxy server
        PORT:        25
        TERM TYPE: vt100

   c. After you are connected, you will see a blank screen. Press the ENTER
      key and wait about 30 seconds. You should see a message from the
      Exchange SMTP service indicating a good setup. If not, re-check your
      settings.

   d. You can also try port 110 to test the POP service.

</PRE></OL>To Configure Your DNS
<P><h3>Mail Exchange (MX) Record</h3>
 
<P>
If you are using your ISP's DNS server, you must contact them and ask to
add an 'MX' and 'A' record for your domain so other Internet mail servers
will be able to contact your Exchange Server computer.

<OL><P><LI>Your 'MX' and 'A' DNS resource records must refer to the IP address of
   the proxy server's external network adapter and NOT the internal IP
   address of the Exchange Server computer or SMTP server itself.
<P>
   For example, if your registered Internet domain name is "mydomain.com",
   and your internal Exchange Server computer uses a DNS host name of
   "exchange1", you need to use an MX, or mail ex- changer, record to
   provide other Internet hosts the name of your internal Exchange Server
   computer. In this case, an MX record added in the "mydomain.com" zone
   can provide this information as follows:
<P>
<P><PRE>       mydomain.com IN MX 10 exchange1.mydomain.com
</PRE><P>
<P><PRE>    You then need to create an A, or address, record for
    "exchange1.mydomain.com" that uses an external IP address of the
    proxy server.  If the external IP address of your proxy server
    is 127.34.56.89, you add the following A record to the
    "mydomain.com" zone:
</PRE><P>
<PRE>       exchange1.mydomain.com       IN A 127.34.56.89

    In addition, you can add or create a PTR, or pointer, record to
    the "mydomain.com" zone to provide reverse lookup. A valid PTR
    record to do this is:

       89.56.34.127.in-addr.arpa   IN PTR exchange1.mydomain.com

</PRE></OL><h3>Other Third-Party SMTP Servers</h3>
 
<P>
These server proxy setup instructions also apply to other third-party SMTP
mail servers with the exception of step #6. Other SMTP servers will have
slightly different Wspcfg.ini settings. See Microsoft Knowledge Base
article <B><A HREF="../proxysvr/Q177153.htm">Q177153</A></B>, "Additional Proxy Server 2.0 Configurations." This article
contains Wspcfg.ini settings for other products, including SMTP servers.
<P>
If dynamic packet filtering is enabled on the proxy server (recommended),
the proxy server will dynamically open all necessary ports when they are
requested. No special configuration is needed.
<P>
It is not necessary to configure a DNS address on other proxy clients. This
is only required on the Exchange Server computer.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: lotus notes ccmail cc:mail<BR>
Version           : WINDOWS:4.0,5.0,5.5; WINNT:2.0<BR>
Platform          : WINDOWS winnt<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 19, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
