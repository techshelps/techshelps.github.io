

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>INF: How to Use OLE DB Sample Text Provider in ADO </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q164586">
<META NAME="KBModify" CONTENT="1997/08/26">
<META NAME="KBCreate" CONTENT="1997/03/05">
<META NAME="Keywords" CONTENT="odbc SSrvProg kbusage">
<META NAME="KBArea" CONTENT="Support; KB; odbc">
<META NAME="Description" CONTENT="  This article describes how you can use ADO to access the sample text OLE DB provider.  MORE INFORMATION  The OLE DB SDK installs a sample text OLE DB provider that allows you to access text files. This sample text provider is located in the Samples...">
<META NAME="Product" CONTENT="ODBC">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAPF,QBWB,QATX,QAMB,QAUD,QA9Q,QAMJ,QBRZ,QAH4,QABA,QAK6,QALW,QABO,QBS0,QBSO V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: How to Use OLE DB Sample Text Provider in ADO</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  August 26, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q164586</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft OLE DB, version 1.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article describes how you can use ADO to access the sample text
OLE DB provider.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The OLE DB SDK installs a sample text OLE DB provider that allows you to
access text files. This sample text provider is located in the
Samples\Sampprov directory. To use this sample text provider in ADO, you
need to change the source code of the sample text provider, and you also
need to change the ADO threading model. To do this, perform the following
steps:

<OL><P><LI>Modify the SetProperties function in the CutilProp class. The source
   file that contains this function is Utilprop.cpp. Change the last line
   of this function to return DB_E_ERRORSOCCURRED instead of E_FAIL. The
   complete line is:
<P>
<P><PRE>      return ResultFromScode( DB_E_ERRORSOCCURRED  );
</PRE><P>
   ADO returns an error if the underline providers return E_FAIL when
   setting the OLE DB properties. The sample text driver needs to return
   DB_E_ERRORSOCCURRED instead of E_FAIL if there are any unsupported
   properties encountered.

<P><LI>The ADO threading model needs to be either "apartment" or "both." The
   default threading model is the apartment model. The sample text
   provider does not register any threading model, so it defaults
   to a single-threaded model. The threading models needs to match up in
   order for ADO to communicate with the sample text provider. After
   changing the threading model, you will need to restart Internet
   Information Server (IIS) for the changes to take effect.
<P>
</OL>You can use the batch file that came with the OLE DB SDK 1.1 to change the
ADO apartment model. These files are located in the Bin\Util OLEDBSDK
directory. The Makeapt batch file sets ADO to be apartment model threaded.
You can create a REG file base on the following code and merge it with the
registry to change the ADO threading model to both:
<P>
WARNING: Modifying the registry incorrectly can cause serious, system-wide
problems that may require you to reinstall Windows NT to correct them.
Microsoft cannot guarantee that any problems resulting from the use of
Registry Editor can be solved. Use this tool at your own risk.
<P>
<PRE>   REGEDIT4

   [HKEY_LOCAL_MACHINE\SOFTWARE\Classes\CLSID\{0000022C-0000-0010-8000-
   00AA006D2EA4}\InprocServer32]
   "ThreadingModel"="Both"

   [HKEY_LOCAL_MACHINE\SOFTWARE\Classes\CLSID\{00000231-0000-0010-8000-
   00AA006D2EA4}\InprocServer32]
   "ThreadingModel"="Both"

   [HKEY_LOCAL_MACHINE\SOFTWARE\Classes\CLSID\{00000280-0000-0010-8000-
   00AA006D2EA4}\InprocServer32]
   "ThreadingModel"="Both"

   [HKEY_LOCAL_MACHINE\SOFTWARE\Classes\CLSID\{00000281-0000-0010-8000-
   00AA006D2EA4}\InprocServer32]
   "ThreadingModel"="Both"

   [HKEY_LOCAL_MACHINE\SOFTWARE\Classes\CLSID\{00000293-0000-0010-8000-
   00AA006D2EA4}\InprocServer32]
   "ThreadingModel"="Both"

</PRE></OL>After you finish the two steps listed above, you can use the following
Visual Basic code to use the sample text provider to retrieve data
from a text file in ADO:
<P>
<PRE>   Private Sub myTest()
        Dim con As New ADODB.Connection
        Dim rs As ADODB.Recordset

        ' data source specifies path that contains customer.csv
        con.Open "provider=sampprov;data
   source=c:\\sdks\\oledbsdk\\samples\\sampclnt\\"
        Set rs = con.Execute("customer.csv")

        For i = 0 To rs.Fields.Count - 1
            Print rs.Fields(i).Name
        Next i
        While Not rs.EOF
            Debug.Print rs(0)
            rs.MoveNext
        Wend
   End Sub
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: ASP<BR>
Keywords          : odbc SSrvProg kbusage<BR>
Technology        : kbole ODBC<BR>
Version           : 1.1<BR>
Platform          : WINDOWS<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  August 26, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
