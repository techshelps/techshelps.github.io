

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>INF: When and How an ODBC Driver DLL Gets Unloaded </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q101521">
<META NAME="KBModify" CONTENT="1996/09/09">
<META NAME="KBCreate" CONTENT="1993/07/15">
<META NAME="Keywords" CONTENT="kbusage">
<META NAME="KBArea" CONTENT="Support; KB; odbc">
<META NAME="Description" CONTENT="...">
<META NAME="Product" CONTENT="ODBC">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGI,QAU9,QAIF,QA9E,QAY5,QAH5,QAGU,QAKJ,QAJH,QDL9,QBWQ,QBWO,QBWN,QBG2,QAI5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: When and How an ODBC Driver DLL Gets Unloaded</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 9, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q101521</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h2>SUMMARY</h2>
 
<P>
A driver gets unloaded by the ODBC Driver Manager when an application
calls the ODBC SQLDisconnect() function by passing the handle to the
database connection made by that driver. This article discusses how
the driver is unloaded.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
All ODBC calls by an application are intercepted and routed by the
ODBC Driver Manager (DM). When an application calls the
SQLDisconnect() function on a particular connection, the DM calls the
driver's SQLDisconnect() function.
<P>
When the driver returns a status of SQL_SUCCESS or
SQL_SUCCESS_WITH_INFO on this call, the DM then calls the driver's
SQLFreeConnect() and SQLFreeEnv() in quick succession. Also, since the
driver has made a successful disconnect on the call to
SQLDisconnect(), the DM calls the FreeLibrary() function in the
Windows API to reduce the reference count of the driver DLL by one.
When the reference count of the Driver DLL gets to zero (0) after
repeated calls to SQLDisconnect() by the application for all
connections made by that driver, Windows will unload the driver DLL.
<P>
Driver developers may note minor implications arising out of the
above. Note that every time an application calls SQLDisconnect(), the
DM, besides calling the driver's SQLDisconnect(), also calls the
Driver's SQLFreeConnect() and SQLFreeEnv() immediately. Thus
SQLFreeEnv() is called on every SQLDisconnect(). When the application
calls SQLFreeConnect() and SQLFreeEnv(), the DM does its own cleanup
and does not make the same calls to the Driver because these calls
would have been made at the time of SQLDisconnect().
<P>
If an ODBC application terminates without calling SQLDisconnect on all
open connections, Windows will unload the Driver Manager if its
reference count is reduced to zero. However, the Driver Manager cannot
unload the driver DLL because the WEP of the Driver Manager (or any
Windows DLL) cannot call the FreeLibrary function.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbusage<BR>
KBSubcategory:
<P>

Additional reference words: 1.00
<P>


</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 9, 1996</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
