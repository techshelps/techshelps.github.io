

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>FIX: Memory Leak with ODBC Driver Manager During Connection </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q119150">
<META NAME="KBModify" CONTENT="1997/07/02">
<META NAME="KBCreate" CONTENT="1994/08/09">
<META NAME="Keywords" CONTENT="kbfix2.00 kbusage">
<META NAME="KBArea" CONTENT="Support; KB; odbc">
<META NAME="Description" CONTENT="   When an ODBC application makes a sequence of calls to connect to an ODBC driver, a memory loss of the order of a few hundred bytes may occur. The loss of memory depends on the actual driver in use and the exact calls being made.  CAUSE =====  The ...">
<META NAME="Product" CONTENT="ODBC">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGI,QA9E,QAU9,QAUD,QAGU,QAI5,QAIF,QAIH,QAH5,QAB4,QBG2,QAR4,QAKP,QAM1,QDKW V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Memory Leak with ODBC Driver Manager During Connection</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 2, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q119150</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
1.00.2709
WINDOWS
kbusage kbbug1.00.2709 kbfix2.00
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Open Database Connectivity, version 1.0
</UL> 
<P>
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When an ODBC application makes a sequence of calls to connect to an ODBC
driver, a memory loss of the order of a few hundred bytes may occur. The
loss of memory depends on the actual driver in use and the exact calls
being made.
<P>
<P><h2>CAUSE</h2>
 
<P>
The sequence of calls that exhibit this behavior are:
<P>
<PRE>   SQLAllocEnv
   SQLAllocConnect
   SQLConnect or SQLDriverConnect
   SQLDisconnect
   SQLFreeConnect
   SQLFreeEnv

</PRE>The problem occurs as Driver Manager caches error messages but does not
subsequently release the memory used for the caching.
<P>
For Microsoft Access and Microsoft Visual Basic for Windows applications,
the behavior is exhibited when a new connection to an ODBC driver is made
to either access attached tables or to create a dynaset or a snapshot.
<P>
When using Microsoft FoxPro Connectivity Kit, the problem is encountered on
a call to DBConnect(). Microsoft Foundation Classes (MFC) users will see
the problem when CDatabase::Open and CrecordSet::Open are called.
<P>
For Microsoft Word for Windows users, this behavior will be exhibited when
connecting to an ODBC data source using Microsoft Query. This includes use
of the INSERT DATABASE and MAIL MERGE functionality in Microsoft Word.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
For those drivers that return SQL_SUCCESS_WITH_INFO on SQLDriverConnect or
SQLConnect call, an application can work around this problem by calling
SQLError call to retrieve the error message that is cached in Driver
Manager; therefore, freeing up the memory. The SQLError can be called
immediately after SQLConnect or SQLDriverConnect returns
SQL_SUCCESS_WITH_INFO, calling SQLError repeatedly, until it returns
SQL_NO_DATA_FOUND.
<P>
An example of an ODBC Driver that normally returns SQL_SUCCESS_WITH_INFO on
a successful connection is SQL Server Driver.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in ODBC Driver Manager version
1.0. This problem was fixed in the version 2.x ODBC Driver Manager. Contact
your primary support provider for more information.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 1.00.2709 DM VC++ VB C++ MSVC FoxPro<BR>
KBCategory: kbusage kbfix2.00<BR>
KBSubcategory:<BR>
Keywords            : kbfix2.00 kbusage<BR>
Technology          : kbMfc<BR>
Version             : 1.00.2709<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 2, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
