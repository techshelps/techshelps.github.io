

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: ODBC SQL Server Driver and Access Violation on SQL Server </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q114630">
<META NAME="KBModify" CONTENT="1996/09/09">
<META NAME="KBCreate" CONTENT="1994/05/09">
<META NAME="Keywords" CONTENT="kbusage">
<META NAME="KBArea" CONTENT="Support; KB; odbc">
<META NAME="Description" CONTENT="  When using the SQL Server ODBC driver with an ODBC enabled application to access SQL Server for Windows NT, an update on a table with a trigger which calls a stored procedure, which in turn contains an unmatched COMMIT TRAN or ROLLBACK TRAN stateme...">
<META NAME="Product" CONTENT="ODBC">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA9E,QABM,QAXB,QA1S,QATP,QAC1,QBD2,QAU9,QDN9,QBW7,QAOI,QAI5,QBS0,QBWG,QBWP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: ODBC SQL Server Driver and Access Violation on SQL Server</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 9, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q114630</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Open Database Connectivity, version 1.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When using the SQL Server ODBC driver with an ODBC enabled application to
access SQL Server for Windows NT, an update on a table with a trigger which
calls a stored procedure, which in turn contains an unmatched COMMIT TRAN
or ROLLBACK TRAN statement, may cause an access violation to be encountered
on SQL Server, causing SQL server to terminate.
<P>
In case of Access and Visual Basic, an attempt to update the SQL server
table, will generate the following message,
<P>
<PRE>   ODBC - Update failed.

</PRE>followed by:
<P>
<PRE>   [Microsoft][ODBC SQL Server Driver]Communication Link Failure.

</PRE>For ODBC application writer, the following steps will encounter the
behavior:
<P>
<PRE>   // prepared execution to update the table
   SQLPrepare: update &lt;tablename&gt; set &lt;col&gt;= ? where &lt;col&gt;=?

   //Set parameters for the above prepared stmt
   SQLSetParam:

   //Begin transaction
   SQLSetConnectOption:
      fOption: SQL_AUTOCOMMIT
      vParam : FALSE or 0

   //Execute the previously prepared stmt
   SQLExecute:

</PRE>This will return SQL_ERROR, with szSqlState = "08S01", *pfNativeError
= 0, *pcbErrorMsg = 61, szErrorMsg = [Microsoft][ODBC SQL Server
Driver] Communication link failure.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
This does not happen, if on SQL Server, the ROLLBACK TRAN or COMMIT
TRAN statement itself is contained in the trigger instead of being in
the stored procedure that is called by the trigger.
<P>
This happens only for prepared execution in ODBC. Thus, another
workaround is to revoke stored procedure permissions from the users
which will result in a non-prepared execution, and it will not cause
access violation on the SQL Server.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbusage<BR>
KBSubcategory:
<P>

Additional reference words: 1.01.2807
<P>


</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 9, 1996</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
