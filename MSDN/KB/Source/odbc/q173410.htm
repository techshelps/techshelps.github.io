

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: Server-side Cursors Are Forced w/More Than One Command Obj. </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q173410">
<META NAME="KBModify" CONTENT="1997/09/04">
<META NAME="KBCreate" CONTENT="1997/09/03">
<META NAME="Keywords" CONTENT="odbcCursor SSrvProg kbprg">
<META NAME="KBArea" CONTENT="Support; KB; odbc">
<META NAME="Description" CONTENT="  The ODBC Provider may force the use of server-side cursors if both of the following conditions are true:   - The backend database server is Microsoft SQL Server     -and-   - More than one Command object exists within the same session object.  Serv...">
<META NAME="Product" CONTENT="ODBC">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QA9E,QAPN,QAO2,QAB9,QBWB,QA63,QAW6,QADX,QAGI,QBV8,QAJH,QA9Q,QAU9,QAX6 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Server-side Cursors Are Forced w/More Than One Command Obj.</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 4, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q173410</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft OLE DB, version 1.1
<LI>Microsoft ODBC Provider, version 1.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The ODBC Provider may force the use of server-side cursors if both of the
following conditions are true:

<UL><LI>The backend database server is Microsoft SQL Server
<P>
   -and-

<LI>More than one Command object exists within the same session object.
<P>
</UL>Server-side cursors will be implicitly forced with any queries, even they
are if not requested by the application.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The Microsoft SQL Server ODBC driver can have only one active statement
unless server-side cursors are used. An ODBC application may receive the
following error message if it attempts to have more than one active
statement without using server-side cursors:
<P>
<PRE>   szSqlState = "S1000", *pfNativeError = 0
   szErrorMsg = "[Microsoft][ODBC SQL Server Driver]Connection is busy with
   results for another hstmt"

</PRE>Using the ODBC Provider, an OLE DB application is like an ODBC application.
The ODBC Provider translates OLE DB interface requests into ODBC APIs, and
then sends ODBC requests to ODBC drivers. OLE DB session objects are mapped
to ODBC connections, and command objects are mapped to statements.
<P>
Dealing with the SQL Server ODBC driver, the ODBC Provider forces the use
of server-side cursors if there is more than one command object or
statement opened. With more than one command object or statement opened,
the application may run into the one active statement limitation.
Therefore, the ODBC Provider automatically uses server-side cursors to
avoid the limitation. The type of server-side cursor enforced by the ODBC
Provider is forward-only and read-only. For example, the forward and
read-only server-side cursors will be forced with the following code:
<P>
<PRE>   IcommandText         *pICommandText1;
   IcommandText         *pICommandText1;
   Icommand             *pIDBCommand;
   WCHAR  *stmt_string = SysAllocString((LPOLESTR)L"SELECT * FROM TITLES");

   ...connect to the ODBC Provider, create session and command object .....

   pIDBCommand-
   &gt;CreateCommand(NULL,IID_ICommandText,(IUnknown**)&amp;pICommandText1)
   pIDBCommand-
   &gt;CreateCommand(NULL,IID_ICommandText,(IUnknown**)&amp;pICommandText2)

   pICommandText1-&gt;SetCommandText ( DBGUID_DBSQL,  stmt_string )
   pICommandText1-&gt;Execute(NULL, IID_NULL, NULL, NULL,NULL)

</PRE>With server-side cursors being enforced, an application cannot execute SQL
statements that generate more than one resultset. SQL Server only allows
executing server-side cursors with SQL statements that generate a single
resultset. At this point, the application will have to release all the
command objects except one, so that server-side cursor will not be
enforced. Then the multiple-resultset SQL statements can be executed
successfully.
<P>
For additional information for server-side cursors and multiple resultsets,
please see the following article in the Microsoft Knowledge Base:
<P>
ARTICLE-ID: <B><A HREF="../SQLSERVER/Q156500.htm">Q156500</A></B>
<PRE>TITLE     : INF: Processing Procedures and Batches with Multiple SELECTS
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: busy oledb<BR>
Keywords          : odbcCursor SSrvProg kbprg<BR>
Version           : WINDOWS:1.1.0.2326<BR>
Platform          : WINDOWS<BR>
Issue type        : kbinfo<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 4, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
