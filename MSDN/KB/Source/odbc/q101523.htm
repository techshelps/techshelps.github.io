

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>INF: Meaning of an Active ODBC Statement Handle </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q101523">
<META NAME="KBModify" CONTENT="1996/09/09">
<META NAME="KBCreate" CONTENT="1993/07/15">
<META NAME="Keywords" CONTENT="kbusage">
<META NAME="KBArea" CONTENT="Support; KB; odbc">
<META NAME="Description" CONTENT="...">
<META NAME="Product" CONTENT="ODBC">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAL3,QA5V,QAY2,QAXB,QAPN,QA9E,QA62,QAZA,QAU9,QAPF,QADX,QA2Q,QALS,QAHT,QAGI V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: Meaning of an Active ODBC Statement Handle</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 9, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q101523</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h2>SUMMARY</h2>
 
<P>
An ODBC application can call SQLGetInfo() with an fInfoType of
SQL_ACTIVE_STATEMENTS to determine the number of active statement
handles that an ODBC driver can support on a connection. This article
explains how the concept of 'active statement' is far removed from the
states of statement handles in an ODBC State Transition table.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
An ODBC application may be written such that one statement handle
(hstmt) on a connection (hdbc) is used to fetch data from the back
end, and a second  hstmt within the same hdbc is used simultaneously
for other tasks, such as generating updates. But an application must
not assume that the driver will support such behavior from the
application. The application must first call SQLGetInfo with the
fInfoType of SQL_ACTIVE_STATEMENTS to see if multiple active hstmts
are supported. In ODBC, an hstmt is defined as active if it has
results pending. The term 'results' means rows from a select or the
number of rows affected by an insert, update or delete operation (such
as row count).
<P>
If a driver supports only one active hstmt per hdbc, applications
written as above will not work. They must allocate a second hdbc, make
a new connection, and then allocate another hstmt within this new hdbc
to be able to concurrently use both hstmts, that is, concurrently
having one hstmt with results pending as the rows are being fetched,
and using the other hstmt for other application-specific tasks.
<P>
It must be noted, however, that even for a driver that supports only
one active hstmt per hdbc, it may be possible to allocate more than
one hstmt within the hdbc, that is, such a driver may support multiple
hstmts per hdbc but not multiple active hstmts per hdbc. In such
cases, applications must be careful to not use other hstmts within the
hdbc when results are pending on a hstmt within the hdbc.
<P>
The following examples assume a driver that supports only one active
hstmt per hdbc, without limiting multiple hstmts per hdbc.
<P>
SQLAllocStmt(hdbc, &amp;hstmt1)
SQLAllocStmt(hdbc, &amp;hstmt2)
<P>
<P><h3>Example 1</h3>
 
<P>
SQLExecDirect (hstmt1, "select * from &lt;a zero-row table&gt;", SQL_NTS)
<PRE>//Since the above select generated no results, it's OK to use hstmt2
</PRE>SQLExecDirect(hstmt2, "select * from &lt;table&gt;", SQL_NTS)
<P>
<P><h3>Example 2</h3>
 
<P>
SQLExecDirect(hstmt1, "select * from &lt;table that has rows&gt;", SQL_NTS)
<PRE>// The above statement generates a results set
</PRE>SQLExecDirect(hstmt2, "some update statement", SQL_NTS)
<PRE>// Error with SQLState 24000 "Invalid Cursor State"

</PRE><h3>Example 3</h3>
 
<P>
SQLExecDirect(hstmt1, "delete  from &lt;table that has rows&gt;", SQL_NTS)
<PRE>// The above delete generates a row count (the number of rows
</PRE>affected)
SQLExecDirect(hstmt2, "some update statement", SQL_NTS)
<PRE>// Error with SQLState 24000 "Invalid Cursor State"


</PRE>Because there are results pending on hstmt1, the last SQLExecDirect on
hstmt2 in Examples 2 and 3 results in SQLState 24000 "Invalid Cursor
state." Note that in example 3, if SQLRowCount had been called after
the first SQLExecDirect to determine the number of rows affected, the
second SQLExecDirect would have been valid.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbusage<BR>
KBSubcategory:
<P>

Additional reference words: 1.00
<P>


</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 9, 1996</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
