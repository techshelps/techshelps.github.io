

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>INFO: Nested Transactions Not Available in ODBC/OLE DB/ADO </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q177138">
<META NAME="KBModify" CONTENT="1997/12/05">
<META NAME="KBCreate" CONTENT="1997/11/21">
<META NAME="Keywords" CONTENT="kbinterop">
<META NAME="KBArea" CONTENT="Support; KB; odbc">
<META NAME="Description" CONTENT="  Neither Open Database Connectivity (ODBC), nor any released Microsoft OLE DB Provider, supports Nested Transactions. ActiveX Data Objects (ADO) supports the feature, but only if the underlying provider exposes it. Currently none of Microsoft's OLE ...">
<META NAME="Product" CONTENT="ODBC">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA9E,QAJ8,QA9Q,QBWB,QAH4,QA1S,QAB4,QAFF,QBXJ,QBXS,QAYY,QBVV,QAMB,QALQ,QAI5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INFO: Nested Transactions Not Available in ODBC/OLE DB/ADO</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 5, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q177138</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Open Database Connectivity, versions 1.0, 2.0, 3.0, 3.5
<LI>Microsoft OLE DB, versions 1.0, 1.1, 1.5
<LI>ActiveX Data Objects (ADO), versions 1.0, 1.5
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Neither Open Database Connectivity (ODBC), nor any released Microsoft OLE
DB Provider, supports Nested Transactions. ActiveX Data Objects (ADO)
supports the feature, but only if the underlying provider exposes it.
Currently none of Microsoft's OLE DB providers support Nested Transactions.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Neither ODBC, nor any released OLE DB Provider, exposes Nested Transaction
functionality, even if the back-end data source supports this feature.
<P>
Nested Transactions are a feature of the Jet engine, but only when
accessing the Jet engine directly via Data Access Objects (DAO). If using
DAO against a Microsoft database (MDB) file that has an attached ODBC Data
Source, any attempt to use nested transactions is ignored.
<P>
The ADO Help indicates that ADO supports nested transactions but only if
the underlying OLE DB Provider supports nested transactions. The following
Microsoft Providers do not support Nested Transactions:
<P>
<PRE>   OLE DB Provider for ODBC Drivers
   Index Server Provider for OLE DB
   Active Directory Provider for OLE DB

</PRE><h3>Sample Code</h3>
 
<P>
Below is the error message and the code snippet that generates the error
for ADO when the underlying provider does not support nested transactions:
<P>
<PRE>   Run-time error '-2147168237 (8004d013)':
   Only one transaction can be active on this session.

</PRE>Here is the code used to generate the error:
<P>
<PRE>   Option Explicit
   Dim Cn As ADODB.Connection
   Dim Cmd1 As ADODB.Command
   Dim strConn, strQSQL As String

   Private Sub Form_Load()

   ' Open connection.  Set Cn = New ADODB.Connection
   ' Change the connect string to match your setup
   strConn = "driver={SQL Server};server=MyServer;" &amp; _
   "uid=sa;pwd=;database=pubs"
   Set Cn = New ADODB.Connection
   Cn.Open strConn
   Cn.CursorLocation = adUseClient
   'Cmd1 executes a SQL Insert
   strQSQL = "Insert INTO Stores (stor_id, stor_name, " &amp; _
   "stor_address, city) VALUES(?,?,?,?)"
   Set Cmd1 = New ADODB.Command
   With Cmd1
   .ActiveConnection = Cn
   .CommandText = strQSQL
   .CommandType = adCmdText
   .Parameters.Append .CreateParameter("", adChar, adParamInput, 4)
   .Parameters.Append .CreateParameter("", adVarChar, adParamInput, 40)
   .Parameters.Append .CreateParameter("", adVarChar, adParamInput, 40)
   .Parameters.Append .CreateParameter("", adVarChar, adParamInput, 20)
   End With
   End Sub

   Private Sub cmdInsert_Click()
   MousePointer = vbHourglass

   Cn.BeginTrans

   Cmd1(0) = "101"
   Cmd1(1) = "Store One"
   Cmd1(2) = "123 Oak St."
   Cmd1(3) = "Seattle"
   Cmd1.Execute

   Cn.BeginTrans   'Comment out and this code will run.

   Cmd1(0) = "102"
   Cmd1(1) = "Store Two"
   Cmd1(2) = "123 Main St."
   Cmd1(3) = "Tacoma"
   Cmd1.Execute

   Cn.CommitTrans   'Comment out and this code will run.

   Cn.CommitTrans

   MousePointer = vbDefault
   End Sub

   Private Sub Form_Unload(Cancel As Integer)
   Cn.Close
   Set Cn = Nothing
   Set Cmd1 = Nothing

   End Sub

</PRE><h2>REFERENCES</h2>
 
<P>
<B><A HREF="http://www.microsoft.com/data">http://www.microsoft.com/data</A></B>
<P>
The Microsoft Jet Database Engine Programmer's Guide (Second Edition), page
425 – "Nesting of transactions", MS Press.
 
<PRE>Keywords          : kbinterop
Technology        : odbc ole
Version           : WINDOWS:1.0,1.1,1.5,2.0,3.0,3.5
Platform          : WINDOWS
Issue type        : kbinfo</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 5, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
