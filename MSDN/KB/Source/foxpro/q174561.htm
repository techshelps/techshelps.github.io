

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>BUG: OS() Function Returns Incorrect Value Under Windows NT 4.0 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q174561">
<META NAME="KBModify" CONTENT="1997/10/02">
<META NAME="KBCreate" CONTENT="1997/10/01">
<META NAME="Keywords" CONTENT="FoxDos FoxWin FxprgGeneral">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  The OS() function returns incorrect operating system information when executed from FoxPro for Windows 2.6x or FoxPro for MS-DOS 2.6x running under Windows NT 4.0. The OS() function returns the value DOS 05.00 for the MS-DOS version. Adding the  1 ...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QAUD,QDL9,QBWQ,QBWO,QBWN,QAY5,QBV8,QAB9,QAH4,QDIR,QBWS,QBE7,QBE6,QAKC V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: OS() Function Returns Incorrect Value Under Windows NT 4.0</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 2, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q174561</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft FoxPro for Windows, versions 2.6, 2.6a
<LI>Microsoft FoxPro for MS-DOS, versions 2.6, 2.6a
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The OS() function returns incorrect operating system information when
executed from FoxPro for Windows 2.6x or FoxPro for MS-DOS 2.6x running
under Windows NT 4.0. The OS() function returns the value DOS 05.00 for the
MS-DOS version. Adding the "1" switch available in the OS() function under
FoxPro for Windows 2.6x should report the current version of Windows. When
running under Windows NT 4.0, the OS(1) function incorrectly identifies the
Windows version as Windows 3.10
<P>
<P><h2>RESOLUTION</h2>
 
<P>
In FoxPro for Windows 2.6x, you can use the GetWinFlags API to determine
whether the application is running on Windows NT 4.0. The code example
sends a message to the FoxPro desktop indicating whether Windows NT is the
current operating system. It does not include the version of NT. Since the
code includes Windows API calls, it will not work in FoxPro for MS-DOS.
<P>
<PRE>   **** Begin Code Example****

   CLEAR
   SET LIBRARY TO home() + "foxtools.fll"

   * WF-WINNT represented as the 0-based bit number that must be on
   * in the returned WinFlags() for the program to be running under NT.

   WF_WINNT = 14

   m.getwinflags = RegFN("GetWinFlags", "", "L")
   m.retval = callfn(m.getwinflags)

   IF testbit(m.retval, WF_WINNT)
      ? "Running NT"
   ELSE
      ? "Not running NT"
   ENDIF


   *****************
   * function testbit - determines if a specific bit of a passed number is
   * on/off
   *
   * passed: number (m.number)
   *      bit number (m.bitnum, 0 - 31)
   *
   * returns: .f. for off, .t. for on, .f. for illegal function call
   ****************

   FUNCTION testbit

   PARAMETERS m.number, m.bitnum

   * number too big - exit
   IF NOT BETWEEN(m.bitnum, 0, 31)
      RETURN .F.
   ENDIF

   m.ascii = m.number
   FOR i = 31 TO 0 STEP -1
      m.newascii = MOD(m.ascii, 2 ^ i)
         IF m.bitnum = i
            IF m.newascii # m.ascii
               RETURN .T.
            ELSE
               RETURN .F.
            ENDIF
         ENDIF
   m.ascii = m.newascii
   NEXT
   **** End Code Example****

</PRE><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products
listed at the beginning of this article. We are researching this
bug and will post new information here in the Microsoft Knowledge
Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The OS() function differs slightly between FoxPro for MS-DOS and FoxPro for
Windows 2.6x.  In FoxPro for Windows, the OS() function has an optional
parameter of 1. This returns the version of Windows. The OS() function
simply returns the MS-DOS operating system version.
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Start FoxPro for MS-DOS on a machine running Windows NT 4.0.

<P><LI>In the Command window, type the following:
<P>
<P><PRE>     ? OS()
</PRE>
<P><LI>The OS() function incorrectly reports MS-DOS 05.00.

<P><LI>Start FoxPro for Windows 2.6x on a machine running Windows NT 4.0.

<P><LI>In the Command window, type the following commands:
<P>
<P><PRE>      ? OS()
      ? OS(1)
</PRE>
<P><LI>The OS() function incorrectly reports MS-DOS 05.00 as the MS-DOS version
   and Windows 3.10 as the version of Windows.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
For additional information, please see the following articles in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../VBWIN/Q122353.htm">Q122353</A></B>
   TITLE     : How to Determine If a VB App is Running Under Windows NT 3.x

   ARTICLE-ID: <B><A HREF="../WIN16SDK/Q131371.htm">Q131371</A></B>
   TITLE     : Determining System Version from a Windows-Based Application
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: OS<BR>
Keywords          : FoxDos FoxWin FxprgGeneral<BR>
Version           : MS-DOS:2.6,2.6a; WINDOWS:2.6,2.6a<BR>
Platform          : MS-DOS winnt<BR>
Issue type        : kbbug<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 2, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
