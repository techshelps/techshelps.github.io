

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>FIX: SCAN..ENDSCAN Causes a Memory Leak </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q125374">
<META NAME="KBModify" CONTENT="1997/09/22">
<META NAME="KBCreate" CONTENT="1995/01/25">
<META NAME="Keywords" CONTENT="FxotherGeneral kbbuglist kbfixlist kbprg">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  Looping through a Table with a SCAN..ENDSCAN will reduce the amount of memory available to less than 200,000 bytes after a number of records have been processed. How quickly the memory is depleted depends on how many fields are in the database and ...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA5V,QANY,QBW6,QAZV,QAUD,QAR4,QBXN,QAVX,QAVW,QAH3,QAH4,QBWS,QBJQ,QDO9,QA7O V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: SCAN..ENDSCAN Causes a Memory Leak</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 22, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q125374</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
2.60a
MACINTOSH
kbprg kbfixlist kbbuglist
<P>
 
The information in this article applies to:

<UL><LI>Microsoft FoxPro for Macintosh, version 2.6a
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Looping through a Table with a SCAN..ENDSCAN will reduce the amount of
memory available to less than 200,000 bytes after a number of records have
been processed. How quickly the memory is depleted depends on how many
fields are in the database and on how many tables are open in addition to
the table used by the loop. If the number of fields is less than five, the
memory is not reduced below 200,000 bytes for a 50,000 record database.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
The memory leak can be avoided by testing for low memory in the loop and
calling a function to close and reopen the database. Low memory is tested
for by using SYS functions SYS(1001) and SYS(1016). SYS(1001) returns the
total amount of memory available to the FoxPro memory manager, and
SYS(1016) returns the amount of memory being used.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the Microsoft products
listed at the beginning of this article. This problem was corrected in
Visual FoxPro 3.0b for Macintosh.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Problem</h3>
 
<P>
Open a database that has about 50,000 records and more than five fields.
Then execute the following code:
<P>
<PRE>   SCAN ALL NOOPTIMIZE
       MEMLEFT= VAL(SYS(1001))-VAL(SYS(1016))
       IF MEMLEFT&lt; 200000
           CURREC=RECNO()
           WAIT WINDOW STR(MEMLEFT)+" "+STR(RECNO())
   *       DO RESTORMEM WITH CURREC
       ENDIF
   ENDSCAN

   PROCEDURE RESTORMEM
   PARAMETER WHATRECORD
   DB_NAME= ALIAS()
   USE
   USE (DB_NAME)
   MEMLEFT= VAL(SYS(1001))-VAL(SYS(1016))
   WAIT WINDOW STR(MEMLEFT)+" "+ STR(RECNO())
   GO WHATRECORD
   RETURN

</PRE>In one test, the wait window appeared after approximately 33,000 records
have been processed if no other databases are open. The preferred size for
FoxPro was set at 8000k.
<P>
Removing the asterisk from the DO RESTORMEM line to change it from a
comment to code. Now, the procedure will run correctly. This illustrates
that memory is restored by closing and reopening the database.
Approximately 33,000 records will be processed before the procedure is
executed again.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: fixlist3.00b VFoxMac FoxMac 2.60a buglist2.60a<BR>
KBCategory: kbprg kbfixlist kbbuglist<BR>
KBSubcategory: FxotherGeneral<BR>
Keywords          : FxotherGeneral kbbuglist kbfixlist kbprg<BR>
Version           : 2.60a<BR>
Platform          : MACINTOSH<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 22, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
