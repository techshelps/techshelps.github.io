

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: Multiple E-mail Attachments Cause Error with MSMAPI OCX </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q181899">
<META NAME="KBModify" CONTENT="1998/03/02">
<META NAME="KBCreate" CONTENT="1998/02/27">
<META NAME="Keywords" CONTENT="FxinteropOcx vfoxwin">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  When attaching multiple file attachments using the MSMAPI32 OCX, calling the Send method causes the following error to occur:     OLE IDispatch exception code 0 from MAPIMessages:  Unspecified Failure    has occurred.  CAUSE =====  The AttachmentPo...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QA5T,QAPN,QAEV,QACI,QA7O,QAMN,QAB5,QAYC,QA39,QASR,QAOE,QAH6,QAA1,QAHV V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Multiple E-mail Attachments Cause Error with MSMAPI OCX</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 2, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q181899</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, versions 3.0, 3.0b, 5.0, 5.0a
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When attaching multiple file attachments using the MSMAPI32 OCX, calling
the Send method causes the following error to occur:
<P>
<PRE>   OLE IDispatch exception code 0 from MAPIMessages:  Unspecified Failure
   has occurred.

</PRE><h2>CAUSE</h2>
 
<P>
The AttachmentPosition property of the MAPIMessage control is not being
incremented with each attachment. The AttachmentPosition property indicates
the position of the attachment within the message. If two attachments
occupy the same position, an error occurs when the MAPIMessage's Send
method is called.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Change the AttachmentPosition for each attachment. In the code sample
below, change the following section:
<P>
<PRE>   *-- Attach the files.
   FOR lnCount = 1 TO ALEN(lcAttachment)
      oMessage.AttachmentIndex = lnCount - 1
      oMessage.AttachmentPathName = lcAttachment(lnCount)
   ENDFOR

</PRE>The changes for the code are give below:
<P>
<PRE>   *-- Attach the files.
   FOR lnCount = 1 TO ALEN(lcAttachment)
      oMessage.AttachmentIndex = lnCount - 1
      oMessage.AttachmentPathName = lcAttachment(lnCount)

      *-- We have to increment the AttachmentPosition because two
      *-- attachments cannot occupy the same space.
      *-- The AttachmentPosition dictates the character position of the
      *-- attachment, so stick them in after the message.
      oMessage.AttachmentPosition = lnCount - 1
   ENDFOR

</PRE><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
NOTE: This code works with version 6.00.8023 of the Msmapi32.ocx control.
If an earlier version of this control is installed, an error occurs when
setting the LogonUI property. The Msmapi.ocx version 1.0.2815 ships with
Visual FoxPro version 5.0. This code runs under Visual FoxPro 5.0; however,
the later version of the MSMAPI32 control must be installed and registered.
<P>
The AttachmentPosition property determines the character position of an
attachment within a message. This value can be programmatically set to any
position within the message body. However, since the number of attachments
may be unknown, it would be easiest to increment the AttachmentPosition
property one character for each attachment.
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Place the following code in a program file and run the program:
<P>
<P><PRE>      oSession = CREATEOBJECT("MSMapi.MapiSession")
      oMessage = CREATEOBJECT("MSMapi.MapiMessages")
</PRE><P>
<P><PRE>      oSession.LogonUI = .t.
      oSession.SignOn
</PRE><P>
<P><PRE>      *-- The message control needs to reference the session control's ID.
      oMessage.SessionID = oSession.SessionID
      oMessage.MsgIndex = -1
</PRE><P>
<P><PRE>      *-- Set up our message and send it.
      oMessage.Compose
      oMessage.msgsubject = "Attachments sent using FoxPro and MAPI"
<PRE></PRE>      oMessage.msgnotetext = "   Attached are some test files."

      *-- Create an array holding the attachment file names.
      DIMENSION lcAttachment(2)
      lcAttachment(1) = home()+ "samples\data\customer.dbf"
      lcAttachment(2) = home()+ "samples\data\customer.cdx"

      *-- Attach the files.
      FOR lnCount = 1 TO ALEN(lcAttachment)
         oMessage.AttachmentIndex = lnCount - 1
         oMessage.AttachmentPathName = lcAttachment(lnCount)
      ENDFOR

      *-- Send the message on its way.
      oMessage.send(1)

</PRE><P><LI>A dialog box displays the following message:
<P>
<P><PRE>      OLE Idispatch exception code 0 from MAPIMessages: Unspecified Failure
      has occurred.
</PRE><P>
</OL><h2>REFERENCES</h2>
 
<P>
For additional information, please see the following article in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../FOXPRO/Q136638.htm">Q136638</A></B>
   TITLE     : How To Send Email Programmatically by Using MSMAPI OLE
               Control

</PRE></OL>COMCTL1.HLP Help; Topic: "AttachmentPosition Property"
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: MSMAPI MAPI OCX<BR>
Keywords          : FxinteropOcx vfoxwin<BR>
Version           : WINDOWS:3.0,3.0b,5.0,5.0a<BR>
Platform          : WINDOWS<BR>
Issue type        : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 2, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
