

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: Releasing Object Variable Does Not Close Microsoft Excel </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q132535">
<META NAME="KBModify" CONTENT="1996/12/31">
<META NAME="KBCreate" CONTENT="1995/07/13">
<META NAME="Keywords" CONTENT="kbinterop kbole kbprb">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  The CREATEOBJECT function can be used to create a reference to an instance of Microsoft Excel and assign that reference to a variable. However, releasing that variable does not cause the instance of Excel to quit.  Inadvertently creating multiple i...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBVP,QAYL,QAB4,QAY5,QAH4,QAGB,QBE7,QBE6,QBVV,QAB9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Releasing Object Variable Does Not Close Microsoft Excel</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 31, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q132535</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, version 3.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The CREATEOBJECT function can be used to create a reference to an instance
of Microsoft Excel and assign that reference to a variable. However,
releasing that variable does not cause the instance of Excel to quit.
<P>
Inadvertently creating multiple instances of Excel can cause a variety of
error messages, depending on the machine configuration and Windows version.
These error messages include:
<P>
<PRE>   "Insufficient Memory"
   "Not enough memory"
   "Page Fault"

</PRE><h2>RESOLUTION</h2>
 
<P>
If you are running Microsoft Excel 5.0, use the following code to close all
instances of Microsoft Excel:
<P>
<PRE>   PROCEDURE xlquit
   local llFlag
   ON ERROR  llFlag = .F. &amp;&amp; Exit loop
   llFlag = .T.
   DO  WHILE  llFlag
      y=GETOBJECT (,"Excel.Application")
      y.QUIT
   ENDDO
   ON ERROR   &amp;&amp; Set back to default

</PRE>If you are using Microsoft Excel 7.0, use the following code:
<P>
<PRE>   PROCEDURE xlquit
   DECLARE LONG FindWindowA IN USER32 AS FindA STRING,STRING
   DECLARE LONG SendMessageA IN USER32 AS SendA LONG, LONG, LONG, LONG
   WM_USER = 1024
   hwnd = FindA("XLMAIN", 0)
     DO  WHILE  hwnd &gt; 0
       WhatD= SendA(hwnd, WM_USER + 18, 0, 0)
       y=GETOBJECT (,"Excel.Application")
       y.QUIT
       hwnd = FindA("XLMAIN", 0)
     ENDDO

</PRE>The code is different because of a change in behavior between Microsoft
Excel 7.0 and Microsoft Excel 5.x. For more information, please see the
following article in the Microsoft Knowledge Base.
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../FOXPRO/Q147573.htm">Q147573</A></B>
   TITLE     : PRB: Microsoft Excel Not Registered in Running Object Table

</PRE>NOTE: The DECLARE statements in the above example are case-sensitive and
the functions must be called just as in the example.
<P>
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 
<P>
Run the following code to create five instances of Microsoft Excel, none of
which are visible:
<P>
<PRE>   FOR i = 1 to 5
     x = CREATEOBJECT("Excel.Application")
     RELEASE x
   ENDFOR

</PRE>Releasing the variable x  does not terminate the instance of Microsoft
Excel. To ensure that each instance is terminated, add the following
command immediately before the RELEASE x command:
<P>
<PRE>   x.Quit

</PRE>To test if an instance of Microsoft Excel exists use this function:
<P>
<PRE>   x=GETOBJECT(,"Excel.Application")  &amp;&amp; The first argument is empty

</PRE>This returns an OLE error if no instance of Microsoft Excel is in memory.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For more information about the GETOBJECT function, please see the following
article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../FOXPRO/Q128994.htm">Q128994</A></B>
   TITLE     : Behavior of GETOBJECT() with Excel and Word for Windows
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 VFoxWin<BR>
KBCategory: kbinterop kbole kbprb<BR>
KBSubcategory: FxinteropExcel<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 31, 1996</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
