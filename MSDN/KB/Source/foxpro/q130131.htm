

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: ON ERROR Not Called When Trigger Fails in Browse or Grid </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q130131">
<META NAME="KBModify" CONTENT="1996/04/30">
<META NAME="KBCreate" CONTENT="1995/05/11">
<META NAME="Keywords" CONTENT="kbprg kbcode kbprb kbdocerr">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  Triggers that fail while working interactively in a Browse or a Grid are not captured by the ON ERROR Routine. Instead the Default Message,  Trigger Failed  is displayed. This seems inconsistent with what is documented in the Help file and in the  ...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QATP,QAEF,QAGB,QBCT,QA5V,QAGC,QAAP,QAH4,QAB4,QDKD,QBWT,QBVV,QDKW,QAB9,QAKP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: ON ERROR Not Called When Trigger Fails in Browse or Grid</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 30, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q130131</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, version 3.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Triggers that fail while working interactively in a Browse or a Grid are
not captured by the ON ERROR Routine. Instead the Default Message, "Trigger
Failed" is displayed. This seems inconsistent with what is documented in
the Help file and in the "Language Reference" manual under CREATE TRIGGER.
<P>
<P><h2>CAUSE</h2>
 
<P>
This is because the firing of a trigger in the context of a Browse or Grid
leaves the control in the hands of the Browse or Grid after the trigger
fires. If the normal error handler (the one that allows for ON ERROR) is
called, the option of RETRY becomes applicable. But because the Trigger
code finished executing, the last command to be retried is the Browse.
<P>
Therefore, choosing the RETRY option results in two problems:

<UL><LI>The Browse is retried instead of the trigger.
<LI>A new Browse or Grid is instantiated.
<P>
</UL>This scenario could result in an infinite loop.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
One way to work around this problem is to trap the failed triggers at the
Engine level, not at the Object level. In this case, put the appropriate
code to handle erroneous conditions in the trigger itself. This workaround
is shown below in the "More Information" section.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design. We are researching this design decision and
will post new information here in the Microsoft Knowledge Base if it
becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Execute the following code to create a DBC that contains a table with a
   delete trigger and to set up an ON ERROR routine:
<P>
   CLOSE ALL
   CREATE DATABASE dbTEST
   CREATE TABLE Test1 (Fld N(3), Fld2 C(3))
   CREATE TRIGGER ON Test1 FOR DELETE AS .F.
   ON ERROR WAIT WINDOW 'Delete Trigger Failed'

<P><LI>Open the dbTEST database, then open the table Test1 with the USE
   command, and use the BROWSE command to browse the table. Then issue the
   following two commands from the Command window:
<P>
   APPEND BLANK
   DELETE NEXT 1
<P>
   When the Trigger fails, the Wait window is displayed. Everything is as
   expected.

<P><LI>Browse the table again, and use the mouse to delete a record. This time
   when the Trigger fails, no Wait window is displayed. Instead the
   default system message "Trigger Failed" is displayed.
<P>
</OL><h3>Steps to Implement Workaround</h3>
 

<OL><P><LI>Change the CREATE TRIGGER statement to read:
<P>
   CREATE TRIGGER ON Test1 FOR DELETE AS MyDelTrig()

<P><LI>Remove the ON ERROR WAIT WINDOW 'Delete Trigger Failed' line from the '
   code.

<P><LI>Add the following Procedure to the "Stored Procedures":
<P>
   PROCEDURE MyDelTrig
   IF Fld &gt;= 10
<P><PRE>      RETURN .T.
</PRE>   ELSE
<P><PRE>      =MESSAGEBOX("Test1 must be greater than '10' to be deleted ;
      "+CHR(13)+"Record Number: "+STR(RECNO())+" Was NOT deleted!")
<PRE></PRE>         IF CURSORGETPROP('BUFFERING') &gt; 1
            =TABLEREVERT(.F.) &amp;&amp;Buffering enabled Revert record.
         ELSE
            RECALL NEXT 1 &amp;&amp;Buffering NOT enabled Revert record.
         ENDIF
   ENDIF
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00  VFoxWin<BR>
KBCategory: kbprg kbcode kbprb kbdocerr<BR>
KBSubcategory: FxprgBrowse<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 30, 1996</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
