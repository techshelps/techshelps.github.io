

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>FIX: Subquery Causes SUM to Return Incorrect Results </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q165066">
<META NAME="KBModify" CONTENT="1997/10/29">
<META NAME="KBCreate" CONTENT="1997/03/12">
<META NAME="Keywords" CONTENT="buglist5.00 FxprgSql vfpfix5.0a kbbuglist kbfixlist">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  Including a subquery with a SQL-SELECT statement containing a SUM command causes the SUM command to report incorrect amounts.  STATUS ======  Microsoft has confirmed this to be a problem in the Microsoft products listed at the beginning of this art...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QACI,QAL3,QAKD,QA9N,QAY4,QAOE,QAMA,QAH4,QAWI,QAR4,QAAP,QBPJ,QAUD,QDNB,QA56 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Subquery Causes SUM to Return Incorrect Results</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 29, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q165066</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, version 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Including a subquery with a SQL-SELECT statement containing a SUM command
causes the SUM command to report incorrect amounts.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the Microsoft products
listed at the beginning of this article. This problem was corrected in
Visual FoxPro 5.0a for Windows.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following code creates a table, populates it with data, and performs a
SELECT-SQL statement containing a subquery.
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 
<P>
Create a program containing the following lines of code and execute it:
<P>
<PRE>   *** Begin program code

   CLOSE ALL
   CREATE CURSOR Master ( nId I, cName C(10))
   INSERT INTO Master VALUES ( 1, "One")
   INSERT INTO Master VALUES ( 2, "Two")
   INSERT INTO Master VALUES ( 3, "Three")
   INSERT INTO Master VALUES ( 4, "Four")

   CREATE CURSOR Results ( nId I, dDate D)
   INSERT INTO Results VALUES ( 1, DATE())
   INSERT INTO Results VALUES ( 1, DATE())
   INSERT INTO Results VALUES ( 1, DATE())
   INSERT INTO Results VALUES ( 1, DATE())
   INSERT INTO Results VALUES ( 2, DATE() + 3)
   INSERT INTO Results VALUES ( 2, DATE() + 3)
   INSERT INTO Results VALUES ( 2, DATE() + 3)

   CREATE CURSOR Detail ( nId I, nAmount Y)
   INSERT INTO Detail VALUES ( 1, 100.00)
   INSERT INTO Detail VALUES ( 3, 300.00)

   * This will show correct sums
   WAIT WINDOW "Correct:" timeout 3
   SELECT Master.cName, ;
      SUM( NVL( Detail.nAmount, 0)) AS nSum ;
      FROM Master LEFT OUTER JOIN Detail ON Detail.nId = Master.nId ;
      GROUP BY 1

   * However, if I add an additional subquery, sum results are wrong.
   WAIT WINDOW "w/ Subquery - Wrong under VFP 5.0:" timeout 3
   SELECT Master.cName, ;
      SUM( NVL( Detail.nAmount, 0)) AS nSum ;
      FROM Master LEFT OUTER JOIN Detail ON Detail.nId = Master.nId ;
      WHERE Master.nId IN ( SELECT DISTINCT nId FROM Results ) ;
      GROUP BY 1

   CLOSE ALL
   *** End of program code

</PRE>Executing the first query in Visual FoxPro 5.0 gives the following
results:
<P>
<PRE>   Cname       Nsum
   -----       -----
   Four        0.0000
   One         100.000
   Three       300.000
   Two         0.00000

</PRE>The second query in Visual FoxPro 5.0, which contains the subquery, gives
the following incorrect results based on the same data:
<P>
<PRE>   Cname       Nsum
   -----       -----
   One         0
   Two         0

</PRE>In Visual FoxPro 5.0a, the results of the first query remain the same.
However, the second query correctly returns to following values:
<P>
<PRE>   Cname       Nsum
   -----       -----
   One         100.0000
   Two         0.0000
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 5.0<BR>
Keywords          : buglist5.00 FxprgSql vfpfix5.0a kbbuglist kbfixlist<BR>
Version           : 5.0<BR>
Platform          : WINDOWS<BR>
Issue type        : kbbug<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 29, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
