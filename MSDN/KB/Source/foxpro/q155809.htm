

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>How To Use the SYS(3053) Function Handle with ODBC </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q155809">
<META NAME="KBModify" CONTENT="1997/01/20">
<META NAME="KBCreate" CONTENT="1996/09/09">
<META NAME="Keywords" CONTENT="kbusage kbprg kbhowto">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  Visual FoxPro 5.0 introduces a new SYS() function, SYS(3053), which returns the ODBC hEnv (environment handle) that Visual FoxPro uses for connectivity operations. One of the uses of the SYS() function is to get a list of available datasources that...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAY5,QAUD,QA9E,QA56,QA55,QA4Q,QBV8,QAB9,QAX1,QAIJ,QAH6,QAGI,QALW,QBSO,QABI V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How To Use the SYS(3053) Function Handle with ODBC</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 20, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q155809</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, version 5.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Visual FoxPro 5.0 introduces a new SYS() function, SYS(3053), which returns
the ODBC hEnv (environment handle) that Visual FoxPro uses for connectivity
operations. One of the uses of the SYS() function is to get a list of
available datasources that users can connect to.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
NOTE: Visual FoxPro uses the ODBC environment handle returned by SYS(3053)
for all of its connectivity operations. Use this handle for information
retrieval, not for changing options associated with it. In particular, you
should not call functions such as SQLFreeEnv(), which would release the
handle while FoxPro was using it and cause instability in the Visual FoxPro
environment.
<P>
The SYS(3053) return value is called an hEnv, which is a handle used by
ODBC to describe an environment in which connectivity operations take
place. One feature not available natively in FoxPro is the ability to
generate a list of datasources on users' machines.
<P>
ODBC has an API function called SQLDataSources that you can use to provide
this functionality. SQLDataSources requires an hEnv--which you can get from
the SYS(3053) function--to be passed to it. The sample below uses the
Visual FoxPro DECLARE (DLL) function to register the SQLDataSources API,
and then passes the value returned from SYS(3053) to that API in order to
retrieve the list of datasources and descriptions.
<P>
#DEFINE SQL_FETCH_NEXT 1
#DEFINE SQL_FETCH_FIRST 2
#DEFINE SQL_SUCCESS 0
#DEFINE MAX_STRING 128
<P>
DECLARE INTEGER SQLDataSources IN ODBC32.DLL ;
<PRE>   INTEGER henv, SHORT fdirection, ;
   STRING @szDSN, INTEGER cbDSNMax, ;
   INTEGER @pcbDSN, STRING @szDescription, ;
   INTEGER cbDescriptionMax, INTEGER @pcbDescriptionn

hEnv = VAL(SYS(3053))      &amp;&amp; The hEnv (converted to a number)
cbDsnMax = MAX_STRING      &amp;&amp; How long can the DSN Name be?
pcbDSN = 0                 &amp;&amp; How many were actually returned
</PRE>cbDescriptMax = MAX_STRING &amp;&amp; How long can the description be?
<PRE>pcbDescript = 0            &amp;&amp; How long the description actually was

fDirection = SQL_FETCH_FIRST     &amp;&amp; The first time start at the top
retVal = SQL_SUCCESS             &amp;&amp; Start with no errors
</PRE>DO WHILE (retVal = SQL_SUCCESS)
<PRE>   szDsn = SPACE(MAX_STRING+1)   &amp;&amp; Make sure there is enough space
   szDescript = SPACE(MAX_STRING+1)

   retval = SQLDataSources(hEnv, fDirection, ;
                  @szDSN, cbDSNMax, @pcbDSN, ;
                  @szDescript, cbDescriptMax, @pcbDescript)
   ? LEFT(szDSN, pcbDSN)
   ? LEFT(szDescript, pcbDescript)

   * We only want to do the SQL_FETCH_FIRST the first time
   fDirection = SQL_FETCH_NEXT
</PRE>ENDDO
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbusage kbprg kbhowto<BR>
KBSubcategory: FxinteropOdbc<BR>
Additional reference words: 5.00 kbdse vfoxwin
<P>


</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 20, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
