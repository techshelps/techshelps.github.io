

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>How to Implement Pessimistic Locking on SQL Server </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q115838">
<META NAME="KBModify" CONTENT="1995/06/27">
<META NAME="KBCreate" CONTENT="1994/06/05">
<META NAME="Keywords" CONTENT="kbinterop kbprg kbcode">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  This article describes how to use the FoxPro Connectivity Kit to prevent other users from updating a table on which you have executed an SQL SELECT statement before you UPDATE the table with any needed changes. This locking strategy is known as  pe...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDMF,QABM,QAXB,QBWP,QABT,QBG2,QBD2,QA2Q,QAC1,QAG2,QBXS,QAYZ,QAB5,QBWS,QAK7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to Implement Pessimistic Locking on SQL Server</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 27, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q115838</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft FoxPro for Windows, versions 2.5, 2.5a, 2.5b, 2.6
<LI>Microsoft FoxPro Connectivity Kit, versions 2.5, 2.6
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article describes how to use the FoxPro Connectivity Kit to prevent
other users from updating a table on which you have executed an SQL SELECT
statement before you UPDATE the table with any needed changes. This locking
strategy is known as "pessimistic locking."
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
In Transact-SQL in SQL Server for Windows NT, the SELECT statement can use
the HOLDLOCK keyword to hold a shared lock that it has set until a
transaction has been completed instead of releasing the lock as soon as the
required table is no longer needed.
<P>
You can accomplish this with the Connectivity Kit by using a routine
similar to the one shown below.
<P>
<PRE>   * CKPLOCK.PRG
   * Pessimistic Locking on SQL Server with the CK
   * Assumes pass of a valid connection handle or connection handle = 1
   * Uses 'pubs' database

   PARAMETERS dbHdle

   IF TYPE('dbHdle') = "L"
      STORE 1 TO dbHdle
   ENDIF

   STORE 0 TO lnResult

   *---- Use pubs database
   lnResult = DBExec(dbHdle, "use pubs")

   *---- Set Transaction Mode to manual (required for this to work)
   lnResult = DBSetOpt(dbHdle, "Transact", 2)

   *---- SELECT a rowset to update and lock the table until transaction
   *---- is completed. Note that SELECT without HOLDLOCK will not normally
   *---- cause the table to be locked.
   lnResult = DBExec(;
     dbHdle, "SELECT * FROM sales HOLDLOCK WHERE sales.stor_id = '7131' ")

   *---- FoxPro program would normally perform any necessary data changes
   *---- locally at this point.
   WAIT WINDOW "Table is now locked on server ... " TIMEOUT 5

   *---- Write changed data back
   lnResult = DBExec(;
     dbHdle,"UPDATE sales SET sales.qty =25 WHERE sales.stor_id='7131' ;
      AND sales.ord_num = 'P3087a' ")

   *---- Commit results
   lnResult = DBTransact(dbHdle, "Commit")

   *---- Set Transaction Mode back to Automatic
   lnResult = DBSetOpt(dbHdle, "Transact", 1)

   WAIT WINDOW ;
     "Table is now available for updating by another user on server ... " ;
     TIMEOUT 2

</PRE><h2>REFERENCES</h2>
 
<P>
"Transact-SQL Reference" for Microsoft SQL Server for Windows NT, pages 403-
405
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: FoxWin 2.50 2.50a 2.50b 2.60 CK<BR>
KBCategory: kbinterop kbprg kbcode<BR>
KBSubcategory: FxtoolCk<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 27, 1995</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
