

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: CURVAL() Returns Same Value as OLDVAL() </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q130299">
<META NAME="KBModify" CONTENT="1996/04/30">
<META NAME="KBCreate" CONTENT="1995/05/16">
<META NAME="Keywords" CONTENT="kbprg kbprb kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  Under certain circumstances, CURVAL() and OLDVAL() return the same value.  CAUSE =====  This is by design. CURVAL() and OLDVAL() only return different values when the following two conditions are both true:   - Optimistic buffering is enabled.  - A...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAJQ,QAUD,QA5V,QAKD,QAH4,QA9N,QAI2,QBWS,QAC1,QA7O,QA7N,QA4F,QAY5,QAYY,QAXB V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: CURVAL() Returns Same Value as OLDVAL()</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 30, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q130299</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, version 3.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Under certain circumstances, CURVAL() and OLDVAL() return the same value.
<P>
<P><h2>CAUSE</h2>
 
<P>
This is by design. CURVAL() and OLDVAL() only return different values when
the following two conditions are both true:

<UL><LI>Optimistic buffering is enabled.
<LI>Another user has modified the current record in a table while you were
   editing it.
<P>
</UL>In addition, CURVAL() and OLDVAL() return the same value if the all three
of the following conditions are met:

<UL><LI>Two forms in the same Visual FoxPro session are using the same table.
<LI>The data on one instance of the form has been modified.
<LI>The data on another instance of the form has not been modified.
<P>
</UL>In this case, CURVAL() does not return a different value because the two
instances of the forms share a data session by default. Because the user
has locked the record in the first form, the data session in the second
form considers itself to have locked the record as well.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Choose one of the following threee alternatives:

<UL><LI>If you want to write code to determine if the current user has modified
   the current record, use the GETFLDSTATE() function. The GETFLDSTATE()
   function returns a numeric value indicating if one or more fields in
   the current record have changed, if a record was appended, or if the
   deletion status of the current record has changed. For more information
   on using GETFLDSTATE(), please see the Visual FoxPro Help file.
<P>
   -or-

<LI>If you want to test code in a multiuser scenario, you must have two data
   sessions running. To do this:
<P>
<P><PRE>    - Run two instances of Visual FoxPro simultaneously on the same or
      networked computers.
</PRE><P>
<P><PRE>      -or-
</PRE><P>
<P><PRE>    - Set the DataSession property of the form to 2 - Private Data Session,
      and run two instances of the form.
</PRE><P>
   -or-

<LI>If you are using pessimistic buffering, or no buffering, change to
   optimistic row or table buffering by using the CURSORSETPROP() function
   in the init method of the form. For example, enter the following command
   to set optimistic table buffering:
<P>
   =CURSORSETPROP("BUFFERING",5)
<P>
</UL><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Create a new form, and add a table to the data environment.

<P><LI>Drag at least one field from the data environment onto the form.

<P><LI>Add a command button to the form. Set the caption of the button to
   "Display" (without the quotation marks). In the click event of the
   button, type the following code, substituting the field name from step 2
   for &lt;fieldname&gt;. The field name should be enclosed in quotation marks:
<P>
   =MESSAGEBOX("Current value of field:  " + CURVAL(&lt;'fieldname'&gt;) + ;
<PRE>              CHR(13) + ;
              "Old value of field:      " + OLDVAL(&lt;'fieldname'&gt;))

</PRE><P><LI>Add a second command button to the form. Set the caption of the button
   to "Update" (without the quotation marks). In the click event of the
   button, type the following code:
<P>
   =TABLEUPDATE()

<P><LI>In the init event of the form, add the following code:
<P>
   =CURSORSETPROP("BUFFERING",5)

<P><LI>Save the form as TESTFORM.

<P><LI>In the Command window, type DO FORM TESTFORM and press ENTER. Repeat
   this step.

<P><LI>Move the forms so that you can see each form on the screen.

<P><LI>Change the data in one copy of the form, and press ENTER. Click the
   Display button. The current value and old value should be the same.
   Click the Update button.

<P><LI>Click the second copy of the form. Click the Display button. The
<P><PRE>    current and old value should be the same.
</PRE>
<P><LI>Close both instances of the form. Change the form.DataSession property
<P><PRE>    to 2, and run both copies of the form again. The curval() and oldval()
    functions should display the same value on the copy of the form in
    which you changed the data. After clicking the Update button in this
    copy of the form, the unmodified copy of the form should display
    different values for the curval and oldval functions.
<P></BLOCKQUOTE>
</OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 VFoxWin  multi-user<BR>
KBCategory: kbprg kbprb kbnetwork<BR>
KBSubcategory: FxprgTable<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 30, 1996</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
