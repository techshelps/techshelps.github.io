

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>HOWTO: Return Multiple Recordsets with Column Names and Values </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q182290">
<META NAME="KBModify" CONTENT="1998/03/12">
<META NAME="KBCreate" CONTENT="1998/03/10">
<META NAME="Keywords" CONTENT="mdacGenInfo">
<META NAME="KBArea" CONTENT="Support; KB; mdac">
<META NAME="Description" CONTENT="  This article contains sample code using Visual Basic version 5.0 that demonstrates how to return multiple ADO Recordsets from a Microsoft SQL Server stored procedure. The code also demonstrates how to extract the column names and values from each A...">
<META NAME="Product" CONTENT="mdac">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QAVX,QAUD,QBWS,QAH4,QBS0,QAY2,QA2Q,QANF,QAB9,QA1S,QDNQ,QA6A,QAYY,QAUJ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Return Multiple Recordsets with Column Names and Values</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 12, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q182290</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Data Access Components, version 1.5
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article contains sample code using Visual Basic version 5.0 that
demonstrates how to return multiple ADO Recordsets from a Microsoft SQL
Server stored procedure. The code also demonstrates how to extract the
column names and values from each ADO Recordset as each row is returned.
<P>
Returning multiple ADO Recordsets is only supported using Server-Side
Firehouse cursors, which are Forward-Only, Read-Only Recordsets that reside
on the Server.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
This application requires a Microsoft SQL Server stored procedure that will
return multiple Recordsets. An example of the script required to accomplish
this task is given below. It is assumed that the reader is familiar with
creating stored procedures in Microsoft SQL Server. This stored procedure
uses the pubs database supplied with Microsoft SQL Server. You need to run
the following script against the pubs database before running the sample
code:
<P>
<PRE>   CREATE PROCEDURE Multi_Results AS

   SELECT * FROM Authors
   SELECT * FROM Stores
   SELECT * FROM Sales
   GO

</PRE>NOTE: You need to acquire and install the Microsoft Data Access Components
(MDAC) 1.5 stack for the sample in this article. Please refer to the
article listed in the REFERENCES section for more information on MDAC 1.5.
<P>
After the stored procedure is created, follow these steps:

<OL><P><LI>Open a new project in Visual Basic 5.0. Form1 is created by default.

<P><LI>Place a command button on the new Form.

<P><LI>From the Project menu, select References and then select Microsoft
   ActiveX Data Objects 1.5. (This was installed with the MDAC 1.5 stack.)

<P><LI>Place the following code in the General Declarations section of Form1.
   You may need to alter the database connection information. Here is the
   code:
<P>
<P><PRE>      Private Sub Command1_Click()
      Dim Conn1 As New ADODB.Connection
      Dim Cmd1 As New ADODB.Command
      Dim Rs1 As New ADODB.Recordset
      Dim RSField As ADODB.Field
      Dim ColCnt, Cnt1, i As Long
</PRE><P>
<P><PRE>      Debug.Print "----Starting-----"
</PRE><P>
<P><PRE>      'Create all the objects required by this application.
      '
      'The connection string will have to be modified to reflect your data
      'source name (DSN).
      Conn1.Open "MyDSN", "sa", ""
      Conn1.DefaultDatabase = "pubs"
      Conn1.CursorLocation = adUseServer
      'Conn1.CursorLocation = adUseClient  'This will give error 3251 -
<PRE></PRE>                          '"The operation requested by the application
                          'is not supported by the provider" when calling
                          'the NextRecordset method.
      Cmd1.ActiveConnection = Conn1
      Cmd1.CommandType = adCmdStoredProc
      Cmd1.CommandText = "Multi_Results"

      'Opens a Forward-Only, Read-Only Recordset cursor.
      Set Rs1 = Cmd1.Execute

      'Continue looping while the Recordset state is open.
      Do While Rs1.State = adStateOpen
         ColCnt = Rs1.Fields.Count
         Debug.Print "The Recordset State is " &amp; Rs1.State
         Debug.Print "The Column Count is: " &amp; ColCnt

         Do While Not Rs1.EOF    'Cycle through the Recordset.

            Debug.Print "Next Record:"
            Cnt1 = 0

            'Cycle through the Field collection.
            For Each RSField In Rs1.Fields
               Debug.Print "   " &amp; RSField.Name &amp; " = " &amp; Rs1(Cnt1)
               Cnt1 = Cnt1 + 1
               If Cnt1 = ColCnt Then
                   Exit For
               End If

            Next RSField

            Rs1.MoveNext
         Loop

         'IMPORTANT:
         'The call to NextRecordset only works with firehose cursors
         'that exist on the server-side.
         '
         'Put a breakpoint here to see the last results in the Debug
</PRE></OL>window.
<PRE>         '
              Set Rs1 = Rs1.NextRecordset

              If Rs1.State = adStateOpen Then
                  Debug.Print
                  Debug.Print "***** NEXT RECORDSET *****"
              Else
                  Debug.Print
                  Debug.Print "***** THE END *****"
                  Exit Do
              End If

      Loop

      Set Rs1 = Nothing
      Unload Me   'Quit the application.

      End Sub

</PRE>Run the application by pressing F5 and click the command button. The
results will be displayed in the Debug window.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For additional information on MDAC 1.5, please see the following article in
the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../VBWIN/Q175018.htm">Q175018</A></B>
   TITLE     : HOWTO: Acquire and Install the Microsoft Oracle ODBC Driver
               v2.0


</PRE>(c) Microsoft Corporation 1998, All Rights Reserved.
Contributions by Ron Nelson, Microsoft Corporation
 
<PRE>Keywords          : mdacGenInfo
Version           : WINDOWS:1.5
Platform          : WINDOWS
Issue type        : kbhowto</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 12, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
