

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>FIX: Assertion Using Multiple %1 (or %2) in AfxFormatString1 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q116212">
<META NAME="KBModify" CONTENT="1997/09/18">
<META NAME="KBCreate" CONTENT="1994/06/13">
<META NAME="Keywords" CONTENT="MfcMisc kbbuglist kbfixlist kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  When you use the AfxFormatString1() or AfxFormatString2() function, with more than one %1 or %2 parameter in the template string, the following assertion occurs:     File strcore1.cpp, Line 269, Assertion Failed!  CAUSE =====  These functions do no...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH6,QATX,QAR4,QA56,QA55,QA4F,QAMB,QDL9,QBWQ,QBWO,QBWN,QAH4,QBWP,QBFY,QAJN V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Assertion Using Multiple %1 (or %2) in AfxFormatString1</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 18, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q116212</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
1.00 1.50 | 1.00
<PRE>WINDOWS   | WINDOWS NT
</PRE>kbprg kbfixlist kbbuglist
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
<P>
<P><PRE>    - Microsoft Visual C++ for Windows, versions 1.0 and 1.5
    - Microsoft Visual C++, 32-bit Edition, version 1.0
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you use the AfxFormatString1() or AfxFormatString2() function, with
more than one %1 or %2 parameter in the template string, the following
assertion occurs:
<P>
<PRE>   File strcore1.cpp, Line 269, Assertion Failed!

</PRE><h2>CAUSE</h2>
 
<P>
These functions do not allocate enough memory for multiple parameters to be
used. However, in the case of AfxFormatString2(), two parameters may be
used (one %1 and one %2) successfully. It is the use of two %1's or two
%2's that causes the problem.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article. This problem has been corrected in MFC
3.0, included with Visual C++ version 2.0.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
You can reproduce the problem by using the following steps:

<OL><P><LI>Create a .CPP file using the sample code provided below.

<P><LI>Create a new Windows project that uses MFC, and add the .CPP that you
   just created to the project.

<P><LI>Use App Studio to create a string table that includes the following two
   entries:
<P>
<P><PRE>      IDS_THETEMPLATE = File %1 has some text associated with it.
      IDS_THENEWTEMPLATE = File %1 and %1 have associated text.
</PRE>
<P><LI>Save the string information in an .RC file.

<P><LI>Add the newly created .RC file to the project by choosing Edit from the
   Project menu.

<P><LI>Perform a build. Visual Workbench creates a .DEF file for you if you do
   not supply your own .DEF file.

<P><LI>Run the program to view the assertion.
<P>
</OL><h3>Sample Code</h3>
 
<P>
<PRE>/* Compile options needed: Default MFC-Windows project options
*/
   /////////////////////////////////////////////////////////////////////
   // main cpp file
   /////////////////////////////////////////////////////////////////////
   #include &lt;afxwin.h&gt;          // Provide access to MFC
   #include "resource.h"     // App Studio puts resource ID's here

   // myWinApp hooks us into the MFC application processing
   class myWinApp : CWinApp
   {
   public:
        BOOL InitInstance();
   };

   BOOL myWinApp::InitInstance()
   {
     CString theOutputString;

     // This works fine
     AfxFormatString1( theOutputString, IDS_THETEMPLATE,
                       "filename.ext" );
     TRACE("theOutputString=%s\n", theOutputString);

     // Comment this out to avoid Assertion
     AfxFormatString1( theOutputString, IDS_THENEWTEMPLATE,
                       "filename.ext");
     TRACE("theOutputString=%s.\n", theOutputString);

     return FALSE; // Terminate the program
   }

   myWinApp theApp;

   /////////////////////////////////////////////////////////////////////
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 1.00 1.50 2.00 2.10 2.50 AfxFormatString2<BR>
KBCategory: kbprg kbfixlist kbbuglist<BR>
KBSubcategory: MfcMisc<BR>
Keywords          : MfcMisc kbbuglist kbfixlist kbprg<BR>
Technology        : kbMfc<BR>
Version           : 1.00 1.50 | 1.00<BR>
Platform          : NT WINDOWS<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 18, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
