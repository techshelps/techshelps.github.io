

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>FIX: Application Fails But Gives No Error Message </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q133302">
<META NAME="KBModify" CONTENT="1997/09/18">
<META NAME="KBCreate" CONTENT="1995/07/27">
<META NAME="Keywords" CONTENT="LibIss MfcMisc kbbuglist kbcode kbfixlist kbother kbtshoot">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  A Windows-based application using the DLL version of the CRT (C run-time) causes a run-time error and exits without displaying any error message or notification.  CAUSE =====  There are two ways to notify a user of a run-time error -- one for Windo...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB4,QAH4,QAJH,QAC2,QAAP,QAGB,QACI,QAR4,QAR5,QAEV,QBHU,QBHT,QBWD,QAKP,QAI4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Application Fails But Gives No Error Message</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 18, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q133302</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
2.00 2.10 2.20
Windows NT
kbother kbbuglist kbfixlist kbcode kbtshoot
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Visual C++, 32-bit Edition, versions 2.0, 2.1, 2.2
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
A Windows-based application using the DLL version of the CRT (C run-time)
causes a run-time error and exits without displaying any error message or
notification.
<P>
<P><h2>CAUSE</h2>
 
<P>
There are two ways to notify a user of a run-time error -- one for Windows-
based applications and one for console-based applications. A Windows-based
application linked with the static CRT pops up a dialog box with the
run-time error number. A console-based application outputs the error
message to stderr. However a Windows-based application using the CRT DLL
calls the console version, which outputs to stderr. Because stderr does
nothing in a Windows-based application, the application terminates without
giving a warning or notification.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Here are two workarounds for a Windows-based application using the CRT DLL:

<UL><LI>Use the static CRT library version.
<P>
   -or-

<LI>Use the sample code listed in the "More Information" section of this
   article.
<P>
</UL>The initialization section of the sample code allocates a console window
for the Windows-based application and redirects stderr. CreateProcess()
must then be used so that the window will not terminate with a run-time
error. If the application encounters a run-time error, the console window
stays on the screen to display the run-time error message.
<P>
The initialization part of the sample code should execute before any other
global data initialization. Within a source file, the order of execution
will be in the order the initializations appear in the file. In order to
ensure that the initialization code is executed first, place the code
within that compilation unit at the top of the file, after include files.
<P>
The order of initialization of data in different compilation units cannot
be guaranteed. If your application is still exiting without a message you
can use the first workaround, or you can place all your global data in the
same compilation unit, with the sample initialization code at the top of
the file.
<P>
The termination section of the sample code is used for the normal
termination of the application. It ensures that the console window is
destroyed when the application terminates. For MFC applications, place the
termination code in the application object's ExitInstance() member
function. In a non-MFC Windows-based application, place this code in the
WM_DESTROY message hanlder.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article. This problem was corrected in Visual C++
4.0
<P>
<P><h2>REFERENCES</h2>
 
<P>
<P><h3>Sample Code - Initialization Section</h3>
 
<P>
<PRE>/* The following lines of code need to be placed in file scope, in
   one source file, in your project. */

#include   &lt;stdio.h&gt;
#include   &lt;wincon.h&gt;

PROCESS_INFORMATION    pi;

int    InitConsoleWindow()
</PRE>{
<PRE>   STARTUPINFO si = {0};            // Initialize all members to zero
   si.cb = sizeof(STARTUPINFO);     // Set byte count

   AllocConsole();                  // Allocate console window
   freopen("CONOUT$", "a", stderr); // Redirect stderr to console

   // Display user message in console window.
   fprintf(stderr, "Application stderr output window\n");
   fprintf(stderr, "DO NOT CLOSE THIS WINDOW, ");
   fprintf(stderr, "it will terminate your application!\n");

   return CreateProcess(NULL,// address of module name
          "cmd.exe",         // address of command line
          NULL,              // address of process security attributes
          NULL,              // address of thread security attributes
          TRUE,              // new process inherits handles
          CREATE_SUSPENDED,  // creation flags
          NULL,              // address of new environment block
          NULL,              // address of current directory name
          &amp;si,               // address of STARTUPINFO
          &amp;pi);              // address of PROCESS_INFORMATION
}

int  nInit = InitConsoleWindow();

</PRE><h3>Sample Code - Termination Section</h3>
 
<P>
<PRE>/* The following two lines need to be placed in the normal termination
   procedure for your application. */

</PRE>TerminateProcess(pi.hProcess, 0);
CloseHandle(pi.hProcess);
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 2.00 2.10 2.20 3.00 3.50 3.51 4.00<BR>
KBCategory: kbother kbbuglist kbfixlist kbcode kbtshoot<BR>
KBSubcategory: LibIss MfcMisc<BR>
Keywords          : LibIss MfcMisc kbbuglist kbcode kbfixlist kbother kbtshoot<BR>
Technology        : kbMfc<BR>
Version           : 2.00 2.10 2.20<BR>
Platform          : NT WINDOWS<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 18, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
