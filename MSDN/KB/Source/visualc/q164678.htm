

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: Incorrect Syntax Near 'FOR' When Calling Stored Procedure </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q164678">
<META NAME="KBModify" CONTENT="1997/07/18">
<META NAME="KBCreate" CONTENT="1997/03/06">
<META NAME="Keywords" CONTENT="kb16bitonly MfcDatabase kbprb">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  Opening a snapshot-type recordset and calling a SQL Server stored procedure in Open() throws a CDBException with the following error message:        DBMS: Microsoft SQL Server, Version: 06.00.0121       Incorrect syntax near the keyword 'FOR'.     ...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QAGI,QAPN,QA9E,QAXB,QAB9,QAIF,QAU9,QAAP,QAC1,QAB4,QABA,QBD2,QBWS,QAA5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Incorrect Syntax Near 'FOR' When Calling Stored Procedure</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 18, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q164678</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
   - Microsoft Visual C++ for Windows, 16-bit edition, version 1.52
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Opening a snapshot-type recordset and calling a SQL Server stored
procedure in Open() throws a CDBException with the following error
message:
<P>
<PRE>      DBMS: Microsoft SQL Server, Version: 06.00.0121
      Incorrect syntax near the keyword 'FOR'.
      State:37000[Microsoft][ODBC SQL Server Driver][SQL Server]

</PRE><h2>CAUSE</h2>
 
<P>
When you open a snapshot with the default settings, the 16-bit MFC ODBC
classes add a "FOR UPDATE OF" clause at the end of the SQL statement. The
SQL Server ODBC drivers (2.10.2401 or later) do not accept this clause
with the CALL statement.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Open the recordset as readOnly when you use a CALL statement to execute a
stored procedure.
<P>
<PRE>     MyCRecordset rs;
     rs.Open(CRecordset::snapshot,"{CALL sp_myproc}";
     CRecordset::readOnly);

</PRE><h2>MORE INFORMATION</h2>
 
<P>
This behavior is by design.
<P>
The Microsoft SQL Server ODBC driver version 2.00.1912 that ships with
Visual C++ 1.52, accepts the ‘FOR UPDATE OF’ clause. However, newer SQL
Server ODBC drivers (version 2.10.2401 or later) will return an error in
SQLPrepare() when you call a stored procedure in a snapshot-type recordset
with default options.
<P>
The exception is thrown when SQLPrepare() is executed at line 1226 in
dbcore.cpp.
<P>
The 32-bit MFC ODBC classes do not add the "FOR UPDATE OF" clause to a
CALL statement.
<P>
<P><h2>REFERENCES</h2>
 
The Non-supported ODBC SQL Grammar section in drvssrvr.hlp
(SQL Server driver help file)
<P>
For more information, please see the following article in the Microsoft
Knowledge Base:
<P>
<PRE>      ARTICLE-ID: <B><A HREF="../VISUALC/Q131401.htm">Q131401</A></B>
      TITLE     : PRB: Couldn't Find Object on Recordset for Predefined
                  Query
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : kb16bitonly MfcDatabase kbprb<BR>
Technology          : kbMfc<BR>
Version             : 1.52 2.52<BR>
Platform            : NT WINDOWS<BR>
Issue type          : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 18, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
