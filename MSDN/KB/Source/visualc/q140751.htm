

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: Problems Occur When Defining _AFX_NO_XXX </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q140751">
<META NAME="KBModify" CONTENT="1997/07/31">
<META NAME="KBCreate" CONTENT="1995/12/06">
<META NAME="Keywords" CONTENT="MfcMisc kbprb kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  The _AFX_NO_XXX macros are not intended to be defined or undefined by users of MFC. These macros exist only for the purpose of checking whether a particular target platform supports that feature or not. You can write your program to check these mac...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QBVV,QAY5,QAPF,QBWP,QABH,QACJ,QABI,QA1S,QBHQ,QAYV,QAO4,QALQ,QAGI,QAEF V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Problems Occur When Defining _AFX_NO_XXX</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 31, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q140751</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
4.00
WINDOWS NT
kbprg kbprb
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
   Microsoft Visual C++, 32-bit Edition, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The _AFX_NO_XXX macros are not intended to be defined or undefined by users
of MFC. These macros exist only for the purpose of checking whether a
particular target platform supports that feature or not. You can write your
program to check these macros (for example, #ifndef _AFX_NO_OLE_SUPPORT),
but your program should never define or undefine these macros.
<P>
If you define _AFX_NO_OLE_SUPPORT, the symptoms might include:

<UL><LI>Application encounters Access Violation on start-up.
<LI>InitInstance is not called in a DLL.
<P>
</UL>Other macros that you should not define include:
<P>
_AFX_NO_AFXCMN_SUPPORT
_AFX_NO_CTL3D_RESOURCES
_AFX_NO_DAO_SUPPORT
_AFX_NO_DB_SUPPORT
_AFX_NO_MAPI_RESOURCES
_AFX_NO_NESTED_DERIVATION
_AFX_NO_OCC_SUPPORT
_AFX_NO_OCX_SUPPORT
_AFX_NO_OLE_SUPPORT
_AFX_NO_RICHEDIT_SUPPORT
_AFX_NO_SOCKET_SUPPORT
_AFX_NO_SPLITTER_RESOURCES
_AFX_NO_SYNC_SUPPORT
_AFX_NO_TRACKER_RESOURCES
<P>
<P><h2>CAUSE</h2>
 
<P>
If you define or undefine any of these macros differently from the way MFC
defines them, then your application's compile will be based on a different
definition of MFC than the pre-compiled MFC library.
<P>
One example of how these macros are used by MFC can be found in AfxWin.h.
CCmdTarget has the following section of code in its declaration:
<P>
class CCmdTarget : public CObject
{
...
#ifndef _AFX_NO_OLE_SUPPORT
<PRE>  // called before dispatching to an automation handler function
  virtual BOOL IsInvokeAllowed(DISPID dispid);
</PRE>#endif
...
};
<P>
If _AFX_NO_OLE_SUPPORT is defined in your project, then the declaration of
CCmdTarget will not include this virtual function. However, the compiled
version of CCmdTarget in the MFC library does contain this function. This
will result in a v-table mismatch between your code and MFC's code.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Don't define or undefine these macros in your own code. They are intended
to be tested only. For example, for maximum future portability, if MFC were
to eventually target a platform that did not contain OLE support, then you
could use _AFX_NO_OLE_SUPPORT as follows:
<P>
#ifndef _AFX_NO_OLE_SUPPORT
<PRE>  DoSomeOLEStuff();
</PRE>#endif
<P>
A common place to try to use these macros might be in your pre-compiled
header file (for example, StdAfx.h). In this case, you don't need to define
these symbols to prevent the including of unneccessary header files, you
can simply remove the #include lines.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.00<BR>
KBCategory: kbprg kbprb<BR>
KBSubcategory: MfcMisc<BR>
Keywords          : MfcMisc kbprb kbprg<BR>
Technology        : kbMfc<BR>
Version           : 4.00<BR>
Platform          : NT WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 31, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
