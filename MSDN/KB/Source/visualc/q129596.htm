

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: C2517, C2653, or C2600 If Local Struct Contains Class. </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q129596">
<META NAME="KBModify" CONTENT="1997/07/25">
<META NAME="KBCreate" CONTENT="1995/04/30">
<META NAME="Keywords" CONTENT="CPPIss kberrmsg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  In a C++ program, when you define a local struct, class, or union in which one or more of the fields contains a struct, class, or union type that defines member functions, the compiler generates these compiler errors:  In Visual C++ versions 1.5x: ...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAY5,QAB4,QAAP,QBFY,QBV8,QABO,QAB9,QAAW,QA56,QA55,QAOT,QBVV,QAKP,QA5E,QAUD V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: C2517, C2653, or C2600 If Local Struct Contains Class.</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 25, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q129596</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The Microsoft C/C++ Compiler (CL.EXE) included with:
   - Microsoft Visual C++ for Windows, versions 1.5, 1.51, 1.52
   - Microsoft Visual C++, 32-bit Edition, versions 2.0, 2.1, 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
In a C++ program, when you define a local struct, class, or union in which
one or more of the fields contains a struct, class, or union type that
defines member functions, the compiler generates these compiler errors:
<P>
In Visual C++ versions 1.5x:
<P>
<PRE>   Error C2517 : 'S' : right of '::' is undefined
   Error C2270 : 'S' : modifiers not allowed on nonmember functions
   Error C2561 : 'S' : function must return a value
   Error C2510 : 'S' : left of '::' must be a class/struct/union
   Error C2084 : function 'S' already has a body

</PRE>In Visual C++ versions 2.x:
<P>
<PRE>   Error C2653 : 'S' : is not a class name
   Error C2561 : 'S' : function must return a value
   Error C2084 : function 'int _cdecl S(void)' already has a body

</PRE>In Visual C++ version 4.0:
<P>
<PRE>   error C2600: 'a' : uses 'A' in local class 'S' causing compiler-
   generated special member functions
   error C2601: functions cannot be defined in local classes

</PRE>Using any MFC classes in the local structure will also cause this problem.
<P>
<P><h2>CAUSE</h2>
 
<P>
Function definitions are found in a local struct, class, or union
definition. Support for member functions of local classes is part of the
current draft of the C++ Working Paper, but they are not currently
supported by Microsoft Visual C++. They will be supported in a future
release of Microsoft Visual C++.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To work around the problem, choose one of the following two methods:

<UL><LI>Declare the structure in a file scope instead of a unit scope.
<P>
   -or-

<LI>If a local structure is needed for a class member function, define it
   inside the class definition instead of within the function body as in
   this example:
<P>
   class B;
   class A
   {
<P><PRE>     struct S
     {
       int a;
<PRE></PRE>       B   b;
     };
   };

</PRE></UL><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
In the sample code below, even though the local struct S does not, at first
glance, appear to have any member functions, the compiler attempts to
generate a non-trival default constructor and destructor for the local
struct S. Because the compiler is not designed to support member functions
of local classes, this hidden attempt to generate two such functions causes
the compiler to produce the error messages descibed in the SYMPTOMS section
of this article.
<P>
<P><h3>Sample Code to Reproduce Behavior</h3>
 
<P>
<PRE>   /* Compile options needed: none
   */

   struct A
   {
      A() {};
      ~A() {};
   };

   void main()
   {
      struct S
      {
         A a;
      };

      S s_test;
   }
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 8.00 8.00c 9.00 9.10<BR>
Keywords          : CPPIss kberrmsg<BR>
Version           : 1.5 1.51 1.52 2.0 2.1 4.0<BR>
Platform          : NT WINDOWS<BR>
Issue type        : kbprb<BR>
Solution Type     : Info_Provided<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 25, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
