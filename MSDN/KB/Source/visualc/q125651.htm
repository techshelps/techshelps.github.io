

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: Update or Delete Record Gives Error: Query is too complex </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q125651">
<META NAME="KBModify" CONTENT="1997/07/31">
<META NAME="KBCreate" CONTENT="1995/02/01">
<META NAME="Keywords" CONTENT="MfcDatabase kbprb kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  When trying to update or delete a record of a CRecordset object, the following message occurs:   - With 16-bit MFC database classes and 16-bit ODBC desktop drivers:     DBMS: ACCESS, Version: 2.0    Query is too complex.    State:S1000[Microsoft][O...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAXB,QAC1,QA5V,QAPN,QBJQ,QBD2,QA9E,QAU9,QAEF,QAE1,QBHQ,QAZV,QAO2,QA1S,QAA5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Update or Delete Record Gives Error: Query is too complex</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 31, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q125651</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
1.50 1.51 1.52 | 2.00 2.10 4.00 4.10
<PRE>WINDOWS        | WINDOWS NT
</PRE>kbprg kbprb
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC), included with:
<P>
<P><PRE>    - Microsoft Visual C++ for Windows, versions 1.50, 1.51, and 1.52
    - Microsoft Visual C++, 32-bit Edition, versions 2.0, 2.1,
      4.0, and 4.1
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When trying to update or delete a record of a CRecordset object, the
following message occurs:

<UL><LI>With 16-bit MFC database classes and 16-bit ODBC desktop drivers:
<P>
   DBMS: ACCESS, Version: 2.0
   Query is too complex.
   State:S1000[Microsoft][ODBC Microsoft Access 2.0 Driver]

<LI>With 32-bit MFC database classes and 32-bit ODBC desktop drivers:
<P>
   DBMS: ACCESS
   , Version: 2.0
   Query is too complex.
   State:S1000,Native:-3071,Origin:[Microsoft]
<P><PRE>      [ODBC Microsoft Access 2.0 Driver]
</PRE><P>
</UL>The examples above show "Microsoft Access 2.0" but could be any of the
Microsoft desktop drivers.
<P>
<P><h2>CAUSE</h2>
 
<P>
The error occurs when the cursor library is loaded and the recordset
retrieved by the CRecordset is opened as a snapshot object that contains
more than 40 bound columns.
<P>
By default, the cursor library is loaded when a CRecordset is opened. MFC
snapshots perform positioned updates and deletes by using the ODBC SQL
WHERE CURRENT OF syntax. The cursor library changes the WHERE CURRENT OF
clause to a full WHERE clause using all the columns in the recordset.
<P>
For example, the MFC Database classes might create the following SQL
statement when updating a record:
<P>
<PRE>   Update table1
   SET column1=?
   WHERE CURRENT OF XXXXX

</PRE>The cursor library knows which record the application is currently
positioned at and converts the WHERE CURRENT OF clause into a WHERE clause
that will update the current record only. For example, assume the recordset
has three columns. The cursor library changes the SQL statement to:
<P>
<PRE>   Update table1
   SET column1=?
   WHERE column1=&lt;current value&gt; AND column2=&lt;current value&gt; AND
     column3 =&lt;current value&gt;

</PRE>Here &lt;current value&gt; represents the value of that column before the update
is performed.
<P>
You can see that more than 40 columns in a CRecordset will cause more than
40 AND predicates in the WHERE clause. The helpfile for the ODBC desktop
drivers (ODBCJET.HLP) states in the SQL limitations section that no more
than 40 AND predicates are supported. Thus, the SQL statement is too
complex.
<P>
NOTE: Long binary columns (those using RFX_LongBinary) are not bound and do
not count against the 40-column limit. However, an MFC ODBC application
that references the RFX_LongBinary function may encounter this error when
the recordset is opened. This is because the cursor library precedes calls
to SQLGetData with the execution of a SELECT statement with a WHERE clause
as described above.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To work around this behavior, do one of the following:

<UL><LI>Reduce the number of columns in your recordset. If you are using the
   CRecordset object that AppWizard/ClassWizard created for you, you can
   reduce the number of columns returned in the recordset by removing
   record field exchange(RFX) functions from the CRecordset's
   DoFieldExchange() function.

<LI>Use dynasets. See the online books for more information about the
   differences between snapshots and dynasets. To use dynasets with the
   16-bit MFC Database classes, please see the following article in the
   Microsoft Knowledge Base:
<P>
   ARTICLE-ID: <B><A HREF="../VISUALC/Q124915.htm">Q124915</A></B>
<PRE>   TITLE     :SAMPLE: Using Dynasets with the 16-Bit MFC Database Classes

   Special code must be acquired to use dynasets with the 16-bit MFC
   Database classes. CRecordsets which use a dynaset use the SQLSetPos()
   ODBC 2.0 functionality to perform positioned updates and deletes. This
   means the MFC database classes do not need to construct an SQL statement
   to send to the ODBC driver. A call to the SQLSetPos() function of the
   driver is all that is necessary to perform the update or delete.

</PRE></UL><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>REFERENCES</h2>
 
<P>
Appendix G of the ODBC 2.0 Programmer's Reference contains information
about the cursor library.  The ODBC Programmer's Reference is available in
the onine books for Visual C++ version 2.0 or greater.
<P>
MFC TechNote #45 contains additional information about MFC support for long
binary data and the use of RFX_LongBinary.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 1.50 2.00 2.10 2.50 2.51 2.52 3.00 3.10 4.00<BR>
4.10<BR>
KBCategory: kbprg kbprb<BR>
KBSubcategory: MfcDatabase<BR>
Keywords          : MfcDatabase kbprb kbprg<BR>
Technology        : kbMfc<BR>
Version           : 1.50 1.51 1.52 | 2.00 2.10 4.00<BR>
Platform          : NT WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 31, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
