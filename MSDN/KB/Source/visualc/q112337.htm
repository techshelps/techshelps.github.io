

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: /MD Causes C4273 Warning When Replacing _matherr </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q112337">
<META NAME="KBModify" CONTENT="1997/09/08">
<META NAME="KBCreate" CONTENT="1994/03/07">
<META NAME="Keywords" CONTENT="CRTIss kbprb kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  Attempting to replace the default _matherr function with a user-defined version and then linking with the C run-time dynamic-linked library (DLL) causes the compiler to issue the following warning:     warning C4273: '_matherr' : inconsistent dll l...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB4,QBFY,QABA,QAUD,QAH4,QBHQ,QAH6,QDNN,QDMH,QA56,QA55,QAY5,QAUJ,QACI,QBUJ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: /MD Causes C4273 Warning When Replacing _matherr</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 8, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q112337</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>The C Run-time (CRT) included with:
   - Microsoft Visual C++, 32-bit Edition, versions 1.0, 2.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Attempting to replace the default _matherr function with a user-defined
version and then linking with the C run-time dynamic-linked library (DLL)
causes the compiler to issue the following warning:
<P>
<PRE>   warning C4273: '_matherr' : inconsistent dll linkage. dllexport
   assumed.

</PRE>Running the resultant executable causes the default _matherr to be used
rather than the user-defined version.
<P>
<P><h2>CAUSE</h2>
 
<P>
The compiler issues the C4273 warning because of the way the _matherr
function is prototyped in the MATH.H header file. _matherr has the
following prototype:
<P>
<PRE>   _CRTIMP int __cdecl _matherr(struct _exception *);

</PRE>When code is being compiled to be used with the C run-time DLL, _CRTIMP is
defined to be the following:
<P>
<PRE>   __declspec(dllimport)

</PRE>When code is being compiled to be used with one of the statically linked C
run-time libraries, _CRTIMP is defined to be nothing.
<P>
The C4273 warning is generated because the compiler has detected a
redefinition of _matherr after already seeing a prototype that specifies
that _matherr is being imported.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
It is not possible to replace the default version of _matherr when using
the dynamically linked version of the C run-time library.
<P>
The README.WRI file supplied with Visual C++, 32-bit Edition, version 1.0,
gives the following information:
<P>
<PRE>   Using _matherr with CRTDLL.DLL

   If you use the dynamically linked version of the C run-time
   library (CRTDLL.DLL), you cannot replace the default _matherr
   routine with a user-defined version. You can only install a
   custom _matherr routine if you use one of the statically linked C
   run-time libraries.

</PRE>CRTDLL.DLL is the name of the C Run-time DLL that is supplied with Windows
NT. The C Run-time DLL supplied with version 1.0 of Visual C++, 32-bit
Edition, is called MSVCRT10.DLL and the name of the C Run-time DLL supplied
with version 2.0 of Visual C++, 32-bit Edition is MSVCRT20.DLL. The
limitation of not being able to replace _matherr pertains only to using
MSVCRT*.DLL.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following sample code can be used to demonstrate the problem.
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>   /* Compile options needed: /MD
   */

   #include &lt;math.h&gt;
   #include &lt;string.h&gt;
   #include &lt;stdio.h&gt;

   void main()
   {
       // Do a math operation that causes an error
       printf( "log( -2.0 ) = %e\n", log( -2.0 ) );
   }

   int _matherr( struct _exception *except )
   {
       /* Handle _DOMAIN errors for log */
       if( except-&gt;type == _DOMAIN )
       {
           if( strcmp( except-&gt;name, "log" ) == 0 )
           {
               except-&gt;retval = log( -(except-&gt;arg1) );
               printf( "Special: using absolute value: %s: _DOMAIN "
                       "error\n", except-&gt;name );
               return 1;
           }
       }
       else
       {
           printf( "Normal: " );
           return 0;    /* Else use the default actions */
       }

       return 0;
   }

</PRE><h2>REFERENCE</h2>
 
<P>
For additional information, please see the following article in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../VISUALC/Q112297.htm">Q112297</A></B>
   TITLE     : INFO: User Defined CRT Function Causes Unresolved External
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: _matherrl<BR>
Keywords          : CRTIss kbprb kbprg<BR>
Version           : WINDOWS:1.0,2.0;<BR>
Platform          : WINDOWS<BR>
Issue type        : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 8, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
