

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>FIX: Append-Only on Dynaset Recordsets Forces Read-Only </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q139069">
<META NAME="KBModify" CONTENT="1997/09/18">
<META NAME="KBCreate" CONTENT="1995/11/02">
<META NAME="Keywords" CONTENT="MfcDatabase kbbuglist kbfixlist kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  Opening a recordset as an append-only dynaset leads to an internal application error when Update() is called to commit an AddNew(). A CDBException is thrown, and the following error is displayed in the output window of the debugger (DB tracing enab...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA1S,QAXB,QAR4,QDN9,QAC1,QBFY,QBD2,QA56,QA55,QAGI,QAAP,QAKP,QBXS,QA63,QA5V V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Append-Only on Dynaset Recordsets Forces Read-Only</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 18, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q139069</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
1.51 1.52 | 2.00 2.10 2.20
<PRE>WINDOWS   | WINDOWS NT
</PRE>kbprg kbfixlist kbbuglist
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Visual C++ for Windows, versions 1.51 and 1.52
<LI>Microsoft Visual C++, 32-bit Edition, versions 2.0, 2.1, 2.2
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Opening a recordset as an append-only dynaset leads to an internal
application error when Update() is called to commit an AddNew(). A
CDBException is thrown, and the following error is displayed in the
output window of the debugger (DB tracing enabled):
<P>
In Visual C++ 1.5x using the Microsoft Access 2.0 driver:
<P>
<PRE>   Error: failure updating record.
   Invalid argument value
   State:S1009[Microsoft][ODBC Microsoft Access 2.0 Driver]

</PRE>In Visual C++ 2.x using the Microsoft Access 2.0 driver:
<P>
<PRE>   Error: failure updating record.
   Invalid argument value
   State:S1009,Native:57,Origin:[Microsoft][ODBC Microsoft Access 2.0
   Driver]

</PRE><h2>CAUSE</h2>
 
<P>
Due to a bug in the MFC code, specifying that a recordset be opened as
append-only results in its concurrency being set to read-only. While the
concurrency is not checked for snapshots, it must be consistent in dynasets
with operations performed on the datasource.
<P>
Specifying CRecordset::appendOnly as the third parameter to
CRecordset::Open results in m_bUpdatable being set false. Open calls
OnSetOptions where, if m_bUpdatable is false, the concurrency for the
recordset is set to SQL_CONCUR_READ_ONLY.  When Update() is eventually
called, the ODBC API SQLSetPos is invoked to perform the update. Because
the operation (SQL_ADD) and locking mode (SQL_LOCK_NO_CHANGE) do not
match the concurrency, SQLSetPos fails.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Opening a recordset as append-only has very limited benefits, so to work
around the problem, don't use it. The only real benefit to setting a
recordset to append-only is to inhibit you from calling Edit() on the
recordset.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article. This problem was corrected in Visual C++
version 4.0 but has not been fixed in the 16-bit version of the compiler.
We will post new information here in the Knowledge Base as it becomes
available.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 1.51 2.51 1.52 2.52 2.00 3.00 2.10 3.10 2.20<BR>
3.20<BR>
KBCategory: kbprg kbbuglist kbfixlist<BR>
KBSubcategory: MfcDatabase<BR>
Keywords          : MfcDatabase kbbuglist kbfixlist kbprg<BR>
Technology        : kbMfc<BR>
Version           : 1.51 1.52 | 2.00 2.10 2.20<BR>
Platform          : NT WINDOWS<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 18, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
