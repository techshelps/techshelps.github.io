

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>HOWTO: Passing a License Key to Classes Generated by #import </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q170461">
<META NAME="KBModify" CONTENT="1997/09/30">
<META NAME="KBCreate" CONTENT="1997/06/20">
<META NAME="Keywords" CONTENT="adoengdb adovc CLIss MfcDatabase">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  The #import directive is used to incorporate information from a type library, but makes no provision for a license key. If you installed the OLE- DB SDK or Internet Information Server 3.0, then the license key is automatically created in the regist...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBXO,QAH4,QAH6,QAA1,QDI2,QBWP,QBVV,QBG2,QAI5,QAEQ,QABG,QAYY,QDL9,QBWQ,QBWO V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Passing a License Key to Classes Generated by #import</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 30, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q170461</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual C++, 32-bit Editions, version 5.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The #import directive is used to incorporate information from a type
library, but makes no provision for a license key. If you installed the OLE-
DB SDK or Internet Information Server 3.0, then the license key is
automatically created in the registry.
<P>
However, if your application is redistributed to machines that have not had
either OLE-DB SDK or Internet Information Server 3.0 installed on them, you
need to programmatically provide the ADO License Key. This is necessary
regardless of the development environment you are using to manipulate ADO.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following is a typical #import statement:
<P>
<PRE>   #import "msado10.dll" no_namespace rename( "EOF", "adoEOF" )

</PRE>When using #import to generate classes for ADO, your code to manipulate a
recordset might look like this:
<P>
<PRE>   HRESULT        hr;
   _ConnectionPtr pConn;
   _bstr_t        bstrConnect = SysAllocString( L"driver={sql server};"
                                                L"Database=pubs;"
                                                L"UID=sa;PWD=;" );

   hr = pConn.CreateInstance(__uuidof(Connection));
   if (!FAILED(hr))
      pConn-&gt;ConnectionString = bstrConnect;

</PRE>This will work on any machine that has had the ADO 1.0 License Key already
installed. However, if the license key is not installed, this code will not
work. The code sample below is functionally equivalent but demonstrates how
to create an ADO object using a license key.
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>   BSTR            LicKey;
   IClassFactory2  *pIUnknown = NULL;
   IUnknown        *pOuter    = NULL;
   HRESULT         hr;
   _ConnectionPtr  pConn;
   _bstr_t         bstrConnect = SysAllocString( L"driver={sql server};"
                                                 L"Database=pubs;"
                                                 L"UID=sa;PWD=;" );

   LicKey = SysAllocString( L"gxwaezucfyqpwjgqbcmtsncuhwsnyhiohwxz" );

   //
   hr = CoGetClassObject( __uuidof(Connection),
                          CLSCTX_INPROC_SERVER,
                          NULL,
                          IID_IClassFactory2,
                          reinterpret_cast&lt;void**&gt;(&amp;pIUnknown) );

   if( !FAILED( hr ) )
   {
      pIUnknown-&gt;CreateInstanceLic( pOuter,
                                    NULL,
                                    __uuidof(_Connection),
                                    LicKey,
                                    reinterpret_cast&lt;void**&gt; (&amp;pConn) );
   }

   if( !FAILED( hr ) )
      pConn-&gt;ConnectionString = bstrConnect;

   SysFreeString( LicKey );

</PRE><h2>REFERENCES</h2>
 
<P>
For additional information, please see the following article in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../ADOBJ/Q168122.htm">Q168122</A></B>
   TITLE     : HOWTO: Redistribute ADO 1.0 or ADO/R 1.0 with OLE/DB 1.1
</PRE> 
<PRE>Keywords          : adoengdb adovc CLIss MfcDatabase
Version           : WINDOWS: 5.0; WINDOWS NT: 5.0
Platform          : NT WINDOWS
Issue type        : kbhowto</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 30, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
