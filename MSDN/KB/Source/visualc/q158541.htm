

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: C2440 Error When Using CMap and User Defined Key Type </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q158541">
<META NAME="KBModify" CONTENT="1997/07/02">
<META NAME="KBCreate" CONTENT="1996/10/31">
<META NAME="Keywords" CONTENT="kberrmsg kbprg MfcMisc vcbuglist420">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  When using the Cmap-templated collection class with a user-defined class as the data type for key arguments, the compiler generates the following compiler error:     afxtempl.h(97) : error C2440: 'abstract declarator' :        cannot convert from '...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAUD,QABO,QAB4,QAAP,QAY5,QAPN,QAOT,QANY,QAKM,QAP2,QA36,QAY2,QALM,QAHE,QAGU V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: C2440 Error When Using CMap and User Defined Key Type</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 2, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q158541</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
   - Microsoft Visual C++, 32-bit Edition, versions 4.0, 4.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When using the Cmap-templated collection class with a user-defined
class as the data type for key arguments, the compiler generates
the following compiler error:
<P>
<PRE>   afxtempl.h(97) : error C2440: 'abstract declarator' :
       cannot convert from 'class CClass' to 'unsigned long'

</PRE>where CClass is the name of the user-defined class.
<P>
<P><h2>CAUSE</h2>
 
<P>
The default implementation of CMap's HashKey function takes an DWORD
(unsigned long) as a parameter. The compiler does not know how to convert
from a user-defined class type to an unsigned long.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Create a static template function to generate a custom HashKey value.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Sample Code</h3>
 
<P>
This is a sample declaration of a CMap that uses a user-defined class for
as data-type for a Cmap:
<P>
<PRE>   #include &lt;afxtempl.h&gt;

   class CEmployee : public CObject
   {
   public:
   CString m_firstName;
   CString m_lastName;

   public:
   CEmployee(){ };

   // Copy constructor required by Cmap.
   CEmployee(const CEmployee&amp; n)
   {
   m_firstName = n.m_firstName;
   m_lastName = n.m_lastName;
   }


   // Operator= is required by Cmap.
   CEmployee&amp; operator=(const CEmployee&amp; n)
   {
   m_firstName = n.m_firstName;
   m_lastName = n.m_lastName;
   return *this;
   }

   BOOL AFXAPI operator==(const CEmployee&amp; n) const
   {
   return m_firstName == n.m_firstName
   &amp;&amp; m_lastName == n.m_lastName;
   }
   };

   template&lt;&gt;
   inline UINT AFXAPI HashKey(CEmployee&amp; key)
   {
   return HashKey((LPCTSTR)key.m_lastName) +
                   HashKey((LPCTSTR)key.m_firstName);
   }

   // Declare the CMap object.
   CMap&lt;CEmployee, CEmployee&amp;, CEmployee, CEmployee&amp;&gt; EmployeeMap;
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : kberrmsg kbprg MfcMisc vcbuglist420<BR>
Technology          : kbMfc<BR>
Version             : 4.0 4.1<BR>
Platform            : NT WINDOWS<BR>
Issue type          : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 2, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
