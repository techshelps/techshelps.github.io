

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>How to Use TrackPopupMenu() and Update UI Handlers </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q139469">
<META NAME="KBModify" CONTENT="1997/10/10">
<META NAME="KBCreate" CONTENT="1995/11/09">
<META NAME="Keywords" CONTENT="MfcUI kbcode kbhowto kbprg kbui">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  Floating popup menus are generally displayed in response to right-mouse click messages. The CMenu::TrackPopupMenu() function is used to display these menus. For the MFC Update UI mechanism to work correctly with these menus, the owner of these menu...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAXB,QBD2,QBC9,QBC8,QANO,QAC1,QAVI,QAH4,QAF0,QAA5,QAY5,QAGI,QAEV,QBV8,QAB9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to Use TrackPopupMenu() and Update UI Handlers</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 10, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q139469</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
1.50 1.51 1.52 | 2.00 2.10 2.20 4.00 4.10
<PRE>WINDOWS        | WINDOWS NT
</PRE>kbprg kbui kbcode kbhowto
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
<P>
<P><PRE>    - Microsoft Visual C++ for Windows, versions 1.5, 1.51, 1.52
    - Microsoft Visual C++, 32-bit Edition, versions 2.0, 2.1, 2.2,
      4.0, and 4.1
</UL></PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Floating popup menus are generally displayed in response to right-mouse
click messages. The CMenu::TrackPopupMenu() function is used to display
these menus. For the MFC Update UI mechanism to work correctly with these
menus, the owner of these menus should be a class derived from CFrameWnd.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Menu items in an MFC application are updated in response to the
WM_INITMENUPOPUP message. The MFC CFrameWnd::OnInitMenuPopup() function
has special code for handling the Update UI mechanism.
<P>
The code in CFrameWnd::OnInitMenuPopup iterates through the menu items
and checks for the Update UI and Command handlers in the command route,
for each item. Depending on the result of this search, it updates the
state of the menu item.
<P>
The WM_INITMENUPOPUP message is sent only to the owner of the menu. Hence
for the menus to be updated correctly, you need to make a CFrameWnd-derived
class the owner of the floating popup menu.
<P>
The Update UI mechanism doesn't work for a dialog-based application because
the code that calls the UI handlers is not found in a CDialog-derived
class.
<P>
The following sample code displays the File popup menu in the CView-derived
class (CMyView) in response to the WM_RBUTTONUP message. Note that the main
frame window pointer is used in the call to the CMenu::TrackPopupMenu()
function, so the Update UI mechanism will work correctly.
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>void CMyView::OnRButtonUp(UINT nFlags, CPoint point)
    {
    // Calling the base class function.
    CView::OnRButtonUp(nFlags, point);

    // Get the top level menu from the main application window.
    CWnd*  pMainWindow = AfxGetMainWnd();
    CMenu* pTopLevelMenu = pMainWindow-&gt;GetMenu();

    // Get the File popup menu from the top level menu.
    CMenu *pFileMenu = pTopLevelMenu-&gt;GetSubMenu(0);

    // Convert the mouse location to screen coordinates before passing
    // it to the TrackPopupMenu() function.
    ClientToScreen(&amp;point);

    // Display the File popup menu as a floating popup menu in the
    // client area of the main application window.
    pFileMenu-&gt;TrackPopupMenu(TPM_LEFTALIGN | TPM_LEFTBUTTON,
        point.x,
        point.y,
        pMainWindow);    // owner is the main application window
    }

</PRE><h2>REFERENCES</h2>
 
<P>
For information about command and message routing, please refer to MFC
Technical Note 21 in Books Online
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: kbinf 2.00 2.10 2.20 2.51 2.52 2.10 3.00 3.10<BR>
3.20 4.00 4.10<BR>
KBCategory: kbprg kbui kbcode kbhowto<BR>
KBSubcategory: MfcUI<BR>
Keywords          : MfcUI kbcode kbhowto kbprg kbui<BR>
Technology        : kbMfc<BR>
Version           : 1.50 1.51 1.52 | 2.00 2.10 2.20<BR>
Platform          : NT WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 10, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
