

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: Error: "Invalid cursor name" &amp; "No cursor name available" </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q120511">
<META NAME="KBModify" CONTENT="1997/07/31">
<META NAME="KBCreate" CONTENT="1994/09/13">
<META NAME="Keywords" CONTENT="MfcDatabase kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  A program using the Microsoft Foundation Class Library Database Classes may receive one of the following ODBC error messages when trying to update a record following a call to CRecordset::Requery():     Invalid cursor name    State:34000,Native:0,O...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAO2,QA9E,QAUJ,QBXS,QAU9,QAGI,QA59,QAB4,QAZV,QARM,QABO,QA8T,QBWG,QAIF,QAAP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Error: "Invalid cursor name" &amp; "No cursor name available"</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 31, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q120511</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
1.50 1.51
WINDOWS
kbprg kbprb
<P>
 
The information in this article applies to:
<P>
<PRE>   The Microsoft Foundation Classes (MFC), included with:
    - Microsoft Visual C++ for Windows, versions 1.5 and 1.51
</PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
A program using the Microsoft Foundation Class Library Database Classes may
receive one of the following ODBC error messages when trying to update a
record following a call to CRecordset::Requery():
<P>
<PRE>   Invalid cursor name
   State:34000,Native:0,Origin:[Microsoft][ODBC Cursor Library]

      -or-

   No cursor name available
   State:S1015,Native:0,Origin:[Microsoft][ODBC SQL Server Driver]

</PRE>The following code produces the the S1015 ODBC error:
<P>
<PRE>    CMyRecordSet set;
    set.m_strFilter = "CustNo = ?";
    set.m_CustNoParam = 1;
    set.Open();

    set.m_CustNoParam = 1;
    set.Requery();

    set.Edit();
    set.m_CustNo = 2;

    set.Update();

</PRE>Note: The ODBC drivers that shipped with VC++ 1.52 are ODBC 2.0 compliant
and should not exhibit this behavior. No Microsoft 32-bit driver should
exhibit this behavior.
<P>
<P><h2>CAUSE</h2>
 
<P>
The MFC database classes do not explicitly set a cursor name with the
SQLSetCursorName call. Thus the MFC database classes depend on implicit
cursor names given by the ODBC driver by default. The 1.0 ODBC
Specification did not specify that an implicit cursor remain with the
statement handle until the hstmt was dropped. Hence, the implicit cursor
name in the SQL Server driver goes away just before the recordset.Update()
call in the above example, resulting in the "No Cursor Name available"
message when the MFC Database classes call SQLGetCursorName (Line 2421 in
the UpdateInsertDelete method in dbcore.cpp).
<P>
You can receive the "Invalid cursor name" message under similar
circumstances especially after you have traversed a recordset and before
requerying.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
The version 2.0 "ODBC Specification" requires that implicit cursor names
must remain until statement handles have been dropped. The drivers provided
with the ODBC Driver pack, version 2.0, have been changed to conform to the
2.0 specification. These drivers may be used with the MFC library database
classes without running into the above problem.
<P>
<P><h2>STATUS</h2>
 
<P>
For more information on version 2.0 of the ODBC Driver pack, please see the
file ODBCDD20.DOC (in Microsoft Word format) or the file ODBCDD20.WRI (in
Microsoft Write format), which are available via ftp.microsoft.com, under
the directory /BUSSYS/SQL_ODBC/ODBC-MRKTG. Information can also be obtained
by calling the Microsoft Sales Information Center at (800) 426-9400.
<P>
In addition, the text of ODBCDD20 is also available in the following
Microsoft Knowledge Base article:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../ODBC/Q125235.htm">Q125235</A></B>
   TITLE     : INF: ODBC Driver Pack 2.0 Fulfillment Kit Q&amp;A
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 1.50 1.51 2.51<BR>
KBCategory: kbprg<BR>
KBSubcategory: MfcDatabase<BR>
Keywords          : MfcDatabase kbprg<BR>
Technology        : kbMfc<BR>
Version           : 1.50 1.51<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 31, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
