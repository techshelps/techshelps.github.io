

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: Hidden MDI Child Window Causes Corrupted MDI Window Menu </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q125435">
<META NAME="KBModify" CONTENT="1997/07/10">
<META NAME="KBCreate" CONTENT="1995/01/26">
<META NAME="Keywords" CONTENT="kbprb kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  If an MDI child window is hidden or disabled, the Window menu is not properly updated for the visible MDI child windows. Specifically, the Window menu will continue to show deleted MDI child windows or will fail to add new MDI child windows to the ...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBJZ,QDL9,QBWQ,QBWO,QBWN,QAEV,QAGQ,QAYC,QBXS,QBVV,QA4P,QBSO,QBWP,QAXB,QDKW V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Hidden MDI Child Window Causes Corrupted MDI Window Menu</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 10, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q125435</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
1.00 1.50 | 1.00 2.00 4.00
<PRE>WINDOWS   | WINDOWS NT
</PRE>kbprg kbprb
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC), included with:
<P>
<P><PRE>    - Microsoft Visual C++ for Windows, versions 1.0, 1.5
    - Microsoft Visual C++, 32-bit Edition, versions 1.0, 2.0, 2.1,
      2.2, 4.0, 4.1, 4.2
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If an MDI child window is hidden or disabled, the Window menu is
not properly updated for the visible MDI child windows. Specifically, the
Window menu will continue to show deleted MDI child windows or will fail to
add new MDI child windows to the list.
<P>
<P><h2>CAUSE</h2>
 
<P>
These problems occur only after at least one MDI child window has been
destroyed. When Windows destroys an MDI child window, it moves activation
to a different window. This activation change causes MFC to change and
refresh the MDI frame window's menu. Windows does not handle this menu
refresh message correctly while in the process of destroying an MDI child
window when other windows are hidden or disabled. This problem does not
occur if the window being destroyed is hidden or disabled.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To work around this problem, program your application to ensure that that
an MDI child window is always hidden or disabled before it is destroyed.
The destruction of MDI child windows is managed by the MDICLIENT window in
the processing of the WM_MDIDESTROY message. You can customize the behavior
of this message as follows:

<OL><P><LI>Subclass the MDICLIENT window and provide a handler for the message.
   For an example that shows how to subclass the MDICLIENT window, please
   see the article in the Microsoft Knowledge Base:
<P>
   ARTICLE-ID: <B><A HREF="../VISUALC/Q129471.htm">Q129471</A></B>
<PRE>   TITLE     : How to SubClass the MDIClient by Using MFC

</PRE><P><LI>Add a message handler for the WM_MDIDESTROY message to the class used to
   subclass the MDICLIENT window; this example calls it the CMDIClientWnd
   class. This message is not listed by ClassWizard, so you will need to
   add the handler manually. If you are unfamiliar with how to do this,
   please see the following article in the Microsoft Knowledge Base:
<P>
   ARTICLE-ID: <B><A HREF="../VISUALC/Q99848.htm">Q99848</A></B>
<PRE>   TITLE     : INF: Use ON_MESSAGE() Macro to Map Less-Common Messages

</PRE><P><LI>Implement the OnMDIDestroy function as follows:
<P>
   LRESULT CMDIClientWnd::OnMDIDestroy(WPARAM wParam,LPARAM lParam)
   {
<P><PRE>      // wParam contains the hwnd of the child being destroyed
      HWND hwndChild = (HWND) wParam;
      ::ShowWindow(hwndChild,SW_HIDE);
      return Default();
</PRE>   };
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbprg kbprb<BR>
KBSubCategory: MfcUI<BR>
Additional reference words: 1.00 1.50 2.00 2.10 2.20 2.50 3.00 4.00 4.10<BR>
4.20<BR>
Keywords            : kbprb kbprg<BR>
Technology          : kbMfc<BR>
Version             : 1.00 1.50 | 1.00 2.00 4.00<BR>
Platform            : NT WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 10, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
