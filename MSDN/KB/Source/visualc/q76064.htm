

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>XMS Usage with Compact, Large, or Huge Memory Model </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q76064 ">
<META NAME="KBModify" CONTENT="1997/07/17">
<META NAME="KBCreate" CONTENT="1991/09/12">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  The  R6001: Null pointer assignment  error may be encountered when writing XMS functions in the compact, large, or huge memory model with inline assembly. The problem will appear if the variables used in the inline assembly are global.  MORE INFORM...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAPF,QBA8,QAC2,QAEF,QAYA,QAGI,QBFY,QAYL,QAU9,QAH4,QBW6,QA4Q,QABI,QAXC,QAR5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XMS Usage with Compact, Large, or Huge Memory Model</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 17, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q76064 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
6.00 6.00a 6.00ax 7.00 | 1.00 1.50
<PRE>MS-DOS                 | WINDOWS
</PRE>kbprg
<P>
<P>
 
The information in this article applies to:

<UL><LI>Microsoft C for MS-DOS, versions 6.0, 6.0a, and 6.0ax
<LI>Microsoft C/C++ for MS-DOS, version 7.0
<LI>Microsoft Visual C++ versions 1.0 and 1.5
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The "R6001: Null pointer assignment" error may be encountered when writing
XMS functions in the compact, large, or huge memory model with inline
assembly. The problem will appear if the variables used in the inline
assembly are global.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The XMS comes with a library that works only with the small memory
model. A programmer who wants to implement the XMS with another memory
model must write his or her own library routines.
<P>
If you use the sample code provided in the XMS to find the address of
the XMS driver with the compact, large, or huge memory model, you must
make sure that all variables used in the inline assembly code are
declared as local variables.
<P>
If you do not use local variables, you will get the "R6001: null
pointer assignment" error.
<P>
For more information on the problem with inline assembly accessing
global data, please query on the following words:
<P>
<PRE>   inline and assembly and incorrectly and accesses and far and labels

</PRE>Below is a sample program that finds the address of the XMS driver, uses
that address to get its version, and then displays it. The program works
with all memory models.
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>/***************************************************
 LXMS.C : Sample program to get XMS driver address
          and make a call to get its version. This
          sample works with the large memory model
          through inline assembly.

          The trick here is to define all variables
          used in the inline assembly as local.

</PRE>****************************************************/
<P>
<P>
<PRE>#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;dos.h&gt;

#define GET_VERSION 0

</PRE>unsigned xms_call( void (_far *xms_driver)(),
<PRE>                   unsigned call_number )
{
   _asm
   {
      mov ax, call_number
      call far ptr [xms_driver]
      mov  call_number, ax
   }
   return( call_number );
</PRE>}
<P>
<PRE>void main ( void )
</PRE>{
<PRE>   unsigned int status;
   void (_far *xms_driver) ( void );
   unsigned int xms_version;

   status = 0;
   _asm
   {
      mov ax, 4300h
      int 2Fh
      cmp al, 80h
      jne noXMS

      ;---- Get Driver Address for Later Requests ---

      mov ax, 4310h
      int 2Fh
      mov word ptr [xms_driver], bx
      mov word ptr [xms_driver+2], es
      jmp End

</PRE>noXMS:
<PRE>      mov xms_version, 0
      mov status, ax
</PRE>End:
<PRE>   }
   xms_version = xms_call( xms_driver, GET_VERSION );
   if(!xms_version) status = 80 ;
   if(!status)
     printf("\n XMS Driver %x Detected.\n",xms_version);
</PRE>}
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: kbinf 1.00 1.50 6.00 6.00a 6.00ax 7.00 extended<BR>
memory<BR>
KBCategory: kbprg<BR>
KBSubcategory: CLngIss<BR>
Keywords            : kb16bitonly<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 17, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
