

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: "Attempt to Delete Object Owned by System" Error </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q98200 ">
<META NAME="KBModify" CONTENT="1997/07/17">
<META NAME="KBCreate" CONTENT="1993/04/29">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  When an application passes the handle associated with a CBrush object to the AfxRegisterWndClass() function, an attempt to delete the CBrush object fails and Microsoft Windows generates the following message:     err MYAPP GDI: GDI: Attempt to dele...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGI,QAPN,QAEF,QAGB,QBCT,QAW6,QAGC,QA5E,QDL9,QBWO,QBWN,QDKD,QAY5,QBWQ,QAIF V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: "Attempt to Delete Object Owned by System" Error</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 17, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q98200 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
1.00 1.50 1.51 1.52
WINDOWS
kbprg kbprb
<P>
 
The information in this article applies to:
<P>
<PRE>  The Microsoft Foundation Classes (MFC), included with:

    - Microsoft C/C++ version 7.0
    - Microsoft Visual C++ for Windows, versions 1.0, 1.5, 1.51, and
      1.52
</PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When an application passes the handle associated with a CBrush object
to the AfxRegisterWndClass() function, an attempt to delete the CBrush
object fails and Microsoft Windows generates the following message:
<P>
<PRE>   err MYAPP GDI: GDI: Attempt to delete object owned by system
   Fatal Exit Code = 0x8400

</PRE><h2>CAUSE</h2>
 
<P>
The AfxRegisterWndClass() function registers a window class. When an
application registers a window class, the system takes ownership of
any resources specified for the class. Windows deletes the objects
when the application terminates or if the application calls the
UnregisterClass() function to remove the class. The fatal error above
occurs when the application attempts to delete the brush while it is
owned by the system (in other words, while the window class is still
registered). The destructor for the CBrush class calls DeleteObject()
and causes this error.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
There are two methods to work around this situation, as follows:

<UL><LI>Call the underlying Windows API function, ::CreateSolidBrush(), to
   create a brush and specify that brush handle in the call to
   AfxRegisterWndClass(). Do not associate a CBrush object with the
   brush handle.

<LI>Create the CBrush object and specify it in the AfxRegisterWndClass()
   call as before. Before deleting the CBrush object, call the
   Detach() member function to detach the brush handle from the CBrush
   object. The sample code below demonstrates this method.
<P>
</UL><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following code demonstrates using the Detach() member function:
<P>
<PRE>   brush = new CBrush;
   // initialize brush
   // call AfxRegisterWndClass with brush
   brush-&gt;Detach();
   delete brush;

</PRE>The "delete brush" statement deletes only the CBrush object; it does
not destroy the actual Windows brush owned by the system. Windows
destroys the brush when it deletes the window class.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 1.00 1.50 1.51 1.52 2.51 2.52 Visual destructor<BR>
KBCategory: kbprg kbprb<BR>
KBSubcategory: MfcMisc<BR>
Keywords            : kb16bitonly<BR>
Technology          : kbMfc<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 17, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
