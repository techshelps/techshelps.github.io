

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: CPropertySheet::DoModal() or Create() Causes an Exception </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q158552">
<META NAME="KBModify" CONTENT="1997/09/15">
<META NAME="KBCreate" CONTENT="1996/10/31">
<META NAME="Keywords" CONTENT="MfcUI kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  Calling CPropertySheet::DoModal() or CPropertySheet::Create() in Windows 95 may cause an exception. The Output window displays a message that says the following:     First-chance exception in               (Comctl32.dll): 0xC0000005:    Access Viol...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBVV,QAIM,QA1O,QABN,QAH4,QBFN,QA8T,QBWP,QAPN,QADF,QAA8,QBWA,QA4P,QALF,QAH7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: CPropertySheet::DoModal() or Create() Causes an Exception</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 15, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q158552</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
   - Microsoft Visual C++, 32-bit Edition, versions 4.0, 4.1, 4.2, 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Calling CPropertySheet::DoModal() or CPropertySheet::Create() in Windows 95
may cause an exception. The Output window displays a message that says the
following:
<P>
<PRE>   First-chance exception in &lt;program.exe&gt; (Comctl32.dll): 0xC0000005:
   Access Violation.

</PRE>Newer versions (version 4.70) of the Comctl32.dll do not have this problem.
<P>
<P><h2>CAUSE</h2>
 
<P>
The CommCtl32.dll tries to modify the resources for the pages. Since the
resources are normally in read-only sections this throws an Exception that
can be caught in the application. However, if the application does not
catch this exception then the OS will handle this exception correctly.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
The first-chance exception can be ignored because it is safely handled by
the operating system.
<P>
One way to prevent the exception from being thrown is to make the resources
read/write. You can do this by adding a linker setting of
"/SECTION:.rsrc,rw."
<P>
A second way to prevent the exception being thrown is to change the font of
the pages so they are not "MS Sans Serif". MFC checks the dialog template
font for the page. If it is not "MS Sans Serif" then it makes a copy of the
resource in read/write memory, modifies the font and passes this to the C
mCtl32.dll. So when the dll writes to the template for the page it is
writing to read/write memory and hence exception is not thrown.
<P>
Another way to prevent the exception from affecting your application is not
to have the call for creating the property sheet in a try/catch(...) block.
Instead catch particular exceptions in the catch block.
<P>
If the property sheet is part of an OLE Automation Server that can be
invoked through a method of the server then you have to make the resources
read/write, using either of the first two methods described above, since
OLE catches the exception.
<P>
NOTE: Making the resources Read/Write can cause the resources to be written
to a page file.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>   /* Compile options needed: default
   */

   /***** this code will cause unpredictable results *****/
   try
   {
       sheet.DoModal();
   }
   catch(...)
   {
   }

   /***** this code is OK *****/
   try
   {
       if (0 == sheet.DoModal())
           throw "DoModal() failed!";
   }
   catch(char * str)
   {
       TRACE ("Exception thrown: %s\n", str);
   }

</PRE><h2>REFERENCES</h2>
 
<P>
For more information, please see the following article in the Microsoft
Knowledge Base:
<P>
<PRE>   ARTICLE ID: <B><A HREF="../WIN32SDK/Q126630.htm">Q126630</A></B>
   TITLE     : Resource Sections are Read-only
</PRE> 
<PRE>Keywords          : MfcUI kbprg
Technology        : kbMfc
Version           : WINDOWS NT:4.0 4.1 4.2 5.0;
Platform          : NT WINDOWS
Issue type        : kbprb</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 15, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
