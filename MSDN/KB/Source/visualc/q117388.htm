

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: Structure Packing Causes Some Win32 Programs to Fail </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q117388">
<META NAME="KBModify" CONTENT="1997/07/31">
<META NAME="KBCreate" CONTENT="1994/06/27">
<META NAME="Keywords" CONTENT="CLIss">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  The default packing (alignment) for structures in Windows NT is 8 bytes. This setting is the default for projects created using the Visual Workbench. Programs built with other packing build without error, but the resulting executable may produce ru...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QAH4,QABA,QALG,QBXS,QAAP,QBFY,QBAO,QBVV,QAB4,QA56,QA55,QABI,QABH,QAJH V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Structure Packing Causes Some Win32 Programs to Fail</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 31, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q117388</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The Microsoft C/C++ Compiler (CL.EXE) included with:
   - Microsoft Visual C++, 32-bit Edition, versions 1.0, 2.0, 2.1, 2.2,
<P><PRE>     4.0, 4.1, 4.2, 5.0
</PRE><LI>Microsoft Win32 Software Development Kit (SDK) for Windows NT,
   versions 3.1, 3.5
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The default packing (alignment) for structures in Windows NT is 8 bytes.
This setting is the default for projects created using the Visual
Workbench. Programs built with other packing build without error, but the
resulting executable may produce run-time errors. These errors include
incorrect data, error return codes from Win32 APIs, or program failure. On
RISC platforms, such as MIPS and Alpha, doubles and long ints that are not
8-byte-aligned cause alignment faults.
<P>
<P><h2>CAUSE</h2>
 
<P>
The default packing on Windows NT is 8-byte packing. This packing is used
both for efficiency reasons and for portability (some RISC processors allow
only 8-byte packing). Because the operating system is expecting data packed
on 8-byte boundaries, it may incorrectly process structures passed from
programs that were not packed on 8-byte boundaries. Not all programs
exhibit this behavior. One example that does give problems with a different
kind of packing is shown in the "MORE INFORMATION" section.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
If a program builds without errors or warnings but does not run correctly,
one thing to check is that all modules are compiled with /Zp8 (or no /Zp
switch at all).
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Many MS-DOS and Windows programs are built with 1- or 2-byte packing. Old
makefiles may have a /Zp1 or /Zp2 setting included. When porting programs
with Win32, this setting should be changed. In addition, check for a /Zp
setting in the CL environment variable in the AUTOEXEC.BAT file. This
setting overrides the setting in the Visual Workbench or in a makefile.
<P>
While 8-byte packing is the standard for Windows NT, in many cases 4-byte
packing works. Macro Assembler, version 6.11 and earlier, does not allow
8-byte packing. Use the highest available packing in this case. In some
cases, you may not be able to get the program working and it may have to be
rewritten in C or C++.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For more information on alignment, see the "Programming Techniques" book
included with the Visual C++, 32-bit Edition, documentation set.
<P>
For general porting guidelines, please see the article, "Port Your 16-bit
Applications to Windows NT Without Ripping Your Hair Out," in the
"Microsoft Systems Journal," August 1993.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 8.00 9.00<BR>
Keywords          : CLIss<BR>
Version           : 1.0 2.0 2.1 2.2 3.1 3.5 4.0 4.1<BR>
Platform          : NT WINDOWS<BR>
Issue type        : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 31, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
