

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>FIX: typedef Class Template Causes Compiler Errors C2440/C2561 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q129783">
<META NAME="KBModify" CONTENT="1997/09/18">
<META NAME="KBCreate" CONTENT="1995/05/04">
<META NAME="Keywords" CONTENT="kbbuglist kbcode kbfixlist kbtool">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  Compiling a program that has all of the following in the code causes the compiler to generate two errors:   - Class A.  - Class B derived from class A.  - Template class C that has type T as its argument.  - Class C has a member function that retur...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABO,QBFY,QAUD,QA36,QBXF,QDKS,QAY5,QAB4,QAAP,QAR4,QAOT,QBV8,QAB9,QDKW,QAH4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: typedef Class Template Causes Compiler Errors C2440/C2561</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 18, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q129783</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
2.00 2.10
WINDOWS NT
kbtool kbfixlist kbcode
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft C/C++ Compiler (CL.EXE) included with:
   Microsoft Visual C++, 32-bit Edition, versions 2.0 and 2.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Compiling a program that has all of the following in the code causes the
compiler to generate two errors:

<UL><LI>Class A.
<LI>Class B derived from class A.
<LI>Template class C that has type T as its argument.
<LI>Class C has a member function that returns a type of A*.
<LI>Type T* value in the return statement of the function.
<LI>Function implementation inside the class C definition.
<LI>"typedef C&lt;B&gt; CB" before the class B definition.
<P>
</UL>Here are the two errors generated:
<P>
<PRE>   error C2440 : 'return' : cannot convert from 'class B*' to
                            'class A*'
   error C2561 : 'f' : function must return a value

</PRE><h2>CAUSE</h2>
 
<P>
The class template was instantiated within the typedef statement where the
class B definition (the derivation) has not been seen by the compiler yet.
Therefore no conversion is defined between the derived class and the base
class.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Use any one of the following three workarounds:

<UL><LI>Do not create a typedef based on class B until class B is defined.
<P>
   -or-

<LI>Due to the definition of the member function, the templated class C
   can only be instantiated with class T if a conversion from T* to A*
   exists. This may have been unintentional, and the design of class C
   could be re-thought.
<P>
   -or-

<LI>Do not define the class template member function inside the class
   definition. The following sample code demonstrates this workaround:
<P>
<PRE>   /* Compile options needed: none
   */

   class A {};

   template &lt; class T &gt;
   class C
   {
     public:
      A* f( T *t );
   };

   template &lt; class T &gt;
   inline A* C::f( T *t )
   {
     return t;
   }

   class B;
   typedef C&lt;B&gt; CB;

   class B : public A {};

</PRE></UL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article.  This problem was fixed in Microsoft
Visual C++, 32-bit Edition, version 4.0.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Sample Code to Reproduce Problem</h3>
 
<P>
<PRE>/* Compile options needed: none
*/

</PRE>class A {};
<P>
template &lt; class T &gt;
class C
{
<PRE>  public :
   A* f( T *t ) { return t; }
</PRE>};
<P>
class B;
typedef C&lt;B&gt; CB;
<P>
<PRE>// Work around #1: Move the following line, the definition of class B,
// before the typedef which depends on class B
</PRE>class B : public A {};
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 2.00 2.10 9.00 9.10<BR>
KBCategory: kbtool kbfixlist kbbuglist kbcode<BR>
KBSubCategory: CPPIss<BR>
Keywords          : kbbuglist kbcode kbfixlist kbtool<BR>
Version           : 2.00 2.10<BR>
Platform          : NT WINDOWS<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 18, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
