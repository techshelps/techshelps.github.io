

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>FIX: CWnd::SubclassDlgItem Returns FALSE for OLE Controls </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q148703">
<META NAME="KBModify" CONTENT="1997/09/19">
<META NAME="KBCreate" CONTENT="1996/03/20">
<META NAME="Keywords" CONTENT="CDKIss MfcOLE kbbuglist kbcode kbfixlist kbole kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  Using CWnd::SubclassDlgItem to subclass an OLE Control returns FALSE, after failing on the check for m_pCtrlCont != NULL in line 301 of Winctrl1.cpp.  CAUSE =====  The MFC framework's implementation of CWnd::SubclassDlgItem checks and uses the CWnd...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB5,QA7O,QAOE,QAMN,QAUD,QAH4,QABI,QABH,QAHV,QA9Q,QAR4,QAGI,QALW,QAW6,QADO V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: CWnd::SubclassDlgItem Returns FALSE for OLE Controls</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 19, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q148703</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
4.00
WINDOWS
kbprg kbole kbcode kbbuglist kbfixlist
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
   Microsoft Visual C++, 32-bit Edition, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Using CWnd::SubclassDlgItem to subclass an OLE Control returns FALSE,
after failing on the check for m_pCtrlCont != NULL in line 301 of
Winctrl1.cpp.
<P>
<P><h2>CAUSE</h2>
 
<P>
The MFC framework's implementation of CWnd::SubclassDlgItem checks and
uses the CWnd::m_pCtrlCont member of the OLE control, instead of the
control container, which is the parent of the control. The source code
should use pParent-&gt;m_pCtrlCont in order to access the container.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
As a workaround, use CWnd::SubclassWindow instead of CWnd::SubclassDlgItem,
which is illustrated in the sample code section in this article.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be bug in the Microsoft products listed at
the beginning of this article. This problem was corrected in Microsoft
Visual C++, 32-bit Edition, version 4.1.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Help Reproduce Problem</h3>
 

<OL><P><LI>Generate a default SDI control container application using AppWizard.

<P><LI>Insert the Grid OLE Control through the Component Gallery, which in
   turn generates the CGridCtrl wrapper class.

<P><LI>Place the Grid control in the Application's About dialog box.

<P><LI>Declare an embedded member variable called "m_gridctrl" in CAboutDlg of
   type CGridCtrl.

<P><LI>Generate an OnInitDialog() handler for the CAboutDlg class and
   subclass the Grid control inside it as illustrated by this code:
<P>
   BOOL CAboutDlg::OnInitDialog()
   {
<P><PRE>       // Call base class implementation
       CDialog::OnInitDialog();
</PRE><P>
<P><PRE>       // Try to subclass the Grid control by calling SubclassDlgItem
       m_gridctrl.SubclassDlgItem(IDC_GRID1, this);
</PRE><P>
<P><PRE>       return TRUE;  // set focus to first control of the dialog
</PRE>   }
<P>
   NOTE: In this code, IDC_GRID1 is the ID of the Grid control.

<P><LI>When running the container application through the debugger, notice
   that CWnd::SubclassDlgItem returns FALSE after failing on the check for
   m_pCtrlCont != NULL in line 301 of Winctrl1.cpp.
<P>
</OL><h3>Sample Code to Work Around Problem</h3>
 
<P>
BOOL CAboutDlg::OnInitDialog()
{
<PRE>    CDialog::OnInitDialog();

    // Try to Subclass the Grid control by calling SubclassWindow
    CWnd* pWnd = GetDlgItem(IDC_GRID1);
    m_gridctrl.SubclassWindow(pWnd-&gt;m_hWnd);

    return TRUE;  // set focus to first control of the dialog
                  // Exception: OCX Property Pages should return FALSE
}
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.00 ocx ole control<BR>
KBCategory: kbprg kbole kbcode kbbuglist kbfixlist<BR>
KBSubcategory: MfcOLE CDKIss<BR>
Keywords          : CDKIss MfcOLE kbbuglist kbcode kbfixlist kbole kbprg<BR>
Technology        : kbMfc<BR>
Version           : 4.00<BR>
Platform          : WINDOWS<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 19, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
