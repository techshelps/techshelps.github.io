

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: Incorrect CListCtrl Painting During Label Editing </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q149709">
<META NAME="KBModify" CONTENT="1997/07/10">
<META NAME="KBCreate" CONTENT="1996/04/10">
<META NAME="Keywords" CONTENT="MFCUI kbprb kbprg kbui">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  A label-editing enabled List View control with callback items (the application stores the text), may show selected items incorrectly highlighted when labels are edited in place. When label editing changes the length of the text, clearing the item s...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAMB,QAC2,QATX,QAB5,QA7O,QAOE,QAMN,QBER,QAY5,QAGI,QADK,QAAP,QAVS,QAE1,QAA1 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Incorrect CListCtrl Painting During Label Editing</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 10, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q149709</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
2.10 2.20 4.00 4.10
WINDOWS NT
kbui kbprg kbprb
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
   Microsoft Visual C++, 32-bit Edition, versions 2.1, 2.2, 4.0, 4.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
A label-editing enabled List View control with callback items (the
application stores the text), may show selected items incorrectly
highlighted when labels are edited in place. When label editing changes the
length of the text, clearing the item selection and re-selecting it may
cause the highlighted bar to span the length of the original text.
<P>
<P><h2>CAUSE</h2>
 
<P>
The functionality to show the highlighted bar resides in the List View
control. In this case, the control does not calculate the new size of the
highlighted bar for the edited label.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
At the end of label editing, call the CListCtrl::SetItem function to make
the control calculate the size of the just edited item. This function sets
some or all of a list view item's attributes.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
This problem can be seen in the MSDN sample, MFCLIST. The sample
demonstrates a simple list view control implemented with MFC. Editing any
of the "Address" column labels and changing the text length demonstrates
the problem.
<P>
<P><h3>Sample Code</h3>
 
<P>
The following code demonstrates how to correct the behavior:
<P>
<PRE>void CMyDialog::OnEndLabelEdit (NMHDR* pNMHDR, LRESULT* pResult)
</PRE>{
<PRE>    LV_DISPINFO* pLvdi = (LV_DISPINFO*)pNMHDR;

// The text is maintained by the application, so first update it

// Set up the item, to reset its text
    LV_ITEM lvi;
    lvi.mask = LVIF_TEXT;
    lvi.iItem=pLvdi-&gt;item.iItem;
    lvi.iSubItem = 0;
    lvi.pszText = LPSTR_TEXTCALLBACK;

// Call CListCtrl::SetItem, to force recalculation of the text length
    m_ListCtl.SetItem ( &amp;lvi );

    *pResult = 0;
</PRE>}
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 2.10 2.20 3.10 3.20 4.00 4.10<BR>
LPSTR_TEXTCALLBACK edit highlight MFCList<BR>
KBCategory: kbui kbprg kbprb<BR>
KBSubcategory: MFCUI<BR>
Keywords            : MFCUI kbprb kbprg kbui<BR>
Technology          : kbMfc<BR>
Version             : 2.10 2.20 4.00 4.10<BR>
Platform            : NT WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 10, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
