

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PC MAPI: Loss of Memory with MapiSendMail and Visual Basic </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q148369">
<META NAME="KBModify" CONTENT="1996/08/26">
<META NAME="KBCreate" CONTENT="1996/03/12">
<META NAME="Keywords" CONTENT="kbprg kbtool">
<META NAME="KBArea" CONTENT="Support; KB; pcmail">
<META NAME="Description" CONTENT="  When the MAPI function MAPISendMail is used in an application developed with Microsoft Visual Basic versions 2.0 and 3.0 for Windows, the memory is not released properly from the global heap. When you exit the MAPI application, it will release the ...">
<META NAME="Product" CONTENT="PC Mail">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QAL7,QDL9,QBWO,QBWN,QBW6,QAJH,QBWQ,QBVV,QA39,QAR4,QAEV,QAYC,QAKP,QAY5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PC MAPI: Loss of Memory with MapiSendMail and Visual Basic</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  August 26, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q148369</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Mail for Windows, version 3.5
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When the MAPI function MAPISendMail is used in an application developed
with Microsoft Visual Basic versions 2.0 and 3.0 for Windows, the memory is
not released properly from the global heap. When you exit the MAPI
application, it will release the memory.
<P>
If the application sends large numbers of messages or several messages with
multiple recipients the heap memory could be exhausted and result in
subsequent failures of applications running in the Microsoft Windows
environment.
<P>
When the MAPI application is stopped, the memory that was not released
during operation will be released and become available to other
applications.
<P>
The amount of memory lost during the MAPISendMail function call will be on
the order of 32 bytes for each recipient and 32 bytes for each attached
file. If the Windows system has a few megabytes of available memory, it
will take thousands of messages to exhaust the heap. This is a problem only
for a program designed to run for long continuous periods.
<P>
<P><h2>CAUSE</h2>
 
<P>
The loss of heap memory is a result of an error in MAPI.DLL and the way it
frees allocated memory. The memory fails to be released for each recipient
and for each attached file in the message. This loss only occurs when the
Visual Basic MAPI interface is used. It does not occur if the application
uses the MAPI interface for Microsoft C.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in version 3.5 of Microsoft
Mail for Windows. A fix for this problem is in development, but has not
been regression-tested and may be destabilizing in production environments.
<P>
Contact Microsoft Product Support Services for more information on the
availability of this fix.
\\cypress\qferel\hotfixes\clients\win&amp;pm\mapi.dll\v3.05.4095
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 3.20 3.20a 3.50<BR>
KBCategory: kbprg kbtool<BR>
KBSubcategory: MailPCMAPI<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  August 26, 1996</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
