

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PC Ext: Err Msg: Error 021: Message Was Not Delivered... </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q103960">
<META NAME="KBModify" CONTENT="1994/10/29">
<META NAME="KBCreate" CONTENT="1993/09/02">
<META NAME="Keywords" CONTENT="kbenv kbnetwork kb3rdparty kbbug3.00 kbfix3.20">
<META NAME="KBArea" CONTENT="Support; KB; pcmail">
<META NAME="Description" CONTENT="  If there are several mail transfer agents (MTAs) on a hub postoffice and some of the MTAs have the -V20 command-line parameter enabled, Microsoft Mail users may receive messages returned from the Postmaster with the following error message:     Err...">
<META NAME="Product" CONTENT="PC Mail">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAYC,QAB4,QAAP,QAH6,QAKP,QAWM,QAH4,QAEV,QBWS,QBVW,QBCT,QAGC,QAGB,QAEF,QBV0 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PC Ext: Err Msg: Error 021: Message Was Not Delivered...</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 29, 1994</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q103960</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Mail for PC Networks, versions 3.0 and 3.2
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If there are several mail transfer agents (MTAs) on a hub postoffice
and some of the MTAs have the -V20 command-line parameter enabled,
Microsoft Mail users may receive messages returned from the Postmaster
with the following error message:
<P>
<PRE>   Error: [021]
   Message was not delivered due to missing routing file.

</PRE>This message will also appear in the SYSTEM.LOG file, and the
following corresponding errors will appear in the SESSION.LOG file:
<P>
<PRE>   opening FIPS file. Failure to open file
   File I/O: Error opening "M:KEY\INQUEUE3.KEY" error code=32
   File I/O: Error opening "K:P1\0000000E.0LK", error code=2
   File I/O: Error finding "M:MAI\MAE\0009DF5E.MAI", error code=2

</PRE><h2>CAUSE</h2>
 
<P>
There are two causes of this error:

<UL><LI>The mail is delivered--the MTA is able to read the P1 file in
   memory; however, after delivery the MTA failed to delete the P1
   file and declares it missing. Therefore, users see mail being
   delivered, but they still receive the original error.

<LI>The P1 file really is missing when the MTA tries to read it into
   memory.
<P>
</UL>This error only occurs when multiple MTAs are processing a single
INQUEUE3.MBG file. In Mail version 3.0, if the INQUEUE3.KEY file gets
locked open, the MTA will not handle the open failure properly;
therefore, the MTA cannot delete the mail item. However, it does
successfully delete the P1 file.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in version 3.0 of
Microsoft Mail for PC Networks. This problem was corrected in version
3.2.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
This error may occur in Mail version 3.2 if SOME External Mail
programs or gateways have the CompatV20 (V20) option enabled. The
solution is to be consistent with how this option is implemented on
each hub postoffice: the option should be set to All or None.
<P>
Having -V20 on some of the Externals will force those Externals to
lock the INQUEUE.KEY file differently. The following is an analysis of
having three Externals without, one PROFS 2.1g gateway without, and
one External with the -V20 option, all of which process mail on a
single hub postoffice.

<OL><P><LI>The External Mail program creates the INQUEUE.OLK file, opens it
   RDWRT|DENY_ALL, and processes Inqueue.

<P><LI>The PROFS gateway locks Inqueue with READ | DENY_READ and starts
   processing mail time (oblivious to INQUEUE.OLK)

<P><LI>The PROFS gateway may outpace External, deliver its mail, and
   delete its .MAI and .P1 files.

<P><LI>External delivers the mail, but is unable to delete the .P1 files
   properly. (It misses the window and cannot find the .P1 and/or .MAI
   files the gateway just delivered. External will log that it is
   unable to open or find the FIPS file when trying to deliver mail).
   It is also possible for both the External and the gateway to
   successfully process the .MAI and .P1 files (in this scenario, the
   users could get duplicate mail).
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: Backboning 3.20 mta<BR>
KBCategory: kbenv kbnetwork kb3rdparty kbbug3.00 kbfix3.20<BR>
KBSubCategory: MailPCExt<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 29, 1994</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
