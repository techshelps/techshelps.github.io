

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: Multiple Connections Opened Using ADO </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q173391">
<META NAME="KBModify" CONTENT="1997/09/03">
<META NAME="KBCreate" CONTENT="1997/09/02">
<META NAME="Keywords" CONTENT="adoall adoengdb">
<META NAME="KBArea" CONTENT="Support; KB; adobj">
<META NAME="Description" CONTENT="  ActiveX Data Objects (ADO) commands may open multiple connections on SQL Server even though the same connection has been specified for each command.  CAUSE =====  The connection has not been released by the previously executed command.  RESOLUTION ...">
<META NAME="Product" CONTENT="adobj">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAI5,QBG2,QBXS,QAVX,QAVW,QA5A,QAFF,QAB9,QBV8,QAJQ,QAGI,QAMB,QAVI,QANF,QAOX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Multiple Connections Opened Using ADO</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 3, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q173391</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>ActiveX Data Objects, versions 1.0, 1.5
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
ActiveX Data Objects (ADO) commands may open multiple connections on SQL
Server even though the same connection has been specified for each command.
<P>
<P><h2>CAUSE</h2>
 
<P>
The connection has not been released by the previously executed command.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Use SET COMMAND = NOTHING after executing the command.
<P>
The "Steps to Reproduce Behavior" section below also demonstrates how to
ensure that commands can use the same connection. Uncomment the three SET
mcommandx = Nothing lines.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Active connections on SQL Server may be monitored in SQL Enterprise Manager
by bringing up the Current Activity Window, which may be selected from the
Server Menu item. The number of connections is listed at the bottom of this
window. Each new connection increases the number of idle connections. The
refresh button on the toolbar must be pressed to see the changes in the
number of connections. Connections may also be monitored using SQL Trace
and observing "New Connection" and "Disconnection."
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 
<P>
This code also includes (commented out) the means to force the connections
to be closed.

<OL><P><LI>Create a project, and under Project References, select Microsoft OLEDB
   ActiveX Data Objects library. Names may appear slightly different
   depending on the version of ADO being used.

<P><LI>Create three stored procedures called Test, Test2, and Test3 using
   isql_w. Each stored procedure should be created by entering and running
   the following:
<P>
<P><PRE>      Create procedure test
      @result integer output
      as
      select @result =100
</PRE><P>
   Test2 and Test3 should be the same. Change Test to Test2 and Test3,
   respectively, and change 100 to 200 and 300, respectively.

<P><LI>Add four command buttons to the form with the following labels and
   captions:
<P>
<PRE>      Name        Captions
      -----       --------
      connect     Establish Connection
      test        Call Stored Proc Test
      test2       Call Stored Proc Test2
      test3       Call Stored Proc Test3
      close_conn  Close Connections and Exit

</PRE><P><LI>Add the following code to the form:
<P>
<P><PRE>      Option Explicit
      Dim mCommand1 As New Command
      Dim mCommand2 As New Command
      Dim mCommand3 As New Command
      Dim oconnection As New Connection
      Dim output As Variant
</PRE><P>
<P><PRE>      Private Sub close_conn_Click()
<PRE></PRE>         oconnection.Close
         Set oconnection = Nothing
         Unload Me
      End Sub

      Private Sub connect_Click()
        oconnection.Open "DSN=mymachine;UID=sa;PWD="
      End Sub

      Private Sub test_Click()
        Set mCommand1.ActiveConnection = oconnection
        mCommand1.CommandText = "test"
        mCommand1.CommandType = adCmdStoredProc
        Set output = mCommand1.CreateParameter(Type:=adInteger, _
               Direction:=adParamOutput)
        mCommand1.Parameters.Append output
        mCommand1.Execute
        MsgBox output
       'Set cmd.ActiveConnection = Nothing
      End Sub

      Private Sub test2_Click()
        Set mCommand2.ActiveConnection = oconnection
        mCommand2.CommandText = "test2"
        mCommand2.CommandType = adCmdStoredProc
        Set output = mCommand2.CreateParameter(Type:=adInteger, _
            Direction:=adParamOutput)
        mCommand2.Parameters.Append output
        MsgBox output
       'Set cmd.ActiveConnection = Nothing
     End Sub


     Private Sub test3_Click()
       Set mCommand3.ActiveConnection = oconnection
       mCommand3.CommandText = "test3"
       mCommand3.CommandType = adCmdStoredProc
       Set output = mCommand3.CreateParameter(Type:=adInteger, _
            Direction:=adParamOutput)
       mCommand3.Parameters.Append output
       mCommand3.Execute
       MsgBox output
       'Set cmd.ActiveConnection = Nothing
     End Sub

</PRE></OL><h2>REFERENCES</h2>
 
<P>
For additional information on ADO commands download the ADO Help file from
the Internet at <B><A HREF="http://microsoft.com/ado/">http://microsoft.com/ado/.</A></B>
<P>
<P>
 
<PRE>Keywords          : adoall adoengdb
Version           : WINDOWS:1.0,1.5
Platform          : WINDOWS
Issue type        : kbprb</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 3, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
