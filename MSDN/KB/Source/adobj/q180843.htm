

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: Error Creating More Than One Recordset in a Transaction </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q180843">
<META NAME="KBModify" CONTENT="1998/02/12">
<META NAME="KBCreate" CONTENT="1998/02/10">
<META NAME="Keywords" CONTENT="adoengdb adoiis adovb adovc adovj">
<META NAME="KBArea" CONTENT="Support; KB; adobj">
<META NAME="Description" CONTENT="  When you use the OLE DB Provider for ODBC and you try to create more than one recordset in the middle of a transaction, the following error occurs:      Cannot create a new connection because in manual transaction mode   The HRESULT is 0x80004005. ...">
<META NAME="Product" CONTENT="adobj">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QANF,QA9E,QAYV,QBG2,QAO2,QAAP,QAI5,QAB4,QAJQ,QA2Q,QAY2,QAO4,QAN0,QAH4,QAD2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Error Creating More Than One Recordset in a Transaction</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 12, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q180843</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>ActiveX Data Objects (ADO), version 1.5
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you use the OLE DB Provider for ODBC and you try to create more than
one recordset in the middle of a transaction, the following error occurs:
<P>
<PRE>   "Cannot create a new connection because in manual transaction mode"

</PRE>The HRESULT is 0x80004005.
<P>
<P><h2>CAUSE</h2>
 
<P>
This is caused by a limitation of the ODBC driver. If an ODBC driver does
not support multiple active recordsets on the same connection, the OLE DB
Provider for ODBC attempts to work around this limitation by creating a
second connection. Because a manual transaction is being performed and
transactions are at a connection level, the error occurs.
<P>
The SQL Server ODBC driver uses a special cursor when the cursor is forward-
only, read-only, and the ODBC rowset size is one. The cursor is called a
"firehose" cursor because it is the fastest way to retrieve the data.
Unfortunately, a side affect of the cursor is that it only permits one
active recordset per connection.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Use a different cursor type or close the first recordset before opening
another on the same connection/transaction.
<P>
For example, if you use the code below the error will not occur:
<P>
<PRE>   Dim cnn1 As New ADODB.Connection
   Dim rs1 As New ADODB.Recordset
   Dim rs2 As New ADODB.Recordset

   strCnn = "DSN=Springhill;uid=sa;pwd=;database=pubs"
   cnn1.Open strCnn
   cnn1.BeginTrans
   rs1.Open "Select * from authors", cnn1, adOpenStatic, adLockOptimistic
   rs2.Open "Select * from publishers", cnn1, adOpenStatic,
     adLockOptimistic
   cnn1.CommitTrans
   cnn1.Close

</PRE><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 
<P>
The following Visual Basic code causes the error to occur:
<P>
<PRE>   Dim cnn1 As ADODB.Connection
   Dim rs1 As Recordset
   Dim rs2 As Recordset
   Dim strCnn As String

   Set cnn1 = New ADODB.Connection
   strCnn = "DSN=SQLServer;uid=sa;pwd=;database=pubs"

   cnn1.Open strCnn
   cnn1.BeginTrans
   Set rs1 = cnn1.Execute("Select * from authors")
   Set rs2 = cnn1.Execute("Select * from publishers")

   cnn1.CommitTrans

   cnn1.Close
   End Sub

</PRE> 
<PRE>Keywords          : adoengdb adoiis adovb adovc adovj
Technology        : odbc
Version           : WINDOWS:1.5
Platform          : WINDOWS
Issue type        : kbprb</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 12, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
