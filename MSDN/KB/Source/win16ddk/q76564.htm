

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Receiving a Physical COM Port from the Windows VCD </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q76564 ">
<META NAME="KBModify" CONTENT="1995/04/12">
<META NAME="KBCreate" CONTENT="1991/09/26">
<META NAME="Keywords" CONTENT="kbprg">
<META NAME="KBArea" CONTENT="Support; KB; win16ddk">
<META NAME="Description" CONTENT="  In the enhanced mode of the Microsoft Windows graphical environment, the virtual communications device (VCD) assigns a physical communications (COM) port to a virtual machine (VM) only when certain events occur. The text below lists these events.  ...">
<META NAME="Product" CONTENT="Win16 DDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDJ9,QAGI,QDL9,QBWO,QBWN,QDJP,QAKG,QBJQ,QAHC,QADN,QBWQ,QAIF,QAU9,QAO4,QAJH V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Receiving a Physical COM Port from the Windows VCD</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 12, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q76564 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Windows Device Driver Kit (DDK) for Windows versions 3.0
   and 3.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
In the enhanced mode of the Microsoft Windows graphical environment, the
virtual communications device (VCD) assigns a physical communications (COM)
port to a virtual machine (VM) only when certain events occur. The text
below lists these events.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
In Windows enhanced mode, the VCD virtualizes and serializes the ownership
of physical COM ports. When a program running in a VM directly accesses one
of the I/O ports of a COM port (for example, COM1 corresponds to I/O ports
0x3F8 through 0x3FE), that VM may not necessarily own the physical port.
The VM communicates with a virtual COM port until the VCD assigns a
physical port.
<P>
Seven conditions that cause the VCD to assign a physical COM port to a
particular VM are:

<OL><P><LI>When an application reads or writes the Receive/Transmit buffer
   with the Divisor Latch Access Bit (80h) of the Line Control Register
   off.

<P><LI>When an application reads the Line Status Register more than once.

<P><LI>When an application reads the Modem Status Register more than once.

<P><LI>When an application writes to the Modem Control Register with the
   Loopback (10h) or Interrupt Enable (08h) bits on (simply changing
   the DTR or RTS line states does not cause VCD to assign a physical
   COM port).

<P><LI>When an application unmasks a COM port interrupt.

<P><LI>When a COM port interrupt occurs for an unowned COM port.

<P><LI>When the communications driver (COMM.DRV) instructs the VCD to
   assign a port to the Windows (system) VM because an application
   called the OpenComm function.
<P>
</OL>Implementation details on COM port assignment can be found by examining the
source code to VCD, which is available in the DDK. Some of the relevant
procedures are:
<P>
 
<PRE>VCD_Attach called by:   VCD_Set_Owner

</PRE></OL>VCD_Detach called by:
<PRE>   VCD_Set_Owner

</PRE>VCD_Set_Owner called by:
<PRE>   VCD_Assign
   VCD_Set_Port_Global
   VCD_PM_Acquire_Port
   VCD_PM_Free_Port
   VCD_Set_Focus
   VCD_Set_Owner_Event
   VCD_Detach_If_Owner

</PRE>VCD_Assign called by:
<PRE>   VCD_PM_Steal_Port
   VCD_Cant_Virtualize
   VCD_Mask

</PRE>VCD_PM_Steal_Port called by:
<PRE>   Comm Driver KickTx/StealPort

</PRE>VCD_Cant_Virtualize called by:
<PRE>   VCD_Virt_In_Out_RxTxB   (Condition 1)
   VCD_Virt_In_LSR      (Condition 2)
   VCD_Virt_In_MSR      (Condition 3)
   VCD_Virt_Out_MCR  (Condition 4)

</PRE>VCD_Mask called by:
<PRE>   VCD_handler (VPICD Mask_Change_Proc)   (Condition 5)

</PRE>VCD_PM_Acquire_Port called by:
<PRE>   Comm Driver GetCOMport386     (Condition 7)

</PRE>VCD_PM_Free_Port called by:
<PRE>   Comm Driver ReleaseCOMport386

</PRE>VCD_Set_Owner_Event called by:
<PRE>   VCD_Int        (Condition 6)

</PRE>VCD_Detach_If_Owner called by:
<PRE>   VCD_Destroy_VM
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 3.10 DDKCOMM<BR>
KBCategory: kbprg<BR>
KBSubcategory: D3CommVcd<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 12, 1995</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
