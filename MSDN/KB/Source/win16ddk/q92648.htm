

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: Linear Addr Mode Display Driver &amp; MS-DOS Virtual Machines </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q92648 ">
<META NAME="KBModify" CONTENT="1995/04/12">
<META NAME="KBCreate" CONTENT="1992/11/12">
<META NAME="Keywords" CONTENT="kbprg kbprb">
<META NAME="KBArea" CONTENT="Support; KB; win16ddk">
<META NAME="Description" CONTENT=" Linear address mode display drivers must save the extended portions of the CPU registers. Some enhanced mode grabbers assume that the display driver does save these register portions. Windowed MS-DOS sessions can become filled with 'garbage' if the ...">
<META NAME="Product" CONTENT="Win16 DDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAUR,QAU9,QAU7,QBCF,QBJM,QBJL,QAM3,QBVV,QAR4,QAFR,QDL9,QBWO,QBWN,QA5W,QABI V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Linear Addr Mode Display Driver &amp; MS-DOS Virtual Machines</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 12, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q92648 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Windows Device Driver Kit (DDK) for Windows version 3.1
</UL> 
<P>
Linear address mode display drivers must save the extended portions
of the CPU registers. Some enhanced mode grabbers assume that the
display driver does save these register portions. Windowed MS-DOS
sessions can become filled with 'garbage' if the display driver does
not save the extended CPU register portions.
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When an MS-DOS session is opened to full screen and then converted to a
windowed shell, the client area is filled with text-like 'garbage'.  If a
DIR or CLS command is issued, the windowed MS-DOS session is filled with
the correct information at the point where the command  was entered. Any
scrolling thereafter displays the correct  information.
<P>
If the windowed screen is enlarged it will also fill up with the  similar
type of 'garbage' and will correct itself when scrolled or  cleared.
<P>
<P><h2>CAUSE</h2>
 
<P>
The cause of this type of problem is a 'trashing' of the high part of  some
register(s) by the display driver. When the display grabber  receives the
execution focus with corrupted registers, the result  is screen garbage.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Modify your display driver so that it saves the extended portions of
registers before using them and restores them after your through.  Do not
assume that the extended portions of the CPU registers are free  to trash.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
While it could be argued that it is not required to save the high portions
of the CPU registers, the fact is that there are grabbers out there that
assume otherwise. At a minimum, you need to make sure to save and restore
processor registers ESI,EDI in BitBlt(). It is likely that your driver code
is saving and restoring SI,DI but you are using ESI,EDI, which means the
high part of ESI,EDI is not being preserved correctly. There may also be a
need to save the other extended registers as well.
<P>
Note that this problem does not occur when a 'segmented' driver is used.
The segmented driver accesses the video memory at the standard locations of
A0000-BFFFF. This problem does not occur with full screen only MS-DOS
sessions.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.10 DDK display driver<BR>
KBCategory: kbprg kbprb<BR>
KBSubcategory: D2DispQuest<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 12, 1995</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
