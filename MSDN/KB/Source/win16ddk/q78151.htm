

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Using the Interrupt 2Fh Critical Section Services </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q78151 ">
<META NAME="KBModify" CONTENT="1995/03/15">
<META NAME="KBCreate" CONTENT="1991/11/06">
<META NAME="Keywords" CONTENT="kbprg">
<META NAME="KBArea" CONTENT="Support; KB; win16ddk">
<META NAME="Description" CONTENT="  In the enhanced mode of the Microsoft Windows graphical environment, MS-DOS (non-Windows) applications are scheduled for execution using a preemptive multitasking scheme; that is, the amount of time that a process is allowed to run is determined by...">
<META NAME="Product" CONTENT="Win16 DDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QADN,QAHC,QAH4,QACK,QDL9,QBWO,QBWN,QAKR,QAHE,QAHB,QAY5,QBVV,QAL4,QBJQ,QBWS V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Using the Interrupt 2Fh Critical Section Services</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 15, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q78151 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Windows Device Driver Kit (DDK) for Windows versions 3.0
   and 3.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
In the enhanced mode of the Microsoft Windows graphical environment,
MS-DOS (non-Windows) applications are scheduled for execution using a
preemptive multitasking scheme; that is, the amount of time that a
process is allowed to run is determined by the operating system and
not by the process. Therefore, there is no way for a process, running
in a virtual machine (VM), to claim the CPU for an arbitrary amount of
time. In particular, the Begin Critical Section (Interrupt 2Fh
Function 1681h) and End Critical Section (Interrupt 2Fh Function
1682h) services do not prevent a task switch from occurring. These
services cannot be used in a terminate-and-stay-resident program (TSR)
to run code consecutively.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The services mentioned above, Begin Critical Section and End Critical
Section, call directly into the virtual machine manager's (VMM's)
services Begin_Critical_Section and End_Critical_Section. As the
documentation for these services points out, these VMM services impact
task switching only in a limited way. The function of the global
critical section is to shield a non-reentrant portion of code, such as
the BIOS-resident MS-DOS services, from being entered more than once.
<P>
Whenever an application claims the global critical section, the VMM
schedules for execution VMs that have a priority lower than
Time_Critical_Boost. VMs into which a hardware interrupt is reflected
have at least this priority; however, any virtual device driver (VxD)
may assign a low execution priority to a VM. Therefore, depending on
the particular system configuration, the critical section may or may
not provide exclusive execution of the code.
<P>
To influence task switching behavior, code must reside in a VxD.
However, there are very few scenarios in which code must be run
exclusively. In most cases, the Switch VMs and Callback service
(Interrupt 2Fh Function 1685h) is sufficient to leave a TSR in a
consistent state. The user can disable task switching entirely by
modifying setting the AllVMsExclusive option to TRUE in the SYSTEM.INI
file.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 3.10 DDKTSR DDKVXD<BR>
KBCategory: kbprg<BR>
KBSubcategory: D2MiscInt2fin<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 15, 1995</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
