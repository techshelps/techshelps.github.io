

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>How Display Drivers Use Shadow RAM </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q74808 ">
<META NAME="KBModify" CONTENT="1995/03/30">
<META NAME="KBCreate" CONTENT="1991/07/30">
<META NAME="Keywords" CONTENT="kbprg">
<META NAME="KBArea" CONTENT="Support; KB; win16ddk">
<META NAME="Description" CONTENT="  In the Microsoft Windows graphical environment, the term  shadow memory  refers to the  invisible  portion of the video memory. That is, the contents of the shadow memory is not displayed on the screen. Some Windows display drivers use this memory ...">
<META NAME="Product" CONTENT="Win16 DDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWN,QDL9,QBWO,QAU9,QBXT,QBXN,QA5V,QAH3,QAIB,QBW6,QAML,QBWQ,QA38,QAFR,QAB5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How Display Drivers Use Shadow RAM</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 30, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q74808 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Windows Device Driver Kit (DDK) for Windows versions 3.0
   and 3.1, and Microsoft Windows for WOrkgroups, version 3.11
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
In the Microsoft Windows graphical environment, the term "shadow memory"
refers to the "invisible" portion of the video memory. That is, the
contents of the shadow memory is not displayed on the screen. Some Windows
display drivers use this memory as storage to save and restore screen
bitmaps when requested by the user module of Windows. By doing so, Windows
achieves better performance.
<P>
Another possible use of shadow memory is to store a device bitmap. For more
information, see pages 39 and 40 of the "Microsoft Windows Device Driver
Kit: Device Driver Adaptation Guide" for Windows 3.1.
<P>
The article discusses some details about the implementation of shadow
memory, which are not documented in the Windows Device Driver Kit (DDK).
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Drivers that support shadow memory export a SaveScreenBitmap() function
for the user module to call.
<P>
The display driver creates an imitation device, ssb_device, containing a
BITMAP data structure. This device is almost the same as the
physical_device in the display driver, but ssb_device has a different
height. The height of the physical_device is SCREEN_HEIGHT (for example,
480 for VGA). The height of ssb_device is larger to include the entire
video memory. Using VGA as an example, 64K of address space can hold up to
819 scan lines (640 pixels, or 80 bytes per scan line). For this fictitious
example device, the first 480 scan lines form the visible portion. However,
the storage portion does not start at the 481st scan line (or scan line
480, 0-indexed) but at the 616th scan line (or scan line 615). This scan
line is the first scan line in the first 4K page of "invisible" memory. The
driver uses the space between the end of the 480th scan line to the end of
the last visible page to save and restore the mouse cursor image. In
addition, the virtual display device (VDDEGA/VGA) requires that the last 16
bytes in the last visible 4K page be reserved.
<P>
Scan line 615 starts at offset C030h (or 80 * 615 = 49200) into the video
RAM. The value 615 is represented by a constant, SSB_START_SCAN. This value
is used by the routine SaveScreenBitmap when it performs a bitblt (bit
block-transfer operation) to save or restore a screen bitmap. From the
offset C030h to the end of the video memory (address FFFFh), there is space
for a total of 204 scan lines. This is the value for the SSB_TOTAL_SCANS
constant. This value is also used by the SaveScreenBitmap routine in the
display driver.
<P>
Upon initialization, the display driver calls the BIOS Interrupt 10h
Function 12h with BL=10h to determine the amount of video memory installed.
If the return value indicates 256K memory is available, the driver sets the
RC_SAVEBITMAP bit in the ssb_mask variable; otherwise, the driver clears
that bit.
<P>
Another variable, ssb_shadow_status, maintains the status of the shadow
memory. The status bits are SSB_EXISTS, SSB_IN_USE, and SSB_TRASHED. The
SSB_EXISTS bit is set by the physical_enable function if ssb_mask has
RC_SAVEBITMAP set.
<P>
Note: The names of variables and constants mentioned in this article
were obtained from the VGA/EGA display driver source code in version
3.0 of the DDK. These names may be changed in the future versions of
the DDK.
<P>
<P><h2>REFERENCE</h2>
 
<P>
For more information, please refer to the display driver source code
included in the Windows DDK.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 3.10 3.11 DDKDISPLAY<BR>
KBCategory: kbprg<BR>
KBSubcategory: D2DispBitmaps<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 30, 1995</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
