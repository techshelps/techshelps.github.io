

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: Video Driver GP-Faults When Handling Large Bitmaps </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q69292 ">
<META NAME="KBModify" CONTENT="1995/04/04">
<META NAME="KBCreate" CONTENT="1991/02/12">
<META NAME="Keywords" CONTENT="kbprg kbprb">
<META NAME="KBArea" CONTENT="Support; KB; win16ddk">
<META NAME="Description" CONTENT="  Some display drivers experience a GP-fault or unrecoverable application error (UAE) when a large bitmap is loaded onto the desktop as  wallpaper.  This fault occurs when the bitmap is aligned on a page boundary and the driver attempts to read the n...">
<META NAME="Product" CONTENT="Win16 DDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QALG,QAU9,QAH2,QAA7,QAH4,QDL9,QBWO,QBWN,QAHT,QABN,QAFQ,QDK0,QAYS,QAO4,QAM4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Video Driver GP-Faults When Handling Large Bitmaps</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 4, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q69292 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Windows Device Development Kit (DDK) for Windows
   versions 3.0 and 3.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Some display drivers experience a GP-fault or unrecoverable application
error (UAE) when a large bitmap is loaded onto the desktop as "wallpaper."
This fault occurs when the bitmap is aligned on a page boundary and the
driver attempts to read the next page. In standard mode, the next page is
often valid and the bug escapes detection. In enhanced mode, the next page
is frequently invalid and the GP-fault occurs.
<P>
<P><h2>CAUSE</h2>
 
<P>
This GP-fault can be attributed to the way the main loop is constructed in
the video driver DIB-handling routines. The main loop is written so that a
byte is fetched from the DIB and the data pointer is advanced immediately,
before processing the byte. This is fine until the very last byte in the
DIB is processed.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
This problem has manifested itself in a few different ways. For
example, in one instance, the driver code fetched the final DIB byte
(which was at an offset of FFFFh in a given segment). The driver
incremented the offset, determined that it wrapped to zero, and
incremented the value in the DIB segment register. Because this was
the final byte of the DIB, the new value in the DIB segment register
was an invalid selector. Using an invalid selector causes a GP-fault.
<P>
In a second example, the driver code loaded each DIB byte at the
bottom of the main loop (loop termination logic is at the top of the
loop). This caused a final, invalid byte to be loaded at the bottom of
the loop (before the loop termination test). This worked for many
bitmaps because there are often a few extra bytes of space after the
final DIB byte. One bitmap, however, fit exactly within the segment
limit. When the program tried to fetch one extra byte in this case, a
GP-fault occurred because the fetch violated the segment limit defined
in the local descriptor table.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 3.10<BR>
KBCategory: kbprg kbprb<BR>
KBSubcategory: DtwoDispBitmaps<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 4, 1995</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
