

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Using Auto-Initialize DMA Under Windows </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q83012 ">
<META NAME="KBModify" CONTENT="1995/04/12">
<META NAME="KBCreate" CONTENT="1992/04/01">
<META NAME="Keywords" CONTENT="kbprg">
<META NAME="KBArea" CONTENT="Support; KB; win16ddk">
<META NAME="Description" CONTENT="  VADMAD, the Virtual Auto-Initialize Direct Memory Access Device, is provided with the Windows Multimedia Device Development Kit version 1.0, and the Multimedia Extensions to Windows version 1.0, to allow devices that use auto-initialize DMA to func...">
<META NAME="Product" CONTENT="Win16 DDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWN,QDL9,QBWO,QBWQ,QA5W,QDI6,QBXS,QAEF,QAGI,QBII,QAB5,QAYA,QAH6,QAJQ,QA7R V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Using Auto-Initialize DMA Under Windows</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 12, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q83012 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Windows Device Driver Kit (DDK) for Windows versions 3.0
   and 3.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
VADMAD, the Virtual Auto-Initialize Direct Memory Access Device, is
provided with the Windows Multimedia Device Development Kit version 1.0,
and the Multimedia Extensions to Windows version 1.0, to allow devices that
use auto-initialize DMA to function properly under Windows 3.0.
<P>
However, under Windows version 3.1, the VDMAD (Virtual DMA Device) supports
an auto-initialize DMA transfer, without using VADMAD.
<P>
Do not use VADMAD with Windows 3.1 because it conflicts with VDMAD.
<P>
The remainder of this article describes how an application can perform auto-
initialize DMA transfers under Windows 3.0 and under Windows 3.1.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Under Windows version 3.1, auto-initialize DMA is performed using the
same method as under MS-DOS: set the auto-initialize bit in the mode
register and perform the transfer.
<P>
Under Windows 3.0, the application must call VADMAD to set the auto-
initialize bit of the DMA mode register.
<P>
If the VADMAD driver is installed, the GetVADMADEntry function, listed
below, returns its address in ES:DI. If INT 2Fh returns 0 in ES,
VADMAD is not installed, and attempts to call the address will cause a
general protection fault (GP fault).
<P>
VADMAD_Entry dd ?
<P>
cProc  GetVADMADEntry &lt;NEAR,PASCAL,PUBLIC&gt;&lt;si,di&gt;
<PRE>   xor  di,di                         ; Clear DI
   mov  es,di                         ; Clear ES
   mov  ax,1684h                      ; Get device entry
   mov  bx,0444h                      ; VADMAD Device
   int  2f                            ; Get function entry
   mov  word ptr [VADMAD_ENTRY],di    ; Save entry point
   mov  word ptr [VADMAD_ENTRY+2],es

</PRE>cEnd
<P>
Once the VADMAD address is available, set the DMA mode using the
following code:
<P>
<PRE>   push dx                   ; Save DX
   mov  dx,VADMAD_Service    ; Set VADMAD operation
   call VADMAD_Entry         ; Set mode or channel
   out  0Bh,al               ; Out to mode register
   pop  dx                   ; Restore DX


</PRE>The values for the VADMAD_Service are defined as follows:
<P>
<PRE>   0: Set the VADMAD mode (put the desired mode into the AX register)
   1: Set the VADMAD channel (put the desired channel into the AX
      register)

</PRE>Two calls to the VADMAD_Entry are required: one to set the mode and
one to set the channel.
<P>
Under Windows 3.1, set the mode by modifying the mode register, as
follows:
<P>
<PRE>   mov  al,01010100b   ; Auto-Initialize, Write, Channel 0
   out  0bh,al         ; Send the data to the DMA mode register.

</PRE>An application can use the same procedure to program channels 4 through 7,
which are 16-bit channels; channels 0 through 3 are 8-bit channels. To
program channels 4 through 7, use port D6h rather than 0Bh.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 3.10<BR>
KBCategory: kbprg<BR>
KBSubcategory: D3DmaVdmad<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 12, 1995</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
