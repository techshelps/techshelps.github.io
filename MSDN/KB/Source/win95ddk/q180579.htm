

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: _PageAllocate May Fail to Allocate Memory Blocks </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q180579">
<META NAME="KBModify" CONTENT="1998/02/06">
<META NAME="KBCreate" CONTENT="1998/02/05">
<META NAME="Keywords" CONTENT="">
<META NAME="KBArea" CONTENT="Support; KB; win95ddk">
<META NAME="Description" CONTENT="  The virtual machine manager (VMM) service _PageAllocate may fail when you attempt to allocate memory, even when there is enough free memory available in the system. This problem is most common when you are trying to allocate large memory blocks.  C...">
<META NAME="Product" CONTENT="win95ddk">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBTP,QBXV,QBW6,QAHE,QAKD,QANY,QA5E,QAHC,QBWQ,QBBI,QAL2,QAKP,QAKC,QAJ6,QAI4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: _PageAllocate May Fail to Allocate Memory Blocks</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 6, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q180579</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Windows 95 Device Driver Kit (DDK), version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The virtual machine manager (VMM) service _PageAllocate may fail when you
attempt to allocate memory, even when there is enough free memory available
in the system. This problem is most common when you are trying to allocate
large memory blocks.
<P>
<P><h2>CAUSE</h2>
 
<P>
maxPhys is documented in the Windows 95 DDK as:
<P>
<PRE>   Maximum acceptable physical page number in the memory block. All page
   numbers must be less than this value. This parameter is used only if the
   flags parameter specifies the PAGEUSEALIGN value.

</PRE>Since maxPhys is a page number, the maximum valid value for maxPhys is
0x100000. However, if _PageAllocate is called with a maxPhys value of
0xffffffff, the service does not fail due to the invalid parameter.
Instead, it attempts to allocate the memory below 16MB using a maxPhys
value of 0x1000.
<P>
This behavior can cause _PageAllocate to fail mysteriously, particularly
for large memory blocks. If you attempt to allocate a large memory block
(for example, 16MB (0x1000 pages) of memory) and specify a maxPhys value of
0xffffffff, _PageAllocate will always fail, even if there is sufficient
free memory in the system.
<P>
Specifying 0xffffffff for the maxPhys parameter is a common error when you
fail to recognize that the parameter requires a page number, not a full
physical address. If you run the debug version of vmm.vxd, it displays the
following messages that can help you identify this problem:
<P>
<PRE>     PageAllocate: maxphys parameter greater than 4gig (0x100000)
     PageAllocate: maxphys = -1, remapping to 16meg

</PRE><h2>RESOLUTION</h2>
 
<P>
The maximum value that should be specified for maxPhys is 0x100000.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>REFERENCES</h2>
 
<P>
Windows 95 Device Driver Kit: _PageAllocate
 
<PRE>Version           : WIN95
Platform          : Win95
Issue type        : kbprb</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 6, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
