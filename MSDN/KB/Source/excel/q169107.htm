

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>XL97: BottomRightCell/TopLeftCell Incorrect with Merged Cell </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q169107">
<META NAME="KBModify" CONTENT="1998/01/09">
<META NAME="KBCreate" CONTENT="1997/05/27">
<META NAME="Keywords" CONTENT="xldraw xlformat xlvbahowto xlvbainfo kberrmsg">
<META NAME="KBArea" CONTENT="Support; KB; excel, convert, crossnet, odbc, winprint, setup">
<META NAME="Description" CONTENT="  In Microsoft Excel 97, if you run a Visual Basic for Applications macro that checks the BottomRightCell property or TopLeftCell property of a drawing object, AutoShape, chart, or other object, the address of the cell may appear to be incorrect.  CA...">
<META NAME="Product" CONTENT="Excel">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAUD,QAPN,QBVP,QBS0,QAH4,QDNZ,QAC2,QABI,QBJZ,QAW6,QABH,QBVV,QAR5,QALW,QANX P2 T2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XL97: BottomRightCell/TopLeftCell Incorrect with Merged Cell</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 9, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q169107</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Excel 97 for Windows
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
In Microsoft Excel 97, if you run a Visual Basic for Applications macro
that checks the BottomRightCell property or TopLeftCell property of a
drawing object, AutoShape, chart, or other object, the address of the cell
may appear to be incorrect.
<P>
<P><h2>CAUSE</h2>
 
<P>
This problem occurs if the BottomRightCell or TopLeftCell returns the
address of a merged cell.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Microsoft provides examples of Visual Basic for Applications procedures for
illustration only, without warranty either expressed or implied, including,
but not limited to the implied warranties of merchantability and/or fitness
for a particular purpose. The Visual Basic procedures in this article are
provided 'as is' and Microsoft does not guarantee that they can be used in
all situations. While Microsoft support engineers can help explain the
functionality of a particular macro, they will not modify these examples to
provide added functionality, nor will they help you construct macros to
meet your specific needs. If you have limited programming experience, you
may want to consult one of the Microsoft Solution Providers. Solution
Providers offer a wide range of fee-based services, including creating
custom macros. For more information about Microsoft Solution Providers,
call Microsoft Customer Information Service at (800) 426-9400.
<P>
If you want to return the address of the merged cell that lies beneath the
upper-left corner or the lower-right corner of an object, modify the code
so that it checks the address of the upper-leftmost cell of the MergeArea
that lies beneath the object. For example, instead of using the following
code
<P>
<PRE>   X = ActiveSheet.Shapes(1).TopLeftCell.Address

</PRE>use this code:
<P>
<PRE>   X = ActiveSheet.Shapes(1).TopLeftCell.MergeArea.Resize(1, 1).Address

</PRE>The MergeArea property returns the entire range of cells that is merged
into a single cell. The Resize method returns the upper-leftmost cell of
the MergeArea. The Address property returns the address of the merged cell.
<P>
You can use the same process with the BottomRightCell property of objects.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the Microsoft products
listed at the beginning of this article. We are researching this problem
and will post new information here in the Microsoft Knowledge Base as it
becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
When you check the BottomRightCell property or the TopLeftCell property of
an object in Microsoft Excel 97, the property does not recognize that the
worksheet may contain merged cells. As a result, each property returns the
address of the cell that would have been under the upper-left or lower-
right corner of the object if the cells had not been merged.
<P>
To demonstrate this behavior, use the following steps:

<OL><P><LI>In Microsoft Excel 97, create a new workbook.

<P><LI>Select the range of cells B2:F6. On the Formatting toolbar, click
   Merge And Center.

<P><LI>Using the Rectangle tool on the Drawing toolbar, draw a rectangle that
   is completely within the merged cell.

<P><LI>On the Tools menu, point to Macro, and then click Visual Basic Editor.

<P><LI>On the View menu, click Immediate Window.

<P><LI>Type the following command
<P>
<P><PRE>      ?Sheets(1).Shapes(1).BottomRightCell.Address
</PRE><P>
   and press ENTER.
<P>
   The Immediate window returns $F$6 even though the rectangle is
   completely within the merged cell ($B$2).

<P><LI>Type the following command
<P>
<P><PRE>      ?Sheets(1).Shapes(1).BottomRightCell.MergeArea.Resize(1, 1).Address
</PRE><P>
   and press ENTER.
<P>
</OL>The Immediate window returns $B$2, the correct address.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: XL97<BR>
Keywords          : xldraw xlformat xlvbahowto xlvbainfo kberrmsg<BR>
Version           : WINDOWS:97<BR>
Platform          : WINDOWS<BR>
Issue type        : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 9, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
