

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>XL97: Referenced Workbooks and Add-Ins Are Automatically Opened </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q167277">
<META NAME="KBModify" CONTENT="1998/02/12">
<META NAME="KBCreate" CONTENT="1997/04/22">
<META NAME="Keywords" CONTENT="xlui xlvbainfo kbprg">
<META NAME="KBArea" CONTENT="Support; KB; excel, convert, crossnet, odbc, winprint, setup">
<META NAME="Description" CONTENT="  In Microsoft Excel 97, when you create a reference from a workbook to another workbook or to an add-in, the referenced workbook or add-in is automatically opened by Microsoft Excel 97. This is different from behavior in earlier versions of Microsof...">
<META NAME="Product" CONTENT="Excel">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB4,QBS0,QBVP,QAB3,QBWS,QAH0,QDNM,QAH4,QAAP,QBVV,QAHT,QAGB,QAKP,QAGU,QAJQ P2 T2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XL97: Referenced Workbooks and Add-Ins Are Automatically Opened</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 12, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q167277</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Excel 97 for Windows
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
In Microsoft Excel 97, when you create a reference from a workbook to
another workbook or to an add-in, the referenced workbook or add-in is
automatically opened by Microsoft Excel 97. This is different from behavior
in earlier versions of Microsoft Excel. In earlier versions, the referenced
workbook or add-in is not automatically opened.
<P>
This article explains the problems that you may encounter when you
reference other workbooks and add-ins in Microsoft Excel 97.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
In Microsoft Excel 97, you can create a reference from one workbook to
another workbook or to an add-in by doing the following:

<OL><P><LI>Switch to the workbook from which you want to create the reference.

<P><LI>On the Tools menu, point to Macro, and then click Visual Basic Editor.

<P><LI>On the Tools menu, click References.

<P><LI>In the References dialog box, select the check box to the left of the
   file for which you want to create the reference. If the file is not
   listed, click Browse, select the file in the Add Reference dialog box,
   and then click Open.

<P><LI>When you are done, click OK.
<P>
</OL>A workbook that contains a reference to another workbook or to an add-in is
a “referencing” workbook. A workbook or add-in that is referred to
by another workbook is a "referenced” workbook.
<P>
<P><h3>Errors Opening Referenced Workbooks or Add-Ins with Visual Basic Macros</h3>
 
<P>
Microsoft provides examples of Visual Basic for Applications procedures for
illustration only, without warranty either expressed or implied, including,
but not limited to the implied warranties of merchantability and/or fitness
for a particular purpose. The Visual Basic procedures in this article are
provided 'as is' and Microsoft does not guarantee that they can be used in
all situations. While Microsoft support engineers can help explain the
functionality of a particular macro, they will not modify these examples to
provide added functionality, nor will they help you construct macros to
meet your specific needs. If you have limited programming experience, you
may want to consult one of the Microsoft Solution Providers. Solution
Providers offer a wide range of fee-based services, including creating
custom macros. For more information about Microsoft Solution Providers,
call Microsoft Customer Information Service at (800) 426-9400.
<P>
If you attempt to use a Visual Basic for Applications macro to open a
workbook or add-in that is already referenced by another open workbook, you
may receive the following error message:
<P>
<PRE>   Run-time error '1004':
   This workbook is currently referenced by another workbook and cannot
   be closed.

</PRE></OL>For example, if Book1.xls references Book2.xls, you receive the error
message if a Visual Basic macro executes the following line of code:
<P>
<PRE>   Workbooks.Open FileName:="Book2.xls"

</PRE>To prevent the error message from appearing, modify the Visual Basic code
to the following:
<P>
<PRE>   On Error Resume Next                   ' Prevents the error message.
   Workbooks.Open FileName:="Book2.xls"   ' Opens the workbook or add-in.
   On Error GoTo 0                        ' Restores normal error handling.

</PRE><h3>Errors Closing Referenced Workbooks or Add-Ins</h3>
 
<P>
In Microsoft Excel 97, you cannot close a referenced workbook or add-in if
the referencing workbook is open. If you attempt to do so, you receive one
of the following error messages:
<P>
<PRE>   This workbook is currently referenced by another workbook and cannot
   be closed.

   -or-

   Run-time error '1004':
   This workbook is currently referenced by another workbook and cannot
   be closed.

</PRE>For more information about this problem, please see the following article
in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../vbapps/Q159794.htm">Q159794</A></B>
   TITLE     : XL97: Cannot Programmatically Close Referenced Workbook

</PRE><h3>Errors When Multiple Users Reference the Same Workbook or Add-In</h3>
 
<P>
Because Microsoft Excel 97 automatically opens referenced workbooks and 
add-ins, you may experience problems if multiple users reference the same 
copy of a workbook or an add-in. This problem may occur if you create a 
reference to a workbook or to an add-in stored on a network server, or if 
you open a workbook that contains this kind of reference. 
<P>
The first user who creates the reference does not receive an error message.
However, all users who subsequently create a reference or open a workbook
that contains this kind of reference may receive the following error
message:
<P>
<PRE>   '&lt;Filename&gt;' is being modified by
   &lt;First user's name&gt;
   Open as Read-Only, or choose Notify to be alerted when it is
   available.

</PRE>If you click Cancel in the File Reservation dialog box, you may also
receive the following error message:
<P>
<PRE>   Can't add a reference to the specified file.

</PRE>If you use a Visual Basic macro to open the referencing workbook, the
previous error message may not appear immediately, and the workbook is
opened without any problems. When the error message does appear, click 
Read-
Only or Notify.
<P>
If multiple users share the same copy of an add-in, you may want to give
each user a copy of the add-in, and then ask each user change the reference
to refer to each copy of the add-in. By doing this, you can prevent this
problem from occurring.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: XL97<BR>
Keywords          : xlui xlvbainfo kbprg<BR>
Version           : WINDOWS:97<BR>
Platform          : WINDOWS<BR>
Issue type        : kbinfo<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 12, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
