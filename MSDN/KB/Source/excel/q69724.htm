

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Excel: Reading the First DOS Environment Variable </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q69724 ">
<META NAME="KBModify" CONTENT="1994/11/03">
<META NAME="KBCreate" CONTENT="1991/02/27">
<META NAME="Keywords" CONTENT="kbusage">
<META NAME="KBArea" CONTENT="Support; KB; excel, convert, crossnet, odbc, winprint, setup">
<META NAME="Description" CONTENT=" IMPORTANT: The CALL() and REGISTER() functions are provided for advanced users only. If you use these functions incorrectly you could accidentally cause errors in your system's operation.   It is possible to retrieve the value of the first environme...">
<META NAME="Product" CONTENT="Excel">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBVP,QDL9,QBWO,QBWN,QBFY,QAX1,QAYL,QAUD,QATX,QBWQ,QAGI,QBV8,QAB9,QBXS,QAY5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Excel: Reading the First DOS Environment Variable</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 3, 1994</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q69724 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Excel for Windows, versions 2.x, 3.0, 4.0, 5.0
</UL> 
<P>
IMPORTANT:
The CALL() and REGISTER() functions are provided for advanced users
only. If you use these functions incorrectly you could accidentally
cause errors in your system's operation.
<P>
<P><h2>SUMMARY</h2>
 
<P>
It is possible to retrieve the value of the first environment variable from
the DOS environment string from within Microsoft Excel if you are running
under Microsoft Windows. This is done using the CALL and REGISTER
functions. One possible use for this would be to determine the directory
from which Microsoft Windows was started.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The DOS environment is an area of memory that DOS sets aside to store
a series of ASCII strings. Each string in the environment is
terminated by a byte of zero. The final string is terminated by two
bytes of zero.
<P>
The following Microsoft Excel macro returns the first substring in
the MS-DOS environment string:
<P>
<PRE>   A1      Get_Environment
   A2      =REGISTER("KERNEL","GetDOSEnvironment","C")
   A3      =CALL(A2)
   A4      =RETURN()

</PRE>Note: The CALL function can also be used on a standard worksheet in
Microsoft Excel versions 3.0 and later.
<P>
<P><h3>Adding Variable to Beginning of Environment String</h3>
 
<P>
To arrange for a particular string to be placed at the beginning of the
environment string, you must redefine all environment variables in a
particular order. When an environment variable is first defined, its string
is appended to the end of the existing environment string. If the variable
was previously defined, it is deleted from its old position in the string
and appended to the end.
<P>
To retrieve an environment string called "CURDIR" that you set to the
current directory before running Microsoft Windows, using the macro example
above, do the following:

<OL><P><LI>Type "SET" (without the quotation marks) at the MS-DOS prompt to display
   the current environment string. For this example, the SET command
   displays:
<P>
<P><PRE>      COMSPEC=C:\DOS\COMMAND.COM
      PATH=C:\WINDOWS;C:\;C:\WINWORD
      TEMP=C:\WINDOWS\TEMP
</PRE>
<P><LI>If you want to start Microsoft Windows from the C:\USER directory,
   type "SET CURDIR=C:\USER" (without the quotation marks) at the
   MS-DOS prompt and press the ENTER key. The SET command now
   returns the following:
<P>
<P><PRE>      COMSPEC=C:\DOS\COMMAND.COM
      PATH=C:\WINDOWS;C:\;C:\WINWORD
      TEMP=C:\WINDOWS\TEMP
      CURDIR=C:\USER
</PRE>
<P><LI>Redeclare your other environment variables by using the "SET="
   command with COMSPEC, PATH, and TEMP just as they appeared previously.
   The SET command now returns the following:
<P>
<P><PRE>      CURDIR=C:\USER
      COMSPEC=C:\DOS\COMMAND.COM
      PATH=C:\WINDOWS;C:\;C:\WINWORD
      TEMP=C:\WINDOWS\TEMP
</PRE><P>
</OL>Now run Microsoft Windows and Microsoft Excel. When you run the
above macro, cell A3 returns "CURDIR=C:\USER."
<P>
<P><h2>REFERENCES</h2>
 
<P>
"Microsoft Excel Function Reference," version 4.0, pages 42-43,
350-352, 475-480
<P>
"Microsoft Excel Function Reference," version 3.0, pages 24, 193-194,
253-258
<P>
"Microsoft Excel for Windows Functions and Macros," version 2.1x, pages
255-256, 337-340
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbusage<BR>
KBSubcategory:
<P>

Additional reference words: 2.1 2.10 3.0 3.00 4.0 4.00 5.00<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 3, 1994</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
