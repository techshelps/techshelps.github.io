

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Excel: Returning the Name of the Currently Running Macro Sheet </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q59244 ">
<META NAME="KBModify" CONTENT="1994/11/02">
<META NAME="KBCreate" CONTENT="1990/02/28">
<META NAME="Keywords" CONTENT="macrosheet kbmacro">
<META NAME="KBArea" CONTENT="Support; KB; excel, convert, crossnet, odbc, winprint, setup">
<META NAME="Description" CONTENT="...">
<META NAME="Product" CONTENT="Excel">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAUD,QAUJ,QAH4,QBWS,QBVP,QANY,QARM,QAFQ,QBXT,QA5V,QAIB,QAHE,QAEF,QAB9,QAXC V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Excel: Returning the Name of the Currently Running Macro Sheet</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 2, 1994</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q59244 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h2>SUMMARY</h2>
 
<P>
In Microsoft Excel, you sometimes must get the name of the currently
running macro sheet. This is necessary, for example, if you want to
activate a macro sheet whose name may have been changed since it was
written. Because the argument to the ACTIVATE() command is a text
string, it is not changed when the document name is changed.
<P>
To get the name of the currently running macro sheet, enter the
following three macro lines. Hold down the COMMAND key when entering
the second line so that it is entered as an array formula. If it is
correctly entered as an array, Excel places braces ({}) at the
beginning and end of the formula.
<P>
<PRE>   =SET.NAME("flag","run")
   =LOOKUP("\",IF(ISERROR(GET.DEF("""run""",DOCUMENTS())),,DOCUMENTS()))
   =DELETE.NAME("flag")

</PRE><h2>MORE INFORMATION</h2>
 
<P>
The formula works by setting a name on the active macro sheet in the
first line, then going through all the open worksheets looking for
that definition in the second line, as follows:

<OL><P><LI>GET.DEF("""run""",DOCUMENTS()) looks for a name defined as "run" on
   each of the open documents. If the document does not contain a name
   defined as "run", GET.DEF() returns an error value.

<P><LI>IF(ISERROR(GET.DEF(... ...),,DOCUMENTS())) returns an array
   containing FALSE for each file that does not contain a name defined
   as "run", and the name of the document that has the defined name
   (the macro sheet).

<P><LI>LOOKUP("/",IF(... ...)) returns the greatest value less than or
   equal to the ASCII code for a forward slash. Thus, it looks through
   the array created above, which contains FALSE for each file that
   isn't the macro sheet, and the name of the macro sheet that is
   currently running. Since forward slash comes after any other valid
   filename characters, the LOOKUP() statement returns the name of the
   macro as the greatest value less than or equal to forward slash.

<P><LI>The DELETE.NAME() statement removes the flag defined on the macro
   sheet.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbmacro<BR>
KBSubcategory:
<P>

Additional reference words: noupd<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 2, 1994</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
