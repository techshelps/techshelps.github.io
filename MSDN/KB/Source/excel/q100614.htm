

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>XL: Add-in Macro Fails to Load when Starting Excel </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q100614">
<META NAME="KBModify" CONTENT="1998/02/02">
<META NAME="KBCreate" CONTENT="1993/06/23">
<META NAME="Keywords" CONTENT="xladdins">
<META NAME="KBArea" CONTENT="Support; KB; excel, convert, crossnet, odbc, winprint, setup">
<META NAME="Description" CONTENT="  When you automatically load an add-in macro sheet, the add-in may appear to  fail to load. All of the add-in custom functions appear in the Formula  Paste Function dialog box, but none of its custom menu commands appear.  The primary method for aut...">
<META NAME="Product" CONTENT="Excel">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBVP,QAH0,QAH4,QAB9,QBV8,QAUJ,QAVI,QAIJ,QBRD,QBWS,QAF0,QDIV,QAY5,QACI,QARW V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XL: Add-in Macro Fails to Load when Starting Excel</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 2, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q100614</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Excel for Windows, versions 4.0, 4.0a, 5.0
<LI>Microsoft Excel for the Macintosh, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you automatically load an add-in macro sheet, the add-in may appear to 
fail to load. All of the add-in custom functions appear in the Formula 
Paste Function dialog box, but none of its custom menu commands appear.
<P>
The primary method for automatically loading a document when you start
Microsoft Excel is to place the file in your startup directory:

<UL><LI>XLSTART directory (for Microsoft Excel for Windows) 
<P>
<P><PRE>    -or-
</PRE>
<LI>Excel Startup Folder (4) (for Microsoft Excel for the Macintosh).
<P>
</UL>Or, you can use an OPEN= statement in the settings file: EXCEL4.INI file 
(Excel 4.0 for Windows), EXCEL5.INI file (Excel 5.0 for Windows), or Excel 
Settings (4) file (Excel 4.0 for the Macintosh).
<P>
<P><h2>CAUSE</h2>
 
<P>
This problem occurs when the name __DemandLoad is defined in the add-in 
sheet and either of the following is true:

<UL><LI>The add-in macro sheet is located in the startup directory
<P>
<P><PRE>    -or-
</PRE>
<LI>The add-in macro is set to load in the settings file by using an OPEN=
   statement that contains the /F switch.
<P>
</UL>NOTE: this information applies to Microsoft Excel 5.0 only when you use the 
version 4.0 macro language.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
When the name __DemandLoad (note that the string "DemandLoad" is preceded
by two underscores) is defined on the add-in macro sheet, the add-in file
is not actually loaded until you open it from the Open dialog box or until 
one of its custom functions is entered into a sheet or is recalculated.
In essence, the add-in is loaded into memory upon demand. This saves time 
and memory when you start Microsoft Excel.
<P>
Because the add-in macro is not loaded, any auto open macros that add
custom menu commands or run other command macros are not executed. Only
custom functions are added when __DemandLoad is defined on your sheet. If
your add-in macro sheet contains both types of macros, you can remove the
defined name __DemandLoad from your add-in sheet and save it to your
startup directory. When you start Microsoft Excel, this loads the add-in, 
executes any auto open macros, and adds custom functions to the Paste
Function dialog box.
<P>
Alternatively, if you want the add-in macro to load on demand when one of
its custom functions or custom menu commands is called, in addition to
__DemandLoad, add the defined names __Command and/or __Menu, to your add-in
sheet and then use the Add-in Manager to add your add-in to the startup
list contained in your EXCEL4.INI file (Windows) or Excel Settings (4) file
(Macintosh). The Add-in Manager checks for these defined names and performs
the specified action.
<P>
<P><h3>__DemandLoad</h3>
 
<P>
When this name is defined on the add-in sheet, the Add-in Manager adds an
OPEN= line with the /F switch to the Microsoft Excel section in your
settings file. The OPEN= line contains the path and name of your add-in
macro. /F is a fast load option switch that, when used in conjunction with
a file containing the defined name __DemandLoad, places all of the custom
functions in the Paste Function dialog box. Note that if the add-in macro
sheet does not contain the defined name, the add-in file is fully loaded 
when you start Microsoft Excel.
<P>
The definition for __DemandLoad is not important. In the add-ins that are 
built into Microsoft Excel, it is commonly defined as the Boolean value, 
TRUE. When defined as FALSE, however, it functions the same.
<P>
<P><h3>__Command</h3>
 
<P>
When this name is defined on the add-in sheet, the Add-in Manager adds your
custom commands to specified menus when you start Microsoft Excel. Similar
to __DemandLoad, the add-in macro sheet is not actually loaded until you
select one of the commands. This saves time and memory when you start 
Microsoft Excel.
<P>
The Add-in Manager adds the information necessary to add the custom menu
commands to the Init Commands section of your settings file. __Command must
refer to a horizontal array that contains the following information (only 
the first 4 are required):
<P>
<PRE>   &lt;Menu_Bar_Num&gt;  Menu bar number
   &lt;Menu Name&gt;     Menu the command should be added to
   &lt;Command Name&gt;  Name of the command to be added
   &lt;Macro text&gt;    Name of the macro to run when command is selected
   &lt;Position&gt;      Position of command on the menu
   &lt;Key&gt;           Macro shortcut key
   &lt;Status&gt;        Message to be displayed on the Status bar
   &lt;Help&gt;          Help topic number

</PRE>The array can be a cell range or an array formula. Assume your add-in
contains a SalesRpt macro that runs when you select Create Report from the
Options menu. You can enter the following information in cells and define
__Command as =$B$1:$E$1 (in the Refers To box),
<P>
<PRE>    B1: 1   C1: Options   D1: Create Report   E1: SalesRpt

-or-

</PRE>you can use an array formula as follows:
<P>
<PRE>    ={1,"Options","Create Report","SalesRpt"}

</PRE>If you have more than one custom command to add, use sequential names
beginning with __Command, then __Command1, __Command2, and so on.
<P>
<P><h3>__Menu</h3>
 
<P>
Use this defined name when your add-in creates a custom menu. The Add-in
Manager adds the information necessary to add the custom menu to the Init
Menus section of your settings file. Like the definition for __Command,
__Menu must refer to a horizontal cell range or array formula containing
the following information:
<P>
<PRE>    &lt;Menu_Bar_Num&gt;  Number of the bar you want to add the menu to
    &lt;New Menu&gt;      The name of your menu
    &lt;Position&gt;      Position of the menu on the bar

</PRE>Again, if you have more than one custom menu to add, use sequential names
beginning with __Menu, __Menu1, __Menu2, and so on.
<P>
<P><h2>REFERENCES</h2>
 
<P>
"EXCELINI.TXT"
"SDK User's Guide," page 441
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 4.0 4.00 4.0a 4.00a 5.0 5.00 excel.ini<BR>
Keywords          : xladdins<BR>
Version           : WINDOWS: 4.0, 4.0a, 5.0; MACINTOSH: 4.0<BR>
Platform          : MACINTOSH WINDOWS<BR>
Issue type        : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 2, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
