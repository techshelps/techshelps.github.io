

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>XL4: Macro to Export Text File with Commas and Quotation Marks </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q103985">
<META NAME="KBModify" CONTENT="1998/02/02">
<META NAME="KBCreate" CONTENT="1993/09/02">
<META NAME="Keywords" CONTENT="kbmacro">
<META NAME="KBArea" CONTENT="Support; KB; excel, convert, crossnet, odbc, winprint, setup">
<META NAME="Description" CONTENT="  In Microsoft Excel, there is no menu command to automatically export data to a text file such that the text file is exported with quotation marks AND commas as delimiters. For example, there is no command to automatically create a text file that co...">
<META NAME="Product" CONTENT="Excel">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBRZ,QA3P,QAH4,QBVP,QA5V,QA50,QBXT,QAIB,QABH,QABI,QBBL,QAUD,QAPF,QAKC,QAA7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XL4: Macro to Export Text File with Commas and Quotation Marks</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 2, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q103985</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Excel for Windows, versions 3.0, 4.0, 4.0a
<LI>Microsoft Excel for the Macintosh, versions 3.0, 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
In Microsoft Excel, there is no menu command to automatically export
data to a text file such that the text file is exported with quotation
marks AND commas as delimiters. For example, there is no command to
automatically create a text file that contains the following:
<P>
<PRE>   "Text1","Text2","Text3"

</PRE>If you want to export data that resembles the above example, you can use
the FWRITE() function in a macro to export a text file. The "More
Information" section of this article includes a sample macro that
demonstrates one way to do this.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Microsoft provides macro examples for illustration only, without warranty
either expressed or implied, including but not limited to the implied
warranties of merchantability and/or fitness for a particular purpose. This
macro is provided 'as is' and Microsoft does not guarantee that the
following code can be used in all situations. Microsoft does not support
modifications of the code to suit customer requirements for a particular
purpose.
<P>
Note that you must select the cells that you want to export before you run
the following sample macro.
<P>
<P><h3>Sample Macro</h3>
 
<P>
<PRE>    A1: =ERROR(FALSE)
    A2: =SET.NAME("FName",INPUT("Export to Path\Filename: ",2))
    A3: =IF(FName=FALSE,RETURN())
    A4: =SET.NAME("FileNum",FOPEN(FName,3))
    A5: =IF(ISERROR(FileNum),RETURN())
    A6: =SET.NAME("StartCell",TEXTREF(GET.CELL(1,SELECTION()),TRUE))
    A7: =FOR("RowCount",0,ROWS(SELECTION())-1)
    A8: =FOR("ColCount",0,COLUMNS(SELECTION())-1)
    A9: =SET.NAME("CurrentCell",OFFSET(StartCell,RowCount,ColCount))
   A10: =IF(AND(ISNUMBER(CurrentCell),GET.CELL(7,CurrentCell)&lt;&gt;"General"))
   A11: =FWRITE(FileNum,""""&amp;TEXT(CurrentCell,GET.CELL(7,
         CurrentCell))&amp;"""")
   A12: =ELSE()
   A13: =FWRITE(FileNum,""""&amp;CurrentCell&amp;"""")
   A14: =END.IF()
   A15: =IF(ColCount=COLUMNS(SELECTION())-1,FWRITELN(FileNum,""),
         FWRITE(FileNum,","))
   A16: =NEXT()
   A17: =NEXT()
   A18: =FCLOSE(FileNum)
   A19: =RETURN()
   
   Explanation of Above Macro
   --------------------------
   
    A1: Turns error checking off.
    A2: Prompts for the filename to export to.
    A3: Checks to see if Cancel was selected from line two. If so, ends
        the macro.
    A4: Opens a new file and stores the file number to variable "FileNum."
    A5: Checks to see if an empty file was created, if not, it ends the
        macro.
    A6: Determines the top left cell of the current selection, and
        assigns it to variable "StartCell."
    A7: Begins loop based on the number of rows selected.
    A8: Begins loop based on the number of columns selected.
    A9: Determines the current cell in the loop by offsetting the
        "StartCell" by the loop counters "RowCount" and "ColCount."
   A10: Tests if "CurrentCell" is numeric and formatted other than a
        General number format.
   A11: If line 10 is true, write the contents of "CurrentCell" to the
        file retaining the number format enclosed in quotation marks.
   A12: Else statement for line 10.
   A13: If line 10 is false, write the contents of "CurrentCell" to the
        file, and enclose this entry in quotation marks (").
   A14: End the prior IF statement.
   A15: Check to see if "CurrentCell" is in the last column. If so, go to
        next line in export file. Otherwise, write a comma (,) to the
        current line in the export file.
   A16: Loops back to line 8.
   A17: Loops back to line 7.
   A18: Closes the export file.
   A19: Ends the macro.

</PRE><h2>REFERENCES</h2>
 
<P>
For information on how to use a Visual Basic macro to export a text
file with both comma and quote delimiters, please see the following
article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../vbapps/Q123183.htm">Q123183</A></B>
   TITLE     : XL: Procedure to Export Text File with Comma AND Quote
               Delimiter

</PRE>"Function Reference," version 4.0, page 182
"Function Reference," version 3.0, page 99
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 3.0 3.00 4.0 4.00 4.0a 4.00a export quotes<BR>
marks howto<BR>
Keywords          : kbmacro<BR>
Version           : WINDOWS:3.0,4.0,4.0a; MACINTOSH:3.0,4.00<BR>
Platform          : MACINTOSH WINDOWS<BR>
Issue type        : kbhowto kbinfo<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 2, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
