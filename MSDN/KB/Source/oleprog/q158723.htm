

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>How To Use BSTR, VARIANT, SAFEARRAY Types in Custom Interface </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q158723">
<META NAME="KBModify" CONTENT="1996/11/06">
<META NAME="KBCreate" CONTENT="1996/11/04">
<META NAME="Keywords" CONTENT="kbole kbhowto">
<META NAME="KBArea" CONTENT="Support; KB; oleprog">
<META NAME="Description" CONTENT="  On platforms that do not support DCOM, such as Windows 95 without DCOM and versions of NT before NT 4.0, MIDL cannot generate marshaling code for custom interfaces that use the VARIANT, BSTR, or SAFEARRAY types. MIDL can generate marshaling code fo...">
<META NAME="Product" CONTENT="OLE (Programming)">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="OLE ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QDK6,QBBS,QAP2,QA9Q,QABG,QARW,QBVV,QA2K,QAH6,QAJG,QAG1,QDL9,QBWQ,QBWO V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How To Use BSTR, VARIANT, SAFEARRAY Types in Custom Interface</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 6, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q158723</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft COM libraries included with:
   Microsoft Windows NT 4.0
   Microsoft Windows NT 3.51

<LI>Windows 95 without DCOM
<LI>Windows 95 with DCOM
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
On platforms that do not support DCOM, such as Windows 95 without DCOM and
versions of NT before NT 4.0, MIDL cannot generate marshaling code for
custom interfaces that use the VARIANT, BSTR, or SAFEARRAY types. MIDL
can generate marshaling code for such custom interfaces on platforms
that support DCOM, such as Windows 95 with DCOM, NT 4.0 and later versions.
This marshaling code can only be used on DCOM platforms; it cannot be
used on platforms that do not support DCOM.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Marshaling code for the VARIANT, BSTR, and SAFEARRAY types was available
on platforms that do not support DCOM for use by the OLE Automation
marshaler. However, this code was not exposed to other users, such as MIDL.
Consequently, MIDL cannot generate marshaling code on these platforms for
custom interfaces that use these types unless you provide your own
marshaling code for these types. On platforms that support DCOM, the
system providing marshaling code for these types is made available to
MIDL.
<P>
If your custom interface uses BSTR, VARIANT, or SAFEARRAY, and if you want
to use your custom interface marshaling code only on a DCOM platform,
you can use MIDL generated marshaling code. You will need to use
-D_WIN32_DCOM as a C compiler flag in the build process of the MIDL
generated code. Otherwise, a compiler error will be generated that
indicates that your code will compile only if you mark it as runable
only on a DCOM platform.
<P>
If your custom interface uses BSTR, VARIANT, or SAFEARRA, and if you want
to use your custom interface marshaling code on platforms that do not
support DCOM, consider the following workarounds:.

<UL><LI>Use LPSTR or LPWSTR instead of BSTR to pass strings. MIDL can
</UL>generate code to marshal LPSTR and LPWSTR on all platforms. Use MIDL
arrays instead of SAFEARRAY. Replace VARIANT with simple types or your
own structure or union.

<UL><LI>Use the OLE Automation marshaler to marshal your custom interface
</UL>instead of using MIDL-generated marshaling code. The custom interface
must be constrained to the OLE Automation-compatible types for this.
The OLE Automation marshaler can marshal VARIANT and BSTR on all
platforms.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For more information, please see the following articles in the Microsoft
Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../OLEPROG/Q139074.htm">Q139074</A></B>
   TITLE     : SAMPLE: VTBLBIND: Marshaling Using an OLE Automation
               Marshaler

   ARTICLE-ID: <B><A HREF="../OLEPROG/Q139072.htm">Q139072</A></B>
   TITLE     : Using OLE Automation Marshaler for 16/16 &amp; 16/32 COM
               Interface
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 2.00 4.00 OLE2 OLE COM DCOM kbdss<BR>
KBCategory: kbole kbhowto<BR>
KBSubcategory: LeTwoArc
<P>


</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 6, 1996</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
