

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Steady Timer Messages in a Dynamic-Link Library (DLL) </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q74412 ">
<META NAME="KBModify" CONTENT="1995/04/06">
<META NAME="KBCreate" CONTENT="1991/07/17">
<META NAME="Keywords" CONTENT="kbprg">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="  In the Microsoft Windows graphical environment, a dynamic-link library (DLL) can receive steady timer messages, even as various applications that link into the DLL are started and terminated. However, it cannot do so by calling the SetTimer() API d...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAEV,QATK,QAGI,QAYC,QDL9,QBWO,QBWN,QDNN,QAJH,QAY4,QAY5,QACE,QAIF,QBBI,QAGB V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Steady Timer Messages in a Dynamic-Link Library (DLL)</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 6, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q74412 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows
   versions 3.1 and 3.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
In the Microsoft Windows graphical environment, a dynamic-link library
(DLL) can receive steady timer messages, even as various applications
that link into the DLL are started and terminated. However, it cannot
do so by calling the SetTimer() API directly as an application
typically does. To receive steady timer messages, a DLL can launch a
hidden application and use that application's message queue to receive
the timer messages.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The SetTimer() API is used to create a Windows timer. When the timer
expires, Windows needs a message queue into which it can place a WM_TIMER
message. A message queue is required even if a timer notification function
is specified as the lpTimerFunc parameter to SetTimer().
<P>
Because a DLL is not a task, it does not have a message queue. When a
DLL calls SetTimer(), Windows places the resulting WM_TIMER messages
into the message queue of the currently active task, which is the
application instance that called into the DLL.
<P>
If this application instance should terminate, its message queue is
destroyed, and the DLL does not receive any more timer messages. If
the DLL specified a timer notification function, the notification
function is not called again.
<P>
For a DLL to receive a steady flow of timer messages, the timer
messages must go into a message queue that will remain present while
the various applications that link into the DLL are started and
terminated. One way to achieve this is to launch a hidden application
from the DLL. The DLL can use that application's message queue to
receive steady timer messages.
<P>
This technique could be implemented as follows:

<OL><P><LI>Export a routine from the DLL with syntax similar to the following:
<P>
<P><PRE>      void FAR PASCAL StartDLLTimer(HWND hWndHiddenApp)
</PRE>
<P><LI>To start a steady timer, the DLL launches a hidden application with
   a call similar to the following:
<P>
<P><PRE>      WinExec("MYTIMER.EXE", SW_HIDE);
</PRE><P>
   MYTIMER is a minimal Windows-based application. The only special
   processing MYTIMER requires is to link to the DLL and call the
   StartDLLTimer function in the processing of its WM_CREATE case,
   supplying the handle for its main window as the value for the
   hWndHiddenApp parameter.

<P><LI>In the StartDLLTimer function, the DLL calls SetTimer, specifying
   hWndHiddenApp as the hWnd parameter.
<P>
</OL>Timer messages for the DLL consequently use the MYTIMER function's
message queue. Therefore, the DLL continues to receive timer messages
regardless of other applications that link into the DLL.
<P>
Timers are a scarce system resource. If the SetTimer() call fails, no
timers are available for use.
<P>
Before the DLL terminates, it should free the timer. It can do so by
calling KillTimer(). It then sends a WM_CLOSE message to the MYTIMER
application, which terminates MYTIMER.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 3.10<BR>
KBCategory: kbprg<BR>
KBSubcategory: KrDll<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 6, 1995</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
