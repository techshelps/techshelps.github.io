

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PRB: Avoiding "Insufficient Memory to Run" Errors </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q86230 ">
<META NAME="KBModify" CONTENT="1997/07/23">
<META NAME="KBCreate" CONTENT="1992/06/30">
<META NAME="Keywords" CONTENT="kb16bitonly kbprg KrToolHlp kbprb kbprg">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="  During the process of loading an application, Microsoft Windows displays an application execution error message box with the following message:     Insufficient memory to run this application; close one or more    Windows applications and try again...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWN,QDL9,QBWO,QBW6,QAHT,QBWQ,QAHC,QAJH,QAM1,QAB4,QAA8,QAGI,QA01,QAYY,QABT V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Avoiding "Insufficient Memory to Run" Errors</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 23, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q86230 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows
   versions 3.0 and 3.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
During the process of loading an application, Microsoft Windows
displays an application execution error message box with the
following message:
<P>
<PRE>   Insufficient memory to run this application; close one or more
   Windows applications and try again.

</PRE><h2>CAUSE</h2>
 
<P>
One of the reasons this message is displayed is that the system has
no memory available with an address less than 1 megabyte (MB). When
Windows loads an application, it calls the GlobalDosAlloc() API
to allocate memory in the address space below 1 MB for the
application's task database. If the GlobalDosAlloc() call fails,
Windows displays the application execution error message.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Use as little memory below 1 MB as possible.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
A common situation that leads to an insufficient memory error regards
an application developed using a large memory model that includes many
extra data segments and/or very large extra data segments. When
Windows loads the application, it allocates fixed memory to hold the
extra data segments. In Windows 3.0, these fixed memory blocks are
also page locked, which prevents the memory manager from moving the
blocks to disk as memory fills.
<P>
Fixed memory is allocated from the bottom of the global heap, which
starts at the lowest possible memory address. If all the memory below
1 MB is filled with page locked memory blocks, Windows cannot move
blocks in memory or swap blocks to disk to free any memory. When
Windows cannot allocate a task database for a new task, it displays
the error message box discussed above.
<P>
An application can determine whether all memory addressed below 1 MB
is in use by attempting to allocate a small block of memory with the
GlobalDosAlloc function. (Windows 3.0 requires 512 bytes of low memory
for the task database of each application.) If the allocation fails,
Windows will not be able to start another program. Even if the
allocation is successful, the failure of another memory allocation
required by the application may prevent it from loading.
<P>
One way to address this problem is to remove the page lock from an
application's extra data segments. However, memory accessed by an
interrupt service routine must be page locked to keep its data
available at all times. An application can use the services of the
tool helper dynamic-link library (TOOLHELP.DLL) and a few Windows
functions to modify the flags on the extra data segments. After
modification, the data segments are movable and not page locked.
<P>
Use the GlobalFirst() and GlobalNext() functions provided by the tool
helper library to walk the global heap looking for memory blocks owned
by the application. If a memory block is page locked (the wcPageLock
field of the GLOBALENTRY data structure is not zero), call the
GlobalPageUnlock function to change the lock count for the memory
block. Calling GlobalRealloc() to change the block from fixed to
movable memory might also be desirable.
<P>
For more information on the tool helper library, see Chapter 8 of the
"Microsoft Windows Software Development Kit: Programmer's Reference,
Volume 1: Overview" version 3.1 manual.
<P>
Another method to unlock data segments uses the GlobalPageUnlock() and
GlobalUnfix() functions. For more information on this technique, please see
the following article(s) in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../WIN16SDK/Q83363.htm">Q83363</A></B>
   TITLE     : Sample Code Unlocks Large-Model Extra Data Segments

 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : kb16bitonly kbprg KrToolHlp kbprb kbprg<BR>
Version             : 3.0 3.1<BR>
Platform            : WINDOWS<BR>
Issue type          : kbprb<BR>
Resolution Type     : Info_Provided<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 23, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
