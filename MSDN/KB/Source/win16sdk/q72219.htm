

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>INFO: Context-Sensitive Help in a Dialog Box Through F1 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q72219 ">
<META NAME="KBModify" CONTENT="1998/01/09">
<META NAME="KBCreate" CONTENT="1991/05/17">
<META NAME="Keywords" CONTENT="kb16bitonly UsrDlgs kbcode">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="  In an application developed with Windows version 3.0 and later, to implement the ability to request context-sensitive help by pressing the F1 key in a dialog box, it is necessary to install a message filter.  This article describes how to install t...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAEV,QAUD,QDL9,QBWO,QBWN,QA01,QALZ,QAYC,QAH6,QAGI,QAH7,QAD7,QBWQ,QAA1,QDI2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INFO: Context-Sensitive Help in a Dialog Box Through F1</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 9, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q72219 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows
   versions 3.0, 3.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
In an application developed with Windows version 3.0 and later, to
implement the ability to request context-sensitive help by pressing the F1
key in a dialog box, it is necessary to install a message filter.
<P>
This article describes how to install the message filter. In
particular, it describes code that you can add to the Generic sample
application (included with the Windows Software Development Kit) to install
a message filter that would detect F1 keystrokes in the About Generic modal
dialog box.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Detecting F1 Keystrokes in a Dialog Box</h3>
 
<P>
Normally, the child control windows in a dialog box do not pass keystroke
messages on to the dialog box window. To detect F1 keystrokes in a dialog
box, it is necessary to install a message filter.
<P>
<P><h3>Installing a Filter Function</h3>
 
<P>
Page 1-65 of the "Microsoft Windows Software Development Kit Reference,
Volume 1" for version 3.0 of the Windows SDK and page 70 of "Programmer's
Reference, Volume 1, Overview" for version 3.1 of the Windows SDK describe
the method for installing a filter function for Windows.
<P>
<P><h3>Sample Code</h3>
 
<P>
Perform the following six steps to add code to the Generic sample
application to provide context-sensitive help in the About Generic modal
dialog box:

<OL><P><LI>Define a private message that the filter function can post to the
   application. For example:
<P>
<P><PRE>      #define PM_CALLHELP  WM_USER+1000
<PRE></PRE>                                     // wParam and lParam can be used to
                                     // pass context information

</PRE><P><LI>Define global variables:
<P>
<PRE>      FARPROC lpfnFilterProc;        // Our filter function
      HHOOK hHook;                   // hook handle

</PRE><P><LI>Add a filter function to the C-language source file. For example:
<P>
<PRE>   /*--------------------------    FilterFunc -------------------------*/
   //
   //   PARAMETERS:
   //
   //      nCode : Specifies the type of message being processed. It will
   //              be either MSGF_DIALOGBOX, MSGF_MENU, or less than 0.
   //
   //      wParam: specifies a NULL value
   //
   //      lParam: a FAR pointer to a MSG structure
   //
   //
   //   GLOBAL VARIABLES USED:
   //
   //      hHook
   //
   //
   //   NOTES:
   //
   //     If (nCode &lt; 0), return CallNextHookEx IMMEDIATELY.
   //
   //     If (MSGF_DIALOGBOX==nCode), set the local variable ptrMsg to
   //     point to the message structure. If this message is an F1
   //     keystroke, ptrMsg-&gt;hwnd will contain the HWND for the dialog
   //     control that the user wants help information on. Post a private
   //     message to the application, then return 1L to indicate that
   //     this message was handled.
   //
   //     When the application receives the private message, it can call
   //     WinHelp. WinHelp must NOT be called directly from the
   //     FilterFunc() routine.
   //
   //     In this example, post a private PM_CALLHELP message to the
   //     dialog box. wParam and lParam can be used to pass context
   //     information.
   //
   //     If the message is not an F1 keystroke, or if nCode is
   //     MSGF_MENU, we return 0L to indicate that we did not process
   //     this message.
   //
   //
  
   DWORD CALLBACK FilterFunc(nCode, wParam, lParam)
   int   nCode;
   WORD  wParam;
   DWORD lParam;
   {
      MSG FAR * ptrMsg;

      if (nCode &gt;= 0)                         // MUST return CallNextHookEx
      {
         if (MSGF_DIALOGBOX == nCode)
         {
            ptrMsg = (MSG FAR *)lParam;

            if ((WM_KEYDOWN == ptrMsg-&gt;message)
                   &amp;&amp; (VK_F1 == ptrMsg-&gt;wParam))
            {
               // Use PostMessage here to post an application-defined
               // message to the application. Here is one possible call:
               PostMessage(GetParent(ptrMsg-&gt;hwnd),
                                      PM_CALLHELP, ptrMsg-&gt;hwnd, 0L);
               return 1L;                       // Handled it
            }
         }
      }
      return CallNextHookEx(hHook, nCode, wParam, lParam);
   }
   /*--------------------- end FilterFunc  ----------------------------*/

</PRE><P><LI>Export the filter function in the module definition file.

<P><LI>Before calling DialogBox(), set the hook. After DialogBox() returns,
   unhook the hook. For example, the About Generic dialog box could be
   called as follows:
<P>
<P><PRE>      case IDM_ABOUT:
<PRE></PRE>        lpProcAbout    = MakeProcInstance(About, hInst);
        lpfnFilterProc = MakeProcInstance(FilterFunc, hInst);
        hHook    = SetWindowsHookEx(WH_MSGFILTER,
                                          lpfnFilterProc,
                                          hInst,
                                          NULL);

        DialogBox(hInst, "AboutBox", hWnd, lpProcAbout);

        UnhookWindowsHookEx(hHook);
        FreeProcInstance(lpfnFilterProc);
        FreeProcInstance(lpProcAbout);

        break;

</PRE><P><LI>Make the application respond to the private message by calling
   WinHelp.
</OL> 
<PRE>Keywords          : kb16bitonly UsrDlgs kbcode
Issue type        : kbinfo</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 9, 1998</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
