

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Reactivating First (and Only) Instance of an Application </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q70074 ">
<META NAME="KBModify" CONTENT="1997/07/22">
<META NAME="KBCreate" CONTENT="1991/03/09">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="  Sometimes restricting an application to a single instance is desirable. In that case, when the user starts a second instance of the application, a message box that says that the application is already running can be displayed. A more user-friendly ...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWN,QDL9,QBWO,QAJH,QBWS,QAF3,QAY5,QAMA,QAJQ,QBVV,QAUD,QAPN,QAML,QAGQ,QA01 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Reactivating First (and Only) Instance of an Application</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 22, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q70074 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.00 3.10
WINDOWS
kbprg
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows
   versions 3.1 and 3.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Sometimes restricting an application to a single instance is
desirable. In that case, when the user starts a second instance of the
application, a message box that says that the application is already
running can be displayed. A more user-friendly approach is to bring
the first instance to the front and activate it.
<P>
To accomplish this, perform the following four steps:

<OL><P><LI>Obtain the main window handle of the first instance.

<P><LI>If the first instance has an open dialog box, obtain the window
   handle of its last active pop-up window.

<P><LI>Bring the parent and pop-up window (if present) to the front.

<P><LI>Do not run the second instance.
<P>
</OL><h2>MORE INFORMATION</h2>
 
<P>
To determine whether an instance of the application is already
running, the first method below uses the FindWindow function to look
for the an application with the same main window class name. The
second method uses the hPrevInstance parameter to the WinMain
function.
<P>
The FindWindow method does not depend on any memory architecture or on
the hPrevInstance parameter; therefore, it is the suggested method for
future portability. The hPrevInstance assumes a memory architecture
for the operating system that allows a task to access another
application's data segments. In future versions of Windows, this may
not be possible if applications do not share the same local descriptor
table (LDT).
<P>
<P><h3>Method 1: Use FindWindow Function</h3>
 
<P>
HWND FirsthWnd, FirstChildhWnd;
<P>
if (FirsthWnd = FindWindow("MyMainWindowClassName", NULL))
<PRE>   {
   // Found another running application with the same class name.
   // Therefore, one instance is already running.
   // NOTE: "MyMainWindowClassName" must match the class name of the
   // program's main window. In the GENERIC sample application,
   // provided with the Microsoft Windows Software Development Kit,
   // versions 3.0 and 3.1, the chass name is "GenericWClass", which
   // is used in the InitApplication and InitInstance functions.

   FirstChildhWnd = GetLastActivePopup(FirsthWnd);
   BringWindowToTop(FirsthWnd);         // bring main window to top

   if (FirsthWnd != FirstChildhWnd)
      BringWindowToTop(FirstChildhWnd); // a pop-up window is active
                                        // bring it to the top too

   return FALSE;                        // do not run second instance
   }

</PRE></OL><h3>Method 2: Use hPrevInstance Parameter</h3>
 
<P>
<PRE>// Declare a global variable to save the handle of the first instance
// of the main window.

</PRE>HWND FirsthWnd;
<P>
<P>
<PRE>// Make the following modifications to the WinMain function:

HWND FirstChildhWnd;    // handle of last active pop-up window of the
                        // first application instance

if (!hPrevInstance)     // other instances of application running?
   if (!InitApplication(hInstance))  // initialize shared things
         return FALSE;  // exits if unable to initialize
   else {}

</PRE>else  // a previous instance exists;
<PRE>      // retrieve the main window handle from the first instance
   {
   GetInstanceData(hPrevInstance, (NPSTR)&amp;FirsthWnd, 2);

   FirstChildhWnd = GetLastActivePopup(FirsthWnd);
   BringWindowToTop(FirsthWnd);         // bring main window to top

   if (FirsthWnd != FirstChildhWnd)
      BringWindowToTop(FirstChildhWnd); // a pop-up window is active
                                        // bring it to the top too

   return FALSE;                        // do not run second instance
   }


// Add this line to the InitApplication function:

</PRE>FirsthWnd = NULL;  // no previous window, so this is NULL
<P>
<P>
<PRE>// Add these two lines to the InitInstance function after the
// "hWnd = CreateWindow(...);" call:

if (!FirsthWnd)       // If this is the first instance,
   FirsthWnd = hWnd;  // save the window handle.
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 3.10<BR>
KBCategory: kbprg<BR>
KBSubcategory: UsrWndw<BR>
Keywords            : kb16bitonly<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 22, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
