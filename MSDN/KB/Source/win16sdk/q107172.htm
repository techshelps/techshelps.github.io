

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Determining the Stack Size of an Application </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q107172">
<META NAME="KBModify" CONTENT="1997/07/23">
<META NAME="KBCreate" CONTENT="1993/11/15">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="  The tool helper library (TOOLHELP.DLL) contains application programming interface (API) functions that provide information about the task header of a Windows-based application's default data segment (DGROUP). A Windows- based application can use th...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWN,QDL9,QBWO,QBWQ,QAJH,QBQU,QAYY,QABH,QAGI,QADK,QABI,QA19,QAUS,QAKD,QBHQ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Determining the Stack Size of an Application</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 23, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q107172</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.10
WINDOWS
kbprg
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows version 3.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The tool helper library (TOOLHELP.DLL) contains application programming
interface (API) functions that provide information about the task header of
a Windows-based application's default data segment (DGROUP). A Windows-
based application can use this information to determine the maximum stack
size, the optimum stack size for the application, and whether the stack is
going to overflow.
<P>
Because the tool helper library is redistributable, this information
applies to Windows 3.0 also.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
A Windows-based application's DGROUP consists of several parts: the task
header, initialized and uninitialized static data area, stack, local
heap, and an atom table. The following picture extracted from Chapter
18 of the "Windows 3.1 Power Programming Techniques" by Peter Norton
and Paul Yao, shows the organization of the DGROUP:
<P>
<PRE>                   ---------------
                  |               |
                  |               |
                  |  Local Heap   |
                  |               |
                   --------------- &lt;-
                  |               |  |
                  |               |  |
                  |    Stack      |&lt;-|-
                  |               |  | |
                   --------------- &lt;-|-|-
                  |               |  | | |
                  |               |  | | |
                  |  Static Data  |  | | |
                  |               |  | | |
               --&gt; ---------------   | | |
              |   | pStackBottom  |--  | |
              |    ---------------     | |
              |   | pStackMin     |----  |
              |    ---------------       |
   Task   ----|   | pStackTop     |------
   Header     |    ---------------
              |   |     .         |
              |   |     .         |
              |   |     .         |
               --&gt; ---------------

</PRE>The task header is a data structure stored in the first 16 bytes of
the DGROUP and contains information about the stack, the local heap,
and the atom table. Windows stores three variables (pStackTop,
pStackBottom, and pStackMin) that point to various places in the stack
as shown in the picture above. pStackTop and pStackBottom point to the
top and bottom of the stack, and these two values stay constant once
initialized. pStackMin changes during run time to indicate how much of
the stack is actually used. Given this information, the following can
be determined:
<P>
<PRE>   Maximum Stack size = pStackBottom - pStackTop
   Dynamic Stack Size = pStackBottom - pStackMin

</PRE>The maximum stack size is either the size specified in the DEF file
with the STACKSIZE statement or 5K (Windows provides a minimum of 5K
stack). Because Windows updates the pStackMin at run time, monitoring
the dynamic size gives an indication as to how much stack space an
application really needs. This value may also be used to check for
stack overflows during run time, although using stack probes is
definitely a better method for checking stack overflows. Some advanced
debuggers such as WDEB386 (included in the Microsoft Windows SDK) and
SoftIce/W (from NuMega Technologies, Inc.) allow breakpoints to be set
on particular memory locations; for example, if a breakpoint is set at
the bottom of the stack, the debugger will break just before a stack
overflow.
<P>
Windows-based applications can obtain the values of pStackTop,
pStackBottom, and pStackMin by calling the tool help library API functions,
which return a TASKENTRY structure. An application should call
GetCurrentTask() to get its task handle and then call TaskFindHandle(),
TaskFirst() or TaskNext() with the task handle as a parameter. The
TASKENTRY structure contains three members wStackTop, wStackBottom, and
wStackMinimum, which correspond to the three pointers pStackTop,
pStackBottom, and pStackMin, respectively.
<P>
CodeView for Windows (CVW) debugger can also be used to look at the
task header of an application's DGROUP. For example, using CVW one can
periodically check the first 16 bytes in the DGROUP using the command:
<P>
<PRE>   D DS:0

</PRE>CVW will then display the following information:
<P>
<PRE>   DS:0006  PLOCALHEAP
   DS:0008  pAtomTable
   DS:000A  pStackTop
   DS:000C  pStackMin
   DS:000E  pStackBot

</PRE>The three values pStackTop, pStackMin, and pStackBot at locations
DS:000A, DS:000C, and DS:000E, respectively, can be used to determine
information about the application's stack as illustrated above.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.10<BR>
KBCategory: kbprg<BR>
KBSubCategory: KrMm<BR>
Keywords            : kb16bitonly<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 23, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
