

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Intel Privileged and Sensitive Instructions </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q114473">
<META NAME="KBModify" CONTENT="1997/07/23">
<META NAME="KBCreate" CONTENT="1994/05/04">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="  The Intel architecture defines  privileged  instructions and  sensitive  instructions. The privileged instructions may only be executed when the Current Privilege Level is zero (CPL = 0). Attempting to execute a privileged instruction when CPL != 0...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QASR,QATS,QBV8,QAB9,QAEF,QAHC,QADN,QDL9,QBWO,QBWN,QAJX,QADR,QA5W,QBWQ,QAHE V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Intel Privileged and Sensitive Instructions</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 23, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q114473</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.10
WINDOWS
kbprg
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows
   version 3.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The Intel architecture defines "privileged" instructions and "sensitive"
instructions. The privileged instructions may only be executed when the
Current Privilege Level is zero (CPL = 0). Attempting to execute a
privileged instruction when CPL != 0 will generate a general protection
(GP) exception. Windows traps GP exceptions caused by executing
privileged instructions and usually generates an application error.
<P>
The sensitive instructions (also called IOPL-sensitive) may only be
executed when CPL &lt;= IOPL (I/O Privilege Level). Attempting to execute a
sensitive instruction when CPL &gt; IOPL will generate a GP exception. This
should usually not cause a fatal error. The Windows Virtual Machine
Manager (VMM) traps GP exceptions caused by executing sensitive
instructions and (depending on the instruction) either simulates the
instruction's behavior in the VM in which the instruction was executed,
or dispaches it to a virtual device driver, which simulates the
instruction's behavior.
<P>
The Virtual Machine Manager (VMM), which is in WIN386 along with the
core Virtual Device Drivers (VxDs), runs at CPL = 0. By Intel hardware
definition, Virtual 8086 (V86) mode always runs at CPL = 3. In enhanced
mode, the machine can be either in IOPL = 0 or IOPL = 3.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The privileged instructions include:
<P>
<PRE>    CLTS - Clear Task-Switched Flag    LMSW    - Load Machine Status
    HLT  - Halt Processor              LTR     - Load Task Register
    LGDT - Load GDT Register           MOV CRn - Move Control Register
    LIDT - Load IDT Register           MOV DRn - Move Debug Register
    LLDT - Load LDT Register           MOV TRn - Move Test Register

</PRE>The sensitive instructions in protected mode include:
<P>
<PRE>    IN  - Input           OUTS - Output String
    INS - Input String    CLI  - Clear Interrupt-Enable Flag (IF)
    OUT - Output          STI  - Set IF

</PRE>The instruction POPF is both IOPL and CPL sensitive. IOPL will only be
changed by POPF when executed at CPL = 0. The interrupt flag (IF) will
only be changed by POPF if executed with CPL &lt;= IOPL. If POPF does not
change IOPL or the interrupt flag due to lack of privilege, no exception
is generated.
<P>
The sensitive instructions V86 mode include:
<P>
<PRE>    CLI   - Clear IF      POPF  - Pop Flags
    STI   - Set IF        INT n - Software Interrupt
    PUSHF - Push Flags    IRET  - Interrupt Return

</PRE>The CPL = 3 by definition in V86 mode. If IOPL &lt; 3, attempting to execute
V86 mode sensitive instructions will generate a GP exception. The
Windows VMM will trap the GP exception and emulate the instruction in
the VM in which it was originally executed.
<P>
I/O instructions are special in that they are sensitive not only to
IOPL, but also to the IO permission bitmap in the Task State Segment
(TSS). If CPL &lt;= IOPL, then the I/O operation will proceed without
checking the I/O permission bitmap. If CPL &gt; IOPL, or if in V86 mode, then
the I/O permission bitmap is consulted. If the bits corresponding to the
I/O port are clear, the I/O operation proceeds, otherwise, a GP
exception is generated. In response to this GP exception, the VMM gets
control and dispatches control to the VxD that traps the port.
<P>
<P><h2>REFERENCE</h2>
 
<P>
For additional information, please see the following article(s) in the
Microsoft Knowledge Base:
<P>
ARTICLE-ID: <B><A HREF="../WIN16SDK/Q100947.htm">Q100947</A></B>
<PRE>TITLE     : Port Trapping in Windows 3.0/3.1

</PRE>ARTICLE-ID: <B><A HREF="../VISUALC/Q112298.htm">Q112298</A></B>
<PRE>TITLE     : DOCERR: Port I/O with inp() and outp() Fails on Windows NT

</PRE>Also see the Intel "i486(TM) Microprocessor Programmer's Reference Manual"
and the section "The Effect of Priviledge Levels" in the article "The Tao
of Interrupts" on the Microsoft Developer Network (MSDN) Development
Library CD.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.10<BR>
KBCategory: kbprg<BR>
KBSubcategory: KrMisc<BR>
Keywords            : kb16bitonly<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 23, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
