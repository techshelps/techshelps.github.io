

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>DOCERR: "Guide to Programming" DLL Example Incorrect </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q88140 ">
<META NAME="KBModify" CONTENT="1997/07/23">
<META NAME="KBCreate" CONTENT="1992/08/18">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="  In the  Guide to Programming  manual included with version 3.1 of the Microsoft Windows Software Development Kit (SDK), the dynamic-link library (DLL) example in Chapter 20 contains some errors. The text below lists these errors and the steps to co...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QDL9,QBWO,QBWN,QBFY,QAAP,QAR4,QAB9,QBHQ,QBBI,QAPF,QDNN,QBWQ,QAPN,QAM1 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>DOCERR: "Guide to Programming" DLL Example Incorrect</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 23, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q88140 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.10
WINDOWS
kbtoolkbtoolg kbdocerr
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows version 3.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
In the "Guide to Programming" manual included with version 3.1 of the
Microsoft Windows Software Development Kit (SDK), the dynamic-link
library (DLL) example in Chapter 20 contains some errors. The text
below lists these errors and the steps to correct them.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Pages 475 and 480 discuss the Windows exit procedure (WEP) that must
be present in every DLL. The code on page 475 implies that the source
code for the WEP function belongs in the same file as the source code
for the other functions in the DLL. This implication is incorrect.
Because the segment containing the WEP must be marked PRELOAD FIXED
and the other segments of the DLL should be marked MOVEABLE
DISCARDABLE, the source code for the WEP should be in a separate file,
for example, WEP.C.
<P>
To correct this problem, name the code segment that contains the WEP
by specifying the -NT option switch for the Microsoft C Compiler. The
following compiles the code in the WEP.C file and places the resulting
code into a code segment named WEP_SEG:
<P>
<PRE>   cl -c -AMw -Gsw -NT WEP_SEG -Os -W3 wep.c

</PRE>Place a SEGMENTS statement in the module definition (.DEF) file to
specify the attributes for the code segment that contains the WEP. The
.DEF file should also include a CODE statement that specifies the
default attributes for the code segments not listed in a SEGMENTS
statement. The SEGMENTS statement is as follows:
<P>
<PRE>   SEGMENTS
      WEP_SEG PRELOAD FIXED

</PRE>On page 481, the .DEF file names the library using a combination of
uppercase and lowercase letters. Naming a library with lowercase
letters causes problems if the DLL is used with version 3.0 of the
Microsoft Windows graphical environment. These problems have been
corrected in Windows 3.1.
<P>
Also on page 481, the HEAPSIZE statement in the .DEF file does not
reserve any space for a heap for the DLL. This is incorrect. The DLL
must have at least a minimal heap available for the functions in the C
run-time library. Modify the HEAPSIZE statement to reserve 1024 bytes
for the heap.
<P>
On pages 482 and 483, the small memory model is incorrectly specified
in the C compiler command line. On pages 483 and 484, medium memory
model libraries are correctly specified to link the DLL.
<P>
To correct this problem, modify the compiler command line to use the
medium memory model libraries by replacing the -ASw option switch with
the -AMw option switch.
<P>
To reflect the changes listed in this article, replace the .DEF file
on page 481 with the following:
<P>
<PRE>   LIBRARY MINDLL
   DESCRIPTION 'MinDLL -- Minimum Code Required for DLL.'
   EXETYPE WINDOWS
   STUB 'WINSTUB.EXE'

   CODE MOVEABLE DISCARDABLE
   DATA MOVEABLE SINGLE
   SEGMENTS
      WEP_SEG PRELOAD FIXED

   HEAPSIZE 1024

   EXPORTS
      MinRoutine @1
      WEP        @2 RESIDENTNAME

</PRE>To reflect the changes listed in this article, replace the makefile on
pages 482 and 483 with the following:
<P>
<PRE>   all: mindll.dll

   mindll.obj: mindll.c
      cl -c -AMw -Gsw -Os -W3 mindll.c

   wep.obj: wep.c
      cl -c -AMw -Gsw -NT WEP_SEG -Os -W3 wep.c

   mindll.dll: mindll.obj wep.obj
      link mindll.obj libentry.obj wep.obj, mindll.dll, \
         mindll.map/map, mdllcew.lib libw.lib/noe/nod, mindll.def
      mapsym mindll.map
      implib mindll.lib mindll.def
      rc mindll.dll
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.10 docerr<BR>
KBCategory: kbprg kbdocerr<BR>
KBSubcategory: KrDll<BR>
Keywords            : kb16bitonly<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 23, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
