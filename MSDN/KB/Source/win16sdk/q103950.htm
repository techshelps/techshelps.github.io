

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>SetSelectorLimit() Crossing 1 Megabyte Boundary </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q103950">
<META NAME="KBModify" CONTENT="1997/07/23">
<META NAME="KBCreate" CONTENT="1993/09/01">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="  The SetSelectorLimit() application programming interface (API) function will not properly modify the limit of a selector if the change is to cross the 1 megabyte (MB) (0x100000) boundary. That is, the change is improper going from less than 1 MB to...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QANY,QABN,QAJB,QBXS,QAY5,QAEF,QBVV,QALG,QAJX,QADR,QBWA,QBV8,QAB9,QDL9,QBWO V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>SetSelectorLimit() Crossing 1 Megabyte Boundary</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 23, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q103950</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.00 3.10
WINDOWS
kbprg
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows,
   versions 3.0 and 3.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The SetSelectorLimit() application programming interface (API)
function will not properly modify the limit of a selector if the
change is to cross the 1 megabyte (MB) (0x100000) boundary. That is,
the change is improper going from less than 1 MB to greater than 1 MB
and visa versa. In these cases, DPMI function 08h must be used to
properly change the limit of a selector.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
SetSelectorLimit() does not correctly handle setting segment sizes
from less than 1 MB to greater than 1 MB because it will not set the
granularity bit. The granularity bit needs to be set to indicate page
granularity in the segment descriptor. When the granularity bit is
set, the selector limit has the form xxxxxFFFh for page alignment. A
page is 4K (4096 bytes).
<P>
Similarly, SetSelectorLimit() does not correctly handle setting
segment sizes from greater than 1 MB to less than 1 MB because it will
not clear the granularity bit. When the granularity bit is clear, the
selector limit has the form xxxxxh for byte alignment.
<P>
DPMI function 08h properly sets or clears the granularity bit when
appropriate. The limit must be in the form xxxxxFFFh when changed to
greater than 1 MB, and must be in the form xxxxxh when changed to less
than 1 MB.
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>//********************************************************************
// DPMISetSelectorLimit()
//
// This function sets a selector limit using DPMI Function AX=0008h
//(Set Segment Limit). This function is necessary if the segment size
// is greater than 1 MB because SetSelectorLimit() does not correctly
// set selector sizes greater than 1 MB.
//
// Segments that are larger than 1MB are actually page granular,
// meaning that in the descriptor, the limit field is actually
// stored as the number of 4K pages rather than bytes. When you
// specify a limit greater than 1MB, this function rounds it up
// to the nearest page boundary.
//
// No matter the size of the segment, this function always accepts
// selector limits in number of bytes, never pages. The conversion
// between bytes and pages is handled internally.
//
// Note that this function takes a segment limit, which is one less
// than the number of bytes in the segment.
//
//********************************************************************

</PRE>BOOL DPMISetSelectorLimit (UINT selector, DWORD dwLimit)
{
<PRE>   BOOL bRetVal=TRUE;

// If the limit is &gt;= 1MB, you need to make the limit a multiple of
// the page size or DPMISetSelectorLimit will fail.

   if( dwLimit &gt;= 0x100000 )
      dwLimit |= 0x0FFF;

   _asm
   {
      mov  ax, 0008h
      mov  bx, selector
      mov  cx, word ptr [dwLimit+2]
      mov  dx, word ptr [dwLimit]
      int  31h
      jnc  success
      mov  bRetVal, FALSE
   success:
   }

   return bRetVal;
</PRE>}
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: gp-fault gpf uae gp fault<BR>
KBCategory: kbprg<BR>
KBSubcategory: KrMm<BR>
Keywords            : kb16bitonly<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 23, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
