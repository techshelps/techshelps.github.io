

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>DOCERR: Suggested Changes to the DEVCAPS2 Sample App </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q80784 ">
<META NAME="KBModify" CONTENT="1996/01/09">
<META NAME="KBCreate" CONTENT="1992/02/13">
<META NAME="Keywords" CONTENT="kbprg kbfile">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="  DEVCAPS2 is a sample application developed for the Windows environment by Charles Petzold. DEVCAPS2 demonstrates how to retrieve various capabilities of a printer or display device. This sample is included in the book  Programming Windows Version 3...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QAGI,QDL9,QBWO,QBWN,QABA,QBAO,QAOX,QBWQ,QAJH,QAR4,QAPF,QAIF,QACT,QBTX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>DOCERR: Suggested Changes to the DEVCAPS2 Sample App</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 9, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q80784 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows
   versions 3.1 and 3.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
DEVCAPS2 is a sample application developed for the Windows environment
by Charles Petzold. DEVCAPS2 demonstrates how to retrieve various
capabilities of a printer or display device. This sample is included
in the book "Programming Windows Version 3," published by Microsoft
Press.
<P>
This article describes a change that should be made to the code in
DEVCAPS2, and also to any application based on DEVCAPS2. This change
works around a problem in calling the DeviceMode() API.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Problem Description</h3>
 
<P>
When the user selects DeviceMode from the File menu and modifies the
printer settings in the dialog box, the unmodified version of DEVCAPS2
does not update the WIN.INI file with the changed information.
Similarly, any changes to printer settings made using the Control
Panel are not reflected in the dialog box in DEVCAPS2.
<P>
The DeviceMode menu item is designed to allow the user to modify any
printer settings globally, for all applications. Any application that
uses the DeviceMode dialog box should use the new printer settings. In
addition, the application should write the new printer settings into
the WIN.INI file.
<P>
<P><h3>Resolution</h3>
 
<P>
Because the DEVCAPS2 program calls the DeviceMode() API with incorrect
parameters, it exhibits the behavior described above. The following code
appears in the DEVCAPS2.C file starting at line 176:
<P>
<PRE>       szOutput = strtok(szDriver,", ");
       strcat(strcpy(szDriverFile, szDriver), ".DRV");

</PRE>The code above sets szOutput equal to the name of the device driver
(for example, "EPSON9") rather than to the output port (for example,
"LPT1:"). To correct this problem, modify the code to add an
additional call to the strtok function, as in the following code:
<P>
<PRE>       szOutput = strtok(szDriver, ", ");
       szOutput = strtok(NULL, ", ");
       strcat(strcpy(szDriverFile, szDriver), ".DRV");

</PRE>After the modification, szOutput points to the output port. In the
subsequent call to DeviceMode(), the parameters are correct, and the
function works as expected.
<P>
In Windows version 3.1, applications should call ExtDeviceMode()
instead of DeviceMode().
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 3.10<BR>
KBCategory: kbprg kbfile<BR>
KBSubcategory: GdiDc<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 9, 1996</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
