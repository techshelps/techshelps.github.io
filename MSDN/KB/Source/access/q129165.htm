

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>ACC2: Trapping Specific ODBC Error Messages </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q129165">
<META NAME="KBModify" CONTENT="1997/05/20">
<META NAME="KBCreate" CONTENT="1995/04/19">
<META NAME="Keywords" CONTENT="kbusage OdbcSqlms">
<META NAME="KBArea" CONTENT="Support; KB; access, convert, crossnet, dbweb, odbc, winprint, setup, vbapp, office, officevba">
<META NAME="Description" CONTENT="  Advanced: Requires expert coding, interoperability, and multiuser skills.  This article demonstrates how to create a sample user-defined Access Basic function you can use to trap and parse a specific Open Database Connectivity (ODBC) error message,...">
<META NAME="Product" CONTENT="Access">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB4,QA1S,QAAP,QA9E,QABM,QDN9,QAY5,QA5F,QAMA,QAB9,QAH4,QAGI,QBV8,QAKP,QBAD V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>ACC2: Trapping Specific ODBC Error Messages</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 20, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q129165</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Access version 2.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Advanced: Requires expert coding, interoperability, and multiuser skills.
<P>
This article demonstrates how to create a sample user-defined Access
Basic function you can use to trap and parse a specific Open Database
Connectivity (ODBC) error message, such as the error message returned by
Microsoft SQL Server if you duplicate a unique index.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
ODBC error strings are returned in two parts. The first part is the generic
"ODBC call failed" error message; the second part is the specific error
message. If you use the Err() function to trap only the error number (which
is 3146 for a duplicate unique index), you trap only the first part, the
generic "ODBC call failed" error message. To get the specific error
message, you must parse the full error string that is returned.
<P>
This article assumes that you are familiar with Access Basic and with
creating Microsoft Access applications using the programming tools provided
with Microsoft Access. For more information about Access Basic, please
refer to the "Building Applications" manual.
<P>
<P><h3>Creating the Sample Function</h3>
 
<P>
To create the function that traps the specific error message, create a new
module and enter the following procedure.
<P>
NOTES:

<UL><LI>The following sample code assumes that you have an attached table
   called dbo_authors from the sample database PUBS in Microsoft SQL
   Server.

<LI>In the following sample code, an underscore (_) at the end of a line
   is used as a line-continuation character. Remove the underscore from the
   end of the line when re-creating this code.
<P>
<P><PRE>    Function TrapODBCError ()
</PRE><P>
<P><PRE>    On Error GoTo ErrorHandler
</PRE><P>
<P><PRE>    Dim mydb As Database
    Dim myrs As Recordset
    Dim ErrorString As String, ErrorNum As Double
    Dim ErrorStart As Integer, ErrorLength As Integer
</PRE><P>
<P><PRE>      Set mydb = CurrentDB()
       Set myrs = mydb.OpenRecordset("dbo_authors", db_open_dynaset,_
<PRE></PRE>          db_appendonly)

       myrs.AddNew
       myrs.au_id = "xxx"
       myrs.au_lname = "Smith"
       myrs.contract = 0
       myrs.Update

    Exit Function

    ErrorHandler:

       ErrorString = Error$
       'Find the beginning of the error string. It begins with "#."
       ErrorStart = InStr(1, ErrorString, "#") + 1
       'Find the length of the error value.
       ErrorLength = InStr(ErrorStart, ErrorString, ")") - ErrorStart
       'Get the error number.
       ErrorNum = Mid(ErrorString, ErrorStart, ErrorLength)
       MsgBox "Error number " &amp; CStr(ErrorNum) &amp; " has occurred."

       Exit Function

    End Function

</PRE></UL><h2>REFERENCES</h2>
 
<P>
Microsoft Access "Building Applications," version 2.0, Chapter 10,
"Handling Run-Time Errors," pages 221-238
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : kbusage OdbcSqlms<BR>
Version             : 2.0<BR>
Platform            : WINDOWS<BR>
Hardware            : X86<BR>
Issue type          : kbinfo<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 20, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
