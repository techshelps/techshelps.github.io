

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>ACC2: RegisterDatabase Method Does Not Modify ODBC.INI File </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q132329">
<META NAME="KBModify" CONTENT="1997/05/20">
<META NAME="KBCreate" CONTENT="1995/07/06">
<META NAME="Keywords" CONTENT="kberrmsg kbusage OdbcProb">
<META NAME="KBArea" CONTENT="Support; KB; access, convert, crossnet, dbweb, odbc, winprint, setup, vbapp, office, officevba">
<META NAME="Description" CONTENT="  Advanced: Requires expert coding, interoperability, and multiuser skills.  When you use the RegisterDatabase method in a custom function to supply connection information for an ODBC data source, Microsoft Access does not modify the ODBC.INI file an...">
<META NAME="Product" CONTENT="Access">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA1S,QDN9,QA9E,QAK6,QAY5,QAYY,QAH4,QAB9,QA5F,QAMA,QBXT,QA5V,QAIB,QBV8,QAPN V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>ACC2: RegisterDatabase Method Does Not Modify ODBC.INI File</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 20, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q132329</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Access version 2.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Advanced: Requires expert coding, interoperability, and multiuser skills.
<P>
When you use the RegisterDatabase method in a custom function to supply
connection information for an ODBC data source, Microsoft Access does not
modify the ODBC.INI file and may display the following error message:
<P>
<PRE>   "&lt;Data Source&gt; is not an existing data source name."

</PRE>This article assumes that you are familiar with Access Basic and with
creating Microsoft Access applications using the programming tools provided
with Microsoft Access. For more information about Access Basic, please
refer to the "Building Applications" manual.
<P>
<P><h2>CAUSE</h2>
 
<P>
The RegisterDatabase method in Microsoft Access version 2.0 is designed for
ODBC version 1.0. If you installed the ODBC Fulfillment Pack version 2.0,
you have a newer, incompatible version of the ODBC.DLL file, ODBC.DLL
2.00.1912.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To work around this problem, use one of the following methods to register
an ODBC data source if you installed the ODBC Fulfillment Pack version 2.0.
<P>
<P><h3>Method 1</h3>
 
<P>
In Access Basic, you can use the WritePrivateProfileString() API function
to add connection information to the ODBC.INI file for an ODBC data source.
The custom function adds the data source to the ODBC Data Sources section
of the OBDC.INI file, and then creates a new section for the data source as
follows:
<P>
<PRE>   [ODBC Data Sources]
   MyServer=SQL SERVER

   [MyServer]
   Driver=C:\WINDOWS\SYSTEM\sqlsrvr.dll
   Description=MyServer Data Source
   Server=MyServer
   Network=DBNMP3
   Database=pubs
   Language=us_english
   OemToAnsi=No

</PRE>For details on using the WritePrivateProfileString() API function, please
refer to the Microsoft Access Developer's Toolkit "Advanced Topics,"
version 2.0, Chapter 2, "Creating a Custom Setup Program," pages 32-34.
<P>
<P><h3>Method 2</h3>
 
<P>
In Access Basic, you can use the SQLConfigDatasource API() function to
write connection information for a data source to the ODBC.INI file. To
create and test this function, follow these steps:

<OL><P><LI>Create a new module and type the following lines in the Declarations
   section.
<P>
   NOTE: In the following sample code, an underscore (_) at the end of a
   line is used as a line-continuation character. Remove the underscore
   from the end of the line when re-creating this code.
<P>
<P><PRE>      Option Explicit
</PRE><P>
<P><PRE>      Declare Function SQLConfigDatasource Lib "odbcinst.dll" (ByVal _
<PRE></PRE>                       Hwnd%, ByVal fRequest%, ByVal lpszDriver$, _
                       ByVal lpszAttributes$) As Integer

      Global Const SQL_Add_DataSource = 1
      Global Const SQL_Edit_DataSource = 2
      Global Const SQL_Delete_DataSource = 3

</PRE><P><LI>Type the following procedure.
<P>
   NOTE: In the following sample code, an underscore (_) at the end of a
   line is used as a line-continuation character. Remove the underscore
   from the end of the line when re-creating this code.
<P>
<P><PRE>      Function New_DataSource (DataSourceType$, DataSourceName$, _
<PRE></PRE>               ServerName$, DatabaseName$) As Variant

         Const MB_ICON_INFORMATION = 64

         Dim DName As String
         Dim DSName As String
         Dim Server As String
         Dim DDatabase As String

         Dim RetVar As Variant

         DName = DataSourceType &amp; Chr$(0)
         DSName = "DSN=" &amp; DataSourceName &amp; Chr$(0)
         Server = "Server=" &amp; ServerName &amp; Chr$(0)
         DDatabase = "Database=" &amp; DatabaseName &amp; Chr$(0)

         RetVar = SQLConfigDatasource(0&amp;, SQL_Add_DataSource, DName, _
             DSName &amp; Server &amp; DDatabase)

         If RetVar = 1 Then
             MsgBox "Added Successfully.", MB_ICON_INFORMATION, ""
         Else
         MsgBox "There is a problem trying to register new data source." _
             &amp; Chr$(13) &amp; Chr$(10) &amp; "Please make sure everything is set _
             correctly.", MB_ICON_INFORMATION, ""
     End If

        New_DataSource = RetVar
      End Function

</PRE><P><LI>To test this procedure, type the following line in the Immediate
   window, and then press ENTER:
<P>
<P><PRE>      Print New_DataSource("SQL Server","TestSQL","MyServer","Pubs")
</PRE><P>
   Note that you receive a message stating that the new data source was
   added successfully.
<P>
</OL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft Access version
2.0. This problem no longer occurs in Microsoft Access version 7.0.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Problem</h3>
 

<OL><P><LI>Create a new module and type the following line in the Declarations
   section:
<P>
<P><PRE>      Option Explicit
</PRE>
<P><LI>Type the following procedure:
<P>
<PRE>      Sub Try_New_DataSource ()

         Dim Attribs As String
         Attribs = "Description=SQL Server on server MyServer" &amp; Chr$(13)
         Attribs = Attribs &amp; "OemToAnsi=No" &amp; Chr$(13)
         Attribs = Attribs &amp; "Network=DBNMP3" &amp; Chr$(13)
         Attribs = Attribs &amp; "Address=\\MYSERVER\PIPE\SQL\QUERY" &amp; Chr$(13)
         Attribs = Attribs &amp; "Database=NWIND.MDB"
         DBEngine.RegisterDatabase "MyServer", "SQL Server", 0, Attribs

      End Sub

</PRE><P><LI>To test this procedure, type the following line in the Immediate window,
   and then press ENTER:
<P>
<P><PRE>      Try_New_DataSource
</PRE><P>
   Note that you receive the following error message:
<P>
<P><PRE>      &lt;MyServer&gt; is not a valid data source name.
</PRE><P>
</OL><h2>REFERENCES</h2>
 
<P>
Microsoft Access "Building Applications," version 2.0, Chapter 15, "Using
Library Databases and Dynamic-Link Libraries," pages 367-371
<P>
"Microsoft ODBC Programmer's Reference and SDK Guide", version 2.0,
Chapter 24, "Installer DLL Function Reference," pages 528-529
<P>
For more information about using the WritePrivateProfileString() API
Function, please see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../ACCESS/Q90988.htm">Q90988</A></B>
   TITLE     : How to Use Get, WritePrivateProfileString

</PRE></OL>For more information about registering a data source from Microsoft Visual
Basic, please see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../VBWIN/Q126940.htm">Q126940</A></B>
   TITLE     : BUG: RegisterDatabase Fails After ODBC Version 2.x Installed
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : kberrmsg kbusage OdbcProb<BR>
Version             : 2.0<BR>
Platform            : WINDOWS<BR>
Hardware            : X86<BR>
Issue type          : kbbug<BR>
Resolution Type     : kbcode<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 20, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
