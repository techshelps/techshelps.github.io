

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>BUG: Initialization Problem with FORTRAN and Basic </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q79825 ">
<META NAME="KBModify" CONTENT="1997/02/06">
<META NAME="KBCreate" CONTENT="1992/01/08">
<META NAME="Keywords" CONTENT="kbprg kbinterop kbbuglist kbcode">
<META NAME="KBArea" CONTENT="Support; KB; fortran">
<META NAME="Description" CONTENT="  Mixed-language programs with Microsoft FORTRAN 5.0 or 5.1 and Microsoft Basic 7.1, in which the FORTRAN code opens a file or accesses the near heap, can stop the machine upon execution. This problem occurs while running the program under both MS-DO...">
<META NAME="Product" CONTENT="Fortran">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAMA,QA5F,QAGI,QAVX,QAVW,QAH4,QAIF,QBJC,QAKP,QBFY,QAGB,QBSO,QBXT,QALZ,QAA7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Initialization Problem with FORTRAN and Basic</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 6, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q79825 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft FORTRAN for MS-DOS, versions 5.0 and 5.1
<LI>Microsoft FORTRAN for OS/2, versions 5.0 and 5.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Mixed-language programs with Microsoft FORTRAN 5.0 or 5.1 and Microsoft
Basic 7.1, in which the FORTRAN code opens a file or accesses the near
heap, can stop the machine upon execution. This problem occurs while
running the program under both MS-DOS and OS/2.
<P>
<P><h2>CAUSE</h2>
 
<P>
Basic calls its heap initialization sequence twice and FORTRAN calls its
initialization sequence once. The second time Basic calls its
initialization sequence, it overwrites the information that FORTRAN
requires to do file I/O.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
The Basic program must explicitly call the FORTRAN initialization routine
before calling any other FORTRAN routine that does file I/O. It should be
called only once, typically at the start of the Basic main program. This
routine will rewrite the required FORTRAN file structure information and
allow FORTRAN file I/O to function correctly.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft FORTRAN version
5.0 and 5.1 for MS-DOS and OS/2. We are researching this problem and will
post new information here as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The FORTRAN initialization routine that needs to be called is named
__FFinit. The easiest way to call this routine is to use a DECLARE
statement in Basic that uses the ALIAS keyword. The following sample
code illustrates this solution and runs as expected. If the Basic call
to __FFinit is commented out, the program will stop the machine under
MS-DOS and stop the current process under OS/2.
<P>
<P><h3>Basic Sample Code</h3>
 
<P>
DIM HEAP%(2048)
COMMON SHARED /NMALLOC/ HEAP%()
<P>
DECLARE SUB FINIT CDECL ALIAS "__FFinit"
DECLARE SUB FORTSUB
<P>
CALL FINIT
CALL FORTSUB
<P>
END
<P>
<P>
<P><h3>FORTRAN Sample Code</h3>
 
<P>
<PRE>      subroutine fortsub

      open(1,file='test.dat')
      write(1,*) 'Writing to file in FORTRAN'
      print*, 'Finished writing to file in FORTRAN'
      close(1)
      end

</PRE>Note: The following MAKE files are only for use with FORTRAN 5.1. To
use FORTRAN 5.O, you must specify a C-compatible FORTRAN library and
also a C 6.0 run-time library on the link line. For additional
information, please see the following article in the Microsoft Knowledge
Baes:
<P>
<PRE>   ARTICLE-ID: <B><A HREF="../zMiscellaneous/Q66428.htm">Q66428</A></B>
   TITLE     : How to Link Basic 7.1 with C 5.1, FORTRAN 5.0, and Pascal
               4.0

</PRE><h3>MAKE File for OS/2</h3>
 
<P>
all: test.exe
<P>
ftest.obj : ftest.for
<PRE>  fl /c /Zi /Od ftest.for

</PRE>btest.obj : btest.bas
<PRE>  bc /o /Fs /Zi /LP btest.bas;

</PRE>test.exe : btest.obj ftest.obj
<PRE>  link /NOD /NOE /CO btest ftest,test.exe,nul,bcl71efp llibfep os2;


</PRE><h3>MAKE File for MS-DOS</h3>
 
<P>
all: test.exe
<P>
ftest.obj : ftest.for
<PRE>  fl /c /Zi /Od ftest.for

</PRE>btest.obj : btest.bas
<PRE>  bc /o /Fs /Zi /LR btest.bas;

</PRE>test.exe : btest.obj ftest.obj
<PRE>  link /NOD /NOE /CO btest ftest,test.exe,nul,bcl71efr llibfer;
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 5.10 5.00 7.10 F6200<BR>
KBCategory: kbprg kbbuglist kbcode kbinterop<BR>
KBSubcategory: FORTLngIss<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 6, 1997</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
