

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Monitoring the Stack Using Assembly or C </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q51294 ">
<META NAME="KBModify" CONTENT="1995/07/17">
<META NAME="KBCreate" CONTENT="1989/11/22">
<META NAME="Keywords" CONTENT="kbprg kbcode">
<META NAME="KBArea" CONTENT="Support; KB; fortran">
<META NAME="Description" CONTENT="  If, for any reason, you believe that the stack in a FORTRAN program is being corrupted, you can monitor the stack segment (SS) register and stack pointer (SP) register by using either the Microsoft Assembler package. Since CodeView may use the stac...">
<META NAME="Product" CONTENT="Fortran">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA4Q,QAH4,QBBS,QAPN,QAB9,QAY5,QAUD,QAYA,QBFY,QBV8,QAJQ,QDMW,QBE7,QBE6,QA8T V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Monitoring the Stack Using Assembly or C</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 17, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q51294 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft FORTRAN for MS-DOS, versions 4.0, 4.1, 5.0 and 5.1
<LI>Microsoft FORTRAN for OS/2, version 4.0, 4.1, 5.0 and 5.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
If, for any reason, you believe that the stack in a FORTRAN program is
being corrupted, you can monitor the stack segment (SS) register and
stack pointer (SP) register by using either the Microsoft Assembler
package. Since CodeView may use the stack for its own purposes, this allows
a more direct monitoring method.
<P>
A function for each package is shown below along with the appropriate
interface statement. Each function returns an integer*4 to FORTRAN.
<P>
To extract the hexadecimal values from that integer, use a format
statement something similar to the following example:
<P>
<PRE>      write (*,'(1x,A7,1x,4Z,A1,4Z)')
     + 'seg:off',stackloc(),':',ISHC(stackloc(),16)

</PRE>This write statement produces video output of the following form:
<P>
<PRE>      seg:off 2BC0:111A

</PRE><h2>MORE INFORMATION</h2>
 
<P>
The assembly code and interface statement are shown below.
<P>
<PRE>      interface to integer*4 function stackloc()
      end
      integer*4 stackloc

</PRE>.model large
.code
public stackloc
stackloc proc
<PRE>       mov dx,ss
       mov ax,sp
       ret
</PRE>stackloc endp
<PRE>       end

</PRE>The equivalent interface for the following QuickC with Assembler code
is also listed below (keep in mind that this code must be compiled
with the /AL switch for memory model compatibility):
<P>
<PRE>      interface to integer*4 function stackloc [C,
     + alias:'_stackloc'] ()
      end
      integer*4 stackloc

int * stackloc(void)
</PRE>{
<PRE>        int j[2];

        _asm {
                mov     j[0],ss
                mov     j[1],sp
        }
        return j;
}
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: kbinf  5.00 5.10 debug watch view<BR>
KBCategory: kbprg kbcode<BR>
KBSubcategory: FORTLngIss CLngIss MASMLngIss<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 17, 1995</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
