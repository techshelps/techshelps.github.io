

<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Using the NEAR Attribute with FORTRAN COMMON Blocks </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q60079 ">
<META NAME="KBModify" CONTENT="1995/07/17">
<META NAME="KBCreate" CONTENT="1990/03/28">
<META NAME="Keywords" CONTENT="kbprg kbcode">
<META NAME="KBArea" CONTENT="Support; KB; fortran">
<META NAME="Description" CONTENT="  Page 34 of the Microsoft FORTRAN  Advanced Topics  manual includes a discussion of using the NEAR attribute with a COMMON block. By default, in Microsoft FORTRAN each COMMON block is placed into its own data segment to save space in the default dat...">
<META NAME="Product" CONTENT="Fortran">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAHC,QAA8,QAYY,QAKR,QAHE,QABA,QAPN,QAC2,QAAW,QAH4,QABO,QAW6,QAUJ,QAOT,QAE1 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Using the NEAR Attribute with FORTRAN COMMON Blocks</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 17, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q60079 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft FORTRAN for MS-DOS, versions 4.0, 4.01, 4.1, 5.0, 5.1
<LI>Microsoft FORTRAN for OS/2, version 4.1, 5.0, 5.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Page 34 of the Microsoft FORTRAN "Advanced Topics" manual includes a
discussion of using the NEAR attribute with a COMMON block. By
default, in Microsoft FORTRAN each COMMON block is placed into its own
data segment to save space in the default data segment (DGROUP). The
drawback to this method is that a far pointer is required to access
data from a COMMON block which makes the compiled code larger and
slower. To address this problem, use the NEAR attribute with small,
frequently accessed COMMON blocks. To use this technique, sufficient
space must be available in the default data segment.
<P>
When an application uses the NEAR attribute with a COMMON block, the
data in each COMMON block may appear to remain in its own segment,
rather than in the DGROUP segment when you use the /Fs compiler option
switch to create a source listing. This may be confusing when space is
obviously available in the default data segment for information in the
COMMON block. To verify that a NEAR COMMON block is concatenated to
the default data segment, view an object listing or a map listing. (To
create an object listing, specify the /Fl compiler option switch; to
generate a map listing, specify the /Fm compiler option switch.)
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following code example demonstrates using the NEAR attribute to
place data in COMMON blocks into the default data segment.
<P>
<P><h3>Sample Code</h3>
 
<P>
C Compile options needed: None
<P>
<PRE>      INTEGER*4 A, B, C
      COMMON    /C1 [NEAR]/ A, C
      COMMON    /C2 [NEAR]/ B
      END

</PRE>The source listing describes each COMMON block as follows:
<P>
<PRE>   Global Symbols
   Name                      Class   Type              Size   Offset
   C1. . . . . . . . . . . . common  ***                  8    0000
   C2. . . . . . . . . . . . common  ***                  4    0000
   main. . . . . . . . . . . FSUBRT  ***                ***    0000

</PRE>The map file indicates that each COMMON block is included in DGROUP.
In the listing below, note that the segment address of each COMMON
block is 005Dh, the DGROUP segment address:
<P>
<PRE> Start  Stop   Length Name                   Class
 00710H 00713H 00004H C2$A                   $C2
 00720H 00727H 00008H C1$A                   $C1

 Origin   Group
 005D:0   DGROUP

  Address         Publics by Name
 005D:0130       C1
 005D:0120       C2

  Address         Publics by Value
 005D:0120       C2
 005D:0130       C1

</PRE>The object listing includes a description of the manner in which the
compiler grouped all segments, including the NEAR COMMON blocks, into
DGROUP. That portion of the object listing is as follows:
<P>
<PRE>     NAME    common

</PRE>C2$A SEGMENT  PARA COMMON '$C2'
C2$A ENDS
C1$A SEGMENT  PARA COMMON '$C1'
C1$A ENDS
<PRE>DGROUP    GROUP     CONST, _BSS, _DATA, C2$A, C1$A
     ASSUME  CS: COMMON_TEXT, DS: DGROUP, SS: DGROUP, ES: DGROUP
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: kbinf  4.00 4.01 4.10 5.00 5.10<BR>
KBCategory: kbprg kbcode<BR>
KBSubcategory: FORTLngIss<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 17, 1995</FONT>
	<BR>
	<A HREF="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
