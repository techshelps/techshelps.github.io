<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Receive</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_sna_receive_cpic"></a>Receive</h1>
<p>
The <b>Receive</b> call (function name <b>cmrcv</b>) receives any data that is currently available from the partner program. To avoid blocking for clients running Microsoft® Windows® version 3.<i>x</i>, use the <a href="cpic03_3kir.htm"><b>Specify_Windows_Handle</b></a> call. For Microsoft® Windows NT® and Windows 95, run a background thread for all CPI-C communications and preserve the foreground thread for user interface only.</p>
<pre><code><b>CM_ENTRY Receive(
  unsigned char FAR</b><i> *conversation_ID</i><b>,  </b>
<b>  unsigned char FAR</b><i> *buffer</i><b>,           </b>
<b>  CM_INT32 FAR</b><i> *requested_length</i><b>,      </b>
<b>  CM_INT32 FAR</b><i> *data_received</i><b>,         </b>
<b>  CM_INT32 FAR</b><i> *received_length</i><b>,       </b>
<b>  CM_INT32 FAR</b><i> *status_received</i><b>,       </b>
<b>  CM_INT32 FAR</b><i> *request_to_send_received</i><b>,  </b>
<b>  CM_INT32 FAR</b><i> *return_code            </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>conversation_ID</i></dt>
<dd>
Supplied parameter. Specifies the identifier for the conversation. The value of this parameter was returned by <a href="cpic03_0jhf.htm"><b>Initialize_Conversation</b></a> or <a href="cpic03_70df.htm"><b>Accept_Conversation</b></a>.</dd>
<dt>
<i>buffer</i></dt>
<dd>
Returned parameter. Specifies the address of the buffer to contain the data received by the local program.
<p>
The buffer contains data if the following conditions are true:

<ul>
<li>
The <i>data_received</i> parameter is set to a value other than CM_NO_DATA_RECEIVED.</li>
<li>
The <i>return_code</i> parameter is set to cm_ok or to cm_deallocated_normal.</li>
</ul>
</dd>
<dt>
<i>requested_length</i></dt>
<dd>
Supplied parameter. Indicates the maximum number of bytes of data the local program is to receive. The range is from 0 through 32767.</dd>
<dt>
<i>data_received</i></dt>
<dd>
Returned parameter. Indicates whether the program received data. The following are possible values. These codes are not relevant unless <i>return_code</i> is set to cm_ok or cm_deallocated_normal.
<dl>
<dt>
CM_DATA_RECEIVED</dt>
<dd>
Can be returned for a basic conversation if the conversation's fill characteristic is set to CM_FILL_BUFFER, indicating that the program is receiving data independent of its logical format. The local program received data until <i>requested_length</i> or end of data was reached.
<p>
The end of the data is indicated by either a change to another conversation state, based on the <i>return_code</i>, <i>status_received</i>, and <i>data_received</i> parameters, or an error condition. If the conversation's receive type is set to CM_RECEIVE_IMMEDIATE, the data received can be less than <i>requested_length</i> if a smaller amount of data has arrived from the partner program.
</dd>
<dt>
CM_COMPLETE_DATA_RECEIVED</dt>
<dd>
In a mapped conversation, indicates that the local program has received a complete data record or the last part of a data record.
<p>
In a basic conversation with the fill characteristic set to CM_FILL_LL, this value indicates that the local program has received a complete logical record or the end of a logical record.
</dd>
<dt>
CM_INCOMPLETE_DATA_RECEIVED</dt>
<dd>
In a mapped conversation, indicates that the local program has received an incomplete data record. The <i>requested_length</i> parameter specified a value less than the length of the data record (or less than the remainder of the data record if this is not the first <b>Receive</b> to read the record). The amount of data received is equal to the <i>requested_length</i> parameter.
<p>
In a basic conversation with the fill characteristic set to CM_FILL_LL, this value indicates that the local program has received an incomplete logical record. The amount of data received is equal to the <i>requested_length</i> parameter. (If the received data was truncated, the length of the data will be less than <i>requested_length</i>.)

<p>
Upon receiving this value, the local program normally reissues <b>Receive</b> to receive the next part of the record.
</dd>
<dt>
CM_NO_DATA_RECEIVED</dt>
<dd>
The program did not receive data.
</dd>
</dl>

<p>
Note that if the <i>return_code</i> parameter is set to cm_ok, status information may be available through the <i>status_received</i> parameter.
</dd>
<dt>
<i>received_length</i></dt>
<dd>
Returned parameter. Indicates the number of bytes of data the local program received on this <b>Receive</b> call. If <i>return_code</i> or <i>data_received</i> indicates that the program received no data, this number is not relevant.</dd>
<dt>
<i>status_received</i></dt>
<dd>
Returned parameter. Indicates changes in the status of the conversation. The following are possible values. These codes are not relevant unless <i>return_code</i> is set to cm_ok.
<dl>
<dt>
CM_NO_STATUS_RECEIVED</dt>
<dd>
No conversation status change was received on this call.</dd>
<dt>
CM_SEND_RECEIVED</dt>
<dd>
Indicates, for the partner program, that the conversation has entered RECEIVE state. For the local program, the conversation is now in SEND state if no data was received on this call, or SEND_PENDING state if data was received on this call.
<p>
Upon receiving this value, the local program normally uses <a href="cpic03_94ir.htm"><b>Send_Data</b></a> to begin sending data.
</dd>
<dt>
CM_CONFIRM_DEALLOC_RECEIVED</dt>
<dd>
Indicates that the partner program issued <a href="cpic03_5vkz.htm"><b>Deallocate</b></a> with confirmation requested. For the local program the conversation is now in CONFIRM_DEALLOCATE state.
<p>
Upon receiving this value, the local program normally issues the <a href="cpic03_6c6b.htm"><b>Confirmed</b></a> call.
</dd>
<dt>
CM_CONFIRM_RECEIVED</dt>
<dd>
Indicates that the partner program issued the <a href="cpic03_5q8z.htm"><b>Confirm</b></a> call. For the local program, the conversation is in CONFIRM state.
<p>
Upon receiving this value, the local program normally issues the <b>Confirmed</b> call.
</dd>
<dt>
CM_CONFIRM_SEND_RECEIVED</dt>
<dd>
Indicates, for the partner program, that the conversation has entered RECEIVE state and a request for confirmation has been received by the local program. For the local program, the conversation is now in CONFIRM_SEND state.
<p>
The program normally responds by issuing the <b>Confirmed</b> call. Upon successful execution of the <b>Confirmed</b> call, the conversation changes to SEND state for the local program.

</dd>
</dl>
</dd>
<dt>
<i>request_to_send_received</i></dt>
<dd>
Returned parameter. Specifies the request-to-send-received indicator. Possible values are:
<dl>
<dt>
CM_REQ_TO_SEND_RECEIVED</dt>
<dd>
The partner program issued the <a href="cpic03_6crn.htm"><b>Request_To_Send</b></a> call, which requests the local program to change the conversation to RECEIVE state.</dd>
<dt>
CM_REQ_TO_SEND_NOT_RECEIVED</dt>
<dd>
The partner program did not issue the <b>Request_To_Send</b> call. This value is not relevant if the <i>return_code</i> parameter is set to cm_program_parameter_check or cm_program_state_check.
</dd>
</dl>
</dd>
<dt>
<i>return_code</i></dt>
<dd>
The code returned from this call. The valid return codes are listed below.
</dd>
</dl>
<h4>Return Codes</h4>
<dl>
<dt>
cm_ok</dt>
<dd>
Primary return code; the call executed successfully.</dd>
<dt>
cm_operation_not_accepted</dt>
<dd>
Primary return code; a previous operation on this conversation is incomplete.</dd>
<dt>
cm_operation_incomplete</dt>
<dd>
Primary return code; the operation has not completed (processing mode is nonblocking only) and is still in progress. The program can issue <a href="cpic03_6un7.htm"><b>Wait_For_Conversation</b></a> to await the completion of the operation, or <a href="cpic03_017n.htm"><b>Cancel_Conversation</b></a> to cancel the operation and conversation. If <a href="cpic03_3kir.htm"><b>Specify_Windows_Handle</b></a> has been called, the application should wait for notification by a Windows message and not call <b>Wait_For_Conversation</b>.</dd>
<dt>
cm_unsuccessful</dt>
<dd>
Primary return code; the receive type is set to CM_RECEIVE_IMMEDIATE and no data is immediately available from the partner program.</dd>
<dt>
cm_deallocated_normal</dt>
<dd>
Primary return code; the conversation has been deallocated normally. The partner program issued <a href="cpic03_5vkz.htm"><b>Deallocate</b></a> with the conversation's deallocate type set to CM_DEALLOCATE_FLUSH or CM_DEALLOCATE_SYNC_LEVEL with the synchronization level of the conversation specified as CM_NONE.</dd>
<dt>
cm_program_parameter_check</dt>
<dd>
Primary return code; one of the following occurred:
<ul>
<li>
The value specified by <i>conversation_ID</i> is invalid.</li>
<li>
The value specified by <i>requested_length</i> is out of range (greater than 32767).</li>
</ul>

<p>
If the program receives this return code, the other returned parameters are not valid.
</dd>
<dt>
cm_program_state_check</dt>
<dd>
Primary return code; one of the following occurred:
<ul>
<li>
The receive type is set to CM_RECEIVE_AND_WAIT and the conversation state is not RECEIVE, SEND, or SEND_PENDING.</li>
<li>
The receive type is set to CM_RECEIVE_IMMEDIATE and the conversation state is not RECEIVE.</li>
<li>
In a basic conversation, the conversation is in SEND state, the receive type is set to CM_RECEIVE_AND_WAIT, and the program did not finish sending a logical record.</li>
</ul>

<p>
If the program receives this return code, the other returned parameters are not valid.
</dd>
<dt>
cm_product_specific_error</dt>
<dd>
Primary return code; a product-specific error occurred and has been logged in the product's error log.</dd>
<dt>
cm_conversation_type_mismatch</dt>
<dd>
Primary return code; the partner LU or program does not support the conversation type (basic or mapped) specified in the allocation request.</dd>
<dt>
cm_pip_not_specified_correctly</dt>
<dd>
Primary return code; the allocation request was rejected by a non-CPI-C LU 6.2 TP. The partner program requires one or more PIP data variables, which are not supported by CPI-C.</dd>
<dt>
cm_security_not_valid</dt>
<dd>
Primary return code; the user identifier or password specified in the allocation request was not accepted by the partner LU.</dd>
<dt>
cm_sync_level_not_supported_pgm</dt>
<dd>
Primary return code; the partner program does not support the synchronization level specified in the allocation request.</dd>
<dt>
cm_tpn_not_recognized</dt>
<dd>
Primary return code; the partner LU does not recognize the program name specified in the allocation request.</dd>
<dt>
cm_tp_not_available_no_retry</dt>
<dd>
Primary return code; the partner LU cannot start the program specified in the allocation request because of a permanent condition. The reason for the error may be logged on the remote node. Do not retry the allocation until the error has been corrected.</dd>
<dt>
cm_tp_not_available_retry</dt>
<dd>
Primary return code; the partner LU cannot start the program specified in the allocation request because of a temporary condition. The reason for the error may be logged on the remote node. Retry the allocation.</dd>
<dt>
cm_program_error_no_trunc</dt>
<dd>
Primary return code; while in SEND state or in SEND_PENDING state with the error direction set to CM_SEND_ERROR, the partner program issued <a href="cpic03_2j6r.htm"><b>Send_Error</b></a>. Data was not truncated.</dd>
<dt>
cm_program_error_purging</dt>
<dd>
Primary return code; one of the following occurred:
<ul>
<li>
While in RECEIVE or CONFIRM state, the partner program issued <b>Send_Error</b>. Data sent but not yet received is purged.</li>
<li>
While in SEND_PENDING state with the error direction set to CM_RECEIVE_ERROR, the partner program issued <b>Send_Error</b>. Data was not purged.</li>
</ul>
</dd>
<dt>
cm_resource_failure_no_retry</dt>
<dd>
Primary return code; one of the following occurred:
<ul>
<li>
The conversation was terminated prematurely because of a permanent condition. Do not retry until the error has been corrected.</li>
<li>
The partner program did not deallocate the conversation before terminating normally.</li>
</ul>
</dd>
<dt>
cm_resource_failure_retry</dt>
<dd>
Primary return code; the conversation was terminated prematurely because of a temporary condition, such as modem failure. Retry the conversation.</dd>
<dt>
cm_deallocated_abend</dt>
<dd>
Primary return code; the conversation has been deallocated for one of the following reasons:
<ul>
<li>
The remote program issued <a href="cpic03_5vkz.htm"><b>Deallocate</b></a> with the type parameter<i> </i>set to CM_DEALLOCATE_ABEND, or the remote LU did so because of a remote program abnormal-ending condition. If the conversation for the remote program was in RECEIVE state when the call was issued, information sent by the local program and not yet received by the remote program is purged.</li>
<li>
The remote TP terminated normally but did not deallocate the conversation before terminating. Node services at the remote LU deallocated the conversation on behalf of the remote TP.</li>
</ul>
</dd>
<dt>
cm_deallocated_abend_svc</dt>
<dd>
Primary return code; the conversation has been deallocated for one of the following reasons:
<ul>
<li>
The partner program issued <b>Deallocate</b> with the type parameter set to ABEND_SVC.</li>
<li>
The partner program did not deallocate the conversation before terminating.</li>
</ul>

<p>
If the conversation is in RECEIVE state for the partner program when this call is issued by the local program, data sent by the local program and not yet received by the partner program is purged.
</dd>
<dt>
cm_deallocated_abend_timer</dt>
<dd>
Primary return code; the conversation has been deallocated because the partner program issued <b>Deallocate</b> with the type parameter set to ABEND_TIMER. If the conversation is in RECEIVE state for the partner program when this call is issued by the local program, data sent by the local program and not yet received by the partner program is purged.</dd>
<dt>
cm_svc_error_purging</dt>
<dd>
Primary return code; while in SEND state, the partner program or partner LU issued <a href="cpic03_2j6r.htm"><b>Send_Error</b></a> with the type parameter set to SVC. Data sent to the partner program may have been purged.</dd>
<dt>
cm_svc_error_no_trunc</dt>
<dd>
Primary return code; while in SEND state, the partner program or partner LU issued <b>Send_Error</b> with the type parameter set to SVC. Data sent to the partner program may have been purged.</dd>
<dt>
cm_program_error_trunc</dt>
<dd>
Primary return code; in SEND state, before finishing sending a complete logical record, the partner program issued <b>Send_Error</b>. The local program may have received the first part of the logical record through a <b>Receive</b> call.</dd>
<dt>
cm_svc_error_trunc</dt>
<dd>
Primary return code; while in RECEIVE or CONFIRM state, the partner program or partner LU issued <b>Send_Error</b> with the type parameter set to SVC before it finished sending a complete logical record. The local program may have received the first part of the logical record.
</dd>
</dl>
<h4>State Changes</h4>
<p>
The conversation can be in RECEIVE, SEND, or SEND_PENDING state.</p>
<p>
If <i>receive_type</i> is set to CM_RECEIVE_IMMEDIATE, the conversation must be in RECEIVE state.</p>
<p>
Issuing <b>Receive</b> while the conversation is in SEND or SEND_PENDING state causes the local LU to send the information in its send buffer and a send indicator to the partner program. Based on <i>data_received</i> and <i>status_received</i> the conversation can change to RECEIVE state for the local program.</p>
<p>
The new conversation state is determined by:
<ul>
<li>
The state the conversation is in when the program issues the call.</li>
<li>
The <i>return_code</i> parameter.</li>
<li>
The <i>data_received</i> and <i>status_received</i> parameters.</li>
</ul>
<p>
If no data is currently available and the receive type (set by <a href="cpic03_919f.htm"><b>Set_Receive_Type</b></a>) is set to CM_RECEIVE_AND_WAIT, the local program waits for data to arrive. If the receive type is set to CM_RECEIVE_IMMEDIATE, the local program does not wait.</p>
<p>
The process for receiving data is as follows:
<ul>
<li>
The local program issues a <b>Receive</b> call until it finishes receiving a complete unit of data. The local program may need to issue <b>Receive</b> several times to receive a complete unit of data. The <i>data_received</i> parameter indicates whether the receipt of data is finished.<p>
The data received can be:
<p class=indent1>
One data record transmitted in a mapped conversation.</p>
<p class=indent1>
One logical record transmitted in a basic conversation with the conversation's fill characteristic set to CM_FILL_LL.</p>
<p class=indent1>
A buffer of data received independent of its logical-record format in a basic conversation with the fill characteristic set to CM_FILL_BUFFER.</p>
<p>
When a complete unit of data has been received, the local program can manipulate it.
</li>
<li>
The local program determines the next action to take based on the control information received through <i>status_received</i>. The local program may have to reissue <b>Receive</b> to receive the control information.</li>
</ul>
<p>
The conversation type is set by <a href="cpic03_38v7.htm"><b>Set_Conversation_Type</b></a>; the fill characteristic is set by <a href="cpic03_12qr.htm"><b>Set_Fill</b></a>.</p>
<p>
The following table summarizes the state changes that can occur when <b>Receive</b> is issued with the conversation in RECEIVE state and <i>return_code</i> is cm_ok.</p>
<table cellspacing=4 cols=3>
<tr valign=top>
<th align=left width=39%><i>data_received</i></th>
<th align=left width=43%><i>status_received</i></th>
<th align=left width=18%>New state</th>
</tr>
<tr valign=top>
<td width=39%>CM_DATA_RECEIVED</td>
<td width=43%>CM_NO_STATUS_RECEIVED</td>
<td width=18%>No change</td>
</tr>
<tr valign=top>
<td width=39%>CM_COMPLETE_DATA_<br>
RECEIVED</td>
<td width=43%>CM_NO_STATUS_RECEIVED</td>
<td width=18%>No change</td>
</tr>
<tr valign=top>
<td width=39%>CM_INCOMPLETE_DATA_<br>
RECEIVED</td>
<td width=43%>CM_SEND_RECEIVED</td>
<td width=18%>SEND_PENDING</td>
</tr>
<tr valign=top>
<td width=39%>CM_NO_DATA_RECEIVED</td>
<td width=43%>CM_SEND_RECEIVED</td>
<td width=18%>SEND</td>
</tr>
</table><br>
<p>
If <i>return_code</i> is set to cm_unsuccessful, meaning that the <i>receive_type</i> is set to CM_RECEIVE_IMMEDIATE and no data is available, there is no state change.</p>
<p>
The following table summarizes the state changes that can occur when <b>Receive</b> is issued with the conversation in send state and <i>return_code</i> is cm_ok.</p>
<table cellspacing=4 cols=3>
<tr valign=top>
<th align=left width=40%><i>data_received</i></th>
<th align=left width=41%><i>status_received</i></th>
<th align=left width=19%>New state</th>
</tr>
<tr valign=top>
<td width=40%>CM_DATA_RECEIVED</td>
<td width=41%>CM_NO_STATUS_RECEIVED</td>
<td width=19%>RECEIVE</td>
</tr>
<tr valign=top>
<td width=40%>CM_COMPLETE_DATA_<br>
RECEIVED</td>
<td width=41%>CM_NO_STATUS_RECEIVED</td>
<td width=19%>RECEIVE</td>
</tr>
<tr valign=top>
<td width=40%>CM_INCOMPLETE_DATA_<br>
RECEIVED</td>
<td width=41%>CM_SEND_RECEIVED</td>
<td width=19%>SEND_PENDING</td>
</tr>
<tr valign=top>
<td width=40%>CM_NO_DATA_RECEIVED</td>
<td width=41%>CM_SEND_RECEIVED</td>
<td width=19%>No change</td>
</tr>
</table><br>
<p>
The following table summarizes the state changes that can occur when <b>Receive</b> is issued with the conversation in SEND_PENDING state and <i>return_code</i> is cm_ok.</p>
<table cellspacing=4 cols=3>
<tr valign=top>
<th align=left width=40%><i>data_received</i></th>
<th align=left width=41%><i>status_received</i></th>
<th align=left width=19%>New state</th>
</tr>
<tr valign=top>
<td width=40%>CM_DATA_RECEIVED</td>
<td width=41%>CM_NO_STATUS_RECEIVED</td>
<td width=19%>RECEIVE</td>
</tr>
<tr valign=top>
<td width=40%>CM_COMPLETE_DATA_<br>
RECEIVED</td>
<td width=41%>CM_NO_STATUS_RECEIVED</td>
<td width=19%>RECEIVE</td>
</tr>
<tr valign=top>
<td width=40%>CM_INCOMPLETE_DATA_<br>
RECEIVED</td>
<td width=41%>CM_SEND_RECEIVED</td>
<td width=19%>No change</td>
</tr>
<tr valign=top>
<td width=40%>CM_NO_DATA_RECEIVED</td>
<td width=41%>CM_SEND_RECEIVED</td>
<td width=19%>SEND</td>
</tr>
</table><br>
<p>
The following topics summarize state changes that can occur when <b>Receive</b> is issued in any allowed state.</p>
<p>&nbsp;</p></body>
</HTML>
