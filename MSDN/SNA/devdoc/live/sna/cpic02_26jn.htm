<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Changing Conversation States</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_sna_changing_conversation_states_cpic"></a>Changing Conversation States</h3>
<p>
A change in the conversation state can result from:
<ul>
<li>
A call made by the local TP.</li>
<li>
A call made by the partner TP.</li>
<li>
An error condition.</li>
</ul>
<p>
The following example shows how CPI-C calls can change the state of the conversation from SEND to RECEIVE and from RECEIVE to SEND.</p>
<p>
<b>Note</b>&nbsp;&nbsp;Any TP can send or receive data, regardless of whether it is the invoking TP (the TP that started the conversation) or the invokable TP (the TP that responded to a request to start a conversation).</p>
<p>
This example shows how CPI-C calls can change the conversation state. In this table, each conversation state appears in bold and precedes the CPI-C calls that are used while in that state.</p>
<table cellspacing=4 cols=3>
<tr valign=top>
<th align=left colspan=2 width=50%>Issued by the invoking TP</th>
<th align=left width=50%>Issued by the invokable TP</th>
</tr>
<tr valign=top>
<td colspan=2 width=50%><b>Conversation state: RESET</b></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td colspan=2 width=50%><code>Initialize_Conversation</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td colspan=2 width=50%><b>Conversation state: INITIALIZE</b></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td colspan=2 width=50%><code>Set_Sync_Level</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td colspan=2 width=50%><code>  (sync_level=CM_CONFIRM)</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td colspan=2 width=50%><code>Allocate</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td colspan=2 width=50%><b>Conversation state: SEND</b></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td colspan=2 width=50%><code>Send_Data</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td colspan=2 width=50%><code>Prepare_to_Receive</code></td>
<td width=50%><b>Conversation state: RESET</b></td>
</tr>
<tr valign=top>
<td colspan=2 width=50%></td>
<td width=50%><code>Accept_Conversation</code></td>
</tr>
<tr valign=top>
<td colspan=2 width=50%></td>
<td width=50%><b>Conversation state: RECEIVE</b></td>
</tr>
<tr valign=top>
<td colspan=2 width=50%></td>
<td width=50%><pre><code>(status_received= 
   CM_CONFIRM_SEND_RECEIVED)</code></pre>
</td>
</tr>
<tr valign=top>
<td colspan=2 width=50%></td>
<td width=50%><b>Conversation state: CONFIRM_SEND</b></td>
</tr>
<tr valign=top>
<td colspan=2 width=50%></td>
<td width=50%><pre><code>Confirm</code></pre>
</td>
</tr>
<tr valign=top>
<td colspan=2 width=50%></td>
<td width=50%><b>Conversation state: SEND</b></td>
</tr>
<tr valign=top>
<td colspan=2 width=50%><code>  (return_code=CM_OK)</code></td>
<td width=50%><pre><code>Send_Data</code></pre>
</td>
</tr>
<tr valign=top>
<td colspan=2 width=50%><b>Conversation state: RECEIVE</b></td>
<td width=50%><pre><code>Confirm</code></pre>
</td>
</tr>
<tr valign=top>
<td colspan=2 width=50%><code>  (status_received=<br>
   CM_CONFIRM_RECEIVED)</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td colspan=2 width=50%><b>Conversation state: CONFIRM</b></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td colspan=2 width=50%><code>Request_To_Send</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td colspan=2 width=50%><code>Confirmed</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td colspan=2 width=50%><b>Conversation state: RECEIVE</b></td>
<td width=50%><code>  (return_code=CM_OK)</code></td>
</tr>
<tr valign=top>
<td colspan=2 width=50%></td>
<td width=50%><pre><code>(request_to_send_received=
   CM_REQ_TO_SEND_RECEIVED)</code></pre>
</td>
</tr>
<tr valign=top>
<td colspan=2 width=50%></td>
<td width=50%><pre><code>Prepare_To_Receive</code></pre>
</td>
</tr>
<tr valign=top>
<td colspan=2 width=50%><code>Receive</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td colspan=2 width=50%><code>  (status_received= <br>
   CM_CONFIRM_SEND_RECEIVED)</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td colspan=2 width=50%><b>Conversation state: CONFIRM_SEND</b></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td colspan=2 width=50%><code>Confirmed</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=48%><b>Conversation state: SEND</b></td>
<td colspan=2 width=52%><code>  (return_code=CM_OK)</code></td>
</tr>
<tr valign=top>
<td width=48%></td>
<td colspan=2 width=52%><b>Conversation state: RECEIVE</b></td>
</tr>
<tr valign=top>
<td width=48%><code>Send_Data</code></td>
<td colspan=2 width=52%></td>
</tr>
<tr valign=top>
<td width=48%><code>Deallocate</code></td>
<td colspan=2 width=52%></td>
</tr>
<tr valign=top>
<td width=48%></td>
<td colspan=2 width=52%>Receive</td>
</tr>
<tr valign=top>
<td width=48%></td>
<td colspan=2 width=52%>  (status_received=<br>
   CM_CONFIRM_DEALLOC_RECEIVED)</td>
</tr>
<tr valign=top>
<td width=48%></td>
<td colspan=2 width=52%><b>Conversation state: <br>
CONFIRM_DEALLOCATE</b></td>
</tr>
<tr valign=top>
<td width=48%></td>
<td colspan=2 width=52%>Confirmed</td>
</tr>
<tr valign=top>
<td width=48%><code>  (return_code=CM_OK)</code></td>
<td colspan=2 width=52%><b>Conversation state: RESET</b></td>
</tr>
<tr valign=top>
<td width=48%><b>Conversation state: RESET</b></td>
<td colspan=2 width=52%></td>
</tr>
</table><br>
<h4>Initial States</h4>
<p>
Before the conversation is allocated, the state is RESET for both TPs.</p>
<p>
In the example, after the conversation is allocated, the initial state is SEND for the invoking TP and RECEIVE for the invokable TP.</p>
<h4>Changing to RECEIVE State</h4>
<p>
The <a href="cpic03_0ihv.htm"><b>Prepare_To_Receive</b></a> call allows a TP to change the conversation from SEND to RECEIVE state. This call:
<ul>
<li>
Flushes the local LU's send buffer.</li>
<li>
Sends a CM_CONFIRM_SEND indicator to the partner TP through the <i>status_received</i> parameter of a <a href="cpic03_3vhf.htm"><b>Receive</b></a> call, because the synchronization level is set to CM_CONFIRM. This indicator tells the partner TP that a <a href="cpic03_6c6b.htm"><b>Confirmed</b></a> response is expected before the partner TP can begin to send data.</li>
</ul>
<h4>Changing to SEND State</h4>
<p>
The <a href="cpic03_6crn.htm"><b>Request_To_Send</b></a> call informs the partner TP (for which the conversation is in SEND state) that the local TP (for which the conversation is in RECEIVE state) wants to send data. This request is communicated to the partner TP through the <i>request_to_send_received</i> parameter of the <a href="cpic03_5q8z.htm"><b>Confirm</b></a> call. (The <i>request_to_send_received </i>parameter is also returned to <a href="cpic03_94ir.htm"><b>Send_Data</b></a> and other calls.)</p>
<p>
When the partner TP issues the <a href="cpic03_0ihv.htm"><b>Prepare_To_Receive</b></a> call, the conversation state changes to RECEIVE for the partner TP, making it possible for the local TP to send data.</p>
<p>
<b>Important</b>&nbsp;&nbsp;Issuing <a href="cpic03_6crn.htm"><b>Request_To_Send</b></a> does not change the state of the conversation. Upon receiving a request to send, the partner TP is not required to change the conversation state; it can ignore the request.</p>
<p>&nbsp;</p></body>
</HTML>
