<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Negotiable Link Roles</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_sna_negotiable_link_roles_dev"></a>Negotiable Link Roles</h3>
<p>
The following figure shows the sequence of messages for a peer connection where both the local and remote ends are configured as negotiable. Since the remote node identifier is larger (numerically) than the local node identifier, the remote station will become primary.</p>
<p>
<img src="images/dev3e.gif" border=0></p>
<table cellspacing=4 cols=2>
<tr valign=top>
<td width=35%>local node identifier</td>
<td width=65%>= 0x05D11111</td>
</tr>
<tr valign=top>
<td width=35%>remote node identifier</td>
<td width=65%>= 0x05D22222</td>
</tr>
</table><br>
<p>
In summary, here are the rules that the SNALink must follow when supporting XID exchange, and in particular XID role negotiation:
<ul>
<li>
If an XID is supplied in the <a href="devc04_4qeu.htm"><b>Open(LINK) Request</b></a>, it must be transmitted as soon as the end-to-end connection is established for primary or negotiable links.</li>
<li>
All XIDs received from the remote station must be passed to the local node in a <a href="devc04_977a.htm"><b>Request-Open-Station</b></a> message.</li>
<li>
An XID received from the local node in a <a href="devc04_5ovq.htm"><b>Send-XID</b></a> message must be transmitted immediately.</li>
<li>
XID transmissions must be retried until an XID is received from the remote station. For half-duplex links, the retry time-out should be randomized to prevent repeated XID clashes.</li>
<li>
When a mode-setting command (SNRM, QSM, SABME) is received before the station has been opened, a <b>Request-Open-Station</b> must be sent to the local node with the Rcv-Set-Mode flag on.</li>
<li>
When the local node sends an <a href="devc04_3ut2.htm"><b>Open(STATION)</b></a> message, the link should examine it to determine its link role (that is, primary or secondary).</li>
<li>
A secondary station should send a <a href="devc04_8vcm.htm"><b>Station-Contacted</b></a> message after receiving and responding to the <b>Open(STATION)</b> message.</li>
<li>
For a primary station, the mode-setting command should be sent when the <b>Open(STATION)</b> message is received. The <b>Station-Contacted</b> message should be sent to the local node when this command has been acknowledged by the secondary station (for instance, a UA received on an SDLC link).</li>
</ul>
<p>
If the local node detects an error during role negotiation, such as both PUs configured as primary, it sends out an XID containing an error vector. The vector is appended to the end of the normal XID data. The vector number specified is 0x22, and the vector data specifies that the DLC role field is in error. Refer to the <i>SNA Formats</i> Help file for details of the XID formats and error vectors.</p>
<p>
After sending the error XID, the local node sends a <b>Close(LINK)</b> message to terminate the connection (see <a href="devc03_9bqu.htm">Closing a Connection</a>).</p>
<p>
The following figure is a matrix of the possible combinations of station link roles and shows the eventual role of the local station.</p>
<table cellspacing=4 cols=5>
<tr valign=top>
<th align=left width=18%></th>
<td width=20%></td>
<td colspan=3 width=62%><b>Local Station</b></td>
</tr>
<tr valign=top>
<td width=18%></td>
<td width=20%></td>
<td width=19%><b>Primary</b></td>
<td width=20%><b>Secondary</b></td>
<td width=23%><b>Negotiable</b></td>
</tr>
<tr valign=top>
<td width=18%><b>Remote</b></td>
<td width=20%><b>Primary</b></td>
<td width=19%>Fail</td>
<td width=20%>Secondary</td>
<td width=23%>Secondary</td>
</tr>
<tr valign=top>
<td width=18%><b>Station</b></td>
<td width=20%><b>Secondary</b></td>
<td width=19%>Primary</td>
<td width=20%>Fail</td>
<td width=23%>Primary</td>
</tr>
<tr valign=top>
<td width=18%></td>
<td width=20%><b>Negotiable</b></td>
<td width=19%>Primary</td>
<td width=20%>Secondary</td>
<td width=23%>Either*</td>
</tr>
</table><br>
<p>
*The station with the higher node identifier becomes the primary.</p>
<p>&nbsp;</p></body>
</HTML>
