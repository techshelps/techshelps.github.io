<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>TEST_RTS_AND_POST</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_sna_test_rts_and_post_appc"></a>TEST_RTS_AND_POST</h1>
<p>
The <b>TEST_RTS_AND_POST</b> verb allows an application, typically a 5250 emulator, to request asynchronous notification when a partner TP requests send direction. It is not supported on Microsoft® MS-DOS® platforms.</p>
<p>
The following structure describes the verb control block used by the <b>TEST_RTS_AND_POST</b> verb.</p>
<pre><code>struct test_rts {
    unsigned short      opcode;
    unsigned char       opext;
    unsigned char       reserv2;
    unsigned short      primary_rc;
    unsigned long       secondary_rc;
    unsigned char       tp_id[8];
    unsigned long       conv_id;
    unsigned char       reserv3;
    unsigned long       handle;
};
</code></pre>
<h4>Members</h4>
<dl>
<dt>
<b>opcode</b></dt>
<dd>
Supplied parameter. Specifies the verb operation code, AP_B_TEST_RTS_AND_POST.</dd>
<dt>
<b>opext</b></dt>
<dd>
Supplied parameter. Specifies the verb operation extension, AP_BASIC_CONVERSATION.</dd>
<dt>
<b>primary_rc</b></dt>
<dd>
Returned parameter. Specifies the primary return code set by APPC at the completion of the verb. The valid return codes vary depending on the APPC verb issued. See Return Codes for valid error codes for this verb.</dd>
<dt>
<b>secondary_rc</b></dt>
<dd>
Returned parameter. Specifies the secondary return code set by APPC at the completion of the verb. The valid return codes vary depending on the APPC verb issued. See Return Codes for valid error codes for this verb.</dd>
<dt>
<b>tp_id</b></dt>
<dd>
Supplied parameter. Identifies the local TP. The value of this parameter was returned by <a href="appc04_0fs3.htm"><b>TP_STARTED</b></a> in the invoking TP or by <a href="appc05b_0m77.htm"><b>RECEIVE_ALLOCATE</b></a> in the invoked TP.</dd>
<dt>
<b>conv_id</b></dt>
<dd>
Supplied parameter. Provides the conversation identifier. The value of this parameter was returned by <a href="appc05a_1ckj.htm"><b>ALLOCATE</b></a> in the invoking TP or by <b>RECEIVE_ALLOCATE</b> in the invoked TP.</dd>
<dt>
<b>handle</b></dt>
<dd>
Supplied parameter. On Microsoft® Windows NT® and Microsoft® Windows® 95 this field provides the event handle to set. On Windows 3.x, this field provides the Windows handle to receive the completion message. On OS/2, this field provides the address of the semaphore APPC is to clear when the asynchronous operation is finished.
</dd>
</dl>
<h4>Return Codes from Initial Verb</h4>
<dl>
<dt>
ap_ok</dt>
<dd>
Primary return code; the verb executed successfully. Note particularly that a return code of AP_OK from the initial verb does not indicate that <b>REQUEST_TO_SEND</b> verb received from the partner TP. It simply indicates that the facility to receive asynchronous notification has been registered.</dd>
<dt>
ap_unsuccessful</dt>
<dd>
Primary return code; request-to-send notification has not been received.</dd>
<dt>
ap_parameter_check</dt>
<dd>
Primary return code; the verb did not execute because of a parameter error.
<dl>
<dt>
ap_bad_conv_id</dt>
<dd>
Secondary return code; the value of <b>conv_id</b> did not match a conversation identifier assigned by APPC.</dd>
<dt>
AP_BAD_TP_ID</dt>
<dd>
Secondary return code; the value of <b>tp_id</b> did not match a TP identifier assigned by APPC.</dd>
<dt>
AP_INVALID_SEMAPHORE_HANDLE</dt>
<dd>
Secondary return code, the value of <b>handle</b> was invalid.
</dd>
</dl>
</dd>
<dt>
ap_comm_subsystem_abended</dt>
<dd>
Primary return code; indicates one of the following conditions:
<ul>
<li>
The node used by this conversation encountered an ABEND.</li>
<li>
The connection between the TP and the PU 2.1 node has been broken (a LAN error).</li>
<li>
The SnaBase at the TP's computer encountered an ABEND.</li>
</ul>

<p>
The system administrator should examine the error log to determine the reason for the ABEND.
</dd>
<dt>
ap_comm_subsystem_not_loaded</dt>
<dd>
Primary return code; a required component could not be loaded or has terminated while processing the verb. Thus, communication could not take place. Contact the system administrator for corrective action.
<p>
When this return code is used with <b>ALLOCATE</b>, it may indicate that no communications subsystem could be found to support the local LU. (For example, the local LU alias specified with <b>TP_STARTED</b> is incorrect or has not been configured.) Note that if <b>lu_alias</b> or <b>mode_name</b> is fewer than eight characters, you must ensure that these fields are filled with spaces to the right. This error is returned if these parameters are not filled with spaces, since there is no node available that can satisfy the <b>ALLOCATE</b> request.

<p>
When <b>ALLOCATE</b> produces this return code for a Microsoft® SNA Server Client system configured with multiple nodes, there are two secondary return codes as follows:

<dl>
<dt>
0x<small>f0000001</small></dt>
<dd>
Secondary return code; no nodes have been started.</dd>
<dt>
0x<small>f0000002</small></dt>
<dd>
Secondary return code; at least one node has been started, but the local LU (when <b>TP_STARTED</b> is issued) is not configured on any active nodes. The problem could be either of the following:
<table cellspacing=4 cols=1>
<tr valign=top>
<td width=100%><font face="Symbol">·</font>&nbsp;&nbsp;&nbsp;&nbsp;The node with the local LU is not started.</td>
</tr>
<tr valign=top>
<td width=100%><font face="Symbol">·</font>&nbsp;&nbsp;&nbsp;&nbsp;The local LU is not configured.</td>
</tr>
</table><br>

</dd>
</dl>
</dd>
<dt>
ap_conversation_type_mixed</dt>
<dd>
Primary return code; the TP has issued both basic and mapped conversation verbs. Only one type can be issued in a single conversation.</dd>
<dt>
ap_invalid_verb_segment</dt>
<dd>
Primary return code; the VCB extended beyond the end of the data segment.</dd>
<dt>
ap_stack_too_small</dt>
<dd>
Primary return code; the stack size of the application is too small to execute the verb. Increase the stack size of your application.</dd>
<dt>
ap_conv_busy</dt>
<dd>
Primary return code; there can only be one outstanding conversation verb at a time on any conversation. This can occur if the local TP has multiple threads, and more than one thread is issuing APPC calls using the same <b>conv_id</b>.</dd>
<dt>
ap_thread_blocking</dt>
<dd>
Primary return code; the calling thread is already in a blocking call.</dd>
<dt>
ap_unexpected_dos_error</dt>
<dd>
Primary return code; the operating system has returned an error to APPC while processing an APPC call from the local TP. The operating system return code is returned through the <b>secondary_rc</b>. It appears in Intel byte-swapped order. If the problem persists, consult the system administrator.
</dd>
</dl>
<h4>Return Codes from Asynchronous Completion</h4>
<dl>
<dt>
ap_ok</dt>
<dd>
Primary return code; the request-to-send notification has been received from the partner TP.</dd>
<dt>
AP_CANCELLED</dt>
<dd>
The outstanding <b>TEST_RTS_AND_POST</b> verb has been terminated. This will occur if the underlying conversation has been deallocated or an AP_TP_ENDED has been issued.<br>
Note that as with <b>RECEIVE_AND_POST</b>, the TP is still responsible for correctly terminating the conversation and possibly terminating the TP. Issuing another verb, such as <b>RECEIVE_IMMEDIATE, </b>at this point will indicate the reason for the conversation failure.
</dd>
</dl>
<h4>Remarks</h4>
<p>
The conversation can be in any state except RESET when the TP issues this verb. There is no state change.</p>
<p>
A common feature of many APPC applications, such as 5250 emulators, is a requirement to detect a partner's request to send. Currently, this can be done by polling the APPC interface to detect the partner's request. For example, an application can occasionally issue one of the following verbs:
<ul>
<li>
<b>TEST_RTS</b></li>
<li>
<b>RECEIVE_IMMEDIATE</b> and check the <b>rts_rcvd</b> field</li>
<li>
<b>SEND_DATA</b> of zero bytes, again checking the <b>rts_rcvd</b> field.</li>
</ul>
<p>
Some of the problems associated with this polling approach are:
<ul>
<li>
The application must continually interrupt its main work to poll APPC.</li>
<li>
The partner's request is not detected as soon as it becomes available.</li>
<li>
These approaches are processor-intensive.</li>
</ul>
<p>
The <b>TEST_RTS_AND_POST</b> verb allows an application running on Windows NT, Windows 95, Windows 3.<i>x</i>, or OS/2, typically a 5250 emulator, to request asynchronous notification when the partner TP requests send direction.</p>
<p>
An APPC application typically issues the <b>TEST_RTS_AND_POST</b> verb while in SEND state and then continues with its main processing. A request for send direction from the partner TP is indicated asynchronously to the application. After dealing with the partner's request, the application typically returns to SEND state, reissues <b>TEST_RTS_AND_POST</b>, and continues.</p>
<p>
The <b>TEST_RTS_AND_POST</b> verb completes synchronously and the return code AP_OK indicates that a request for asynchronous notification has been registered. It is important to emphasize that this does not indicate that request-to-send was received from the partner TP.</p>
<p>
When the partner's request to send is received, the asynchronous event completion occurs. It is important to note that this may be before the completion of the local TP's original <b>TEST_RTS_AND_POST</b> verb. This will be the case if the partner's request to send was received before the local TP's <b>TEST_RTS_AND_POST</b> verb was issued, or while the local TP's <b>TEST_RTS_AND_POST</b> verb was being processed.</p>
<p>
</p>
<p>&nbsp;</p></body>
</HTML>
