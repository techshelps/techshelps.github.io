<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>RECEIVE_ALLOCATE</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_sna_receive_allocate_appc"></a>RECEIVE_ALLOCATE</h1>
<p>
The <b>RECEIVE_ALLOCATE</b> verb is issued by the invoked TP to confirm that the invoked TP is ready to begin a conversation with the invoking TP that issued <a href="appc05a_1ckj.htm"><b>ALLOCATE</b></a> or <a href="appc05a_38f7.htm"><b>MC_ALLOCATE</b></a>.</p>
<p>
For the Microsoft® Windows® version 3<i>.x</i> system, it is recommended that you use <a href="appc06_66sj.htm"><b>WinAsyncAPPC</b></a> rather than the blocking version of this call.</p>
<p>
The following structure describes the verb control block used by the <b>RECEIVE_ALLOCATE</b> verb.</p>
<pre><code>struct receive_allocate {
    unsigned short   opcode;
    unsigned char    opext;
    unsigned char    reserv2;
    unsigned short   primary_rc;
    unsigned long    secondary_rc;
    unsigned char    tp_name[64];
    unsigned char    tp_id[8];
    unsigned long    conv_id;
    unsigned char    sync_level;
    unsigned char    conv_type;
    unsigned char    user_id[10];
    unsigned char    lu_alias[8];
    unsigned char    plu_alias[8];
    unsigned char    mode_name[8];
    unsigned char    reserv3[2];
    unsigned long    conv_group_id;
    unsigned char    fqplu_name[17];
    unsigned char    pip_incoming;
    unsigned char    syncpoint_rqd;
    unsigned char    reserv4[3];
}; 
 </code></pre>
<h4>Members</h4>
<dl>
<dt>
<b>opcode</b></dt>
<dd>
Supplied parameter. Specifies the verb operation code, AP_RECEIVE_ALLOCATE.</dd>
<dt>
<b>opext</b></dt>
<dd>
Supplied parameter. Specifies the verb operation extension. If the AP_EXTD_VCB bit is set, this indicates that the <b>receive_allocate</b> structure includes the <b>syncpoint_rqd</b> member used for Sync Point support. Otherwise the verb control block ends immediately after the <b>fqplu_name</b> member.</dd>
<dt>
<b>primary_rc</b></dt>
<dd>
Returned parameter. Specifies the primary return code set by APPC at the completion of the verb. The valid return codes vary depending on the APPC verb issued. See Return Codes for valid error codes for this verb.</dd>
<dt>
<b>secondary_rc</b></dt>
<dd>
Returned parameter. Specifies the secondary return code set by APPC at the completion of the verb. The valid return codes vary depending on the APPC verb issued. See Return Codes for valid error codes for this verb.</dd>
<dt>
<b>tp_name</b></dt>
<dd>
Supplied parameter. Provides the name of the local TP. The value of <b>tp_name</b> must match the TP name configured through registry or environment variables. APPC matches the <b>RECEIVE_ALLOCATE</b> verb's <b>tp_name</b> parameter with the TP name specified by the incoming allocate, which is generated by <a href="appc05a_38f7.htm"><b>MC_ALLOCATE</b></a> or <a href="appc05a_1ckj.htm"><b>ALLOCATE</b></a> in the invoking TP.
<p>
This parameter is a 64-byte EBCDIC character string and is case-sensitive. The <b>tp_name</b> parameter can consist of characters from the type AE EBCDIC character set:

<ul>
<li>
Uppercase and lowercase letters</li>
<li>
Numerals 0 through 9</li>
<li>
Special characters $, #, and period (.)</li>
</ul>

<p>
If <b>tp_name</b> is fewer than 64 bytes, use EBCDIC spaces (0x40) to pad it on the right.

<p>
The SNA convention is that a service TP name can have up to four characters. The first character is a hexadecimal byte between 0x00 and 0x3F. The other characters are from the type AE EBCDIC character set.
</dd>
<dt>
<b>tp_id</b></dt>
<dd>
Returned parameter. Identifies the local TP.</dd>
<dt>
<b>conv_id</b></dt>
<dd>
Returned parameter. Provides the conversation identifier. It identifies the conversation APPC has established between the two partner TPs.</dd>
<dt>
<b>sync_level</b></dt>
<dd>
Returned parameter. Specifies the synchronization level of the conversation. It determines whether the TPs can request confirmation of receipt of data and confirm receipt of data.
<ul>
<li>
AP_NONE specifies that confirmation processing will not be used in this conversation.</li>
<li>
AP_CONFIRM_SYNC_LEVEL specifies that the TPs can use confirmation processing in this conversation. </li>
<li>
AP_SYNCPT specifies that TPs can use Sync Point Level 2 confirmation processing in this conversation. </li>
</ul>
</dd>
<dt>
<b>conv_type</b></dt>
<dd>
Returned parameter. Specifies the type of conversation chosen by the partner TP, using <a href="appc05a_38f7.htm"><b>MC_ALLOCATE</b></a> or <a href="appc05a_1ckj.htm"><b>ALLOCATE</b></a>. The following are possible values:
<p class=indent1>
AP_BASIC_CONVERSATION</p>

<p class=indent1>
AP_MAPPED_CONVERSATION</p>

</dd>
<dt>
<b>user_id</b></dt>
<dd>
Returned parameter. Provides the user identifier specified by the partner TP, using <b>MC_ALLOCATE</b> or <b>ALLOCATE</b> (if the partner TP set the <b>MC_ALLOCATE</b> or <b>ALLOCATE</b> verb's security parameter to AP_PGM or AP_SAME). It is a type AE EBCDIC character string.</dd>
<dt>
<b>lu_alias</b></dt>
<dd>
Returned parameter. Provides the alias by which the local LU is known to the local TP. It is an ASCII character string.</dd>
<dt>
<b>plu_alias</b></dt>
<dd>
Returned parameter. Provides the alias by which the partner LU (which initiated the incoming allocate) is known to the local TP. It is an ASCII character string.</dd>
<dt>
<b>mode_name</b></dt>
<dd>
Returned parameter. Provides the mode name specified by <b>MC_ALLOCATE</b> or <b>ALLOCATE</b> in the partner TP. It is the name of a set of networking characteristics defined during configuration. The <b>mode_name</b> is a type A EBCDIC character string.</dd>
<dt>
<b>conv_group_id</b></dt>
<dd>
Conversation group identifier.</dd>
<dt>
<b>fqplu_name</b></dt>
<dd>
This returned parameter provides the fully qualified LU name.</dd>
<dt>
<b>pip_incoming</b></dt>
<dd>
This optional supplied and returned parameter is only applicable if the AP_EXTD_VCB bit is set in the <b>opext</b> parameter and Sync Point services are required. 
<p>
For the supplied parameter:

<p class=indent1>
AP_YES if TP does accept PIP data.</p>

<p class=indent1>
AP_NO if TP does not accept PIP data.</p>

<p>
For the returned parameter:

<p class=indent1>
AP_YES if PIP data is not available.</p>

<p class=indent1>
AP_NO if PIP data is available.</p>
</dd>
<dt>
<b>syncpoint_rqd</b></dt>
<dd>
This optional parameter is only applicable if the AP_EXTD_VCB bit is set in the <b>opext</b> parameter and Sync Point services are required.
<p class=indent1>
AP_YES if Sync Point is required.</p>

<p class=indent1>
AP_NO if Sync Point is not required.</p>

</dd>
</dl>
<h4>Return Codes</h4>
<dl>
<dt>
ap_ok</dt>
<dd>
Primary return code; the verb executed successfully.</dd>
<dt>
ap_parameter_check</dt>
<dd>
Primary return code; the verb did not execute because of a parameter error.
<dl>
<dt>
ap_undefined_tp_name</dt>
<dd>
Secondary return code; the TP name was not configured correctly.
</dd>
</dl>
</dd>
<dt>
ap_state_check</dt>
<dd>
Primary return code; the verb did not execute because it was issued in an invalid state.
<dl>
<dt>
ap_allocate_not_pending</dt>
<dd>
Secondary return code; APPC did not find an incoming allocate (from the invoking TP) to match the value of <b>tp_name</b>, supplied by <b>RECEIVE_ALLOCATE</b>. <b>RECEIVE_ALLOCATE</b> waited for the incoming allocate and eventually timed out.</dd>
<dt>
ap_invalid_process</dt>
<dd>
Secondary return code; the process issuing <b>RECEIVE_ALLOCATE</b> was different from the one started by APPC.
</dd>
</dl>
</dd>
<dt>
ap_comm_subsystem_abended</dt>
<dd>
Primary return code; indicates one of the following conditions:
<ul>
<li>
The node used by this conversation encountered an ABEND.</li>
<li>
The connection between the TP and the PU 2.1 node has been broken (a LAN error).</li>
<li>
The SnaBase at the TP's computer encountered an ABEND.</li>
</ul>

<p>
The system administrator should examine the error log to determine the reason for the ABEND.
</dd>
<dt>
ap_conv_busy</dt>
<dd>
Primary return code; there can only be one outstanding conversation verb at a time on any conversation.</dd>
<dt>
ap_thread_blocking</dt>
<dd>
Primary return code; the calling thread is already in a blocking call.</dd>
<dt>
ap_comm_subsystem_not_loaded</dt>
<dd>
Primary return code; a required component could not be loaded or terminated while processing the verb. Thus, communication could not take place. Contact the system administrator for corrective action.</dd>
<dt>
ap_invalid_verb_segment</dt>
<dd>
Primary return code; the VCB extended beyond the end of the data segment.</dd>
<dt>
ap_stack_too_small</dt>
<dd>
Primary return code; the stack size of the application is too small to execute the verb. Increase the stack size of your application.</dd>
<dt>
ap_unexpected_dos_error</dt>
<dd>
Primary return code; the operating system has returned an error to APPC while processing an APPC call from the local TP. The operating system return code is returned through the <b>secondary_rc</b>. It appears in Intel byte-swapped order. If the problem persists, consult the system administrator.
</dd>
</dl>
<h4>Remarks</h4>
<p>
This must be the first APPC verb issued by the invoked TP. The initial state is RESET. If the verb executes successfully (<b>primary_rc</b> is ap_ok), the state changes to RECEIVE.</p>
<p>
In response to this verb, APPC establishes a conversation between the two TPs and generates a TP identifier for the invoked TP and a conversation identifier. These identifiers are required parameters for subsequent APPC verbs.</p>
<p>
If the invoked TP issues <b>RECEIVE_ALLOCATE</b> and a corresponding incoming allocate (resulting from <a href="appc05a_38f7.htm"><b>MC_ALLOCATE</b></a> or <a href="appc05a_1ckj.htm"><b>ALLOCATE</b></a> issued by the invoking TP) is not present, the invoked TP waits until the incoming allocate arrives or the verb times out. The time-out value is set by the system administrator.</p>
<p>&nbsp;</p></body>
</HTML>
