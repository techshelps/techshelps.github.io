<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Closing the PLU Connection</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_sna_closing_the_plu_connection_3270"></a>Closing the PLU Connection</h2>
<p>
Either the application or the local node can terminate the PLU connection. The criteria for closing are:
<ul>
<li>
The local node closes the PLU connection if it receives an UNBIND request from the host PLU, which terminates the PLU session. If the UNBIND type is "BIND forthcoming" (0x02), the local node sets the BIND-forthcoming indicator in the <a href="3270c4_31tc.htm"><b>Close(PLU) Request</b></a>, so that the application can reserve any necessary resources.</li>
<li>
The local node closes the PLU connection if it receives a DACTLU or DACTPU request from the SSCP.</li>
<li>
The local node closes the PLU connection if it receives an outage notification from data link control.</li>
<li>
The local node closes the PLU connection if it detects a critical error in a message from the application, putting the application in a "critically failed" state. In this case the local node sends a TERM-SELF request to the host to elicit an UNBIND.</li>
<li>
The application should close the PLU connection for logical power-off conditions—for example, if its resources are temporarily unavailable, or when the user finishes using the session.</li>
</ul>
<p>
When the local node issues a <a href="3270c4_31tc.htm"><b>Close(PLU) Request</b></a>, the application can determine the reason from the Close control field. There may be an associated Status message on either the PLU connection (a <a href="3270c4_7wxc.htm"><b>Status-Acknowledge(Nack-2)</b></a>) or the SSCP connection (a <a href="3270c4_7v8w.htm"><b>Status-Session</b></a> message if the LU has been deactivated).</p>
<p>
Whether the local node or the application closes the connection, the message is the same. The initiator of the Close sequence sends a <b>Close(PLU) Request</b> to its partner, which responds with a <b>Close(PLU) Response</b>. The <b>Close(PLU) Request</b> is unconditional—the <b>Close(PLU) Response</b> always reports that the connection was successfully closed.</p>
<p>
The <b>Close(PLU) Response</b> is provided so that the initiator of the Close sequence can determine when outstanding data and status messages have been delivered. To avoid possible race conditions, the application should discard all messages it receives on the PLU connection after issuing a <b>Close(PLU) Request</b>, including any <b>Close(PLU) Request</b> messages from the local node, until it receives the <b>Close(PLU) Response</b>.</p>
<p>
Note that, if the application sends a <a href="3270c4_9re8.htm"><b>Close(SSCP) Request</b></a> while the PLU session is active, the local node will close the PLU connection (as if <b>Close(PLU) Request</b> had been sent) as well as the SSCP connection.</p>
<p>
The message sequence for an application-initiated Close is shown in the following figure. The local node sends a TERM-SELF request to the host to elicit an UNBIND.</p>
<p>
If the host generates an UNBIND automatically on receipt of a TERM-SELF, the application can view <b>Close(PLU)</b> as equivalent to the termination of the PLU-SLU session.</p>
<p>
<img src="images/32703h.gif" border=0></p>
<p>
The message flow for a local node-initiated Close after receiving an UNBIND request from the host is shown in the following figure.</p>
<p>
<img src="images/32703ha.gif" border=0></p>
<p>
When an application is using the LUA variant of the FMI, issuing a <a href="3270c4_31tc.htm"><b>Close(PLU) Request</b></a> causes the node to immediately unbind the PLU session by sending an UNBIND request to the PLU. The <b>Close(PLU) Response</b> is returned to the application on receipt of the UNBIND response, as shown in the following figure.</p>
<p>
<img src="images/32703hb.gif" border=0></p>
<p>&nbsp;</p></body>
</HTML>
