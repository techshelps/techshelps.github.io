<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Matching Invoking and Invokable TPs</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_sna_matching_invoking_and_invokable_tps_cpic"></a>Matching Invoking and Invokable TPs</h2>
<p>
Each SNA server maintains a list of available invokable TP names and any LU aliases to be associated with the TP names. This information is obtained as follows:
<ul>
<li>
For autostarted invokable TPs, registry or environment variables identify a TP name containing a maximum of eight characters, and can specify an associated LU. This information is sent from the client to the server that sponsors the client. A client learns about the domain through a sponsor connection to a server; clients must establish the sponsor connection before proceeding with any other tasks.</li>
<li>
For operator-started invokable TPs, a TP name (with a maximum of 64 characters) is specified in <a href="cpic03_68wz.htm"><b>Specify_Local_TP_Name</b></a> (or, for OS/2 only, by setting <b>APPCTPN=</b><i>TPname</i>). The TP name is truncated to eight characters and sent from the client to the server that sponsors the client, along with the alias of an associated LU if one has been configured through a registry or environment variable.</li>
</ul>
<p>
<b>Note</b>&nbsp;&nbsp;If you want a TP name to be unique, it is recommended that you limit the name to eight characters or fewer, or make the name unique within the first eight characters. This is because the preliminary routing of allocation requests is carried out using the first eight characters. Although further matching is later carried out between the full TP names, it is inefficient to allow the preliminary routing to succeed when in some cases the later matching will fail.</p>
<p>
The next step in the matching of invoking and invokable TPs is the creation of a side information table from the parameters in the symbolic destination name. Then the invoking TP issues the <a href="cpic03_2krn.htm"><b>Allocate</b></a> call, and an allocation request flows to the partner LU specified in the side information table, stating the name of the invokable TP that has been requested (also listed in the side information table).</p>
<p>
When an allocation request arrives, the SNA server compares the requested invokable TP name and LU alias to the list of available invokable TPs (which can include associated LU aliases). The comparison can be modified by registry variables, but by default is carried out as follows:
<ul>
<li>
Although the TP name requested in the symbolic destination name can be as long as 64 characters, any name received through a registry or environment variable is eight characters or less. Therefore, only the first eight characters of TP names are used in comparisons.</li>
<li>
The comparison is carried out first on both the TP name and the LU alias. An invokable TP for which there is a match on both TP name and LU alias will be chosen ahead of a TP for which no LU alias has been configured through a registry or environment variable. A TP for which no LU alias has been configured can be matched with any request that specifies that TP name, since there cannot be a mismatch based on LU alias.</li>
<li>
The comparison of requested and available TP names is carried out in a specific order:<ol>
<li>
The SNA server first checks for operator-started invokable TPs on the local system (the SNA server itself).</li>
<li>
If no match is found, the SNA server checks for autostarted invokable TPs on the local system (the SNA server itself).</li>
<li>
If no match is found, the SNA server checks for operator-started invokable TPs on other SNA servers or clients.</li>
<li>
If no match is found, the SNA server checks for autostarted invokable TPs on other SNA servers or clients.</li>
</ol>
</li>
</ul>
<p>
This comparison can be modified somewhat by registry entries for the SnaServr service. The entries are called <b>DloadMatchTPOnly</b> and <b>DloadMatchLocalFirst</b>, and are described in the <i>Microsoft SNA Server Reference</i>.</p>
<p>
If a match is found, the SNA server signals the system containing the requested TP to connect to that SNA server. If no match is found, the SNA server rejects the incoming request.</p>
<p>
For suggestions about specific ways to handle TP names and LU aliases, see <a href="cpic02_46n7.htm">Arranging TPs Within an SNA Network</a>.</p>
<p>
<b>Note</b>&nbsp;&nbsp;Because of the way CPI-C works, an allocation request will not flow until local data buffers are full, or a <a href="cpic03_5q8z.htm"><b>Confirm</b></a> or <a href="cpic03_3vab.htm"><b>Flush</b></a> call is made. This may mean that the allocation request does not flow until some time after the <a href="cpic03_2krn.htm"><b>Allocate</b></a> call is made. Therefore, any allocation failure caused by the rejection of the allocation request at the partner LU will be observed as the failure of a later call with one of the allocation failure return codes.</p>
<p>&nbsp;</p></body>
</HTML>
