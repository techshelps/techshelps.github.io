<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>APPC Send and Receive TPs</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_sna_appc_send_and_receive_tps_appc"></a>APPC Send and Receive TPs</h1>
<p>
These are simple APPC send and receive TPs that illustrate the use of asynchronous verb completion. This sample implements simple bulk data sending and receiving TPs (SENDTP and RECVTP).</p>
<h4>Setup</h4>
<p>
To set up these TPs, create an appropriate APPC LU-LU-mode triplet. The default is SENDLU-RECVLU-#INTER, but this can be configured (see the following sections).</p>
<h4>Input and Output</h4>
<p>
The APPC send and receive TPs each use a configuration file for input. To name the file, use .CFG as the extension, and use the same base file name as the TP executable file (SENDTP.CFG, for example). Save this configuration file in the same directory location as the executable file (the TP itself).</p>
<p>
For SENDTP, the configuration file (called SENDTP.CFG if the executable file is SENDTP.EXE) can contain the following items, one per line, in any order. If a variable is not found in the file or the file is not present at all, the default is used.</p>
<table cellspacing=4 cols=3>
<tr valign=top>
<th align=left width=27%>Line</th>
<th align=left width=24%>Default value</th>
<th align=left width=49%>Value to supply</th>
</tr>
<tr valign=top>
<td width=27%><code>ResultFile =</code></td>
<td width=24%>C:\SENDTP.OUT</td>
<td width=49%>File name to print timings to</td>
</tr>
<tr valign=top>
<td width=27%><code>LocalLUAlias =</code></td>
<td width=24%>SENDLU</td>
<td width=49%>Local LU alias</td>
</tr>
<tr valign=top>
<td width=27%><code>RemoteLUAlias =</code></td>
<td width=24%>RECVLU</td>
<td width=49%>Remote LU alias</td>
</tr>
<tr valign=top>
<td width=27%><code>ModeName =</code></td>
<td width=24%>#INTER</td>
<td width=49%>Mode name</td>
</tr>
<tr valign=top>
<td width=27%><code>LocalTPName =</code></td>
<td width=24%>SENDTP</td>
<td width=49%>Name of local TP</td>
</tr>
<tr valign=top>
<td width=27%><code>RemoteTPName =</code></td>
<td width=24%>RECVTP</td>
<td width=49%>Name of remote TP</td>
</tr>
<tr valign=top>
<td width=27%><code>NumConversations =</code></td>
<td width=24%>1</td>
<td width=49%>Number of conversations</td>
</tr>
<tr valign=top>
<td width=27%><code>NumSends =</code></td>
<td width=24%>2</td>
<td width=49%>Number of <a href="appc05b_7wbn.htm"><b>SEND_DATA</b></a> verbs per conversation</td>
</tr>
<tr valign=top>
<td width=27%><code>SendSize =</code></td>
<td width=24%>1024</td>
<td width=49%>Size in bytes of data sent each time</td>
</tr>
<tr valign=top>
<td width=27%><code>ConfirmEvery =</code></td>
<td width=24%>1</td>
<td width=49%>Number of <b>SEND_DATA</b> verbs between <a href="appc05a_4i1v.htm"><b>CONFIRM</b></a> verbs</td>
</tr>
<tr valign=top>
<td width=27%><code>SendConversation =</code></td>
<td width=24%>No</td>
<td width=49%>Yes or No: Use the <a href="appc05b_16ub.htm"><b>SEND_CONVERSATION</b></a> verb rather than the sequence of <a href="appc05a_1ckj.htm"><b>ALLOCATE</b></a>, <b>SEND_DATA</b>, <a href="appc05a_4ndv.htm"><b>DEALLOCATE</b></a></td>
</tr>
</table><br>
<p>
RECVTP uses a RECVTP.CFG file in a similar way, but only to read the <b>LocalTPName</b> field.</p>
<p>
The output from SENDTP and RECVTP consists of details of the configuration and the time taken for each conversation, and is sent to the result file specified in SENDTP.CFG.</p>
<h4>Operation</h4>
<p>
RECVTP should be started first; it issues <a href="appc05b_0m77.htm"><b>RECEIVE_ALLOCATE</b></a> with the specified TP name. SENDTP is then started; it first issues <a href="appc05b_7qoz.htm"><b>MC_SEND_CONVERSATION</b></a> to tell RECVTP how many conversations will be carried out. It then carries out the specified number of conversations.</p>
<p>
For SENDTP, each conversation consists of an <a href="appc05a_38f7.htm"><b>MC_ALLOCATE</b></a> verb, followed by a given number of <a href="appc05b_8iub.htm"><b>MC_SEND_DATA</b></a> verbs of a given size, and interspersed with <a href="appc05a_0b8j.htm"><b>MC_CONFIRM</b></a> verbs at a given interval, followed by an <a href="appc05a_4okj.htm"><b>MC_DEALLOCATE</b></a>.</p>
<p>
RECVTP issues <a href="appc05a_5qlf.htm"><b>MC_RECEIVE_AND_WAIT</b></a> when <b>RECEIVE_ALLOCATE</b> completes, and then issues either <a href="appc05a_5qlf.htm"><b>MC_RECEIVE_AND_WAIT</b></a> or <a href="appc05a_5qhv.htm"><b>MC_CONFIRMED</b></a> according to the return from the previous <b>MC_RECEIVE_AND_WAIT</b>.</p>
<p>
At any stage, if the TPs encounter an error, they terminate. Use APPC API tracing to diagnose problems with the configuration.</p>
<p>
At the end of the specified number of conversations, SENDTP sends timing information to a file.</p>
<p>
Both TPs are built from a single source code file, SENDRECV.C. SENDTP is compiled only if <b>-DSENDTP</b> is used on the command line.</p>
<p>
The TPs run as Microsoft® Windows NT® or Microsoft® Windows® 95 applications with a minimized window, the title bar of which displays the status. When the WndProc of this window, TPWndProc, receives the WM_CREATE message for the window, this triggers the issuing of the first verb. When TPWndProc receives an ASYNC_COMPLETE message from Windows APPC, this triggers the issuing of the next verb, dependent on what the previous verb was. When the window is closed, <a href="appc06_57fn.htm"><b>WinAPPCCleanup</b></a> is issued to terminate any active conversations.</p>
<p>&nbsp;</p></body>
</HTML>
