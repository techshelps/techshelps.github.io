<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>DevIoctl Definitions to Support SNA Modem Status</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_sna_devioctl_definitions_to_support_sna_modem_status_dev"></a>DevIoctl Definitions to Support SNA Modem Status</h1>
<p>
The SNA DevIoctl interface is modified to update the <b>MODEM_STATUS</b> structure for a link each time a modem status change is detected or caused by a <b>GetV24</b> or <b>SetV24</b> IOCTL call. Code is manually added to the link service to track the number of frames received and transmitted.</p>
<p>
The DevIoctl changes are highlighted below:</p>
<pre><code>#define SETV24STATUS                                              \
         NtDeviceIoControlFile(seldrvrh,NULL,NULL,NULL,&amp;IoStatus, \
                               IoctlCodeSetV24,NULL,0L,           \
                               &amp;pInterfaceRecord-&gt;V24Out,1L);     \
         if (SavedIROut != (InterfaceRecord.V24Out &amp;              \
                            (MASK_DTR | MASK_RTS)    ))           \
         {                                                        \
           SavedIROut = (pInterfaceRecord-&gt;V24Out &amp;               \
                         (MASK_DTR | MASK_RTS)    );              \
           pSharedMem-&gt;V24Out = pInterfaceRecord-&gt;V24Out;         \
<b>         </b>}


#define GETV24STATUS(rc)                                          \
         rc |= NtDeviceIoControlFile(seldrvrh,NULL,NULL,NULL,     \
             &amp;IoStatus,IoctlCodeGetV24,NULL,0L,NULL,0L);          \
         rc |= READINTERFACERECORD;                               \
         if (SavedIRIn != (InterfaceRecord.V24In &amp;                \
                     (MASK_CTS | MASK_DSR | MASK_DCD| MASK_DRI))) \
         {                                                        \
             SavedIRIn = (InterfaceRecord.V24In &amp;                 \
                     (MASK_CTS | MASK_DSR | MASK_DCD| MASK_DRI)); \
             pSharedMem-&gt;V24In = InterfaceRecord.V24In;           \
         } 
 </code></pre>
<p>
<i>pSharedMem</i> is a pointer to the <a href="modemapi_488m.htm"><b>MODEM_STATUS</b></a> structure for this link service.</p>
<p>
<i>SavedV24In</i> and <i>SavedV24Out</i> are characters used to only notify the display application when status changes, not each time it is read or set.</p>
<p>
</p>
<p>&nbsp;</p></body>
</HTML>
