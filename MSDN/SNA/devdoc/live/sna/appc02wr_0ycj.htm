<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Changing Conversation States</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_sna_changing_conversation_states_appc"></a>Changing Conversation States</h3>
<p>
A change in the conversation state can result from:
<ul>
<li>
A verb issued by the local TP.</li>
<li>
A verb issued by the partner TP.</li>
<li>
An error condition.</li>
</ul>
<p>
The following example shows how APPC verbs can change the state of the conversation from SEND to RECEIVE and from RECEIVE to SEND.</p>
<p>
<b>Note</b>&nbsp;&nbsp;Any TP can send or receive data, regardless of whether it is the invoking TP (the TP that started the conversation) or the invokable TP (the TP that responded to a request to start a conversation).</p>
<p>
This example shows how APPC verbs can change the conversation state. In this table, each conversation state appears in bold and precedes the APPC verbs that are used while in that state.</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=50%>Issued by the invoking TP</th>
<th align=left width=50%>Issued by the invokable TP</th>
</tr>
<tr valign=top>
<td width=50%><code>TP_STARTED</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%><b>Conversation state: RESET</b></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%><code>MC_ALLOCATE</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%><code>(synclevel=AP_CONFIRM_SYNC_LEVL)</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%><b>Conversation state: SEND</b></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%><code>MC_SEND_DATA</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%><code>MC_PREPARE_TO_RECEIVE</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%><code>(ptr_type=AP_SYNC_LEVEL)</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><b>Conversation state: RESET</b></td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><code>RECEIVE_ALLOCATE</code></td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><b>Conversation state: RECEIVE</b></td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><pre><code>MC_RECEIVE_AND_WAIT</code></pre>
</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><pre><code>(primary_rc=AP_OK)</code></pre>
</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><pre><code>(what_rcvd=AP_DATA_COMPLETE)</code></pre>
</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><pre><code>MC_RECEIVE_AND_WAIT</code></pre>
</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><pre><code>(primary_rc=AP_OK)</code></pre>
</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><pre><code>(what_rcvd=AP_CONFIRM_SEND)</code></pre>
</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><b>Conversation state: CONFIRM_SEND</b></td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><pre><code>MC_CONFIRMED</code></pre>
</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><b>Conversation state: SEND</b></td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><pre><code>MC_SEND_DATA</code></pre>
</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><pre><code>MC_CONFIRM</code></pre>
</td>
</tr>
<tr valign=top>
<td width=50%><b>Conversation state: RECEIVE</b></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%><code>MC_RECEIVE_AND_WAIT</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%><code>(primary_rc=AP_OK)</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%><code>(what_rcvd=AP_DATA_COMPLETE)</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%><code>MC_RECEIVE_AND_WAIT</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%><code>(primary_rc=AP_OK)</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%><code>(what_rcvd=AP_CONFIRM_WHAT_RECEIVED)</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%><b>Conversation state: CONFIRM</b></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%><code>MC_REQUEST_TO_SEND</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%><code>MC_CONFIRMED</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><pre><code>(rts_rcvd=AP_YES)</code></pre>
</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><pre><code>MC_PREPARE_TO_RECEIVE</code></pre>
</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><pre><code>(ptr_type=AP_SYNC_LEVEL)</code></pre>
</td>
</tr>
<tr valign=top>
<td width=50%><b>Conversation state: RECEIVE</b></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%><code>MC_RECEIVE_AND_WAIT</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%><code>(primary_rc=AP_OK)</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%><code>(what_rcvd=AP_CONFIRM_SEND)</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%><b>Conversation state: CONFIRM_SEND</b></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%><code>MC_CONFIRMED</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%><b>Conversation state: SEND</b></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%><code>MC_SEND_DATA</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%><code>MC_DEALLOCATE</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%><code>(dealloc_type=AP_SYNC_LEVEL)</code></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><b>Conversation state: RECEIVE</b></td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><pre><code>MC_RECEIVE_AND_WAIT</code></pre>
</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><pre><code>(primary_rc=AP_OK)</code></pre>
</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><pre><code>(what_rcvd=AP_DATA_COMPLETE)</code></pre>
</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><pre><code>MC_RECEIVE_AND_WAIT</code></pre>
</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><pre><code>(primary_rc=AP_OK)</code></pre>
</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><pre><code>(what_rcvd=AP_CONFIRM_DEALLOCATE)</code></pre>
</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><b>Conversation state: CONFIRM_DEALLOCATE</b></td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%><pre><code>MC_CONFIRMED</code></pre>
</td>
</tr>
<tr valign=top>
<td width=50%><b>Conversation state: RESET</b></td>
<td width=50%><b>Conversation state: RESET</b></td>
</tr>
<tr valign=top>
<td width=50%><code>TP_ENDED</code></td>
<td width=50%><pre><code>TP_ENDED</code></pre>
</td>
</tr>
</table><br>
<h4>Initial States</h4>
<p>
Before the conversation is allocated, the state is RESET for both TPs.</p>
<p>
In the example, after the conversation is allocated, the initial state is SEND for the invoking TP and RECEIVE for the invokable TP.</p>
<h4>Changing to RECEIVE State</h4>
<p>
<a href="appc05a_8ktf.htm"><b>MC_PREPARE_TO_RECEIVE</b></a> allows a TP to change the conversation from SEND to RECEIVE state. This verb:
<ul>
<li>
Flushes the local LU's send buffer.</li>
<li>
Sends the AP_CONFIRM_SEND indicator to the partner TP through the <b>what_rcvd</b> parameter of a receive verb. This indicator tells the partner TP that an <a href="appc05a_5qhv.htm"><b>MC_CONFIRMED</b></a> response is expected before the partner TP can begin to send data.</li>
</ul>
<p>
Confirmation processing is performed when the following conditions are true:
<ul>
<li>
The <b>ptr_type</b> parameter is set to AP_SYNC_LEVEL.</li>
<li>
The synchronization level of the conversation is set to AP_CONFIRM_SYNC_LEVEL.</li>
</ul>
<p>
For more information about confirmation processing, see <a href="appc02wr_2i1v.htm">Confirmation Processing</a>.</p>
<p>
<b>Important</b>&nbsp;&nbsp;Issuing <a href="appc05a_5qlf.htm"><b>MC_RECEIVE_AND_WAIT</b></a> while the conversation is in SEND state flushes the LU's send buffer and changes the conversation state to RECEIVE. Changing the conversation state in this manner does not support confirmation processing.</p>
<h4>Changing to SEND State</h4>
<p>
<a href="appc05b_0737.htm"><b>MC_REQUEST_TO_SEND</b></a> informs the partner TP (for which the conversation is in SEND state) that the local TP (for which the conversation is in RECEIVE state) wants to send data. This request is communicated to the partner TP through the <b>rts_rcvd</b> parameter of <a href="appc05a_0b8j.htm"><b>MC_CONFIRM</b></a>. (The <b>rts_rcvd</b> parameter is also returned to <a href="appc05b_8iub.htm"><b>MC_SEND_DATA</b></a> and other verbs.)</p>
<p>
When the partner TP issues <a href="appc05a_8ktf.htm"><b>MC_PREPARE_TO_RECEIVE</b></a>, the conversation state changes to RECEIVE for the partner TP, making it possible for the local TP to send data.</p>
<p>
<b>Important</b>&nbsp;&nbsp;Issuing <a href="appc05b_0737.htm"><b>MC_REQUEST_TO_SEND</b></a> does not change the state of the conversation. Upon receiving a request to send, the partner TP is not required to change the conversation state; it can ignore the request.</p>
<p>&nbsp;</p></body>
</HTML>
