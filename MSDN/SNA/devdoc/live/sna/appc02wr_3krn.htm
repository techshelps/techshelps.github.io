<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Generating and Setting LUWIDs</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_sna_generating_and_setting_luwids_appc"></a>Generating and Setting LUWIDs</h3>
<p>
The LUWID is used to identify conversations that are part of a single Sync Point transaction. All conversations with the same LUWID are committed (or backed out) at the same time.</p>
<p>
SNA Server assigns two LUWIDs to a transaction program when the TP is started. For locally started TP's, this is when the <a href="appc04_0fs3.htm"><b>TP_STARTED</b></a> verb is issued. (In previous versions of SNA Server 2.<i>x</i> only one LUWID was assigned.) The first LUWID is the TP's protected LUWID. It is used by SNA Server as the LUWID for all <b>synclevel</b> AP_SYNCPT conversations allocated by the TP. When the TP issues an <a href="appc05a_1ckj.htm"><b>ALLOCATE</b></a> or <a href="appc05a_38f7.htm"><b>MC_ALLOCATE</b></a> verb with a <b>synclevel</b> of AP_SYNCPT, SNA Server generates an Attach containing the TP's current protected LUWID.</p>
<p>
The second LUWID is the TP's unprotected LUWID. It is used on all conversations allocated by the TP with a <b>synclevel</b> other than AP_SYNCPT.</p>
<p>
For remotely initiated TPs, the incoming Attach may contain an LUWID for the TP—it is mandatory if the conversation has a <b>synclevel</b> of AP_SYNCPT. For Sync Point conversations, SNA Server saves the LUWID as the TP's protected LUWID and generates a new unprotected LUWID for it. For conversations with a <b>synclevel</b> other than Sync Point (AP_SYNCPT), SNA Server saves the LUWID as the TP's unprotected LUWID and generates a new protected LUWID.</p>
<p>
SNA Server generates LUWIDs by concatenating the following:
<ul>
<li>
The fully qualified name of the local LU, preceded by a single byte indicating its length (exclusive of the length byte).</li>
<li>
A 6-byte LUW instance number, generated from the current date and time (modified to ensure uniqueness if necessary).</li>
<li>
A 2-byte LUW sequence number, initialized to 1.</li>
</ul>
<p>
If the fully qualified LU name component of the LUWID is not 17 bytes long, SNA Server does not add any padding between it and the LUW instance number. The application can determine the length of the LUWID, and the offsets within it of the LUW instance number and LUW sequence number, by examining the first byte of the LUWID, which indicates the length of the fully qualified LU name.</p>
<p>
When SNA Server generates both a protected and an unprotected LUWID for a TP, the unprotected LUWID is created by incrementing the protected LUWID's instance number.</p>
<p>
The protected LUWID needs to be changed by a TP for one of four reasons:
<ul>
<li>
When a transaction is backed out or committed, the LUWID sequence number must be incremented.</li>
<li>
If the transaction tree is split, a new LUWID must be generated for the TP.</li>
<li>
If the application uses multiple logical TPs to implement a transaction, each TP must have the same LUWID (different from that assigned by SNA Server).</li>
<li>
If the application is acting as a gateway from a non-SNA environment and LUWIDs are received by a means other than an Attach.</li>
</ul>
<p>
To allow a TP to set or generate new LUWIDs, a new verb, <a href="appc04_73z7.htm"><b>SET_TP_PROPERTIES</b></a>, is provided by the APPC API. This verb allows the TP to either set its LUWIDs to an existing value, by providing the LUWIDs, or generate new ones and use them from then on. When a new LUWID is generated by SNA Server, it is guaranteed to be unique.</p>
<p>
Note that it is the responsibility of the application (the Sync Point system component) to transmit the new LUWID PS header to the partner Sync Point system when the protected LUWID is changed. Similarly, when a new LUWID PS header is received, the application must inform the LU by issuing <b>SET_TP_PROPERTIES</b>.</p>
<p>&nbsp;</p></body>
</HTML>
