<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Confirmation Processing</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_sna_confirmation_processing_appc"></a>Confirmation Processing</h2>
<p>
The sequence of events for confirmation processing is as follows:
<ol>
<li>
Establish the synchronization level.</li>
<li>
Send a confirmation request.</li>
<li>
Receive data and confirmation request.</li>
<li>
Respond to the confirmation request.</li>
<li>
Deallocate the conversation.</li>
</ol>
<p>
Using confirmation processing, a TP sends a confirmation request with the data; the partner TP confirms receipt of the data or indicates that an error occurred. Each time the two TPs exchange a confirmation request and response, they are synchronized.</p>
<p>
<b>Note</b>&nbsp;&nbsp;Although the example in this section does not show this, any TP can send or receive data, regardless of whether the TP is the invoking TP or the invokable TP.</p>
<p>
The following example illustrates confirmation processing.</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=53%>Issued by the invoking TP</th>
<th align=left width=47%>Issued by the invokable TP</th>
</tr>
<tr valign=top>
<td colspan=2 width=100%></td>
</tr>
<tr valign=top>
<td width=53%><pre><code>TP_STARTED</code></pre>
</td>
<td width=47%><pre></pre>
</td>
</tr>
<tr valign=top>
<td width=53%><pre><code>MC_ALLOCATE</code></pre>
</td>
<td width=47%><pre></pre>
</td>
</tr>
<tr valign=top>
<td width=53%><pre><code>(synclevel=AP_CONFIRM_SYNC_LEVEL)</code></pre>
</td>
<td width=47%><pre></pre>
</td>
</tr>
<tr valign=top>
<td width=53%><pre><code>MC_SEND_DATA</code></pre>
</td>
<td width=47%><pre></pre>
</td>
</tr>
<tr valign=top>
<td width=53%><pre><code>(type=AP_SEND_DATA_CONFIRM)</code></pre>
</td>
<td width=47%><pre></pre>
</td>
</tr>
<tr valign=top>
<td width=53%><pre></pre>
</td>
<td width=47%><pre><code>RECEIVE_ALLOCATE</code></pre>
</td>
</tr>
<tr valign=top>
<td width=53%><pre></pre>
</td>
<td width=47%><pre><code>MC_RECEIVE_AND_WAIT</code></pre>
</td>
</tr>
<tr valign=top>
<td width=53%><pre></pre>
</td>
<td width=47%><pre><code>(primary_rc=AP_OK)</code></pre>
</td>
</tr>
<tr valign=top>
<td width=53%><pre></pre>
</td>
<td width=47%><pre><code>(rtn_status=AP_YES)</code></pre>
</td>
</tr>
<tr valign=top>
<td width=53%><pre></pre>
</td>
<td width=47%><pre><code>(what_rcvd=
AP_DATA_COMPLETE_CONFIRM)</code></pre>
</td>
</tr>
<tr valign=top>
<td width=53%><pre></pre>
</td>
<td width=47%><pre><code>MC_CONFIRMED</code></pre>
</td>
</tr>
<tr valign=top>
<td width=53%><pre><code>MC_SEND_DATA</code></pre>
</td>
<td width=47%><pre></pre>
</td>
</tr>
<tr valign=top>
<td width=53%><pre><code>(type=AP_SEND_DATA_DEALLOC_SYNC_LEVEL)</code></pre>
</td>
<td width=47%><pre></pre>
</td>
</tr>
<tr valign=top>
<td width=53%><pre></pre>
</td>
<td width=47%><pre><code>MC_RECEIVE_AND_WAIT</code></pre>
</td>
</tr>
<tr valign=top>
<td width=53%><pre></pre>
</td>
<td width=47%><pre><code>(primary_rc=AP_OK)</code></pre>
</td>
</tr>
<tr valign=top>
<td width=53%><pre></pre>
</td>
<td width=47%><pre><code>(rtn_status=AP_YES)</code></pre>
</td>
</tr>
<tr valign=top>
<td width=53%><pre></pre>
</td>
<td width=47%><pre><code>(what_rcvd=
AP_DATA_COMPLETE_CONFIRM_
DEALLOCATE)</code></pre>
</td>
</tr>
<tr valign=top>
<td width=53%><pre></pre>
</td>
<td width=47%><pre><code>MC_CONFIRMED</code></pre>
</td>
</tr>
<tr valign=top>
<td width=53%><pre><code>TP_ENDED</code></pre>
</td>
<td width=47%><pre><code>TP_ENDED</code></pre>
</td>
</tr>
</table><br>
<h4>Establishing the Synchronization Level</h4>
<p>
The <b>synclevel</b> parameter of <a href="appc05a_38f7.htm"><b>MC_ALLOCATE</b></a> determines the synchronization level of the conversation. There are three possible synchronization levels:
<ul>
<li>
AP_NONE, under which confirmation processing does not occur.</li>
<li>
AP_CONFIRM_SYNC_LEVEL, under which the TPs can request confirmation of receipt of data and respond to requests for confirmation of data.</li>
<li>
AP_SYNCPT, under which the TPs operate under Sync Point Level 2 support for confirmation of receipt of data.</li>
</ul>
<h4>Sending a Confirmation Request</h4>
<p>
<a href="appc05b_8iub.htm"><b>MC_SEND_DATA</b></a> with type AP_SEND_DATA_CONFIRM has two effects:
<ul>
<li>
It flushes the local LU's send buffer and sends any data contained in the buffer to the partner TP.</li>
<li>
It sends a confirmation request that the partner TP receives through the <b>what_rcvd</b> parameter of a receive verb.</li>
</ul>
<p>
After issuing <b>MC_SEND_DATA</b>, the local TP waits for confirmation from the partner TP.</p>
<h4>Receiving Data and Confirmation Request</h4>
<p>
The <b>what_rcvd</b> parameter of <a href="appc05a_5qlf.htm"><b>MC_RECEIVE_AND_WAIT</b></a> indicates:
<ul>
<li>
Status of the data received: complete or incomplete.</li>
<li>
Future processing expected of the local TP.</li>
</ul>
<p>
In the example, <b>what_rcvd</b> is ap_data_complete_confirm, indicating that the status is complete and a confirmation is requested.</p>
<h4>Responding to a Confirmation Request</h4>
<p>
The partner TP issues <a href="appc05a_5qhv.htm"><b>MC_CONFIRMED</b></a> to confirm receipt of data. This frees the local TP to resume processing.</p>
<h4>Deallocating the Conversation</h4>
<p>
<a href="appc05b_8iub.htm"><b>MC_SEND_DATA</b></a> sends a confirmation request with the data when all of the following conditions are true:
<ul>
<li>
The conversation's synchronization level (established by the <b>synclevel</b> parameter of <a href="appc05a_38f7.htm"><b>MC_ALLOCATE</b></a>) is AP_CONFIRM_SYNC_LEVEL.</li>
<li>
The <b>type</b> parameter of <b>MC_SEND_DATA</b> is set to AP_SEND_DATA_DEALLOC_SYNC_LEVEL.</li>
<li>
The <b>what_rcvd</b> parameter of the final <a href="appc05a_5qlf.htm"><b>MC_RECEIVE_AND_WAIT</b></a> is AP_DATA_COMPLETE_CONFIRM_DEALLOCATE, indicating that a confirmation of receipt of data is required before APPC will deallocate the conversation. The local TP waits for this confirmation until the partner TP issues <a href="appc05a_5qhv.htm"><b>MC_CONFIRMED</b></a>.</li>
</ul>
<p>&nbsp;</p></body>
</HTML>
