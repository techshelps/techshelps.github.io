<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>CONFIRM</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_sna_confirm_appc"></a>CONFIRM</h1>
<p>
The <b>CONFIRM</b> verb sends the contents of the local LU's send buffer and a confirmation request to the partner TP.</p>
<p>
For the Microsoft® Windows® version 3<i>.x</i> system, it is recommended that you use <a href="appc06_66sj.htm"><b>WinAsyncAPPC</b></a> rather than the blocking version of this call.</p>
<p>
The following structure describes the verb control block used by the <b>CONFIRM</b> verb.</p>
<pre><code>struct confirm {
    unsigned short  opcode;
    unsigned char   opext;
    unsigned char   reserv2;
    unsigned short  primary_rc;
    unsigned long   secondary_rc;
    unsigned char   tp_id[8];
    unsigned long   conv_id;
    unsigned char   rts_rcvd;
}; 
 </code></pre>
<h4>Members</h4>
<dl>
<dt>
<b>opcode</b></dt>
<dd>
Supplied parameter. Specifies the verb operation code, AP_B_CONFIRM.</dd>
<dt>
<b>opext</b></dt>
<dd>
Supplied parameter. Specifies the verb operation extension, AP_BASIC_CONVERSATION.</dd>
<dt>
<b>primary_rc</b></dt>
<dd>
Returned parameter. Specifies the primary return code set by APPC at the completion of the verb. The valid return codes vary depending on the APPC verb issued. See Return Codes for valid error codes for this verb.</dd>
<dt>
<b>secondary_rc</b></dt>
<dd>
Returned parameter. Specifies the secondary return code set by APPC at the completion of the verb. The valid return codes vary depending on the APPC verb issued. See Return Codes for valid error codes for this verb.</dd>
<dt>
<b>tp_id</b></dt>
<dd>
Supplied parameter. Identifies the local TP. The value of this parameter was returned by <a href="appc04_0fs3.htm"><b>TP_STARTED</b></a>.</dd>
<dt>
<b>conv_id</b></dt>
<dd>
Returned parameter. Identifies the conversation established between the two TPs.</dd>
<dt>
<b>rts_rcvd</b></dt>
<dd>
Returned parameter. Indicates whether the partner TP issued <a href="appc05b_54kj.htm"><b>REQUEST_TO_SEND</b></a>, which requests the local TP to change the conversation to RECEIVE state. 
<p>
To change to RECEIVE state operating on Microsoft® Windows NT® or Windows 95, the local TP can use <a href="appc05b_9aar.htm"><b>PREPARE_TO_RECEIVE</b></a>, <a href="appc05b_19er.htm"><b>RECEIVE_AND_WAIT</b></a>, or <a href="appc05b_92oz.htm"><b>RECEIVE_AND_POST</b></a>. 

<p>
To change to RECEIVE state operating on Windows 3.x, the local TP can use <b>PREPARE_TO_RECEIVE</b> or <b>RECEIVE_AND_WAIT</b>. 

<p>
To change to RECEIVE state operating on OS/2, the local TP can use <b>RECEIVE_AND_POST</b>.

</dd>
</dl>
<h4>Return Codes</h4>
<dl>
<dt>
ap_ok</dt>
<dd>
Primary return code; the verb executed successfully.</dd>
<dt>
ap_parameter_check</dt>
<dd>
Primary return code; the verb did not execute because of a parameter error.
<dl>
<dt>
ap_bad_conv_id</dt>
<dd>
Secondary return code; the value of <b>conv_id</b> did not match a conversation identifier assigned by APPC.</dd>
<dt>
ap_bad_tp_id</dt>
<dd>
Secondary return code; the value of <b>tp_id</b> did not match a TP identifier assigned by APPC.</dd>
<dt>
ap_confirm_on_sync_level_none</dt>
<dd>
Secondary return code; the local TP attempted to use <b>CONFIRM</b> in a conversation with a synchronization level of AP_NONE. The synchronization level, established by <a href="appc05a_1ckj.htm"><b>ALLOCATE</b></a>, must be AP_CONFIRM_SYNC_LEVEL.
</dd>
</dl>
</dd>
<dt>
ap_state_check</dt>
<dd>
Primary return code; the verb did not execute because it was issued in an invalid state.
<dl>
<dt>
ap_confirm_bad_state</dt>
<dd>
Secondary return code; the conversation was not in SEND state.</dd>
<dt>
ap_confirm_not_ll_bdy</dt>
<dd>
Secondary return code; the conversation for the local TP was in SEND state, and the local TP did not finish sending a logical record.
</dd>
</dl>
</dd>
<dt>
ap_allocation_error</dt>
<dd>
Primary return code; APPC has failed to allocate a conversation. The conversation state is set to RESET.
<p>
This code can be returned through a verb issued after <b>ALLOCATE</b>.

<dl>
<dt>
ap_allocation_failure_no_retry</dt>
<dd>
Secondary return code; the conversation cannot be allocated because of a permanent condition, such as a configuration error or session protocol error. To determine the error, the system administrator should examine the error log file. Do not retry the allocation until the error has been corrected.</dd>
<dt>
ap_allocation_failure_retry</dt>
<dd>
Secondary return code; the conversation could not be allocated because of a temporary condition, such as a link failure. The reason for the failure is logged in the system error log. Retry the allocation.</dd>
<dt>
ap_conversation_type_mismatch</dt>
<dd>
Secondary return code; the partner LU or TP does not support the conversation type (basic or mapped) specified in the allocation request.</dd>
<dt>
ap_pip_not_allowed</dt>
<dd>
Secondary return code; the allocation request specified PIP data, but either the partner TP does not require this data, or the partner LU does not support it.</dd>
<dt>
ap_pip_not_specified_correctly</dt>
<dd>
Secondary return code; the partner TP requires PIP data, but the allocation request specified either no PIP data or an incorrect number of parameters.</dd>
<dt>
ap_security_not_valid</dt>
<dd>
Secondary return code; the user identifier or password specified in the allocation request was not accepted by the partner LU.</dd>
<dt>
ap_sync_level_not_supported</dt>
<dd>
Secondary return code; the partner TP does not support the <b>sync_level</b> (AP_NONE, AP_CONFIRM_SYNC_LEVEL, or AP_SYNCPT) specified in the allocation request, or the <b>sync_level</b> was not recognized.</dd>
<dt>
ap_tp_name_not_recognized</dt>
<dd>
Secondary return code; the partner LU does not recognize the TP name specified in the allocation request.</dd>
<dt>
ap_trans_pgm_not_avail_no_retry</dt>
<dd>
Secondary return code; the remote LU rejected the allocation request because it was unable to start the requested partner TP. The condition is permanent. The reason for the error may be logged on the remote node. Do not retry the allocation until the error has been corrected.</dd>
<dt>
ap_trans_pgm_not_avail_retry</dt>
<dd>
Secondary return code; the remote LU rejected the allocation request because it was unable to start the requested partner TP. The condition may be temporary, such as a time-out. The reason for the error may be logged on the remote node. Retry the allocation.
</dd>
</dl>
</dd>
<dt>
ap_comm_subsystem_abended</dt>
<dd>
Primary return code; indicates one of the following conditions:
<ul>
<li>
The node used by this conversation encountered an ABEND.</li>
<li>
The connection between the TP and the PU 2.1 node has been broken (a LAN error).</li>
<li>
The SnaBase at the TP's computer has encountered an ABEND.</li>
</ul>

<p>
The system administrator should examine the error log to determine the reason for the ABEND.
</dd>
<dt>
ap_conv_failure_no_retry</dt>
<dd>
Primary return code; the conversation was terminated because of a permanent condition, such as a session protocol error. The system administrator should examine the system error log to determine the cause of the error. Do not retry the conversation until the error has been corrected.</dd>
<dt>
ap_conv_failure_retry</dt>
<dd>
Primary return code; the conversation was terminated because of a temporary error. Restart the TP to see if the problem occurs again. If it does, the system administrator should examine the error log to determine the cause of the error.</dd>
<dt>
ap_conversation_type_mixed</dt>
<dd>
Primary return code; the TP has issued both basic and mapped conversation verbs. Only one type can be issued in a single conversation.</dd>
<dt>
ap_invalid_verb_segment</dt>
<dd>
Primary return code; the VCB extended beyond the end of the data segment.</dd>
<dt>
ap_prog_error_purging</dt>
<dd>
Primary return code; while in RECEIVE, PENDING, PENDING_POST (Windows NT, Windows 95, and OS/2 only), CONFIRM, CONFIRM_SEND, or CONFIRM_DEALLOCATE state, the partner TP issued <a href="appc05b_1azn.htm"><b>SEND_ERROR</b></a> with <b>err_type</b> set to AP_PROG. Data sent but not yet received is purged.</dd>
<dt>
ap_stack_too_small</dt>
<dd>
Primary return code; the stack size of the application is too small to execute the verb. Increase the stack size of your application.</dd>
<dt>
ap_conv_busy</dt>
<dd>
Primary return code; there can only be one outstanding conversation verb at a time on any conversation. This can occur if the local TP has multiple threads, and more than one thread is issuing APPC calls using the same <b>conv_id</b>.</dd>
<dt>
ap_thread_blocking</dt>
<dd>
Primary return code; the calling thread is already in a blocking call.</dd>
<dt>
ap_unexpected_dos_error</dt>
<dd>
Primary return code; the operating system has returned an error to APPC while processing an APPC call from the local TP. The operating system return code is returned through the <b>secondary_rc</b>. It appears in Intel byte-swapped order. If the problem persists, consult the system administrator.</dd>
<dt>
ap_dealloc_abend_prog</dt>
<dd>
Primary return code; the conversation has been deallocated for one of the following reasons:
<ul>
<li>
The partner TP issued <a href="appc05a_4ndv.htm"><b>DEALLOCATE</b></a> with <b>dealloc_type</b><i> </i>set to AP_ABEND_PROG.</li>
<li>
The partner TP has encountered an ABEND, causing the partner LU to send a <b>DEALLOCATE</b> request.</li>
</ul>
</dd>
<dt>
ap_dealloc_abend_svc</dt>
<dd>
Primary return code; the conversation has been deallocated because the partner TP issued <b>DEALLOCATE</b> with <b>dealloc_type</b> set to AP_ABEND_SVC.</dd>
<dt>
ap_dealloc_abend_timer</dt>
<dd>
Primary return code; the conversation has been deallocated because the partner TP issued <b>DEALLOCATE</b> with <b>dealloc_type</b> set to AP_ABEND_TIMER.</dd>
<dt>
ap_svc_error_purging</dt>
<dd>
Primary return code; the partner TP (or partner LU) issued <a href="appc05b_1azn.htm"><b>SEND_ERROR</b></a> with <b>err_type</b> set to AP_SVC while in RECEIVE, PENDING_POST (Windows NT, Windows 95, and OS/2 only), CONFIRM, CONFIRM_SEND, or CONFIRM_DEALLOCATE state. Data sent to the partner TP may have been purged.
</dd>
</dl>
<h4>Remarks</h4>
<p>
In response to <b>CONFIRM</b>, the partner TP normally issues <a href="appc05a_53z7.htm"><b>CONFIRMED</b></a> to confirm that it has received the data without error. (If the partner TP encounters an error, it issues <a href="appc05b_1azn.htm"><b>SEND_ERROR</b></a> or abnormally deallocates the conversation.)</p>
<p>
The TP can issue <b>CONFIRM</b> only if the conversation's synchronization level, established by <a href="appc05a_1ckj.htm"><b>ALLOCATE</b></a>, is AP_CONFIRM_SYNC_LEVEL.</p>
<p>
The conversation must be in SEND state when the TP issues this verb. State changes, summarized in the following table, are based on the value of the <b>primary_rc</b>.</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=48%>primary_rc</th>
<th align=left width=52%>New state</th>
</tr>
<tr valign=top>
<td width=48%>ap_ok</td>
<td width=52%>No change</td>
</tr>
<tr valign=top>
<td width=48%>ap_allocation_error</td>
<td width=52%>RESET</td>
</tr>
<tr valign=top>
<td width=48%>ap_comm_subsystem_abended<br>
ap_comm_subsystem_not_loaded</td>
<td width=52%>RESET<br>
RESET</td>
</tr>
<tr valign=top>
<td width=48%>ap_conv_failure_retry<br>
ap_conv_failure_no_retry</td>
<td width=52%>RESET<br>
RESET</td>
</tr>
<tr valign=top>
<td width=48%>ap_dealloc_abend<br>
ap_dealloc_abend_prog<br>
ap_dealloc_abend_svc<br>
ap_dealloc_abend_timer</td>
<td width=52%>RESET<br>
RESET<br>
RESET<br>
RESET</td>
</tr>
<tr valign=top>
<td width=48%>ap_prog_error_purging<br>
ap_svc_error_purging</td>
<td width=52%>RECEIVE<br>
RECEIVE</td>
</tr>
</table><br>
<p>
<b>CONFIRM</b> waits for a response from the partner TP. A response is generated by one of the following verbs in the partner TP:
<ul>
<li>
<a href="appc05a_53z7.htm"><b>CONFIRMED</b></a></li>
<li>
<a href="appc05b_1azn.htm"><b>SEND_ERROR</b></a></li>
<li>
<a href="appc05a_4ndv.htm"><b>DEALLOCATE</b></a> with <b>dealloc_type</b> set to AP_ABEND_PROG, AP_ABEND_SVC, or AP_ABEND_TIMER</li>
<li>
<a href="appc04_8k0z.htm"><b>TP_ENDED</b></a></li>
</ul>
<p>
By issuing <b>CONFIRM</b> after<b> <a href="appc05a_1ckj.htm">ALLOCATE</a></b>, the invoking TP can immediately determine whether the allocation was successful (if <b>synclevel</b> is set to AP_CONFIRM_SYNC_LEVEL).</p>
<p>
Normally, the value of the <b>ALLOCATE</b> verb's <b>mode_name</b> parameter must match the name of a mode configured for the invoked TP's node and associated during configuration with the partner LU.</p>
<p>
If one of the modes associated with the partner LU on the invoked TP's node is an implicit mode, the session established between the two LUs will be of the implicit mode when no mode name associated with the partner LU matches the value of <b>mode_name</b>. For more information, see the <i>Microsoft SNA Server Administration Guide</i>.</p>
<p>
Several parameters of <b>ALLOCATE</b> are EBCDIC or ASCII strings. A TP can use the CSV <a href="appc08c_2vvn.htm"><b>CONVERT</b></a> to translate a string from one character set to the other.</p>
<p>
To send the <b>ALLOCATE</b> request immediately, the invoking TP can issue <a href="appc05a_2n37.htm"><b>FLUSH</b></a> or <b>CONFIRM</b> immediately after <b>ALLOCATE</b>. Otherwise, the <b>ALLOCATE</b> request accumulates with other data in the local LU's send buffer until the buffer is full.</p>
<p>&nbsp;</p></body>
</HTML>
