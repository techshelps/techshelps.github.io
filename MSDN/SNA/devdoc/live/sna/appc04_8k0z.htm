<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>TP_ENDED</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_sna_tp_ended_appc"></a>TP_ENDED</h1>
<p>
The <b>TP_ENDED</b> verb is issued by both the invoking and invoked TP, and notifies APPC that the TP is ending.</p>
<p>
For the Microsoft® Windows® version 3.<i>x</i> system, it is recommended that you use the <a href="appc06_66sj.htm"><b>WinAsyncAPPC</b></a> function rather than the blocking version of this call.</p>
<p>
The following structure describes the verb control block used by the <b>TP_ENDED</b> verb.</p>
<pre><code>struct tp_ended {
    unsigned short  opcode;
    unsigned char   opext;
    unsigned char   reserv2;
    unsigned short  primary_rc;
    unsigned long   secondary_rc;
    unsigned char   tp_id[8];
    unsigned char   type;
}; 
 </code></pre>
<h4>Members</h4>
<dl>
<dt>
<b>opcode</b></dt>
<dd>
Supplied parameter. Specifies the verb operation code, AP_TP_ENDED.</dd>
<dt>
<b>opext</b></dt>
<dd>
Supplied parameter. Specifies the verb operation extension. This field is not used by the <b>TP_ENDED</b> verb. </dd>
<dt>
<b>primary_rc</b></dt>
<dd>
Returned parameter. Specifies the primary return code set by APPC at the completion of the verb. The valid return codes vary depending on the APPC verb issued. See Return Codes for valid error codes for this verb.</dd>
<dt>
<b>secondary_rc</b></dt>
<dd>
Returned parameter. Specifies the secondary return code set by APPC at the completion of the verb. The valid return codes vary depending on the APPC verb issued. See Return Codes for valid error codes for this verb.</dd>
<dt>
<b>tp_id</b></dt>
<dd>
Supplied parameter. Identifies the local TP. The value of this parameter was returned by <a href="appc04_0fs3.htm"><b>TP_STARTED</b></a> in the invoking TP or by <a href="appc05b_0m77.htm"><b>RECEIVE_ALLOCATE</b></a> in the invoked TP.</dd>
<dt>
<b>type</b></dt>
<dd>
Supplied parameter. Specifies the type of termination to be performed. The following are allowed values:
<ul>
<li>
AP_HARD indicates that all active verbs for the TP are terminated; the session(s) being used by the conversation(s) are ended. Both the local TP and the partner TP can receive conversation failure return codes (ap_dealloc_abend for mapped conversations and ap_dealloc_abend_prog for basic conversations).</li>
<li>
AP_SOFT indicates that the TP waits for all active verbs to complete; the session being used by the conversation remains active.</li>
</ul>
</dd>
</dl>
<h4>Return Codes</h4>
<dl>
<dt>
ap_ok</dt>
<dd>
Primary return code; the verb executed successfully.</dd>
<dt>
ap_parameter_check</dt>
<dd>
Primary return code; the verb did not execute because of a parameter error.
<dl>
<dt>
ap_bad_tp_id</dt>
<dd>
Secondary return code; APPC did not recognize the <b>tp_id</b> as an assigned TP identifier.</dd>
<dt>
ap_bad_type</dt>
<dd>
Secondary return code; the specified <b>type</b> value was not recognized by APPC.
</dd>
</dl>
</dd>
<dt>
ap_comm_subsystem_abended</dt>
<dd>
Primary return code; indicates one of the following conditions:
<ul>
<li>
The node used by this conversation encountered an ABEND.</li>
<li>
The connection between the TP and the PU 2.1 node has been broken (a LAN error).</li>
<li>
The SnaBase at the TP's computer encountered an ABEND.</li>
</ul>

<p>
The system administrator should examine the error log to determine the reason for the ABEND.
</dd>
<dt>
ap_comm_subsystem_not_loaded</dt>
<dd>
Primary return code; a required component could not be loaded or terminated while processing the verb. Thus, communication could not take place. Contact the system administrator for corrective action.</dd>
<dt>
ap_invalid_verb_segment</dt>
<dd>
Primary return code; the VCB extended beyond the end of the data segment.</dd>
<dt>
ap_stack_too_small</dt>
<dd>
Primary return code; the stack size of the application is too small to execute the verb. Increase the stack size of your application.</dd>
<dt>
ap_tp_busy</dt>
<dd>
Primary return code; the local TP has issued a call to APPC while APPC was processing another call for the same TP. This can occur if the local TP has multiple threads, and more than one thread is issuing APPC calls using the same <b>tp_id</b>.</dd>
<dt>
ap_thread_blocking</dt>
<dd>
Primary return code; the calling thread is already in a blocking call.</dd>
<dt>
ap_unexpected_dos_error</dt>
<dd>
Primary return code; the operating system has returned an error to APPC while processing an APPC call from the local TP. The operating system return code is returned through the <b>secondary_rc</b>. It appears in Intel byte-swapped order. If the problem persists, consult the system administrator.
</dd>
</dl>
<h4>Remarks</h4>
<p>
In response to <b>TP_ENDED</b>, APPC frees the resources used by the TP. After this verb executes, the TP identifier is no longer valid; the TP cannot issue any more APPC conversation verbs.</p>
<p>
The conversation can be in any state when the TP issues this verb.</p>
<p>
If the conversation is in SEND state, <b>TP_ENDED</b> performs the function of <a href="appc05a_4ndv.htm"><b>DEALLOCATE</b></a> or <a href="appc05a_4okj.htm"><b>MC_DEALLOCATE</b></a> with <b>dealloc_type</b> set to AP_FLUSH.</p>
<p>
If the conversation is in a state other than RESET or SEND, <b>TP_ENDED</b> performs the function of <b>DEALLOCATE</b> or <b>MC_DEALLOCATE</b> with <b>dealloc_type</b> set to AP_ABEND (for a mapped conversation) or AP_ABEND_PROG (for a basic conversation).</p>
<p>
After successful execution (<b>primary_rc</b> is ap_ok), there is no APPC state.</p>
<p>&nbsp;</p></body>
</HTML>
