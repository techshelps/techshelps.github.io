<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Outbound Chaining</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_sna_outbound_chaining_3270"></a>Outbound Chaining</h2>
<p>
The local node checks that outbound chains of requests conform to the correct SNA usage, to the chaining usage for the session, and to the current state of the session. The local node will accept valid outbound chains of data from the host if one of the following is true:
<ul>
<li>
Data traffic is active on a full-duplex session.</li>
<li>
The session is in a state where it can receive data.</li>
<li>
The session is between brackets with neither half-session currently sending (see <a href="3270c3_873k.htm">Brackets</a>), or the session is in contention for a half-duplex contention session.</li>
<li>
The session is waiting for the host to initiate a recovery procedure (see <a href="3270c3_95kg.htm">Recovery</a>); for example, the local node has sent a negative response to an outbound chain.</li>
</ul>
<p>
The local node sends a <a href="3270c4_4eeo.htm"><b>Data</b></a> message to the application for each outbound request—but note the effects of the application specifying the segment delivery option in the connection information control block (see <a href="3270c3_9vg0.htm">Segment Delivery</a>). If the application does not specify segment delivery, then the BCI and ECI application flags in the message header reflect the chaining indicators in the RH of the request.</p>
<p>
An outbound chain can terminate in several ways:
<ul>
<li>
The chain is received complete and without error; all the requests in the chain have been passed to the application as <b>Data</b> messages and have been acknowledged where applicable.</li>
<li>
The application detects an error in a <a href="3270c4_4eeo.htm"><b>Data</b></a> message while receiving the chain. The application should send a <a href="3270c4_11bk.htm"><b>Status-Acknowledge(Nack-1)</b></a> with associated sense data to the local node, which sends a negative response plus the sense data to the host for the request corresponding to the <b>Data</b> message in error. The local node will not purge the remainder of the chain, so the application will see EC (end chain). Alternatively, the host can terminate the chain with a CANCEL, which is delivered to the application as a <b>Status-Control(CANCEL)</b> with ACKRQD set.</li>
<li>
The local node detects an error in a request and presents the application with a system detected error <b>Data</b> message to report the premature termination of the chain. This message carries the SDI (system detected error indicator) and ECI (end chain indicator) application flags, the sense codes for the error, and the ACKRQD indicator; it does not carry user data. When the application responds with <a href="3270c4_5z00.htm"><b>Status-Acknowledge(Ack)</b></a>, the local node generates a negative response to the chain using the appropriate sense code. The application can use the reported sense codes to generate diagnostic information for the user (for example, a 3270 emulator would generate PROG check codes). The local node will purge the remainder of the chain, so the application may not see EC. Alternatively, the host can terminate the chain with a CANCEL, which is delivered to the application as a <b>Status-Control(CANCEL)</b> with ACKRQD set.</li>
<li>
The host can cancel the chain while sending, by sending the CANCEL request. The local node sends a <b>Status-Control(CANCEL)</b> message to the application, which the application must acknowledge.</li>
</ul>
<p>
If an error occurs while receiving a chain, and the session uses half-duplex flip-flop protocols, then the application must assume an error-recovery-pending state (see <a href="3270c3_95kg.htm">Recovery</a>).</p>
<p>
For a session using half-duplex flip-flop protocols, if the application flags in the last <a href="3270c4_4eeo.htm"><b>Data</b></a> message of the chain have the CDI (change direction) flag set, then:
<ul>
<li>
If the chain was received without error, the application has direction.</li>
<li>
If the application rejected any message in the chain, the host retains direction.</li>
</ul>
<p>
The following four figures illustrate outbound chaining protocols between the local node and the application and how those protocols relate to the underlying SNA protocols.</p>
<p>
In the first illustration, a complete outbound chain is received without error and accepted by the application; note that after sending <b>Status-Acknowledge(Ack)</b> the application has direction.</p>
<p>
<img src="images/32703i.gif" border=0></p>
<p>
<img src="images/32703ia.gif" border=0></p>
<p>
In the following illustration, a complete outbound chain is received without error, but is rejected by the application; note that even though the chain carried CD, the application does not have direction.</p>
<p>
<img src="images/32703ib.gif" border=0></p>
<p>
In the following illustration, the local node detects the invalid use of RQD without EC and converts the request to a <b>Data</b> message with the SDI application flag set, plus ACKRQD and appropriate sense codes. The application's <b>Status-Acknowledge(Ack)</b> drives the negative response to the host. This example assumes that the receive check 4007 has been specified in the CICB on the <b>Open (SSCP)</b>.</p>
<p>
In the following illustration, the host cancels the outbound chain.</p>
<p>
<img src="images/32703ic.gif" border=0></p>
<p>&nbsp;</p></body>
</HTML>
