<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>SEND_ERROR</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_sna_send_error_appc"></a>SEND_ERROR</h1>
<p>
The <b>SEND_ERROR</b> verb notifies the partner TP that the local TP has encountered an application-level error.</p>
<p>
For the Microsoft® Windows® version 3.<i>x</i> system, it is recommended that you use <a href="appc06_66sj.htm"><b>WinAsyncAPPC</b></a> rather than the blocking version of this call.</p>
<p>
The following structure describes the verb control block used by the <b>SEND_ERROR</b> verb.</p>
<pre><code>struct send_error {
    unsigned short      opcode;
    unsigned char       opext;
    unsigned char       reserv2;
    unsigned short      primary_rc;
    unsigned long       secondary_rc;
    unsigned char       tp_id[8];
    unsigned long       conv_id;
    unsigned char       rts_rcvd;
    unsigned char       err_type;
    unsigned char       err_dir;
    unsigned char       reserv3;
    unsigned short      log_dlen;
    unsigned char FAR * log_dptr;
}; 
 </code></pre>
<h4>Members</h4>
<dl>
<dt>
<b>opcode</b></dt>
<dd>
Supplied parameter. Specifies the verb operation code, AP_B_SEND_ERROR.</dd>
<dt>
<b>opext</b></dt>
<dd>
Supplied parameter. Specifies the verb operation extension, AP_BASIC_CONVERSATION.</dd>
<dt>
<b>primary_rc</b></dt>
<dd>
Returned parameter. Specifies the primary return code set by APPC at the completion of the verb. The valid return codes vary depending on the APPC verb issued. See Return Codes for valid error codes for this verb.</dd>
<dt>
<b>secondary_rc</b></dt>
<dd>
Returned parameter. Specifies the secondary return code set by APPC at the completion of the verb. The valid return codes vary depending on the APPC verb issued. See Return Codes for valid error codes for this verb.</dd>
<dt>
<b>tp_id</b></dt>
<dd>
Supplied parameter. Identifies the local TP.
<p>
The value of this parameter is returned by <a href="appc04_0fs3.htm"><b>TP_STARTED</b></a> in the invoking TP or by <a href="appc05b_0m77.htm"><b>RECEIVE_ALLOCATE</b></a> in the invoked TP.
</dd>
<dt>
<b>conv_id</b></dt>
<dd>
Supplied parameter. Provides the conversation identifier. The value of this parameter is returned by <a href="appc05a_1ckj.htm"><b>ALLOCATE</b></a><b> </b>in the invoking TP or by <b>RECEIVE_ALLOCATE</b> in the invoked TP.</dd>
<dt>
<b>rts_rcvd</b></dt>
<dd>
Returned parameter. Indicates whether the partner TP issued <a href="appc05b_54kj.htm"><b>REQUEST_TO_SEND</b></a>.<b> </b>Possible values include:
<ul>
<li>
ap_yes indicates that the partner TP has issued <b>REQUEST_TO_SEND</b>, which requests that the local TP change the conversation to RECEIVE state. To change to RECEIVE state, the local TP can use <a href="appc05b_9aar.htm"><b>PREPARE_TO_RECEIVE</b></a>, <a href="appc05b_19er.htm"><b>RECEIVE_AND_WAIT</b></a>, or <a href="appc05b_92oz.htm"><b>RECEIVE_AND_POST</b></a>.</li>
<li>
ap_no indicates that the partner TP has not issued <b>REQUEST_TO_SEND</b>.</li>
</ul>
</dd>
<dt>
<b>err_type</b></dt>
<dd>
Supplied parameter. Indicates the type of the error being reported — application program or service program.
<p>
AP_PROG indicates that the error is to be reported to an end-user application program. This value causes APPC to send one of the following return codes to the partner TP:

<p class=indent1>
AP_PROG_ERROR_NO_TRUNC</p>

<p class=indent1>
AP_PROG_ERROR_PURGING</p>

<p class=indent1>
AP_PROG_ERROR_TRUNC</p>


<p>
AP_SVC indicates that the error is to be reported to a service program. This value causes APPC to send one of the following return codes to the partner TP:

<p class=indent1>
AP_SVC_ERROR_NO_TRUNC</p>

<p class=indent1>
AP_SVC_ERROR_PURGING</p>

<p class=indent1>
AP_SVC_ERROR_TRUNC</p>

</dd>
<dt>
<b>err_dir</b></dt>
<dd>
Supplied parameter. Indicates whether the error is with data just received or with data that is about to be sent. Use this parameter only when the conversation is in SEND_PENDING state. The parameter is ignored otherwise. The following are allowed values:
<ul>
<li>
AP_RCV_DIR_ERROR indicates that the TP issued <b>SEND_ERROR</b> after detecting an error associated with the data just received.</li>
<li>
AP_SEND_DIR_ERROR indicates that the TP issued <b>SEND_ERROR</b> after detecting an error associated with data it was going to send. For example, the TP encountered an error while reading data from the disk drive.</li>
</ul>
</dd>
<dt>
<b>log_dlen</b></dt>
<dd>
Supplied parameter for basic conversations; specifies the number of bytes of data to be sent to the error log file. The range is from 0 through 32767.
<p>
A length of zero indicates that there is no error log data.
</dd>
<dt>
<b>log_dptr</b></dt>
<dd>
Supplied parameter for basic conversations; specifies the address of the data buffer containing error information. The data is sent to the local error log and to the partner LU.
<p>
This parameter is used by <b>SEND_ERROR</b> if <b>log_dlen</b> is greater than zero.

<p>
For the Microsoft® Windows NT® and Windows 95 operating systems and the Windows graphical environment, the data buffer can reside in a static data area or in a globally allocated area. The data buffer must fit entirely within this area.

<p>
For the OS/2 operating system, the log data buffer must reside on an unnamed, shared segment, which is allocated by the function <b>DosAllocSeg</b> with <b>Flags</b> equal to 1. The log data buffer must fit entirely on the segment.

<p>
The TP must format the error data as a GDS error log variable. For more information, see your IBM SNA manual(s).

</dd>
</dl>
<h4>Return Codes</h4>
<dl>
<dt>
ap_ok</dt>
<dd>
Primary return code; the verb executed successfully.</dd>
<dt>
ap_parameter_check</dt>
<dd>
Primary return code; the verb did not execute because of a parameter error.
<dl>
<dt>
ap_bad_conv_id</dt>
<dd>
Secondary return code; the value of <b>conv_id</b> did not match a conversation identifier assigned by APPC.</dd>
<dt>
ap_bad_tp_id</dt>
<dd>
Secondary return code; the value of <b>tp_id</b> did not match a TP identifier assigned by APPC.</dd>
<dt>
ap_bad_error_direction</dt>
<dd>
Secondary return code; the specified <b>err_dir</b> was not recognized by APPC.</dd>
<dt>
ap_invalid_data_segment</dt>
<dd>
Secondary return code; the error data for the log file was longer than the segment allocated to contain the error data, or the address of the error data buffer was wrong.</dd>
<dt>
ap_send_error_bad_type</dt>
<dd>
Secondary return code; the value of <b>err_type</b> was invalid.</dd>
<dt>
ap_send_error_log_ll_wrong</dt>
<dd>
Secondary return code; the LL field of the error log GDS variable did not match the actual length of the data.
</dd>
</dl>
</dd>
</dl>
<p>
The following return codes can be generated when <b>SEND_ERROR</b> is issued in any allowed state:
<dl>
<dt>
ap_comm_subsystem_abended</dt>
<dd>
Primary return code; indicates one of the following conditions:
<ul>
<li>
The node used by this conversation encountered an ABEND.</li>
<li>
The connection between the TP and the PU 2.1 node has been broken (a LAN error).</li>
<li>
The SnaBase at the TP's computer encountered an ABEND.</li>
</ul>

<p>
The system administrator should examine the error log to determine the reason for the ABEND.
</dd>
<dt>
ap_comm_subsystem_not_loaded</dt>
<dd>
Primary return code; a required component could not be loaded or has terminated while processing the verb. Thus, communication could not take place. Contact the system administrator for corrective action.
<p>
When this return code is used with <b>ALLOCATE</b>, it may indicate that no communications subsystem could be found to support the local LU. (For example, the local LU alias specified with <b>TP_STARTED</b> is incorrect or has not been configured.) Note that if <b>lu_alias</b> or <b>mode_name</b> is fewer than eight characters, you must ensure that these fields are filled with spaces to the right. This error is returned if these parameters are not filled with spaces, since there is no node available that can satisfy the <b>ALLOCATE</b> request.

<p>
When <b>ALLOCATE</b> produces this return code for a Microsoft® SNA Server Client system configured with multiple nodes, there are two secondary return codes as follows:

<dl>
<dt>
0x<small>f0000001</small></dt>
<dd>
Secondary return code; no nodes have been started.</dd>
<dt>
0x<small>f0000002</small></dt>
<dd>
Secondary return code; at least one node has been started, but the local LU (when <b>TP_STARTED</b> is issued) is not configured on any active nodes. The problem could be either of the following:
<table cellspacing=4 cols=1>
<tr valign=top>
<td width=100%><font face="Symbol">·</font>&nbsp;&nbsp;&nbsp;&nbsp;The node with the local LU is not started.</td>
</tr>
<tr valign=top>
<td width=100%><font face="Symbol">·</font>&nbsp;&nbsp;&nbsp;&nbsp;The local LU is not configured.</td>
</tr>
</table><br>

</dd>
</dl>
</dd>
<dt>
ap_conv_failure_no_retry</dt>
<dd>
Primary return code; the conversation was terminated because of a permanent condition, such as a session protocol error. The system administrator should examine the system error log to determine the cause of the error. Do not retry the conversation until the error has been corrected.</dd>
<dt>
ap_conv_failure_retry</dt>
<dd>
Primary return code; the conversation was terminated because of a temporary error. Restart the TP to see if the problem occurs again. If it does, the system administrator should examine the error log to determine the cause of the error.</dd>
<dt>
ap_conversation_type_mixed</dt>
<dd>
Primary return code; the TP has issued both basic and mapped conversation verbs. Only one type can be issued in a single conversation.</dd>
<dt>
ap_invalid_verb_segment</dt>
<dd>
Primary return code; the VCB extended beyond the end of the data segment.</dd>
<dt>
ap_stack_too_small</dt>
<dd>
Primary return code; the stack size of the application is too small to execute the verb. Increase the stack size of your application.</dd>
<dt>
ap_conv_busy</dt>
<dd>
Primary return code; there can only be one outstanding conversation verb at a time on any conversation. This may occur if the local TP has multiple threads, and more than one thread is issuing APPC calls using the same <b>conv_id</b>.</dd>
<dt>
ap_thread_blocking</dt>
<dd>
Primary return code; the calling thread is already in a blocking call.</dd>
<dt>
ap_unexpected_dos_error</dt>
<dd>
Primary return code; the operating system has returned an error to APPC while processing an APPC call from the local TP. The operating system return code is returned through the <b>secondary_rc</b>. It appears in Intel byte-swapped order. If the problem persists, consult the system administrator.
</dd>
</dl>
<p>
The following return codes can be generated only if <b>SEND_ERROR</b> is issued in SEND state:
<dl>
<dt>
ap_allocation_error</dt>
<dd>
Primary return code; APPC has failed to allocate a conversation. The conversation state is set to RESET.
<p>
This code may be returned through a verb issued after <a href="appc05a_1ckj.htm"><b>ALLOCATE</b></a>.

<dl>
<dt>
ap_allocation_failure_no_retry</dt>
<dd>
Secondary return code; the conversation cannot be allocated because of a permanent condition, such as a configuration error or session protocol error. To determine the error, the system administrator should examine the error log file. Do not retry the allocation until the error has been corrected.</dd>
<dt>
ap_allocation_failure_retry</dt>
<dd>
Secondary return code; the conversation could not be allocated because of a temporary condition, such as a link failure. The reason for the failure is logged in the system error log. Retry the allocation.</dd>
<dt>
ap_conversation_type_mismatch</dt>
<dd>
Secondary return code; the partner LU or TP does not support the conversation type (basic or mapped) specified in the allocation request.</dd>
<dt>
ap_pip_not_allowed</dt>
<dd>
Secondary return code; the allocation request specified PIP data, but either the partner TP does not require this data, or the partner LU does not support it.</dd>
<dt>
ap_pip_not_specified_correctly</dt>
<dd>
Secondary return code; the partner TP requires PIP data, but the allocation request specified either no PIP data or an incorrect number of parameters.</dd>
<dt>
ap_security_not_valid</dt>
<dd>
Secondary return code; the user identifier or password specified in the allocation request was not accepted by the partner LU.</dd>
<dt>
ap_sync_level_not_supported</dt>
<dd>
Secondary return code; the partner TP does not support the <b>sync_level</b> (AP_NONE or AP_CONFIRM_SYNC_LEVEL) specified in the allocation request, or the <b>sync_level</b> was not recognized.</dd>
<dt>
ap_tp_name_not_recognized</dt>
<dd>
Secondary return code; the partner LU does not recognize the TP name specified in the allocation request.</dd>
<dt>
ap_trans_pgm_not_avail_no_retry</dt>
<dd>
Secondary return code; the remote LU rejected the allocation request because it was unable to start the requested partner TP. The condition is permanent. The reason for the error may be logged on the remote node. Do not retry the allocation until the error has been corrected.</dd>
<dt>
ap_trans_pgm_not_avail_retry</dt>
<dd>
Secondary return code; the remote LU rejected the allocation request because it was unable to start the requested partner TP. The condition may be temporary, such as a time-out. The reason for the error may be logged on the remote node. Retry the allocation.
</dd>
</dl>
</dd>
<dt>
ap_prog_error_purging</dt>
<dd>
Primary return code; while in RECEIVE, PENDING, PENDING_POST (Windows NT, Windows 95, and OS/2 only), CONFIRM, CONFIRM_SEND, or CONFIRM_DEALLOCATE state, the partner TP issued <b>SEND_ERROR</b> with <b>err_type</b> set to AP_PROG. Data sent but not yet received is purged.
</dd>
</dl>
<p>
The following return codes can be generated only if <b>SEND_ERROR</b> is issued in SEND state:
<dl>
<dt>
ap_dealloc_abend_prog</dt>
<dd>
Primary return code; the conversation has been deallocated for one of the following reasons:
<ul>
<li>
The partner TP has issued <a href="appc05a_4ndv.htm"><b>DEALLOCATE</b></a> with<b> dealloc_type </b>set to AP_ABEND_PROG.</li>
<li>
The partner TP has encountered an ABEND, causing the partner LU to send a <b>DEALLOCATE</b> request.</li>
</ul>
</dd>
<dt>
ap_dealloc_abend_svc</dt>
<dd>
Primary return code; the conversation has been deallocated because the partner TP issued <b>DEALLOCATE</b> with <b>dealloc_type</b> set to AP_ABEND_SVC.</dd>
<dt>
ap_dealloc_abend_timer</dt>
<dd>
Primary return code; the conversation has been deallocated because the partner TP issued <b>DEALLOCATE</b> with <b>dealloc_type</b> set to AP_ABEND_TIMER.</dd>
<dt>
ap_svc_error_purging</dt>
<dd>
Primary return code; the partner TP (or partner LU) issued <b>SEND_ERROR</b> with <b>err_type</b> set to AP_SVC while in RECEIVE, PENDING_POST (Windows NT, Windows 95, and OS/2 only), CONFIRM, CONFIRM_SEND, or CONFIRM_DEALLOCATE state. Data sent to the partner TP may have been purged.
</dd>
</dl>
<p>
The following return code can be generated only if <b>SEND_ERROR</b> is issued in RECEIVE state:
<dl>
<dt>
ap_dealloc_normal</dt>
<dd>
Primary return code; this return code does not indicate an error.
<p>
The partner TP issued <a href="appc05a_4ndv.htm"><b>DEALLOCATE</b></a> with <b>dealloc_type</b> set to one of the following:

<ul>
<li>
AP_FLUSH</li>
<li>
AP_SYNC_LEVEL with the synchronization level of the conversation specified as AP_NONE</li>
</ul>
</dd>
</dl>
<h4>Remarks</h4>
<p>
The conversation can be in any state except RESET when the TP issues this verb. The conversation state must be SEND_PENDING if <b>err_dir</b> is used.</p>
<p>
The local TP sends the error notification immediately to the partner TP; it does not hold the information in the local LU's send buffer.</p>
<p>
Upon successful execution of this verb, the conversation is in SEND state for the local TP and in RECEIVE state for the partner TP.</p>
<p>
The new state is determined by <b>primary_rc</b>. Possible state changes are summarized in the following table.</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=64%>primary_rc</th>
<th align=left width=36%>New state</th>
</tr>
<tr valign=top>
<td width=64%>ap_ok</td>
<td width=36%>SEND</td>
</tr>
<tr valign=top>
<td width=64%>ap_allocation_error</td>
<td width=36%>RESET</td>
</tr>
<tr valign=top>
<td width=64%>ap_conv_failure_retry</td>
<td width=36%>RESET</td>
</tr>
<tr valign=top>
<td width=64%>ap_conv_failure_no_retry</td>
<td width=36%>RESET</td>
</tr>
<tr valign=top>
<td width=64%>ap_dealloc_abend</td>
<td width=36%>RESET</td>
</tr>
<tr valign=top>
<td width=64%>ap_dealloc_abend_prog</td>
<td width=36%>RESET</td>
</tr>
<tr valign=top>
<td width=64%>ap_dealloc_abend_svc</td>
<td width=36%>RESET</td>
</tr>
<tr valign=top>
<td width=64%>ap_dealloc_abend_timer</td>
<td width=36%>RESET</td>
</tr>
<tr valign=top>
<td width=64%>ap_dealloc_normal</td>
<td width=36%>RESET</td>
</tr>
<tr valign=top>
<td width=64%>ap_prog_error_purging</td>
<td width=36%>RECEIVE</td>
</tr>
<tr valign=top>
<td width=64%>ap_svc_error_purging</td>
<td width=36%>RECEIVE</td>
</tr>
</table><br>
<p>
If the conversation is in RECEIVE state when the TP issues <b>SEND_ERROR</b>, incoming data is purged by APPC. This data includes:
<ul>
<li>
Data sent by <a href="appc05b_7wbn.htm"><b>SEND_DATA</b></a>.</li>
<li>
Return code indicators.</li>
<li>
Confirmation requests.</li>
<li>
Deallocation requests.</li>
</ul>
<p>
APPC does not purge an incoming request-to-send indicator. APPC replaces purged incoming return code indicators with other return codes. The primary return code ap_ok replaces the following purged return code indicators:</p>
<p class=indent1>
AP_PROG_ERROR_NO_TRUNC</p>
<p class=indent1>
AP_PROG_ERROR_PURGING</p>
<p class=indent1>
AP_PROG_ERROR_TRUNC</p>
<p class=indent1>
AP_SVC_ERROR_NO_TRUNC</p>
<p class=indent1>
AP_SVC_ERROR_PURGING</p>
<p class=indent1>
AP_SVC_ERROR_TRUNC</p>
<p>
The primary return code ap_dealloc_normal replaces the following purged return code indicators:</p>
<p class=indent1>
AP_ALLOCATION_ERROR</p>
<p class=indent1>
AP_ALLOCATION_FAILURE_NO_RETRY</p>
<p class=indent1>
AP_ALLOCATION_FAILURE_RETRY</p>
<p class=indent1>
AP_CONVERSATION_TYPE_MISMATCH</p>
<p class=indent1>
AP_DEALLOC_ABEND</p>
<p class=indent1>
AP_DEALLOC_ABEND_PROG</p>
<p class=indent1>
AP_DEALLOC_ABEND_SVC</p>
<p class=indent1>
AP_DEALLOC_ABEND_TIMER</p>
<p class=indent1>
AP_PIP_NOT_ALLOWED</p>
<p class=indent1>
AP_PIP_NOT_SPECIFIED_CORRECTLY</p>
<p class=indent1>
AP_SECURITY_NOT_VALID</p>
<p class=indent1>
AP_SYNC_LEVEL_NOT_SUPPORTED</p>
<p class=indent1>
AP_TP_NAME_NOT_RECOGNIZED</p>
<p class=indent1>
AP_TRANS_PGM_NOT_AVAIL_NO_RETRY</p>
<p class=indent1>
AP_TRANS_PGM_NOT_AVAIL_RETRY</p>
<p>
When the conversation is in SEND_PENDING state, APPC reports the following return codes to the partner TP based on the value in <b>err_dir</b>:
<dl>
<dt>
ap_prog_error_purging</dt>
<dd>
The local TP issued <b>SEND_ERROR</b> with RECEIVE as the <b>err_dir</b>.</dd>
<dt>
ap_prog_error_no_trunc</dt>
<dd>
The local TP issued <b>SEND_ERROR</b> with SEND as the <b>err_dir</b>.</dd>
<dt>
ap_svc_error_purging</dt>
<dd>
The local TP issued <b>SEND_ERROR</b> with RECEIVE as the <b>err_dir.</b></dd>
<dt>
ap_svc_error_no_trunc</dt>
<dd>
The local TP issued <b>SEND_ERROR</b> with SEND as the <b>err_dir</b>.
</dd>
</dl>
<p>&nbsp;</p></body>
</HTML>
