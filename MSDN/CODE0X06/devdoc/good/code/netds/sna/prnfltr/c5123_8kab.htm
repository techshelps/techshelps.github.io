<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>NTFILTER.C</title>
<link disabled rel=stylesheet href=../../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>
<h2><a name="_code_context5123"></a>NTFILTER.C</h2>
<pre><code>#include "NtFilter.h" <br> <br> <br>int SessId =156789; <br>void *  Uid = (void *)&amp;SessId ; <br>FILE *f; <br> <br> <br>BOOL APIENTRY DllMain( HANDLE hModule,DWORD ul_reason_for_call,LPVOID lpReserved ) <br>{ <br>    switch( ul_reason_for_call ) <br>{ <br>case DLL_PROCESS_ATTACH: <br>trace("Initialization - Process Attach"); <br>break; <br>case DLL_THREAD_ATTACH: <br>trace("Thread Attach"); <br>   break; <br>case DLL_THREAD_DETACH: <br>trace("Thread Detach"); <br>    break; <br>case DLL_PROCESS_DETACH: <br>trace("Process Detach"); <br>    break; <br>    } <br>return TRUE; <br>} <br> <br>__declspec( dllexport ) void * WINAPI PrtFilterAlloc(DWORD BufLen) <br>{ <br>/* MSFT - 3 lines for Debug OutPut - START */ <br>void * pBuf ; <br>char TrBuf[50] ; <br>trace("FilterAlloc"); <br>/* MSFT - 3 lines for Debug OutPut - END */ <br> <br>pBuf = malloc(BufLen) ; <br> <br>/* MSFT - 2 lines for Debug OutPut - START */ <br>sprintf (TrBuf,"%x ",pBuf); <br>trace (TrBuf) ; <br>/* MSFT - 2 lines for Debug OutPut - END */ <br> <br>return(pBuf); <br>} <br> <br>__declspec( dllexport ) void WINAPI PrtFilterFree(void *pBuf) <br>{ <br>/* MSFT - 4 lines for Debug OutPut - START */ <br>char TrBuf[50] ; <br>trace("FilterFree"); <br>sprintf (TrBuf,"%x ",pBuf); <br>trace (TrBuf) ; <br>/* MSFT - 4 lines for Debug OutPut - END */ <br> <br>free(pBuf); <br> <br>/* MSFT - 1 line for Debug OutPut - START */ <br>trace("  Buffer library"); <br>/* MSFT - 1 line for Debug OutPut - END */ <br> <br>return; <br>} <br> <br>__declspec( dllexport ) void   WINAPI PrtFilterJobData(void *UniqueID, char **pBufPtr,DWORD *pBufLen) <br>{ <br>/* MSFT - 4 lines for Debug OutPut - START */ <br>char TrBuf[50] ; <br>trace("FilterJobData"); <br>sprintf (TrBuf,"%d ",*pBufLen); <br>trace (TrBuf) ; <br>/* MSFT - 4 lines for Debug OutPut - END */ <br> <br>if (*pBufLen &gt; 49) <br>{ <br>strcpy(*pBufPtr,"- FILTER - FilterJobData --- FilterJobData --- Fil"); <br>*pBufLen=strlen(*pBufPtr); <br>} <br>else <br>/* MSFT - 1 line for Debug OutPut - START */ <br>trace("Buffer too small - No modifications to the original data"); <br>/* MSFT - 1 line for Debug OutPut - END */ <br>return; <br>} <br> <br>__declspec( dllexport ) void *WINAPI PrtFilterJobStart(char *SessionName,DWORD LUType,char** pBufPtr,DWORD *pBuflen) <br>{ <br>/* MSFT - 1 line for Debug OutPut - START */ <br>trace("FilterJobStart"); <br>/* MSFT - 1 line for Debug OutPut - END */ <br> <br>return((void *)(Uid)); <br>} <br> <br>__declspec( dllexport ) void *WINAPI PrtFilterJobEnd(char *SessionName,char** pBufPtr,DWORD *pBufLen) <br>{ <br>/* MSFT - 1 line for Debug OutPut - START */ <br>trace("FilterJobEnd"); <br>/* MSFT - 1 line for Debug OutPut - END */ <br> <br>return((void *)(Uid)); <br>} <br> <br>void trace(char *text) <br>{ <br>f= fopen("c:\\trfilter.txt","a+t"); <br>fprintf(f,"NTFILTER : %s \n",text); <br>fclose(f); <br>} </code></pre>
<p>&nbsp;</p></body>
</HTML>
