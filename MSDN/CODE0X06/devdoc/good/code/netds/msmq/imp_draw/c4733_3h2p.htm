<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>MQEVENTHANDLER.CPP</title>
<link disabled rel=stylesheet href=../../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>
<h2><a name="_code_context4741"></a>MQEVENTHANDLER.CPP</h2>
<pre><code><br>#include "stdafx.h" <br>#include &lt;afxdisp.h&gt; <br>#include "Imp_Draw.h" <br>#include "Imp_DrawDlg.h" <br>#import &lt;mqoa.dll&gt; no_namespace <br> <br>//#include "MQEventHandler.h" <br> <br> <br>BEGIN_DISPATCH_MAP(CMSMQEventHandler, CCmdTarget) <br>DISP_FUNCTION_ID(CMSMQEventHandler, "Arrived", 0, Arrived, VT_EMPTY, VTS_DISPATCH VTS_I4) <br>DISP_FUNCTION_ID(CMSMQEventHandler, "ArrivedError", 1, ArrivedError, VT_EMPTY, VTS_DISPATCH VTS_I4 VTS_I4) <br>END_DISPATCH_MAP() <br> <br> <br>CMSMQEventHandler::CMSMQEventHandler() <br>{ <br>EnableAutomation(); <br>dwMyCookie = 0; <br>pMyCP = NULL; <br>} <br> <br>CMSMQEventHandler::~CMSMQEventHandler() <br>{ <br>if (pMyCP) <br>{ <br>pMyCP-&gt;Unadvise(dwMyCookie); <br>pMyCP-&gt;Release(); <br>}; <br> <br>} <br> <br>void CMSMQEventHandler::Arrived(IDispatch* pdispQueue, long lCursor) <br>{ <br>CImp_DrawDlg* pDlg = (CImp_DrawDlg*) AfxGetApp()-&gt;m_pMainWnd; <br>pDlg-&gt;Arrived(pdispQueue, S_OK, lCursor); <br>} <br> <br>void CMSMQEventHandler::ArrivedError(IDispatch* pdispQueue, long lErrorCode, long lCursor) <br>{ <br>CImp_DrawDlg* pDlg = (CImp_DrawDlg*) AfxGetApp()-&gt;m_pMainWnd; <br>pDlg-&gt;Arrived(pdispQueue, lErrorCode, lCursor); <br>} <br> <br>HRESULT CMSMQEventHandler::AdviseSource(IDispatch* pDispatch) <br>{ <br>LPCONNECTIONPOINTCONTAINERpCPCont = NULL; <br>HRESULThr; <br> <br>hr = pDispatch-&gt;QueryInterface(IID_IConnectionPointContainer, (void**) &amp;pCPCont); <br>if (FAILED(hr)) <br>return hr; <br> <br>hr = pCPCont-&gt;FindConnectionPoint(__uuidof(_DMSMQEventEvents), &amp;pMyCP); <br>pCPCont-&gt;Release(); <br>if (FAILED(hr)) <br>return hr; <br> <br>return pMyCP-&gt;Advise(GetIDispatch(TRUE), &amp;dwMyCookie); <br>}; <br> <br> <br> <br> </code></pre>
<p>&nbsp;</p></body>
</HTML>
