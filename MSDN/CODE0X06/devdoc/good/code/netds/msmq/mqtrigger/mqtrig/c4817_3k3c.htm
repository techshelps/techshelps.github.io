<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>FRMMONITOR.FRM</title>
<link disabled rel=stylesheet href=../../../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>
<h2><a name="_code_context4818"></a>FRMMONITOR.FRM</h2>
<pre><code>VERSION 5.00 <br>Object = "{6B7E6392-850A-101B-AFC0-4210102A8DA7}#1.2#0"; "COMCTL32.OCX" <br>Begin VB.Form frmMonitor  <br>   Caption         =   "Trigger Monitor" <br>   ClientHeight    =   3420 <br>   ClientLeft      =   60 <br>   ClientTop       =   345 <br>   ClientWidth     =   5775 <br>   LinkTopic       =   "Form1" <br>   ScaleHeight     =   3420 <br>   ScaleWidth      =   5775 <br>   StartUpPosition =   3  'Windows Default <br>   Begin VB.CommandButton cmdBeginMonitor  <br>      Caption         =   "Begin Monitor" <br>      Height          =   495 <br>      Left            =   3120 <br>      TabIndex        =   13 <br>      Top             =   2880 <br>      Width           =   1215 <br>   End <br>   Begin VB.TextBox txtMsgCount  <br>      Height          =   375 <br>      Left            =   4560 <br>      TabIndex        =   12 <br>      Top             =   1920 <br>      Width           =   975 <br>   End <br>   Begin VB.TextBox txtPollingFrequency  <br>      Height          =   375 <br>      Left            =   2160 <br>      TabIndex        =   11 <br>      Top             =   1920 <br>      Width           =   1215 <br>   End <br>   Begin VB.CommandButton cmdPollingConfig  <br>      Caption         =   "Polling Frequency" <br>      Height          =   495 <br>      Left            =   120 <br>      TabIndex        =   9 <br>      Top             =   2880 <br>      Width           =   1575 <br>   End <br>   Begin VB.Timer Timer1  <br>      Left            =   240 <br>      Top             =   720 <br>   End <br>   Begin VB.CommandButton cmdClose  <br>      Caption         =   "Close" <br>      Height          =   495 <br>      Left            =   4440 <br>      TabIndex        =   0 <br>      Top             =   2880 <br>      Width           =   1215 <br>   End <br>   Begin VB.CommandButton cmdConfigure  <br>      Caption         =   "Settings" <br>      Height          =   495 <br>      Left            =   1800 <br>      TabIndex        =   1 <br>      Top             =   2880 <br>      Width           =   1215 <br>   End <br>   Begin ComctlLib.ProgressBar ProgressBar1  <br>      Height          =   375 <br>      Left            =   960 <br>      TabIndex        =   4 <br>      Top             =   1200 <br>      Width           =   4575 <br>      _ExtentX        =   8070 <br>      _ExtentY        =   661 <br>      _Version        =   327682 <br>      Appearance      =   1 <br>   End <br>   Begin VB.TextBox txtQueueName  <br>      Enabled         =   0   'False <br>      Height          =   375 <br>      Left            =   960 <br>      TabIndex        =   2 <br>      Top             =   240 <br>      Width           =   4575 <br>   End <br>   Begin VB.Label Label4  <br>      Caption         =   "Message Count:" <br>      Height          =   375 <br>      Left            =   3720 <br>      TabIndex        =   14 <br>      Top             =   1920 <br>      Width           =   735 <br>   End <br>   Begin VB.Label Label3  <br>      Caption         =   "Polling Frequency (sec) :" <br>      Height          =   255 <br>      Left            =   240 <br>      TabIndex        =   10 <br>      Top             =   2040 <br>      Width           =   1815 <br>   End <br>   Begin VB.Label Label2  <br>      Alignment       =   1  'Right Justify <br>      Caption         =   "Count:" <br>      Height          =   255 <br>      Left            =   120 <br>      TabIndex        =   8 <br>      Top             =   1320 <br>      Width           =   615 <br>   End <br>   Begin VB.Label lblProgressMax  <br>      Caption         =   "Max" <br>      Height          =   255 <br>      Left            =   5040 <br>      TabIndex        =   7 <br>      Top             =   840 <br>      Width           =   495 <br>   End <br>   Begin VB.Label lblThreshold  <br>      Caption         =   "Threshold" <br>      Height          =   255 <br>      Left            =   3600 <br>      TabIndex        =   6 <br>      Top             =   840 <br>      Width           =   735 <br>   End <br>   Begin VB.Label lblProgress0  <br>      Caption         =   "0" <br>      Height          =   255 <br>      Left            =   960 <br>      TabIndex        =   5 <br>      Top             =   840 <br>      Width           =   375 <br>   End <br>   Begin VB.Label Label1  <br>      Alignment       =   1  'Right Justify <br>      Caption         =   "Queue:" <br>      Height          =   255 <br>      Left            =   120 <br>      TabIndex        =   3 <br>      Top             =   360 <br>      Width           =   615 <br>   End <br>End <br>Attribute VB_Name = "frmMonitor" <br>Attribute VB_GlobalNameSpace = False <br>Attribute VB_Creatable = False <br>Attribute VB_PredeclaredId = True <br>Attribute VB_Exposed = False <br>    Public qTargetQueue As New MSMQQueue <br>    Public qinfoTargetQueue As New MSMQQueueInfo <br> <br>Private Sub cmdBeginMonitor_Click() <br>    If Timer1.Enabled Then <br>        Timer1.Enabled = False <br>        cmdBeginMonitor.Caption = "Begin Monitor" <br>    Else <br>        Timer1.Enabled = True <br>        cmdBeginMonitor.Caption = "Stop Monitor" <br>    End If <br>End Sub <br> <br>Private Sub cmdClose_Click() <br>    'Clean up and exit <br>    Unload frmConfig <br>    Unload frmMonitor <br>End Sub <br> <br>Private Sub cmdConfigure_Click() <br>    frmConfig.Show vbModal <br>    InitGlobals <br>    InitControls <br>End Sub <br> <br>Sub InitControls() <br>    'initialize controls <br>    txtQueueName = sQueueName <br>    txtPollingFrequency = iPollingFrequency <br>    lblProgress0 = "0" <br>    lblThreshold = iThreshold <br>    lblProgressMax = (1 + iThreshold) * 3 \ 2 <br>    lblProgressMax.Refresh <br>    ProgressBar1.Min = 0 <br>    ProgressBar1.Max = (1 + iThreshold) * 3 \ 2 <br>    Timer1.Enabled = False <br>    Timer1.Interval = iPollingFrequency * 1000 <br>End Sub <br> <br>Private Sub cmdPollingConfig_Click() <br>    frmPollingConfig.Show vbModal <br>    iPollingFrequency = GetSetting("MQTrigger", "Settings", "PollingFrequency") <br>    txtPollingFrequency = iPollingFrequency <br>    Timer1.Interval = iPollingFrequency * 1000 <br>End Sub <br> <br>Private Sub OpenQueue() <br>    On Error GoTo ErrHandler <br>     <br>    'verify queue exists <br>    qinfoTargetQueue.PathName = txtQueueName <br>    Set qTargetQueue = qinfoTargetQueue.Open(Access:=MQ_PEEK_ACCESS, ShareMode:=MQ_DENY_NONE) <br>    qTargetQueue.Close <br>    Exit Sub <br>ErrHandler: <br>    MsgBox txtQueueName &amp; " is an invalid Queue pathname", vbOKOnly, "Queue Open Failure" <br>    cmdConfigure_Click <br>    Resume <br> <br>End Sub <br> <br>Private Sub Form_Load() <br>    InitControls <br>    OpenQueue <br>End Sub <br> <br>Private Sub Timer1_Timer() <br>    Dim dwNumMessages As Long <br>    Dim TriggerMsg As String <br>     <br>    dwNumMessages = GetPerfmonInfo(qinfoTargetQueue.PathName) <br>    If ProgressBar1.Max &lt; dwNumMessages Then <br>        ' max the bar do nothing else (to avoid overflowing the progress bar) <br>        ProgressBar1 = ProgressBar1.Max <br>    Else <br>        ProgressBar1 = dwNumMessages <br>    End If <br>    txtMsgCount = dwNumMessages <br>    If dwNumMessages &gt; iThreshold Then <br>        TriggerMsg = "Trigger: " &amp; txtMsgCount &amp; " messages in queue." <br>        MsgBox TriggerMsg, vbSystemModal, "Trigger Event" <br>    End If <br>End Sub </code></pre>
<p>&nbsp;</p></body>
</HTML>
