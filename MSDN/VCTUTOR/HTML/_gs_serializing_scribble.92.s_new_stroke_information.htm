<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Serializing Scribble's New Stroke Information</title>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>
<font face="verdana,arial,helvetica" size="2"><h1><a name="_gs_serializing_scribble.92.s_new_stroke_information"></a>Serializing Scribble’s New Stroke Information</h1>
<p>
All of these code changes, including the change to the mapping mode, invalidate previous Scribble file formats. For example, the x and y-coordinates of earlier Scribble drawings were based on pixel locations. Now they are interpreted according to 1/100ths of an inch. Also, because of the metric mapping mode, the sign of the y-coordinate reverses, and what used to be a positive value is now negative. To compensate for this reversal, you’ll modify the <code>m_rectBounding</code> variable, which is a member of <code>CStroke</code>, the class that stores Scribble’s stroke data.</p>
<p>
What does this mean? If the new version of Scribble tries to read in stroke data from an older version of Scribble, it will still try to draw the stroke, but the old stroke data might map to an area, for example, outside the current window. </p>
<p>
Recall that, earlier in the tutorial, when you <a href="_gs_define_a_hint_for_scribble.htm">defined a hint for Scribble</a> in Lesson 8, you modified the way Scribble stored strokes by adding the member variable, <code>m_rectBounding</code>. In that tutorial step, you incremented the schema number of the <b>IMPLEMENT_SERIAL</b> macro to distinguish between stroke data from different versions of Scribble. Because of the code changes you’ll make in following topics, you need to increment this schema number again. </p>
<p class=indent>
<B><b>Note</b></B>&nbsp;&nbsp;&nbsp;After marking the version of Scribble data in this way, you’ll receive an error message “Unrecognized file format” if you try to load drawings from previous versions of Scribble. This is preferable to opening a drawing and seeing nothing on the screen.</p>
<p class=label>
<b>To increment Scribble’s serialization</b>
<ul type=disc>
<li>
Open ScribbleDoc.cpp, search for the <b>IMPLEMENT_SERIAL</b> macro, and change the schema number parameter to 3.<pre><code>IMPLEMENT_SERIAL( CStroke, CObject, 3 )
</code></pre>
</li>
</ul>
</font></BODY>
</HTML>
