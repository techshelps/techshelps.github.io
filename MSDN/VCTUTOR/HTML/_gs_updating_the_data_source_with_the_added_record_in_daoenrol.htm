<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Updating the Data Source with the Added Record in DaoEnrol</title>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>
<font face="verdana,arial,helvetica" size="2"><h1><a name="_gs_updating_the_data_source_with_the_added_record_in_daoenrol"></a>Updating the Data Source with the Added Record in DaoEnrol</h1>
<p class=indent>
<B><b>Note</b></B>&nbsp;&nbsp;&nbsp;You should have completed the topics <a href="_gs_adding_and_deleting_records.htm">Adding and Deleting Records</a> through <a href="_gs_implementing_the_add_command.htm">Implementing the Add Command</a> in Lesson 4 of the Enroll tutorial before starting this topic.</p>
<p>
Add mode is completed when the user moves off the record. DaoEnrol implements this by overriding the <b>CDaoRecordView::OnMove</b> member function. </p>
<h3>Suggested Reading</h3>
<ul type=disc>
<li>
<object id=alink_1 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="DefaultTopic" value="_topic_not_found.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_MFC_CDaoRecordView.3a3a.OnMove">
</object><a href=JavaScript:alink_1.Click()>CDaoRecordView::OnMove</a>, <i>Microsoft Foundation Class Reference</i><br><br></li>
<li>
<object id=alink_2 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="DefaultTopic" value="_topic_not_found.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="wizbar">
</object><a href=JavaScript:alink_2.Click()>Using WizardBar</a>, <i>Visual C++ Programmer’s Guide</i></li>
</ul>
<p class=label>
<b>To implement Add functionality in the OnMove function override</b>
<ol>
<li>
From the <b>View</b> menu, click <b>ClassWizard</b>.<br><br></li>
<li>
Click the <b>Message Maps</b> tab, if necessary.<br><br></li>
<li>
In the <b>Class name</b> box, click CSectionForm.<br><br></li>
<li>
In the <b>Object IDs</b> list, select <code>CSectionForm</code>.<br><br></li>
<li>
In the <b>Messages</b> box, select <code>OnMove</code>.<br><br></li>
<li>
Click <b>Add Function</b>.<br><br></li>
<li>
Click <b>Edit code</b> to jump to the starter <code>OnMove</code> function, and replace the highlighted //TODO comment with the following code:<pre><code>&nbsp;&nbsp;&nbsp;&nbsp;if ( m_bAddMode )
 &nbsp;&nbsp; {
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( !UpdateData( ) )
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return FALSE;

 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m_pSet-&gt;Update( );
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; catch( CDaoException* e )
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AfxMessageBox( e-&gt;
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m_pErrorInfo-&gt;m_strDescription );
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e-&gt;Delete( );
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return FALSE;
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m_pSet-&gt;Requery( );
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UpdateData( FALSE );
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m_ctlSection.SetReadOnly( TRUE );
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m_bAddMode = FALSE;
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return TRUE;
 &nbsp;&nbsp; }

 &nbsp;&nbsp; else
 &nbsp;&nbsp; {
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return CDaoRecordView::OnMove( nIDMoveCommand );
 &nbsp;&nbsp; }
</code></pre>
</li>
</ol>
<p>
Error handling in the DAO database classes differs from that of the ODBC database classes. The implementation of <b>else</b> in this code block requires a message box with error information to complete the <b>if/else</b> control structure.</p>
<p>
In its default <b>CDaoRecordView</b> implementation, <b>OnMove</b> moves to the next, previous, first, or last record. If the application has changed the recordset field data members for the current record before the move, the framework updates the data source before moving to another record.</p>
<p>
Normally, the <b>Move</b> commands behave as you might expect: <b>MoveNext</b> moves to the next record, and so on. But as a consequence of the decision to <b>Requery</b> during the <b>Add</b> operation, when the user chooses any move command when adding a record, DaoEnrol always effectively moves to the first record. That’s because requerying the recordset automatically sets the recordset to the first record.</p>
</font></BODY>
</HTML>
