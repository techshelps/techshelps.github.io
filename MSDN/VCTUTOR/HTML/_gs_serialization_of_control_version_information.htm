<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Serialization of Control Version Information</title>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>
<font face="verdana,arial,helvetica" size="2">
<h1><a name="_gs_serialization_of_control_version_information"></a>Serialization of Control Version Information</h1>
<p>
Serialization is the process by which persistent data is loaded or stored through an exchange object. One type of exchange object is used to initialize a control's persistent properties to default values; another type is used to load and store persistent data in persistent storage. A control's persistent data is serialized in the <b>DoPropExchange</b> function.</p>
<p>
The Circle control's version, stock properties, and persistent custom properties, in that order, are serialized in the <code>DoPropExchange</code> function in CIRCCTL.CPP.</p>
<pre><code>void CCircCtrl::DoPropExchange(CPropExchange* pPX)
{
 &nbsp;&nbsp; ExchangeVersion(pPX, MAKELONG(_wVerMinor, _wVerMajor));
 &nbsp;&nbsp; COleControl::DoPropExchange(pPX);

 &nbsp;&nbsp; PX_Bool(pPX, _T("CircleShape"), m_circleShape, TRUE);
 &nbsp;&nbsp; PX_Short(pPX, _T("CircleOffset"), m_circleOffset, 0);
 &nbsp;&nbsp; PX_Long(pPX, _T("FlashColor"), (long &amp;)m_flashColor, RGB(0xFF, 0x00, 0x00));
 &nbsp;&nbsp; PX_String(pPX, _T("Note"), m_note, _T(""));
}
</code></pre>
<p>
When the Circle control project was created, ControlWizard produced the code that calls the <code>ExchangeVersion</code> and <b>COleControl::DoPropExchange</b> functions. ControlWizard also defined the global constants <code>_wVerMajor</code> and <code>_wVerMinor</code> in CIRC.CPP as 1 and 0 respectively, which represents version 1.0.</p>
<p>
The <code>ExchangeVersion</code> function serializes a control's version and sets the version used by the exchange object, <code>pPX</code>. This call should always be made before any version-sensitive persistent data is serialized. When persistent data is being initialized or written into persistent storage through the exchange object, the exchange object's version is set to the version parameter passed to the function. When persistent data is being read from persistent storage through the exchange object, the exchange object's version is read from persistent storage.</p>
<p>
The <b>COleControl::DoPropExchange</b> function serializes all of a control's stock properties. The <b>PX_</b> functions serialize each of the Circle control's persistent custom properties. These calls were added in previous lessons of the tutorial.</p>
</font></BODY>
</HTML>
