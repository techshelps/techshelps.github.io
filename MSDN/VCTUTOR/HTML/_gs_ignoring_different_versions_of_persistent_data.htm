<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Ignoring Different Versions of Persistent Data</title>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>
<font face="verdana,arial,helvetica" size="2">
<h1><a name="_gs_ignoring_different_versions_of_persistent_data"></a>Ignoring Different Versions of Persistent Data</h1>
<p>
When a control is requested to load persistent data through an exchange object with a version different from the control, it must do something reasonable to set the values of its persistent custom properties. The simplest approach is to ignore the exchange object and initialize each persistent custom property to its default value by modifying the Circle control's <code>DoPropExchange</code> function. The changes involve using two member functions of the exchange object, <code>GetVersion</code> and <code>IsLoading</code>.</p>
<p>
The <code>GetVersion</code> member function returns the exchange object's version. The exchange object's <code>IsLoading</code> member function returns <b>TRUE</b> if the control is to load values through the exchange object. It returns <b>FALSE</b> if the control is to store values through the exchange object.</p>
<p>
The <code>GetVersion</code> function is used to compare the exchange object's version and the control's version. If the versions are the same, each persistent custom property is serialized as usual. If the versions are different and the <code>IsLoading</code> function returns <b>TRUE</b>, the Circle control's persistent properties are initialized to their default values. If the versions are different and the <code>IsLoading</code> function returns <b>FALSE</b>, the Circle control ignores the exchange object. Technically, this situation never occurs, because the Circle control always stores the current version of persistent data.</p>
<p>
Modify the <code>DoPropExchange</code> function to look like this:</p>
<pre><code>void CCircCtrl::DoPropExchange(CPropExchange* pPX)
{
 &nbsp;&nbsp; ExchangeVersion(pPX, MAKELONG(_wVerMinor, _wVerMajor));
 &nbsp;&nbsp; COleControl::DoPropExchange(pPX);
 &nbsp;&nbsp; if (pPX-&gt;GetVersion() == (DWORD)MAKELONG(_wVerMinor, _wVerMajor))
 &nbsp;&nbsp; {
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PX_Bool(pPX, _T("CircleShape"), m_circleShape, TRUE);
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PX_Short(pPX, _T("CircleOffset"), m_circleOffset, 0);
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PX_Long(pPX, _T("FlashColor"), (long &amp;)m_flashColor, RGB(0xFF,
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x00, 0x00));
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PX_String(pPX, _T("Note"), m_note, _T(""));
 &nbsp;&nbsp; }
 &nbsp;&nbsp; else
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (pPX-&gt;IsLoading())
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m_circleShape = TRUE;
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m_circleOffset = 0;
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m_flashColor = RGB(0xFF, 0x00, 0x00);
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m_note = _T("");
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
}
</code></pre>
<p>
As described earlier, the <code>ExchangeVersion</code> function sets the exchange object's version. This is the version of persistent data that the control is to load or store through the exchange object. This version is returned by the <code>GetVersion</code> function.</p>
<p>
The control version and stock properties are serialized as usual. The <b>COleControl::DoPropExchange</b> function correctly loads or stores stock property values for different versions because part of what is serialized is information about which stock properties were stored for that version.</p>
<p>
If the exchange object's version and the control's version are the same, the Circle control's persistent custom properties are loaded or stored through the exchange object as usual.</p>
<p>
If the versions are different, and persistent data is to be loaded, all persistent properties are initialized to their default values instead.</p>
<p>
If the versions are different, and persistent data is to be stored, the exchange object is ignored and no persistent data is stored through the exchange object. This case should never happen with the Circle control because the exchange object's version and the control's version may be different only when data is to be loaded through the exchange object. Using <b>FALSE</b> as the third parameter to the <code>ExchangeVersion</code> function allows a control to specify that persistent data should be stored as the same version that was last loaded.</p>
</font></BODY>
</HTML>
