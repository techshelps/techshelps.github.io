<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Check Operations in Advance When Installing</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_logo_check_operations_in_advance_when_installing"></a>Check Operations in Advance When Installing</h3>
<p>
<span style=color:#FF0000>[This is preliminary documentation and subject to change.]</span> </p>
<p>
<b>Requirement&nbsp;&nbsp;</b>(Designed for Microsoft® Windows® Logo)</p>
<p>
The installer must check before starting any operation to ensure that it can complete that operation. The following are requirements based on this principle: 
<ul>
<li>
Installers must fail gracefully in the case where a system component cannot be replaced because file system security prevents an existing file from being overwritten. For example, installers that must overwrite system files should check up-front if the current user is a member of the administrator's local group. This will avoid confusion later by preventing the user from getting file copy errors from which there is no recovery.</li>
<li>
Applications must be tested on Windows NT under non-administrator accounts. An application must run under a user account, but that user must not be able to change the application setup configuration.</li>
<li>
When installing the application, the installer must check for the user privilege level. If the user is not an administrator and the application will work but with limited functionality, the installer must warn the user that only limited functionality will be available since they do not have administrator privileges; the installer must allow them to discontinue the installation.</li>
</ul>
<h4>Remarks</h4>
<p>
The following sample code checks for user privilege level.</p>
<pre><code>//----------------------------------------------------------
// IsAdmin - tests to see if the current user is an admin
//----------------------------------------------------------

BOOL IsAdmin( )
{
    SC_HANDLE hSC;

// Try an Admin Privileged API - if it works, return TRUE, else FALSE
    hSC = OpenSCManager(
        NULL,
        NULL,
        GENERIC_READ | GENERIC_WRITE | GENERIC_EXECUTE  );

    if ( hSC == NULL ) 
        return FALSE;
    CloseServiceHandle( hSC );
    return TRUE;
}</code></pre>
<h4>See Also</h4>
<p>
For more information about how to check the user privilege level, see KB article PSS ID# Q118626. </p>
<p>&nbsp;</p></body>
</HTML>
