<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>A.1.3.3  SCSI Class Driver’s GetCapabilities Routine</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H4><A NAME="DDK_SCSI_Class_Drivers_GetCapabilities_Routine_KG"></A>A.1.3.3  SCSI Class Driver’s GetCapabilities Routine</H4>
<P>
For data transfer operations, SCSI class drivers need configuration
information about each HBA driving a bus to which their devices are attached.
Consequently, a class driver either calls a GetCapabilities routine or
implements the same functionality in its DriverEntry routine. 
<P>
A GetCapabilities routine builds and sets up an IRP_MJ_DEVICE_CONTROL request
with the I/O control code IOCTL_SCSI_GET_CAPABILITIES for the port driver. The
class driver inspects the returned IO_SCSI_CAPABILITIES-type information to
determine the following: 
<UL>
<LI>
The maximum number of bytes a particular HBA can transfer in a single
operation 
<P>
<LI>
If the HBA can transfer buffered data backed by discontiguous physical pages,
how many discontiguities per buffer it can manage per transfer operation 
<P>
<LI>
The HBA’s alignment requirements for transfers so the class driver can
properly set the <B>AlignmentRequirement</B>&nbsp;field in its device objects. 
<P>
Applications that send IOCTL_SCSI_PASS_THROUGH requests also might use this
field. 
<P>
For more information about setting up <B>AlignmentRequirement</B>&nbsp;in device
objects, see Chapter 3. 
<P>
<LI>
Whether the HBA uses PIO and requires the use of system-space virtual
addresses mapped to physical memory for data buffers 
<P>
<LI>
Whether the HBA supports SCSI-II tagged queueing and/or per-logical-unit
internal queues (<B>MultipleRequestsPerLu</B>) 
<P>
<LI>
Whether the HBA supports asynchronous event notifications 
<P>
<LI>
Whether the HBA scans down 
</UL>
<P>
The class driver should store this information in the device extension so its
Dispatch routines can ensure that all requests sent to the port and miniport
drivers conform to the size, alignment, and PIO requirements of the underlying
HBA. For more information about class driver Dispatch routines, see <A HREF="appascsi_9.htm">Section
A.1.4</A>. For more information about setting up device extensions, see <A HREF="appascsi_8.htm">Section
A.1.3.4</A>. 
<P>
For more information about general requirements for DriverEntry routines, see
Chapter 5. 
<P></FONT>
</BODY>
</HTML>
