<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>16.6.1  Calling IoAllocateErrorLogEntry</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H3><A NAME="DDK_Calling_IoAllocateErrorLogEntry_KG"></A>16.6.1  Calling IoAllocateErrorLogEntry</H3>
<DL>
<DT>
When an NT driver discovers an I/O error in processing an IRP, it should call <B>IoAllocateErrorLogEntry</B>
as follows:
<DD>
<PRE><FONT FACE="Courier" SIZE="2">size = sizeof(IO_ERROR_LOG_PACKET) + (n * sizeof(ULONG)) 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+ sizeof(InsertionStrings); 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // where n depends on how much 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // DumpData the driver will supply 
errorLogEntry = (PIO_ERROR_LOG_PACKET)IoAllocateErrorLogEntry( 
&nbsp; &nbsp; deviceExtension-&gt;DeviceObject, 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // target device for current operation 
&nbsp; &nbsp; size); 
&nbsp;</FONT></PRE>
</DL>
<P>
Note that an error log packet is limited in size, and the system-defined limit
includes any dump data and insertion strings that the driver supplies with a
packet. NT drivers can call <B>IoAllocateErrorLogEntry</B>&nbsp;with a specified <I>EntrySize</I>
value that is, at most, ERROR_LOG_MAXIMUM_SIZE.<B>&nbsp;</B>
<P>
<B>IoAllocateErrorLogEntry</B>&nbsp;returns a pointer to an error log packet. If
the returned pointer is NULL, the driver need not log an error. It should
simply continue running and assume that, if the same error occurs again, it
can be logged at that point. 
<P></FONT>
</BODY>
</HTML>
