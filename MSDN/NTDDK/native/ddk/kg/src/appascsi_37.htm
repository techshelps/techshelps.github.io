<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>A.4.3.2  Port-Driver-Supplied ConfigInfo for HwScsiFindAdapter</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H4><A NAME="DDK_Port_Driver_Supplied_ConfigInfo_for_HwScsiFindAdapter_KG"></A>A.4.3.2  Port-Driver-Supplied ConfigInfo for HwScsiFindAdapter</H4>
<P>
The system port driver always sets up the following
PORT_CONFIGURATION_INFORMATION before it calls a miniport’s HwScsiFindAdapter
routine: 
<UL>
<LI>
<B>Length</B>&nbsp;to <B>sizeof</B>(PORT_CONFIGURATION_INFORMATION) 
<P>
<LI>
<B>AdapterInterfaceType</B>&nbsp;to the miniport’s HW_INITIALIZATION_DATA
specification 
<P>
<LI>
<B>InterruptMode</B>&nbsp;to <B>Latched</B>&nbsp;
<P>
If the miniport has no HwScsiInterrupt routine and, therefore, set the <B>HwInterrupt</B>
entry point to NULL in the HW_INITIALIZATION_DATA, this member is irrelevant. 
<P>
<LI>
<B>AtdiskPrimaryClaimed</B>&nbsp;to TRUE if a previously loaded driver is using the
I/O port range 0x1F0 to 0x1FF 
<P>
<LI>
<B>AtdiskSecondaryClaimed</B>&nbsp;to TRUE if a previously loaded driver is using
the I/O port range 0x170 to 0x17F 
<P>
<LI>
<B>NumberOfAccessRanges</B>&nbsp;to the miniport’s HW_INITIALIZATION_DATA
specification 
</UL>
<P>
The port driver also attempts to fill in the following members with values
from the registry: 
<UL>
<LI>
<B>SystemIoBusNumber</B>&nbsp;set to the system-assigned value for the I/O bus 
<P>
The miniport’s HwScsiFindAdapter routine can be called for each bus of the
given <B>AdapterInterfaceType</B>&nbsp;with an updated value for <B>SystemIoBusNumber</B>,
or this can be set to a value from the registry if the system detects an HBA
on a particular bus of the given <B>AdapterInterfaceType</B>. 
<P>
<LI>
<B>AccessRanges</B>&nbsp;elements, set with the bus-relative <B>RangeStart</B>
address and <B>RangeLength</B>, as well as whether each range is a <B>RangeInMemory</B>
<P>
<B>RangeInMemory</B>&nbsp;set to FALSE indicates a range of ports in I/O space,
rather than a memory-space range. 
<P>
The port driver either supplies all the information in an ACCESS_RANGE-type
element or it sets all members of the element to (default) zero. Usually, the
port driver supplies additional configuration information if it provides
nonzero values for an access range. 
<P>
A miniport driver must map the bus-relative access range values, if any,
supplied by the port driver with <B>ScsiPortGetDeviceBase</B>&nbsp;and use the
mapped logical address values to determine whether the corresponding adapter
is an HBA the driver supports. <I>Never</I>&nbsp;map and use a miniport-supplied
range to access an adapter on the bus if the port driver supplies filled-in
access range elements in the port configuration information it passes to the
HwScsiFindAdapter routine. Using miniport-supplied addresses when the port
driver has supplied range configuration information can reset an already
configured adapter, making it disfunctional, or even cause the system to fail
the boot process. 
<P>
For more information about using mapped logical access ranges, see also <A HREF="appascsi_38.htm">Section
A.4.3.3</A>.
<P>
<LI>
<B>BusInterruptLevel</B>&nbsp;or <B>BusInterruptVector</B>&nbsp;
<P>
This member is irrelevant if the miniport has no HwScsiInterrupt routine. 
<P>
<LI>
<B>DmaChannel</B>&nbsp;or <B>DmaPort</B>&nbsp;if the HBA uses a system DMA controller 
<P>
If the HBA is a busmaster or uses PIO, these members of
PORT_CONFIGURATION_INFORMATION are irrelevant. 
<P>
<LI>
<B>InitiatorBusId</B>&nbsp;
<P>
If the input <B>InitiatorBusId[0]</B>&nbsp;has the value zero, the miniport can
assign a default value if its HBA does not require the use of particular
value(s) determined by querying the HBA. Otherwise, the miniport should use
any nonzero value assigned by the port driver if possible. Every miniport must
update <B>InitiatorBusId</B>&nbsp;specifications to match what its HBA uses, if
necessary querying the HBA to determine the appropriate values(s).
<P>
A miniport driver must set an entry for each SCSI bus supported by the HBA, as
indicated by the value of <B>NumberOfBuses</B>.
</UL>
<P></FONT>
</BODY>
</HTML>
