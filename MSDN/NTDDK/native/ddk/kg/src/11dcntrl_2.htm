<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>11.1.1  Designing Device Drivers with DriverControl Routines</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H3><A NAME="DDK_Designing_Device_Drivers_with_DriverControl_Routines_KG"></A>11.1.1  Designing Device Drivers with DriverControl Routines</H3>
<P>
Most NT drivers of DMA devices must have an AdapterControl routine:
<UL>
<LI>
Every NT driver of a DMA device that is connected to a system DMA controller
must have an AdapterControl routine.
<P>
<LI>
Any NT driver of a busmaster DMA device must have an AdapterControl routine
unless that driver’s designer decides to use the system’s common-buffer DMA
support exclusively.
</UL>
<P>
At the driver writer’s discretion, an NT device driver can have a
ControllerControl routine in order to synchronize its operations to similar
devices through a single physical controller or adapter.
<P>
The I/O Manager defines a single type (DRIVER_CONTROL) for AdapterControl and
ControllerControl routines because each is called indirectly, usually from the
StartIo routine, when a driver needs to synchronize access to a physical
device that might already be busy:
<UL>
<LI>
When a driver calls <B>IoAllocateAdapterChannel</B>, its AdapterControl
routine is run immediately if the system DMA controller or busmaster adapter
is available for a DMA operation. Otherwise, the AdapterControl routine is
queued until the DMA controller or busmaster adapter is free.
<P>
<LI>
When a driver calls <B>IoAllocateController</B>, its ControllerControl routine
is run immediately if the hardware represented by the controller object is
available for an I/O operation. Otherwise, the ControllerControl routine is
queued until the controller is free.
</UL>
<P>
For a ControllerControl routine, the input PVOID <I>MapRegisterBase</I>, shown
in the DRIVER_CONTROL declaration, is a system-reserved value.
<P></FONT>
</BODY>
</HTML>
