<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>16.9.2  Creating Symbolic Links between Devices and ARC Names</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H3><A NAME="DDK_Creating_Symbolic_Links_between_Devices_and_ARC_Names_KG"></A>16.9.2  Creating Symbolic Links between Devices and ARC Names</H3>
<P>
Drivers of floppy and CD-ROM devices from which the system itself can be
loaded must be identified by the ARC or NtDetect components during the
earliest phase of the system boot process.
<P>
For such a boot-from floppy or CD-ROM device in a given machine, a hardware
device name, representing a vector to the device, is passed to the system boot
loader by the ARC component. To ensure driver portablity across NT platforms,
the OS loader sets up the ARC names in x86-based NT machines.
<P>
When the driver of a floppy or CD-ROM device is loaded, it must call <B>IoAssignArcName</B>
to create a symbolic link between the ARC name for the device and the name
that the driver assigned when it created a device object to represent a
possible boot-from device.
<DL>
<DT>
For example, when such a CD-ROM driver creates a device object for a CD-ROM
drive, it should include code somewhat like the following:
<DD>
<PRE><FONT FACE="Courier" SIZE="2">{ 
&nbsp; &nbsp; CCHAR ntNameBuffer[MAXIMUM_FILENAME_LENGTH]; 
&nbsp; &nbsp; CCHAR arcNameBuffer[MAXIMUM_FILENAME_LENGTH]; 
&nbsp; &nbsp; STRING ntNameString; 
&nbsp; &nbsp; STRING arcNameString; 
&nbsp; &nbsp; UNICODE_STRING ntUnicodeString; 
&nbsp; &nbsp; UNICODE_STRING arcUnicodeString; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; :      : 
&nbsp; &nbsp; RtlInitString(&amp;ntNameString, ntNameBuffer); 
&nbsp; &nbsp; (VOID)RtlAnsiStringToUnicodeString( 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;ntUnicodeString, 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;ntNameString, 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TRUE); 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; :     : 
&nbsp; &nbsp; // Call IoCreateDevice with ntUnicodeString 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; :     : 
&nbsp; &nbsp; // 
&nbsp; &nbsp; // An ARC name looks something like 
&nbsp; &nbsp; // \ArcName\scsi(0)cdrom(0)fdisk(0) 
&nbsp; &nbsp; // 
&nbsp; &nbsp; RtlInitString(&amp;arcNameString, arcNameBuffer); 
&nbsp; &nbsp; status = RtlAnsiStringToUnicodeString( 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;arcUnicodeString, 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;arcNameString, 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TRUE); 
&nbsp; &nbsp; if (!NT_SUCCESS(status)) { 
&nbsp; &nbsp; &nbsp; &nbsp; RtlFreeUnicodeString(&amp;ntUnicodeString); 
&nbsp; &nbsp; &nbsp; &nbsp; goto CreateDeviceObjectsExit; 
&nbsp; &nbsp; } 
&nbsp; &nbsp; IoAssignArcName(&amp;arcUnicodeString,  &amp;ntUnicodeString); 
&nbsp; &nbsp; RtlFreeUnicodeString(&amp;arcUnicodeString); 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; :     : 
&nbsp;</FONT></PRE>
</DL>
<P>
If such a driver has an Unload routine, it must call <B>IoDeassignArcName</B>
to delete each such symbolic link that the DriverEntry routine set up.
<P>
&nbsp;
<P></FONT>
</BODY>
</HTML>
