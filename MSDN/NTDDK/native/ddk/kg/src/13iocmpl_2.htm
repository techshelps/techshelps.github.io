<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>13.1.1  Setting Up an IoCompletion Routine</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H3><A NAME="DDK_Setting_Up_an_IoCompletion_Routine_KG"></A>13.1.1  Setting Up an IoCompletion Routine</H3>
<P>
Every higher-level NT driver’s Dispatch routines are generally responsible for
the following:
<OL>
<LI>
Checking the validity of parameters in their own I/O stack location of
incoming IRPs and failing those requests with invalid parameters
<P>
<LI>
Sending IRPs with valid parameters and those for which the Dispatch routine
cannot determine the validity on to lower drivers with <B>IoCallDriver</B>&nbsp;
<P>
For more detailed information about higher-level drivers’ Dispatch routines,
see Chapter 6. 
</OL>
<P>
Such a Dispatch routine can call <B>IoSetCompletionRoutine</B>&nbsp;with the entry
point of a driver-supplied IoCompletion routine and with any IRP that it will
pass on to lower drivers with <B>IoCallDriver</B>. 
<P>
Such a Dispatch routine can specify whether the given IoCompletion routine
will be called when lower drivers complete the given IRP with any one, two, or
all of the following NTSTATUS values when it calls <B>IoSetCompletionRoutine</B>:
<UL>
<LI>
STATUS_SUCCESS indicating that all lower-level drivers completed the requested
operation successfully
<P>
<LI>
STATUS_CANCELLED indicating that the IRP was cancelled in a lower driver
<P>
<LI>
STATUS_<I>XXX</I>&nbsp;indicating that a lower driver encountered an error and
failed the IRP
</UL>
<P>
The purpose of an IoCompletion routine is to monitor what lower-level drivers
did with a given IRP and/or to do any necessary cleanup processing for an IRP
that the higher-level driver has passed on for processing by lower drivers. 
<P>
For more information about NTSTATUS and I/O errors, see Chapter 16. 
<P>
For specific information about any of the support routines mentioned in this
chapter, see the <I>Kernel-mode Driver Reference</I>. 
<P></FONT>
</BODY>
</HTML>
