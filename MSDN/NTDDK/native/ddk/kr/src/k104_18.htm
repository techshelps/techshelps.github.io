<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IoCheckShareAccess</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_IoCheckShareAccess_KR"></A>IoCheckShareAccess</H2>
<P>
<B>NTSTATUS <BR>
&nbsp; &nbsp; IoCheckShareAccess(</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN ACCESS_MASK</B>&nbsp; <I>DesiredAccess</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN ULONG</B>&nbsp; <I>DesiredShareAccess</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN OUT PFILE_OBJECT</B>&nbsp; <I>FileObject</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN OUT PSHARE_ACCESS</B>&nbsp; <I>ShareAccess</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN BOOLEAN</B>&nbsp; <I>Update</I><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>);</B>
<P>
<B>IoCheckShareAccess</B>&nbsp;is called by FSDs or other highest-level drivers to
check whether shared access to a file object is permitted.
<H3>Parameters</H3>
<DL>
<DT>
<I>DesiredAccess</I>
<DD>
Specifies the type(s) of access to the given <I>FileObject</I>&nbsp;for the current
open request. Generally, the value of this parameter is equal to the <I>DesiredAccess</I>
passed to the file system or highest-level driver by the I/O manager when an
open request is made.
<BR>
<DT>
<I>DesiredShareAccess</I>
<DD>
Specifies the type(s) of shared access to the file object for the current open
request. This parameter is generally identical to the <I>ShareAccess</I>&nbsp;that
was passed to the file system or highest-level driver by the I/O Manager when
the open request was made.
<BR>
<DT>
<I>FileObject</I>
<DD>
Points to the file object, to which accesses are to be checked for the current
open request.
<BR>
<DT>
<I>ShareAccess</I>
<DD>
Points to the common share-access data structure associated with the file
object being opened. This structure is treated as an opaque type by drivers.
<BR>
<DT>
<I>Update</I>
<DD>
Specifies whether or not the system should update the share-access status of
the specified file object. A Boolean value of TRUE means the share access
information for the file is to be updated if the open request is permitted.
</DL>
<H3>Return Value</H3>
<P>
<B>IoCheckShareAccess</B>&nbsp;returns STATUS_SUCCESS if the requestor’s access to
the file object is compatible with the way in which it is currently open. If
the request is denied because of a sharing violation, then
STATUS_SHARING_VIOLATION is returned.
<H3>Comments</H3>
<P>
<B>IoCheckShareAccess</B>&nbsp;checks a file object open request to determine
whether the types of desired and shared accesses specified are compatible with
the way in which the file object is currently being accessed by other opens.
<P>
File systems maintain state about files through structures called file control
blocks (FCBs). The SHARE_ACCESS is a structure describing how the file is
currently accessed by all opens. This state is contained in the FCB as part of
the open state for each file object. Other highest-level drivers might call
this routine to check the access requested when a file object representing
such a driver’s device object is opened.
<P>
Callers of <B>IoCheckShareAccess</B>&nbsp;must be running at IRQL PASSIVE_LEVEL.
<H3>See Also</H3>
<P>
<B><A HREF="k104_48.htm">IoGetRelatedDeviceObject</A></B>, <B><A HREF="k104_64.htm">IoRemoveShareAccess</A></B>,
<B><A HREF="k104_72.htm">IoSetShareAccess</A></B>, <B><A HREF="k104_80.htm">IoUpdateShareAccess</A></B>
<P></FONT>
</BODY>
</HTML>
