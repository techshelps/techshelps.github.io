<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>ZwReadFile</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_ZwReadFile_KR"></A>ZwReadFile</H2>
<P>
<B>NTSTATUS  <BR>
&nbsp; &nbsp; ZwReadFile(</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN HANDLE</B>&nbsp; <I>FileHandle</I><B>,<BR>
</B><I>&nbsp; &nbsp; &nbsp; &nbsp; </I><B>IN HANDLE</B>&nbsp; <I>Event</I><B>,</B><I>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </I>/*
optional */<I><BR>
&nbsp; &nbsp; &nbsp; &nbsp; </I><B>IN PIO_APC_ROUTINE</B><I>&nbsp; ApcRoutine</I><B>,</B><I>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </I>/*
optional */<I><BR>
&nbsp; &nbsp; &nbsp; &nbsp; </I><B>IN PVOID</B>&nbsp; <I>ApcContext</I><B>,</B><I>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </I>/*
optional */<I><BR>
&nbsp; &nbsp; &nbsp; &nbsp; </I><B>OUT PIO_STATUS_BLOCK</B>&nbsp; <I>IoStatusBlock</I><B>,<BR>
</B><I>&nbsp; &nbsp; &nbsp; &nbsp; </I><B>OUT PVOID</B>&nbsp; <I>Buffer</I><B>,<BR>
</B><I>&nbsp; &nbsp; &nbsp; &nbsp; </I><B>IN ULONG</B>&nbsp; <I>Length</I><B>,<BR>
</B><I>&nbsp; &nbsp; &nbsp; &nbsp; </I><B>IN PLARGE_INTEGER</B>&nbsp; <I>ByteOffset</I><B>,</B>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /*
optional */<I><BR>
&nbsp; &nbsp; &nbsp; &nbsp; </I><B>IN PULONG</B>&nbsp; <I>Key</I>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* optional */<BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>);</B>
<P>
Data can be read from an opened file with <B>ZwReadFile</B>.
<H3>Parameters</H3>
<DL>
<DT>
<I>FileHandle</I>
<DD>
Is the handle returned by a successful call to <B>ZwCreateFile</B>.
<BR>
<DT>
<I>Event</I>
<DD>
Is an optional handle for an event to be set to the Signaled state when the
read operation completes. Device and intermediate drivers should set this
parameter to NULL.
<BR>
<DT>
<I>ApcRoutine</I>
<DD>
Device and intermediate drivers should set this pointer to NULL.
<BR>
<DT>
<I>ApcContext</I>
<DD>
Device and intermediate drivers should set this pointer to NULL.
<BR>
<DT>
<I>IoStatusBlock</I>
<DD>
Points to a variable that receives the final completion status and information
about the requested read operation.
<BR>
<DT>
<I>Buffer</I>
<DD>
Points to a caller-allocated buffer to receive the data read from the file.
<BR>
<DT>
<I>Length</I>
<DD>
Specifies the size in bytes of the given <I>Buffer</I>. A successful call to <B>ZwReadFile</B>
returns the given number of bytes from the file, unless this routine reaches
the end of file first.
<BR>
<DT>
<I>ByteOffset</I>
<DD>
Points to a variable specifying the starting byte offset within the file at
which to begin the read operation. If an attempt is made to start reading
beyond the end of file, <B>ZwReadFile</B>&nbsp;returns an error.
<P>
If the call to <B>ZwCreateFile</B>&nbsp;set either of the <I>CreateOptions</I>
flags FILE_SYNCHRONOUS_IO_ALERT or FILE_SYNCHRONOUS_IO_NONALERT, the I/O
Manager maintains the current file position. If so, the caller of <B>ZwReadFile</B>
can specify that the current file position offset be used instead of an
explicit <I>ByteOffset</I>&nbsp;value in either of the following ways:
<UL>
<LI>
Specify the system-defined value FILE_USE_FILE_POINTER_POSITION.
<P>
<LI>
Pass a NULL pointer for <I>ByteOffset</I>.
</UL>
<P>
<B>ZwReadFile</B>&nbsp;updates the current file position by adding the number of
bytes read when it completes the read operation, if it is using the current
file position maintained by the I/O Manager.
<P>
Even when the I/O Manager is maintaining the current file position, the caller
can reset this position by passing an explicit <I>ByteOffset</I>&nbsp;value to <B>ZwReadFile</B>.
Doing this automatically changes the current file position to that <I>ByteOffset</I>,
performs the read, and then updates the position according to the number of
bytes actually read. This technique gives the caller atomic seek-and-read
service.
<BR>
<DT>
<I>Key</I>
<DD>
Device and intermediate drivers should set this pointer to NULL.
</DL>
<H3>Return Value</H3>
<P>
<B>ZwReadFile</B>&nbsp;either returns STATUS_SUCCESS or an appropriate error
status. The number of bytes actually read from the file is returned in the <B>Information</B><I>
</I>member of the <I>IoStatusBlock</I>.
<H3>Comments</H3>
<P>
Callers of <B>ZwReadFile</B>&nbsp;must have already called <B>ZwCreateFile</B>&nbsp;with
the <I>DesiredAccess</I>&nbsp;flag FILE_READ_DATA set, either explicitly or by
setting this flag with GENERIC_READ.
<P>
If the preceding call to <B>ZwCreateFile</B>&nbsp;set the <I>CreateOptions</I>&nbsp;flag
FILE_NO_INTERMEDIATE_BUFFERING, certain restrictions on the parameters to <B>ZwReadFile</B>
are enforced. See <B>ZwCreateFile</B>&nbsp;for specifics.
<P>
<B>ZwReadFile</B>&nbsp;begins reading from the given <I>ByteOffset</I>&nbsp;or the
current file position into the given <I>Buffer</I>. It terminates the read
operation under one of the following conditions:
<UL>
<LI>
The buffer is full because the number of bytes specified by the <I>Length</I>
parameter has been read. Therefore, no more data can be placed into the buffer
without an overflow.
<P>
<LI>
The end of file is reached during the read operation, so there is no more data
in the file to be transferred into the buffer.
</UL>
<P>
If the caller opened the file with the <I>DesiredAccess</I>&nbsp;SYNCHRONIZE flag
set, the caller can wait on this routine’s setting the given <I>FileHandle</I>
to the Signaled state.
<P>
Callers of <B>ZwReadFile</B>&nbsp;must be running at IRQL PASSIVE_LEVEL.
<H3>See Also</H3>
<P>
<B><A HREF="k105_17.htm">KeInitializeEvent</A></B>, <B><A HREF="k111_3.htm">ZwCreateFile</A></B>,
<B><A HREF="k111_13.htm">ZwQueryInformationFile</A></B>, <B><A HREF="k111_17.htm">ZwSetInformationFile</A></B>,
<B><A HREF="k111_21.htm">ZwWriteFile</A></B>&nbsp;
<P></FONT>
</BODY>
</HTML>
