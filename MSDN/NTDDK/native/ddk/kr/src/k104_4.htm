<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IoAllocateErrorLogEntry</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_IoAllocateErrorLogEntry_KR"></A>IoAllocateErrorLogEntry</H2>
<P>
<B>PVOID <BR>
&nbsp; &nbsp; IoAllocateErrorLogEntry(</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PVOID</B>&nbsp; <I>IoObject</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN UCHAR</B>&nbsp; <I>EntrySize</I><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>);</B>
<P>
<B>IoAllocateErrorLogEntry</B>&nbsp;allocates an error log packet and returns a
pointer to the packet so the caller can supply information about an I/O error.
<H3>Parameters</H3>
<DL>
<DT>
<I>IoObject</I>
<DD>
Points to a device object representing the device on which an I/O error
occurred, or to a driver object representing the driver that found an error.
<BR>
<DT>
<I>EntrySize</I>
<DD>
Specifies the size in bytes of the packet to be allocated. This value cannot
exceed ERROR_LOG_MAXIMUM_SIZE.
</DL>
<H3>Return Value</H3>
<P>
<B>IoAllocateErrorLogEntry</B>&nbsp;returns a pointer to the allocated packet in
which the driver sets up the error data, or NULL if a packet could not be
allocated.
<H3>Comments</H3>
<P>
The driver must fill in the packet with information about the error and, then,
call <B>IoWriteErrorLogEntry</B>&nbsp;to post the entry to the error log.
<P>
The value supplied for <I>EntrySize</I>&nbsp;depends on how much <B>DumpData</B>
the driver includes in the error log packet, as well as any <B>InsertionStrings</B>
it provides for the error. In general, the value of <I>EntrySize</I>&nbsp;is the
following:
<PRE><FONT FACE="Courier" SIZE="2">sizeof(IO_ERROR_LOG_PACKET) + (n * sizeof(ULONG))
&nbsp; &nbsp; &nbsp; &nbsp; + sizeof(InsertionStrings)
</FONT></PRE>
<P>
Where <I>n</I>&nbsp;depends on how much <B>DumpData</B>&nbsp;the driver supplies with
the error. If <B>IoAllocateErrorLogPacket</B>&nbsp;returns NULL, the driver should
continue to run and assume that, if the same error occurs again, the driver
can log the error at that point. The returned error log packet is defined as
follows:
<PRE><FONT FACE="Courier" SIZE="2">typedef struct _IO_ERROR_LOG_PACKET (
&nbsp; &nbsp; UCHAR MajorFunctionCode;
&nbsp; &nbsp; UCHAR RetryCount;
&nbsp; &nbsp; USHORT DumpDataSize;
&nbsp; &nbsp; USHORT NumberOfStrings;
&nbsp; &nbsp; USHORT StringOffset;
&nbsp; &nbsp; USHORT EventCategory;
&nbsp; &nbsp; NTSTATUS ErrorCode;
&nbsp; &nbsp; ULONG UniqueErrorValue;
&nbsp; &nbsp; NTSTATUS FinalStatus;
&nbsp; &nbsp; ULONG SequenceNumber;
&nbsp; &nbsp; ULONG IoControlCode;
&nbsp; &nbsp; LARGE_INTEGER DeviceOffset;
&nbsp; &nbsp; ULONG DumpData[1];
}IO_ERROR_LOG_PACKET, *PIO_ERROR_LOG_PACKET;
</FONT></PRE>
<P>
Caller-supplied data in the packet includes the following: 
<TABLE>
<TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>Member</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>Meaning</B>
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>MajorFunctionCode</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
The IRP_MJ_<I>XXX</I>&nbsp;of the current IRP.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>RetryCount</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
A count of how many times the caller has retried the operation and encountered
the same error.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>DumpDataSize</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
The number of bytes of caller-suplied <B>DumpData</B>, if any.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NumberOfStrings</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
The number of insertion strings supplied following the <B>DumpData</B>; the
initial string, if any, is assumed to be the driver name or that of the target
device object.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>StringOffset</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
The offset, immediately following any <B>DumpData</B>, of the caller-supplied,
zero-terminated Unicode insertion strings, if any.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>EventCategory</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
A caller-determined value matching that in the caller’s message file for
categories if the driver set itself up in the registry as an event-logging
component; otherwise, zero.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>ErrorCode</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
An IO_ERR_<I>XXX</I>&nbsp;value.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>UniqueErrorValue</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
A driver-determined value that indicates where in the driver  the error was
encountered.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>FinalStatus</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
The STATUS_<I>XXX</I>&nbsp;value to be set in the I/O status block of the IRP or a
STATUS_<I>XXX</I>&nbsp;returned by a support routine.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>SequenceNumber</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
A driver-assigned number for the current IRP, constant for the life of the
request.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>IoControlCode</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
An IOCTL_<I>XXX</I>&nbsp;if <B>MajorFunctionCode</B>&nbsp;is IRP_MJ_DEVICE_CONTROL,
IRP_MJ_INTERNAL_DEVICE_CONTROL, or IRP_MJ_SCSI; otherwise, zero.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>DeviceOffset</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
The offset on the device where the error occurred, or zero.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>DumpData</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Caller-supplied data, such as device register contents, if <B>DumpDataSize</B>
is nonzero.
</FONT></TABLE>
<P>
The I/O Manager uses the first insertion string for the device or driver name
derived from the <I>IoObject</I>.
<P>
Callers of <B>IoAllocateErrorLogEntry</B>&nbsp;must be running at IRQL &lt;=
DISPATCH_LEVEL.
<H3>See Also</H3>
<P>
<B><A HREF="k104_81.htm">IoWriteErrorLogEntry</A></B>&nbsp;
<P></FONT>
</BODY>
</HTML>
