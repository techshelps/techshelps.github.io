<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>8.1  Tape I/O Requests</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_Tape_I_O_Requests_KR"></A>8.1  Tape I/O Requests</H2>
<P>
Any driver that sets up device objects of type FILE_DEVICE_TAPE is required to
handle at least four types of requests.
<H3>IRP_MJ_CREATE</H3>
<H4>Operation</H4>
<P>
Returns STATUS_SUCCESS, indicating the existence of the device.
<H4>When Called</H4>
<P>
A higher-level driver is attempting to connect one of its device objects to
the target device object, or a user-mode process has attempted to open a file
stored on the physical device, thereby causing a file system to carry out a
mount operation.
<H4>I/O Status Block</H4>
<P>
Returns STATUS_SUCCESS in the <B>Status</B>&nbsp;field and zero in the <B>Information</B>
field.
<H3>IRP_MJ_SHUTDOWN</H3>
<H4>Operation</H4>
<P>
Transfers data cached in the device or in the driver’s internal buffer(s) into
system memory or out to the device before the system is shut down. If the
device or driver supports caching or buffering data, the driver must handle
this request.
<H4>When Called</H4>
<P>
The user has decided to shut down the system.
<H4>I/O Status Block</H4>
<P>
The <B>Status</B>&nbsp;field is set to STATUS_SUCCESS when the transfer is
complete.
<H3>IRP_MJ_READ</H3>
<H4>Operation</H4>
<P>
Transfers data from the underlying device to system memory.
<H4>Output</H4>
<P>
Drivers of tape devices generally use direct I/O, so the lowest-level driver
transfers data using DMA or PIO into the buffer described by the MDL at <B>Irp-&gt;MdlAddress</B>.
<H4>When Called</H4>
<P>
A Win32&reg; application with a handle for the opened file object that
represents the tape device has requested a data transfer.
<H4>I/O Status Block</H4>
<DL>
<DT>
The <B>Information</B>&nbsp;field is set to the number of bytes transferred,
whatever the <B>Status</B>&nbsp;field’s value. In addition to STATUS_SUCCESS,
possible values are any of the following:
<DD>
<PRE><FONT FACE="Courier" SIZE="2">STATUS_INSUFFICIENT_RESOURCES<BR>STATUS_DEVICE_DATA_ERROR<BR>STATUS_INVALID_DEVICE_REQUEST<BR>STATUS_NO_SUCH_DEVICE<BR>STATUS_IO_TIMEOUT<BR>STATUS_IO_DEVICE_ERROR<BR>STATUS_DEVICE_NOT_READY<BR>STATUS_NO_MEDIA_IN_DEVICE<BR>STATUS_VERIFY_REQUIRED</FONT></PRE>
</DL>
<H3>IRP_MJ_WRITE</H3>
<H4>Operation</H4>
<P>
Transfers data from system memory to the underlying device.
<H4>Output</H4>
<P>
Drivers of tape devices generally use direct I/O, so the lowest-level driver
transfers data using DMA or PIO into the buffer described by the MDL at <B>Irp-&gt;MdlAddress</B>.
<H4>When Called</H4>
<P>
A Win32 application with a handle for the opened file object that represents
the tape device has requested a data transfer.
<H4>I/O Status Block</H4>
<P>
The <B>Information</B>&nbsp;field is set to the number of bytes transferred,
whatever the <B>Status</B>&nbsp;field’s value. Possible values are any of those
returned for read requests and STATUS_MEDIA_WRITE_PROTECTED.
<H3>IRP_MJ_DEVICE_CONTROL</H3>
<H4>Operation</H4>
<P>
Determined by the I/O control code set at <B>Parameters.DeviceIoControl.IoControlCode</B>
in the driver’s I/O stack location of the IRP.
<H4>When Called</H4>
<P>
A Win32 application with a handle for the opened file object that represents
the tape device has called <B>DeviceIoControl</B>, or a higher-level driver
has set up the request.
<H4>I/O Status Block</H4>
<P>
Also determined by the operation, either STATUS_SUCCESS or an appropriate
STATUS_<I>XXX</I>&nbsp;value. For most operations, the set of STATUS_<I>XXX</I>
values includes those propagated from a call to a support routine or
lower-level driver and/or those chosen by the driver designer. In general, the
<B>Information</B>&nbsp;field of the I/O status block is set to the number of bytes
returned or transferred.
<P></FONT>
</BODY>
</HTML>
