<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>SCSI_REQUEST_BLOCK</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_SCSI_REQUEST_BLOCK_KR"></A>SCSI_REQUEST_BLOCK</H2>
<PRE><FONT FACE="Courier" SIZE="2">typedef struct _SCSI_REQUEST_BLOCK { 
&nbsp; &nbsp; USHORT Length; 
&nbsp; &nbsp; UCHAR Function; 
&nbsp; &nbsp; UCHAR SrbStatus; 
&nbsp; &nbsp; UCHAR ScsiStatus; 
&nbsp; &nbsp; UCHAR PathId; 
&nbsp; &nbsp; UCHAR TargetId; 
&nbsp; &nbsp; UCHAR Lun; 
&nbsp; &nbsp; UCHAR QueueTag; 
&nbsp; &nbsp; UCHAR QueueAction; 
&nbsp; &nbsp; UCHAR CdbLength; 
&nbsp; &nbsp; UCHAR SenseInfoBufferLength; 
&nbsp; &nbsp; ULONG SrbFlags; 
&nbsp; &nbsp; ULONG DataTransferLength; 
&nbsp; &nbsp; ULONG TimeOutValue; 
&nbsp; &nbsp; PVOID DataBuffer; 
&nbsp; &nbsp; PVOID SenseInfoBuffer; 
&nbsp; &nbsp; struct _SCSI_REQUEST_BLOCK *NextSrb; 
&nbsp; &nbsp; PVOID OriginalRequest; 
&nbsp; &nbsp; PVOID SrbExtension; 
&nbsp; &nbsp; ULONG QueueSortKey; 
&nbsp; &nbsp; UCHAR Cdb[16]; 
} SCSI_REQUEST_BLOCK, *PSCSI_REQUEST_BLOCK; 
&nbsp;</FONT></PRE>
<H3>Members</H3>
<DL>
<DT>
<B>Length</B>
<DD>
Specifies the size in bytes of this structure.
<BR>
<DT>
<B>Function</B>
<DD>
Specifies the operation to be performed, which can be one of the following
values:
<TABLE>
<TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>Operation</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>Meaning</B>
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_FUNCTION_EXECUTE_SCSI
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
A SCSI device I/O request should be executed on the target logical unit.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_FUNCTION_ABORT_COMMAND
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
A SCSIMESS_ABORT message should be sent to cancel the request pointed to by
the <B>NextSrb</B>&nbsp;member. If this is a tagged-queue request, a
SCSIMESS_ABORT_WITH_TAG message should be used instead. If the indicated
request has been completed, this request should be completed normally. Only
the SRB <B>Function</B>, <B>PathId</B>, <B>TargetId</B>, <B>Lun</B>, and <B>NextSrb</B>
members are valid.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_FUNCTION_RESET_DEVICE
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
The SCSI target controller should be reset using the SCSIMESS_BUS_DEVICE_RESET
message. The miniport driver should complete any active requests for the
target controller. Only the SRB  <B>Function</B>, <B>TargetId,</B>&nbsp;and <B>PathId</B>
members are valid.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_FUNCTION_RESET_BUS
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
The SCSI bus should be reset using the SCSIMESS_BUS_DEVICE_RESET message. A
miniport driver receives this request only if a given request has timed out
and a subsequent request to abort the timed-out request also has timed out.
Only the SRB <B>Function</B>&nbsp;and <B>PathId</B>&nbsp;members are valid.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_FUNCTION_TERMINATE_IO
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
A SCSIMESS_TERMINATE_IO_PROCESS message should be sent to cancel the request
pointed to by the <B>NextSrb</B>&nbsp;member. If the indicated request has already
completed, this request should be completed normally. Only the SRB <B>Function</B>,
<B>PathId</B>, <B>TargetId</B>, <B>Lun</B>, and <B>NextSrb</B>&nbsp;members are
valid.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_FUNCTION_RELEASE_RECOVERY
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
A SCSIMESS_RELEASE_RECOVERY message should be sent to the target controller.
Only the SRB <B>Function</B>, <B>PathId</B>, <B>TargetId</B>, and <B>Lun</B>
members are valid.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_FUNCTION_RECEIVE_EVENT
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
The HBA should be prepared to receive an asynchronous event notification from
the addressed target. The SRB <B>DataBuffer</B>&nbsp;member indicates where the
data should be placed.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_FUNCTION_SHUTDOWN
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
The system is being shut down. This request is sent to a miniport driver only
if it set <B>CachesData</B>&nbsp;to TRUE in the PORT_CONFIGURATION_INFORMATION for
the HBA. Such a miniport driver can receive several of these notifications
before all system activity actually stops. However, the last shutdown
notification will occur after the last start I/O. Only the SRB <B>Function</B>,
<B>PathId</B>, <B>TargetId,</B>&nbsp;and <B>Lun</B>&nbsp;members are valid.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_FUNCTION_FLUSH
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
The miniport should flush any cached data for the target device. This request
is sent to the miniport driver only if it set <B>CachesData</B>&nbsp;to TRUE in the
PORT_CONFIGURATION_INFORMATION for the HBA. Only the SRB <B>Function</B>, <B>PathId</B>,
<B>TargetId,</B>&nbsp;and <B>Lun</B>&nbsp;members are valid.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
&nbsp;SRB_FUNCTION_IO_CONTROL
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
The request is an I/O control request, originating in a user-mode application
with a dedicated HBA. The SRB <B>DataBuffer</B>&nbsp;points to an SRB_IO_CONTROL
header followed by the data area. The value in <B>DataBuffer</B>&nbsp;can be used
by the driver, regardless of the value of <B>MapBuffers</B>. Only the SRB <B>Function</B>,
<B>SrbFlags</B>, <B>TimeOutValue</B>, <B>DataBuffer</B>, and <B>DataTransferLength</B>
members are valid, along with the <B>SrbExtension</B>&nbsp;member if the miniport
driver requested SRB extensions when it initialized. If a miniport driver
controls an application-dedicated HBA so it supports this request, the
miniport should execute the request and notify the OS-specific port driver
when the SRB has completed, using the normal mechanism of calls to <B>ScsiPortNotification</B>
with <B>RequestComplete</B>&nbsp;and <B>NextRequest</B>.
</FONT></TABLE>
<DT>
<B>SrbStatus</B>
<DD>
Returns the status of the completed request. This member should be set by the
miniport driver before it notifies the OS-specific driver that the request has
completed by calling <B>ScsiPortNotification</B>&nbsp;with <B>RequestComplete</B>.
The value of this member can be one of the following:
<TABLE>
<TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>Status</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>Meaning</B>
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_PENDING
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates the request is in progress. The OS-specific port driver initializes <B>SrbStatus</B>
to this value. A miniport driver should <I>never</I>&nbsp;set the <B>SrbStatus</B>
member to this value.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_SUCCESS
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates the request was completed successfully.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_ABORTED
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates the request was aborted as directed by the port driver. A miniport
driver sets this status in the <B>NextSrb</B>&nbsp;for a successful
SRB_FUNCTION_ABORT_COMMAND request.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_ABORT_FAILED
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates an attempt to abort the request failed. Return this status for an
SRB_FUNCTION_ABORT_COMMAND request when the specified request cannot be
located.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_ERROR
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates the request was completed with an error in the SCSI bus status.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_BUSY
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates the miniport or target device could not accept the request at this
time. The OS-specific port driver will resubmit the request later.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_INVALID_REQUEST
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates the miniport driver does not support the given request.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_NO_DEVICE
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates the device did not respond.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_TIMEOUT
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates the request timed out.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_SELECTION_TIMEOUT
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates the SCSI device selection timed out.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_COMMAND_TIMEOUT
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates the target did not complete the command within the time limit.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_MESSAGE_REJECTED
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates the target rejected a message. This is normally returned only for
such message-type requests as SRB_FUNCTION_TERMINATE_IO.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_BUS_RESET
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates a bus reset occurred while this request was being executed.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_PARITY_ERROR
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates a parity error occurred on the SCSI bus and that a retry failed.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_REQUEST_SENSE_FAILED
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates the request-sense command failed. This is returned only if the HBA
performs auto request sense and the miniport driver set <B>AutoRequestSense</B>
to TRUE in the PORT_CONFIGURATION_INFORMATION for this HBA.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_NO_HBA
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates the HBA does not respond.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_DATA_OVERRUN
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates that a data overrun or underrun error occurred. The miniport also
must update the SRB’s <B>DataTransferLength</B>&nbsp;member to indicate how much
data actually was transferred if an underrun occurs. 
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_UNEXPECTED_BUS_FREE
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates the target disconnected unexpectedly.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_PHASE_SEQUENCE_FAILURE
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates the HBA detected an illegal phase sequence failure error.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_REQUEST_FLUSHED
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates the request for status was stopped.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_BAD_FUNCTION
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates the SRB <B>Function</B>&nbsp;code is not supported.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_INVALID_PATH_ID
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates the <B>PathId</B>&nbsp;specified in the SRB does not exist.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_INVALID_TARGET_ID
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates the <B>TargetID</B>&nbsp;value in the SRB is invalid.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_INVALID_LUN
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates the <B>Lun</B>&nbsp;value in the SRB is invalid.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_ERROR_RECOVERY
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates the request was completed with an error in the SCSI bus status and
that the SCSI INITIATE RECOVERY message was received.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_AUTOSENSE_VALID
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates information returned in the <B>SenseInfoBuffer</B>&nbsp;<I>is</I>&nbsp;valid.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_STATUS_QUEUE_FROZEN
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
A miniport driver should <I>never</I>&nbsp;set the <B>SrbStatus</B>&nbsp;member to this
value. The Windows NT port driver can set this value to inform a SCSI class
driver that its queue of requests for a particular peripheral has been frozen.
</FONT></TABLE>
<DT>
<B>ScsiStatus</B>
<DD>
Returns the SCSI status that was returned by the HBA or target device. If the
status is not SUCCESS, the miniport driver should set the <B>SrbStatus</B>
member to SRB_STATUS_ERROR.
<BR>
<DT>
<B>PathId</B>
<DD>
Indicates the SCSI port or bus for the request. This value is zero-based.
<BR>
<DT>
<B>TargetId</B>
<DD>
Indicates the target controller or device on the bus.
<BR>
<DT>
<B>Lun</B>
<DD>
Indicates the logical unit number of the device.
<BR>
<DT>
<B>QueueTag</B>
<DD>
Is the queue-tag value assigned by the OS-specific port driver. If this member
is used for tagged queueing, the HBA supports internal queueing of requests to
LUs and the miniport driver set <B>TaggedQueuing</B>&nbsp;to TRUE in the
PORT_CONFIGURATION_INFORMATION for this HBA.
<BR>
<DT>
<B>QueueAction</B>
<DD>
Indicates the tagged-queueing message to be used when the
SRB_FLAGS_QUEUE_ACTION_ENABLE flag is set. The value can be one of the
following: SRB_SIMPLE_TAG_REQUEST, SRB_HEAD_OF_QUEUE_TAG_REQUEST, or
SRB_ORDERED_QUEUE_TAG_REQUEST, as defined according to the SCSI-II
specification.
<BR>
<DT>
<B>CdbLength</B>
<DD>
Indicates the size in bytes of the SCSI command descriptor block.
<BR>
<DT>
<B>SenseInfoBufferLength</B>
<DD>
Indicates the size in bytes of the request-sense buffer.
<BR>
<DT>
<B>SrbFlags</B>
<DD>
Indicates various parameters and options about the request. <B>SrbFlags</B>&nbsp;is
read-only, except when SRB_FLAGS_UNSPECIFIED_DIRECTION is set and miniport
drivers of slave DMA adapters are required to update SRB_FLAGS_DATA_IN or
SRB_FLAGS_DATA_OUT. This member can have one or more of the following flags
set:
<TABLE>
<TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>Value</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>Meaning</B>
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_FLAGS_QUEUE_ACTION_ENABLE
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates tagged-queue actions are to be enabled.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_FLAGS_DISABLE_AUTOSENSE
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates that request-sense information should not be returned.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_FLAGS_DATA_IN
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates data will be transferred from the device to the system.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_FLAGS_DATA_OUT
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates data will be transferred from the system to the device.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_FLAGS_UNSPECIFIED_DIRECTION
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Defined for backward compatibility with the ASPI/CAM SCSI interfaces, this
flag indicates that the transfer direction could be either of the preceding
because both of the preceding flags are set. If this flag is set, a miniport
driver should determine the transfer direction by examining the data phase for
the target on the SCSI bus. If its HBA is a slave DMA device, such a miniport
must update SRB_FLAGS_DATA_OUT or SRB_FLAGS_DATA_IN to the correct value
before it calls <B>ScsiPortIoMapTransfer</B>.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_FLAGS_NO_DATA_TRANSFER
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates no data transfer with this request. If this is set, the flags
SRB_FLAGS_DATA_OUT, SRB_FLAGS_DATA_IN, and SRB_FLAGS_UNSPECIFIED_DIRECTION are
clear.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_FLAGS_DISABLE_SYNCH_TRANSFER
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates the HBA, if possible, should not perform a synchronous negotiation
for this transfer request.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_FLAGS_DISABLE_DISCONNECT
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates the HBA should not allow the target to disconnect from the SCSI bus
during processing of this request.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_FLAGS_BYPASS_FROZEN_QUEUE
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Is irrelevant to miniport drivers.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_FLAGS_NO_QUEUE_FREEZE
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Is irrelevant to miniport drivers.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_FLAGS_IS_ACTIVE
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Is irrelevant to miniport drivers.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_FLAGS_ALLOCATED_FROM_ZONE
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Is irrelevant to miniport drivers. To a Windows NT class driver, this
indicates whether the SRB was allocated from a zone buffer. If this flag is
set, the class driver must call <B>ExInterlockedFreeToZone</B>&nbsp;to release the
SRB; otherwise, it must call <B>ExFreePool</B>.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
SRB_FLAGS_SGLIST_FROM_POOL
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Is irrelevant to miniport drivers. To a Windows NT class driver, this
indicates that memory for a scatter/gather list was allocated from nonpaged
pool. If this flag is set, the class driver must call <B>ExFreePool</B>&nbsp;to
release the memory after the SRB is completed. 
</FONT></TABLE>
<DT>
<B>DataTransferLength</B>
<DD>
Indicates the size in bytes of the data buffer. If an underrun occurs, the
miniport must update this member to the number of bytes actually transferred.
<BR>
<DT>
<B>TimeOutValue</B>
<DD>
Indicates the interval in seconds that the request can execute before the
OS-specific port driver might consider it timed out. Miniport drivers are not
required to time requests because the port driver already does.
<BR>
<DT>
<B>DataBuffer</B>
<DD>
Points to the data buffer. Miniport drivers should not use this value as a
data pointer unless the miniport set <B>MapBuffers</B>&nbsp;to TRUE in the
PORT_CONFIGURATION_INFORMATION for the HBA. In the case of
SRB_FUNCTION_IO_CONTROL requests, however, miniport drivers can use this value
as a data pointer regardless of the value of <B>MapBuffers</B>.
<BR>
<DT>
<B>SenseInfoBuffer</B>
<DD>
Points to the request-sense buffer. A miniport driver is not required to
provide request-sense data after a CHECK CONDITION. If it does, such a driver
should not use the <B>SenseInfoBuffer </B>value as a data pointer unless the
miniport set <B>MapBuffers</B>&nbsp;to TRUE in the PORT_CONFIGURATION_INFORMATION
for the HBA. The physical address of the buffer can be obtained by calling <B>ScsiPortGetPhysicalAddress</B>.
<BR>
<DT>
<B>NextSrb</B>
<DD>
Indicates the SCSI_REQUEST_BLOCK to which this request applies. Only a small
subset of requests use a second SRB, for example SRB_FUNCTION_ABORT_COMMAND.
<BR>
<DT>
<B>OriginalRequest</B>
<DD>
Points to the IRP for this request.
<BR>
<DT>
<B>SrbExtension</B>
<DD>
Points to the Srb extension. A miniport must not use this member if it set <B>SrbExtensionSize</B>
to zero in the SCSI_HW_INITIALIZATION_DATA. The memory at <B>SrbExtension</B>
is not initialized by the OS-specific port driver, and the miniport-determined
data can be accessed directly by the HBA. The corresponding physical address
can be obtained by calling <B>ScsiPortGetPhysicalAddress</B>&nbsp;with the <B>SrbExtension</B>
pointer.
<BR>
<DT>
<B>QueueSortKey</B>
<DD>
Specifies the offset from the start of the media or zero, depending on the
type of the target device. 
<BR>
<DT>
<B>Cdb</B>
<DD>
Specifies the SCSI-II command descriptor block to be sent to the target
device.
</DL>
<H3>Comments</H3>
<P>
Windows NT SCSI class and filter drivers can send SRBs with the following <B>Function</B>
values to the system port driver:
<UL>
<LI>
SRB_FUNCTION_CLAIM_DEVICE to indicate that the class driver supports a
peripheral identified in the SRB by the <B>PathId</B>, <B>TargetId</B>, and <B>Lun</B>
members.
<P>
<LI>
SRB_ATTACH_DEVICE to indicate that a filter driver, layered above a class
driver, wants requests for a particular peripheral to be routed first to the
filter driver.
<P>
<LI>
SRB_FUNCTION_RELEASE_DEVICE to indicate that a class driver is releasing its
claim on a particular peripheral.
<P>
<LI>
SRB_FUNCTION_FLUSH_QUEUE to request cancellation of any requests currently
queued in the port driver to a particular peripheral.
<P>
<LI>
SRB_FUNCTION_RELEASE_QUEUE to request that the port driver release a frozen
queue of requests to a particular peripheral.
</UL>
<P>
The preceding SRB_FUNCTION_<I>XXX</I>&nbsp; are never set in SRBs sent to SCSI
miniport drivers. SRB_FUNCTION_REMOVE_DEVICE is defined for use in future
versions of the system. It, too, is never set in SRBs sent to SCSI miniport
drivers. 
<H3>See Also</H3>
<P>
<B><A HREF="k102_21.htm">ExFreePool</A></B>, <B><A HREF="k102_42.htm">ExInterlockedFreeToZone</A></B>,
<A HREF="k305_2.htm">HW_INITIALIZATION_DATA</A>, <A HREF="k305_3.htm">PORT_CONFIGURATION_INFORMATION</A>,
<B><A HREF="k301_9.htm">ScsiPortGetPhysicalAddress</A></B>,
<B><A HREF="k301_10.htm">ScsiPortGetSrb</A></B>, <B><A HREF="k301_14.htm">ScsiPortIoMapTransfer</A></B>,
<B><A HREF="k301_17.htm">ScsiPortNotification</A></B>, <A HREF="k305_5.htm">SRB_IO_CONTROL</A>
<P>
&nbsp;
<P>
&nbsp;
<P></FONT>
</BODY>
</HTML>
