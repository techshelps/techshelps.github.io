<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IoAllocateMdl</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_IoAllocateMdl_KR"></A>IoAllocateMdl</H2>
<P>
<B>PMDL <BR>
&nbsp; &nbsp; IoAllocateMdl(</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PVOID</B>&nbsp; <I>VirtualAddress</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN ULONG</B>&nbsp; <I>Length</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN BOOLEAN</B>&nbsp; <I>SecondaryBuffer</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN BOOLEAN</B>&nbsp; <I>ChargeQuota</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN OUT PIRP</B>&nbsp; <I>Irp</I>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; /* optional */<BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>);</B>
<P>
<B>IoAllocateMdl</B>&nbsp;allocates an MDL large enough to map a buffer, given its
starting address and length. Optionally, this routine associates the MDL with
an IRP.
<H3>Parameters</H3>
<DL>
<DT>
<I>VirtualAddress</I>
<DD>
Points to the base virtual address of the buffer the MDL is to describe.
<BR>
<DT>
<I>Length</I>
<DD>
Specifies the length in bytes of the buffer the MDL is to describe.
<BR>
<DT>
<I>SecondaryBuffer</I>
<DD>
Indicates whether the buffer is a primary or secondary buffer. This parameter
determines how the MDL is to be linked to the IRP. All buffers except the
first buffer described by an MDL in an IRP are considered secondary buffers.
This field must be FALSE if no IRP is associated with the MDL.
<BR>
<DT>
<I>ChargeQuota</I>
<DD>
Should be set to FALSE by intermediate drivers. This can be set to TRUE only
by highest-level drivers that are called in the context of the thread that
originates the I/O request for which the driver is allocating another IRP.
<BR>
<DT>
<I>Irp</I>
<DD>
Points to an IRP to be associated with the MDL. If the <I>Irp</I>&nbsp;pointer is
nonNULL, the allocated MDL is associated with the specified IRP’s MDL list,
according to the value of <I>SecondaryBuffer</I>.
</DL>
<H3>Return Value</H3>
<P>
<B>IoAllocateMdl</B>&nbsp;returns a pointer to an MDL or a NULL pointer if the MDL
cannot be allocated.
<H3>Comments</H3>
<P>
<B>IoAllocateMdl</B>&nbsp;can be used by a driver that needs to break a buffer into
pieces, each mapped by a separate MDL, or to map a driver-allocated buffer.
The driver should call <B>MmBuildMdlForNonPagedPool</B>&nbsp;with the MDL allocated
by this call to set up an MDL describing a driver-allocated buffer in nonpaged
pool.
<P>
Callers of <B>IoAllocateMdl</B>&nbsp;must be running at IRQL &lt;= DISPATCH_LEVEL.
<H3>See Also</H3>
<P>
<B><A HREF="k104_14.htm">IoBuildPartialMdl</A></B>, <B><A HREF="k104_38.htm">IoFreeMdl</A></B>,
<B><A HREF="k106_10.htm">MmBuildMdlForNonPagedPool</A></B>&nbsp;
<P></FONT>
</BODY>
</HTML>
