<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>ZwWriteFile</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_ZwWriteFile_KR"></A>ZwWriteFile</H2>
<P>
<B>NTSTATUS  <BR>
&nbsp; &nbsp; ZwWriteFile(</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN HANDLE</B>&nbsp; <I>FileHandle</I><B>,<BR>
</B><I>&nbsp; &nbsp; &nbsp; &nbsp; </I><B>IN HANDLE</B>&nbsp; <I>Event</I><B>,</B><I>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </I>/*
optional */<I><BR>
&nbsp; &nbsp; &nbsp; &nbsp; </I><B>IN PIO_APC_ROUTINE</B><I>&nbsp; ApcRoutine</I><B>,</B><I>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </I>/*
optional */<I><BR>
&nbsp; &nbsp; &nbsp; &nbsp; </I><B>IN PVOID</B>&nbsp; <I>ApcContext</I><B>,</B><I>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </I>/*
optional */<I><BR>
&nbsp; &nbsp; &nbsp; &nbsp; </I><B>OUT PIO_STATUS_BLOCK</B>&nbsp; <I>IoStatusBlock</I><B>,<BR>
</B><I>&nbsp; &nbsp; &nbsp; &nbsp; </I><B>IN PVOID</B>&nbsp; <I>Buffer</I><B>,<BR>
</B><I>&nbsp; &nbsp; &nbsp; &nbsp; </I><B>IN ULONG</B>&nbsp; <I>Length</I><B>,<BR>
</B><I>&nbsp; &nbsp; &nbsp; &nbsp; </I><B>IN PLARGE_INTEGER</B>&nbsp; <I>ByteOffset</I><B>,</B>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /*
optional */<I><BR>
&nbsp; &nbsp; &nbsp; &nbsp; </I><B>IN PULONG</B>&nbsp; <I>Key</I>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* optional */<BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>);</B>
<P>
Data can be written to an open file with <B>ZwWriteFile</B>.
<H3>Parameters</H3>
<DL>
<DT>
<I>FileHandle</I>
<DD>
Is the handle returned by a successful call to <B>ZwCreateFile</B>.
<BR>
<DT>
<I>Event</I>
<DD>
Is an optional handle for an event to be set to the Signaled state when the
write operation completes. Device and intermediate drivers should set this
parameter to NULL.
<BR>
<DT>
<I>ApcRoutine</I>
<DD>
Device and intermediate drivers should set this pointer to NULL.
<BR>
<DT>
<I>ApcContext</I>
<DD>
Device and intermediate drivers should set this pointer to NULL.
<BR>
<DT>
<I>IoStatusBlock</I>
<DD>
Points to a variable that receives the final completion status and information
about the requested write operation.
<BR>
<DT>
<I>Buffer</I>
<DD>
Points to a caller-allocated buffer containing the data to be written to the
file.
<BR>
<DT>
<I>Length</I>
<DD>
Specifies the size in bytes of the given <I>Buffer</I>. A successful call to <B>ZwWriteFile</B>
transfers the given number of bytes to the file. If necessary, the length of
the file is extended.
<BR>
<DT>
<I>ByteOffset</I>
<DD>
Points to a variable specifying the starting byte offset within the file at
which to begin the write operation. If a given <I>Length</I>&nbsp;and <I>ByteOffset</I>
specify a write operation past the current end-of-file mark, <B>ZwWriteFile</B>
automatically extends the file and updates the end-of-file mark; any bytes
that are not explicitly written between such old and new end-of-file marks are
defined to be zero.
<P>
If the call to <B>ZwCreateFile</B>&nbsp;set only the <I>DesiredAccess</I>&nbsp;flag
FILE_APPEND_DATA, <I>ByteOffset</I>&nbsp;is ignored. Data in the given <I>Buffer</I>,
for <I>Length</I>&nbsp;bytes, is written starting at the current end of file.
<P>
If the call to <B>ZwCreateFile</B>&nbsp;set either of the <I>CreateOptions</I>
flags FILE_SYNCHRONOUS_IO_ALERT or FILE_SYNCHRONOUS_IO_NONALERT, the I/O
Manager maintains the current file position. If so, the caller of <B>ZwWriteFile</B>
can specify that the current file position offset be used instead of an
explicit <I>ByteOffset</I>&nbsp;value in either of the following ways:
<UL>
<LI>
Specify the system-defined value FILE_USE_FILE_POINTER_POSITION.
<P>
<LI>
Pass a NULL pointer for <I>ByteOffset</I>.
</UL>
<P>
<B>ZwWriteFile</B>&nbsp;updates the current file position by adding the number of
bytes written when it completes the write operation, if it is using the
current file position maintained by the I/O Manager.
<P>
Even when the I/O Manager is maintaining the current file position, the caller
can reset this position by passing an explicit <I>ByteOffset</I>&nbsp;value to <B>ZwWriteFile</B>.
Doing this automatically changes the current file position to that <I>ByteOffset</I>,
performs the write, and then updates the position according to the number of
bytes actually written. This technique gives the caller atomic seek-and-write
service.
<P>
It is also possible to cause a write to start at the current end of file by
specifying FILE_WRITE_TO_END_OF_FILE for the <I>ByteOffset </I>parameter even
if the I/O Manager is not maintaining the current file position.
<BR>
<DT>
<I>Key</I>
<DD>
Device and intermediate drivers should set this pointer to NULL.
</DL>
<H3>Return Value</H3>
<P>
<B>ZwWriteFile</B>&nbsp;either returns STATUS_SUCCESS or an appropriate error
status. The number of bytes actually written to the file is returned in the <B>Information</B><I>
</I>member of <I>IoStatusBlock</I>.
<H3>Comments</H3>
<P>
Callers of <B>ZwWriteFile</B>&nbsp;must have already called <B>ZwCreateFile</B>
with the <I>DesiredAccess</I>&nbsp;flags FILE_WRITE_DATA and/or FILE_APPEND_DATA
set, either explicitly or by setting these flags with GENERIC_WRITE. Note that
having only FILE_APPEND_DATA access to a file does not allow the caller to
write anywhere in the file except at the current end-of-file mark, while
having FILE_WRITE_DATA access to a file does not preclude the caller from
writing to or beyond the end of a file.
<P>
If the preceding call to <B>ZwCreateFile</B>&nbsp;set the <I>CreateOptions</I>&nbsp;flag
FILE_NO_INTERMEDIATE_BUFFERING, certain restrictions on the parameters to <B>ZwWriteFile</B>
are enforced. See <B>ZwCreateFile</B>&nbsp;for specifics.
<P>
<B>ZwWriteFile</B>&nbsp;begins writing data from the given <I>Buffer</I>&nbsp;at the
given <I>ByteOffset</I>&nbsp;in the file<I>,</I>&nbsp;at the current file position
within the file, or at the end-of-file mark. It terminates the write operation
when it has written <I>Length</I>&nbsp;bytes to the file, extending the length of
the file if necessary, and resetting the end-of-file mark.
<P>
If the caller opened the file with the <I>DesiredAccess</I>&nbsp;SYNCHRONIZE flag
set, the caller can wait on this routine’s setting the given <I>FileHandle</I>
to the Signaled state.
<P>
Callers of <B>ZwWriteFile</B>&nbsp;must be running at IRQL PASSIVE_LEVEL.
<H3>See Also</H3>
<P>
<B><A HREF="k105_17.htm">KeInitializeEvent</A></B>, <B><A HREF="k111_3.htm">ZwCreateFile</A></B>,
<B><A HREF="k111_13.htm">ZwQueryInformationFile</A></B>, <B><A HREF="k111_16.htm">ZwReadFile</A></B>,
<B><A HREF="k111_17.htm">ZwSetInformationFile</A></B>&nbsp;
<P>
&nbsp;
<P></FONT>
</BODY>
</HTML>
