<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>ScsiPortValidateRange</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_ScsiPortValidateRange_KR"></A>ScsiPortValidateRange</H2>
<P>
<B>BOOLEAN <BR>
&nbsp; &nbsp; ScsiPortValidateRange(</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PVOID</B>&nbsp; <I>HwDeviceExtension</I><B>,</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN INTERFACE_TYPE</B>&nbsp; <I>BusType</I><B>,</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN ULONG</B>&nbsp; <I>SystemIoBusNumber</I><B>,</B><I><BR>
&nbsp; &nbsp; &nbsp; &nbsp; </I><B>IN SCSI_PHYSICAL_ADDRESS</B><I>&nbsp; IoAddress</I><B>,</B><I><BR>
&nbsp; &nbsp; &nbsp; &nbsp; </I><B>IN ULONG</B><I>&nbsp; NumberOfBytes</I><B>,</B><I><BR>
&nbsp; &nbsp; &nbsp; &nbsp; </I><B>IN BOOLEAN</B><I>&nbsp; InIoSpace</I><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>);</B>
<P>
<B>ScsiPortValidateRange</B>&nbsp;indicates whether the specified access range
values have already been claimed in the registry by another driver.
<H3>Parameters</H3>
<DL>
<DT>
<I>HwDeviceExtension</I>
<DD>
Points to the per-HBA storage the OS-specific port driver allocated,
initialized with zeros, and passed in to the miniport’s HwScsiFindAdapter
routine.
<BR>
<DT>
<I>BusType</I>
<DD>
Is the value of the <B>AdapterInterfaceType</B>&nbsp;member in the
PORT_CONFIGURATION_INFORMATION structure when HwScsiFindAdapter is called.
<BR>
<DT>
<I>SystemIoBusNumber</I>
<DD>
Is the value of the <B>SystemIoBusNumber</B>&nbsp;member in the configuration
information when HwScsiFindAdapter is called.
<BR>
<DT>
<I>IoAddress</I>
<DD>
Is a bus-relative base address for the range of ports or device memory to be
validated <I>before</I>&nbsp;the miniport’s HwScsiFindAdapter routine attempts to
map the access range for the adapter at that address.
<BR>
<DT>
<I>NumberOfBytes</I>
<DD>
Specifies the size in bytes or number of elements in the range.
<BR>
<DT>
<I>InIoSpace</I>
<DD>
TRUE indicates the range is in I/O space, rather than in memory.
</DL>
<H3>Return Value</H3>
<P>
<B>ScsiPortValidateRange</B>&nbsp;returns TRUE if the HwScsiFindAdapter routine can
safely map and use the mapped range to access the adapter. <B>ScsiPortValidateRange</B>
returns FALSE if the specified access range values have already been claimed
in the registry by another driver.
<H3>Comments</H3>
<P>
<B>ScsiPortValidateRange </B>can be called only from a miniport driver’s
HwScsiFindAdapter routine. Calls from other miniport driver routines will
result in system failure or incorrect operation for the caller.
<P>
If the OS-specific port driver initializes any <B>AccessRanges</B>&nbsp;element of
the PORT_CONFIGURATION_INFORMATION structure before it calls the miniport’s
HwScsiFindAdapter routine, the miniport must pass the supplied values to <B>ScsiPortGetDeviceBase</B>
and use the mapped logical addresses for the range to determine whether an HBA
is one that it supports.
<P>
The port driver either fills an ACCESS_RANGE-type element with a complete
description of a bus-relative address range for an adapter, or the port driver
zeros all members of the element.
<P>
For input <B>AccessRanges</B>&nbsp;elements set with default zeros, the
HwScsiFindAdapter routine can attempt to locate an adapter it supports on the
given I/O bus. In these circumstances, a miniport driver usually has a set of
driver-determined default addresses for its type(s) of HBA. However, a
previously loaded driver might already be using an initialized adapter at one
of this miniport’s default address ranges, particularly in x86-only systems in
which some devices are initialized in x86 real mode. To prevent such a device
from being inadvertantly reprogrammed, each miniport driver’s
HwScsiFindAdapter routine should call <B>ScsiPortValidateRange</B>&nbsp;before it
maps any driver-supplied addresses with <B>ScsiPortGetDeviceBase</B>&nbsp;and then
uses the mapped logical addresses to interrogate adapters on an I/O bus.
<P>
If <B>ScsiPortValidateRange</B>&nbsp;returns FALSE, HwScsiFindAdapter must not
attempt to map the input range addresses because another driver has already
claimed the range in the registry.
<P>
If <B>ScsiPortValidateRange</B>&nbsp;returns TRUE, HwScsiFindAdapter can safely do
the following:
<OL>
<LI>
Map the bus-relative range addresses to system-space logical range addresses
with <B>ScsiPortGetDeviceBase</B>.
<P>
<LI>
Use the mapped logical addresses with the <B>ScsiPortRead/Write</B><I>Xxx</I>
to determine whether the adapter actually is an HBA that the driver supports.
</OL>
<P>
If a miniport uses a range successfully passed to <B>ScsiPortValidateRange</B>
for an HBA it supports, that driver must invert the <I>InIoSpace</I>&nbsp;value
when it sets the <B>RangeInMemory</B>&nbsp;member of an <B>AccessRanges</B>&nbsp;element
in the PORT_CONFIGURATION_INFORMATION.
<H3>See Also</H3>
<P>
<A HREF="k305_1.htm">ACCESS_RANGE</A>, <A HREF="k302_6.htm">HwScsiFindAdapter</A>,
<A HREF="k305_3.htm">PORT_CONFIGURATION_INFORMATION</A>,
<B><A HREF="k301_7.htm">ScsiPortGetDeviceBase</A></B>, <B><A HREF="k301_13.htm">ScsiPortInitialize</A></B>,
<B>ScsiPortRead</B><I>Xxx</I>, <B>ScsiPortWrite</B><I>Xxx</I>
<P></FONT>
</BODY>
</HTML>
