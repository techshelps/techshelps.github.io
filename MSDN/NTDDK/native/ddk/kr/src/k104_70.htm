<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IoSetNextIrpStackLocation</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_IoSetNextIrpStackLocation_KR"></A>IoSetNextIrpStackLocation</H2>
<P>
<B>VOID <BR>
&nbsp; &nbsp; IoSetNextIrpStackLocation(</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN OUT PIRP</B>&nbsp; <I>Irp</I><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>);</B>
<P>
<B>IoSetNextIrpStackLocation</B>&nbsp;sets the IRP stack location in a
driver-allocated IRP to that of the caller.
<H3>Parameters</H3>
<DL>
<DT>
<I>Irp</I>
<DD>
Points to the IRP whose stack location is to be set.
</DL>
<H3>Comments</H3>
<P>
In general, this routine is seldom used by drivers. It is primarily used by
drivers that require their own stack location in an IRP that they have
allocated, on their own, to send to another driver.
<P>
<B>IoSetNextIrpStackLocation</B>&nbsp;is generally not needed because either:
<UL>
<LI>
The driver received the IRP it is passing from another, higher-level driver,
and so it already owns a stack location,
<P>
<LI>
Or, the driver allocated the IRP but does not need its own stack location
because it can keep everything that it needs in a context block whose address
can be passed to its IoCompletion routine.
</UL>
<P>
Care should be taken if this routine is called, especially when allocating the
IRP with <B>IoAllocateIrp</B>&nbsp;or <B>IoMakeAssociatedIrp</B>. The writer of the
allocating driver must remember that a caller-specific stack location is not
included in the number of stack locations required by the lower-level drivers
to which it sends IRPs with <B>IoCallDriver</B>. A driver must explicitly
specify a stack location for itself in its call to <B>IoAllocateIrp</B>&nbsp;or <B>IoMakeAssociatedIrp</B>
if it calls <B>IoSetNextIrpStackLocation</B>&nbsp;with the IRP returned by either
routine.
<P>
A driver cannot call <B>IoSetNextIrpStackLocation</B>&nbsp;with any IRP it
allocates by calling <B>IoBuildAsynchronousFsdRequest</B>, <B>IoBuildDeviceIoControlRequest</B>,
or <B>IoBuildSynchronousFsdRequest</B>.
<P>
Callers of <B>IoSetNextIrpStackLocation</B>&nbsp;must be running at IRQL &lt;=
DISPATCH_LEVEL.
<H3>See Also</H3>
<P>
<A HREF="k112_26.htm">IO_STACK_LOCATION</A>, <B><A HREF="k104_5.htm">IoAllocateIrp</A></B>,
<B><A HREF="k104_12.htm">IoBuildAsynchronousFsdRequest</A></B>,
<B><A HREF="k104_13.htm">IoBuildDeviceIoControlRequest</A></B>,
<B><A HREF="k104_15.htm">IoBuildSynchronousFsdRequest</A></B>,
<B><A HREF="k104_16.htm">IoCallDriver</A></B>, <B><A HREF="k104_68.htm">IoSetCompletionRoutine</A></B>
<P></FONT>
</BODY>
</HTML>
