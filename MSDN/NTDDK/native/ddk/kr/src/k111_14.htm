<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>ZwQueryKey</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_ZwQueryKey_KR"></A>ZwQueryKey</H2>
<P>
<B>NTSTATUS <BR>
&nbsp; &nbsp; ZwQueryKey(</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN HANDLE</B>&nbsp; <I>KeyHandle</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN KEY_INFORMATION_CLASS</B>&nbsp; <I>KeyInformationClass</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>OUT PVOID</B>&nbsp; <I>KeyInformation</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN ULONG</B>&nbsp; <I>Length</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>OUT PULONG</B>&nbsp; <I>ResultLength</I><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>);</B>
<P>
<B>ZwQueryKey</B>&nbsp;provides data about the class of a key, and the number and
sizes of its subkeys.
<H3>Parameters</H3>
<DL>
<DT>
<I>KeyHandle</I>
<DD>
Is the handle, returned by a successful call to <B>ZwCreateKey</B>&nbsp;or <B>ZwOpenKey</B>,
of the key to be queried.
<BR>
<DT>
<I>Index</I>
<DD>
Specifies the zero-based index of a subkey for which the key information is
requested.
<BR>
<DT>
<I>KeyInformationClass</I>
<DD>
Specifies the type of information returned in the buffer as one of the
following:
<P>
<B>KeyBasicInformation<BR>
KeyFullInformation<BR>
KeyNodeInformation</B>
<BR>
<DT>
<I>KeyInformation</I>
<DD>
Points to a caller-allocated buffer to receive the requested data.
<BR>
<DT>
<I>Length</I>
<DD>
Is the size in bytes of the <I>KeyInformation</I>&nbsp;buffer, which the caller
should set according to the given <I>KeyInformationClass</I>.
<BR>
<DT>
<I>ResultLength</I>
<DD>
Points to number of bytes actually returned to <I>KeyInformation</I>&nbsp;or, if
the input <I>Length</I>&nbsp;is too small, points to the number of bytes required
for the available information.
</DL>
<H3>Return Value</H3>
<P>
<B>ZwQueryKey</B>&nbsp;returns STATUS_SUCCESS if it returned the requested
information in the <I>KeyInformation </I>buffer. Otherwise, <B>ZwQueryKey</B>
can return one of the following values:
<P>
STATUS_BUFFER_OVERFLOW<BR>
STATUS_INVALID_PARAMETER
<H3>Comments</H3>
<P>
The<I>&nbsp;KeyHandle</I>&nbsp;passed to <B>ZwQueryKey</B>&nbsp;must have been opened with
the KEY_QUERY_KEY <I>DesiredAccess</I>&nbsp;flag set for this call to succeed. See <B>ZwCreateKey</B>
for a description of possible values for <I>DesiredAccess</I>.
<P>
<B>ZwQueryKey</B>&nbsp;returns information about the size of the value entries, the
number of subkeys, the length of their names, and the size of their value
entries that its caller can use to allocate buffers for registry data.
<P>
For example, a successful caller of <B>ZwQueryKey</B>&nbsp;might allocate a buffer
for a subkey, call <B>ZwEnumerateKey</B>&nbsp;to get the name of the subkey, and
pass that name to an <B>Rtl..Registry</B>&nbsp;routine.
<P>
Callers of <B>ZwQueryKey</B>&nbsp;must be running at IRQL PASSIVE_LEVEL.
<H3>See Also</H3>
<P>
<A HREF="k112_29.htm">KEY_BASIC_INFORMATION</A>, <A HREF="k112_30.htm">KEY_FULL_INFORMATION</A>,
<A HREF="k112_31.htm">KEY_NODE_INFORMATION</A>, <B><A HREF="k111_1.htm">ZwClose</A></B>,
<B><A HREF="k111_6.htm">ZwEnumerateKey</A></B>, <B><A HREF="k111_11.htm">ZwOpenKey</A></B>
<P></FONT>
</BODY>
</HTML>
