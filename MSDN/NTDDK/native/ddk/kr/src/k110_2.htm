<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>SeAssignSecurity</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_SeAssignSecurity_KR"></A>SeAssignSecurity</H2>
<P>
<B>NTSTATUS <BR>
&nbsp; &nbsp; SeAssignSecurity(</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PSECURITY_DESCRIPTOR</B>&nbsp; <I>ParentDescriptor</I><B>,</B>&nbsp; &nbsp; &nbsp; &nbsp; /* optional*/<BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PSECURITY_DESCRIPTOR</B>&nbsp; <I>ExplicitDescriptor</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>OUT PSECURITY_DESCRIPTOR</B>&nbsp; <I>*NewDescriptor</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN BOOLEAN</B>&nbsp; <I>IsDirectoryObject</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PSECURITY_SUBJECT_CONTEXT</B>&nbsp; <I>SubjectContext</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PGENERIC_MAPPING</B>&nbsp; <I>GenericMapping</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN POOL_TYPE</B>&nbsp; <I>PoolType</I><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>);</B>
<P>
<B>SeAssignSecurity</B>&nbsp;builds a self-relative security descriptor for a new
object, given the security descriptor of its parent directory and any
originally requested security for the object.
<H3>Parameters</H3>
<DL>
<DT>
<I>ParentDescriptor</I>
<DD>
Points to a buffer containing the security descriptor of the parent directory
containing the new object being created.
<BR>
<DT>
<I>ExplicitDescriptor</I>
<DD>
Points to a buffer containing the security descriptor specified by the user
that is applied to the new object.
<BR>
<DT>
<I>NewDescriptor</I>
<DD>
Receives a pointer to the returned security descriptor for which this routine
allocates a buffer according to the given <I>PoolType</I>.
<BR>
<DT>
<I>IsDirectoryObject</I>
<DD>
Specifies whether the new object is a directory object. TRUE indicates the
object contains other objects.
<BR>
<DT>
<I>SubjectContext</I>
<DD>
Points to a buffer containing the security context of the subject creating the
object. This is used to retrieve default security information for the new
object, such as the default owner, the primary group, and discretionary access
control.
<BR>
<DT>
<I>GenericMapping</I>
<DD>
Points to an array of access mask values denoting the mapping between each
generic right to nongeneric rights.
<BR>
<DT>
<I>PoolType</I>
<DD>
Specifies the pool type to use when allocating a new security descriptor,
which can be one of the following:
<P>
<B>NonPagedPool<BR>
PagedPool<BR>
NonPagedPoolMustSucceed<BR>
NonPagedPoolCacheAligned<BR>
NonPagedPoolCacheAlignedMustS<BR>
PagedPoolCacheAligned</B>
<P>
Usually, a caller specifies <B>PagedPool,</B>&nbsp;or else <B>NonPagedPool</B>&nbsp;if
the buffer will be accessed at raised IRQL in an arbitrary thread context.
</DL>
<H3>Return Value</H3>
<P>
<B>SeAssignSecurity</B>&nbsp;can return one of the following:
<TABLE>
<TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>Status</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>Meaning</B>
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
STATUS_SUCCESS
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates the operation was successful.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
STATUS_INVALID_OWNER
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
The owner SID that was provided as the owner of the target security descriptor
is not one the caller is authorized to assign as the owner of an object.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
STATUS_PRIVILEGE_NOT_HELD
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
The caller does not have the privilege (<B>SeSecurityPrivilege</B>) necessary
to explicitly assign the specified system ACL.
</FONT></TABLE>
<H3>Comments</H3>
<P>
Network transport drivers call this routine.
<P>
The final security descriptor returned to the caller may contain a mix of
information, some explicitly provided from the new object’s parent.
<P>
<B>SeAssignSecurity</B>&nbsp;assumes privilege checking has not been performed.
This routine performs privilege checking.
<P>
The assignment of system and discretionary ACLs is governed by the logic
illustrated in the following table:
<TABLE>
<TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>Explicit (nondefault) ACL specified</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>Explicit default ACL specified</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>No ACL specified</B>
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>Inheritable ACL from parent</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Assign specified ACL
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Assign inherited ACL
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Assign inherited ACL
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>No inheritable ACL from parent</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Assign specified ACL
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Assign default ACL
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Assign no ACL
</FONT></TABLE>
<P>
An explicitly specified ACL, whether a default ACL or not, can be empty or
null. The caller must be a kernel-mode client or be appropriately privileged
to explicitly assign a default or nondefault system ACL.
<P>
The assignment of the new object’s owner and group is governed by the
following logic:
<UL>
<LI>
If the passed security descriptor includes an owner, it is assigned as the new
object’s owner. Otherwise, the caller’s token is considered to determine the
owner. Within the token, the default owner, if any, is assigned. Otherwise,
the caller’s user ID is assigned.
<P>
<LI>
If the passed security descriptor includes a group, it is assigned as the new
object’s group. Otherwise, the caller’s token is considered to determine the
group. Within the token, the default group, if any, is assigned. Otherwise,
the caller’s primary group ID is assigned.
</UL>
<P>
Callers of <B>SeAssignSecurity</B>&nbsp;must be running at IRQL PASSIVE_LEVEL.
<H3>See Also</H3>
<P>
<B><A HREF="k104_44.htm">IoGetFileObjectGenericMapping</A></B>,
<B><A HREF="k110_3.htm">SeDeassignSecurity</A></B>&nbsp;
<P></FONT>
</BODY>
</HTML>
