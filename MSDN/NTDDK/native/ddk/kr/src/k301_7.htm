<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>ScsiPortGetDeviceBase</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_ScsiPortGetDeviceBase_KR"></A>ScsiPortGetDeviceBase</H2>
<P>
<B>PVOID <BR>
&nbsp; &nbsp; ScsiPortGetDeviceBase(</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PVOID</B>&nbsp; <I>HwDeviceExtension</I><B>,</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN INTERFACE_TYPE</B>&nbsp; <I>BusType</I><B>,</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN ULONG</B>&nbsp; <I>SystemIoBusNumber</I><B>,</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN SCSI_PHYSICAL_ADDRESS</B>&nbsp; <I>IoAddress</I><B>,</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN ULONG</B>&nbsp; <I>NumberOfBytes</I><B>,</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN BOOLEAN</B>&nbsp; <I>InIoSpace</I><B>,</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>);</B>
<P>
<B>ScsiPortGetDeviceBase</B>&nbsp;returns a mapped, logical base address that can
be used to communicate with an HBA. Every miniport driver must pass mapped,
logical access range addresses to the <B>ScsiPort..Port</B><I>Xxx</I>&nbsp;and <B>ScsiPort..Register</B><I>Xxx</I>
routines to communicate with its HBA(s).
<H3>Parameters</H3>
<DL>
<DT>
<I>HwDeviceExtension</I>
<DD>
Points to the miniport driver’s per-HBA storage area. Miniports usually store
their mapped access ranges addresses for the HBA in this extension.
<BR>
<DT>
<I>BusType</I>
<DD>
Specifies the interface type of the I/O bus on which the HBA is connected. The
miniport’s HwScsiFindAdapter routine obtains the value for this parameter from
the <B>AdapterInterfaceType</B>&nbsp;member of the input
PORT_CONFIGURATION_INFORMATION.
<BR>
<DT>
<I>SystemIoBusNumber</I>
<DD>
Specifies the system-assigned number of the I/O bus on which the HBA is
connected. The HwScsiFindAdapter routine obtains the value for this parameter
from the <B>SystemIoBusNumber</B>&nbsp;member of the input
PORT_CONFIGURATION_INFORMATION.
<BR>
<DT>
<I>IoAddress</I>
<DD>
Specifies the bus-relative base address of a range used by the HBA. The
HwScsiFindAdapter routine obtains the value for this parameter from one of the
<B>AccessRanges</B>&nbsp;elements in the PORT_CONFIGURATION_INFORMATION if the port
driver supplies range-configuration information. Otherwise, this address can
be a value returned by <B>ScsiPortGetBusData</B>&nbsp;or a miniport-supplied
default value. Avoid using a base address of zero because its successful
return status can conflict with the error status (NULL).
<BR>
<DT>
<I>NumberOfBytes</I>
<DD>
Specifies the size in bytes of the range that the mapping should cover. The
HwScsiFindAdapter routine obtains the value of this parameter from the same <B>AccessRanges</B>
element as <I>IoAddress</I>&nbsp;if the port driver supplies range configuration
information. Otherwise, this value can be returned by <B>ScsiPortGetBusData</B>
or a miniport-supplied default. In any case, the driver must not access the
hardware outside of the returned, mapped range.
<BR>
<DT>
<I>InIoSpace</I>
<DD>
TRUE indicates the range to be mapped is in I/O space, and the miniport will
pass mapped addresses in this range to the <B>ScsiPort...Port</B><I>Xxx</I>&nbsp;to
communicate with the HBA. The HwScsiFindAdapter routine obtains the value of
this parameter from the same <B>AccessRanges</B>&nbsp;element as <I>IoAddress</I>.
Note that a miniport driver <I>must invert</I>&nbsp;the value of the <B>InMemorySpace</B>
member in an ACCESS_RANGE-type element before it is passed to <B>ScsiPortGetDeviceBase</B>
as the <I>InIoSpace</I>&nbsp;argument.
</DL>
<H3>Return Value</H3>
<P>
<B>ScsiPortGetDeviceBase</B>&nbsp;returns a mapped logical base address for the
given <I>IoAddress</I>&nbsp;if it successfully mapped the given range from <I>IoAddress</I>
to <I>NumberOfBytes</I>. If a given range cannot be mapped, <B>ScsiPortGetDeviceBase</B>
returns NULL.
<H3>Comments</H3>
<P>
Windows NT platforms can have several types of I/O buses and several I/O buses
of the same type. Moreover, the HAL can map I/O space to memory in some
platforms.
<P>
Consequently, a miniport driver cannot use bus-relative access range addresses
to communicate with its HBA. To maintain miniport driver portability across
CISC- and RISC-based machines, the addresses they use to access HBAs must be
translated with <B>ScsiPortGetDeviceBase</B>.
<P>
Every miniport driver must use system-space logical range addresses, mapped by
<B>ScsiPortGetDeviceBase</B>, to communicate with its HBA(s). Calls to the <B>ScsiPort...Port/Register</B><I>Xxx</I>
routines require these mapped, logical addresses.
<P>
<B>ScsiPortGetDeviceBase</B>&nbsp;can be called several times, depending on how
many HBAs the miniport driver supports and how many access ranges each HBA
requires. Each mapped range corresponds to a range of bus-relative device
addresses specified in an ACCESS_RANGE-type element of the <B>AccessRanges</B>
array.
<P>
<B>ScsiPortGetDeviceBase</B>&nbsp;can be called only from a miniport driver’s
HwScsiFindAdapter routine. Calls from other miniport routines will result in
system failure or in incorrect operation for the caller.
<P>
Follow these guidelines for calling <B>ScsiPortGetDeviceBase</B>:
<UL>
<LI>
If HwScsiFindAdapter is using a miniport-supplied set of default bus-relative
access ranges or values returned by <B>ScsiPortGetBusData</B>, it should call <B>ScsiPortValidateRange</B>
before attempting to call <B>ScsiPortGetDeviceBase</B>.
<P>
<LI>
If HwScsiFindAdapter determines that a particular HBA is not one that the
miniport supports, it must call <B>ScsiPortFreeDeviceBase</B>&nbsp;to release the
mapping(s) it set up to communicate with that HBA.
</UL>
<P>
The logical address returned by <B>ScsiPortGetDeviceBase</B>&nbsp;should be used
for all subsequent references made to the hardware but should <I>not</I>&nbsp;be
added to any <B>AccessRanges</B>&nbsp;specification in the
PORT_CONFIGURATION_INFORMATION. Miniport driver writers should make no
assumptions about how many bits are used in the logical base address returned
by <B>ScsiPortGetDeviceBase</B>.
<H3>See Also</H3>
<P>
<A HREF="k305_1.htm">ACCESS_RANGE</A>, <A HREF="k302_6.htm">HwScsiFindAdapter</A>,
<B><A HREF="k301_5.htm">ScsiPortFreeDeviceBase</A></B>, <B><A HREF="k301_6.htm">ScsiPortGetBusData</A></B>,
<B>ScsiPortRead</B><I>Xxx</I>, <B><A HREF="k301_32.htm">ScsiPortValidateRange</A></B>,
<B>ScsiPortWrite</B><I>Xxx</I>, <A HREF="k305_3.htm">PORT_CONFIGURATION_INFORMATION</A>
<P></FONT>
</BODY>
</HTML>
