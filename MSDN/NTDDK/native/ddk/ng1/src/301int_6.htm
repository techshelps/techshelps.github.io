<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>1.2.1  Opening an Adapter Underlying an Intermediate Driver</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H3><A NAME="DDK_Opening_an_Adapter_Underlying_an_Intermediate_Driver_NG"></A>1.2.1  Opening an Adapter Underlying an Intermediate Driver </H3>
<P>
ProtocolBindAdapter uses the value at <I>DeviceName</I>&nbsp;to open an underlying
NIC or virtual NIC, thereby establishing a binding to the underlying NIC
driver. It can also read additional configuration information it requires from
the registry. <B>NdisOpenProtocolConfiguration</B>&nbsp;is called to obtain a
handle to the registry key where the intermediate driver stores any
adapter-specific information, and the <B>NdisRead(Write)Configuration</B>
functions are called to read and write such information. The <B>NdisRead(Write)Configuration</B>
functions are described in the <I>Network Driver Reference</I>. 
<P>
Typically, ProtocolBindAdapter uses the context area it allocates to represent
its binding to <I>DeviceName</I>&nbsp;as storage for any binding-specific
information associated with the bound adapter. 
<P>
Binding is accomplished by calling <B>NdisOpenAdapter</B>, declared as
follows:
<P>
<B>VOID<BR>
&nbsp; &nbsp; NdisOpenAdapter(<BR>
&nbsp; &nbsp; &nbsp; &nbsp; OUT PNDIS_STATUS    </B><I>Status</I><B>,</B><BR>
<B>&nbsp; &nbsp; &nbsp; &nbsp; OUT PNDIS_STATUS    </B><I>OpenErrorStatus</I><B>,</B><BR>
<B>&nbsp; &nbsp; &nbsp; &nbsp; OUT PNDIS_HANDLE    </B><I>NdisBindingHandle</I><B>,</B><BR>
<B>&nbsp; &nbsp; &nbsp; &nbsp; OUT PUINT    </B><I>SelectedMediumIndex</I><B>,</B><BR>
<B>&nbsp; &nbsp; &nbsp; &nbsp; IN PNDIS_MEDIUM    </B><I>MediumArray</I><B>,</B><BR>
<B>&nbsp; &nbsp; &nbsp; &nbsp; IN UINT    </B><I>MediumArraySize</I><B>,</B><BR>
<B>&nbsp; &nbsp; &nbsp; &nbsp; IN NDIS_HANDLE    </B><I>NdisProtocolHandle</I><B>,</B><BR>
<B>&nbsp; &nbsp; &nbsp; &nbsp; IN NDIS_HANDLE    </B><I>ProtocolBindingContext</I><B>,</B><BR>
<B>&nbsp; &nbsp; &nbsp; &nbsp; IN PNDIS_STRING    </B><I>AdapterName</I><B>,</B><BR>
<B>&nbsp; &nbsp; &nbsp; &nbsp; IN UINT    </B><I>OpenOptions</I><B>,</B><BR>
<B>&nbsp; &nbsp; &nbsp; &nbsp; IN PSTRING    </B><I>AddressingInformation</I><BR>
<B>&nbsp; &nbsp; &nbsp; &nbsp; );</B>
<P>
An intermediate driver passes a handle at <I>ProtocolBindingContext</I>&nbsp;that
represents the binding-specific context area it allocated and initialized.
NDIS will pass this context back to the intermediate driver in future calls
pertaining to the binding, for instance, in calls to ProtocolReceive or
ProtocolStatus. Similarly, NDIS will pass a handle at <I>NdisBindingHandle</I>
to the intermediate driver when <B>NdisOpenAdapter</B>&nbsp;returns. This handle
must be retained by the intermediate driver, usually in its binding-specific
context area. The intermediate driver passes this handle to NDIS in future
calls relating to this binding, such as calls to <B>NdisSend</B>&nbsp;or <B>NdisSendPackets</B>.
<P>
ProtocolBindAdapter also passes the type(s) of medium(s) it supports at <I>MediumArray</I>.
If <B>NdisOpenAdapter</B>&nbsp;is successful, the underlying NIC driver will select
a medium it can support and return the index of the selected medium from <I>MediumArray</I>
at <I>SelectedMediumIndex</I>. 
<P>
ProtocolBindAdapter passes the value returned from a previous successful call
to <B>NdisRegisterProtocol</B>&nbsp;at <I>NdisProtocolHandle</I>. 
<P>
If <B>NdisOpenAdapter</B>&nbsp;returns an error, the intermediate driver should
deallocate the memory used for the context area and release any other
resources it allocated for the binding. Typically, ProtocolBindAdapter logs
any failed binding operations with appropriate descriptive information by
calling <B><A HREF="../../nr/src/103ndisx_217.htm">NdisWriteErrorLogEntry</A></B>.
<P></FONT>
</BODY>
</HTML>
