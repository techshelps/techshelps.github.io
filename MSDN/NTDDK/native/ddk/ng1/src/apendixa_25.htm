<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>A.2.3.8  Interrupt Handling Functions</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H3><A NAME="DDK_A.2.3.8_Interrupt_Handling_Functions_NG"></A>A.2.3.8  Interrupt Handling Functions</H3>
<P>
The NDIS interface library provides several interrupt handling functions for
use in a multiprocessor environment, which are listed in Table A.2.11. These
functions relate to network interface card interrupts to a host processor.
Windows NT makes it invalid to call <B><A HREF="../../nr/src/103ndisx_6.htm">NdisAcquireSpinLock</A></B>
or<B>&nbsp;<A HREF="../../nr/src/103ndisx_187.htm">NdisReleaseSpinLock</A></B>&nbsp;from within
an ISR. For more information about spin locks, see <A HREF="apendixa_28.htm">Section
A.2.3.11</A>. 
<P>
Consider what happens if an executing NIC driver thread acquires a spin lock,
begins manipulating associated data structures, and is then interrupted by the
network controller hardware. In handling the interrupt, the driver enters a
section of code in the ISR that needs the data structures that the spin lock
protects. Therefore, the driver needs to acquire the lock from within the ISR
to inspect the data structures. The driver must essentially acquire the spin
lock from itself. If it attempts to do this, an infinite loop occurs, since
the interrupt has pre-empted the locked region of code. 
<P>
To alleviate this problem, the NIC driver calls <B>NdisSynchronizeWithInterrupt</B>
from most functions (except <B><A HREF="../../nr/src/appdxa_13.htm">MacInterruptServiceRoutine</A></B>
and <B><A HREF="../../nr/src/appdxa_21.htm">MacSynchronizeFunction</A>)</B>&nbsp;to
synchronize access to data that the ISR shares with non-ISR functions. <B>NdisSynchronizeWithInterrupt</B>
raises the IRQL of the executing thread and then calls <B>MacSynchronizeFunction</B>
to access shared data. Because of the raised IRQL, the ISR cannot execute on
any processor while <B>MacSynchronizeFunction</B>&nbsp;is running. 
<P>
A typical use of interrupt synchronization by the NIC driver is to protect a
global variable that counts the number of interrupts received but not
processed. The ISR must increment this variable and a non-ISR NIC driver
function must decrement it once the ISR processes an interrupt. The decrement
operation must be non-interruptible, but this is not ensured because
interrupts are enabled. Therefore, the driver must use interrupt
synchronization to protect the variable. Access from the ISR requires no
special precautions. However, the driver must access the variable from non-ISR
functions by calling <B>NdisSynchronizeWithInterrupt</B>. 
<P>
<B>Table A.2.11    Interrupt Handling Functions </B>
<TABLE>
<TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>Function</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>Definition</B>
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="../../nr/src/appdxa_83.htm">NdisInitializeInterrupt</A></B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Associates the <B><A HREF="../../nr/src/appdxa_13.htm">MacInterruptServiceRoutine</A></B>
and <B><A HREF="../../nr/src/appdxa_12.htm">MacDeferredProcessingRoutine</A></B>
functions with a network interface card. 
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="../../nr/src/appdxa_100.htm">NdisRemoveInterrupt</A></B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Stops interrupt reception by <B>MacInterruptServiceRoutine</B>&nbsp;during network
interface card removal. 
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="../../nr/src/appdxa_104.htm">NdisSynchronizeWithInterrupt</A></B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Synchronizes access to data shared between non-ISR functions and <B>MacInterruptServiceRoutine</B>.
</FONT></TABLE>
<P>
&nbsp;
<P></FONT>
</BODY>
</HTML>
