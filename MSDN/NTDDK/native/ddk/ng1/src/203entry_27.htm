<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>3.5  Hardware Reset</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_Hardware_Reset_NG"></A>3.5  Hardware Reset</H2>
<P>
A miniport must register a MiniportReset function with <B>NdisMRegisterMiniport</B>.
The definition of MiniportReset is:
<P>
<B>NDIS_STATUS<BR>
</B>&nbsp; &nbsp; <B>MiniportReset(<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>OUT PBOOLEAN</B>&nbsp;<I>AddressingReset</I><B>,</B><I><BR>
</I>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN NDIS_HANDLE </B><I>MiniportAdapterContext</I><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>);</B>
<P>
MiniportReset will be called if NDIS determines that the miniport’s NIC has
hung, either because the miniport’s MiniportCheckForHang function returned
TRUE or because NDIS detected a pending send packet or request that did not
complete in an agreed upon timeout period.
<P>
MiniportReset should:
<UL>
<LI>
First disable further interrupts
<P>
<LI>
Null out the packets associated with any sends in progress; for instance, on a
ring buffer for a busmaster DMA device, the pointers to send buffers should be
cleared. The miniport relinquishes pending packet ownership, no matter the
state of the send. NDIS will complete any pending sends to higher layers with
an appropriate status.
<P>
<LI>
Restore the hardware state and the miniport’s internal state back to the
initial state it had with respect to multicast addresses and registered
filters. Either the miniport takes responsibility for doing this or it relies
on NDIS. 
</UL>
<P>
If the miniport returns FALSE in <I>AddressingReset</I>, the miniport will
return its addressing values to their initial state. If the miniport returns
TRUE in <I>AddressingReset</I>, NDIS will call the miniport’s
MiniportSetInformation function to set addresses and filters to their initial
state. Note that it is the choice of the driver writer whether the miniport
will save this addressing state so that it can restore it on a reset or
whether it will rely on NDIS.
<P></FONT>
</BODY>
</HTML>
