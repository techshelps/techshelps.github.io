<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>4.5  TDI Library Functions and Macros</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_TDI_Library_Functions_and_Macros_NG"></A>4.5  TDI Library Functions and Macros</H2>
<P>
Windows NT provides a small set of TDI library functions as a kernel-mode
dynamic-link library (the <I>tdi.sys</I>&nbsp;export library) with which TDI
drivers and kernel-mode clients link themselves. However, most of the
system-supplied <B>TdiBuild</B><I>Xxx</I>&nbsp;called by kernel-mode clients are
implemented as macros in the <I>tdikrnl.h</I>&nbsp;header that both clients and
transports include. 
<P>
Any kernel-mode TDI client can use the <B>TdiBuild</B><I>Xxx</I>&nbsp;macros as
needed in preparing the TDI_<I>XXX</I>&nbsp;IOCTL IRPs, already mentioned in<A HREF="304tovw_5.htm">
Section 4.3</A>. After the client has set up such an IRP with a <B>TdiBuild</B><I>Xxx</I>
macro, it submits the request to the underlying TDI driver by passing the IRP
to <B>IoCallDriver</B>. Each of these macros fills in the relevant members of
the client-provided IRP, except for the <B>Status</B>&nbsp;and <B>Information</B>
members, which the underlying transport fills in after processing its
client&#39;s request. Before using one of <B>TdiBuild</B><I>Xxx</I>&nbsp;IOCTL
macros, a client can call <B><A HREF="../../nr/src/24bldmac_7.htm">TdiBuildInternalDeviceControlIrp</A></B>
to allocate the IRP if it has not already been allocated by a still higher
level network component and given to the client.
<P>
A transport driver never uses the <B>TdiBuild</B><I>Xxx</I>&nbsp;macros. However, a
TDI driver can use some of the remaining TDI library routines, such as <B>TdiCompleteRequest
</B>and <B>TdiCopyBufferToMdl</B>, for assistance in processing client
requests.
<P>
TDI library routines and macros include the following:
<DL>
<DT>
<B><A HREF="../../nr/src/24bldmac_7.htm">TdiBuildInternalDeviceControlIrp</A></B>
<DD>
Allocates an IRP if the client does not receive an IRP from a higher network
layer.
<BR>
<DT>
<B><A HREF="../../nr/src/24bldmac_1.htm">TdiBuildAccept</A></B>&nbsp;
<DD>
Sets up an IRP for a client-submitted TDI_ACCEPT request.
<BR>
<DT>
<B><A HREF="../../nr/src/24bldmac_2.htm">TdiBuildAction</A></B>&nbsp;
<DD>
Sets up an IRP for a client-submitted TDI_ACTION request.
<BR>
<DT>
<B><A HREF="../../nr/src/24bldmac_3.htm">TdiBuildAssociateAddress</A></B>&nbsp;
<DD>
Sets up an IRP for a client-submitted TDI_ASSOCIATE_ADDRESS request.
<BR>
<DT>
<B><A HREF="../../nr/src/24bldmac_4.htm">TdiBuildConnect</A></B>&nbsp;
<DD>
Sets up an IRP for a client-submitted TDI_CONNECT request.
<BR>
<DT>
<B><A HREF="../../nr/src/24bldmac_5.htm">TdiBuildDisassociateAddress</A></B>
<DD>
Sets up an IRP for a client-submitted TDI_DISASSOCIATE_ADDRESS request.
<BR>
<DT>
<B><A HREF="../../nr/src/24bldmac_8.htm">TdiBuildListen</A></B>&nbsp;
<DD>
Sets up an IRP for a client-submitted TDI_LISTEN request.
<BR>
<DT>
<B><A HREF="../../nr/src/24bldmac_11.htm">TdiBuildQueryInformation</A></B>&nbsp;
<DD>
Sets up an IRP for a client-submitted TDI_QUERY_INFORMATION request.
<BR>
<DT>
<B><A HREF="../../nr/src/24bldmac_12.htm">TdiBuildReceive</A></B>&nbsp;
<DD>
Sets up an IRP for a client-submitted TDI_RECEIVE request.
<BR>
<DT>
<B><A HREF="../../nr/src/24bldmac_13.htm">TdiBuildReceiveDatagram</A></B>&nbsp;
<DD>
Sets up an IRP for a client-submitted TDI_RECEIVE_DATAGRAM request.
<BR>
<DT>
<B><A HREF="../../nr/src/24bldmac_14.htm">TdiBuildSend</A></B>&nbsp;
<DD>
Sets up an IRP for a client-submitted TDI_SEND request.
<BR>
<DT>
<B><A HREF="../../nr/src/24bldmac_15.htm">TdiBuildSendDatagram</A></B>&nbsp;
<DD>
Sets up an IRP for a client-submitted TDI_SEND_DATAGRAM request.
<BR>
<DT>
<B><A HREF="../../nr/src/24bldmac_16.htm">TdiBuildSetEventHandler</A></B>&nbsp;
<DD>
Sets up an IRP for a client-submitted TDI_SET_EVENT_HANDLER request.
<BR>
<DT>
<B><A HREF="../../nr/src/24bldmac_17.htm">TdiBuildSetInformation</A></B>&nbsp;
<DD>
Sets up an IRP for a client-submitted TDI_SET_INFORMATION request.
<BR>
<DT>
<B><A HREF="../../nr/src/24bldmac_9.htm">TdiBuildNetbiosAddress</A></B>&nbsp;
<DD>
Sets up a NetBIOS address for a client.
<BR>
<DT>
<B><A HREF="../../nr/src/24bldmac_10.htm">TdiBuildNetbiosAddressEa</A></B>
<DD>
Sets up a buffered NetBIOS address that a client can pass subsequently to <B>ZwCreateFile</B>
to open the address. 
<BR>
<DT>
<B><A HREF="../../nr/src/23tdifun_7.htm">TdiReturnChainedReceives</A></B>
<DD>
Relinquishes control of the buffer that was passed to a
ClientEventChainedReceive(<I>Xxx</I>) handler after the client has consumed
the received TSDU.
<BR>
<DT>
<B><A HREF="../../nr/src/23tdifun_2.htm">TdiCopyBufferToMdl</A></B>&nbsp;
<DD>
Copies a range of buffered data into a destination buffer mapped by a given
MDL. 
<P>
Both clients and transports can use this function. 
<BR>
<DT>
<B><A HREF="../../nr/src/23tdifun_4.htm">TdiCopyMdlToBuffer</A></B>&nbsp;
<DD>
Copies data from buffer(s) mapped by a given MDL into a caller-supplied
destination buffer.
<P>
Both clients and transports can use this function. 
<BR>
<DT>
<B><A HREF="../../nr/src/23tdifun_3.htm">TdiCopyLookaheadData</A></B>
<DD>
Safely copies received data indicated to the transport by a NIC driver,
whatever the nature of the memory (including mapped device memory) the NIC is
using. 
<BR>
<DT>
<B><A HREF="../../nr/src/23tdifun_6.htm">TdiMapUserRequest</A></B>
<DD>
Converts an IRP passed in to a transport&#39;s TdiDispatchDeviceControl
routine into a TDI_<I>XXX</I>&nbsp;IOCTL IRP if <B>TdiMapUserRequest</B>&nbsp;recognizes
the minor function code specified in the input IRP.
<BR>
<DT>
<B><A HREF="../../nr/src/23tdifun_1.htm">TdiCompleteRequest</A></B>
<DD>
Completes an IRP with the system-defined network-specific priority boost for a
transport driver.
</DL>
<P>
&nbsp;
<P></FONT>
</BODY>
</HTML>
