<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>2.3.2.9  Packet and Buffer Functions</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H4><A NAME="DDK_Packet_and_Buffer_Functions_NG"></A>2.3.2.9  Packet and Buffer Functions</H4>
<P>
Miniport NIC drivers have a need to allocate buffers for receiving incoming
data. The driver of a busmaster DMA device that indicates the entire incoming
packet up to interested protocols must allocate and manage packets for this
purpose. A NIC driver might need to allocate buffer space to stage data on a
send if the packet it receives from an upper layer is small and fragmented. On
a send, all miniport NIC drivers receive a complete packet and must call NDIS
functions to manipulate those packets and extract the data to be sent. A
miniport that transfers incoming data to an upper layer driver receives a
packet from the upper layer and must manipulate the packet structure to fill
it with received data. NDIS provides functions that miniport drivers can call
to allocate, construct, and inspect packets. 
<P>
NDIS defines a packet as a packet descriptor with a chain of one or more
buffers containing the network packet data. The NDIS library describes a
packet descriptor by defining the NDIS_PACKET structure. The descriptor
consists of two parts: a public component that a miniport driver can see, and
a private component that is invisible to the driver. The public component
allows a miniport driver to maintain context information about the packet. A
miniport driver can use this component to link packets into data transfer
queues. 
<TABLE>
<TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>Function</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>Definition</B>
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisAllocatePacketPool</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Allocates and initializes a block of nonpaged packet pool. The caller supplies
the requested number of packet descriptors and the size in bytes of each
fixed-size packet.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisAllocatePacket</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Allocates a fixed-size packet descriptor from the packet pool returned by <B>NdisAllocatePacketPool</B>.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisAllocateBufferPool</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Returns a handle with which the caller can allocate buffer descriptors with <B>NdisAllocateBuffer</B>.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisAllocateBuffer</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Creates a buffer descriptor mapping a specified virtual range within an
already allocated, nonpaged memory block, given a handle returned by <B>NdisAllocateBufferPool</B>.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisAdjustBufferLength</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Modifies the length of the range specified in a given buffer descriptor.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisCopyBuffer</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Creates a buffer descriptor for a specified range, given a handle for a block
of already allocated memory and a pointer to the buffer descriptor for the
block.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisCopyFromPacketToPacket</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Copies a specified number of bytes from one packet to another, given a
specified source packet and a destination packet and specified offsets in
each.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisCreateLookaheadBufferFromSharedMemory</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Returns the virtual address of a buffer within a block of memory shared with a
busmaster DMA NIC. Allows a driver to map a portion of received data to
indicate up to interested protocols as a read-only lookahead buffer.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisDestroyLookaheadBufferFromSharedMemory</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Releases a buffer acquired by calling <B>NdisCreateLookaheadBufferFromSharedMemory</B>.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisQueryPacket</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Returns a set of information that describes a packet and a pointer to the
initial buffer in the chain.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisQueryBuffer</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Returns the base virtual address and size of a buffer that is mapped by a
given buffer descriptor.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisQueryBufferOffset</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Returns the base virtual address of the range specified in a given buffer
descriptor.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisGetFirstBufferFromPacket</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Returns pointers to the buffer descriptor and base virtual address for the
initial buffer chained to a given packet, along with the size of the initial
buffer and full buffer, in case the buffer is fragmented.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisGetNextBuffer</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Returns the next buffer descriptor in a chain, given the current buffer
descriptor.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisGetPacketFlags</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Returns the flags, if any, set by a protocol driver in a given packet.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisFreePacketPool</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Releases a block of nonpaged pool allocated by calling <B>NdisAllocatePacketPool</B>.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisFreePacket</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Releases a packet allocated by calling <B>NdisAllocatePacket</B>.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisFreeBufferPool</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Releases a handle obtained by calling <B>NdisAllocateBufferPool</B>.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisFreeBuffer</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Releases a buffer descriptor allocated by calling <B>NdisAllocateBuffer</B>.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisChainBufferAtFront</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Links a given buffer descriptor at the front of a chain of buffer descriptors
for a given packet.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisChainBufferAtBack</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Links a given buffer descriptor at the end of a chain of buffer descriptors
for a given packet.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisUnchainBufferAtFront</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Removes a given buffer descriptor from the front of a chain of buffer
descriptors for a given packet and returns a pointer to that buffer
descriptor.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisUnchainBufferAtBack</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Removes a given buffer descriptor from the back of a chain of buffer
descriptors for a given packet and returns a pointer to that buffer
descriptor.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisReinitializePacket</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Removes any chained buffers from a given packet and reinitializes it for
reuse.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisRecalculatePacketCounts</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Resets the valid count for a given packet so that the next call to <B>NdisQueryPacket</B>
recalculates the counts.
</FONT></TABLE>
<P></FONT>
</BODY>
</HTML>
