<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>5.4.2  WAN-Specific Status Indications</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H3><A NAME="DDK_WAN_Specific_Status_Indications_NG"></A>5.4.2  WAN-Specific Status Indications</H3>
<P>
Most WAN NIC drivers indicate status with some special status codes and buffer
contents. A WAN miniport calls <B><A HREF="../../nr/src/103ndisx_108.htm">NdisMIndicateStatus</A></B>
when changes in the status of a network adapter occur. These status
indications are generated by WAN NIC drivers, and NDIS protocol drivers bound
to such a miniport can ignore these indications. However, processing these
indications correctly usually results in improved performance for protocols
and for WAN NIC drivers. Such a status change is passed to a bound protocol’s
ProtocolStatus handler (or to a configuration manager) to log the change in
status or to take corrective action. 
<P>
The following four types of WAN-specific indications can be sent to bound
protocol drivers with <B>NdisMIndicateStatus</B>: 
<OL>
<LI>
Line up
<P>
<LI>
Line down
<P>
<LI>
Fragment
<P>
<LI>
TAPI line event
</OL>
<P>
The status indication provides two basic pieces of information:
<UL>
<LI>
An overall status code indicating the general change in status. There are a
limited number of defined general status codes; this list is subject to future
expansion.
<P>
<LI>
A specific reason for the general change, which can be adapter-specific. For
example, notification that the link speed of an X.25 link has just decreased
by a factor of two or that a new link is coming up or an existing link is
going to the idle state.
</UL>
<P>
WAN status indications use a general status of NDIS_STATUS_WAN_<I>XXX</I>. The
three types of WAN indications are NDIS_STATUS_LINE_UP, NDIS_STATUS_LINE_DOWN,
and NDIS_STATUS_FRAGMENT.
<P>
All TAPI status indications must use a <I>GeneralStatus</I>&nbsp;value of
NDIS_STATUS_TAPI_INDICATION. The specific event that is the reason for the
status indication is reported in a structure of type NDIS_TAPI_EVENT<I>.</I>
The general type of TAPI status indications of interest to miniport developers
are changes in line states, changes in call states, the arrival of an incoming
call or the closing by a remote node or by the miniport of an existing call or
line. See <A HREF="206tapi.htm">Chapter
6</A>&nbsp;for more details.
<H4>Line Up Status</H4>
<P>
A WAN miniport calls <B>NdisMIndicateStatus</B>&nbsp;with a <I>GeneralStatus</I>
value of NDIS_STATUS_WAN_LINE_UP to indicate that a new data channel has
become active. Until this occurs, the NIC will accept frames and can let them
succeed or fail, but it is unlikely that such packets will actually be
received by any remote-node process. Until a line is up, protocols should
reduce their timers and retry counts so that any outgoing connection attempts
quickly fail. 
<P>
A WAN miniport makes a line-up indication before it returns from an
OID_TAPI_GET_ID request. The line-up indication is made if OID_TAPI_GET_ID
request contains a new <B>DeviceClass</B>&nbsp;and <B>ulSelect</B>&nbsp;is set to
LINECALLSELECT_CALL. The <B>NdisLinkContext</B>&nbsp;returned from <B>NdisMIndicateStatus</B>
for the line-up indication is passed back in the NDIS_TAPI_GET_ID structure as
the <B>DeviceID</B>&nbsp;when the WAN miniport returns from the OID_TAPI_GET_ID
request. See Chapter 6, <A HREF="206tapi_12.htm">Section 6.12</A>&nbsp;for a
discussion of making a line-up indication.
<P>
The status code for the line-up indication is NDIS_STATUS_WAN_LINE_UP. The
buffer at <I>StatusBuffer</I>&nbsp;is formatted as an <A HREF="../../nr/src/106nstru_3.htm">NDIS_MAC_LINE_UP</A>
structure.
<H4>Line Down Status</H4>
<P>
A WAN miniport makes a line-down indication whenever a link goes down. The <B>NdisLinkHandle</B>
for the line is no longer valid. When this occurs, bound protocols should
reduce their timers and retry counts until the next line-up indication.
<P>
The status code for the line-down indication is NDIS_STATUS_WAN_LINE_DOWN. The
buffer at <I>StatusBuffer</I>&nbsp;is formatted as an <A HREF="../../nr/src/106nstru_2.htm">NDIS_MAC_LINE_DOWN</A>
structure.
<H4>Fragment Indication</H4>
<P>
A WAN miniport makes a fragment indication whenever it receives a partial
packet from a remote peer. Otherwise, NDIS will be unaware of this particular
error. The protocol should send frames to the remote that notify the remote of
the fragment indication, rather than waiting for a timeout to occur.
<P>
The status code for the fragment indication is NDIS_STATUS_WAN_FRAGMENT. The
buffer at <I>StatusBuffer</I>&nbsp;is formatted as an <A HREF="../../nr/src/106nstru_1.htm">NDIS_MAC_FRAGMENT</A>
structure.
<P>
NDISWAN monitors dropped packets by counting the number of fragment
indications on the link.
<P></FONT>
</BODY>
</HTML>
