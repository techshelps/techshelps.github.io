<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>6.10  Making a Call</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_Making_a_Call_NG"></A>6.10  Making a Call</H2>
<P>
A miniport with an open line can also receive a request to initiate a call in
one of two ways. Either the miniport receives:
<UL>
<LI>
An OID_TAPI_MAKE_CALL request that contains the destination address or that
specifies that a predefined default number should be used
<P>
<LI>
Or, an OID_TAPI_MAKE_CALL request that does not include a destination address 
<P>
In this case, the OID_TAPI_MAKE_CALL will be followed by an OID_TAPI_DIAL
request that includes the destination address 
</UL>
<P>
When MiniportQueryInformation is called with an OID_TAPI_MAKE_CALL request,
NDISTAPI passes the line identifier for the line on which the call is to be
made in the <B>hdLine</B>&nbsp;member of the NDIS_TAPI_MAKE_CALL structure. The <B>hdLine</B>
value is the value returned by the miniport to an OID_TAPI_OPEN request.
<P>
The miniport should store the <B>htCall</B>&nbsp;value passed in this request with
the call context it maintains and pass it in subsequent status calls and
responses related to this call instance. For instance, the miniport will
supply this value as the <B>ConnectionWrapperID</B>&nbsp;when it indicates a line
up to NDISWAN.
<P>
The <B>ulDestAddressSize</B>&nbsp;can be zero for undialed addresses, such as for a
hot phone, which always automatically connects to a predefined number, or when
dialing will be done subsequently with an OID_TAPI_DIAL request. 
<P>
If the <B>bUseDefaultLineCallParams</B>&nbsp;member of NDIS_TAPI_MAKE_CALL is set
to FALSE, the miniport should use the call parameters in the <B>LineCallParams</B>
member. If <B>bUseDefaultLineCallParams</B>&nbsp;is TRUE, the previously set
default call parameters should be used. 
<P>
The miniport must check the state of the line on which the make-call request
is made to ensure that it can make the requested call. If not, the miniport
should fail the call.
<P>
MiniportQueryInformation returns when either:
<UL>
<LI>
It has made the call,
<P>
<LI>
Or, if the number will be dialed as a result of a subsequent OID_TAPI_DIAL
request, the miniport allocates a structure and sets itself in a state,
probably the dialtone state, to subsequently complete the call. 
</UL>
<P>
The miniport must return a call-specific context value in the <B>hdCall</B>
member if MiniportQueryInformation returns NDIS_STATUS_SUCCESS. This unique <B>hdCall</B>
value will be passed to the miniport in subsequent requests related to this
call.
<P>
If a call is made in two steps by first making an OID_TAPI_MAKE_CALL request
to MiniportQueryInformation, followed by an OID_TAPI_DIAL request to
MiniportSetInformation, the destination number is passed to the miniport in
the NDIS_TAPI_DIAL structure. The OID_TAPI_DIAL request requires an <B>hdCall</B>
member to be passed in the NDIS_TAPI_DIAL structure; its value will match the
handle the miniport returned from a previous OID_TAPI_MAKE_CALL request.
<P></FONT>
</BODY>
</HTML>
