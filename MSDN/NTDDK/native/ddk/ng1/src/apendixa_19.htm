<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>A.2.3.4.1  Buffers</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H4><A NAME="DDK_A.2.3.4.1_Buffers_NG"></A>A.2.3.4.1  Buffers</H4>
<P>
Both NIC and transport drivers allocate and manage virtual memory buffers in
the host. The NDIS interface library provides functions that allow the drivers
to allocate, construct, and inspect such buffers. These buffers are listed in
Table A.2.6. 
<P>
NDIS 3.0 (<I>ndis.h</I>) uses an NDIS_BUFFER structure to define a
variable-length buffer descriptor for a buffer. A buffer descriptor is an MDL
that contains virtual and physical addressing information for the buffer, the
buffer length, and a pointer to the next buffer descriptor in the chain of
buffer descriptors that make up a packet descriptor. 
<P>
For bus-mastering transfers, a NIC driver needs to send the physical addresses
of virtual memory buffers to its network interface card. Under NDIS 3.0, the
driver can obtain these addresses by calling <B>NdisStartBufferPhysicalMapping</B>.
A portable NIC driver has limited use of physical addresses and sometimes only
has knowledge of a virtual address when the network interface card requires a
physical address. The operating system must then map the virtual address to an
appropriate physical address. The resultant mapping is temporary and the NIC
driver must manage it using map registers. 
<P>
<B>Table A.2.6    Buffer Functions </B>
<TABLE>
<TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>Function</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>Definition</B>
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="../../nr/src/103ndisx_7.htm">NdisAdjustBufferLength</A></B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Modifies the length field in an allocated buffer descriptor.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="../../nr/src/103ndisx_8.htm">NdisAllocateBuffer</A></B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Allocates and initializes a buffer descriptor for virtual memory. 
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="../../nr/src/103ndisx_9.htm">NdisAllocateBufferPool</A></B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Allocates and initializes a block of storage for a pool of buffer descriptors.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="../../nr/src/103ndisx_15.htm">NDIS_BUFFER_LINKAGE</A></B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Retrieves the internal buffer linkage from a buffer descriptor for use by a
transport driver.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="../../nr/src/103ndisx_17.htm">NdisChainBufferAtBack</A></B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Appends a buffer descriptor to a chain of buffer descriptors for a packet
descriptor.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="../../nr/src/103ndisx_18.htm">NdisChainBufferAtFront</A></B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Adds a buffer descriptor at the front of a chain of buffer descriptors for a
packet descriptor.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="../../nr/src/appdxa_65.htm">NdisCompleteBufferPhysicalMapping</A></B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Indicates to the operating system that a physical address mapping is no longer
needed. 
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="../../nr/src/103ndisx_24.htm">NdisCopyBuffer</A></B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Creates a buffer descriptor for a specific memory descriptor that a higher
network layer passes to the transport driver. 
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="../../nr/src/103ndisx_26.htm">NdisCreateLookaheadBufferFrom
SharedMemory</A></B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Provides a lookahead buffer, which is a virtual memory copy of shared memory
on the network interface card.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="../../nr/src/103ndisx_28.htm">NdisDestroyLookaheadBufferFrom
SharedMemory</A></B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Disassociates a lookahead buffer from shared memory on the network card.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="../../nr/src/103ndisx_37.htm">NdisFreeBuffer</A></B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Frees a buffer descriptor. 
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="../../nr/src/103ndisx_38.htm">NdisFreeBufferPool</A></B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Terminates the use of a buffer descriptor pool. 
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>NdisGetBufferPhysicalAddress</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Obtains the physical segments that make up a single buffer. This function is
obsolete, and <B>NdisStartBufferPhysicalMapping</B>&nbsp;replaces it.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="../../nr/src/103ndisx_44.htm">NdisGetBufferPhysicalArraySize</A></B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Determines the maximum number of physical segments in a buffer.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="../../nr/src/103ndisx_49.htm">NdisGetNextBuffer</A></B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Finds the next buffer descriptor in a buffer descriptor chain. 
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="../../nr/src/103ndisx_57.htm">NdisGetPhysicalAddressHigh</A></B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Queries the high 32 bits of a physical address. 
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="../../nr/src/103ndisx_58.htm">NdisGetPhysicalAddressLow</A></B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Returns the low 32 bits of a physical address.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="../../nr/src/103ndisx_157.htm">NdisQueryBuffer</A></B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Queries a specified buffer descriptor.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="../../nr/src/103ndisx_203.htm">NdisSetPhysicalAddressHigh</A></B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Sets the high 32 bits of a physical address. 
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="../../nr/src/103ndisx_204.htm">NdisSetPhysicalAddressLow</A></B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Sets the low 32 bits of a physical address.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="../../nr/src/appdxa_103.htm">NdisStartBufferPhysicalMapping</A></B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Starts a mapping that the NDIS interface library uses to associate the virtual
address of a buffer with the addresses of its physical segments. Replaces
function <B>NdisGetBufferPhysicalAddress </B>that is no longer supported.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="../../nr/src/103ndisx_211.htm">NdisUnchainBufferAtBack</A></B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Removes the last buffer descriptor from a buffer descriptor chain. 
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="../../nr/src/103ndisx_212.htm">NdisUnchainBufferAtFront</A></B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Removes the first buffer descriptor from a buffer descriptor chain. 
</FONT></TABLE>
<P>
&nbsp;
<P></FONT>
</BODY>
</HTML>
