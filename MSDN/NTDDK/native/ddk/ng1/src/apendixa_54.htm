<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>A.4.1.4  Using Shared Memory</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H3><A NAME="DDK_A.4.1.4_Using_Shared_Memory_NG"></A>A.4.1.4  Using Shared Memory</H3>
<P>
Use of cached memory that is shared between a NIC driver and its netcard
requires special precautions. Windows NT does not ensure execution of the NDIS
interface library with an I/O-coherent cache, since a netcard can access
physical memory directly while the NIC driver accesses memory through the
cache. This can cause differences in what the driver and the netcard detect in
memory, even if they look at the same location. 
<P>
Use of noncached shared memory avoids most of the problems mentioned for
cached shared memory. However, when data written to physical memory must use a
small write queue, even noncached data might not appear in physical memory
immediately. Additionally, there are cases when using noncached memory is not
recommended or is not possible. For example, data the NIC driver reads
repeatedly should always be cached to improve performance. The NIC driver
should also use cached memory for any data that a transport driver passes in. 
<P>
To help eliminate shared memory problems, use an <B><A HREF="../../nr/src/appdxa_63.htm">NdisAllocateSharedMemory</A></B>
call in your NIC driver to allocate memory for permanent sharing between the
netcard and the driver. This function writes a virtual address and a physical
address for the shared memory. The physical address is valid until a call to <B><A HREF="../../nr/src/appdxa_78.htm">NdisFreeSharedMemory</A></B>
frees the memory. To access the shared memory, your driver must call <B><A HREF="../../nr/src/appdxa_106.htm">NdisUpdateSharedMemory</A></B>.
<P></FONT>
</BODY>
</HTML>
