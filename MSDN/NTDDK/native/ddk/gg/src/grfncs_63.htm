<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>EngAllocUserMem</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_EngAllocUserMem_GG"></A>EngAllocUserMem</H2>
<P>
<B>PVOID EngAllocUserMem(</B>
<TABLE>
<TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>&nbsp; &nbsp; ULONG </B><I>cj</I><B>,</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>&nbsp; &nbsp; ULONG </B><I>tag</I>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>&nbsp; &nbsp;);</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT></TABLE>
<P>
<B>EngAllocUserMem</B>&nbsp;allocates a block of memory from the address space of
the current process, and inserts a caller-supplied tag before the allocation.
<H3>Parameters</H3>
<DL>
<DT>
<I>cj</I>
<DD>
Specifies the number of bytes to allocate.
<BR>
<DT>
<I>tag</I>
<DD>
A 4-byte allocation tag that uniquely identifies the driver doing the memory
allocation.
</DL>
<H3>Return Value</H3>
<P>
<B>EngAllocUserMem </B>returns a pointer to the allocated memory if there is
enough user-mode memory to satisfy the request; otherwise, it returns a null
pointer.
<H3>Comments</H3>
<P>
A Windows NT process has 4 GB of virtual address space. The upper 2 GB is
system memory that is accessible only to kernel-mode threads; this space is
identical across all processes. The lower 2 GB is user memory that is
accessible to both user-mode and kernel-mode threads; this space is unique to
its process. The memory allocated by <B>EngAllocUserMem</B>&nbsp;is allocated from
the unique 2 GB of user memory, and is thus accessible only when the graphics
driver is called in the context of the thread in which the memory was
allocated. Graphics drivers always execute in the context of the caller; that
is, graphics drivers cannot switch process contexts.
<P>
<B>EngAllocUserMem</B>&nbsp;is particularly useful to a printer driver with large
bitmaps that will only be used by the current process. Rather than allocating
from the system pool, this driver can instead allocate space from the current
process’s address space. Drivers need to exercise care with memory allocated
by <B>EngAllocUserMem</B>, as it is possible for the application to step on
this memory. <B>EngAllocUserMem</B>&nbsp;should only be used to allocate relatively
large chunks of memory, as each allocation takes at least 64K of virtual
address space. Sensitive data structures should never be allocated using this
function. Also, user memory allocated by this function cannot be passed to <B><A HREF="grfncs_139.htm">EngWritePrinter</A></B>
by the printer driver.
<P>
The <I>tag</I>&nbsp;string should be specified in byte reversed order. The first
letter must be ‘D’; the other three should be indicative of the driver name.
For example, the <I>tag</I>&nbsp;string ‘ 3sD’ appears as ‘Ds3 ‘ if pool is dumped.
The tag appears in any crash dump of the system that occurs.
<H3>See Also</H3>
<P>
<B><A HREF="grfncs_94.htm">EngFreeUserMem</A></B>&nbsp;
<P></FONT>
</BODY>
</HTML>
