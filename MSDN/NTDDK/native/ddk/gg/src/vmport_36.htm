<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Validating Instructions in SvgaHwIoPortXxx</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H3><A NAME="DDK_Validating_Instructions_in_SvgaHwIoPortXxx_GG"></A>Validating Instructions in SvgaHwIoPortXxx</H3>
<P>
As already mentioned in <A HREF="vmport_35.htm">VGA-Compatible
Miniports HwFindAdapter</A>, the IOPM set for directly accessible I/O ports
usually includes all SVGA registers except the sequencer registers and the
miscellaneous output register, which the VGA-compatible miniport continues to
monitor with its SvgaHwIoPort<I>Xxx</I>&nbsp;functions. The sequencer registers
control internal chip timing on VGA-compatible video adapters. If a
full-screen MS-DOS application touches other adapter registers during a
synchronous reset, the machine can hang. Likewise, if the miscellaneous output
register is set to select a nonexistent clock, the machine can hang.
<P>
VGA-compatible miniport drivers must ensure that full-screen MS-DOS
applications do not issue instructions that cause the machine to hang. Each
such miniport driver must supply SvgaHwIoPort<I>Xxx</I>&nbsp;function that monitor
application-issued instructions to the I/O ports for the adapter sequencer
registers and miscellaneous output register. Each new VGA-compatible miniport
driver for an adapter with special features also must monitor and continue to
validate any I/O ports to which an application might send any instruction
sequence that could hang the machine.
<P>
Whenever an application attempts to access the sequencer clock register, the
SvgaHwIoPort<I>Xxx</I>&nbsp;must change the IOPM in order to trap all instructions
coming in during a synchronous reset. As soon as an application sends an
instruction that affects the sequencer or attempts to write to the
miscellaneous output register, the SvgaHwIoPort<I>Xxx</I>&nbsp;should adjust the
IOPM by calling <B>VideoPortSetTrappedEmulatorPorts</B>&nbsp;to disable direct
access to all adapter registers.
<P>
The miniport-supplied SvgaHwIoPort<I>Xxx</I>&nbsp;functions should buffer
subsequent <B>IN</B>&nbsp;(or <B>INSB/INSW/INSD</B>) and/or <B>OUT </B>(or <B>OUTSB/OUTSW/OUTSD</B>)<B>
</B>instructions in the <B>EmulatorAccessEntriesContext</B>&nbsp;area it set up in
the VIDEO_PORT_CONFIG_INFO (see <A HREF="vmport_35.htm">VGA-Compatible
Miniports HwFindAdapter</A>&nbsp;) until the synchronous reset is done, or until the
application either restores the miscellaneous output register or resets it to
a “safe” clock.
<P>
Then, the miniport driver is responsible for checking that the buffered
instructions cannot hang the machine. If not, the miniport should process the
buffered instructions, usually by calling <B>VideoPortSynchronizeExecution</B>
with a driver-supplied <A HREF="vmport_29.htm">HwVidSynchronizeExecutionCallback</A>
function. Otherwise, the miniport driver should discard the buffered
instructions.
<P></FONT>
</BODY>
</HTML>
