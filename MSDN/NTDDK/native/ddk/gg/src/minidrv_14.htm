<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>NT RLE Character Mapping</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H3><A NAME="DDK_NT_RLE_Character_Mapping_GG"></A>NT RLE Character Mapping</H3>
<P>
To fully support Unicode, Windows NT has changed the format of the Windows 3.1
CTT to the new RLE format. RasDD can still use the old format (for
compatibility with 16-bit minidrivers), but the RLE format supports the wide
characters of Unicode and speeds up <B>CreateDC</B>&nbsp;calls by having much of
the font information precomputed in the format required by GDISrv.
<P>
The CTT file contents can be saved into one of three formats. Unitool
determines which one is to be used to save the CTT file based on the
information that was entered as follows:
<UL>
<LI>
1-to-1 (byte to byte) translation (effectively a translation table). Each
character code consists of a single byte. For simple remappings, RasDD sends
the character value entered in the edit control each time the ASCII value is
shown.
<P>
<LI>
2-to-1 (two bytes to one byte) translation. Each character code consists of
either one or two characters. RasDD sends the first character value entered in
the edit control, then uses either a backspace or x-movement command (as
defined in the DI_BKSP_OK control) to move from the current position back to
the original position. Then RasDD sends the second character to overprint the
first. If null, the second character is not sent. This is used to overstrike
characters, such as the slash and zero to produce a slashed zero.
<P>
<LI>
Variable-length (byte to byte) string translation. Each character code
consists of a variable length string containing printer commands that can
change printer modes to gain access to a particular character, such as symbol
set switching in the LaserJet family. RasDD sends the commands entered in the
edit control when requested.
</UL>
<P>
The differences between these formats is transparent to the user. Unitool
creates the CTT in a format that results in the smallest file size depending
on the actual translation. Printer commands sent from the CTT do not change
the permanent state of the printer.
<P>
The Window NT equivalent of these is the RLE table. Because Unicode is a
somewhat sparse mapping and real fonts are even sparser, there is a need to
have the capability to return information about which glyphs are available in
the font to GDISrv. This is done using the WCRUN structures defined in the <I>winddi.h</I>
header file. To speed up <B>CreateDC</B>, RasDD uses these same structures in
the minidriver. This means no time is spent building up tables that are static
for a given printer.
<P>
The Windows NT DDK provides the <B>ctt2rle</B>&nbsp;tool to convert an existing
Windows 3.1 CTT file to an NT RLE file. The conversion is done assuming that
the Windows 3.1 character set provides the input mapping. The <B>ctt2rle</B>
executable<B>&nbsp;</B>requires only a single parameter: the file containing the
CTT data. The output is written to a file with the same prefix, but with a <I>.rle</I>
extension. Similar to Unitool, <B>ctt2rle</B>&nbsp;uses the shortest format
available to encode this information. The sample drivers in the DDK contain a
batch file showing how <B>ctt2rle.exe</B>&nbsp;is used to convert existing files.
<P></FONT>
</BODY>
</HTML>
