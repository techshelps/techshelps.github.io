<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Porting Steps for Printer Drivers</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_Porting_Steps_for_Printer_Drivers_GG"></A>Porting Steps for Printer Drivers</H2>
<P>
This section contains porting notes that pertain to print drivers only.
<P>
In general, print drivers have become more complex than display drivers,
largely due to fonts. However, Windows NT kernel-mode drivers should be as
simple as possible, dealing only with the tasks required to render an image.
Tasks unrelated to rendering should be moved, if possible, into the User
Interface (UI) portion of the driver or into the print processor. The UI
portion of the driver still runs in user mode. If you have a library that is
shared by both DLLs, you need to write it so that it can be built and run in
both kernel- and user-mode.
<H4>EMF Printing</H4>
<P>
Journaling has been replaced by metafile spooling, making the Windows NT model
more similar to Windows 95. Metafile spooling also allows GDI to have a single
recording model. See the reference pages for <B><A HREF="grfncs_113.htm">EngMarkBandingSurface</A></B>,
<B><A HREF="grfncs_51.htm">DrvStartBanding</A></B>, and <B><A HREF="grfncs_33.htm">DrvNextBand</A></B>
for more details.
<H4>More on Replacing Calls to the Win32 API</H4>
<P>
New kernel-mode GDI functions have been implemented to replace some of the
Win32 functions commonly used by print drivers. References pages for these
functions are provided in this package. Parameters and usage should be checked
in all cases, as the new GDI functions are not exact replacement functions.The
following table shows the old Win32 functions and their corresponding new
kernel-mode engine functions:
<TABLE>
<TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>Win32 Function</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>Kernel-mode Engine Function</B>
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>GetLastError</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="grfncs_99.htm">EngGetLastError</A></B>
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>EnumForms</B>, <B>GetForm</B>, <B>GetPrinter</B>, <B>GetPrinterData</B>, <B>SetPrinterData</B>,
<B>WritePrinterData</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="grfncs_87.htm">EngEnumForms</A></B>, <B><A HREF="grfncs_98.htm">EngGetForm</A></B>,
<B><A HREF="grfncs_100.htm">EngGetPrinter</A></B>, <B><A HREF="grfncs_101.htm">EngGetPrinterData</A></B>,
<B><A HREF="grfncs_126.htm">EngSetPrinterData</A></B>, <B><A HREF="grfncs_139.htm">EngWritePrinter</A></B>
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>FindResource</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="grfncs_91.htm">EngFindResource</A></B>
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>LoadLibrary</B>, <B>GetProcAddress</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="grfncs_106.htm">EngLoadImage</A></B>, <B><A HREF="grfncs_90.htm">EngFindImageProcAddress</A></B>
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>GetFileTime</B>, <B>GetLocalTime</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="grfncs_97.htm">EngGetFileChangeTime</A></B>, <B><A HREF="grfncs_120.htm">EngQueryLocalTime</A></B>
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>QueryPerformanceCounter</B>, <B>QueryPerformanceFrequency</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="grfncs_121.htm">EngQueryPerformanceCounter</A></B>,
<B><A HREF="grfncs_122.htm">EngQueryPerformanceFrequency</A></B>
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>MultiByteToWideChar</B>, <B>WideCharToMultiByte</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="grfncs_116.htm">EngMultiByteToWideChar</A></B>, <B><A HREF="grfncs_138.htm">EngWideCharToMultiByte</A></B>
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>MulDiv</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B><A HREF="grfncs_114.htm">EngMulDiv</A></B>
</FONT></TABLE>
<H4>Version Marking</H4>
<DL>
<DT>
To ensure that the driver’s correct version is run on the corresponding
version of Windows NT, each print driver must be marked with a version number
in the resource file; for example:
<DD>
<PRE><FONT FACE="Courier" SIZE="2">#include &lt;ntverp.h&gt;
#define VER_FILEVERSION 0,2,0,0
&nbsp;</FONT></PRE>
</DL>
<P>
Version 2 drivers runs in kernel mode. The spooler ensures that the driver is
kept separate from the older, non-kernel-mode drivers.
<H4>UNICODE Conversion</H4>
<P>
Limited ANSI-to UNICODE and UNICODE-to ANSI translation is available through
GDI. See the <B><A HREF="grfncs_115.htm">EngMultiByteToUnicodeN</A></B>
and <B><A HREF="grfncs_132.htm">EngUnicodeToMultiByteN</A></B>
reference pages for more details.
<H4>Spooler Functions</H4>
<P>
The set of spooler functions is limited to UNICODE and those from a driver
that make sense.
<H4>Impersonation</H4>
<P>
Impersonate client and <B>RevertToSelf</B>&nbsp;are handled automatically by
spooler functions.
<H4>Registry</H4>
<P>
There are no plans to support registry functions passing data to kernel-mode
drivers. Settings from the driver should be retrieved using <B><A HREF="grfncs_101.htm">EngGetPrinterData</A></B>.
<H4>File Operations</H4>
<P>
GDI now supplies file mapping support. See the reference pages for <B><A HREF="grfncs_107.htm">EngLoadModule</A></B>,
<B><A HREF="grfncs_108.htm">EngLoadModuleForWrite</A></B>, <B><A HREF="grfncs_111.htm">EngMapFontFile</A></B>,
<B><A HREF="grfncs_112.htm">EngMapModule</A></B>, and <B><A HREF="grfncs_136.htm">EngUnmapFontFile</A></B>
for more information.
<P>
There are no plans to support file read/write/create, file path, or file find
functions.
<H4>Resource Functions</H4>
<P>
See the reference page for <B><A HREF="grfncs_91.htm">EngFindResource</A></B>
for more details.
<P></FONT>
</BODY>
</HTML>
