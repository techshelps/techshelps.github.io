<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Reading from a Port</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H3><A NAME="DDK_Reading_from_a_Port_GG"></A>Reading from a Port</H3>
<P>
A language monitor’s <B><A HREF="pmonfncs_16.htm">ReadPort</A></B>&nbsp;implementation
can call the port monitor’s <B>ReadPort</B>&nbsp;routine to get information from a
bidirectional printer that it supports. The port monitor should simply return
the raw data it receives from the printer to the calling language monitor.
<P>
Language monitors set time-outs on port monitors, and port monitors set
time-outs on the physical device. A port monitor’s <B>ReadPort</B>
implementation should time-out and log an error code if it cannot read data
from the printer associated with the specified port or if it receives no
response from the printer within some appropriate time interval. A port might
return zero bytes on a read; in this case, <B><A HREF="pmonfncs_16.htm">ReadPort</A></B>
should return success.
<P>
Note that a port monitor must implement <B>ReadPort</B>, because a language
monitor’s only method of communication with a bidirectional printer is through
a port monitor.
<P>
Only language monitors are able to parse the strings of data read from a port
to which a bidirectional printer is attached. A language monitor’s <B>ReadPort</B>
or <B><A HREF="pmonfncs_8.htm">GetPrinterDataFromPort</A></B>
implementation calls the port monitor’s corresponding function to get data
from a bidirectional printer. It is the port monitor’s <B><A HREF="pmonfncs_16.htm">ReadPort</A></B>
or <B>GetPrinterDataFromPort </B>function that reads any data available from
the printer and passes that data back to the language monitor, but the port
monitor should not change this data in any way. It is up to the language
monitor to interpret the meaning of the data read from the printer.
<P>
The language monitor can call the port monitor’s <B>GetPrinterDataFromPort</B>
or <B>ReadPort</B>&nbsp;from a background thread on a periodic basis, for example,
every few seconds, to read unsolicited status information from a bidirectional
printer. The PJLMON source code shows how to read unsolicited printer status
information in this way.
<P>
A language monitor can support <B><A HREF="pmonfncs_8.htm">GetPrinterDataFromPort</A></B>
to query information from a bidirectional printer that supports the IEEE 1284
standard. A vendor defines the status request strings passed from the language
monitor to the associated bidirectional printer.
<P>
A port monitor can implement <B>GetPrinterDataFromPort </B>to accommodate
communication between a language monitor and bidirectional printer that
support the IEEE 1284 specification. A port monitor’s <B>GetPrinterDataFromPort</B>
routine makes supported IOCTL calls to IEEE 1284-compliant bidirectional
printers and returns any data received from the printer to the calling
language monitor. <B><A HREF="pmonfncs_8.htm">GetPrinterDataFromPort</A></B>
should use the Win32 <B>DeviceIoControl</B>&nbsp;function to send the IOCTL to the
printing device.
<P>
All monitors that support <B>GetPrinterDataFromPort</B>&nbsp;should fail
immediately with ERROR_INVALID_PARAMETER for registry keys they do not
understand. This forces the spooler to obtain the key value itself from the
registry.
<P>
A port monitor can implement <B>GetPrinterDataFromPort </B>to make IEEE 1284
specification IOCTL calls to bidirectional printers that support this
specification. <B><A HREF="pmonfncs_8.htm">GetPrinterDataFromPort</A></B>
should call the Win32 <B>DeviceIoControl</B>&nbsp;function to send the IOCTL to the
printing device.
<P></FONT>
</BODY>
</HTML>
