<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>VideoPortSetTrappedEmulatorPorts</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_VideoPortSetTrappedEmulatorPorts_GG"></A>VideoPortSetTrappedEmulatorPorts</H2>
<P>
<B>VP_STATUS VideoPortSetTrappedEmulatorPorts(</B>
<TABLE>
<TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
&nbsp; &nbsp; <B>PVOID</B>&nbsp; <I>HwDeviceExtension</I><B>,</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
&nbsp; &nbsp; <B>ULONG</B>&nbsp; <I>NumAccessRanges</I><B>,</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
&nbsp; &nbsp; <B>PVIDEO_ACCESS_RANGE</B>&nbsp; <I>AccessRange</I>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
&nbsp; &nbsp;);
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
</FONT></TABLE>
<P>
VGA-compatible (SVGA) miniport drivers call <B>VideoPortSetTrappedEmulatorPorts</B>
to dynamically change the list of I/O ports that are trapped when a VDM runs
in full-screen mode on an x86-based machine.
<H3>Parameters</H3>
<DL>
<DT>
<I>HwDeviceExtension</I>
<DD>
Points to the miniport driver’s device extension.
<BR>
<DT>
<I>NumAccessRanges</I>
<DD>
Specifies the number of elements in the <I>AccessRange</I>&nbsp;array.
<BR>
<DT>
<I>AccessRange</I>
<DD>
Points to an array of <A HREF="vstrcts_3.htm">VIDEO_ACCESS_RANGE</A>
elements. Each element describes a proper subrange of the <B>EmulatorAccessEntries</B>
that the miniport set up in <A HREF="vstrcts_6.htm">VIDEO_PORT_CONFIG_INFO</A>.
Setting the <B>RangeVisible</B>&nbsp;member of an <I>AccessRange</I>&nbsp;element to
TRUE enables direct access to the I/O port range by the full-screen MS-DOS
application. Setting a <B>RangeVisible</B>&nbsp;member to FALSE causes
application-issued <B>IN</B>s, <B>INSB/INSW/INSD</B>s, <B>OUT</B>s and/or <B>OUTSB/OUTSW/OUTSD</B>s
to that range to be trapped and forwarded to the corresponding miniport <B>SvgaHwIoPort</B><I>Xxx</I>
function for validation.
<P>
The <I>AccessRange</I>&nbsp;array passed to <B>VideoPortSetTrappedEmulatorPorts</B>
must be a proper subset of the I/O port range(s) that the <B><A HREF="vmpfncs_3.htm">HwVidFindAdapter</A></B>
function set up in the <B>EmulatorAccessEntries</B>&nbsp;array of the <A HREF="vstrcts_6.htm">VIDEO_PORT_CONFIG_INFO</A>
structure. Any I/O port ranges in the access ranges array that are not
included in the <B>EmulatorAccessEntries</B>&nbsp;array are trapped and reflected
to the user-mode VDD.
</DL>
<H3>Return Value</H3>
<P>
<B>VideoPortSetTrappedEmulatorPorts</B>&nbsp;returns NO_ERROR if it successfully
changed the trapped ports. Otherwise, it can return ERROR_INVALID_PARAMETER.
<H3>Comments</H3>
<P>
By default, the <I>AccessRange</I>&nbsp;of I/O ports that full-screen MS-DOS
applications can access directly includes none of the access range array
elements describing I/O port ranges that also have corresponding elements in
the <B>EmulatorAccessEntries</B>&nbsp;array of the <A HREF="vstrcts_6.htm">VIDEO_PORT_CONFIG_INFO</A>
structure. That is, I/O port ranges with corresponding emulator access entries
are, by default, hooked to the miniport’s <B>SvgaHwIoPort</B><I>Xxx</I>
functions so application-issued instructions are forwarded to the <B>SvgaHwIoPort</B><I>Xxx</I>
functions for validation.
<P>
A VGA-compatible SVGA miniport driver can enable and disable ranges of I/O
ports on an as-needed basis with calls to <B>VideoPortSetTrappedEmulatorPorts</B>.
Enabled port ranges allow a full-screen MS-DOS application to access those I/O
ports directly, without having application-issued assembly instructions
trapped and forwarded to the miniport driver’s <B>SvgaHwIoPort</B><I>Xxx</I>
functions for validation first. Direct I/O port access for such an application
gives the user faster video I/O response times.
<P>
<B>VideoPortSetTrappedEmulatorPorts</B>&nbsp;scans the <I>AccessRange</I>&nbsp;parameter
array from the first element to the last, enabling and disabling I/O ports as
directed in each element. Note that a range of enabled ports (the <B>RangeVisible</B>
member set to TRUE) can be disabled again in the same call if the miniport
includes a duplicate description of the same range with the <B>RangeVisible</B>
member set to FALSE. Note also that a miniport can enable a wide range of I/O
ports in the initial element of the <I>AccessRange</I>&nbsp;array and selectively
disable subranges of ports in subsequent array elements when it calls <B>VideoPortSetTrappedEmulatorPorts</B>.
<P>
All full-screen MS-DOS applications use the same IOPM (I/O permission map) in
x86-based machines and, therefore, the same set of enabled or disabled I/O
ports. On each switch to such a full-screen application, a VGA-compatible
miniport driver’s <B><A HREF="vmpfncs_9.htm">HwVidStartIO</A></B>&nbsp;function
is called with the IOCTL_VIDEO_ENABLE_VDM VRP. The miniport should then
reinitialize a default set of directly accessible I/O ports, which can include
any ports in the <B>EmulatorAccessEntries</B>&nbsp;array.
<P>
While giving full-screen MS-DOS applications on x86-based machines direct
access to the video ports makes application-initiated video operations faster,
every VGA-compatible SVGA miniport driver must continue to trap a subset of
critical I/O ports to prevent such an application from hanging the machine. In
particular, such miniports <I>always</I>&nbsp;should trap application I/O to the
VGA-compatible adapter sequencer and miscellaneous output registers. Such a
miniport driver also should trap and validate application-issued direct I/O
that could cause the machine to hang for any additional adapter-dependent
subset of I/O ports.
<P>
Calling <B>VideoPortSetTrappedEmulatorPorts</B>&nbsp;again and resetting the <B>RangeVisible</B>
member of an <I>AccessRange</I>&nbsp;element to FALSE causes the application-issued
instructions for that range to be forwarded to the corresponding miniport <B>SvgaHwIoPort</B><I>Xxx</I>
function.
<H3>See Also</H3>
<P>
<A HREF="vstrcts_1.htm">EMULATOR_ACCESS_ENTRY</A>, <B><A HREF="vmpfncs_3.htm">HwVidFindAdapter</A></B>,
<B><A HREF="vmpfncs_9.htm">HwVidStartIO</A></B>, IOCTL_VIDEO_ENABLE_VDM, <B>SvgaHwIoPort</B><I>Xxx</I>,
<A HREF="vstrcts_3.htm">VIDEO_ACCESS_RANGE</A>, <A HREF="vstrcts_6.htm">VIDEO_PORT_CONFIG_INFO</A>,
<B><A HREF="vpfncs_37.htm">VideoPortSynchronizeExecution</A></B>
<P></FONT>
</BODY>
</HTML>
