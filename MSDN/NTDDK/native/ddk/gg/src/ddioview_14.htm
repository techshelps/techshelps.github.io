<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Styled Cosmetic Lines</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H4><A NAME="DDK_Styled_Cosmetic_Lines_GG"></A>Styled Cosmetic Lines</H4>
<P>
<B><A HREF="grfncs_56.htm">DrvStrokePath</A></B>&nbsp;must support the drawing
of cosmetic lines with arbitrary clipping using a solid-color brush. The
driver can make a call to the GDI service <B><A HREF="grfncs_179.htm">PATHOBJ_vEnumStartClipLines</A></B>
to precompute the clipping.
<P>
Styling of a cosmetic line is similar to that for a geometric wide line
because it is specified by a repeating array. For a styled cosmetic line, the
array entries are LONG values that contain the lengths in style steps. The
relation between style steps and pixels is defined by the <B>xStyleStep</B>, <B>yStyleStep</B>,
and <B>denStyleStep</B>&nbsp;fields in the <A HREF="grstrcts_20.htm">GDIINFO</A>structure
returned by <B><A HREF="grfncs_20.htm">DrvEnablePDEV</A></B>.
<P>
When the driver calls <B><A HREF="grfncs_174.htm">PATHOBJ_bEnumClipLines</A></B>,
to handle styled cosmetic lines through complex clipping, GDI modifies the
value of the <A HREF="grstrcts_3.htm">CLIPLINE</A>&nbsp;structure’s <B>iStyleState</B>
member to represent the style state. The style state is the offset back to the
first pixel of the line segment; that is, the first pixel that would be
rendered if the line were not clipped. The style state consists of two 16-bit
values packed into a ULONG value. If HIGH and LOW are the high- and low-order
16 bits of the style state, a fractional version of the style state, referred
to as style position, can be computed as:
<PRE><FONT FACE="Courier" SIZE="2">&nbsp; &nbsp; style position = HIGH + LOW/denStyleStep
&nbsp;</FONT></PRE>
<P>
For example, if the values in <B>iStyleState</B>&nbsp;are 1 and 2, and <B>denStyleStep</B>
is 3, then style position is 5/3. To determine exactly where the drawing of
the style begins in the style array, take the product of:
<PRE><FONT FACE="Courier" SIZE="2">&nbsp; &nbsp; style position * denStyleStep
&nbsp;</FONT></PRE>
<P>
In this example, with a <B>denStyleStep</B>&nbsp;value of 3, the drawing position
is calculated to exclude the first five (5/3 * 3) pixels of the style array.
That is, drawing begins at the sixth pixel in the style array of this clipped
line.
<P>
There are y-styled cosmetic lines and x-styled cosmetic lines. If a line
extends dx device units in the x-direction and dy units in the y-direction,
the line is y-styled when the following is true:
<P>
<TT><FONT FACE="COURIER" SIZE=2>&nbsp; &nbsp; (dy * yStyleStep)  </FONT></TT><FONT
FACE="Symbol">&#179;</FONT><TT><FONT FACE="COURIER" SIZE=2>&nbsp; (dx * xStyleStep)</FONT></TT>
<PRE><FONT FACE="Courier" SIZE="2">&nbsp;</FONT></PRE>
<P>
In this case, the style position is advanced by <B>yStyleStep</B>/<B>denStyleStep</B>
for each pixel advanced in the y direction.
<P>
Conversely, a line is x-styled and the style position is advanced by <B>xStyleStep</B>/<B>denStyleStep</B>
for each pixel advanced in the x direction when the following is true:
<PRE><FONT FACE="Courier" SIZE="2">&nbsp; &nbsp; (dx * xStyleStep)  &gt;  (dy * yStyleStep) 
&nbsp;</FONT></PRE>
<P>
When the style position advances to a new integer, the style step advances one
unit in the style array.
<P>
Figure 3.2 shows several cosmetic styled lines having different slopes. In
this illustration, the pixel grid shown is not square, but is shown as it
would be for an EGA display in which four pixels in the x direction move as
far as three pixels in the y direction. The style steps in <A HREF="grstrcts_20.htm">GDIINFO</A>
ensure that styled lines appear the same at any slope on displays with
nonsquare pixel coordinates. In this illustration, the styling array (defined
by <B>pStyle</B>&nbsp;of <A HREF="grstrcts_25.htm">LINEATTRS</A>) is {1,1}, which is a
broken line having equal-sized dots and gaps. The driver’s value of <B>xStyleStep</B>
is 3, <B>yStyleStep</B>&nbsp;is 4, and <B>denStyleStep</B>&nbsp;is 12.
<P>
<B><IMG SRC="../art/102-02.gif" BORDER=0></B>
<P>
<B>Figure 3.2    Styled Cosmetic Line Examples</B>
<P>
To illustrate further, suppose a dot matrix printer has a 144-dpi horizontal
resolution and a 72-dpi vertical resolution. In addition, suppose the dot
length of the minimum dot is 1/24-inch. To support this printer, select the
smallest numbers for <B>xStyleStep</B>&nbsp;and <B>yStyleStep</B>&nbsp;that can
compensate for the printer’s aspect ratio, such as 1 for <B>xStyleStep</B>&nbsp;and
2 (144/72) for <B>yStyleStep</B>, and 6 (144/24) for <B>denStyleStep</B>.
<P>
If the LA_ALTERNATE bit is set in the flag in the <A HREF="grstrcts_25.htm">LINEATTRS</A>
structure, a special style is used for a cosmetic line. In this case, every
other pixel is on, regardless of direction or aspect ratio. Style state is
returned as if the style array is {1,1} and <B>xStyleStep</B>, <B>yStyleStep</B>,
and <B>denStyleStep</B>&nbsp;are all one. In other words, if <B>lStyleState</B>&nbsp;is
zero, the first pixel is on; if <B>lStyleState</B>&nbsp;is one, the first pixel is
off.
<P>
If the LA_STARTGAP bit is set in the LINEATTRS flag, the sense of the elements
in the style array is inverted. The first array entry specifies the length of
the first gap, the second entry specifies the length of the first dash, and so
forth.
<P></FONT>
</BODY>
</HTML>
