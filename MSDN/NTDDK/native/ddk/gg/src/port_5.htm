<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Porting Steps for Display Drivers</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_Porting_Steps_for_Display_Drivers_GG"></A>Porting Steps for Display Drivers</H2>
<P>
This section contains porting notes that pertain to display drivers only.
<H4>Replace DeviceIoControl</H4>
<P>
The Win32 <B>DeviceIoControl</B>&nbsp;function has been replaced with <B><A HREF="grfncs_86.htm">EngDeviceIoControl</A></B>.
The return value is the inverse of what it used to be: 0 (ERROR_SUCCESS) for
success, and non-zero for failure. The new function also takes one less
parameter; <B>DeviceIoControl</B>’s last parameter, <I>lpoverlapped</I>, is no
longer necessary.
<H4>Remove DCI code</H4>
<P>
DCI support has been permanently removed from the system. Therefore, all DCI
code used in your driver must be removed.
<H4>Remove VFLATD</H4>
<P>
VFLATD functionality is not supported for kernel-mode threads. This means that
your driver can no longer use this functionality to map a banked frame buffer
in the miniport for GDI to write to.
<H4>DEC ALPHA Drivers</H4>
<P>
For drivers that work on the DEC ALPHA only: all calls to the special
TRANSLATE_ADDR access macros should be removed. Calls to the WRITE_FAST access
macros should be changed to use the WRITE_REGISTER access macros. On the
ALPHA, the WRITE_REGISTER and WRITE_PORT macros handle all required address
translation by calling into the HAL. 
<P>
<B>Note</B>&nbsp; The GDI engine is still not equipped to handle sparse frame
buffer access.
<H4>Other Windows NT 4.0 Display Driver Changes</H4>
<P>
Because all Windows NT 3.51 drivers are incompatible in Windows NT 4.0, a few
things have been cleaned up in the display drivers:
<UL>
<LI>
The default patterns are now provided by the engine. A display driver no
longer needs to initialize those patterns. The static array of patterns and
the pattern enable/disable routines should be completely removed.
<P>
<LI>
During driver initialization, DM_INTERLACED should no longer be checked during
mode selection.
<P>
<LI>
Some of the fields in the DEVMODE structure returned by <B><A HREF="grfncs_28.htm">DrvGetModes</A></B>
have changed slightly:
<P>
<OL>
<LI>
The DM_INTERLACED flag in the <B>dmFlag</B>&nbsp;field is obsolete. Its usage must
be completely removed.
<P>
<LI>
The name of the driver must be stored in the <B>dmDeviceName</B>&nbsp;field.
<P>
<LI>
The <B>dmFields</B>&nbsp;field must be filled in with the appropriate bits.
</OL>
<P>
The following is a copy of the sample code found in every Microsoft display
driver:
<P>
<PRE><FONT FACE="Courier" SIZE="2">// Zero the entire structure to start off with.
memset(pdm, 0, sizeof(DEVMODEW));
&nbsp;
// Set the name of the device to the name of the DLL.
memcpy(pdm-&gt;dmDeviceName, DLL_NAME, sizeof(DLL_NAME));
&nbsp;
pdm-&gt;dmSpecVersion      = DM_SPECVERSION;
pdm-&gt;dmDriverVersion    = DM_SPECVERSION;
pdm-&gt;dmSize             = sizeof(DEVMODEW);
pdm-&gt;dmDriverExtra      = DRIVER_EXTRA_SIZE;
&nbsp;
pdm-&gt;dmBitsPerPel       = pVideoTemp-&gt;NumberOfPlanes *
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pVideoTemp-&gt;BitsPerPlane;
pdm-&gt;dmPelsWidth        = pVideoTemp-&gt;VisScreenWidth;
pdm-&gt;dmPelsHeight       = pVideoTemp-&gt;VisScreenHeight;
pdm-&gt;dmDisplayFrequency = pVideoTemp-&gt;Frequency;
pdm-&gt;dmDisplayFlags     = 0;
&nbsp;
pdm-&gt;dmFields           = DM_BITSPERPEL       |
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DM_PELSWIDTH        |
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DM_PELSHEIGHT       |
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DM_DISPLAYFREQUENCY |
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DM_DISPLAYFLAGS     ;
&nbsp;</FONT></PRE>
</UL>
<H4>Update Your .inf File</H4>
<P>
In order for the applet to install the new driver, the <I>OptionType = VIDEO</I>
line in the driver&#39;s .<I>inf</I>&nbsp;file must be changed to:
<PRE><FONT FACE="Courier" SIZE="2">OptionType = VIDEO40BETA
&nbsp;</FONT></PRE>
<P></FONT>
</BODY>
</HTML>
