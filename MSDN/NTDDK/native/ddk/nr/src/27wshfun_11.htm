<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>WSHIoctl</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_WSHIoctl_NR"></A>WSHIoctl</H2>
<P>
<B>INT<BR>
&nbsp; &nbsp; WSHIoctl(<BR>
&nbsp; &nbsp; &nbsp; &nbsp; IN PVOID  </B><I>HelperDllSocketContext<B>,</I></B><BR>
<B>&nbsp; &nbsp; &nbsp; &nbsp; IN SOCKET  </B><I>SocketHandle<B>,</I></B><BR>
<B>&nbsp; &nbsp; &nbsp; &nbsp; IN HANDLE  </B><I>TdiAddressObjectHandle<B>,</I></B><BR>
<B>&nbsp; &nbsp; &nbsp; &nbsp; IN HANDLE  </B><I>TdiConnectionObjectHandle<B>,</I></B><BR>
<B>&nbsp; &nbsp; &nbsp; &nbsp; IN DWORD  </B><I>IoControlCode<B>,</I></B><BR>
<B>&nbsp; &nbsp; &nbsp; &nbsp; IN LPVOID  </B><I>InputBuffer<B>,</I></B><BR>
<B>&nbsp; &nbsp; &nbsp; &nbsp; IN DWORD  </B><I>InputBufferLength<B>,</I></B><BR>
<B>&nbsp; &nbsp; &nbsp; &nbsp; IN LPVOID  </B><I>OutputBuffer<B>,</I></B><BR>
<B>&nbsp; &nbsp; &nbsp; &nbsp; IN DWORD  </B><I>OutputBufferLength<B>,</I></B><BR>
<B>&nbsp; &nbsp; &nbsp; &nbsp; OUT LPDWORD  </B><I>NumberOfBytesReturned<B>,</I></B><BR>
<B>&nbsp; &nbsp; &nbsp; &nbsp; IN LPWSAOVERLAPPED  </B><I>Overlapped<B>,</I></B><BR>
<B>&nbsp; &nbsp; &nbsp; &nbsp; IN LPWSAOVERLAPPED_COMPLETION_ROUTINE  </B><I>CompletionRoutine<B>,</I></B><BR>
<B>&nbsp; &nbsp; &nbsp; &nbsp; OUT LPBOOL  </B><I>NeedsCompletion</I><BR>
<B>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</B>
<P>
<B>WSHIoctl</B>&nbsp;returns information or carries out a particular operation
specified by the given <I>IoControlCode</I>.
<H3>Parameters</H3>
<DL>
<DT>
<I>HelperDllSocketContext</I>
<DD>
Points to a per-socket context area, allocated and initialized by the WSH DLL <B>WSHOpenSocket
</B>or <B>WSHOpenSocket2 </B>function.
<BR>
<DT>
<I>SocketHandle</I>
<DD>
Specifies a handle to the socket that is the target of the requested
operation.
<BR>
<DT>
<I>TdiAddressObjectHandle</I>
<DD>
Specifies the handle to a file object representing the open transport address
for the socket. If the socket is not currently bound to an address, this
parameter is NULL.
<BR>
<DT>
<I>TdiConnectionObjectHandle</I>
<DD>
Specifies the handle to a file object representing the connection endpoint
associated with the socket. If the socket is not currently connected, this
parameter is NULL.
<BR>
<DT>
<I>IoControlCode</I>
<DD>
Specifies an SIO_<I>XXX</I>&nbsp;code requesting a specific operation. The
following are possible system-defined <I>IoControlCodes</I>: 
<DL>
<DT>
SIO_FIND_ROUTE
<DD>
Requests that the route to this socket be determined. <I>InputBuffer</I>&nbsp;will
be NULL. However, <I>OutputBuffer</I>&nbsp;must not be null.
<BR>
<DT>
SIO_FLUSH
<DD>
Requests that the current contents of the send queue for the socket be
flushed. <I>InputBuffer </I>and <I>OutputBuffer</I>&nbsp;will be NULL.
<BR>
<DT>
SIO_MULTIPOINT_LOOPBACK
<DD>
Requests that, whenever data is sent on a multipoint session socket, the data
also be sent to the socket on the local host if the data in <I>InputBuffer</I>
is TRUE. Otherwise, the socket is requested to terminate that behavior.
<BR>
<DT>
SIO_MULTICAST_SCOPE
<DD>
Sets, for the socket specified, wheter data sent on a multipoint sessions
socket will cross routers. If the <I>InputBuffer</I>&nbsp;contains zero, no data
should be sent except to multipoint session members on the local host. The
value one indicates that no routers should be crossed. Values greater than one
indicate that <I>n-1</I>&nbsp;routers may be crossed when data is sent.
</DL>
<P>
A helper DLL also can define its own codes.
<BR>
<DT>
<I>InputBuffer</I>
<DD>
Points to an input buffer for the operation requested by the given <I>IoControlCode</I>.
<BR>
<DT>
<I>InputBufferLength</I>
<DD>
Specifies the length in bytes of the buffer at <I>InputBuffer</I>.
<BR>
<DT>
<I>OutputBuffer</I>
<DD>
Points to an output buffer for the operation requested by the given <I>IoControlCode</I>.
This buffer is used to return information or query results to the caller.
<BR>
<DT>
<I>OutputBufferLength</I>
<DD>
Specifies the length in bytes of the buffer at <I>OutputBuffer</I>.
<BR>
<DT>
<I>NumberOfBytesReturned</I>
<DD>
On return, specifies the number of bytes copied into the buffer at <I>OutputBuffer</I>.
<BR>
<DT>
<I>Overlapped</I>
<DD>
Specifies a pointer to a WSAOVERLAPPED structure to facilitate asynchronous
I/O.
<BR>
<DT>
<I>CompletionRoutine</I>
<DD>
Specifies a pointer to a WSAOVERLAPPED_COMPLETION_ROUTINE provided by the
caller.
<BR>
<DT>
<I>NeedsCompletion</I>
<DD>
On output, specifies whether the service provider should perform I/O
completion operations for overlapped requests.
</DL>
<H3>Return Value</H3>
<DL>
<DT>
<B>WSHIoctl </B>returns zero to indicate successful operation. Otherwise, it
returns a Winsock Error code, as outlined in the following:
<DD>
WSAENETDOWN
<P>
Specifies that the network has failed.
<DL>
<DT>
WSAEFAULT
<DD>
Specifies that one or more of the buffers at <I>InputBuffer</I>&nbsp;or <I>OutputBuffer</I>
are too small for successful operation.
<BR>
<DT>
WSAEINVAL
<DD>
Specifies that the <I>IoControlCode</I>&nbsp;is not a valid command or that a
supplied parameter is invalid.
<BR>
<DT>
WSAEINPROGRESS
<DD>
Specifies that <B>WSHIoctl</B>&nbsp;was called while there was a completion routine
callback in progress. This error can be returned only if the helper DLL
handles I/O completion of overlapped requests itself.
<BR>
<DT>
WSAEOPNOTSUPP
<DD>
Specifies that a normally valid <I>IoControlCode</I>&nbsp;is inappropriate to this
socket. This generally indicates that the requested operation is not supported
by the underlying protocol.
<BR>
<DT>
WSA_IO_PENDING
<DD>
Specifies that the request is still in progress and will be completed at a
later time. This error code can be returned only if overlapped information has
been supplied at <I>Overlapped</I>&nbsp;or <I>OverlappedRoutine</I>.
<BR>
<DT>
WSAEWOULDBLOCK
<DD>
Specifies that this operation would block the socket but the socket has been
marked as a non-blocking socket.
</DL>
</DL>
<H3>Comments</H3>
<P>
<B>WSHIoctl</B>&nbsp;is called by the service provider to satisfy several types of
requests. In addition, it is possible for a helper DLL to support operations
designated by privately defined I/O control codes specific to a protocol that
the helper DLL supports. Such privately defined codes will be transmitted to
the helper DLL by <B>WSAIoctl</B>. For more information on <B>WSAIoctl</B>&nbsp;or
custom control codes, see the Win32 SDK.
<P>
Because some operations that are normally requested through <B>WSHIoctl</B>
can require a significant amount of time to complete, an overlapped I/O
mechanism is provided. A caller either specifies a WSAOVERLAPPED structure in <I>Overlapped
</I>or specifies a callback routine in <I>OverlappedRoutine</I>.
<P>
When such an I/O operation is completed, the helper DLL can either handle I/O
completion in the overlapped manner itself, or allow the service provider to
handle such operations. This is controlled by the <I>NeedsCompletion</I>
parameter.
<P>
If the helper DLL chooses to handle the I/O completion itself, the following
guidelines apply:
<UL>
<LI>
If a completion routine is specified in <I>OverlappedRoutine</I>, the
structure provided at <I>Overlapped</I>&nbsp;should be ignored.
<P>
<LI>
If a completion routine is not specified, then the <I>Overlapped</I>&nbsp;parameter
is used. The event handle provided in this structure should be signalled to
indicate to the caller that the I/O has completed.
<P>
<LI>
When calling a completion routine provided at <I>OverlappedRoutine</I>, the
number of bytes transferred, normally returned in <I>NumberOfBytesReturned</I>
and an error code (zero indicating success) must be passed as the defined
parameters to this caller-supplied I/O completion routine.
</UL>
<P></FONT>
</BODY>
</HTML>
