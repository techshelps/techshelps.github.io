<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>NdisMIndicateStatus</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_NdisMIndicateStatus_NR"></A>NdisMIndicateStatus</H2>
<P>
<B>VOID <BR>
&nbsp; &nbsp; NdisMIndicateStatus(<BR>
&nbsp; &nbsp; &nbsp; &nbsp; IN</B>&nbsp;<B>NDIS_HANDLE</B>&nbsp;<I>MiniportAdapterHandle</I><B>,</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN</B>&nbsp;<B>NDIS_STATUS</B>&nbsp;<I>GeneralStatus</I><B>,</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PVOID</B>&nbsp;<I>StatusBuffer</I><B>,</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN</B>&nbsp;<B>UINT</B>&nbsp;<I>StatusBufferSize<BR>
</I>&nbsp; &nbsp; &nbsp; &nbsp; <B>);</B>
<P>
<B>NdisMIndicateStatus</B>&nbsp;indicates changes in the status of a NIC to
higher-level NDIS drivers. 
<H3>Parameters</H3>
<DL>
<DT>
<I>MiniportAdapterHandle</I>
<DD>
Specifies the handle originally input to MiniportInitialize. 
<BR>
<DT>
<I>GeneralStatus</I>
<DD>
Specifies the NDIS_STATUS_<I>XXX</I>&nbsp;value that indicates the general change
in status for the NIC. 
<BR>
<DT>
<I>StatusBuffer</I>
<DD>
Points to a caller-allocated buffer containing data that is medium-specific
and dependent on the value of <I>GeneralStatus</I>. It indicates detailed
information about the change in status. 
<BR>
<DT>
<I>StatusBufferSize</I>
<DD>
Specifies the size in bytes of the buffer at <I>StatusBuffer</I>.
</DL>
<H3>Comments</H3>
<P>
When a miniport calls <B>NdisMIndicateStatus</B>, NDIS calls each bound
protocol’s ProtocolStatus function. This allows a bound protocol driver or,
possibly, the configuration manager to log the change in status of an
underlying NIC or to take corrective action. For example, a protocol might
call <B>NdisReset</B>, depending on the NDIS_STATUS_<I>XXX</I>&nbsp;indicated. 
<P>
When a miniport calls <B>NdisMIndicateStatus</B>&nbsp;to report a change in NIC
status, NDIS can call the MiniportReset function to try restoring the NIC to a
working condition. In these circumstances, NDIS can call bound protocols only
with NDIS_STATUS_RESET_START and later with NDIS_STATUS_RESET_END, rather than
with the <I>GeneralStatus</I>&nbsp;indicated by the miniport.
<P>
<B>NdisMIndicateStatus</B>&nbsp;provides two pieces of information:
<UL>
<LI>
An overall status value indicating the general change in status.
<P>
<LI>
A specific reason for the general change, which can be network-specific. For
example, ring-insertion failures are particular to Token Ring (802.5)
networks, but are irrelevant to Ethernet (802.3) NICs and their drivers.
</UL>
<P>
A miniport also can call <B>NdisMIndicateStatus</B>&nbsp;to indicate problems such
as cables that have been accidentally removed and then reinserted, or a ring
that has temporarily failed. For example, suppose both the following
conditions occur: 
<UL>
<LI>
The miniport calls <B>NdisMIndicateStatus</B>&nbsp;with NDIS_STATUS_RING_STATUS.
<P>
<LI>
The <I>StatusBuffer</I>&nbsp;contains one of the following status values:<BR>
NDIS_RING_LOBE_WIRE_FAULT<BR>
NDIS_RING_HARD_ERROR<BR>
NDIS_RING_SIGNAL_LOSS
</UL>
<P>
After such a change in status has been signaled with an indication, any
associated thresholds or statistics counters remain unchanged.
<P>
Callers of <B>NdisMIndicateStatus</B>&nbsp;run at IRQL DISPATCH_LEVEL. 
<H3>WAN Miniport Calls to NdisMIndicateStatus</H3>
<P>
Most WAN NIC drivers indicate status with some special status codes and buffer
contents. These status indications are generated by WAN NIC drivers, and NDIS
protocol drivers bound to such a miniport can ignore these indications.
However, processing these indications correctly usually results in improved
performance for protocols and for WAN NIC drivers. 
<P>
The following four types of WAN-specific indications can be sent to bound
protocol drivers with <B>NdisMIndicateStatus</B>: 
<OL>
<LI>
Line up
<P>
<LI>
Line down
<P>
<LI>
Fragment
<P>
<LI>
TAPI line event
</OL>
<H4>NDIS_STATUS_WAN_LINE_UP</H4>
<P>
A WAN miniport makes a line-up indication whenever a new link becomes active.
Until this occurs, the NIC will accept frames and let them succeed or fail,
but it is unlikely that they will actually be received by any remote. Until
this occurs, protocols should reduce their timers and retry counts so as to
quickly fail any outgoing connection attempts.
<P>
The WAN miniport makes this indication with <B>NdisMIndicateStatus</B>&nbsp;before
it returns from the OID_TAPI_GET_ID request. 
<P>
The status code for the line-up indication is NDIS_STATUS_WAN_LINE_UP. The
buffer at <I>StatusBuffer</I>&nbsp;is formatted as an NDIS_MAC_LINE_UP structure.
<H4>NDIS_STATUS_WAN_LINE_DOWN</H4>
<P>
A WAN miniport makes a line-down indication whenever a link goes down. When
this occurs, bound protocols should reduce their timers and retry counts until
the next line-up indication.
<P>
The status code for the line-down indication is NDIS_STATUS_WAN_LINE_DOWN. The
buffer at <I>StatusBuffer</I>&nbsp;is formatted as an NDIS_MAC_LINE_DOWN structure.
<H4>NDIS_STATUS_WAN_FRAGMENT</H4>
<P>
A WAN miniport makes a fragment indication whenever it receives a partial
packet from the remote node. When this occurs, a bound protocol should send
frames to the remote that will notify it of this situation, rather than
waiting for a timeout to occur.
<P>
The status code for the fragment indication is NDIS_STATUS_WAN_FRAGMENT. The
buffer at <I>StatusBuffer</I>&nbsp;is formatted as an NDIS_MAC_FRAGMENT structure. 
<P>
NDISWAN monitors dropped packets by counting the number of fragment
indications on each link.
<H4>NDIS_TAPI_EVENT</H4>
<P>
A WAN miniport must use a <I>GeneralStatus</I>&nbsp;value of
NDIS_STATUS_TAPI_INDICATION for TAPI status indications<I>.</I>&nbsp;The buffer at <I>StatusBuffer</I>
is formatted as an NDIS_TAPI_EVENT structure. 
<H3>See Also</H3>
<P>
<B><A HREF="101mini_8.htm">MiniportInitialize</A></B>, <B><A HREF="101mini_12.htm">MiniportReset</A></B>,
<B><A HREF="106nstru_1.htm">NDIS_MAC_FRAGMENT</A></B>, <B><A HREF="106nstru_2.htm">NDIS_MAC_LINE_DOWN</A></B>,
<B><A HREF="106nstru_3.htm">NDIS_MAC_LINE_UP</A></B>, <B><A HREF="103ndisx_109.htm">NdisMIndicateStatusComplete</A></B>,
<B><A HREF="106nstru_8.htm">NDIS_TAPI_EVENT</A></B>, <B><A HREF="104tdlow_11.htm">ProtocolStatus</A></B>
<P></FONT>
</BODY>
</HTML>
