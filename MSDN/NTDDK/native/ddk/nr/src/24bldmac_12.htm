<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>TdiBuildReceive</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_TdiBuildReceive_NR"></A>TdiBuildReceive</H2>
<P>
<B>VOID <BR>
&nbsp; &nbsp; TdiBuildReceive (<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PIRP</B>&nbsp; <I>Irp</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PDEVICE_OBJECT</B>&nbsp; <I>DevObj</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PFILE_OBJECT</B>&nbsp; <I>FileObj</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PVOID</B>&nbsp; <I>CompRoutine</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PVOID</B>&nbsp; <I>Contxt</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PMDL</B>&nbsp; <I>MdlAddr</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN ULONG</B>&nbsp; <I>InFlags</I><B>,</B>&nbsp;<B><BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN ULONG</B>&nbsp; <I>ReceiveLen<BR>
</I>&nbsp; &nbsp; &nbsp; &nbsp; <B>);</B>
<P>
<B>TdiBuildReceive</B>&nbsp;sets up an internal device control IRP for a
TDI_RECEIVE request to the underlying transport in which the local-node client
has established an endpoint-to-endpoint connection with a remote-node peer. 
<H3>Parameters</H3>
<DL>
<DT>
<I>Irp</I>
<DD>
Points to a client-supplied IRP, either originating in a higher level network
component or allocated with <B>TdiBuildInternalDeviceControlIrp</B>. 
<BR>
<DT>
<I>DevObj</I>
<DD>
Points to the device object created by the next lower TDI transport driver.
<BR>
<DT>
<I>FileObj</I>
<DD>
Points to a file object representing a connection endpoint. 
<P>
The caller previously made a successful request, set up with <B>TdiBuildAssociateAddress</B>,
to the transport to set up an association between this connection endpoint and
a local-node address. When the association was established, the caller also
established an endpoint-to-endpoint connection with a remote-node peer, by
issuing a successful request set up with <B>TdiBuildConnect</B>&nbsp;or <B>TdiBuildListen</B>,
the latter possibly followed by a successful request set up with <B>TdiBuildAccept</B>.
<BR>
<DT>
<I>CompRoutine</I>
<DD>
Specifies the entry point of a client-supplied IoCompletion routine or NULL.
The I/O Manager calls this routine when the given IRP is completed, unless the
client sets this parameter to NULL. 
<BR>
<DT>
<I>Contxt</I>
<DD>
Points to a client-determined context. This client-supplied pointer is passed
in to the IoCompletion routine when it is called with the completed IRP. <I>Contxt</I>
should be NULL if <I>CompRoutine</I>&nbsp;is NULL.
<BR>
<DT>
<I>MdlAddr</I>
<DD>
Points to an MDL, possibly the initial MDL in a chain of MDLs, mapping a
client-supplied buffer into which the transport is to transfer the received
TSDU according to the given <I>InFlags</I>.
<BR>
<DT>
<I>InFlags</I>
<DD>
Specifies the type of receive to be returned by the transport as one or more
(Ored) or none (zero) of the following:
<DL>
<DT>
TDI_RECEIVE_NORMAL
<DD>
Return a normal TSDU to the client-supplied buffer.
<BR>
<DT>
TDI_RECEIVE_EXPEDITED
<DD>
Return an expedited TSDU to the client-supplied buffer. 
</DL>
<P>
If both TDI_RECEIVE_NORMAL and TDI_RECEIVE_EXPEDITED are set or if neither is
set, the underlying transport will indicate either type of TSDU for this
receive request.
<DL>
<DT>
TDI_RECEIVE_PEEK
<DD>
Return indicated data as soon as a receive arrives from the remote node, even
if it is a partial TSDU, and the client will request another receive for the
remainder of the TSDU to be transferred into this buffer if the packet is of
interest to this client. This flag is valid only if the underlying transport
buffers received data internally.
</DL>
<DT>
<I>ReceiveLen</I>
<DD>
Specifies the size in bytes of the client-supplied receive buffer.
</DL>
<H3>Comments</H3>
<P>
<B>TdiBuildReceive </B>sets IRP_MJ_INTERNAL_DEVICE_CONTROL as the <B>MajorFunction</B>
and TDI_RECEIVE as the <B>MinorFunction</B>&nbsp;codes in the transport&#39;s I/O
stack location of the given IRP.
<P>
If the client has registered any of its ClientEvent(Chained)Receive(Expedited)
handler(s) for the given connection endpoint, issuing a receive request
suppresses calls to ClientEvent(Chained)Receive(Expedited) until the receive
IRP is satisfied. Then, the transport resumes indicating receives to the
appropriate ClientEvent(Chained)Receive(Expedited) handler(s).
<P>
Unless the TDI_RECEIVE_PEEK flag is set, the underlying transport fills the
given buffer with received data until the client&#39;s buffer is full or the
transport receives an end-of-record indication from the remote node. If this
flag is set, the client must issue subsequent receive request(s) when this IRP
is satisfied to obtain the full TSDU. 
<P>
If the underlying transport is receiving normal data and expedited data
arrives from the remote node, the transport pre-empts its normal receive
operation and returns immediately to the client with any normal data it has
already transferred into the client-supplied buffer. When this occurs, the
client must make as many receive requests as necessary to receive the
expedited TSDU. When the client has retrieved all the arriving expedited data,
it issues another receive request to resume receiving normal data. 
<P>
A client can also receive normal TSDUs on an endpoint-to-endpoint connection
by calling <B>ZwReadFile</B>. However, the client cannot receive expedited
data in this manner because the transport has no way to indicate receive
flags. In addition, a call to <B>ZwReadFile</B>&nbsp;does not tell the client
whether the underlying transport has received an end-of-record indication.
<H3>See Also</H3>
<P>
<B><A HREF="25tdicli_2.htm">ClientEventChainedReceive</A></B>, <B><A HREF="25tdicli_4.htm">ClientEventChainedReceiveExpedited</A></B>,
<B><A HREF="25tdicli_7.htm">ClientEventReceive</A></B>, <B><A HREF="25tdicli_9.htm">ClientEventReceiveExpedited</A></B>,
<B><A HREF="24bldmac_1.htm">TdiBuildAccept</A></B>, <B><A HREF="24bldmac_4.htm">TdiBuildConnect</A></B>,
<B><A HREF="24bldmac_7.htm">TdiBuildInternalDeviceControlIrp</A></B>,
<B><A HREF="24bldmac_8.htm">TdiBuildListen</A></B>, <B><A HREF="24bldmac_13.htm">TdiBuildReceiveDatagram</A></B>,
<B><A HREF="24bldmac_14.htm">TdiBuildSend</A></B>, <B><A HREF="24bldmac_16.htm">TdiBuildSetEventHandler</A></B>,
<B><A HREF="22ioctl_9.htm">TDI_RECEIVE</A></B>&nbsp;
<P></FONT>
</BODY>
</HTML>
