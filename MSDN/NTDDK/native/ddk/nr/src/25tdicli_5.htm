<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>ClientEventDisconnect</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_ClientEventDisconnect_NR"></A>ClientEventDisconnect</H2>
<P>
<B>NTSTATUS <BR>
&nbsp; &nbsp; ClientEventDisconnect (<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PVOID</B>&nbsp; <I>TdiEventContext</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN CONNECTION_CONTEXT</B>&nbsp; <I>ConnectionContext</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN LONG</B>&nbsp; <I>DisconnectDataLength</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PVOID</B>&nbsp; <I>DisconnectData</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN LONG</B>&nbsp; <I>DisconnectInformationLength</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PVOID</B>&nbsp; <I>DisconnectInformation</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN ULONG</B>&nbsp; <I>DisconnectFlags<BR>
</I>&nbsp; &nbsp; &nbsp; &nbsp; <B>);</B>
<P>
ClientEventDisconnect is an event handler that the underlying TDI transport
calls in response to an incoming disconnection notification from a remote
node. 
<H3>Parameters</H3>
<DL>
<DT>
<I>TdiEventContext</I>
<DD>
Points to the client-supplied context provided in the IRP that was set up with
<B>TdiBuildSetEventHandler</B>&nbsp;when ClientEventDisconnect was registered with
the underlying transport.
<BR>
<DT>
<I>ConnectionContext</I>
<DD>
Points to the client&#39;s context area for this connection endpoint. The
client previously supplied this value to its underlying transport when its
ClientEventConnect handler accepted a connection offer from the remote-node
peer and/or when it opened the connection endpoint with <B>ZwCreateFile</B>. 
<BR>
<DT>
<I>DisconnectDataLength</I>
<DD>
Specifies the size in bytes of the buffer at <I>DisconnectData</I>. Zero
indicates that no disconnect data was transmitted from the remote node.
<BR>
<DT>
<I>DisconnectData</I>
<DD>
Points to a buffer containing disconnect data received from the remote node by
the underlying transport. This pointer is NULL if <I>DisconnectDataLength</I>
is zero. 
<BR>
<DT>
<I>DisconnectInformationLength</I>
<DD>
Specifies the size in bytes of the buffer at <I>DisconnectInformation</I>.
Zero indicates that no additional disconnect information was transmitted from
the remote node. 
<BR>
<DT>
<I>DisconnectInformation</I>
<DD>
Points to a buffer containing any additional transport-specific disconnect
information. This pointer is NULL if <I>DisconnectInformationLength</I>&nbsp;is
zero.
<BR>
<DT>
<I>DisconnectFlags</I>
<DD>
Specifies the nature of the disconnection operation as zero or as one of the
following flags:
<DL>
<DT>
TDI_DISCONNECT_ABORT
<DD>
The transport is closing the endpoint-to-endpoint connection immediately
without completing any pending operations on the connection. In effect, this
flag is equivalent to a <I>DisconnectFlags</I>&nbsp;of zero. 
<BR>
<DT>
TDI_DISCONNECT_RELEASE
<DD>
The transport is engaged in a controlled disconnect operation with the remote
node. 
</DL>
</DL>
<H3>Return Value</H3>
<P>
ClientEventDisconnect can return STATUS_SUCCESS. 
<H3>Comments</H3>
<P>
A call to ClientEventDisconnect notifies the local-node client that its
remote-node peer is closing their established endpoint-to-endpoint connection.
Depending on the input <I>DisconnectFlags</I>, the disconnect can be either
controlled or uncontrolled. ClientEventDisconnect is the last event handler
the TDI driver calls on an endpoint-to-endpoint connection.
<P>
If TDI_DISCONNECT_RELEASE is set in the <I>DisconnectFlags</I>, both
transports are coordinating a controlled disconnection. (See TDI_DISCONNECT
for details.) 
<P>
A call to ClientEventDisconnect notifies the local-node client that
endpoint-to-endpoint activity has ceased or is ceasing on the connection
endpoint opened by that client. However, the connection endpoint is still
valid after the endpoint-to-endpoint connection has been broken. The
local-node client can reuse its open connection endpoint in a subsequent
operation after ClientEventDisconnect returns control.
<P>
ClientEventDisconnect can be called at IRQL DISPATCH_LEVEL. 
<H3>See Also</H3>
<P>
<B><A HREF="24bldmac_6.htm">TdiBuildDisconnect</A></B>, <B><A HREF="24bldmac_16.htm">TdiBuildSetEventHandler</A></B>,
<B><A HREF="22ioctl_6.htm">TDI_DISCONNECT</A></B>&nbsp;
<P></FONT>
</BODY>
</HTML>
