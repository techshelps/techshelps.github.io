<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>MacAddAdapter</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_MacAddAdapter_NR"></A>MacAddAdapter</H2>
<P>
<B>NDIS_STATUS</B><BR>
&nbsp; &nbsp; <B>MacAddAdapter(</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN NDIS_HANDLE</B>&nbsp; <I>MacMacContext</I><B>,</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN NDIS_HANDLE</B>&nbsp; <I>WrapperConfigurationContext</I><B>,</B><I><BR>
</I>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PNDIS_STRING</B>&nbsp; <I>AdapterName<BR>
</I>&nbsp; &nbsp; &nbsp; &nbsp; <B>);</B>
<P>
MacAddAdapter is called to add support for each network interface card on the
network. 
<H3>Parameters</H3>
<DL>
<DT>
<I>MacMacContext</I>
<DD>
Points to a context area in which NDIS maintains state about the NIC. 
<BR>
<DT>
<I>WrapperConfigurationContext</I>
<DD>
Specifies the context that the NDIS library associates with registry
information for the NIC. The <B>DriverEntry</B>&nbsp;function obtained this handle
from its call to <B>NdisInitializeWrapper</B>. 
<BR>
<DT>
<I>AdapterName</I>
<DD>
Points to a string in the OS-default character set naming the NIC. For Windows
NT drivers, this string is a counted, zero-terminated Unicode string. The NIC
driver passes this name to <B>NdisRegisterAdapter</B>. 
</DL>
<H3>Return Value</H3>
<P>
MacAddAdapter can return the value returned by <B>NdisRegisterAdapter</B>&nbsp;or
possibly one of the following status codes: 
<P>
NDIS_STATUS_ADAPTER_NOT_FOUND<BR>
NDIS_STATUS_RESOURCES<BR>
NDIS_STATUS_SUCCESS only if <B>NdisRegisterAdapter</B>&nbsp;returned this value
<H3>Comments</H3>
<P>
Using calls to <B>Ndis</B><I>Xxx</I>&nbsp;configuration functions, such as <B>NdisOpenConfiguration</B>,
<B>NdisReadConfiguration</B>, and <B>NdisReadEisaSlotInformation</B>, the NIC
driver reads the hardware configuration information from the registry or from
the I/O bus to determine the correct NIC parameters. 
<P>
When it has collected the NIC configuration data it needs, MacAddAdapter calls
<B>NdisRegisterAdapter</B>&nbsp;for the associated NIC, including the name of the
logical adapter representing the NIC. This name allows NDIS to recognize the
NIC when a protocol driver binds to the NIC using <B>NdisOpenAdapter</B>. 
<P>
Other initialization functions the MacAddAdapter function calls can include <B>NdisAllocateDmaChannel</B>
or <B>NdisAllocateSharedMemory</B>, <B>NdisAllocateMemory</B>, <B>NdisInitializeInterrupt</B>,
and <B>NdisMapIoSpace</B>. 
<P>
A successful call to <B>NdisInitializeInterrupt</B>&nbsp;enables calls to the NIC
driver’s MacInterruptServiceRoutine. Unless MacAddAdapter disables interrupts
on the NIC before it calls <B>NdisInitializeInterrupt</B>&nbsp;or its NIC cannot
generate interrupts in its current state, the driver must be prepared to
handle a device interrupt during initialization. 
<P>
MacAddAdapter should register the driver’s MacShutdown function with <B>NdisRegisterAdapterShutdownHandler</B>.
<P>
MacAddAdapter also can initialize a filter library database with a call to <B>EthCreateFilter</B>,
<B>FddiCreateFilter</B>, or <B>TrCreateFilter</B>, as appropriate to the
medium type it supports. 
<P>
If MacAddAdapter’s call to <B>NdisRegisterAdapter</B>&nbsp;succeeds but it
subsequently fails to initialize its NIC or to allocate necessary resources to
support its NIC, MacAddAdapter must release any resources it has already
allocated, such as by calling <B>NdisFreeDmaChannel</B>&nbsp;or <B>NdisFreeSharedMemory</B>,
<B>NdisRemoveInterrupt</B>, <B>NdisUnmapIoSpace</B>, <B>NdisCloseConfiguration</B>,
<B>NdisDeregisterAdapterShutdownHandler</B>, and so forth. It also must call <B>NdisDeregisterAdapter</B>
before it returns control with an error status. 
<P>
If MacAddAdapter cannot recognize, configure, and initialize at least one NIC
in the machine, the NIC driver will not remain loaded. If MacAddAdapter does
not returns NDIS_STATUS_SUCCESS for at least one adapter, the NDIS library
interprets this as a failure and the driver will not remain loaded. 
<P>
MacAddAdapter runs at IRQL PASSIVE_LEVEL in the context of a system thread. 
<H3>See Also</H3>
<P>
<B><A HREF="appdxa_3.htm">DriverEntry of NDIS
Full-NIC Drivers</A></B>, <B><A HREF="appdxa_31.htm">EthCreateFilter</A></B>,
<B><A HREF="appdxa_48.htm">FddiCreateFilter</A></B>, <B><A HREF="101mini_8.htm">MiniportInitialize</A></B>,
<B><A HREF="appdxa_62.htm">NdisAllocateDmaChannel</A></B>, <B><A HREF="103ndisx_10.htm">NdisAllocateMemory</A></B>,
<B><A HREF="appdxa_63.htm">NdisAllocateSharedMemory</A></B>, <B><A HREF="103ndisx_13.htm">NdisAllocateSpinLock</A></B>,
<B><A HREF="appdxa_74.htm">NdisDeregisterAdapter</A></B>, <B><A HREF="appdxa_83.htm">NdisInitializeInterrupt</A></B>,
<B><A HREF="appdxa_86.htm">NdisMapIoSpace</A></B>, <B><A HREF="103ndisx_148.htm">NdisOpenAdapter</A></B>,
<B><A HREF="103ndisx_149.htm">NdisOpenConfiguration</A></B>, <B><A HREF="appdxa_87.htm">NdisPciAssignResources</A></B>,
<B><A HREF="103ndisx_175.htm">NdisReadConfiguration</A></B>, <B><A HREF="103ndisx_176.htm">NdisReadEisaSlotInformation</A></B>,
<B><A HREF="103ndisx_177.htm">NdisReadEisaSlotInformationEx</A></B>,
<B><A HREF="103ndisx_178.htm">NdisReadMcaPosInformation</A></B>, <B><A HREF="103ndisx_179.htm">NdisReadNetworkAddress</A></B>,
<B><A HREF="103ndisx_180.htm">NdisReadPciSlotInformation</A></B>,
<B><A HREF="appdxa_96.htm">NdisRegisterAdapter</A></B>, <B><A HREF="appdxa_97.htm">NdisRegisterAdapterShutdownHandler</A></B>,
<B><A HREF="103ndisx_216.htm">NdisWriteConfiguration</A></B>, <B><A HREF="103ndisx_218.htm">NdisWritePciSlotInformation</A></B>,
<B><A HREF="appdxa_121.htm">TrCreateFilter</A></B>&nbsp;
<P></FONT>
</BODY>
</HTML>
