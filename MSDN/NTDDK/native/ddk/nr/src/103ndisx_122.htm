<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>NdisMRegisterDmaChannel</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_NdisMRegisterDmaChannel_NR"></A>NdisMRegisterDmaChannel</H2>
<P>
<B>NDIS_STATUS <BR>
&nbsp; &nbsp; NdisMRegisterDmaChannel(<BR>
&nbsp; &nbsp; &nbsp; &nbsp; OUT PNDIS_HANDLE</B>&nbsp;<I>MiniportDmaHandle</I><B>,</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN NDIS_HANDLE</B>&nbsp;<I>MiniportAdapterHandle</I><B>,</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN UINT</B>&nbsp;<I>DmaChannel</I><B>,</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN BOOLEAN</B>&nbsp;<I>Dma32BitAddresses</I><B>,</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PNDIS_DMA_DESCRIPTION</B>&nbsp;<I>DmaDescription</I><B>,</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN ULONG</B>&nbsp;<I>MaximumLength<BR>
</I>&nbsp; &nbsp; &nbsp; &nbsp; <B>);</B>
<P>
<B>NdisMRegisterDmaChannel</B>&nbsp;claims a system DMA controller channel during
initialization for DMA operations on a slave NIC or on an ISA busmaster NIC. 
<H3>Parameters</H3>
<DL>
<DT>
<I>MiniportDmaHandle</I>
<DD>
Points to a caller-supplied variable in which this function returns a handle
the miniport uses in subsequent calls to the <B>NdisM</B><I>Xxx</I>&nbsp;system DMA
functions.
<BR>
<DT>
<I>MiniportAdapterHandle</I>
<DD>
Specifies the handle input to MiniportInitialize.
<BR>
<DT>
<I>DmaChannel</I>
<DD>
Ignored. Set the DMA channel, if any, at <I>DmaDescription</I>.  
<BR>
<DT>
<I>Dma32BitAddresses</I>
<DD>
Specifies TRUE if the NIC has 32 address lines.
<BR>
<DT>
<I>DmaDescription</I>
<DD>
Points to an NDIS_DMA_DESCRIPTION structure filled in by the caller. This
structure is defined as follows: 
<PRE><FONT FACE="Courier" SIZE="2">typedef struct _NDIS_DMA_DESCRIPTION {
&nbsp; &nbsp; BOOLEAN DemandMode;
&nbsp; &nbsp; BOOLEAN AutoInitialize;
&nbsp; &nbsp; BOOLEAN DmaChannelSpecified;
&nbsp; &nbsp; DMA_WIDTH DmaWidth;
&nbsp; &nbsp; DMA_SPEED DmaSpeed;
&nbsp; &nbsp; ULONG DmaPort;
&nbsp; &nbsp; ULONG DmaChannel;
} NDIS_DMA_DESCRIPTION, *PNDIS_DMA_DESCRIPTION;
&nbsp;</FONT></PRE>
<P>
The driver should initialize this structure with zeros before filling in the
following members:
<DL>
<DT>
<B>DemandMode</B>
<DD>
Specifies TRUE if the slave NIC uses the system DMA controller’s demand mode.
<BR>
<DT>
<B>AutoInitialize</B>
<DD>
Specifies TRUE if the slave NIC uses the system DMA controller’s
autoinitialize mode.
<BR>
<DT>
<B>DmaChannelSpecified</B>
<DD>
Specifies TRUE if <B>DmaChannel</B>&nbsp;is set to the bus-relative value of the
system DMA controller channel used by the NIC.
<BR>
<DT>
<B>DmaWidth</B>
<DD>
Specifies the transfer width for DMA operations, one of <B>Width8Bits</B>, <B>Width16Bits</B>,
or <B>Width32Bits</B>.
<BR>
<DT>
<B>DmaSpeed</B>
<DD>
Specifies one of <B>Compatible</B>, <B>TypeA</B>, <B>TypeB</B>, or <B>TypeC</B>.
<BR>
<DT>
<B>DmaPort</B>
<DD>
Specifies the bus-relative port number if the NIC is on an MCA bus; otherwise,
specifies zero. 
<BR>
<DT>
<B>DmaChannel</B>
<DD>
Specifies the bus-relative number of the system DMA controller channel used by
the NIC.
</DL>
<DT>
<I>MaximumLength</I>
<DD>
Specifies the maximum number of bytes the NIC can transfer in a single DMA
operation. If the NIC has unlimited transfer capacity,set this parameter to
-1. 
</DL>
<H3>Return Value</H3>
<P>
<B>NdisMRegisterDmaChannel</B>&nbsp;can return one of the following status values:
<DL>
<DT>
NDIS_STATUS_SUCCESS
<DD>
NDIS claimed the specified DMA channel in the registry for the caller’s NIC
and set up necessary resources for subsequentl DMA operations by the miniport.
<BR>
<DT>
NDIS_STATUS_RESOURCE_CONFLICT
<DD>
An attempt to claim the DMA channel in the registry has failed, possibly
because another driver has already claimed that channel for its device. <B>NdisMRegisterDmaChannel
</B>logs an error if this occurs.
<BR>
<DT>
NDIS_STATUS_RESOURCES
<DD>
NDIS could not allocate the system resources it needs to support DMA
operations by this NIC driver.
<BR>
<DT>
NDIS_STATUS_FAILURE
<DD>
Either the bus type or bus number is out of range or the driver declared its
NIC a busmaster on an I/O bus other than ISA. 
</DL>
<H3>Comments</H3>
<P>
A driver of a slave-DMA NIC must call <B>NdisMRegisterDmaChannel</B>&nbsp;from its
MiniportInitialize function to reserve system resources for subsequent DMA
operations and to claim them in the registry. 
<P>
The driver of an ISA busmaster NIC also must call <B>NdisMRegisterDmaChannel</B>
from MiniportInitialize to claim a system DMA controller channel for its NIC
in the registry. 
<P>
MiniportInitialize must call <B>NdisMSetAttributes</B>&nbsp;or <B>NdisMSetAttributesEx</B>
before calling <B>NdisMRegisterDmaChannel</B>. 
<P>
MiniportInitialize obtained the bus-relative values passed to <B>NdisMRegisterDmaChannel</B>
either from the registry or by calling a bus-type-specific <B>Ndis</B><I>Xxx</I>
configuration function. 
<P>
If such a driver cannot allocate the system DMA resources that its device
needs, MiniportInitialize should release all resources it already allocated
for its NIC and, then, fail initialization for that NIC. 
<P>
Callers of <B>NdisMRegisterDmaChannel</B>&nbsp;run at IRQL PASSIVE_LEVEL. 
<H3>See Also</H3>
<P>
<B><A HREF="101mini_8.htm">MiniportInitialize</A></B>, <B><A HREF="103ndisx_94.htm">NdisMCompleteDmaTransfer</A></B>,<B>
<A HREF="103ndisx_97.htm">NdisMDeregisterDmaChannel</A></B>,<B>&nbsp;<A HREF="103ndisx_117.htm">NdisMPciAssignResources</A></B>,
<B><A HREF="103ndisx_129.htm">NdisMSetAttributes</A></B>, <B><A HREF="103ndisx_130.htm">NdisMSetAttributesEx</A></B>,
<B><A HREF="103ndisx_134.htm">NdisMSetupDmaTransfer</A></B>, <B><A HREF="103ndisx_149.htm">NdisOpenConfiguration</A></B>,
<B><A HREF="103ndisx_176.htm">NdisReadEisaSlotInformation</A></B>,
<B><A HREF="103ndisx_178.htm">NdisReadMcaPosInformation</A></B>, <B><A HREF="103ndisx_180.htm">NdisReadPciSlotInformation</A></B>
<P></FONT>
</BODY>
</HTML>
