<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>NdisQueryReceiveInformation</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_NdisQueryReceiveInformation_NR"></A>NdisQueryReceiveInformation</H2>
<P>
<B>NDIS_STATUS</B><BR>
&nbsp; &nbsp; <B>NdisQueryReceiveInformation(</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN NDIS_HANDLE</B>&nbsp; <I>NdisBindingHandle</I><B>,</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN NDIS_HANDLE</B>&nbsp; <I>MacContext</I><B>,</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>OUT PLONGLONG</B>&nbsp; <I>TimeSent</I>&nbsp; <B>OPTIONAL,</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>OUT PLONGLONG</B>&nbsp; <I>TimeReceived</I>&nbsp; <B>OPTIONAL,</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PUCHAR</B>&nbsp; <I>Buffer</I><B>,</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN UINT</B>&nbsp; <I>BufferSize</I><B>,</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>OUT PUINT</B>&nbsp; <I>SizeNeeded</I><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>);</B>
<P>
<B>NdisQueryReceiveInformation</B>&nbsp;returns information from the out-of-band
data block associated with a packet descriptor input to the ProtocolReceive
function. 
<H3>Parameters</H3>
<DL>
<DT>
<I>NdisBindingHandle</I>
<DD>
Specifies the handle returned by <B>NdisOpenAdapter</B>&nbsp;that identifies the
target NIC or the virtual adapter of the next-lower driver to which the caller
is bound. 
<BR>
<DT>
<I>MacContext</I>
<DD>
Specifies the <I>MacReceiveContext</I>&nbsp;handle input to the caller’s
ProtocolReceive function. 
<BR>
<DT>
<I>TimeSent</I>
<DD>
Points to a caller-supplied variable in which this function returns the <B>TimeSent</B>
timestamp, if any, for the received packet. This parameter can be NULL. 
<BR>
<DT>
<I>TimeReceived</I>
<DD>
Points to a caller-supplied variable in which this function returns the <B>TimeReceived</B>
timestamp, if any, for the received packet. This parameter can be NULL. 
<BR>
<DT>
<I>Buffer</I>
<DD>
Points to a caller-supplied buffer in which this function returns a copy of
any medium-specific out-of-band information, such as packet priority,
associated with the received packet. 
<BR>
<DT>
<I>BufferSize</I>
<DD>
Specifies the size in bytes of the supplied buffer. 
<BR>
<DT>
<I>SizeNeeded</I>
<DD>
Points to a caller-supplied variable in which this function returns how large
a buffer should be supplied if the given <I>BufferSize</I>&nbsp;is too small. 
</DL>
<H3>Return Value</H3>
<P>
<B>NdisQueryReceiveInformation</B>&nbsp;can return one of the following values:
<DL>
<DT>
NDIS_STATUS_SUCCESS
<DD>
The caller can use the medium-specific information returned at <I>Buffer</I>
and/or the value(s) returned at <I>TimeSent</I>&nbsp;and <I>TimeReceived</I>. 
<BR>
<DT>
NDIS_STATUS_BUFFER_TOO_SHORT
<DD>
The amount of medium-specific information was too large to fit at <I>Buffer</I>
according to the given <I>BufferSize</I>. <I>SizeNeeded</I>&nbsp;is set to the
number of bytes of medium-specific information available for the indication. 
<BR>
<DT>
NDIS_STATUS_NOT_SUPPORTED
<DD>
The underlying driver does not indicate receives with <B>NdisMIndicateReceivePacket</B>
and, therefore, there is no out-of-band information available with the given
packet descriptor. 
</DL>
<H3>Comments</H3>
<P>
The ProtocolReceive functions of protocol drivers that do not supply a
ProtocolReceivePacket function can call <B>NdisQueryReceiveInformation</B>
when such a driver is bound to an underlying driver that supplies
medium-specific information, such as packet priority, and timestamps when it
indicates receives. 
<P>
Whenever the underlying driver calls <B>NdisMIndicateReceivePacket</B>&nbsp;with a
packet descriptor for which the <B>Status</B>&nbsp;member in the associated
NDIS_PACKET_OOB_DATA block is set to NDIS_STATUS_RESOURCES, the
ProtocolReceive functions of bound protocols are called once with each packet
descriptor, rather than their ProtocolReceivePacket functions. The
ProtocolReceive function of such a driver can call <B>NdisQueryReceiveInformation</B>
to retrieve a copy of any medium-specific information and optionally the <B>TimeSent</B>
and <B>TimeReceived</B>&nbsp;values if either or both of these timestamps were
supplied by the indicating driver. 
<P>
The <I>MacContext</I>&nbsp;handle passed to <B>NdisQueryReceiveInformation</B>&nbsp;is
opaque to the caller of <B>NdisQueryReceiveInformation</B>&nbsp;and reserved for
use by the underlying driver. 
<P>
Callers of <B>NdisQueryReceiveInformation</B>&nbsp;run at IRQL &lt;=
DISPATCH_LEVEL. 
<H3>See Also</H3>
<P>
<B><A HREF="103ndisx_107.htm">NdisMIndicateReceivePacket</A></B>,
<B><A HREF="106nstru_5.htm">NDIS_PACKET_OOB_DATA</A></B>, <B><A HREF="104tdlow_5.htm">ProtocolReceive</A></B>,
<B><A HREF="104tdlow_7.htm">ProtocolReceivePacket</A></B>&nbsp;
<P></FONT>
</BODY>
</HTML>
