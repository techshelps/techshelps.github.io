<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>MiniportReturnPacket</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_MiniportReturnPacket_NR"></A>MiniportReturnPacket</H2>
<P>
<B>VOID</B><BR>
&nbsp; &nbsp; <B>MiniportReturnPacket(</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN NDIS_HANDLE</B>&nbsp; <I>MiniportAdapterContext</I><B>,</B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PNDIS_PACKET</B>&nbsp; <I>Packet</I><BR>
&nbsp; &nbsp; &nbsp; &nbsp; <B>);</B>&nbsp;
<P>
MiniportReturnPacket is a required function in drivers that indicate receives
with <B>NdisMIndicateReceivePacket</B>. 
<H3>Parameters</H3>
<DL>
<DT>
<I>MiniportAdapterContext</I>
<DD>
Specifies the handle to a miniport-allocated context area in which the driver
maintains per-NIC state, set up by MiniportInitialize. 
<BR>
<DT>
<I>Packet</I>
<DD>
Points to a packet descriptor being returned to the miniport, which previously
indicated a packet array that contained this pointer. 
</DL>
<H3>Comments</H3>
<P>
Drivers of busmaster DMA NICs that support multipacket receives and NIC
drivers that supply media-specific information, such as packet priorities,
with their indications must have MiniportReturnPacket functions. NDIS
intermediate drivers that bind themselves to such a NIC driver also must have
MiniportReturnPacket functions. 
<P>
Any packet with associated NDIS_PACKET_OOB_DATA in which the <B>Status</B>&nbsp;is
set to NDIS_STATUS_PENDING on return from <B>NdisMIndicateReceivePacket</B>
will be returned to MiniportReturnPacket. When all bound protocols have called
<B>NdisReturnPackets</B>&nbsp;as many times as necessary to release their
references to the originally indicated packet array, NDIS returns pended
packets from the array to the MiniportReturnPacket function of the driver that
originally allocated the packet array. 
<P>
Usually, MiniportReturnPacket prepares such a returned packet to be used in a
subsequent receive indication. Although MiniportReturnPacket could return the
buffer descriptors chained to the packet to buffer pool and the packet
descriptor itself to packet pool, it is far more efficient to reuse returned
descriptors. 
<P>
MiniportReturnPacket must call <B>NdisUnchainBufferAt</B><I>Xxx</I>&nbsp;as many
times as necessary to save the pointers to all chained buffer descriptors
before it calls <B>NdisReinitializePacket</B>. Otherwise, MiniportReturnPacket
cannot recover the buffer descriptors the driver originally chained to the
packet for the indication. 
<P>
MiniportReturnPacket also can call <B>NdisZeroMemory</B>&nbsp;with the pointer
returned by NDIS_OOB_DATA_FROM_PACKET to prepare the packet’s associated
out-of-band block for reuse.
<P>
If a particular buffer descriptor was shortened to match the size of an
indicated range of data, MiniportReturnPacket should call <B>NdisAdjustBufferLength</B>
with that buffer descriptor to restore its mapping of the NIC’s receive buffer
range. 
<P>
By default, MiniportReturnPacket runs at IRQL DISPATCH_LEVEL. 
<H3>See Also</H3>
<P>
<B><A HREF="103ndisx_7.htm">NdisAdjustBufferLength</A></B>, <B><A HREF="103ndisx_8.htm">NdisAllocateBuffer</A></B>,
<B><A HREF="103ndisx_11.htm">NdisAllocatePacket</A></B>, <B><A HREF="103ndisx_107.htm">NdisMIndicateReceivePacket</A></B>,
<B><A HREF="103ndisx_147.htm">NDIS_OOB_DATA_FROM_PACKET</A></B>, <B><A HREF="106nstru_4.htm">NDIS_PACKET</A></B>,
<B><A HREF="106nstru_5.htm">NDIS_PACKET_OOB_DATA</A></B>, <B><A HREF="103ndisx_186.htm">NdisReinitializePacket</A></B>,
<B><A HREF="103ndisx_192.htm">NdisReturnPackets</A></B>, <B><A HREF="103ndisx_211.htm">NdisUnchainBufferAtBack</A></B>,
<B><A HREF="103ndisx_212.htm">NdisUnchainBufferAtFront</A></B>, <B><A HREF="103ndisx_223.htm">NdisZeroMemory</A></B>
<P></FONT>
</BODY>
</HTML>
