<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>ClientEventReceiveExpedited</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_ClientEventReceiveExpedited_NR"></A>ClientEventReceiveExpedited</H2>
<P>
<B>TDI_STATUS <BR>
&nbsp; &nbsp; ClientEventReceiveExpedited (<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PVOID</B>&nbsp; <I>TdiEventContext</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN CONNECTION_CONTEXT</B>&nbsp; <I>ConnectionContext</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN ULONG</B>&nbsp; <I>ReceiveFlags</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN ULONG</B>&nbsp; <I>BytesIndicated</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN ULONG</B>&nbsp; <I>BytesAvailable</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>OUT ULONG</B>&nbsp; <B>*</B><I>BytesTaken</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PVOID</B>&nbsp; <I>Tsdu</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>OUT PIRP</B>&nbsp; <B>*</B><I>IoRequestPacket<BR>
</I>&nbsp; &nbsp; &nbsp; &nbsp; <B>);</B>
<P>
ClientEventReceiveExpedited is an event handler that the underlying TDI
transport calls in response to an incoming expedited receive from a remote
node with which the client has an established endpoint-to-endpoint connection.
<H3>Parameters</H3>
<DL>
<DT>
<I>TdiEventContext</I>
<DD>
Points to the client-supplied context provided in the IRP that was set up with
<B>TdiBuildSetEventHandler</B>&nbsp;when ClientEventReceiveExpedited was registered
with the underlying transport.
<BR>
<DT>
<I>ConnectionContext</I>
<DD>
Points to the client&#39;s context area for this connection endpoint. The
client previously supplied this value to its underlying transport when its
ClientEventConnect handler accepted a connection offer from the remote-node
peer and/or when it opened the connection endpoint with <B>ZwCreateFile</B>. 
<BR>
<DT>
<I>ReceiveFlags</I>
<DD>
Specifies the nature of the receive indication as a combination (ORed) of the
following flags:
<DL>
<DT>
TDI_RECEIVE_EXPEDITED
<DD>
The buffer mapped at <I>Tsdu</I>&nbsp;contains expedited data received from the
client&#39;s remote-node peer. This flag is always set when
ClientEventReceiveExpedited is called.  
<BR>
<DT>
TDI_RECEIVE_ENTIRE_MESSAGE
<DD>
The buffer mapped at <I>Tsdu</I>&nbsp;contains a full TSDU.
ClientEventReceiveExpedited should return control as quickly as possible after
copying the indicated data into an internal buffer if it accepts the TSDU. 
<P>
If this flag is clear (or TDI_RECEIVE_PARTIAL is set by a legacy transport),
ClientEventReceiveExpedited must check the <I>BytesIndicated</I>&nbsp;and <I>BytesAvailable</I>
parameters to determine how much of the TSDU has been provided. Although
legacy transports continue to set the TDI_RECEIVE_PARTIAL flag, newer
transports leave clear the TDI_RECEIVE_ENTIRE_MESSAGE flag to indicate partial
TSDUs to their clients. 
<BR>
<DT>
TDI_RECEIVE_COPY_LOOKAHEAD
<DD>
Unless TDI_RECEIVE_ENTIRE_MESSAGE is set, <I>BytesIndicated</I>&nbsp;is something
less than <I>BytesAvailable</I>, and ClientEventReceiveExpedited should copy
the number of indicated bytes into an internal buffer, set the variable at <I>BytesTaken</I>,
and return control. The client will subsequently submit one or more
TDI_RECEIVE requests to get the remainder of the TSDU or
ClientEventReceiveExpedited will be called again to copy the remainder of the
TSDU. 
<BR>
<DT>
TDI_RECEIVE_FRAGMENT
<DD>
The buffer mapped at <I>Tsdu</I>&nbsp;contains a fragmented TSDU. 
<BR>
<DT>
TDI_RECEIVE_PEEK
<DD>
The transport has buffered some receive data internally, but not yet the full
TSDU. The client can examine the buffer mapped at <I>Tsdu</I>&nbsp;to decide
whether to submit a TDI_RECEIVE request for the TSDU. 
<BR>
<DT>
TDI_RECEIVE_AT_DISPATCH_LEVEL
<DD>
The receive is being indicated at IRQL DISPATCH_LEVEL. This flag restricts the
set of support routines that the client can call in processing this
indication. Some transports never set this flag, whatever the current IRQL,
when making receive-event notifications.  
</DL>
<DT>
<I>BytesIndicated</I>
<DD>
Specifies the number of bytes of expedited data in the buffer mapped at <I>Tsdu</I>.
This parameter is always less than or equal to the value of <I>BytesAvailable</I>.
A TDI transport provides at least 128 bytes of data in a receive indication to
its client, unless the received message or stream segment is less than 128
bytes in length. If <I>BytesAvailable</I>&nbsp;is greater than <I>BytesIndicated</I>,
the transport has received data that it does not make available when it calls
ClientEventReceiveExpedited.
<BR>
<DT>
<I>BytesAvailable</I>
<DD>
Specifies the total number of bytes in the received TSDU. 
<BR>
<DT>
<I>BytesTaken</I>
<DD>
Points to a caller-supplied variable in which ClientEventReceiveExpedited
returns the number of bytes of data it copies from the TSDU.
<BR>
<DT>
<I>Tsdu</I>
<DD>
Points to an MDL, possibly the initial MDL in a chain, mapping the buffer
containing the received TSDU data.
<BR>
<DT>
<I>IoRequestPacket</I>
<DD>
Points to a variable in which ClientEventReceiveExpedited returns a pointer to
an IRP that was set up with <B>TdiBuildReceive</B>. If this parameter is NULL,
the client will not be making a receive request for the remainder of the TSDU.
</DL>
<H3>Return Value</H3>
<P>
ClientEventReceiveExpedited can return one of the following:
<DL>
<DT>
STATUS_SUCCESS
<DD>
Indicates the client copied all the data in the given TSDU.
<BR>
<DT>
STATUS_MORE_PROCESSING_REQUIRED
<DD>
Indicates the client has supplied an IRP requesting the remainder of the TSDU,
after copying <I>BytesIndicated</I>&nbsp;into an internal buffer. 
<BR>
<DT>
STATUS_DATA_NOT_ACCEPTED
<DD>
Indicates this client is not interested in the TSDU. 
</DL>
<H3>Comments</H3>
<P>
ClientEventReceiveExpedited accepts or rejects an expedited TSDU that the TDI
driver has received on an established endpoint-to-endpoint connection. This
handler is almost identical to ClientEventReceive, except that expedited data
flow supersedes normal data flow. 
<P>
Consequently, the underlying transport can call ClientEventReceiveExpedited on
a connection while a normal receive operation or an indication to
ClientEventReceive (or ClientEventChainedReceive) is in progress. If this
occurs, normal data flow does not resume until ClientEventReceiveExpedited has
returned and the client has received all the expedited data for the TSDU. If
ClientEventReceiveExpedited provides a TDI_RECEIVE request at <I>IoRequestPacket</I>,
this request also has priority over any client-issued request for nonexpedited
data.
<P>
When ClientEventReceiveExpedited is called, it can do one of the following:
<UL>
<LI>
Reject the indicated TSDU if it has no use for the data by returning
STATUS_DATA_NOT_ACCEPTED
<P>
<LI>
Copy all of the data into an internal buffer if TDI_RECEIVE_ENTIRE_MESSAGE is
set in the <I>ReceiveFlags</I>&nbsp;and return STATUS_SUCCESS
<P>
<LI>
If TDI_RECEIVE_ENTIRE_MESSAGE is clear (or TDI_RECEIVE_PARTIAL is set), copy
some or all of the indicated data and return either of the following,
depending on which operation it carries out:
<P>
STATUS_MORE_PROCESSING_REQUIRED if the client is supplying a TDI_RECEIVE
request at <I>IoRequestPacket</I>&nbsp;to obtain the remaining TSDU data 
<P>
STATUS_SUCCESS if the transport is expected to call
ClientEventReceiveExpedited again with the remaining TSDU data 
</UL>
<P>
When it has finished copying receive data, ClientEventReceiveExpedited sets
the variable at <I>BytesTaken</I>&nbsp;to the number of bytes of data accepted
before it returns control.
<P>
By default, ClientEventReceiveExpedited runs at IRQL DISPATCH_LEVEL. 
<H3>See Also</H3>
<P>
<B><A HREF="25tdicli_4.htm">ClientEventChainedReceiveExpedited</A></B>,
<B><A HREF="25tdicli_7.htm">ClientEventReceive</A></B>, <B><A HREF="24bldmac_7.htm">TdiBuildInternalDeviceControlIrp</A></B>,
<B><A HREF="24bldmac_12.htm">TdiBuildReceive</A></B>, <B><A HREF="24bldmac_16.htm">TdiBuildSetEventHandler</A></B>
<P></FONT>
</BODY>
</HTML>
