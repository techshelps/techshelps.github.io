<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>TdiBuildConnect</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_TdiBuildConnect_NR"></A>TdiBuildConnect</H2>
<P>
<B>VOID <BR>
&nbsp; &nbsp; TdiBuildConnect (<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PIRP</B>&nbsp; <I>Irp</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PDEVICE_OBJECT</B>&nbsp; <I>DevObj</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PFILE_OBJECT</B>&nbsp; <I>FileObj</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PVOID</B>&nbsp; <I>CompRoutine</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PVOID</B>&nbsp; <I>Contxt</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PLARGE_INTEGER</B>&nbsp; <I>Time</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PTDI_CONNECTION_INFORMATION</B>&nbsp; <I>RequestConnectionInfo</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>OUT PTDI_CONNECTION_INFORMATION</B>&nbsp; <I>ReturnConnectionInfo<BR>
</I>&nbsp; &nbsp; &nbsp; &nbsp; <B>);</B>
<P>
<B>TdiBuildConnect</B>&nbsp;sets up an internal device control IRP for a
TDI_CONNECT request to the underlying transport in which a local-node client
has already associated an address and a connection endpoint. 
<H3>Parameters</H3>
<DL>
<DT>
<I>Irp</I>
<DD>
Points to a client-supplied IRP, either originating in a higher level network
component or allocated with <B>TdiBuildInternalDeviceControlIrp</B>. 
<BR>
<DT>
<I>DevObj</I>
<DD>
Points to the device object created by the next lower TDI transport driver.
<BR>
<DT>
<I>FileObj</I>
<DD>
Points to a file object representing the connection endpoint.
<BR>
<DT>
<I>CompRoutine</I>
<DD>
Specifies the entry point of a client-supplied IoCompletion routine or NULL.
The I/O Manager calls this routine when the given IRP is completed, unless the
client sets this parameter to NULL. 
<BR>
<DT>
<I>Contxt</I>
<DD>
Points to a client-determined context. This client-supplied pointer is passed
in to the IoCompletion routine when it is called with the completed IRP. <I>Contxt</I>
should be NULL if <I>CompRoutine</I>&nbsp;is NULL.
<BR>
<DT>
<I>Time</I>
<DD>
Points to a variable specifying a system-relative time-out interval that the
transport is to use for the connection attempt, or this parameter can be NULL.
<P>
An explicit time-out must be specified as the negative of the number of
100-nanosecond intervals, relative to the current system time, that its
connection attempt is allowed to remain pending before the transport fails
this connect request. If this pointer is NULL, the transport uses its own
default time-out interval for establishing a connection with any remote node. 
<BR>
<DT>
<I>RequestConnectionInfo</I>
<DD>
Points to a caller-supplied buffer containing a TDI_CONNECTION_INFORMATION
structure that specifies the remote-node client address to which the
local-node client is requesting an endpoint-to-endpoint connection.
<BR>
<DT>
<I>ReturnConnectionInfo</I>
<DD>
Points to a caller<FONT FACE="Symbol">&#45;</FONT>supplied buffer in which the
transport returns the remote-node client address with which it has established
a connection. This buffer is also formatted as TDI_CONNECTION_INFORMATION
structure. If a local-node client requires no output information or if the
underlying transport does not return such information, this parameter should
be NULL.
</DL>
<H3>Comments</H3>
<P>
<B>TdiBuildConnect </B>sets IRP_MJ_INTERNAL_DEVICE_CONTROL as the <B>MajorFunction</B>
and TDI_CONNECT as the <B>MinorFunction</B>&nbsp;codes in the transport&#39;s I/O
stack location of the given IRP.
<P>
If the specified endpoint is inactive or nonexistent, the transport fails the
connect request. If the specified endpoint has not been associated with a
local-node address, the transport also fails the connect request. 
<P>
For a local-node client to establish an endpoint-to-endpoint connection with a
remote-node peer process, it must first associate an idle local connection
endpoint with a local-node address. A client cannot initiate a connection
attempt to a remote-node peer until it has made a successful
TDI_ASSOCIATE_ADDRESS request, which it set up with <B>TdiBuildAsociateAddress</B>,
to its underlying transport. 
<P>
For a local-node client&#39;s connect request to succeed, the remote-node
client must have an open listen request or a registered ClientEventConnect
routine that can receive notification from its underlying transport of
connection offers.
<H3>See Also</H3>
<P>
<B><A HREF="25tdicli_1.htm">ClientEventConnect</A></B>, <B><A HREF="24bldmac_3.htm">TdiBuildAssociateAddress</A></B>,
<B><A HREF="24bldmac_7.htm">TdiBuildInternalDeviceControlIrp</A></B>,
<B><A HREF="24bldmac_8.htm">TdiBuildListen</A></B>, <B><A HREF="24bldmac_16.htm">TdiBuildSetEventHandler</A></B>,
<B><A HREF="22ioctl_4.htm">TDI_CONNECT</A></B>, <B><A HREF="26tdstrc_21.htm">TDI_CONNECTION_INFORMATION</A></B>
<P></FONT>
</BODY>
</HTML>
