<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>TDI_CONNECT</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_TDI_CONNECT_NR"></A>TDI_CONNECT</H2>
<P>
When a kernel-mode client makes a TDI_CONNECT request, it asks the underlying
TDI transport driver to offer a connection on a particular local-node
connection endpoint to a remote-node peer.
<H3>IRP</H3>
<P>
The transport calls <B>IoGetCurrentIrpStackLocation</B>&nbsp;with the given <I>Irp</I>
to get a pointer to its own I/O stack location in the IRP, shown in the
following list as <B>IrpSp</B>. IRP members relevant to this request include
the following:
<DL>
<DT>
<B>IoStatus.Status</B>
<DD>
Specifies the final status of the connection request. The transport sets this
member before it completes the IRP, possibly to one of the following:
<P>
STATUS_SUCCESS<BR>
STATUS_PENDING<BR>
STATUS_BAD_NETWORK_PATH<BR>
STATUS_INVALID_CONNECTION<BR>
STATUS_REMOTE_NOT_LISTENING<BR>
STATUS_INSUFFICIENT_RESOURCES<BR>
STATUS_REQUEST_TIMED_OUT
<BR>
<DT>
<B>IrpSp-&gt;MajorFunction</B>
<DD>
Specifies IRP_MJ_INTERNAL_DEVICE_CONTROL. The transport can ignore this member
if it exports a TdiDispatchInternalDeviceControl routine that handles only
TDI_<I>XXX</I>&nbsp;requests. 
<BR>
<DT>
<B>IrpSp-&gt;MinorFunction</B>
<DD>
Specifies TDI_CONNECT.
<BR>
<DT>
<B>IrpSp-&gt;FileObject</B>
<DD>
Points to an open file object representing the connection endpoint already
associated with a local-node address. The transport uses the <B>FsContext</B>
and, possibly, <B>FsContext2</B>&nbsp;fields to access the state it maintains about
this connection. 
<BR>
<DT>
<B>IrpSp-&gt;Parameters</B>
<DD>
Points to a TDI_REQUEST_KERNEL_CONNECT structure, equivalent to the
TDI_REQUEST_KERNEL structure. 
<P>
The <B>RequestFlags</B>&nbsp;member is irrelevant for connect requests. The
transport uses the client-supplied information, such as the remote-node
address to which the connection should be offered, in the buffer at <B>RequestConnectionInformation</B>.
The transport returns information to the client-supplied buffer at <B>ReturnConnectionInformation</B>.
Each of these buffers is formatted as a TDI_CONNECTION_INFORMATION structure. 
<BR>
<DT>
<B>IrpSp-&gt;Parameters.RequestSpecific</B>
<DD>
Points to a LARGE_INTEGER variable specifying the time-out value for the
connection offer or is NULL. An explicit time out is specified as the negative
of the number of 100-nanosecond units, relative to the current system time,
for the time-out interval. If this member is NULL, the transport must choose
an appropriate time-out interval, usually something less than one second.
</DL>
<H3>Comments</H3>
<P>
For a local-node client to establish an endpoint-to-endpoint connection with a
remote-node peer, it must associate an idle local connection endpoint with an
open transport address before making a TDI_CONNECT request. If the specified
local endpoint is active or nonexistent, the transport fails the connect
request. 
<P>
For a TDI_CONNECT request to succeed, the remote-node client must have an open
TDI_LISTEN request or have registered its ClientEventConnect handler to
receive connection offers indicated by the underlying transport on the remote
node.
<P>
<B>TdiBuildConnect</B>&nbsp;is the macro a client uses to fill in the IRP.
<H3>See Also</H3>
<P>
<B><A HREF="25tdicli_1.htm">ClientEventConnect</A></B>, <B><A HREF="24bldmac_4.htm">TdiBuildConnect</A></B>,
<B><A HREF="26tdstrc_21.htm">TDI_CONNECTION_INFORMATION</A></B>,
<B><A HREF="21tddisp_6.htm">TdiDispatchInternalDeviceControl</A></B>,
<B><A HREF="22ioctl_7.htm">TDI_LISTEN</A></B>, <B><A HREF="26tdstrc_27.htm">TDI_REQUEST_KERNEL</A></B>
<P></FONT>
</BODY>
</HTML>
