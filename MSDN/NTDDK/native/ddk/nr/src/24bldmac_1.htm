<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>TdiBuildAccept</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_TdiBuildAccept_NR"></A>TdiBuildAccept</H2>
<P>
<B>VOID <BR>
&nbsp; &nbsp; TdiBuildAccept (<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PIRP</B>&nbsp; <I>Irp</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PDEVICE_OBJECT</B>&nbsp; <I>DevObj</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PFILE_OBJECT</B>&nbsp; <I>FileObj</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PVOID</B>&nbsp; <I>CompRoutine</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PVOID</B>&nbsp; <I>Contxt</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>IN PTDI_CONNECTION_INFORMATION</B>&nbsp; <I>RequestConnectionInfo</I><B>,<BR>
</B>&nbsp; &nbsp; &nbsp; &nbsp; <B>OUT PTDI_CONNECTION_INFORMATION</B>&nbsp; <I>ReturnConnectionInfo<BR>
</I>&nbsp; &nbsp; &nbsp; &nbsp; <B>);</B>
<P>
<B>TdiBuildAccept</B>&nbsp;sets up an internal device control IRP for a TDI_ACCEPT
request to the underlying transport in which a local-node client has already
opened a connection endpoint and associated it with a local-node address and
to which the client has already issued a TDI_LISTEN request. 
<H3>Parameters</H3>
<DL>
<DT>
<I>Irp</I>
<DD>
Points to a client-supplied IRP, either originating in a higher level network
component or allocated with <B>TdiBuildInternalDeviceControlIrp</B>. 
<BR>
<DT>
<I>DevObj</I>
<DD>
Points to the device object created by the next lower TDI transport driver.
<BR>
<DT>
<I>FileObj</I>
<DD>
Points to a file object representing a connection endpoint. The client
previously made a successful request, set up with <B>TdiBuildAssociateAddress</B>,
to the transport to set up an association between this connection and a
local-node address. When the association was established, the client also
issued a listen request, set up with <B>TdiBuildListen</B>, to the transport. 
<BR>
<DT>
<I>CompRoutine</I>
<DD>
Specifies the entry point of a client-supplied IoCompletion routine or NULL.
The I/O Manager calls this routine when the given IRP is completed, unless the
client sets this parameter to NULL. 
<BR>
<DT>
<I>Contxt</I>
<DD>
Points to a client-determined context. This client-supplied pointer is passed
in to the IoCompletion routine when it is called with the completed IRP. <I>Contxt</I>
should be NULL if <I>CompRoutine</I>&nbsp;is NULL.
<BR>
<DT>
<I>RequestConnectionInfo</I>
<DD>
Points to a caller-supplied buffer containing a TDI_CONNECTION_INFORMATION
structure, set up to specify a valid remote-node client address from which the
caller, a local-node client, can accept a connection. The local-node client
also can provide buffered accept data, specified at <B>UserData</B>&nbsp;in this
structure, that the underlying transport should send to the remote node when
it transmits acceptance of the offered connection (see <B>TdiBuildListen</B>
for details). 
<BR>
<DT>
<I>ReturnConnectionInfo</I>
<DD>
Points to a caller<FONT FACE="Symbol">&#45;</FONT>supplied buffer in which the
transport returns the remote-node client&#39;s address with which it has
established an endpoint-to-endpoint connection for the local-node client. This
buffer is also formatted as a  TDI_CONNECTION_INFORMATION structure. If the
underlying transport does not provide this information, this parameter should
be NULL. 
</DL>
<H3>Comments</H3>
<P>
<B>TdiBuildAccept </B>sets IRP_MJ_INTERNAL_DEVICE_CONTROL as the <B>MajorFunction</B>
and TDI_ACCEPT as the <B>MinorFunction</B>&nbsp;codes in the transport&#39;s I/O
stack location of the given IRP.
<P>
When a kernel-mode client issues a TDI_ACCEPT request, it asks the underlying
transport to accept an incoming request to connect from a remote-node client
and, thereby, to enable network data reception on an established
endpoint-to-endpoint connection. 
<P>
Usually, a client sends an accept request in response to a return from its
preceding listen request, set up with <B>TdiBuildListen</B>&nbsp;with the
TDI_QUERY_ACCEPT option selected. If a client did not set this value in the <I>Flags</I>
for its listen request, its accept request fails because the underlying
transport has already established an endpoint-to-endpoint connection when the
listen request completes.
<P>
Most TDI transports have a time-out feature that prevents attempts to
establish endpoint-to-endpoint connections from hanging when a remote node
does not respond. Therefore, a client must either accept or reject a
connection as soon as possible after completion of its listen request. The
interval between client notification of a remote-node peer connection offer
and that local client&#39;s connection acceptance or rejection is subject to a
transport-determined time-out limit, usually something less than one second.
<P>
A client indicates its acceptances of a connection to the remote-node peer by
submitting a request set up by <B>TdiBuildAccept</B>&nbsp;to the underlying
transport. It indicates its rejection of a connection offer by submitting an
IRP set up with <B>TdiBuildDisconnect</B>. 
<P>
The local client&#39;s registered ClientEvent(Chained)Receive(Expedited)
handler(s) can be called before the I/O Manager formally completes its
processing of the accept IRP. That is, the remote-node peer can start sending
data to the local client as soon as the remote node receives an acceptance of
the offered connection. 
<H3>See Also</H3>
<P>
<B><A HREF="25tdicli_2.htm">ClientEventChainedReceive</A></B>, <B><A HREF="25tdicli_4.htm">ClientEventChainedReceiveExpedited</A></B>,
<B><A HREF="25tdicli_1.htm">ClientEventConnect</A></B>, <B><A HREF="25tdicli_7.htm">ClientEventReceive</A></B>,
<B><A HREF="25tdicli_9.htm">ClientEventReceiveExpedited</A></B>,
<B><A HREF="22ioctl_1.htm">TDI_ACCEPT</A></B>, <B><A HREF="24bldmac_6.htm">TdiBuildDisconnect</A></B>,
<B><A HREF="24bldmac_7.htm">TdiBuildInternalDeviceControlIrp</A></B>,
<B><A HREF="24bldmac_8.htm">TdiBuildListen</A></B>, <B><A HREF="26tdstrc_21.htm">TDI_CONNECTION_INFORMATION</A></B>
<P></FONT>
</BODY>
</HTML>
