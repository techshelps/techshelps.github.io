<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Guidelines for Writing ACM Drivers</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H3><A NAME="DDK_Guidelines_for_Writing_ACM_Drivers"></A>Guidelines for Writing ACM Drivers</H3>
<P>
Use the following guidelines when writing an ACM driver:
<UL>
<LI>
Allocate driver instance data when the driver receives a DRV_OPEN message, as
explained in the description of <A HREF="intro_34.htm">DRV_OPEN</A>.
<P>
<LI>
Allocate stream instance data when the driver receives an ACMDM_STREAM_OPEN
message, as explained in the description of <A HREF="acm_drv_34.htm">ACMDM_STREAM_OPEN</A>.
<P>
<LI>
Do not use global variables. Defining a single DWORD of global data in a DLL
allocates 4K of memory in every process that uses the ACM, because your driver
is mapped into the address space of each process, and global data space is not
shared. Instead of using global data, dynamically allocate local storage space
for each driver instance and each stream instance, as needed.
<P>
<LI>
Do not link to <I>crtdll.dll</I>, the dynamic-link version of the C runtime
library. This DLL cannot be loaded into all contexts. As a result, your driver
will not work correctly for system sounds that are played by means of the <B>MessageBeep
</B>function. Use Win32 API functions instead of C library functions, or link
to a static C runtime library (<I>libc.lib</I>&nbsp;or <I>libcmt.lib</I>).
<P>
<LI>
Be careful when calling Win32 functions. If your driver is used in conjunction
with playing system sounds, it might get loaded into a context in which these
functions fail. This warning pertains to any Win32 function that requires an
instance handle, and possibly other functions. Notice, for example, that if
the samples call <B>LoadString</B>&nbsp;or <B>LoadIcon</B>, they do not test for
error return values. If you strictly follow the model provided by the sample
drivers, you will not have this problem.
</UL>
<P></FONT>
</BODY>
</HTML>
