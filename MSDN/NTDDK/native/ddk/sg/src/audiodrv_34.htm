<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Using Exclusion Routines</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H4><A NAME="DDK_Using_Exclusion_Routines"></A>Using Exclusion Routines</H4>
<P>
Drivers using <I>soundlib.lib</I>&nbsp;must define an exclusion routine that
accepts input messages. The exclusion routine is called under the following
circumstances:
<UL>
<LI>
When a device is opened for writing.
<P>
The exclusion routine receives a <B>SoundExcludeOpen</B>&nbsp;message.
<P>
<LI>
When a device, previously opened for writing, is closed.
<P>
The exclusion routine receives a <B>SoundExcludeClose</B>&nbsp;message.
<P>
<LI>
When a request is directed to a device opened for writing.
<P>
The exclusion routine receives a <B>SoundExcludeEnter</B>&nbsp;message.
<P>
<LI>
When a request to a device opened for writing is complete.
<P>
The exclusion routine receives a <B>SoundExcludeLeave</B>&nbsp;message.
<P>
<LI>
When the caller wants to confirm that the drive is open.
<P>
The exclusion routine receives a <B>SoundExcludeQueryOpen</B>&nbsp;message.
</UL>
<P>
The exclusion routine is specified as the <B>ExclusionRoutine</B>&nbsp;member of a<A HREF="audiodrv_218.htm">
SOUND_DEVICE_INIT</A>&nbsp;structure. Exclusion messages are defined in <I>devices.h.</I>
In <I>sndblst.sys</I>, the exclusion routine is called <B>SoundExcludeRoutine</B>
and is contained in the file <I>\src\mmedia\sndblst\driver\init.c</I>. The
function’s purpose is to implement mutual exclusion during write operations.
For <I>sndblst.sys</I>, <B>SoundExcludeRoutine</B>&nbsp;does this by calling <B><A HREF="../../kr/src/k105_56.htm">KeWaitForSingleObject</A></B>
when it receives the <B>SoundExcludeEnter</B>&nbsp;message and <B><A HREF="../../kr/src/k105_38.htm">KeReleaseMutex</A></B>
when it receives <B>SoundExcludeLeave</B>.
<P>
For information on mutexes, see the <I>Kernel-Mode Drivers</I>&nbsp;<I>Design Guide</I>.
<P></FONT>
</BODY>
</HTML>
