<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>SoundGetCommonBuffer</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_SoundGetCommonBuffer"></A>SoundGetCommonBuffer</H2>
<P>
<B>NTSTATUS<BR>
&nbsp; &nbsp; SoundGetCommonBuffer(<BR>
&nbsp; &nbsp; &nbsp; &nbsp; IN PDEVICE_DESCRIPTION </B><I>DeviceDescription</I><B>,<BR>
&nbsp; &nbsp; &nbsp; &nbsp; IN OUT PSOUND_DMA_BUFFER </B><I>SoundAutoData</I><B><BR>
&nbsp; &nbsp; &nbsp; &nbsp; );</B>
<P>
The <B>SoundGetCommonBuffer</B>&nbsp;function allocates a buffer for use by
waveform devices during auto-initialize DMA transfers, and maps the buffer so
it is accessible to both the processor and the device.
<H5>Parameters</H5>
<DL>
<DT>
<I>DeviceDescription</I>
<DD>
Pointer to an initialized DEVICE_DESCRIPTION structure. (For a description of
this structure, see <B><A HREF="../../kr/src/k103_5.htm">HalGetAdapter</A></B>.)
<BR>
<DT>
<I>SoundAutoData</I>
<DD>
Pointer to a <A HREF="audiodrv_220.htm">SOUND_DMA_BUFFER</A>&nbsp;structure.
Generally this is the address of the <B>DMABuf</B>&nbsp;member of a <A HREF="audiodrv_228.htm">WAVE_INFO</A>
structure.
</DL>
<H5>Return Value</H5>
<P>
Returns one of the following values.
<TABLE>
<TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>Value</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>Definition</B>
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
STATUS_SUCCESS
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Operation succeeded.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
STATUS_DEVICE_CONFIGURATION_ERROR
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Couldn’t find adapter.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
STATUS_INSUFFICIENT_RESOURCES
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
Not enough memory to allocate buffer.
</FONT></TABLE>
<H5>Comments</H5>
<P>
The returned buffer is described by the contents of the <A HREF="audiodrv_220.htm">SOUND_DMA_BUFFER</A>
structure.
<P>
<B>SoundGetCommonBuffer</B>&nbsp;calls <B><A HREF="../../kr/src/k103_5.htm">HalGetAdapter</A></B>
to obtain an adapter object and <B><A HREF="../../kr/src/k103_1.htm">HalAllocateCommonBuffer</A></B>
to get a buffer. If a buffer of the requested size is not available, a smaller
one is returned. The smallest buffer that can be requested is 4 kilobytes.
<P>
After the buffer has been allocated, the function calls <B><A HREF="../../kr/src/k104_6.htm">IoAllocateMdl</A></B>
and <B><A HREF="../../kr/src/k106_10.htm">MmBuildMdlForNonPagedPool</A>&nbsp;</B>to
build a memory descriptor list (MDL). A MDL is needed by <I>soundlib.lib</I>
for calls to <B><A HREF="../../kr/src/k104_55.htm">IoMapTransfer</A></B>.
<P>
If the requested buffer size is large, <I>soundlib.lib</I>&nbsp;might not use the
entire buffer. To find out how much of the buffer is actually used, call <B><A HREF="audiodrv_178.htm">SoundGetDMABufferSize</A></B>.
<P>
Prior to being unloaded, the driver must free the allocated buffer space by
calling <B><A HREF="audiodrv_172.htm">SoundFreeCommonBuffer</A></B>.
<P>
Drivers calling <B>SoundGetCommonBuffer</B>&nbsp;must include <I>wave.h</I>.
<P></FONT>
</BODY>
</HTML>
