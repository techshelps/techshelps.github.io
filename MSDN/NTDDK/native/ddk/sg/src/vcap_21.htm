<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Opening and Closing a Device, Using VCUser.lib</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H4><A NAME="DDK_Opening_and_Closing_a_Device_Using_VCUser.lib"></A>Opening and Closing a Device, Using <I>VCUser.lib</I></H4>
<P>
When your user-mode driver receives a <A HREF="intro_34.htm">DRV_OPEN</A>&nbsp;message
it should call <B><A HREF="vcap_92.htm">VC_OpenDevice</A></B>&nbsp;to open a
device. The following two restrictions apply to opening a video capture
device:
<OL>
<LI>
A user-mode video capture driver can only allow one instance of a device to be
open at time.
<P>
<LI>
A kernel-mode video capture driver can only support one hardware device.
</OL>
<P>
There are two ways to specify a device when calling <B><A HREF="vcap_92.htm">VC_OpenDevice</A></B>
<FONT FACE="Symbol">&#190;</FONT> by device name or by index number. Because a
kernel-mode driver can only support one hardware device, you specify a
device’s name by specifying the kernel-mode driver’s name, such as “bravado”,
without appending a device number.
<P>
Video capture device objects are assigned names of vidcap0, vidcap1, vidcap2,
and so on. By specifying an index number instead of a device name, you can
open any video capture device without knowing its name. For example,
specifying an index of “1” opens the device “vidcap1”. The <A HREF="vcap_4.htm">sample
video capture driver</A>&nbsp;<I>msyuv.dll</I>&nbsp;uses this index number in order to
search for a device that supports a specific data format. For more information
about device objects, see the <I>Kernel-Mode Drivers Design Guide</I>.
<P>
Your driver receives a <A HREF="intro_34.htm">DRV_OPEN</A>&nbsp;message for each video
channel (VIDEO_EXTERNALIN, VIDEO_IN, VIDEO_OUT, VIDEO_EXTERNALOUT) that the
client will be using, but <B><A HREF="vcap_92.htm">VC_OpenDevice</A></B>
should only be called once.
<P>
If your hardware provides overlay capabilities, then prior to calling <B><A HREF="vcap_92.htm">VC_OpenDevice</A></B>
your driver must determine characteristics of the user’s display device, such
as the display’s horizontal and vertical resolutions, and bits per pixel. The
kernel-mode driver needs this information when constructing and positioning an
overlay image. The user-mode driver can obtain characteristics of the user’s
display device by calling <B>GetDeviceCaps</B>, which is described in the
Win32 SDK. Your user-mode driver should call <B><A HREF="vcap_109.htm">VC_WriteProfile</A></B>
to store the characteristics in the registry, where your kernel-mode driver
can access them when needed.
<P>
Upon receipt of a <A HREF="intro_27.htm">DRV_CLOSE</A>&nbsp;message, your driver
should call <B><A HREF="vcap_79.htm">VC_CloseDevice</A></B>. Your driver
will receive a <A HREF="intro_27.htm">DRV_CLOSE</A>&nbsp;message for each open video
channel, but <B><A HREF="vcap_79.htm">VC_CloseDevice</A></B>&nbsp;should only be
called once.
<P></FONT>
</BODY>
</HTML>
