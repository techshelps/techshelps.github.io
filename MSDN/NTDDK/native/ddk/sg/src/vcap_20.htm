<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Installing and Configuring a Kernel-Mode Driver, Using VCUser.lib</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H4><A NAME="DDK_Installing_and_Configuring_a_Kernel_Mode_Driver_Using_VCUser.lib"></A>Installing and Configuring a Kernel-Mode Driver, Using <I>VCUser.lib</I></H4>
<P>
User-mode drivers are responsible for installing their associated kernel-mode
drivers and for providing kernel-mode drivers with configuration parameter
values. The first <I>VCUser.lib</I>&nbsp;function that a user-mode driver should
call is <B><A HREF="vcap_93.htm">VC_OpenProfileAccess</A></B>. This
function, which specifies the kernel-mode driver’s name and sets up storage
for access to the Service Control Manager and the registry, should be called
when the driver receives a <A HREF="intro_33.htm">DRV_LOAD</A>&nbsp;message.
<P>
Next, the driver should call <B><A HREF="vcap_81.htm">VC_ConfigAccess</A></B>.
If the client has Administrators privilege and is thus allowed to install
drivers, this function establishes a connection to the Service Control
Manager. The driver should call the function when it receives a <A HREF="intro_36.htm">DRV_QUERYCONFIGURE</A>
message.
<P>
When the driver receives a <A HREF="intro_28.htm">DRV_CONFIGURE</A>&nbsp;message,
it should call <B><A HREF="vcap_91.htm">VC_InstallDriver</A></B>&nbsp;to
install the kernel-mode driver. This function allows you to specify a callback
function, from which your driver can make calls to <B><A HREF="vcap_109.htm">VC_WriteProfile</A></B>
to store driver configuration parameters in the registry. If your kernel-mode
driver encounters installation errors, it should write an error code into the
registry. Your user-mode driver can call <B><A HREF="vcap_95.htm">VC_ReadProfile</A></B>
to check the error code or to obtain the stored configuration information.
<P>
Upon receipt of a <A HREF="intro_37.htm">DRV_REMOVE</A>&nbsp;message, your driver
should call <B><A HREF="vcap_98.htm">VC_RemoveDriver</A></B>&nbsp;to remove the
kernel-mode driver’s installation. The last message your driver can receive is
<A HREF="intro_31.htm">DRV_FREE</A>, at which time it should call <B><A HREF="vcap_80.htm">VC_CloseProfileAccess</A></B>
to remove its connection to the Service Control Manager.
<P></FONT>
</BODY>
</HTML>
