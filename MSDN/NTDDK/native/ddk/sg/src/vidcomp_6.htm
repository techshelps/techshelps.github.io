<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Messages for Configuring the Driver State</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H4><A NAME="DDK_Messages_for_Configuring_the_Driver_State"></A>Messages for Configuring the Driver State </H4>
<P>
The video compression-specific and decompression-specific configuration
messages are typically initiated by the client application or from dialog
boxes displayed by your driver. Your driver should use these messages to
configure the driver.
<P>
If your driver is configurable, it should support the <A HREF="vidcomp_44.htm">ICM_CONFIGURE</A>
message for driver configuration. It should also use this message to set
parameters for compression or decompression. Any options the user selects in
the dialog box displayed for ICM_CONFIGURE should be saved as part of the
state information referenced by the <A HREF="vidcomp_79.htm">ICM_GETSTATE</A>
and <A HREF="vidcomp_82.htm">ICM_SETSTATE</A>&nbsp;messages.
<P>
The ICM_GETSTATE and ICM_SETSTATE messages query and set the internal state of
your compression or decompression driver. State information is device
dependent, and your driver must define its own data structure for it. While
the client application reserves a memory block for the information, it will
obtain the size needed for the memory block from your driver. If your driver
receives ICM_GETSTATE with a NULL pointer for <I>dwParam1</I>, the client
application is requesting that your driver return the size of its state
information. Conversely, if your driver receives ICM_GETSTATE with <I>dwParam1</I>
pointing to a block of memory, and <I>dwParam2</I>&nbsp;specifying the size of the
memory block, the client application is requesting that your driver transfer
the state information to the memory block.
<P>
When your driver receives ICM_SETSTATE, with <I>dwParam1</I>&nbsp;pointing to a
block of memory and <I>dwParam2</I>&nbsp;specifying the size of the memory block,
the client application is requesting that your driver restore its
configuration from the state information contained in the memory block. Before
setting the state, your driver should verify that the state information
applies to your driver. One technique for verifying the data is to reserve the
first DWORD in the state data structure for the four-character code used to
identify your driver. If you set this DWORD for data returned for
ICM_GETSTATE, you can use it to verify the data supplied with ICM_SETSTATE. If
ICM_SETSTATE has a NULL pointer for <I>dwParam1</I>, it indicates that your
driver should return to its default state.
<P>
State information should not contain any data that is absolutely required for
data decompression<FONT FACE="Symbol">&#190;</FONT>any such data should be
part of the format you return for the <A HREF="vidcomp_48.htm">ICM_DECOMPRESS_GET_FORMAT</A>
message.
<P></FONT>
</BODY>
</HTML>
