<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Specifying the Input Format and Determining the Decompression Format</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H4><A NAME="DDK_Specifying_the_Input_Format_and_Determining_the_Decompression_Format"></A>Specifying the Input Format and Determining the Decompression Format</H4>
<P>
Depending on how the client application will use the decompressed data, it
will send either <A HREF="vidcomp_48.htm">ICM_DECOMPRESS_GET_FORMAT</A>
or <A HREF="vidcomp_55.htm">ICM_DECOMPRESSEX_QUERY</A>&nbsp;to specify the
input format and determine the decompression format. The client application
sends ICM_DECOMPRESS_GET_FORMAT to have your driver suggest the decompressed
format. The client application sends ICM_DECOMPRESSEX_QUERY to determine if
your driver supports a format it is suggesting.
<P>
The ICM_DECOMPRESS_GET_FORMAT message sends a pointer to a BITMAPINFO data
structure in <I>dwParam1</I>. This structure specifies the format of the
incoming compressed data. The input format was obtained by the client
application from the ‘strf’ chunk in the AVI file. While the output format is
specified by <I>dwParam2</I>, your driver must use the message to determine
how the parameter is defined. 
<P>
If your driver receives ICM_DECOMPRESS_GET_FORMAT, both <I>dwParam1</I>&nbsp;and <I>dwParam2</I>
point to BITMAPINFO data structures. The input format data is contained in the
<I>dwParam1</I>&nbsp;structure. Your driver should fill in the <I>dwParam2</I>
BITMAPINFO data structure with information about the format it will use to
decompress the data. If your driver can handle the format, return the number
of bytes used for the <I>dwParam2</I>&nbsp;structure as the return value. If your
driver cannot handle the input format, or the input format from the ‘strf’
chunk is incorrect, your driver should return ICERR_BADFORMAT to fail the
message.
<P>
If you have format information in addition to that specified in the
BITMAPINFOHEADER structure, you can add it immediately after this structure.
If you do this, update the <B>biSize</B>&nbsp;member to specify the number of bytes
used by the structure and your additional information. If a color table is
part of the BITMAPINFO information, it follows immediately after your
additional information. Return ICERR_OK when your driver has finished updating
the data format.
<P>
If your driver receives ICM_DECOMPRESSEX_QUERY, <I>dwParam1</I>&nbsp;points to an <A HREF="vidcomp_89.htm">ICDECOMPRESSEX</A>
data structure containing the input format data. If <B>lpbiDst </B>is NULL,
your decompression driver can use any output format. In this case, the client
application is querying whether your driver can decompress the input format,
and the output format doesn’t matter. If <B>lpbiDst</B>&nbsp;points to a BITMAPINFO
structure, the suggested format will be the native or best format for the
decompressed data. For example, if playback is on an 8-bit device, the client
application will suggest an 8-bit DIB. 
<P>
If your driver supports the specified input and output format (which might
also include stretching the image according to the values specified for the <B>xDst</B>,<B>
yDst</B>,<B>&nbsp;dxDst</B>,<B>&nbsp;dyDst</B>,<B>&nbsp;xSrc</B>,<B>&nbsp;ySrc</B>,<B>&nbsp;dxSrc</B>,<B>
</B>and <B>dySrc</B>&nbsp;members), or if it supports the specified input with NULL
specified for <B>lpbiDst</B>, return ICERR_OK to indicate the driver accepts
the formats. 
<P>
Your driver does not have to accept the formats suggested. If you fail the
message by returning ICERR_BADFORMAT, the client application suggests
alternate formats until your driver accepts one. If your driver exhausts the
list of formats usually used, the client application requests a format with
ICM_DECOMPRESS_GET_FORMAT.
<P>
If you are decompressing to 8-bit data, your driver also receives the
ICM_DECOMPRESS_GET_PALETTE message. Your driver should add a color table to
the BITMAPINFO data structure and specify the number of palette entries in the
<B>biClrUsed</B>&nbsp;member. The space reserved for the color table is always 256
colors.
<P></FONT>
</BODY>
</HTML>
