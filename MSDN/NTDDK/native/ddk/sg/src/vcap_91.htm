<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>VC_InstallDriver</TITLE>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">

<FONT FACE="ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="DDK_VC_InstallDriver"></A>VC_InstallDriver</H2>
<P>
<B>LRESULT<BR>
VC_InstallDriver(<BR>
&nbsp; &nbsp; PVC_PROFILE_INFO </B><I>pProfile<B>,</I><BR>
&nbsp; &nbsp; PPROFILE_CALLBACK </B><I>pCallback</I><B>,<BR>
&nbsp; &nbsp; PVOID </B><I>pContext<B><BR>
&nbsp; &nbsp; </I>);</B>
<P>
The <B>VC_InstallDriver</B>&nbsp;function installs a kernel-mode driver and allows
modification of configuration parameters.
<H5>Parameters</H5>
<DL>
<DT>
<I>pProfile</I>
<DD>
Address of a VC_PROFILE_INFO structure returned by <B><A HREF="vcap_93.htm">VC_OpenProfileAccess</A></B>,
containing the kernel-mode driver’s name.
<BR>
<DT>
<I>pCallback</I>
<DD>
Pointer to a driver-supplied function that is called before the kernel-mode
driver is reloaded. Can be NULL.
<P>
The function should return TRUE if the installation should continue, or FALSE
if the installation should be terminated. It uses the following prototype
definition:
<PRE><FONT FACE="Courier" SIZE="2"><B>BOOL </B><I>pCallback</I><B>&nbsp;(PVOID </B><I>pContext</I><B>);</B>
</FONT></PRE>
<DT>
<I>pContext</I>
<DD>
Pointer to a driver-defined structure that is passed as input to the function
pointed to by <I>pCallback</I>. Can be NULL.
</DL>
<H5>Return Value</H5>
<P>
Returns one the following values.
<TABLE>
<TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>Value</B>
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
<B>Definition</B>
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
DRVCNF_OK
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
The driver is correctly loaded and started. System restart is not required.
</FONT><TR VALIGN=top>
<TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
DRVCNF_CANCEL
</FONT><TD><FONT FACE="ARIAL,HELVETICA" SIZE="2">
<P>
An error occurred.
</FONT></TABLE>
<H5>Comments</H5>
<P>
Under Windows NT, kernel-mode drivers are considered to be services under the
control of the Service Control Manager. The <B>VC_InstallDriver</B>&nbsp;function
establishes a kernel-mode driver as a service by performing the following
operations, in order:
<OL>
<LI>
Calling <B>OpenSCManager</B>&nbsp;to create a connection to the local Service
Control Manager. <B>OpenSCManager</B>&nbsp;is called with a desired access type of
SC_MANAGER_ALL_ACCESS, which requires Administrators privilege. (<B>OpenSCManager</B>
is described in the Win32 SDK.)
<P>
<LI>
Calling <B>CreateService</B>&nbsp;to create a kernel-mode driver service and obtain
a service handle. The function sets the service’s start type to
SERVICE_DEMAND_START, so it will not automatically reload when the system is
restarted. (<B>CreateService</B>&nbsp;is described in the Win32 SDK.)
<P>
<LI>
Unloading the kernel-mode driver, if it is loaded.
<P>
<LI>
Calling the driver-supplied function specified by the <I>pCallback</I>
parameter. Generally, drivers use this function to modify configuration
parameters in the registry, using <B><A HREF="vcap_109.htm">VC_WriteProfile</A></B>.
<P>
<LI>
Reloading and restarting the kernel-mode driver, setting its start type to
SERVICE_SYSTEM_START, so it will automatically reload and restart when the
system is restarted.
</OL>
<P>
A result of calling <B>CreateService</B>&nbsp;is the creation of a driver subkey
under the <B>\Services</B>&nbsp;registry key. The path to the subkey is <B>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\</B><I>DriverName</I>,
where <I>DriverName</I>&nbsp;is the driver name specified as input to <B><A HREF="vcap_93.htm">VC_OpenProfileAccess</A></B>.
<P>
Typically, a user-mode video capture driver calls <B>VC_InstallDriver</B>&nbsp;when
its <B><A HREF="intro_44.htm">DriverProc</A></B>&nbsp;function receives a <A HREF="intro_28.htm">DRV_CONFIGURE</A>
message.
<P></FONT>
</BODY>
</HTML>
