<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PERFUTIL.H</title>
<link disabled rel=stylesheet href=../../../../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>
<h2><a name="_code_context6283"></a>PERFUTIL.H</h2>
<pre><code>/*++ BUILD Version: 0001    // Increment this if a change has global effects <br> <br>Copyright 1995 - 1998 Microsoft Corporation <br> <br>Module Name: <br> <br>    perfutil.h   <br> <br>Abstract: <br> <br>    This file supports routines used to parse and <br>    create Performance Monitor Data Structures. <br>    It actually supports Performance Object types with <br>    multiple instances <br> <br>Author: <br> <br>    Bob Watson  28-Jul-1995 <br> <br>Revision History: <br> <br> <br>--*/ <br>#ifndef _PERFUTIL_H_ <br>#define _PERFUTIL_H_ <br> <br>// enable this define to log process heap data to the event log <br>#ifdef PROBE_HEAP_USAGE <br>#undef PROBE_HEAP_USAGE <br>#endif <br>// <br>//  Utility macro.  This is used to reserve a DWORD multiple of <br>//  bytes for Unicode strings embedded in the definitional data, <br>//  viz., object instance names. <br>// <br>#define DWORD_MULTIPLE(x) (((x+sizeof(DWORD)-1)/sizeof(DWORD))*sizeof(DWORD)) <br> <br>//    (assumes dword is 4 bytes long and pointer is a dword in size) <br>#define ALIGN_ON_DWORD(x) ((VOID *)( ((DWORD) x &amp; 0x00000003) ? ( ((DWORD) x &amp; 0xFFFFFFFC) + 4 ) : ( (DWORD) x ) )) <br> <br>extern WCHAR  GLOBAL_STRING[];      // Global command (get all local ctrs) <br>extern WCHAR  FOREIGN_STRING[];           // get data from foreign computers <br>extern WCHAR  COSTLY_STRING[];       <br>extern WCHAR  NULL_STRING[]; <br> <br>#define QUERY_GLOBAL    1 <br>#define QUERY_ITEMS     2 <br>#define QUERY_FOREIGN   3 <br>#define QUERY_COSTLY    4 <br> <br>// <br>// The definition of the only routine of perfutil.c, It builds part of a  <br>// performance data instance (PERF_INSTANCE_DEFINITION) as described in  <br>// winperf.h <br>// <br> <br>HANDLE MonOpenEventLog (); <br>VOID MonCloseEventLog (); <br>DWORD GetQueryType (IN LPWSTR); <br>BOOL IsNumberInUnicodeList (DWORD, LPWSTR); <br> <br>BOOL <br>MonBuildInstanceDefinition( <br>    PERF_INSTANCE_DEFINITION *pBuffer, <br>    PVOID *pBufferNext, <br>    DWORD ParentObjectTitleIndex, <br>    DWORD ParentObjectInstance, <br>    DWORD UniqueID, <br>    LPWSTR Name <br>    ); <br> <br>typedef struct _LOCAL_HEAP_INFO_BLOCK { <br>    DWORD   AllocatedEntries; <br>    DWORD   AllocatedBytes; <br>    DWORD   FreeEntries; <br>    DWORD   FreeBytes; <br>} LOCAL_HEAP_INFO, *PLOCAL_HEAP_INFO; <br> <br> <br>// <br>//  Memory Probe macro <br>// <br>#ifdef PROBE_HEAP_USAGE <br> <br>#define HEAP_PROBE()    { \ <br>    DWORD   dwHeapStatus[5]; \ <br>    NTSTATUS CallStatus; \ <br>    dwHeapStatus[4] = __LINE__; \ <br>    if (!(CallStatus = memprobe (dwHeapStatus, 16L, NULL))) { \ <br>        REPORT_INFORMATION_DATA (TCP_HEAP_STATUS, LOG_DEBUG,    \ <br>            &amp;dwHeapStatus, sizeof(dwHeapStatus));  \ <br>    } else {  \ <br>        REPORT_ERROR_DATA (TCP_HEAP_STATUS_ERROR, LOG_DEBUG, \ <br>            &amp;CallStatus, sizeof (DWORD)); \ <br>    } \ <br>} <br> <br>#else <br> <br>#define HEAP_PROBE()    ; <br> <br>#endif <br> <br>#endif  //_PERFUTIL_H_ </code></pre>
<p>&nbsp;</p></body>
</HTML>
