<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Recordset: Locking Records (ODBC)</TITLE>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_vc_addpf_home">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="Enroll tutorial">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.SetLockingMode">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.Edit">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.Update">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.SetLockingMode">
</OBJECT>
</TD></TR></TABLE>


<font face="verdana,arial,helvetica" size="2">
<H1><A NAME="_core_recordset.3a_.locking_records_.28.odbc.29"></A>Recordset: Locking Records (ODBC)</H1>

<P><A HREF="JavaScript:hhobj_1.Click()">Home</A>  |&nbsp; <A HREF="_core_databases.3a_.overview.htm">Overview</A>  |&nbsp; <A HREF="_core_odbc_database_tasks.htm">How Do I</A>  |&nbsp; <A HREF="_core_databases.3a_.frequently_asked_questions.htm">FAQ</A>  |&nbsp; <A HREF="_core_odbc_database_sample_list.htm">Sample</A>  |&nbsp; <A HREF="JavaScript:hhobj_2.Click()">Tutorial</A>  |&nbsp; <A HREF="_core_odbc_driver_list.htm">ODBC Driver List</A></P>

<P>This article applies to the MFC ODBC classes. For DAO recordsets, see the article <A HREF="_core_dao_recordset.htm">DAO Recordset</A>.</P>

<P>This article explains: 

<UL type=disc>
	<LI><A HREF="#_core_record.2d.locking_modes">The kinds of record locking available</A>.<BR><BR></LI>

	<LI><A HREF="#_core_locking_records_in_your_recordset">How to lock records in your recordset during updates</A>.</LI>
</UL>

<P>When you use a recordset to update a record on the data source, your application can lock the record so no other user can update the record at the same time. The state of a record updated by two users at “the same time” is undefined unless the system can guarantee that two users can’t update a record simultaneously. </P>

<P class=indent><B><B>Note&nbsp;&nbsp;&nbsp;</B></B>This article applies to objects derived from <B>CRecordset</B> in which bulk row fetching has not been implemented. If you have implemented bulk row fetching, some of the information does not apply. For example, you cannot call the <B>Edit</B> and <B>Update</B> member functions. For more information about bulk row fetching, see the article <A HREF="_core_recordset.3a_.fetching_records_in_bulk_.28.odbc.29.htm">Recordset: Fetching Records in Bulk (ODBC)</A>.</P>



<H2><A NAME="_core_record.2d.locking_modes"></A>Record-Locking Modes</H2>

<P>The database classes provide two <A HREF="JavaScript:hhobj_3.Click()">record-locking modes</A>:

<UL type=disc>
	<LI>Optimistic locking (the default)<BR><BR></LI>

	<LI>Pessimistic locking </LI>
</UL>

<P>Updating a record occurs in three steps:

<OL>
	<LI>You begin the operation by calling the <A HREF="JavaScript:hhobj_4.Click()">Edit</A> member function. <BR><BR></LI>

	<LI>You change the appropriate fields of the current record.<BR><BR></LI>

	<LI>You end the operation — and normally commit the update — by calling the <A HREF="JavaScript:hhobj_5.Click()">Update</A> member function.</LI>
</OL>

<P>Optimistic locking locks the record on the data source only during the <B>Update</B> call. If you use optimistic locking in a multiuser environment, the application should handle an <B>Update</B> failure condition. Pessimistic locking locks the record as soon as you call <B>Edit</B> and doesn’t release it until you call <B>Update</B> (failures are indicated via the <B>CDBException</B> mechanism, not by a value of <B>FALSE</B> returned by <B>Update</B>). Pessimistic locking has a potential performance penalty for other users, since concurrent access to the same record may have to wait until completion of your application’s <B>Update</B> process.</P>

<H2><A NAME="_core_locking_records_in_your_recordset"></A>Locking Records in Your Recordset</H2>

<P>If you want to change a recordset object’s <A HREF="#_core_record.2d.locking_modes">locking mode</A> from the default, you must change the mode before you call <B>Edit</B>.</P>

<P class=label><B><A NAME="_core_to_change_the_current_locking_mode_for_your_recordset"></A>To change the current locking mode for your recordset</B>

<UL type=disc>
	<LI>Call the <A HREF="JavaScript:hhobj_6.Click()">SetLockingMode</A> member function, specifying either <B>CRecordset::pessimistic</B> or <B>CRecordset::optimistic</B>.</LI>
</UL>

<P>The new locking mode remains in effect until you change it again or the recordset is closed.</P>

<P class=indent><B><B>Note&nbsp;&nbsp;&nbsp;</B></B>Relatively few ODBC drivers currently support pessimistic locking.</P>

<P><B>See Also</B>&nbsp;&nbsp;&nbsp;<A HREF="_core_recordset.3a_.performing_a_join_.28.odbc.29.htm">Recordset: Performing a Join (ODBC)</A>, <A HREF="_core_recordset.3a_.adding.2c_.updating.2c_.and_deleting_records_.28.odbc.29.htm">Recordset: Adding, Updating, and Deleting Records (ODBC)</A> </P>
</font>
</BODY>
</HTML>
