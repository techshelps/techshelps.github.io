<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Serialization: Making a Serializable Class</TITLE>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_vc_addpf_home">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_gs_Serializing_the_Data">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CArchive">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CArchive">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CArchive.3a3a.Read">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CArchive.3a3a.Write">
</OBJECT>
</TD></TR></TABLE>


<font face="verdana,arial,helvetica" size="2">
<H1><A NAME="_core_serialization.3a_.making_a_serializable_class"></A>Serialization: Making a Serializable Class</H1>

<P><A HREF="JavaScript:hhobj_1.Click()">Home</A>  |&nbsp; <A HREF="_core_serialization.3a_.overview.htm">Overview</A>  |&nbsp; <A HREF="_core_serialization_tasks.htm">How Do I</A>  |&nbsp; <A HREF="JavaScript:hhobj_2.Click()">Tutorial</A></P>

<P>Five main steps are required to make a class serializable. They are listed below and explained in the following sections:

<OL>
	<LI><A HREF="#_core_deriving_your_class_from_cobject">Deriving your class from CObject</A> (or from some class derived from <B>CObject</B>).<BR><BR></LI>

	<LI><A HREF="#_core_overriding_the_serialize_member_function">Overriding the Serialize member function</A>.<BR><BR></LI>

	<LI><A HREF="#_core_using_the_declare_serial_macro">Using the DECLARE_SERIAL macro</A> in the class declaration.&nbsp; <BR><BR></LI>

	<LI><A HREF="#_core_defining_a_constructor_with_no_arguments">Defining a constructor that takes no arguments</A>.<BR><BR></LI>

	<LI><A HREF="#_core_using_the_implement_serial_macro_in_the_implementation_file">Using the IMPLEMENT_SERIAL macro in the implementation file</A> for your class.</LI>
</OL>

<P>If you call <B>Serialize</B> directly rather than through the &gt;&gt; and &lt;&lt; operators of <A HREF="JavaScript:hhobj_3.Click()">CArchive</A>, the last three steps are not required for serialization.</P>



<H2><A NAME="_core_deriving_your_class_from_cobject"></A>Deriving Your Class from CObject</H2>

<P>The basic serialization protocol and functionality are defined in the <B>CObject</B> class. By deriving your class from <B>CObject</B> (or from a class derived from <B>CObject</B>), as shown in the following declaration of class <CODE>CPerson</CODE>, you gain access to the serialization protocol and functionality of <B>CObject</B>.</P>



<H2><A NAME="_core_overriding_the_serialize_member_function"></A>Overriding the Serialize Member Function</H2>

<P>The <B>Serialize</B> member function, which is defined in the <B>CObject</B> class, is responsible for actually serializing the data necessary to capture an object’s current state. The <B>Serialize</B> function has a <B>CArchive</B> argument that it uses to read and write the object data. The <A HREF="JavaScript:hhobj_4.Click()">CArchive</A> object has a member function, <B>IsStoring</B>, which indicates whether <B>Serialize</B> is storing (writing data) or loading (reading data). Using the results of <B>IsStoring</B> as a guide, you either insert your object’s data in the <B>CArchive</B> object with the insertion operator (<B>&lt;&lt;</B>) or extract data with the extraction operator (<B>&gt;&gt;</B>).</P>

<P>Consider a class that is derived from <B>CObject</B> and has two new member variables, of types <B>CString</B> and <B>WORD</B>. The following class declaration fragment shows the new member variables and the declaration for the overridden <B>Serialize</B> member function:</P>

<PRE><CODE>class CPerson : public CObject
{
public:
    DECLARE_SERIAL( CPerson )
    // empty constructor is necessary
    CPerson(){};

    CString m_name;
    WORD   m_number;

    void Serialize( CArchive&amp; archive );
    
    // rest of class declaration
};
</CODE></PRE>

<P class=label><B><A NAME="_core_to_override_the_serialize_member_function"></A>To override the Serialize member function</B>

<OL>
	<LI>Call your base class version of <B>Serialize</B> to make sure that the inherited portion of the object is serialized.<BR><BR></LI>

	<LI>Insert or extract the member variables specific to your class.
<P class=tl>The insertion and extraction operators interact with the archive class to read and write the data. The following example shows how to implement <B>Serialize</B> for the <CODE>CPerson</CODE> class declared above:</P>
<PRE><CODE>void CPerson::Serialize( CArchive&amp; archive )
{
    // call base class function first
    // base class is CObject in this case
    CObject::Serialize( archive );

    // now do the stuff for our specific class
    if( archive.IsStoring() )
        archive &lt;&lt; m_name &lt;&lt; m_number;
    else
        archive &gt;&gt; m_name &gt;&gt; m_number;
}
</CODE></PRE>
</LI>
</OL>

<P>You can also use the <A HREF="JavaScript:hhobj_5.Click()">CArchive::Read</A> and <A HREF="JavaScript:hhobj_6.Click()">CArchive::Write</A> member functions to read and write large amounts of untyped data.</P>



<H2><A NAME="_core_using_the_declare_serial_macro"></A>Using the DECLARE_SERIAL Macro</H2>

<P>The <B>DECLARE_SERIAL</B> macro is required in the declaration of classes that will support serialization, as shown here:</P>

<PRE><CODE>class CPerson : public CObject
{
    DECLARE_SERIAL( CPerson )
    // rest of declaration follows...
};
</CODE></PRE>



<H2><A NAME="_core_defining_a_constructor_with_no_arguments"></A>Defining a Constructor with No Arguments</H2>

<P>MFC requires a default constructor when it re-creates your objects as they are deserialized (loaded from disk). The deserialization process will fill in all member variables with the values required to re-create the object.</P>

<P>This constructor can be declared public, protected, or private. If you make it protected or private, you ensure that it will only be used by the serialization functions. The constructor must put the object in a state that allows it to be safely deleted if necessary.</P>

<P class=indent><B><B>Note</B></B>&nbsp;&nbsp;&nbsp;If you forget to define a constructor with no arguments in a class that uses the <B>DECLARE_SERIAL</B> and <B>IMPLEMENT_SERIAL</B> macros, you will get a “no default constructor available” compiler warning on the line where the <B>IMPLEMENT_SERIAL</B> macro is used.</P>



<H2><A NAME="_core_using_the_implement_serial_macro_in_the_implementation_file"></A>Using the IMPLEMENT_SERIAL Macro in the Implementation File</H2>

<P>The <B>IMPLEMENT_SERIAL</B> macro is used to define the various functions needed when you derive a serializable class from <B>CObject</B>. You use this macro in the implementation file (.CPP) for your class. The first two arguments to the macro are the name of the class and the name of its immediate base class.</P>

<P>The third argument to this macro is a schema number. The schema number is essentially a version number for objects of the class. Use an integer greater than or equal to 0 for the schema number. (Don’t confuse this schema number with database terminology.)</P>

<P>The MFC serialization code checks the schema number when reading objects into memory. If the schema number of the object on disk does not match the schema number of the class in memory, the library will throw a <B>CArchiveException</B>, preventing your program from reading an incorrect version of the object.</P>

<P>If you want your <CODE>Serialize</CODE> member function to be able to read multiple versions — that is, files written with different versions of the application — you can use the value <B>VERSIONABLE_SCHEMA</B> as an argument to the <B>IMPLEMENT_SERIAL</B> macro. For usage information and an example, see the <B>GetObjectSchema</B> member function of class <B>CArchive</B>.</P>

<P>The following example shows how to use <B>IMPLEMENT_SERIAL</B> for a class, <CODE>CPerson</CODE>, that is derived from <B>CObject</B>:</P>

<PRE><CODE>IMPLEMENT_SERIAL( CPerson, CObject, 1 )
</CODE></PRE>

<P>Once you have a serializable class, you can serialize objects of the class, as discussed in the article <A HREF="_core_serialization.3a_.serializing_an_object.htm">Serialization: Serializing an Object</A>. </P>
</font>
</BODY>
</HTML>
