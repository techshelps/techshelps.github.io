<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Managing the State Data of MFC Modules</TITLE>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_vc_addpf_home">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="MFC samples">
</OBJECT>
</TD></TR></TABLE>


<font face="verdana,arial,helvetica" size="2">
<H1><A NAME="_core_managing_the_state_data_of_mfc_modules"></A>Managing the State Data of MFC Modules</H1>

<P><A HREF="JavaScript:hhobj_1.Click()">Home</A>  |&nbsp; <A HREF="_core_mfc.3a_.overview.htm">Overview</A>  |&nbsp; <A HREF="_core_mfc_tasks.htm">How Do I</A>  |&nbsp; <A HREF="JavaScript:hhobj_2.Click()">Sample</A>  |&nbsp; <A HREF="_core_mfc_tutorials_available.htm">Tutorial</A></P>

<P>This article discusses the state data of MFC modules and how this state is updated when the flow of execution (the path code takes through an application when executing) enters and leaves a module. Switching module states with the <B>AFX_MANAGE_STATE</B> and <B>METHOD_PROLOGUE</B> macros is also discussed.</P>

<P class=indent><B><B>Note</B></B>&nbsp;&nbsp;&nbsp;The term "module" here refers to an executable program, or to a DLL (or set of DLLs) that operate independently of the rest of the application, but uses a shared copy of the MFC DLL. An ActiveX control is a typical example of a module.</P>

<P>As shown in the figure "State Data of a Single Module (Application)," MFC has state data for each module used in an application. Examples of this data include: Windows instance handles (used for loading resources), pointers to the current <B>CWinApp</B> and <B>CWinThread</B> objects of an application, OLE module reference counts, and a variety of maps that maintain the connections between Windows object handles and corresponding instances of MFC objects. However, when an application uses multiple modules, the state data of each module is not application-wide. Rather, each module has its own private copy of the MFC's state data.</P>

<P class=label><B>State Data of a Single Module (Application)</B></P>

<P><IMG SRC="appstate.gif" ALT="" BORDER=0></P>

<P>A module's state data is contained in a structure and is always available via a pointer to that structure. When the flow of execution enters a particular module, as shown in the figure "State Data of Multiple Modules," that module's state must be the "current" or "effective" state. Therefore, each thread object has a pointer to the effective state structure of that application. Keeping this pointer updated at all times is vital to managing the application's global state and maintaining the integrity of each module's state. Incorrect management of the global state can lead to unpredictable application behavior.</P>

<P class=label><B>State Data of Multiple Modules</B></P>

<P><IMG SRC="modstate.gif" ALT="" BORDER=0></P>

<P>In other words, each module is responsible for correctly switching between module states at all of its entry points. An "entry point" is any place where the flow of execution can enter the module's code. Entry points include:

<UL type=disc>
	<LI><A HREF="_core_exported_dll_function_entry_points.htm">Exported functions in a DLL</A><BR><BR></LI>

	<LI><A HREF="_core_com_interface_entry_points.htm">Member functions of COM interfaces</A><BR><BR></LI>

	<LI><A HREF="_core_window_procedure_entry_points.htm">Window procedures</A></LI>
</UL>
</font>
</BODY>
</HTML>
