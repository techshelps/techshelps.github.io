<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Windows Sockets: Using Class CAsyncSocket</TITLE>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_vc_addpf_home">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CAsyncSocket">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CSocket">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CAsyncSocket">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CAsyncSocket.3a3a.Create">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CAsyncSocket.3a3a.Connect">
</OBJECT>
<OBJECT ID="hhobj_7" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CAsyncSocket.3a3a.Listen">
</OBJECT>
<OBJECT ID="hhobj_8" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CAsyncSocket.3a3a.Accept">
</OBJECT>
<OBJECT ID="hhobj_9" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CAsyncSocket">
</OBJECT>
<OBJECT ID="hhobj_10" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CAsyncSocket.3a3a.Close">
</OBJECT>
<OBJECT ID="hhobj_11" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CAsyncSocket">
</OBJECT>
</TD></TR></TABLE>


<font face="verdana,arial,helvetica" size="2">
<H1><A NAME="_core_windows_sockets.3a_.using_class_casyncsocket"></A>Windows Sockets: Using Class CAsyncSocket</H1>

<P><A HREF="JavaScript:hhobj_1.Click()">Home</A>  |&nbsp; <A HREF="_core_windows_sockets_for_network_programming.3a_.overview.htm">Overview</A>  |&nbsp; <A HREF="_core_windows_sockets_tasks.htm">How Do I</A>  |&nbsp; <A HREF="_core_windows_sockets_sample_list.htm">Sample</A></P>

<P>This article explains how to use class <A HREF="JavaScript:hhobj_2.Click()">CAsyncSocket</A>. Be aware that this class encapsulates the Windows Sockets API at a very low level. <B>CAsyncSocket</B> is for use by programmers who know network communications in detail but want the convenience of callbacks for notification of network events. Based on this assumption, this article provides only basic instruction. You should probably consider using <B>CAsyncSocket</B> if you want Windows Sockets’ ease of dealing with multiple network protocols in an MFC application but don’t want to sacrifice flexibility. You might also feel that you can get better efficiency by programming the communications more directly yourself than you could using the more general alternative model of class <B>CSocket</B>.</P>

<P><B>CAsyncSocket</B> is documented in the <I>Class Library Reference</I>. Visual C++ also supplies the Windows Sockets specification, located in the Win32 SDK. The details are left to you. Visual C++ does not supply a sample application for <B>CAsyncSocket</B>. </P>

<P>If you aren’t highly knowledgeable about network communications and want a simple solution that shields you from most of the details, use class <A HREF="JavaScript:hhobj_3.Click()">CSocket</A> with a <B>CArchive</B> object. See the article <A HREF="_core_windows_sockets.3a_.using_sockets_with_archives.htm">Windows Sockets: Using Sockets with Archives</A>. </P>

<P>This article covers:

<UL type=disc>
	<LI>Creating and using a <B>CAsyncSocket</B> object.<BR><BR></LI>

	<LI><A HREF="#_core_your_responsibilities_with_casyncsocket">Your responsibilities with CAsyncSocket</A>.</LI>
</UL>

<H2><A NAME="_core_creating_and_using_a_casyncsocket_object"></A>Creating and Using a CAsyncSocket Object</H2>

<P class=label><B>To use CAsyncSocket</B>

<OL>
	<LI>Construct a <A HREF="JavaScript:hhobj_4.Click()">CAsyncSocket</A> object and use the object to create the underlying <B>SOCKET</B> handle.
<P class=tl>Creation of a socket follows the MFC pattern of two-stage construction.</P>
<P class=tl>For example:</P>
<PRE><CODE>CAsyncSocket sock;
sock.Create( );    // Use the default parameters
</CODE></PRE>

<P class=tl>-or-</P>
<PRE><CODE>CAsyncSocket* pSocket = new CAsyncSocket;
int nPort = 27;
pSocket-&gt;Create( nPort, SOCK_DGRAM );
</CODE></PRE>

<P class=tl>The first constructor above creates a <B>CAsyncSocket</B> object on the stack. The second constructor creates a <B>CAsyncSocket</B> on the heap. The first <A HREF="JavaScript:hhobj_5.Click()">Create</A> call above uses the default parameters to create a stream socket. The second <B>Create</B> call creates a datagram socket with a specified port and address. (You can use either <B>Create</B> version with either construction method.)</P>
<P class=tl>The parameters to <B>Create</B> are:</P>
<UL type=disc>
	<LI>A “port”: a short integer.
<P class=tl>For a server socket, you must specify a port. For a client socket, you’ll typically accept the default value for this parameter, which lets Windows Sockets select a port.</P></LI>

	<LI>A socket type: <B>SOCK_STREAM</B> (the default) or <B>SOCK_DGRAM</B>.<BR><BR></LI>

	<LI>A socket “address,” such as “ftp.microsoft.com” or “128.56.22.8”.
<P class=tl>This is your Internet Protocol (IP) address on the network. You’ll probably always rely on the default value for this parameter.</P></LI>
</UL>

<P class=tl>The terms “port” and “socket address” are explained in the article <A HREF="_core_windows_sockets.3a_.ports_and_socket_addresses.htm">Windows Sockets: Ports and Socket Addresses</A>. </P></LI>

	<LI>If the socket is a client, connect the socket object to a server socket, using <A HREF="JavaScript:hhobj_6.Click()">CAsyncSocket::Connect</A>.
<P class=tl>-or-</P>
<P class=tl>If the socket is a server, set the socket to begin listening (with <A HREF="JavaScript:hhobj_7.Click()">CAsyncSocket::Listen</A>) for connect attempts from a client. Upon receiving a connection request, accept it with <A HREF="JavaScript:hhobj_8.Click()">CAsyncSocket::Accept</A>.</P>
<P class=tl>After accepting a connection, you can perform such tasks as validating passwords.</P>
<P class=atl><B><B>Note</B></B>&nbsp;&nbsp;&nbsp;The <B>Accept</B> member function takes a reference to a new, empty <B>CSocket</B> object as its parameter. You must construct this object before you call <B>Accept</B>. Keep in mind that if this socket object goes out of scope, the connection closes. Do not call <B>Create</B> for this new socket object. For an example, see the article <A HREF="_core_windows_sockets.3a_.sequence_of_operations.htm">Windows Sockets: Sequence of Operations</A>. </p></LI>

	<LI>Carry out communications with other sockets by calling the <B>CAsyncSocket</B> object’s member functions that encapsulate the Windows Sockets API functions.
<P class=tl>See the Windows Sockets specification and class <A HREF="JavaScript:hhobj_9.Click()">CAsyncSocket</A> in the <I>Class Library Reference</I>.</P></LI>

	<LI>Destroy the <B>CAsyncSocket</B> object.
<P class=tl>If you created the socket object on the stack, its destructor is called when the containing function goes out of scope. If you created the socket object on the heap, using the <B>new</B> operator, you are responsible for using the <B>delete</B> operator to destroy the object. </P>
<P class=tl>The destructor calls the object’s <A HREF="JavaScript:hhobj_10.Click()">Close</A> member function before destroying the object.</P></LI>
</OL>

<P>For an example of this sequence in code (actually for a <B>CSocket</B> object), see the article <A HREF="_core_windows_sockets.3a_.sequence_of_operations.htm">Windows Sockets: Sequence of Operations</A>. </P>



<H2><A NAME="_core_your_responsibilities_with_casyncsocket"></A>Your Responsibilities with CAsyncSocket</H2>

<P>When you create an object of class <A HREF="JavaScript:hhobj_11.Click()">CAsyncSocket</A>, the object encapsulates a Windows <B>SOCKET</B> handle and supplies operations on that handle. When you use <B>CAsyncSocket</B>, you must deal with all of the issues you might face if using the API directly. For example:

<UL type=disc>
	<LI>“Blocking” scenarios <BR><BR></LI>

	<LI>Byte order differences between the sending and receiving machines<BR><BR></LI>

	<LI>Converting between Unicode and multibyte character set (MBCS) strings</LI>
</UL>

<P>For definitions of these terms and additional information, see the articles <A HREF="_core_windows_sockets.3a_.blocking.htm">Windows Sockets: Blocking</A>, <A HREF="_core_windows_sockets.3a_.byte_ordering.htm">Windows Sockets: Byte Ordering</A>, <A HREF="_core_windows_sockets.3a_.converting_strings.htm">Windows Sockets: Converting Strings</A>. </P>

<P>Despite these issues, class <B>CAsycnSocket</B> may be the right choice for you if your application requires all the flexibility and control you can get. If not, you should consider using class <B>CSocket</B> instead. <B>CSocket</B> hides a lot of detail from you: it pumps Windows messages during blocking calls and gives you access to <B>CArchive</B>, which manages byte order differences and string conversion for you.</P>

<H3>What do you want to know more about?</H3>

<UL type=disc>
	<LI><A HREF="_core_windows_sockets.3a_.background.htm">Windows Sockets: Background</A><BR><BR></LI>

	<LI><A HREF="_core_windows_sockets.3a_.stream_sockets.htm">Windows Sockets: Stream Sockets</A><BR><BR></LI>

	<LI><A HREF="_core_windows_sockets.3a_.datagram_sockets.htm">Windows Sockets: Datagram Sockets</A></LI>
</UL>
</font>
</BODY>
</HTML>
