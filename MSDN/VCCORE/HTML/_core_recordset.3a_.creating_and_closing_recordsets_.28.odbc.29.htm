<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Recordset: Creating and Closing Recordsets (ODBC)</TITLE>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_vc_addpf_home">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="Enroll tutorial">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.Open">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.GetDefaultConnect">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.Open">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.Close">
</OBJECT>
</TD></TR></TABLE>


<font face="verdana,arial,helvetica" size="2">
<H1><A NAME="_core_recordset.3a_.creating_and_closing_recordsets_.28.odbc.29"></A>Recordset: Creating and Closing Recordsets (ODBC) </H1>

<P><A HREF="JavaScript:hhobj_1.Click()">Home</A>  |&nbsp; <A HREF="_core_databases.3a_.overview.htm">Overview</A>  |&nbsp; <A HREF="_core_odbc_database_tasks.htm">How Do I</A>  |&nbsp; <A HREF="_core_databases.3a_.frequently_asked_questions.htm">FAQ</A>  |&nbsp; <A HREF="_core_odbc_database_sample_list.htm">Sample</A>  |&nbsp; <A HREF="JavaScript:hhobj_2.Click()">Tutorial</A>  |&nbsp; <A HREF="_core_odbc_driver_list.htm">ODBC Driver List</A></P>

<P>This article applies to the MFC ODBC classes. For DAO recordsets, see the article <A HREF="_core_dao_recordset.htm">DAO Recordset</A>.</P>

<P>To use a recordset, construct a recordset object, then call its <B>Open</B> member function to run the recordset’s query and select records. When you finish with the recordset, close and destroy the object.</P>

<P>This article explains:

<UL type=disc>
	<LI><A HREF="#_core_creating_recordsets_at_run_time">When and how to create a recordset object</A> .<BR><BR></LI>

	<LI><A HREF="#_core_setting_recordset_options">When and how you can qualify the recordset’s behavior by parameterizing, filtering, sorting, or locking it</A>.<BR><BR></LI>

	<LI><A HREF="#_core_closing_a_recordset">When and how to close a recordset object</A>.</LI>
</UL>

<H2><A NAME="_core_creating_recordsets_at_run_time"></A>Creating Recordsets at Run Time</H2>

<P>Before you can create recordset objects in your program, you typically write application-specific recordset classes. For more information on this preliminary step, see the article <A HREF="_core_classwizard.3a_.creating_a_recordset_class.htm">ClassWizard: Creating a Recordset Class</A>.</P>

<P>Open a dynaset or snapshot object when you need to select records from a data source. The type of object to create depends on what you need to do with the data in your application and on what your ODBC driver supports. For more information, see the articles <A HREF="_core_dynaset.htm">Dynaset</A> and <A HREF="_core_snapshot.htm">Snapshot</A>. </P>

<P class=label><B><A NAME="_core_to_open_a_recordset"></A>To open a recordset</B>

<OL>
	<LI>Construct an object of your <B>CRecordset</B>-derived class.
<P class=tl>You can construct the object on the heap or on the stack frame of a function.</P></LI>

	<LI>Optionally modify the default recordset behavior. For the available options, see <A HREF="#_core_setting_recordset_options">Setting Recordset Options</A>.<BR><BR></LI>

	<LI>Call the object’s <A HREF="JavaScript:hhobj_3.Click()">Open</A> member function.</LI>
</OL>

<P>In the constructor, pass a pointer to a <B>CDatabase</B> object, or pass <B>NULL</B> to use a temporary database object that the framework will construct and open based on the connection string returned by the <A HREF="JavaScript:hhobj_4.Click()">GetDefaultConnect</A> member function. The <B>CDatabase</B> object may or may not already be connected to a data source.</P>

<P>The call to <B>Open</B> uses SQL to select records from the data source. The first record selected (if any) is the “current record”. The values of this record’s fields are stored in the recordset object’s field data members. If any records were selected, both the <B>IsBOF</B> and <B>IsEOF</B> member functions return 0.</P>

<P>In your <A HREF="JavaScript:hhobj_5.Click()">Open</A> call, you can:

<UL type=disc>
	<LI>Specify whether the recordset is a dynaset or snapshot. Recordsets open as snapshots by default. Or you can specify a forward-only recordset, which allows only forward scrolling, one record at a time. 
<P class=tl>By default, a recordset uses the default type stored in the <B>CRecordset</B> data member <B>m_nDefaultType</B>. Wizards write code to initialize <B>m_nDefaultType</B> to the recordset type you choose in the wizard. Rather than accepting this default, you can substitute another recordset type.</P></LI>

	<LI>Specify a string to replace the default SQL <B>SELECT</B> statement that the recordset constructs.<BR><BR></LI>

	<LI>Specify whether the recordset is read-only or append-only. Recordsets allow full updating by default, but you can limit that to adding new records only or you can disallow all updates.</LI>
</UL>

<P>The following example shows how to open a read-only snapshot object of class <CODE>CStudentSet</CODE>, an application-specific class:</P>

<PRE><CODE>// Construct the snapshot object
CStudentSet rsStudent( NULL );
// Set options if desired, then open the recordset
if(!rsStudent.Open(CRecordset::snapshot, NULL, CRecordset::readOnly))
    return FALSE;
// Use the snapshot to operate on its records...
</CODE></PRE>

<P>After you call <B>Open</B>, use the member functions and data members of the object to work with the records. In some cases, you may want to requery or refresh the recordset to include changes that have occurred on the data source. See the article <A HREF="_core_recordset.3a_.requerying_a_recordset_.28.odbc.29.htm">Recordset: Requerying a Recordset (ODBC)</A>. </P>

<P class=indent><B><B>Tip&nbsp;&nbsp;&nbsp;</B></B>The connect string you use during development might not be the same connect string that your eventual users need. For ideas about generalizing your application in this regard, see the article <A HREF="_core_data_source.3a_.managing_connections_.28.odbc.29.htm">Data Source: Managing Connections (ODBC)</A>. </P>



<H2><A NAME="_core_setting_recordset_options"></A>Setting Recordset Options</H2>

<P>After you construct your recordset object but before you call <B>Open</B> to select records, you may want to set some options to control the recordset’s behavior. For all recordsets, you can:

<UL type=disc>
	<LI>Specify a <A HREF="_core_recordset.3a_.filtering_records_.28.odbc.29.htm">filter</A> to constrain record selection.&nbsp; <BR><BR></LI>

	<LI>Specify a <A HREF="_core_recordset.3a_.sorting_records_.28.odbc.29.htm">sort</A> order for the records. <BR><BR></LI>

	<LI>Specify <A HREF="_core_recordset.3a_.parameterizing_a_recordset_.28.odbc.29.htm">parameters</A> so you can select records using information obtained or calculated at run time. </LI>
</UL>

<P>You can also set the following option if conditions are right:

<UL type=disc>
	<LI>If the recordset is updatable and supports locking options, specify the <A HREF="_core_recordset.3a_.locking_records_.28.odbc.29.htm">locking</A> method used for updates.&nbsp; </LI>
</UL>

<P class=indent><B><B>Important</B></B>&nbsp;&nbsp;&nbsp;To affect record selection, you must set these options before you call the <B>Open</B> member function.</P>



<H2><A NAME="_core_closing_a_recordset"></A>Closing a Recordset</H2>

<P>When you finish with your recordset, you must dispose of it and deallocate its memory.</P>

<P class=label><B><A NAME="_core_to_close_a_recordset"></A>To close a recordset</B>

<OL>
	<LI>Call its <A HREF="JavaScript:hhobj_6.Click()">Close</A> member function.<BR><BR></LI>

	<LI>Destroy the recordset object.
<P class=tl>If you declared it on the stack frame of a function, the object is destroyed automatically when the object goes out of scope. Otherwise, use the <B>delete</B> operator.</P></LI>
</OL>

<P><B>Close</B> frees the recordset’s <B>HSTMT</B> handle. It doesn’t destroy the C++ object. </P>

<P><B>See Also</B>&nbsp;&nbsp;&nbsp;<A HREF="_core_recordset.3a_.scrolling_.28.odbc.29.htm">Recordset: Scrolling (ODBC)</A>, <A HREF="_core_recordset.3a_.adding.2c_.updating.2c_.and_deleting_records_.28.odbc.29.htm">Recordset: Adding, Updating, and Deleting Records (ODBC)</A> </P>
</font>
</BODY>
</HTML>
