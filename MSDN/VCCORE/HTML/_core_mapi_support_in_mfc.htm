<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>MAPI Support in MFC</TITLE>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_vc_addpf_home">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CDocument.3a3a.OnFileSendMail">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CDocument.3a3a.OnUpdateFileSendMail">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_COleDocument.3a3a.OnFileSendMail">
</OBJECT>
</TD></TR></TABLE>


<font face="verdana,arial,helvetica" size="2">
<H1><A NAME="_core_mapi_support_in_mfc"></A>MAPI Support in MFC</H1>

<P><A HREF="JavaScript:hhobj_1.Click()">Home</A>  |&nbsp; <A HREF="_core_mapi.2c_.enabling_your_program_for_mail.3a_.overview.htm">Overview</A>  |&nbsp; <A HREF="_core_mail.2d.enabling_tasks_.28.mapi.29.htm">How Do I</A>  |&nbsp; <A HREF="_core_mapi_sample_list.htm">Sample</A></P>

<P>MFC supplies support for a subset of the Microsoft Messaging Application Program Interface (MAPI) in class <B>CDocument</B>. Specifically, <B>CDocument</B> has member functions that determine whether mail support is present on the end-user’s machine and, if so, enable a Send Mail command whose standard command ID is <B>ID_FILE_SEND_MAIL</B>. The MFC handler function for this command allows the user to send a document via electronic mail.</P>

<P class=indent><B><B>Tip</B></B>&nbsp;&nbsp;&nbsp;Although MFC does not encapsulate the entire MAPI function set, you can still call MAPI functions directly, just as you can call Win32 API functions directly from MFC programs.</P>

<P>Providing the Send Mail command in your application is very easy. MFC provides the implementation to package a document (that is, a <B>CDocument</B>-derived object) as an attachment and send it as mail. This attachment is equivalent to a File Save command that saves (serializes) the document’s contents to the mail message. This implementation calls upon the mail client on the user’s machine to give the user the opportunity to address the mail and to add subject and message text to the mail message. Users see their familiar mail application’s user interface. This functionality is supplied by two <B>CDocument</B> member functions: <B>OnFileSendMail</B> and <B>OnUpdateFileSendMail</B>.</P>

<P>MAPI needs to read the file to send the attachment. If the application keeps its data file open during an <B>OnFileSendMail</B> function call, the file needs to be opened with a share mode that allows multiple processes to access the file.</P>

<P class=indent><B><B>Note</B></B>&nbsp;&nbsp;&nbsp;An overriding version of <B>OnFileSendMail</B> for class <B>COleDocument</B> correctly handles compound documents.</P>

<P class=label><B>To implement a Send Mail command with MFC</B>

<OL>
	<LI>Use the Visual C++ menu editor to add a menu item whose command ID is <B>ID_FILE_SEND_MAIL</B>.
<P class=tl>This command ID is provided by the framework in AFXRES.H. The command can be added to any menu, but it is usually added to the <B>File </B>menu.</P></LI>

	<LI>Manually add the following to your document’s message map: 
<PRE><CODE>ON_COMMAND(ID_FILE_SEND_MAIL, OnFileSendMail)
ON_UPDATE_COMMAND_UI(ID_FILE_SEND_MAIL, OnUpdateFileSendMail)
</CODE></PRE>

<P class=tl>Place the new lines outside of the special “//{{AFX” comments.</P>
<P class=atl><B><B>Note</B></B>&nbsp;&nbsp;&nbsp;This message map works for a document derived from either <B>CDocument</B> or <B>ColeDocument</B> — it picks up the correct base class in either case, even though the message map is in your derived document class.</p></LI>

	<LI>Build your application.</LI>
</OL>

<P>If mail support is available, MFC enables your menu item with <B>OnUpdateFileSendMail</B> and subsequently processes the command with <B>OnFileSendMail</B>. If mail support is not available, MFC automatically removes your menu item so the user will not see it.</P>

<P class=indent><B><B>Tip</B></B>&nbsp;&nbsp;&nbsp;Rather than manually adding message map entries as described above, you can use ClassWizard to add them, although the method is indirect. To use ClassWizard, add an <CODE>OnFileSendMail</CODE> command handler and an <CODE>OnUpdateFileSendMail</CODE> command update handler as you normally would. This gives you two empty handlers that effectively override the <B>OnFileSendMail</B> and <B>OnUpdateFileSendMail</B> handlers in <B>CDocument</B>, which contain the MAPI implementations. To use those implementations, call the base-class versions of <B>OnFileSendMail</B> and <B>OnUpdateFileSendMail</B> in your new handlers. While this approach works,&nbsp; manually adding the message map entries, as described in the procedure above, is quicker and more direct.</P>

<P class=indent>Note also that the MFC AppWizard lets you select an option that adds MAPI support directly to your new MFC application. If you use that option, you can skip steps 1 and 2 above.</P>

<P>For related information, see <A HREF="_core_mapi_topics.htm">MAPI Topics</A>. </P>

<H3>What do you want to do?</H3>

<UL type=disc>
	<LI>Learn more about the <B>CDocument</B> member functions that enable MAPI:
<UL type=disc>
	<LI><A HREF="JavaScript:hhobj_2.Click()">CDocument::OnFileSendMail</A><BR><BR></LI>

	<LI><A HREF="JavaScript:hhobj_3.Click()">CDocument::OnUpdateFileSendMail</A><BR><BR></LI>

	<LI><A HREF="JavaScript:hhobj_4.Click()">COleDocument::OnFileSendMail</A> </LI>
</UL>
</LI>
</UL>
</font>
</BODY>
</HTML>
