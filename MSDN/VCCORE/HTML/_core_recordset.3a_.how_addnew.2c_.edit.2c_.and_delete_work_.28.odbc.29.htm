<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Recordset: How AddNew, Edit, and Delete Work (ODBC)</TITLE>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_vc_addpf_home">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="Enroll tutorial">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CRecordset.3a3a.AddNew">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CRecordset.3a3a.Update">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CRecordset.3a3a.SetFieldDirty">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CRecordset.3a3a.Edit">
</OBJECT>
<OBJECT ID="hhobj_7" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CRecordset.3a3a.Update">
</OBJECT>
<OBJECT ID="hhobj_8" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CRecordset.3a3a.Delete">
</OBJECT>
</TD></TR></TABLE>


<font face="verdana,arial,helvetica" size="2">
<H1><A NAME="_core_recordset.3a_.how_addnew.2c_.edit.2c_.and_delete_work_.28.odbc.29"></A>Recordset: How AddNew, Edit, and Delete Work (ODBC)</H1>

<P><A HREF="JavaScript:hhobj_1.Click()">Home</A>  |&nbsp; <A HREF="_core_databases.3a_.overview.htm">Overview</A>  |&nbsp; <A HREF="_core_odbc_database_tasks.htm">How Do I</A>  |&nbsp; <A HREF="_core_databases.3a_.frequently_asked_questions.htm">FAQ</A>  |&nbsp; <A HREF="_core_odbc_database_sample_list.htm">Sample</A>  |&nbsp; <A HREF="JavaScript:hhobj_2.Click()">Tutorial</A>  |&nbsp; <A HREF="_core_odbc_driver_list.htm">ODBC Driver List</A></P>

<P>This article applies to the MFC ODBC classes. For DAO recordsets, see the article <A HREF="_core_dao_recordset.htm">DAO Recordset</A>.</P>

<P>This article explains how the <B>AddNew</B>, <B>Edit</B>, and <B>Delete</B> member functions of class <B>CRecordset</B> work. Topics covered include:

<UL type=disc>
	<LI><A HREF="#_core_adding_a_record">How adding records works</A><BR><BR></LI>

	<LI><A HREF="#_core_visibility_of_added_records">Visibility of added records</A><BR><BR></LI>

	<LI><A HREF="#_core_editing_an_existing_record">How editing records works</A><BR><BR></LI>

	<LI><A HREF="#_core_deleting_a_record">How deleting records works</A></LI>
</UL>

<P class=indent><B><B>Note&nbsp;&nbsp;&nbsp;</B></B>This article applies to objects derived from <B>CRecordset</B> in which bulk row fetching has not been implemented. If you are using bulk row fetching, see the article <A HREF="_core_recordset.3a_.fetching_records_in_bulk_.28.odbc.29.htm">Recordset: Fetching Records in Bulk (ODBC)</A>.</P>

<P>As a supplement, you might want to read the article <A HREF="_core_record_field_exchange.3a_.how_rfx_works.htm">Record Field Exchange: How RFX Works</A>, which describes the corresponding role of RFX in update operations.</P>



<H2><A NAME="_core_adding_a_record"></A>Adding a Record</H2>

<P>Adding a new record to a recordset involves calling the recordset’s <A HREF="JavaScript:hhobj_3.Click()">AddNew</A> member function, setting the values of the new record’s field data members, and calling the <A HREF="JavaScript:hhobj_4.Click()">Update</A> member function to write the record to the data source. </P>

<P>As a precondition for calling <B>AddNew</B>, the recordset must not have been opened as read-only. The <B>CanUpdate</B> and <B>CanAppend</B> member functions let you determine these conditions.</P>

<P>When you call <B>AddNew</B>:

<OL>
	<LI>The record in the edit buffer is stored, so its contents can be restored if the operation is canceled.<BR><BR></LI>

	<LI>The field data members are flagged so it will be possible to detect changes in them later. The field data members are also marked “clean” (unchanged) and set to a Null. </LI>
</OL>

<P>After you call <B>AddNew</B>, the edit buffer represents a new, empty record, ready to be filled in with values. To do this, you manually set the values by assigning to them. Instead of specifying an actual data value for a field, you can call <B>SetFieldNull</B> to specify the value Null. </P>

<P>To commit your changes, you call <B>Update</B>.</P>

<P>When you call <B>Update</B> for the new record:

<UL type=disc>
	<LI>If your ODBC driver supports the <B>::SQLSetPos</B> ODBC API function, MFC uses the function to add the record on the data source. With <B>::SQLSetPos</B>, MFC can add a record more efficiently because it doesn’t have to construct and process an SQL statement.<BR><BR></LI>

	<LI>If <B>::SQLSetPos</B> can’t be used, MFC does the following:</LI>
</UL>

<OL>
	<LI>If no changes are detected, <B>Update</B> does nothing and returns 0.<BR><BR></LI>

	<LI>If there are changes, <B>Update</B> constructs an SQL <B>INSERT</B> statement. The columns represented by all dirty field data members are listed in the <B>INSERT</B> statement. To force a column to be included, call the <A HREF="JavaScript:hhobj_5.Click()">SetFieldDirty</A> member function: 
<PRE><CODE>SetFieldDirty( &amp;m_dataMember, TRUE );
</CODE></PRE>
</LI>

	<LI><B>Update</B> commits the new record — the <B>INSERT</B> statement&nbsp; is executed and the record is committed to the table on the data source (and the recordset, if not a snapshot)&nbsp; unless a transaction is in progress (see <A HREF="_core_recordset.3a_.more_about_updates_.28.odbc.29.htm#_core_how_transactions_affect_updates">How Transactions Affect Updates</A> in the article Recordset: More About Updates).<BR><BR></LI>

	<LI>The stored record is restored to the edit buffer. The record that was current before the <B>AddNew</B> call is current again regardless of whether the <B>INSERT</B> statement was successfully executed.</LI>
</OL>

<P class=indent><B><B>Tip&nbsp;&nbsp;&nbsp;</B></B>For complete control of a new record, take the following approach: (a) set the values of any fields that will have values; (b) explicitly set any fields that will remain Null by calling <B>SetFieldNull</B> with a pointer to the field and the parameter <B>TRUE</B> (the default). If you want to ensure that a field is not written to the data source, call <B>SetFieldDirty</B> with a pointer to the field and the parameter <B>FALSE</B>, and do not modify the field’s value. To determine whether a field is allowed to be Null, call <B>IsFieldNullable</B>.</P>

<P class=indent><B><B>Tip&nbsp;&nbsp;&nbsp;</B>Advanced</B>: To detect when recordset data members change value, MFC uses a <B>PSEUDO_NULL</B> value appropriate to each data type that you can store in a recordset. If you must explicitly set a field to the <B>PSEUDO_NULL</B> value and the field happens already to be marked Null, you must also call <B>SetFieldNull</B>, passing the address of the field in the first parameter and <B>FALSE</B> in the second parameter. </P>

<H2><A NAME="_core_visibility_of_added_records"></A>Visibility of Added Records</H2>

<P>When is an added record visible to your recordset? Added records sometimes show up and sometimes aren’t visible, depending on two things:

<UL type=disc>
	<LI>What your driver is capable of.<BR><BR></LI>

	<LI>What the framework can take advantage of.</LI>
</UL>

<P>If your ODBC driver supports the <B>::SQLSetPos</B> ODBC API function, MFC uses the function to add records. With <B>::SQLSetPos</B>, added records are visible to any updatable MFC recordset. Without support for the function, added records are not visible, and you must call <B>Requery</B> to see them. Using <B>::SQLSetPos</B> is also more efficient.</P>



<H2><A NAME="_core_editing_an_existing_record"></A>Editing an Existing Record</H2>

<P>Editing an existing record in a recordset involves scrolling to the record, calling the recordset’s <A HREF="JavaScript:hhobj_6.Click()">Edit</A> member function, setting the values of the new record’s field data members, and calling the <A HREF="JavaScript:hhobj_7.Click()">Update</A> member function to write the changed record to the data source.</P>

<P>As a precondition for calling <B>Edit</B>, the recordset must be updatable and on a record. The <B>CanUpdate</B> and <B>IsDeleted</B> member functions let you determine these conditions. The current record also must not already have been deleted, and there must be records in the recordset (both <B>IsBOF</B> and <B>IsEOF</B> return 0).</P>

<P>When you call <B>Edit</B>, the record in the <A HREF="_core_recordset.3a_.how_recordsets_update_records_.28.odbc.29.htm#_core_the_edit_buffer">edit buffer</A> (the current record) is stored. The stored record’s values are later used to detect whether any fields have changed. </P>

<P>After you call <B>Edit</B>, the edit buffer still represents the current record but is now ready to accept changes to the field data members. To change the record, you manually set the values of any field data members you want to edit. Instead of specifying an actual data value for a field, you can call <B>SetFieldNull</B> to specify the value Null. To commit your changes, call <B>Update</B>.</P>

<P class=indent><B><B>Tip&nbsp;&nbsp;&nbsp;</B></B>To get out of <B>AddNew</B> or <B>Edit</B> mode, call <B>Move</B> with the parameter <B>AFX_MOVE_REFRESH</B>.</P>

<P>As a precondition for calling <B>Update</B>, the recordset must not be empty and the current record must not have been deleted. <B>IsBOF</B>, <B>IsEOF</B>, and <B>IsDeleted</B> should all return 0.</P>

<P>When you call <B>Update</B> for the edited record:

<UL type=disc>
	<LI>If your ODBC driver supports the <B>::SQLSetPos</B> ODBC API function, MFC uses the function to update the record on the data source. With <B>::SQLSetPos</B>, the driver compares your edit buffer with the corresponding record on the server, updating the record on the server if the two are different. With <B>::SQLSetPos</B>, MFC can update a record more efficiently because it doesn’t have to construct and process an SQL statement.
<P class=tl>-or-</P></LI>

	<LI>If <B>::SQLSetPos</B> can’t be used, MFC does the following:</LI>
</UL>

<OL>
	<LI>If there have been no changes, <B>Update</B> does nothing and returns 0.<BR><BR></LI>

	<LI>If there are changes, <B>Update</B> constructs an SQL <B>UPDATE</B> statement. The columns listed in the <B>UPDATE</B> statement are based on the field data members that have changed.<BR><BR></LI>

	<LI><B>Update</B> commits the changes — executes the <B>UPDATE</B> statement — and the record is changed on the data source, but not committed if a transaction is in progress (see the article <A HREF="_core_transaction.3a_.performing_a_transaction_in_a_recordset_.28.odbc.29.htm">Transaction: Performing a Transaction in a Recordset (ODBC)</A> for details about how the transaction affects the update). ODBC keeps a copy of the record, which also changes.<BR><BR></LI>

	<LI>Unlike the process for <B>AddNew</B>, the <B>Edit</B> process does not restore the stored record. The edited record remains in place as the current record.</LI>
</OL>

<P class=indent><B><B>Caution&nbsp;&nbsp;&nbsp;</B></B>When you prepare to update a recordset by calling <B>Update</B>, take care that your recordset includes all columns making up the primary key of the table (or all of the columns of any unique index on the table, or enough columns to uniquely identify the row). In some cases, the framework can use only the columns selected in your recordset to identify which record in your table to update. Without all the necessary columns, multiple records may be updated in the table. In this case, the framework will throw exceptions when you call <B>Update</B>.</P>

<P class=indent><B><B>Tip&nbsp;&nbsp;&nbsp;</B></B>If you call <B>AddNew</B> or <B>Edit</B> after having called either function previously but before you call <B>Update</B>, the edit buffer is refreshed with the stored record, replacing the new or edited record in progress. This behavior gives you a way to abort an <B>AddNew</B> or <B>Edit</B> and begin a new one: if you determine that the record-in-progress is faulty, simply call <B>Edit</B> or <B>AddNew</B> again.</P>



<H2><A NAME="_core_deleting_a_record"></A>Deleting a Record</H2>

<P>Deleting a record from a recordset involves scrolling to the record and calling the recordset’s <A HREF="JavaScript:hhobj_8.Click()">Delete</A> member function. Unlike <B>AddNew</B> and <B>Edit</B>, <B>Delete</B> does not require a matching call to <B>Update</B>.</P>

<P>As a precondition for calling <B>Delete</B>, the recordset must be updatable and it must be on a record. The <B>CanUpdate</B>, <B>IsBOF</B>, <B>IsEOF</B>, and <B>IsDeleted</B> member functions let you determine these conditions.</P>

<P>When you call <B>Delete</B>:

<UL type=disc>
	<LI>If your ODBC driver supports the <B>::SQLSetPos</B> ODBC API function, MFC uses the function to delete the record on the data source. Using <B>::SQLSetPos</B> is usually more efficient than using SQL.
<P class=tl>-or-</P></LI>

	<LI>If <B>::SQLSetPos</B> can’t be used, MFC does the following:</LI>
</UL>

<OL>
	<LI>The current record in the <A HREF="_core_recordset.3a_.how_recordsets_update_records_.28.odbc.29.htm#_core_the_edit_buffer">edit buffer</A> is not backed up as in <B>AddNew</B> and <B>Edit</B>.<BR><BR></LI>

	<LI><B>Delete</B> constructs an SQL <B>DELETE</B> statement that will remove the record.
<P class=tl>The current record in the edit buffer is not stored as in <B>AddNew</B> and <B>Edit</B>.</P></LI>

	<LI><B>Delete</B> commits the deletion — executes the <B>DELETE</B> statement. The record is marked deleted on the data source and, if the record is a snapshot, in ODBC. <BR><BR></LI>

	<LI>The deleted record’s values are still in the field data members of the recordset, but the field data members are marked Null and the recordset’s <B>IsDeleted</B> member function will return a nonzero value. </LI>
</OL>

<P class=indent><B><B>Important&nbsp;&nbsp;&nbsp;</B></B>After deleting a record, you should scroll to another record to refill the edit buffer with the new record’s data. It’s an error to call <B>Delete</B> again, or to call <B>Edit</B>.</P>

<P>For information about the SQL statements used in update operations, see the article <A HREF="_core_sql.htm">SQL</A>. </P>

<P><B>See Also</B>&nbsp;&nbsp;&nbsp;<A HREF="_core_recordset.3a_.more_about_updates_.28.odbc.29.htm">Recordset: More About Updates (ODBC)</A>, <A HREF="_core_record_field_exchange_.28.rfx.29.htm">Record Field Exchange</A> </P>
</font>
</BODY>
</HTML>
