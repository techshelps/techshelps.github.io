<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Data Objects and Data Sources: Creation and Destruction</TITLE>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_vc_addpf_home">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_sample_mfc_OCLIENT">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_sample_mfc_OCLIENT">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_sample_mfc_HIERSVR">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_COleDataObject">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_COleDataSource">
</OBJECT>
</TD></TR></TABLE>


<font face="verdana,arial,helvetica" size="2">
<H1><A NAME="_core_data_objects_and_data_sources.3a_.creation_and_destruction"></A>Data Objects and Data Sources: Creation and Destruction</H1>

<P><A HREF="JavaScript:hhobj_1.Click()">Home</A>  |&nbsp; <A HREF="_core_ole_in_mfc.3a_.overview.htm">Overview</A>  |&nbsp; <A HREF="_core_ole_tasks.htm">How Do I</A>  |&nbsp; <A HREF="_core_ole_sample_list.htm">Sample</A>  |&nbsp; <A HREF="_core_ole_tutorial_list.htm">Tutorial</A></P>

<P>As explained in the article <A HREF="_core_data_objects_and_data_sources_.28.ole.29.htm">Data Objects and Data Sources (OLE)</A>, data objects and data sources represent both sides of a data transfer. This article explains when to create and destroy these objects and sources to perform your data transfers properly. Topics include:

<UL type=disc>
	<LI><A HREF="#_core_creating_data_objects">Creating data objects</A><BR><BR></LI>

	<LI><A HREF="#_core_destroying_data_objects">Destroying data objects</A><BR><BR></LI>

	<LI><A HREF="#_core_creating_data_sources">Creating data sources</A><BR><BR></LI>

	<LI><A HREF="#_core_destroying_data_sources">Destroying data sources</A></LI>
</UL>



<H2><A NAME="_core_creating_data_objects"></A>Creating Data Objects</H2>

<P>Data objects are used by the destination application — either the client or the server. A data object in the destination application is one end of a connection between the source application and the destination application. A data object in the destination application is used to access and interact with the data in the data source. </P>

<P>There are two common situations where a data object is needed. The first is when data is dropped in your application using drag and drop. The second is when Paste or Paste Special is chosen from the Edit Menu. </P>

<P>In a drag-and-drop situation, you do not need to create a data object. A pointer to an existing data object will be passed to your <B>OnDrop</B> function. This data object is created by the framework as part of the drag-and-drop operation and will also be destroyed by it. This is not always the case when pasting is done by another method. For more information, see <A HREF="#_core_destroying_data_objects">Destroying Data Objects</A>. </P>

<P>If the application is performing a paste or paste special operation, you should create a <B>COleDataObject</B> object and call its <B>AttachClipboard</B> member function. This associates the data object with the data on the Clipboard. You can then use this data object in your paste function.</P>

<P>For an example of how this is done, see the <B>DoPasteItem</B> function in the MAINVIEW.CPP file that is part of the MFC OLE sample <A HREF="JavaScript:hhobj_2.Click()">OCLIENT</A>. OCLIENT implements a function that performs all paste operations and calls <B>DoPasteItem</B> from its <B>OnDrop</B>, <B>OnPaste</B>, and <B>OnPasteLink</B> functions. Because <B>OnDrop</B> has a pointer to a data object passed to it, it passes the pointer on to <B>DoPasteItem</B>. <B>OnPaste</B> and <B>OnPasteLink</B> pass <B>NULL</B> for this parameter, telling <B>DoPasteItem</B> to create a data object and attach it to the Clipboard. This scheme separates your paste code so you only have to debug it in one place, but you can still use it for both kinds of paste operations. </P>



<H2><A NAME="_core_destroying_data_objects"></A>Destroying Data Objects</H2>

<P>If you follow the scheme described in <A HREF="#_core_creating_data_objects">Creating Data Objects</A>, destroying data objects is a trivial aspect of data transfers. The data object that was created in your paste function will be destroyed by MFC when your paste function returns.</P>

<P>If you follow another method of handling paste operations, make sure the data object is destroyed after your paste operation is complete. Until the data object is destroyed, it will be impossible for any application to successfully copy data to the Clipboard.</P>



<H2><A NAME="_core_creating_data_sources"></A>Creating Data Sources</H2>

<P>Data sources are used by the source of the data transfer — which can be either the client or the server side of the data transfer. A data source in the source application is one end of a connection between the source application and the destination application. A data object in the destination application is used to interact with the data in the data source.</P>

<P>Data sources are created when an application needs to copy data to the Clipboard. A typical scenario runs like this:

<OL>
	<LI>The user selects some data.<BR><BR></LI>

	<LI>The user chooses <B>Copy </B>(or <B>Cut</B>) from the <B>Edit </B>menu or begins a drag-and-drop operation.<BR><BR></LI>

	<LI>Depending on the design of the program, the application creates either a <B>COleDataSource</B> object or an object from a class derived from <B>COleDataSource</B>.<BR><BR></LI>

	<LI>The selected data is inserted into the data source by calling one of the functions in the <B>COleDataSource::CacheData</B> or <B>COleDataSource::DelayRenderData</B> groups.<BR><BR></LI>

	<LI>The application calls the <B>SetClipboard</B> member function (or the <B>DoDragDrop</B> member function if this is a drag-and-drop operation) belonging to the object created in step 3.<BR><BR></LI>

	<LI>If this is a <B>Cut </B>operation or <B>DoDragDrop</B> returns <B>DROPEFFECT_MOVE</B>, the data selected in step 1 is deleted from the document.</LI>
</OL>

<P>This scenario is implemented by the MFC OLE samples <A HREF="JavaScript:hhobj_3.Click()">OCLIENT</A> and <A HREF="JavaScript:hhobj_4.Click()">HIERSVR</A>. Look at the source for each application’s <B>CView</B>-derived class for all but the <B>GetClipboardData</B> and <B>OnGetClipboardData</B> functions. These two functions are in either the <B>COleClientItem</B> or <B>COleServerItem</B>-derived class implementations. These sample programs provide a good example of how to implement these concepts. </P>

<P>One other situation in which you might want to create a <B>COleDataSource</B> object occurs if you are modifying the default behavior of a drag-and-drop operation. For more information, see the <A HREF="_core_drag_and_drop.3a_.customizing.htm">Drag and Drop: Customizing</A> article.</P>



<H2><A NAME="_core_destroying_data_sources"></A>Destroying Data Sources</H2>

<P>Data sources must be destroyed by the application currently responsible for them. In situations where you hand the data source to OLE, such as calling <B>COleDataSource::SetClipboard</B>, you do not have to worry about destroying it because it will be destroyed by OLE. If you do not hand your data source to OLE, then you are responsible for destroying it, as with any typical C++ object.</P>

<H3>What do you want to know more about?</H3>

<UL type=disc>
	<LI><A HREF="_core_drag_and_drop_.28.ole.29.htm">Drag and drop</A><BR><BR></LI>

	<LI><A HREF="_core_clipboard.3a_.overview.htm">Clipboard</A><BR><BR></LI>

	<LI><A HREF="_core_data_objects_and_data_sources.3a_.manipulation.htm">Manipulating data objects and data sources</A></LI>
</UL>

<P><B>See Also</B>&nbsp;&nbsp;&nbsp;<A HREF="JavaScript:hhobj_5.Click()">COleDataObject</A>, <A HREF="JavaScript:hhobj_6.Click()">COleDataSource</A></P>
</font>
</BODY>
</HTML>
