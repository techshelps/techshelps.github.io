<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Servers: Server Items</TITLE>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_vc_addpf_home">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_sample_mfc_HIERSVR">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_sample_mfc_HIERSVR">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CView.3a3a.OnDraw">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_COleServerItem.3a3a.OnDraw">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_sample_mfc_HIERSVR">
</OBJECT>
<OBJECT ID="hhobj_7" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CView.3a3a.OnDraw">
</OBJECT>
<OBJECT ID="hhobj_8" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_COleServerItem">
</OBJECT>
<OBJECT ID="hhobj_9" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_COleServerItem.3a3a.OnDraw">
</OBJECT>
<OBJECT ID="hhobj_10" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_COleServerDoc.3a3a.OnGetEmbeddedItem">
</OBJECT>
</TD></TR></TABLE>


<font face="verdana,arial,helvetica" size="2">
<H1><A NAME="_core_servers.3a_.server_items"></A>Servers: Server Items</H1>

<P><A HREF="JavaScript:hhobj_1.Click()">Home</A>  |&nbsp; <A HREF="_core_ole_in_mfc.3a_.overview.htm">Overview</A>  |&nbsp; <A HREF="_core_ole_tasks.htm">How Do I</A>  |&nbsp; <A HREF="_core_ole_sample_list.htm">Sample</A>  |&nbsp; <A HREF="_core_ole_tutorial_list.htm">Tutorial</A></P>

<P>When a container launches a server so that a user can edit an embedded or linked OLE item, the server application creates a “server item.” The server item, which is an object of a class derived from <B>COleServerItem</B>, provides an interface between the server document and the container application.</P>

<P>The <B>COleServerItem</B> class defines several overridable member functions that are called by OLE, usually in response to requests from the container. Server items can represent part of the server document or the entire document. When an OLE item is embedded in the container document, the server item represents the entire server document. When the OLE item is linked, the server item can represent a part of the server document or the whole document, depending on whether the link is to a part or to the whole.</P>

<P>In the HIERSVR sample, for example, the server-item class, <B>CServerItem</B>, has a member that is a pointer to an object of the class <B>CServerNode</B>. The <B>CServerNode</B> object is a node in the HIERSVR application’s document, which is a tree. When the <B>CServerNode</B> object is the root node, the <B>CServerItem</B> object represents the whole document. When the <B>CServerNode</B> object is a child node, the <B>CServerItem</B> object represents a part of the document. See the MFC OLE sample <A HREF="JavaScript:hhobj_2.Click()">HIERSVR</A> for an example of this interaction.</P>



<H2><A NAME="_core_implementing_server_items"></A>Implementing Server Items</H2>

<P>If you use AppWizard to produce “starter” code for your application, all you have to do to include server items in your starter code is to choose one of the server options from the OLE Options page. If you’re adding server items to an existing application, perform the following steps:</P>

<P class=label><B>To implement a server item</B>

<OL>
	<LI>Derive a class from <B>COleServerItem</B>.<BR><BR></LI>

	<LI>In your derived class, override the <B>OnDraw</B> member function.
<P class=tl>The framework calls <B>OnDraw</B> to render the OLE item into a metafile. The container application uses this metafile to render the item. Your application’s view class also has an <B>OnDraw</B> member function, which is used to render the item when the server application is active. </P></LI>

	<LI>Implement an override of <B>OnGetEmbeddedItem</B> for your server-document class. For further information, see the article <A HREF="_core_servers.3a_.implementing_server_documents.htm">Servers: Implementing Server Documents</A> and the MFC OLE sample <A HREF="JavaScript:hhobj_3.Click()">HIERSVR</A>.<BR><BR></LI>

	<LI>Implement your server-item class’s <B>OnGetExtent</B> member function. The framework calls this function to retrieve the size of the item. The default implementation does nothing.</LI>
</OL>



<H2><A NAME="_core_a_tip_for_server.2d.item_architecture"></A>A Tip for Server-Item Architecture</H2>

<P>As noted in <A HREF="#_core_implementing_server_items">Implementing Server Items</A>, server applications must be able to render items both in the server’s view and in a metafile used by the container application. In the Microsoft Foundation Class Library’s application architecture, the view class’s <B>OnDraw</B> member function renders the item when it is being edited (see <A HREF="JavaScript:hhobj_4.Click()">CView::OnDraw</A> in the <I>Class Library Reference</I>). The server item’s <B>OnDraw</B> renders the item into a metafile in all other cases (see <A HREF="JavaScript:hhobj_5.Click()">COleServerItem::OnDraw</A>).</P>

<P>You can avoid duplication of code by writing helper functions in your server-document class and calling them from the <B>OnDraw</B> functions in your view and server-item classes. The MFC OLE sample <A HREF="JavaScript:hhobj_6.Click()">HIERSVR</A> uses this strategy: the functions <B>CServerView::OnDraw</B> and <B>CServerItem::OnDraw</B> both call <B>CServerDoc::DrawTree</B> to render the item.</P>

<P>The view and the item both have <B>OnDraw</B> member functions because they draw under different conditions. The view must take into account such factors as zooming, selection size and extent, clipping, and user-interface elements such as scroll bars. The server item, on the other hand, always draws the entire OLE object.</P>

<P>For more information, see <A HREF="JavaScript:hhobj_7.Click()">CView::OnDraw</A>, <A HREF="JavaScript:hhobj_8.Click()">COleServerItem</A>, <A HREF="JavaScript:hhobj_9.Click()">COleServerItem::OnDraw</A>, and <A HREF="JavaScript:hhobj_10.Click()">COleServerDoc::OnGetEmbeddedItem</A> in the <I>Class Library Reference</I>.</P>
</font>
</BODY>
</HTML>
