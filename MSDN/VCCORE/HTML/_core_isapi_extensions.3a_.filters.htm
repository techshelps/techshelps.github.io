<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>ISAPI Extensions: Filters</TITLE>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_vc_addpf_home">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_sample_mfc_MFCUCASE">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CHttpFilter.3a3a.GetFilterVersion">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CHttpFilter.3a3a.HttpFilterProc">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CHttpFilter.3a3a.GetFilterVersion">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_HTTP_FILTER_VERSION_structure">
</OBJECT>
<OBJECT ID="hhobj_7" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CHttpFilter.3a3a.HttpFilterProc">
</OBJECT>
<OBJECT ID="hhobj_8" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CHttpFilter.3a3a.OnSendRawData">
</OBJECT>
<OBJECT ID="hhobj_9" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CHttpFilter.3a3a.OnPreProcHeaders">
</OBJECT>
<OBJECT ID="hhobj_10" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CHttpFilter.3a3a.OnAuthentication">
</OBJECT>
<OBJECT ID="hhobj_11" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CHttpFilter.3a3a.OnUrlMap">
</OBJECT>
<OBJECT ID="hhobj_12" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CHttpFilter.3a3a.OnSendRawData">
</OBJECT>
<OBJECT ID="hhobj_13" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CHttpFilter.3a3a.OnReadRawData">
</OBJECT>
<OBJECT ID="hhobj_14" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CHttpFilter.3a3a.OnLog">
</OBJECT>
<OBJECT ID="hhobj_15" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CHttpFilter.3a3a.OnEndOfNetSession">
</OBJECT>
<OBJECT ID="hhobj_16" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CHttpFilter">
</OBJECT>
<OBJECT ID="hhobj_17" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CHttpFilterContext">
</OBJECT>
</TD></TR></TABLE>


<font face="verdana,arial,helvetica" size="2">
<H1><A NAME="_core_isapi_extensions.3a_.filters"></A>ISAPI Extensions: Filters</H1>

<P><A HREF="JavaScript:hhobj_1.Click()">Home</A>  |&nbsp; <A HREF="_core_internet_support.3a_.overview.htm">Overview</A>  |&nbsp; <A HREF="_core_internet_tasks.htm">How Do I</A></P>

<P>This article describes the benefits of ISAPI filters and how to use them with Internet servers. Topics included in this article are:

<UL type=disc>
	<LI><A HREF="#_core_how_filters_can_enhance_a_server">How ISAPI Filters Can Enhance a Server</A><BR><BR></LI>

	<LI><A HREF="#_core_filter_entry.2d.point_functions">Filter Entry-Point Functions</A><BR><BR></LI>

	<LI><A HREF="#_core_types_of_filter_notifications">Types of Filter Notifications</A></LI>
</UL>

<P>The development environment includes an ISAPI Extension Wizard to help you create an ISAPI filter and set the appropriate notifications. For information on using the wizard, see the article <A HREF="_core_steps_to_create_a_typical_isapi_filter.htm">Steps to Create a Typical ISAPI Filter</A>.</P>

<P>See the MFC Internet sample <A HREF="JavaScript:hhobj_2.Click()">MFCUCASE</A> for an illustration of how to use a <B>CHttpFilter</B> object to create a filter that converts content to uppercase by overriding two <B>CHttpFilter</B> member functions: <B>OnSendRawData</B> and <B>OnUrlMap</B>. </P>

<H2><A NAME="_core_how_filters_can_enhance_a_server"></A>How Filters Can Enhance a Server</H2>

<P>Use Internet Server API (ISAPI) filters to enhance Internet servers with custom features such as enhanced logging of HTTP requests, custom encryption and compression schemes, or new authentication methods. The filter application sits between the network connection to the clients and the HTTP server. Depending on the options that the filter application requests notification for, it can act on several server actions. Filters can be set to receive notification when selected events occur, including reading raw data from the client, processing the headers, managing communications over a secure port using Personal Communications Technology (PCT) or Secure Sockets Layer (SSL), or handling other stages in the processing of the HTTP request.</P>

<H2><A NAME="_core_filter_entry.2d.point_functions"></A>Filter Entry-Point Functions</H2>

<P>Use the MFC class <B>CHttpFilter</B> to create a filter to manage the incoming and outgoing data for an ISAPI server. Two entry-point member functions, <A HREF="JavaScript:hhobj_3.Click()">CHttpFilter::GetFilterVersion</A> and <A HREF="JavaScript:hhobj_4.Click()">CHttpFilter::HttpFilterProc</A>, establish the filter and configure it for the notifications it will act upon. </P>

<H2>GetFilterVersion</H2>

<P>Using <B>CHttpFilter</B> requires that the filter application's path be inserted into the registry, in HKEY_LOCAL_MACHINE/SYSTEM/CurrentControlSet/Services/W3SVC/Parameters/FilterDLLs. When the server starts up, it reads this value and loads the DLLs listed. It then calls <A HREF="JavaScript:hhobj_5.Click()">CHttpFilter::GetFilterVersion</A> to perform three tasks:

<UL type=disc>
	<LI>Exchange version information
<P class=tl>The MFC implementation of <B>GetFilterVersion</B> compares the version number for which you are creating your filter with the server’s version number. </P></LI>

	<LI>Determine the requested events
<P class=tl>Register your ISAPI filter applications only for the events that you require. If you register for extraneous events, your choices can have a significant negative impact on the performance and scalability of your filter. </P></LI>

	<LI>Specify the priority to deliver the requested events
<P class=tl>The priority of requested events is specified by <B>GetFilterVersion</B> in the <B>dwFlags</B><I> </I>member of the <A HREF="JavaScript:hhobj_6.Click()">HTTP_FILTER_VERSION</A> structure. After the <B>GetFilterVersion</B> exchange, every time the server processes one of the events, it will call any filters that have registered for that event. The calling order depends on priority.</P></LI>
</UL>

<H2>HttpFilterProc</H2>

<P>The second <B>CHttpFilter</B> member function to consider as an entry point is <A HREF="JavaScript:hhobj_7.Click()">CHttpFilter::HttpFilterProc</A>. As events happen, the server notifies each filter that registered for the event by calling the filter’s <B>HttpFilterProc</B> entry point. MFC's implementation of <B>CHttpFilter::HttpFilterProc</B> determines which event was fired and calls one of the <B>CHttpFilter</B> members dedicated to handling the specific notification. You can override <B>HttpFilterProc</B> to provide special handling for events. To write code that reacts only to a particular event, see the next section, Types of Filter Notifications.</P>

<H2><A NAME="_core_types_of_filter_notifications"></A>Types of Filter Notifications</H2>

<P>When <B>CHttpFilter::HttpFilterProc</B> is called, the notifications received will determine which of the <B>CHttpFilter</B> member functions will be called. In your override of an individual <B>HttpFilterProc</B> member function, you can set the filter object to change data in a specific manner. For example, you can create an encryption or compression filter by overriding <A HREF="JavaScript:hhobj_8.Click()">OnSendRawData</A> and providing whatever special functionality your filter needs. Other overridable member functions include:

<UL type=disc>
	<LI><A HREF="JavaScript:hhobj_9.Click()">OnPreprocHeaders</A>&nbsp;&nbsp;&nbsp;Notifies the filter that the server has preprocessed the client headers.<BR><BR></LI>

	<LI><A HREF="JavaScript:hhobj_10.Click()">OnAuthentication</A>&nbsp;&nbsp;&nbsp;Authenticates the client.<BR><BR></LI>

	<LI><A HREF="JavaScript:hhobj_11.Click()">OnUrlMap</A>&nbsp;&nbsp;&nbsp;Notifies a filter when a server is mapping a logical URL to a physical path.<BR><BR></LI>

	<LI><A HREF="JavaScript:hhobj_12.Click()">OnSendRawData</A>&nbsp;&nbsp;&nbsp;Notifies the filter before raw data is sent from the server to the client.<BR><BR></LI>

	<LI><A HREF="JavaScript:hhobj_13.Click()">OnReadRawData</A>&nbsp;&nbsp;&nbsp;Notifies the filter after raw data is sent from the client to the server, but before the server processes it.<BR><BR></LI>

	<LI><A HREF="JavaScript:hhobj_14.Click()">OnLog</A>&nbsp;&nbsp;&nbsp;Logs information to a server file.<BR><BR></LI>

	<LI><A HREF="JavaScript:hhobj_15.Click()">OnEndOfNetSession</A>&nbsp;&nbsp;&nbsp;Notifies the filter that the session is ending.</LI>
</UL>

<P><B>See Also</B>&nbsp;&nbsp;&nbsp;<A HREF="JavaScript:hhobj_16.Click()">CHttpFilter</A>, <A HREF="JavaScript:hhobj_17.Click()">CHttpFilterContext</A>, <A HREF="_core_internet.3a_.where_is.......htm">Internet: Where Is...</A></P>
</font>
</BODY>
</HTML>
