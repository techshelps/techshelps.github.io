<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Recordset: More About Updates (ODBC)</TITLE>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_vc_addpf_home">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="Enroll tutorial">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CDatabase">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CRecordset">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CDatabase.3a3a.CommitTrans">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CDatabase.3a3a.Rollback">
</OBJECT>
<OBJECT ID="hhobj_7" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CRecordset.3a3a.Requery">
</OBJECT>
</TD></TR></TABLE>


<font face="verdana,arial,helvetica" size="2">
<H1><A NAME="_core_recordset.3a_.more_about_updates_.28.odbc.29"></A>Recordset: More About Updates (ODBC)</H1>

<P><A HREF="JavaScript:hhobj_1.Click()">Home</A>  |&nbsp; <A HREF="_core_databases.3a_.overview.htm">Overview</A>  |&nbsp; <A HREF="_core_odbc_database_tasks.htm">How Do I</A>  |&nbsp; <A HREF="_core_databases.3a_.frequently_asked_questions.htm">FAQ</A>  |&nbsp; <A HREF="_core_odbc_database_sample_list.htm">Sample</A>  |&nbsp; <A HREF="JavaScript:hhobj_2.Click()">Tutorial</A>  |&nbsp; <A HREF="_core_odbc_driver_list.htm">ODBC Driver List</A></P>

<P>This article applies to the MFC ODBC classes. For DAO recordsets, see the article <A HREF="_core_dao_recordset.htm">DAO Recordset</A>.</P>

<P>This article explains:

<UL type=disc>
	<LI><A HREF="#_core_how_transactions_affect_updates">How other operations, such as transactions, affect updates</A>. <BR><BR></LI>

	<LI><A HREF="#_core_your_updates_and_the_updates_of_other_users">Your updates and those of other users</A>.<BR><BR></LI>

	<LI><A HREF="#_core_more_about_update_and_delete">More about the Update and Delete member functions</A>.</LI>
</UL>

<P class=indent><B><B>Note&nbsp;&nbsp;&nbsp;</B></B>This article applies to objects derived from <B>CRecordset</B> in which bulk row fetching has not been implemented. If you have implemented bulk row fetching, some of the information does not apply. For example, you cannot call the <B>AddNew</B>, <B>Edit</B>, <B>Delete</B>, and <B>Update</B> member functions; however, you can perform transactions. For more information about bulk row fetching, see the article <A HREF="_core_recordset.3a_.fetching_records_in_bulk_.28.odbc.29.htm">Recordset: Fetching Records in Bulk (ODBC)</A>.</P>

<H2><A NAME="_core_how_other_operations_affect_updates"></A>How Other Operations Affect Updates</H2>

<P>Your updates are affected by transactions in effect at the time of the update, by closing the recordset before completing a transaction, and by scrolling before completing a transaction.</P>



<H3><A NAME="_core_how_transactions_affect_updates"></A>How Transactions Affect Updates</H3>

<P>Beyond understanding how <B>AddNew</B>, <B>Edit</B>, and <B>Delete</B> work, it’s important to understand how the <B>BeginTrans</B>, <B>CommitTrans</B>, and <B>Rollback</B> member functions of <A HREF="JavaScript:hhobj_3.Click()">CDatabase</A> work with the update functions of <A HREF="JavaScript:hhobj_4.Click()">CRecordset</A>. </P>

<P>By default, calls to <B>AddNew</B> and <B>Edit</B> affect the data source immediately when you call <B>Update</B>. <B>Delete</B> calls take effect immediately. But you can establish a transaction and execute a batch of such calls. The updates are not permanent until you commit them. If you change your mind, you can roll back the transaction instead of committing it. </P>

<P>For more information about transactions, see the article <A HREF="_core_transaction_.28.odbc.29.htm">Transaction (ODBC)</A>. </P>



<H3><A NAME="_core_how_closing_the_recordset_affects_updates"></A>How Closing the Recordset Affects Updates</H3>

<P>If you close a recordset, or its associated <B>CDatabase</B> object, with a transaction in progress (you haven’t called <A HREF="JavaScript:hhobj_5.Click()">CommitTrans</A> or <A HREF="JavaScript:hhobj_6.Click()">Rollback</A>), the transaction is rolled back automatically (unless your database backend is the Microsoft Jet database engine). <A HREF="_core_transaction.3a_.how_transactions_affect_updates_.28.odbc.29.htm#_core_how_rollback_affects_updates">How Rollback Affects Transactions</A> in the article Transaction: How Transactions Affects Updates (ODBC) describes the effect this has on <B>AddNew</B>, <B>Edit</B>, or <B>Delete</B> operations in progress.</P>

<P class=indent><B><B>Caution&nbsp;&nbsp;&nbsp;</B></B>If you are using the Microsoft Jet database engine, closing a recordset inside an explicit transaction does <B>not</B> result in releasing any of the rows that were modified or locks that were placed until the explicit transaction is committed or rolled back. It is recommended that you always both open and close recordsets either inside or outside of an explicit Jet transaction.</P>



<H3><A NAME="_core_how_scrolling_affects_updates"></A>How Scrolling Affects Updates</H3>

<P>When you <A HREF="_core_recordset.3a_.scrolling_.28.odbc.29.htm">scroll</A> in a recordset, the edit buffer is filled with each new current record (the previous record is not stored first). Scrolling skips over records previously deleted. If you scroll after an <B>AddNew</B> or <B>Edit</B> call without calling <B>Update</B>, <B>CommitTrans</B>, or <B>Rollback</B> first, any changes are lost (with no warning to you) as a new record is brought into the edit buffer. The edit buffer is filled with the record scrolled to, the stored record is freed, and no change occurs on the data source. This applies to both <B>AddNew</B> and <B>Edit</B>.</P>



<H2><A NAME="_core_your_updates_and_the_updates_of_other_users"></A>Your Updates and the Updates of Other Users</H2>

<P>When you use a recordset to update data, your updates affect other users. Similarly, the updates of other users during the lifetime of your recordset affect you.</P>

<P>In a multiuser environment, other users can open recordsets that contain some of the same records you have selected in your recordset. Changes to a record before you retrieve it are reflected in your recordset. Dynasets retrieve a record each time you scroll to it, so dynasets reflect changes each time you scroll to a record. Snapshots retrieve a record the first time you scroll to it, so snapshots reflect only those changes that occur before you scroll to the record initially.</P>

<P>Records added by other users after you open the recordset don’t show up in your recordset unless you requery. If your recordset is a dynaset, edits to existing records by other users do show up in your dynaset when you scroll to the affected record. If your recordset is a snapshot, edits don’t show up until you requery the snapshot. If you want to see records added or deleted by other users in your snapshot, or records added by other users in your dynaset, call <A HREF="JavaScript:hhobj_7.Click()">Requery</A> to rebuild the recordset. (Note that the deletions of other users show up in your dynaset.) You may also call <B>Requery</B> to see records you add, but not to see your deletions.</P>

<P class=indent><B><B>Tip&nbsp;&nbsp;&nbsp;</B></B>To force caching of an entire snapshot at once, call <B>MoveLast</B> immediately after you open the snapshot. Then call <B>MoveFirst</B> to begin working with the records. <B>MoveLast</B> is equivalent to scrolling over all the records, but it retrieves them all at once. Note, however, that this can lower performance and may not be required for some drivers.</P>

<P>The effects of your updates on other users are similar to their effects on you. </P>

<H2><A NAME="_core_more_about_update_and_delete"></A>More About Update and Delete</H2>

<P>This section provides additional information to help you work with <B>Update</B> and <B>Delete</B>.</P>

<H3>Update Success and Failure</H3>

<P>If <B>Update</B> succeeds, the <B>AddNew</B> or <B>Edit</B> mode ends. To begin an <B>AddNew</B> or <B>Edit</B> mode again, call <B>AddNew</B> or <B>Edit</B>.</P>

<P>If <B>Update</B> fails (returns <B>FALSE</B> or throws an exception), you remain in <B>AddNew</B> or <B>Edit</B> mode, depending on which function you called last. You can then do one of the following:

<UL type=disc>
	<LI>Modify a field data member and try the <B>Update</B> again.<BR><BR></LI>

	<LI>Call <B>AddNew</B> to reset the field data members to Null, set the values of the field data members, then call <B>Update</B> again.<BR><BR></LI>

	<LI>Call <B>Edit</B> to reload the values that were in the recordset before the first call to <B>AddNew</B> or <B>Edit</B>, then set the values of the field data members, then call <B>Update</B> again. After a successful <B>Update</B> call (except after an <B>AddNew</B> call), the field data members retain their new values.<BR><BR></LI>

	<LI>Call <B>Move</B> (including <B>Move</B> with a parameter of <B>AFX_MOVE_REFRESH</B>, or 0), which flushes any changes and ends any <B>AddNew</B> or <B>Edit</B> mode in effect.</LI>
</UL>

<H3>Update and Delete</H3>

<P>This section applies to both <B>Update</B> and <B>Delete</B>.</P>

<P>On an <B>Update</B> or <B>Delete</B> operation, one and only one record should be updated. That record is the current record, which corresponds to the data values in the fields of the recordset. If for some reason no records are affected or more than one record is affected, an exception is thrown containing one of the following <B>RETCODE</B> values:

<UL type=disc>
	<LI><B>AFX_SQL_ERROR_NO_ROWS_AFFECTED</B><BR><BR></LI>

	<LI><B>AFX_SQL_ERROR_MULTIPLE_ROWS_AFFECTED</B></LI>
</UL>

<P>When these exceptions are thrown, you remain in the <B>AddNew</B> or <B>Edit</B> state you were in when you called <B>Update</B> or <B>Delete</B>. Here are the most common scenarios in which you would see these exceptions. You’re most likely to see:

<UL type=disc>
	<LI><B>AFX_SQL_ERROR_NO_ROWS_AFFECTED</B> when you’re using optimistic locking mode and another user has modified the record in a way that prevents the framework from identifying the correct record to update or delete.<BR><BR></LI>

	<LI><B>AFX_SQL_ERROR_MULTIPLE_ROWS_AFFECTED</B> when the table you’re updating has no primary key or unique index, and you don’t have enough columns in the recordset to uniquely identify a table row.</LI>
</UL>

<P><B>See Also</B>&nbsp;&nbsp;&nbsp;<A HREF="_core_recordset.3a_.how_recordsets_select_records_.28.odbc.29.htm">Recordset: How Recordsets Select Records (ODBC)</A>, <A HREF="_core_record_field_exchange_.28.rfx.29.htm">Record Field Exchange</A>, <A HREF="_core_sql.htm">SQL</A>, <A HREF="_core_exceptions.3a_.database_exceptions.htm">Exceptions: Database Exceptions</A> </P>
</font>
</BODY>
</HTML>
