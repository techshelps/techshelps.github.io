<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Recordset: How Recordsets Select Records (ODBC)</TITLE>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_vc_addpf_home">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="Enroll tutorial">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CRecordset.3a3a.Open">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CRecordset.3a3a.Open">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CRecordset.3a3a.GetDefaultSQL">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CRecordset.3a3a.DoFieldExchange">
</OBJECT>
<OBJECT ID="hhobj_7" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.DoBulkFieldExchange">
</OBJECT>
<OBJECT ID="hhobj_8" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CRecordset.3a3a.m_strFilter">
</OBJECT>
<OBJECT ID="hhobj_9" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CRecordset.3a3a.m_strSort">
</OBJECT>
<OBJECT ID="hhobj_10" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CDatabase.3a3a.ExecuteSQL">
</OBJECT>
<OBJECT ID="hhobj_11" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CRecordset.3a3a.Open">
</OBJECT>
<OBJECT ID="hhobj_12" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CRecordset.3a3a.GetDefaultSQL">
</OBJECT>
<OBJECT ID="hhobj_13" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CRecordset.3a3a.DoFieldExchange">
</OBJECT>
<OBJECT ID="hhobj_14" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.DoBulkFieldExchange">
</OBJECT>
</TD></TR></TABLE>


<font face="verdana,arial,helvetica" size="2">
<H1><A NAME="_core_recordset.3a_.how_recordsets_select_records_.28.odbc.29"></A>Recordset: How Recordsets Select Records (ODBC)</H1>

<P><A HREF="JavaScript:hhobj_1.Click()">Home</A>  |&nbsp; <A HREF="_core_databases.3a_.overview.htm">Overview</A>  |&nbsp; <A HREF="_core_odbc_database_tasks.htm">How Do I</A>  |&nbsp; <A HREF="_core_databases.3a_.frequently_asked_questions.htm">FAQ</A>  |&nbsp; <A HREF="_core_odbc_database_sample_list.htm">Sample</A>  |&nbsp; <A HREF="JavaScript:hhobj_2.Click()">Tutorial</A>  |&nbsp; <A HREF="_core_odbc_driver_list.htm">ODBC Driver List</A></P>

<P>This article applies to the MFC ODBC classes. For DAO recordsets, see the article <A HREF="_core_dao_recordset.htm">DAO Recordset</A>.</P>

<P>This article explains:

<UL type=disc>
	<LI><A HREF="#_core_your_options_in_selecting_records">Your role and your options in selecting records</A>.<BR><BR></LI>

	<LI><A HREF="#_core_how_a_recordset_constructs_its_sql_statement">How a recordset constructs its SQL statement and selects records</A>.<BR><BR></LI>

	<LI><A HREF="#_core_customizing_the_selection">What you can do to customize the selection</A>.</LI>
</UL>

<P>Recordsets select records from a data source through an ODBC driver by sending SQL statements to the driver. The SQL sent depends on how you design and open your recordset class.</P>

<H2><A NAME="_core_your_options_in_selecting_records"></A>Your Options in Selecting Records</H2>

<P>The following table shows your options in selecting records.</P>

<P class=label><B>How and When You Can Affect a Recordset</B></P>

<TABLE border=1 cellpadding=5 cols=2 frame=below rules=rows>

<TR VALIGN="top">
<TD class=label width=38%><B>When you ...</B></TD>
<TD class=label width=62%><B>You can ...</B></TD>
</TR>

<TR VALIGN="top">
<TD width=38%>Declare your recordset class with ClassWizard...</TD>
<TD width=62%>Specify which table to select from.
<P>Specify which columns to include.</P>

<P>See <A HREF="_core_classwizard.3a_.creating_a_recordset_class.htm">ClassWizard: Creating a Recordset Class</A>. </P>
</TD>
</TR>

<TR VALIGN="top">
<TD width=38%>Complete your recordset class implementation...</TD>
<TD width=62%>Override member functions such as <B>OnSetOptions</B> (advanced) to set application-specific options or to change defaults. Specify parameter data members if you want a parameterized recordset.</TD>
</TR>

<TR VALIGN="top">
<TD width=38%>Construct a recordset object (before you call <B>Open</B>) and then...</TD>
<TD width=62%>Specify a search condition (possibly compound) for use in a <B>WHERE</B> clause that filters the records. See <A HREF="_core_recordset.3a_.filtering_records_.28.odbc.29.htm">Recordset: Filtering Records (ODBC)</A>. 
<P>Specify a sort order for use in an <B>ORDER BY</B> clause that sorts the records. See <A HREF="_core_recordset.3a_.sorting_records_.28.odbc.29.htm">Recordset: Sorting Records (ODBC)</A>. </P>

<P>Specify parameter values for any parameters you added to the class. See <A HREF="_core_recordset.3a_.parameterizing_a_recordset_.28.odbc.29.htm">Recordset: Parameterizing a Recordset (ODBC)</A>. </P>
</TD>
</TR>

<TR VALIGN="top">
<TD width=38%>Run the recordset’s query by calling <B>Open</B>...</TD>
<TD width=62%>Specify a custom SQL string to replace the default SQL string set up by ClassWizard. See <A HREF="JavaScript:hhobj_3.Click()">CRecordset::Open</A> in the <I>Class Library Reference</I> and <A HREF="_core_sql.3a_.customizing_your_recordset.92.s_sql_statement_.28.odbc.29.htm">SQL: Customizing Your Recordset’s SQL Statement (ODBC)</A>. </TD>
</TR>

<TR VALIGN="top">
<TD width=38%>Call <B>Requery</B> to requery the recordset with the latest values on the data source...</TD>
<TD width=62%>Specify new parameters, filter, or sort. See <A HREF="_core_recordset.3a_.requerying_a_recordset_.28.odbc.29.htm">Recordset: Requerying a Recordset (ODBC)</A>. </TD>
</TR>
</TABLE><BR>



<H2><A NAME="_core_how_a_recordset_constructs_its_sql_statement"></A>How a Recordset Constructs Its SQL Statement</H2>

<P>When you call a recordset object’s <A HREF="JavaScript:hhobj_4.Click()">Open</A> member function, <B>Open</B> constructs an SQL statement using some or all of the following ingredients:

<UL type=disc>
	<LI>The <B>lpszSQL</B> parameter passed to <B>Open</B>. If not <B>NULL</B>, this parameter specifies a custom SQL string, or part of one. The framework parses the string. If the string is an SQL <B>SELECT</B> statement or an ODBC <B>CALL</B> statement, the framework uses the string as the recordset’s SQL statement. If the string does not begin with “SELECT” or “{CALL”, the framework uses what’s supplied to construct an SQL <B>FROM</B> clause.<BR><BR></LI>

	<LI>The string returned by <A HREF="JavaScript:hhobj_5.Click()">GetDefaultSQL</A>. By default, this is the name of the table you specified for the recordset in ClassWizard, but you can change what the function returns. The framework calls <B>GetDefaultSQL</B> — if the string doesn’t begin with “SELECT” or “{CALL”, it is assumed to be a table name, which is used to construct an SQL string.<BR><BR></LI>

	<LI>The field data members of the recordset, which are to be bound to specific columns of the table. The framework binds record columns to the addresses of these members, using them as buffers. The framework determines the correlation of field data members to table columns from the <A HREF="_core_record_field_exchange.3a_.using_rfx.htm">RFX</A> or Bulk RFX function calls in the recordset’s <A HREF="JavaScript:hhobj_6.Click()">DoFieldExchange</A> or <A HREF="JavaScript:hhobj_7.Click()">DoBulkFieldExchange</A> member function.<BR><BR></LI>

	<LI>The <A HREF="_core_recordset.3a_.filtering_records_.28.odbc.29.htm">filter</A> for the recordset, if any, contained in the <A HREF="JavaScript:hhobj_8.Click()">m_strFilter</A> data member. The framework uses this string to construct an SQL <B>WHERE</B> clause.<BR><BR></LI>

	<LI>The <A HREF="_core_recordset.3a_.sorting_records_.28.odbc.29.htm">sort</A> order for the recordset, if any, contained in the <A HREF="JavaScript:hhobj_9.Click()">m_strSort</A> data member. The framework uses this string to construct an SQL <B>ORDER BY</B> clause.
<P class=atl><B><B>Tip&nbsp;&nbsp;&nbsp;</B></B>To use the SQL <B>GROUP BY</B> clause (and possibly the <B>HAVING</B> clause), append the clause(s) to the end of your filter string.</p></LI>

	<LI>The values of any <A HREF="_core_recordset.3a_.parameterizing_a_recordset_.28.odbc.29.htm">parameter data members</A> you specify for the class. You set parameter values just before you call <B>Open</B> or <B>Requery</B>. The framework binds the parameter values to “?” placeholders in the SQL string. At compile time, you specify the string with placeholders. At run time, the framework fills in the details based on the parameter values you pass.</LI>
</UL>

<P><B>Open</B> constructs an SQL <B>SELECT</B> statement from these ingredients. See <A HREF="#_core_customizing_the_selection">Customizing the Selection</A> for details about how the framework uses the ingredients.</P>

<P>After constructing the statement, <B>Open</B> sends the SQL to the ODBC Driver Manager (and the ODBC Cursor Library if it is in memory), which sends it on to the ODBC driver for the specific DBMS. The driver communicates with the DBMS to carry out the selection on the data source and fetches the first record. The framework loads the record into the field data members of the recordset.</P>

<P>You can use a combination of these techniques to open <A HREF="_core_recordset.3a_.declaring_a_class_for_a_table_.28.odbc.29.htm">tables</A> and to construct a query based on a <A HREF="_core_recordset.3a_.performing_a_join_.28.odbc.29.htm">join</A> of multiple tables. With additional customization, you can call <A HREF="_core_recordset.3a_.declaring_a_class_for_a_predefined_query_.28.odbc.29.htm">predefined queries</A> (stored procedures), select table columns not known at design time and <A HREF="_core_recordset.3a_.dynamically_binding_data_columns_.28.odbc.29.htm">bind</A> them to recordset fields, or perform most other data-access tasks. Tasks you can’t accomplish by customizing recordsets can still be accomplished by <A HREF="_core_odbc.3a_.calling_odbc_api_functions_directly.htm">calling ODBC API functions</A> or directly executing SQL statements with <A HREF="JavaScript:hhobj_10.Click()">CDatabase::ExecuteSQL</A>. </P>

<H2><A NAME="_core_customizing_the_selection"></A>Customizing the Selection</H2>

<P>Besides supplying a filter, a sort order, or parameters, you can take the following actions to customize your recordset’s selection:

<UL type=disc>
	<LI>Pass a custom SQL string in <B>lpszSQL</B> when you call <A HREF="JavaScript:hhobj_11.Click()">Open</A> for the recordset. Anything you pass in <B>lpsqSQL</B> takes precedence over what the <A HREF="JavaScript:hhobj_12.Click()">GetDefaultSQL</A> member function returns. 
<P class=tl>See the article <A HREF="_core_sql.3a_.customizing_your_recordset.92.s_sql_statement_.28.odbc.29.htm">SQL: Customizing Your Recordset’s SQL Statement (ODBC)</A>. That article describes the kinds of SQL statements (or partial statements) you can pass to <B>Open</B> and what the framework does with them.</P>
<P class=atl><B><B>Note&nbsp;&nbsp;&nbsp;</B></B>If the custom string you pass does not begin with “SELECT” or “{CALL”, MFC assumes it contains a table name. This also applies to the next bulleted item below.</p></LI>

	<LI>Alter the string that ClassWizard writes in your recordset’s <B>GetDefaultSQL</B> member function. Edit the function’s code to change what it returns. By default, ClassWizard writes a <B>GetDefaultSQL</B> function that returns a single table name.
<P class=tl>You can have <B>GetDefaultSQL</B> return any of the items that you can pass in the <B>lpszSQL</B> parameter to <B>Open</B>. If you don’t pass a custom SQL string in <B>lpszSQL</B>, the framework uses the string that <B>GetDefaultSQL</B> returns. At a minimum, <B>GetDefaultSQL</B> must return a single table name. But you can have it return multiple table names, a full <B>SELECT</B> statement, an ODBC <B>CALL</B> statement, and so on. For a list of what you can pass to <B>lpszSQL</B> — or have <B>GetDefaultSQL</B> return — see the article <A HREF="_core_sql.3a_.customizing_your_recordset.92.s_sql_statement_.28.odbc.29.htm">SQL: Customizing Your Recordset’s SQL Statement (ODBC)</A>. </P>
<P class=tl>If you’re performing a join of two or more tables, rewrite <B>GetDefaultSQL</B> to customize the table list used in the SQL <B>FROM</B> clause. See the article <A HREF="_core_recordset.3a_.performing_a_join_.28.odbc.29.htm">Recordset: Performing a Join (ODBC)</A>. </P></LI>

	<LI>Manually bind additional field data members, perhaps based on information you obtain about the schema of your data source at run time. You add field data members to the recordset class, <A HREF="_core_record_field_exchange.3a_.using_rfx.htm">RFX</A> or Bulk RFX function calls for them to the <A HREF="JavaScript:hhobj_13.Click()">DoFieldExchange</A> or <A HREF="JavaScript:hhobj_14.Click()">DoBulkFieldExchange</A> member function, and initializations of the data members in the class constructor.
<P class=tl>See the article <A HREF="_core_recordset.3a_.dynamically_binding_data_columns_.28.odbc.29.htm">Recordset: Dynamically Binding Data Columns (ODBC)</A>. </P></LI>

	<LI>Override recordset member functions, such as <B>OnSetOptions</B>, to set application-specific options or to override defaults.</LI>
</UL>

<P>If you want to base the recordset on a complex SQL statement, you’ll need to use some combination of these customization techniques. For example, perhaps you want to use SQL clauses and keywords not directly supported by recordsets, or perhaps you’re joining multiple tables.</P>

<P><B>See Also</B>&nbsp;&nbsp;&nbsp;<A HREF="_core_recordset.3a_.how_recordsets_update_records_.28.odbc.29.htm">Recordset: How Recordsets Update Records (ODBC)</A>, <A HREF="_core_odbc.htm">ODBC</A>, <A HREF="_core_sql.htm">SQL</A>, <A HREF="_core_recordset.3a_.locking_records_.28.odbc.29.htm">Recordset: Locking Records (ODBC)</A> </P>
</font>
</BODY>
</HTML>
