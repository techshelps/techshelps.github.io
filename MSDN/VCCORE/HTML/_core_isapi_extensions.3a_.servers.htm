<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>ISAPI Extensions: Servers</TITLE>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_vc_addpf_home">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_sample_mfc_WWWQUOTE">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CHttpServer">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CHttpServerContext">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CHtmlStream">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CHttpServer">
</OBJECT>
<OBJECT ID="hhobj_7" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CHttpServerContext">
</OBJECT>
<OBJECT ID="hhobj_8" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CHttpServer.3a3a.GetExtensionVersion">
</OBJECT>
<OBJECT ID="hhobj_9" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CHttpServer.3a3a.HttpExtensionProc">
</OBJECT>
<OBJECT ID="hhobj_10" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CHttpServer.3a3a.GetExtensionVersion">
</OBJECT>
<OBJECT ID="hhobj_11" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CHttpServer.3a3a.HttpExtensionProc">
</OBJECT>
<OBJECT ID="hhobj_12" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CHttpServer.3a3a.HttpExtensionProc">
</OBJECT>
<OBJECT ID="hhobj_13" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CHttpServerContext">
</OBJECT>
</TD></TR></TABLE>


<font face="verdana,arial,helvetica" size="2">
<H1><A NAME="_core_isapi_extensions.3a_.servers"></A>ISAPI Extensions: Servers</H1>

<P><A HREF="JavaScript:hhobj_1.Click()">Home</A>  |&nbsp; <A HREF="_core_internet_support.3a_.overview.htm">Overview</A>  |&nbsp; <A HREF="_core_internet_tasks.htm">How Do I</A></P>

<P>This article describes the MFC classes used in writing ISAPI server extensions. Topics include:

<UL type=disc>
	<LI><A HREF="#_core_classes_used_in_writing_an_isa">Classes Used in Writing an ISA</A><BR><BR></LI>

	<LI><A HREF="#_core_server_entry.2d.point_functions">Server Entry-Point Functions</A><BR><BR></LI>

	<LI><A HREF="#_core_the_extension_control_block_structure">The EXTENSION_CONTROL_BLOCK Structure</A></LI>
</UL>

<P>For a detailed list of steps to create your ISAPI server extension, see <A HREF="_core_steps_to_create_a_typical_isapi_extension.htm">Steps to Create a Typical ISAPI Extension</A>.</P>

<P>For an introduction to HTTP servers, see the article <A HREF="_core_internet_server_api_.28.isapi.29_.extensions.htm">Internet Server API (ISAPI) Extensions</A>. For a comparison of ISAPI and CGI, see <A HREF="_core_how_does_isapi_compare_with_cgi.3f.htm">How Does ISAPI Compare with CGI?</A>.</P>

<P>The MFC Internet sample program <A HREF="JavaScript:hhobj_2.Click()">WWWQUOTE</A> illustrates how to use <A HREF="JavaScript:hhobj_3.Click()">CHttpServer</A>, <A HREF="JavaScript:hhobj_4.Click()">CHttpServerContext</A>, and <A HREF="JavaScript:hhobj_5.Click()">CHtmlStream</A>.</P>

<H2><A NAME="_core_classes_used_in_writing_an_isa"></A>Classes Used in Writing an ISA</H2>

<P>To write an ISA in MFC, create a <A HREF="JavaScript:hhobj_6.Click()">CHttpServer</A> object. Each time the <B>CHttpServer</B> receives a client request, it creates a <A HREF="JavaScript:hhobj_7.Click()">CHttpServerContext</A> object. It passes a pointer to that object to the command handling function. The use of multiple <B>CHttpServerContext</B> objects permits the <B>CHttpServer</B> object to handle a single command from a single client to the server object. Because the server may be handling concurrent, multiple requests, more than one active <B>CHttpServerContext</B> object can be associated with a particular <B>CHttpServer</B> instance.</P>

<H2><A NAME="_core_server_entry.2d.point_functions"></A>Server Entry-Point Functions</H2>

<P>Use the MFC class <B>CHttpServer</B> to create and manage a server extension DLL. Your server extension DLL should expose two entry points as exported functions: <A HREF="JavaScript:hhobj_8.Click()">CHttpServer::GetExtensionVersion</A> and <A HREF="JavaScript:hhobj_9.Click()">CHttpServer::HttpExtensionProc</A>. An extension DLL generated by the ISAPI Extension Wizard will have a .def file that correctly exports these functions. The functions are implemented by MFC, which simply finds the single <B>CHttpExtension</B> instance in the DLL and calls its <B>CHttpServer::GetExtensionVersion</B> or <B>CHttpServer::HttpExtensionProc</B> implementation as appropriate.</P>

<H2>CHttpServer::GetExtensionVersion</H2>

<P>When the server application is invoked for the first time, the server calls <A HREF="JavaScript:hhobj_10.Click()">CHttpServer::GetExtensionVersion</A> to perform two tasks:

<UL type=disc>
	<LI>Exchange version information
<P class=tl>The default implementation of <B>GetExtensionVersion</B> checks the version number for which you are creating your server extension against the server’s version number.</P></LI>

	<LI>Provide a short text description of the ISA
<P class=tl>Override <B>GetExtensionVersion</B> to set the text string with your own description.</P></LI>
</UL>

<H2>CHttpServer::HttpExtensionProc</H2>

<P>The second <B>CHttpServer</B> member function to consider as an entry point is <A HREF="JavaScript:hhobj_11.Click()">CHttpServer::HttpExtensionProc</A>, which is similar to the <B>main</B> function of an application. It uses callback functions to read client data and determine the action to be taken. Usually, you won’t take direct action with <B>HttpExtensionProc</B> because MFC automatically handles incoming client requests by sending them through a parse map. The parse map is used to identify which of your functions to call, and to extract the function parameters. For information on using the parse map macros, see the article <A HREF="_core_isapi_extensions.3a_.parse_maps.htm">ISAPI Extensions: Parse Maps</A>.</P>

<P>When <B>HttpExtensionProc</B> finishes, it returns a value, which the server then formats and returns to the client. For a list of the values returned, see the description for <A HREF="JavaScript:hhobj_12.Click()">HttpExtensionProc</A> in the <I>Class Library Reference</I>.</P>

<P>The default implementation of <B>HttpExtensionProc</B> is recommended; however, you can override it to provide custom implementation. For example, you could override this function to allocate per-call data.</P>

<H2><A NAME="_core_the_extension_control_block_structure"></A>The EXTENSION_CONTROL_BLOCK Structure</H2>

<P>The HTTP server and the ISA communicate data through the <B>EXTENSION_CONTROL_BLOCK</B> structure. The information passed through the structure includes, for example, the raw query string, path information, method name, and translated path. MFC copies the <B>EXTENSION_CONTROL_BLOCK</B> pointer it receives from the server and passes it along in the <A HREF="JavaScript:hhobj_13.Click()">CHttpServerContext</A> object passed to command handling functions. Reference information about the <B>EXTENSION_CONTROL_BLOCK</B> structure, including a list of possible field values, is in the <I>Class Library Reference</I>. </P>

<P><B>See Also</B>&nbsp;&nbsp;&nbsp;<A HREF="_core_isapi_extensions.3a_.mfc_classes.htm">ISAPI Extensions: MFC Classes</A>, <A HREF="_core_isapi_extensions.3a_.filters.htm">ISAPI Extensions: Filters</A>, <A HREF="_core_steps_to_create_a_typical_isapi_filter.htm">Steps to Create a Typical ISAPI Filter</A>, <A HREF="_core_internet.3a_.where_is.......htm">Internet: Where Is...</A></P>
</font>
</BODY>
</HTML>
