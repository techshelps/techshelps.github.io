<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Record Field Exchange: How RFX Works</TITLE>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_vc_addpf_home">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="Enroll Tutorial">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.DoFieldExchange">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CFieldExchange">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.Open">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.AddNew">
</OBJECT>
<OBJECT ID="hhobj_7" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.Edit">
</OBJECT>
<OBJECT ID="hhobj_8" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.Update">
</OBJECT>
<OBJECT ID="hhobj_9" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_Macros.2c_.Global_Functions.2c_.and_Global_Variables">
</OBJECT>
<OBJECT ID="hhobj_10" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CFieldExchange">
</OBJECT>
<OBJECT ID="hhobj_11" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.DoFieldExchange">
</OBJECT>
</TD></TR></TABLE>


<font face="verdana,arial,helvetica" size="2">
<H1><A NAME="_core_record_field_exchange.3a_.how_rfx_works"></A>Record Field Exchange: How RFX Works</H1>

<P><A HREF="JavaScript:hhobj_1.Click()">Home</A>  |&nbsp; <A HREF="_core_databases.3a_.overview.htm">Overview</A>  |&nbsp; <A HREF="_core_odbc_database_tasks.htm">How Do I</A>  |&nbsp; <A HREF="_core_databases.3a_.frequently_asked_questions.htm">FAQ</A>  |&nbsp; <A HREF="_core_odbc_database_sample_list.htm">Sample</A>  |&nbsp; <A HREF="JavaScript:hhobj_2.Click()">Tutorial</A>  |&nbsp; <A HREF="_core_odbc_driver_list.htm">ODBC Driver List</A></P>

<P>This article explains the RFX process. This is an advanced topic covering:

<UL type=disc>
	<LI><A HREF="#_core_rfx_and_the_recordset">RFX and the recordset</A><BR><BR></LI>

	<LI><A HREF="#_core_the_record_field_exchange_process">The RFX process</A></LI>
</UL>

<P class=indent><B><B>Note&nbsp;&nbsp;&nbsp;</B></B>This article applies to classes derived from <B>CRecordset</B> in which bulk row fetching has not been implemented. If you are using bulk row fetching, then bulk record field exchange (Bulk RFX) is implemented. Bulk RFX is similar to RFX. To understand the differences, see the article <A HREF="_core_recordset.3a_.fetching_records_in_bulk_.28.odbc.29.htm">Recordset: Fetching Records in Bulk (ODBC)</A>.</P>

<H2><A NAME="_core_rfx_and_the_recordset"></A>RFX and the Recordset</H2>

<P>The recordset object’s field data members, taken together, constitute an “edit buffer” that holds the selected columns of one record. When the recordset is first opened and is about to read the first record, RFX binds (associates) each selected column to the address of the appropriate field data member. When the recordset updates a record, RFX calls ODBC API functions to send an SQL <B>UPDATE</B> or <B>INSERT</B> statement to the driver. RFX uses its knowledge of the field data members to specify the columns to write. </P>

<P>The framework backs up the edit buffer at certain stages so it can restore its contents if necessary. RFX backs up the edit buffer before adding a new record and before editing an existing record. It restores the edit buffer in some cases, for example, after an <B>Update</B> call following <B>AddNew</B>. The edit buffer is not restored if you abandon a newly changed edit buffer by, for example, moving to another record before calling <B>Update</B>.</P>

<P>Besides exchanging data between the data source and the recordset’s field data members, RFX manages binding parameters. When the recordset is opened, any parameter data members are bound in the order of the “?” placeholders in the SQL statement that <B>CRecordset::Open</B> constructs. For more information, see the article <A HREF="_core_recordset.3a_.parameterizing_a_recordset_.28.odbc.29.htm">Recordset: Parameterizing a Recordset (ODBC)</A>. </P>

<P>Your recordset class’s override of <B>DoFieldExchange</B> does all the work, moving data in both directions. Like dialog data exchange (DDX), RFX needs information about the data members of your class. ClassWizard provides the necessary information by writing a recordset-specific implementation of <B>DoFieldExchange</B> for you, based on the field data member names and data types you specify with the wizard. </P>

<H2><A NAME="_core_the_record_field_exchange_process"></A>The Record Field Exchange Process</H2>

<P>This section describes the sequence of RFX events as a recordset object is opened and as you add, update, and delete records. The table <A HREF="_core_record_field_exchange.3a_.using_rfx.htm#_core_using_rfx.3a_.you_and_the_framework">Using RFX: You and the Framework</A> in the article Record Field Exchange: Using RFX shows the process at a high level, illustrating operations as a recordset is opened. The table <A HREF="#_core_sequence_of_rfx_operations_during_recordset_open">Sequence of RFX Operations During Recordset Open</A> and the table <A HREF="#_core_sequence_of_rfx_operations_during_scrolling">Sequence of RFX Operations During Scrolling</A> in this article show the process as RFX processes a <B>Move</B> command in the recordset and as RFX manages an update. During these processes, <A HREF="JavaScript:hhobj_3.Click()">DoFieldExchange</A> is called to perform many different operations. The <B>m_nOperation</B> data member of the <A HREF="JavaScript:hhobj_4.Click()">CFieldExchange</A> object determines which operation is requested. You might find it helpful to read the articles <A HREF="_core_recordset.3a_.how_recordsets_select_records_.28.odbc.29.htm">Recordset: How Recordsets Select Records (ODBC)</A> and <A HREF="_core_recordset.3a_.how_recordsets_update_records_.28.odbc.29.htm">Recordset: How Recordsets Update Records (ODBC)</A> before you read this material.</P>



<H3><A NAME="_mfc_rfx.3a_.initial_binding_of_columns_and_parameters"></A>RFX: Initial Binding of Columns and Parameters</H3>

<P>The following RFX activities occur, in the order shown, when you call a recordset object’s <A HREF="JavaScript:hhobj_5.Click()">Open</A> member function:

<UL type=disc>
	<LI>If the recordset has parameter data members, the framework calls <B>DoFieldExchange</B> to bind the parameters to parameter placeholders in the recordset’s SQL statement string. A data type-dependent representation of the value of the parameter is used for each placeholder found in the <B>SELECT</B> statement. This occurs after the SQL statement is prepared but before it is executed. (For information about statement preparation, see the <B>::SQLPrepare</B> function in the ODBC <I>Programmer’s Reference</I>.)<BR><BR></LI>

	<LI>The framework calls <B>DoFieldExchange</B> a second time to bind the values of selected columns to corresponding field data members in the recordset. This establishes the recordset object as an edit buffer containing the columns of the first record.<BR><BR></LI>

	<LI>The recordset executes the SQL statement and the data source selects the first record. The record’s columns are loaded into the recordset’s field data members.</LI>
</UL>

<P>The following table shows the sequence of RFX operations when you open a recordset.</P>

<P class=label><B><A NAME="_core_sequence_of_rfx_operations_during_recordset_open"></A>Sequence of RFX Operations During Recordset Open</B></P>

<TABLE border=1 cellpadding=5 cols=3 frame=below rules=rows>

<TR VALIGN="top">
<TD class=label width=29%><B>Your operation</B></TD>
<TD class=label width=36%><B>DoFieldExchange operation</B></TD>
<TD class=label width=35%><B>Database/SQL operation</B></TD>
</TR>

<TR VALIGN="top">
<TD width=29%>1. Open recordset.</TD>
<TD width=36%>&nbsp;</TD>
<TD width=35%>&nbsp;</TD>
</TR>

<TR VALIGN="top">
<TD width=29%>&nbsp;</TD>
<TD width=36%>2. Build an SQL statement.</TD>
<TD width=35%>&nbsp;</TD>
</TR>

<TR VALIGN="top">
<TD width=29%>&nbsp;</TD>
<TD width=36%>&nbsp;</TD>
<TD width=35%>3. Send the SQL.</TD>
</TR>

<TR VALIGN="top">
<TD width=29%>&nbsp;</TD>
<TD width=36%>4. Bind parameter data member(s).</TD>
<TD width=35%>&nbsp;</TD>
</TR>

<TR VALIGN="top">
<TD width=29%>&nbsp;</TD>
<TD width=36%>5. Bind field data member(s) to column(s).</TD>
<TD width=35%>&nbsp;</TD>
</TR>

<TR VALIGN="top">
<TD width=29%>&nbsp;</TD>
<TD width=36%>&nbsp;</TD>
<TD width=35%>6. ODBC does the move and fills in the data.</TD>
</TR>

<TR VALIGN="top">
<TD width=29%>&nbsp;</TD>
<TD width=36%>7. Fix up the data for C++.</TD>
<TD width=35%>&nbsp;</TD>
</TR>
</TABLE><BR>

<P>Recordsets use ODBC’s “prepared execution” to allow for fast requerying with the same SQL statement. For more information about prepared execution, see the ODBC SDK <I>Programmer’s Reference</I> on the MSDN Library CD.</P>



<H3><A NAME="_mfc_rfx.3a_.scrolling"></A>RFX: Scrolling</H3>

<P>When you scroll from one record to another, the framework calls <B>DoFieldExchange</B> to replace the values previously stored in the field data members with values for the new record.</P>

<P>The following table shows the sequence of RFX operations when the user moves from record to record.</P>

<P class=label><B><A NAME="_core_sequence_of_rfx_operations_during_scrolling"></A>Sequence of RFX Operations During Scrolling</B></P>

<TABLE border=1 cellpadding=5 cols=3 frame=below rules=rows>

<TR VALIGN="top">
<TD class=label width=31%><B>Your operation</B></TD>
<TD class=label width=36%><B>DoFieldExchange operation</B></TD>
<TD class=label width=33%><B>Database/SQL operation</B></TD>
</TR>

<TR VALIGN="top">
<TD width=31%>1. Call <B>MoveNext</B> or one of the other Move functions.</TD>
<TD width=36%>&nbsp;</TD>
<TD width=33%>&nbsp;</TD>
</TR>

<TR VALIGN="top">
<TD width=31%>&nbsp;</TD>
<TD width=36%>&nbsp;</TD>
<TD width=33%>2. ODBC does the move and fills in the data.</TD>
</TR>

<TR VALIGN="top">
<TD width=31%>&nbsp;</TD>
<TD width=36%>3. Fix up the data for C++.</TD>
<TD width=33%>&nbsp;</TD>
</TR>
</TABLE><BR>



<H3><A NAME="_mfc_rfx.3a_.adding_new_records_and_editing_existing_records"></A>RFX: Adding New Records and Editing Existing Records</H3>

<P>If you add a new record, the recordset operates as an edit buffer to build up the contents of the new record. As with adding records, editing records involves changing the values of the recordset’s field data members. From the RFX perspective, the sequence is as follows:

<OL>
	<LI>Your call to the recordset’s <A HREF="JavaScript:hhobj_6.Click()">AddNew</A> or <A HREF="JavaScript:hhobj_7.Click()">Edit</A> member function causes RFX to store the current edit buffer so it can be restored later.<BR><BR></LI>

	<LI><B>AddNew</B> or <B>Edit</B> prepares the fields in the edit buffer so RFX can detect changed field data members. 
<P class=tl>Since a new record has no previous values to compare new ones with, <B>AddNew</B> sets the value of each field data member to a <B>PSEUDO_NULL</B> value. Later, when you call <B>Update</B>, RFX compares each data member’s value with the <B>PSEUDO_NULL</B> value. If there is a difference, the data member has been set. (<B>PSEUDO_NULL</B> is not the same thing as a record column with a true Null value, nor is either of these the same as C++ <B>NULL</B>.) </P>
<P class=tl>Unlike the <B>Update</B> call for <B>AddNew</B>, the <B>Update</B> call for <B>Edit</B> compares updated values with previously stored values rather than using <B>PSEUDO_NULL</B>. The difference is that <B>AddNew</B> has no previously stored values for comparison.</P></LI>

	<LI>You directly set the values of field data members whose values you want to edit or that you want filled for a new record. (This can include calling <B>SetFieldNull</B>.)<BR><BR></LI>

	<LI>Your call to <A HREF="JavaScript:hhobj_8.Click()">Update</A> checks for changed field data members, as described in step 2 (see the table <A HREF="#_core_sequence_of_rfx_operations_during_scrolling">Sequence of RFX Operations During Scrolling</A>). If none have changed, <B>Update</B> returns 0. If some field data members have changed, <B>Update</B> prepares and executes an SQL <B>INSERT</B> statement that contains values for all updated fields in the record.<BR><BR></LI>

	<LI>For <B>AddNew</B>, <B>Update</B> concludes by restoring the previously stored values of the record that was current before the <B>AddNew</B> call. For <B>Edit</B>, the new, edited values remain in place.</LI>
</OL>

<P>The following table shows the sequence of RFX operations when you add a new record or edit an existing record.</P>

<P class=label><B><A NAME="_core_sequence_of_rfx_operations_during_addnew_and_edit"></A>Sequence of RFX Operations During AddNew and Edit</B></P>

<TABLE border=1 cellpadding=5 cols=3 frame=below rules=rows>

<TR VALIGN="top">
<TD class=label width=26%><B>Your operation</B></TD>
<TD class=label width=38%><B>DoFieldExchange operation</B></TD>
<TD class=label width=36%><B>Database/SQL operation</B></TD>
</TR>

<TR VALIGN="top">
<TD width=26%>1. Call <B>AddNew</B> or <B>Edit</B>.</TD>
<TD width=38%>&nbsp;</TD>
<TD width=36%>&nbsp;</TD>
</TR>

<TR VALIGN="top">
<TD width=26%>&nbsp;</TD>
<TD width=38%>2. Back up the edit buffer.</TD>
<TD width=36%>&nbsp;</TD>
</TR>

<TR VALIGN="top">
<TD width=26%>&nbsp;</TD>
<TD width=38%>3. For <B>AddNew</B>, mark field data members as “clean” and Null.</TD>
<TD width=36%>&nbsp;</TD>
</TR>

<TR VALIGN="top">
<TD width=26%>4. Assign values to recordset field data members.</TD>
<TD width=38%>&nbsp;</TD>
<TD width=36%>&nbsp;</TD>
</TR>

<TR VALIGN="top">
<TD width=26%>5. Call <B>Update</B>.</TD>
<TD width=38%>&nbsp;</TD>
<TD width=36%>&nbsp;</TD>
</TR>

<TR VALIGN="top">
<TD width=26%>&nbsp;</TD>
<TD width=38%>6. Check for changed fields.</TD>
<TD width=36%>&nbsp;</TD>
</TR>

<TR VALIGN="top">
<TD width=26%>&nbsp;</TD>
<TD width=38%>7. Build SQL <B>INSERT</B> statement for <B>AddNew</B> or <B>UPDATE</B> statement for <B>Edit</B>.</TD>
<TD width=36%>&nbsp;</TD>
</TR>

<TR VALIGN="top">
<TD width=26%>&nbsp;</TD>
<TD width=38%>&nbsp;</TD>
<TD width=36%>8. Send the SQL.</TD>
</TR>

<TR VALIGN="top">
<TD width=26%>&nbsp;</TD>
<TD width=38%>9. For <B>AddNew</B>, restore the edit buffer to its backed-up contents. For <B>Edit</B>, delete the backup.</TD>
<TD width=36%>&nbsp;</TD>
</TR>
</TABLE><BR>

<H3>RFX: Deleting Existing Records</H3>

<P>When you delete a record, RFX sets all the fields to <B>NULL</B> as a reminder that the record is deleted and you must move off it. You won’t need any other RFX sequence information.</P>

<P><B>See Also</B>&nbsp;&nbsp;&nbsp;<A HREF="_core_classwizard.3a_.creating_a_recordset_class.htm">ClassWizard: Creating a Recordset Class</A>, <A HREF="JavaScript:hhobj_9.Click()">Macros and Globals</A>, <A HREF="JavaScript:hhobj_10.Click()">CFieldExchange</A>, <A HREF="JavaScript:hhobj_11.Click()">CRecordset::DoFieldExchange</A></P>
</font>
</BODY>
</HTML>
