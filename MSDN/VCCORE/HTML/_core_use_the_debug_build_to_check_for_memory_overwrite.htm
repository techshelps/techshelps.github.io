<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Use the Debug Build To Check for Memory Overwrite</TITLE>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_vc_compiling_home">
</OBJECT>
</TD></TR></TABLE>


<font face="verdana,arial,helvetica" size="2">
<H1><A NAME="_core_use_the_debug_build_to_check_for_memory_overwrite"></A>Use the Debug Build To Check for Memory Overwrite</H1>

<P><A HREF="JavaScript:hhobj_1.Click()">Home</A>  |&nbsp; <A HREF="_core_creating_a_release_build.3a_.overview.htm">Overview</A></P>

<P>First, switch back and rebuild your project for debug. Go to the very beginning of your application's <B>InitInstance</B> function and add the following line:</P>

<PRE><CODE>afxMemDF |= checkAlwaysMemDF;</CODE></PRE>

<P>The debug memory allocator puts guard bytes around all memory allocations. However, these guard bytes don't do any good unless you check whether they have been changed (which would indicate a memory overwrite). Otherwise, this just provides a buffer that might in fact allow you to get away with a memory overwrite.</P>

<P>By turning on the <CODE>checkAlwaysMemDF</CODE>, you will force MFC to make a call to the <B>AfxCheckMemory</B> function every time a call to <B>new</B> or <B>delete</B> is made. If a memory overwrite was detected, it will generate a TRACE message that looks similar to the following:</P>

<PRE><CODE>Damage Occurred! Block=0x5533</CODE></PRE>

<P>If you see one of these messages, you need to step through your code to determine where the damage occurred. To isolate more precisely where the memory overwrite occurred, you can make explicit calls to <B>AfxCheckMemory</B> yourself. For example:</P>

<PRE><CODE>ASSERT(AfxCheckMemory());
    DoABunchOfStuff();
    ASSERT(AfxCheckMemory());</CODE></PRE>

<P>If the first ASSERT succeeds and the second one fails, it means that the memory overwrite must have occurred in the function between the two calls.</P>

<P>Depending on the nature of your application, you may find that <B>afxMemDF</B> causes your program to run too slowly to even test. The <B>afxMemDF</B> variable causes <B>AfxCheckMemory</B> to be called for every call to new and delete. In that case, you should scatter your own calls to <B>AfxCheckMemory</B>( ) as shown above, and try to isolate the memory overwrite that way.</P>
</font>
</BODY>
</HTML>
