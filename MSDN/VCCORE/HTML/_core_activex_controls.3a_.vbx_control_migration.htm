<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>ActiveX Controls: VBX Control Migration</TITLE>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_vc_addui_home">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="circle sample start">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_sample_mfc_CONTROLS">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_sample_mfc_CONTROLS">
</OBJECT>
</TD></TR></TABLE>


<font face="verdana,arial,helvetica" size="2">
<H1><A NAME="_core_activex_controls.3a_.vbx_control_migration"></A>ActiveX Controls: VBX Control Migration</H1>

<P><A HREF="JavaScript:hhobj_1.Click()">Home</A>  |&nbsp; <A HREF="_core_activex_controls.3a_.overview.htm">Overview</A>  |&nbsp; <A HREF="_core_activex_control_tasks.htm">How Do I</A>  |&nbsp; <A HREF="_core_frequently_asked_questions_about_activex_controls.htm">FAQ</A>  |&nbsp; <A HREF="JavaScript:hhobj_2.Click()">Tutorial</A>  |&nbsp; <A HREF="_core_activex_control_sample_list.htm">Sample</A></P>

<P>SVBX control migration was available only through the VBX template tool, a part of the ControlWizard found in version 1.x of the CDK. Because this tool was removed from the ControlWizard shipped with Visual C++ 4.0, migrating existing VBX controls requires version 1.x of the CDK. The only option for VBX migration using VC ++ 4.0 is to create a framework from ControlWizard and manually port the entire code base of the VBX control into the ActiveX control framework.</P>

<P>As stated above, developers with existing VBX controls can use the VBX template tool, found in the CDK ControlWizard, to convert existing VBX controls to the ActiveX control format.</P>

<P>The VBX template tool helps you migrate your VBX custom control to an ActiveX control. The template tool uses model information in the .VBX file and creates a Visual C++ project file, as well as source code files for creating the ActiveX control. These files can be compiled and linked to produce a working framework for the ActiveX control.</P>

<P>Once this framework is built and tested, the next step is to take code from your VBX source files and place it in the appropriate areas of the generated OLE source files. The transplanted code will probably require some degree of modification to work in the new source code files.</P>

<P>This article explains:

<UL type=disc>
	<LI><A HREF="#_core_preparing_the_vbx_custom_control">Preparing your .VBX source code files for conversion</A><BR><BR></LI>

	<LI><A HREF="#_core_running_the_vbx_template_tool">Using the VBX template tool</A><BR><BR></LI>

	<LI><A HREF="#_core_what_gets_converted">What gets converted</A><BR><BR></LI>

	<LI><A HREF="#_core_building_and_testing_the_activex_control_framework">Building and testing the framework of your ActiveX control</A><BR><BR></LI>

	<LI><A HREF="#_core_where_to_go_from_here">Where to go from here</A></LI>
</UL>

<P>If you want to port your ActiveX control framework to Visual C++ 4.0, see the article <A HREF="_core_activex_controls.3a_.converting_a_cdk_project_to_a_visual_c.2b2b_.project.htm">ActiveX Controls: Converting a CDK Project to a Visual C++ Project</A>.</P>



<H2><A NAME="_core_preparing_the_vbx_custom_control"></A>Preparing the VBX Custom Control</H2>

<P>For the VBX template tool to properly translate the VBX control, you must expose the VBX control model information to the template builder, using the <B>VBGetModelInfo</B> function. If your VBX source code does not already define this function, first define a <B>MODELINFO</B> structure containing a specific Visual Basic version number, and a <B>NULL</B>-terminated array of <B>MODEL</B> structures. The MFC ActiveX controls sample CIRC3, listed under <A HREF="JavaScript:hhobj_3.Click()">CONTROLS</A>, defines the <B>MODELINFO</B> structure as follows:</P>

<PRE><CODE>LPMODEL modellistCircle[] =
    {
    &amp;modelCircle,
    NULL
    };
</CODE></PRE>

<P class=indent><B><B>Note</B></B>&nbsp;&nbsp;&nbsp;Remember to NULL-terminate the array of model pointers.</P>

<PRE><CODE>MODELINFO modelinfoCircle =
    {
    VB_VERSION,        // VB version being used
    modellistCircle    // MODEL list
    };
</CODE></PRE>

<P class=indent><B><B>Note</B></B>&nbsp;&nbsp;&nbsp;If your .VBX file provides different models to support earlier versions, you should create similar <B>MODELINFO</B> structures to point to those models. The CIRC3 custom control, for example, also defines <CODE>ModelinfoCircle_VB1</CODE> and <CODE>ModelinfoCircle_VB2</CODE> structures.</P>

<P>Once you have defined the <B>MODELINFO</B> structure(s), you can define the <B>VBGetModelInfo</B> function, as an export, in your source code. The MFC ActiveX controls sample CIRC3, listed under <A HREF="JavaScript:hhobj_4.Click()">CONTROLS</A>, defines the function:</P>

<PRE><CODE>LPMODELINFO FAR PASCAL _export VBGetModelInfo
(
    USHORT usVersion
)
{
    if (usVersion &lt;= VB100_VERSION)
        return &amp;modelinfoCircle_Vb1;

    if (usVersion &lt;= VB200_VERSION)
        return &amp;modelinfoCircle_Vb2;
    else
        return &amp;modelinfoCircle;
}
</CODE></PRE>

<P>Once this function is defined, rebuild your VBX control before using the template tool.</P>



<H2><A NAME="_core_running_the_vbx_template_tool"></A>Running the VBX Template Tool</H2>

<P>After your VBX control has been built with the <B>VBGetModelInfo</B> function, as described in the previous topic, you are ready to run the VBX template tool.</P>

<P>As mentioned before, you must be using the ControlWizard that shipped with version 1.x of the CDK. The template tool is not available with Visual C++ 4.0.</P>

<P>If you only need to use the ControlWizard shipped with version 1.x of the CDK, you can copy two files from the distribution CD. These two files, CTLWZLIB.DLL and MFCCTLWZ.EXE, is in the vc152\msvccdk directory of the Visual C++ Version 1.52 CD.</P>

<P class=label><B>To run the VBX template tool</B>

<OL>
	<LI>Start <B>ControlWizard </B>by running MFCCTLWZ.EXE from the DOS command prompt or Windows Explorer.<BR><BR></LI>

	<LI>When the <B>ControlWizard </B>dialog box appears, change to the desired drive and directory and enter a project name. ControlWizard automatically creates a new subdirectory with the same name as the project.<BR><BR></LI>

	<LI>Click <B>Control Options</B>. When the <B>Control Options</B> dialog box appears, choose the <B>Use VBX Control as Template</B> check box.<BR><BR></LI>

	<LI>Click <B>Select VBX Control</B>.<BR><BR></LI>

	<LI>In the <B>Use VBX Control as Template </B>dialog box, type the .VBX file name, including the drive and directory path. Alternatively, you can click <B>Browse </B>to locate and select your .VBX file. All control names defined in the .VBX file are displayed in the control name drop-down list. Select the desired control name from the drop-down list.
<P class=atl><B><B>Note</B></B>&nbsp;&nbsp;&nbsp;If you select a .VBX file that does not properly export the model information (as described in the Note in <A HREF="#_core_preparing_the_vbx_custom_control">Preparing the VBX Custom Control</A>), Visual C++ may crash at this point.</p></LI>

	<LI>Click <B>OK </B>twice to close the <B>Use VBX Control as Template</B> box and the <B>Control Options</B> box. Click <B>OK </B>from <B>ControlWizard </B>to prepare to create the template.<BR><BR></LI>

	<LI>When the<B> New Control Information</B> box appears, a summary of&nbsp; the generated files is displayed. Click <B>Create </B>to create all the files for the ActiveX control.<BR><BR></LI>

	<LI>When the VBX template tool is finished, your project directory should contain the following files (the files listed here assume the VBX example control, CIRC3.VBX, was used as the project):
<UL type=disc>
	<LI>CIRC3.CLW<BR><BR></LI>

	<LI>CIRC3.CPP<BR><BR></LI>

	<LI>CIRC332.DEF<BR><BR></LI>

	<LI>CIRC3.DEF<BR><BR></LI>

	<LI>CIRC3.H<BR><BR></LI>

	<LI>CIRC3.ICO<BR><BR></LI>

	<LI>CIRC3.MAK<BR><BR></LI>

	<LI>CIRC332.MAK<BR><BR></LI>

	<LI>MAKEFILE<BR><BR></LI>

	<LI>CIRC3.ODL<BR><BR></LI>

	<LI>CIRC3.RC<BR><BR></LI>

	<LI>CIRC3.RC2<BR><BR></LI>

	<LI>CIRC3CTL.BMP<BR><BR></LI>

	<LI>CIRC3CTL.CPP<BR><BR></LI>

	<LI>CIRC3CTL.H<BR><BR></LI>

	<LI>CIRC3PPG.CPP<BR><BR></LI>

	<LI>CIRC3PPG.H<BR><BR></LI>

	<LI>README.TXT<BR><BR></LI>

	<LI>RESOURCE.H<BR><BR></LI>

	<LI>STDAFX.CPP<BR><BR></LI>

	<LI>STDAFX.H</LI>
</UL>
</LI>
</OL>

<P>In addition, a subdirectory for the Type library file is created. If you are using the 16-bit version of the CDK, it is called TLB16. If you are using the 32-bit version of the CDK, it is called OBJDU.</P>

<P>The README.TXT file contains a summary description of each file created by the VBX template tool. These files are all that is required to build a complete working framework of the new ActiveX control.</P>

<H2><A NAME="_core_what_gets_converted"></A>What Gets Converted</H2>

<P>The template generated by the VBX template tool is similar to the "blank" template that is generated when you use ControlWizard to create a new control, with the following differences:</P>

<H3>Stock Properties and Events</H3>

<P>ControlWizard converts most of the standard properties and events in your .VBX to fully implemented stock properties and events in the template's source code.</P>

<P>Stock properties supported by the VBX template tool include:

<UL type=disc>
	<LI>BorderStyle<BR><BR></LI>

	<LI>Enabled<BR><BR></LI>

	<LI>Font<BR><BR></LI>

	<LI>Caption<BR><BR></LI>

	<LI>Text<BR><BR></LI>

	<LI>ForeColor<BR><BR></LI>

	<LI>BackColor<BR><BR></LI>

	<LI>hWnd</LI>
</UL>

<P>Stock events supported by the VBX template tool include:

<UL type=disc>
	<LI>Click<BR><BR></LI>

	<LI>DblClick<BR><BR></LI>

	<LI>KeyDown<BR><BR></LI>

	<LI>KeyPress<BR><BR></LI>

	<LI>KeyUp<BR><BR></LI>

	<LI>MouseDown<BR><BR></LI>

	<LI>MouseMove<BR><BR></LI>

	<LI>MouseUp</LI>
</UL>

<P class=indent><B><B>Note</B></B>&nbsp;&nbsp;&nbsp;A number of properties not mentioned above that were formerly standard in the .VBX Control model are automatically supported by ActiveX as standard "extender" properties (e.g., Left, Top, Height, Width). Therefore, these properties are not needed in an ActiveX control, and are not converted by the VBX template tool.</P>

<H3>Currently Unimplemented Properties and Events</H3>

<P>Stock properties of the VBX model not supported:

<UL type=disc>
	<LI>DragIcon<BR><BR></LI>

	<LI>DragMode<BR><BR></LI>

	<LI>MouseCursor<BR><BR></LI>

	<LI>MousePointer</LI>
</UL>

<P>Stock events of the VBX model not supported:

<UL type=disc>
	<LI>DragDrop<BR><BR></LI>

	<LI>DragOver<BR><BR></LI>

	<LI>LinkOpen<BR><BR></LI>

	<LI>LinkClose<BR><BR></LI>

	<LI>LinkError<BR><BR></LI>

	<LI>LinkNotify</LI>
</UL>

<H3>Custom Properties and Events</H3>

<P>Custom properties and events in your VBX control are provided in the template as stub functions. In order to make these properties and events functional, you must port the implementation code from your VBX control’s source files into the appropriate files in the new control template. These places are indicated by similar comments in the template's source code files:</P>

<PRE><CODE>    // TODO: Initialize your control's instance data here.
</CODE></PRE>



<H2><A NAME="_core_building_and_testing_the_activex_control_framework"></A>Building and Testing the ActiveX Control Framework</H2>

<P>After ControlWizard generates the basic framework for your VBX control, build and test the control to familiarize yourself with ActiveX control behavior. The following sections describe this process and demonstrate how to use Test Container to test your new ActiveX control.</P>

<H3>Creating the Type Library for the ActiveX Control</H3>

<P>Note that the following information only applies if you are using the 16-bit version of Visual C++. If you are using the 32-bit version of Visual C++, the type library is automatically generated by the control makefile.</P>

<P>Before you can compile and link the control template, you must create a type library, used by control containers that use your control. This will be based on the information contained in the Object Description Library (.ODL) file created by the porting tool.</P>

<P class=label><B>To create the type library</B>

<OL>
	<LI>Load the project make file that you generated by running the VBX template tool.<BR><BR></LI>

	<LI>On the <B>Tools </B>menu, click <B>Make TypeLib</B>. MKTYPLIB.EXE creates a type library based on the .ODL file in the project. After building successfully, MKTYPLIB automatically adds the resulting *.TLB file to your project. The information in this .TLB file will be built into your .DLL as a resource.</LI>
</OL>

<H3>Compiling, Linking, and Registering the ActiveX Control Framework</H3>

<P>Note that the following information only applies if you are using the 16-bit version of Visual C++.</P>

<P>After creating the Type Library, you can build the framework control by choosing Build from the Visual C++ Project menu.</P>

<P>When the project has built successfully, you must register the new control before you can test it. Choose Register Control from the Tools menu. A message box appears, indicating that the control was successfully registered.</P>

<H2>Testing the ActiveX Control Framework</H2>

<P>For procedures on testing your ActiveX control framework, see the article <A HREF="_core_test_container.htm">Test Container</A>.</P>



<H2><A NAME="_core_where_to_go_from_here"></A>Where to Go From Here</H2>

<P>When you are satisfied that the control framework is working properly, the next step is to port the implementation of your ActiveX control's custom properties and events from your VBX source code to the new control's source code files. To do this, use ClassWizard and the implementation guidelines in the ActiveX controls articles. Remember to back up your files frequently and to use Test Container to test each new block of code as you go.</P>

<P>Once the VBX control is ported to a CDK project, you could port the CDK project to Visual C++ 4.0 by following the steps given in the article <A HREF="_core_activex_controls.3a_.converting_a_cdk_project_to_a_visual_c.2b2b_.project.htm">ActiveX Controls: Converting a CDK Project to a Visual C++ Project</A>.</P>
</font>
</BODY>
</HTML>
