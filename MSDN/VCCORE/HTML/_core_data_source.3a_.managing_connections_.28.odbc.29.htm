<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Data Source: Managing Connections (ODBC)</TITLE>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_vc_addpf_home">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="Enroll tutorial">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.GetDefaultConnect">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CDatabase.3a3a.OpenEx">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CDatabase.3a3a.Open">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CDatabase.3a3a.Close">
</OBJECT>
<OBJECT ID="hhobj_7" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CRecordset">
</OBJECT>
</TD></TR></TABLE>


<font face="verdana,arial,helvetica" size="2">
<H1><A NAME="_core_data_source.3a_.managing_connections_.28.odbc.29"></A>Data Source: Managing Connections (ODBC)</H1>

<P><A HREF="JavaScript:hhobj_1.Click()">Home</A>  |&nbsp; <A HREF="_core_databases.3a_.overview.htm">Overview</A>  |&nbsp; <A HREF="_core_odbc_database_tasks.htm">How Do I</A>  |&nbsp; <A HREF="_core_databases.3a_.frequently_asked_questions.htm">FAQ</A>  |&nbsp; <A HREF="_core_odbc_database_sample_list.htm">Sample</A>  |&nbsp; <A HREF="JavaScript:hhobj_2.Click()">Tutorial</A>  |&nbsp; <A HREF="_core_odbc_driver_list.htm">ODBC Driver List</A></P>

<P>This article applies to the MFC ODBC classes. For information about the MFC DAO classes, see the article <A HREF="_core_data_access_objects_.28.dao.29.htm">Data Access Objects (DAO)</A>.</P>

<P>This article explains:

<UL type=disc>
	<LI><A HREF="#_core_configuring_a_data_source">How to configure a data source</A>.<BR><BR></LI>

	<LI><A HREF="#_core_working_in_a_multiuser_environment">How a multiuser environment affects a data source and its recordsets</A>.<BR><BR></LI>

	<LI><A HREF="#_core_generalizing_the_connection_string">Why you generalize a connection string to a data source</A>.<BR><BR></LI>

	<LI><A HREF="#_core_connecting_to_a_specific_data_source">How to connect to a data source</A>.<BR><BR></LI>

	<LI><A HREF="#_core_disconnecting_from_a_data_source">How to disconnect from a data source</A>.<BR><BR></LI>

	<LI><A HREF="#_core_reusing_a_cdatabase_object">How to reuse a CDatabase object</A>.</LI>
</UL>

<P>Connecting to a data source means establishing communications with a DBMS in order to access the data. When you connect to a data source from an application through an ODBC driver, the driver makes the connection for you, either locally or across a network. </P>

<P>You can connect to any data source for which you have an ODBC driver. Users of your application must also have the same ODBC driver for their data source. For more information about redistributing ODBC drivers, see <A HREF="_core_redistributing_odbc_components_to_your_customers.htm">Redistributing ODBC Components to Your Customers</A> in the article ODBC. </P>

<H2><A NAME="_core_configuring_a_data_source"></A>Configuring a Data Source</H2>

<P>ODBC Administrator is used to configure your data sources. You can also use ODBC Administrator after installation to add or remove data sources. When you create applications, you can either direct your users to the ODBC Administrator to let them add data sources, or you can build this functionality into your application by making direct ODBC installation calls. For more information, see the Setup DLL Function Reference chapter in the ODBC <I>Programmer’s Reference</I>, the article <A HREF="_core_odbc_administrator.htm">ODBC Administrator</A>, and the online ODBC API Reference help system.</P>



<H2><A NAME="_core_working_in_a_multiuser_environment"></A>Working in a Multiuser Environment</H2>

<P>If multiple users are connected to a data source, they can change data while you are manipulating it in your recordsets. Similarly, your changes may affect other users’ recordsets. For more information about how your updates affect other users, and how their updates affect you, see the articles <A HREF="_core_recordset.3a_.how_recordsets_update_records_.28.odbc.29.htm">Recordset: How Recordsets Update Records (ODBC)</A> and <A HREF="_core_transaction_.28.odbc.29.htm">Transaction (ODBC)</A>. </P>



<H2><A NAME="_core_generalizing_the_connection_string"></A>Generalizing the Connection String</H2>

<P>ClassWizard uses a default connection string to establish a connection to a data source. You use this connection to view tables and columns while you are developing your application. However, this default connection string may not be appropriate for your users’ connections to the data source through your application. For example, their data source and the path to its location may be different from the one used in developing your application. In that case, you should re-implement the <A HREF="JavaScript:hhobj_3.Click()">CRecordset::GetDefaultConnect</A> member function in a more generic fashion and discard ClassWizard’s implementation. For example, use one of the following approaches:

<UL type=disc>
	<LI>Register and manage the connect strings by using ODBC Administrator.<BR><BR></LI>

	<LI>Remove the data-source name completely. The framework supplies “ODBC” as the data source and ODBC will display a dialog box asking for the data-source name, and any other required connection information.<BR><BR></LI>

	<LI>Supply the data-source name only. ODBC will ask for the user ID and password, if required. For example, before generalizing, the connection string looks like this:
<PRE><CODE>CString CApp1Set::GetDefaultConnect()
{
return "ODBC;DSN=afx;UID=sa;PWD=Fred;";
}
</CODE></PRE>

<P class=tl>To generalize it, rewrite <B>GetDefaultConnect</B> so that it returns one of the following values:</P>
<PRE><CODE>// Most general case. User must select data source and 
// supply user and password
    return "ODBC;";
// User and password required
    return "ODBC;DSN=mydb;";
// Password required
    return "ODBC;DSN=mydb;UID=sa;";
// On most systems, will connect to server w/o any queries to user
    return "ODBC;DSN=mydb;UID=sa;PWD=Fred;";
</CODE></PRE>
</LI>
</UL>



<H2><A NAME="_core_connecting_to_a_specific_data_source"></A>Connecting to a Specific Data Source</H2>

<P>To connect to a specific data source, your data source must already have been configured with <A HREF="_core_odbc_administrator.htm">ODBC Administrator</A>.</P>

<P class=label><B><A NAME="_core_to_connect_to_a_specific_data_source"></A>To connect to a specific data source</B>

<OL>
	<LI>Construct a <B>CDatabase</B> object.<BR><BR></LI>

	<LI>Call its <B>OpenEx</B> or <B>Open</B> member function.</LI>
</OL>

<P>For more information about how to specify the data source if it is something other than the one you specified with ClassWizard, see <A HREF="JavaScript:hhobj_4.Click()">CDatabase::OpenEx</A> or <A HREF="JavaScript:hhobj_5.Click()">CDatabase::Open</A> in the <I>Class Library Reference</I>.</P>



<H2><A NAME="_core_disconnecting_from_a_data_source"></A>Disconnecting from a Data Source</H2>

<P>You must close any open recordsets before calling the <B>Close</B> member function of <B>CDatabase</B>. In recordsets associated with the <B>CDatabase</B> object you want to close, any pending <B>AddNew</B> or <B>Edit</B> statements are canceled, and all pending transactions are rolled back.</P>

<P class=label><B><A NAME="_core_to_disconnect_from_a_data_source"></A>To disconnect from a data source</B>

<OL>
	<LI>Call the <B>CDatabase</B> object’s <A HREF="JavaScript:hhobj_6.Click()">Close</A> member function.<BR><BR></LI>

	<LI>Destroy the object unless you want to reuse it.</LI>
</OL>

<H2><A NAME="_core_reusing_a_cdatabase_object"></A>Reusing a CDatabase Object</H2>

<P>You can reuse a <B>CDatabase</B> object after disconnecting from it, whether you use it to reconnect to the same data source or to connect to a different data source. </P>

<P class=label><B><A NAME="_core_to_reuse_a_cdatabase_object"></A>To reuse a CDatabase object</B>

<OL>
	<LI>Close the object’s original connection.<BR><BR></LI>

	<LI>Instead of destroying the object, call its <B>OpenEx</B> or <B>Open</B> member function again.</LI>
</OL>

<P><B>See Also</B>&nbsp;&nbsp;&nbsp;<A HREF="_core_data_source.3a_.determining_the_schema_of_the_data_source_.28.odbc.29.htm">Data Source: Determining the Schema of the Data Source (ODBC)</A> <A HREF="JavaScript:hhobj_7.Click()">CRecordset</A> </P>
</font>
</BODY>
</HTML>
