<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Containers: Compound Files</TITLE>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_vc_addpf_home">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_com_IStream">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_com_IStorage">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_com_ILockBytes">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_COleStreamFile">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_COleDocument">
</OBJECT>
</TD></TR></TABLE>


<font face="verdana,arial,helvetica" size="2">
<H1><A NAME="_core_containers.3a_.compound_files"></A>Containers: Compound Files</H1>

<P><A HREF="JavaScript:hhobj_1.Click()">Home</A>  |&nbsp; <A HREF="_core_ole_in_mfc.3a_.overview.htm">Overview</A>  |&nbsp; <A HREF="_core_ole_tasks.htm">How Do I</A>  |&nbsp; <A HREF="_core_ole_sample_list.htm">Sample</A>  |&nbsp; <A HREF="_core_ole_tutorial_list.htm">Tutorial</A></P>

<P>This article explains the components and implementation of compound files and the advantages and disadvantages of using compound files in your OLE applications.</P>

<P>Compound files are an integral part of OLE. They are used to facilitate data transfer and OLE document storage. Compound files are an implementation of the Active structured storage model. Consistent interfaces exist that support serialization to a storage, a stream, or a file object. Compound files are supported in the Microsoft Foundation Class Library by the classes <B>COleStreamFile</B> and <B>COleDocument</B>.</P>

<P class=indent><B><B>Note</B></B>&nbsp;&nbsp;&nbsp;Using a compound file does not imply that the information comes from an OLE document or a compound document. Compound files are just one of the ways to store compound documents, OLE documents, and other data.</P>



<H2><A NAME="_core_components_of_a_compound_file"></A>Components of a Compound File</H2>

<P>OLE’s implementation of compound files uses three object types: stream objects, storage objects, and <B>ILockBytes</B> objects. These objects are similar to the components of a standard file system in the following ways: 

<UL type=disc>
	<LI>Stream objects, like files, store data of any type. <BR><BR></LI>

	<LI>Storage objects, like directories, can contain other storage and stream objects. <BR><BR></LI>

	<LI><B>LockBytes</B> objects represent the interface between the storage objects and the physical hardware. They determine how the actual bytes are written to whatever storage device the <B>LockBytes</B> object is accessing, such as a hard drive or an area of global memory. For more information about <B>LockBytes</B> objects and the <B>ILockBytes</B> interface, see the <I>OLE Programmer’s Reference</I>.</LI>
</UL>



<H2><A NAME="_core_advantages_and_disadvantages_of_compound_files"></A>Advantages and Disadvantages of Compound Files</H2>

<P>Compound files provide benefits not available with earlier methods of file storage. They include:

<UL type=disc>
	<LI>Incremental file accessing<BR><BR></LI>

	<LI>File access modes<BR><BR></LI>

	<LI>Standardization of file structure</LI>
</UL>

<P>The potential disadvantages of compound files — large size and performance issues relating to storage on floppy disks — should be considered when deciding whether to use them in your application.</P>



<H3><A NAME="_core_incremental_access_to_files"></A>Incremental Access to Files</H3>

<P>Incremental access to files is an automatic benefit of using compound files. Because a compound file can be viewed as a “file system within a file,” individual object types, such as stream or storage, can be accessed without the need to load the entire file. This can dramatically decrease the time an application needs to access new objects for editing by the user. Incremental updating, based on the same concept, offers similar benefits. Instead of saving the entire file just to save the changes made to one object, OLE saves only the stream or storage object edited by the user.</P>



<H3><A NAME="_core_file_access_modes"></A>File Access Modes</H3>

<P>Being able to determine when changes to objects in a compound file are committed to disk is another benefit of using compound files. The mode in which files are accessed, either transacted or direct, determines when changes are committed. 

<UL type=disc>
	<LI>Transacted mode uses a two-phase commit operation to make changes to objects in a compound file, thereby keeping both the old and the new copies of the document available until the user chooses to either save or undo the changes. <BR><BR></LI>

	<LI>Direct mode incorporates changes to the document as they are made, without the ability to later undo them. </LI>
</UL>

<P>For more information on access modes, see the <I>OLE Programmer’s Reference</I>.</P>



<H3><A NAME="_core_standardization"></A>Standardization</H3>

<P>The standardized structure of compound files allows different OLE applications to browse through compound files created by your OLE application with no knowledge of the application that actually created the file.</P>



<H3><A NAME="_core_size_and_performance_considerations"></A>Size and Performance Considerations</H3>

<P>Because of the complexity of the compound file storage structure and the ability to save data incrementally, files using this format tend to be larger than other files using unstructured or “flat file” storage. If your application frequently loads and saves files, using compound files can cause the file size to increase much more quickly than noncompound files. Because compound files can get large, the access time for files stored on and loaded from floppy disks can also be affected, resulting in slower access to files.</P>

<P>Another issue that affects performance is compound-file fragmentation. The size of a compound file is determined by the difference between the first and last disk sectors used by the file. A fragmented file can contain many areas of free space that do not contain data, but are counted when calculating the size. During the lifetime of a compound file, these areas are created by the insertion or deletion of storage objects.</P>



<H2><A NAME="_core_using_compound_files_format_for_your_data"></A>Using Compound Files Format for Your Data</H2>

<P>After successfully creating an application that has a document class derived from <B>COleDocument</B>, ensure that your main document constructor calls <B>EnableCompoundFile</B>. When AppWizard creates OLE container applications, this call is inserted for you.</P>

<P>In the <I>OLE Programmer’s Reference</I>, see <A HREF="JavaScript:hhobj_2.Click()">IStream</A>, <A HREF="JavaScript:hhobj_3.Click()">IStorage</A>, <A HREF="JavaScript:hhobj_4.Click()">ILockBytes</A>.</P>

<P><B>See Also</B>&nbsp;&nbsp;&nbsp;<A HREF="_core_containers.3a_.user.2d.interface_issues.htm">Containers: User-Interface Issues</A>, <A HREF="JavaScript:hhobj_5.Click()">COleStreamFile</A>, <A HREF="JavaScript:hhobj_6.Click()">COleDocument</A></P>
</font>
</BODY>
</HTML>
