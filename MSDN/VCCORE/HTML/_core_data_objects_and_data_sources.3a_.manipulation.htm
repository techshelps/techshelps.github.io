<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Data Objects and Data Sources: Manipulation</TITLE>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_vc_addpf_home">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_COleDataObject">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_COleDataSource">
</OBJECT>
</TD></TR></TABLE>


<font face="verdana,arial,helvetica" size="2">
<H1><A NAME="_core_data_objects_and_data_sources.3a_.manipulation"></A>Data Objects and Data Sources: Manipulation</H1>

<P><A HREF="JavaScript:hhobj_1.Click()">Home</A>  |&nbsp; <A HREF="_core_ole_in_mfc.3a_.overview.htm">Overview</A>  |&nbsp; <A HREF="_core_ole_tasks.htm">How Do I</A>  |&nbsp; <A HREF="_core_ole_sample_list.htm">Sample</A>  |&nbsp; <A HREF="_core_ole_tutorial_list.htm">Tutorial</A></P>

<P>After a data object or data source has been created, you can perform a number of common operations on the data, such as inserting and removing data, enumerating the formats the data is in, and more. This article describes the techniques necessary to complete the most common operations. Topics include:

<UL type=disc>
	<LI><A HREF="#_core_inserting_data_into_a_data_source">Inserting data into a data source</A><BR><BR></LI>

	<LI><A HREF="#_core_determining_the_formats_available_in_a_data_object">Determining the formats available in a data object</A><BR><BR></LI>

	<LI><A HREF="#_core_retrieving_data_from_a_data_object">Retrieving data from a data object</A></LI>
</UL>



<H2><A NAME="_core_inserting_data_into_a_data_source"></A>Inserting Data into a Data Source </H2>

<P>How data is inserted into a data source depends on whether the data is supplied immediately or on demand, and in which medium it is supplied. The possibilities are as follows.</P>

<H3>Supplying Data Immediately (Immediate Rendering)</H3>

<UL type=disc>
	<LI>Call <B>COleDataSource::CacheGlobalData</B> repeatedly for every Clipboard format in which you are supplying data. Pass the Clipboard format to be used, a handle to the memory containing the data and, optionally, a <B>FORMATETC</B> structure describing the data.
<P class=tl>-or-</P></LI>

	<LI>If you want to work directly with <B>STGMEDIUM</B> structures, you call <B>COleDataSource::CacheData</B> instead of <B>COleDataSource::CacheGlobalData</B> in the option above.</LI>
</UL>

<H3>Supplying Data on Demand (Delayed Rendering)</H3>

<P>This is an advanced topic.

<UL type=disc>
	<LI>Call <B>COleDataSource::DelayRenderData</B> repeatedly for every Clipboard format in which you are supplying data. Pass the Clipboard format to be used and, optionally, a <B>FORMATETC</B> structure describing the data. When the data is requested, the framework will call <B>COleDataSource::OnRenderData</B>, which you must override.
<P class=tl>-or-</P></LI>

	<LI>If you use a <B>CFile</B> object to supply the data, call <B>COleDataSource::DelayRenderFileData</B> instead of <B>COleDataSource::DelayRenderData</B> in the option above. When the data is requested, the framework will call <B>COleDataSource::OnRenderFileData</B>, which you must override.</LI>
</UL>



<H2><A NAME="_core_determining_the_formats_available_in_a_data_object"></A>Determining the Formats Available in a Data Object</H2>

<P>Before an application allows the user to paste data into it, it needs to know if there are formats on the Clipboard that it can handle. To do this, your application should do the following:

<OL>
	<LI>Create a <B>COleDataObject</B> object and a <B>FORMATETC</B> structure.<BR><BR></LI>

	<LI>Call the data object’s <B>AttachClipboard</B> member function to associate the data object with the data on the Clipboard.<BR><BR></LI>

	<LI>Do one of the following:
<UL type=disc>
	<LI>Call the data object’s <B>IsDataAvailable</B> member function if there are only one or two formats you need. This will save you time in cases where the data on the Clipboard supports significantly more formats than your application.
<P class=tl>-or-</P></LI>

	<LI>Call the data object’s <B>BeginEnumFormats</B> member function to start enumerating the formats available on the Clipboard. Then call <B>GetNextFormat</B> until the Clipboard returns a format your application supports or there are no more formats.</LI>
</UL>
</LI>
</OL>

<P>If you are using <B>ON_UPDATE_COMMAND_UI</B>, you can now enable the Paste and, possibly, Paste Special items on the Edit menu. To do this, call either <B>CMenu::EnableMenuItem</B> or <B>CCmdUI::Enable</B>. For more information on what container applications should do with menu items and when, see the <A HREF="_core_menus_and_resources.3a_.container_additions.htm">Menus and Resources: Container Additions</A> article.</P>



<H2><A NAME="_core_retrieving_data_from_a_data_object"></A>Retrieving Data from a Data Object</H2>

<P>Once you have decided on a data format, all that’s left is to retrieve the data from the data object. To do this, the user decides where he or she wants to put the data, and the application calls the appropriate function. The data will be available in one of the following mediums:</P>

<TABLE border=1 cellpadding=5 cols=2 frame=below rules=rows>

<TR VALIGN="top">
<TD class=label width=47%><B>Medium</B></TD>
<TD class=label width=53%><B>Function to call</B></TD>
</TR>

<TR VALIGN="top">
<TD width=47%>Global Memory (<B>HGLOBAL</B>)</TD>
<TD width=53%><B>COleDataObject::GetGlobalData</B></TD>
</TR>

<TR VALIGN="top">
<TD width=47%><B>File (CFile)</B></TD>
<TD width=53%><B>COleDataObject::GetFileData</B></TD>
</TR>

<TR VALIGN="top">
<TD width=47%><B>STGMEDIUM</B> structure (<B>IStorage</B>)</TD>
<TD width=53%><B>COleDataObject::GetData</B></TD>
</TR>
</TABLE><BR>

<P>Commonly, the medium will be specified along with its Clipboard format. For example, a <B>CF_EMBEDDEDSTRUCT</B> object is always in an <B>IStorage</B> medium that requires an <B>STGMEDIUM</B> structure. Therefore, you would use <B>GetData</B> because it is the only one of these functions that can accept an <B>STGMEDIUM</B> structure.</P>

<P>For cases where the Clipboard format is in an <B>IStream</B> or <B>HGLOBAL</B> medium, the framework can provide a <B>CFile</B> pointer that references the data. The application can then use file read to get the data in much the same way as it might import data from a file. Essentially, this is the client-side interface to the <B>OnRenderData</B> and <B>OnRenderFileData</B> routines in the data source.</P>

<P>The user can now insert data into the document just like for any other data in the same format.</P>

<H3>What do you want to know more about?</H3>

<UL type=disc>
	<LI><A HREF="_core_drag_and_drop_.28.ole.29.htm">Drag and drop</A><BR><BR></LI>

	<LI><A HREF="_core_clipboard.3a_.overview.htm">Clipboard</A></LI>
</UL>

<P><B>See Also</B>&nbsp;&nbsp;&nbsp;<A HREF="JavaScript:hhobj_2.Click()">COleDataObject</A>, <A HREF="JavaScript:hhobj_3.Click()">COleDataSource</A></P>
</font>
</BODY>
</HTML>
