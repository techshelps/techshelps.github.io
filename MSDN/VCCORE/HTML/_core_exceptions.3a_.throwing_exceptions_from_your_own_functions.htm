<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Exceptions: Throwing Exceptions from Your Own Functions</TITLE>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_vc_addpf_home">
</OBJECT>
</TD></TR></TABLE>


<font face="verdana,arial,helvetica" size="2">
<H1><A NAME="_core_exceptions.3a_.throwing_exceptions_from_your_own_functions"></A>Exceptions: Throwing Exceptions from Your Own Functions</H1>

<P><A HREF="JavaScript:hhobj_1.Click()">Home</A>  |&nbsp; <A HREF="_core_exception_handling.3a_.overview.htm">Overview</A>  |&nbsp; <A HREF="_core_exception_handling_tasks.htm">How Do I</A>  |&nbsp; <A HREF="_core_exception_handling.3a_.frequently_asked_questions.htm">FAQ</A></P>

<P>It is possible to use the MFC exception-handling paradigm solely to catch exceptions thrown by functions in MFC or other libraries. In addition to catching exceptions thrown by library code, you can throw exceptions from your own code if you are writing functions that can encounter exceptional conditions.</P>

<P>When an exception is thrown, execution of the current function is stopped and jumps directly to the <B>catch</B> block of the innermost exception frame. The exception mechanism bypasses the normal exit path from a function. Therefore, you must be sure to delete those memory blocks that would be deleted in a normal exit. </P>

<P class=label><B><A NAME="_core_to_throw_an_exception"></A>To throw an exception</B>

<UL type=disc>
	<LI>Use one of the MFC helper functions, such as <B>AfxThrowMemoryException</B>. These functions throw a preallocated exception object of the appropriate type. 
<P class=tl>In the following example, a function tries to allocate two memory blocks and throws an exception if either allocation fails:</P>
<PRE><CODE>{
    char* p1 = (char*)malloc( SIZE_FIRST );
    if( p1 == NULL )
        AfxThrowMemoryException();
    char* p2 = (char*)malloc( SIZE_SECOND );
    if( p2 == NULL )
    {
        free( p1 );
        AfxThrowMemoryException();
    }
    
    // ... Do something with allocated blocks ...

    // In normal exit, both blocks are deleted.
    free( p1 );
    free( p2 );
}
</CODE></PRE>

<P class=tl>If the first allocation fails, you can simply throw the memory exception. If the first allocation is successful but the second one fails, you must free the first allocation block before throwing the exception. If both allocations succeed, you can proceed normally and free the blocks when exiting the function.</P>
<P class=tl>&nbsp;–&nbsp;or&nbsp;–&nbsp;</P></LI>

	<LI>Use a user-defined exception to indicate a problem condition. You can throw an item of any type, even an entire class, as your exception.
<P class=tl>The following example attempts to play a sound through a wave device and throws an exception if there is a failure.</P>
<PRE><CODE>#define WAVE_ERROR -5
{
    // This Win32 API returns 0 if the sound cannot be played.
    // Throw an integer constant if it fails.
    if( !sndPlaySound("SIREN.WAV", SND_ASYNC) )
        throw WAVE_ERROR;
}
</CODE></PRE>
</LI>
</UL>

<P class=indent><B><B>Note</B></B>&nbsp;&nbsp;&nbsp;MFC’s default handling of exceptions applies only to pointers to <B>CException</B> objects (and objects of <B>CException</B>-derived classes). The example above bypasses MFC’s exception mechanism.</P>
</font>
</BODY>
</HTML>
