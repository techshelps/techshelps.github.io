<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Record Views: Filling a List Box from a Second Recordset</TITLE>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_vc_addpf_home">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="Enroll tutorial">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordView">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_sample_mfc_ENROLL">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CDaoRecordset">
</OBJECT>
<OBJECT ID="hhobj_7" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CComboBox">
</OBJECT>
<OBJECT ID="hhobj_8" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CComboBox.3a3a.AddString">
</OBJECT>
<OBJECT ID="hhobj_9" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_sample_mfc_ENROLL">
</OBJECT>
</TD></TR></TABLE>


<font face="verdana,arial,helvetica" size="2">
<H1><A NAME="_core_record_views.3a_.filling_a_list_box_from_a_second_recordset"></A>Record Views: Filling a List Box from a Second Recordset</H1>

<P><A HREF="JavaScript:hhobj_1.Click()">Home</A>  |&nbsp; <A HREF="_core_databases.3a_.overview.htm">Overview</A>  |&nbsp; <A HREF="_core_odbc_database_tasks.htm">How Do I</A>  |&nbsp; <A HREF="_core_databases.3a_.frequently_asked_questions.htm">FAQ</A>  |&nbsp; <A HREF="_core_odbc_database_sample_list.htm">Sample</A>  |&nbsp; <A HREF="JavaScript:hhobj_2.Click()">Tutorial</A>  |&nbsp; <A HREF="_core_odbc_driver_list.htm">ODBC Driver List</A></P>

<P>By default, a record view is associated with a single recordset object, whose fields are mapped to the record view’s controls. Sometimes you will want to put a list box or combo box control in your record view and fill it with values from a second recordset object. The user can use the list box to select a new category of information to display in the record view. This article explains how and when to do that.</P>

<P class=indent><B><B>Tip</B></B>&nbsp;&nbsp;&nbsp;Be aware that filling a combo box or list box from a data source might be slow. Take precautions against trying to fill a control from a recordset with a large number of records.</P>

<P>For example, the ENROLL tutorial in <I>Tutorials</I> uses a <A HREF="JavaScript:hhobj_3.Click()">CRecordView</A>, <CODE>CSectionForm</CODE>, to display information about sections of college courses. (For DAO tutorial purposes, follow the ODBC ENROLL tutorial except for Step 1.) ENROLL binds the form’s controls to the field data members of a recordset of class <CODE>CSectionSet</CODE>. <CODE>CSectionForm</CODE>’s combo box control is filled from a second recordset of class <CODE>CCourseSet</CODE> that contains a record for each course offered at the school. When the user selects a new course in the combo box, the record view requeries the <CODE>CSectionSet</CODE> recordset to get the sections for the selected course. See the MFC Tutorial sample <A HREF="JavaScript:hhobj_4.Click()">ENROLL</A>. Step 2 adds the combo box.</P>

<P>The model for this article, then, consists of a primary recordset that fills the controls of your form, while a secondary recordset fills a list box or combo box. Selecting a string from the list box causes your program to requery the primary recordset based on what was selected. The procedure below uses a combo box but applies equally to a list box.</P>

<P class=label><B><A NAME="_core_to_fill_a_list_box_or_combo_box_from_a_second_recordset"></A>To fill a combo box or list box from a second recordset</B>

<OL>
	<LI>Create the recordset object (<A HREF="JavaScript:hhobj_5.Click()">CRecordset</A> for ODBC, <A HREF="JavaScript:hhobj_6.Click()">CDaoRecordset</A> for DAO).<BR><BR></LI>

	<LI>Obtain a pointer to the <A HREF="JavaScript:hhobj_7.Click()">CComboBox</A> object for the combo box control.<BR><BR></LI>

	<LI>Empty the combo box of any previous contents.<BR><BR></LI>

	<LI>Move through all records in the recordset, calling <A HREF="JavaScript:hhobj_8.Click()">CComboBox::AddString</A> for each string from the current record you want to add to the combo box.<BR><BR></LI>

	<LI>Initialize the selection in the combo box. </LI>
</OL>

<P>The code in the <CODE>OnInitialUpdate</CODE> member function of class <CODE>CSectionForm</CODE> in the MFC Tutorial sample <A HREF="JavaScript:hhobj_9.Click()">ENROLL</A> illustrates the procedure. The following excerpt shows how the combo box is filled by extracting a course ID value from each record in the recordset pointed to by <CODE>pCourses</CODE>. (The code for DAO is quite similar.)</P>

<PRE><CODE>void CSectionForm::OnInitialUpdate()
{
    // ...

    // Fill the combo box with all of the courses
    CENROLLDoc* pDoc = GetDocument();
    if (!pDoc-&gt;m_courseSet.Open())
        return;

    // ...

    m_ctlCourseList.ResetContent();
    if (pDoc-&gt;m_courseSet.IsOpen())
    { 
        while (!pDoc-&gt;m_courseSet.IsEOF() )
        {
            m_ctlCourseList.AddString(
                pDoc-&gt;m_courseSet.m_CourseID);
            pDoc-&gt;m_courseSet.MoveNext();
        }
    }
    m_ctlCourseList.SetCurSel(0);
}
</CODE></PRE>

<P>This function uses a second recordset, <CODE>m_courseSet</CODE>, which contains a record for each course offered, and a <B>CComboBox</B> control, <CODE>m_ctlCourseList</CODE>, which is stored in the record view class.</P>

<P>The function gets <CODE>m_courseSet</CODE> from the document and opens it. Then it empties <CODE>m_ctlCourseList</CODE> and scrolls through <CODE>m_courseSet</CODE>. For each record, the function calls the combo box’s <B>AddString</B> member function to add the course ID value from the record. Finally, the code sets the combo box’s selection.</P>
</font>
</BODY>
</HTML>
