<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Strings in MFC</TITLE>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_vc_addpf_home">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_MFC_CString">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CString.3a3a.operator_LPCTSTR">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CString.3a3a.GetBuffer">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CString.3a3a.ReleaseBuffer">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CString.3a3a.AllocSysString">
</OBJECT>
<OBJECT ID="hhobj_7" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CString.3a3a.SetSysString">
</OBJECT>
<OBJECT ID="hhobj_8" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CString">
</OBJECT>
<OBJECT ID="hhobj_9" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CString.3a3a.LockBuffer">
</OBJECT>
<OBJECT ID="hhobj_10" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CString.3a3a.UnlockBuffer">
</OBJECT>
</TD></TR></TABLE>


<font face="verdana,arial,helvetica" size="2">
<H1><A NAME="_core_strings_in_mfc"></A>Strings in MFC</H1>

<P><A HREF="JavaScript:hhobj_1.Click()">Home</A>  |&nbsp; <A HREF="_core_strings.3a_.overview.htm">Overview</A>  |&nbsp; <A HREF="_core_string_handling_tasks.htm">How Do I</A></P>

<P>This article describes the general-purpose services that the class library provides related to string manipulation. Topics covered in this article include:

<UL type=disc>
	<LI><A HREF="#_core_unicode_and_mbcs_provide_portability">Unicode and MBCS provide portability</A><BR><BR></LI>

	<LI><A HREF="#_core_cstrings_and_const_char_pointers">CStrings and const char pointers</A><BR><BR></LI>

	<LI><A HREF="#_core_cstring_reference_counting">CString reference counting</A></LI>
</UL>

<P>The <A HREF="JavaScript:hhobj_2.Click()">CString</A> class provides support for manipulating strings. It is intended to replace and extend the functionality normally provided by the C run-time library string package. The <B>CString</B> class supplies member functions and operators for simplified string handling, similar to those found in Basic. The class also provides constructors and operators for constructing, assigning, and comparing <B>CStrings</B> and standard C++ string data types. Because <B>CString</B> is not derived from <B>CObject</B>, you can use <B>CString</B> objects independently of most of the Microsoft Foundation Class Library (MFC).</P>

<P><B>CString</B> objects follow “value semantics.” A <B>CString</B> object represents a unique value. Think of a <B>CString</B> as an actual string, not as a pointer to a string. </P>

<P>A <B>CString</B> object represents a sequence of a variable number of characters. <B>CString</B> objects can be thought of as arrays of characters. </P>



<H2><A NAME="_core_unicode_and_mbcs_provide_portability"></A>Unicode and MBCS Provide Portability</H2>

<P>With MFC version 3.0 and later, MFC, including <B>CString</B>, is enabled for both Unicode and Multibyte Character Sets (MBCS). This support makes it easier for you to write portable applications that you can build for either Unicode or ANSI characters. To enable this portability, each character in a <B>CString</B> object is of type <B>TCHAR</B>, which is defined as <B>wchar_t</B> if you define the symbol <B>_UNICODE</B> when you build your application, or as <B>char</B> if not. A <B>wchar_t</B> character is 16 bits wide. (Unicode is available only under Windows NT.) MBCS is enabled if you build with the symbol <B>_MBCS</B> defined. MFC itself is built with either the <B>_MBCS</B> symbol (for the NAFX libraries) or the <B>_UNICODE</B> symbol (for the UAFX libraries) defined.</P>

<P class=indent><B><B>Note</B></B>&nbsp;&nbsp;&nbsp;The <B>CString</B> examples in this and the accompanying articles on strings show literal strings properly formatted for Unicode portability, using the <B>_T</B> macro, which translates the literal string to the form</P>

<PRE><CODE>L"literal string"
</CODE></PRE>

<P class=indent>which the compiler treats as a Unicode string. For example, the following code:</P>

<PRE><CODE>CString strName = _T("Name");
</CODE></PRE>

<P class=indent>is translated as a Unicode string if <B>_UNICODE</B> is defined or as an ANSI string if not. For more information, see the article <A HREF="_core_strings.3a_.unicode_and_multibyte_character_set_.28.mbcs.29_.support.htm">Strings: Unicode and Multibyte Character Set (MBCS) Support</A>. </P>

<P>A <B>CString</B> object can store up to <B>INT_MAX</B> (2,147,483,647) characters. The <B>TCHAR</B> data type is used to get or set individual characters inside a <B>CString</B> object. Unlike character arrays, the <B>CString</B> class has a built-in memory allocation capability. This allows <B>CString</B> objects to automatically grow as needed (that is, you don’t have to worry about growing a <B>CString</B> object to fit longer strings). </P>



<H2><A NAME="_core_cstrings_and_const_char_pointers"></A>CStrings and const char Pointers</H2>

<P>A <B>CString</B> object also can act like a literal C-style string (an <B>LPCTSTR</B>, which is the same as <B>const char*</B> if not under Unicode). The <A HREF="JavaScript:hhobj_3.Click()">LPCTSTR</A> conversion operator allows <B>CString</B> objects to be freely substituted for character pointers in function calls. The <B>CString( LPCTSTR</B> <I>lpsz</I> <B>)</B> constructor allows character pointers to be substituted for <B>CString</B> objects. </P>

<P>No attempt is made to fold <B>CString</B> objects. If you make two <B>CString</B> objects containing <CODE>Chicago</CODE>, for example, the characters in <CODE>Chicago</CODE> are stored in two places. (This may not be true of future versions of MFC, so you should not depend on it.)</P>

<P class=indent><B><B>Tips</B></B>&nbsp;&nbsp;&nbsp;Use the <A HREF="JavaScript:hhobj_4.Click()">GetBuffer</A> and <A HREF="JavaScript:hhobj_5.Click()">ReleaseBuffer</A> member functions when you need to directly access a <B>CString</B> as a nonconstant pointer to a character (<B>LPTSTR</B> instead of a <B>const</B> character pointer, <B>LPCTSTR</B>).</P>

<P class=indent>Use the <A HREF="JavaScript:hhobj_6.Click()">AllocSysString</A> and <A HREF="JavaScript:hhobj_7.Click()">SetSysString</A> member functions to allocate and set <B>BSTR</B> objects used in Automation (formerly known as OLE Automation).</P>

<P class=indent>Where possible, allocate <B>CString</B> objects on the frame rather than on the heap. This saves memory and simplifies parameter passing.</P>

<P>The <B>CString</B> class is not implemented as a Microsoft Foundation Class Library collection class, though <B>CString</B> objects can certainly be stored as elements in collections.</P>



<H2><A NAME="_core_cstring_reference_counting"></A>CString Reference Counting</H2>

<P>As of MFC version 4.0, when <A HREF="JavaScript:hhobj_8.Click()">CString</A> objects are copied, MFC increments a reference count rather than copying the data. This makes passing parameters by value and returning <B>CString</B> objects by value more efficient. These operations cause the copy constructor to be called, sometimes more than once. Incrementing a reference count reduces that overhead for these common operations and makes using <B>CString</B> a more attractive option. </P>

<P>As each copy is destroyed, the reference count in the original object is decremented. The original <B>CString</B> object is not destroyed until its reference count is reduced to zero.</P>

<P>You can use the <B>CString</B> member functions <A HREF="JavaScript:hhobj_9.Click()">LockBuffer</A> and <A HREF="JavaScript:hhobj_10.Click()">UnlockBuffer</A> to disable or enable reference counting.</P>

<H2>Further Reading About Strings</H2>

<P>The following articles provide more information about <B>CString</B>:

<UL type=disc>
	<LI><A HREF="_core_strings.3a_.basic_cstring_operations.htm">Strings: Basic CString Operations</A><BR><BR></LI>

	<LI><A HREF="_core_strings.3a_.cstring_semantics.htm">Strings: CString Semantics</A><BR><BR></LI>

	<LI><A HREF="_core_strings.3a_.cstring_operations_relating_to_c.2d.style_strings.htm">Strings: CString Operations Relating to C-Style Strings</A><BR><BR></LI>

	<LI><A HREF="_core_strings.3a_.cstring_exception_cleanup.htm">Strings: CString Exception Cleanup</A><BR><BR></LI>

	<LI><A HREF="_core_strings.3a_.cstring_argument_passing.htm">Strings: CString Argument Passing</A><BR><BR></LI>

	<LI><A HREF="_core_strings.3a_.unicode_and_multibyte_character_set_.28.mbcs.29_.support.htm">Strings: Unicode and Multibyte Character Set (MBCS) Support</A></LI>
</UL>
</font>
</BODY>
</HTML>
