<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Initialize Regular DLLs</TITLE>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_vc_addpf_home">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_win32_TlsAlloc">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_win32_TlsGetValue">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_win32_Processes_and_Threads">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfcnotes_TN058">
</OBJECT>
</TD></TR></TABLE>


<font face="verdana,arial,helvetica" size="2">
<H1><A NAME="_core_initialize_regular_dlls"></A>Initialize Regular DLLs</H1>

<P><A HREF="JavaScript:hhobj_1.Click()">Home</A>  |&nbsp; <A HREF="_core_dlls.3a_.overview.htm">Overview</A>  |&nbsp; <A HREF="_core_dll_tasks.htm">How Do I</A>  |&nbsp; <A HREF="_core_dlls.3a_.frequently_asked_questions.htm">FAQ</A>  |&nbsp; <A HREF="_core_dll_topics.htm">Details</A>  |&nbsp; <A HREF="_core_dll_sample_programs.htm">Sample</A></P>

<P>Because regular DLLs have a <B>CWinApp</B> object, they should perform their initialization and termination tasks in the same location as an MFC application: in the <B>InitInstance</B> and <B>ExitInstance </B>member functions of the DLL’s <B>CWinApp</B>-derived class. Because MFC provides a <B>DllMain</B> function that is called by <B>_DllMainCRTStartup</B> for <B>PROCESS_ATTACH</B> and <B>PROCESS_DETACH</B>, you should not write your own <B>DllMain</B> function. The MFC-provided <B>DllMain</B> function calls <B>InitInstance</B> when your DLL is loaded and it calls <B>ExitInstance</B> before the DLL is unloaded.</P>

<P>A regular DLL can keep track of multiple threads by calling <A HREF="JavaScript:hhobj_2.Click()">TlsAlloc</A> and <A HREF="JavaScript:hhobj_3.Click()">TlsGetValue</A> in its <B>InitInstance</B> function. These functions allow the DLL to track thread-specific data.</P>

<P>In your regular DLL that dynamically links to MFC, if you are using any MFC OLE, MFC Database (or DAO), or MFC Sockets support, respectively, the MFC debug extension DLLs MFCOxxD.DLL, MFCDxxD.DLL, and MFCNxxD.DLL (where xx is the version number) are linked in automatically. You must call one of the following predefined initialization functions for each of these DLLs that you are using in your regular DLL's <B>CWinApp::InitInstance</B>. </P>

<TABLE border=1 cellpadding=5 cols=2 frame=below rules=rows>

<TR VALIGN="top">
<TD class=label width=50%><B>Type of MFC Support</B></TD>
<TD class=label width=50%><B>Initialization Function to Call</B></TD>
</TR>

<TR VALIGN="top">
<TD width=50%>MFC OLE (MFCOxxD.DLL)</TD>
<TD width=50%><B>AfxOleInitModule</B></TD>
</TR>

<TR VALIGN="top">
<TD width=50%>MFC Database (MFCDxxD.DLL)</TD>
<TD width=50%><B>AfxDbInitModule</B></TD>
</TR>

<TR VALIGN="top">
<TD width=50%>MFC Sockets (MFCNxxD.DLL)</TD>
<TD width=50%><B>AfxNetInitModule</B></TD>
</TR>
</TABLE><BR>

<H3>What do you want to do?</H3>

<UL type=disc>
	<LI><A HREF="_core_initialize_extension_dlls.htm">Initialize extension DLLs</A><BR><BR></LI>

	<LI><A HREF="_core_initialize_non.2d.mfc_dlls.htm">Initialize non-MFC DLLs</A></LI>
</UL>

<H3>What do you want to know more about?</H3>

<UL type=disc>
	<LI><A HREF="_core_run.2d.time_library_behavior.htm">The C run-time library behavior and _DllMainCRTStartup</A><BR><BR></LI>

	<LI><A HREF="_core_using_extension_dll.2c.database.2f.ole.2f.sockets_in_regular_dll.htm">Using extension DLL, Database/OLE/Sockets in regular DLL</A><BR><BR></LI>

	<LI><A HREF="JavaScript:hhobj_4.Click()">Processes and threads (Win32 SDK documentation)</A><BR><BR></LI>

	<LI><A HREF="JavaScript:hhobj_5.Click()">Thread local storage wrappers (MFC Technical Note 58)</A></LI>
</UL>
</font>
</BODY>
</HTML>
