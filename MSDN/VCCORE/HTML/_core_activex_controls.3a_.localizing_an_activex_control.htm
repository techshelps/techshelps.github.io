<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>ActiveX Controls: Localizing an ActiveX Control</TITLE>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_vc_addui_home">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="circle sample start">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_sample_mfc_CONTROLS">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_sample_mfc_CONTROLS">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_AfxOleRegisterTypeLib">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_sample_mfc_CONTROLS">
</OBJECT>
<OBJECT ID="hhobj_7" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_COleControl.3a3a.AmbientLocaleID">
</OBJECT>
<OBJECT ID="hhobj_8" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_AfxSetResourceHandle">
</OBJECT>
<OBJECT ID="hhobj_9" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_COleControl.3a3a.OnSetClientSite">
</OBJECT>
<OBJECT ID="hhobj_10" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_COlePropertyPage.3a3a.OnSetPageSite">
</OBJECT>
</TD></TR></TABLE>


<font face="verdana,arial,helvetica" size="2">
<H1><A NAME="_core_activex_controls.3a_.localizing_an_activex_control"></A>ActiveX Controls: Localizing an ActiveX Control</H1>

<P><A HREF="JavaScript:hhobj_1.Click()">Home</A>  |&nbsp; <A HREF="_core_activex_controls.3a_.overview.htm">Overview</A>  |&nbsp; <A HREF="_core_activex_control_tasks.htm">How Do I</A>  |&nbsp; <A HREF="_core_frequently_asked_questions_about_activex_controls.htm">FAQ</A>  |&nbsp; <A HREF="JavaScript:hhobj_2.Click()">Tutorial</A>  |&nbsp; <A HREF="_core_activex_control_sample_list.htm">Sample</A></P>

<P>This article discusses procedures for localizing ActiveX control interfaces.</P>

<P>If you want to adapt an ActiveX control to an international market, you may want to localize the control. Windows supports several languages in addition to the default English, including German, French, and Swedish. This can present problems for the control if its interface is in English only.</P>

<P>In general, ActiveX controls should always base their locale on the ambient LocaleID property. There are three ways to do this:

<UL type=disc>
	<LI>Load resources, always on demand, based on the current value of the ambient LocaleID property. The MFC ActiveX controls sample LOCALIZE, listed under <A HREF="JavaScript:hhobj_3.Click()">CONTROLS</A>, uses this strategy.<BR><BR></LI>

	<LI>Load resources when the first control is instanced, based on the ambient LocaleID property, and use these resources for all other instances. This article demonstrates this strategy.
<P class=atl><B><B>Note</B></B>&nbsp;&nbsp;&nbsp;This will not work correctly in some cases, if future instances have different locales.</p></LI>

	<LI>Use the <B>OnAmbientChanged</B> notification function to dynamically load the proper resources for the container’s locale.
<P class=atl><B><B>Note</B></B>&nbsp;&nbsp;&nbsp;This will work for the control, but the run-time DLL will not dynamically update its own resources when the ambient LocaleID property changes. In addition, run-time DLLs for ActiveX controls use the thread locale to determine the locale for its resources.</p></LI>
</UL>

<P>The rest of this article describes two localizing strategies. The first strategy <A HREF="#_core_localizing_your_control.92.s_programmability_interface">localizes the control’s programmability interface</A> (names of properties, methods, and events). The second strategy <A HREF="#_core_localizing_the_control.92.s_user_interface">localizes the control’s user interface</A>, using the container’s ambient LocaleID property. For a demonstration of control localization, see the MFC ActiveX controls sample LOCALIZE, listed under <A HREF="JavaScript:hhobj_4.Click()">CONTROLS</A>.</P>



<H2><A NAME="_core_localizing_your_control.92.s_programmability_interface"></A>Localizing the Control’s Programmability Interface</H2>

<P>When localizing the control’s programmability interface (the interface used by programmers writing applications that use your control), you must create a modified version of the control .ODL file (a script for building the control type library) for each language you intend to support. This is the only place you need to localize the control property names.</P>

<P>When you develop a localized control, include the locale ID as an attribute at the type library level. For example, if you want to provide a type library with French localized property names, make a copy of your SAMPLE.ODL file, and call it SAMPLEFR.ODL. Add a locale ID attribute to the file (the locale ID for French is 0x040c), similar to the following:</P>

<PRE><CODE>[ uuid(xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx), version(1.0), lcid(0x040c) ]
library Sample
{
</CODE></PRE>

<P>Change the property names in SAMPLEFR.ODL to their French equivalents, and then use MKTYPLIB.EXE to produce the French type library, SAMPLEFR.TLB.</P>

<P>To create multiple localized type libraries you can add any localized .ODL files to the project and they will be built automatically.</P>

<P class=label><B>To add an .ODL file to your ActiveX control project</B>

<OL>
	<LI>With your control project open, on the <B>Project </B>menu, click <B>Add to Project</B> and then <B>Files</B>.
<P class=tl>The<B> Insert Files Into Project</B> dialog box appears.</P></LI>

	<LI>If necessary, select the drive and directory to view.<BR><BR></LI>

	<LI>In the <B>Files of Type</B> box, select <B>Interface Definition Files (*.odl,*.idl)</B>.<BR><BR></LI>

	<LI>In the file list box, double-click the .ODL file you want to insert into the project.<BR><BR></LI>

	<LI>Close the <B>Insert Files Into Project </B>dialog box when you have added all necessary .ODL files.</LI>
</OL>

<P>Because the files have been added to the project, they will be built when the rest of the project is built. The localized type libraries are located in the current ActiveX control project directory.</P>

<P>Within your code, the internal property names (usually in English) are always used and are never localized. This includes the control dispatch map, the property exchange functions, and your property page data exchange code.</P>

<P>Only one type library (.TLB) file may be bound into the resources of the control implementation (.OCX) file. This is usually the version with the standardized (typically, English) names. To ship a localized version of your control you need to ship the .OCX (which has already been bound to the default .TLB version) and the .TLB for the appropriate locale. This means that only the .OCX is needed for English versions, since the correct .TLB has already been bound to it. For other locales, the localized type library also must be shipped with the .OCX.</P>

<P>To ensure that clients of your control can find the localized type library, register your locale-specific .TLB file(s) under the TypeLib section of the Windows system registry. The third parameter (normally optional) of the <A HREF="JavaScript:hhobj_5.Click()">AfxOleRegisterTypeLib</A> function is provided for this purpose. The following example registers a French type library for an ActiveX control:</P>

<PRE><CODE>STDAPI DllRegisterServer(void)
{
    AFX_MANAGE_STATE(_afxModuleAddrThis);

    if (!AfxOleRegisterTypeLib(AfxGetInstanceHandle(), _tlid))
        return ResultFromScode(SELFREG_E_TYPELIB);
    AfxOleRegisterTypeLib(AfxGetInstanceHandle(), _tlid,
        _T("samplefr.tlb"))
    if (!COleObjectFactoryEx::UpdateRegistryAll(TRUE))
        return ResultFromScode(SELFREG_E_CLASS);

    return NOERROR;
}
</CODE></PRE>

<P>When your control is registered, the <B>AfxOleRegisterTypeLib</B> function automatically looks for the specified .TLB file in the same directory as the control and registers it in the Windows registration database. If the .TLB file isn’t found, the function has no effect.</P>



<H2><A NAME="_core_localizing_the_control.92.s_user_interface"></A>Localizing the Control’s User Interface</H2>

<P>To localize a control’s user interface, place all of the control’s user-visible resources (such as property pages and error messages) into language-specific resource DLLs. You then can use the container’s ambient LocaleID property to select the appropriate DLL for the user’s locale.</P>

<P>The following code example demonstrates one approach to locate and load the resource DLL for a specific locale. This member function, called <CODE>GetLocalizedResourceHandle</CODE> for this example, can be a member function of your ActiveX control class:</P>

<PRE><CODE>HINSTANCE CSampleCtrl::GetLocalizedResourceHandle(LCID lcid)
{
    LPCTSTR lpszResDll;
    HINSTANCE hResHandle = NULL;
    LANGID lang = LANGIDFROMLCID(lcid);
    switch (PRIMARYLANGID(lang))
    {
    case LANG_ENGLISH:
        lpszResDll = “myctlen.dll”;
        break;

    case LANG_FRENCH:
        lpszResDll = “myctlfr.dll”;
        break;

    case LANG_GERMAN:
        lpszResDll = “myctlde.dll”;
        break;

    case 0:
    default:
        lpszResDll = NULL;
    }

    if (lpszResDll != NULL)
        hResHandle = LoadLibrary(lpszResDll);
    #ifndef _WIN32
        if(hResHandle &lt;= HINSTANCE_ERROR)
           hResHandle = NULL;
    #endif

    return hResHandle;
}
</CODE></PRE>

<P>Note that the sublanguage ID could be checked in each case of the switch statement, to provide more specialized localization (for example, local dialects of German). For a demonstration of this function, see the <CODE>GetResourceHandle</CODE> function in the MFC ActiveX controls sample LOCALIZE, listed under <A HREF="JavaScript:hhobj_6.Click()">CONTROLS</A>.</P>

<P>When the control first loads itself into a container, it can call <A HREF="JavaScript:hhobj_7.Click()">COleControl::AmbientLocaleID</A> to retrieve the locale ID. The control can then pass the returned locale ID value to the <CODE>GetLocalizedResourceHandle</CODE> function, which loads the proper resource library. The control should pass the resulting handle, if any, to <A HREF="JavaScript:hhobj_8.Click()">AfxSetResourceHandle</A>:</P>

<PRE><CODE>m_hResDll = GetLocalizedResourceHandle( AmbientLocaleID() );
if (m_hResDll != NULL)
    AfxSetResourceHandle(m_hResDll);
</CODE></PRE>

<P>Place the code sample above into a member function of the control, such as an override of <A HREF="JavaScript:hhobj_9.Click()">COleControl::OnSetClientSite</A>. In addition, <CODE>m_hResDLL</CODE> should be a member variable of the control class.</P>

<P>You can use similar logic for localizing a control’s property page. To localize the property page, add code similar to the following sample to your property page’s implementation file (in an override of <A HREF="JavaScript:hhobj_10.Click()">COlePropertyPage::OnSetPageSite</A>):</P>

<PRE><CODE>LPPROPERTYPAGESITE pSite;
LCID lcid = 0;
if((pSite = GetPageSite()) != NULL)
    pSite-&gt;GetLocaleID(&amp;lcid);
HINSTANCE hResource = GetLocalizedResourceHandle(lcid);
HINSTANCE hResourceSave = NULL;

if (hResource != NULL)
{
    hResourceSave = AfxGetResourceHandle();
    AfxSetResourceHandle(hResource);
}

//  Load dialog template and caption string.
COlePropertyPage::OnSetPageSite( );

if (hResource != NULL)
    AfxSetResourceHandle(hResourceSave);
</CODE></PRE>
</font>
</BODY>
</HTML>
