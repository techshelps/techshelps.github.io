<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Recordset: Fetching Records in Bulk (ODBC)</TITLE>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<TABLE ALIGN=right WIDTH=0 BORDER=0><TR><TD>
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_vc_addpf_home">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="Enroll tutorial">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.Open">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.CheckRowsetError">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.DoBulkFieldExchange">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.GetRowsetSize">
</OBJECT>
<OBJECT ID="hhobj_7" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.GetRowsFetched">
</OBJECT>
<OBJECT ID="hhobj_8" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.GetRowStatus">
</OBJECT>
<OBJECT ID="hhobj_9" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.RefreshRowset">
</OBJECT>
<OBJECT ID="hhobj_10" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.SetRowsetCursorPosition">
</OBJECT>
<OBJECT ID="hhobj_11" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.SetRowsetSize">
</OBJECT>
<OBJECT ID="hhobj_12" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_sample_mfc_DBFETCH">
</OBJECT>
<OBJECT ID="hhobj_13" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.Move">
</OBJECT>
<OBJECT ID="hhobj_14" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_Record_Field_Exchange_Functions">
</OBJECT>
<OBJECT ID="hhobj_15" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_sample_mfc_DBFETCH">
</OBJECT>
<OBJECT ID="hhobj_16" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CFieldExchange.3a3a.SetFieldType">
</OBJECT>
<OBJECT ID="hhobj_17" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.m_nFields">
</OBJECT>
<OBJECT ID="hhobj_18" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink">
	<PARAM NAME="DefaultTopic" VALUE="_topic_not_found.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="_mfc_CRecordset.3a3a.m_nParams">
</OBJECT>
</TD></TR></TABLE>


<font face="verdana,arial,helvetica" size="2">
<H1><A NAME="_core_recordset.3a_.fetching_records_in_bulk_.28.odbc.29"></A>Recordset: Fetching Records in Bulk (ODBC)</H1>

<P><A HREF="JavaScript:hhobj_1.Click()">Home</A>  |&nbsp; <A HREF="_core_databases.3a_.overview.htm">Overview</A>  |&nbsp; <A HREF="_core_odbc_database_tasks.htm">How Do I</A>  |&nbsp; <A HREF="_core_databases.3a_.frequently_asked_questions.htm">FAQ</A>  |&nbsp; <A HREF="_core_odbc_database_sample_list.htm">Sample</A>  |&nbsp; <A HREF="JavaScript:hhobj_2.Click()">Tutorial</A>  |&nbsp; <A HREF="_core_odbc_driver_list.htm">ODBC Driver List</A></P>

<P>This article applies to the MFC ODBC classes. For information about DAO recordsets, see the article <A HREF="_core_dao_recordset.htm">DAO Recordset</A>.</P>

<P>Class <B>CRecordset</B> provides support for bulk row fetching, which means that multiple records can be retrieved at once during a single fetch, rather than retrieving one record at a time from the data source. You can implement bulk row fetching only in a derived <B>CRecordset</B> class. The process of transferring data from the data source to the recordset object is called bulk record field exchange (Bulk RFX). Note that if you are not using bulk row fetching in a <B>CRecordset</B>-derived class, then data is transferred via record field exchange (RFX). For more information, see the article <A HREF="_core_record_field_exchange_.28.rfx.29.htm">Record Field Exchange (RFX)</A>.</P>

<P>This article explains:

<UL type=disc>
	<LI><A HREF="#_core_how_crecordset_supports_bulk_row_fetching">How CRecordset supports bulk row fetching</A>.<BR><BR></LI>

	<LI><A HREF="#_core_special_considerations">Some special considerations when using bulk row fetching</A>.<BR><BR></LI>

	<LI><A HREF="#_core_how_to_implement_bulk_record_field_exchange">How to implement bulk record field exchange</A>.</LI>
</UL>

<H2><A NAME="_core_how_crecordset_supports_bulk_row_fetching"></A>How CRecordset Supports Bulk Row Fetching</H2>

<P>Before opening your recordset object, you can define a rowset size with the <B>SetRowsetSize</B> member function. The rowset size specifies how many records should be retrieved during a single fetch. When bulk row fetching is implemented, the default rowset size is 25. Note that if bulk row fetching is not implemented, the rowset size remains fixed at 1.</P>

<P>After you have initialized the rowset size, call the <A HREF="JavaScript:hhobj_3.Click()">Open</A> member function. Here you must specify the <B>CRecordset::useMultiRowFetch</B> option of the <B>dwOptions</B> parameter in order to implement bulk row fetching. You can additionally set the <B>CRecordset::userAllocMultiRowBuffers</B> option. The bulk record field exchange mechanism uses arrays to store the multiple rows of data retrieved during a fetch. These storage buffers can be allocated automatically by the framework, or you can allocate them manually. Specifying the <B>CRecordset::userAllocMultiRowBuffers</B> option means that you will do the allocation.</P>

<P>The following table lists the member functions provided by <B>CRecordset</B> to support bulk row fetching.</P>

<TABLE border=1 cellpadding=5 cols=2 frame=below rules=rows>

<TR VALIGN="top">
<TD class=label width=38%><B>Member Function</B></TD>
<TD class=label width=62%><B>Description</B></TD>
</TR>

<TR VALIGN="top">
<TD width=38%><A HREF="JavaScript:hhobj_4.Click()">CheckRowsetError</A></TD>
<TD width=62%>Virtual function that handles any errors that occur during fetching.</TD>
</TR>

<TR VALIGN="top">
<TD width=38%><A HREF="JavaScript:hhobj_5.Click()">DoBulkFieldExchange</A></TD>
<TD width=62%>Implements bulk record field exchange. Called automatically to transfers multiple rows of data from the data source to the recordset object.</TD>
</TR>

<TR VALIGN="top">
<TD width=38%><A HREF="JavaScript:hhobj_6.Click()">GetRowsetSize</A></TD>
<TD width=62%>Retrieves the current setting for the rowset size.</TD>
</TR>

<TR VALIGN="top">
<TD width=38%><A HREF="JavaScript:hhobj_7.Click()">GetRowsFetched</A></TD>
<TD width=62%>Tells how many rows were actually retrieved after a given fetch. In most cases, this will be the rowset size, unless an incomplete rowset was fetched.</TD>
</TR>

<TR VALIGN="top">
<TD width=38%><A HREF="JavaScript:hhobj_8.Click()">GetRowStatus</A></TD>
<TD width=62%>Returns a fetch status for a particular row within a rowset.</TD>
</TR>

<TR VALIGN="top">
<TD width=38%><A HREF="JavaScript:hhobj_9.Click()">RefreshRowset</A></TD>
<TD width=62%>Refreshes the data and status of a particular row within a rowset.</TD>
</TR>

<TR VALIGN="top">
<TD width=38%><A HREF="JavaScript:hhobj_10.Click()">SetRowsetCursorPosition</A></TD>
<TD width=62%>Moves the cursor to a particular row within a rowset.</TD>
</TR>

<TR VALIGN="top">
<TD width=38%><A HREF="JavaScript:hhobj_11.Click()">SetRowsetSize</A></TD>
<TD width=62%>Virtual function that changes the setting for the rowset size to the specified value.</TD>
</TR>
</TABLE><BR>

<H2><A NAME="_core_special_considerations"></A>Special Considerations</H2>

<P>Although bulk row fetching is a performance gain, certain features operate differently. Before you decide to implement bulk row fetching, consider the following:

<UL type=disc>
	<LI>The framework will automatically call the <B>DoBulkFieldExchange</B> member function to transfer data from the data source to the recordset object. However, data is not transferred from the recordset back to the data source. Calling the <B>AddNew</B>, <B>Edit</B>, <B>Delete</B>, or <B>Update</B> member functions will result in a failed assertion. Although <B>CRecordset</B> currently does not provide a mechanism for updating bulk rows of data, you can write your own functions by using the ODBC API function <B>SQLSetPos</B>. For an example of how to do this, see the sample <A HREF="JavaScript:hhobj_12.Click()">DBFETCH</A>. For more information about <B>SQLSetPos</B>, see the ODBC SDK <I>Programmer’s Reference</I> on the MSDN Library CD.<BR><BR></LI>

	<LI>The member functions <B>IsDeleted</B>, <B>IsFieldDirty</B>, <B>IsFieldNull</B>, <B>IsFieldNullable</B>, <B>SetFieldDirty</B>, and <B>SetFieldNull</B> cannot be used on recordsets that implement bulk row fetching. However, you can call <B>GetRowStatus</B> in place of <B>IsDeleted</B>, and <B>GetODBCFieldInfo</B> in place of <B>IsFieldNullable</B>.<BR><BR></LI>

	<LI>The <B>Move</B> operations will reposition your recordset by rowset. For example, suppose you open a recordset that has 100 records with an initial rowset size of 10. <B>Open</B> will fetch rows 1 through 10, with the current record positioned on row 1. A call to <B>MoveNext</B> will fetch the next rowset, not the next row. This rowset will consist of rows 11 through 20, with the current record positioned on row 11. Note that <B>MoveNext</B> and <B>Move( 1 )</B> are not equivalent when bulk row fetching is implemented. <B>Move( 1 )</B> will fetch the rowset that begins 1 row from the current record. In this example, calling <B>Move( 1 )</B> after calling <B>Open</B> will fetch the rowset consisting of rows 2 through 11, with the current record positioned on row 2. For more information, see the <A HREF="JavaScript:hhobj_13.Click()">Move</A> member function.<BR><BR></LI>

	<LI>Unlike record field exchange, ClassWizard does not support bulk record field exchange. This means that you must manually declare your field data members as well as manually override <B>DoBulkFieldExchange</B> by writing calls to the Bulk RFX functions. For more information, see the topic <A HREF="JavaScript:hhobj_14.Click()">Record Field Exchange Functions</A> in the <I>Class Library Reference</I>.</LI>
</UL>

<H2><A NAME="_core_how_to_implement_bulk_record_field_exchange"></A>How to Implement Bulk Record Field Exchange</H2>

<P>Bulk record field exchange transfers a rowset of data from the data source to the recordset object. The Bulk RFX functions use arrays to store this data, as well as arrays to store the length of each data item in the rowset. In your class definition you must define your field data members as pointers in order to access the arrays of data. In addition, you must define a set of pointers to access the arrays of lengths. Any parameter data members should not be declared as pointers; declaring parameter data members when using bulk record field exchange is the same as declaring them when using record field exchange. The following code shows a simple example:</P>

<PRE><CODE>class MultiRowSet : public CRecordset
{
public:
   // Field/Param Data
      // field data members
      long* m_rgID;
      LPSTR m_rgName;

      // pointers for the lengths
      // of the field data
      long* m_rgIDLengths;
      long* m_rgNameLengths;

      // input parameter data member
      CString m_strNameParam;

   .
   .
   .
}
</CODE></PRE>

<P>You can either allocate these storage buffers manually, or you can have the framework do the allocation. To allocate the buffers yourself, you must specify the <B>CRecordset::userAllocMultiRowBuffers</B> option of the <B>dwOptions</B> parameter in the <B>Open</B> member function. Be sure to set the sizes of the arrays at least equal to the rowset size. If you wish to have the framework do the allocation, you should initialize your pointers to <B>NULL.</B> This is typically done in the recordset object's constructor:</P>

<PRE><CODE>MultiRowSet::MultiRowSet( CDatabase* pDB )
   : CRecordset( pDB )
{
   m_rgID = NULL;
   m_rgName = NULL;
   m_rgIDLengths = NULL;
   m_rgNameLengths = NULL;
   m_strNameParam = "";

   m_nFields = 2;
   m_nParams = 1;

   .
   .
   .
}
</CODE></PRE>

<P>Finally, you must override the <B>DoBulkFieldExchange</B> member function. For the field data members, call the Bulk RFX functions; for any parameter data members, call the RFX functions. If you opened the recordset by passing an SQL statement or stored procedure to <B>Open</B>, then the order in which you make the Bulk RFX calls must correspond to the order of the columns in the recordset; similarly, the order of the RFX calls for parameters must correspond to the order of parameters in the SQL statement or stored procedure.</P>

<PRE><CODE>void MultiRowSet::DoBulkFieldExchange( CFieldExchange* pFX )
{
   // call the Bulk RFX functions
   // for field data members
   pFX-&gt;SetFieldType( CFieldExchange::outputColumn );
   RFX_Long_Bulk( pFX, _T( "[colRecID]" ),
                  &amp;m_rgID, &amp;m_rgIDLengths );
   RFX_Text_Bulk( pFX, _T( "[colName]" ),
                  &amp;m_rgName, &amp;m_rgNameLengths, 30 );


   // call the RFX functions for
   // for parameter data members
   pFX-&gt;SetFieldType( CFieldExchange::inputParam );
   RFX_Text( pFX, "NameParam", m_strNameParam );
}
</CODE></PRE>

<P class=indent><B><B>Important&nbsp;&nbsp;&nbsp;</B></B>You must call the <B>Close</B> member function before your derived <B>CRecordset</B> class goes out of scope. This ensures that any memory allocated by the framework will be freed. Note that it is good programming practice to always explicitly call <B>Close</B>, regardless of whether you have implemented bulk row fetching.</P>

<P>For an additional example of implementing bulk record field exchange, see the MFC sample <A HREF="JavaScript:hhobj_15.Click()">DBFETCH</A>. For more information about record field exchange (RFX), see the article <A HREF="_core_record_field_exchange.3a_.how_rfx_works.htm">Record Field Exchange: How RFX Works</A>. For more information about using parameters, see <A HREF="JavaScript:hhobj_16.Click()">CFieldExchange::SetFieldType</A> and the article <A HREF="_core_recordset.3a_.parameterizing_a_recordset_.28.odbc.29.htm">Recordset: Parameterizing a Recordset (ODBC)</A>.</P>

<P><B>See Also</B>&nbsp;&nbsp;&nbsp;<A HREF="JavaScript:hhobj_17.Click()">CRecordset::m_nFields</A>, <A HREF="JavaScript:hhobj_18.Click()">CRecordset::m_nParams</A></P>
</font>
</BODY>
</HTML>
