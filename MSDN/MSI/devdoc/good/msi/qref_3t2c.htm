<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>MsiFormatRecord</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_msi_msiformatrecord"></a>MsiFormatRecord</h1>
<p>
<span style=color:#FF0000>[This is preliminary documentation and subject to change.]</span> </p>
<p>
The <b>MsiFormatRecord</b> function formats record field data and properties using a format string.</p>
<pre><code><b>UINT MsiFormatRecord(
</b>  <b>MSIHANDLE</b> <i>hInstall</i><b>,</b>    // installer handle
<b>  MSIHANDLE</b> <i>hRecord</i><b>,</b><i>     </i>// record to execute
<b>  LPTSTR </b><i>szResultBuf</i><b>,</b>    // buffer to return formatted string
<b>  DWORD </b><i>*pcchResultBuf   </i>// in/out buffer character count
<b>);</b>
<b> </b></code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>hInstall</i></dt>
<dd>
Handle to the installation. This may be omitted, in which case only the record field parameters are processed and properties are not available for substitution.</dd>
<dt>
<i>hRecord</i></dt>
<dd>
Handle to the record to format. The template string must be stored in record field 0 followed by referenced data parameters.</dd>
<dt>
<i>szResultBuf</i></dt>
<dd>
Specifies the buffer to return the formatted string to.</dd>
<dt>
<i>pcchResultBuf</i></dt>
<dd>
Specifies the in/out character count.
</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
ERROR_INVALID_HANDLE</dt>
<dd>
An invalid or inactive handle was supplied.</dd>
<dt>
ERROR_INVALID_PARAMETER</dt>
<dd>
An invalid parameter was passed to the function.</dd>
<dt>
ERROR_MORE_DATA</dt>
<dd>
A buffer was too small to hold the entire value.</dd>
<dt>
ERROR_SUCCESS</dt>
<dd>
The function succeeded.
</dd>
</dl>
<h4>Remarks</h4>
<p>
The <b>MsiFormatRecord</b> function uses the following format process.</p>
<p>
Parameters that are to be formatted are enclosed in square brackets [...]. The square brackets can be iterated because the substitutions are resolved from the inside out.</p>
<p>
If a part of the string is enclosed in curly braces { } and contains no square brackets, it is left unchanged, including the curly braces.</p>
<p>
If a part of the string is enclosed in curly braces { } and contains one or more property names, and if all the properties are found, the text (with the resolved substitutions) is displayed without the curly braces. If any of the properties is not found, all the text in the braces and the braces themselves are removed.</p>
<p>
The following steps describe how to format strings using the MsiFormatRecord function:</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To format strings using the MsiFormatRecord function</h5>
<ol>
<li>
The numeric parameters are substituted by replacing the marker with the value of the corresponding record field, with missing or null values producing no text.</li>
<li>
The resultant string is processed by replacing the non-record parameters with the corresponding values, described next.<ul>
<li>
If a substring of the form [propertyname] is encountered, it is replaced by the value of the property.</li>
<li>
If a substring of the form [%environmentvariable] is found, the value of the environment variable is substituted. </li>
<li>
If a substring of the form [#filekey] is found, it is replaced by the full path of the file, with the value <i>filekey</i> used as a key into the <a href="tref_4n6t.htm">File table</a>. </li>
<li>
If a substring of the form [$componentkey] is found, it is replaced by the installation directory of the component, with the value <i>componentkey</i> used as a key into the <a href="tref_09np.htm">Component table</a>, taking into account the Component.Action column state. If the component is selected to be installed locally, it is replaced by the target directory. If the component is selected to run from source, it is replaced by the source directory. If the component is not selected or if the component is missing, it is replaced by a null string.</li>
<li>
If a substring of the form [\c] is found, it is replaced by the character without any further processing. Only the first character after the backslash is kept; everything else is removed. </li>
</ul>
</li>
</ol>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 4.0 or later. Available as a redistributable for Windows NT 4.0.<br>
<b>&nbsp;&nbsp;Windows: </b>Requires Windows 95 or later. Available as a redistributable for Windows 95.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in msiquery.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use msi.lib.<br>
<b>&nbsp;&nbsp;Unicode: </b>Implemented as Unicode and ANSI versions on Windows NT.</p>
<p>&nbsp;</p></body>
</HTML>
