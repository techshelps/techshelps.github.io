<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Creating Add-ins Using Visual Basic</title>
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<h1><a name="_asug_creating_add_ins_using_visual_basic"></a>Creating Add-ins Using Visual Basic</h1>
<p>
<a href="_asug_home_page.3a_.developer_studio_add_ins.htm">Home Page (Add-ins)</a>  |&nbsp; <a href="_asug_overview.3a_.developer_studio_add.2d.ins.htm">Overview</a>  |&nbsp; <a href="_asug_how_do_i_......_topics.3a_.developer_studio_add.2d.ins.htm">How Do I ... Topics</a>  |&nbsp; <a href="_asug_frequently_asked_questions.3a_.developer_studio_add_ins.htm">FAQ</a>  |&nbsp; <a href="_asug_reference.3a_.developer_studio_add.2d.ins.htm">Reference</a></p>
<p>
In addition to creating add-ins with Visual C++, you can create them with Visual Basic version 4.0 or later. The easiest way to create an add-in with Visual Basic is to start with the sample provided. The sample for Visual Basic version 4.0 is called VB4AddIn, and the sample for Visual Basic versions 5.0 or later is called VB5AddIn.</p>
<p>
Add-ins created with Visual Basic version 5.0 (or later) have the following advantages over Visual Basic version 4.0:
<ul type=disc>
<li>
Your add-in can handle events fired by the <a href="_asug_application_object.htm">Application</a> object. (In the sample code, the <i>m_app</i> member variable points to this object.)<br><br></li>
<li>
The <a href="_asug_how_add.2d.ins_connect_and_disconnect.htm#_asug_the_dsaddin_object">DSAddIn</a> object implements the COM interface <b>IDSAddIn</b> rather than a dispatch interface. This results in faster calls from Developer Studio to your add-in's <b>DSAddIn</b> object.</li>
</ul>
<p>
Creating an add-in with Visual Basic can be divided into the following steps:
<ol>
<li>
<a href="#_asug_copying_the_sample_add_in_files">Copy the sample files</a><br><br></li>
<li>
<a href="#_asug_naming_and_describing_the_add_in">Name and describe the add-in</a><br><br></li>
<li>
<a href="#_asug_referencing_the_type_libraries">Reference the Visual C++ Type libraries</a><br><br></li>
<li>
<a href="#_asug_modifying_the_code">Modify the add-in code</a>:<ul type=disc>
<li>
For connecting and disconnecting<br><br></li>
<li>
For the command the add-in will run<br><br></li>
<li>
To add the command to the Visual C++ environment<br><br></li>
<li>
To create event handlers (optional)</li>
</ul>
</li>
<li>
<a href="#_asug_creating_the_add_in_dll">Build the add-in .DLL</a></li>
</ol>
<p>
Optionally, after creating an add-in project, you can <a href="#_asug_employing_early_binding">employ early binding</a> to optimize the add-in's performance.</p>
<h3><a name="_asug_copying_the_sample_add_in_files"></a>Copying the Sample Add-in Files</h3>
<p class=label>
<b>To copy the sample add-in files</b>
<ul type=disc>
<li>
In the Visual C++ online documentation, open the topic <object id=alink_1 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="DefaultTopic" value="_topic_not_found.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="vcsmpDeveloperStudioAddinSamples">
</object><a href=JavaScript:alink_1.Click()>Visual C++ Developer Studio Add-in Samples</a>, and click the link of any sample to copy its project files to a new directory. You can specify the directory.</li>
</ul>
<h3><a name="_asug_naming_and_describing_the_add_in"></a>Naming and Describing the Add-in</h3>
<p class=label>
<b>To name and describe the add-in</b>
<ol>
<li>
In Visual Basic, open the sample add-in project.<p class=tl>
Note that this project in Visual Basic is a .DLL project type. When you build it, you will build a .DLL.</P></li>
<li>
On the <b>Project Properties</b> dialog box, <b>General</b> tab, give the project a unique name.<br><br></li>
<li>
On the <b>Project Properties</b> dialog box, <b>Make</b> tab, give the application a unique title.<br><br></li>
<li>
In the Visual Basic <b>Object Browser</b>, from the <b>Project/Library</b> drop-down, select the add-in project (for example, VB5AddIn). <br><br></li>
<li>
Select the <b>DSAddIn</b> class, click the right mouse button, and select <b>Properties</b> from the popup menu.<br><br></li>
<li>
On the <b>Member Options</b> properties page, enter a name in the <b>Description</b> box and click <b>OK</b>. <p class=tl>
Once the add-in project is built, this name appears in Visual C++ on the <b>Add-ins and Macros Files</b> tab of the <b>Customize</b> dialog box (<b>Tools</b> menu, <b>Customize Command</b>).</P></li>
<li>
With the <b>DSAddIn</b> class still selected, click the <b>Description</b> property in the <b>Members</b> list box.<br><br></li>
<li>
Click the right mouse button and select <b>Properties</b> from the popup menu.<br><br></li>
<li>
On the <b>Procedure Attributes</b> properties page, enter a description in the <b>Description</b> edit control. <p class=tl>
Once the add-in project is built, this description also appears on the <b>Add-ins and Macros Files</b> tab of the <b>Customize</b> dialog box.</P></li>
</ol>
<h3><a name="_asug_referencing_the_type_libraries"></a>Referencing the Visual C++ Type Libraries</h3>
<p class=label>
<b>To reference the Visual C++ type libraries</b>
<ol>
<li>
In the Visual Basic <b>References</b> dialog box (<b>Project</b> menu, <b>References </b>command), select the check boxes next to the Visual C++ type libraries. <p class=tl>
For Visual C++ version 5.0, their names begin with "Visual Studio 97." For Visual C++ version 6.0, their names begin with "Visual C++ 6.0." </P></li>
<li>
Click <b>OK</b>. </li>
</ol>
<h3><a name="_asug_modifying_the_code"></a>Modifying the Add-in Code</h3>
<p>
To customize your add-in, you can modify the code in several ways:
<ul type=disc>
<li>
<a href="#_asug_modify_the_connection_and_disconnection_code">Modify the connection and disconnection code</a><br><br></li>
<li>
<a href="#_asug_specifying_the_actions">Specify the actions the add-in command will perform</a><br><br></li>
<li>
<a href="#_asug_adding_the_command_to_the_environment">Add the command to the Visual C++ Developer Studio environment</a><br><br></li>
<li>
<a href="#_asug_adding_event_handlers">Add event handlers</a> (Visual Basic 5.0 or later)</li>
</ul>
<p>
Some of these steps are optional, or contain optional parts.</p>
<h4><a name="_asug_modify_the_connection_and_disconnection_code"></a>Modifying connection and disconnection code</h4>
<p>
Your add-in will connect to and disconnect from Developer Studio by using the <a href="_asug_the_onconnection_method.htm">OnConnection</a> and <a href="_asug_the_ondisconnection_method.htm">OnDisconnection</a> methods implemented in the <b>DSAddIn</b> class.
<ul type=disc>
<li>
To view this code in Visual Basic 4.0, look for the connection and disconnection code in the <b>General</b> methods of the <b>DSAddIn</b> class. <br><br></li>
<li>
To view this code in Visual Basic 5.0 or 6.0, look for the connection and disconnection code in the <b>IDSAddIn</b> member of the <b>DSAddIn</b> class. </li>
</ul>
<p>
In the samples, the connection code adds one command to the Visual C++ environment. You add more commands by calling the <a href="_asug_addcommand_method.htm">AddCommand</a> method for each command you want to add (see <u>Adding commands to the Visual C++ environment</u> for details). </p>
<p>
In the samples, the disconnection code does nothing; however, you might want to modify it to add clean-up code that destroys the objects you create. </p>
<h4><a name="_asug_specifying_the_actions"></a>Specifying the actions the add-in command will perform</h4>
<p>
The <b>Commands</b> class defines the actions performed by the commands you add to the Visual C++ environment. The samples define one action, which is to display a message box.
<ul type=disc>
<li>
To view or modify this code, open the code editor for the <b>Commands</b> class, and choose the <b>General</b> section.</li>
</ul>
<h4><a name="_asug_adding_the_command_to_the_environment"></a>Adding the command to the Visual C++ environment</h4>
<p>
This consists of two steps for every command you add: Adding a public procedure to the <b>Commands</b> class, and adding a call to the <b>AddCommand</b> method. Optionally, you can create a toolbar button for the command.</p>
<p class=label>
<b>To add a public procedure to the Commands class</b>
<ol>
<li>
Open the code editor for the <b>Commands</b> class, and choose the <b>General</b> section.<br><br></li>
<li>
From the <b>Tools</b> menu, choose <b>Add Procedure</b>.<br><br></li>
<li>
Enter a name for the procedure, select the <b>Sub</b> and <b>Public</b> radio buttons, and click <b>OK</b>.<br><br></li>
<li>
Type the procedure in the code window.</li>
</ol>
<p class=label>
<b>To add a call to the AddCommand method</b>
<ul type=disc>
<li>
In the <b>OnConnection</b> code, add a call to the <b>AddCommand</b> method. (For more information, see <a href="#_asug_modify_the_connection_and_disconnection_code">Modifying connection and disconnection code</a>.)</li>
</ul>
<p class=label>
<b>To create a toolbar button for the command</b>
<ol>
<li>
Add an image for the button to the files Tbarmedm.bmp and Tbarlrge.bmp (located in the directory where you copied the add-in sample files).<br><br></li>
<li>
Reference the bitmap locations in the <b>AddCommand</b> call.<br><br></li>
<li>
If you want the button to automatically appear on your add-in's toolbar when you first connect the add-in to the Visual C++ environment, in the <b>OnConnection</b> code call the <a href="_asug_addcommandbarbutton_method.htm">AddCommandBarButton</a> method when the <i>bFirstTime</i> parameter is <b>True</b>.</li>
</ol>
<p class=label>
<b><a name="_asug_adding_event_handlers"></a>Add event handlers (Visual Basic 5.0 or later)</b>
<ol>
<li>
Open the code editor for the <b>Commands</b> class, and choose <b>General</b> from the <b>Object</b> drop-down list<br><br></li>
<li>
For each event replace the <b>MsgBox</b> command with your event-handling code.</li>
</ol>
<h3><a name="_asug_creating_the_add_in_dll"></a>Creating the Add-in DLL</h3>
<p class=label>
<b>To create the add-in DLL</b>
<ol>
<li>
On the <b>File</b> menu, click <b>Make &lt;AddIn_Name&gt;.dll …</b>.<br><br></li>
<li>
Copy the resulting DLL into the \MSDEV98\AddIns directory.</li>
</ol>
<p>
Now when you return to Visual C++, the add-in appears on the <b>Add-ins and Macros Files</b> tab of the <b>Customize</b> dialog box (<b>Tools</b> menu, <b>Customize Command</b>). You can select it to view its name and description. You can run the add-in by using the toolbar button or key sequence you assign to it. For more information, see<a href="_asug_carrying_out_add_in_commands.htm"> Carrying Out Add-in Commands</a>.</p>
<h2><a name="_asug_employing_early_binding"></a>Employing Early Binding</h2>
<p>
An add-in can employ early binding by using the COM interface. Early binding makes all calls into the interface faster at run time. In Visual Basic, you use early binding by declaring object variables as the appropriate types. For example, the following code accesses text-specific members of an object by declaring the <code>MyTextDoc</code> variable as <a href="_asug_textdocument_object.htm">TextDocument</a>.</p>
<pre><code>Dim MyDoc as Document
set MyDoc = Application.ActiveDocument
if (MyDoc.Type = "Text") then
   Dim MyTextDoc as TextDocument
   ' VB does an implicit QueryInterface
   ' for the following set
   set MyTextDoc = MyDoc
   ' Now, you can use text-specific members of
   ' MyTextDoc
End If</code></pre>
</FONT></BODY>
</HTML>
