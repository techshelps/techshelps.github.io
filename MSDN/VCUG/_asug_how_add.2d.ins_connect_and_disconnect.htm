<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>How Add-ins Connect and Disconnect</title>
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<h1><a name="_asug_how_add.2d.ins_connect_and_disconnect"></a>How Add-ins Connect and Disconnect</h1>
<p>
<a href="_asug_home_page.3a_.developer_studio_add_ins.htm">Home Page (Add-ins)</a>  |&nbsp; <a href="_asug_overview.3a_.developer_studio_add.2d.ins.htm">Overview</a>  |&nbsp; <a href="_asug_how_do_i_......_topics.3a_.developer_studio_add.2d.ins.htm">How Do I ... Topics</a>  |&nbsp; <a href="_asug_frequently_asked_questions.3a_.developer_studio_add_ins.htm">FAQ</a>  |&nbsp; <a href="_asug_reference.3a_.developer_studio_add.2d.ins.htm">Reference</a></p>
<p>
When Visual C++ starts, it automatically loads all add-ins checked on the <b>Add-ins and Macro Files</b> tab of the <b>Customize</b> dialog box (<b>Tools</b> menu, <b>Customize</b> command). Visual C++ loads each add-in by calling the <a href="_asug_the_onconnection_method.htm">OnConnection</a> method exposed by the add-in's <a href="#_asug_the_dsaddin_object">DSAddIn</a> object. This method also makes the commands exposed by the add-in available for the user to carry out, and it connects the add-in to Developer Studio events if the add-in contains event handlers.</p>
<p>
When Visual C++ quits, it unloads each add-in by calling the <a href="_asug_the_ondisconnection_method.htm">OnDisconnection</a> method exposed by the add-in's <a href="#_asug_the_dsaddin_object">DSAddIn</a> object.</p>
<h2><a name="_asug_the_dsaddin_object"></a>The DSAddIn Object</h2>
<p>
Each add-in exposes a <a href="#_asug_the_dsaddin_object">DSAddIn</a> object and a <a href="#_asug_the_commands_object">Commands</a> object. The Visual C++ Developer Studio environment uses the <b>DSAddIn</b> object to connect to or disconnect from an add-in, and it uses the <b>Commands</b> object to carry out a command added by the <a href="_asug_addcommand_method.htm">AddCommand</a> method.</p>
<p>
<img src="du1402cx.gif" border=0></p>
<p>
An add-in exposes the <b>DSAddIn</b> object by implementing the COM <b>IDSAddIn</b> interface or the <b>IDispatch</b> <b>IDispDSAddIn</b> interface. An add-in written in Visual Basic version 4.0 must implement the <b>IDispatch</b> interface.</p>
<p>
The COM interface is early bound by Developer Studio, whereas the <b>IDispatch</b> interface is late bound. The advantage of using the COM interface is that its early binding makes all calls into the interface faster at run time.</p>
<p class=indent>
<B><b>Note</b></B>&nbsp;&nbsp;&nbsp;<b>IDSAddIn</b> is not a dual interface because it does not derive from <b>IDispatch</b>. It derives from <b>IUnknown</b>.</p>
<p>
If an add-in provides a COM interface to its <b>DSAddIn</b> object, Developer Studio chooses it; otherwise, Developer Studio chooses an <b>IDispatch</b> interface. If neither interface is available, Developer Studio does not connect to the add-in.</p>
<p>
To implement the COM interface, add-ins must use the following predefined Interface ID (IID), which is declared in Microsoft Visual Studio\VC98\Include\ObjModel\AddGuid.h:</p>
<pre><code>// {C0002F81-AE2E-11cf-AD07-00A0C9034965}
DEFINE_GUID(IID_IDSAddIn,
0xc0002f81, 0xae2e, 0x11cf, 0xad, 0x7, 0x0, 0xa0, 0xc9, 0x3, 0x49, 0x65);
</code></pre>
<p>
If you use the Developer Studio Add-in Wizard, it automatically generates the code to implement the COM interface. Similarly, if you use Visual Basic version 5.0 or later, the sample add-in includes this code.</p>
<h2><a name="_asug_the_commands_object"></a>The Commands Object</h2>
<p>
Each add-in exposes a <a href="#_asug_the_dsaddin_object">DSAddIn</a> object and a <a href="#_asug_the_commands_object">Commands</a> object. Developer Studio uses the <b>DSAddIn</b> object to connect to or disconnect from an add-in, and it uses the <b>Commands</b> object to carry out a command added by the <a href="_asug_addcommand_method.htm">AddCommand</a> method.</p>
<p>
The <b>Commands</b> object exposes a method for each command added by <b>AddCommand</b>. This method specifies what the command does. You must write the code for the method.</p>
<p>
If you use Visual C++, you can implement the <b>Commands</b> object by using the Developer Studio Add-in Wizard. This wizard automatically generates code for one method; however, if you need more methods you must add the code for them. For details, see <a href="_asug_adding_commands_to_developer_studio.htm">Adding Commands to the Visual C++ Developer Studio</a>.</p>
<p>
If you use Visual Basic version 4.0 or later, you can implement the <b>Commands</b> object by copying code from the samples provided. However, each sample includes code for only one method, which displays a simple message box. If you need more methods, you must add the code for them.</p>
</FONT></BODY>
</HTML>
