<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Batch-Mode Rules</title>
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<h1><a name="_asug_batch.2d.mode_rules"></a>Batch-Mode Rules</h1>
<p>
<a href="_asug_home_page.3a_.working_with_projects.htm">Home Page (Projects)</a>  |&nbsp; <a href="_asug_overview.3a_.nmake_reference.htm">Overview (NMAKE Reference)</a>  |&nbsp; <a href="_asug_how_do_i......_topics.3a_.working_with_projects.htm">How Do I... Topics (Projects)</a></p>
<p>
Batch-mode inference rules provide only one invocation of the inference rule when N commands go through this inference rule. Without batch-mode inference rules, it would require N commands to be invoked. N is the number of dependents that trigger the inference rule.</p>
<p>
Makefiles that contain batch-mode inference rules must use NMAKE version 1.62 or higher. To check the NMAKE version, run the _NMAKE_VER macro available with NMAKE version 1.62 or higher. This macro returns an integer representing the NMAKE version. For example, the macro returns 162 for NMAKE version 1.62.</p>
<p>
A batch-mode inference rule has the following syntax:</p>
<p>
{<i>frompath</i>}.<i>fromext</i>{<i>topath</i>}.<i>toext</i>::<br>
<i>commands</i></p>
<p>
The only syntactical difference from the standard inference rule is that the batch-mode inference rule is terminated with a double colon (::).</p>
<p class=indent>
<B><b>Note</b></B>&nbsp;&nbsp;&nbsp;The tool being invoked must be able to handle multiple files. The batch-mode inference rule must use <code>$&lt;</code> as the macro to access dependent files.</p>
<p>
The batch-mode inference rules can speed up the build process. It is faster to supply files to the compiler in batch, because the compiler driver is invoked only once. For example, the C and C++ compiler performs better when handling a set of files because it can remain memory resident during the process.</p>
<p>
The following example shows how to use batch-mode inference rules:</p>
<pre><code>#
# sample makefile to illustrate batch-mode inference rules
#
O = .
S = .
Objs = $O/foo1.obj $O/foo2.obj $O/foo2.obj $O/foo3.obj $O/foo4.obj
CFLAGS = -nologo

all : $(Objs)

!ifdef NOBatch
{$S}.cpp{$O}.obj:
!else
{$S}.cpp{$O}.obj::
!endif
   $(CC) $(CFLAGS) -Fd$O\ -c $&lt;

$(Objs) :

#end of makefile
</code></pre>
<p>
NMAKE produces the following output without batch-mode inference rules:</p>
<pre><code>E:\tmp&gt; nmake -f test.mak -a NOBatch=1

Microsoft (R) Program Maintenance Utility&nbsp;&nbsp; Version 1.62.6200
Copyright (C) Microsoft Corp 1988-1996. All rights reserved.

 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cl -nologo -Fd.\ -c .\foo1.cpp
foo1.cpp
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cl -nologo -Fd.\ -c .\foo2.cpp
foo2.cpp
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cl -nologo -Fd.\ -c .\foo3.cpp
foo3.cpp
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cl -nologo -Fd.\ -c .\foo4.cpp
foo4.cpp
</code></pre>
<p>
NMAKE produces the following result with the batch-mode inference rules:</p>
<pre><code>E:\tmp&gt; nmake -f test.mak -a

Microsoft (R) Program Maintenance Utility&nbsp;&nbsp; Version 1.62.6200
Copyright (C) Microsoft Corp 1988-1996. All rights reserved.

 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cl -nologo -Fd.\ -c .\foo1.cpp .\foo2.cpp .\foo3.cpp .\foo4.cpp
foo1.cpp
foo2.cpp
foo3.cpp
foo4.cpp
Generating Code...
</code></pre>
</FONT></BODY>
</HTML>
