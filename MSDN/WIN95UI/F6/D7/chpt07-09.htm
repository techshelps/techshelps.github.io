<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 2.0">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Adding Context Menus</title>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>

<BODY bgcolor="#FFFFFF">


<h1><font size="5">Adding Context Menus</font></h1>

<p>Next I wanted to add a context menu. This requires handling
the WM_CONTEXTMENU message, which is sent when the user clicks
the right mouse button in the client window. For instance, when
the user right-clicks a list view item (the <i>wParam</i>
parameter is filled in with the handle of the window that
received the right click), a context menu for that item appears. </p>

<p>This task is straightforward. Basically, you load the menu and
call TrackPopupMenu, as you would in a 16-bit Windows-based
application. When the user chooses an item from the context menu,
the appropriate command is generated and sent to the window
procedure as a WM_COMMAND message. The following code, from the
main window procedure, demonstrates how to handle the
WM_CONTEXTMENU message: </p>

<p><tt>case WM_CONTEXTMENU:<br>
// The right mouse button has been clicked.<br>
if ((HWND)wParam == g_Listing.hWndListView)<br>
{<br>
// Get the context menu from the resource file.<br>
hMenu = LoadMenu (g_Listing.hInst, &quot;HousePopupMenu&quot;);<br>
if (! hMenu)<br>
break;;<br>
<br>
// Get the first item in the menu for TrackPopupMenu().<br>
hMenuTrackPopup = GetSubMenu (hMenu, 0);<br>
<br>
// Draw and track the &quot;floating&quot; menu.<br>
TrackPopupMenu (hMenuTrackPopup, <br>
TPM_LEFTALIGN | TPM_RIGHTBUTTON,<br>
LOWORD(lParam), HIWORD(lParam), <br>
0, g_Listing.hWndListView, NULL);<br>
<br>
// Destroy the menu.<br>
DestroyMenu (hMenu);<br>
}<br>
break;</tt> </p>
</body>
</html>
