<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 2.0">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Initializing with IPersistFile</title>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD>

<BODY bgcolor="#FFFFFF">


<h1><font size="5">Initializing with IPersistFile</font></h1>

<p>Icon handlers, drop target handlers, and data object handlers
are initialized with the IPersistFile interface, which is used to
load and save documents that are stored in disk files (as opposed
to objects stored in IStorage instances). Once the document is
loaded, the application opens it as needed. IPersistFile itself
won't open the file for you; it has no way of knowing what type
of data your file contains. </p>

<p>In addition to the standard IUnknown functions, the
IPersistFile interface supports six other member functions. Five
of these functions&#151;IsDirty, Save, SaveCompleted, GetCurFile,
and GetClassID&#151;are part of the IPersistFile interface but
are not required for user interface extensions. For each of these
functions, you can simply return E_NOTIMPL. First, however, let's
look at the Load member function, which does need to be
implemented. </p>

<h4>Load</h4>

<p>This member function loads the document object that is
specified in the <i>pszFileName</i> parameter. A user interface
extension saves the filename for further processing. For example,
an icon handler saves the filename to determine which type of
icon to supply for the file. </p>

<p>Unlike the other functions listed here, the Load function is
required for user interface extensions. The implementation, as
you can see, is trivial: </p>

<p><tt>STDMETHODIMP CIconExt::XPerFile::Load (LPCOLESTR
pszFileName,<br>
DWORD dwMode)<br>
{<br>
METHOD_PROLOGUE (CIconExt, PerFile);<br>
<br>
WideCharToMultiByte (<br>
CP_ACP, // codePage<br>
0, // dwFlags<br>
(LPCWSTR)pszFileName, // lpWideCharStr<br>
-1, // cchWideChar<br>
pThis-&gt;m_szFile, // lpMultiByteStr<br>
sizeof (pThis-&gt;m_szFile), // cchMultiByte,<br>
NULL, // lpDefaultChar,<br>
NULL); // lpUsedDefaultChar<br>
<br>
return NOERROR;<br>
}</tt> </p>

<p>The following member functions, as mentioned earlier, are
supported by IPersistFile but are not required by user interface
extensions. </p>

<h4>IsDirty</h4>

<p>The IsDirty function checks a document object for any changes
that might have been made since the document was loaded. </p>

<h4>Save</h4>

<p>This function saves a copy of the object to the given
filename. </p>

<h4>SaveCompleted</h4>

<p>The SaveCompleted function simply signals that the object has
been saved. </p>

<h4>GetCurFile</h4>

<p>This member function returns either the absolute path of the
document's currently associated file or the default filename
prompt (if no currently associated file exists). </p>

<h4>GetClassID</h4>

<p>The GetClassID function returns a document's class ID. </p>
</body>
</html>
