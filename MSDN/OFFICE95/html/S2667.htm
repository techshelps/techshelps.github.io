<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>MAPIReadMail</TITLE><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">


<FONT FACE="ARIAL,HELVETICA" SIZE="2"><H3 CLASS="h2">MAPIReadMail</H3><P CLASS="h"><B>Syntax</B></P>
<P CLASS="syn"><B>MAPIReadMail(</B><I>Session</I><B>, </B><I>UIParam</I><B>, </B><I>MessageID$</I><B>, </B><I>Flags</I><B>, </B><I>Reserved</I><B>)</B></P>
<P CLASS="h"><B>Remarks</B></P>
<P CLASS="t">Reads a mail message and makes it the current inbound message. Before calling <B>MAPIReadMail</B>, use <B>MAPIFindNext</B> to verify that the correct message will be read. Use the MAPIQuery helper functions to retrieve information about the message. Use the MAPISet helper functions and <B>MAPISaveMail</B> to change the message. Use the MAPISet helper functions and <B>MAPISendMail</B> to forward or reply to the message.</P>
<P CLASS="t"><B>MAPIReadMail</B> automatically creates a temporary file for every attachment unless you call <B>MAPIReadMail</B> with the MAPI_ENVELOPE_ONLY or MAPI_SUPPRESS_ATTACH flag. The temporary files are not deleted automatically by the workgroup extensions. You must use <B>MAPIQueryAttachments</B> to enumerate the attachments and delete the<BR>temporary files.</P>
<P CLASS="t">Recipients, attachments, and contents are copied from the message before the function returns to the caller, so later changes to these elements do not affect the contents of the message unless changes are explicitly saved with <B>MAPISaveMail</B> or <B>MAPISendMail</B>.</P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="72pt" VALIGN="TOP"><COL WIDTH="276pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="thf"><B>Argument</B></P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="th"><B>Explanation</B></P></FONT></TD></TR><TR><TD COLSPAN="2" VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tr"></P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt"><I>Session</I></P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">An opaque session handle whose value represents a session with the messaging system. If the value is 0 (zero), <B>MAPIReadMail</B> returns MAPI_E_INVALID_SESSION. </P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt"><I>UIParam</I></P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">The parent window handle for the dialog box. A value of 0 (zero) specifies that any dialog box displayed is application modal.</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt"><I>MessageID$</I></P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">A variable-length string that is the message identifier<I> </I>of the message to be read. Message IDs are system specific, nonprintable, and opaque. Message IDs can be obtained from the <B>MAPIFindNext</B> and <B>MAPISaveMail</B> functions.</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt"><I>Flags</I></P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">A bitmask of flags. Unspecified flags should always be set to<BR>0 (zero). Undocumented flags are reserved. The following flags<BR>are defined:</P>
<P CLASS="ct">MAPI_ENVELOPE_ONLY&nbsp;=&nbsp;64<BR>MAPI_SUPPRESS_ATTACH&nbsp;=&nbsp;2048<BR>MAPI_BODY_AS_FILE&nbsp;=&nbsp;512<BR>MAPI_PEEK&nbsp;=&nbsp;128</P>
<P CLASS="tt">Set MAPI_ENVELOPE_ONLY if you don't want the function to copy attachments to temporary files or return the note text. All other message information (except temporary filenames) is returned. Setting this flag usually reduces the processing time required for<BR>the function.</P>
<P CLASS="tt">Set MAPI_SUPPRESS_ATTACH if you don't want <B>MAPIReadMail</B> to copy attachments but just to return note text.<BR>If MAPI_ENVELOPE_ONLY is set, this flag is ignored. The flag should reduce the time required by the <B>MAPIReadMail</B> function.</P>
<P CLASS="tt">Set MAPI_BODY_AS_FILE if you want the message body written to a temporary file and added to the attachment list as the first attachment, instead of using <B>MAPIQueryNoteText</B> to retrieve the message body (the default behavior). The <I>Position</I> argument of a body attachment is –1.</P>
<P CLASS="tt">Set MAPI_PEEK if you don't want <B>MAPIReadMail</B> to mark the message as read. Any unsuccessful return leaves the message unread.</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt"><I>Reserved</I></P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">Reserved for future use. This argument must be 0 (zero).</P></FONT></TD></TR></TBODY></TABLE>
<P CLASS="spacing"><BR></P><P></P>
<P CLASS="t">The following table lists the possible return values of the <B>MAPIReadMail</B> function and their meanings.</P>

<TABLE COLS="4" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="35pt" VALIGN="TOP"><COL WIDTH="165pt" VALIGN="TOP"><COL WIDTH="146pt" VALIGN="TOP"><COL WIDTH="0pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="thf"><B>Value</B></P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="th"><B>Name</B></P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="th"><B>Meaning</B></P></FONT></TD></TR><TR><TD COLSPAN="4" VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tr"></P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">–13</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">MAPI_E_ATTACHMENT_<BR>WRITE_FAILURE</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">An attachment could not be written to a temporary file. Check folder permissions.</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">–4</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">MAPI_E_DISK_FULL</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">The disk was full.</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">–2</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">MAPI_E_FAILURE</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">One or more unspecified errors occurred while reading the mail. No mail was read.</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">–5</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">MAPI_E_INSUFFICIENT_MEMORY</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">There was insufficient memory<BR>to proceed. No mail was read.</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">–17</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">MAPI_E_INVALID_MESSAGE</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">The message ID was invalid. It may have been deleted or changed by another process.</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">–19</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">MAPI_E_INVALID_SESSION</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">An invalid session handle was used for the <I>Session</I> argument. No mail was read.</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">–26</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">MAPI_E_NOT_SUPPORTED</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">The operation was not supported by the underlying messaging system.</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">–9</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">MAPI_E_TOO_MANY_FILES</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">Too many file attachments were contained in the message. No mail was read.</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">–10</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">MAPI_E_TOO_MANY_RECIPIENTS</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">There were too many recipients of the message. No mail was read.</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">0</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">SUCCESS_SUCCESS</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">The function returned successfully. </P></FONT></TD></TR></TBODY></TABLE>
<P CLASS="spacing"><BR></P><P></P>
<P CLASS="h"><B>Example</B></P>
<P CLASS="t">The following example displays the subject of the first message in the Inbox. The <B>MAPIReadMail</B> function in the example does not retrieve the note text or attachments of the message, and it does not mark the message as read.</P>
<P CLASS="spacing"><BR></P>
<PRE>Sub MAIN
MAPI_LOGON_UI&nbsp;=&nbsp;1
Session&nbsp;=&nbsp;MAPILogon(0, "", "", MAPI_LOGON_UI, 0)
Dim MessageID$, Subject$
result&nbsp;=&nbsp;MAPIFindNext(Session, 0, "", "", 0, 0, MessageID$)
MAPI_ENVELOPE_ONLY&nbsp;=&nbsp;64
MAPI_PEEK&nbsp;=&nbsp;128
Flags&nbsp;=&nbsp;MAPI_ENVELOPE_ONLY + MAPI_PEEK
result&nbsp;=&nbsp;MAPIReadMail(Session, 0, MessageID$, Flags, 0)
result&nbsp;=&nbsp;MAPIQuerySubject(Subject$)
MsgBox Subject$
result&nbsp;=&nbsp;MAPILogoff(Session, 0, 0, 0)
End Sub</PRE></FONT></FONT></BODY></HTML>
