<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>MAPISaveMail</TITLE><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">


<FONT FACE="ARIAL,HELVETICA" SIZE="2"><H3 CLASS="h2">MAPISaveMail</H3><P CLASS="h"><B>Syntax</B></P>
<P CLASS="syn"><B>MAPISaveMail(</B><I>Session</I><B>, </B><I>UIParam</I><B>, </B><I>Subject$</I><B>, </B><I>NoteText$</I><B>, </B><I>Flags</I><B>, </B><I>Reserved</I><B>, </B><I>MessageID$</I><B>)</B></P>
<P CLASS="h"><B>Remarks</B></P>
<P CLASS="t">Saves the current outbound message in the Mail Inbox, optionally replacing an existing message. Before calling <B>MAPISaveMail</B>, use <B>MAPIFindNext </B>to verify that the correct message will be saved. <I>MessageID$</I> must be a variable-length string. The elements of the message identified by the <I>MessageID$</I> argument are replaced by the elements of the current outbound message. If the <I>MessageID$</I> argument is empty, a new message is created. The new message ID is returned<BR>in the <I>MessageID$</I> argument on completion of the call. All replaced messages<BR>are saved in their appropriate folders. New messages are saved in the folder appropriate for incoming messages of that class.</P>
<P CLASS="t">The <B>MAPISaveMail</B> function uses the recipients and file attachments that you previously specified with the <B>MAPISetRecipient</B>, <B>MAPISetRecipientList</B>, <B>MAPISetMessageType</B> and <B>MAPISetAttachment</B> functions.</P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="72pt" VALIGN="TOP"><COL WIDTH="276pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="thf"><B>Argument</B></P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="th"><B>Explanation</B></P></FONT></TD></TR><TR><TD COLSPAN="2" VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tr"></P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt"><I>Session</I></P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">An opaque session handle whose value represents a session with the messaging system. Session handles are returned by <B>MAPILogon</B> and invalidated by <B>MAPILogoff</B>. If the value is 0 (zero) and <I>MessageID</I> is an empty string (""), the messaging system establishes a session from a system default session (if one exists) or presents a log-in dialog box. Otherwise, calls with <I>Session</I> equal to 0 (zero) return MAPI_E_INVALID_SESSION.</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt"><I>UIParam</I></P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">The parent window handle for the dialog box. A value of 0 (zero) specifies that any dialog box displayed is application modal.</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt"><I>Subject$</I></P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">The subject text, limited to 256 characters. (Messages saved with <B>MAPISaveMail</B> are not limited to 256 characters.) An empty string ("") indicates no subject text.</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt"><I>NoteText$</I></P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">A string containing the text of the message.</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt"><I>Flags</I></P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">A bitmask of flags. Unspecified flags should always be set to<BR>0 (zero). Undocumented flags are reserved. The following flags<BR>are defined:</P>
<P CLASS="ct">MAPI_LOGON_UI&nbsp;=&nbsp;1<BR>MAPI_NEW_SESSION&nbsp;=&nbsp;2</P>
<P CLASS="tt">Set MAPI_LOGON_UI if the function should display a log-in dialog box (if required). When this flag is not set, the function does not display a dialog box and returns an error if the user is not logged in.</P>
<P CLASS="tt">Set MAPI_NEW_SESSION if you want to establish a session other than the current one. For instance, if a mail client is already running, another MAPI e-mail client can piggyback on the session created<BR>by the mail client application. Do not set this flag if you want the default session (if it still exists). If the session passed in <I>Session</I> is not 0 (zero), this flag is ignored.</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt"><I>Reserved</I></P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">Reserved for future use. This argument must be 0 (zero).</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt"><I>MessageID$</I></P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">The variable-length string identifier for this message. It is<BR>returned by the <B>MAPIFindNext</B> function or a previous call to <B>MAPISaveMail</B>. If a new message is to be created, this argument should be an empty string (""). Message ID strings must be dynamic strings.</P></FONT></TD></TR></TBODY></TABLE>
<P CLASS="spacing"><BR></P><P></P>
<P CLASS="t">The following table lists the possible return values of the <B>MAPISaveMail</B> function and their meanings.</P>

<TABLE COLS="4" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="35pt" VALIGN="TOP"><COL WIDTH="165pt" VALIGN="TOP"><COL WIDTH="146pt" VALIGN="TOP"><COL WIDTH="0pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="thf"><B>Value</B></P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="th"><B>Name</B></P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="th"><B>Meaning</B></P></FONT></TD></TR><TR><TD COLSPAN="4" VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tr"></P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">–4</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">MAPI_E_DISK_FULL</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">The disk was full.</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">–2</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">MAPI_E_FAILURE</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">One or more unspecified errors occurred while saving the mail. No mail was saved.</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">–5</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">MAPI_E_INSUFFICIENT_MEMORY</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">There was insufficient memory<BR>to proceed. No mail was saved.</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">–17</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">MAPI_E_INVALID_MESSAGE</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">An invalid message ID was used for the <I>MessageID$</I> argument. No mail was saved.</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">–19</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">MAPI_E_INVALID_SESSION</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">An invalid session handle was used for the <I>Session</I> argument. No mail was saved.</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">–3</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">MAPI_E_LOGIN_FAILURE</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">There was no default log-in,<BR>and the user failed to log in successfully when the log-in dialog box was displayed. No mail was saved.</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">–26</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">MAPI_E_NOT_SUPPORTED</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">The operation was not supported by the underlying messaging system.</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">–1</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">MAPI_USER_ABORT</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">The user canceled the process. No mail was saved.</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">0</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">SUCCESS_SUCCESS</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">The function returned successfully. </P></FONT></TD></TR></TBODY></TABLE>
<P CLASS="spacing"><BR></P><P></P>
<P CLASS="h"><B>Example</B></P>
<P CLASS="t">The following example saves a message in the Inbox with two unresolved recipients.</P>
<P CLASS="spacing"><BR></P>
<PRE>Sub MAIN
MAPI_LOGON_UI&nbsp;=&nbsp;1
Session&nbsp;=&nbsp;MAPILogon(0, "", "", MAPI_LOGON_UI, 0)
Dim MessageID$
result= MAPISetRecipient(1,"Anita Kopf","")
result= MAPISetRecipient(2,"Roger Selva","")
result&nbsp;=&nbsp;MAPISaveMail(Session, 0, "Monthly Summary",\
    "We will quickly satisfy all orders for clamps.", 0, 0, MessageID$)
result&nbsp;=&nbsp;MAPILogoff(Session, 0, 0, 0)
End Sub
</PRE></FONT></FONT></BODY></HTML>
