<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Calling Routines in DLLs</TITLE><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY BGPROPERTIES="FIXED" TEXT="#000000" BGCOLOR="#FFFFFF">


<FONT FACE="ARIAL,HELVETICA" SIZE="2"><H2 CLASS="h1">Calling Routines in DLLs</H2><P CLASS="t">In Windows, a macro can call routines in a <I>dynamic-link library</I> (DLL) or Word add-in library (WLL) to access capabilities that aren't directly available in WordBasic. Calls are often made to Windows API (application programming interface) routines, but they can be made to routines in any DLL that makes routines available for other programs. WLLs are a special kind of DLL written specifically for Word; WordBasic can call routines in a WLL in the same way it calls routines from a DLL.</P>
<P CLASS="t">On the Macintosh, DLL files are not available, but you can call routines stored in WLLs. In this section, the term DLL is used to refer to DLLs in Windows and Word add-in libraries in Windows or on the Macintosh.</P>
<P></P>
<P CLASS="nh"><B>Note</B></P>
<P CLASS="nt">For information about writing Word add-in libraries using the Word API, see Appendix C, "Microsoft Word Application Programming Interface," in Part 3, "Appendixes."</P>
<P></P>
<P CLASS="t">Because DLL routines reside in files that are external to Word, you must let WordBasic know where it can find the routines you want to use. You provide this information with the <B>Declare</B> statement. Once you have declared a DLL routine, you can use it in your code like any other routine (although you have to be especially careful about the arguments that you pass to DLL routines).</P>
<P CLASS="t">There are two steps to using a DLL routine:</P>
<P CLASS="ls">    1.    Tell WordBasic about the routine by using a <B>Declare</B> statement.</P>
<P CLASS="ls">    2.    Make the actual call.</P>
<P></P>
<P CLASS="t">You declare a DLL routine only once in a macro. You then can call it any number of times from any subroutine or user-defined function used in the macro.</P>
<H3 CLASS="h3"><A NAME="sec0"></A>Declaring a DLL Routine</H3><P CLASS="t">To declare a DLL routine, place a <B>Declare</B> statement outside a subroutine or<BR>user-defined function. Typically, <B>Declare</B> statements are placed at the start of<BR>the macro before any other statements.</P>
<P CLASS="t">If the routine does not return a value, declare it as a subroutine. For example:</P>
<P CLASS="spacing"><BR></P>
<PRE>Declare Sub SetWindowTextA Lib "User32" (hWnd As Long,\
    lpString As String)
</PRE>
<P CLASS="t">If the routine returns a value, declare it as a function. For example:</P>
<P CLASS="spacing"><BR></P>
<PRE>Declare Function GetSystemMetrics Lib "User32" (num As Long) \
    As Long
</PRE>
<P CLASS="t">In Windows 95 and Windows NT, function names are case-sensitive and must be declared exactly as they appear in the DLL. </P>
<P CLASS="t">Here are the same declarations in Word version 6.0 for Windows:</P>
<P CLASS="spacing"><BR></P>
<PRE>Declare Sub SetWindowText Lib "User" (hWnd As Integer, \
    lpString As String)
Declare Function GetSystemMetrics Lib "User" (num As Integer) As Integer
</PRE>
<P CLASS="t">Note the <B>Lib</B> keyword in the <B>Declare</B> statement. The <B>Declare</B> statement can also contain an optional <B>Alias</B> keyword. The use of these keywords is explained under "Special Considerations When Declaring DLL Routines" later in this section.</P>
<P CLASS="t">For the complete syntax of the <B>Declare</B> statement, see Part 2, "WordBasic Reference."</P>
<H3 CLASS="h3"><A NAME="sec1"></A>Calling a DLL Routine</H3><P CLASS="t">Once a routine is declared, you can then call it just as you would a WordBasic statement or function. The following example uses the GetSystemMetrics Windows API routine to determine whether a mouse is installed. The value 19 assigned to SM_MOUSEPRESENT is one of a number of values that can be passed to the GetSystemMetrics function. These values are listed in the Microsoft Win32&reg; Software Development Kit. </P>
<P CLASS="spacing"><BR></P>
<PRE>Declare Function GetSystemMetrics Lib "User32" (num As Long) \
    As Long

Sub MAIN
    SM_MOUSEPRESENT = 19
    If GetSystemMetrics(SM_MOUSEPRESENT) Then MsgBox "Mouse installed"
End Sub
</PRE>
<P></P>
<P CLASS="nh"><B>Important</B></P>
<P CLASS="nt">WordBasic can't verify that you are passing correct values to a DLL routine. If you pass incorrect values, the routine may fail, which may cause unexpected behavior or errors in Word or the operating system. Take care when experimenting with DLL routines, and save your work often.</P>
<P></P>
<H3 CLASS="h3"><A NAME="sec2"></A>Special Considerations When Declaring DLL Routines</H3><P CLASS="t">As you have probably realized, the declarations for DLL routines can be quite complex. The Microsoft Word Developer's Kit disk for Windows includes the text files WIN16API.TXT and WIN32API.TXT, which list WordBasic DLL routine declarations for the Windows API. You can search for the declarations you want in the text files, copy them, and paste them into your macro. </P>
<P CLASS="t">Once you have pasted the appropriate DLL routine declarations into your code, you simply call the routines like any other routine in your application. Because you have to take extra care when passing values to DLL routines, however, you should first read "Calling DLL Routines with Specific Variable Types" later in this section.</P>
<P CLASS="t">If you are attempting to call a routine in a DLL that is not part of the operating environment, you should consult the documentation for the DLL to determine the proper declaration for it.</P>
<H4 CLASS="h4"><A NAME="sec3"></A>Specifying the Library</H4><P CLASS="t">The <B>Lib</B> <I>LibName$</I> clause in the <B>Declare</B> statement tells WordBasic where to find the dynamic-link library. For the Windows 95 and Windows NT operating environment DLLs, this is either "User32," "GDI32," "Kernel32," or one of the other system DLLs such as "MMSystem." For Windows 3.<I>x</I>, this is either "User," "GDI," "Kernel," or one of the other system DLLs. For other DLLs, the <I>LibName$</I> is a file specification that can include a path. For example:</P>
<P CLASS="spacing"><BR></P>
<PRE>Declare Function EnvString Lib "c:\win\strings.dll" (stringbuffer$, \<BR>    stringnum As Long) As Long
</PRE>
<P CLASS="t">If you are declaring a function in a loaded DLL or WLL, you do not need to specify the path.</P>
<H4 CLASS="h4"><A NAME="sec4"></A>Using an Alias</H4><P CLASS="t">You can use the <B>Alias</B> keyword to call a routine by a different name within a macro. You may need to do this if the routine name is not a valid subroutine or function name in WordBasic. If a routine has a long name, you can use <B>Alias</B> to substitute a shorter one. For example, this <B>Declare</B> statement substitutes the name WinDir for the routine's longer name (GetWindowsDirectory):</P>
<P CLASS="spacing"><BR></P>
<PRE>Declare Function WinDir Lib "Kernel32" Alias "GetWindowsDirectoryA" \
    (stringbuffer$, stringnum As Long) As Long
</PRE>
<P CLASS="t">Note that the routine's real name, GetWindowsDirectoryA, follows the <B>Alias</B> keyword and that the alias WinDir (the name given to the routine within the macro) follows the <B>Function</B> keyword. </P>
<P CLASS="t">Here is the same <B>Declare</B> statement for Windows 3.<I>x</I>:</P>
<P CLASS="spacing"><BR></P>
<PRE>Declare Function WinDir Lib "Kernel" Alias "GetWindowsDirectory" \
    (stringbuffer$, stringnum As Integer) As Integer
</PRE>
<P CLASS="t">Now you can use this shorter name to call the GetWindowsDirectory routine:</P>
<P CLASS="spacing"><BR></P>
<PRE>WinPath$ = String$(145, "*")
worked = WinDir(WinPath$, Len(WinPath$))
MsgBox WinPath$
</PRE>
<H3 CLASS="h3"><A NAME="sec5"></A>Calling DLL Routines with Specific Variable Types</H3><P CLASS="t">Many DLL routines require or return variable types that are not supported in WordBasic. WordBasic, in turn, supports variable-length strings, which are not supported by most DLL routines. Therefore, you must take care when passing variables to and receiving variables from DLL routines.</P>
<H4 CLASS="h4"><A NAME="sec6"></A>DLL Routines That Use Strings</H4><P CLASS="t">Windows 95 or Windows NT functions that use strings are typically available in two versions: ANSI and Unicode. Word version 7.0 and Word version 6.0 for Windows NT are ANSI applications and must, therefore, use ANSI versions of the API functions. The ANSI API functions have an "A" appended to the function name. For instance, the Windows 3.<I>x</I> function GetWindowsDirectory is GetWindowsDirectoryA in Windows 95 and Windows NT. </P>
<H4 CLASS="h4"><A NAME="sec7"></A>DLL Routines That Modify Strings</H4><P CLASS="t">A DLL routine can modify a WordBasic string variable it receives as an argument. (Strings are always passed to DLL routines by reference.) Be careful when calling a DLL routine that modifies a string. A DLL cannot increase the length of a WordBasic string; it simply writes beyond the end of the string if<BR>it is not long enough. This corrupts other areas of memory. You can avoid this problem by making the string argument long enough that the DLL routine can never write past the end of it.</P>
<P CLASS="t">For example, the GetWindowsDirectory routine returns the path for the Windows folder in its first argument:</P>
<P CLASS="spacing"><BR></P>
<PRE>Declare Function GetWindowsDirectoryA Lib "Kernel32" \
    (stringbuffer As String, stringnum As Long) As Long
</PRE>
<P CLASS="t">A safe way to call this routine is to make the returned argument at least 255 characters long by filling it with characters — in this case, asterisk (*) characters&nbsp;— before it is passed by reference to the DLL routine:</P>
<P CLASS="spacing"><BR></P>
<PRE>path$ = String$(255, "*")
worked = GetWindowsDirectory(path$, Len(path$))
</PRE>
<P CLASS="t">Most DLL routines (and all the routines in the Windows API) expect standard<BR>C strings, which end in a "null character" (ANSI 0). Word converts all strings that<BR>it passes to DLL routines to null-terminated strings. Visual Basic includes the <B>ByVal</B> keyword to specify that a string should be passed as a null-terminated string, but this keyword is not supported (or necessary) in WordBasic.</P>
<P></P>
<P CLASS="nh"><B>Note</B></P>
<P CLASS="nt">Windows DLL routines generally do not return strings longer than 255 characters. While this is true of many other libraries, always consult the documentation for the routine in question.</P>
<P></P>
<H4 CLASS="h4"><A NAME="sec8"></A>The Double, Integer, and Long Variable Types</H4><P CLASS="t">Two variable types are supported within WordBasic: strings and numbers (double-precision floating-point numbers). But in the <B>Declare</B> statement only, WordBasic supports two additional types, <B>Integer</B> and <B>Long</B>:</P>
<UL><LI>    An <B>Integer</B> variable stores an integer value between -32,768 and 32,767 or between 0 and 65,535.</LI><LI>    A <B>Long</B> variable stores a value between -2,147,483,648 and -2,147,483,647 or 0 and 4,294,967,295.</LI></UL><P></P>
<P CLASS="t"><B>Integer</B> and <B>Long</B> variables are used to export values from and import values to WordBasic. When WordBasic receives an <B>Integer</B> or <B>Long</B> value from a DLL routine, the value is converted into a double-precision floating-point value, the standard WordBasic numeric type. </P>
<P CLASS="t">If a function in Windows 3.<I>x</I> uses the type <B>Integer</B>, the corresponding function in Windows 95 and Windows NT uses <B>Long</B>.</P>
<P CLASS="t">In addition, the variable type <B>Double </B>is available in <B>Declare</B>. <B>Double</B> is a double-precision floating-point number equivalent to the standard WordBasic numeric type. When you define a variable as <B>Double</B> in a <B>Declare</B> instruction, it is the same as defining it as a numeric variable elsewhere in WordBasic.</P>
<H4 CLASS="h4"><A NAME="sec9"></A>Structured Variable Limitation</H4><P CLASS="t">Some DLL routines take or receive variables referred to as "structures" in C,<BR>as "records" in Pascal, or as "user-defined types" in Visual Basic. DLL documentation often uses the C terminology. WordBasic does not support structured variables (other than dialog records), so these routines calling DLL routines that return or require structured variables may cause unpredictable results.</P>
<H4 CLASS="h4"><A NAME="sec10"></A>Arrays</H4><P CLASS="t">You can pass individual elements of an array in the same way you pass any variable. For example, you can use the sndPlaySound routine to play a series of .WAV files stored in an array:</P>
<P CLASS="spacing"><BR></P>
<PRE>Declare Function sndPlaySoundA Lib "WINMM"(sound$, flag As Integer) \
    As Long

Sub MAIN
WAVEFILECOUNT = 10
Dim WaveFile$(WAVEFILECOUNT - 1)
For i = 0 To WAVEFILECOUNT - 1
    worked = sndPlaySoundA(WaveFile$(i), 0)
Next i
End Sub
</PRE>
<P CLASS="t">WordBasic does not support passing entire arrays to DLL routines.</P>
<H3 CLASS="h3"><A NAME="sec11"></A>Converting Common Declarations</H3><P CLASS="t">The routines in DLLs are most commonly documented using C language syntax. To call them from WordBasic, you must translate them into valid <B>Declare</B> statements and call them correctly. When translating, you may find the following table useful; it lists common C language declarations and their WordBasic equivalents.</P>

<TABLE COLS="6" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="97pt" VALIGN="TOP"><COL WIDTH="0pt" VALIGN="TOP"><COL WIDTH="121pt" VALIGN="TOP"><COL WIDTH="0pt" VALIGN="TOP"><COL WIDTH="129pt" VALIGN="TOP"><COL WIDTH="0pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="thf"><B>C language declaration</B></P></FONT></TD><TD COLSPAN="2" VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="th"><B>In WordBasic declare as</B></P></FONT></TD><TD COLSPAN="3" VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="th"><B>Call with</B></P></FONT></TD></TR><TR><TD COLSPAN="6" VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tr"></P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">Pointer to a string (LPSTR)</P></FONT></TD><TD COLSPAN="2" VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">S <B>As</B> <B>String </B>or S$</P></FONT></TD><TD COLSPAN="3" VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">A string variable</P></FONT></TD></TR><TR><TD COLSPAN="2" VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">Pointer to an integer (LPINT)</P></FONT></TD><TD COLSPAN="3" VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">L <B>As</B> <B>Long</B></P></FONT></TD><TD COLSPAN="3" VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">A long variable</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">Pointer to a long integer (LPDWORD)</P></FONT></TD><TD COLSPAN="2" VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">L <B>As</B> <B>Long</B></P></FONT></TD><TD COLSPAN="3" VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">A long variable</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">Pointer to a structure (for example, LPRECT)</P></FONT></TD><TD COLSPAN="2" VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">No equivalent</P></FONT></TD><TD COLSPAN="3" VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">No equivalent</P></FONT></TD></TR></TBODY></TABLE>
<P CLASS="spacing"><BR></P><P></P>
<P></P>

<TABLE COLS="4" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="97pt" VALIGN="TOP"><COL WIDTH="121pt" VALIGN="TOP"><COL WIDTH="129pt" VALIGN="TOP"><COL WIDTH="0pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="thf"><B>C language declaration</B></P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="th"><B>In WordBasic declare as</B></P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="th"><B>Call with</B></P></FONT></TD></TR><TR><TD COLSPAN="4" VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tr"></P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">Integer (INT, UINT, WORD, BOOL)</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">L <B>As</B> <B>Long </B>(I <B>As</B> <B>Integer</B> in Windows 3.<I>x</I>)</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">A long variable (an integer variable in Windows 3.<I>x</I>)</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">Handle (hWnd, hDC, hMenu, and so on)</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">h <B>As</B> <B>Long </B>(h <B>As</B> <B>Integer</B> in Windows 3.<I>x</I>)</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">A long variable (an integer variable in Windows 3.<I>x</I>)</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">Long (DWORD, LONG)</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">L <B>As</B> <B>Long</B></P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">A long variable</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">Pointer to an array of integers</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">No equivalent</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">No equivalent</P></FONT></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">Pointer to a void (void *)</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">No equivalent</P></FONT></TD><TD VALIGN="TOP"><FONT FACE="ARIAL,HELVETICA" SIZE="2"><P CLASS="tt">No equivalent</P></FONT></TD></TR></TBODY></TABLE>
<P CLASS="spacing"><BR></P><P></P>
<P CLASS="t">If the routine's return value is void, it should be declared as a subroutine (see "Declaring a DLL Routine" earlier in this section).</P></FONT></FONT></BODY></HTML>
