<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>How Migration DLLs are Processed</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_zaw_how_migration_dlls_are_processed"></a>How Migration DLLs are Processed</h2>
<p>
<span style=color:#FF0000>[This is preliminary documentation and subject to change.]</span> </p>
<p>
This section provides the order in which the functions in the migration DLL are called and a brief description of each function. Note that if any of the required seven functions is not present, Setup will skip your MIGRAGE.DLL, and your application will not be migrated to the new system.</p>
<p>
During the initial portion of Windows NT Setup (that is, while Windows 95 or Windows 98 is still running), the following MIGRATE.DLL functions are called in the order listed. </p>
<table cellspacing=4 cols=3>
<tr valign=top>
<th align=left width=38%>Function</th>
<th align=left width=18%>Caller</th>
<th align=left width=44%>Reason for Call</th>
</tr>
<tr valign=top>
<td width=38%><b>DllMain (DLL_PROCESS_ATTACH)</b></td>
<td width=18%>Windows 95 and Windows 98</td>
<td width=44%>Standard call to load the migration DLL from the installation media.</td>
</tr>
<tr valign=top>
<td width=38%><b>QueryVersion</b></td>
<td width=18%>Setup</td>
<td width=44%>Obtain application ID information (such as the product ID and version number) and determine if further processing is necessary. <p>
After successful processing, the relevant files are copied to the user's hard disk. </p>
</td>
</tr>
<tr valign=top>
<td width=38%><b>DllMain (DLL_PROCESS_DETACH)</b></td>
<td width=18%>Windows 95 and Windows 98</td>
<td width=44%>The system unloads the migration DLL.</td>
</tr>
<tr valign=top>
<td width=38%><b>DllMain (DLL_PROCESS_ATTACH)</b></td>
<td width=18%>Windows 95 and Windows 98</td>
<td width=44%>The system loads the migration DLL from its new location on the local hard disk.</td>
</tr>
<tr valign=top>
<td width=38%><b>Initialize9x</b></td>
<td width=18%>Setup</td>
<td width=44%>MIGRATE.DLL prepares itself for the migration process. It detects its target application component locations. Then it provides the working and source directories to Windows NT Setup.</td>
</tr>
<tr valign=top>
<td width=38%><b>MigrateUser9x</b></td>
<td width=18%>Setup</td>
<td width=44%>Setup calls the <b>MigrateUser9x</b> function once for each Windows 95 and Windows 98 user account on the computer being upgraded as well as for the Windows NT Administrator account (that is, the active user account becomes the Windows NT Administrator account after migration). The migration DLL detects the users that have installed its target application. <p>
Setup also calls <b>MigrateUser9x</b> for the default user account if necessary. </p>
<p>
If the application is installed for the given user name, the DLL gathers user-specific application information to be used during the <b>MigrateUserNT</b> function call.</p>
</td>
</tr>
<tr valign=top>
<td width=38%><b>MigrateSystem9x</b></td>
<td width=18%>Setup</td>
<td width=44%>The DLL gathers system-wide information concerning its target application and saves private data to be used during the <b>MigrateSystemNT</b> function call.</td>
</tr>
<tr valign=top>
<td width=38%><b>DllMain (DLL_PROCESS_DETACH)</b></td>
<td width=18%>Windows 95 and Windows 98</td>
<td width=44%>The system unloads the migration DLL.</td>
</tr>
</table><br>
<p>
During the second portion of Windows NT Setup (that is, when the newly installed Windows NT is running), the following MIGRATE.DLL functions are called in the order listed. </p>
<table cellspacing=4 cols=3>
<tr valign=top>
<th align=left width=38%>Function</th>
<th align=left width=18%>Caller</th>
<th align=left width=44%>Reason for Call</th>
</tr>
<tr valign=top>
<td width=38%><b>DllMain (DLL_PROCESS_ATTACH)</b></td>
<td width=18%>Windows NT</td>
<td width=44%>The system loads the migration DLL. </td>
</tr>
<tr valign=top>
<td width=38%><b>InitializeNT</b></td>
<td width=18%>Setup</td>
<td width=44%>Windows NT Setup provides the migration DLL with its working directory, specified during the earlier call to <b>Initialize9x</b>.</td>
</tr>
<tr valign=top>
<td width=38%><b>MigrateUserNT</b></td>
<td width=18%>Setup</td>
<td width=44%>Setup calls <b>MigrateUserNT</b> once per user. It enables the migration DLL to make changes to a user's application settings. <p>
Note that the number of calls may be less than the number made to <b>MigrateUser9x</b> since some user accounts may not migrate. For example, the default user account may not migrate if that account has never been accessed. As such, a DLL must store its private data on a per-user basis.</p>
</td>
</tr>
<tr valign=top>
<td width=38%><b>MigrateSystemNT</b></td>
<td width=18%>Setup</td>
<td width=44%>The migration DLL makes changes to the system application settings based on the information obtained during the call to <b>MigrateSystem9x</b>. </td>
</tr>
<tr valign=top>
<td width=38%><b>DllMain (DLL_PROCESS_DETACH)</b></td>
<td width=18%>Windows NT</td>
<td width=44%>The system unloads the migration DLL.</td>
</tr>
</table><br>
<p>
By the time the system calls the <b>DllMain (DLL_PROCESS_ATTACH)</b> function, Setup has done the following:
<ol>
<li>
Copied all 32-bit executables from %windir%\system to %windir%\system32.</li>
<li>
Adjusted Window 95 or Windows 98 registry key values within HKU\User\Software and HKLM\Software that contain full paths to files that exist in a new location on Windows NT. </li>
<li>
Migrated all system settings, including the registry, program menu items, desktop, recent documents, and other shell settings.</li>
<li>
Deleted Windows 95- and Windows 98-specific OLE system objects (not application objects).</li>
<li>
Migrated the user shell folders (such as c:\windows\desktop) to the Windows NT equivalent (that is, c:\windows\profiles\&lt;user&gt;\desktop).</li>
<li>
Adjusted the paths in .STF files (part of ACME Setup) if necessary (for Beta 2).</li>
<li>
Adjusted links and PIFs that point to moved files.</li>
</ol>
<p>
<b>Note</b>  In the Windows NT phase of the upgrade process, each DLL function has 60 seconds to complete its processing. If it takes longer, Setup will terminate it.</p>
<p>&nbsp;</p></body>
</HTML>
