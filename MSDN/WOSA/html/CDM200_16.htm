<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>4.1 WFS_CMD_CDM_DENOMINATE</TITLE>
<BODY bgcolor=white>

<FONT FACE="verdana"><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY>
<h5>
4.1 WFS_CMD_CDM_DENOMINATE</h5>
<p>
<b>Description</b> This command, which is designed to support denomination dialogues, will provide a denomination, i.e., a mix of bills and/or coins, capable of being paid out according to the amount (in terms of the minimum dispense unit) and currency specified, the mix algorithm selected and the desired denomination. In addition to that, it provides a facility for checking any given denomination for its capability of being paid out.</p>
<p>
For the denomination of a specified amount the money can be retrieved from three different sources:</p>
<ul>
<li>
the cash dispenser<p>
</li>
<li>
the coin dispenser (see WFS_INF_CDM_CAPABILITIES)<p>
</li>
<li>
the teller's cash box (see WFS_INF_CDM_CAPABILITIES)</li>
</ul>
<ol>
</ol>
<p>
The configuration specifies which of these three sources are allowed to be used in the denomination. For a ATS all three can be used. If the device used is an ATM, only the cash dispenser and, optionally, the coin dispenser can be available.</p>
<p>
For the cash dispenser module there is a parameter (<i>wMaxBills</i> in the WFS_INF_CDM_CAPABILITIES command) controlling the maximum number of bills or documents that can be paid out within a single dispensing command. The coin dispenser has a parameter (<i>wMaxCoins</i> in the WFS_INF_CDM_CAPABILITIES command) specifying the maximum number of coins that can be paid out.</p>
<p>
Existing variants for dispensing of bills or documents are:</p>
<ul>
<li>
House mix tables (denomination tables), defined in the configuration <p>
</li>
<li>
Denomination algorithms, such as balanced use of the different cash units, use of bills with highest possible values, etc. </li>
</ul>
<p>
There are four distinct combinations of the inputs to this command:</p>
<ol>
<li>
Input parameters are currency and denomination, with mix number WFS_CDM_INDIVIDUAL and amount equal to zero. In this case the service checks only whether the denomination is valid according to the counters and the states of the cash units.<p>
</li>
<li>
Input parameters are currency, amount and denomination, with mix number WFS_CDM_INDIVIDUAL. The service checks amount and denomination and returns amount, currency and denomination, if the denomination specified is OK.<p>
</li>
<li>
Input parameters are currency, amount and mix number. The denomination is performed depending on the specified amount and mix number, and the configuration (coin dispenser and/or cash box; see WFS_INF_CDM_CAPABILITIES). The service returns the values for amount, currency and denomination (given the general capability to pay out the amount specified; see above).</li>
</ol>
<p>
 If, for example, the amount of £34.00 has been chosen, the CDM service will try to separate the required coins (up to the configured maximum value) using a coin dispenser. If no coin dispenser is available, the separated amount is assigned to sources other than the CDM (such as the teller's cash box). An ATM (having no cash box) raises an error indicating that this amount cannot be denominated.</p>
<p>
 If, for example, there are no more £10.00 bills in the CDM (cash unit minimum has been reached), it performs payments using bills denominating £20.00 while the remaining £10.00 will have to be paid out from the cash box, if present.</p>
<ol>
<li>
Input parameters are currency, amount and mix number, where the desired denomination is partly defined or a minimum amount for the cashbox is specified. In these cases the partly specified denomination is completed; the cashbox amount may be updated and returned together with the amount and the desired currency.</li>
</ol>
<p>
The following errors can occur:</p>
<ul>
<li>
If the denomination specified requires the selection of a locked cash unit, the CDM service returns the error WFS_ERR_CDM_CASHUNITERROR.<p>
</li>
<li>
If the sum total of the denomination is greater than the amount specified (exception: amount is zero), the CDM service returns the error WFS_ERR_CDM_INVALIDDENOMINATION.<p>
</li>
<li>
If the amount specified cannot be dispensed, either because a bill value or coin type is not in the machine, the difference is requested from the teller's cash box. If the device is an ATM, there is no cash box and the error WFS_ERR_CDM_NOTDISPENSABLE is returned.<p>
</li>
<li>
If no coin dispenser is in the unit and a coin amount is specified, a WFS_ERR_CDM_CASHUNITERROR error is returned.<p>
</li>
<li>
If the desired denomination refers to cash units containing different currencies, the CDM-service returns the error WFS_ERR_CDM_NOCURRENCYMIX. A cash unit with a currency type indicating a coupon or non-cash item can be mixed with other currencies.<p>
</li>
<li>
If the currency specified is not configured for the service, a WFS_ERR_CDM_INVALIDCURRENCY error is returned.</li>
</ul>
<p>
<b>Input Param</b> <code>LPWFSCDMDENOMINATE lpDenominate;</code></p>
<pre><FONT FACE="COURIER NEW" SIZE=2>typedef struct _wfs_cdm_denominate<BR> {<BR> USHORT      usTellerID;<BR> USHORT      usMixNumber;<BR> LPWFSCDMDENOMINATION lpDenomination;<BR> } WFSCDMDENOMINATE, * LPWFSCDMDENOMINATE;</FONT></pre>
<p>
 <i>usTellerID</i><BR>Identification of teller.</p>
<p>
 <i>usMixNumber</i><BR>Mix algorithm or house mix table to be used. If the value is WFS_CDM_INDIVIDUAL, the service does not calculate an alternative denomination.</p>
<p>
 <i>lpDenomination</i><BR>Pointer to a WFSCDMDENOMINATION structure, describing the contents of the denomination operation.</p>
<pre><FONT FACE="COURIER NEW" SIZE=2>typedef struct _wfs_cdm_denomination<BR> {<BR> CHAR   cCurrencyID[3];<BR> ULONG   ulAmount;<BR> USHORT   usCount;<BR> LPULONG  lpulValues;<BR> ULONG   ulCashBox;<BR> } WFSCDMDENOMINATION, * LPWFSCDMDENOMINATION;</FONT></pre>
<p>
 <i>cCurrencyID</i><BR>Identification of currency (ISO format).</p>
<p>
 <i>ulAmount</i><BR>The total amount of money to be dispensed. (Amount expressed in minimum dispense units; see WFS_INF_CDM_CURRENCY_EXP.)</p>
<p>
 <i>usCount</i><BR>Number of cash units used. Size of the array <i>lpulValues</i>.</p>
<p>
 <i>lpulValues</i><BR>Pointer to a list of ULONGs, specifying the number of coins/bills to take from the cash unit. The position in the list defines the logical number of the logical cash unit to be used, the first value in the array is related to the cash unit with the logical number 1. When  more than one physical cash unit exists for a logical cash unit, the device selects the actual physical cash unit to use.</p>
<p>
 <i>ulCashBox</i><BR>Amount of money that could not be denominated and has to be paid from the tellers cash box. (Amount expressed in minimum dispense units; see WFS_INF_CDM_CURRENCY_EXP.)</p>
<p>
<b>Output Param</b> <code>LPWFSCDMDENOMINATION lpDenomination;<BR></code>For a description see the input structure.</p>
<p>
<b>Error Codes </b>The following additional error codes can be generated by this command:</p>
<p>
Value Meaning</p>
<p>
WFS_ERR_CDM_CASHUNITERROR The specified cash unit caused a problem. A WFS_EXECUTE_EVENT with an id of WFS_EXEE_CDM_CASHUNITERROR is posted with the details.</p>
<p>
WFS_ERR_CDM_EXCHANGEACTIVE The CDM service is in an exchange state (see WFS_CMD_CDM_START_EXCHANGE).</p>
<p>
WFS_ERR_CDM_INVALIDCURRENCY Currency type is not configured.</p>
<p>
WFS_ERR_CDM_INVALIDDENOMINATION The sum of the values for cashbox, cash unit and coin were greater than the amount specified. Or, <i>usMixNumber</i> was WFS_CDM_INDIVIDUAL and the calculated denomination is smaller than the given amount.</p>
<p>
WFS_ERR_CDM_INVALIDMIXNUMBER Mix algorithm is not known.</p>
<p>
WFS_ERR_CDM_INVALIDTELLERID Teller ID not present in service provider’s teller ID list</p>
<p>
WFS_ERR_CDM_NOCURRENCYMIX More than one currency was selected when the cash units were specified. The exception to this is when the cash unit selected contains a non-currency value such as a coupon.</p>
<p>
WFS_ERR_CDM_NOTDISPENSABLE The amount is not dispensable by the cash dispenser.</p>
<p>
WFS_ERR_CDM_TOOMANYBILLS The request would require too many bills to be dispensed.</p>
<p>
WFS_ERR_CDM_TOOMANYCOINS The request would require too many coins to be dispensed.</p>
<p>
<b>Events</b> The following additional events can be generated by this command:</p>
<p>
Value Meaning</p>
<p>
WFS_EXEE_CDM_CASHUNITERROR An error occurred while attempting to denominate from the cash unit specified by the event.</p>
<p>
<b>Comments</b> None.</p>
</BODY>
</HTML>
