<HTML><HEAD><META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>'kern'- Kerning</TITLE><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
</OBJECT></FORM>
<H3>'kern'- Kerning</H3>The kerning table contains the values that control the intercharacter spacing for the glyphs in a font. There is currently no system level support for kerning (other than returning the kern pairs and kern values).</P>
Each subtable varies in format, and can contain information for vertical or horizontal text, and can contain kerning values or minimum values. Kerning values are used to adjust inter-character spacing, and minimum values are used to limit the amount of adjustment that the scaler applies by the combination of kerning and tracking. Because the adjustments are additive, the order of the subtables containing kerning values is not important. However, tables containing minimum values should usually be placed last, so that they can be used to limit the total effect of other subtables.</P>
The kerning table in the TrueType font file has a header, which contains the format number and the number of subtables present, and the subtables themselves.</P>

<TABLE COLS="3" BORDER="1" CELLPADDING="7"><COLGROUP><COL WIDTH="70pt" VALIGN="TOP"><COL WIDTH="70pt" VALIGN="TOP"><COL WIDTH="284pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>Type</P></TD><TD VALIGN="TOP"><P>Field</P></TD><TD VALIGN="TOP"><P>Description</P></TD></TR><TR><TD VALIGN="TOP"><P>USHORT</P></TD><TD VALIGN="TOP"><P>version</P></TD><TD VALIGN="TOP"><P>Table version number (starts at 0)</P></TD></TR><TR><TD VALIGN="TOP"><P>USHORT</P></TD><TD VALIGN="TOP"><P>nTables</P></TD><TD VALIGN="TOP"><P>Number of subtables in the kerning table.</P></TD></TR></TBODY></TABLE>
<BR></P>Kerning subtables will share the same header format. This header is used to identify the format of the subtable and the kind of information it contains:</P>

<TABLE COLS="3" BORDER="1" CELLPADDING="7"><COLGROUP><COL WIDTH="70pt" VALIGN="TOP"><COL WIDTH="71pt" VALIGN="TOP"><COL WIDTH="284pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>Type</P></TD><TD VALIGN="TOP"><P>Field</P></TD><TD VALIGN="TOP"><P>Description</P></TD></TR><TR><TD VALIGN="TOP"><P>USHORT</P></TD><TD VALIGN="TOP"><P>version</P></TD><TD VALIGN="TOP"><P>Kern subtable version number</P></TD></TR><TR><TD VALIGN="TOP"><P>USHORT</P></TD><TD VALIGN="TOP"><P>length</P></TD><TD VALIGN="TOP"><P>Length of the subtable, in bytes (including this header).</P></TD></TR><TR><TD VALIGN="TOP"><P>USHORT</P></TD><TD VALIGN="TOP"><P>coverage</P></TD><TD VALIGN="TOP"><P>What type of information is contained in this table. </P></TD></TR></TBODY></TABLE>
<BR></P>The coverage field is divided into the following sub-fields, with sizes given in bits:</P>

<TABLE COLS="4" BORDER="1" CELLPADDING="7"><COLGROUP><COL WIDTH="106pt" VALIGN="TOP"><COL WIDTH="53pt" VALIGN="TOP"><COL WIDTH="52pt" VALIGN="TOP"><COL WIDTH="220pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>Sub-field</P></TD><TD VALIGN="TOP"><P>Bits #'s</P></TD><TD VALIGN="TOP"><P>Size</P></TD><TD VALIGN="TOP"><P>Description</P></TD></TR><TR><TD VALIGN="TOP"><P>horizontal</P></TD><TD VALIGN="TOP"><P>0</P></TD><TD VALIGN="TOP"><P>1</P></TD><TD VALIGN="TOP"><P>1 if table has horizontal data, 0 if vertical.</P></TD></TR><TR><TD VALIGN="TOP"><P>minimum</P></TD><TD VALIGN="TOP"><P>1</P></TD><TD VALIGN="TOP"><P>1</P></TD><TD VALIGN="TOP"><P>If this bit is set to 1, the table has minimum values. If set to 0, the table has kerning values.</P></TD></TR><TR><TD VALIGN="TOP"><P>cross-stream</P></TD><TD VALIGN="TOP"><P>2</P></TD><TD VALIGN="TOP"><P>1</P></TD><TD VALIGN="TOP"><P>If set to 1, kerning is perpendicular to the flow of the text. </P>
<P>If the text is normally written horizontally, kerning will be done in the up and down directions. If kerning values are positive, the text will be kerned upwards; if they are negative, the text will be kerned downwards.</P>
<P>If the text is normally written vertically, kerning will be done in the left and right directions. If kerning values are positive, the text will be kerned to the right; if they are negative, the text will be kerned to the left.</P>
<P>The value 0x8000 in the kerning data resets the cross-stream kerning back to 0.</P></TD></TR><TR><TD VALIGN="TOP"><P>override</P></TD><TD VALIGN="TOP"><P>3</P></TD><TD VALIGN="TOP"><P>1</P></TD><TD VALIGN="TOP"><P>If this bit is set to 1 the value in this table should replace the value currently being accumulated.</P></TD></TR><TR><TD VALIGN="TOP"><P>reserved1</P></TD><TD VALIGN="TOP"><P>4-7</P></TD><TD VALIGN="TOP"><P>4</P></TD><TD VALIGN="TOP"><P>Reserved. This should be set to zero.</P></TD></TR><TR><TD VALIGN="TOP"><P>format</P></TD><TD VALIGN="TOP"><P>8-15</P></TD><TD VALIGN="TOP"><P>8</P></TD><TD VALIGN="TOP"><P>Format of the subtable. Only formats 0 and 2 have been defined. Formats 1 and 3 through 255 are reserved for future use.</P></TD></TR></TBODY></TABLE>
<BR></P><H4><A NAME="sec0"></A>Format 0Format 0</H4>This is the only format that will be properly interpreted by Windows and OS/2.</P>
This subtable is a sorted list of kerning pairs and values. The list is preceded by information which makes it possible to make an efficient binary search of the list:</P>

<TABLE COLS="3" BORDER="1" CELLPADDING="7"><COLGROUP><COL WIDTH="106pt" VALIGN="TOP"><COL WIDTH="106pt" VALIGN="TOP"><COL WIDTH="220pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>Type</P></TD><TD VALIGN="TOP"><P>Field</P></TD><TD VALIGN="TOP"><P>Description</P></TD></TR><TR><TD VALIGN="TOP"><P>USHORT</P></TD><TD VALIGN="TOP"><P>nPairs</P></TD><TD VALIGN="TOP"><P>This gives the number of kerning pairs in the table.</P></TD></TR><TR><TD VALIGN="TOP"><P>USHORT</P></TD><TD VALIGN="TOP"><P>searchRange</P></TD><TD VALIGN="TOP"><P>The largest power of two less than or equal to the value of nPairs, multiplied by the size in bytes of an entry in the table.</P></TD></TR><TR><TD VALIGN="TOP"><P>USHORT</P></TD><TD VALIGN="TOP"><P>entrySelector</P></TD><TD VALIGN="TOP"><P>This is calculated as log2 of the largest power of two less than or equal to the value of nPairs. This value indicates how many iterations of the search loop will have to be made. (For example, in a list of eight items, there would have to be three iterations of the loop).</P></TD></TR><TR><TD VALIGN="TOP"><P>USHORT</P></TD><TD VALIGN="TOP"><P>rangeShift</P></TD><TD VALIGN="TOP"><P>The value of nPairs minus the largest power of two less than or equal to nPairs, and then multiplied by the size in bytes of an entry in the table.</P></TD></TR></TBODY></TABLE>
<BR></P>This is followed by the list of kerning pairs and values. Each has the following format:</P>

<TABLE COLS="3" BORDER="1" CELLPADDING="7"><COLGROUP><COL WIDTH="106pt" VALIGN="TOP"><COL WIDTH="71pt" VALIGN="TOP"><COL WIDTH="250pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>Type</P></TD><TD VALIGN="TOP"><P>Field</P></TD><TD VALIGN="TOP"><P>Description</P></TD></TR><TR><TD VALIGN="TOP"><P>USHORT</P></TD><TD VALIGN="TOP"><P>left</P></TD><TD VALIGN="TOP"><P>The glyph index for the left-hand glyph in the kerning pair.</P></TD></TR><TR><TD VALIGN="TOP"><P>USHORT</P></TD><TD VALIGN="TOP"><P>right</P></TD><TD VALIGN="TOP"><P>The glyph index for the right-hand glyph in the kerning pair.</P></TD></TR><TR><TD VALIGN="TOP"><P>FWORD</P></TD><TD VALIGN="TOP"><P>value</P></TD><TD VALIGN="TOP"><P>The kerning value for the above pair, in FUnits. If this value is greater than zero, the characters will be moved apart. If this value is less than zero, the character will be moved closer together.</P></TD></TR></TBODY></TABLE>
<BR></P>The left and right halves of the kerning pair make an unsigned 32-bit number, which is then used to order the kerning pairs numerically.</P>
A binary search is most efficiently coded if the search range is a power of two. The search range can be reduced by half by shifting instead of dividing. In general, the number of kerning pairs, nPairs, will not be a power of two. The value of the search range, searchRange, should be the largest power of two less than or equal to nPairs. The number of pairs not covered by searchRange (that is, nPairs – searchRange) is the value rangeShift. </P>
Windows v3.1 does not make use of the 'kern' data other than to expose it to applications through the GetFontData() API.</P>
<H4><A NAME="sec1"></A>Format 2Format 2</H4>This subtable is a two-dimensional array of kerning values. The glyphs are mapped to classes, using a different mapping for left- and right-hand glyphs. This allows glyphs that have similar right- or left-side shapes to be handled together. Each similar right- or left-hand shape is said to be single class.</P>
Each row in the kerning array represents one left-hand glyph class, each column represents one right-hand glyph class, and each cell contains a kerning value. Row and column 0 always represent glyphs that do not kern and contain all zeros. </P>
The values in the right class table are stored pre-multiplied by the number of bytes in a single kerning value, and the values in the left class table are stored pre-multiplied by the number of bytes in one row. This eliminates needing to multiply the row and column values together to determine the location of the kerning value. The array can be indexed by doing the right- and left-hand class mappings, adding the class values to the address of the array, and fetching the kerning value to which the new address points.</P>
The header for the simple array has the following format:</P>

<TABLE COLS="3" BORDER="1" CELLPADDING="7"><COLGROUP><COL WIDTH="80pt" VALIGN="TOP"><COL WIDTH="90pt" VALIGN="TOP"><COL WIDTH="254pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>Type</P></TD><TD VALIGN="TOP"><P>Field</P></TD><TD VALIGN="TOP"><P>Description</P></TD></TR><TR><TD VALIGN="TOP"><P>USHORT</P></TD><TD VALIGN="TOP"><P>rowWidth</P></TD><TD VALIGN="TOP"><P>The width, in bytes, of a row in the table.</P></TD></TR><TR><TD VALIGN="TOP"><P>USHORT</P></TD><TD VALIGN="TOP"><P>leftClassTable</P></TD><TD VALIGN="TOP"><P>Offset from beginning of this subtable to left-hand class table.</P></TD></TR><TR><TD VALIGN="TOP"><P>USHORT</P></TD><TD VALIGN="TOP"><P>rightClassTable</P></TD><TD VALIGN="TOP"><P>Offset from beginning of this subtable to right-hand class table.</P></TD></TR><TR><TD VALIGN="TOP"><P>USHORT</P></TD><TD VALIGN="TOP"><P>array</P></TD><TD VALIGN="TOP"><P>Offset from beginning of this subtable to the start of the kerning array.</P></TD></TR></TBODY></TABLE>
<BR></P>Each class table has the following header:</P>

<TABLE COLS="3" BORDER="1" CELLPADDING="7"><COLGROUP><COL WIDTH="80pt" VALIGN="TOP"><COL WIDTH="90pt" VALIGN="TOP"><COL WIDTH="254pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>Type</P></TD><TD VALIGN="TOP"><P>Field</P></TD><TD VALIGN="TOP"><P>Description</P></TD></TR><TR><TD VALIGN="TOP"><P>USHORT</P></TD><TD VALIGN="TOP"><P>firstGlyph</P></TD><TD VALIGN="TOP"><P>First glyph in class range.</P></TD></TR><TR><TD VALIGN="TOP"><P>USHORT</P></TD><TD VALIGN="TOP"><P>nGlyphs</P></TD><TD VALIGN="TOP"><P>Number of glyph in class range.</P></TD></TR></TBODY></TABLE>
<BR></P>This header is followed by nGlyphs number of class values, which are in USHORT format. Entries for glyphs that don't participate in kerning should point to the row or column at position zero.</P>
The array itself is a left by right array of kerning values, which are FWords, where left is the number of left-hand classes and R is the number of right-hand classes. The array is stored by row.</P>
Note that this format is the quickest to process since each lookup requires only a few index operations. The table can be quite large since it will contain the number of cells equal to the product of the number of right-hand classes and the number of left-hand classes, even though many of these classes do not kern with each other.</P></BODY></HTML>
