<HTML><HEAD><META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Shared Tables: ValueRecord, Anchor Table, and MarkArray</TITLE><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
</OBJECT></FORM>
<H2>Shared Tables: <BR>ValueRecord, Anchor Table, and MarkArray</H2>Several lookup subtables described earlier in this chapter refer to one or more of the same tables for positioning data: ValueRecord, Anchor table, and MarkArray. For easy reference, those shared tables are described here.</P>
Example 14 at the end of the chapter uses a ValueFormat table and ValueRecord to specify positioning values in GPOS.</P>
<H3><A NAME="sec0"></A>ValueRecord</H3>GPOS subtables use ValueRecords to describe all the variables and values used to adjust the position of a glyph or set of glyphs. A ValueRecord may define any combination of X and Y values (in design units) to add to (positive values) or subtract from (negative values) the placement and advance values provided in the font. A ValueRecord also may contain an offset to a Device table for each of the specified values. If a ValueRecord specifies more than one value, the values should be listed in the order shown in the ValueRecord definition.</P>
The text-processing client must be aware of the flexible and multi-dimensional nature of ValueRecords in the GPOS table. Because the GPOS table uses ValueRecords for many purposes, the sizes and contents of ValueRecords may vary from subtable to subtable. </P>
ValueRecord (all fields are optional)</P>

<TABLE COLS="3" BORDER="1" CELLPADDING="7"><COLGROUP><COL WIDTH="69pt" VALIGN="TOP"><COL WIDTH="121pt" VALIGN="TOP"><COL WIDTH="246pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>Type</P></TD><TD VALIGN="TOP"><P>Name</P></TD><TD VALIGN="TOP"><P>Description</P></TD></TR><TR><TD VALIGN="TOP"><P>int16</P></TD><TD VALIGN="TOP"><P>XPlacement</P></TD><TD VALIGN="TOP"><P>Horizontal adjustment for placement</P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>—in design units</P></TD></TR><TR><TD VALIGN="TOP"><P>int16</P></TD><TD VALIGN="TOP"><P>YPlacement</P></TD><TD VALIGN="TOP"><P>Vertical adjustment for placement</P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>—in design units</P></TD></TR><TR><TD VALIGN="TOP"><P>int16</P></TD><TD VALIGN="TOP"><P>XAdvance</P></TD><TD VALIGN="TOP"><P>Horizontal adjustment for advance</P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>—in design units</P></TD></TR><TR><TD VALIGN="TOP"><P>int16</P></TD><TD VALIGN="TOP"><P>YAdvance</P></TD><TD VALIGN="TOP"><P>Vertical adjustment for advance</P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>—in design units</P></TD></TR><TR><TD VALIGN="TOP"><P>Offset</P></TD><TD VALIGN="TOP"><P><SPAN CLASS="Symbol">Þ</SPAN> XPlaDevice</P></TD><TD VALIGN="TOP"><P>Offset to Device table for horizontal placement</P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>—measured from beginning of PosTable</P></TD></TR><TR><TD VALIGN="TOP"><P>Offset</P></TD><TD VALIGN="TOP"><P><SPAN CLASS="Symbol">Þ</SPAN> YPlaDevice</P></TD><TD VALIGN="TOP"><P>Offset to Device table for vertical placement</P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>—measured from beginning of PosTable</P></TD></TR><TR><TD VALIGN="TOP"><P>Offset</P></TD><TD VALIGN="TOP"><P><SPAN CLASS="Symbol">Þ</SPAN> XAdvDevice</P></TD><TD VALIGN="TOP"><P>Offset to Device table for horizontal advance</P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>—measured from beginning of PosTable</P></TD></TR><TR><TD VALIGN="TOP"><P>Offset</P></TD><TD VALIGN="TOP"><P><SPAN CLASS="Symbol">Þ</SPAN> YAdvDevice</P></TD><TD VALIGN="TOP"><P>Offset to Device table for vertical advance</P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>—measured from beginning of PosTable</P></TD></TR></TBODY></TABLE>
<BR></P>A data format (ValueFormat), usually declared at the beginning of each GPOS subtable, defines the types of positioning adjustment data that ValueRecords specify. Usually, the same ValueFormat applies to every ValueRecord defined in the particular GPOS subtable. </P>
The ValueFormat determines whether the ValueRecords:</P>
Apply to placement, advance, or both. </P>
Apply to the horizontal position (X coordinate), the vertical position (Y coordinate), or both. </P>
May refer to one or more Device tables for any of the specified values.</P>
Each one-bit in the ValueFormat corresponds to a field in the ValueRecord and increases the size of the ValueRecord by 2 bytes. A ValueFormat of 0x0000 corresponds to an empty ValueRecord, which indicates no positioning changes. </P>
To identify the fields in each ValueRecord, the ValueFormat uses the bit settings shown below. To specify multiple fields with a ValueFormat, the bit settings of the relevant fields are added with a logical OR operation.</P>
For example, to adjust the left-side bearing of a glyph, the ValueFormat will be 0x0001, and the ValueRecord will define the XPlacement value. To adjust the advance width of a different glyph, the ValueFormat will be 0x0004, and the ValueRecord will describe the XAdvance value. To adjust both the XPlacement and XAdvance of a set of glyphs, the ValueFormat will be 0x0005, and the ValueRecord will specify both values in the order they are listed in the ValueRecord definition.</P>
ValueFormat bit enumeration (indicates which fields are present)</P>

<TABLE COLS="3" BORDER="1" CELLPADDING="7"><COLGROUP><COL WIDTH="69pt" VALIGN="TOP"><COL WIDTH="121pt" VALIGN="TOP"><COL WIDTH="246pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>Mask</P></TD><TD VALIGN="TOP"><P>Name</P></TD><TD VALIGN="TOP"><P>Description</P></TD></TR><TR><TD VALIGN="TOP"><P>0x0001</P></TD><TD VALIGN="TOP"><P>XPlacement</P></TD><TD VALIGN="TOP"><P>Includes horizontal adjustment for placement</P></TD></TR><TR><TD VALIGN="TOP"><P>0x0002</P></TD><TD VALIGN="TOP"><P>YPlacement</P></TD><TD VALIGN="TOP"><P>Includes vertical adjustment for placement</P></TD></TR><TR><TD VALIGN="TOP"><P>0x0004</P></TD><TD VALIGN="TOP"><P>XAdvance</P></TD><TD VALIGN="TOP"><P>Includes horizontal adjustment for advance</P></TD></TR><TR><TD VALIGN="TOP"><P>0x0008</P></TD><TD VALIGN="TOP"><P>YAdvance</P></TD><TD VALIGN="TOP"><P>Includes vertical adjustment for advance</P></TD></TR><TR><TD VALIGN="TOP"><P>0x0010</P></TD><TD VALIGN="TOP"><P>XPlaDevice</P></TD><TD VALIGN="TOP"><P>Includes horizontal Device table for placement</P></TD></TR><TR><TD VALIGN="TOP"><P>0x0020</P></TD><TD VALIGN="TOP"><P>YPlaDevice</P></TD><TD VALIGN="TOP"><P>Includes vertical Device table for placement</P></TD></TR><TR><TD VALIGN="TOP"><P>0x0040</P></TD><TD VALIGN="TOP"><P>XAdvDevice</P></TD><TD VALIGN="TOP"><P>Includes horizontal Device table for advance</P></TD></TR><TR><TD VALIGN="TOP"><P>0x0080</P></TD><TD VALIGN="TOP"><P>YAdvDevice</P></TD><TD VALIGN="TOP"><P>Includes vertical Device table for advance</P></TD></TR><TR><TD VALIGN="TOP"><P>0xFF00</P></TD><TD VALIGN="TOP"><P>Reserved</P></TD><TD VALIGN="TOP"><P>For future use</P></TD></TR></TBODY></TABLE>
<BR></P><H3><A NAME="sec1"></A>Anchor Table</H3>A GPOS table uses anchor points to position one glyph with respect to another. Each glyph defines an anchor point, and the text-processing client attaches the glyphs by aligning their corresponding anchor points.</P>
To describe an anchor point, an Anchor table can use one of three formats. The first format uses design units to specify a location for the anchor point. The other two formats refine the location of the anchor point using contour points (Format 2) or Device tables (Format 3).</P>
<H4><A NAME="sec2"></A>Anchor Table: Format 1</H4>AnchorFormat1 consists of a format identifier (AnchorFormat) and a pair of design unit coordinates (XCoordinate and YCoordinate) that specify the location of the anchor point. This format has the benefits of small size and simplicity, but the anchor point cannot be hinted to adjust its position for different device resolutions.</P>
Example 15 at the end of this chapter uses AnchorFormat1.</P>
AnchorFormat1 table: Design units only</P>

<TABLE COLS="3" BORDER="1" CELLPADDING="7"><COLGROUP><COL WIDTH="69pt" VALIGN="TOP"><COL WIDTH="121pt" VALIGN="TOP"><COL WIDTH="246pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>Type</P></TD><TD VALIGN="TOP"><P>Name</P></TD><TD VALIGN="TOP"><P>Description</P></TD></TR><TR><TD VALIGN="TOP"><P>uint16</P></TD><TD VALIGN="TOP"><P>AnchorFormat</P></TD><TD VALIGN="TOP"><P>Format identifier </P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>—format = 1</P></TD></TR><TR><TD VALIGN="TOP"><P>int16</P></TD><TD VALIGN="TOP"><P>XCoordinate</P></TD><TD VALIGN="TOP"><P>Horizontal value </P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>—in design units</P></TD></TR><TR><TD VALIGN="TOP"><P>int16</P></TD><TD VALIGN="TOP"><P>YCoordinate</P></TD><TD VALIGN="TOP"><P>Vertical value</P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>—in design units</P></TD></TR></TBODY></TABLE>
<BR></P><H4><A NAME="sec3"></A>Anchor Table: Format 2</H4>Like AnchorFormat1, AnchorFormat2 specifies a format identifier (AnchorFormat) and a pair of design unit coordinates for the anchor point (Xcoordinate and Ycoordinate). </P>
For fine-tuning the location of the anchor point, AnchorFormat2 also provides an index to a glyph contour point (AnchorPoint) that is on the outline of a glyph (AnchorPoint). Hinting can be used to move the AnchorPoint. In the rendered text, the AnchorPoint will provide the final positioning data for a given ppem size.</P>
Example 16 at the end of this chapter uses AnchorFormat2.</P>
AnchorFormat2 table: Design units plus contour point</P>

<TABLE COLS="3" BORDER="1" CELLPADDING="7"><COLGROUP><COL WIDTH="69pt" VALIGN="TOP"><COL WIDTH="121pt" VALIGN="TOP"><COL WIDTH="246pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>Type</P></TD><TD VALIGN="TOP"><P>Name</P></TD><TD VALIGN="TOP"><P>Description</P></TD></TR><TR><TD VALIGN="TOP"><P>uint16</P></TD><TD VALIGN="TOP"><P>AnchorFormat</P></TD><TD VALIGN="TOP"><P>Format identifier</P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>—format = 2</P></TD></TR><TR><TD VALIGN="TOP"><P>int16</P></TD><TD VALIGN="TOP"><P>XCoordinate</P></TD><TD VALIGN="TOP"><P>Horizontal value </P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>—in design units</P></TD></TR><TR><TD VALIGN="TOP"><P>int16</P></TD><TD VALIGN="TOP"><P>YCoordinate</P></TD><TD VALIGN="TOP"><P>Vertical value</P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>—in design units</P></TD></TR><TR><TD VALIGN="TOP"><P>uint16</P></TD><TD VALIGN="TOP"><P>AnchorPoint</P></TD><TD VALIGN="TOP"><P>Index to glyph contour point</P></TD></TR></TBODY></TABLE>
<BR></P><H4><A NAME="sec4"></A>Anchor Table: Format 3</H4>Like AnchorFormat1, AnchorFormat3 specifies a format identifier (AnchorFormat) and locates an anchor point (Xcoordinate and Ycoordinate). And, like AnchorFormat 2, it permits fine adjustments to the coordinate values. However, AnchorFormat3 uses Device tables, rather than a contour point, for this adjustment. </P>
With a Device table, a client can adjust the position of the anchor point for any font size and device resolution. AnchorFormat3 can specify offsets to Device tables for the the X coordinate (XDeviceTable) and the Y coordinate (YDeviceTable). If only one coordinate requires adjustment, the offset to the Device table may be set to NULL for the other coordinate.</P>
Example 17 at the end of the chapter shows an AnchorFormat3 table.</P>
AnchorFormat3 table: Design units plus Device tables</P>

<TABLE COLS="3" BORDER="1" CELLPADDING="7"><COLGROUP><COL WIDTH="69pt" VALIGN="TOP"><COL WIDTH="121pt" VALIGN="TOP"><COL WIDTH="246pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>Type</P></TD><TD VALIGN="TOP"><P>Name</P></TD><TD VALIGN="TOP"><P>Description</P></TD></TR><TR><TD VALIGN="TOP"><P>uint16</P></TD><TD VALIGN="TOP"><P>AnchorFormat</P></TD><TD VALIGN="TOP"><P>Format identifier</P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>—format = 3</P></TD></TR><TR><TD VALIGN="TOP"><P>int16</P></TD><TD VALIGN="TOP"><P>XCoordinate</P></TD><TD VALIGN="TOP"><P>Horizontal value </P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>—in design units</P></TD></TR><TR><TD VALIGN="TOP"><P>int16</P></TD><TD VALIGN="TOP"><P>YCoordinate</P></TD><TD VALIGN="TOP"><P>Vertical value</P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>—in design units</P></TD></TR><TR><TD VALIGN="TOP"><P>Offset</P></TD><TD VALIGN="TOP"><P><SPAN CLASS="Symbol">Þ</SPAN> XDeviceTable</P></TD><TD VALIGN="TOP"><P>Offset to Device table for X coordinate</P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>—from beginning of Anchor table</P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>— may be NULL</P></TD></TR><TR><TD VALIGN="TOP"><P>Offset</P></TD><TD VALIGN="TOP"><P><SPAN CLASS="Symbol">Þ</SPAN> YDeviceTable</P></TD><TD VALIGN="TOP"><P>Offset to Device table for Y coordinate</P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>— from beginning of Anchor table</P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>— may be NULL</P></TD></TR></TBODY></TABLE>
<BR></P><H3><A NAME="sec5"></A>Mark Array</H3>The MarkArray table defines the class and the anchor point for a mark glyph. Three GPOS subtables—MarkToBase, MarkToLigature, and MarkToMark Attachment—use the MarkArray table to specify data for attaching marks.</P>
The MarkArray table contains a count of the number of mark records (MarkCount) and an array of those records (MarkRecord). Each mark record defines the class of the mark and an offset to the Anchor table that contains data for the mark. </P>
A class value can be 0 (zero), but the MarkRecord must explicitly assign that class value (this differs from the ClassDef table, in which all glyphs not assigned class values automatically belong to Class 0). The GPOS subtables that refer to MarkArray tables use the class assignments for indexing zero-based arrays that contain data for each mark class.</P>
In Example 18 at the end of the chapter, a MarkArray table and two MarkRecords define two mark classes.</P>
MarkArray table</P>

<TABLE COLS="3" BORDER="1" CELLPADDING="7"><COLGROUP><COL WIDTH="69pt" VALIGN="TOP"><COL WIDTH="121pt" VALIGN="TOP"><COL WIDTH="246pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>Type</P></TD><TD VALIGN="TOP"><P>Name</P></TD><TD VALIGN="TOP"><P>Description</P></TD></TR><TR><TD VALIGN="TOP"><P>uint16</P></TD><TD VALIGN="TOP"><P>MarkCount</P></TD><TD VALIGN="TOP"><P>Number of MarkRecords</P></TD></TR><TR><TD VALIGN="TOP"><P>struct</P></TD><TD VALIGN="TOP"><P>MarkRecord[MarkCount]</P></TD><TD VALIGN="TOP"><P>Array of MarkRecords </P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>—in Coverage order</P></TD></TR></TBODY></TABLE>
<BR></P>MarkRecord</P>

<TABLE COLS="3" BORDER="1" CELLPADDING="7"><COLGROUP><COL WIDTH="69pt" VALIGN="TOP"><COL WIDTH="121pt" VALIGN="TOP"><COL WIDTH="246pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>Type</P></TD><TD VALIGN="TOP"><P>Name</P></TD><TD VALIGN="TOP"><P>Description</P></TD></TR><TR><TD VALIGN="TOP"><P>uint16</P></TD><TD VALIGN="TOP"><P>Class</P></TD><TD VALIGN="TOP"><P>Class defined for this mark</P></TD></TR><TR><TD VALIGN="TOP"><P>Offset</P></TD><TD VALIGN="TOP"><P><SPAN CLASS="Symbol">Þ</SPAN> MarkAnchor</P></TD><TD VALIGN="TOP"><P>Offset to Anchor table </P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>—from beginning of MarkArray table</P></TD></TR></TBODY></TABLE>
<BR></P></BODY></HTML>
