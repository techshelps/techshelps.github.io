<HTML><HEAD><META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>2.4.1.10  Inbound Call Notification</TITLE><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">

</OBJECT></FORM>
<H3>2.4.1.10  Inbound Call Notification</H3>After the TAPI DLL has opened a line device registering a media mode it can be notified when a call arrives.  The Service Provider informs the TAPI DLL of a new incoming call via the <B>LINE_NEWCALL</B> callback message.  This message passes the Service Provider's handle for the call to the TAPI DLL.  The TAPI DLL returns its handle for the call.  The Service Provider follows this with a <B>LINE_CALLSTATE</B> callback message.  For an unanswered inbound call, the call state will be <I>offering</I>. The TAPI DLL can then invoke <B>TSPI_lineGetCallInfo</B> to find out information about the call. The fact that a call is offered may not necessarily imply the user is being alerted. A separate <B>LINE_LINEDEVSTATE</B> callback is made with a <I>ringing</I> indication to provide this information to the TAPI DLL. </P>
Call information includes (among other things):</P>
<SPAN CLASS="list"><UL><LI><B>    bearer mode, rate</B>  -  This is the bearer mode (voice, data) and data rate (in bps) of the call.</LI><LI><B>    media mode</B>  -  The current media mode of the call. <I>Unknown</I> if this information is unknown.</LI><LI><B>    call origin </B> -  Indicates whether the call originated from an internal caller, an external caller, or unknown.</LI><LI><B>    reason for the call </B> -  Describes "why" the call is occurring. Possible reasons are: direct call, transferred from another number, busy-forwarded from another number, unconditionally forwarded from another number, the call was picked up from another number, a call completion request, or a callback reminder. <I>Unknown</I> if this information is not known. </LI><LI><B>    caller-ID</B>  -  Identifies the originating party of the call. This can be in a variety of (name or number) formats, determined by what the switch or network provides.</LI><LI><B>    called-ID</B>  -  Identifies the party originally dialed by the caller.</LI><LI><B>    connected-ID</B>  -  Identifies the party that is actually connected to. This may be different from the called party if the call was diverted.</LI><LI><B>    redirection-ID</B>  -  Identifies to the caller the number towards which diversion was invoked.</LI><LI><B>    redirecting-ID</B>  -  Identifies to the diverted-to user the party from which diversion was invoked.</LI><LI><B>    user-to-user information</B>  -  User-to-user information sent by the remote station (ISDN).
Note that depending on the telephony environment, not all information about a call may be available at the time the call is initially offered. For example, if caller ID is provided by the network between the first and second ring, caller-ID will be unknown at the time the call is first offered. When it becomes known shortly thereafter, a <B>LINE_CALLINFO</B> callback message will notify the TAPI DLL about the change in party ID information of the call.</P>

If a new call arrives while another call already exists on the line or address, then similar notification and call information is supplied following the same mechanism as for any incoming call. If an app does not want any interference for a call from the switch or phone network, then it should secure the call. Securing a call can be done at the time the call is made via a parameter to <B>TSPI_lineMakeCall</B>, or later on when the call already exists via <B>TSPI_lineSecureCall</B>. The call will be secure until the call is disconnected. Securing a call may be useful for example when it is feared that certain network tones (e.g., call waiting) could destroy a call's media stream (e.g., fax). </P></LI></UL></SPAN>TSPI_lineSecureCall</P>
Secures an existing call from interference by other events.  </P></BODY></HTML>
