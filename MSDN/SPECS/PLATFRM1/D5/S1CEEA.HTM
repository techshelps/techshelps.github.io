<HTML><HEAD><META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>A.4 AT&amp;D3 Implementation Issues</TITLE><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">

</OBJECT></FORM>
<H2>A.4 AT&amp;D3 Implementation Issues</H2>  </P>
The AT&amp;D3 command presents special problems for Plug and Play COM enumeration.</P>
In many implementations, the hardware DTR lead is logically wired to the reset pin on the modem control processor.  In this case, the modem will be reset on either the level (DTR=0) or on an edge (depending on implementation).  </P>
The useful effect is that this modem can be hard reset under PC software control.  The adverse effect is that the modem controller may not be able to recover from a hard reset fast enough to respond to the enumerator, or to assert DSR if a reset clears it, and the enumerator will miss it.</P>
There are at least two alternative implementations of &amp;D3 that can function with the PNP COM enumerator, but they require redesign of the modem controller firmware.  These are:</P>
<SPAN CLASS="list"><UL><LI>Firmware-only implementation of &amp;D3</LI><LI>Hybrid implementation of &amp;D3 (software ON-Hook, hardware OFF-Hook)</LI></UL></SPAN>Modem controller firmware:  (Some implementations already work this way.)  If possible, this would allow the modem controller to be sufficiently initiallized to be functional when the COM enumerator begins toggling DTR.  Also, this would mean that DSR wasn't automatically dropped if DTR dropped.  The disadvantage is that the useful feature of &amp;D3 would be lost, and a modem in controller firmware failure could not be reset without operator intervention.</P>
Hybrid implementation: while ON-Hook, the modem would implement &amp;D3 in firmware; while OFF-Hook, the modem would implement &amp;D3 in hardware.  This modem should also initialize DSR=1 within 200ms, and initialize to a software &amp;D3 response.  This would remove the capability for PC controlled hard reset while the modem is in a stable state (On-hook, idle) but retain the PC-controlled reset capability while the modem is in a vulnerable state (Off-hook, carrier on, data carrier active, possible error control and data compression engines running).  Note that if the modem is Off-hook, the com port will be closed except in system failure modes, and the enumerator will not disturb the modem (see 2.1.1).</P>
Note that a modem in recovery from a hard reset initiated while off-hook could still recognize the enumerator from the details of DTR-RTS on and off timing, and respond to the 2nd phase.</P>
 </P></BODY></HTML>
