<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<META HTTP-EQUIV="Content-Type" Content="text-html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>6.5.1 Fixup Block</title>
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY BGCOLOR=#FFFFFF TEXT=#000000>

<FONT FACE="verdana, Arial, Helvetica" SIZE="2">

<h1><a name="6.5.1fixupblock"></a>6.5.1 Fixup Block</h1>
<p>
Each fixup block starts with the following structure:</p>
<table border=1 cols=4 frame=box rules=all>
<tr valign=top>
<TD width=69pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2"><b>Offset</b></td>
<TD width=40pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2"><b>Size</b></td>
<TD width=117pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2"><b>Field</b></td>
<TD width=212pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2"><b>Description</b></td>
</tr>
<tr valign=top>
<TD width=69pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">0</td>
<TD width=40pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">4</td>
<TD width=117pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">Page RVA</td>
<TD width=212pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">The image base plus the page RVA is added to each offset to create the virtual address of where the fixup needs to be applied.</td>
</tr>
<tr valign=top>
<TD width=69pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">4</td>
<TD width=40pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">4</td>
<TD width=117pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">Block Size</td>
<TD width=212pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">Total number of bytes in the fixup block, including the Page RVA and Block Size fields, as well as the Type/Offset fields that follow.</td>
</tr>
</table><br>
<p>
The Block Size field is then followed by any number of Type/Offset entries. Each entry is a word (2 bytes) and has the following structure:</p>
<table border=1 cols=4 frame=box rules=all>
<tr valign=top>
<TD width=69pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2"><b>Offset</b></td>
<TD width=40pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2"><b>Size</b></td>
<TD width=117pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2"><b>Field</b></td>
<TD width=212pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2"><b>Description</b></td>
</tr>
<tr valign=top>
<TD width=69pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">0</td>
<TD width=40pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">4 bits</td>
<TD width=117pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">Type</td>
<TD width=212pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">Stored in high 4 bits of word. Value indicating which type of fixup is to be applied. These fixups are described in &quot;Fixup Types.&quot;</td>
</tr>
<tr valign=top>
<TD width=69pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">0</td>
<TD width=40pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">12 bits</td>
<TD width=117pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">Offset</td>
<TD width=212pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">Stored in remaining 12 bits of word. Offset from starting address specified in the Page RVA field for the block. This offset specifies where the fixup is to be applied.</td>
</tr>
</table><br>

<p>
To apply a fixup, a delta is calculated as the difference between the preferred base address, and the base where the image is actually loaded. If the image is loaded at its preferred base, the delta would be zero, and thus the fixups would not have to be applied.</p>

</BODY>
</HTML>
