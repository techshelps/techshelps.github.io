<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<META HTTP-EQUIV="Content-Type" Content="text-html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>5.3 COFF Line Numbers</title>
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY BGCOLOR=#FFFFFF TEXT=#000000>


<FONT FACE="verdana, Arial, Helvetica" SIZE="2">

<h1><a name="5.3cofflinenumbers"></a>5.3 COFF Line Numbers</h1>
<p>
COFF line numbers indicate the relationship between code and line-numbers in source files. The Microsoft format for COFF line numbers is similar to standard COFF, but it has been extended to allow a single section to relate to line numbers in multiple source files.</p>
<p>
COFF line numbers consist of an array of fixed-length records. The location (file offset) and size of the array are specified in the section header. Each line-number record is of the following format:</p>
<table border=1 cols=4 frame=box rules=all>
<tr valign=top>
<TD width=51pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2"><b>Offset</b></td>
<TD width=40pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2"><b>Size</b></td>
<TD width=117pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2"><b>Field</b></td>
<TD width=238pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2"><b>Description</b></td>
</tr>
<tr valign=top>
<TD width=51pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">0</td>
<TD width=40pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">4</td>
<TD width=117pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">Type (*)</td>
<TD width=238pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">Union of two fields: Symbol Table Index and RVA. Whether Symbol Table Index or RVA is used depends on the value of Linenumber.</td>
</tr>
<tr valign=top>
<TD width=51pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">4</td>
<TD width=40pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">2</td>
<TD width=117pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">Linenumber</td>
<TD width=238pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">When nonzero, this field specifies a one-based line number. When zero, the Type field is interpreted as a Symbol Table Index for a function.</td>
</tr>
</table><br>

<p>
The Type field is a union of two four-byte fields, Symbol Table Index, and RVA:</p>
<table border=1 cols=4 frame=box rules=all>
<tr valign=top>
<TD width=51pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2"><b>Offset</b></td>
<TD width=40pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2"><b>Size</b></td>
<TD width=117pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2"><b>Field</b></td>
<TD width=238pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2"><b>Description</b></td>
</tr>
<tr valign=top>
<TD width=51pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">0</td>
<TD width=40pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">4</td>
<TD width=117pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">SymbolTableIndex</td>
<TD width=238pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">Used when Linenumber is 0: index to symbol table entry for a function. This format is used to indicate the function that a group of line-number records refer to.</td>
</tr>
<tr valign=top>
<TD width=51pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">0</td>
<TD width=40pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">4</td>
<TD width=117pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">VirtualAddress</td>
<TD width=238pt><FONT FACE="verdana, Arial, Helvetica" SIZE="2">Used when Linenumber is non-zero: relative virtual address of the executable code that corresponds to the source line indicated.  In an object file, this contains the virtual address within the section.</td>
</tr>
</table><br>

<p>
A line-number record, then, can either set the Linenumber field to 0 and point to a function definition in the Symbol Table, or else it can work as a standard line-number entry by giving a positive integer (line number) and the corresponding address in the object code.</p>
<p>
A group of line-number entries always begins with the first format: the index of a function symbol. If this is the first line-number record in the section, then it is also the COMDAT symbol name for the function if the section&#39;s COMDAT flag is set. (See Section 5.5.6, &quot;COMDAT Sections.&quot;) The function&#39;s auxiliary record in the Symbol Table has a Pointer to Linenumbers field that points to this same line-number record.</p>
<p>
A record identifying a function is followed by any number of line-number entries that give actual line-number information (Linenumber greater than zero). These entries are one-based, relative to the beginning of the function, and represent every source line in the function except for the first one.</p>
<p>
For example, the first line-number record for the following example would specify the ReverseSign function (Symbol Table Index of ReverseSign, Linenumber set to 0). Then records with Linenumber values of 1, 2, and 3 would follow, corresponding to source lines as shown:</p>
<pre><code>// some code precedes ReverseSign function
intReverseSign(int i)
1:{
2:return -1 * i;
3:}
</code></pre>

</BODY>
</HTML>
