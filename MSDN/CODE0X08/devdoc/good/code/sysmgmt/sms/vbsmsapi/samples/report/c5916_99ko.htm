<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PICKMACH.FRM</title>
<link disabled rel=stylesheet href=../../../../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>
<h2><a name="_code_context5928"></a>PICKMACH.FRM</h2>
<pre><code>VERSION 4.00 <br>Begin VB.Form frmPickMachineGroups  <br>   Appearance      =   0  'Flat <br>   BorderStyle     =   3  'Fixed Dialog <br>   Caption         =   "Pick Machine Group for Report" <br>   ClientHeight    =   4125 <br>   ClientLeft      =   1740 <br>   ClientTop       =   4650 <br>   ClientWidth     =   5115 <br>   BeginProperty Font  <br>      name            =   "MS Sans Serif" <br>      charset         =   1 <br>      weight          =   700 <br>      size            =   8.25 <br>      underline       =   0   'False <br>      italic          =   0   'False <br>      strikethrough   =   0   'False <br>   EndProperty <br>   ForeColor       =   &amp;H80000008&amp; <br>   Height          =   4530 <br>   Left            =   1680 <br>   LinkTopic       =   "Form1" <br>   MaxButton       =   0   'False <br>   MinButton       =   0   'False <br>   ScaleHeight     =   4125 <br>   ScaleWidth      =   5115 <br>   Top             =   4305 <br>   Width           =   5235 <br>   Begin VB.CommandButton cmdOk  <br>      Appearance      =   0  'Flat <br>      Caption         =   "OK" <br>      Default         =   -1  'True <br>      Height          =   375 <br>      Left            =   3900 <br>      TabIndex        =   5 <br>      Top             =   120 <br>      Width           =   1095 <br>   End <br>   Begin VB.CommandButton cmdCancel  <br>      Appearance      =   0  'Flat <br>      Cancel          =   -1  'True <br>      Caption         =   "Cancel" <br>      Height          =   375 <br>      Left            =   3900 <br>      TabIndex        =   4 <br>      Top             =   540 <br>      Width           =   1095 <br>   End <br>   Begin Threed.SSPanel pnlOutlineBackdrop  <br>      Height          =   3870 <br>      Left            =   120 <br>      TabIndex        =   0 <br>      Top             =   120 <br>      Width           =   3615 <br>      _Version        =   65536 <br>      _ExtentX        =   6376 <br>      _ExtentY        =   6826 <br>      _StockProps     =   15 <br>      Begin Threed.SSPanel pnlSrceFrame  <br>         Height          =   3390 <br>         Left            =   240 <br>         TabIndex        =   1 <br>         Top             =   360 <br>         Width           =   3255 <br>         _Version        =   65536 <br>         _ExtentX        =   5741 <br>         _ExtentY        =   5980 <br>         _StockProps     =   15 <br>         BevelOuter      =   1 <br>         Autosize        =   3 <br>         Begin MSOutl.Outline olnData  <br>            Height          =   3360 <br>            Left            =   15 <br>            TabIndex        =   2 <br>            Top             =   15 <br>            Width           =   3225 <br>            _Version        =   65536 <br>            _ExtentX        =   5689 <br>            _ExtentY        =   5927 <br>            _StockProps     =   77 <br>            BackColor       =   -2147483643 <br>            Style           =   1 <br>         End <br>      End <br>      Begin VB.Label Label1  <br>         Appearance      =   0  'Flat <br>         AutoSize        =   -1  'True <br>         Caption         =   "&amp;Report on machines in:" <br>         ForeColor       =   &amp;H80000008&amp; <br>         Height          =   195 <br>         Left            =   240 <br>         TabIndex        =   3 <br>         Top             =   120 <br>         Width           =   1980 <br>      End <br>   End <br>End <br>Attribute VB_Name = "frmPickMachineGroups" <br>Attribute VB_Creatable = False <br>Attribute VB_Exposed = False <br>Option Explicit <br> <br>'//**************************************************************************** <br>'// <br>'//  Copyright (c) 1995, Microsoft Corporation <br>'// <br>'//  File:  PICKMACH.FRM <br>'// <br>'//  History: <br>'// <br>'//      Gary Fuehrer, SEA   5/9/95      Created. <br>'// <br>'//**************************************************************************** <br> <br>Dim OldMousePointer% <br>Dim CallingForm As Form <br> <br>Dim hConnect&amp; <br>Dim db As Database <br> <br>'State flags <br>Dim bGetMachineGroupData%  'If True, getting machine group data from SMS. <br>Dim MachineGroupID$() <br> <br>'Some relavent names for the outline control pictures <br>Const MSOUTLINE_PICTURE_GROUP = MSOUTLINE_PICTURE_CLOSED <br>Const MSOUTLINE_PICTURE_MACHINE = MSOUTLINE_PICTURE_OPEN <br> <br>Private Sub cmdCancel_Click() <br>    Unload Me <br>End Sub <br> <br>Private Sub cmdOk_Click() <br>    If olnData.ListIndex &gt;= 0 Then <br>        'Return list of group selected <br>        MachineGroupPicked$ = MachineGroupID$(olnData.ItemData(olnData.ListIndex)) <br> <br>        'Set to login success <br>        PickMachineGroupsUserCanceled% = False <br>    End If <br> <br>    Unload Me <br>End Sub <br> <br>Private Sub Form_Activate() <br>    bGetMachineGroupData% = True <br>    GetMachineGroups <br>    If bGetMachineGroupData% Then <br>        bGetMachineGroupData% = False <br>    Else: Unload Me <br>    End If <br>End Sub <br> <br>Private Sub Form_Load() <br>    Dim NewLeft%, NewTop% <br>     <br>    'Save the old mouse pointer <br>    Set CallingForm = Screen.ActiveForm <br>    OldMousePointer% = CallingForm.MousePointer <br>     <br>    'Turn on normal pointer <br>    MousePointer = NORMAL <br>     <br>    'Center form on calling form <br>    NewLeft% = CallingForm.left + (CallingForm.Width - Width) / 2 <br>    If NewLeft% + Width &gt; Screen.Width Then NewLeft% = Screen.Width - Width <br>    If NewLeft% &lt; 0 Then NewLeft% = 0 <br>    NewTop% = CallingForm.top + (CallingForm.Height - Height) / 2 <br>    If NewTop% + Height &gt; Screen.Height Then NewTop% = Screen.Height - Height <br>    If NewTop% &lt; 0 Then NewTop% = 0 <br>    left = NewLeft% <br>    top = NewTop% <br> <br>    'Copy parameters locally <br>    hConnect&amp; = PickMachineGroupshConnect&amp; <br>    Set db = PickMachineGroupsDB <br> <br>    'Set default to be user canceled <br>    PickMachineGroupsUserCanceled% = True <br>End Sub <br> <br>Private Sub Form_QueryUnload(Cancel As Integer, UnloadMode As Integer) <br>    If bGetMachineGroupData% Then <br>        bGetMachineGroupData% = False <br>        Cancel = True <br>        Exit Sub <br>    End If <br>End Sub <br> <br>Private Sub Form_Unload(Cancel As Integer) <br>    'Replace mouse pointer <br>    CallingForm.MousePointer = OldMousePointer% <br>End Sub <br> <br>Private Sub GetMachineGroups() <br>    Dim hContainer&amp;, hSubFolder&amp;, FolderType&amp;, TypeName$ <br>    Dim sScalar As SCALAR, GroupID$, GroupName$ <br>    Dim lRet&amp;, Resp%, ListIndex% <br> <br>    'Reset list index <br>    ListIndex% = 0 <br>    ReDim MachineGroupID$(0 To 0) <br> <br>    lRet&amp; = SmsOpenContainer&amp;(C_MACHINEGROUP, hConnect&amp;, hContainer&amp;) <br>    If lRet&amp; &lt;&gt; SMS_OK Then <br>        MsgBox "SMS Error:" + Chr$(10) + Chr$(10) + SMSError$(lRet&amp;), MB_ICONEXCLAMATION + MB_OK, Caption <br>        Exit Sub <br>    End If <br> <br>    lRet&amp; = SmsPopulate&amp;(hContainer&amp;, POP_SYNC, ByVal 0&amp;) <br>    If lRet&amp; &lt;&gt; SMS_OK And lRet&amp; &lt;&gt; SMS_EMPTY Then <br>        MsgBox "SMS Error:" + Chr$(10) + Chr$(10) + SMSError$(lRet&amp;), MB_ICONEXCLAMATION + MB_OK, Caption <br>        GoTo GetMachineGroupsCleanup <br>    End If <br> <br>    'List the machine groups in this container <br>    Resp% = IDOK <br>    lRet&amp; = SmsGetNextFolder&amp;(hContainer&amp;, F_ANY, hSubFolder&amp;) <br>    Do While lRet&amp; = SMS_OK <br>        'Get this folder's type (expect Machine Group) <br>        lRet&amp; = SmsGetFolderType&amp;(hSubFolder&amp;, FolderType&amp;, TypeName$) <br>        If lRet&amp; &lt;&gt; SMS_OK Or TypeName &lt;&gt; "Machine Group" Then <br>            If lRet&amp; &lt;&gt; SMS_OK Then Resp% = MsgBox("SMS Error:" + Chr$(10) + Chr$(10) + SMSError$(lRet&amp;), MB_ICONEXCLAMATION + MB_ABORTRETRYIGNORE, Caption) <br>            GoTo GetMachineGroupsCont <br>        End If <br> <br>        'Get this folder's ID <br>        lRet&amp; = SmsGetFolderID&amp;(hSubFolder&amp;, GroupID$) <br>        If lRet&amp; &lt;&gt; SMS_OK Then <br>            Resp% = MsgBox("SMS Error:" + Chr$(10) + Chr$(10) + SMSError$(lRet&amp;), MB_ICONEXCLAMATION + MB_ABORTRETRYIGNORE, Caption) <br>            GoTo GetMachineGroupsCont <br>        End If <br> <br>        'Get this group's name <br>        lRet&amp; = SmsGetScalarByName&amp;(hSubFolder&amp;, "Name", sScalar) <br>        If lRet&amp; &lt;&gt; SMS_OK Then <br>            Resp% = MsgBox("SMS Error:" + Chr$(10) + Chr$(10) + SMSError$(lRet&amp;), MB_ICONEXCLAMATION + MB_ABORTRETRYIGNORE, Caption) <br>            GoTo GetMachineGroupsCont <br>        End If <br>        GroupName$ = sScalar.pszValue <br> <br>        DoEvents <br> <br>        'Check to see if the user wants to cancel <br>        If bGetMachineGroupData% Then <br>            'Add item to outline control and array <br>            olnData.AddItem GroupName$, ListIndex% <br>            olnData.Indent(ListIndex%) = 1 <br>            olnData.PictureType(ListIndex%) = MSOUTLINE_PICTURE_GROUP <br>            olnData.ItemData(ListIndex%) = ListIndex% <br> <br>            'Add GroupID to the array <br>            If ListIndex% &gt;= UBound(MachineGroupID$, 1) Then ReDim Preserve MachineGroupID$(0 To ListIndex% + 32) <br>            MachineGroupID$(ListIndex%) = GroupID$ <br> <br>            ListIndex% = ListIndex% + 1 <br>            Resp% = IDOK <br>        Else: Resp% = IDABORT <br>        End If <br> <br>GetMachineGroupsCont: <br>        'Check the user response <br>        Select Case Resp% <br>            Case IDOK, IDIGNORE <br>                lRet&amp; = SmsCloseFolder&amp;(hSubFolder&amp;) <br>                lRet&amp; = SmsGetNextFolder&amp;(hContainer&amp;, F_ANY, hSubFolder&amp;) <br>                Resp% = IDOK <br>            Case IDABORT <br>                lRet&amp; = SmsCloseFolder&amp;(hSubFolder&amp;) <br>                lRet&amp; = SMS_NO_MORE_DATA <br>            Case IDRETRY <br>                lRet&amp; = SMS_OK <br>        End Select <br>    Loop <br>    If lRet&amp; &lt;&gt; SMS_NO_MORE_DATA Then <br>        MsgBox "SMS Error:" + Chr$(10) + Chr$(10) + SMSError$(lRet&amp;), MB_ICONEXCLAMATION + MB_OK, Caption <br>    End If <br>         <br>GetMachineGroupsCleanup: <br>    lRet&amp; = SmsCloseContainer&amp;(hContainer&amp;) <br>End Sub <br> <br>Private Sub olnData_DblClick() <br>    cmdOk_Click <br>End Sub <br> </code></pre>
<p>&nbsp;</p></body>
</HTML>
