<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>SCRNSAVE.H</title>
<link disabled rel=stylesheet href=../../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>
<h2><a name="_code_context5949"></a>SCRNSAVE.H</h2>
<pre><code>#include "miginf.h" <br> <br>// <br>// utils.c -- reusable utilities (unrelated to screen saver code) <br>// <br> <br>VOID <br>LogRegistryError ( <br>    IN      HKEY Key, <br>    IN      LPCSTR ValueName <br>    ); <br> <br>HKEY <br>OpenRegKey ( <br>    IN      HKEY RootKey, <br>    IN      LPCSTR Key <br>    ); <br> <br>HKEY <br>CreateRegKey ( <br>    IN      HKEY RootKey, <br>    IN      LPCSTR Key <br>    ); <br> <br>VOID <br>CloseRegKey ( <br>    IN      HKEY Key <br>    ); <br> <br>LPCSTR <br>GetRegValueString ( <br>    IN      HKEY Key, <br>    IN      LPCSTR ValueName <br>    ); <br> <br>BOOL <br>SetRegValueString ( <br>    HKEY Key, <br>    LPCSTR ValueName, <br>    LPCSTR ValueStr <br>    ); <br> <br>DWORD <br>CountStringBytes ( <br>    IN      LPCSTR str <br>    ); <br> <br>DWORD <br>CountMultiStringBytes ( <br>    IN      LPCSTR str <br>    ); <br> <br>LPSTR <br>CopyStringAtoB ( <br>    OUT     LPSTR mbstrDest,  <br>    IN      LPCSTR mbstrStart,  <br>    IN      LPCSTR mbstrEnd     // ptr to the first char NOT to copy <br>    ); <br> <br>BOOL <br>OurGetLongPathName ( <br>    LPCSTR ShortPath, <br>    LPSTR Buffer <br>    ); <br> <br>VOID <br>ConvertSystemToSystem32 ( <br>    IN OUT  LPSTR Filename <br>    ); <br> <br>// <br>// utils.c -- helper functions specific to screen saver settings <br>// <br> <br>VOID <br>GenerateFilePaths ( <br>    VOID <br>    ); <br> <br>LPCSTR <br>GetScrnSaveExe ( <br>    VOID <br>    ); <br> <br>BOOL <br>CreateScreenSaverParamKey ( <br>    IN      LPCSTR ScreenSaverName, <br>    IN      LPCSTR Value, <br>    OUT     LPSTR Buffer <br>    ); <br> <br>BOOL <br>DecodeScreenSaverParamKey ( <br>    IN      LPCSTR EncodedString, <br>    OUT     LPSTR ScreenSaverName, <br>    OUT     LPSTR ValueName <br>    ); <br> <br> <br>// <br>// savecfg.c -- functions that save things to our working directory <br>// <br> <br>BOOL <br>SaveDatFileKeyAndVal ( <br>    IN      LPCSTR Key, <br>    IN      LPCSTR Val <br>    ); <br> <br>BOOL <br>CopyRegValueToDatFile ( <br>    IN      HKEY RegKey, <br>    IN      LPCSTR ValueName <br>    ); <br> <br>BOOL <br>SaveControlIniSection ( <br>    LPCSTR ControlIniSection, <br>    LPCSTR ScreenSaverName <br>    ); <br> <br> <br>// <br>// dataconv.c -- functions that convert Win9x settings &amp; save them on NT <br>// <br> <br>BOOL <br>CopyValuesFromDatFileToRegistry ( <br>    IN      HKEY RegKey, <br>    IN      LPCSTR RegKeyName, <br>    IN      LPCSTR ScreenSaverName, <br>    IN      LPCSTR ValueArray[] <br>    ); <br> <br>LPCSTR <br>GetSettingsFileVal ( <br>    IN      LPCSTR Key <br>    ); <br> <br>BOOL <br>TranslateGeneralSetting ( <br>    IN      HKEY RegKey, <br>    IN      LPCSTR Win9xSetting, <br>    IN      LPCSTR WinNTSetting <br>    ); <br> <br>BOOL <br>SaveScrName ( <br>    IN      HKEY RegKey,  <br>    IN      LPCSTR KeyName <br>    ); <br> <br>BOOL <br>TranslateScreenSavers ( <br>    IN      HKEY RegRoot <br>    ); <br> <br>BOOL <br>CopyUntranslatedSettings ( <br>    IN      HKEY RegRoot <br>    ); <br> <br>// <br>// DLL globals <br>// <br> <br>extern LPCSTR g_User; <br>extern LPSTR g_SettingsFile; <br>extern LPSTR g_MigrateDotInf; <br>extern LPSTR g_WorkingDirectory; <br>extern LPSTR g_SourceDirectories; <br>extern HANDLE g_hHeap; <br> <br>// <br>// Define strings <br>// <br> <br>#define DEFINE_LOCALIZED_STRINGS                                            \ <br>    DEFMAC (S_HUGEDATA_ERROR,   "An invalid screen saver was detected "     \ <br>                                "and skipped.\r\n")                         \ <br>                                                                            \ <br>    DEFMAC (S_DEFAULT_USER,     "Default User")                             \ <br>                                                                            \ <br>    DEFMAC (g_MyProductId,      "Windows 95 Screen Savers")                 \ <br>                                                                            \ <br>    DEFMAC (PASSWORD_ALERT,     "The current screen saver password may be " \ <br>                                "different from the password expected by "  \ <br>                                "Windows NT.  On Windows NT, use your "     \ <br>                                "logon password when a screen saver "       \ <br>                                "prompts for a password.")                  \ <br>                                                                            \ <br>    DEFMAC (USER_PROCESSING_ERROR, "An error occurred processing screen "   \ <br>                                "saver settings for user %s.  The screen "  \ <br>                                "saver will be disabled for this user.  "   \ <br>                                "(Error: %u)\r\n")                          \ <br>                                                                            \ <br>    DEFMAC (DELETEFILE_SUCCESS, "Deleted Windows 95 screen saver %s\r\n")   \ <br>                                                                            \ <br>    DEFMAC (DELETEFILE_ERROR,   "An error occurred attempting to delete "   \ <br>                                "the Windows 95 screen saver %s.  (Error: " \ <br>                                "%u)\r\n")                                  \ <br>                                                                            \ <br>    DEFMAC (S_BEZIER_DATA_ERROR, "Some of the Bezier screen saver "         \ <br>                                "settings are invalid and cannot be "       \ <br>                                "transfered to Windows NT.\r\n")            \ <br>                                                                            \ <br>    DEFMAC (S_REGISTRY_ERROR,   "An error occurred saving the screen "      \ <br>                                "saver settings for user %s.  (Error: %u, " \ <br>                                "%s [%s])\r\n")                             \ <br>                                                                            \ <br>     <br> <br> <br>#define DEFINE_NONLOCALIZED_STRINGS                                         \ <br>    DEFMAC (S_BOOT,             "boot")                                     \ <br>    DEFMAC (S_SCRNSAVE_EXE,     "SCRNSAVE.EXE")                             \ <br>    DEFMAC (S_SCRNSAVE_DOT,     "Screen Saver.")                            \ <br>    DEFMAC (S_SCRNSAVE_MASK,    "Screen Saver.%s")                          \ <br>    DEFMAC (S_EMPTY,            "")                                         \ <br>    DEFMAC (S_DOUBLE_EMPTY,     "\0")                                       \ <br>    DEFMAC (S_SETTINGS_MASK,    "%s\\settings.dat")                         \ <br>    DEFMAC (S_MIGINF_MASK,      "%s\\migrate.inf")                          \ <br>    DEFMAC (S_SYSTEM_INI,       "system.ini")                               \ <br>    DEFMAC (S_CONTROL_INI,      "control.ini")                              \ <br>    DEFMAC (S_BEZIER,           "Bezier")                                   \ <br>    DEFMAC (S_MARQUEE,          "Marquee")                                  \ <br>    DEFMAC (S_BEZIER_SETTINGS,  "Screen Saver.Bezier")                      \ <br>    DEFMAC (S_MARQUEE_SETTINGS, "Screen Saver.Marquee")                     \ <br>    DEFMAC (S_MIGRATION_PATHS,  "Migration Paths")                          \ <br>    DEFMAC (S_CONTROL_PANEL_MASK, "Control Panel\\%s")                      \ <br>    DEFMAC (S_LENGTH,           "Length")                                   \ <br>    DEFMAC (S_WIDTH,            "Width")                                    \ <br>    DEFMAC (S_LINESPEED,        "LineSpeed")                                \ <br>    DEFMAC (S_BACKGROUND_COLOR, "BackgroundColor")                          \ <br>    DEFMAC (S_CHARSET,          "CharSet")                                  \ <br>    DEFMAC (S_FONT,             "Font")                                     \ <br>    DEFMAC (S_MODE,             "Mode")                                     \ <br>    DEFMAC (S_SIZE,             "Size")                                     \ <br>    DEFMAC (S_SPEED,            "Speed")                                    \ <br>    DEFMAC (S_TEXT,             "Text")                                     \ <br>    DEFMAC (S_TEXTCOLOR,        "TextColor")                                \ <br>    DEFMAC (S_ACTIVE1,          "Active1")                                  \ <br>    DEFMAC (S_ACTIVE2,          "Active2")                                  \ <br>    DEFMAC (S_CLEAN_SCREEN,     "Clean Screen")                             \ <br>    DEFMAC (S_ENDCOLOR1,        "EndColor1")                                \ <br>    DEFMAC (S_ENDCOLOR2,        "EndColor2")                                \ <br>    DEFMAC (S_LINES1,           "Lines1")                                   \ <br>    DEFMAC (S_LINES2,           "Lines2")                                   \ <br>    DEFMAC (S_STARTCOLOR1,      "StartColor1")                              \ <br>    DEFMAC (S_STARTCOLOR2,      "StartColor2")                              \ <br>    DEFMAC (S_WALKRANDOM1,      "WalkRandom1")                              \ <br>    DEFMAC (S_WALKRANDOM2,      "WalkRandom2")                              \ <br>    DEFMAC (S_DENSITY,          "Denisty")                                  \ <br>    DEFMAC (S_WARPSPEED,        "WarpSpeed")                                \ <br>    DEFMAC (S_HKR,              "HKR")                                      \ <br>    DEFMAC (S_DEFAULT_KEYSTR,   "(unknown regkey)")                         \ <br>    DEFMAC (S_SYSTEM_DIR,       "\\system\\")                               \ <br>    DEFMAC (S_SYSTEM32_DIR,     "\\system32\\")                             \ <br> <br>#define DEFINE_STRINGS DEFINE_LOCALIZED_STRINGS DEFINE_NONLOCALIZED_STRINGS <br> <br>// <br>// Declare externs for all string variables <br>// <br> <br>#define DEFMAC(var,str) extern CHAR var[]; <br>DEFINE_STRINGS <br>#undef DEFMAC <br> <br> </code></pre>
<p>&nbsp;</p></body>
</HTML>
