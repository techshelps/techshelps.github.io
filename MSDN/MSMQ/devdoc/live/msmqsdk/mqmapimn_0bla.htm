<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>MSMQ Exchange Connector: Book Server Application</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_mq_msmq_exchange_connector_book_server_application"></a>MSMQ Exchange Connector: Book Server Application</h3>
<p>
The Book Server sample application uses the MSMQ Exchange Connector to pass messages between a Microsoft® Exchange user and an MSMQ application. In this application, the Exchange user requests a query, the MSMQ application performs the query, and the results of the query are sent back to the Exchange user.</p>
<h4>How Book Server Works</h4>
<p>
Here is the step-by-step process that Book Server uses to perform its query.
<ol>
<li>
Using Microsoft Exchange, the Microsoft Exchange user enters the search criteria and submits the query mail, which is preaddressed to a recipient called Book Server. The mail's MSMQ-typed address is set to the label of the <a href="msmqglos_3wv5.htm#_mq_application_input_queue_gly">application input queue</a> of the sample MSMQ application <i>booksrvr</i>.</li>
<li>
The Exchange Connector receives the form from Exchange (because the recipient is an MSMQ-typed recipient), translates it into an MSMQ mail message, and sends it to the application input queue of the sample MSMQ application.</li>
<li>
The sample MSMQ application (<i>booksrvr</i>) retrieves the message from the application input queue, calls <a href="mqfunc_7yex.htm"><b>MQMailParseBody</b></a> to parse the body of the message into a mail structure, and finds the values of the query fields from the structure and performs the query.</li>
<li>
Once the query is complete, a reply form is sent to the Exchange Connector. The reply form is created by including the results of the query, who is sending the results (in this case the <i>booksrvr </i>application), and who will receive the results (the sender of the original mail) in a new mail structure. After the structure is filled in, a call to <a href="mqfunc_27w9.htm"><b>MQMailComposeBody</b></a> creates a message body that is then sent to the Exchange Connector's <a href="msmqglos_3wvn.htm#_mq_server_input_queue_gly">server input queue</a>.</li>
<li>
The Exchange Connector retrieves the message from the queue, translates it into mail, and submits it to the Exchange user who requested the query.</li>
<li>
The Exchange user can then retrieve the mail from the Inbox and view the results of the query.</li>
</ol>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To Run Book Server</h5>
<ol>
<li>
Build the sample MSMQ application.<ul>
<li>
Make sure that the environment (PATH, INCLUDE, and LIB variables) is set correctly to compile Windows-based applications.</li>
<li>
Edit the file mk.bat that is in the <i>booksrvr</i> directory. Make the following changes to point to the correct locations of the MSMQ SDK directory and the MSMQ Mail SDK directory.<pre><code>set MSMQ_SDK=c:\msmq\sdk
set MQMAIL_SDK=c:\msmqmail
 </code></pre>
</li>
<li>
Run mk.bat. This should build booksrvr.exe in the <i>booksrvr</i> directory.</li>
</ul>
</li>
<li>
Ask your Microsoft Exchange administrator to install the MSMQ Exchange Connector from the MSMQ CD. </li>
<li>
From the <i>booksrvr</i> directory, the administrator must install the forms bookfrm.efp and bookres.efp into your Exchange system.</li>
<li>
Your Exchange administrator must add a custom recipient named "Book Server" with the address-type MSMQ and whose address is "booksrvrq." It must not be a rich-text recipient.</li>
<li>
Run booksrvr.exe (make sure MSMQ is running). Type "booksrvr booksrvrq" in the command line. The argument booksrvrq is the label of the queue that the booksrvr application will use as its input queue. This label should be identical to the address of the "Book Server" custom recipient that your Exchange administrator entered.</li>
<li>
Send the query. In your mail client, open the form named "Book Search". Fill in the appropriate fields and submit the form.</li>
<li>
Verify the query results. After a short time, you should receive a result form sent by the sample <i>booksrvr</i> application with the results of the query.</li>
</ol>
<p>&nbsp;</p></body>
</HTML>
