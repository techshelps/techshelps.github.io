<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>MQLocateBegin</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_mq_mqlocatebegin"></a>MQLocateBegin</h1>
<p>
The <b>MQLocateBegin</b> function starts a query to locate a single public queue (or set of public queues), returning a query handle. Use <a href="mqfunc_416c.htm"><b>MQLocateNext</b></a> to retrieve the query results.</p>
<p>
This function does not return the number of matching entries.</p>
<pre><code><b>HRESULT APIENTRY MQLocateBegin(
  LPCWSTR</b><i> lpwcsContext</i><b>,          </b>
<b>  MQRESTRICTION </b><i>*pRestriction</i><b>,  </b>
<b>  MQCOLUMNSET <i>*</i></b><i>pColumns</i><b>,        </b>
<b>  MQSORTSET <i>*</i></b><i>pSort</i><b>,             </b>
<b>  PHANDLE</b><i> phEnum                 </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>lpwcsContext</i></dt>
<dd>
[in] Specifies the starting point of the query within <a href="msmqglos_3wv5.htm#_mq_active_directory_gly">Active Directory</a>. Must be NULL.</dd>
<dt>
<i>pRestriction</i></dt>
<dd>
[in] Specifies the search criteria for the query. NULL value indicates no restrictions.</dd>
<dt>
<i>pColumns</i></dt>
<dd>
[in] Specifies which queue properties should be returned by the query. Must not be set to NULL.</dd>
<dt>
<i>pSort</i></dt>
<dd>
[in] Specifies the sort order for the query results. <a href="mqprop_0pt1.htm">PROPID_Q_PATHNAME</a> cannot be used as a sort key. Can be set to NULL to indicate no sort order is needed.</dd>
<dt>
<i>phEnum</i></dt>
<dd>
[out] Pointer to a query handle to use when calling <a href="mqfunc_416c.htm"><b>MQLocateNext</b></a> and <a href="mqfunc_104k.htm"><b>MQLocateEnd</b></a>.
</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
MQ_OK</dt>
<dd>
Indicates success.</dd>
<dt>
MQ_ERROR_ILLEGAL_CONTEXT</dt>
<dd>
Indicates that <i>lpwcsContext</i> is not NULL.</dd>
<dt>
MQ_ERROR_ILLEGAL_MQCOLUMNS</dt>
<dd>
Indicates that <i>pColumns</i> is NULL.</dd>
<dt>
MQ_ERROR_ILLEGAL_PROPERTY_VALUE</dt>
<dd>
Indicates that an illegal property value was specified in <i>pRestriction.</i> For example, this error is returned if <a href="mqprop_7830.htm">PROPID_Q_LABEL</a> is specified and the supplied queue label is longer than the maximum label length.</dd>
<dt>
MQ_ERROR_ILLEGAL_PROPID</dt>
<dd>
Indicates that an illegal property identifier was specified in <i>pColumns</i>.</dd>
<dt>
MQ_ERROR_ILLEGAL_RELATION</dt>
<dd>
Indicates that an invalid relationship value was specified in <i>pRestriction</i>.</dd>
<dt>
MQ_ERROR_ILLEGAL_RESTRICTION_PROPID</dt>
<dd>
Indicates that an illegal property identifier was specified in <i>pRestriction.</i> For example, <a href="mqprop_0pt1.htm">PROPID_Q_PATHNAME</a> is not valid.</dd>
<dt>
MQ_ERROR_ILLEGAL_SORT_PROPID</dt>
<dd>
Indicates that an illegal property identifier was specified in <i>pSort</i>. For example, if <i>pSort</i> specifies PROPID_Q_PATHNAME, this error is returned.</dd>
<dt>
MQ_ERROR_NO_DS</dt>
<dd>
Cannot access <a href="msmqglos_3wv5.htm#_mq_active_directory_gly">Active Directory</a>.
</dd>
</dl>
<h4>Remarks</h4>
<p>
Queries can only locate public queues. <b>MQLocateBegin</b> cannot locate a private queue. For a complete description of running a query, see <a href="msmquse_4wo9.htm">Locating a Public Queue</a>.</p>
<p>
The <i>pRestriction </i>parameter specifies the search criteria (which queue properties and values are used in the search). It is a pointer to a structure containing a list of property restrictions logically combined by the <b>And</b> operator, with each restriction including a queue property identifier, a property value, and a comparison operator. Comparison operators include: less than (PRLT), less than or equal to (PRLE), equal (PREQ), not equal (PRNE), greater than or equal to (PRGE), greater than (PRGT).</p>
<p>
To specify the search criteria, MSMQ uses two structures: <a href="mqstruc_2coe.htm"><b>MQPROPERTYRESTRICTION</b></a> and <a href="mqstruc_9p2m.htm"><b>MQRESTRICTION</b></a>. <b>MQPROPERTYRESTRICTION</b> defines a single property restriction. <b>MQRESTRICTION</b> specifies an array of restrictions as well as a count of how many restrictions there are (see the following examples).</p>
<p>
This example locates queues by their type of service. For example, locating all the queues whose <a href="mqprop_5011.htm">PROPID_Q_TYPE</a> equals <i>guidx</i>.</p>
<pre><code>/*Set property restriction. */
MQPROPERTYRESTRICTION PropertyRestriction;
PropertyRestriction.rel         = PREQ;
PropertyRestriction.prop        = PROPID_Q_TYPE;
PropertyRestriction.prval.vt    = VT_CLSID;
PropertyRestriction.prval.puuid = &amp;guidX;
 
/*Package restrictions. */
MQRESTRICTION rest;
rest.cRes = 1;
rest.paPropRes = &amp;PropertyRestriction;
 </code></pre>
<p>
This example locates queues by their type of service (PROPID_Q_TYPE equals <i>guidx</i>) and by their message journal property (<a href="mqprop_9s18.htm">PROPID_Q_JOURNAL</a> equals 1).</p>
<p>
First, prepare the property restrictions:</p>
<pre><code>/*Set property restrictions. */
MQPROPERTYRESTRICTION PropertyRestrictions[2];
/*Set first restriction. */
PropertyRestrictions[0].rel = PREQ;
PropertyRestrictions[0].prop = PROPID_Q_TYPE;
PropertyRestrictions[0].prval.vt  = VT_CLSID;
PropertyRestrictions[0].prval.puuid = &amp;guidX;
/*Set second restriction. */
PropertyRestrictions[1].rel = PREQ;
PropertyRestrictions[1].prop = PROPID_Q_JOURNAL;
PropertyRestrictions[1].prval.vt  = VT_UI1;
PropertyRestrictions[1].prval.bVal = 1;
  
/*Package the restrictions. */
MQRESTRICTION rest;
rest.cRes = 2;
rest.paPropRes = PropertyRestrictions;
 </code></pre>
<p>
Setting <i>pRestriction</i> to NULL retrieves information about all the queues.</p>
<p>
The <i>pColumns </i>parameter allows you to specify which queue properties to retrieve. You can retrieve any number of queue properties with the same call to <b>MQLocateBegin</b>.</p>
<p>
The <i>pSort </i>parameter allows you to specify the sort order (ascending or descending) of the result according to one or more of the properties (PROPID_Q_PATHNAME cannot be used as a sort key). Two structures are used to set the sort order: <a href="mqstruc_92ux.htm"><b>MQSORTKEY</b></a> specifies a single sort key, and <a href="mqstruc_9s50.htm"><b>MQSORTSET</b></a> specifies an array of sort keys along with the number of keys.</p>
<p>
For example, the following code sorts queues according to their quota:</p>
<pre><code>/* Prepare sort key. */
MQSORTKEY SortKey;
SortKey.propColumn = PROPID_Q_QUOTA;
SortKey.dwOrder = QUERY_SORTASCEND;
 
/* Indicate number of sort keys. */
MQSORTSET SortSet;
SortSet.cCol = 1;
SortSet.aCol = &amp;SortKey; 
 </code></pre>
<p>
When running a query, MSMQ can locate queues faster when the query is based on <a href="mqprop_80th.htm">PROPID_Q_INSTANCE</a>, <a href="mqprop_5011.htm">PROPID_Q_TYPE</a>, or <a href="mqprop_7830.htm">PROPID_Q_LABEL</a> (PREQ only). The query runs faster because these properties are indexed in <a href="msmqglos_3wv5.htm#_mq_active_directory_gly">Active Directory</a>, providing a faster way for MSMQ to locate the property specified in the call.</p>
<p>
<b>MQLocateBegin</b> can only return queues that are in <a href="msmqglos_3wv5.htm#_mq_active_directory_gly">Active Directory</a> when <b>MQLocateBegin</b> is called. Queues added to Active Directory after <b>MQLocateBegin</b> is called are not included.</p>
<p>
Public queues cannot be located if there is no connection to Active Directory. This restriction applies to <a href="msmqglos_3wv8.htm#_mq_dependent_client_gly">dependent client</a> computers, <a href="msmqglos_3wvd.htm#_mq_independent_client_gly">independent client</a> computers that are working offline, and MSMQ routing servers (FRS). (For information on offline operations, see <a href="msmq_guide_72es.htm">MSMQ Offline Support</a>.)</p>
<h4>Examples</h4>
<p>
For an example of using <b>MQLocateBegin</b>, see <a href="msmquse_4wo9.htm">Locating a Public Queue</a>.</p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 4.0 SP3 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Requires Windows 95 or later.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in mq.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use mqrt.lib.<br>
<b>&nbsp;&nbsp;Unicode: </b>Defined only as Unicode.</p>
<h4>See Also</h4>
<p>
<a href="mqstruc_0cl0.htm"><b>MQCOLUMNSET</b></a>, <a href="mqfunc_104k.htm"><b>MQLocateEnd</b></a>, <a href="mqfunc_416c.htm"><b>MQLocateNext</b></a>, <a href="mqstruc_2coe.htm"><b>MQPROPERTYRESTRICTION</b></a>, <a href="mqstruc_9p2m.htm"><b>MQRESTRICTION</b></a>, <a href="mqstruc_92ux.htm"><b>MQSORTKEY</b></a>, <a href="mqstruc_9s50.htm"><b>MQSORTSET</b></a>, <a href="mqprop_9s18.htm">PROPID_Q_JOURNAL</a>, <a href="mqprop_7830.htm">PROPID_Q_LABEL</a>, <a href="mqprop_0pt1.htm">PROPID_Q_PATHNAME</a>, <a href="mqprop_5011.htm">PROPID_Q_TYPE</a> </p>
<p>&nbsp;</p></body>
</HTML>
