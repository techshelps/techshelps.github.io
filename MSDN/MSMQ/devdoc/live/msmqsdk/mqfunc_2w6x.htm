<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>MQGetQueueSecurity</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_mq_mqgetqueuesecurity"></a>MQGetQueueSecurity</h1>
<p>
The <b>MQGetQueueSecurity</b> function retrieves the access control security descriptor for the specified queue.</p>
<pre><code><b>HRESULT APIENTRY MQGetQueueSecurity(
  LPCWSTR</b><i> lpwcsFormatName</i><b>,                     </b>
<b>  SECURITY_INFORMATION </b><i>*SecurityInformation</i><b>,  </b>
<b>  PSECURITY_DESCRIPTOR <i>*</i></b><i>pSecurityDescriptor</i><b>,  </b>
<b>  DWORD</b><i> nLength</i><b>,                               </b>
<b>  LPDWORD</b><i> lpnLengthNeeded                      </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>lpwcsFormatName</i></dt>
<dd>
[in] Pointer to the format name string of the queue whose security information will be retrieved. Use a public or private format name to specify the queue. You cannot specify a direct format name.</dd>
<dt>
<i>SecurityInformation</i></dt>
<dd>
[in] Specifies the <b>SECURITY_INFORMATION</b> structure that identifies the access control information being requested. (For information on the <b>SECURITY_INFORMATION</b> structure, see the Microsoft Platform SDK.)</dd>
<dt>
<i>pSecurityDescriptor</i></dt>
<dd>
[out] Pointer to the security descriptor buffer that receives the queue's security descriptor. The calling process must have the rights to view the specified aspects of the queue's security status. The <b>SECURITY_DESCRIPTOR</b> structure is returned in self-relative format. (For information on the <b>SECURITY_DESCRIPTOR</b> structure, see the Microsoft Platform SDK.)</dd>
<dt>
<i>nLength</i></dt>
<dd>
[in] Specifies the size, in bytes, of the security descriptor buffer (see <i>pSecurityDescriptor</i>).</dd>
<dt>
<i>lpnLengthNeeded</i></dt>
<dd>
[out] Pointer to a variable that indicates if any additional length is needed for the security descriptor. If the security descriptor fits in the buffer, this variable indicates the actual size of the security descriptor.
<p>
If the security descriptor buffer is too small for the security descriptor (the value of <i>lpnLengthNeeded</i> is greater than the value of <i>nLength</i>), this variable indicates the size of the buffer needed to hold the security descriptor. When this happens, the security descriptor is not copied to the buffer and MQ_ERROR_SECURITY_DESCRIPTOR_BUFFER_TOO_SMALL is returned.

</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
MQ_OK</dt>
<dd>
Indicates success.</dd>
<dt>
MQ_ERROR_ACCESS_DENIED</dt>
<dd>
The process does not have the correct access rights to get the queue's security descriptor. For a complete list of queue access rights, see <a href="msmq_guide_8i0c.htm">Access Control</a>.
<p>
To change access rights, call <a href="mqfunc_4rg9.htm"><b>MQSetQueueSecurity</b></a>.
</dd>
<dt>
MQ_ERROR_FUNCTION_NOT_SUPPORTED</dt>
<dd>
<b>MQGetQueueSecurity</b> is not supported in Windows 95.</dd>
<dt>
MQ_ERROR_ILLEGAL_FORMATNAME</dt>
<dd>
The <i>lpwcsFormatName </i>parameter specified an illegal format name.</dd>
<dt>
MQ_ERROR_NO_DS</dt>
<dd>
Cannot access <a href="msmqglos_3wv5.htm#_mq_active_directory_gly">Active Directory</a>.</dd>
<dt>
MQ_ERROR_PRIVILEGE_NOT_HELD</dt>
<dd>
The process does not have the proper privilege to read the queue's system access control list.</dd>
<dt>
MQ_ERROR_SECURITY_DESCRIPTOR_BUFFER_TOO_SMALL</dt>
<dd>
The buffer pointed to by <i>pSecurityDescriptor</i> is too small to hold the security descriptor; the returned value of <i>lpnLengthNeeded</i> is greater than the supplied value of <i>nLength.</i></dd>
<dt>
MQ_ERROR_UNSUPPORTED_FORMATNAME_OPERATION</dt>
<dd>
The <i>lpwcsFormatName</i> parameter contains a public or private queue using a <a href="msmqglos_3wv8.htm#_mq_direct_format_name_gly">direct format name</a> or a <a href="msmqglos_3wve.htm#_mq_journal_queue_gly">journal</a>, <a href="msmqglos_3wv8.htm#_mq_dead_letter_queue_gly">dead letter</a>, or <a href="msmqglos_3wv7.htm#_mq_connector_queue_gly">connector queue</a>.
</dd>
</dl>
<h4>Remarks</h4>
<p>
The queue's <a href="msmqglos_3wvn.htm#_mq_security_descriptor_gly">security descriptor</a> is initially set when the queue is created (see <a href="mqfunc_8dut.htm"><b>MQCreateQueue</b></a>). Access to the following queue operations can be controlled: creating, deleting, and opening the queue for sending messages to and reading messages from the queue; getting and setting the queue's properties; and getting and setting the queue's security descriptor.</p>
<p>
The format name of the queue (specified by <i>lpwcsFormatName</i>) must be a <a href="msmqglos_3wvk.htm#_mq_public_format_name_gly">public</a> or <a href="msmqglos_3wvk.htm#_mq_private_format_name_gly">private format name</a>. For public queues, MSMQ must be able to access <a href="msmqglos_3wv5.htm#_mq_active_directory_gly">Active Directory</a>. For private queues, MSMQ must access the local computer.</p>
<p>
If the format name of the queue is unknown, see <a href="msmq_guide_1sbp.htm">Format Name</a> to find ways to obtain a new format name.</p>
<p>
To read the security descriptor of a queue, the calling process must have READ_CONTROL access or be the owner of the queue. Access rights such as READ_CONTROL are set when the queue is created and can be modified by calling <a href="mqfunc_4rg9.htm"><b>MQSetQueueSecurity</b></a>.</p>
<p>
To read the queue's system access control list, the caller must have SE_SECURITY_NAME privileges on the <a href="msmqglos_3wv5.htm#_mq_active_directory_gly">Active Directory</a> server (for public queues) or on the local computer (for private queues).</p>
<p>
<b>MQGetQueueSecurity</b> cannot retrieve the security descriptor of a <a href="msmqglos_3wve.htm#_mq_journal_queue_gly">journal</a>, <a href="msmqglos_3wv8.htm#_mq_dead_letter_queue_gly">dead letter</a>, <a href="msmqglos_3wv7.htm#_mq_connector_queue_gly">connector</a>, or <a href="msmqglos_3wva.htm#_mq_foreign_queue_gly">foreign queue</a>.</p>
<p>
A public queue's security descriptor cannot be retrieved if there is no connection to <a href="msmqglos_3wv5.htm#_mq_active_directory_gly">Active Directory</a>. This restriction applies to <a href="msmqglos_3wv8.htm#_mq_dependent_client_gly">dependent client</a> computers, <a href="msmqglos_3wvd.htm#_mq_independent_client_gly">independent client</a> computers that are working offline, and MSMQ routing servers (FRS). (For information on offline operations, see <a href="msmq_guide_72es.htm">MSMQ Offline Support</a>.)</p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 4.0 SP3 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Requires Windows 95 or later.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in mq.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use mqrt.lib.<br>
<b>&nbsp;&nbsp;Unicode: </b>Defined only as Unicode.</p>
<h4>See Also</h4>
<p>
<a href="mqfunc_4rg9.htm"><b>MQSetQueueSecurity</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
