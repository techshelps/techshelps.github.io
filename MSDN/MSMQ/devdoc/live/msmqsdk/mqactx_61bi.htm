<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Open</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_mq_open"></a>Open<br>
<a href="mqactx_01nz.htm">MSMQQueueInfo</a></h1>
<p>
The <b>Open</b> method opens a queue for sending messages to the queue, for reading messages in the queue (peek and receive access), or for looking at queue's information.</p>
<p>
The properties of the queue are based on the current properties of the queue information (<b>MSMQQueueInfo</b>) object.</p>
<h4>Syntax</h4>
<pre><code><i>set object2 = object1</i>.<b>Open</b> <i>(Access, ShareMode)</i>
<i> </i></code></pre>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=28%>Syntax Element</th>
<th align=left width=72%>Description</th>
</tr>
<tr valign=top>
<td width=28%><i>object1</i></td>
<td width=72%>Queue information (<b>MSMQQueueInfo</b>) object that defines the queue.</td>
</tr>
<tr valign=top>
<td width=28%><i>object2</i></td>
<td width=72%>Queue (<b>MSMQQueue</b>) object that represents the open instance of the queue.</td>
</tr>
<tr valign=top>
<td width=28%><i>Access</i></td>
<td width=72%>Specifies how the application accesses the queue (peek, send, or receive). This setting cannot be changed while the queue is open.<p>
<i>Access</i> can be set to one of the following:</p>
<p>
MQ_PEEK_ACCESS: Messages can only be looked at. They cannot be removed from the queue.</p>
<p>
MQ_SEND_ACCESS: Messages can only be sent to the queue.</p>
<p>
MQ_RECEIVE_ACCESS: Messages can be retrieved from the queue or peeked at. See <i>ShareMode</i> for limiting who can retrieve messages.</p>
</td>
</tr>
<tr valign=top>
<td width=28%><i>ShareMode</i></td>
<td width=72%>Specifies who can access the queue. Set to one of the following:<p>
MQ_DENY_NONE: Default. The queue is available to everyone. This setting must be used if <i>Access</i> is set to MQ_PEEK_ACCESS or MQ_SEND_ACCESS.</p>
<p>
MQ_DENY_RECEIVE_SHARE: Limits those who can retrieve messages from the queue to this process. If the queue is already opened for retrieving messages by another process, this call fails and returns MQ_ERROR_SHARING_VIOLATION. Applicable only when <i>Access</i> is set to MQ_RECEIVE_ACCESS.</p>
</td>
</tr>
</table><br>
<h4>Return Codes</h4>
<p>
For information on return codes, see <a href="mqfunc_9pgz.htm">MSMQ Error and Information Codes</a>. </p>
<h4>Remarks</h4>
<p>
<b>Open</b> returns an <a href="mqactx_1qcl.htm"><b>MSMQQueue</b></a> object each time it is called. Consequently, the <b>MSMQQueueInfo</b> object that opens the queue can be associated with any number of <b>MSMQQueue</b> objects.</p>
<p>
When the queue is opened, <a href="msmqglos_3wv5.htm#_mq_active_directory_gly">Active Directory</a> is automatically updated with the current property values of the <b>MSMQQueueInfo</b> object.</p>
<p>
When a queue is opened, the cursor points to the front of the queue, not the first message in the queue. For information on how to move the cursor to the first message in the queue, see <a href="mqactx_1qcl.htm"><b>MSMQQueue</b></a>.</p>
<p>
Direct format names can only be used when sending messages to a queue. A direct format name tells MSMQ not to use <a href="msmqglos_3wv5.htm#_mq_active_directory_gly">Active Directory</a> (for public queues) or the local computer (for private queues) to get routing information. When a direct format name is used, all routing information is taken from the format name and MSMQ sends the messages to the queue in a single hop.</p>
<p>
Setting <i>ShareMode</i> to MQ_DENY_RECEIVE_SHARE means that until the calling application calls the <a href="mqactx_1qcl.htm"><b>MSMQQueue</b></a> object's <a href="mqactx_9mp1.htm"><b>Close</b></a> method, no other MSMQ applications can read the messages in the queue. This includes applications that may have the correct access rights to read messages from the queue.</p>
<p>
If the calling application does not have sufficient access rights to a queue, two things can happen. If <i>Access</i> is set to MQ_PEEK_ACCESS or MQ_RECEIVE_ACCESS, <b>Open</b> fails and throws MQ_ERROR_ACCESS_DENIED. If <i>Access</i> is set to MQ_ACCESS_SEND, <b>Open</b> succeeds, but errors are thrown when the application tries to send a message.</p>
<p>
To change the access rights of the queue, call <a href="mqfunc_4rg9.htm"><b>MQSetQueueSecurity</b></a>. The following table lists the access rights needed to open the queue in peek, send, or receive access mode.</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=51%>Queue Access Mode </th>
<th align=left width=49%>Queue Access Right</th>
</tr>
<tr valign=top>
<td width=51%>MQ_PEEK_MESSAGE</td>
<td width=49%>MQSEC_PEEK_MESSAGE</td>
</tr>
<tr valign=top>
<td width=51%>MQ_SEND_MESSAGE</td>
<td width=49%>MQSEC_WRITE_MESSAGE</td>
</tr>
<tr valign=top>
<td width=51%>MQ_RECEIVE_MESSAGE</td>
<td width=49%>MQSEC_RECEIVE_MESSAGE</td>
</tr>
</table><br>
<p>
After opening a queue, there is no provision to change the access mode of the queue. Either close and open the queue in the current thread, or open a new thread with new access rights.</p>
<p>
When the queue is opened, <a href="msmqglos_3wv5.htm#_mq_active_directory_gly">Active Directory</a> is automatically updated with the current property values of the <b>MSMQQueueInfo</b> object.</p>
<p>
When a queue is opened, the cursor points to the front of the queue, not the first message in the queue. For information on how to move the cursor to the first message in the queue, see <a href="actvxuse_5k54.htm">Reading Messages In a Queue</a>.</p>
<p>
Journal queues and dead letter queues can only be opened with <i>Access</i> set to MQ_PEEK_ACCESS or MQ_RECEIVE_ACCESS. You cannot send messages to a journal queue.</p>
<p>
When opening a queue on a remote computer, MSMQ does not check for the existence of the queue when <i>Access</i> is set to MQ_SEND_ACCESS. In addition, if <i>Access</i> is set to MQ_RECEIVE_ACCESS, the computer opening the queue must support the same protocol as the remote computer where the queue is located.</p>
<p>
<a href="msmqglos_3wva.htm#_mq_foreign_queue_gly">Foreign queues</a> cannot be opened using a direct format name. MSMQ needs the routing information stored in Active Directory to find a MSMQ Connector Sever for the foreign queue.</p>
<h4>Example</h4>
<p>
This example creates a public queue, then opens the queue for sending messages. To try this example using Microsoft® Visual Basic® (version 5.0), paste the code into the Code window of a form, run the example, and click the form.</p>
<pre><code>Dim qinfo As MSMQQueueInfo
Dim q As MSMQQueue

Private Sub Form_Click()
    
  Set qinfo = New MSMQQueueInfo
  qinfo.PathName = ".\OpenTest"
  qinfo.Label = "Test Queue"
  qinfo.Create
  
  Set q = qinfo.Open(MQ_SEND_ACCESS, MQ_DENY_NONE)
  If q.IsOpen Then
     MsgBox "The queue " + qinfo.PathName + " is open."
     Else
     MsgBox "The queue is not open!"
  End If

End Sub
 
 </code></pre>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 4.0 SP3 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in resapi.h.</p>
<h4>See Also</h4>
<p>
<a href="mqactx_6605.htm"><b>Create</b></a>, <a href="mqactx_30do.htm"><b>Label</b></a>, <a href="mqactx_1qcl.htm"><b>MSMQQueue</b></a>, <a href="mqactx_01nz.htm"><b>MSMQQueueInfo</b></a>, <a href="mqactx_823p.htm"><b>PathName</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
