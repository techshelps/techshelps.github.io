<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Dead Letter Queues</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_mq_dead_letter_queues"></a>Dead Letter Queues</h3>
<p>
Dead letter queues are used for storing messages that could not be delivered. MSMQ provides a dead letter queue for <a href="msmqglos_3wvi.htm#_mq_non_transaction_message_gly">non-transaction messages</a> (<a href="msmqglos_3wv8.htm#_mq_deadletter_gly">DEADLETTER</a>) and a dead letter queue for <a href="msmqglos_3wvo.htm#_mq_transaction_message_gly">transaction messages</a> (<a href="msmqglos_3wv8.htm#_mq_deadxact_gly">DEADXACT</a>). Both types of queues are created by MSMQ whenever a computer is added to the enterprise.</p>
<p>
<b>Note</b>&nbsp;&nbsp;Only one copy of a message is stored on a computer at one time. If the message reached the next computer successfully, a copy of the message is stored in that computer's journal queue. If the message could not be delivered to the next computer, it is stored in the current computer's dead letter queue.</p>
<p>
<b>Non-transaction Messages and Dead Letter Queues</b></p>
<p>
To use the non-transaction dead letter queue (DEADLETTER), the non-transaction message must have its journal property set to the appropriate value before the message is sent. Although the DEADLETTER queue is automatically created, MSMQ does not automatically send undelivered non-transaction messages to a computer's DEADLETTER queue.</p>
<p>
MSMQ sends undelivered messages to the DEADLETTER queue of the computer that could not send the message. This can be the source computer, the destination computer, or any MSMQ routing server in between. When an undelivered message is placed in a DEADLETTER queue, MSMQ sets the message's class property to the appropriate negative acknowledgment.</p>
<p>
<b>Note</b>&nbsp;&nbsp;Only one copy of a message is stored on a computer at one time. If the message reached the next computer successfully, a copy of the message is stored in that computer's journal queue. If the message could not be delivered to the next computer, it is stored in the current computer's DEADLETTER queue.</p>
<p>
<b>Transaction Messages and Dead Letter Queues</b></p>
<p>
The transaction dead letter queue (DEADXACT) is used regardless of the transaction message's journal property. MSMQ automatically places a copy of each transaction message it sends in the source computer's DEADXACT queue. The class of the stored message reflects the last known status of the message. </p>
<p>
For example, MSMQ changes the class of the message if the message's <i>time-to-reach-queue</i> timer or <i>time-to-be-received</i> timer expires.</p>
<p>
Only after receiving a positive acknowledgment does MSMQ remove the copy of the transaction message from the DEADXACT queue. Testing to see if the message is removed from the DEADXACT queue is the only way the sending application can tell that the receiving application committed to its transaction.</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=51%>For information on…</th>
<th align=left width=49%>See…</th>
</tr>
<tr valign=top>
<td width=51%>Setting a message's journal property using the C API</td>
<td width=49%><a href="mqprop_20q4.htm">PROPID_M_JOURNAL</a></td>
</tr>
<tr valign=top>
<td width=51%>Setting a message's journal property using the ActiveX components</td>
<td width=49%><a href="mqactx_99nw.htm">Journal</a></td>
</tr>
</table><br>

<h4><a name="_mq_opening_a_dead_letter_queue"></a>Opening a Dead Letter Queue</h4>
<p>
To read the messages in the dead letter queue (an application cannot send messages to a dead letter queue) the format name used to open the queue should appear as follows:</p>
<pre><code>MACHINE=<a href="msmqglos_3wvh.htm#_mq_machineguid_gly">MachineGUID</a>;DEADLETTER (for non-transaction messages)
-or-
MACHINE=<a href="msmqglos_3wvh.htm#_mq_machineguid_gly">MachineGUID</a>;DEADXACT (for transaction messages)
 </code></pre>
<p>
<b>Note</b>&nbsp;&nbsp;You cannot open these queues using a direct format name.</p>
<p>
For an example of reading messages in a dead letter, see <a href="msmquse_13l5.htm">Reading Messages in a Dead Letter Queue</a> (using API functions).</p>
<p>&nbsp;</p></body>
</HTML>
