<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Sending Private Messages</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_mq_sending_private_messages_activex"></a>Sending Private Messages</h3>
<p>
Sending private messages requires setting the privacy level of the message, and, as an option, setting the privacy level of the queue where the message is sent before the message is sent.</p>
<p>
The properties used to set the privacy level of the message are the <a href="mqactx_54px.htm"><b>MSMQMessage</b></a> object's <a href="mqactx_3iuk.htm"><b>PrivLevel</b></a> and <a href="mqactx_1r71.htm"><b>EncryptAlgorithm</b></a> properties. The property used to set the privacy level of the queue is the <a href="mqactx_01nz.htm"><b>MSMQQueueInfo</b></a> object's <a href="mqactx_3iuk.htm"><b>PrivLevel</b></a> property. </p>
<p>
The actual call to send and read private messages is the same as the call to send and read non-private messages.</p>
<p>
<b>Note</b>&nbsp;&nbsp;Each MSMQ message can have no more than 4 MB of data.</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To send private messages</h5>
<ol>
<li>
Optional. Verify that the queue can receive private messages. The <a href="mqactx_01nz.htm"><b>MSMQQueueInfo</b></a> object's <a href="mqactx_3iuk.htm"><b>PrivLevel</b></a> must be set to MQ_PRIV_LEVEL_BODY or MQ_PRIV_LEVEL_OPTIONAL. If set to MQ_PRIV_LEVEL_BODY, the queue can only accept private messages. Non-private messages will be ignored.<pre><code>qinfo.PrivLevel = MQ_PRIV_LEVEL_BODY
 </code></pre>
</li>
<li>
Open the queue for sending messages.<pre><code>Set q = qinfo.Open(MQ_SEND_ACCESS, MQ_DENY_NONE)
</code></pre>
</li>
<li>
Set the <a href="mqactx_54px.htm"><b>MSMQMessage</b></a> object's <a href="mqactx_3iuk.htm"><b>PrivLevel</b></a> property to MQMSG_PRIV_LEVEL_BODY.<pre><code>msg.PrivLevel = MQMSG_PRIV_LEVEL_BODY
 </code></pre>
</li>
<li>
Optional. Set the encryption algorithm used to encrypt the message.<pre><code>msg.EncryptAlgorithm = MQMSG_CALG_RC4
 </code></pre>
</li>
<li>
Send the message.<pre><code>msg.Send q
</code></pre>
</li>
</ol>
<h4>Example</h4>
<pre><code>Dim qinfo As New MSMQQueueInfo
Dim q As New MSMQQueue
Dim msg As New MSMQMessage

Private Sub Form_Click()
  '**********************
  ' Create queue
  '**********************
  Set qinfo = New MSMQQueueInfo
  qinfo.PathName = ".\PrivacyTest"
  qinfo.Label = "Test Queue"
  qinfo.PrivLevel = MQ_PRIV_LEVEL_BODY
  qinfo.Create
  '*********************
  ' Open queue.
  '*********************
  Set q = qinfo.Open(MQ_SEND_ACCESS, MQ_DENY_NONE)
  '*********************
  ' Send message.
  '*********************
  msg.Label = "Test Message"
  msg.Body = "This is a private message."
  msg.PrivLevel = MQMSG_PRIV_LEVEL_BODY
  msg.EncryptAlgorithm = MQMSG_CALG_RC4
  msg.Send q
  MsgBox "The message " + msg.Label + " was sent."
  q.Close
  '*********************
  ' Receive message.
  '*********************
  Set q = qinfo.Open(MQ_RECEIVE_ACCESS, MQ_DENY_NONE)
  Set msg = q.Receive
  If msg.PrivLevel = MQMSG_PRIV_LEVEL_BODY Then
     MsgBox "Message " + msg.Label + " is private."
  Else
     MsgBox "Message " + msg.Label + " is not private."
  End If
  
   MsgBox "Encryption alogithm is: " + CStr(msg.EncryptAlgorithm)
   
   
End Sub
 </code></pre>
<p>&nbsp;</p></body>
</HTML>
