<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Receive</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_mq_receive"></a>Receive<br>
<a href="mqactx_1qcl.htm">MSMQQueue</a></h1>
<p>
The <b>Receive</b> method retrieves the first message in the queue, removing the message from the queue when the message is read. </p>
<h4>Syntax</h4>
<pre><code><i>set object2 = object1</i>.<b>Receive </b>([<i>pTransaction</i>] [,<i> WantDestinationQueue</i>] [,<i> WantBody</i>] [,<i> ReceiveTimeout</i>])
 </code></pre>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=33%>Syntax Element</th>
<th align=left width=67%>Description</th>
</tr>
<tr valign=top>
<td width=33%><i>object1</i></td>
<td width=67%>Queue (<b>MSMQQueue</b>) object that represents queue where the message resides.</td>
</tr>
<tr valign=top>
<td width=33%><i>object2</i></td>
<td width=67%>Message (<a href="mqactx_54px.htm"><b>MSMQMessage</b></a>) object that represents the message retrieved from the queue.</td>
</tr>
<tr valign=top>
<td width=33%><i>pTransaction</i></td>
<td width=67%>Optional. An <a href="mqactx_9c8e.htm"><b>MSMQTransaction</b></a> object or one of the following constants:<p>
MQ_NO_TRANSACTION: Specifies that the call is not part of a transaction.</p>
<p>
MQ_MTS_TRANSACTION: Default. Specifies that the call is part of the current MTS (Microsoft Transaction Server) transaction.</p>
<p>
MQ_XA_TRANSACTION: Specifies that the call is part of an externally coordinated, XA-compliant transaction.</p>
</td>
</tr>
<tr valign=top>
<td width=33%><i>WantDestinationQueue</i></td>
<td width=67%>Optional (default is FALSE). If TRUE, <a href="mqactx_23jj.htm"><b>DestinationQueueInfo</b></a> is updated when the message is read from the queue. Setting this property to TRUE may slow down the operation of the application.</td>
</tr>
<tr valign=top>
<td width=33%><i>WantBody</i></td>
<td width=67%>Optional (default is TRUE). If the Body of the message is not needed, set this property to FALSE to optimize the speed of the application.</td>
</tr>
<tr valign=top>
<td width=33%><i>ReceiveTimeout</i></td>
<td width=67%>Optional (default is INFINITE). Sets the message's <i>timeout</i> timer. Specifies how long (in milliseconds) MSMQ waits for a message to arrive.</td>
</tr>
</table><br>
<h4>Return Values</h4>
<p>
MSMQMessage object that represents the first message in the queue.</p>
<h4>Remarks</h4>
<p>
To retrieve messages from the queue, the queue must be opened with receive access (<i>Access = </i>MQ_RECEIVE_ACCESS). Messages retrieved from a queue are also removed from the queue. </p>
<p>
The <i>ReceiveTimeout</i> parameter is optional. However, if it is not specified the default value of <i>ReceiveTimeout</i> (INFINITE) forces the <a href="#_mq_receive"><b>Receive</b></a> call to block execution until a message arrives.</p>
<p>
The <i>pTransaction</i> parameter can be set to an <a href="mqactx_9c8e.htm"><b>MSMQTransaction</b></a> object or one of the constants described above. For information on the different types of transactions that MSMQ supports, see:
<ul>
<li>
<a href="msmq_guide_5q0j.htm">MSMQ Internal Transactions</a></li>
<li>
<a href="msmq_guide_0ltf.htm">MS DTC External Transactions</a></li>
<li>
<a href="msmq_guide_6mwj.htm">MTS Transactions</a></li>
<li>
<a href="msmq_guide_0ulv.htm">XA-Compliant Transactions</a></li>
</ul>
<p>
The <i>WantDestinationQueue</i> and <i>WantBody</i> parameters can be used to optimize the speed of the application.</p>
<p>
For synchronous calls, execution is stopped until a message is retrieved from the queue or the message's <i>timeout</i> timer expires. For an example of reading messages synchronously, see <a href="actvxuse_4794.htm">Reading Messages Synchronously</a>.</p>
<p>
For an example of reading messages asynchronously, see <a href="actvxuse_2apk.htm">Reading Messages Asynchronously</a>.</p>
<p>
To read messages in a queue without removing them, see the <a href="mqactx_0otn.htm"><b>Peek</b></a>, <a href="mqactx_5i0k.htm"><b>PeekCurrent</b></a>, or <a href="mqactx_4igk.htm"><b>PeekNext</b></a>.</p>
<h4>Example</h4>
<p>
This example locates a destination queue, sends a message to the queue to make sure at least one message is in the queue, and then removes all the messages from the queue. An error handler is added to trap any errors generated as a result of the <a href="#_mq_receive"><b>Receive</b></a> call.</p>
<p>
To try this example using Microsoft® Visual Basic® (version 5.0), paste the code into the Code window of a form, run the example, and click the form.</p>
<pre><code>Option Explicit
Dim query As New MSMQQuery
Dim qinfos As New MSMQQueueInfos
Dim qinfoDest As MSMQQueueInfo
Dim qDest As MSMQQueue
Dim msgSent As New MSMQMessage
Dim msgDest As MSMQMessage

Private Sub Form_Click()
            
   '***************************
   ' Locate destination queue
   '(create one if one doesn't
   ' exist).
   '***************************
   Set qinfos = query.LookupQueue(Label:="Destination Queue")
   qinfos.Reset
   Set qinfoDest = qinfos.Next
   If qinfoDest Is Nothing Then
      Set qinfoDest = New MSMQQueueInfo
      qinfoDest.PathName = ".\DestQueue"
      qinfoDest.Label = "Destination Queue"
      qinfoDest.Create
   End If
   
   '**************
   ' Open destination queue.
   '**************
   Set qDest = qinfoDest.Open(MQ_SEND_ACCESS, MQ_DENY_NONE)
   
   '**************
   ' Send Message.
   '**************
   msgSent.Label = "Test Message A"
   msgSent.Body = "This message is for testing how messages are read from the queue."
   
   msgSent.Send qDest
   qDest.Close
  
   '**********************
   ' Removes all messages
   ' in the queue.
   '**********************
   
   Set qDest = qinfoDest.Open(MQ_RECEIVE_ACCESS, MQ_DENY_NONE)
  
   On Error GoTo Handler
   
   Do While True
      Set msgDest = qDest.Receive(ReceiveTimeout:=1000)
      If msgDest Is Nothing Then Exit Do
      MsgBox msgDest.Label + " is removed from the queue."
   Loop

   Exit Sub

   '***************
   ' Error Handler
   '***************
   
Handler:
   If (Err = MQ_ERROR_IO_TIMEOUT) Then
      MsgBox "All messages are removed from the queue."
      Exit Sub
   Else
      MsgBox "Unexpected error!"
   End If

End Sub
<b> </b></code></pre>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 4.0 SP3 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Requires Windows 95 or later.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in mqoai.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use mqoa.lib.<br>
<b>&nbsp;&nbsp;Unicode: </b>Defined only as Unicode.</p>
<h4>See Also</h4>
<p>
<a href="mqactx_2wl5.htm"><b>Body</b></a>, <a href="mqactx_9mp1.htm"><b>Close</b></a>, <a href="mqactx_6605.htm"><b>Create</b></a>, <a href="mqactx_30do.htm"><b>Label</b></a>, <a href="mqactx_85np.htm"><b>LookupQueue</b></a>, <a href="mqactx_54px.htm"><b>MSMQMessage</b></a>, <a href="mqactx_1q7t.htm"><b>MSMQQuery</b></a>, <a href="mqactx_1qcl.htm"><b>MSMQQueue</b></a>, <a href="mqactx_01nz.htm"><b>MSMQQueueInfo</b></a>, <a href="mqactx_2ypf.htm"><b>MSMQQueueInfos</b></a>, <a href="mqactx_9h84.htm"><b>Next</b></a>, <a href="mqactx_61bi.htm"><b>Open</b></a>, <a href="mqactx_823p.htm"><b>PathName</b></a>, <a href="mqactx_4jhw.htm"><b>Reset</b></a>, <a href="mqactx_7k2s.htm"><b>Send</b></a></p>
<p>&nbsp;</p></body>
</HTML>
