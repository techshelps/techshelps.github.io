<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>MQOpenQueue</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_mq_mqopenqueue"></a>MQOpenQueue</h1>
<p>
The <b>MQOpenQueue</b> function opens a queue for sending messages to the queue or for reading its messages.</p>
<pre><code><b>HRESULT APIENTRY MQOpenQueue(
  LPCWSTR</b><i> lpwcsFormatName</i><b>,  </b>
<b>  DWORD</b><i> dwAccess</i><b>,        </b>
<b>  DWORD</b><i> dwShareMode</i><b>,     </b>
<b>  LPQUEUEHANDLE</b><i> phQueue  </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>lpwcsFormatName</i></dt>
<dd>
[in] Pointer to the <a href="msmqglos_3wva.htm#_mq_format_name_gly">format name</a> string of the queue you want to open. The format name can be in a public, private, or direct format. See the Remarks section for details on direct format names.</dd>
<dt>
<i>dwAccess</i></dt>
<dd>
[in] Specifies how the application accesses the queue (peek, send, or receive). This setting cannot be changed while the queue is open.
<p>
Specify one of the following access modes:

<dl>
<dt>
MQ_PEEK_ACCESS</dt>
<dd>
Messages can only be looked at. They cannot be removed from the queue.</dd>
<dt>
MQ_SEND_ACCESS</dt>
<dd>
Messages can only be sent to the queue.</dd>
<dt>
MQ_RECEIVE_ACCESS</dt>
<dd>
Messages can be looked at and removed from the queue. Whether a message is removed from the queue or looked at depends on the <i>dwAction</i> parameter of <a href="mqfunc_2cdh.htm"><b>MQReceiveMessage</b></a>. 
<p>
See <i>dwShareMode </i>for limiting who can receive the messages.
</dd>
</dl>
</dd>
<dt>
<i>dwShareMode</i></dt>
<dd>
[in] How the queue will be shared. Specify one of the following:
<dl>
<dt>
MQ_DENY_NONE</dt>
<dd>
Default. The queue is available to everyone. This setting must be used if <i>dwAccess</i> is set to MQ_SEND_ACCESS.</dd>
<dt>
MQ_DENY_RECEIVE_SHARE </dt>
<dd>
Limits those who can receive messages from the queue to this process. If the queue is already opened for receiving messages by another process, this call fails and returns MQ_ERROR_SHARING_VIOLATION. Applicable only when <i>dwAccess</i> is set to MQ_RECEIVE_ACCESS or MQ_PEEK_ACCESS.</dd>
</dl>
</dd>
<dt>
<i>phQueue</i></dt>
<dd>
[out] Handle to the opened queue.
</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
MQ_OK</dt>
<dd>
Indicates success.</dd>
<dt>
MQ_ERROR_ACCESS_DENIED</dt>
<dd>
The calling process does not have the required access rights to open the queue with the access mode specified by <i>dwAccess</i>.</dd>
<dt>
MQ_ERROR_ILLEGAL_FORMATNAME</dt>
<dd>
The <i>lpwcsFormatName </i>parameter specified an illegal format name.</dd>
<dt>
MQ_ERROR_NO_DS</dt>
<dd>
Cannot access <a href="msmqglos_3wv5.htm#_mq_active_directory_gly">Active Directory</a>.</dd>
<dt>
MQ_ERROR_QUEUE_NOT_FOUND</dt>
<dd>
(Public queues only)  Queue is not registered in <a href="msmqglos_3wv5.htm#_mq_active_directory_gly">Active Directory</a>.</dd>
<dt>
MQ_ERROR_SERVICE_NOT_AVAILABLE</dt>
<dd>
Cannot connect to the Queue Manager.</dd>
<dt>
MQ_ERROR_INVALID_PARAMETER</dt>
<dd>
One of the IN parameters is not valid.</dd>
<dt>
MQ_ERROR_SHARING_VIOLATION</dt>
<dd>
Another process already opened this queue with <i>dwShareMode</i> set to MQ_DENY_RECEIVE_SHARE, or another process has already opened the queue for receive so you can't specify MQ_DENY_RECEIVE_SHARE.</dd>
<dt>
MQ_ERROR_UNSUPPORTED_ACCESS_MODE</dt>
<dd>
The access mode specified by <i>dwAccess</i> is not supported. Set <i>dwAccess</i> to MQ_PEEK_MESSAGE, MQ_SEND_MESSAGE, or MQ_RECEIVE_MESSAGE and call <b>MQOpenQueue</b> again.</dd>
<dt>
MQ_ERROR_UNSUPPORTED_FORMATNAME_OPERATION</dt>
<dd>
The <i>lpwcsFormatName </i>parameter<i> </i>specified a format name that is not supported by the access rights specified in <i>dwAccess</i>. See the following Remarks section for restrictions on using direct format names.
</dd>
</dl>
<h4>Remarks</h4>
<p>
If the format name of the queue is unknown, see <a href="msmq_guide_1sbp.htm">Format Name</a> to find ways to obtain a new format name.</p>
<p>
Direct format names can only be used to open a queue for sending messages. A direct format name instructs MSMQ not to use <a href="msmqglos_3wv5.htm#_mq_active_directory_gly">Active Directory</a> (for public queues) or the local computer (for private queues) to get routing information. When a direct format name is used to send messages, all routing information is derived from the provided format name and MSMQ sends the messages to the queue in a single hop.</p>
<p>
Setting <i>dwShareMode</i> to MQ_DENY_RECEIVE_SHARE indicates that until the calling application calls <a href="mqfunc_19np.htm"><b>MQCloseQueue</b></a>, no other MSMQ applications can open a queue with receive access.</p>
<p>
When opening a queue on a remote computer, MSMQ does not check for the existence of the queue when <i>dwAccess</i> is set to MQ_SEND_ACCESS. In addition, if <i>dwAccess</i> is set to MQ_RECEIVE_ACCESS, the computer opening the queue must support the same protocol as the remote computer where the queue is located.</p>
<p>
Journal queues and dead letter queues can only be opened with <i>dwAccess</i> set to MQ_PEEK_ACCESS or MQ_RECEIVE_ACCESS. You cannot send messages to a journal queue.</p>
<p>
<a href="msmqglos_3wva.htm#_mq_foreign_queue_gly">Foreign queues</a> cannot be opened using a direct format name. MSMQ needs the routing information stored in <a href="msmqglos_3wv5.htm#_mq_active_directory_gly">Active Directory</a> to find an MSMQ Connector Sever for the foreign queue.</p>
<p>
If the calling application does not have sufficient access rights to a queue, the following two things can happen:
<ul>
<li>
If <i>dwAccess</i> is set to MQ_ACCESS_SEND, <b>MQOpenQueue</b> will succeed, but errors will be returned when the application tries to send a message.</li>
<li>
If <i>dwAccess</i> is set to MQ_PEEK_ACCESS or MQ_RECEIVE_ACCESS, <b>MQOpenQueue</b> will fail and return MQ_ERROR_ACCESS_DENIED. In this case a queue handle is not returned to <i>phQueue</i>. </li>
</ul>
<p>
To change the access rights of the queue, call <a href="mqfunc_4rg9.htm"><b>MQSetQueueSecurity</b></a>. The following table lists the access right needed to open the queue in peek, send, or receive access mode.</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=51%>Queue Access Mode </th>
<th align=left width=49%>Queue Access Right</th>
</tr>
<tr valign=top>
<td width=51%>MQ_PEEK_MESSAGE</td>
<td width=49%>MQSEC_PEEK_MESSAGE</td>
</tr>
<tr valign=top>
<td width=51%>MQ_SEND_MESSAGE</td>
<td width=49%>MQSEC_WRITE_MESSAGE</td>
</tr>
<tr valign=top>
<td width=51%>MQ_RECEIVE_MESSAGE</td>
<td width=49%>MQSEC_RECEIVE_MESSAGE</td>
</tr>
</table><br>
<p>
There is no provision to change the access mode of the queue when it is open. Either close and open the queue with the desired access mode, or open a second instance of the queue.</p>
<h4>For Windows NT</h4>
<p>
For Windows NT, a queue handle is always inherited by a child process. If a child process is created by the process that opened the queue, the queue handle is inherited by the child process.</p>
<h4>For Windows 95</h4>
<p>
A queue handle is not inherited by a child process.</p>
<h4>Examples</h4>
<p>
For examples of using <b>MQOpenQueue</b>, see:
<ul>
<li>
<a href="msmquse_0max.htm">Opening a Queue</a></li>
<li>
<a href="msmquse_8k89.htm">Reading Messages Using a Cursor</a> </li>
<li>
<a href="msmquse_13l5.htm">Reading Messages in a Dead Letter Queue</a> </li>
<li>
<a href="msmquse_75nt.htm">Reading Messages in a Machine Journal</a> </li>
<li>
<a href="msmquse_552h.htm">Sending Private Messages</a> </li>
</ul>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 4.0 SP3 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Requires Windows 95 or later.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in mq.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use mqrt.lib.<br>
<b>&nbsp;&nbsp;Unicode: </b>Defined only as Unicode.</p>
<h4>See Also</h4>
<p>
<a href="mqfunc_19np.htm"><b>MQCloseQueue</b></a>,<a href="mqfunc_2cdh.htm"> <b>MQReceiveMessage</b></a>, <a href="mqfunc_4rg9.htm"><b>MQSetQueueSecurity</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
