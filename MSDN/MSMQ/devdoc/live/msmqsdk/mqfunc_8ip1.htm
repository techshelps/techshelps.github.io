<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>MQSendMessage</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_mq_mqsendmessage"></a>MQSendMessage</h1>
<p>
The <b>MQSendMessage</b> function sends a message to the queue corresponding to the handle <i>hDestinationQueue</i>.</p>
<pre><code><b>HRESULT APIENTRY MQSendMessage(
  QUEUEHANDLE</b><i> hDestinationQueue</i><b>,  </b>
<b>  MQMSGPROPS </b><i>*pMessageProps</i><b>,      </b>
<b>  ITransaction </b><i>*pTransaction      </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>hDestinationQueue</i></dt>
<dd>
[in] Handle to the queue where you want to send the message.</dd>
<dt>
<i>pMessageProps</i></dt>
<dd>
[in] Pointer to an <a href="mqstruc_559v.htm"><b>MQMSGPROPS</b></a> structure describing the message to send.</dd>
<dt>
<i>pTransaction</i></dt>
<dd>
[in] Must be a pointer to a transaction object, a constant, or NULL.
<p>
Transaction object can be obtained internally from MSMQ (by calling <a href="mqfunc_2xta.htm"><b>MQBeginTransaction</b></a>) or externally from Microsoft® Distributed Transaction Coordinator (MS DTC).

<p>
Constants include: 

<dl>
<dt>
MQ_NO_TRANSACTION</dt>
<dd>
Specifies that the call is not part of a transaction.</dd>
<dt>
MQ_MTS_TRANSACTION</dt>
<dd>
Specifies that the current Microsoft Transaction Server (MTS) transaction is used to send the message.</dd>
<dt>
MQ_SINGLE_MESSAGE</dt>
<dd>
Sends a single message as a transaction. Messages sent as a single-message transaction must be sent to a transaction queue. </dd>
<dt>
MQ_XA_TRANSACTION</dt>
<dd>
Specifies that the call is part of an externally coordinated, XA-compliant transaction.</dd>
</dl>

<p>
NULL indicates the message is not sent as part of a transaction.

</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
MQ_OK</dt>
<dd>
Indicates success.</dd>
<dt>
MQ_ERROR_ACCESS_DENIED</dt>
<dd>
The queue was not opened with MQ_SEND_ACCESS rights.</dd>
<dt>
MQ_ERROR_BAD_SECURITY_CONTEXT</dt>
<dd>
The security context buffer (<a href="mqprop_27lg.htm">PROPID_M_SECURITY_CONTEXT</a>) is corrupted.</dd>
<dt>
MQ_ERROR_CORRUPTED_INTERNAL_CERTIFICATE</dt>
<dd>
The internal security certificate provided by MSMQ is corrupted. Register the internal certificate again using MSMQ Control Panel.</dd>
<dt>
MQ_ERROR_CORRUPTED_PERSONAL_CERT_STORE</dt>
<dd>
The Microsoft® Internet Explorer personal certificate store is corrupted.</dd>
<dt>
MQ_ERROR_CORRUPTED_SECURITY_DATA</dt>
<dd>
The operating system encountered an error when calling one of the cryptographic functions (CryptoAPI).</dd>
<dt>
MQ_ERROR_COULD_NOT_GET_USER_SID</dt>
<dd>
<b>MQSendMessage</b> could not retrieve the user identifier specified by <a href="mqprop_0p7o.htm">PROPID_M_SENDERID</a>.</dd>
<dt>
MQ_ERROR_DTC_CONNECT</dt>
<dd>
MSMQ was unable to connect to MS DTC.</dd>
<dt>
MQ_ERROR_ILLEGAL_FORMATNAME</dt>
<dd>
Format name specified in <a href="mqprop_0yp1.htm">PROPID_M_ADMIN_QUEUE</a> or <a href="mqprop_204l.htm">PROPID_M_RESP_QUEUE</a> is illegal.</dd>
<dt>
MQ_ERROR_INSUFFICIENT_RESOURCES</dt>
<dd>
Insufficient resources to complete operation (for example, an attempt was made to send a message whose body contained more than 4 MB of data). Operation failed.</dd>
<dt>
MQ_ERROR_INVALID_CERTIFICATE</dt>
<dd>
The external security certificate passed in <a href="mqprop_2nsk.htm">PROPID_M_SENDER_CERT</a> is not valid. The certificate is corrupted or not placed in the Microsoft Internet Explorer personal certificate store.</dd>
<dt>
MQ_ERROR_INVALID_HANDLE</dt>
<dd>
The queue handle specified in <i>hDestinationQueue </i>is not valid.</dd>
<dt>
MQ_ERROR_MESSAGE_STORAGE_FAILED</dt>
<dd>
A recoverable message (<a href="mqprop_28e1.htm">PROPID_M_DELIVERY</a> is set to MQMSG_DELIVERY_RECOVERABLE) could not be stored on the local computer.</dd>
<dt>
MQ_ERROR_NO_INTERNAL_USER_CERT</dt>
<dd>
The internal security certificate provided by MSMQ is not registered. Register the internal certificate using MSMQ Control Panel. </dd>
<dt>
MQ_ERROR_PROPERTY</dt>
<dd>
One or more properties resulted in an error.</dd>
<dt>
MQ_ERROR_SERVICE_NOT_AVAILABLE</dt>
<dd>
Cannot connect to the Queue Manager.</dd>
<dt>
MQ_ERROR_STALE_HANDLE</dt>
<dd>
The specified queue handle was obtained in a previous session of the Queue Manager service. Close the queue and open it again to obtain a fresh handle.</dd>
<dt>
MQ_ERROR_TRANSACTION_USAGE</dt>
<dd>
Transaction error. An attempt was made to open a remote queue for read access from within a transaction, or an attempt was made to read a message from a <a href="msmqglos_3wvi.htm#_mq_non_transaction_queue_gly">non-transaction queue</a> from within a transaction.</dd>
<dt>
MQ_INFORMATION_PROPERTY</dt>
<dd>
One or more of the properties resulted in a warning even though the function completed.
</dd>
</dl>
<h4>Remarks</h4>
<p>
All message properties can be attached to a message. Some are attached by MSMQ, and others can be attached by the sending application. For a complete list of all the message properties, see <a href="msmquse_3fft.htm">Sending Messages to a Queue</a>.</p>
<p>
<b>Note</b>&nbsp;&nbsp;Each MSMQ message can have no more than 4 MB of data.</p>
<p>
The PROPID_M_BODY property is a <b>CAUI1</b> structure that contains the message body. The caui1.cElems field of this structure represents the size of the message body.</p>
<p>
The sending application can receive two types of messages in response to the messages it sends:
<ul>
<li>
If <a href="mqprop_204l.htm">PROPID_M_RESP_QUEUE</a> is passed to <b>MQSendMessage</b>, the receiving application can send application-defined response messages back to the specified queue. For information on response queues, see <a href="msmq_guide_8ib7.htm">Response Queues</a>.</li>
<li>
If <a href="mqprop_0yp1.htm">PROPID_M_ADMIN_QUEUE</a> and <a href="mqprop_9411.htm">PROPID_M_ACKNOWLEDGE</a> are passed to <b>MQSendMessage</b>, MSMQ can return acknowledgment messages back to the <a href="msmqglos_3wv5.htm#_mq_administration_queue_gly">administration queue</a>.</li>
</ul>
<p>
You can use the same queue for the response queue (PROPID_M_RESP_QUEUE) and <a href="msmqglos_3wv5.htm#_mq_administration_queue_gly">administration queue</a> (PROPID_M_ADMIN_QUEUE)<i>.</i></p>
<p>
To save a copy of a message after it is successfully sent, set <a href="mqprop_20q4.htm">PROPID_M_JOURNAL</a> to MQMSG_JOURNAL or MQMSG_JOURNAL | MQMSG_DEADLETTER and attach it to the message. This tells MSMQ to save a copy of the message in the sending computer's <a href="msmqglos_3wvh.htm#_mq_machine_journal_gly">machine journal</a> after the message is successfully sent. For more information, see <a href="msmq_guide_9s4z.htm">Journal Queues</a>.</p>
<p>
To save a copy of a message if it does not reach its destination, set <a href="mqprop_20q4.htm">PROPID_M_JOURNAL</a> to MQMSG_DEADLETTER or MQMSG_JOURNAL | MQMSG_DEADLETTER and attach it to the message. This tells MSMQ to save a copy of the message in the <a href="msmqglos_3wv8.htm#_mq_dead_letter_queue_gly">dead letter queue</a>. For non-transaction messages, the message is saved on the computer that could not deliver the message. This could be the sending machine or any MSMQ server used to route the message to its destination. For transaction messages, the message is saved on the source machine where it originated. For information on dead letter queues, see <a href="msmq_guide_0s37.htm">Dead Letter Queues</a>. </p>
<p>
When impersonating another user, <a href="mqfunc_031w.htm"><b>MQGetSecurityContext</b></a> must be called. Typically, <b>MQGetSecurityContext</b> is only needed when sending authenticated messages.</p>
<p>
PROPID_M_RESP_QUEUE can be used to send the format name of a private queue to another application. This is typically done when the sending application wants to make a private queue available to other applications.</p>
<h5>Sending Messages Within a Transaction</h5>
<p>
If the send is part of a transaction (<i>pTransaction</i> is not set to MQ_NO_TRANSACTION or NULL), the <i>hDestinationQueue</i> parameter must refer to a transaction queue.</p>
<p>
During a transaction, MSMQ performs the following tasks:
<ul>
<li>
The message's priority property (<a href="mqprop_7abd.htm">PROPID_M_PRIORITY</a>) is set to 0.</li>
<li>
The message's delivery property (<a href="mqprop_28e1.htm">PROPID_M_DELIVERY</a>) is set to MQMSG_DELIVERY_RECOVERABLE.</li>
<li>
The <i>time-to-be-received</i> and <i>time-to-reach-queue</i> timers are set by the first message sent in the transaction. All subsequent messages use the first message's timer settings.</li>
<li>
As part of a transaction, messages are not sent until the Commit time frame. For information on lTransaction::Commit, see the Platform SDK.</li>
</ul>
<h5>Requesting a Response</h5>
<p>
The sending application can pass <a href="mqprop_204l.htm">PROPID_M_RESP_QUEUE</a> to <b>MQSendMessage</b> to indicate that it expects a response from the receiving application. The messages returned to the response queue specified by this property are application-defined.</p>
<h4>Examples</h4>
<p>
For examples of using <b>MQSendMessage</b>, see:
<ul>
<li>
<a href="msmquse_9fu1.htm">Sending Messages that Request Acknowledgments</a> </li>
<li>
<a href="msmquse_8w2x.htm">Sending Messages that Request a Response</a> </li>
<li>
<a href="msmquse_552h.htm">Sending Private Messages</a></li>
<li>
<a href="msmquse_2esp.htm">Sending Messages Using an Internal Transaction</a></li>
<li>
<a href="msmquse_5drd.htm">Sending Messages Using an MS DTC External Transaction</a> </li>
</ul>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 4.0 SP3 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Requires Windows 95 or later.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in mq.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use mqrt.lib.<br>
<b>&nbsp;&nbsp;Unicode: </b>Defined only as Unicode.</p>
<h4>See Also</h4>
<p>
<a href="mqfunc_031w.htm"><b>MQGetSecurityContext</b></a>, <a href="mqstruc_559v.htm"><b>MQMSGPROPS</b></a>, <a href="mqfunc_4rg9.htm"><b>MQSetQueueSecurity</b></a>, <a href="mqprop_9411.htm">PROPID_M_ACKNOWLEDGE</a>, <a href="mqprop_0yp1.htm">PROPID_M_ADMIN_QUEUE</a>, <a href="mqprop_6wzd.htm">PROPID_M_BODY</a>, <a href="mqprop_7b6t.htm">PROPID_M_BODY_SIZE</a>, <a href="mqprop_53qr.htm">PROPID_M_CLASS</a>, <a href="mqprop_28e1.htm">PROPID_M_DELIVERY</a>, <a href="mqprop_20q4.htm">PROPID_M_JOURNAL</a>, <a href="mqprop_0vxg.htm">PROPID_M_MSGID</a>, <a href="mqprop_7abd.htm">PROPID_M_PRIORITY</a>, <a href="mqprop_204l.htm">PROPID_M_RESP_QUEUE</a>, <a href="mqprop_0p7o.htm">PROPID_M_SENDERID</a>, <a href="mqprop_7p5x.htm">PROPID_M_SENTTIME</a>, <a href="mqprop_531g.htm">PROPID_M_TIME_TO_BE_RECEIVED</a>, <a href="mqprop_8ahx.htm">PROPID_M_TIME_TO_REACH_QUEUE</a> </p>
<p>&nbsp;</p></body>
</HTML>
