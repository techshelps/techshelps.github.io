<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>MQSetQueueSecurity</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_mq_mqsetqueuesecurity"></a>MQSetQueueSecurity</h1>
<p>
The <b>MQSetQueueSecurity</b> function sets the access control security for the queue. </p>
<pre><code><b>HRESULT APIENTRY MQSetQueueSecurity(
  LPCWSTR</b><i> lpwcsFormatName</i><b>,                    </b>
<b>  SECURITY_INFORMATION </b><i>*SecurityInformation</i><b>,  </b>
<b>  PSECURITY_DESCRIPTOR </b><i>*pSecurityDescriptor  </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>lpwcsFormatName</i></dt>
<dd>
[in] Pointer to the <a href="msmq_guide_1sbp.htm">format name</a> string of the queue to be secured. You cannot specify a direct format name.</dd>
<dt>
<i>securityInformation</i></dt>
<dd>
[in] Specifies a <b>SECURITY_INFORMATION</b> structure identifying the contents of the security descriptor pointed to by the <i>pSecurityDescriptor</i> parameter. (For information on the <b>SECURITY_INFORMATION</b> structure, see the Microsoft Platform SDK.)</dd>
<dt>
<i>pSecurityDescriptor</i></dt>
<dd>
[in] Pointer to a <b>SECURITY_DESCRIPTOR</b> structure. Can be set to NULL; see default values in the following Return Values section. (For information on the <b>SECURITY_DESCRIPTOR</b> structure, see the Microsoft Platform SDK.)
</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
MQ_OK</dt>
<dd>
Indicates success.</dd>
<dt>
MQ_ERROR_ACCESS_DENIED</dt>
<dd>
The process owner does not have the sufficient access rights to set the queue security information. The following access rights may be required:
<ul>
<li>
MQSEC_CHANGE_QUEUE_PERMISSIONS</li>
<li>
MQSEC_TAKE_QUEUE_OWNERSHIP</li>
</ul>

<p>
If access is denied, contact someone who has rights to modify the security descriptor.
</dd>
<dt>
MQ_ERROR_FUNCTION_NOT_SUPPORTED</dt>
<dd>
<b>MQSetQueueSecurity</b> is not supported in Windows 95.</dd>
<dt>
MQ_ERROR_ILLEGAL_FORMATNAME</dt>
<dd>
The <i>lpwcsFormatName</i> parameter<i> </i>specified an illegal format name.</dd>
<dt>
MQ_ERROR_NO_DS</dt>
<dd>
Cannot access <a href="msmqglos_3wv5.htm#_mq_active_directory_gly">Active Directory</a>.</dd>
<dt>
MQ_ERROR_PRIVILEGE_NOT_HELD</dt>
<dd>
The process owner does not have the proper privilege to set the queue's system access control list.</dd>
<dt>
MQ_ERROR_SERVICE_NOT_AVAILABLE</dt>
<dd>
Cannot connect to the Queue Manager.</dd>
<dt>
MQ_ERROR_UNSUPPORTED_FORMATNAME_OPERATION</dt>
<dd>
The <i>lpwcsFormatName</i> parameter<i> </i>contains a public or private queue using a <a href="msmqglos_3wv8.htm#_mq_direct_format_name_gly">direct format name</a> or a <a href="msmqglos_3wve.htm#_mq_journal_queue_gly">journal</a>, <a href="msmqglos_3wv8.htm#_mq_dead_letter_queue_gly">dead letter</a>, or <a href="msmqglos_3wv7.htm#_mq_connector_queue_gly">connector queue</a>.
</dd>
</dl>
<h4>Remarks</h4>
<p>
Following are the default values for the security descriptor.</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=41%>Default Value</th>
<th align=left width=59%>Meaning</th>
</tr>
<tr valign=top>
<td width=41%>Owner </td>
<td width=59%>The process user.</td>
</tr>
<tr valign=top>
<td width=41%>Group </td>
<td width=59%>The process group.</td>
</tr>
<tr valign=top>
<td width=41%>DACL </td>
<td width=59%>Full control for the process user. All processes of other users can get queue properties, get queue security, and send messages to the queue.</td>
</tr>
<tr valign=top>
<td width=41%>SACL</td>
<td width=59%>None.</td>
</tr>
</table><br>
<p>
The format name of the queue (specified by <i>lpwcsFormatName</i>) must be a <a href="msmqglos_3wvk.htm#_mq_public_format_name_gly">public</a> or <a href="msmqglos_3wvk.htm#_mq_private_format_name_gly">private format name</a>. MSMQ must be able to access <a href="msmqglos_3wv5.htm#_mq_active_directory_gly">Active Directory</a> (for public queues) or the local computer (for private queues) to get the queue's security descriptor.</p>
<p>
If the format name of the queue is unknown, see <a href="msmq_guide_1sbp.htm">Format Name</a> to find ways to obtain a new format name.</p>
<p>
The following access rights and privileges are required to change the queue's security descriptor.</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=44%>Access right/privilege</th>
<th align=left width=56%>Required to</th>
</tr>
<tr valign=top>
<td width=44%>MQSEC_TAKE_QUEUE<br>
_OWNERSHIP </td>
<td width=56%>Change the owner of the queue. This access right is equivalent to WRITE_OWNER as defined by the Win32 header files.</td>
</tr>
<tr valign=top>
<td width=44%>SE_TAKE_OWNERSHIP<br>
_NAME</td>
<td width=56%>Change the owner of the queue. This privilege can be used instead of having the MQSEC_TAKE_QUEUE_OWNERSHIP access on the queue. If a user has this privilege on the server, the user can change the owner of any public queue in the enterprise. If the user has this privilege on the local computer, the user can change the owner of any private queue.</td>
</tr>
<tr valign=top>
<td width=44%>MQSEC_CHANGE_QUEUE<br>
_PERMISSIONS </td>
<td width=56%>Change the queue's discretionary access control list (DACL) if the process is not the owner of the queue. This access right is equivalent to WRITE_DAC as defined by the Win32 header files.</td>
</tr>
<tr valign=top>
<td width=44%>SE_SECURITY_NAME </td>
<td width=56%>Change the queue's system ACL (SACL); this privilege must be enabled for the calling process on <a href="msmqglos_3wv5.htm#_mq_active_directory_gly">Active Directory</a> for public queues and on the local computer for private queues.</td>
</tr>
</table><br>
<p>
<a href="mqfunc_2w6x.htm"><b>MQGetQueueSecurity</b></a> cannot retrieve the security descriptor of a <a href="msmqglos_3wve.htm#_mq_journal_queue_gly">journal</a>, <a href="msmqglos_3wv8.htm#_mq_dead_letter_queue_gly">dead letter</a>, <a href="msmqglos_3wv7.htm#_mq_connector_queue_gly">connector</a>, or <a href="msmqglos_3wva.htm#_mq_foreign_queue_gly">foreign queue</a>.</p>
<p>
A public queue's access security cannot be set if there is no connection to <a href="msmqglos_3wv5.htm#_mq_active_directory_gly">Active Directory</a>. This restriction applies to <a href="msmqglos_3wv8.htm#_mq_dependent_client_gly">dependent client</a> computers, <a href="msmqglos_3wvd.htm#_mq_independent_client_gly">independent client</a> computers that are working offline, and MSMQ routing servers (FRS). (For information on offline operations, see <a href="msmq_guide_72es.htm">MSMQ Offline Support</a>.)</p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 4.0 SP3 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Requires Windows 95 or later.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in mq.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use mqrt.lib.<br>
<b>&nbsp;&nbsp;Unicode: </b>Defined only as Unicode.</p>
<h4>See Also</h4>
<p>
<a href="mqfunc_2w6x.htm"><b>MQGetQueueSecurity</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
