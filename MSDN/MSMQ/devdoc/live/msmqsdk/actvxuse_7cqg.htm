<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Opening a Queue</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mq_opening_a_queue_activex"></a>Opening a Queue</h2>
<p>
Queues can be opened by calling the <a href="mqactx_01nz.htm"><b>MSMQQueueInfo</b></a> object's <a href="mqactx_61bi.htm"><b>Open</b></a> method. The <b>Open</b> method returns an <a href="mqactx_1qcl.htm"><b>MSMQQueue</b></a> object that can be used for:
<ul>
<li>
Sending messages to the queue (<a href="mqactx_7k2s.htm"><b>Send</b></a>).</li>
<li>
Enabling notification for reading messages asynchronously (<a href="mqactx_10ha.htm"><b>EnableNotification</b></a>).</li>
<li>
Reading messages in the queue (<a href="mqactx_0otn.htm"><b>Peek</b></a>, <a href="mqactx_4igk.htm"><b>PeekNext</b></a>, <a href="mqactx_80dh.htm"><b>Receive</b></a>).</li>
<li>
Closing the queue (<a href="mqactx_9mp1.htm"><b>Close</b></a>).</li>
</ul>
<p>
<b>Note</b>&nbsp;&nbsp;The <a href="mqactx_1qcl.htm"><b>MSMQQueue</b></a> object exposes a queue handle that can be used to call MSMQ API functions directly. For example, in Microsoft® Visual Basic®, MSMQ functions can be called directly using the Declare Function facility.</p>
<p>
When opening a queue, the application specifies the access rights and share mode of the queue. The queue's access rights indicate if the application is going to send messages to the queue, peek at the messages in the queue, or retrieve messages from the queue. The queue's share mode indicates who else can use the queue while the application is using the queue.</p>
<p>
In most cases, a queue can be opened without checking its access rights. However, if MQ_ERROR_ACCESS_DENIED is returned to the <a href="mqactx_61bi.htm"><b>Open</b></a> call, the queue's access control is blocking the application from opening the queue. A queue's access control can block sending messages, retrieving messages, or peeking at messages. For information about access rights, see <a href="msmq_guide_8i0c.htm">Access Control</a>.</p>
<p>
The properties of the opened queue are based on the current properties of the <b>MSMQQueueInfo</b> object used to open the queue. While the queue is opened, the application can always see the current properties of the queue by calling the <b>MSMQQueue</b> object's <a href="mqactx_9433.htm"><b>queueInfo</b></a> property.</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To open a queue</h5>
<ol>
<li>
Determine the queue's access mode. Are messages going to be sent to the queue (<i>lAccess</i> = MQ_SEND_ACCESS), retrieved from the queue(<i>lAccess</i> = MQ_RECEIVE_ACCESS), or peeked at without removing them from the queue (<i>lAccess</i> = MQ_PEEK_ACCESS)?<p>
When a queue is opened with receive access, the application can also peek at the queue's messages. However, the reverse is not true. When a queue is opened with peek access, the application cannot retrieve a message from the queue.
</li>
<li>
Determine the queue's share mode. If messages are going to be retrieved from the queue (<i>lAccess</i> = MQ_RECEIVE_ACCESS), determine if the application should not allow others to retrieve messages at the same time it is retrieving messages(<i>ShareMode </i>= MQ_DENY_RECEIVE_SHARE). Using this setting does not stop other applications from peeking at the messages in the queue, it only prevents them from retrieving messages at the same time the calling application is retrieving messages.</li>
<li>
Verify that the queue information (<b>MSMQQueueInfo</b>) object exists and that a queue object (<b>MSMQQueue</b>) is available.</li>
<li>
Call <a href="mqactx_61bi.htm"><b>Open</b></a>, setting the queue's access mode and share mode to the appropriate value.</li>
</ol>
<h4>Example: Opening a queue for sending messages</h4>
<p>
This example creates a public queue and opens the queue for sending messages. To try this example using Microsoft® Visual Basic® (version 5.0), paste the code into the Declaration section of a form, run the example, and click the form.</p>
<pre><code>Dim qinfo As New MSMQQueueInfo
Dim q As New MSMQQueue

Private Sub Form_Click()
    
  Set qinfo = New MSMQQueueInfo
  qinfo.PathName = ".\SendTest"
  qinfo.Label = "Test Queue"
  qinfo.Create
  
  Set q = qinfo.Open(MQ_SEND_ACCESS, MQ_DENY_NONE)
  If q.IsOpen Then
     MsgBox "The queue is open for sending messages."
     Else
        MsgBox "The queue is not open!"
  End If

End Sub
 </code></pre>
<h4>Example: Opening a queue for reading messages</h4>
<p>
This example creates a public queue and opens the queue for retrieving messages. To try this example using Microsoft Visual Basic (version 5.0), paste the code into the Declaration section of a form, run the example, and click the form.</p>
<pre><code>Dim qinfo As New MSMQQueueInfo
Dim q As New MSMQQueue

Private Sub Form_Click()
    
  Set qinfo = New MSMQQueueInfo
  qinfo.PathName = ".\ReceiveTest"
  qinfo.Label = "Test Queue"
  qinfo.Create
  
  Set q = qinfo.Open(MQ_RECEIVE_ACCESS, MQ_DENY_NONE)
  If q.IsOpen Then
     MsgBox "The queue is open to receive messages."
     Else
        MsgBox "The queue is not open!"
  End If

End Sub
 </code></pre>
<p>&nbsp;</p></body>
</HTML>
