<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>MQCreateQueue</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_mq_mqcreatequeue"></a>MQCreateQueue</h1>
<p>
The <b>MQCreateQueue</b> function creates a queue and registers it in <a href="msmqglos_3wv5.htm#_mq_active_directory_gly">Active Directory</a> (for public queues) or on the local computer (for private queues). It also attaches the specified queue properties (default values are used for all properties that are not specified) and security attributes to the queue and returns a format name that can be used to open the queue.</p>
<pre><code><b>HRESULT APIENTRY MQCreateQueue(
  PSECURITY_DESCRIPTOR</b><i> pSecurityDescriptor</i><b>,  </b>
<b>  MQQUEUEPROPS </b><i>*pQueueProps</i><b>,                 </b>
<b>  LPWSTR</b><i> lpwcsFormatName</i><b>,                    </b>
<b>  LPDWORD</b><i> lpdwFormatNameLength               </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>pSecurityDescriptor</i></dt>
<dd>
[in] Pointer to a <b>SECURITY_DESCRIPTOR</b> structure that specifies the security information associated with the queue. (For information on the <b>SECURITY_DESCRIPTOR</b> structure, see the Microsoft Platform SDK.) Following are the default values (NULL pointer indicates all default values are used):
<dl>
<dt>
Owner</dt>
<dd>
The process user.</dd>
<dt>
Group</dt>
<dd>
The process group.</dd>
<dt>
DACL</dt>
<dd>
Full control for the creator of the queue. All other processes can get queue properties, get queue security, and send messages to the queue.</dd>
<dt>
SACL</dt>
<dd>
None.</dd>
</dl>
</dd>
<dt>
<i>pQueueProps</i></dt>
<dd>
[in, out] Pointer to the <a href="mqstruc_2ygj.htm"><b>MQQUEUEPROPS</b></a> structure that specifies the created queue's properties.
<p>
On input, the <b>cProp</b> member of <b>MQQUEUEPROPS</b> specifies the number of queue properties supplied, the <b>aPropID</b> array specifies their property identifiers, and the <b>aPropVar </b>array specifies their values.

<p>
On output, the optional <b>aStatus</b> array, if it was included in <b>MQQUEUEPROPS</b>, indicates the status of the properties.
</dd>
<dt>
<i>lpwcsFormatName</i></dt>
<dd>
[out] Pointer to buffer to receive the <a href="msmqglos_3wva.htm#_mq_format_name_gly">format name</a> for the queue (NULL pointer allowed). This buffer is called the format name buffer.</dd>
<dt>
<i>lpdwFormatNameLength</i></dt>
<dd>
[in, out] On input, specifies the length of the <i>lpwcsFormatName </i>buffer (in Unicode characters). Public queues require at least 44 Unicode characters; private queues require at least 54. NULL pointer is not allowed.
<p>
On output, indicates the length of the returned <a href="msmqglos_3wva.htm#_mq_format_name_gly">format name</a> string, including the null-terminating character. If the output value is greater than the initial input value, the supplied buffer is not large enough to contain the complete format name string and MQ_INFORMATION_FORMATNAME_BUFFER_TOO_SMALL is returned. In this case, the queue is created and only a portion of the format name is returned.

</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
MQ_OK</dt>
<dd>
Indicates success.</dd>
<dt>
MQ_ERROR_ACCESS_DENIED</dt>
<dd>
The process does not have the rights to create a queue on this computer.</dd>
<dt>
MQ_ERROR_ILLEGAL_PROPERTY_VALUE</dt>
<dd>
An illegal property value is specified.</dd>
<dt>
MQ_ERROR_ILLEGAL_QUEUE_PATHNAME</dt>
<dd>
<a href="mqprop_0pt1.htm">PROPID_Q_PATHNAME</a> contains an illegal MSMQ pathname string.</dd>
<dt>
MQ_ERROR_ILLEGAL_SECURITY_DESCRIPTOR</dt>
<dd>
The passed security descriptor has an invalid structure.</dd>
<dt>
MQ_ERROR_INSUFFICIENT_PROPERTIES</dt>
<dd>
No MSMQ pathname was specified (PROPID_Q_PATHNAME).</dd>
<dt>
MQ_ERROR_INVALID_OWNER</dt>
<dd>
The specified MSMQ pathname (PROPID_Q_PATHNAME) contains the name of an unrecognized machine.</dd>
<dt>
MQ_ERROR_NO_DS</dt>
<dd>
Cannot access <a href="msmqglos_3wv5.htm#_mq_active_directory_gly">Active Directory</a>.</dd>
<dt>
MQ_ERROR_PROPERTY</dt>
<dd>
One or more properties resulted in an error.</dd>
<dt>
MQ_ERROR_PROPERTY_NOTALLOWED</dt>
<dd>
A specified property is not valid when creating the queue.</dd>
<dt>
MQ_ERROR_QUEUE_EXISTS</dt>
<dd>
A queue with an identical MSMQ pathname or instance already exists.</dd>
<dt>
MQ_ERROR_SERVICE_NOT_AVAILABLE</dt>
<dd>
Cannot connect to the Queue Manager.</dd>
<dt>
MQ_ERROR_WRITE_NOT_ALLOWED</dt>
<dd>
Cannot add a queue to <a href="msmqglos_3wv5.htm#_mq_active_directory_gly">Active Directory</a>.</dd>
<dt>
MQ_INFORMATION_FORMATNAME_BUFFER_TOO_SMALL</dt>
<dd>
The queue was created successfully, but the size of the buffer for receiving the format name of the created queue is too small.</dd>
<dt>
MQ_INFORMATION_PROPERTY</dt>
<dd>
The function completed, but one or more properties resulted in a warning.
</dd>
</dl>
<h4>Remarks</h4>
<p>
You must always specify the queue's <a href="msmq_guide_8f1h.htm">MSMQ pathname</a> (<a href="mqprop_0pt1.htm">PROPID_Q_PATHNAME</a>) before calling <b>MQCreateQueue</b>. The PROPID_Q_PATHNAME property tells MSMQ where to store the queue's messages, if the queue is public or private, and the name of the queue. </p>
<p>
Public queues are registered in <a href="msmqglos_3wv5.htm#_mq_active_directory_gly">Active Directory</a>, and private queues are registered on the local computer. All queues exist until explicitly deleted.</p>
<p>
Private queues can only be created on the local computer. When a private queue is created, MSMQ stores a description of the queue in the LQS directory on the local computer (by default, \program files\msmq\storage\lqs). Applications must ensure that no other private queues with the same name exist on a local computer. If a queue with the same name already exists, MSMQ will return an MQ_ERROR_QUEUE_EXISTS error when <b>MQCreateQueue</b> is called.</p>
<p>
Setting other queue properties is optional. If a property is not specified in the <i>pQueueProps</i> parameter, MSMQ uses its default value when creating the queue. After the queue is created, its properties can be changed by calling <a href="mqfunc_0wxf.htm"><b>MQSetQueueProperties</b></a>.</p>
<p>
To use a public queue's <a href="msmqglos_3wvl.htm#_mq_queue_journal_gly">queue journal</a>, pass <a href="mqprop_9s18.htm">PROPID_Q_JOURNAL</a> and <a href="mqprop_5469.htm">PROPID_Q_JOURNAL_QUOTA</a> to <b>MQCreateQueue</b>. The journal keeps a copy of all messages retrieved from the public queue. For conceptual information about queue and <a href="msmqglos_3wvh.htm#_mq_machine_journal_gly">machine journals</a>, see <a href="msmq_guide_9s4z.htm">Journal Queues</a>.</p>
<p>
To create a transaction queue, pass <a href="mqprop_1r8u.htm">PROPID_Q_TRANSACTION</a> to <b>MQCreateQueue</b>. This property cannot be changed once the queue is created.</p>
<p>
The queue's returned <a href="msmq_guide_1sbp.htm">format name</a> is invalid if <b>MQCreateQueue</b> fails for any reason, including returning the error MQ_ERROR_QUEUE_EXISTS. If the call returns MQ_INFORMATION_FORMATNAME_BUFFER_TOO_SMALL, this means that the queue was created, but the format name could not fit in the format name buffer.</p>
<p>
After the queue is created, its properties can be retrieved using <a href="mqfunc_8b03.htm"><b>MQGetQueueProperties</b></a> and reset using <a href="mqfunc_0wxf.htm"><b>MQSetQueueProperties</b></a>.</p>
<p>
Access control for the queue is based on the MSMQ default security. For information on access control, see <a href="msmq_guide_8i0c.htm">Access Control</a>.</p>
<p>
<a href="msmqglos_3wva.htm#_mq_foreign_queue_gly">Foreign queues</a> must be public queues. Their PROPID_Q_PATHNAME property must specify the name of the foreign computer as it is defined in <a href="msmqglos_3wv5.htm#_mq_active_directory_gly">Active Directory</a>. For information on connecting to foreign queues, see <a href="msmq_guide_7k8i.htm">MSMQ Connector Server</a>.</p>
<p>
When creating a public queue, some clients may not be able to see the new queue registered in <a href="msmqglos_3wv5.htm#_mq_active_directory_gly">Active Directory</a> even though the queue exists. A change to Active Directory (such as creating a public queue) is propagated from domain controller to domain controller, which can cause delays in the availability of new information. Consequently, clients using a specific domain controller may not be able to open the queue, even though it exists. Propagation delays, including communication network delays such as down links, are controlled by the MSMQ Administrator.</p>
<p>
Public queues cannot be created if there is no connection to Active Directory. This restriction applies to <a href="msmqglos_3wv8.htm#_mq_dependent_client_gly">dependent client</a> computers, <a href="msmqglos_3wvd.htm#_mq_independent_client_gly">independent client</a> computers that are working offline, and MSMQ routing servers (FRS). For information on offline operations, see <a href="msmq_guide_72es.htm">MSMQ Offline Support</a>.</p>
<h4>Examples</h4>
<p>
For an example of using <b>MQCreateQueue</b>, see <a href="msmquse_02g9.htm">Creating a Queue</a>.</p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 4.0 SP3 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Requires Windows 95 or later.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in mq.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use mqrt.lib.<br>
<b>&nbsp;&nbsp;Unicode: </b>Defined only as Unicode.</p>
<h4>See Also</h4>
<p>
<a href="mqfunc_19np.htm"><b>MQCloseQueue</b></a>, <a href="mqfunc_3pd1.htm"><b>MQDeleteQueue</b></a>, <a href="mqfunc_8b03.htm"><b>MQGetQueueProperties</b></a>, <a href="mqfunc_1gha.htm"><b>MQLocateBegin</b></a>, <a href="mqfunc_42hx.htm"><b>MQOpenQueue</b></a>, <a href="mqfunc_0wxf.htm"><b>MQSetQueueProperties</b></a>, <a href="mqprop_80th.htm">PROPID_Q_INSTANCE</a>, <a href="mqprop_9s18.htm">PROPID_Q_JOURNAL</a>, <a href="mqprop_0pt1.htm">PROPID_Q_PATHNAME</a>, <a href="mqprop_1r8u.htm">PROPID_Q_TRANSACTION</a> </p>
<p>&nbsp;</p></body>
</HTML>
