<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Reading Messages Synchronously</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_mq_reading_messages_synchronously_activex"></a>Reading Messages Synchronously</h3>
<p>
When reading messages synchronously, all calls are blocked until the next message is available or time-out occurs.</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To read a message synchronously</h5>
<ol>
<li>
Open the queue with receive or peek access.<pre><code>Set qDest = qinfoDest.Open(MQ_RECEIVE_ACCESS, MQ_DENY_NONE)
 </code></pre>
</li>
<li>
Call <a href="mqactx_80dh.htm"><b>Receive</b></a> or <a href="mqactx_0otn.htm"><b>Peek</b></a> to read each message in the queue. The example below uses <b>Receive</b> to remove each message in the queue. (Using <b>Peek</b> in the code below creates an Infinite loop.)<pre><code>Do While True
   Set msgDest = qDest.Receive(ReceiveTimeout:=1000)
   If msgDest Is Nothing Then Exit Do
   MsgBox msgDest.Label + " is removed from the queue."
Loop
 </code></pre>
</li>
</ol>
<h4>Example</h4>
<p>
This example reads all messages in a queue, removing each message as it is read. An error handler is added to trap any errors generated as a result of the <b>Receive</b> call.</p>
<p>
To try this example using Microsoft® Visual Basic® (version 5.0), paste the code into the Code window of a form, run the example, and click the form.</p>
<pre><code>Option Explicit
Dim qinfoDest As MSMQQueueInfo
Dim qDest As MSMQQueue
Dim msgDest As MSMQMessage

Private Sub Form_Click()
   
   '**********************
   ' Removes all messages
   ' in the queue.
   '**********************
   
   Set qDest = qinfoDest.Open(MQ_RECEIVE_ACCESS, MQ_DENY_NONE)
  
   On Error GoTo Handler
   
   Do While True
      Set msgDest = qDest.Receive(ReceiveTimeout:=1000)
      If msgDest Is Nothing Then Exit Do
      MsgBox msgDest.Label + " is removed from the queue."
   Loop

   Exit Sub

   '***************
   ' Error Handler
   '***************
   
Handler:
   If (Err = MQ_ERROR_IO_TIMEOUT) Then
      MsgBox "All messages are removed from the queue."
      Exit Sub
   Else
      MsgBox "Unexpected error!"
   End If

End Sub
<b> </b></code></pre>
<p>&nbsp;</p></body>
</HTML>
