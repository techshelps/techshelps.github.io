<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Shell Library</TITLE>

<META NAME=MS-HKWD CONTENT="Shell Library">
<META NAME="Keywords" CONTENT="Internet Tools & Technologies, Windows Shell API">
<META NAME="Platform" CONTENT="Windows, Win95, WinNT, Mac">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<SCRIPT>
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->
</SCRIPT>
<SCRIPT SRC="../../code/ver.js"></SCRIPT>


<SCRIPT DEFER SRC="../../code/common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{
		SetTOC();
	}
}
//-->
</SCRIPT>

<LINK REL="stylesheet" HREF="/msdn/sdk/inetsdk/help/basicsdkIE4.css" TYPE="text/css">
<!-- STYLE_START -->


<SCRIPT>
//<!--
   var sVR = '../../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'basicSDKIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'basicSDKIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'basicSDKNAV';
   }
   else
   {
	   sCSS += 'basicSDKIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->
</SCRIPT>
<!-- STYLE_END -->
</HEAD>
<BODY onload="InitPage()" BGCOLOR="#FFFFFF">

<A NAME="pagetop"></A><A NAME="ch_shelllib"></A>
<!-- NAV_LINKS_START -->
<TABLE class=main BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="10%"><TR><TD ROWSPAN="3" VALIGN="TOP" WIDTH="121"><IMG SRC="../../art/headbar2.gif" WIDTH="121" HEIGHT="82" BORDER=0 ALT="Shell Library"></TD><TD ROWSPAN="2" VALIGN="TOP" WIDTH="186"><IMG SRC="../../art/headbard.gif" WIDTH="186" HEIGHT="44" BORDER=0 ALT="Shell Library"></TD><TD VALIGN="TOP" WIDTH="470"><IMG SRC="../../art/replace1.gif" WIDTH="470" HEIGHT="17" BORDER=0 ALT="*"></TD></TR>
<TR><TD><PRE><IMG SRC="../../art/arrowrht.gif" WIDTH="14" HEIGHT="14" ALIGN="MIDDLE" BORDER=0 ALT="*"><object id="hhal_1" type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="Item1" value="">
<PARAM name="Item2" value=_win32_Contents>
</object><A STYLE="color:black" ID=TOC HREF=JavaScript:hhal_1.Click()>Contents</A>  <IMG SRC="../../art/arrowrht.gif" WIDTH="14" HEIGHT="14" ALIGN="MIDDLE" BORDER=0 ALT="*"><object id="hhal_2" type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="Item1" value="">
<PARAM name="Item2" value=_win32_Index_1sz1>
</object><A STYLE="color:black" HREF=JavaScript:hhal_2.Click()>Index</A>  <IMG SRC="../../art/arrowrht.gif" WIDTH="14" HEIGHT="14" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black" HREF="Shell.htm#book_shell">Topic Contents</A></PRE></TD></TR>
<TR><TD COLSPAN="2"><PRE><IMG SRC="../../art/arrowlft.gif" WIDTH="17" HEIGHT="15" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="ShellExt.htm">Shell Extensions</A>
<IMG SRC="../../art/arrownxt.gif" WIDTH="17" HEIGHT="16" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="Shortcut.htm">Shell Links</A></PRE></TD></TR>
</TABLE>
<!-- NAV_LINKS_END -->
<BLOCKQUOTE class="body">
<!-- CONTENTS_START -->
<H1>Shell Library</H1>
<BR CLEAR=ALL>
<P>A <I>shell</I> is an application that enables users to group, start, and otherwise control other applications. This overview describes features of the shell for the Microsoft&#174; Windows&#174; operating system. 
<P><A CLASS=tctop HREF="ShellLib.htm#About_the_Shell_Libr"><IMG SRC="../../art/arrowy.gif" WIDTH="6" HEIGHT="11" BORDER=0 ALT="arrowy.gif">About the Shell Library</A><BR>
<P><A CLASS=tctop HREF="ShellLib.htm#Shell_Library_Refere"><IMG SRC="../../art/arrowy.gif" WIDTH="6" HEIGHT="11" BORDER=0 ALT="arrowy.gif">Shell Library Reference</A><BR>
<!--*************************************************************--><H2><A NAME="About_the_Shell_Libr">About the Shell Library</A></H2>
<P>The following features are supported by the dynamic-link library Shell.dll: 
<UL><LI>The drag-and-drop feature.
<LI>Associations used to find and start applications. 
<LI>Extraction of icons from executable files.
</UL>
<H3><A NAME="shelllib_Using_Drag_Drop">Using the Drag-and-Drop Feature</A></H3>
<P>When an application implements the drag-and-drop feature, a user can select one or more files in File Manager, drag them to an open application, and drop them there. The application in which the files were dropped receives a message it can use to retrieve the file names and the coordinates of the point at which the files were dropped. 

<P>An application that can accept dropped files from File Manager calls the <A HREF="functions/DragAcceptFiles.htm#DragAcceptFiles">DragAcceptFiles</A> function for one or more of its windows. When the user releases the mouse button to drop a file or files in the window specified in the call to <B>DragAcceptFiles</B>, File Manager sends the application a WM_DROPFILES message. (File Manager does not send the WM_DROPFILES message to an application unless the application calls <B>DragAcceptFiles</B>.) WM_DROPFILES contains a handle to a structure that the application can query to retrieve the name of the dropped file and the coordinates of the cursor when the file was dropped. The application can use the <A HREF="functions/DragQueryFile.htm#DragQueryFile">DragQueryFile</A> function to retrieve a count of the files that were dropped and their names. The <A HREF="functions/DragQueryPoint.htm#DragQueryPoint">DragQueryPoint</A> function returns the window coordinates of the cursor when the user released the mouse button. 

<P>To free the memory allocated by the system for the WM_DROPFILES message, an application calls the <A HREF="functions/DragFinish.htm#DragFinish">DragFinish</A> function when it is finished. 

<P>For example, an application can call the <A HREF="functions/DragAcceptFiles.htm#DragAcceptFiles">DragAcceptFiles</A> function when it starts and call a drag-and-drop function when it receives a WM_DROPFILES message, as shown in the following example. 

<PRE>case WM_CREATE: 
    DragAcceptFiles(hwnd, TRUE); 
    break; 
 
case WM_DROPFILES: 
    DragFunc(hwnd, wParam); /* application-defined function */ 
    break; 
 
case WM_DESTROY: 
    DragAcceptFiles(hwnd, FALSE); 
    break; 
</PRE>
<P>The following example uses the <A HREF="functions/DragQueryPoint.htm#DragQueryPoint">DragQueryPoint</A> function to determine where to begin to write text. The first call to the <A HREF="functions/DragQueryFile.htm#DragQueryFile">DragQueryFile</A> function determines the number of dropped files. The loop writes the name of each file, beginning at the point returned by <B>DragQueryPoint</B>. 
<PRE>POINT pt; 
WORD cFiles, a; 
char lpszFile[80]; 
 
DragQueryPoint((HANDLE) wParam, &amp;pt); 
 
cFiles = DragQueryFile((HANDLE) wParam, 0xFFFF, (LPSTR) NULL, 0); 
for(a = 0; a &lt; cFiles; pt.y += 20, a++) { 
    DragQueryFile((HANDLE) wParam, a, lpszFile, sizeof(lpszFile)); 
    TextOut(hdc, pt.x, pt.y, lpszFile, lstrlen(lpszFile)); 
} 
 
DragFinish((HANDLE) wParam); 
</PRE>
<H3><A NAME="shelllib_Using_Associations">Using Associations to Find and Start Applications</A></H3>
<P>File Manager includes an Associate dialog box that makes it possible for users to associate a file name extension with a specific application. File Manager stores these associations in the registry (under HKEY_CURRENT_USER\Software\Description\Microsoft\Windows\CurrentVersion\Extensions). If a file has a file name extension that is associated with an application, that application starts automatically whenever the user double-clicks that file in File Manager. 

<P>Using the <A HREF="functions/FindExecutable.htm#FindExecutable">FindExecutable</A> and <A HREF="functions/ShellExecute.htm#ShellExecute">ShellExecute</A> functions, applications can take advantage of such associations to find and start applications or open and print files. 

<P>An application can use the <A HREF="functions/FindExecutable.htm#FindExecutable">FindExecutable</A> function to retrieve the name and handle to the executable file that is associated with a specified file name. The <A HREF="functions/ShellExecute.htm#ShellExecute">ShellExecute</A> function either opens or prints a specified file, depending on the value of its <I>lpOperation</I> parameter. To open a document file, the function relies on the association of the file name extension. 

<P>You can use <A HREF="functions/ShellExecute.htm#ShellExecute">ShellExecute</A> to open or explore a folder. To open a folder, use either of the following calls:
<PRE>ShellExecute(handle, NULL, "path_to_folder", NULL, NULL, SW_SHOWNORMAL);
</PRE>
<P> or
<PRE>ShellExecute(handle, "open", "path_to_folder", NULL, NULL, SW_SHOWNORMAL);
</PRE>
<P>To explore a folder, use the following call:
<PRE>ShellExecute(handle, "explore", "path_to_folder", NULL, NULL, SW_SHOWNORMAL);
</PRE>
<P>If the <I>lpOperation</I> parameter is NULL, the function opens the file specified by its <I>lpFile</I> parameter. If <I>lpOperation</I> is "open", the function will open the file in a new window. If <I>lpOperation</I> is "explore", the function will browse to the folder using an existing Explorer window, if one is open. If an Explorer window is not open, a new one will be created.

<H3><A NAME="shelllib_Extracting_Icons">Extracting Icons from Executable Files</A></H3>
<P>An application can use the
<object id="hhal_3" type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="Item1" value="">
<PARAM name="Item2" value=_win32_Further_Reading>
</object><A HREF=JavaScript:hhal_3.Click()>ExtractIcon</A> function to retrieve the handle to an icon from a specified executable file, dynamic-link library, or icon file. The following example uses the <A HREF="functions/DragQueryPoint.htm#DragQueryPoint">DragQueryPoint</A> function to retrieve the coordinates of the point where a file was dropped, the <A HREF="functions/DragQueryFile.htm#DragQueryFile">DragQueryFile</A> function to retrieve the file name of a dropped file, and the <B>ExtractIcon</B> function to retrieve the handle to the first icon in the file, if any. 

<PRE>POINT pt; 
WORD cFiles; 
HDC hdc; 
char lpszFile[80]; 
HANDLE hCurrentInst, hicon; 
 
DragQueryPoint((HANDLE) wParam, &amp;pt); 
 
cFiles = DragQueryFile((HANDLE) wParam, 0xFFFF, NULL, NULL); 
 
if(cFiles &gt; 1) { 
    TextOut(hdc, pt.x, pt.y, 
        "Please drop only one icon file.", 31); 
    return FALSE; 
} 
else { 
    DragQueryFile((HANDLE) wParam, 0, lpszFile, sizeof(lpszFile)); 
    hCurrentInst = (HINSTANCE) GetWindowLong(hwnd, GWL_HINSTANCE); 
    hicon = ExtractIcon(hCurrentInst, lpszFile, 0); 
    if (hicon == NULL) 
        TextOut(hdc, pt.x, pt.y, "No icons found.", 15); 
    else if (hicon == (HICON) 1) 
        TextOut(hdc, pt.x, pt.y, 
            "File must be .EXE, .ICO, or .DLL.", 33); 
    else 
        DrawIcon(hdc, pt.x, pt.y, hicon); 
} 
 
DragFinish((HANDLE) wParam); 
</PRE>
<H2><A NAME="Shell_Library_Refere">Shell Library Reference</A></H2>
<P>The following programming elements are associated with shell features. 

<H3><A NAME="Shell_Library_Functi">Shell Library Functions</A></H3>
<P>The following functions are used to implement shell features. 
<TABLE>
<TR><TD><A HREF="functions/DragAcceptFiles.htm#DragAcceptFiles">DragAcceptFiles</A></TD></TR>
<TR><TD><A HREF="functions/DragFinish.htm#DragFinish">DragFinish</A></TD></TR>
<TR><TD><A HREF="functions/DragQueryFile.htm#DragQueryFile">DragQueryFile</A></TD></TR>
<TR><TD><A HREF="functions/DragQueryPoint.htm#DragQueryPoint">DragQueryPoint</A></TD></TR>
<TR><TD><object id="hhal_4" type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="Item1" value="">
<PARAM name="Item2" value=_win32_Further_Reading>
</object><A HREF=JavaScript:hhal_4.Click()>ExtractAssociatedIcon</A></TD></TR>
<TR><TD><object id="hhal_5" type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="Item1" value="">
<PARAM name="Item2" value=_win32_Further_Reading>
</object><A HREF=JavaScript:hhal_5.Click()>ExtractIcon</A></TD></TR>
<TR><TD><object id="hhal_6" type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="Item1" value="">
<PARAM name="Item2" value=_win32_Further_Reading>
</object><A HREF=JavaScript:hhal_6.Click()>ExtractIconEx</A></TD></TR>
<TR><TD><A HREF="functions/FindExecutable.htm#FindExecutable">FindExecutable</A></TD></TR>
<TR><TD><A HREF="functions/ShellAbout.htm#ShellAbout">ShellAbout</A></TD></TR>
<TR><TD><A HREF="functions/ShellExecute.htm#ShellExecute">ShellExecute</A> </TD></TR>
<TR><TD><A HREF="functions/ShellExecuteEx.htm#ShellExecuteEx">ShellExecuteEx</A> </TD></TR>
</TABLE>
<H3><A NAME="Shell_Library_Messag">Shell Library Messages</A></H3>
<P>The following message is used to implement shell features. 
<TABLE>
<TR><TD><B>Message
 </B></TD><TD><B>Description</B></TD></TR>
<TR><TD>WM_DROPFILES  </TD><TD>Sent to the window that the mouse is over when the user drops an item or items on the window. See the <A HREF="messages/WM_DROPFILES.htm#WM_DROPFILES">WM_DROPFILES</A> description for more information.</TD></TR>
</TABLE>
<H3><A NAME="Shell_Library_Struct">Shell Library Structures</A></H3>
<P>The following structure is used to implement shell features. 
<TABLE>
<TR><TD><A HREF="structures/SHELLEXECUTEINFO.htm#SHELLEXECUTEINFO">SHELLEXECUTEINFO</A> </TD></TR>
</TABLE>
<!--CONTENTS_END -->
<!-- START PAGE FOOTER -->
<H6><HR size=1></H6>
<P><A ID=line HREF="#pagetop"><IMG src="../../art/arrowup1.gif" WIDTH="17" HEIGHT="16" ALIGN="MIDDLE" BORDER="0" ALT="Up">&nbsp;Top of Page</A>
<BR><A ID=line HREF="http://www.microsoft.com/misc/cpyright.htm" TARGET="_top">&#169; 1997 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END PAGE FOOTER -->
</BLOCKQUOTE>
</BODY>
</HTML>