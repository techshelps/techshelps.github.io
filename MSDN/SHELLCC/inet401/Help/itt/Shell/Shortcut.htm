<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Shell Links</TITLE>

<META NAME=MS-HKWD CONTENT="Shell Links">
<META NAME="Keywords" CONTENT="Internet Tools & Technologies, Windows Shell API">
<META NAME="Platform" CONTENT="Windows, Win95, WinNT, Mac">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<SCRIPT>
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->
</SCRIPT>
<SCRIPT SRC="../../code/ver.js"></SCRIPT>


<SCRIPT DEFER SRC="../../code/common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{
		SetTOC();
	}
}
//-->
</SCRIPT>

<LINK REL="stylesheet" HREF="/msdn/sdk/inetsdk/help/basicsdkIE4.css" TYPE="text/css">
<!-- STYLE_START -->


<SCRIPT>
//<!--
   var sVR = '../../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'basicSDKIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'basicSDKIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'basicSDKNAV';
   }
   else
   {
	   sCSS += 'basicSDKIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->
</SCRIPT>
<!-- STYLE_END -->
</HEAD>
<BODY onload="InitPage()" BGCOLOR="#FFFFFF">

<A NAME="pagetop"></A><A NAME="ch_shellink"></A>
<!-- NAV_LINKS_START -->
<TABLE class=main BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="10%"><TR><TD ROWSPAN="3" VALIGN="TOP" WIDTH="121"><IMG SRC="../../art/headbar2.gif" WIDTH="121" HEIGHT="82" BORDER=0 ALT="Shell Links"></TD><TD ROWSPAN="2" VALIGN="TOP" WIDTH="186"><IMG SRC="../../art/headbard.gif" WIDTH="186" HEIGHT="44" BORDER=0 ALT="Shell Links"></TD><TD VALIGN="TOP" WIDTH="470"><IMG SRC="../../art/replace1.gif" WIDTH="470" HEIGHT="17" BORDER=0 ALT="*"></TD></TR>
<TR><TD><PRE><IMG SRC="../../art/arrowrht.gif" WIDTH="14" HEIGHT="14" ALIGN="MIDDLE" BORDER=0 ALT="*"><object id="hhal_1" type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="Item1" value="">
<PARAM name="Item2" value=_win32_Contents>
</object><A STYLE="color:black" ID=TOC HREF=JavaScript:hhal_1.Click()>Contents</A>  <IMG SRC="../../art/arrowrht.gif" WIDTH="14" HEIGHT="14" ALIGN="MIDDLE" BORDER=0 ALT="*"><object id="hhal_2" type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="Item1" value="">
<PARAM name="Item2" value=_win32_Index_1sz1>
</object><A STYLE="color:black" HREF=JavaScript:hhal_2.Click()>Index</A>  <IMG SRC="../../art/arrowrht.gif" WIDTH="14" HEIGHT="14" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black" HREF="Shell.htm#book_shell">Topic Contents</A></PRE></TD></TR>
<TR><TD COLSPAN="2"><PRE><IMG SRC="../../art/arrowlft.gif" WIDTH="17" HEIGHT="15" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="ShellLib.htm">Shell Library</A>
<IMG SRC="../../art/arrownxt.gif" WIDTH="17" HEIGHT="16" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="NameSpace.htm">Shell Namespace</A></PRE></TD></TR>
</TABLE>
<!-- NAV_LINKS_END -->
<BLOCKQUOTE class="body">
<!-- CONTENTS_START -->
<H1>Shell Links</H1>
<BR CLEAR=ALL>
<P>A <I>shell link</I> is a data object that contains information used to access another object in the shell's namespace&#151;that is, any object visible through Microsoft&#174; Windows&#174; Explorer. The types of objects that can be accessed through shell links include files, folders, disk drives, and printers. A shell link allows a user or an application to access an object from anywhere in the namespace. The user or application does not need to know the current name and location of the object. 
<P><A CLASS=tctop HREF="Shortcut.htm#Shellink_About"><IMG SRC="../../art/arrowy.gif" WIDTH="6" HEIGHT="11" BORDER=0 ALT="arrowy.gif">About Shell Links</A><BR>
<P><A CLASS=tctop HREF="Shortcut.htm#Shellink_Using"><IMG SRC="../../art/arrowy.gif" WIDTH="6" HEIGHT="11" BORDER=0 ALT="arrowy.gif">Using Shell Links</A><BR>
<!--*************************************************************--><H2><A NAME="Shellink_About">About Shell Links</A></H2>
<P>The user creates a shell link by choosing the Create Shortcut command from an object's context menu. The system automatically creates an icon for the shell link by combining the object's icon with a small arrow (known as the system-defined link overlay icon) that appears in the lower left corner of the icon. A shell link that has an icon is called a shortcut; however, the terms shell link and shortcut are often used interchangeably. Typically, the user creates shortcuts to gain quick access to objects stored in subfolders or in shared folders on other machines. For example, a user can create a shortcut to a Microsoft&#174; Word document that is located in a subfolder and place the shortcut icon on the desktop. The user can then open the document by double-clicking the shortcut icon. If the document is moved or renamed after the shortcut is created, the system will attempt to update the shortcut the next time the user selects it. 

<P>Applications can also create and use shell links and shortcuts. For example, a word processing application might create a shell link to implement a list of the most recently used documents. An application creates a shell link by using the <A HREF="ifaces/ishelllink/IShellLink.htm#shell_ishelllink">IShellLink</A> interface to create a shell link object. The application uses the
<object id="hhal_3" type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="Item1" value="">
<PARAM name="Item2" value=_win32_Further_Reading>
</object><A HREF=JavaScript:hhal_3.Click()>IPersistFile</A> or
<object id="hhal_4" type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="Item1" value="">
<PARAM name="Item2" value=_win32_Further_Reading>
</object><A HREF=JavaScript:hhal_4.Click()>IPersistStream</A> interface to store the object in a file or stream. 

<P>This overview describes the <A HREF="ifaces/ishelllink/IShellLink.htm#shell_ishelllink">IShellLink</A> interface and explains how to use it to create and resolve shell links from within a Microsoft&#174; Win32&#174;-based application. Because the design of shell links is based on the OLE Component Object Model (COM), you should be familiar with the basic concepts of COM and OLE programming before reading this overview. 

<H3><A NAME="Shellink_Link_Resolution">Link Resolution</A></H3>
<P>If a user creates a shortcut to an object and the name or location of the object is later changed, the system automatically takes steps to update, or resolve, the shortcut the next time the user selects it. However, if an application creates a shell link and stores it in a stream, the system does not automatically attempt to resolve the link. The application must resolve the link by calling the <A HREF="ifaces/ishelllink/Resolve.htm#IShellLink_Resolve">IShellLink::Resolve</A> method. 

<P>When a shell link is created, the system saves information about the link. When resolving a link (either automatically or with an <A HREF="ifaces/ishelllink/Resolve.htm#IShellLink_Resolve">IShellLink::Resolve</A> call), the system first retrieves the path associated with the shell link by using a pointer to the shell link's identifier list. (For more information about the identifier list, see <A HREF="Shortcut.htm#Shellink_Item_Identifiers">Item Identifiers and Identifier Lists</A>.) The system searches for the associated object in that path and, if it finds the object, resolves the link. If the system cannot find the object, it looks in the same directory for an object that has the same file creation time and attributes, but a different name. This type of search resolves a link to an object that has been renamed. 

<P>If the system still cannot find the object, it searches the subdirectories of the current directory, looking recursively though the directory tree for an object with either the same name or creation time. If the system still does not find a match, it displays a dialog box prompting the user for a location. An application can suppress the dialog box by specifying the SLR_NO_UI value in a call to <B>IShellLink::Resolve</B>.

<H4><A NAME="Shellink_Initialization">Initialization of the Component Object Library</A></H4>
<P>Before an application can create and resolve shortcuts, it must initialize the component object library by calling the <B>CoInitialize</B> function. Each call to <B>CoInitialize</B> requires a corresponding call to the <B>CoUninitialize</B> function, which an application should call when it terminates. The call to <B>CoUninitialize</B> ensures that the application does not terminate until it has received all of its pending messages. 

<H4><A NAME="Shellink_Location_Independent_Names">Location-Independent Names</A></H4>
<P>The system provides location-independent names for shell links to objects stored in shared folders. If the object is stored locally, the system provides the local path and file name for the object. If the object is stored remotely, the system provides a Universal Naming Convention (UNC) network resource name for the object. Because the system provides location-independent names, a shell link can serve as a universal name for a file that can be transferred to other machines. 

<H3><A NAME="Shellink_Link_Files">Link Files</A></H3>
<P>When the user creates a shortcut to an object by choosing the Create Shortcut command from the object's context menu, Windows stores the information it needs to access the object in a link file&#151;a binary file that has the .lnk file name extension. A link file contains the following information: 
<UL><LI>The location (path) of the object referenced by the shortcut (called the corresponding object).
<LI>The working directory of the corresponding object.
<LI>The list of arguments that the system passes to the corresponding object when the <A HREF="ifaces/icontextmenu/InvokeCommand.htm#IContextMenu_InvokeCommand">IContextMenu::InvokeCommand</A> method is activated for the shortcut.
<LI>The show command used to set the initial show state of the corresponding object. This is one of the SW_ values described in
<object id="hhal_5" type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="Item1" value="">
<PARAM name="Item2" value=_win32_Further_Reading>
</object><A HREF=JavaScript:hhal_5.Click()>ShowWindow</A>. 
<LI>The location (path and index) of the shortcut's icon.
<LI>The shortcut's description string.
<LI>The hot key for the shortcut.
</UL>
<P>When a link file is deleted, the corresponding object is not affected.

<P>If you create a shortcut to another shortcut, the system simply copies the link file rather than creating a new link file. In this case, the shortcuts will not be independent of each other.

<P>An application can register a file name extension as a shortcut file type. If a file has a file name extension that has been registered as a shortcut file type, the system automatically adds the system-defined link overlay icon (a small arrow) to the file's icon. To register a file name extension as a shortcut file type, you must add the IsShortcut value to the registry description of the file name extension, as shown in the example below. Note that the shell must be restarted for the overlay icon to take effect.

<PRE>HKEY_CLASSES_ROOT 
  .xyz    (Default) = "XYZApp" 
  . 
  . 
  . 
  XYZApp  IsShortcut = "" 
</PRE>
<H4><A NAME="Shellink_Shortcut_Names">Shortcut names</A></H4>
<P>The shortcut's name, which is a string that appears below the shell link icon, is actually the file name of the shortcut itself. The user can edit the description string by selecting it and entering a new string. 

<H4><A NAME="Shellink_Location_Name_Space">Location of shortcuts in the namespace</A></H4>
<P>A shortcut can exist on the desktop or anywhere in the shell's namespace. Similarly, the object that is associated with the shortcut can also exist anywhere in the shell's namespace. An application can use the <A HREF="ifaces/ishelllink/SetPath.htm#IShellLink_SetPath">IShellLink::SetPath</A> method to set the path and file name for the associated object, and the <A HREF="ifaces/ishelllink/GetPath.htm#IShellLink_GetPath">IShellLink::GetPath</A> method to retrieve the current path and file name for the object.

<H4><A NAME="Shellink_Working_Directory">Shortcut working directory</A></H4>
<P>The working directory is the directory where the corresponding object of a shortcut loads or stores files when the user does not identify a specific directory. A link file contains the name of the working directory for the corresponding object. An application can set the name of the working directory for the corresponding object by using the <A HREF="ifaces/ishelllink/SetWorkingDirectory.htm#IShellLink_SetWorkingDirectory">IShellLink::SetWorkingDirectory</A> method and can retrieve the name of the current working directory for the corresponding object by using the <A HREF="ifaces/ishelllink/GetWorkingDirectory.htm#IShellLink_GetWorkingDirectory">IShellLink::GetWorkingDirectory</A> method. 

<H4><A NAME="Shellink_Command_Line_Arguments">Shortcut command-line arguments</A></H4>
<P>A link file contains command-line arguments that the shell passes to the corresponding object when the user selects the link. An application can set the command-line arguments for a shortcut by using the <A HREF="ifaces/ishelllink/SetArguments.htm#IShellLink_SetArguments">IShellLink::SetArguments</A> method. It is useful to set command-line arguments when the corresponding application, such as a linker or compiler, takes special flags as arguments. An application can retrieve the command-line arguments from a shortcut by using the <A HREF="ifaces/ishelllink/GetArguments.htm#IShellLink_GetArguments">IShellLink::GetArguments</A> method.

<H4><A NAME="Shellink_Show_Commands">Shortcut show commands</A></H4>
<P>When the user double-clicks a shortcut, the system starts the application associated with the corresponding object and sets the initial show state of the application based on the show command specified by the shortcut. The show command can be any of the SW_ values included in the description of the
<object id="hhal_6" type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="Item1" value="">
<PARAM name="Item2" value=_win32_Further_Reading>
</object><A HREF=JavaScript:hhal_6.Click()>ShowWindow</A> function. An application can set the show command for a shortcut by using the <A HREF="ifaces/ishelllink/SetShowCmd.htm#IShellLink_SetShowCmd">IShellLink::SetShowCmd</A> method and can retrieve the current show command by using the <A HREF="ifaces/ishelllink/GetShowCmd.htm#IShellLink_GetShowCmd">IShellLink::GetShowCmd</A> method.

<H4><A NAME="Shellink_Shortcut_Icons">Shortcut icons</A></H4>
<P>Like other shell objects, a shortcut has an icon. The user accesses the object associated with a shortcut by double-clicking the shortcut's icon. When the system creates an icon for a shortcut, it uses the bitmap of the corresponding object and adds the system-defined link overlay icon (a small arrow) to the lower left corner. An application can set the location (path and index) of a shortcut's icon by using the <A HREF="ifaces/ishelllink/SetIconLocation.htm#IShellLink_SetIconLocation">IShellLink::SetIconLocation</A> method. An application can retrieve this location by using the <A HREF="ifaces/ishelllink/GetIconLocation.htm#IShellLink_GetIconLocation">IShellLink::GetIconLocation</A> method. 

<H4><A NAME="Shellink_Shortcut_Descriptions">Shortcut descriptions</A></H4>
<P>Shortcuts have descriptions, but the user never sees them. An application can use a description to store any text information. Descriptions are set using the <A HREF="ifaces/ishelllink/SetDescription.htm#IShellLink_SetDescription">IShellLink::SetDescription</A> method and retrieved using the <A HREF="ifaces/ishelllink/GetDescription.htm#IShellLink_GetDescription">IShellLink::GetDescription</A> method.

<H4><A NAME="Shellink_Hot_Keys">Shortcut hot keys</A></H4>
<P>A shortcut object can have a hot key associated with it. Hot keys allow a user to press a combination of keys to activate a shortcut. An application can set the hot key for a shortcut by using the <A HREF="ifaces/ishelllink/SetHotkey.htm#IShellLink_SetHotkey">IShellLink::SetHotkey</A> method and can retrieve the current hot key by using the <A HREF="ifaces/ishelllink/GetHotkey.htm#IShellLink_GetHotkey">IShellLink::GetHotkey</A> method. 

<H3><A NAME="Shellink_Item_Identifiers">Item Identifiers and Identifier Lists</A></H3>
<P>The shell uses object identifiers within the shell's namespace. All objects visible in the shell (files, directories, servers, workgroups, and so on) have unique identifiers among the objects within their parent folder. These identifiers are called item identifiers, and they have the <A HREF="structures/SHITEMID.htm#SHITEMID">SHITEMID</A> data type as defined in the Shlobj.h header file. An item identifier is a variable-length byte stream that contains information that identifies an object within a folder. Only the creator of an item identifier knows the content and format of the identifier. The only part of an item identifier that the shell uses is the first two bytes, which specify the size of the identifier. 

<P>Each parent folder has its own item identifier that identifies it within its own parent folder. Thus, any shell object can be uniquely identified by a list of item identifiers. A parent folder keeps a list of identifiers for the items it contains. The list has the <A HREF="structures/ITEMIDLIST.htm#ITEMIDLIST">ITEMIDLIST</A> data type. Item identifier lists are allocated by the shell and may be passed across shell interfaces, such as <A HREF="ifaces/ishellfolder/IShellFolder.htm#shell_ishellfolder">IShellFolder</A>. It is important to remember that each identifier in an item identifier list is only meaningful within the context of its parent folder.

<P>An application can set a shortcut's item identifier list by using the <A HREF="ifaces/ishelllink/SetIDList.htm#IShellLink_SetIDList">IShellLink::SetIDList</A> method. This method is useful when setting a shortcut to an object that is not a file, such as a printer or disk drive. An application can retrieve a shortcut's item identifier list by using the <A HREF="ifaces/ishelllink/GetIDList.htm#IShellLink_GetIDList">IShellLink::GetIDList</A> method.

<H2><A NAME="Shellink_Using">Using Shell Links</A></H2>
<P>This section contains examples that demonstrate how to create and resolve shortcuts from within a Win32-based application. This section assumes you are familiar with Win32, C++, and OLE COM programming. 

<H3><A NAME="Shellink_Creating_Shortcut">Creating a Shortcut to a File</A></H3>
<P>The CreateLink sample function in the following example creates a shortcut. The parameters include a pointer to the name of the file to link to, a pointer to the name of the shortcut that you are creating, and a pointer to the description of the link. The description consists of the string, "Shortcut to <I>file name</I>," where <I>file name</I> is the name of the file to link to. 

<P>Because CreateLink calls the
<object id="hhal_7" type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="Item1" value="">
<PARAM name="Item2" value=_win32_Further_Reading>
</object><A HREF=JavaScript:hhal_7.Click()>CoCreateInstance</A> function, it is assumed that the
<object id="hhal_8" type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="Item1" value="">
<PARAM name="Item2" value=_win32_Further_Reading>
</object><A HREF=JavaScript:hhal_8.Click()>CoInitialize</A> function has already been called. CreateLink uses the
<object id="hhal_9" type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="Item1" value="">
<PARAM name="Item2" value=_win32_Further_Reading>
</object><A HREF=JavaScript:hhal_9.Click()>IPersistFile</A> interface to save the shortcut and the <A HREF="ifaces/ishelllink/IShellLink.htm#shell_ishelllink">IShellLink</A> interface to store the file name and description.
<PRE>// CreateLink - uses the shell's IShellLink and IPersistFile interfaces 
//   to create and store a shortcut to the specified object. 
// Returns the result of calling the member functions of the interfaces. 
// lpszPathObj - address of a buffer containing the path of the object. 
// lpszPathLink - address of a buffer containing the path where the 
//   shell link is to be stored. 
// lpszDesc - address of a buffer containing the description of the 
//   shell link. 
 
HRESULT CreateLink(LPCSTR lpszPathObj, 
    LPSTR lpszPathLink, LPSTR lpszDesc) 
{ 
    HRESULT hres; 
    IShellLink* psl; 
 
    // Get a pointer to the IShellLink interface. 
    hres = CoCreateInstance(&amp;CLSID_ShellLink, NULL, 
        CLSCTX_INPROC_SERVER, &amp;IID_IShellLink, &amp;psl); 
    if (SUCCEEDED(hres)) { 
        IPersistFile* ppf; 
 
        // Set the path to the shortcut target and add the 
        // description. 
        psl-&gt;lpVtbl-&gt;SetPath(psl, lpszPathObj); 
        psl-&gt;lpVtbl-&gt;SetDescription(psl, lpszDesc); 
 
       // Query IShellLink for the IPersistFile interface for saving the 
       // shortcut in persistent storage. 
        hres = psl-&gt;lpVtbl-&gt;QueryInterface(psl, &amp;IID_IPersistFile, 
            &amp;ppf); 
 
        if (SUCCEEDED(hres)) { 
            WORD wsz[MAX_PATH]; 
 
            // Ensure that the string is ANSI. 
            MultiByteToWideChar(CP_ACP, 0, lpszPathLink, -1, 
                wsz, MAX_PATH); 
 
            // Save the link by calling IPersistFile::Save. 
            hres = ppf-&gt;lpVtbl-&gt;Save(ppf, wsz, TRUE); 
            ppf-&gt;lpVtbl-&gt;Release(ppf); 
        } 
        psl-&gt;lpVtbl-&gt;Release(psl); 
    } 
    return hres; 
} 
</PRE>
<H3><A NAME="Shellink_Resolving_Shortcut">Resolving a Shortcut</A></H3>
<P>An application may need to access and manipulate a shortcut that was previously created. This operation is referred to as resolving the shortcut. 

<P>The application-defined ResolveIt function in the following example resolves a shortcut. Its parameters include a window handle, a pointer to the path of the shortcut, and the address of a buffer that receives the new path to the object. The window handle identifies the parent window for any message boxes that the shell may need to display. For example, the shell can display a message box if the link is on unshared media, if network problems occur, if the user needs to insert a floppy disk, and so on. 

<P>The ResolveIt function calls the
<object id="hhal_10" type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="Item1" value="">
<PARAM name="Item2" value=_win32_Further_Reading>
</object><A HREF=JavaScript:hhal_10.Click()>CoCreateInstance</A> function and assumes that the
<object id="hhal_11" type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="Item1" value="">
<PARAM name="Item2" value=_win32_Further_Reading>
</object><A HREF=JavaScript:hhal_11.Click()>CoInitialize</A> function has already been called. Note that ResolveIt needs to use the
<object id="hhal_12" type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="Item1" value="">
<PARAM name="Item2" value=_win32_Further_Reading>
</object><A HREF=JavaScript:hhal_12.Click()>IPersistFile</A> interface to store the link information. <B>IPersistFile</B> is implemented by the <A HREF="ifaces/ishelllink/IShellLink.htm#shell_ishelllink">IShellLink</A> object. The link information must be loaded before the path information is retrieved, which is shown later in the example. Failing to load the link information causes the calls to the <A HREF="ifaces/ishelllink/GetPath.htm#IShellLink_GetPath">IShellLink::GetPath</A> and <A HREF="ifaces/ishelllink/GetDescription.htm#IShellLink_GetDescription">IShellLink::GetDescription</A> member functions to fail.

<PRE>HRESULT ResolveIt(HWND hwnd, LPCSTR lpszLinkFile, LPSTR lpszPath) 
{ 
    HRESULT hres; 
    IShellLink* psl; 
    char szGotPath[MAX_PATH]; 
    char szDescription[MAX_PATH]; 
    WIN32_FIND_DATA wfd; 
 
    *lpszPath = 0; // assume failure 
 
    // Get a pointer to the IShellLink interface. 
    hres = CoCreateInstance(&amp;CLSID_ShellLink, NULL, 
            CLSCTX_INPROC_SERVER, &amp;IID_IShellLink, &amp;psl); 
    if (SUCCEEDED(hres)) { 
        IPersistFile* ppf; 
 
        // Get a pointer to the IPersistFile interface. 
        hres = psl-&gt;lpVtbl-&gt;QueryInterface(psl, &amp;IID_IPersistFile, 
            &amp;ppf); 
        if (SUCCEEDED(hres)) { 
            WORD wsz[MAX_PATH]; 
 
            // Ensure that the string is Unicode. 
            MultiByteToWideChar(CP_ACP, 0, lpszLinkFile, -1, wsz, 
                MAX_PATH); 
 
            // Load the shortcut. 
            hres = ppf-&gt;lpVtbl-&gt;Load(ppf, wsz, STGM_READ); 
            if (SUCCEEDED(hres)) { 
 
                // Resolve the link. 
                hres = psl-&gt;lpVtbl-&gt;Resolve(psl, hwnd, SLR_ANY_MATCH); 
                if (SUCCEEDED(hres)) { 
 
                    // Get the path to the link target. 
                    hres = psl-&gt;lpVtbl-&gt;GetPath(psl, szGotPath, 
                        MAX_PATH, (WIN32_FIND_DATA *)&amp;wfd, 
                        SLGP_SHORTPATH ); 
                    if (!SUCCEEDED(hres) 
                        HandleErr(hres); // application-defined function 
 
                    // Get the description of the target. 
                    hres = psl-&gt;lpVtbl-&gt;GetDescription(psl, 
                        szDescription, MAX_PATH); 
                    if (!SUCCEEDED(hres)) 
                        HandleErr(hres); 
                    lstrcpy(lpszPath, szGotPath); 
                } 
            } 
        // Release the pointer to the IPersistFile interface. 
        ppf-&gt;lpVtbl-&gt;Release(ppf); 
        } 
    // Release the pointer to the IShellLink interface. 
    psl-&gt;lpVtbl-&gt;Release(psl); 
    } 
    return hres; 
} 
</PRE>
<H3><A NAME="Shellink_Creating_Shortcut_Nonfile">Creating a Shortcut to a Nonfile Object</A></H3>
<P>Creating a shortcut to a nonfile object, such as a printer, is similar to creating a shortcut to a file except that rather than setting the path to the file, you must set the identifier list to the printer. To set the identifier list, call the <A HREF="ifaces/ishelllink/SetIDList.htm#IShellLink_SetIDList">IShellLink::SetIDList</A> method, specifying the address of an identifier list.

<P>Each object within the shell's namespace has an item identifier. The shell often concatenates item identifiers into null-terminated lists consisting of any number of item identifiers. For more information about item identifiers, see <A HREF="Shortcut.htm#Shellink_Item_Identifiers">Item Identifiers and Identifier Lists</A>.

<P>In general, if you need to set a shortcut to an item that does not have a file name, such as a printer, you will already have a pointer to the object's <A HREF="ifaces/ishellfolder/IShellFolder.htm#shell_ishellfolder">IShellFolder</A> interface. <B>IShellFolder</B> is used to create namespace extensions. 

<P>Once you have the class identifier for <A HREF="ifaces/ishellfolder/IShellFolder.htm#shell_ishellfolder">IShellFolder</A>, you can call the
<object id="hhal_13" type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="Item1" value="">
<PARAM name="Item2" value=_win32_Further_Reading>
</object><A HREF=JavaScript:hhal_13.Click()>CoCreateInstance</A> function to get the address of the interface. Then you can call the interface to enumerate the objects in the folder and retrieve the address of the item identifier for the object that you are searching for. Finally, you can use the address in a call to the <A HREF="ifaces/ishelllink/SetIDList.htm#IShellLink_SetIDList">IShellLink::SetIDList</A> member function to create a shortcut to the object. 


<!--CONTENTS_END -->
<!-- START PAGE FOOTER -->
<H6><HR size=1></H6>
<P><A ID=line HREF="#pagetop"><IMG src="../../art/arrowup1.gif" WIDTH="17" HEIGHT="16" ALIGN="MIDDLE" BORDER="0" ALT="Up">&nbsp;Top of Page</A>
<BR><A ID=line HREF="http://www.microsoft.com/misc/cpyright.htm" TARGET="_top">&#169; 1997 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END PAGE FOOTER -->
</BLOCKQUOTE>
</BODY>
</HTML>