<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Execute, Requery, and Clear Methods Example (ADO)</TITLE>

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME=MS-HKWD CONTENT="Execute, Requery, and Clear Methods Example (ADO)">
<META NAME="Keywords" CONTENT="Active Data Objects, ADO">
<META NAME="Platform" CONTENT="Windows">
<META NAME="ROBOTS" CONTENT="all">

<!--@ SNIFF_START -->
<SCRIPT>
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->
</SCRIPT>
<SCRIPT SRC="../code/ver.js"></SCRIPT>
<!--@ SNIFF_END -->

<SCRIPT DEFER SRC="../code/common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{
		SetTOC();
	}
}
//-->
</SCRIPT>

<LINK REL="stylesheet" HREF="/msdn/sdk/inetsdk/help/basicsdkIE4.css" TYPE="text/css">
<!-- STYLE_START -->


<SCRIPT>
//<!--
   var sVR = '../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'basicSDKIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'basicSDKIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'basicSDKNAV';
   }
   else
   {
	   sCSS += 'basicSDKIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->
</SCRIPT>
<!-- STYLE_END -->
</HEAD>
<BODY onload="InitPage()" BGCOLOR="#FFFFFF">

<A NAME="pagetop"></A>
<!-- NAV_LINKS_START -->
<TABLE class=main BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="10%"><TR><TD ROWSPAN="3" VALIGN="TOP" WIDTH="121"><IMG SRC="../art/headbar2.gif" WIDTH="121" HEIGHT="82" BORDER=0 ALT="Microsoft ActiveX Data Objects"></TD><TD ROWSPAN="2" VALIGN="TOP" WIDTH="186"><IMG SRC="../art/headbare.gif" WIDTH="186" HEIGHT="44" BORDER=0 ALT="Microsoft ActiveX Data Objects"></TD><TD VALIGN="TOP" WIDTH="470"><IMG SRC="../art/replace1.gif" WIDTH="470" HEIGHT="17" BORDER=0 ALT="*"></TD></TR>
<TR><TD><PRE><IMG SRC="../art/arrowrht.gif" WIDTH="14" HEIGHT="14" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black" ID=TOC HREF="../contents.htm">Contents</A>  <IMG SRC="../art/arrowrht.gif" WIDTH="14" HEIGHT="14" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black" HREF="../index.htm">Index</A>  <IMG SRC="../art/arrowrht.gif" WIDTH="14" HEIGHT="14" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black" HREF="idx01.htm">Topic Contents</A>
</PRE></TD></TR>
</TABLE>
<!-- NAV_LINKS_END -->
<BLOCKQUOTE class="body">
<!-- CONTENTS_START -->
<P><a name="admthexecutex"></a><b>Execute, Requery, and Clear Methods Example</b>
<p>This example demonstrates the <b>Execute</b> method when run from both a <b>Command</b> object and a <b>Connection</b> object. It also uses the <b>Requery</b> method to retrieve current data in a recordset, and the <b>Clear</b> method to clear the contents of the <b>Errors</b> collection. The ExecuteCommand and PrintOutput procedures are required for this procedure to run.
<pre>Public Sub ExecuteX()

&#09;Dim strSQLChange As String
&#09;Dim strSQLRestore As String
&#09;Dim strCnn As String
&#09;Dim cnn1 As ADODB.Connection
&#09;Dim cmdChange As ADODB.Command
&#09;Dim rstTitles As ADODB.Recordset
&#09;Dim errLoop As ADODB.Error

&#09;' Define two SQL statements to execute as command text.
&#09;strSQLChange = &quot;UPDATE Titles SET Type = &quot; &amp; _
&#09;&#09;&quot;'self_help' WHERE Type = 'psychology'&quot;
&#09;strSQLRestore = &quot;UPDATE Titles SET Type = &quot; &amp; _
&#09;&#09;&quot;'psychology' WHERE Type = 'self_help'&quot;

&#09;' Open connection.
&#09;strCnn = &quot;driver={SQL Server};server=srv;&quot; &amp; _
&#09;&#09;&quot;uid=sa;pwd=;database=pubs&quot;
&#09;Set cnn1 = New ADODB.Connection
&#09;cnn1.Open strCnn

&#09;' Create command object.
&#09;Set cmdChange = New ADODB.Command
&#09;Set cmdChange.ActiveConnection = cnn1
&#09;cmdChange.CommandText = strSQLChange
&#09;
&#09;' Open titles table.
&#09;Set rstTitles = New ADODB.Recordset
&#09;rstTitles.Open &quot;titles&quot;, cnn1, , , adCmdTable

&#09;' Print report of original data.
&#09;Debug.Print _
&#09;&#09;&quot;Data in Titles table before executing the query&quot;
&#09;PrintOutput rstTitles

&#09;' Clear extraneous errors from the Errors collection.
&#09;cnn1.Errors.Clear

&#09;' Call the ExecuteCommand subroutine to execute cmdChange command.
&#09;ExecuteCommand cmdChange, rstTitles
&#09;
&#09;' Print report of new data.
&#09;Debug.Print _
&#09;&#09;&quot;Data in Titles table after executing the query&quot;
&#09;PrintOutput rstTitles

&#09;' Use the Connection object's execute method to 
&#09;' execute SQL statement to restore data. Trap for 
&#09;' errors, checking the Errors collection if necessary.
&#09;On Error GoTo Err_Execute
&#09;cnn1.Execute strSQLRestore
&#09;On Error GoTo 0

&#09;' Retrieve the current data by requerying the recordset.
&#09;rstTitles.Requery

&#09;' Print report of restored data.
&#09;Debug.Print &quot;Data after executing the query &quot; &amp; _
&#09;&#09;&quot;to restore the original information&quot;
&#09;PrintOutput rstTitles

&#09;rstTitles.Close
&#09;cnn1.Close
&#09;
&#09;Exit Sub
&#09;
Err_Execute:

&#09;' Notify user of any errors that result from
&#09;' executing the query.
&#09;If Errors.Count &gt; 0 Then
&#09;&#09;For Each errLoop In Errors
&#09;&#09;&#09;MsgBox &quot;Error number: &quot; &amp; errLoop.Number &amp; vbCr &amp; _
&#09;&#09;&#09;&#09;errLoop.Description
&#09;&#09;Next errLoop
&#09;End If
&#09;
&#09;Resume Next

End Sub

Public Sub ExecuteCommand(cmdTemp As ADODB.Command, _
&#09;rstTemp As ADODB.Recordset)

&#09;Dim errLoop As Error
&#09;
&#09;' Run the specified Command object. Trap for 
&#09;' errors, checking the Errors collection if necessary.
&#09;On Error GoTo Err_Execute
&#09;cmdTemp.Execute
&#09;On Error GoTo 0

&#09;' Retrieve the current data by requerying the recordset.
&#09;rstTemp.Requery
&#09;
&#09;Exit Sub

Err_Execute:

&#09;' Notify user of any errors that result from
&#09;' executing the query.
&#09;If Errors.Count &gt; 0 Then
&#09;&#09;For Each errLoop In Errors
&#09;&#09;&#09;MsgBox &quot;Error number: &quot; &amp; errLoop.Number &amp; vbCr &amp; _
&#09;&#09;&#09;&#09;errLoop.Description
&#09;&#09;Next errLoop
&#09;End If
&#09;
&#09;Resume Next

End Sub

Public Sub PrintOutput(rstTemp As ADODB.Recordset)

&#09;' Enumerate Recordset.
&#09;Do While Not rstTemp.EOF
&#09;&#09;Debug.Print &quot;    &quot; &amp; rstTemp!Title &amp; _
&#09;&#09;&#09;&quot;, &quot; &amp; rstTemp!Type
&#09;&#09;rstTemp.MoveNext
&#09;Loop

End Sub</PRE>
<p><b>VBScript Version</b>
<p>The following is the same example written in VBScript to be used in an Active Server Page (ASP). To view this example, you need to create a system Data Source Name (DSN) called AdvWorks using the data source AdvWorks.mdb installed with IIS and located at C:\InetPub\ASPSamp\AdvWorks. This is a Microsoft Access database file. Use Find to locate the file adovbs.inc and place it in the directory you plan to use. Cut and paste the following code to Notepad or another text editor and save it as Execute.asp. You can view the result in any client browser.
<pre>&lt;!-- #Include file=&quot;ADOVBS.INC&quot; --&gt;
&lt;HTML&gt;&lt;HEAD&gt;
&lt;TITLE&gt;ADO 1.5 Execute Method&lt;/TITLE&gt;&lt;/HEAD&gt;

&lt;BODY&gt; 
&lt;FONT FACE=&quot;MS SANS SERIF&quot; SIZE=2&gt;
&lt;Center&gt;&lt;H3&gt;ADO Execute Method&lt;/H3&gt;&lt;H4&gt;Recordset Retrieved Using Connection Object&lt;/H4&gt;
&lt;TABLE WIDTH=600 BORDER=0&gt;
&lt;TD VALIGN=TOP ALIGN=LEFT COLSPAN=3&gt;&lt;FONT SIZE=2&gt;

&lt;!--- Recordsets retrieved using Execute method of Connection and Command Objects--&gt;
&lt;% 
Set OBJdbConnection = Server.CreateObject(&quot;ADODB.Connection&quot;) 
OBJdbConnection.Open &quot;AdvWorks&quot; 
SQLQuery = &quot;SELECT * FROM Customers&quot; 
'First Recordset RSCustomerList
Set RSCustomerList = OBJdbConnection.Execute(SQLQuery) 

Set OBJdbCommand = Server.CreateObject(&quot;ADODB.Command&quot;)
OBJdbCommand.ActiveConnection = OBJdbConnection
SQLQuery2 = &quot;SELECT * From Products&quot;
OBJdbCommand.CommandText = SQLQuery2
Set RsProductList = OBJdbCommand.Execute

%&gt;
&lt;TABLE COLSPAN=8 CELLPADDING=5 BORDER=0&gt;

&lt;!-- BEGIN column header row for Customer Table--&gt;

&lt;TR&gt;&lt;TD ALIGN=CENTER BGCOLOR=&quot;#008080&quot;&gt;
&lt;FONT STYLE=&quot;ARIAL NARROW&quot; COLOR=&quot;#ffffff&quot; SIZE=1&gt;Company Name&lt;/FONT&gt;
&lt;/TD&gt;
&lt;TD ALIGN=CENTER BGCOLOR=&quot;#008080&quot;&gt;
&lt;FONT STYLE=&quot;ARIAL NARROW&quot; COLOR=&quot;#ffffff&quot; SIZE=1&gt;Contact Name&lt;/FONT&gt;
&lt;/TD&gt;
&lt;TD ALIGN=CENTER WIDTH=150 BGCOLOR=&quot;#008080&quot;&gt;
&lt;FONT STYLE=&quot;ARIAL NARROW&quot; COLOR=&quot;#ffffff&quot; SIZE=1&gt;E-mail address&lt;/FONT&gt;
&lt;/TD&gt;
&lt;TD ALIGN=CENTER BGCOLOR=&quot;#008080&quot;&gt;
&lt;FONT STYLE=&quot;ARIAL NARROW&quot; COLOR=&quot;#ffffff&quot; SIZE=1&gt;City&lt;/FONT&gt;
&lt;/TD&gt;
&lt;TD ALIGN=CENTER BGCOLOR=&quot;#008080&quot;&gt;
&lt;FONT STYLE=&quot;ARIAL NARROW&quot; COLOR=&quot;#ffffff&quot; SIZE=1&gt;State/Province&lt;/FONT&gt;
&lt;/TD&gt;&lt;/TR&gt;

&lt;!--Display ADO Data from Customer Table--&gt;
&lt;% Do While Not RScustomerList.EOF %&gt;
  &lt;TR&gt;
  &lt;TD BGCOLOR=&quot;f7efde&quot; ALIGN=CENTER&gt; 
    &lt;FONT STYLE=&quot;ARIAL NARROW&quot; SIZE=1&gt; 
      &lt;%= RSCustomerList(&quot;CompanyName&quot;)%&gt; 
    &lt;/FONT&gt;&lt;/TD&gt;
  &lt;TD BGCOLOR=&quot;f7efde&quot; ALIGN=CENTER&gt;
    &lt;FONT STYLE=&quot;ARIAL NARROW&quot; SIZE=1&gt; 
      &lt;%= RScustomerList(&quot;ContactLastName&quot;) &amp; &quot;, &quot; %&gt; 
      &lt;%= RScustomerList(&quot;ContactFirstName&quot;) %&gt; 
    &lt;/FONT&gt;&lt;/TD&gt;
  &lt;TD BGCOLOR=&quot;f7efde&quot; ALIGN=CENTER&gt;
    &lt;FONT STYLE=&quot;ARIAL NARROW&quot; SIZE=1&gt;
     
      &lt;%= RScustomerList(&quot;ContactLastName&quot;)%&gt; 
   &lt;/FONT&gt;&lt;/TD&gt;
  &lt;TD BGCOLOR=&quot;f7efde&quot; ALIGN=CENTER&gt;
    &lt;FONT STYLE=&quot;ARIAL NARROW&quot; SIZE=1&gt; 
      &lt;%= RScustomerList(&quot;City&quot;)%&gt; 
    &lt;/FONT&gt;&lt;/TD&gt;
  &lt;TD BGCOLOR=&quot;f7efde&quot; ALIGN=CENTER&gt;
    &lt;FONT STYLE=&quot;ARIAL NARROW&quot; SIZE=1&gt; 
      &lt;%= RScustomerList(&quot;StateOrProvince&quot;)%&gt; 
    &lt;/FONT&gt;&lt;/TD&gt;
  &lt;/TR&gt; 
&lt;!-Next Row = Record Loop and add to html table--&gt;
&lt;% 
RScustomerList.MoveNext 
Loop 
RScustomerList.Close

%&gt;

&lt;/TABLE&gt;&lt;HR&gt;
&lt;H4&gt;Recordset Retrieved Using Command Object&lt;/H4&gt;
&lt;TABLE COLSPAN=8 CELLPADDING=5 BORDER=0&gt;

&lt;!-- BEGIN column header row for Product List Table--&gt;

&lt;TR&gt;&lt;TD ALIGN=CENTER BGCOLOR=&quot;#800000&quot;&gt;
&lt;FONT STYLE=&quot;ARIAL NARROW&quot; COLOR=&quot;#ffffff&quot; SIZE=1&gt;Product Type&lt;/FONT&gt;
&lt;/TD&gt;
&lt;TD ALIGN=CENTER BGCOLOR=&quot;#800000&quot;&gt;
&lt;FONT STYLE=&quot;ARIAL NARROW&quot; COLOR=&quot;#ffffff&quot; SIZE=1&gt;Product Name&lt;/FONT&gt;
&lt;/TD&gt;
&lt;TD ALIGN=CENTER WIDTH=350 BGCOLOR=&quot;#800000&quot;&gt;
&lt;FONT STYLE=&quot;ARIAL NARROW&quot; COLOR=&quot;#ffffff&quot; SIZE=1&gt;Product Description&lt;/FONT&gt;
&lt;/TD&gt;
&lt;TD ALIGN=CENTER BGCOLOR=&quot;#800000&quot;&gt;
&lt;FONT STYLE=&quot;ARIAL NARROW&quot; COLOR=&quot;#ffffff&quot; SIZE=1&gt;Unit Price&lt;/FONT&gt;
&lt;/TD&gt;&lt;/TR&gt;

&lt;!-- Display ADO Data Product List--&gt;
&lt;% Do While Not RsProductList.EOF %&gt;
  &lt;TR&gt;
  &lt;TD BGCOLOR=&quot;f7efde&quot; ALIGN=CENTER&gt; 
    &lt;FONT STYLE=&quot;ARIAL NARROW&quot; SIZE=1&gt; 
      &lt;%= RsProductList(&quot;ProductType&quot;)%&gt; 
    &lt;/FONT&gt;&lt;/TD&gt;
  &lt;TD BGCOLOR=&quot;f7efde&quot; ALIGN=CENTER&gt; 
    &lt;FONT STYLE=&quot;ARIAL NARROW&quot; SIZE=1&gt; 
      &lt;%= RsProductList(&quot;ProductName&quot;)%&gt; 
    &lt;/FONT&gt;&lt;/TD&gt;
  &lt;TD BGCOLOR=&quot;f7efde&quot; ALIGN=CENTER&gt;
    &lt;FONT STYLE=&quot;ARIAL NARROW&quot; SIZE=1&gt;
     &lt;%= RsProductList(&quot;ProductDescription&quot;)%&gt; 
   &lt;/FONT&gt;&lt;/TD&gt;

  &lt;TD BGCOLOR=&quot;f7efde&quot; ALIGN=CENTER&gt;
    &lt;FONT STYLE=&quot;ARIAL NARROW&quot; SIZE=1&gt; 
      &lt;%= RsProductList(&quot;UnitPrice&quot;)%&gt; 
    &lt;/FONT&gt;&lt;/TD&gt;
  
&lt;!--  Next Row = Record --&gt;
&lt;% 
RsProductList.MoveNext 
Loop 
'Remove objects from memory to free resources
RsProductList.Close
OBJdbConnection.Close
Set ObJdbCommand = Nothing
Set RsProductList = Nothing
Set OBJdbConnection = Nothing
%&gt;
&lt;/TABLE&gt;&lt;/FONT&gt;&lt;/Center&gt;&lt;/BODY&gt;&lt;/HTML&gt;</PRE>
<!-- CONTENTS_END -->
<!-- START PAGE FOOTER -->
<H6><HR size=1></H6>
<P><A ID=line HREF="#pagetop"><IMG src="../art/arrowup1.gif" WIDTH="17" HEIGHT="16" ALIGN="MIDDLE" BORDER="0" ALT="Up">&nbsp;Top of Page</A>
<BR><A ID=line HREF="http://www.microsoft.com/misc/cpyright.htm" TARGET="_top">&#169; 1997 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END PAGE FOOTER -->
</BLOCKQUOTE>
</BODY>
</HTML>