<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Open and Close Methods Example (ADO)</TITLE>

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME=MS-HKWD CONTENT="Open and Close Methods Example (ADO)">
<META NAME="Keywords" CONTENT="Active Data Objects, ADO">
<META NAME="Platform" CONTENT="Windows">
<META NAME="ROBOTS" CONTENT="all">

<!--@ SNIFF_START -->
<SCRIPT>
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->
</SCRIPT>
<SCRIPT SRC="../code/ver.js"></SCRIPT>
<!--@ SNIFF_END -->

<SCRIPT DEFER SRC="../code/common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{
		SetTOC();
	}
}
//-->
</SCRIPT>

<LINK REL="stylesheet" HREF="/msdn/sdk/inetsdk/help/basicsdkIE4.css" TYPE="text/css">
<!-- STYLE_START -->


<SCRIPT>
//<!--
   var sVR = '../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'basicSDKIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'basicSDKIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'basicSDKNAV';
   }
   else
   {
	   sCSS += 'basicSDKIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->
</SCRIPT>
<!-- STYLE_END -->
</HEAD>
<BODY onload="InitPage()" BGCOLOR="#FFFFFF">

<A NAME="pagetop"></A>
<!-- NAV_LINKS_START -->
<TABLE class=main BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="10%"><TR><TD ROWSPAN="3" VALIGN="TOP" WIDTH="121"><IMG SRC="../art/headbar2.gif" WIDTH="121" HEIGHT="82" BORDER=0 ALT="Microsoft ActiveX Data Objects"></TD><TD ROWSPAN="2" VALIGN="TOP" WIDTH="186"><IMG SRC="../art/headbare.gif" WIDTH="186" HEIGHT="44" BORDER=0 ALT="Microsoft ActiveX Data Objects"></TD><TD VALIGN="TOP" WIDTH="470"><IMG SRC="../art/replace1.gif" WIDTH="470" HEIGHT="17" BORDER=0 ALT="*"></TD></TR>
<TR><TD><PRE><IMG SRC="../art/arrowrht.gif" WIDTH="14" HEIGHT="14" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black" ID=TOC HREF="../contents.htm">Contents</A>  <IMG SRC="../art/arrowrht.gif" WIDTH="14" HEIGHT="14" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black" HREF="../index.htm">Index</A>  <IMG SRC="../art/arrowrht.gif" WIDTH="14" HEIGHT="14" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black" HREF="idx01.htm">Topic Contents</A>
</PRE></TD></TR>
</TABLE>
<!-- NAV_LINKS_END -->
<BLOCKQUOTE class="body">
<!-- CONTENTS_START -->
<P><a name="admthopenx"></a><b>Open and Close Methods Example</b>
<p>This example uses the <b>Open</b> and <b>Close</b> methods on both <b>Recordset</b> and <b>Connection</b> objects that have been opened.
<pre>Public Sub OpenX()

&#09;Dim cnn1 As ADODB.Connection
&#09;Dim rstEmployees As ADODB.Recordset
&#09;Dim strCnn As String
&#09;Dim varDate As Variant

&#09;' Open connection.
&#09;strCnn = &quot;driver={SQL Server};server=srv;&quot; &amp; _
&#09;&#09;&quot;uid=sa;pwd=;database=pubs&quot;
&#09;Set cnn1 = New ADODB.Connection
&#09;cnn1.Open strCnn
&#09;
&#09;' Open employee table.
&#09;Set rstEmployees = New ADODB.Recordset
&#09;rstEmployees.CursorType = adOpenKeyset
&#09;rstEmployees.LockType = adLockOptimistic
&#09;rstEmployees.Open &quot;employee&quot;, cnn1, , , adCmdTable

&#09;' Assign the first employee record's hire date
&#09;' to a variable, then change the hire date.
&#09;varDate = rstEmployees!hire_date
&#09;Debug.Print &quot;Original data&quot;
&#09;Debug.Print &quot;    Name - Hire Date&quot;
&#09;Debug.Print &quot;    &quot; &amp; rstEmployees!fName &amp; &quot; &quot; &amp; _
&#09;&#09;rstEmployees!lName &amp; &quot; - &quot; &amp; rstEmployees!hire_date
&#09;rstEmployees!hire_date = #1/1/1900#
&#09;rstEmployees.Update
&#09;Debug.Print &quot;Changed data&quot;
&#09;Debug.Print &quot;    Name - Hire Date&quot;
&#09;Debug.Print &quot;    &quot; &amp; rstEmployees!fName &amp; &quot; &quot; &amp; _
&#09;&#09;rstEmployees!lName &amp; &quot; - &quot; &amp; rstEmployees!hire_date

&#09;' Requery Recordset and reset the hire date.
&#09;rstEmployees.Requery
&#09;rstEmployees!hire_date = varDate
&#09;rstEmployees.Update
&#09;Debug.Print &quot;Data after reset&quot;
&#09;Debug.Print &quot;    Name - Hire Date&quot;
&#09;Debug.Print &quot;    &quot; &amp; rstEmployees!fName &amp; &quot; &quot; &amp; _
&#09;&#09;rstEmployees!lName &amp; &quot; - &quot; &amp; rstEmployees!hire_date

&#09;rstEmployees.Close
&#09;cnn1.Close

End Sub</PRE>
<p><b>VBScript Version</b>
<p>The following is the same example written in VBScript to be used in an Active Server Page (ASP). To view this example, you need to create a system Data Source Name (DSN) called AdvWorks for the Microsoft Access database file AdvWorks.mdb, which is installed with Microsoft Internet Information Server and located at C:\InetPub\ASPSamp\AdvWorks. Locate the file adovbs.inc and place it in the directory you plan to use. Cut and paste the following code to Notepad or another text editor and save it as ADOOpen.asp. You can view the result in any client browser.
<pre>&lt;!-- #Include file=&quot;ADOVBS.INC&quot; --&gt;
&lt;HTML&gt;&lt;HEAD&gt;
&lt;TITLE&gt;ADO 1.5 Open Method&lt;/TITLE&gt;
&lt;/HEAD&gt;&lt;BODY&gt; 
&lt;FONT FACE=&quot;MS SANS SERIF&quot; SIZE=2&gt;
&lt;Center&gt;&lt;H3&gt;ADO Open Method&lt;/H3&gt;
&lt;TABLE WIDTH=600 BORDER=0&gt;
&lt;TD VALIGN=TOP ALIGN=LEFT COLSPAN=3&gt;&lt;FONT SIZE=2&gt;
&lt;!--- ADO Connection used to create 2 recordsets--&gt;
&lt;% 
Set OBJdbConnection = Server.CreateObject(&quot;ADODB.Connection&quot;) 
OBJdbConnection.Open &quot;AdvWorks&quot; 
SQLQuery = &quot;SELECT * FROM Customers&quot; 
'First Recordset RSCustomerList
Set RSCustomerList = OBJdbConnection.Execute(SQLQuery) 
'Second Recordset RsProductist
Set RsProductList = Server.CreateObject(&quot;ADODB.Recordset&quot;)
RsProductList.CursorType = adOpenDynamic
RsProductList.LockType = adLockOptimistic
RsProductList.Open &quot;Products&quot;, OBJdbConnection 
%&gt;
&lt;TABLE COLSPAN=8 CELLPADDING=5 BORDER=0&gt;

&lt;!-- BEGIN column header row for Customer Table--&gt;

&lt;TR&gt;&lt;TD ALIGN=CENTER BGCOLOR=&quot;#008080&quot;&gt;
&lt;FONT STYLE=&quot;ARIAL NARROW&quot; COLOR=&quot;#ffffff&quot; SIZE=1&gt;Company Name&lt;/FONT&gt;&lt;/TD&gt;
&lt;TD ALIGN=CENTER BGCOLOR=&quot;#008080&quot;&gt;
&lt;FONT STYLE=&quot;ARIAL NARROW&quot; COLOR=&quot;#ffffff&quot; SIZE=1&gt;Contact Name&lt;/FONT&gt;&lt;/TD&gt;
&lt;TD ALIGN=CENTER WIDTH=150 BGCOLOR=&quot;#008080&quot;&gt;
&lt;FONT STYLE=&quot;ARIAL NARROW&quot; COLOR=&quot;#ffffff&quot; SIZE=1&gt;E-mail address&lt;/FONT&gt;&lt;/TD&gt;
&lt;TD ALIGN=CENTER BGCOLOR=&quot;#008080&quot;&gt;
&lt;FONT STYLE=&quot;ARIAL NARROW&quot; COLOR=&quot;#ffffff&quot; SIZE=1&gt;City&lt;/FONT&gt;&lt;/TD&gt;
&lt;TD ALIGN=CENTER BGCOLOR=&quot;#008080&quot;&gt;
&lt;FONT STYLE=&quot;ARIAL NARROW&quot; COLOR=&quot;#ffffff&quot; SIZE=1&gt;State/Province&lt;/FONT&gt;&lt;/TD&gt;&lt;/TR&gt;

&lt;!--Display ADO Data from Customer Table--&gt;
&lt;% Do While Not RScustomerList.EOF %&gt;
  &lt;TR&gt;&lt;TD BGCOLOR=&quot;f7efde&quot; ALIGN=CENTER&gt; 
    &lt;FONT STYLE=&quot;ARIAL NARROW&quot; SIZE=1&gt; 
      &lt;%= RSCustomerList(&quot;CompanyName&quot;)%&gt; 
    &lt;/FONT&gt;&lt;/TD&gt;
  &lt;TD BGCOLOR=&quot;f7efde&quot; ALIGN=CENTER&gt;
    &lt;FONT STYLE=&quot;ARIAL NARROW&quot; SIZE=1&gt; 
      &lt;%= RScustomerList(&quot;ContactLastName&quot;) &amp; &quot;, &quot; %&gt; 
      &lt;%= RScustomerList(&quot;ContactFirstName&quot;) %&gt; 
    &lt;/FONT&gt;&lt;/TD&gt;
  &lt;TD BGCOLOR=&quot;f7efde&quot; ALIGN=CENTER&gt;
    &lt;FONT STYLE=&quot;ARIAL NARROW&quot; SIZE=1&gt;
    &lt;%= RScustomerList(&quot;ContactLastName&quot;)%&gt; 
   &lt;/FONT&gt;&lt;/TD&gt;
  &lt;TD BGCOLOR=&quot;f7efde&quot; ALIGN=CENTER&gt;
    &lt;FONT STYLE=&quot;ARIAL NARROW&quot; SIZE=1&gt; 
      &lt;%= RScustomerList(&quot;City&quot;)%&gt; 
    &lt;/FONT&gt;&lt;/TD&gt;
  &lt;TD BGCOLOR=&quot;f7efde&quot; ALIGN=CENTER&gt;
    &lt;FONT STYLE=&quot;ARIAL NARROW&quot; SIZE=1&gt; 
      &lt;%= RScustomerList(&quot;StateOrProvince&quot;)%&gt; 
    &lt;/FONT&gt;&lt;/TD&gt;&lt;/TR&gt; 
&lt;!-Next Row = Record Loop and add to html table--&gt;
&lt;% 
RScustomerList.MoveNext 
Loop 
RScustomerList.Close
OBJdbConnection.Close
%&gt;
&lt;/TABLE&gt;
&lt;HR&gt;
&lt;TABLE COLSPAN=8 CELLPADDING=5 BORDER=0&gt;

&lt;!-- BEGIN column header row for Product List Table--&gt;

&lt;TR&gt;&lt;TD ALIGN=CENTER BGCOLOR=&quot;#800000&quot;&gt;
&lt;FONT STYLE=&quot;ARIAL NARROW&quot; COLOR=&quot;#ffffff&quot; SIZE=1&gt;Product Type&lt;/FONT&gt;&lt;/TD&gt;
&lt;TD ALIGN=CENTER BGCOLOR=&quot;#800000&quot;&gt;
&lt;FONT STYLE=&quot;ARIAL NARROW&quot; COLOR=&quot;#ffffff&quot; SIZE=1&gt;Product Name&lt;/FONT&gt;&lt;/TD&gt;
&lt;TD ALIGN=CENTER WIDTH=350 BGCOLOR=&quot;#800000&quot;&gt;
&lt;FONT STYLE=&quot;ARIAL NARROW&quot; COLOR=&quot;#ffffff&quot; SIZE=1&gt;Product Description&lt;/FONT&gt;&lt;/TD&gt;
&lt;TD ALIGN=CENTER BGCOLOR=&quot;#800000&quot;&gt;
&lt;FONT STYLE=&quot;ARIAL NARROW&quot; COLOR=&quot;#ffffff&quot; SIZE=1&gt;Unit Price&lt;/FONT&gt;&lt;/TD&gt;&lt;/TR&gt;
&lt;!-- Display ADO Data Product List--&gt;
&lt;% Do While Not RsProductList.EOF %&gt;
  &lt;TR&gt;  &lt;TD BGCOLOR=&quot;f7efde&quot; ALIGN=CENTER&gt; 
    &lt;FONT STYLE=&quot;ARIAL NARROW&quot; SIZE=1&gt; 
      &lt;%= RsProductList(&quot;ProductType&quot;)%&gt; 
    &lt;/FONT&gt;&lt;/TD&gt;
  &lt;TD BGCOLOR=&quot;f7efde&quot; ALIGN=CENTER&gt; 
    &lt;FONT STYLE=&quot;ARIAL NARROW&quot; SIZE=1&gt; 
      &lt;%= RsProductList(&quot;ProductName&quot;)%&gt; 
    &lt;/FONT&gt;&lt;/TD&gt;
  &lt;TD BGCOLOR=&quot;f7efde&quot; ALIGN=CENTER&gt;
    &lt;FONT STYLE=&quot;ARIAL NARROW&quot; SIZE=1&gt;
     &lt;%= RsProductList(&quot;ProductDescription&quot;)%&gt; 
   &lt;/FONT&gt;&lt;/TD&gt;
  &lt;TD BGCOLOR=&quot;f7efde&quot; ALIGN=CENTER&gt;
    &lt;FONT STYLE=&quot;ARIAL NARROW&quot; SIZE=1&gt; 
      &lt;%= RsProductList(&quot;UnitPrice&quot;)%&gt; 
    &lt;/FONT&gt;&lt;/TD&gt;
  
&lt;!--  Next Row = Record --&gt;
&lt;% 
RsProductList.MoveNext 
Loop 
'Remove Objects from Memory Freeing  
Set RsProductList = Nothing
Set OBJdbConnection = Nothing
%&gt;
&lt;/TABLE&gt;&lt;/FONT&gt;&lt;/Center&gt;&lt;/BODY&gt;&lt;/HTML&gt;</PRE>
<!-- CONTENTS_END -->
<!-- START PAGE FOOTER -->
<H6><HR size=1></H6>
<P><A ID=line HREF="#pagetop"><IMG src="../art/arrowup1.gif" WIDTH="17" HEIGHT="16" ALIGN="MIDDLE" BORDER="0" ALT="Up">&nbsp;Top of Page</A>
<BR><A ID=line HREF="http://www.microsoft.com/misc/cpyright.htm" TARGET="_top">&#169; 1997 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END PAGE FOOTER -->
</BLOCKQUOTE>
</BODY>
</HTML>