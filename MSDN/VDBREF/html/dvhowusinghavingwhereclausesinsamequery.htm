<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Using HAVING and WHERE Clauses in the Same Query</title>
                <style>@import url(msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="msdn_ie3.css">
</HEAD>
<BODY>

<h1><a name="dvhowusinghavingwhereclausesinsamequery"></a>Using HAVING and WHERE Clauses in the Same Query</h1>
<p>
<object id=alink_1 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="Font" value=",,,,underline">
<PARAM name="Text" value="Text:See Also">
<PARAM name="Flags" value=",,1">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="dvhowUsingHAVINGWHEREClausesInSameQuery_C;dvhowUsingHAVINGWHEREClausesInSameQueryC">
</object></p>
<p>
In some instances, you might want to exclude individual rows from groups (using a WHERE clause) before applying a condition to groups as a whole (using a HAVING clause).</p>
<p>
A HAVING clause is like a WHERE clause, but applies only to groups as a whole (that is, to the rows in the <a href="dvovrvisualdatabasetoolsglossary.htm#dvmsgresultset">result set</a> representing groups), whereas the WHERE clause applies to individual rows. A query can contain both a WHERE clause and a HAVING clause. In that case:
<ul type=disc>
<li>
The WHERE clause is applied first to the individual rows in the <a href="dvovrvisualdatabasetoolsglossary.htm#dvmsginputsource">input sources</a>. Only the rows that meet the conditions in the WHERE clause are grouped.<br><br></li>
<li>
The HAVING clause is then applied to the rows in the result set that are produced by grouping. Only the groups that meet the HAVING conditions appear in the query output. You can apply a HAVING clause only to columns that also appear in the GROUP BY clause or in an <a href="dvovrvisualdatabasetoolsglossary.htm#dvmsgaggregatefunction">aggregate function</a>.</li>
</ul>
<p>
For example, imagine that you are joining the <code>titles</code> and <code>publishers</code> tables to create a query showing the average book price for a set of publishers. You want to see the average price for only a specific set of publishers — perhaps only the publishers in the state of California. And even then, you want to see the average price only if it is over $10.00.</p>
<p>
You can establish the first condition by including a WHERE clause, which discards any publishers that are not in California, before calculating average prices. The second condition requires a HAVING clause, because the condition is based on the results of grouping and summarizing the data. The resulting <a href="dvovrvisualdatabasetoolsglossary.htm#dvmsgsql">SQL</a> statement might look like this:</p>
<pre><code>SELECT titles.pub_id, AVG(titles.price)
FROM titles INNER JOIN publishers
 &nbsp; ON titles.pub_id = publishers.pub_id
WHERE publishers.state = 'CA'
GROUP BY titles.pub_id
HAVING AVG(price) &gt; 10
</code></pre>
<p>
You can create both HAVING and WHERE clauses in the <object id=alink_2 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="DefaultTopic" value="_topic_not_found.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="dvrefGridPane">
</object><a href=JavaScript:alink_2.Click()>Grid pane</a> of the Query Designer. By default, if you specify a <a href="dvovrvisualdatabasetoolsglossary.htm#dvmsgsearchcondition">search condition</a> for a column, the condition becomes part of the HAVING clause. However, you can change the condition to be a WHERE clause.</p>
<p>
You can create a WHERE clause and HAVING clause involving the same column. To do so, you must add the column twice to the <b>Grid</b> pane, then specify one instance as part of the HAVING clause and the other instance as part of the WHERE clause.</p>
<p class=label>
<b>To specify a WHERE condition in an aggregate query</b>
<ol>
<li>
Specify the groups for your query. For details, see <a href="dvhowgroupingrowsinqueryresults.htm">Grouping Rows in Query Results</a>.<br><br></li>
<li>
If it is not already in the <b>Grid</b> pane, add the column on which you want to base the WHERE condition.<br><br></li>
<li>
Clear the check box in the <b>Output</b> column unless the data column is part of the GROUP BY clause or included in an aggregate function.<br><br></li>
<li>
In the <b>Criteria</b> column, specify the WHERE condition. The Query Designer adds the condition to the HAVING clause of the SQL statement.<p>
<img src="dv3w9g1.gif" border=0></P><p class=atl>
<B><b>Note</b></B>&nbsp;&nbsp;&nbsp;The query shown in the illustrations for this procedure joins two tables, <code>titles</code> and <code>publishers</code>.</p><p class=tl>
At this point in the query, the SQL statement contains a HAVING clause:</P><pre><code>SELECT titles.pub_id, AVG(titles.price)
FROM titles INNER JOIN publishers 
 &nbsp; ON titles.pub_id = publishers.pub_id
GROUP BY titles.pub_id
HAVING publishers.state = 'CA'
</code></pre>
</li>
<li>
In the <b>Group By</b> column, select <b>Where</b> from the list of group and summary options.&nbsp; The Query Designer removes the condition from the HAVING clause in the SQL statement and adds it to the WHERE clause.<p>
<img src="dv3w9g2.gif" border=0></P><p class=tl>
The SQL statement changes to include a WHERE clause instead:</P><pre><code>SELECT titles.pub_id, AVG(titles.price)
FROM titles INNER JOIN publishers 
 &nbsp; ON titles.pub_id = publishers.pub_id
WHERE publishers.state = 'CA'
GROUP BY titles.pub_id
</code></pre>
</li>
</ol>
</BODY>
</HTML>
