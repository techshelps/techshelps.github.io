<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Adding a Stored Procedure to Source Control in Data View</title>
                <style>@import url(msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="msdn_ie3.css">
</HEAD>
<BODY>

<h1><a name="dvhowaddingstoredproceduretosourcecontrolindataview"></a>Adding a Stored Procedure to Source Control in Data View</h1>
<p>
<object id=alink_1 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="Font" value=",,,,underline">
<PARAM name="Text" value="Text:See Also">
<PARAM name="Flags" value=",,1">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="dvhowAddingStoredProcedureToSourceControlInDataView_C">
</object></p>
<p>
In Microsoft<sup>®</sup> Visual InterDev™ and Microsoft<sup>®</sup> Visual J++™, you can add stored procedures to source control from the Data View window. This allows you to manage the stored procedures in your SQL Server database, and ensure that multiple developers can make changes to the stored procedures without losing changes due to overwritten files.</p>
<p>
For this release we are supporting only Microsoft<sup>®</sup> SQL Server™ version 6.5 databases (with at least Service Pack 3) and Microsoft<sup>®</sup> Visual SourceSafe™. </p>
<p>
The following information applies generally to the source control feature for stored procedures:
<ul type=disc>
<li>
All users work against the same database.<br><br></li>
<li>
When you open a stored procedure, the text is read from the database.<br><br></li>
<li>
The source control library and database should be in synch unless someone has a stored procedure checked out.<br><br></li>
<li>
You are prompted to log in to the source control library whenever you refresh the data connection or refresh the <b>Stored Procedures</b> folder in the Data View window. If your log in fails or if you cancel the dialog box, then Visual InterDev or Visual J++ will treat the stored procedures as if they were not under source control.<br><br></li>
<li>
You are allowed to view a stored procedure in the editor without checking it out from source control. However, the stored procedure is read-only. To edit the stored procedure, you must check it out.<br><br></li>
<li>
The settings on the <b>Source Control</b> tab of the <b>Options</b> dialog box do not affect using source control with stored procedures in the Data View window.</li>
</ul>
<p>
For stored procedures in the Data View window, a subset of the full source control features is available, as described in the procedures below.</p>
<p>
In order to utilize any source control features you must place the database under source code control. When you select this option all stored procedures in the database are added to the source control library.</p>
<p class=indent>
<B><b>Note</b></B>&nbsp;&nbsp;&nbsp;You must also have the Visual SourceSafe client files installed on the SQL Server computer. For more information, see "Setup Issues" below.</p>
<p class=label>
<b>To add a database to source control</b>
<ol>
<li>
Right-click on the data connection in the Data View window.<br><br></li>
<li>
Choose the <b>Add to Source Control</b> command.<p class=tl>
The <b>Enable Source Control</b> dialog box is displayed.</P><p>
<img src="dv56hq1.gif" border=0></P></li>

<li>
Enter the location of your source control database, a project name for your source control project, and a comment if desired.<p class=atl>
<B><b>Note&nbsp;&nbsp;&nbsp;</b></B>The source control database location (the Srcsafe.ini file) is relative to your SQL Server database, not to your local computer. In the figure, the C: drive and the path shown are on the computer containing the SQL Server database.</p></li>
<li value=4>
A lock icon is displayed next to each stored procedure in the database, indicating that it is under source control.<br><br></li>
<li>
New stored procedures added to a database under source control must be manually added to the source control library. </li>
</ol>
<p class=label>
<b>To add a new stored procedure to source control</b>
<ol>
<li>
Right-click the stored procedure in the Data View window.<br><br></li>
<li>
Choose the <b>Add to Source Control</b> command.<p class=tl>
The lock icon is displayed next to the stored procedure. The stored procedure is read from the database and placed in the source control library.</P></li>
</ol>
<p>
You can check out any of the stored procedures from the database and edit them in your project.</p>
<p class=label>
<b>To check out a stored procedure</b>
<ol>
<li>
Right-click the stored procedure in the Data View window.<br><br></li>
<li>
Choose the <b>Check Out</b> command.<p class=tl>
A check icon is displayed next to the stored procedure. </P></li>
</ol>
<p>
When you attempt to check out a stored procedure from source control, both the source control version and the database version are retrieved. These versions are then compared. If they are different, you are prompted for which version to use. You can select the database version (and choose to update the source control version), just use the database version, or just use the source control version.</p>
<p>
<img src="dv56hq2.gif" border=0></p>
<p>
If you select the source control version, the stored procedure is compiled on the database. If the compile fails, the stored procedure is opened in the editor and marked for editing.</p>
<p>
You can also click on the <b>View Differences</b> button and see a window displaying the different text for the source control and database versions of the stored procedure.</p>
<p>
After you have checked out and edited a stored procedure, you will want to check the changes back into the source control library. When this is done, the stored procedure is read from the database and updated in the source control library. If the stored procedure is open in an editor and marked for editing (as discussed above, the database compile failed when you tried to check the file out), the Check In command is disabled.</p>
<p class=label>
<b>To check in a stored procedure</b>
<ol>
<li>
Right-click the stored procedure in the Data View window.<br><br></li>
<li>
Choose the <b>Check In</b> command.<br><br></li>
<li>
Enter a comment for this version of the stored procedure in the source control library if you want.<p class=tl>
The check icon next to the stored procedure is removed. </P><p class=atl>
<B><b>Note</b></B>&nbsp;&nbsp;&nbsp;You always are working against the database. When you check in a file, the latest database version goes into source control.</p></li>
</ol>
<p>
You can undo a check out if you decide you don't want to save your changes.</p>
<p class=label>
<b>To undo a check out</b>
<ol>
<li>
Right-click the stored procedure in the Data View window.<br><br></li>
<li>
Choose the <b>Undo Check Out</b> command.<p class=tl>
The check icon next to the stored procedure is removed. The lock icon is displayed.</P></li>
</ol>
<p>
When you elect to undo a check out, an attempt is made to re-synchronize the source control library and the database. The previous version from the source control library is compiled on the database. If an error occurs in compiling, no further action is taken and the lock on source control is cleared. </p>
<p class=indent>
<B><b>Note</b></B>&nbsp;&nbsp;&nbsp;In this case, you're getting the source control version, and replacing the version that you have been modifying, because you decided to undo the check out.</p>
<h3>Setup issues</h3>
<p>
Microsoft Visual InterDev and Microsoft Visual J++ setup will automatically install Visual SourceSafe on your client computer. However, for the source control feature to work, you must install the Visual SourceSafe client software on the computer containing your SQL server. </p>
<p>
When you're installing Visual InterDev, make sure to select <b>Visual InterDev Server Setup</b> when this option is offered. This will install the Visual SourceSafe client software on your SQL server.</p>
<p>
In addition, the following procedure will help you set up your SQL server to use Visual SourceSafe with stored procedures.</p>
<h4>Setting Up Your Computer for Stored Procedure Source Control Through Microsoft Visual SourceSafe</h4>
<p>
When using source control with stored procedures, the SQL server will be logging into Visual SourceSafe and making the necessary operations on the Visual SourceSafe database. Therefore, it will require appropriate permissions to perform these actions. It is recommended to reduce the security issues by setting the SQL server service to run as a logged on user.</p>
<p class=label>
<b>To set the SQL server service to run as a logged on user </b>
<ol>
<li>
Click <b>Start Menu</b>, <b>Control Panel</b>, and run <b>Services</b>. <br><br></li>
<li>
Select the service <b>MSSQLServer</b> and click the <b>Startup</b> button. <br><br></li>
<li>
In the <b>Service</b> dialog box, select the option <b>This Account</b>. <br><br></li>
<li>
In the <b>This Account</b> text box, type a domain and user name (for example, "domain\username") that has access to the server where the Visual SourceSafe software is installed. <br><br></li>
<li>
Type a password into the <b>Password</b> text box. Click <b>OK</b>. <br><br></li>
<li>
Stop the <b>MSSQLServer</b> service and then restart it. </li>
</ol>
</BODY>
</HTML>
