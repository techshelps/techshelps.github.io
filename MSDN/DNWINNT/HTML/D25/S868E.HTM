<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Creating Scripts for RAS</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2"><FORM NAME="x"><OBJECT CLASSID="clsid:9c2ac687-ceef-11cf-96d9-00a0c903b016" NAME="iv"></OBJECT></FORM>
<H3>Creating Scripts for RAS</H3><P>The SWITCH.INF file is like a set of small batch files (scripts) contained in one file. The SWITCH.INF file can contain a different script for each intermediary device or online service that the RAS user will call. </P>
<P>A SWITCH.INF script has six elements: a section header, comments, commands, responses, response keywords, and macros.</P>
<H4><A NAME="sec0"></A>Section Headers</H4><P>Section headers divide the SWITCH.INF file into individual scripts. A section header marks the beginning of a script for a certain remote computer and must not exceed 31 characters. The text of a section header will appear in RAS when you activate the script. The section header is enclosed in square brackets. For example:</P>
<P><BR></P>
<pre><code>[Route 66 Logon]
</code></pre>
<H4><A NAME="sec1"></A>Comment Lines</H4><P>Comment lines must have a semicolon (;) in column one and can appear anywhere in the file. Comment lines contain information for those who maintain the SWITCH.INF file. For example:</P>
<P><BR></P>
<pre><code>; This script was created by MariaG on September 29, 1996
</code></pre>
<H4><A NAME="sec2"></A>Commands</H4><P>Each line in a script is a command from your local computer to the remote computer or a response from the remote computer to your local computer. Each command or response is a stream of data or text. For example, this command sends a username (MariaG) and a carriage return (the macro <B>&lt;cr&gt;</B>) to the remote computer.</P>
<P><B>COMMAND=MariaG&lt;cr&gt;</B></P>
<P>The commands and responses must be in the exact order in which the remote device expects them. Branching statements, such as GOTO or IF, are not supported. </P>
<P>The required sequence of commands and responses for a specific remote device should be in the documentation for the device, or, if you are connecting to a commercial service, from the support staff of that service. If the exact sequence is not available, activate the generic script provided with RAS and modify it to match the logon sequence of the remote computer as described in the section "Troubleshooting Scripts Using DEVICE.LOG," later in this chapter.</P>
<P>The COMMAND= statement can be used in two additional ways:</P>
<P><BR></P>
<pre><code>COMMAND= 
NoResponse
</code></pre>
<P>This is the default behavior and causes an approximate two-second delay. This can be useful when the intermediate device requires a delay.</P>
<P><BR></P>
<pre><code>COMMAND= <I>string</I>
</code></pre>
<P></P>
<P CLASS="nh"><B>Note</B></P>
<P>s<I>tring</I> is not followed by a carriage return (&lt;<B>cr</B>&gt;). This is useful when a device requires slow input. Instead of receiving the whole command string, the device requires characters to be sent one-by-one.</P>
<P></P>
<P>The following is an example where the intermediary device is so slow that it is only able to receive and process one character of the command PPP at a time. </P>
<P><BR></P>
<pre><code>COMMAND=P
NoResponse

COMMAND=P
NoResponse

COMMAND=P
NoResponse
</code></pre>
<H4><A NAME="sec3"></A>Responses</H4><P>A response is sent from the remote device or computer. To write an automatic script, you must know the responses you will receive from the remote device. If there is a gap of two or more seconds between characters, the received text is sent as a response. This gap is the only cue that a response is over. For more information, see the following section, "Getting Through Large Blocks of Text and Two-Second Gaps" later in this chapter. </P>
<H4><A NAME="sec4"></A>Response Keywords</H4><P>The keyword in a response line specifies what to do with the responses you receive from the remote computer:</P>
<P CLASS="term1"><B>OK=</B><I>remote computer response&lt;macro&gt;</I></P>
<P CLASS="dt1">The script continues to the next line if the response or macro is encountered.</P>
<P CLASS="term1"><B>LOOP=</B><I>remote computer response&lt;macro&gt;</I></P>
<P CLASS="dt1">The script returns to the previous line if the response or macro is encountered.</P>
<P CLASS="term1"><B>CONNECT=</B><I>remote computer response</I> &lt;<I>macro</I>&gt;</P>
<P CLASS="dt1">Used at the end of a successful modem script. Not generally useful for the SWITCH.INF file.</P>
<P CLASS="term1"><B>ERROR=</B><I> remote computer response</I> &lt;<I>macro</I>&gt;</P>
<P CLASS="dt1">Causes RAS to display a generic error message if the response is encountered. Useful for notifying the RAS user when the remote computer reports a specific error.</P>
<P CLASS="term1"><B>ERROR_DIAGNOSTICS=</B><I> remote computer response</I> &lt;<B>diagnostics</B>&gt;</P>
<P CLASS="dt1">Causes RAS to display the specific cause for an error returned by the device. Not all devices report specific errors. Use <B>ERROR=</B> if your device does not return specific errors that can be identified with Microsoft RAS diagnostics.</P>
<P CLASS="term1"><B>NoResponse</B></P>
<P CLASS="dt1">Used when no response will come from the remote device.</P>
<P></P>
<P>RAS on the local computer always expects a response from the remote device and will wait until a response is received unless a <B>NoResponse</B> statement follows the <B>COMMAND=</B> line. If there is no statement for a response following a <B>COMMAND= </B>line, the <B>COMMAND=</B> line will execute and stop the script at that point.</P>
<H4><A NAME="sec5"></A>Macros</H4><P>Macros are enclosed in angle brackets (&lt; &gt;). Macros perform the following special functions.</P>
<P CLASS="term1"><B>&lt;cr&gt;</B></P>
<P CLASS="dt1">Inserts a carriage return.</P>
<P CLASS="term1"><B>&lt;lf&gt;</B></P>
<P CLASS="dt1">Inserts a line feed.</P>
<P CLASS="term1"><B>&lt;match&gt; "</B><I>string</I><B>"</B></P>
<P CLASS="dt1">Reports a match if the string enclosed in quotation marks is found in the device response. Each character in the string is matched according to uppercase and lowercase. For example, <B>&lt;match&gt;</B> "Smith" matches Jane Smith and John Smith III, but not SMITH.</P>
<P CLASS="term1"><B>&lt;?&gt;</B></P>
<P CLASS="dt1">Inserts a wildcard character, for example, <B>CO&lt;?&gt;&lt;?&gt;2</B> matches COOL2 or COAT2, but not COOL3.</P>
<P CLASS="term1"><B>&lt;hXX&gt;</B> (XX are hexadecimal digits)</P>
<P CLASS="dt1">Allows any hexadecimal character to appear in a string including the zero byte, <B>&lt;h00&gt;</B>.</P>
<P CLASS="term1"><B>&lt;ignore&gt;</B></P>
<P CLASS="dt1">Ignores the rest of a response from the macro on.</P>
<P CLASS="term1"><B>&lt;diagnostics&gt;</B></P>
<P CLASS="dt1">Passes specific error information from a device to RAS. This enables RAS to display the specific error to RAS users. Otherwise, a nonspecific error message appears.</P>
<P></P>
<H4><A NAME="sec6"></A>New Macros in Windows&nbsp;NT 3.51</H4><P>The following two macros enable your username and password logon credentials to be automatically passed to the remote computer.</P>
<P CLASS="term1"><B>&lt;username&gt;</B></P>
<P CLASS="dt1">The username entered in the RAS Authentication window is sent to the remote computer. This is not supported with SLIP connections.</P>
<P CLASS="term1"><B>&lt;password&gt;</B></P>
<P CLASS="dt1">The password entered in the RAS Authentication window is sent to the remote computer. This is not supported with SLIP connections.</P>
<P CLASS="proch"><B>If both of the following situations are true, a Retry Authentication dialog box appears with a message that your logon credentials have failed</B></P>
<P CLASS="ls">    1.    You are calling into a system with an intermediary security device. This situation would generally not apply if you are using RAS to call an Internet provider.</P>
<P CLASS="ls">    2.    After the security device has logged you on successfully, you are attempting to log on to a Windows&nbsp;NT RAS server.</P>
<P CLASS="lt1">The reason this message appears is that the RAS Authentication dialog box username and password boxes are used by the two new username and password macros as well as by Windows&nbsp;NT RAS servers. </P>
<P CLASS="lt1">For example, if the logon information for an intermediary security device that is plugged in between the Windows&nbsp;NT RAS server and its modem is username: "BB318" and password: "34554377", but on the Windows&nbsp;NT RAS server it is username: "BB318" and password: "treehouse", then your logon to the intermediary device will succeed, but your logon to the Windows&nbsp;NT RAS server will fail. </P>
<P CLASS="lt1">Logon will fail because the security device password of "34554377" is different from the Windows&nbsp;NT domain password. Windows&nbsp;NT will prompt you with the Retry Authentication dialog box to obtain your proper Windows NT logon credentials, in this case the password.</P>
<P></P>
<P CLASS="proch"><B>To eliminate the Retry Authentication dialog box, you have the following options</B></P>
<P CLASS="ls">    1.    Ask your administrator to make your username and password identical on both systems, although this is not advisable because it would defeat the purpose of the security device.</P>
<P CLASS="ls">    2.    Do not use the shared dialog box for the intermediary device logon credentials by entering the username and password in clear text into the SWITCH.INF file according to the [Generic login for YourLoginHere] script provided in SWITCH.INF. In order to keep your clear-text password confidential you need to use Windows&nbsp;NT file system (NTFS) file permissions to prevent other users from accessing this file.</P>
<P></P>
<H4><A NAME="sec7"></A>Stepping Through an Example Script</H4><P>This section describes each part of the generic script provided in the SWITCH.INF file included with RAS. </P>
<P>Every script must start with a command to the remote computer followed by one or more response lines. This initial command often may be simply to wait for the remote computer to initialize and send its logon banner. The default initial command is to wait two seconds for the logon banner. It would look like this in the SWITCH.INF file:</P>
<P><B>COMMAND=</B></P>
<P>If the response, (the logon banner from the remote computer) is the following:</P>
<P><BR></P>
<pre><code>Welcome to Gibraltar Net. Please enter your login:<BR></code></pre>
<P>then the corresponding response line in the SWITCH.INF file should be:</P>
<P><B>OK=&lt;match&gt;"Please enter your login:"</B></P>
<P>This line indicates that everything is correct if the remote computer sends the string "Please enter your login:". You respond by sending a command with the characters in your username and the carriage return.</P>
<P><B>COMMAND=MariaG&lt;cr&gt;</B></P>
<P>If the response from the remote computer is the following:</P>
<P><BR></P>
<pre><code>Please enter your password:<BR></code></pre>
<P>then the corresponding response line in the SWITCH.INF file should be:</P>
<P><B>OK=&lt;match&gt;"Please enter your password:"</B></P>
<P>To send your password, you would send the command:</P>
<P><B>COMMAND=mUs3naB&lt;cr&gt;</B></P>
<P>On many PPP computers, this script would automatically log you on. </P>
<H4><A NAME="sec8"></A>Automating Log On to SLIP Computers</H4><P>On SLIP systems you are also required to enter an IP address, so even though you can automate much of the logon sequence, you must manually enter your IP address in the SLIP terminal window. A permanent IP address may be provided to you in advance, or the SLIP Login Terminal window may provide a different IP Address each time you log on. This is an example of why PPP connections are usually easier to use.</P>
<P>However, it is possible to fully automate connections to a SLIP provider using the command-line utility RASDIAL.EXE, but only if all of the following conditions are true:</P>
<UL><LI> <FONT FACE="symbol">•</FONT>    The SLIP provider assigns you the same IP address every time you call.</LI><LI> <FONT FACE="symbol">•</FONT>    You have called at least once using the Remote Access program and filled in the IP address field at the lower right corner of the SLIP Terminal window so that the permanent IP address can be stored by RAS for the next connection with the RASDIAL.EXE utility.</LI><LI> <FONT FACE="symbol">•</FONT>    The SLIP logon sequence is automated by an After Dialing SWITCH.INF script. Note that the script you create would not have to include any commands or responses using the IP address because the IP address is permanently stored by RAS (until you delete your particular phonebook entry).</LI></UL><P></P>
<P>If any of the above conditions are not true, you cannot use the RASDIAL.EXE utility to connect to your SLIP provider because your IP address will not get set correctly.</P>
<P></P>
<P CLASS="nh"><B>Note</B></P>
<P>RASDIAL.EXE is in your <I>systemroot</I>\SYSTEM32 directory. The automatic redial upon link failure feature, which is present in the Remote Access program (RASPHONE.EXE), is not part of RASDIAL.EXE. For help on RASDIAL.EXE, type RASDIAL /? at a Windows&nbsp;NT command prompt.</P>
<P></P>
<H4><A NAME="sec9"></A>Getting Through Large Blocks of Text and Two-Second Gaps</H4><P>If the remote computer has a two-second gap in the data stream reponse to your computer, RAS assumes that the gap is the end of the response. These gaps may occur anywhere, including between words, and can only be detected using DEVICE.LOG. For more information, see the "Troubleshooting Scripts Using DEVICE.LOG" section later in this chapter. </P>
<P>If you write a script that seems to fail for no reason, consult DEVICE.LOG to see if a response ends in the middle of a word. If so, your script must account for the two-second gap. A simple way to do this is to include the command:</P>
<P><B>COMMAND=&lt;cr&gt;</B></P>
<P>You can skip to the end of large blocks of text that contain multiple gaps by using the <B>LOOP=</B> keyword and by matching text at the end of a block. For example,</P>
<P><B>COMMAND=&lt;cr&gt;<BR>OK=&lt;match&gt;"Enter the service to start:"<BR>LOOP=&lt;ignore&gt;</B></P>
<P>In this example, RAS sends a null command (waits two seconds), RAS then waits for the message "Enter the service to start:". If this is a long block of text, RAS does not find the string so RAS then moves to the <B>LOOP</B> command. The <B>LOOP</B> command causes RAS to return to the line above, and RAS waits for the words "Enter the service to start:" in the second response. In this manner, you can loop though long blocks of text until you reach the text of the desired prompt.</P>
<H4><A NAME="sec10"></A>Commands and Carriage Returns</H4><P>Usually, you must include <B>&lt;cr&gt;, </B>which indicates a carriage return, at the end of a command. The carriage return causes the remote computer to process the command immediately. If you do not include <B>&lt;cr&gt;</B>, the remote computer may not recognize the command. </P>
<P>In other situations, <B>&lt;cr&gt;</B> cannot be used because the remote computer accepts the command without a carriage return and requires time to process the command. This situation mainly applies when you are sending a series of commands without expecting a response.</P></FONT></BODY></HTML>
