<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>User Authentication</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2"><FORM NAME="x"><OBJECT CLASSID="clsid:9c2ac687-ceef-11cf-96d9-00a0c903b016" NAME="iv"></OBJECT></FORM>
<H3>User Authentication</H3><P>On a Windows&nbsp;NT Workstation computer or a Windows&nbsp;NT Server computer that is not a domain controller, the Netlogon service processes logon requests for the local computer and passes through logon requests to a domain server. </P>
<P>The Netlogon service processes authenticates a logon request in three steps:</P>
<OL><LI>Discovery</LI><LI>Secure channel setup</LI><LI>Pass-through authentication (where necessary)</LI></OL><H4><A NAME="sec0"></A>Discovery</H4><P>When a user logs on to a domain from a Windows&nbsp;NT Workstation computer or a Windows&nbsp;NT Server computer that is not a domain controller, the computer must determine the location of a domain controller in its domain. If the computer is part of a workgroup, not a domain, the Netlogon service terminates. (If the workstation is not connected to a network, Windows&nbsp;NT treats it like a member of a workgroup consisting of one member.) </P>
<P>When a Windows&nbsp;NT Workstation computer or a Windows&nbsp;NT Server computer that is not a domain controller starts up, it attempts to locate a Windows&nbsp;NT Server computer in each  trusted domain. (There is an implicit trust between the client and domain controllers in its own domain.) In either case, the server located can be either a primary domain controller (PDC) or a backup domain controller (BDC). The act of locating a domain controller to connect to is called <I>discovery. </I>Once a domain controller has been discovered, it is used for subsequent user authentication. </P>
<P>When a domain controller is started up, the Netlogon service attempts discovery with all trusted domains. (Discovery is not necessary on the domain controller's own domain, because it has access to its own SAM database.) Each domain is called three times in intervals of five seconds before discovery fails. If a trusted domain does not respond to a discovery attempt, the domain controller attempts another discovery every 15 minutes until it locates a domain controller on the trusted domain. If the domain controller receives an authorization request for the trusted domain for which discovery has not yet been successful, it attempts another discovery immediately, no matter when the last discovery was attempted.</P>
<H4><A NAME="sec1"></A>Secure Communication Channel</H4><P>Before a connection between two Windows&nbsp;NT computers is allowed, each computer's Netlogon service must be satisfied that the computer at the other end of the connection is identifying itself correctly. To do this, each computer's Netlogon service issues and verifies challenge and challenge response information. When this information is successfully completed, a secure channel is established and a communication session set up between the two computers' Netlogon services. The session can be ended without terminating the secure channel. The secure channel is used to pass subsequent network API calls between the two computers. The secure communication channel is used to pass the username and encrypted password during pass-through authentication. Pass-through authentication is discussed in detail later in this chapter.</P>
<P>The Netlogon service maintains security on these communication channels by using user-level security to create the channel. The following special internal user accounts are created:</P>
<UL><LI><I>Workstation trust</I> accounts, which allow a domain workstation to perform pass-through authentication for a Windows&nbsp;NT Server computer in the domain, as described later in this chapter</LI><LI><I>Server trust</I> accounts, which allow Windows&nbsp;NT Server computers to get copies of the master domain database from the domain controller</LI><LI><I>Interdomain trust</I> accounts, which allow a Windows&nbsp;NT Server computer to perform pass-through authentication to another domain</LI></UL><P>The Netlogon service attempts to set up a secure channel when it is started, as soon as discovery is completed. Failing that, Netlogon retries every 15 minutes or whenever an action requiring pass-through authentication occurs. To reduce network overhead among trusted domains, the Netlogon service on a domain controller creates a secure channel only when it is needed. </P>
<P></P>
<P><b>Note</b></P>
<P>If the secure channel cannot be created at logon (for example, because the domain controllers are offline), the Netlogon service starts anyway. If the user's interactive logon uses the same domain name and username, the user's interactive logon is successfully completed using cached credentials.</P>
<P>A Windows&nbsp;NT computer stores the information used to authenticate the last several (ten, by default) users who logged on interactively. That way, if all the domain controllers are down at the same time, the last several users who connected to the computer can still log on. Additionally, the credentials of all users who have logged on from the local computer are stored in the local SAM database. </P>
<P></P>
<H4><A NAME="sec2"></A>Pass-through Authentication</H4><P>Pass-through authentication occurs when a user account must be authenticated, but the local computer can't authenticate the account itself. In this case, the username and password are forwarded to a Windows&nbsp;NT Server computer that can authenticate the user, and the user's information is returned to the requesting computer.</P>
<P>Pass-through authentication occurs in the following instances:</P>
<UL><LI>At interactive logon when a user at a Windows&nbsp;NT Workstation computer or a Windows&nbsp;NT Server computer that is not a domain controller is logging onto a domain or trusted domain</LI><LI>At remote logon when the domain specified is a trusted domain</LI></UL><P>Figure 4.6 illustrates pass-through authentication. In this example, AnnM wants to access a computer in the London domain. Because the London domain trusts AnnM's home domain (Topeka), it asks the Topeka domain to authenticate AnnM's account information.</P>
<P><img src="XRGW17.gif"></P>
<P>Figure 4.6    Pass-Through Authentication</P>
<P>The Netlogon service provides this pass-through authentication. Each Windows&nbsp;NT computer participating in the domain must be running the Netlogon and Workstation services. (Netlogon is dependent on the Workstation service.) The Netlogon service communicates with the Netlogon service on the remote computer, as illustrated in Figure 4.7.</P>
<P><img src="XRGW18.gif"></P>
<P>Figure 4.7    Netlogon Requirements for Domain Logons</P>
<P>If the user account is in a trusted domain, the request must first be passed from the computer in the trusting domain to a domain controller in its domain. The domain controller then passes the request to a domain controller in the trusted domain, which authenticates the user account information and then returns the user information by the reverse route.</P></FONT></BODY></HTML>
