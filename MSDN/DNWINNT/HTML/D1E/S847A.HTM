<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Maintaining Registry Security</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2"><FORM NAME="x"><OBJECT CLASSID="clsid:9c2ac687-ceef-11cf-96d9-00a0c903b016" NAME="iv"></OBJECT></FORM>
<H3>Maintaining Registry Security</H3><P>Don't allow users to log on as members of the Administrators group unless a specific individual has administrative duties.</P>
<P>You might also choose not to put REGEDT32.EXE on workstations, since you can easily administer any workstation from a remote computer. You can also place access controls in File Manager on REGEDT32.EXE, limiting the rights of users to start this program.</P>
<P>This section describes the following additional steps you can take to protect the Registry:</P>
<UL><LI>     Protecting Registry files</LI><LI>     Assigning access rights to Registry keys</LI><LI>     Auditing Registry activities</LI></UL><H4><A NAME="sec0"></A>Protecting Registry Files for User Profiles</H4><P>You can protect the Registry hive files for user profiles in the same way that you protect other files in Windows&nbsp;NT—by restricting access through File Manager. If the files are stored on an NTFS volume, you can use the commands on the Security menu in File Manager to assign permissions. For details about using these commands, see the online Help in File Manager.</P>
<P><B>Caution</B>   You should only change permissions for user profile hives. The permissions for other hives are maintained automatically by the system and should not be changed.</P>
<P>For information about safeguarding files with backups, see "Backing Up and Restoring Registry Hives," later in this chapter.</P>
<H4><A NAME="sec1"></A>Assigning Access Rights to Registry Keys</H4><P>To determine who has access to specific Registry data, set permissions on the Registry keys to specify the users and groups that can access that key. This is sometimes called <I>changing ACLs</I>, in reference to the Access Control Lists that govern who has access to data. You can also add or remove names from the list of users or groups authorized to access the Registry keys.</P>
<P>You can assign access rights to Registry keys regardless of the type of file system on the partition where the Windows&nbsp;NT files are stored.</P>
<P></P>
<P><B>Caution</B></P>
<P>Changing the permissions to limit access to a Registry key can have severe consequences. If, for example, you set No Access permissions on a key that the Network Control Panel application needs for configuration, it will cause the application to fail.</P>
<P>At a minimum, ensure that Administrators and the System have full access to the key, to ensure that the system starts and that the Registry key can be repaired by an administrator.</P>
<P>If you change permissions on a Registry key, you should audit the key for failed access attempts. For details, see "Auditing Registry Activities," later in this chapter.</P>
<P></P>
<P>Because assigning permissions on specific keys can have drastic consequences, you should reserve this action for keys that you add to accommodate custom applications or other custom settings. After you change permissions on a Registry key, be sure to turn on auditing in User Manager, and then test the system extensively through a variety of activities while logged on under different user and administrative accounts.</P>
<P>In the Registry Editor, the commands on the Security menu for assigning permission and ownership of keys work the same as similar commands in File Manager for assigning access rights for files and directories. For details about these commands, see the online Help in Registry Editor. For a detailed discussion of permissions and ownership, see "Securing Directories and Files" in Chapter 4, "File Manager," in the <I>Windows&nbsp;NT System Guide.</I></P>
<H4><A NAME="sec2"></A>To assign permission on a key</H4><OL><LI>    Make a backup copy of the Registry key before making changes.</LI><LI>    Select the key for which you want to assign access permission, and then from the Security menu, choose the Permissions command.</LI><LI>    In the Registry Key Permissions dialog box, assign an access level to the selected key by selecting an option in the Type of Access box as described in the following table, and then choose the OK button.</LI></OL><P></P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="70pt" VALIGN="TOP"><COL WIDTH="261pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>Type of access </P></TD><TD VALIGN="TOP"><P>Meaning</P></TD></TR><TR><TD VALIGN="TOP"><P>Read </P></TD><TD VALIGN="TOP"><P>Allows users on the Permissions list to read the key's contents, but prevents changes from being saved.</P></TD></TR><TR><TD VALIGN="TOP"><P>Full Control </P></TD><TD VALIGN="TOP"><P>Allows users on the Permissions list to access, edit, or take ownership of the selected key.</P></TD></TR><TR><TD VALIGN="TOP"><P>Special Access</P></TD><TD VALIGN="TOP"><P>Allows users on the Permissions list some custom combination of access and edit rights for the selected key. For a description of the Special Access types, see "Auditing Registry Activities," later in this chapter.</P></TD></TR></TBODY></TABLE>
<P><BR></P><OL start=4><LI>    Turn on auditing in User Manager, and then test the system extensively to ensure that the new access control does not interfere with system or application operations.</LI></OL><P>As a system administrator, you may need to take ownership of a key to protect access to that key. You take ownership of a Registry key by choosing the Owner command from the Security menu in Registry Editor, and then completing the Ownership dialog box. You can also add users or groups to the Permissions list by following the same procedure for managing lists of users and groups as appears throughout Windows&nbsp;NT.</P>
<P>You (or any user) can take ownership of any Registry key if you log onto the computer as a member of the Administrator group. However, if an Administrator takes ownership of a key without being assigned full control by its owner, the key cannot be given back to its original owner, and the event is audited.</P>
<H4><A NAME="sec3"></A>Auditing Registry Activities</H4><P>Auditing Registry activities requires several separate activities:</P>
<UL><LI>     Turning on auditing and setting the audit policies in User Manager or User Manager for Domains for the activities you want to audit</LI><LI>     Specifying the groups and users whose activities you want to audit for selected keys, by choosing the Auditing command in Registry Editor</LI><LI>     Viewing the Security log in Event Viewer for a selected computer to see the results of auditing</LI></UL><P>For each of these activities, you must be logged on as a member of the Administrators group for the specific computer you are auditing. Auditing policies are set on a per-computer basis. Before you can audit activities in Registry keys, you must turn on security auditing for the computer. </P>
<H4><A NAME="sec4"></A>To turn on auditing</H4><OL><LI>    In User Manager or User Manager for Domains, choose the Audit command from the Policies menu, and select the Audit These Events option to turn on auditing.</LI><LI>    Check Success and Failure options for each type of event to be audited, and then choose the OK button.</LI></OL><P></P>
<P><B>Note   </B>At a minimum, you should check the Failure option for File And Object Access. Choosing the Success option for many items may produce an abundance of meaningless entries in the event log.</P>
<P>You may want to audit actions for a specific Registry key. For example, you might want to audit the following:</P>
<UL><LI>     Keys where you want to know about changes being made by users or applications</LI><LI>     Keys you added that you want to test</LI></UL><H4><A NAME="sec5"></A>To audit user actions for a selected Registry key</H4><OL><LI>    From the Security menu in Registry Editor, choose the Auditing command, and then complete the dialog box. 
<P>This command in Registry Editor is similar to the Auditing command in File Manager. For details about the Auditing dialog box, choose online Help in Registry Editor. For a discussion of general issues related to the Auditing command, see "Auditing Files and Directories" in Chapter 4, "File Manager," in the <I>Windows&nbsp;NT System Guide.</I></P></LI><LI>    Check the Success or Failure check box for the following activities:</LI></OL><P></P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="89pt" VALIGN="TOP"><COL WIDTH="244pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>Audit option</P></TD><TD VALIGN="TOP"><P>Audit events that attempt to</P></TD></TR><TR><TD COLSPAN="2" VALIGN="TOP"><P></P></TD></TR><TR><TD VALIGN="TOP"><P>Query Value</P></TD><TD VALIGN="TOP"><P>Open a key with Query Value access</P></TD></TR><TR><TD VALIGN="TOP"><P>Set Value</P></TD><TD VALIGN="TOP"><P>Open a key with Set Value access</P></TD></TR><TR><TD VALIGN="TOP"><P>Create Subkey</P></TD><TD VALIGN="TOP"><P>Open a key with Create Value access</P></TD></TR><TR><TD VALIGN="TOP"><P>Enumerate Subkeys</P></TD><TD VALIGN="TOP"><P>Open a key with Enumerate Subkeys access (that is, events that try to find the subkeys of a key)</P></TD></TR><TR><TD VALIGN="TOP"><P>Notify</P></TD><TD VALIGN="TOP"><P>Open a key with Notify access</P></TD></TR><TR><TD VALIGN="TOP"><P>Create Link</P></TD><TD VALIGN="TOP"><P>Open a key with Create Link access</P></TD></TR><TR><TD VALIGN="TOP"><P>Delete</P></TD><TD VALIGN="TOP"><P>Delete the key </P></TD></TR><TR><TD VALIGN="TOP"><P>Write DAC</P></TD><TD VALIGN="TOP"><P>Determine who has access to the key</P></TD></TR><TR><TD VALIGN="TOP"><P>Read Control</P></TD><TD VALIGN="TOP"><P>Find the owner of a key</P></TD></TR></TBODY></TABLE>
<P><BR></P><H4><A NAME="sec6"></A>To view the results of auditing</H4><UL><LI>     Run Event Viewer, select the computer that you are interested in, and then choose the Security command from the Log menu.</LI></UL><P><B>Note</B>   If you change permission for any Registry key, you should turn on Auditing in User Manager and specify the Failure attempts for File And Object Access to be audited. Then you can check the Security event log for details if any application isn't working because of changes in permissions.</P></FONT></BODY></HTML>
