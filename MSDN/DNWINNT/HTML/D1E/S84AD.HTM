<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Creating User Profile Hives</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2"><FORM NAME="x"><OBJECT CLASSID="clsid:9c2ac687-ceef-11cf-96d9-00a0c903b016" NAME="iv"></OBJECT></FORM>
<H3>Creating User Profile Hives</H3><P>With the appropriate access permission, a user can save a locally cached copy of a user profile. The directory and filename of the hive are added as a value under the following Registry key, where <I>SID_#</I> represents a key with the same name as the security ID assigned to the user:</P>
<P><BR></P>
<pre><code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows&nbsp;NT\CurrentVersion<BR>   \ProfileList\<I>SID_#</I></code></pre>
<P>When the user logs on, the hive defined in the particular ProfileList<B>\</B><I>SID_#</I> subkey is loaded, with a root key whose name matches the <I>SID_#</I> as a child key of HKEY_USERS. HKEY_CURRENT_USER points to this key. </P>
<P>The available user profile hives on a computer will consist of any hives created using User Profile Editor or saved locally by a user who logged on with appropriate permissions, as defined in User Manager for Domains. The ProfileList subkeys define all the known user hives on the local computer.</P>
<P>The hive that is loaded when a user logs on depends on whether the user has an assigned profile, as described in the following tables.</P>
<P><B>Table 12.1  Creating a Hive for a User Without an Assigned Profile</B></P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="113pt" VALIGN="TOP"><COL WIDTH="233pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>Scenario</P></TD><TD VALIGN="TOP"><P>How hive is created</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">If the user has permission to keep a local copy of a profile</P></TD><TD VALIGN="TOP"><P CLASS="tt">A copy of the User Default profile (USERDEF) is loaded under the key HKEY_USERS\<I>SID_#</I>, and a local copy of this profile is saved as the user's profile. This hive is created when you install Windows&nbsp;NT and is saved as S<I>ystemRoot</I>\SYSTEM32\CONFIG\USERDEF.</P>
<P CLASS="tt">The user's local copy resides in the same directory. When the user logs off, all changes made to the profile are saved to the local profile just created.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">If the user doesn't have permission to keep a local copy of a profile (that is, Guest accounts)</P></TD><TD VALIGN="TOP"><P CLASS="tt">USERDEF is copied to a temporary file (S<I>ystemRoot</I>\SYSTEM32\CONFIG\TMPDEF00) and this copy will be used by the user. When the user logs off, all changes made to the profile are lost.</P></TD></TR></TBODY></TABLE>
<P><BR></P><P>For a user with an assigned profile, that profile is used whenever possible. Otherwise, the rules shown in the following tables are used to create a hive.</P>
<P><B>Table 12.2    Creating a Hive with an Assigned Profile on a Local Computer</B></P>

<TABLE COLS="3" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="112pt" VALIGN="TOP"><COL WIDTH="0pt" VALIGN="TOP"><COL WIDTH="233pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD COLSPAN="2" VALIGN="TOP"><P>Scenario</P></TD><TD COLSPAN="2" VALIGN="TOP"><P>How hive is created</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">If the user has a mandatory profile (with a .MAN filename extension) on a local and on a remote computer</P></TD><TD COLSPAN="2" VALIGN="TOP"><P CLASS="tt">The profile is copied to a temporary file in the <I>SystemRoot</I>\SYSTEM32\CONFIG directory, and the user will use this temporary profile. All changes made to this profile are lost when the user logs off.</P>
<P CLASS="tt">If the mandatory profile is not accessible (for example, if the server is down or if there is no access permission for the file), the user is not able to log on.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">If the user has a personal profile on a local computer but the profile is not accessible</P></TD><TD COLSPAN="2" VALIGN="TOP"><P CLASS="tt">The user will get a copy of USERDEF.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">If the user has a personal profile on a remote computer but doesn't have permission to save a local copy</P></TD><TD COLSPAN="2" VALIGN="TOP"><UL><LI>If the remote profile is accessible, it is saved as a temporary file in <I>SystemRoot</I>\SYSTEM32\CONFIG directory. The user's changes are saved back to the remote profile when the user logs off.</LI><LI>If the remote profile is not accessible (for example, if the server is down or if there is no access permission for the file) and there is no local copy of the user's profile, a copy of USERDEF is saved as a temporary file in the \CONFIG directory. This temporary profile is used for the user's entire logon session. Changes made to the profile are lost when the user logs off.</LI></UL></TD></TR></TBODY></TABLE>
<P><BR></P><P>This last table shows how a hive is created if the user has a personal profile on a remote computer and has permission to save a local copy.</P>
<P><B>Table 12.3  Creating a Hive for a User with a Profile on a Remote Computer</B></P>

<TABLE COLS="3" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="112pt" VALIGN="TOP"><COL WIDTH="0pt" VALIGN="TOP"><COL WIDTH="233pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD COLSPAN="2" VALIGN="TOP"><P>Scenario</P></TD><TD COLSPAN="2" VALIGN="TOP"><P>How hive is created</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">If the remote profile is accessible and there are no local copies of the profile on the local computer</P></TD><TD COLSPAN="2" VALIGN="TOP"><P CLASS="tt">The remote profile is copied as <I>SystemRoot</I>\SYSTEM32\CONFIG\USER002.</P>
<P CLASS="tt">Then this local copy is loaded into the Registry as the user's profile. At logoff, the changes are saved to the local copy, and the local copy is copied back to the remote profile file.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">If the remote profile is accessible and a local copy exists</P></TD><TD COLSPAN="2" VALIGN="TOP"><P CLASS="tt">The newest file overwrites the older version, and the file is treated as described above.</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">If the remote profile is not accessible but a local copy exists</P></TD><TD COLSPAN="2" VALIGN="TOP"><P CLASS="tt">The local copy is loaded into the Registry and used as the user's profile. At logoff, the changes are saved to the local copy, which is copied to the remote profile file at the next log on (if the remote profile is accessible and if the date on the local copy is newer than that for the remote profile).</P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="tt">If the remote profile is not accessible and the local copy does not exist</P></TD><TD COLSPAN="2" VALIGN="TOP"><P CLASS="tt">A copy of USERDEF is saved to the local profile copy path and is loaded in the Registry to be used as the user's profile. At logoff time, the changes made to the profile are saved in the local profile.</P></TD></TR></TBODY></TABLE>
<P><BR></P></FONT></BODY></HTML>
