<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Creating the Performance DLL</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2"><FORM NAME="x"><OBJECT CLASSID="clsid:9c2ac687-ceef-11cf-96d9-00a0c903b016" NAME="iv"></OBJECT></FORM>
<H2>Creating the Performance DLL</H2><P>An application's performance DLL defines the counter and object data structures that it uses to pass performance data to the performance monitor application. The DLL also provides up to three exported functions—Open, Collect, and Close— that are called by the Registry controller in response to requests from a performance monitoring program. The Collect function is required, while Open and Close are optional. Whichever ones you provide, be sure to export them in your .DEF file.</P>
<P>The prototypes for these functions, and the structures and constants used to define counters and counter objects, are defined in the WINPERF.H file distributed with the Windows&nbsp;NT Software Development Kit (SDK). For more information about using the structures and constants to define counters and counter objects, refer to Chapter 12 of this book, the comments in the WINPERF.H file, and to the SDK documentation on performance monitoring.</P>
<P>Table 13.4    Performance DLL Functions</P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="56pt" VALIGN="TOP"><COL WIDTH="291pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>Function</P></TD><TD VALIGN="TOP"><P>Description</P></TD></TR><TR><TD VALIGN="TOP"><P>Open</P></TD><TD VALIGN="TOP"><P>Initializes performance monitoring for the application</P></TD></TR><TR><TD VALIGN="TOP"><P>Collect</P></TD><TD VALIGN="TOP"><P>Reports performance data when requested</P></TD></TR><TR><TD VALIGN="TOP"><P>Close</P></TD><TD VALIGN="TOP"><P>Closes performance monitoring</P></TD></TR></TBODY></TABLE>
<P>|<P><BR></P><P>When it is necessary to recompile the DLL during development, stop DLL performance monitoring between DLL changes. This is necessary because ADVAPI32.DLL and WINLOGON.EXE keep the old version open as long as you are monitoring.</P></FONT></BODY></HTML>
