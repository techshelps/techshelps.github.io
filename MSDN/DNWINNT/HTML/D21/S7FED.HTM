<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Performance Monitoring Service</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" SIZE="2"><FORM NAME="x"><OBJECT CLASSID="clsid:9c2ac687-ceef-11cf-96d9-00a0c903b016" NAME="iv"></OBJECT></FORM>
<H2>Performance Monitoring Service</H2><P>In Chapter 2 we introduced the facility for establishing Performance Monitor as a service running on any computer. This keeps network traffic for performance monitoring to a minimum, allows unattended automatic alerting and logging, and permits you to control when log or alert data move across the network. A principal feature of this approach is that data from each computer will appear in its own log file and application event log. </P>
<P>The utilities for establishing the Performance Monitor service are included on the floppy disk or CD-ROM provided with this book. Let's take a quick look at how we set up the service on some computer, which we'll call the "target" computer, named \\TARGET. </P>
<P>First you need to determine what counters you want to set alerts on, if any, and what events you want to trigger when those alerts occur. You do this using our good old friend Performance Monitor, and selecting the target computer in the Add to Alert dialog. You may also elect to log certain objects, again pointing the Add to Log dialog at the target computer. Be sure the path that you set up for the log file exists on the target computer. Set your time interval for logging by the service, but don't start logging. You may then save your settings in a workspace settings file, which we'll call TARGET.PMW.</P>
<P>You'll need to copy both DATALOG.EXE<B> </B>and TARGET.PMW<I> </I>to the %SystemRoot%\System32 directory on \\TARGET. You can then use the <B>monitor.exe </B>utility to control the service. The <B>monitor.exe</B> utility is a command line application created just for this purpose. It has the following syntax:</P>
<P><B>monitor</B> [\\<I>computername</I>] [<I>command</I>]</P>
<P>If  \\<I>computername</I> is omitted, the local computer is assumed. If <I>command</I> is omitted, the current setup and status of the service are reported. The following list shows the commands you can use as a <I>command</I> in the <B>monitor</B> command line:</P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="64pt" VALIGN="TOP"><COL WIDTH="287pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P><B>setup</B></P></TD><TD VALIGN="TOP"><P>Sets up the Performance Monitor service registry variables and installs the service in the Service Controller</P></TD></TR><TR><TD VALIGN="TOP"><P><I>filename.pmw</I></P></TD><TD VALIGN="TOP"><P>Establishes the file as the current workspace settings file</P></TD></TR><TR><TD VALIGN="TOP"><P><B>start</B></P></TD><TD VALIGN="TOP"><P>Starts the service</P></TD></TR><TR><TD VALIGN="TOP"><P><B>stop</B></P></TD><TD VALIGN="TOP"><P>Stops the service</P></TD></TR><TR><TD VALIGN="TOP"><P><B>pause</B></P></TD><TD VALIGN="TOP"><P>Sends a pause control to the service, and data collection is suspended</P></TD></TR><TR><TD VALIGN="TOP"><P><B>continue</B></P></TD><TD VALIGN="TOP"><P>Sends a continue control to the service, and data collection is resumed</P></TD></TR></TBODY></TABLE>
<P>|<P><BR></P>
<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="64pt" VALIGN="TOP"><COL WIDTH="287pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P><B>automatic</B></P></TD><TD VALIGN="TOP"><P>Sets the service to start automatically when the computer starts</P></TD></TR><TR><TD VALIGN="TOP"><P><B>manual</B></P></TD><TD VALIGN="TOP"><P>Sets the service to require a manual start using the Control Panel's Services applet or the <B>monitor </B>START command (this is the default)</P></TD></TR><TR><TD VALIGN="TOP"><P><B>disable</B></P></TD><TD VALIGN="TOP"><P>Disables the service: commands like <B>start</B> will be ignored; reset this mode by using <B>automatic</B> or <B>manual</B>  </P></TD></TR></TBODY></TABLE>
<P>|<P><BR></P><P>If you want to watch for alerts or log data to a log file automatically, you can establish the Performance Monitor as an unattended service on the computers you want to monitor. The Performance Monitor service can be set up to start automatically when the computer starts. </P>
<P>The Performance Monitor service, called DATALOG.EXE, always runs locally on the computer on which it is started. Alerts are watched locally on that computer, so no data needs to travel across the network. You can also set up logging on any computer running the service. The log file is usually located on the same computer. The data can remain there until you wish to scan the data using the Performance Monitor, or pull it to another computer when the network is not busy.</P>
<P>You can enhance your control of the service with the use of the <B>at</B> command. (For the <B>at</B> command to operate, you must first start the Schedule service using the Control Panel's Services applet.)  For example suppose you only want to log data during the morning hours of peak usage. You might issue the following commands:</P>
<P>at    \\TARGET   9:30     /date:M,T,W,Th,F    "monitor START"</P>
<P>at    \\TARGET   11:00   /date:M,T,W,Th,F    "monitor STOP"</P>
<P>Of course you can scale this up to handle many computers instead of just one. The thought of all those computers automatically  filling their disks with data just makes us giggle. Until the boss gives <I>us</I> the bill for a new disk drive for each one. So let's take a look at managing all this performance data. It won't really matter whether it's gathered by the Performance Monitoring Service or the actual Performance Monitor: the log file is the same, and manage it we must.</P></FONT></BODY></HTML>
