<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>SetICMMode</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_seticmmode"></a>SetICMMode</h1>
<p>
<span style=color:#FF0000>[This is preliminary documentation and subject to change.]</span> </p>
<p>
The <b>SetICMMode</b> function causes Image Color Management to be enabled, disabled, or queried on a given device context (DC).</p>
<pre><code><b>int WINAPI SetICMMode(
  HDC</b><i> hDC</i><b>,</b>
<b>  int</b><i> iEnableICM</i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>hDC</i></dt>
<dd>
Identifies handle to the device context.</dd>
<dt>
<i>iEnableICM</i></dt>
<dd>
Turns on and off image color management. This parameter can take one of the following constant values.

<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=39%>Constant</th>
<th align=left width=61%>Meaning</th>
</tr>
<tr valign=top>
<td colspan=2 width=100%></td>
</tr>
<tr valign=top>
<td width=39%>ICM_ON</td>
<td width=61%>Turns on color management. Turns off old-style color correction of halftones.</td>
</tr>
<tr valign=top>
<td width=39%>ICM_OFF</td>
<td width=61%>Turns off color management. Turns on old-style color correction of halftones.</td>
</tr>
<tr valign=top>
<td width=39%>ICM_QUERY</td>
<td width=61%>Queries the current state of color management.</td>
</tr>
<tr valign=top>
<td width=39%>ICM_DONE_OUTSIDEDC</td>
<td width=61%>Turns off color management inside DC. Under Windows NT 5.0 or later, also turns off old-style color correction of halftones. Not supported under Windows 95.</td>
</tr>
</table><br>

</dd>
</dl>
<h4>Return Values</h4>
<p>
If this function succeeds, the return value is a nonzero value.</p>
<p>
If this function fails, the return value is zero.</p>
<p>
If ICM_QUERY is specified and the function succeeds, the nonzero value returned is ICM_ON or ICM_OFF to indicate the current mode.</p>
<h4>Remarks</h4>
<p>
If the system cannot find an ICC color profile to match the state of the device, <b>SetICMMode</b> fails and returns zero.</p>
<p>
Once ICM is enabled for a device context (DC), colors passed into the DC using most Win32 API functions are color matched. The primary exceptions are <b>BitBlt</b> and <b>StretchBlt</b>. The assumption is that when performing a bit block transfer (blit) from one DC to another, the two DCs are already compatible and need no color correction. If this is not the case, color correction may be performed. Specifically, if a device independent bitmap (DIB) is used as the source for a blit, and the blit is performed into a DC that has ICM enabled, color matching will be performed. If this is not what you want, turn ICM off for the destination DC by calling <b>SetICMMode</b> before calling <b>BitBlt</b> or <b>StretchBlt</b>.</p>
<p>
If the <b>CreateCompatibleDC</b> function is used to create a bitmap in a DC, it is possible for the bitmap to be color matched twice, once when it is created and once when a blit is performed. The reason is that a bitmap in a DC created by the <b>CreateCompatibleDC</b> function acquires the current brush, pens, and palette of the source DC. However, ICM will be disabled by default for the new DC. If ICM is later enabled for the new DC by using the <b>SetICMMode</b> function, a color correction will be done. To prevent double color corrections through the use of the <b>CreateCompatibleDC</b> function, use the <b>SetICMMode</b> function to turn ICM off for the source DC before the <b>CreateCompatibleDC</b> function is called.</p>
<p>
When a compatible DC is created from a printer's DC (see <b>CreateCompatibleDC</b>), the default is for color matching to always be performed if it is enabled for the printer's DC. The default color profile for the printer is used when a blit is performed into the printer's DC using <b>SetDIBitsToDevice</b> or <b>StretchDIBits</b>. If this is not what you want, turn ICM off for the printer's DC by calling <b>SetICMMode</b> before calling <b>SetDIBitsToDevice</b> or <b>StretchDIBits</b>.</p>
<p>
Also, when printing to a printer's DC with ICM turned on, the <b>SetICMMode </b>function needs to be called after every call to the <b>StartPage</b> function to turn back on ICM. The <b>StartPage</b> function calls the <b>RestoreDC</b> and <b>SaveDC</b> functions, which result in ICM being turned off for the printer's DC.</p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 4.0 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Requires Windows 95 or later.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in wingdi.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use gdi32.lib.</p>
<h4>See Also</h4>
<p>
<a href="icm_156c.htm">Color Management Overview</a>, <a href="icm_4f77.htm">ICM 2.0 Functions</a>, <object id=alink_1 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="DefaultTopic" value="../../notopic_0pk4.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_win32_bitblt">
</object><a href=JavaScript:alink_1.Click()><b>BitBlt</b></a>, <object id=alink_2 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="DefaultTopic" value="../../notopic_0pk4.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_win32_stretchblt">
</object><a href=JavaScript:alink_2.Click()><b>StretchBlt</b></a>, <object id=alink_3 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="DefaultTopic" value="../../notopic_0pk4.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_win32_createcompatibledc">
</object><a href=JavaScript:alink_3.Click()><b>CreateCompatibleDC</b></a>, <object id=alink_4 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="DefaultTopic" value="../../notopic_0pk4.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_win32_setdibitstodevice">
</object><a href=JavaScript:alink_4.Click()><b>SetDIBitsToDevice</b></a>, <object id=alink_5 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="DefaultTopic" value="../../notopic_0pk4.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_win32_stretchdibits">
</object><a href=JavaScript:alink_5.Click()><b>StretchDIBits</b></a>, <object id=alink_6 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="DefaultTopic" value="../../notopic_0pk4.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_win32_startpage">
</object><a href=JavaScript:alink_6.Click()><b>StartPage</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
