<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>MOVPLAY1.C</title>
<link disabled rel=stylesheet href=../../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>
<h2><a name="_code_context3800"></a>MOVPLAY1.C</h2>
<pre><code>/************************************************************************** <br> * <br> *  THIS CODE AND INFORMATION IS PROVIDED "AS IS" WITHOUT WARRANTY OF ANY <br> *  KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE <br> *  IMPLIED WARRANTIES OF MERCHANTABILITY AND/OR FITNESS FOR A PARTICULAR <br> *  PURPOSE. <br> * <br> *  Copyright 1992 - 1998 Microsoft Corporation.  All Rights Reserved. <br> * <br> **************************************************************************/ <br>/*-------------------------------------------------------------------- <br>| <br>| MovPlay1.c - Sample Win app to play AVI movies using mciSendCommand <br>| <br>| Movie Functions supported: <br>|Play/Pause <br>|Home/End <br>|Step/ReverseStep <br>| <br>+--------------------------------------------------------------------*/ <br> <br>#define  STRICT <br>#include &lt;windows.h&gt; <br>#include &lt;windowsx.h&gt; <br>#include &lt;commdlg.h&gt; <br>#include &lt;string.h&gt; <br>#include &lt;stdlib.h&gt; <br>#include &lt;direct.h&gt; <br>#include &lt;mmsystem.h&gt; <br>#include &lt;digitalv.h&gt; <br>#include "movplay.h" <br> <br>//---------------------------------------------------------------------------- <br> <br>#define BUFSIZE 260 <br>#define MOVPLAY_CLASS "movplay" <br>#define AVI_VIDEO "avivideo" <br> <br>//---------------------------------------------------------------------------- <br>//function declarations <br> <br>LRESULT CALLBACK WndProc(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam); <br>BOOL CALLBACK    AboutDlgProc(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam); <br> <br> <br>static BOOL initAVI(void); <br>static void termAVI(void); <br>static HWND initApp(HINSTANCE, HINSTANCE, int); <br>static void menubarUpdate(HWND); <br>static void titlebarUpdate(HWND hWnd, LPSTR lpstrMovie); <br>static void positionMovie(HWND); <br>static void fileCloseMovie(HWND); <br>static void fileOpenMovie(HWND); <br>static void playMovie(HWND, int); <br>static void seekMovie(HWND, int); <br>static void stepMovie(HWND, int); <br>static BOOL FormatFilterString(UINT, LPSTR); <br>static void MovPlay_OnInitMenuPopup(HWND, HMENU, int, BOOL); <br>static void MovPlay_OnCommand(HWND, int, HWND, UINT); <br>static void MovPlay_OnSize(HWND, UINT, int, int); <br>static void MovPlay_OnDestroy(HWND); <br> <br>//---------------------------------------------------------------------------- <br>//AVI stuff to keep around <br> <br>HINSTANCE   ghInst; <br>MCIDEVICEID gwMCIDeviceID = 0;/* MCI Device ID for the AVI file */ <br>HWND        ghwndMovie;/* window handle of the movie */ <br>BOOL        gfPlaying = FALSE;/* Play flag: TRUE == playing, FALSE == paused */ <br>BOOL        gfMovieOpen = FALSE;/* Open flag: TRUE == movie open, FALSE = none */ <br>HANDLE      ghAccel = NULL;/* accelerator table */ <br>HMENU       ghMenuBar = NULL;/* menu bar handle */ <br>char        gszBuffer[BUFSIZE]; <br> <br>//---------------------------------------------------------------------------- <br> <br>/*--------------------------------------------------------------+ <br>| initAVI - initialize avi libraries| <br>|| <br>+--------------------------------------------------------------*/ <br>static BOOL initAVI( <br>void) <br>{ <br>MCI_DGV_OPEN_PARMSmciOpen; <br> <br>/* set up the open parameters */ <br>mciOpen.dwCallback = 0L; <br>mciOpen.wDeviceID = 0; <br>mciOpen.lpstrDeviceType = AVI_VIDEO; <br>mciOpen.lpstrElementName = NULL; <br>mciOpen.lpstrAlias = NULL; <br>mciOpen.dwStyle = 0; <br>mciOpen.hWndParent = NULL; <br> <br>/* try to open the driver */ <br>return (mciSendCommand(0, MCI_OPEN, (DWORD)(MCI_OPEN_TYPE), <br>                          (DWORD)(LPMCI_DGV_OPEN_PARMS)&amp;mciOpen) == 0); <br>} <br> <br>/*--------------------------------------------------------------+ <br>| termAVI - Closes the opened AVI file and the opened device    | <br>|           type.                                               | <br>|                                                               | <br>+--------------------------------------------------------------*/ <br>void termAVI(void) <br>{ <br>MCIDEVICEID        mciID; <br>MCI_GENERIC_PARMS  mciClose; <br>// <br>// Get the device ID for the opened device type and then close <br>// the device type. <br>mciID = mciGetDeviceID(AVI_VIDEO); <br>mciSendCommand(mciID, MCI_CLOSE, 0L, <br>                   (DWORD)(LPMCI_GENERIC_PARMS)&amp;mciClose); <br>} <br> <br> <br>/*--------------------------------------------------------------+ <br>| initApp - initialize the app overall.| <br>|| <br>| Returns the Window handle for the app on success, NULL if| <br>| there is a failure.| <br>|| <br>+--------------------------------------------------------------*/ <br>HWND initApp( <br>HINSTANCE hInstance, <br>HINSTANCE hPrevInstance, <br>int nCmdShow) <br>{ <br>HWNDhWnd;/* window handle to return */ <br>        char szAppName[BUFSIZE]; <br> <br>        ghInst = hInstance; <br> <br>if (!hPrevInstance){ <br>WNDCLASS    wndclass; <br> <br>wndclass.style= CS_DBLCLKS | CS_HREDRAW | CS_VREDRAW; <br>wndclass.lpfnWndProc= WndProc; <br>wndclass.cbClsExtra= 0; <br>wndclass.cbWndExtra= 0; <br>wndclass.hInstance= hInstance; <br>wndclass.hIcon= LoadIcon (hInstance, "AppIcon"); <br>wndclass.hCursor= LoadCursor (NULL, IDC_ARROW); <br>wndclass.hbrBackground= (HBRUSH) (COLOR_WINDOW + 1); <br>wndclass.lpszMenuName= MOVPLAY_CLASS; <br>wndclass.lpszClassName= MOVPLAY_CLASS; <br> <br>if (!RegisterClass(&amp;wndclass)){ <br>        LoadString( ghInst, IDS_APPERR, szAppName, BUFSIZE ); <br>LoadString( ghInst, IDS_REGCLSFAILED, gszBuffer, BUFSIZE ); <br>MessageBox(NULL, gszBuffer, szAppName, MB_OK); <br>return NULL; <br>} <br>} <br> <br>        LoadString( ghInst, IDS_APPNAME, szAppName, BUFSIZE ); <br> <br>/* create the main window for the app */ <br>hWnd = CreateWindow(MOVPLAY_CLASS, szAppName, WS_OVERLAPPEDWINDOW | <br>WS_CLIPCHILDREN, CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT, <br>CW_USEDEFAULT, NULL, NULL, hInstance, NULL); <br> <br>if (hWnd == NULL){ <br>        LoadString( ghInst, IDS_APPERR, szAppName, BUFSIZE ); <br>LoadString( ghInst, IDS_CRTWNDFAILED, gszBuffer, BUFSIZE ); <br>MessageBox(NULL, gszBuffer, szAppName, MB_OK); <br>return NULL; <br>} <br> <br>ghMenuBar = GetMenu(hWnd);/* get the menu bar handle */ <br>menubarUpdate(hWnd);/* update menu bar to disable Movie menu */ <br> <br>/* Show the main window */ <br>ShowWindow(hWnd, nCmdShow); <br>UpdateWindow(hWnd); <br> <br>/* load the accelerator table */ <br>ghAccel = LoadAccelerators(hInstance, MOVPLAY_CLASS); <br> <br>return hWnd; <br>} <br> <br> <br>/*--------------------------------------------------------------+ <br>| WinMain - main routine.| <br>|| <br>+--------------------------------------------------------------*/ <br>int PASCAL WinMain( <br>HINSTANCE hInstance, <br>HINSTANCE hPrevInstance, <br>LPSTR lpszCmdParam, <br>int nCmdShow) <br>{ <br>HWND        hWnd; <br>MSG         msg; <br> <br>if (!initAVI()) <br>return 0; <br> <br>if ((hWnd = initApp(hInstance, hPrevInstance, nCmdShow)) == NULL) <br>return 0;/* died initializing, bail out */ <br> <br>/* main message loop, be sure to handle accelerators */ <br>while (GetMessage(&amp;msg, NULL, 0, 0)){ <br>if (!TranslateAccelerator(hWnd, ghAccel, &amp;msg)) { <br>TranslateMessage(&amp;msg); <br>DispatchMessage(&amp;msg); <br>} <br>} <br>return msg.wParam; <br>} <br> <br>/*--------------------------------------------------------------+ <br>| MovPlay_OnInitMenuPopup - Message handler for WM_INITMENUPOPUP| <br>|| <br>+--------------------------------------------------------------*/ <br>static void MovPlay_OnInitMenuPopup( <br>HWND hwnd, <br>HMENU hMenu, <br>int item, <br>BOOL fSystemMenu) <br>{ <br>UINT uEnable; <br>/* be sure this isn't the system menu */ <br>if (fSystemMenu) <br>return; <br> <br>switch (item){ <br>case 0: /* file menu */ <br>/* turn on/off CLOSE &amp; PLAY */ <br>if(gfMovieOpen) <br>uEnable = MF_ENABLED|MF_BYCOMMAND; <br>else <br>uEnable = MF_GRAYED|MF_BYCOMMAND; <br>EnableMenuItem(hMenu, IDM_CLOSE, uEnable); <br>break; <br> <br>case 1:/* Movie menu */ <br>/* check or uncheck the PLAY menu item */ <br>if (gfPlaying) <br>uEnable = MF_CHECKED|MF_BYCOMMAND; <br>else <br>uEnable = MF_UNCHECKED|MF_BYCOMMAND; <br>CheckMenuItem(hMenu, IDM_PLAY, uEnable); <br>break; <br>} /* switch */ <br>return; <br>} <br>/*--------------------------------------------------------------+ <br>| MovPlay_OnCommand - Message handler for WM_COMMAND| <br>|| <br>+--------------------------------------------------------------*/ <br>static void MovPlay_OnCommand( <br>HWND hWnd, <br>int id, <br>HWND hwndCtl, <br>UINT codeNotify) <br>{ <br>/* handle the menu commands */ <br>switch (id) { <br>                case IDM_ABOUT: <br>                        DialogBox(ghInst, MAKEINTRESOURCE(IDD_ABOUT), hWnd, AboutDlgProc); <br>                        break; <br>/* File Menu */ <br>case IDM_OPEN: <br>fileOpenMovie(hWnd); <br>break; <br>case IDM_CLOSE: <br>fileCloseMovie(hWnd); <br>break; <br>case IDM_EXIT: <br>PostMessage(hWnd, WM_CLOSE, 0, 0L); <br>break; <br>/* Movie Menu - note some of these are by */ <br>/* keyboard only, especially the REVERSE  */ <br>/* commands.  */ <br>case IDM_PLAY: <br>case IDM_RPLAY: <br>playMovie(hWnd, id); <br>break; <br>case IDM_HOME: <br>case IDM_END: <br>seekMovie(hWnd, id); <br>break; <br>case IDM_STEP: <br>case IDM_RSTEP: <br>stepMovie(hWnd,id); <br>break; <br>} <br>return; <br>} <br>/*--------------------------------------------------------------+ <br>| MovPlay_OnSize - Message handler for WM_SIZE| <br>|| <br>+--------------------------------------------------------------*/ <br>static void MovPlay_OnSize( <br>HWND hWnd, <br>UINT state, <br>int cx, <br>int cy) <br>{ <br>positionMovie(hWnd);/* re-center the movie */ <br>return; <br>} <br>/*--------------------------------------------------------------+ <br>| MovPlay_OnDestroy - Message handler for WM_DESTROY| <br>|| <br>+--------------------------------------------------------------*/ <br>static void MovPlay_OnDestroy( <br>HWND hWnd) <br>{ <br>if (gfMovieOpen) <br>fileCloseMovie(hWnd); <br>termAVI(); <br>PostQuitMessage(0); <br>return; <br>} <br>/*--------------------------------------------------------------+ <br>| WndProc - window proc for the app| <br>|| <br>+--------------------------------------------------------------*/ <br>LRESULT CALLBACK WndProc( <br>HWND hWnd, <br>UINT message, <br>WPARAM wParam, <br>LPARAM lParam) <br>{ <br>switch (message){ <br>case WM_INITMENUPOPUP: <br>return HANDLE_WM_INITMENUPOPUP(hWnd, wParam, lParam, MovPlay_OnInitMenuPopup); <br>break; <br> <br>case WM_COMMAND: <br>return HANDLE_WM_COMMAND(hWnd, wParam, lParam, MovPlay_OnCommand); <br>break; <br> <br>case WM_SIZE: <br>return HANDLE_WM_SIZE(hWnd, wParam, lParam, MovPlay_OnSize); <br>break; <br> <br>case WM_DESTROY: <br>return HANDLE_WM_DESTROY(hWnd, wParam, lParam, MovPlay_OnDestroy); <br>break; <br> <br>        // We need to realize the AVI's palette <br>case WM_QUERYNEWPALETTE: <br>case WM_PALETTECHANGED: <br>case WM_ACTIVATE: <br>    { <br>    MCI_GENERIC_PARMSmciGeneric; <br> <br>    // buggy drivers crash if we pass a null parms address <br>            mciSendCommand(gwMCIDeviceID, MCI_REALIZE, <br>                MCI_ANIM_REALIZE_NORM, (DWORD)(LPVOID)&amp;mciGeneric); <br>    break; <br>    } <br> <br>case MM_MCINOTIFY: <br>/* This is where we check the status of an AVI*/ <br>/* movie that might have been playing.  We do*/ <br>/* the play with MCI_NOTIFY on so we should get*/ <br>/* a MCI_NOTIFY_SUCCESSFUL if the play*/ <br>/* completes on it's own.*/ <br>switch(wParam){ <br>case MCI_NOTIFY_SUCCESSFUL: <br>/* the play finished, let's rewind */ <br>/* and clear our flag.   */ <br>gfPlaying = FALSE; <br>mciSendCommand(gwMCIDeviceID, MCI_SEEK, <br>MCI_SEEK_TO_START, <br>(DWORD)(LPVOID)NULL); <br>return 0; <br>} <br>} /* switch */ <br>return DefWindowProc(hWnd, message, wParam, lParam); <br>} <br> <br>/*--------------------------------------------------------------+ <br>| menubarUpdate - update the menu bar based on the &lt;gfMovieOpen&gt; | <br>|  flag value.  This will turn on/off the| <br>|  Movie menu.| <br>|| <br>+--------------------------------------------------------------*/ <br>static void menubarUpdate( <br>HWND hWnd) <br>{ <br>WORD w; <br> <br>if (gfMovieOpen){ <br>w = MF_ENABLED|MF_BYPOSITION; <br>} else { <br>w = MF_GRAYED|MF_BYPOSITION; <br>} <br>EnableMenuItem(ghMenuBar, 1, w);/* change the Movie menu (#1) */ <br>DrawMenuBar(hWnd);/* re-draw the menu bar */ <br>} <br> <br>/*--------------------------------------------------------------+ <br>| titlebarUpdate - update the title bar to include the name| <br>|   of the movie playing.| <br>|| <br>+--------------------------------------------------------------*/ <br>static void titlebarUpdate( <br>HWND hWnd, <br>LPSTR lpstrMovie) <br>{ <br>char szNewTitle[2*BUFSIZE];// space for the title <br>char szAppName[BUFSIZE]; <br> <br>LoadString( ghInst, IDS_APPNAME, szAppName, BUFSIZE ); <br> <br>if (lpstrMovie != NULL) <br>wsprintf(szNewTitle,"%s - %s", (LPSTR)szAppName,(LPSTR)lpstrMovie); <br>else <br>lstrcpy(szNewTitle, szAppName); <br>SetWindowText(hWnd, szNewTitle); <br>} <br> <br>/*--------------------------------------------------------------+ <br>| positionMovie - sets the movie rectange &lt;rcMovie&gt; to be| <br>|centered within the app's window.| <br>|| <br>+--------------------------------------------------------------*/ <br>static VOID positionMovie( <br>HWND hWnd) <br>{ <br>RECT rcMovie;/* the rect where the movie is positioned      */ <br>/* for QT/W this is the movie rect, for AVI    */ <br>/* this is the location of the playback window */ <br>RECTrcClient, rcMovieBounds; <br>MCI_DGV_RECT_PARMSmciRect; <br> <br>/* if there is no movie yet then just get out of here */ <br>if (!gfMovieOpen) <br>return; <br> <br>GetClientRect(hWnd, &amp;rcClient);/* get the parent windows rect */ <br> <br>/* get the original size of the movie */ <br>mciSendCommand(gwMCIDeviceID, MCI_WHERE, <br>                  (DWORD)(MCI_DGV_WHERE_SOURCE), <br>                  (DWORD)(LPMCI_DGV_RECT_PARMS)&amp;mciRect); <br>CopyRect( &amp;rcMovieBounds, &amp;mciRect.rc );/* get it in the movie bounds rect */ <br> <br>rcMovie.left = (rcClient.right/2) - (rcMovieBounds.right / 2); <br>rcMovie.top = (rcClient.bottom/2) - (rcMovieBounds.bottom / 2); <br>rcMovie.right = rcMovie.left + rcMovieBounds.right; <br>rcMovie.bottom = rcMovie.top + rcMovieBounds.bottom; <br> <br>/* reposition the playback (child) window */ <br>MoveWindow(ghwndMovie, rcMovie.left, rcMovie.top, <br>rcMovieBounds.right, rcMovieBounds.bottom, TRUE); <br>} <br> <br>/*--------------------------------------------------------------+ <br>| fileCloseMovie - close the movie and anything associated| <br>|   with it.| <br>|| <br>| This function clears the &lt;gfPlaying&gt; and &lt;gfMovieOpen&gt; flags| <br>|| <br>+--------------------------------------------------------------*/ <br>static void fileCloseMovie(HWND hWnd) <br>{ <br>MCI_GENERIC_PARMS  mciGeneric; <br> <br>mciSendCommand(gwMCIDeviceID, MCI_CLOSE, 0L, <br>                 (DWORD)(LPMCI_GENERIC_PARMS)&amp;mciGeneric); <br> <br>gfPlaying = FALSE;// can't be playing any longer <br>gfMovieOpen = FALSE;// no more movies open <br> <br>titlebarUpdate(hWnd, NULL);// title bar back to plain <br>menubarUpdate(hWnd);// update menu bar <br> <br>/* cause a total repaint to occur */ <br>InvalidateRect(hWnd, NULL, TRUE); <br>UpdateWindow(hWnd); <br>} <br> <br> <br>/*--------------------------------------------------------------+ <br>| fileOpenMovie - open an AVI movie. Use CommDlg open box to| <br>|        open and then handle the initialization to| <br>|show the movie and position it properly.  Keep| <br>|the movie paused when opened.| <br>|| <br>|Sets &lt;gfMovieOpened&gt; on success.| <br>+--------------------------------------------------------------*/ <br>static void fileOpenMovie( <br>HWND hWnd) <br>{ <br>OPENFILENAME ofn; <br> <br>static char szFile [BUFSIZE]; <br>static char szFileTitle [BUFSIZE]; <br>static char szFilter [BUFSIZE]; <br> <br>FormatFilterString( IDS_FILTERSTRING, szFilter ); <br> <br>/* use the OpenFile dialog to get the filename */ <br>memset(&amp;ofn, 0, sizeof(ofn)); <br>ofn.lStructSize = sizeof(ofn); <br>ofn.hwndOwner = hWnd; <br>ofn.lpstrFilter = szFilter; <br>ofn.lpstrFile = szFile; <br>ofn.nMaxFile = sizeof(szFile); <br>ofn.lpstrFileTitle = szFileTitle; <br>ofn.nMaxFileTitle = sizeof(szFileTitle); <br>ofn.Flags = OFN_PATHMUSTEXIST | OFN_FILEMUSTEXIST; <br> <br>/* use CommDlg to get our filename */ <br>if (GetOpenFileName(&amp;ofn)){ <br>MCI_DGV_OPEN_PARMSmciOpen; <br>MCI_DGV_WINDOW_PARMSmciWindow; <br>MCI_DGV_STATUS_PARMSmciStatus; <br> <br>/* we got a filename, now close any old movie and open */ <br>/* the new one.*/ <br>if (gfMovieOpen) <br>fileCloseMovie(hWnd); <br> <br>/* we have a .AVI movie to open, use MCI */ <br>/* set up the open parameters */ <br>mciOpen.dwCallback = 0L; <br>mciOpen.wDeviceID = 0; <br>mciOpen.lpstrDeviceType = NULL; <br>mciOpen.lpstrElementName = ofn.lpstrFile; <br>mciOpen.lpstrAlias = NULL; <br>mciOpen.dwStyle = WS_CHILD; <br>mciOpen.hWndParent = hWnd; <br> <br>/* try to open the file */ <br>if (mciSendCommand(0, MCI_OPEN, <br>(DWORD)(MCI_OPEN_ELEMENT|MCI_DGV_OPEN_PARENT|MCI_DGV_OPEN_WS), <br>(DWORD)(LPMCI_DGV_OPEN_PARMS)&amp;mciOpen) == 0){ <br> <br>/* we opened the file o.k., now set up to */ <br>/* play it.   */ <br>gwMCIDeviceID = mciOpen.wDeviceID;/* save ID */ <br>gfMovieOpen = TRUE;/* a movie was opened */ <br> <br>/* show the playback window */ <br>mciWindow.dwCallback = 0L; <br>mciWindow.hWnd = NULL; <br>mciWindow.nCmdShow = SW_SHOW; <br>mciWindow.lpstrText = (LPSTR)NULL; <br>mciSendCommand(gwMCIDeviceID, MCI_WINDOW, <br>MCI_DGV_WINDOW_STATE, <br>(DWORD)(LPMCI_DGV_WINDOW_PARMS)&amp;mciWindow); <br> <br>/* get the window handle */ <br>mciStatus.dwItem = MCI_DGV_STATUS_HWND; <br>mciSendCommand(gwMCIDeviceID, <br>MCI_STATUS, MCI_STATUS_ITEM, <br>(DWORD)(LPMCI_STATUS_PARMS)&amp;mciStatus); <br>ghwndMovie = (HWND)mciStatus.dwReturn; <br> <br>/* now get the movie centered */ <br>positionMovie(hWnd); <br>} else { <br>/* generic error for open */ <br>LoadString( ghInst, IDS_NOOPEN, gszBuffer, BUFSIZE ); <br>MessageBox(hWnd, gszBuffer, NULL, MB_ICONEXCLAMATION|MB_OK); <br>gfMovieOpen = FALSE; <br>} <br>} <br>/* update menu and title bars */ <br>if (gfMovieOpen) <br>titlebarUpdate(hWnd, ofn.lpstrFileTitle); <br>else <br>titlebarUpdate(hWnd, NULL); <br> <br>menubarUpdate(hWnd); <br> <br>/* cause an update to occur */ <br>InvalidateRect(hWnd, NULL, FALSE); <br>UpdateWindow(hWnd); <br>} <br> <br>/*--------------------------------------------------------------+ <br>| playMovie - play/pause the movie depending on the state| <br>|of the &lt;gfPlaying&gt; flag.| <br>|| <br>| This function sets the &lt;gfPlaying&gt; flag appropriately when done| <br>|| <br>+--------------------------------------------------------------*/ <br>static void playMovie( <br>HWND hWnd, <br>int nDirection) <br>{ <br>gfPlaying = !gfPlaying;/* swap the play flag */ <br>if(!nDirection) <br>gfPlaying = FALSE;/* wDirection == NULL means PAUSE */ <br> <br>/* play/pause the AVI movie */ <br>if (gfPlaying){ <br>DWORDdwFlags; <br>MCI_DGV_PLAY_PARMSmciPlay; <br> <br>/* init to play all */ <br>mciPlay.dwCallback = MAKELONG(hWnd,0); <br>mciPlay.dwFrom = mciPlay.dwTo = 0; <br>dwFlags = MCI_NOTIFY; <br>if (nDirection == IDM_RPLAY) <br>dwFlags |= MCI_DGV_PLAY_REVERSE; <br> <br>mciSendCommand(gwMCIDeviceID, MCI_PLAY, dwFlags, <br>               (DWORD)(LPMCI_DGV_PLAY_PARMS)&amp;mciPlay); <br>} else { <br>MCI_DGV_PAUSE_PARMSmciPause; <br> <br>/* tell it to pause */ <br>mciSendCommand(gwMCIDeviceID,MCI_PAUSE,0L, <br>                     (DWORD)(LPMCI_DGV_PAUSE_PARMS)&amp;mciPause); <br>} <br>} <br> <br>/*--------------------------------------------------------------+ <br>| seekMovie - seek in the movie depending on the wAction.| <br>|      Possible actions are IDM_HOME (start of movie) or| <br>|      IDM_END (end of movie)| <br>|| <br>|      Always stop the play before seeking.| <br>|| <br>+--------------------------------------------------------------*/ <br>static void seekMovie( <br>HWND hWnd, <br>int nAction) <br>{ <br>/* first stop the movie from playing if it is playing */ <br>if (gfPlaying){ <br>playMovie(hWnd, 0); <br>} <br>if (nAction == IDM_HOME){ <br>/* home the movie */ <br>mciSendCommand(gwMCIDeviceID, MCI_SEEK, MCI_SEEK_TO_START, <br>(DWORD)(LPVOID)NULL); <br> <br>} else if (nAction == IDM_END){ <br>/* go to the end of the movie */ <br>mciSendCommand(gwMCIDeviceID, MCI_SEEK, MCI_SEEK_TO_END, <br>(DWORD)(LPVOID)NULL); <br>} <br>} <br> <br>/*--------------------------------------------------------------+ <br>| stepMovie - step forward or reverse in the movie.  wDirection| <br>|can be IDM_STEP (forward) or IDM_RSTEP (reverse)| <br>|| <br>|Again, stop the play if one is in progress.| <br>|| <br>+--------------------------------------------------------------*/ <br>static void stepMovie( <br>HWND hWnd, <br>int nDirection) <br>{ <br>MCI_DGV_STEP_PARMSmciStep; <br> <br>if (gfPlaying) <br>playMovie(hWnd, 0);  /* turn off the movie */ <br> <br>mciStep.dwFrames = 1L; <br>if (nDirection == IDM_STEP) <br>mciSendCommand(gwMCIDeviceID, MCI_STEP, MCI_DGV_STEP_FRAMES, <br>(DWORD)(LPMCI_DGV_STEP_PARMS)&amp;mciStep); <br>else <br>mciSendCommand(gwMCIDeviceID, MCI_STEP, <br>MCI_DGV_STEP_FRAMES|MCI_DGV_STEP_REVERSE, <br>(DWORD)(LPMCI_DGV_STEP_PARMS)&amp;mciStep); <br>} <br>/*--------------------------------------------------------------+ <br>| FormatFilterString | <br>|| <br>+--------------------------------------------------------------*/ <br>static BOOL FormatFilterString( <br>UINT uID, <br>LPSTR lpszString ) <br>{ <br>int nLength, nCtr = 0; <br>char chWildCard; <br> <br>*lpszString = 0; <br> <br>nLength = LoadString( ghInst, uID, lpszString, BUFSIZE ); <br> <br>chWildCard = lpszString[nLength-1]; <br> <br>while( lpszString[nCtr] ) { <br>if( lpszString[nCtr] == chWildCard ) <br>lpszString[nCtr] = 0; <br>nCtr++; <br>} <br> <br>return TRUE; <br>} <br> <br> <br> <br>/* AboutDlgProc() <br> * <br> * Dialog Procedure for the "about" dialog box. <br> * <br> */ <br> <br>BOOL CALLBACK AboutDlgProc( <br>HWNDhwnd, <br>UINTmsg, <br>WPARAMwParam, <br>LPARAMlParam) <br>{ <br>switch (msg) { <br>case WM_COMMAND: <br>EndDialog(hwnd, TRUE); <br>return TRUE; <br>case WM_INITDIALOG: <br>return TRUE; <br>} <br>return FALSE; <br>} </code></pre>
<p>&nbsp;</p></body>
</HTML>
