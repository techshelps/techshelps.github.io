<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Processing the WM_CONTEXTMENU Message</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_win32_processing_the_wm_contextmenu_message"></a>Processing the WM_CONTEXTMENU Message</h3>
<p>
The <a href="newmenus_68vp.htm">WM_CONTEXTMENU</a> message is generated when an application's window procedure passes the <a href="mousinpt_1cmo.htm">WM_RBUTTONUP</a> or <a href="mousinpt_9lm8.htm">WM_NCRBUTTONUP</a> message to the <a href="winprocs_10o3.htm"><b>DefWindowProc</b></a> function. The application can process this message to display a shortcut menu appropriate to a specific portion of its screen. If the application does not display a shortcut menu, it should pass the message to <b>DefWindowProc</b> for default handling.</p>
<p>
Following is an example of WM_CONTEXTMENU message processing as it might appear in an application's window procedure. The low-order and high-order <b>int</b>s of the <i>lParam</i> parameter specify the screen coordinates of the mouse when the right mouse button is released (note that these coordinates can take negative values on systems with multiple monitors). The application-defined OnContextMenu function returns TRUE if it displays a context menu, or FALSE if it does not.</p>
<pre><code>case WM_CONTEXTMENU: 
    if (!OnContextMenu(hwnd, GET_X_LPARAM(lParam),
              GET_Y_LPARAM(lParam))) 
        return DefWindowProc(hwnd, uMsg, wParam, lParam); 
    break; 
 </code></pre>
<p>
The following application-defined OnContextMenu function displays a shortcut menu if the specified mouse position is within the window's client area. A more sophisticated function might display one of several different menus, depending on which portion of the client area is specified. To actually display the shortcut menu, this example calls an application-defined function called DisplayContextMenu. For a description of this function, see <a href="newmenus_2z91.htm">Displaying a Shortcut Menu</a>.</p>
<pre><code>BOOL WINAPI OnContextMenu(HWND hwnd, int x, int y) 
{ 
    RECT rc;                    // client area of window 
    POINT pt = { x, y };        // location of mouse click 
 
    // Get the bounding rectangle of the client area. 
 
    GetClientRect(hwnd, &amp;rc); 
 
    // Convert the mouse position to client coordinates. 
 
    ScreenToClient(hwnd, &amp;pt); 
 
    // If the position is in the client area, display a  
    // shortcut menu. 
 
    if (PtInRect(&amp;rc, pt)) 
    { 
        ClientToScreen(hwnd, &amp;pt); 
        DisplayContextMenu(hwnd, pt); 
        return TRUE; 
    } 
 
    // Return FALSE if no menu is displayed. 
 
    return FALSE; 
} 
 </code></pre>
<p>&nbsp;</p></body>
</HTML>
