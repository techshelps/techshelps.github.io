<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text-html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>ATL Controls, Visual Basic 5.0, and the IQuickActivate Interface</title>

<meta name=href content="msdn_ie4.css">                
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY BGCOLOR=#FFFFFF TEXT=#000000>
<font face="verdana,arial,helvetica" size="2"><form name=x><object name=iv classid="clsid:9c2ac687-ceef-11cf-96d9-00a0c903b016">
</object></form>
<h1><a name="msdn_iquickactivate"></a>ATL Controls, Visual Basic 5.0, and the IQuickActivate Interface</h1>
<p>
Robert Coleridge<br>
MSDN Content Development Group</p>
<p>
Over the past few months I have received numerous questions in regard to the <b>IQuickActivate</b> interface in an Active Template Library (ATL) control used with Microsoft Visual Basic 5.0. I would like to take a few minutes and explain what the problems are and how to fix them.</p>
<p>
What is the <b>IQuickActivate</b> interface? This is an interface which, if supported by the control, allows for faster load times. It allows controls and containers to avoid performance bottlenecks on loading controls. It combines the load-time or initialization-time handshaking between the control and its container into a single call.</p>
<p>
If an ATL control implements the <b>IQuickActivate</b> interface it must also implement the <b>IPropertyNotifySink</b> interface. This interface, <b>IPropertyNotifySink</b>, is implemented by a sink object to receive notifications about property changes from an object that supports <b>IPropertyNotifySink</b> as an "outgoing" interface.</p>
<h4>Problem</h4>
<p>
The problem manifests itself after you have inserted an ATL ActiveX control into Visual Basic 5.0 and then run the program. You will get the following message:</p>
<p>
Unhandled exception in Vb5.exe: 0xC0000005: Access Violation</p>
<p>
You will get the same message when you try to delete the control.</p>
<h4>Solution 1 (recommended)</h4>
<p>
Install the latest service pack for Visual Studio 97. This can be found at http://www.microsoft.com/vstudio/sp/.</p>
<h4>Solution 2</h4>
<p>
Remove the dependence on the <b>IQuickActivate</b> interface. To remove <b>IQuickActivate</b> support, comment out the lines containing <b>IQuickActivateImpl</b> in the control's class inheritance list and in the COM interface map.</p>
<p>
For example, if you generate a full control called MyCtl with the ATL Object Wizard, then go to MyCtl.h and comment out the line containing <b>IQuickActivateImpl</b> in the CMyCtl class inheritance list: </p>
<pre><code>class ATL_NO_VTABLE CMyCtl :
  ...
  // public IQuickActivateImpl&lt;CMyCtl&gt;
Also, comment out the line containing </code>IQuickActivateImpl <code>in the COM interface map in MyCtl.h: </code>
<code>  BEGIN_COM_MAP(CMyCtl)</code>
<code>  ...</code>

<code>  // COM_INTERFACE_ENTRY_IMPL(IQuickActivate)</code>
</pre>
<h4>Solution 3</h4>
<p>
Add support for <b>IPropertyNotifySink</b>. Derive the control class from <b>IPropertyNotifySinkCP</b> and add <b>IPropertyNotifySink</b> to the connection point map. </p>
<pre><code>// derive your control class from IPropertyNotifySinkCP
   class CPolyCtl : public IPropertyNotifySinkCP&lt;CPolyCtl&gt;
   {
   ...
   }
   // add IPropertyNotifySink to the connection point map
   BEGIN_CONNECTION_POINT_MAP(CPolyCtl)

     CONNECTION_POINT_ENTRY(IID_IPropertyNotifySink)
   END_CONNECTION_POINT_MAP()
</code></pre>
<p>
To summarize: When the <b>IQuickActivate</b> interface in an ATL ActiveX control is used with Visual Basic 5.0, it causes an error that needs to be corrected in one of three ways:
<ol type=1>
<li>
Install the latest Visual Studio service pack,<br><br></li>
<li>
Remove the <b>IQuickActivate</b> interface, or <br><br></li>
<li>
Add the <b>IPropertyNotifySink</b> interface.<br><br></li>
</ol>
</font></BODY>
</HTML>
