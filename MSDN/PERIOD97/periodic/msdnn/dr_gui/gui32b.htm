<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 2.0">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>They Saved Nigel's Brain</title>

<meta name=href content="msdn_ie4.css">                
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD><basefont face="verdana,arial,helvetica" size=2 color="#000000">

<BODY bgcolor="#FFFFFF">
<font face="verdana,arial,helvetica" size="2">

<p><!--webbot bot="HTMLMarkup" startspan --><basefont face="verdana,arial,helvetica" size=2 color="#000000"><!--webbot
bot="HTMLMarkup" endspan --><font size="5">They Saved Nigel's
Brain</font></p>

<h2><font size="2">Dear Dr. GUI: </font></h2>

<p><font size="2">I have been trying to get your sample Control
Panel applications using MFC to run under Windows NT 3.51. The
samples (as shipped with the Developer Network article
&quot;Creating Win32 Control Panel Applets with Visual C++&quot;
and other tech articles) just don't seem to run.</font></p>

<p><font size="2">I successfully set a breakpoint in <b>DllMain</b>
and in the constructor of the App object, and everything <i>seems</i>
to be initialized and constructed properly. The <b>CPlApplet</b>
function never gets called, but interestingly enough <b>DllMain()</b>
gets called for ATTACH and TERMINATE real quick before any real
work gets done. The only clue you get that CONTROL.EXE is even
interested in the .DLL is the trace message in the debugger that
the .DLL was loaded <i>and</i> another icon <i>does</i> show up
in the Control Panel, but it is <i>always</i> the ODBC
configuration icon. If I put two sample CPL applets in the
\system32 directory, I get two bogus ODBC icons there (that
really do function as ODBC Control Panel apps.) </font></p>

<p><font size="2">Where is Nigel Thompson? (Or at least his
brain?)</font></p>

<p><font size="2">Andy Levine</font></p>

<h2><font size="2">Dr. GUI replies: </font></h2>

<p><font size="2">After poring fruitlessly through his
neurosurgery textbook in search of the answer, Dr. GUI found
Knowledge Base article #Q151034. According to the Knowledge Base,
the applet entry-point function, <b>CPlApplet()</b>, exported by
the MFC control applet, is resolved to the function exported from
ODBCCP32.LIB rather than the function exported from the project.</font></p>

<p><font size="2">Every Control Panel application must export the
standard entry-point function, <b>CPlApplet</b>, that is called
by Control Panel in various situations. When you include AFXDB.H
in your project, MFC pulls in the ODBCCP32.LIB file through a <b>#pragma
comment()</b>. This is the import library for the ODBC
installation .DLL that also exports <b>CPlApplet</b>. The linker
resolves the <b>CPlApplet</b> function from the ODBCCP32.LIB
rather than from your object files. Since <b>CPlApplet</b>
resolves to the one in ODBCCP32.LIB, your Control Panel applet
acts as another ODBC Control Panel applet. </font></p>

<p><font size="2">See the article at </font><a
href="http://www.microsoft.com/kb/articles/q151/0/34.htm"><font
size="2">http://www.microsoft.com/kb/articles/q151/0/34.htm</font></a><font
size="2"> for steps to resolve this issue. Also note the new path
for Knowledge Base articles.</font></p>
</font></body>
</html>
