<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text-html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Had enough shell allocations today?</title>
<meta name=MS-HAID content="msdn_gui36b">

<meta name=href content="msdn_ie4.css">                
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY BGCOLOR=#FFFFFF TEXT=#000000>

<font face="verdana,arial,helvetica" size="2"><form name=x><object name=iv classid="clsid:9c2ac687-ceef-11cf-96d9-00a0c903b016">
</object></form>
<h1><a name="msdn_gui36b"></a>Had enough shell allocations today?</h1>
<p>
<b>Dear Dr. GUI,</b></p>
<p>
Thanks for telling us how to browse for a folder. Browsing for a folder seems to me even more common in applications than some of the commdlg(32).dll dialog boxes. But for some reason it was never included in those dynamic-link libraries (DLLs). I am not asking why; we both probably know the answer. Anyway, I am glad that you've pointed out the <b>SHBrowseForFolder()</b> function.</p>
<dl>
<dt>
It looks as simple as your article claims (though it requires another function <b>SHGetPathFromIDList()</b>), but there is one problem I have a hard time finding a solution for. The help topic on <b>SHBrowseForFolder()</b> claims:</dt>
<dd>
The calling application is responsible for freeing the returned item identifier list using the shell's task allocator.</dd>
</dl>
<p>
I want to write clean code, so who can explain how to free that identifier?</p>
<p>
Thanks,<BR><i>Vadim Grabovski</i></p>
<p>
<b>Dr. GUI replies:</b></p>
<p>
The good doctor is glad you've found the previous information useful. And he's delighted that you're paying close attention to the documentation. Medicine always goes better when you follow the prescription.</p>
<p>
Call the <b>SHGetMalloc()</b> function to get the <b>IMalloc</b> interface pointer to the shell's task allocator. Once you have that pointer call <b>IMalloc::Free()</b> passing the  LPITEMIDLIST pointer returned from <b>SHBrowseForFolder()</b>. </p>
<p>
The concept of a task allocator actually comes from COM/OLE and hence it helps if you are familiar with COM/OLE. The best Component Object Model (COM) book Dr. GUI has seen is <i>Inside COM</i> by Dale Rogerson (Microsoft Press 1996; <a href="http://mspress.microsoft.com/">http://mspress.microsoft.com/</a>). Dr. GUI recommends this book for every programmer who's using COM, regardless of what language you use.</p>
</font></BODY>
</HTML>
