<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Setting Up MTS to Access Oracle</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR=#FFFFFF TEXT=#000000>

<h1><a name="assettingupmtstoaccessoracle"></a>Setting Up MTS to Access Oracle</h1>
<p>
You can enable transactional MTS components to access an Oracle 7.3.3 database through ODBC. MTS works with Oracle 7 Workgroup Server for Windows NT, Oracle 7 Enterprise Server for Windows NT, Oracle 7 Enterprise Servers on UNIX, and Oracle Parallel Server on UNIX.</p>
<p>
Your MTS component may access an Oracle 8 database on either Windows NT or Unix provided your Microsoft Transaction Server component uses the Oracle 7 client software. MTS does not support Oracle 8 client software.</p>
<p>
This section includes the following topics:</p>
<p>
<a href="#asrequiredsoftware">Required Software</a></p>
<p>
<a href="#assettinguporaclesupport">Setting Up Oracle Support</a></p>
<p>
<a href="#astestingoraclesupportinstallationandconfiguration">Testing Installation and Configuration of MTS Support for Oracle</a></p>
<p>
<a href="#asvalidatingoracleinstallationandconfigurationusingthesamplebankapplication">Validating Oracle Installation and Configuration Using the Sample Bank Application</a></p>
<p>
<a href="#asknownlimitationsofmtssupportfororacle">Known Limitations of MTS Support for Oracle</a></p>

<p>
<a name="asrequiredsoftware"></a>Required Software</p>
<p>
Refer to the following table for a list of the software required to access an Oracle database from MTS components running on either the Windows NT or UNIX platform.</p>
<table cellspacing=5 cols=2>
<tr valign=top>
<th align=left width=45%>Component</th>
<th align=left width=55%>Version</th>
</tr>
<tr valign=top>
<td colspan=2 width=100%></td>
</tr>
<tr valign=top>
<td width=45%><a href="#asoracleforwindowsnt">Oracle for Windows NT</a></td>
<td width=55%><ol>
<li>
(with patch 2 or later)</li>
</ol>
</td>
</tr>
<tr valign=top>
<td width=45%><a href="#asoraclesqlnet">Oracle SQL*Net</a></td>
<td width=55%>2.3.3 </td>
</tr>
<tr valign=top>
<td width=45%><a href="#asoracleociw32dll">Oracle OCIW32.DLL </a></td>
<td width=55%>1, 0, 0, 5</td>
</tr>
<tr valign=top>
<td width=45%><a href="#asoracleforunix">Oracle for UNIX</a></td>
<td width=55%><ol>
<li>
(with patches)</li>
</ol>
</td>
</tr>
<tr valign=top>
<td width=45%><a href="#asmicrosofttransactionserver20">Microsoft Transaction Server 2.0</a></td>
<td width=55%>2.0</td>
</tr>
<tr valign=top>
<td width=45%><a href="#asmicrosoftodbcdriverfororacle">Microsoft ODBC Driver for Oracle (MSORCL32.DLL)</a></td>
<td width=55%>2.0 </td>
</tr>
<tr valign=top>
<td width=45%><a href="#asactivexdataobjects">ActiveX Data Objects (ADO)</a></td>
<td width=55%>1.5</td>
</tr>
</table><br>
<p>
<b>Important</b>   Earlier versions of the software will not work properly. Please ensure you install the correct versions of the software. Failing to do this is by far the most common source of problems when trying to use MTS with Oracle.</p>

<h5><a name="asoracleforwindowsnt"></a>Oracle for Windows NT</h5>
<p>
You must install either the Oracle 7.3.3 Workgroup Server release for Windows NT or the Oracle 7.3.3 Enterprise Server release for Windows NT. The Oracle 7.3.2 and earlier releases of Oracle for Windows NT are not supported and will not work in conjunction with MTS transactions.</p>
<p>
You must install Oracle 7.3.3 patch release 2 or later. This patch is required for all Oracle 7.3.3 clients accessing an Oracle 7.3.3 or Oracle 8 database. Oracle patch release 2 contains fixes that are required to make Oracle XA transaction support work properly on Windows NT. The Oracle 7.3.3 release will not work with MTS unless Oracle 7.3.3 patch release 2 or later is installed.</p>
<p>
<b>Note</b>   If you encounter problems setting up Oracle patch release 2 on Windows 95, contact Oracle for support.</p>
<p>
To obtain Oracle 7.3.3 patch releases from the Oracle customer support organization you must submit a problem report to the Oracle Customer Support Organization. These patch releases were not available from the Oracle public web site at the time this note was written.</p>

<h5><a name="asoraclesqlnet"></a>Oracle SQL*Net</h5>
<p>
You must install the Oracle SQL*Net 2.3.3 release for Windows NT. You can obtain this release from Oracle. Earlier versions of Oracle SQL*Net may not work.</p>

<h5><a name="asoracleociw32dll"></a>Oracle OCIW32.DLL</h5>
<p>
You must ensure that the correct version of the Oracle OCIW32.DLL is installed. Be very careful to check the version installed on your computer.</p>
<p>
The correct version of the Oracle OCIW32.DLL is:</p>
<pre><code>Version 1, 0, 0, 5
Tuesday, March 18, 1997 2:47:52 PM
Size 18KB. </code></pre>
<p>
The improper version of the Oracle OCIW32.DLL is:</p>
<pre><code>Version 7.x
Thursday, February 01, 1996 12:50:06 AM
Size 36 KB</code></pre>
<p>
You can obtain the correct version of this DLL from the Oracle 7.3.3 installation CD from the \WIN32\V7\RSF73 directory.</p>

<h5><a name="asoracleforunix"></a>Oracle for UNIX</h5>
<p>
In order for transactional MTS components to access an Oracle database on UNIX, you must install the Oracle 7.3.3 release (or later) for that UNIX platform. In most cases, you will also be required to install an Oracle 7.3.3 patch release for Oracle on UNIX. </p>
<p>
You must check with Oracle Customer Support to determine if an Oracle 7.3.3 patch release is required for your UNIX platform. Explain that you are going to access your Oracle database on UNIX using the new XA transaction support that is now included in the Oracle 7.3.3 release on Windows NT.</p>
<p>
The following patch releases are known to work:</p>
<table cellspacing=5 cols=2>
<tr valign=top>
<th align=left width=22%>Platform</th>
<th align=left width=78%>Oracle Patch</th>
</tr>
<tr valign=top>
<td colspan=2 width=100%></td>
</tr>
<tr valign=top>
<td width=22%>HP 9000</td>
<td width=78%>7.3.3.3</td>
</tr>
<tr valign=top>
<td width=22%>IBM AIX</td>
<td width=78%>7.3.3.2</td>
</tr>
<tr valign=top>
<td width=22%>Sun Solaris</td>
<td width=78%>7.3.3.2</td>
</tr>
</table><br>

<h5><a name="asmicrosofttransactionserver20"></a>Microsoft Transaction Server 2.0</h5>
<p>
You must install Microsoft Transaction Server 2.0 if you wish to access an Oracle database using MTS. </p>

<h5><a name="asmicrosoftodbcdriverfororacle"></a>Microsoft ODBC Driver<i> </i>for Oracle</h5>
<p>
The Microsoft ODBC 2.0 Driver for Oracle (MSORCL32.DLL) is required. The Windows NT 4.0 Option Pack program automatically installs this DLL.</p>
<p>
If you wish to access an Oracle database, we strongly suggest that you use the new Microsoft ODBC Driver for Oracle 2.0 even if you do not require transaction support. This new driver offers better performance than the ODBC 1.0 driver it replaces. The ODBC 1.0 driver serialized all activity at the driver level; requests were single-threaded through the driver. The ODBC 2.0 driver serializes all activities at the connection level. This allows different database connections to be used in parallel.</p>

<h5><a name="asactivexdataobjects"></a>ActiveX Data Objects (ADO)</h5>
<p>
If your applications use ADO, you must install the ADO version 1.5. Earlier ADO releases will not work with the new ODBC 3.5 Driver Manager. ADO 1.5 is included in the Windows NT 4.0 Option Pack setup program.</p>

<p>
<a name="assettinguporaclesupport"></a>Setting Up Oracle Support</p>
<p>
<b><img src="images/prcarrow.gif" border=0> To set up Oracle support for MTS transactional components</b>
<ol>
<li>
Install the Oracle 7.3.3 release on Windows NT.</li>
</ol>
<p>
If your Oracle database is located on a UNIX system, install the Oracle 7.3.3 release on that system.
<ol>
<li>
Install the Oracle 7.3.3 patch 2 or later on Windows NT. The resulting Oracle version will be Oracle 7.3.3.2 or later depending upon which Oracle patch you install. You must install Oracle 7.3.3 patch 2 or later if you wish to access any Oracle 7 or Oracle 8 database on either Windows NT or Unix. These Oracle patches correct problems that affect Oracle clients.</li>
</ol>
<p>
If you are using UNIX, install any Oracle 7.3.3 patch releases that are required for your UNIX system. I
<ol>
<li>
Ensure that the correct version of the Oracle OCIW32.DLL is installed as described in the <a href="#asrequiredsoftware">Required Software</a> section.</li>
<li>
Install the Microsoft Transaction Server 2.0 version 3.0, which automatically installs the following:<ul>
<li>
Microsoft Transaction Server 2.0, including the Microsoft OCI Interface</li>
<li>
Microsoft ODBC 3.5</li>
<li>
Microsoft ODBC 2.0 driver for Oracle</li>
<li>
ADO 1.5</li>
</ul>
</li>
<li>
Delete the DTCXATM.LOG. Use the Explorer to locate and delete this file if found. Note that the Microsoft Distributed Transaction Coordinator service must be stopped before the DTCXATM.LOG file can be deleted.</li>
<li>
Enable Oracle XA Support</li>
</ol>
<p>
<b><img src="images/prcarrow.gif" border=0> To enable an Oracle database to work with MTS transactions</b>
<ol>
<li>
The system administrator must create views known as V$XATRANS$. To do this, the administrator must run an Oracle-supplied script, named "xaview.sql". This file can usually be found in C:\ORANT\RDBMS73\ADMIN.</li>
<li>
The system administrator must grant SELECT access to the public on these views.<pre><code>Grant Select on V$XATRANS$ to public.</code></pre>
</li>
<li>
In the Oracle Instance Manager, click <b>Advanced Mode</b> on the <b>View</b> menu and select <b>Initialization Parameters</b> in the left pane.</li>
<li>
In the right pane, select <b>Advanced Tuning</b> and increase the "distributed_transactions" parameter to allow for more concurrent MTS transactions to update the database at a single time.</li>
</ol>
<p>
See your Oracle Server documentation for more information about configuring Oracle support for XA transactions.</p>

<p>
<a name="astestingoraclesupportinstallationandconfiguration"></a>Testing Installation and Configuration of MTS Support for Oracle</p>
<p>
After installing and configuring Oracle support, you should validate your Oracle installation using the Oracle test program installed with MTS. The Oracle test program uses Oracle's OCI XA interfaces in much the same way that MTS uses them.</p>
<p>
The Oracle test program determines whether you can connect to an Oracle database using Oracle's XA facility. The Oracle test program uses standard Oracle interfaces and transaction facilities. It makes no use of Microsoft Transaction Server or Microsoft Distributed Transaction Coordinator. Therefore, failure of the test program indicates that your Oracle is installed or configured improperly. Reinstall and reconfigure Oracle, or contact your Oracle representative.</p>
<p>
<b><img src="images/prcarrow.gif" border=0> To run the Oracle test program</b>
<ol>
<li>
Verify that you have installed all of the correct versions of the software as described in <a href="#asrequiredsoftware">Required Software</a>.</li>
<li>
Create an ODBC DSN that refers to your Oracle database. Ensure that your DSN uses the new Microsoft Oracle ODBC 2.0 driver.</li>
<li>
Ensure that you have enabled Oracle XA support.</li>
<li>
Delete all existing Oracle trace files from the machine containing the MTS components that access the Oracle database. The easiest way to do this is to use the Windows Explorer to locate and delete all *.TRC files.</li>
<li>
Delete the DTCXATM.LOG file, if found, from the computer hosting the MTS components that access the Oracle database. Use the Windows Explorer to locate and delete the DTCXATM.LOG file (if it is located on your computer).</li>
<li>
From the MS-DOS Command Prompt run the Oracle test program (TestOracleXaConfig.exe) and supply your Oracle server user ID, password, and server name. For example:<pre><code>c:&gt;TestOracleXaConfig.exe  -U&lt;user id&gt; -P&lt;Password&gt;
-S&lt;Server name as in the TNS file&gt;.</code></pre>
</li>
</ol>
<p>
If you run the test program with no parameters, the program will display help information that describes the required parameters. The test program will display information about each Oracle operation performed and will indicate whether each operation was successful.
<ol>
<li>
If the Oracle test program is able to connect to your Oracle database server without error, then it is very likely that MTS will work with Oracle also. If the Oracle test program reports any errors, follow these steps:<ul>
<li>
Document the exact error message that the Oracle test program displays.</li>
<li>
Examine the Oracle trace file produced when running the Oracle test program. The Oracle trace information is located in the *.TRC file. The Oracle trace file contains extended error information that is extremely helpful in diagnosing problems.</li>
<li>
Contact your Oracle support representative for assistance.</li>
</ul>
</li>
</ol>

<p>
<a name="asvalidatingoracleinstallationandconfigurationusingthesamplebankapplication"></a>Validating Oracle Installation and Configuration Using the Sample Bank Application</p>
<p>
After you have validated your Oracle installation and configuration using the Oracle test program, you can use the Sample Bank Application supplied with Microsoft Transaction Server to ensure that Microsoft Transaction Server can access your Oracle database.</p>
<p>
<b><img src="images/prcarrow.gif" border=0> To validate Oracle support using Sample Bank</b>
<ol>
<li>
Ensure that you have verified that your Oracle support is installed and configured correctly using the Oracle test program provided by MTS.</li>
<li>
On the server, create a table named "Account". The following example demonstrates how to set up the Account table. <pre>Owner                        <b>scott</b>            
Name of Table            <b>Account</b>
Column 1 Name        <b>AccountNo</b>    of type  <b>NUMBER</b>
Column 2 Name        <b>Balance</b>        of type  <b>NUMBER</b></pre>
</li>
<li>
Populate the table with at least two rows. The following table illustrates how to populate the table.<pre>AccountNo        Balance
1            1000
2            1000</pre>
</li>
<li>
Create a file DSN using the ODBC configuration utility. Name the file DSN "MTSSamples". Then manually update the DSN file to add the password of the user. The following example demonstrates how to add the user password to a file DSN.<pre>[ODBC]
DRIVER=Microsoft ODBC for Oracle
UID=scott
PWD=<i>mypassword</i>
ConnectString=<i>myserver</i>
SERVER=<i>myserver</i></pre>
</li>
<li>
Save the file DSN and run the Sample Bank client.</li>
</ol>

<p>
<a name="asknownlimitationsofmtssupportfororacle"></a>Known Limitations of MTS Support for Oracle</p>
<h3>ADO 1.5 Beta Release Is Required When Using ADO with ODBC 3.5</h3>
<p>
If your applications use ADO, make certain that you install the ADO 1.5. Refer to the <a href="#asrequiredsoftware">Required Software </a> section for more information.</p>
<h3>No Oracle Support on Digital Alpha Platform</h3>
<p>
Oracle database connectivity is not supported from Digital Alpha platforms running Microsoft Transaction Server.</p>
<h3>Oracle OCIW32.DLL Version Problem</h3>
<p>
It is important that the correct version of the OCIW32.DLL is installed on your computer. You should check the version of the DLL any time you reinstall Oracle or Microsoft Transaction Server.</p>
<h3>DLL Name Changes in Future Releases of Oracle</h3>
<p>
Oracle sometimes changes DLL names when they release new versions of their product. Microsoft Transaction Server relies upon knowing the names of some Oracle DLLs. Currently, MTS looks for the DLL names provided with Oracle version 7.3.3. As MTS cannot predict future names of these DLLs, you may need to modify the values in the following registry key when you upgrade your Oracle installation:</p>
<pre><code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Transaction Server\Local Computer\My Computer</code></pre>
<p>
Under this key there are two string-named values.
<ul>
<li>
OracleXaLib"xa73.dll"</li>
<li>
OracleSqlLib"sqllib18.dll"</li>
</ul>
<h3>Configuring Oracle to Support a Large Number of Connections</h3>
<p>
If you want to create more than a few dozen connections to an Oracle database, you must configure the Oracle server to support additional database connections. </p>
<p>
You may experience one or more of the following errors if you fail to do this:
<ul>
<li>
Failures on <b>SQLConnect</b> calls.</li>
<li>
Failures to enlist on the calling objects transaction, which may result in any of the following errors in the Oracle trace file:<ul>
<li>
Too many sessions</li>
<li>
TNS server failed to locate the server name</li>
<li>
Too many distributed transactions</li>
</ul>
</li>
<li>
Timeouts while waiting for database locks. This is likely to occur if the configured number of locks is insufficient for the number of concurrently active transactions.</li>
<li>
Record collision due to locks held by in-doubt transactions.</li>
</ul>
<p>
If you experience any of these problems, increase the following Oracle server configuration parameters:
<ul>
<li>
Session count (This is typically three times the number of expected connections)</li>
<li>
Distributed transaction count</li>
<li>
Process count</li>
<li>
Lock count</li>
</ul>
<p>&nbsp; </p></body>
</HTML>
