<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Using IsCallerInRole in the MoveMoney and Account Components (Visual Basic)</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR=#FFFFFF TEXT=#000000>

<h1><a name="asconusingiscallerinrole"></a>Using IsCallerInRole in the MoveMoney and Account Components</h1>
<p>
You will add the <b>IsCallerInRole</b> method to the MoveMoney and Account <a href="vipdef01_1yih.htm#asdefvipercomponent">components</a> to verify that the user running the Bank client is a manager. This additional code is the same for both components. You must modify both components because clicking <b>Account</b> in the Bank client doesn't use the MoveMoney component when the Sample Bank application runs.</p>
<h5><img src="images/prcarrow.gif" border=0>To use IsCallerInRole in the MoveMoney and Account components</h5>
<ol>
<li>
Open the \MTx\Samples\Account.VB\Step8\Account.vbp project.</li>
</ol>
<p>
<a href="sampcodevb_6n7c.htm"><img src="images/chiclet.gif" border=0>Click here to see the modified MoveMoney component</a></p>
<p>
<a href="sampcodevb_29h4.htm"><img src="images/chiclet.gif" border=0>Click here to see the modified Account component</a>
<ol>
<li>
Build the component as a <a href="vipdef01_1yih.htm#asdefdll">DLL</a> and save it as \MTx\Samples\Account.VB\Step8\VBAcct.dll.</li>
</ol>
<p>
<b>IsCallerInRole</b> is a method on an object's <a href="vipdef01_1yih.htm#asdefcontext">context</a>. <b>IsCallerInRole</b> returns TRUE if the <a href="vipdef01_1yih.htm#asdefdirectcaller">direct caller</a> of that object is assigned to a given <a href="vipdef01_1yih.htm#asdefrole">role</a>. You will use <b>IsCallerInRole</b> in the MoveMoney and Account components to verify if the <a href="vipdef01_1yih.htm#asdefcaller">caller</a> of an object — in this case the user running the Bank client — is a manager.</p>
<pre><code>If (lngAmount &gt; 500 Or lngAmount &lt; -500) Then
    If Not ctxObject.IsCallerInRole("Managers") Then
        Err.Raise Number:=ERROR_NUMBER, _
        Description:="Need 'Managers' role for " _
            &amp; "amounts over $500"
    End If
End If</code></pre>
<p>
Before you can use the new MoveMoney and Account components, you must create the role. The Manager role must exist before the call to <b>IsCallerInRole</b>; otherwise, you will get an error.</p>
<p>
Note that the source code is bound to a role name scoped to a <a href="vipdef01_1yih.htm#asdefpackage">package</a>. This creates a dependancy between the source and the package definition that must be considered when making modifications to a Package's security configuration, such as deleting a role.</p>
<h5><img src="images/prcarrow.gif" border=0>To define a role for the Sample Bank package</h5>
<ol>
<li>
Start the <a href="vipdef01_1yih.htm#asdefmicrosofttransactionserverexplorer">Microsoft Transaction Server Explorer</a>.</li>
</ol>
<p>
If you are currently running Sample Bank, you must shut down the associated <a href="vipdef01_1yih.htm#asdefasp">server process</a> to change security properties.</p>
<p>
<a href="install_9kvt.htm"><img src="images/chiclet.gif" border=0>How?</a>
<ol>
<li>
Create a role named Manager.</li>
</ol>
<p>
<a href="install_9q05.htm"><img src="images/chiclet.gif" border=0>How?</a>
<ol>
<li>
Assign users to the role. If you have access to more than one Windows NT account, you may want to exclude some user accounts from the Manager role to see the role checking in effect.</li>
</ol>
<p>
<a href="maintain_7aat.htm"><img src="images/chiclet.gif" border=0>How?</a></p>
<p>
Run the Bank client. If you are logged on as a user in the Manager role, you will be able to perform transactions of any amount. However, if you are logged on as a user who isn't in the Manager role, you will get a warning message when attempting a transaction of more than $500. The <a href="vipdef01_1yih.htm#asdeftransaction">transaction</a> will then abort. If you don't have access to more than one account, try removing your user account from the role to see the role checking enforced.</p>
<p>
<a href="maintain_7aat.htm"><img src="images/chiclet.gif" border=0>How?</a></p>
<h5>See Also</h5>
<p>
<a href="mtxpg04_7i49.htm">Programmatic Security</a>, <a href="install_9kvt.htm">Enabling MTS Package Security</a>, <a href="mtxpg11vb_7ag5.htm">Application Design Notes: Using Roles</a>, <a href="objctxvb_2x5u.htm"><b>IsCallerInRole</b> method</a></p>
<p>&nbsp; </p></body>
</HTML>
