<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Automating MTS Deployment</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR=#FFFFFF TEXT=#000000>

<h1><a name="asautomatingmtsdeployment"></a>Automating MTS Deployment</h1>
<p>
This document describes how you can use the <i>scriptable administration objects </i>to automate deployment and distribution of your MTS packages. The MTS Explorer lets you configure and deploy packages by using a graphical user interface rather than by programming code. However, you can use the scriptable administrative objects to automate administration tasks, such as program configuration and deployment. Note that the scriptable administrative objects support the same collection hierarchy as the MTS Explorer. The following figure shows the MTS Explorer collection hierarchy.</p>
<p>
<img src="images/methhier.gif" border=0></p>
<p>
For more information about MTS Explorer functionality, see the <i>Administrator's Guide</i>.</p>
<p>
Using the Scriptable Administration Objects</p>
<p>
Microsoft Transaction Server contains Automation objects that you can use to program administrative and deployment procedures, including:
<ul>
<li>
Installing a Pre-Built Package</li>
<li>
Creating a New Package and Installing Components</li>
<li>
Enumerating Through Installed Packages to Update Properties</li>
<li>
Enumerating Through Installed Packages to Delete a Package</li>
<li>
Enumerating Through Installed Components to Delete a Component</li>
<li>
Accessing Related Collection Names</li>
<li>
Accessing Property Information</li>
<li>
Configuring a Role</li>
<li>
Exporting a Package</li>
<li>
Configuring a Client to Use Remote Components</li>
<li>
Note that you can use the scriptable administration objects to automate any task in the MTS Explorer.</li>
</ul>
<p>
The scriptable administration objects are derived from the <b>IDispatch</b> interface, so you can use any Automation language to develop your package, such as Microsoft® Visual Basic® version 5.0, Microsoft Visual C++® version 5.0, Microsoft Visual Basic® Scripting Edition (VBScript), and Microsoft JScript™.</p>
<p>
Each folder in the MTS Explorer hierarchy corresponds to a collection stored in the <i>catalog data store</i>. The following scriptable objects are used for administration:
<ul>
<li>
Catalog</li>
<li>
CatalogObject</li>
<li>
CatalogCollection</li>
<li>
PackageUtil</li>
<li>
ComponentUtil</li>
<li>
RemoteComponentUtil</li>
</ul>
<p>
The Catalog, CatalogObject, and CatalogCollection scriptable objects provide top-level functionality such as creating and modifying objects. The Catalog object enables you to connect to specific servers and access collections. Call the CatalogCollection object to enumerate, create, delete, and modify objects, as well as to access related collections. CatalogObject allows you to retrieve and set properties on an object. The Package, Component, Remote Component, and Role objects enable more specific task automation, such as installing components and exporting packages. This utility layer allows you to program very specific tasks for collection types, such as associating a role with a user or class of users.</p>
<p>
The following diagram illustrates how the MTS scriptable administration objects interact with the MTS Explorer catalog:</p>
<p>
<img src="images/vipa01.gif" border=0></p>
<table cellspacing=5 cols=2>
<tr valign=top>
<th align=left width=34%>Interface</th>
<th align=left width=66%>Description</th>
</tr>
<tr valign=top>
<td colspan=2 width=100%></td>
</tr>
<tr valign=top>
<td width=34%><b>ICatalog</b></td>
<td width=66%>The Catalog object enables you to connect to specific servers and access collections.</td>
</tr>
<tr valign=top>
<td width=34%><b>ICatalogCollection</b></td>
<td width=66%>The CatalogCollection object can be used to enumerate objects, create, delete, and modify objects, and access related collections.</td>
</tr>
<tr valign=top>
<td width=34%><b>ICatalogObject</b></td>
<td width=66%>The CatalogObject object provides methods to get and set properties on an object.</td>
</tr>
<tr valign=top>
<td width=34%><b>IPackageUtil</b></td>
<td width=66%>The IPackageUtil object enables a package to be installed and exported within the Packages collection.</td>
</tr>
<tr valign=top>
<td width=34%><b>IComponentUtil</b></td>
<td width=66%>The IComponentUtil object provides methods to install a component in a specific collection and to import components registered as an in-process server.</td>
</tr>
<tr valign=top>
<td width=34%><b>IRemoteComponentUtil</b></td>
<td width=66%>You can use the IRemoteComponentUtil object to program your application to pull remote components from a package on a remote server.</td>
</tr>
<tr valign=top>
<td width=34%><b>IRoleAssociationUtil</b></td>
<td width=66%>Call methods on the IRoleAssociationUtil object to associate roles with a component or component interface.</td>
</tr>
</table><br>
<p>
For example, you can automate creating a new package and installing components into the new package by using the scriptable objects in the utility layer (Package, Component, Remote Component, and Role objects).</p>
<p>
The following Visual Basic sample shows how to use the scriptable administration objects to create and install components into a new package named "My Package."
<ol>
<li>
Declare the objects that you will be using to create and install components into a new package.<pre><code>Dim catalog As Object
Dim packages As Object
Dim newPack As Object
Dim componentsInNewPack As Object
Dim util As Object</code></pre>
</li>
<li>
Use the <b>On Error</b> statement to handle run-time errors if a method returns a failure HRESULT. You can test and respond to MTS trappable errors using the <b>On Error</b> statement and the <b>Err</b> object.<pre><code>On Error GoTo failed</code></pre>
</li>
<li>
Call the <b>CreateObject </b>method to create an instance of the Catalog object. Retrieve the top level Packages collection from the CatalogCollection object by calling the <b>GetCollection</b> method. Then call the <b>Add</b> method to add a new package.<pre><code>Set catalog = CreateObject("MTSAdmin.Catalog.1")
Set packages = catalog.GetCollection("Packages")
Set newPack = packages.Add
Dim newPackID As String</code></pre>
</li>
<li>
Set the package name to "My Package" and save changes to the <b>Packages</b> collection.<pre><code>newPackID = newPack.Key
newPack.Value("Name") = "My Package"
packages.savechanges</code></pre>
</li>
<li>
Call the <b>GetCollection</b> method to access the ComponentsInPackage<b> </b>collection. Then instantiate the ComponentUtil object in order to call the <b>InstallComponent</b> method to populate the new package with components.<pre><code>Set componentsInNewPack = 
    packages.GetCollection("ComponentsInPackage",
    newPackID)
Set util = componentsInNewPack.GetUtilInterface
util.InstallComponent"d:\dllfilepath", "", ""
Exit Sub</code></pre>
</li>
<li>
Use the <b>Err</b> object to display an error message if the installation of the package fails.<pre><code>failed:
    MsgBox "Failure code " + Str$(Err.Number)

End Sub</code></pre>
</li>
</ol>
<p>
For a complete description of how to program these procedures and more sample code, refer to the <i>Administrator’s Guide</i>.</p>
<p>&nbsp; </p></body>
</HTML>
