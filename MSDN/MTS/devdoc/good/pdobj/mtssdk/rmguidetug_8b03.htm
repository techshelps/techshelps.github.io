<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Life of a Transaction: Transaction Commit Phase 1-Prepare II (Phases)</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR=#FFFFFF TEXT=#000000>

<h1><a name="aslifeofatransactiontransactioncommitphase1prepareiiphases"></a>Life of a Transaction: Transaction Commit Phase 1–Prepare II (Phases)</h1>
<table cellspacing=5 cols=2>
<tr valign=top>
<td width=11%>j8.1</td>
<td width=89%>The resource manager invokes the <b>ITransactionEnlistmentAsync</b>::<b>QueryInterface</b> method on the enlistment object to obtain the <b>IPrepareInfo</b> interface<i>.</i></td>
</tr>
<tr valign=top>
<td width=11%>j8.2</td>
<td width=89%>The resource manager invokes the <b>IPrepareInfo</b>::<b>GetPrepareInfoSize</b> method to determine the length of the prepare information. The prepare information is an opaque data item that identifies the transaction. The prepare information is used during failure recovery. At failure recovery time, the resource manager sends the prepare information to the transaction manager to learn the outcome of the transactions.</td>
</tr>
<tr valign=top>
<td width=11%>j9</td>
<td width=89%>The MS DTC proxy returns the byte length of the prepare information. The MS DTC proxy cached the prepare information when the resource manager enlisted in the transaction.</td>
</tr>
<tr valign=top>
<td width=11%>j10</td>
<td width=89%>The resource manager invokes the <b>IPrepareInfo</b>::<b>GetPrepareInfo</b> method to retrieve the prepare information.</td>
</tr>
<tr valign=top>
<td width=11%>j11</td>
<td width=89%>The MS DTC proxy returns the prepare information to the resource manager.</td>
</tr>
<tr valign=top>
<td width=11%>j12.1</td>
<td width=89%>The resource manager does the work necessary to prepare the transaction. This includes writing all changes made on behalf of the transaction to the resource manager’s log file. The resource manager then writes a Prepare record for the transaction to the log. The Prepare record must contain the prepare information obtained from MS DTC.</td>
</tr>
<tr valign=top>
<td width=11%>j12.2</td>
<td width=89%>The resource manager invokes the <b>ITransactionEnlistmentAsync</b>::<b>PrepareRequestDone </b>method to inform the MS DTC proxy that it has completed the prepare phase of the two-phase commit protocol.</td>
</tr>
<tr valign=top>
<td width=11%>j13</td>
<td width=89%>The MS DTC proxy informs the resource manager’s transaction manager that the resource manager has completed phase one.</td>
</tr>
<tr valign=top>
<td width=11%>j14</td>
<td width=89%>When all of the resource managers on the system complete phase one, the resource manager’s transaction manager writes a Prepared record to its log file. The resource manager’s transaction manager then informs the client’s transaction manager that phase one is complete.</td>
</tr>
</table><br>
<p>&nbsp; </p></body>
</HTML>
