<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Life of a Transaction: Transaction Commit Phase 2-Commit (Phases)</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR=#FFFFFF TEXT=#000000>

<h1><a name="aslifeofatransactiontransactioncommitphase2commitphases"></a>Life of a Transaction: Transaction Commit Phase 2–Commit I (Phases)</h1>
<table cellspacing=5 cols=2>
<tr valign=top>
<td width=11%>k1.1</td>
<td width=89%>The client’s transaction manager writes the transaction Commit record to the transaction manager log file.</td>
</tr>
<tr valign=top>
<td width=11%>k1.2</td>
<td width=89%>If the client requested transaction outcome notification, then the client’s transaction manager notifies the client's MS DTC proxy that the transaction has completed phase one.</td>
</tr>
<tr valign=top>
<td width=11%>k1.3</td>
<td width=89%>The client’s transaction manager initiates the second phase of the two-phase commit process. All of the work of committing the transaction is done in parallel. The client’s transaction manager determines if any resource managers on the client’s system have enlisted in the transaction. If so, the client’s transaction manager asks each of these resource managers to commit. In our example, no resource managers on the client’s system participated in the transaction.</td>
</tr>
<tr valign=top>
<td width=11%>k1.4</td>
<td width=89%>The client’s transaction manager determines which subordinate transaction managers have participated in the transaction and sends each of them a Commit message. These Commit messages are sent to the subordinate transaction managers in parallel. The Commit message informs the subordinate transaction managers to perform phase two processing.</td>
</tr>
<tr valign=top>
<td width=11%>k2</td>
<td width=89%>The MS DTC proxy returns from the <b>ITransaction::Commit</b> method invocation. This indicates to the client that phase one has completed.</td>
</tr>
<tr valign=top>
<td width=11%>k4.1</td>
<td width=89%>The resource manager’s transaction manager writes a Commit record to its local transaction manager log file.</td>
</tr>
<tr valign=top>
<td width=11%>k4.2</td>
<td width=89%>The resource manager’s transaction manager determines whether any transaction managers are subordinate to it. In our example, the resource manager’s transaction manager has no subordinates. If the resource manager’s transaction manager has subordinates, it sends each of them a Commit message. These Commit messages are sent to the subordinate transaction managers in parallel.</td>
</tr>
<tr valign=top>
<td width=11%>k4.3</td>
<td width=89%>The resource manager’s transaction manager uses its internal enlistment objects to determine which resource managers have enlisted in the transactions. It sends a Commit message to the MS DTC proxy of each enlisted resource manager. These Commit messages are sent to the MS DTC Proxies in parallel.</td>
</tr>
<tr valign=top>
<td width=11%>k4.4</td>
<td width=89%>The resource manager’s transaction manager awaits notification from all of the resource managers involved in the transaction that they have completed their commit work.</td>
</tr>
<tr valign=top>
<td width=11%>k5</td>
<td width=89%>Each MS DTC proxy invokes the resource manager’s <b>ITransactionResourceAsync::CommitRequest</b> method. This method invocation informs the resource manager that it should perform the second phase of the two-phase commit protocol.</td>
</tr>
<tr valign=top>
<td width=11%>k6</td>
<td width=89%>Each resource manager replies to the <b>CommitRequest </b>call from the MS DTC proxy to acknowledge that the <b>CommitRequest</b> has been received. After responding to the <b>CommitRequest</b> method invocation, the resource manager begins the work necessary to commit the transaction.</td>
</tr>
</table><br>
<p>&nbsp; </p></body>
</HTML>
