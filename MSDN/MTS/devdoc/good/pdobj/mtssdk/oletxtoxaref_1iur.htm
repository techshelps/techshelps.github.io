<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Implementing Algorithms</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR=#FFFFFF TEXT=#000000>

<p>
<a name="asimplementingalgorithms"></a>Implementing Algorithms</p>
<p>
The ODBC drivers are expected to implement several high-level algorithms in order to be fully integrated with MS DTC and, therefore, with Microsoft Transaction Server:</p>
<p>
<b>On SQL_ENLIST_IN_DTC with a Non-NULL Transaction Value</b></p>
<pre><code><b>if</b>  (Connection_State   EQUALS   LOCAL_TRANSACTION_STATE) <b>then</b>
<b>do begin</b>
<b>invoke</b> pIDtcToXaMapper-&gt;RequestNewResourceManager (    “Accounts”,  
“SQLODBC32.DLL”, 
&amp;dwRMCookie)

<b>do</b> close the database if it is open
<b>do</b> xa_open or its equivalent

<b>set</b> Connection_State to DISTRIBUTED_TRANSACTION_MODE
<b>end if</b>

<b>invoke</b> pIDtcToXaMapper-&gt;TranslateTridToXid     (    pITransaction, 
    dwRMCookie,
    &amp;XID
);
<b>do</b> xa_start or its equivalent

<b>invoke</b> pIDtcToXaMapper-&gt;EnlistResourceManager (dwRMCookie, pITransaction)

<b>do</b> xa_end or its equivalent if needed</code></pre>
<p>
<b>On SQL_ENLIST_IN_DTC with a NULL Transaction Value</b></p>
<pre><code><b>if</b> (Connection_State EQULS LOCAL_TRANSACTION_STATE) then
    return ERROR_UNEXPECTED_CALL

<b>set</b> Connection_State to LOCAL_TRANSACTION_MODE

<b>do</b> xa_close or its equivalent if needed</code></pre>
<p>&nbsp; </p></body>
</HTML>
