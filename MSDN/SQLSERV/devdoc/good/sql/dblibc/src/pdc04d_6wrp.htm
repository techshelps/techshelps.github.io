<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>dbmsghandle</title>
<link disabled rel=stylesheet href=../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_dbmsghandle"></a>dbmsghandle</h1>
<p>
Installs a user function to handle SQL Server messages.</p>
<h4>Syntax</h4>
<p>
<b>DBMSGHANDLE_PROC dbmsghandle (DBMSGHANDLE_PROC </b><i>handler</i><b> );</b></p>
<p>
where
<dl>
<dt>
<i>handler</i></dt>
<dd>
Is a pointer to the user function that is called whenever DB-Library receives an error or informational message from SQL Server. DB-Library calls this function with these parameters:
<dl>
<dt>
<i>dbproc</i></dt>
<dd>
Is the affected DBPROCESS. </dd>
<dt>
<i>msgno</i></dt>
<dd>
Is the online message number (datatype DBINT). These numbers are documented in the <i>Microsoft SQL Server Administrator's Companion</i>. They are stored online in the <i>sysmessages</i> table, from which they can be selected.</dd>
<dt>
<i>msgstate</i></dt>
<dd>
Is the message error state number (datatype <i>int</i>). These numbers provide information about the context of the error.</dd>
<dt>
<i>severity</i></dt>
<dd>
Is the message information class or error severity (datatype <i>int</i>). These numbers are documented in the <i>Microsoft SQL Server Administrator's Companion</i>. </dd>
<dt>
<i>msgtext</i></dt>
<dd>
Is the message null-terminated text (datatype <i>char</i> *).</dd>
<dt>
<i>srvname</i></dt>
<dd>
Is the null-terminated name of the server that generated the message (datatype <i>char</i> *). A server name is stored in the <i>srvname</i> column of its <i>sysservers</i> system table. <i>srvname</i> is optional.</dd>
<dt>
<i>procname</i></dt>
<dd>
Is the null-terminated name of the stored procedure that generated the message (datatype <i>char</i> *). If the message was not generated by a stored procedure, <i>procname</i> is set to a length of 0. <i>procname</i> is optional.</dd>
<dt>
<i>line</i></dt>
<dd>
Is the number of the command batch or stored procedure line that generated the message (datatype <i>DBUSMALLINT</i>). Line numbers start at 1.
<p>
The line number pertains to the nesting level at which the message was generated. For instance, if a command batch executes stored procedure A, which then calls stored procedure B, and a message is generated at line 3 of B, then the value of <i>line</i> becomes 3. 

<p>
If no line number is associated with the message, <i>line</i> becomes 0. Circumstances that can generate messages without line numbers include a login error or a call to a remote procedure (through <b>dbrpcsend</b>) to a stored procedure that doesn't exist.

<p>
<i>line</i> is optional.
</dd>
</dl>

<p>
The message handler must return a value of 0 to DB-Library.

</dd>
</dl>
<h4>Returns</h4>
<p>
A pointer to the previously installed message handler. This can be NULL.</p>
<h4>Remarks</h4>
<p>
This function installs a message-handling function that you supply. When DB-Library receives a SQL Server error or informational message, it immediately calls this message handler. You must install a message handler to handle SQL Server messages.</p>
<p>
Since the message handler is a call-back function, special considerations are required when compiling these functions under the Windows operating system. For more information, see <a href="pdc03_58ab.htm">Building Applications</a>. </p>
<p>
<b>Note</b>  The <i>srvname</i>, <i>procname</i>, and <i>line</i> parameters are optional, and compatibility with previous versions of SQL Server is maintained through the <b>cdecl</b> parameter declaration convention.</p>
<h4>Example</h4>
<p>
The following example shows a typical message-handling function:</p>
<pre>#include    &lt;sqlfront.h&gt;
#include    &lt;sqldb.h&gt;

int msg_handler(dbproc, msgno, msgstate, severity, msgtext,
    srvname, procname, line)
DBPROCESS    *dbproc;
DBINT        msgno;
int            msgstate;
int            severity;
char            *msgtext;
char            *srvname;
char            *procname;
DBUSMALLINT    line;

{
    printf("SQL Server message %ld, state %d, "
        "severity %d:\n\t%s\n", msgno, msgstate, severity, msgtext);
    if (strlen(srvname)==0)
        printf ("Server '%s', ", srvname);
    if (strlen(procname)==0)
        printf ("Procedure '%s', ", procname);
    if (line==0)
        printf ("Line %d", line);

 printf("\n\t%s\n", msgtext);
    return(0);
}</pre>
<h4>See Also</h4>
<p>
<a href="pdc04c_6v39.htm"><b>dberrhandle</b></a> </p>
<p>
</p>
<p>&nbsp;</p></body>
</HTML>
