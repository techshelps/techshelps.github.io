<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>dbcursoropen</title>
<link disabled rel=stylesheet href=../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_dbcursoropen"></a>dbcursoropen</h1>
<p>
Opens a cursor. It is an explicit server cursor if you are connected to SQL Server 6.0 and <b>dbcursorfetchex</b> is used for the first fetch. It is a transparent server cursor if you are connected to SQL Server 6.0 and <b>dbcursorfetch</b> is used for the first fetch. It is a client cursor if you are connected to SQL Server 4.2, or if the DBCLIENTCURSORS option is set, and only <b>dbcursorfetch</b> can be used to fetch rows.</p>
<h4>Syntax</h4>
<p>
<b>PDBCURSOR dbcursoropen ( <br>
PDBPROCESS </b><i>dbproc</i><b>, <br>
LPCSTR </b><i>stmt</i><b>, <br>
INT </b><i>scrollopt</i><b>, <br>
INT </b><i>concuropt</i><b>, <br>
UINT </b><i>nrows</i><b>, <br>
LPDBINT </b><i>pstatus</i><b> );</b></p>
<p>
where
<dl>
<dt>
<i>dbproc</i></dt>
<dd>
Is the DBPROCESS structure that is the handle for a particular workstation/ SQL Server process. It contains all the information that DB-Library uses to manage communications and data between the workstation and SQL Server.</dd>
<dt>
<i>stmt</i></dt>
<dd>
Is the SELECT statement that defines a cursor.
<p>
<b>Client cursor:</b>

<p>
This must be a single SELECT statement. All tables included in the FROM clause must have a unique index.

<p>
The SELECT statement cannot contain any of the following:

<ul>
<li>
INTO</li>
<li>
FOR BROWSE</li>
<li>
COMPUTE</li>
<li>
UNION</li>
<li>
COMPUTE BY</li>
<li>
aggregate function</li>
<li>
Table alias</li>
</ul>

<p>
If <i>scrollopt</i> is CUR_KEYSET, the SELECT statement can contain the following keywords:

<ul>
<li>
ORDER BY</li>
<li>
HAVING</li>
<li>
GROUP BY</li>
</ul>

<p>
If the SELECT statement includes a view, the FROM clause must include only a single view (no other tables or views). All base tables included in the FROM clause of the view definition must have a unique index, and the select list must include all unique index columns of the base tables.

<p>
<b>Transparent server cursor, explicit server cursor:</b>

<p>
This can be a single SELECT statement or the name of a stored procedure that contains only a single SELECT statement.

<p>
The SELECT statement (alone or in a stored procedure) cannot contain any of the following keywords:

<ul>
<li>
INTO</li>
<li>
FOR BROWSE</li>
<li>
COMPUTE</li>
</ul>

<p>
The SELECT statement can contain an ORDER BY clause. If the columns in the ORDER BY clause match the columns of the unique indexes used by the cursor, the cursor will use the <i>scrollopt</i> requested. If they do not match, SQL Server must generate a temporary table, and a CUR_KEYSET cursor will be used if a <i>scrollopt</i> of CUR_FORWARD or CUR_DYNAMIC is requested. This also occurs if the SELECT contains a subquery.

<p>
The cursor is automatically opened with a <i>scrollopt</i> of CUR_INSENSITIVE and a <i>concuropt</i> of CUR_READONLY if the SELECT statement contains any of the following:

<ul>
<li>
Table with no unique index</li>
<li>
UNION</li>
<li>
DISTINCT</li>
<li>
GROUP BY</li>
<li>
HAVING</li>
<li>
aggregate function</li>
<li>
Outer join</li>
</ul>

<p>
If a stored procedure is used, any input parameters must be constants. Declared variables cannot be used for input parameters. Any output parameters or return values from the stored procedure are ignored.
</dd>
<dt>
<i>scrollopt</i></dt>
<dd>
Is one of the following requested scroll options:
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=27%></th>
<th align=left width=73%></th>
</tr>
<tr valign=top>
<th align=left width=27%></th>
<th align=left width=73%></th>
</tr>
<tr valign=top>
<th align=left width=27%><i>scrollopt</i></th>
<th align=left width=73%>Description</th>
</tr>
<tr valign=top>
<td width=27%></td>
<td width=73%></td>
</tr>
<tr valign=top>
<td width=27%>CUR_DYNAMIC</td>
<td width=73%>Dynamic cursor.<p>
<b>Client cursor, transparent server cursor:</b></p>
<p>
The <b>dbcursorfetch</b> function will allow only a <i>fetchtype</i> of FETCH_FIRST, FETCH_NEXT, or FETCH_PREV.</p>
<p>
<b>Explicit server cursor:</b></p>
<p>
The <b>dbcursorfetchex</b> function will allow all <i>fetchtype</i> values except FETCH_RANDOM.</p>
</td>
</tr>
<tr valign=top>
<td width=27%>CUR_FORWARD</td>
<td width=73%>Forward-only dynamic cursor.<p>
<b>Client cursor, transparent server cursor:</b></p>
<p>
The <b>dbcursorfetch</b> function will allow only a <i>fetchtype</i> of FETCH_FIRST or FETCH_NEXT.</p>
<p>
<b>Explicit server cursor:</b></p>
<p>
The <b>dbcursorfetchex</b> function will allow only a <i>fetchtype</i> of FETCH_FIRST, FETCH_NEXT, or FETCH_RELATIVE with a positive <i>rownum</i>.</p>
</td>
</tr>
<tr valign=top>
<td width=27%>CUR_KEYSET</td>
<td width=73%>Keyset cursor.<p>
The <b>dbcursorfetch</b> and <b>dbcursorfetchex</b> functions will allow all <i>fetchtype</i> values.</p>
</td>
</tr>
<tr valign=top>
<td width=27%>CUR_INSENSITIVE</td>
<td width=73%><b>Client cursor:</b><p>
Not supported.</p>
<p>
<b>Transparent server cursor, explicit server cursor:</b></p>
<p>
Insensitive keyset cursor. Use a <i>concuropt</i> of READ_ONLY. SQL Server will generate a temporary table, so changes made to the rows by others will not be visible through the cursor.</p>
<p>
The dbcursorfetch and dbcursorfetchex functions will allow all <i>fetchtype</i> values.</p>
</td>
</tr>
<tr valign=top>
<td width=27%><i>n</i> &gt; 1</td>
<td width=73%><b>Client cursor:</b><p>
For backward compatibility with "mixed" client cursors.</p>
<p>
<b>Transparent server cursor, explicit server cursor:</b></p>
<p>
Mapped to a CUR_KEYSET cursor.</p>
</td>
</tr>
</table><br>

</dd>
<dt>
<i>concuropt</i></dt>
<dd>
Is one of the following concurrency control options:
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=28%></th>
<th align=left width=72%></th>
</tr>
<tr valign=top>
<th align=left width=28%></th>
<th align=left width=72%></th>
</tr>
<tr valign=top>
<th align=left width=28%><i>concuropt</i></th>
<th align=left width=72%>Description</th>
</tr>
<tr valign=top>
<td width=28%></td>
<td width=72%></td>
</tr>
<tr valign=top>
<td width=28%>CUR_READONLY</td>
<td width=72%>Read-only cursor. You cannot modify rows in the cursor results set.</td>
</tr>
<tr valign=top>
<td width=28%>CUR_LOCKCC</td>
<td width=72%>Intent to update locking.<p>
<b>Client cursor:</b></p>
<p>
Places an exclusive lock on the data page that contains each row as it is fetched. The locks are maintained only if it is inside an open transaction block defined by BEGIN TRANSACTION; the locks are released when the transaction is closed by a COMMIT TRANSACTION or ROLLBACK TRANSACTION statement.</p>
<p>
<b>Transparent server cursor, explicit server cursor:</b></p>
<p>
Places an update intent lock on the data page that contains each row as it is fetched. If not inside an open transaction, the locks are released when the next fetch is performed. If inside an open transaction, the locks are released when the transaction is closed.</p>
</td>
</tr>
<tr valign=top>
<td width=28%>CUR_OPTCC</td>
<td width=72%>Optimistic concurrency control using timestamp or values. Changes to a row through the cursor succeed only if the row remains unchanged since the last fetch. Changes are detected by comparing timestamps or by comparing all non-text, non-image values if timestamps are not available.</td>
</tr>
<tr valign=top>
<td width=28%>CUR_OPTCCVAL</td>
<td width=72%>Optimistic concurrency control using values. Changes to a row through the cursor succeed only if the row remains unchanged since the last fetch. Changes are detected by comparing all non-text, non-image values.</td>
</tr>
</table><br>

</dd>
<dt>
<i>nrows</i></dt>
<dd>
<b>Client cursor, transparent server cursor:</b>
<p>
Is the number of rows in the fetch buffer filled by calls to dbcursorfetch.

<p>
<b>Explicit server cursor:</b>

<p>
Is the maximum number of rows in the fetch buffer. The <i>nfetchrows</i> parameter of dbcursorfetchex must be less than or equal to this value. 
</dd>
<dt>
<i>pstatus</i></dt>
<dd>
Is a pointer to the array of row status indicators. This array must contain <i>nrows</i> DBINT elements. A row status value is a bitmap of fetch status values ORed together.
<p>
Each row in the fetch buffer has a corresponding row status indicator. After a fetch, the status of every row in the fetch buffer is returned in the corresponding element of this array.

<p>
<b>Client cursor, transparent server cursor:</b>

<p>
For more information about fetch status values, see <b>dbcursorfetch</b>.

<p>
<b>Explicit server cursor:</b>

<p>
For more information about fetch status values, see <b>dbcursorfetchex</b>.

</dd>
</dl>
<h4>Returns</h4>
<p>
A handle to the cursor if the cursor open succeeds. If it fails, NULL is returned. Several errors, such as the following, can cause the cursor to fail:
<ul>
<li>
Not enough memory to complete the request. Reduce the number of rows in the keyset cursor results set by using a more limiting WHERE clause, use a dynamic cursor, or reduce the number of rows in the fetch buffer.</li>
<li>
Tables did not have the required unique indexes.</li>
<li>
A syntax error occurred or the SELECT statement failed.</li>
</ul>
<h4>Remarks</h4>
<p>
After <b>dbcursoropen</b> returns a valid cursor handle, you can call <b>dbcursorinfoex</b> and examine the <b>Type</b> field to determine the actual type of cursor that was opened.</p>
<p>
With a dynamic cursor, membership of rows in the cursor results set is determined at fetch time, and it can change between each fetch. A row disappears from the cursor results set if it is deleted or if it is updated such that it no longer meets the WHERE clause criteria. A row appears in the cursor results set if it is inserted or updated such that it meets the WHERE clause criteria.</p>
<p>
With a keyset cursor, membership and order of rows in the cursor results set is fixed at open time. A row is marked as missing from the cursor results set if it is deleted or if it is updated such that it no longer meets the WHERE clause criteria. A row appears in the cursor results set only if it inserted through a cursor based on a single table.</p>
<p>
Multiple cursors (as many as the system's memory allows) can be opened using the same DBPROCESS connection. When cursor functions are called, there should be no commands waiting to be executed or results pending in the DBPROCESS connection.</p>
<h4>See Also</h4>
<p>
<a href="pdc05_7l4i.htm"><b>dbcursor</b></a>, <a href="pdc05_5jz8.htm"><b>dbcursorbind</b></a>, <a href="pdc05_22sl.htm"><b>dbcursorclose</b></a>, <a href="pdc05_7wbz.htm"><b>dbcursorcolinfo</b></a>, <a href="pdc05_1y20.htm"><b>dbcursorfetch</b></a>, <a href="pdc05_5ban.htm"><b>dbcursorinfo</b></a>, <a href="#_dbcursoropen"><b>dbcursoropen</b></a>; <a href="pdc09_7e7t.htm">Bulk-Copy Functions</a> </p>
<p>&nbsp;</p></body>
</HTML>
