<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>sp_addalert SQL Executive Stored Procedure</title>
<link disabled rel=stylesheet href=../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_sp_addalert_sql_executive_stored_procedure"></a>sp_addalert SQL Executive Stored Procedure </h2>
<p>
Creates an alert.</p>
<h4>Syntax</h4>
<p>
<b>sp_addalert</b> <i>name</i><b>,</b> <i>message_id</i><b>,</b><i> severity</i> [<b>,</b> <i>enabled</i>] [<b>,</b> <i>delay_between_responses</i>] [<b>,</b> <i>notification_message</i>] [<b>,</b> <i>include_event_description_in</i>] [<b>,</b> <i>database_name</i>] [<b>,</b> <i>event_description_keyword</i>] [<b>,</b> <i>task_name</i>]</p>
<p>
where
<dl>
<dt>
<i>name</i> </dt>
<dd>
Is the name of the alert (for example, 605 Alert). This name will appear in the e-mail and/or page sent in response to the alert. It must be unique and be no more than 60 characters. </dd>
<dt>
<i>message_id</i> </dt>
<dd>
Is the message error number that defines the alert. (Normally corresponds to an error number in the <i>sysmessages </i>table.) If <i>severity</i> is used to define the alert, <i>message_id</i> must be zero or NULL. Note that only <i>sysmessages</i> errors written to the event log can cause an alert to be sent. </dd>
<dt>
<i>severity</i></dt>
<dd>
Specifies the severity level (9 through 25, 110, 120, 130, or 140) that defines the alert. Any SQL Server message stored in the <i>sysmessages</i> table that is sent to the Windows NT event log with the indicated severity will cause the alert to be sent. If <i>message_id</i> is used to define the alert, severity must be zero or NULL. </dd>
<dt>
<i>enabled</i></dt>
<dd>
Indicates whether the alert is currently enabled (1 if enabled, 0 if not). A non-enabled alert will not be sent. The default is enabled (1).</dd>
<dt>
<i>delay_between_responses</i></dt>
<dd>
Specifies the wait period, in seconds, between responses to the alert. The response consists of :
<ul>
<li>
One or more notifications sent via e-mail and/or pager<p>
and/or
</li>
<li>
A task to execute <p>
By setting this value it is possible to prevent, for example, an unwanted flood of e-mail messages from being sent when an alert repeatedly occurs in a short period of time. If a value is not supplied, the default is 0, which means there is no waiting between responses (each occurrence of the alert generates a response).
</li>
</ul>
</dd>
<dt>
<i>notification_message</i></dt>
<dd>
Is an optional additional message that will be sent to the operator as part of the e-mail and/or pager notification. Specifying <i>notification_message</i> is useful for adding special notes such as remedial procedures. It can contain as many as 255 characters.</dd>
<dt>
<i>include_event_description_in</i></dt>
<dd>
Specifies whether the description of the SQL Server error from the Windows NT event log should be included as part of the notification message. Must be NONE, EMAIL, PAGER or BOTH.</dd>
<dt>
<i>database_name</i></dt>
<dd>
More restrictively defines the alert by specifying the database in which the error must occur in order for the alert to fire. If <i>database_name</i> is not supplied, the alert will fire regardless of in which database the error occurred.</dd>
<dt>
<i>event_description_keyword</i></dt>
<dd>
More restrictively defines the alert by specifying that the description of the SQL Server error in the Windows NT event log must be like the supplied sequence of characters. Transact-SQL LIKE expression pattern-matching characters can be used. This parameter is useful for filtering object names (for example, %customer_table%). It can contain as many as 100 characters.</dd>
<dt>
<i>task_name</i></dt>
<dd>
Specifies an On-Demand task to be executed in response to an alert. The task must be of type CmdExec or TSQL. For details, see the <b>sp_addtask</b> SQL Executive Stored Procedure.</dd>
</dl>
<h4>Remarks</h4>
<p>
This stored procedure must be run from the <i>msdb</i> database.</p>
<p>
The following summarizes the circumstances under which errors/messages generated by SQL Server and SQL Server applications are sent to the Windows NT event log and can therefore raise alerts:
<ul>
<li>
Severity 19 or higher sysmessages errors</li>
<li>
information/warnings/errors from the server (severities 110, 120, and 130)</li>
<li>
Any RAISERROR statement invoked with WITH_LOG syntax</li>
<li>
Any user-defined messages in the sysmessages table that were created with a WITH_LOG option of 'TRUE'</li>
<li>
Any <i>sysmessages</i> error modified using the <b>sp_altermessage</b> SQL executive stored procedure (for example, <b>sp_altermessage 123456, with_log, true</b>)</li>
<li>
Any event logged using the <b>xp_logevent </b>extended stored procedure</li>
</ul>
<p>
SQL Enterprise Manager provides an easy, graphical way to manage the entire alerting system. Using SQL Enterprise Manager is the recommended way to configure your alert infrastructure.</p>
<p>
If an alert is not functioning properly, check the following:
<ul>
<li>
The SQL Executive service is running</li>
<li>
The event appeared in the Windows NT event log</li>
<li>
The alert is enabled</li>
</ul>
<h4>Example</h4>
<p>
This example adds an alert (<b>'</b>Test Alert<b>'</b>) that invokes the task <b>'</b>Back up the Customer Database,<b>'</b> when fired.</p>
<pre>EXEC sp_addalert @name = 'Test Alert', @message_id = 55001, @severity = NULL, @notification_message = 'Error 55001 has occurred. The database will be backed up...', @task_name = 'Back up the Customer Database'</pre>
<h4>Permission</h4>
<p>
Only the system administrator can use this procedure.</p>
<h4>Tables Used</h4>
<p>
<i>sysalerts</i>, <i>systasks</i></p>
<h4>See Also</h4>
<table cellspacing=4 cols=2>
<tr valign=top>
<td width=48%></td>
<td width=52%></td>
</tr>
<tr valign=top>
<td width=48%><a href="tsql17_4cit.htm"><b>sp_addnotification</b></a></td>
<td width=52%><a href="tsql17_8vz9.htm"><b>sp_helpalert</b></a></td>
</tr>
<tr valign=top>
<td width=48%><a href="tsql17_1qw5.htm"><b>sp_addtask</b></a></td>
<td width=52%><a href="tsql17_17mt.htm"><b>sp_updatealert</b></a></td>
</tr>
<tr valign=top>
<td width=48%><a href="tsql17_5w4l.htm"><b>sp_dropalert</b></a></td>
<td width=52%></td>
</tr>
</table><br>
<p>
</p>
<p>&nbsp;</p></body>
</HTML>
