<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>xp_readmail Extended Stored Procedure</title>
<link disabled rel=stylesheet href=../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_xp_readmail_extended_stored_procedure"></a>xp_readmail Extended Stored Procedure</h2>
<p>
Reads a mail message from the SQL Server mail inbox. This procedure is used by the <b>sp_processmail </b>system stored procedure to process all mail in the SQL Server inbox.</p>
<h4>Syntax</h4>
<p>
<b>xp_readmail</b> <b>(</b>[@msg_id <b>=</b> <i>msg_id</i>] [<b>,</b> @type <b>=</b> <i>type</i> [OUTPUT]] <br>
&nbsp;&nbsp;&nbsp;&nbsp;[<b>,</b> @peek <b>=</b> {<b>'true' | 'false'</b>}] <br>
&nbsp;&nbsp;&nbsp;&nbsp;[<b>, </b>@suppress_attach <b>=</b> {<b>'true' | 'false'</b>}] <br>
&nbsp;&nbsp;&nbsp;&nbsp;[<b>,</b> @originator <b>=</b> <i>@sender</i> OUTPUT] <br>
&nbsp;&nbsp;&nbsp;&nbsp;[<b>,</b> @subject <b>=</b> <i>@subject_line</i> OUTPUT] <br>
&nbsp;&nbsp;&nbsp;&nbsp;[<b>, </b>@message <b>=</b> <i>@body_of_message</i> OUTPUT] <br>
&nbsp;&nbsp;&nbsp;&nbsp;[<b>, </b>@recipients <b>=</b> <i>@recipient_list</i> OUTPUT] <br>
&nbsp;&nbsp;&nbsp;&nbsp;[<b>, </b>@cc_list <b>=</b> <i>@cc_list</i> OUTPUT] <br>
&nbsp;&nbsp;&nbsp;&nbsp;[<b>, </b>@bcc_list <b>=</b> <i>@bcc_list</i> OUTPUT]<br>
&nbsp;&nbsp;&nbsp;&nbsp;[<b>, </b>@date_received <b>=</b> <i>@date</i> OUTPUT] <br>
&nbsp;&nbsp;&nbsp;&nbsp;[<b>,</b> @unread <b>=</b> {<b>'true' | 'false'</b>}] <br>
&nbsp;&nbsp;&nbsp;&nbsp;[<b>, </b>@attachments <b>=</b> <i>@temp_file_paths</i> OUTPUT]<b>)</b> <br>
&nbsp;&nbsp;&nbsp;&nbsp;[<b>,</b> @skip_bytes <b>=</b> <i>@bytes_to skip</i> OUTPUT] <br>
&nbsp;&nbsp;&nbsp;&nbsp;[<b>, </b>@msg_length <b>=</b> <i>@length_in_bytes </i>OUTPUT]<b>)</b> </p>
<p>
where
<dl>
<dt>
@msg_id <b>= </b><i>msg_id</i></dt>
<dd>
Specifies the ID of the message to read.</dd>
<dt>
@type <b>= </b><i>type</i></dt>
<dd>
Returns the message class based on the MAPI mail definition:
<pre>IP[M | C].Vendorname.subclass</pre>

<p>
If used on input, this must define the type for a specific message; this parameter is ignored on input if the <i>msg_id</i> is NULL. 

<p>
The default <i>type </i>is NULL.
</dd>
<dt>
@peek <b>=</b> {<b>'true' | 'false'</b>}</dt>
<dd>
Allows SQL Server to return the message of the mail without changing the mail status to read. The default is <b>false </b>(treat the mail as though it has been read).</dd>
<dt>
@suppress_attach <b>=</b> {<b>'true' | 'false'</b>}</dt>
<dd>
Suppresses mail attachments. When set to <b>true</b>, prevents the creation of temporary files when <b>xp_readmail</b> reads a message with attachments. The default is <b>true </b>(do not create temporary files).</dd>
<dt>
@originator <b>= </b><i>@sender</i></dt>
<dd>
Is the variable in which the mail address of the sender will be returned. Define this variable as <i>varchar</i>(255).</dd>
<dt>
@subject <b>=</b> <i>@subject_line</i></dt>
<dd>
Is the variable in which the subject of the mail message will be returned. Define this variable as <i>varchar</i>(255).</dd>
<dt>
@message <b>= </b><i>@body_of_message</i></dt>
<dd>
Is the variable in which the body (the actual text) of the mail message will be returned. Define this variable as <i>varchar</i>(255).</dd>
<dt>
@recipients <b>=</b> <i>@recipient_list</i></dt>
<dd>
Is the variable in which the list of the recipients of the mail message will be returned. Recipients' names are separated by a semicolon (;). Define this variable as <i>varchar</i>(255).</dd>
<dt>
@cc_list <b>=</b> <i>@cc_list</i></dt>
<dd>
Is the variable in which the list of the copied recipients (cc:'ed) of the mail message will be returned. Recipients' names are separated by a semicolon (;). Define this variable as <i>varchar</i>(255).</dd>
<dt>
@bcc_list <b>=</b> <i>@bcc_list</i></dt>
<dd>
Is the variable in which the list of the blind copy recipients (bcc:'ed) of the mail message will be returned. Recipients' names are separated by a semicolon (;). Define this variable as <i>varchar</i>(255).</dd>
<dt>
@date_received <b>=</b> <i>@date</i></dt>
<dd>
Is the variable in which the date of the mail message will be returned. Define this variable as <i>varchar</i>(255).</dd>
<dt>
@unread = <b>'true' | 'false'</b></dt>
<dd>
Specifies that only unread messages are considered. The default is <b>true</b>.</dd>
<dt>
@attachments <b>=</b> <i>@temp_file_paths</i></dt>
<dd>
Is the variable in which the temporary paths of the mail attachments will be returned. Temporary paths are separated by a semicolon (;). Define this variable as <i>varchar</i>(255).
</dd>
<dt>
@skip_bytes <b>=</b> <i>@bytes_to skip</i> OUTPUT</dt>
<dd>
If a value other than 0 is passed for input, this parameter specifies the number of bytes to skip before reading the next 255 bytes (max) of the message into the <i>@body of message </i>output parameter. When @skip_bytes is used, <i>@body_of_message</i> will include the next portion of the message and <i>@bytes_to_skip</i> will return with the next starting point within the message (the previous <i>@bytes_to_skip </i>plus the length of <i>@body_of_message</i>). </dd>
<dt>
@msg_length <b>=</b> <i>@length_in_bytes </i>OUTPUT</dt>
<dd>
Returns the total length of the message, in bytes. When used with @skip_bytes in a stored procedure, this parameter will allow messages to be read in chunks of 255 bytes.</dd>
</dl>
<h4>Remarks</h4>
<p>
This extended stored procedure returns a successful (0) or failed (1) status. Any failure except an invalid parameter is logged to the Windows NT application event log.</p>
<h4>Example</h4>
<p>
This example returns the status when reading a message. In this example, the value of a message ID from <b>xp_findnextmsg</b> is placed in a local variable named @message_id and passed to <b>xp_readmail</b>.</p>
<pre>EXEC @status = xp_readmail @msg_id = @message_id,
        @originator = @originator OUTPUT,
        @cc_list = @cc_list OUTPUT,
        @subject = @msgsubject OUTPUT,
        @message = @query OUTPUT,
        @peek = 'TRUE',
        @suppress_attach = 'TRUE'
</pre>
<h4>Permission</h4>
<p>
Execute permission defaults to the system administrator, who can grant permission to other users.</p>
<h4>See Also</h4>
<table cellspacing=4 cols=2>
<tr valign=top>
<td width=48%></td>
<td width=52%></td>
</tr>
<tr valign=top>
<td width=48%><a href="tsql23_095x.htm"><b>sp_processmail</b></a></td>
<td width=52%><a href="tsql14_4nad.htm"><b>xp_sendmail</b></a></td>
</tr>
<tr valign=top>
<td width=48%><a href="tsql14_7vfp.htm"><b>xp_deletemail</b></a></td>
<td width=52%><a href="tsql14_0411.htm"><b>xp_startmail</b></a></td>
</tr>
<tr valign=top>
<td width=48%><a href="tsql14_7ylh.htm"><b>xp_findnextmsg</b></a></td>
<td width=52%><a href="tsql14_77c5.htm"><b>xp_stopmail</b></a></td>
</tr>
</table><br>
<p>
</p>
<p>&nbsp;</p></body>
</HTML>
