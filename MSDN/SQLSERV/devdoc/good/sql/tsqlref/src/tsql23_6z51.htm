<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>sp_lock System Stored Procedure</title>
<link disabled rel=stylesheet href=../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_sp_lock_system_stored_procedure"></a>sp_lock System Stored Procedure</h2>
<p>
Reports information about locks.</p>
<h4>Syntax</h4>
<p>
<b>sp_lock</b> [<i>spid1</i> [<b>,</b> <i>spid2</i>]]</p>
<p>
where
<dl>
<dt>
<i>spid1</i></dt>
<dd>
Is the SQL Server process ID number from <i>master.dbo.sysprocesses</i>. Execute <b>sp_who</b> to get the <i>spid</i> of the lock. If this parameter is not supplied, information about all locks is displayed.</dd>
<dt>
<i>spid2</i></dt>
<dd>
Identifies another SQL Server process ID number to check for locks. 
</dd>
</dl>
<h4>Remarks</h4>
<p>
Users can control locking by adding an optimizer hint to the FROM clause of a SELECT statement or by setting the TRANSACTION ISOLATION LEVEL with the SET statement. For syntax and restrictions, see the SELECT and SET statements.</p>
<p>
In general, read operations acquire shared locks, and write operations acquire exclusive locks. Update locks are created at the page level and are acquired during the initial portion of an update operation when the pages are being read. Update locks are compatible with shared locks. Later, if the pages are changed, the update locks are promoted to exclusive locks.</p>
<p>
An intent lock indicates the intention to acquire a shared or exclusive page level lock. An intent lock prevents another transaction from acquiring a table lock for that table.</p>
<p>
An extent lock is held on a group of eight database pages while they are being allocated or freed. Extent locks are set while a CREATE or DROP statement is running or while an INSERT or &nbsp;&nbsp;&nbsp;&nbsp;UPDATE statement that requires new data or index pages is running.</p>
<p>
The <i>locktype</i> column indicates whether the lock is a shared lock (Sh), an exclusive lock (Ex), or an update lock. This column also indicates whether the lock is held on a table (table or intent), a page, or an extent, and whether it is blocking (blk) another process. The blk suffix in the <i>locktype</i> indicates that this process is blocking another process that needs to acquire a lock. As soon as this process finishes, the other process(es) move forward.</p>
<p>
When reading <b>sp_lock</b> information, use the OBJECT_NAME<b>( )</b> function to get a table's name from its ID number. For example:</p>
<pre>SELECT object_name(16003088)
</pre>
<p>
Other information can also be displayed based on the <i>spid</i> returned from <b>sp_lock</b>. For information about using the Windows NT Performance Monitor to view information about a specific <i>spid</i>, see the DBCC statement. </p>
<h4>Examples</h4>
<h5>A.&nbsp;&nbsp;&nbsp;&nbsp;List All Locks</h5>
<p>
This example displays information about all locks currently held in SQL Server.</p>
<pre>sp_lock
</pre>
<h5>B.&nbsp;&nbsp;&nbsp;&nbsp;List a Single Lock</h5>
<p>
This example displays information about locks currently held on <i>spid </i>1.</p>
<pre>sp_lock 1
</pre>
<h4>Permission</h4>
<p>
Execute permission defaults to the <i>public</i> group.</p>
<h4>Tables Used</h4>
<p>
<i>master.dbo.spt_values</i>, <i>master.dbo.syslocks</i>, <i>master.dbo.sysprocesses</i></p>
<h4>See Also</h4>
<table cellspacing=4 cols=2>
<tr valign=top>
<td width=48%><a href="tsql06_0yus.htm">DBCC</a></td>
<td width=52%><a href="tsql12_654k.htm">SELECT statement </a></td>
</tr>
<tr valign=top>
<td width=48%><a href="tsql09_9dyr.htm">Functions</a></td>
<td width=52%><a href="tsql24_2739.htm"><b>sp_who</b></a></td>
</tr>
<tr valign=top>
<td width=48%><a href="tsql11_25bo.htm">KILL statement</a></td>
<td width=52%></td>
</tr>
</table><br>
<p>
</p>
<p>&nbsp;</p></body>
</HTML>
