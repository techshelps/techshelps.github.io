<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>xp_cmdshell Extended Stored Procedure</title>
<link disabled rel=stylesheet href=../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_xp_cmdshell_extended_stored_procedure"></a>xp_cmdshell Extended Stored Procedure </h2>
<p>
Executes a given command string as an operating-system command shell and returns any output as rows of text.</p>
<h4>Syntax</h4>
<p>
<b>xp_cmdshell </b><i>command_string</i> [<b>, no_output</b>]</p>
<p>
where
<dl>
<dt>
<i>command_string</i></dt>
<dd>
Specifies the command string to execute at the operating-system command shell.</dd>
<dt>
<b>no_output</b></dt>
<dd>
Is an optional parameter that executes the given <i>command_string</i> but does not return any output to the client.
</dd>
</dl>
<h4>Remarks</h4>
<p>
Be aware that when you grant execute permission for <b>xp_cmdshell</b> to users, the users will be able to execute any operating-system command at the Windows NT command shell that the account running SQL Server (typically local system) has privilege to execute.</p>
<p>
To restrict <b>xp_cmdshell</b> access to users who have administrator permission on the Windows NT-based computer where SQL Server is running, use SQL Setup or SQL Enterprise Manager to set the server options, selecting the "xp_cmdshell - Impersonates Client" option.  With this option selected, only users who have connected to SQL Server via a trusted connection and are members of the local Administrators group on that computer are allowed to use <b>xp_cmdshell</b>. The commands run by <b>xp_cmdshell</b> continue to execute in the server's security context.</p>
<h4>Examples</h4>
<h5>A.&nbsp;&nbsp;&nbsp;&nbsp;Return a List of Executable Files</h5>
<p>
This example shows the <b>xp_cmdshell</b> extended stored procedure executing a directory command.</p>
<pre>EXEC master..xp_cmdshell "dir *.exe"</pre>
<h5>B.&nbsp;&nbsp;&nbsp;&nbsp;Use Windows NT net Commands</h5>
<p>
This example shows the use of <b>xp_cmdshell</b> in a stored procedure. This example notifies users (with <b>net send</b>) that SQL Server is about to be shut down, pauses the server (with <b>net pause</b>), and then shuts the server down (with <b>net stop</b>):</p>
<pre>CREATE PROC shutdown10
AS
EXEC xp_cmdshell "net send /domain:SQL_USERS 'SQL Server shutting down 
    in 10 minutes. No more connections     allowed.'", no_output
EXEC xp_cmdshell "net pause sqlserver"
WAITFOR DELAY "00:05:00"
EXEC xp_cmdshell "net send /domain: SQL_USERS 'SQL Server shutting down 
    in 5 minutes.'", no_output
WAITFOR DELAY "00:04:00"
EXEC xp_cmdshell "net send /domain:SQL_USERS 'SQL Server shutting down 
    in 1 minute. Log off now.'", no_output
WAITFOR DELAY "00:01:00"
EXEC xp_cmdshell "net stop sqlserver", no_output</pre>
<h5>C.&nbsp;&nbsp;&nbsp;&nbsp;Do Not Return Output </h5>
<p>
This example uses <b>xp_cmdshell</b> to execute a command string without returning the output to the client.</p>
<pre>EXEC xp_cmdshell "copy c:\sqldumps\pubs.dmp \\server2\backups\sqldumps", 
    NO_OUTPUT
</pre>
<h5>D.&nbsp;&nbsp;&nbsp;&nbsp;Use Return Status</h5>
<p>
In this example, the <b>xp_cmdshell</b> extended stored procedure also suggests return status.</p>
<pre>DECLARE @result int
EXEC @result = xp_cmdshell "dir *.exe"
IF (@result = 1)
    PRINT "Success"
ELSE
    PRINT "Failure"
</pre>
<h4>Permission</h4>
<p>
Execute permission defaults to the system administrator, who can grant permission to other users.</p>
<h4>See Also</h4>
<table cellspacing=4 cols=2>
<tr valign=top>
<td width=48%></td>
<td width=52%></td>
</tr>
<tr valign=top>
<td width=48%><a href="tsql03_412s.htm">CREATE PROCEDURE</a> </td>
<td width=52%><a href="tsql08_8dx0.htm">EXECUTE</a> </td>
</tr>
<tr valign=top>
<td width=48%><a href="tsql04_8rg4.htm">CREATE TRIGGER</a> </td>
<td width=52%></td>
</tr>
</table><br>
<p>
</p>
<p>&nbsp;</p></body>
</HTML>
