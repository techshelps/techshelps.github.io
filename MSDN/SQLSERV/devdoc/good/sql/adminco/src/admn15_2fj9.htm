<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Changing a Publisher's Distribution Database</title>
<link disabled rel=stylesheet href=../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_changing_a_publisher.92.s_distribution_database"></a>Changing a Publisher's Distribution Database</h2>
<p>
If necessary you can change the distribution database used by a publication server. The technique you use to change the distribution database depends on whether or not you need to retain existing publications: 
<ul>
<li>
If you do not need to retain existing publications, the procedure is simpler but requires you to completely reestablish replication, including re-creating all publications.</li>
<li>
If you need to retain existing publications, the procedure is slightly more complex, but does not require you to re-create publications.</li>
</ul>
<p>
Except where otherwise noted, the following steps assume the use of SQL Enterprise Manager. </p>
<h5><img src="../../../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To drop existing publications and change a publisher's distribution database</h5>
<ol>
<li>
Make a list of existing publications and subscriptions, so that they can later be re-created.<p>
Information on publications can be obtained using <b>sp_helppublication</b> and <b>sp_helparticle</b>. Information on subscriptions can be obtained using <b>sp_helpsubscription</b>.
</li>
<li>
Make a list of existing subscription servers so that they can later be re-created.<p>
Information on subscription servers can be obtained using <b>sp_helpserver </b>and <b>sp_helpsubscriberinfo</b>.
</li>
<li>
On the publication server, remove all published databases from the Publishing Databases list.<p>
With SQL Enterprise Manager, this list is accessed using the Replication Configuration/Publishing command from the Server menu. 
<p>
<b>Note</b>  Removing a published database from the Publishing Databases list drops all of its publications, and all subscriptions associated with each publication.
</li>
<li>
On the publication server, remove all subscription servers from the Enable Publishing to These Servers list.<p>
This list is also accessed using the Replication Configuration/Publishing command from the Server menu. 
</li>
<li>
On the publication server, run <b>sp_serveroption</b> to clear the distribution server setting. Type:<p>
<b>sp_serveroption</b> <i>servername, </i>'<b>dist', false</b>
<p>
If the publication server is configured as its own distributor, <i>servername</i> is the name of the local server. If the publication server is configured to use a remote distribution server, <i>servername</i> is the name of that remote distribution server.
</li>
<li>
Disconnect from and then reconnect to the publication server.<ul>
<li>
To disconnect, in the Server Manager window, click the right mouse button on the publication server, and then from the drop-down menu that appears, choose Disconnect. </li>
<li>
To reconnect, click on the "" box for the publication server.</li>
</ul>
</li>
<li>
If the publication server was configured as its own distributor, drop the distribution database. However, if the publication server was configured to use a remote distribution server, skip this step.</li>
<li>
Install or select a distribution database.<p>
Select the publication server; from the Server menu, choose Replication Configuration; choose Install Publishing; and complete the Install Replication Publishing dialog box that appears.
</li>
<li>
Continue with replication setup and completely configure replication. <ul>
<li>
On the publication server, set the server publication options. Re-select the publication databases. This automatically sets the status of the database to "published" and creates a log reader task for each published database.</li>
<li>
On the publication server, re-enable publishing to all subscription servers. For each subscriber, if it does not already exist, this adds a new entry in the <i>sysservers</i> table. The server status is set to "sub" (subscription server) and an associated entry for the server is placed in the <i>MSsubscriber_info</i> table of the distribution database. Finally, this creates a cleanup task for the server.</li>
<li>
On the publication server, re-create publications and articles.</li>
<li>
On the subscription servers, subscribe to the publications and articles. The first subscription for each destination database will create a distribution task.</li>
</ul>
</li>
</ol>
<p>
If you need to retain existing publications, the procedure is slightly different. You do not remove published databases from the Publishing Databases list, which allows you to retain the server's publications.</p>
<h5><img src="../../../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To retain existing publications and change a distribution database</h5>
<ol>
<li>
Make a list of existing publications and subscriptions.<p>
Information on publications can be obtained using <b>sp_helppublication</b> and <b>sp_helparticle</b>. Information on subscriptions can be obtained using <b>sp_helpsubscription</b>.
</li>
<li>
Make a list of existing subscription servers.<p>
Information on subscription servers can be obtained using <b>sp_helpserver </b>and <b>sp_helpsubscriberinfo</b>.
</li>
<li>
From all subscription servers of the publisher, drop all subscriptions to all publications of that publication server.</li>
<li>
On the publication server, remove all subscription servers from the Enable Publishing to These Servers list.<p>
With SQL Enterprise Manager, this list is accessed from the Replication Configuration/Publishing command from the Server menu. 
<p>
<b>Important</b>  Do not clear the check boxes for published databases in the Publishing Databases list. If you do so, all publications for those databases will be dropped. If that occurs, to reestablish replication you will need to re-create all publications.
</li>
<li>
On the publication server, run <b>sp_serveroption</b> to clear the distribution server setting. Type:<p>
<b>sp_serveroption</b> <i>servername, </i>'<b>dist', false</b>
<p>
If the publication server is configured as its own distributor, <i>servername</i> is the name of the local server. If the publication server is configured to use a remote distribution server, <i>servername</i> is the name of that remote distribution server.
</li>
<li>
Disconnect from and then reconnect to the publication server.<ul>
<li>
To disconnect, in the Server Manager window, click the right mouse button on the publication server, and then from the drop-down menu that appears, choose Disconnect. </li>
<li>
To reconnect, click on the "" box for the publication server.</li>
</ul>
</li>
<li>
If the publication server was configured as its own distributor, drop the distribution database. However, if the publication server was configured to use a remote distribution server, skip this step.</li>
<li>
Install or select a distribution database.<p>
Select the publication server; from the Server menu, choose Replication Configuration; choose Install Publishing; and complete the Install Replication Publishing dialog box that appears.
</li>
<li>
On the publication server, set the server publication options.<p>
In the Replication Publishing dialog box, add subscription servers to the Enable Publishing to These Servers list. For each subscriber, if it does not already exist, this adds a new entry in the <i>sysservers</i> table. The server status is set to "sub" (subscription server) and an associated entry for the server is placed in the <i>MSsubscriber_info</i> table of the distribution database. Finally, this creates a cleanup task for the server.
<p>
If this dialog box does not appear after you install or select a distribution database, open it by selecting the server and choosing Replication Configuration/Publishing from the Server menu.
</li>
<li>
On the distribution server, add a log reader task for each published database.<p>
To add a scheduled task, select the server from the Server Manager window; from the Tools menu, choose task scheduling; in the Task Scheduling dialog box, choose the New Task button; and complete the New Task dialog box that appears.
<p>
For information about creating replication tasks, see Chapter 16, <a href="admn16_5oab.htm">Scheduling Tasks</a>. 
</li>
<li>
On the subscription servers, resubscribe to the publications and articles.<p>
The first subscription for each destination database will create a distribution task.
</li>
</ol>
<p>
</p>
<p>&nbsp;</p></body>
</HTML>
