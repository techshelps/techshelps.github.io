<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Replication Cleanup</title>
<link disabled rel=stylesheet href=../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_replication_cleanup"></a>Replication Cleanup</h2>
<p>
When a replication is set up, a replication cleanup task is automatically created on the distribution server for each publisher/subscriber pairing. For example, if three publishers use one remote distributor, and if one subscriber subscribes to various publications from all three publishers, then there are three cleanup tasks on the distributor (one to support each publisher/subscriber pairing).</p>
<p>
Replication cleanup is an important task that helps replication to effectively function in a long-running environment. The replication cleanup task:
<ul>
<li>
Retains transactions for each subscribed database for a defined retention period after all subscription servers have received them.</li>
<li>
Deletes associated .TMP files for initial sync events when this transaction is removed.</li>
</ul>
<p>
There is a parameter associated with the cleanup task¾the retention period¾that determines the period of time that transactions will be guaranteed to be retained within the distribution database after they have been distributed to a destination database. The setting of the retention period, in conjunction with scheduling implemented for backup of a subscription server, can be used to ensure that the information required to automatically recover a destination database is always available within the distribution database. </p>
<p>
For example, if the subscription server POODLE has scheduled a transaction log dump of a destination database for once every 24 hours, you could set the retention period for POODLE's cleanup task to 48 hours. Then, even if POODLE experienced a catastrophic failure immediately before a scheduled backup, after restoring the server from the last available transaction log dump, all transactions necessary to automatically restore the replicated tables would still be available to the distribution process of the distribution server.</p>

<h5><a name="_setting_the_retention_period"></a>Setting the Retention Period</h5>
<p>
The first subscription established between a publisher/subscriber pair causes a replication cleanup task to be created on the distributor. This task is created using the existing setting for the retention period. Because of this, it is best to set the retention period before establishing any subscriptions for that publisher/subscriber pair.</p>
<h5><img src="../../../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To set the retention period for a subscription server before any subscriptions are established</h5>
<ol>
<li>
In the Server Manager window select the publication server, from the Server menu choose Replication Configuration, and from the drop-down menu that appears choose Publishing.</li>
<li>
In the Replication Publishing dialog box, select the subscription server, then select the Distribution Options button.<p>
The Distribution Options dialog box appears.
<p>
<img src="images/ad15_851.gif" border=0>
</li>
<li>
Enter a number (representing hours) in the Retention Period After Distribution box.</li>
<li>
Choose OK.</li>
</ol>
<p>
If the replication cleanup task already exists, you can (without dropping subscriptions) change the retention period by editing the cleanup task on the distributor.</p>
<h5><img src="../../../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To change the retention period for an existing cleanup task</h5>
<ol>
<li>
In the Server Manager window select the distribution server, and then from the Tools menu choose Task Scheduling.<p>
The Task Scheduling dialog box appears.
<p>
<img src="images/ad15_500.gif" border=0>
</li>
<li>
Select the cleanup task for the appropriate publisher/subscriber pair.<p>
For example AIREDALE_TERRIER_Cleanup.
</li>
<li>
Select the Edit Task button.<p>
The Task Editing dialog box appears.
<p>
<img src="images/ad15_501.gif" border=0>
</li>
<li>
In the command line, change the retention period setting.<p>
There are four parameters in the command line for the cleanup task:
<ul>
<li>
The cleanup stored procedure, <b>sp_replcleanup</b>.</li>
<li>
The publication server name (for example, TERRIER).</li>
<li>
The subscription server name (for example, AIREDALE).</li>
<li>
The retention period setting. The default is 0, which removes all distributed transactions whenever the cleanup task is run. </li>
</ul>
<p>
Enter a new retention period value. The number you enter represents hours. For example, type 48 to indicate a retention period of 48 hours.
</li>
<li>
Choose the Modify button.</li>
</ol>
<p>
</p>
<p>&nbsp;</p></body>
</HTML>
