<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Resetting the Suspect Status</title>
<link disabled rel=stylesheet href=../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_resetting_the_suspect_status"></a>Resetting the Suspect Status</h2>
<p>
The <b>sp_resetstatus</b> procedure shown below turns off the suspect flag on a database but leaves all other database options intact.</p>
<p>
<b>Caution</b>  Use <b>sp_resetstatus</b> only when directed by your primary support provider or this manual. Otherwise, you might damage your database.</p>
<p>
Because this procedure modifies the system tables, the system administrator must enable updates to the system tables before creating this procedure. To enable updates, use this procedure.</p>
<pre>use master
go
  
sp_configure 'allow updates',1
go
reconfigure with override
go
  </pre>
<p>
After the procedure is created, immediately disable updates to the system tables.</p>
<pre>sp_configure 'allow updates',0
go
  
reconfigure with override
go
  </pre>
<p>
The <b>sp_resetstatus</b> procedure can be executed only by the system administrator. Always shut down SQL Server immediately after executing this procedure.</p>
<h5>Syntax</h5>
<p>
<b>sp_resetstatus </b><i>database_name</i></p>
<h5>Example</h5>
<pre>sp_resetstatus PRODUCTION
  
Database 'PRODUCTION' status reset!
WARNING: You must reboot SQL Server prior to
         accessing this database!
  </pre>
<h5>Stored Procedure Code</h5>
<pre>CREATE PROC sp_resetstatus @dbname varchar(30) AS
DECLARE @msg varchar(80)
IF @@trancount &gt; 0
        BEGIN
            PRINT "Can't run sp_resetstatus from within a transaction."
            RETURN (1)
        END
IF suser_id() != 1
        BEGIN
            SELECT @msg =  "You must be the System Administrator (SA)"
            SELECT @msg = @msg + " to execute this procedure."
            RETURN (1)
        END
IF (SELECT COUNT(*) FROM master..sysdatabases
            WHERE name = @dbname) != 1
        BEGIN
            SELECT @msg = "Database '" + @dbname + "' does not exist!"
            PRINT @msg
            RETURN (1)
        END
IF (SELECT COUNT(*) FROM master..sysdatabases
            WHERE name = @dbname AND status &amp; 256 = 256) != 1
        BEGIN
            PRINT "sp_resetstatus can only be run on suspect databases."
            RETURN (1)
        END
BEGIN TRAN
        UPDATE master..sysdatabases SET status = status ^ 256
            WHERE name = @dbname
        IF @@error != 0 OR @@rowcount != 1
            ROLLBACK TRAN
        ELSE 
            BEGIN
                COMMIT TRAN
                SELECT @msg = "Database '" + @dbname + "' status reset!"
                PRINT @msg
                PRINT " " 
                PRINT "WARNING: You must reboot SQL&nbsp;Server prior to  "
                PRINT "         accessing this database!"
                PRINT " "
            END
  
go
  </pre>
<p>
</p>
<p>&nbsp;</p></body>
</HTML>
