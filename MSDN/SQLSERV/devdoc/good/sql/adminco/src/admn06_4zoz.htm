<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Expanding or Moving Transaction Logs</title>
<link disabled rel=stylesheet href=../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_expanding_or_moving_transaction_logs"></a>Expanding or Moving Transaction Logs</h1>
<p>
A <i>transaction log</i> is a storage area reserved by SQL Server to keep track of transactions made to a database. The transaction log is actually another system table, <i>syslogs</i>, but you should not directly query or modify it. </p>
<p>
To <i>expand</i> a transaction log is to allocate additional device space to the log. If a log becomes larger than the space you have allocated for it, you can expand it.</p>
<p>
You expand a transaction log using SQL Enterprise Manager or the ALTER DATABASE statement. This chapter describes the use of SQL Enterprise Manager. For information about using ALTER DATABASE and other statements, see the <i>Microsoft SQL Server Transact-SQL Reference</i>. </p>
<p>
If you need to expand the transaction log, you must expand it on a device separate from the one on which the database resides. If the transaction log has already been placed on a separate database device from the database, you can expand the amount of space allocated to the log on that device, or you can expand it on another device. The LOGSEGMENT, which stores the logs, is automatically mapped to the new fragment of space on the database device. All database devices available within SQL Server can be used to increase log space.</p>
<p>
If the log is not on a separate database device, you can increase the amount of space allocated to it by adding a new database device and then moving the transaction log to that database device (as described later in this topic).</p>
<h5><img src="../../../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To expand a transaction log</h5>
<ol>
<li>
From the Server Manager window, select a server, and then from the toolbar, choose the Manage Databases button.<p>
<img src="images/db01.gif" border=0>
<p>
The Manage Databases window appears.
</li>
<li>
Select a database from the names adjacent to the graph, and then choose the Edit Database button.<p>
<img src="images/db04.gif" border=0>
<p>
The Edit Database window appears.
<p>
<img src="images/ad06_602.gif" border=0>
</li>
<li>
Choose the Expand button.<p>
The Expand Database dialog box appears.
<p>
<img src="images/ad06_605.gif" border=0>
</li>
<li>
From the list in the Log Device box, select a device on which to place the transaction log. Or to create a new device for this transaction log, select <b>&lt;new&gt;</b> and complete the New Database Device dialog box that appears.<p>
Refer to the graph at the bottom of the dialog box for a display of the devices on the server and the available space on each.
</li>
<li>
In the Log Device Size box, type a size, in megabytes, to allocate to the log. <p>
If this is a device the log already has space on, enter the amount of additional space to allocate (not the total space). The default is the maximum space available on the selected device.
</li>
<li>
Choose OK.<p>
The Edit Database window returns.
</li>
<li>
Choose OK.</li>
</ol>
<p>
<b>Note</b>  After you expand a transaction log, back up the <i>master</i> database.</p>
<p>
To <i>move</i> a transaction log is to place it on a different device. If a transaction log was created on the same device as its database, then it must compete with data for space on the database device, and you can improve performance by moving it to another device. </p>
<p>
Use <b>sp_logdevice</b> to move a transaction log to another device. Because <b>sp_logdevice</b> affects only future allocations of space for the transaction log, the first pages of the log remain on the same device as the data, leaving them temporarily vulnerable. The transaction log remains on the original database device until the currently allocated extent (8 2KB pages) has been filled and the transaction log has been dumped. Only the database owner can move the log. You cannot move the <i>master</i> database's transaction log.</p>
<p>
The following steps show how to use <b>sp_logdevice</b> to move a transaction log.</p>
<h5><img src="../../../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To move the transaction log</h5>
<ul>
<li>
Type<p>
<b>sp_logdevice</b> <i>dbname</i>, <i>database_device</i>
<p>
where
<dl>
<dt>
<i>dbname</i></dt>
<dd>
Is the name of the database whose transaction log you want to move to a different device.</dd>
<dt>
<i>database_device</i></dt>
<dd>
Is the logical name of the database device you want to put the transaction log on. The transaction log must have been expanded onto this device using SQL Enterprise Manager or the ALTER DATABASE statement.
</dd>
</dl>
</li>
</ul>
<p>
The following steps illustrate moving the entire transaction log to a new device that will contain only the transaction log. </p>
<h5><img src="../../../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To move a transaction log</h5>
<ol>
<li>
Use SQL Enterprise Manager to expand the transaction log to a new device.</li>
<li>
Use <b>sp_logdevice</b> to move the transaction log to a new device.<p>
Note that <b>sp_logdevice </b>affects only future allocations of space for the log. The remaining steps in this procedure must be accomplished before the log moves.
</li>
<li>
Complete enough transactions to fill the extent of eight pages that the log is currently using. You can run DBCC CHECKTABLE on the <i>syslogs</i> table to determine when a new page is used. When the total of the pages has increased by eight, the log is on the new device.</li>
<li>
Ensure that enough time passes that all active transactions on the old database device have completed.</li>
<li>
Dump the transaction log (using either SQL Enterprise Manager or DUMP TRANSACTION), which removes from the log all pages written to disk. As long as there are no active transactions in the portion of the log on the old database device, all of the log pages on the old database device are removed.</li>
<li>
Run the <b>sp_helplog</b> system procedure to verify that the complete log is on the new log device.</li>
</ol>
<p>
<b>Note</b>  After you move a transaction log, back up the <i>master</i> database.</p>
<p>
For more information on <b>sp_logdevice</b>, DBCC CHECKTABLE, DUMP TRANSACTION, and <b>sp_helplog</b>, see the <i>Microsoft SQL Server Transact-SQL Reference</i>.</p>
<p>
When you expand a database, a new row is added to the <i>sysusages</i> table for each new portion of space allocated to the database. When a transaction log is expanded or moved, the <i>sysdatabases</i> and <i>sysusages</i> tables are updated to reflect the new location of the log.</p>
<p>
</p>
<p>&nbsp;</p></body>
</HTML>
