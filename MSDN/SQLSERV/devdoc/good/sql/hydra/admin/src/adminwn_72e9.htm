<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Administrator's Companion Errata</title>
<link disabled rel=stylesheet href=../../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_microsoft_sql_server_administrator.92.s_companion_errata"></a><i>Administrator's Companion</i> Errata</h1>
<p>
The following changes should be made to the <i>Microsoft SQL Server Administrator's Companion</i> for Microsoft SQL Server 6.0.
<ul>
<li>
In the SQL Server Books Online version of the <i>Microsoft SQL Server Administrator's Companion</i> for Microsoft SQL Server 6.5, illustrations have been updated to match the illustrations that are in the <i>Microsoft SQL Server Administrator's Companion</i> for Microsoft SQL Server 6.0.<p>
Also, in books online, the introduction to Part 6, "Replication," should reference Chapter 13, "Replication Concepts," Chapter 14, "Setting Up Replication," and Chapter 15, "Advanced Replication."
</li>
<li>
On Page 62, "Configuring Servers," the listed procedure works on Windows NT server machines, but does not work on Windows NT Workstation machines. However, to hide the server on a Windows NT Workstation machine, at the command prompt, type:<pre>net config server /hidden: yes
<b><i>  </i></b></pre>
</li>
<li>
On page 90, "NetWare Clients," in the note that begins "The instructions that follow..." the following sentence should be added: "The network number is in decimal."</li>
<li>
On page 218, "Object Permissions," the following changes should be made:<p>
In the table in the Statement column, "REFERENCE" should be "REFERENCES" and the associated object in the Object column should be "Table, columns." "DUMP TABLE" should be added to the Statement column, along with its associated object "Table."
<p>
Also, SELECT permission does not include REFERENCES permission.
</li>
<li>
On page 437, "Before You Set Up Replication," the following paragraph should be added to the subsection "Use One Character Set":<p>
If the character sets in use are not the same type (for example, 850 and 437), replicating extended characters between ANSI and OEM character sets is not possible unless you are using scheduled table refresh. When replicating extended characters using same-type character sets, both scheduled table refresh and log-based replication will work correctly.
</li>
<li>
On page 547, "To Set Up Replication Manually," step 6 for the <b>sp_addpublisher </b>stored procedure should read:<pre>sp_addpublisher 'WOLFHOUND', 'dist'
go
<b><i>  </i></b></pre>
</li>
<li>
On page 597, "Setting Alerts on Forwarded Events," the following paragraph should be added to the bulleted list at the top of the page:<p>
Each server that participates in event forwarding must have a non-null <i>@@servername</i> value. Without this value, the forwarding process may not work correctly under all situations and cyclical forwarding may go undetected. The <i>@@servername</i> value can be set by executing the command <b>'sp_addserver &lt;</b><i>servername</i><b>&gt;, local'</b> and then restarting SQL Server. For more information about using <b>sp_addserver</b>, see the <i>Microsoft SQL Server Transact-SQL Reference</i>.
</li>
<li>
On page 608, "Setting Up Mail," the following information should be added to step 5 at the bottom of the page: "When assigning a mail login name to the mail client, do not use a mail login that has a null password. A password is required to access a remote post office."</li>
<li>
On page 616, "Setting Up a Mail Post Office," in the paragraph that begins, "When setting up the shared network directory," in the second line RWCD should be changed to RW.</li>
<li>
On page 617, under "Using SQL Mail with a Netware Post Office," the first three paragraphs and step 1 should be replaced with the following:<p>
You can set up the SQL Server service (MSSQLServer) to run under a Windows NT user account. With appropriate permissions, SQL Server can run SQL Mail and access a NetWare Post Office.
<p>
However, the server's LocalSystem account has no user account information that can be used when accessing remote resources. If the SQL Server service (MSSQLServer) is configured to run under the server's LocalSystem account, it cannot directly access certain server software, including Novell® NetWare®.
<p>
When SQL Server is running under LocalSystem, it is possible to set up SQL Mail to work when the post office is on a Novell NetWare file server by going through the Gateway Services for NetWare, which is provided with Windows NT version 3.5 or later.
<p>
The following steps describe how to set up SQL Mail running under LocalSystem to work with a NetWare post office:
<ol>
<li>
Set up a gateway share on the Windows NT Server to point to the post office share on the NetWare machine. Supply a valid NetWare user account and password for an account that has RW access to the post office share. For information on how to set this up, see the Windows NT documentation on the Gateway Services for NetWare.</li>
</ol>
</li>
<li>
On pages 619 and 620, all information under the topic "Troubleshooting SQL Mail Problems" should be replaced with the following:<p>
You can use certain basic troubleshooting techniques to diagnose and resolve most SQL Mail problems. Typically, errors in starting a mail session or in sending mail fall into two categories:
<ul>
<li>
Permissions problems when accessing Shared File System (SFS) shares that are being used as a post office</li>
<li>
Registry setup problems</li>
</ul>
<p>
If you encounter SQL Mail problems, perform the following steps in the order they are presented: 
<ol>
<li>
Ensure that the user who set up SQL Mail can successfully start a mail session and send mail by using the Windows NT Mail client application, MSMAIL32.EXE.</li>
<li>
In SQL Server 6.0 or later, SQL Mail can run when the MSSQLServer service is assigned to the LocalSystem account, and also when it is assigned to another Windows NT user account. </li>
</ol>
<p>
<b>Note</b>  If you are running the Windows NT Mail client application on the same machine as SQL Server, you must run the MSSQLServer service in the LocalSystem account.
<p>
<b>Important</b>  A service that is running under the system account has no user account information associated with it. This will prevent certain network server software from allowing the Windows NT service to access resources. Microsoft LAN Manager user-level security servers and Novell® NetWare® servers will not allow a Windows NT service that is running under the system account to access their file shares. 
<p class=indent1>
In SQL Server 4.2<i>x</i>, the SQLServer service must be assigned the server's LocalSystem account. You can determine the assigned account by opening the Services application in Control Panel, selecting the SQLServer service, and choosing the Startup button. </p>
<ol start=3>
<li>
If SQL Server is running under a user account, proceed to step 6. If SQL Server is running under LocalSystem, proceed with step 4.</li>
<li>
When a mail session is started, mail uses information in the Windows NT Registry to determine startup information, such as the share name that is serving as a post office for the user that is logging in. This Registry information is configured for the current user. To make the information available to SQL Server, run SQL Server <b>setup</b>, select Set Server Options, choose the Mail Login button, and select the option Copy SQL Mail Configuration from Current User Account. <p>
This option creates the Registry key:
<pre>HKEY_USERS\.DEFAULT\Software\Microsoft\Mail
</pre>
<p>
This Registry key is used by SQL Mail. If this Registry key is not set up properly, confirm that it is possible to start a mail session by using the account with which you are currently logged into Windows NT. If so, rerun SQL Server <b>setup</b> with the option Copy SQL Mail Configuration from Current User Account selected. 
</li>
<li>
If the post office resides on a Windows NT server version 3.5<i>x</i>-based computer, add the post office share to the list of shares that can be accessed by services that are running under the system account. To add the post office share, use the Registry Editor file REGEDT32.EXE to add the share name to the following Registry value on the Windows NT computer where the post office is located: <pre>HKEY_LOCAL_MACHINE\System\CurrentControlSet
\Services\LanmanServer\Parameters\NullSessionShares
</pre>
<p>
For example, if the post office is running on a computer with the name "NTServer" and the post office directory is shared as "WGPO," the value "WGPO" must be added to the <b>NullSessionShares </b>value. 
<p>
Because the <b>NullSessionShares </b>value is of the type REG_MULTI_SZ, each share name must be on a separate line from other share names. 
<p>
For this Registry change to take effect, the post office computer must be re-booted. 
</li>
<li>
If SQL Server is running under a user account instead of the system account, confirm that step 1 was performed while the user was logged into Windows NT under the same user account that SQL Server is using. </li>
<li>
Confirm that the MSSQLServer service has Change access permissions or RW access permissions to the post office share. If SQL Server is running under the system account, the post office share must grant these rights to the <i>Everyone </i>group. <p>
Additionally, if the post office is located on an NTFS partition, <i>Everyone </i>must be granted the same rights as the share permissions on the post office directory, including all subdirectories and all existing files in the post office directory. 
<p>
To test SQL Server access permissions on the post office share, execute the <b>xp_cmdshell </b>extended stored procedure, which runs with the same permissions as SQL Mail. 
<p>
You can use the following commands to test read and write access to the server, assuming the post office is located on a computer named "NTServer" and the post office directory is shared as "WGPO": 
<pre>xp_cmdshell <b>'</b>dir \\NTServer\WGPO<b>'</b>

xp_cmdshell <b>'</b>echo 'hello' &gt; \\NTServer\WGPO\test.txt<b>'</b>
</pre>
<p>
If either of the above commands fails, step 5, 6, or 7 has not been completed correctly.
</li>
</ol>
<p>
<b>Note</b>  An access violation can result from an attempt to execute <b>xp_sendmail</b> when the post office and address book are on a file share that the MSSQLServer service cannot access. 
</li>
<li>
On page 743, in Chapter 24 "Additional Problem-Solving Techniques," in the topic "Moving a Device," the syntax diagram should be changed to:<p>
<b>sp_movedevice</b> <i>device_name</i><b>,</b><i>new_path</i>
<p>
The stored procedure for moving a device should be replaced with the following:
<pre>/****************************************************************/
PRINT ' '
PRINT 'Creating Stored Procedure: dbo.sp_movedevice'
PRINT 'Use this prior to moving the device or DB will be suspect'
/***************************************************************/
go
EXEC sp_configure 'allow updates', 1
RECONFIGURE WITH OVERRIDE
go
IF EXISTS (SELECT * FROM sysobjects WHERE
name = 'sp_movedevice' and type = 'P')
DROP PROCEDURE sp_movedevice
go
CREATE PROCEDURE sp_movedevice @devname varchar(30), 
  @newpath varchar (127)
AS
BEGIN
BEGIN TRAN
UPDATE sysdevices set phyname = @newpath
WHERE name = @devname
IF @rowcount &lt;&gt; 1
BEGIN
PRINT '**********************ERROR**********************'
PRINT 'Moved failed - more or less than one row affected'
PRINT '**********************ERROR**********************'
ROLLBACK TRAN
END
ELSE
BEGIN
PRINT 'Device moved successfully'
PRINT 'Change will take effect next time you start SQL Server'
COMMIT TRAN
END
END
go
sp_configure 'allow updates',0
RECONFIGURE WITH OVERRIDE
go
<b><i>  </i></b></pre>
</li>
</ul>
<p>&nbsp;</p></body>
</HTML>
