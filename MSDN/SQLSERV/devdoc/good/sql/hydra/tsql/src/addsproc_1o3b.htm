<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>sp_change_users_login</title>
<link disabled rel=stylesheet href=../../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_sp_change_users_login_whatsnew"></a>sp_change_users_login (version 6.5)</h2>
<p>
Reestablishes foreign key relationships from the <i>syslogins</i> to <i>sysusers</i> and <i>sysalternates</i> tables in cases where cross-server DUMP or LOAD database activity has broken these relationships. Without reestablishing relationships, orphan users may exist. </p>
<h4>Syntax</h4>
<p>
<b>sp_change_users_login</b> {<b>Auto_Fix </b>|<b> Report </b>|<b> Update_One</b>}<br>
[<b>,</b> <b>'</b><i>UserNamePattern</i><b>'</b> [<b>,</b> <b>'</b><i>LoginName</i><b>'</b>]]</p>
<p>
where 
<dl>
<dt>
<b>Auto_Fix | Report |</b> <b>Update_One</b> </dt>
<dd>
Specifies the action to take.
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=19%></th>
<th align=left width=81%></th>
</tr>
<tr valign=top>
<th align=left width=19%></th>
<th align=left width=81%></th>
</tr>
<tr valign=top>
<th align=left width=19%>Action</th>
<th align=left width=81%>Description</th>
</tr>
<tr valign=top>
<td width=19%><b>Auto_Fix</b></td>
<td width=81%>Links existing orphan usernames to logins of the same name. If an alternate username exists, each entry in the <i>sysusers</i> table is linked with an entry in the <i>syslogins</i> and <i>sysalternates</i> table. It is recommended that you monitor the outcome from the <b>Auto_Fix</b> statement. When linking rows, the <b>Auto_Fix </b>option makes assumptions that may be incorrect. </td>
</tr>
<tr valign=top>
<td width=19%><b>Report</b></td>
<td width=81%>Lists all usernames in <i>sysusers</i> that have no link to any login name in <i>syslogin</i>s. This is the default.</td>
</tr>
<tr valign=top>
<td width=19%><b>Update_One</b></td>
<td width=81%>Links a specified orphan username in <i>sysusers</i> to an existing login name in <i>syslogins</i>. An orphan username has an entry in the <i>sysusers</i> table that does not have a matching entry in the <i>syslogins</i> table.</td>
</tr>
</table><br>


<p>
<b>Important</b>  Avoid using <b>Auto_Fix</b> in security-sensitive situations. The procedure makes best estimates on links, which could allow a user more access privileges than intended.
</dd>
<dt>
<i>UserNamePattern</i></dt>
<dd>
Is one of the following patterns.
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=48%></th>
<th align=left width=52%></th>
</tr>
<tr valign=top>
<th align=left width=48%></th>
<th align=left width=52%></th>
</tr>
<tr valign=top>
<th align=left width=48%><i>UserNamePattern</i> must be:</th>
<th align=left width=52%>Action</th>
</tr>
<tr valign=top>
<td width=48%>Any non-NULL user-name pattern that is compatible with the LIKE operator.</td>
<td width=52%><b>Auto_Fix</b></td>
</tr>
<tr valign=top>
<td width=48%>NULL (the default).</td>
<td width=52%><b>Report</b></td>
</tr>
<tr valign=top>
<td width=48%>One username.</td>
<td width=52%><b>Update_One</b></td>
</tr>
</table><br>

</dd>
<dt>
<i>LoginName</i></dt>
<dd>
Is an existing login name. A login name is supported only when <b>Update_One</b> is specified. The default <i>LoginName</i> is NULL.
</dd>
</dl>
<h4>Remarks</h4>
<p>
It is suggested that you use this stored procedure after running the LOAD DATABASE statement because <b>sp_change_users_login</b> eliminates the need for manual updates for aliases or alternate usernames.</p>
<p>
This stored procedure corrects a potential violation of referential integrity between <i>syslogins</i> and <i>sysusers</i> after DUMP and/or LOAD DATABASE activity. If the LOAD DATABASE statement runs and entries in the <i>sysusers</i> table do not have matching entries in the <i>syslogins</i> table, the tables have missing links. Missing links can prevent some users from using the database.</p>
<p>
Missing links are created when login or user modifications occur between the DUMP and LOAD statements or if the dump and load are performed on different servers. For example, if a database is loaded from a database backup from six months ago that had only 100 users and the current version of the database has 130 users, the most recently added 30 users may not be able to access the database loaded from the backup. Reestablishing links by using <b>sp_change_users_login</b> can synchronize the entries in <i>syslogins</i> to the corresponding entries in <i>sysusers</i> and <i>sysalternates</i>, where aliases are used.</p>
<p>
This procedure can also relink entries in the <i>syslogins</i> table to entries in the <i>sysalternates</i> table by using the <b>Auto_Fix</b> option.</p>
<p>
Users such as <i>guest</i>, <i>public</i>, <i>sa</i>, <i>probe</i>, <i>repl_publisher</i>, <i>repl_subscriber</i>, and any group are not processed by this procedure. User logins that meet the conditions specified in <i>UserNameorPattern</i> (<b>Auto_Fix</b>) or <i>LoginName</i> (<b>Update_One</b>) will be processed with this procedure.</p>
<p>
If this procedure completes normally, 0 is returned. If this procedure raises an error, 1 is returned.</p>
<h4>Permission</h4>
<p>
Only the system administrator can run <b>Auto_Fix</b>. The <i>public</i> group can run <b>Report</b>. Only the system administrator or the database owner can run <b>Update_One</b>.</p>
<p>
</p>
<p>&nbsp;</p></body>
</HTML>
