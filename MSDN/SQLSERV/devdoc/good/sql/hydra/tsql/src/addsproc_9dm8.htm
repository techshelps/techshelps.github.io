<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>xp_snmp_raisetrap</title>
<link disabled rel=stylesheet href=../../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_xp_snmp_raisetrap"></a>xp_snmp_raisetrap (version 6.5)</h2>
<p>
Permits a client to define and send a trap (an SNMP alert) to an SNMP client. </p>
<h4>Syntax</h4>
<p>
<b>xp_snmp_raisetrap</b> <i>server</i><b>,</b> <i>database</i><b>,</b> <i>error_message</i><b>,</b> <i>message_id</i><b>,</b> <i>severity</i><b>,</b> <i>user</i><b>,</b> <i>comment</i><b>,</b> <i>date_and_time</i><b>,</b> <i>return_status </i>OUTPUT</p>
<p>
where&nbsp;&nbsp;&nbsp;&nbsp;
<dl>
<dt>
<i>server</i></dt>
<dd>
Is the name of the server where the trap (SNMP alert) originated. The <i>server </i>string can have a maximum of 30 characters and must have a <i>varchar</i> datatype.</dd>
<dt>
<i>database</i></dt>
<dd>
Is the name of a database where the trap originated. The <i>database</i> string can have a maximum of 30 characters and must have a <i>varchar</i> datatype.</dd>
<dt>
<i>error</i>_<i>message</i></dt>
<dd>
Is the message for the trap. The <i>error_message</i> string can have a maximum of 255 characters and must have a <i>varchar</i> datatype.</dd>
<dt>
<i>message_id</i></dt>
<dd>
Is the message error number for the trap. It corresponds to an error number in the <i>sysmessages</i> table, which is associated with the <i>error_message</i>. The <i>message_id</i> must have an <i>int</i> datatype.
<p>
For more information about <i>message_id</i>, see <a href="../../../tsqlref/src/tsql18_076t.htm"><b>sp_addmessage</b></a> in the <i>Microsoft SQL Server Transact-SQL Reference</i>.
</dd>
<dt>
<i>severity</i></dt>
<dd>
Is the severity of <i>message_id</i>.. The SNMP client views this value as the trap number. The <i>severity</i> must have an <i>int</i> datatype.
<p>
For more information on <i>severity</i>, see <a href="../../../tsqlref/src/tsql18_076t.htm"><b>sp_addmessage</b></a> in the <i>Microsoft SQL Server Transact-SQL Reference</i>.
</dd>
<dt>
<i>user</i></dt>
<dd>
Is the name of the user raising the trap. The <i>user</i> string can have a maximum of 30 characters and must have a <i>varchar</i> datatype.</dd>
<dt>
<i>comment</i></dt>
<dd>
Is additional text associated with the trap. The <i>comment</i> string often will include information that is important to interpreting the trap event. The <i>comment</i> string can have a maximum of 255 characters and must have a <i>varchar</i> datatype.</dd>
<dt>
<i>date_and_time</i></dt>
<dd>
Specifies the date and the time the trap occurred. The <i>date_and_time</i> column must have a <i>datetime</i> datatype.</dd>
<dt>
<i>return_status</i> OUTPUT</dt>
<dd>
Returns the completion status of the statement. This parameter must have an <i>int</i> datatype. These are the possible status values.
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=24%></th>
<th align=left width=76%></th>
</tr>
<tr valign=top>
<th align=left width=24%></th>
<th align=left width=76%></th>
</tr>
<tr valign=top>
<th align=left width=24%>Status</th>
<th align=left width=76%>Description</th>
</tr>
<tr valign=top>
<td width=24%>0</td>
<td width=76%>The SQL agent is running and the trap was sent successfully.</td>
</tr>
<tr valign=top>
<td width=24%>2</td>
<td width=76%>A memory error occurred.</td>
</tr>
<tr valign=top>
<td width=24%>3</td>
<td width=76%>The network has not been started.</td>
</tr>
<tr valign=top>
<td width=24%>4</td>
<td width=76%>The SQL SNMP agent has timed out while waiting for a response from the SNMP client.</td>
</tr>
<tr valign=top>
<td width=24%>5</td>
<td width=76%>The SQL SNMP agent is not running.</td>
</tr>
</table><br>

</dd>
</dl>
<h4>Remarks</h4>
<p>
This procedure provides communication about SQL Server conditions to SNMP management workstation(s). You can create your own error messages, message error numbers, and severity levels, although it is recommended that you use the error messages, message error numbers, and severity levels provided in the <i>sysmessages</i> or <i>sysservermessages</i> system tables. In the Network control panel, you can define which SNMP management workstations (clients) will receive traps under SNMP service. Clients are set up on a per SQL Server basis.</p>
<p>
Traps are usually administrative alerts about conditions or events within the SQL Server. Applications may also raise traps to notify SNMP clients of application specific conditions. For example, this procedure allows the system administrator to alert an SNMP workstation of an action that the system administrator needs to fix.</p>
<p>
For more information about SNMP, consult your Microsoft Windows NT operating-system documentation.</p>
<h4>Example</h4>
<p>
This example sends a trap to the SNMP management workstation.</p>
<pre>DECLARE @db varchar(30)
DECLARE @user varchar(30)
DECLARE @dt datetime
DECLARE @retval int
SELECT @dt = getdate()
SELECT @user = user_name()
SELECT @db = db_name()
EXECUTE xp_snmp_raisetrap @@servername, @db,
'The authors table was updated', 
50001, 10, @user, 'This trap could have been raised by  an update 
trigger on the authors table', @dt, @retval OUTPUT
SELECT Status = @retval
<b><i>  </i></b></pre>
<p>
</p>
<p>&nbsp;</p></body>
</HTML>
