<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Considerations for the Function Wizard</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD><BODY bgcolor="#FFFFFF" link=#003399 vlink=#996699><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
	<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<FORM NAME="x"><OBJECT CLASSID="clsid:9c2ac687-ceef-11cf-96d9-00a0c903b016" NAME="iv"></OBJECT></FORM>
<H2>Considerations for the Function Wizard</H2><P CLASS="t">The Function Wizard allows the user to construct an expression's arguments interactively. As a part of this process, the Function Wizard evaluates functions with the user's proposed arguments and displays the result. Each time an argument is entered the function is recalculated. For simple functions that quickly calculate a value this process does not cause a problem. Unfortunately, functions that access external data as a part of calculations, or functions that require a significant amount of time in order to calculate, don't work well, because the time&nbsp;required to calculate or retrieve external data is annoyingly long.</P>
<P></P>
<P></P>
<P></P>
<P CLASS="t">The Function Wizard cannot automatically determine which functions should not&nbsp;be calculated during expression construction. It is therefore up to each XLL function to refuse to calculate if it is called at an inappropriate time. Use the following code to determine if the function wizard window is showing.</P>

<pre><code><FONT FACE="Courier" SIZE="2">#define CLASS_NAME_BUFFER    50

typedef struct _EnumStruct {
    BOOL bFuncWiz;
    short hwndXLMain;
} EnumStruct, FAR * LPEnumStruct;

double WINAPI FuncWiz(double FAR * pdOne, double FAR * pdTwo)
{
    double dResult;
    
    if(IsCalledByFuncWiz())
        return 0;
    
    dResult = *pdOne * *pdTwo;
    return dResult; 
}

BOOL IsCalledByFuncWiz(void)
{
    XLOPER xHwndMain;
    EnumStruct    enm;

    if (Excel4(xlGetHwnd, &amp;xHwndMain, 0) == xlretSuccess) 
    {
        enm.bFuncWiz = FALSE;
        enm.hwndXLMain = xHwndMain.val.w;
        EnumWindows((WNDENUMPROC) EnumProc,
            (LPARAM) ((LPEnumStruct)  &amp;enm)); 
        return enm.bFuncWiz;
    }
    return FALSE;    //safe case: Return False if not sure
} 
</FONT></code></pre>
<P></P>
<P></P>
<P></P>

<pre><code><FONT FACE="Courier" SIZE="2">BOOL CALLBACK EnumProc(HWND hwnd, LPEnumStruct pEnum)
{
    // first check the class of the window.  Will be szXLDialogClass
    // if function wizard dialog is up in Excel
    char rgsz[CLASS_NAME_BUFFER];
    GetClassName(hwnd, (LPSTR)rgsz, CLASS_NAME_BUFFER);
    if (2 == CompareString(MAKELCID(MAKELANGID(LANG_ENGLISH,
        SUBLANG_ENGLISH_US),SORT_DEFAULT), NORM_IGNORECASE,
        (LPSTR)rgsz,  (lstrlen((LPSTR)rgsz)&gt;lstrlen("bosa_sdm_XL")) 
        ? lstrlen("bosa_sdm_XL"):-1, "bosa_sdm_XL", -1)) 
    {
        if(LOWORD((DWORD) GetParent(hwnd)) == pEnum-&gt;hwndXLMain) 
        {
            pEnum-&gt;bFuncWiz = TRUE;
            return FALSE;
        }
    }
    // no luck - continue the enumeration
    return TRUE;
}</FONT></code></pre>
<P CLASS="t"></P></FONT>
</FONT></BODY></HTML>
