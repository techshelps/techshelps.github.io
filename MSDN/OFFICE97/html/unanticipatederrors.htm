<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text-html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Unanticipated Errors</title>
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY BGCOLOR=#FFFFFF TEXT=#000000><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<h2><a name="unanticipatederrors"></a>Unanticipated Errors</h2>
<p>
When you are designing code to handle errors that may occur in a group of nested procedures, you need to examine calling procedures for errors by tracing the calls list backward. The calls list (sometimes called a procedure invocation path) is the sequence of calls that leads to the currently running procedure; it is displayed in the <b>Calls</b> dialog box.</p>
<p>
<b>See Also</b>&nbsp;&nbsp;&nbsp;For more information on the <b>Calls</b> dialog box, see Chapter 7, <a href="debuggingvisualbasiccode.htm">“Debugging Visual Basic Code.”</a></p>
<p>
Two different events can occur during the execution of your code that would cause Visual Basic to search back along the calls list for an enabled error handler:
<ul>
<li>
An error occurs in a procedure that doesn’t have enabled error-handling code.</li>
<li>
An error occurs within an active error handler.</li>
</ul>
<p>
As previously noted, an enabled error handler is one that is turned on by running an <b>On Error</b> statement and that hasn’t yet been turned off, either by an <b>On Error GoTo&nbsp;0</b> statement or by exiting the procedure in which it is enabled. An <i>active</i> error handler is one in which code execution is currently taking place. Suppose that the following is the calls list for a group of three nested procedures in your Visual Basic code:
<ol>
<li>
Procedure A is called from a form event.</li>
<li>
Procedure A calls Procedure B.</li>
<li>
Procedure B calls Procedure C.</li>
</ol>
<p>
If an error occurs in Procedure C and you haven’t enabled error-handling code within that procedure, then Visual Basic searches backward along the calls list first to Procedure B, then to Procedure A, and then to the initial event procedure if necessary. If you haven’t included appropriate error-handling code along the calls list to deal with the error, then Visual Basic displays an appropriate error message and halts execution.</p>
<p>
If Visual Basic encounters enabled error-handling code, but the error-handling code’s range of errors doesn’t include the one that has most recently occurred, an unanticipated error can occur within the current procedure. In such a case, the procedure could run endlessly, especially if your error-handling code runs a <b>Resume</b> statement.</p>
<p>
To prevent such situations, use the <b>Raise</b> method of the <b>Err</b> object in a <b>Case Else</b> clause. This generates an error within the error handler, forcing Visual Basic to search back farther along the calls list for error-handling code that can deal with the error. This strategy is illustrated in the VerifyFile function included earlier in this chapter.</p>
<p>
If Visual Basic finds enabled error-handling code, execution continues with that error-handling code. If the error-handling code includes a <b>Resume</b> or a <b>Resume Next</b> statement, execution continues as shown in the following table.</p>
<table>
<tr valign=top>
<TD>
<b><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">Statement</b></td>
<TD>
<b><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">Result</b></td>
</tr>
<tr valign=top>
<TD>
</td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
</tr>
<tr valign=top>
<TD>
<b><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">Resume</b> </td>
<TD>
Visual Basic runs the call to the next procedure in the calls list. Using the example calls list given earlier, if Procedure A has enabled error-handling code that includes a <b><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">Resume</b> statement, Visual Basic reruns the call to Procedure B.</td>
</tr>
<tr valign=top>
<TD>
<b><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">Resume Next</b></td>
<TD>
Execution returns to the statement following the last statement run in the current procedure. This is the statement after the call to the next procedure in the calls list. Using the example calls list given earlier, if Procedure A has enabled error-handling code that includes a <b><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">Resume Next</b> statement, execution returns to the statement in Procedure A after the call to Procedure B.</td>
</tr>
</table>
<p>
Important   Execution resumes in the procedure where the error-handling code is found, not necessarily in the procedure where the error occurred. If you don’t take this into account when you’re creating error-handling code and nesting procedures, your code may perform in ways you don’t intend, and the behavior of a search backward along the calls list can be hard to predict.</p>
</FONT></FONT></BODY>
</HTML>
