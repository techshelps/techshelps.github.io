<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Complex File Format</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<H2>COMPLEX FILE FORMAT</H1>There are some differences between the file format of a full saved document and that of a fast saved document.  In previous versions of Word, one of the differences was the necessity of the "complex" table information.  In Word '97 and later, the fcClx always indicates the location of the "complex" table information and it is always necessary to determine the location and contents of text and properties.  This arises due to unicode and unicode compression.</P>
</P>
fcClx is the fc where the complex part of the file begins, and cbClx is the size (in bytes) of the complex part. The complex part of the file contains a group of <B>grpprl</B>s that encode formatting changes made by the user and a piece table (<B>plcfpcd</B>). The piece table is needed because the text of the document is not stored contiguously in the file after a fast save.</P>
</P>
The complex part of a file (<B>CLX</B>) is composed of a number of variable-sized blocks of data. Recorded first are any <B>grpprls</B> that may be referenced by the <B>plcfpcd </B>(if the <B>plcfpcd </B>has no <B>grpprl</B> references, no <B>grpprls</B> will be recorded) followed by the <B>plcfpcd</B>. Each block in the complex part is prefaced by a <B>clxt</B> (<B>clx t</B>ype), which is a 1-byte code, either 1 (meaning the block contains a <B>grpprl</B>) or 2 (meaning this is the <B>plcfpcd</B>). A <B>clxtGrpprl (1)</B> is followed by a 2-byte cb which is the count of bytes of the <B>grpprl. A clxtPlcfpcd (2) is followed by a 4-byte lcb which is the count of bytes of</B> the piece table. A full saved file will have no clxtGrpprl's.  So the formats of the two types of blocks are:</P>
</P>
    clxt = 1    clxtGrpprl</P>
    cb    count of bytes in grpprl</P>
    grpprl    see "<B>Definitions</B>" for description of grpprl; a grpprl can contain sprms modifying character, paragraph, table, section or picture properties</P>
</P>
or</P>
</P>
    clxt = 2    clxtPlcfpcd</P>
    lcb    count of bytes in piece table</P>
    plcfpcd    piece table</P>
</P>
The entire CLX would look like this, depending on the number of grpprl's:</P>
</P>
    clxtGrpprl</P>
    cb</P>
    grpprl (0th grpprl)</P>
    clxtGrpprl</P>
    cb</P>
    grpprl (1st grpprl)</P>
    ...</P>
    clxtPlcfpcd</P>
    cb</P>
    plcfpcd</P>
</P>
When the <B>prm</B> in <B>pcd</B>s stored in the <B>plcfpcd</B>, contains an igrpprl (index to a grpprl), the index stored is the order in which that grpprl was stored in the <B>CLX</B>.</P></BODY></HTML>
