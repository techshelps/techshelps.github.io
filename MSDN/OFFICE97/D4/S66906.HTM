<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>piece table:</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<H2>piece table:</H2><P>The <B>piece table </B>is a data structure that describes the logical sequence of characters in a Word document and records recent changes to the formatting of a Word document. It is stored in a Word file as a <B>PLCF</B> named the <B>plcfpcd</B> (<B>PL</B>ex of <B>C</B>ps containing <B>P</B>ie<B>c</B>e <B>D</B>escriptors).The piece table relates a logical character number, called a <B>CP </B>(<B>C</B>haracter <B>P</B>osition), to a physical location within a Word file (an <B>FC</B>). The array of <B>CP</B>s in the <B>plcfpcd</B> defines a partitioning of the Word document into disjoint pieces. The second array is an array of <B>PCD</B>s (<B>P</B>ie<B>c</B>e <B>D</B>escriptors) which is in 1-to-1 correspondence to the array of <B>CP</B>s that records the physical location in the Word file where the corresponding piece begins. To find the physical location of a particular logical character in a<B> </B>Word document, take the <B>CP</B> coordinate of that character within the document and find the piece that contains that character. This is done by finding the index of the largest<B> CP </B>in the array of <B>CP</B>s that is less than the character <B>CP</B>. Then<B> </B>reference the <B>PCD</B> with that index in the array of <B>PCD</B>s. The <B>FC</B> stored in the <B>PCD </B>gives the position of the beginning of the piece in the file. Finally, add the offset of the desired character from the beginning of its piece to the <B>FC</B> of the beginning of the piece. This gives a "virtual" file offset of the character.  If the second most significant bit is clear, then this indicates the actual file offset of the unicode character (two bytes).  If the second most significant bit is set, then the actual address of the codepage-1252 compressed version of the unicode character (one byte), is actually at the offset indicated by clearing this bit and dividing by two.</P></BODY></HTML>
