<HTML>
<HEAD>

<meta http-equiv="Content-Type" content="text/html; charset=iso8859-1">

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>SQL Subqueries</TITLE><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">

<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

<FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE=2>
	<!--TOOLBAR_START-->
	<!--TOOLBAR_EXEMPT-->
	<!--TOOLBAR_END-->



<H1>SQL Subqueries</H1>Description</P>
A subquery is a <SPAN CLASS="jump">SELECT</SPAN> statement nested inside a SELECT, <SPAN CLASS="jump">SELECT...INTO</SPAN>, <SPAN CLASS="jump">INSERT...INTO</SPAN>, <SPAN CLASS="jump">DELETE</SPAN>, or <SPAN CLASS="jump">UPDATE</SPAN> statement or inside another subquery.</P>
Syntax</P>
You can use three forms of syntax to create a subquery:</P>
<SPAN CLASS="p">comparison</SPAN> [ANY | ALL | SOME] (<SPAN CLASS="p">sqlstatement</SPAN>)</P>
<SPAN CLASS="p">expression</SPAN> [NOT] IN (<SPAN CLASS="p">sqlstatement</SPAN>)</P>
[NOT] EXISTS (<SPAN CLASS="p">sqlstatement</SPAN>)</P>
A subquery has these parts:</P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="76pt" VALIGN="TOP"><COL WIDTH="284pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">Part</P></TD><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">Description</P></TD></TR><TR><TD  VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"></P></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><SPAN CLASS="p">comparison</SPAN></P></TD><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">An <SPAN CLASS="pop">expression</SPAN> and a comparison operator that compares the expression with the results of the subquery.</P></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><SPAN CLASS="p">expression</SPAN></P></TD><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">An expression for which the result set of the subquery is searched.</P></TD></TR><TR><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><SPAN CLASS="p">sqlstatement</SPAN></P></TD><TD VALIGN="TOP"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">A SELECT statement, following the same format and rules as any other SELECT statement. It must be enclosed in parentheses.</P></TD></TR></TBODY></TABLE>
<BR></P>Remarks</P>
You can use a subquery instead of an expression in the field list of a SELECT statement or in a <SPAN CLASS="jump">WHERE</SPAN> or <SPAN CLASS="jump">HAVING</SPAN> clause. In a subquery, you use a SELECT statement to provide a set of one or more specific values to evaluate in the WHERE or HAVING clause expression.</P>
Use the ANY or SOME predicate, which are synonymous, to retrieve records in the main query that satisfy the comparison with any records retrieved in the subquery. The following example returns all products whose unit price is greater than that of any product sold at a discount of 25&nbsp;percent or more:</P>

<pre><code>SELECT * FROM Products
WHERE UnitPrice &gt; ANY
(SELECT UnitPrice FROM OrderDetails
WHERE Discount &gt;= .25);</code></pre>
Use the <SPAN CLASS="jump">ALL</SPAN> predicate to retrieve only those records in the main query that satisfy the comparison with all records retrieved in the subquery. If you changed ANY to ALL in the previous example, the query would return only those products whose unit price is greater than that of all products sold at a discount of 25&nbsp;percent or more. This is much more restrictive.</P>
Use the IN predicate to retrieve only those records in the main query for which some record in the subquery contains an equal value. The following example returns all products with a discount of 25&nbsp;percent or more:</P>

<pre><code>SELECT * FROM Products
WHERE ProductID IN
(SELECT ProductID FROM OrderDetails
WHERE Discount &gt;= .25);</code></pre>
Conversely, you can use NOT IN to retrieve only those records in the main query for which no record in the subquery contains an equal value.</P>
Use the EXISTS predicate (with the optional NOT reserved word) in true/false comparisons to determine whether the subquery returns any records.</P>
You can also use table name <SPAN CLASS="pop">aliases</SPAN> in a subquery to refer to tables listed in a <SPAN CLASS="jump">FROM</SPAN> clause outside the subquery. The following example returns the names of employees whose salaries are equal to or greater than the average salary of all employees having the same job title. The Employees table is given the alias "T1":</P>

<pre><code>SELECT LastName,
FirstName, Title, Salary
FROM Employees AS T1
WHERE Salary &gt;=
(SELECT Avg(Salary)
FROM Employees
WHERE T1.Title = Employees.Title) Order by Title;</code></pre>
In the preceding example, the AS <SPAN CLASS="pop">reserved word</SPAN> is optional.</P>
Some subqueries are allowed in crosstab queries — specifically, as predicates (those in the WHERE clause). Subqueries as output (those in the SELECT list) are not allowed in crosstab queries.</P>
See Also</P>
ALL, DISTINCT, DISTINCTROW, TOP predicates, DELETE statement, HAVING clause, INNER JOIN operation, INSERT INTO statement, LEFT JOIN, RIGHT JOIN operations, SELECT statement, SELECT...INTO statement, UNION operation, UPDATE statement, WHERE clause.</P>
Example </P>
This example lists the name and contact of every customer who placed an order in the second quarter of 1995.</P>
This example calls the EnumFields procedure, which you can find in the SELECT statement example.</P>

<pre><code>Sub SubQueryX()

    Dim dbs As Database, rst As Recordset

    ' Modify this line to include the path to Northwind
    ' on your computer.
    Set dbs = OpenDatabase("Northwind.mdb")

    ' List the name and contact of every customer 
    ' who placed an order in the second quarter of
    ' 1995.
    Set rst = dbs.OpenRecordset("SELECT ContactName," _
        &amp; " CompanyName, ContactTitle, Phone" _
        &amp; " FROM Customers" _
        &amp; " WHERE CustomerID" _
        &amp; " IN (SELECT CustomerID FROM Orders" _
        &amp; " WHERE OrderDate Between #04/1/95#" _
        &amp; " And #07/1/95#);")

    ' Populate the Recordset.
    rst.MoveLast

    ' Call EnumFields to print the contents of the 
    ' Recordset. Pass the Recordset object and desired
    ' field width.
    EnumFields rst, 25

    dbs.Close

End Sub</code></pre>
Example (Microsoft Access)</P>
To try the following examples in Microsoft Access, first create a new query in the Northwind sample database. Close the <SPAN CLASS="eln">Show Table</SPAN> dialog box without specifying a table or query. Switch to SQL view, paste an individual example into the SQL window, and run the query.</P>
The following example shows all non-discounted orders whose total is higher than the average order value:</P>

<pre><code>SELECT OrderID, (UnitPrice * Quantity) As OrderTotal FROM [Order Details]
WHERE Discount = 0
AND (UnitPrice * Quantity) &gt; ALL(SELECT Avg(UnitPrice * Quantity)
FROM [Order Details]);</code></pre>
The next example lists the name and unit price of every product whose unit price is the same as that of Aniseed Syrup:</P>

<pre><code>SELECT ProductName, UnitPrice FROM Products
WHERE UnitPrice = (SELECT UnitPrice FROM [Products]
WHERE ProductName = 'Aniseed Syrup');</code></pre>
The following example lists the company and contact of every customer who placed an order in the second quarter of 1995:</P>

<pre><code>SELECT ContactName, CompanyName, ContactTitle, Phone FROM Customers
WHERE CustomerID IN (SELECT CustomerID FROM Orders WHERE OrderDate
BETWEEN #04/1/95# AND #06/30/95#);</code></pre>
The next example selects the name of every employee who has booked at least one order. This could also be done with an INNER&nbsp;JOIN.</P>

<pre><code>SELECT FirstName, LastName FROM Employees
WHERE EXISTS (SELECT OrderID FROM Orders
WHERE Orders.EmployeeID = Employees.EmployeeID);</code></pre>
<HR CLASS="rr"></FONT></BODY>
</HTML>
