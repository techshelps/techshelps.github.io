<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Maintaining a History of Clicked Records in the DataRepeater Control</title>
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY>

<h1><a name="vbconmaintaininghistoryofclickedrecordsindatarepeatercontrol"></a>Maintaining a History of Clicked Records in the DataRepeater Control</h1>
<p>
<object id=alink_1 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="Font" value=",,,,underline">
<PARAM name="Text" value="Text:See Also">
<PARAM name="Flags" value=",,1">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="vbconMaintainingHistoryOfClickedRecordsInDataRepeaterControl_C">
</object></p>
<p>
A common task while using the DataRepeater control is to maintain a history of viewed records. The history can be displayed in a ListBox control. Any time the user clicks on an item in the history, the DataRepeater control displays that record in its client area. As with other data-aware controls (such as the DataGrid control), you (the developer) must store and retrieve bookmarks for each record you wish to track.</p>
<p class=indent>
<B><b>Important</b></B>&nbsp;&nbsp;&nbsp;Bookmarks are valid only for the life of a recordset, and are not persistable or interchangeable across recordsets.</p>
<p>
The following step-by-step creates a history by first storing the bookmarks of viewed records in an array. A value associated with the record is also added to a ListBox control. When the user clicks an item in the ListBox control, the ListIndex of the clicked item is used to retrieve the bookmark of the record. Setting the VisibleRecords property to the bookmark causes the record to appear in the DataRepeater control.</p>
<p>
The step-by-step builds upon the project created in "Using the DataRepeater Control."</p>
<p class=label>
<b>To create a history of viewed records</b>
<ol>
<li>
Add a Reference to the <b>Microsoft ActiveX Data Objects 2.0 Library</b>. <p class=tl>
On the <b>Project</b> menu, click <b>References</b> to open the References dialog box. Check <b>Microsoft ActiveX Data Objects 2.0 Library</b>, and click <b>OK </b>to close the dialog box.</P></li>
<li>
In the Declarations section of the form's code module, declare an array of variants, and an object variable for the ADODB Recordset object. Use the ADODB recordset to navigate.<pre><code>Option Explicit
Private varBookmarks() As Variant
Private rsProducts As ADODB.Recordset</code></pre>
</li>
<li>
In the form's Load event, use the <b>ReDim </b>statement to initialize the array. Set the recordset object variable to the recordset of the ADO Data Control.<pre><code>Private Sub Form_Load()
ReDim varBookmarks(0)
Set rsProducts = adodc1.Recordset
End Sub</code></pre>
</li>
<li>
Draw a <b>ListBox </b>control on the form, and change its name from Listbox1 to <b>lstHistory</b>.<br><br></li>
<li>
Add the following code to the DataRepeater control's CurrentRecordChanged event:<pre><code>Private Sub DataRepeater1_CurrentRecordChanged()
' The CurrentRecordChanged event occurs immediately after the form 
' is opened. At that point, the UBound(varBookmarks) = 0, and no 
' records have been added. Thus you must add the first record to 
' the history list, and its bookmark to the array. Then increment 
' the array index to 1 and exit the sub. The next time a record is 
' clicked, this code will be ignored.
Dim iUpper As Integer ' Upper bound of bookmark array.
Dim i As Integer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' Counter for ListBox
If UBound(varBookmarks) = 0 Then
lstHistory.AddItem rsProducts!ProductName
varBookmarks(0) = DataRepeater1.CurrentRecord
ReDim Preserve varBookmarks(1)
Exit Sub
End If

' The code below now executes when the user clicks a record.
' First check the listbox to ensure the clicked record hasn't
' already been added to the history list. If so, exit.
For i = 0 To lstHistory.ListCount - 1
If lstHistory.List(i) = rsProducts!ProductName _
Then Exit Sub
Next I

' If no duplicates, then add the record to the history, and
' cache the bookmark in the array.
lstHistory.AddItem rsProducts!ProductName
varBookmarks(UBound(varBookmarks)) = DataRepeater1.CurrentRecord
' Increment the array.
ReDim Preserve varBookmarks(UBound(varBookmarks) + 1)
End Sub</code></pre>
</li>
<li>
The code below sets the <b>VisibleRecords </b>property to a cached bookmark. Paste the code into the form's code module.<pre><code>Private Sub lstHistory_Click()
Debug.Print lstHistory.Text, lstHistory.ListIndex
DataRepeater1.VisibleRecords(1) = _
varBookmarks(lstHistory.ListIndex)
End Sub</code></pre>
</li>
<li>
Run the project. Scroll through the recordset using the DataRepeater control's scrollbars. Click on any record to add it to the history. Click any item in the listbox to return to that record.</li>
</ol>
</BODY>
</HTML>
