<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>RegisterActiveObject</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_oa96_registeractiveobject"></a>RegisterActiveObject</h1>
<pre><code><b>HRESULT RegisterActiveObject( 
  IUnknown FAR* </b><i> punk</i><b>,             </b>
<b>  REFCLSID </b><i> rclsid</i><b>,                </b>
<b>  DWORD </b><i> dwFlags</i><b>,                  </b>
<b>  unsigned long FAR* </b><i> pdwRegister  </i>
<b>);</b>
 </code></pre>
<p>
Registers an object as the active object for its class.</p>
<h4>Parameters</h4>
<dl>
<dt>
<i>punk</i></dt>
<dd>
Pointer to the <b>IUnknown</b> interface of the active object.</dd>
<dt>
<i>rclsid</i></dt>
<dd>
Pointer to the CLSID of the active object.</dd>
<dt>
<i>dwFlags</i></dt>
<dd>
Flags controlling registration of the object. Possible values are ACTIVEOBJECT_STRONG and ACTIVEOBJECT_WEAK.</dd>
<dt>
<i>pdwRegister</i></dt>
<dd>
On return, a pointer to a handle. This handle must be passed to <a href="chap5_14xg.htm"><b>RevokeActiveObject</b></a> to end the object's active status.
</dd>
</dl>
<h4>Return Value</h4>
<p>
The return value obtained from the returned HRESULT is one of the following:</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=35%>Return value</th>
<th align=left width=65%>Meaning</th>
</tr>
<tr valign=top>
<td width=35%>S_OK</td>
<td width=65%>Success.</td>
</tr>
<tr valign=top>
<td width=35%>Other return codes</td>
<td width=65%>Failure.</td>
</tr>
</table><br>
<h4>Comments</h4>
<p>
The <b>RegisterActiveObject </b>function registers the object to which <i>punk </i>points as the active object for the class denoted by <i>rclsid. </i>Registration causes the object to be listed in the running object table (ROT) of OLE, a globally accessible lookup table that keeps track of objects that are currently running on the computer. (For more information about the running object table, see the <i>OLE Programmer's Reference</i>.) The <i>dwFlags</i> parameter specifies the strength or weakness of the registration, which affects the way the object is shut down.</p>
<p>
In general, ActiveX objects should behave in the following manner:
<ul>
<li>
If the object is visible, it should shut down only in response to an explicit user command (such as the <b>Exit</b> command on the <b>File</b> menu), or to the equivalent command from an ActiveX client (invoking the <b>Quit</b> or <b>Exit</b> method on the Application object).</li>
<li>
If the object is not visible, it should shut down only when the last external connection to it is gone.</li>
</ul>
<p>
Strong registration performs an <b>AddRef</b> on the object, incrementing the reference count of the object (and its associated stub) in the running object table. A strongly registered object must be explicitly revoked from the table with <a href="chap5_14xg.htm"><b>RevokeActiveObject</b></a>. The default is strong registration (ACTIVEOBJECT_STRONG).</p>
<p>
Weak registration keeps a pointer to the object in the running object table, but does not increment the reference count. Consequently, when the last external connection to a weakly registered object disappears, OLE releases the object's stub, and the object itself is no longer available.</p>
<p>
To ensure the desired behavior, consider not only the default actions of OLE, but also the following:
<ul>
<li>
Even though code can create an invisible object, the object may become visible at some later time. Once the object is visible, it should remain visible and active until it receives an explicit command to shut down. This can occur after references from the code disappear.</li>
<li>
Other ActiveX clients may be using the object. If so, the code should not force the object to shut down.</li>
</ul>
<p>
To avoid possible conflicts, you should always register ActiveX objects with ACTIVEOBJECT_WEAK, and call <b>CoLockObjectExternal, </b>when necessary,<b> </b>to guarantee the object remains active. <b>CoLockObjectExternal</b> adds a strong lock, thereby preventing the object's reference count from reaching zero. For detailed information about this function, refer to the <i>OLE Programmer's Reference</i>.</p>
<p>
Most commonly, objects need to call <b>CoLockObjectExternal</b> when they become visible, so they remain active until the user requests the object to shut down. The following procedure lists the steps your code should follow to shut down an object correctly.</p>
<h5>&nbsp;&nbsp;&nbsp;&nbsp;To shut down an active object:</h5>
<ol>
<li>
When the object becomes visible, make the following call to add a lock for the user:<pre><code>CoLockObjectExternal(punk, TRUE, TRUE)
</code></pre>
<p>
The lock remains in effect until a user explicitly requests the object to be shut down, such as with a <b>Quit</b> or <b>Exit</b> command.
</li>
<li>
When the user requests the object to be shut down, call <b>CoLockObjectExternal </b>again to free the lock, as follows:<pre><code>CoLockObjectExternal(punk, FALSE, TRUE)
</code></pre>
</li>
<li>
Call <a href="chap5_14xg.htm"><b>RevokeActiveObject</b></a><b> </b>to make the object inactive.</li>
<li>
To end all connections from remote processes, call <b>CoDisconnectObject</b> as follows:<pre><code>CoDisconnectObject(punk<i>, </i>0)
</code></pre>
<p>
This function is described in more detail in the <i>OLE Programmer's Reference</i>.
</li>
</ol>
<h4>QuickInfo</h4>
<p>
&nbsp;&nbsp;<b>Windows NT:</b>  Use version 3.1 and later. <br>
&nbsp;&nbsp;<b>Windows:</b> Use Windows 95 and later. <br>
&nbsp;&nbsp;<b>Header:</b> Declared in oleauto.h.<br>
&nbsp;&nbsp;<b>Import Library:</b> Link with oleaut32.lib.</p>
<p>&nbsp;</p></body>
</HTML>
