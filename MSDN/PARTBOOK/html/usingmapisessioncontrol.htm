<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text-html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Using the MAPISession Control</title>
</HEAD>
<BODY BGCOLOR=#FFFFFF TEXT=#000000>
<font face="verdana,arial,helvetica" size="2"><h1><a name="usingmapisessioncontrol"></a>Using the MAPISession Control</h1>
<p>
We begin by setting the MAPISession control&#39;s DownLoadMail property to True so that we will download mail when we establish a MAPI session:</p>
<pre><code>Private Sub email_Click()
&mdash;&gt; MAPISession1.DownLoadMail = True
        .
        .
        .
End Sub</code></pre>
<p>
The MAPISession control has only two methods: SignOn and SignOff. These are the methods you use to connect to the computer&#39;s email system and from there to the Internet. To check the user&#39;s email, we need only establish an email session with the MAPISession control. If the user&#39;s computer is not currently connected to the Internet, the email system automatically makes the connection. All we have to do is to establish an email session with our MAPISession1 control:</p>
<pre><code>Private Sub email_Click()
    MAPISession1.DownLoadMail = True
&mdash;&gt; MAPISession1.SignOn
        .
        .
        .
End Sub</code></pre>
<p>
At this point, the connection is made to the Internet (if necessary) and the user&#39;s email (if any) is downloaded into the Inbox. If you want to fetch the messages from the Inbox and display them, you can use the MAPIMessages control, as we&#39;ll see later.</p>
<p>
There is always the possibility of error when a user signs on to an ISP, so we check for errors using the Err keyword:</p>
<pre><code>Private Sub email_Click()
    MAPISession1.DownLoadMail = True
    MAPISession1.SignOn
&mdash;&gt; If Err &lt;&gt; 0 Then
&mdash;&gt;     MsgBox "Logon Failure: " + Error$
&mdash;&gt; End If
        .
        .
        .
End Sub</code></pre>
<p>
If there has been an error, we report that to the user and send the Visual Basic error message that we get from the Error$ function.</p>
<p>
Now that the email has been downloaded into the Inbox, we quit the MAPI session using the MAPISession control&#39;s SignOff method:</p>
<pre><code>Private Sub email_Click()
    MAPISession1.DownLoadMail = True
    MAPISession1.SignOn
    If Err &lt;&gt; 0 Then
        MsgBox "Logon Failure: " + Error$
    End If
&mdash;&gt; MAPISession1.SignOff
End Sub</code></pre>
<p>
It&#39;s as simple as that to check the user&#39;s email. It&#39;s also worth noting that although the MAPISession control has a UserName property and a Password property, the user usually sets them in the Internet Mail dialog box when setting up the email system, so it&#39;s not usually necessary to include them here. If the connection is refused, Microsoft Exchange will ask the user to enter the user name and password again in any case, and it stores that information.</p>
<p>
Now let&#39;s use the MAPIMessages control to send email.</p>
<h1></h1>
</font></BODY>
</HTML>
