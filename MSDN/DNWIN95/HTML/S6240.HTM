<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Configuring Shared Installations for Protected-Mode Clients</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD><BODY BGCOLOR="#FFFFFF">
<FONT FACE="verdana,arial,helvetica" size="2">
<h3>Configuring Shared Installations for Protected-Mode Clients</H3><P>For shared installations, Windows&nbsp;95 Setup adds the following basic kinds of entries in AUTOEXEC.BAT for computers that will run a shared copy of Windows&nbsp;95 and use basic Microsoft networking for the first connection to the server:</P>
<P><BR></P>
<pre><code>snapshot
net start <I>redir</I>
net use <I>drive</I>: \\<I>server</I>\<I>shared_source</I>
net use <I>drive</I>: \\<I>server</I>\<I>share</I>\<I>machine_dir</I>
setmdir</code></pre>
<P>If AUTOEXEC.BAT previously included <B>net start</B> or <B>net init</B> statements, Windows&nbsp;95 Setup adds the commands for a shared installation at the same location. If AUTOEXEC.BAT included command lines for MS-DOS – based utilities before the <B>net start</B> entry, you must place these after <B>net start</B> for an AUTOEXEC.BAT file to be used with Windows&nbsp;95. </P>
<P>For example, the earlier version of AUTOEXEC.BAT might contain these statements:</P>
<P><BR></P>
<pre><code>doskey
net start</code></pre>
<P>Windows 95 Setup would change this AUTOEXEC.BAT to contain these statements:</P>
<P><BR></P>
<pre><code><I>drive:</I>\<I>sharreddir</I>\doskey
net start basic
net logon /y</code></pre>
<P>You must then manually edit AUTOEXEC.BAT to move the <B>doskey</B> statement after the <B>net</B> statements.</P>
<P>The SNAPSHOT.EXE utility called in AUTOEXEC.BAT is a real-mode program that prepares for the transition to protected-mode networking. A protected-mode counterpart (SNAPSHOT.VXD, stored in the shared Windows SYSTEM directory) uses this information to load the protected-mode network client. The following list shows command-line parameters that Setup might add in AUTOEXEC.BAT.</P>
<P><B>Snapshot Parameters</B></P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="82pt" VALIGN="TOP"><COL WIDTH="265pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P><B>Parameter</B></P></TD><TD VALIGN="TOP"><P><B>Description</B></P></TD></TR><TR><TD VALIGN="TOP"><P><B>/B:</B><I>n</I></P></TD><TD VALIGN="TOP"><P>Sets <I>n</I> as the boot drive, where <I>n</I> is a drive letter A through Z. Usually this is set to <B>/b:c</B>.</P></TD></TR><TR><TD VALIGN="TOP"><P><B>/M:</B><I>n</I></P></TD><TD VALIGN="TOP"><P>Sets the amount of memory to reserve for the real-mode network, where <I>n</I> is a number in kilobytes. The default is 160K.</P></TD></TR><TR><TD VALIGN="TOP"><P><B>/S</B></P></TD><TD VALIGN="TOP"><P>Enables shutdown trapping, which causes Snapshot to intercept the Windows shutdown process and restart the workstation as soon as it is disconnected from the network. This parameter is used for floppy disk-based and remote-boot computers that use swap files on the network.</P></TD></TR><TR><TD VALIGN="TOP"><P><B>/R</B> </P></TD><TD VALIGN="TOP"><P>Indicates that this is a diskless workstation has no floppy disk drives. (On some remote-boot computers, the BIOS reports drives A and B when these drives don't exist; this parameter solves that problem.)</P></TD></TR><TR><TD VALIGN="TOP"><P><B>/V</B> </P></TD><TD VALIGN="TOP"><P>Sets verbose mode.</P></TD></TR></TBODY></TABLE>
<P><BR></P><P>The <B>net start</B> command includes either the <B>basic</B> or <B>nwredir</B> parameter to start real-mode Microsoft networking. For either parameter (and any type of network), the <B>net use </B>command is then used to connect to make the initial network connection. The user is prompted for a user name and password for this real-mode connection. Otherwise, you can modify AUTOEXEC.BAT to use a generic logon for this first connection. </P>
<P><B>Note</B>   If the computer uses more than one network client, the first client specified in the <B>clients=</B> entry in the setup script will be used to run Windows&nbsp;95. If the first client specified in <B>clients=</B> is a Windows&nbsp;95 protected-mode client, then that client is used with the <B>net start</B> command.</P>
<P>The <B>net use</B> entries in AUTOEXEC.BAT map drives for the shared Windows&nbsp;95 files and the machine directory for the computer. The <B>setmdir </B>command (that is, Set Machine Directory) searches for MACHINES.INI in the shared Windows&nbsp;95 directory to locate an entry that specifies the path to the machine directory that contains the full Registry for this computer. For more information, see "Technical Notes on MACHINES.INI and SETMDIR."</P>
<P>The startup disk for a shared installation contains all the software required to connect to the network and start Windows 95. One startup disk can be used for computers with the same kinds of network adapters and settings. The same configuration can be used to run a shared copy of Windows&nbsp;95 on remote-boot workstations with similar hardware configurations.</P>
<P>For computers that start from floppy disks, the contents of the startup disk fit on a 1.2 MB floppy disk. After Setup, you should make sure that the startup disk is write-protected. The software on the disk does not require writing information to the startup disk.</P>
<H4><A NAME="sec0"></A>Configuring a Computer that Starts from a Hard Disk</H4><P>If you want to run a shared copy of Windows&nbsp;95 on a computer that starts from its local hard disk, the setup script should contain the following entries:</P>
<P><BR></P>
<pre><code>[network]
WorkstationSetup=1
HDBoot=1</code></pre>
<P>In this case, if there is a hard disk present on the computer with sufficient space for the required files, Windows&nbsp;95 Setup creates the configuration required to start the computer from the Windows directory on the local hard disk and run a shared copy from the network.</P>
<P>Optionally, if the entry <B>DisplayWorkstationSetup=1</B> is specified in the setup script, the user can choose to create a local installation or a shared installation of Windows&nbsp;95. For a shared installation, the user must specify the path for the machine directory.</P>
<P>For a computer that starts from a hard disk and uses Client for Microsoft Networks, AUTOEXEC.BAT is set up as follows for a shared installation:</P>
<P><BR></P>
<pre><code>snapshot.exe 
net start basic
net logon /savepw:no /y
net use x: \\<I>server</I>\<I>share</I></code></pre>
<P>For computers running a NetWare-compatible client as the default network client, AUTOEXEC.BAT is as follows:</P>
<P><BR></P>
<pre><code>snapshot.exe 
net start nwredir 
net use <I>drive</I>: \\<I>server\directory</I></code></pre>
<P>The following shows an example of AUTOEXEC.BAT for a computer that starts from its local hard disk:</P>
<P><BR></P>
<pre><code>snapshot
c:\windows\net start nwredir
c:\windows\net use * /d
c:\windows\net use r: \\nwsvr\sys
path c:\windows;r:\sbsdist;r:\sbsdist\command
set tmp=c:\windows
set temp=c:\windows</code></pre>
<P></P>
<P>Setup creates a machine directory and copies the following files to the machine directory:</P>
<UL><LI>WIN.COM</LI><LI>All initialization files, including WIN.INI and SYSTEM.INI</LI><LI>USER.DAT 
<P>Notice that the USER.DAT portion of the Registry must be in the machine directory for user profiles to work. During network logon, Windows&nbsp;95 copies the correct USER.DAT to use if user profiles are enabled.</P>

<P>Setup places SYSTEM.DAT on the local hard disk.</P></LI></UL><P>Because all Windows&nbsp;95 source files are on the server, Setup does not need to copy Windows&nbsp;95 locally as it does for installation on a local hard disk. The File Copy step in Setup should only copy about 2&nbsp;MB of files.</P>
<P>For shared installations on computers with hard disks, Setup modifies the Windows&nbsp;95 startup disk by changing the boot sector and copying new IO.SYS, COMMAND.COM, and MSDOS.SYS files. The files in the following list are copied to the startup disk.</P>
<P><B>Files on Startup Disk for Shared Installations on Hard-Disk Computers </B></P>

<TABLE COLS="3" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="105pt" VALIGN="TOP"><COL WIDTH="121pt" VALIGN="TOP"><COL WIDTH="121pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>autoexec.bat<BR>command.com<BR>config.sys<BR>himem.sys<BR>ifshlp.sys<BR>io.sys</P></TD><TD VALIGN="TOP"><P>msdos.sys<BR>ndishlp.sys<BR>net.exe<BR>net.msg<BR>neth.msg<BR>protman.dos</P></TD><TD VALIGN="TOP"><P>protman.exe<BR>protocol.ini<BR>snapshot.exe<BR>system.dat<BR>NDIS 2 adapter driver</P></TD></TR></TBODY></TABLE>
<P><BR></P><P>For a client computer that contains a hard disk, the swap file and TEMP directory are stored on the local hard disk. To change the location for the swap file in this configuration, add a <B>pagingfile=</B><I>path</I> entry in the [386Enh] section of the SYSTEM.INI file that is stored in the machine directory.</P>
<H4><A NAME="sec1"></A>Configuring a Computer that Starts from a Floppy Disk</H4><P>If you want to run a shared copy of Windows&nbsp;95 on a computer that starts from a floppy disk, the setup script should contain the following entries:</P>
<P><BR></P>
<pre><code>[network]
WorkstationSetup=1
HDBoot=0
RPLSetup=0</code></pre>
<P>Windows&nbsp;95 Setup creates the configuration required to start the computer from a floppy-based startup disk and run a shared copy from the network. Setup also creates this configuration if <B>HDBoot=1</B> is specified but there is no hard disk present or there is insufficient space on the hard disk to install the required files.</P>
<P><B>Note</B>   You must add an entry for the client computer in MACHINES.INI before that computer can start Windows&nbsp;95.</P>
<P>For shared installations on floppy disk-based computers, Setup creates a mini Registry in a machine directory on the startup floppy disk. This reduced version of the computer's SYSTEM.DAT file contains only the information needed by IO.SYS and the real-mode network that makes the initial connection to the server. After connecting to the machine directory on the network, Windows&nbsp;95 uses the full Registry stored there. </P>
<P>The swap file and TEMP directory are also stored in the machine directory for a client computer that starts from a floppy disk. To change the location for the swap file in this configuration, add a <B>pagingfile=</B><I>path</I> entry in the [386Enh] section of the SYSTEM.INI file that is stored in the machine directory.</P>
<P>The following shows an example of AUTOEXEC.BAT for a computer that starts from a floppy disk to run Windows&nbsp;95 from a NetWare server:</P>
<P><BR></P>
<pre><code>snapshot
net start nwredir
net use * /d
net use r: \\<I>server</I>\<I>share</I>
setmdir
path=sbsdist;r:\sbsdist\command</code></pre>
<P></P>
<P><B>Note</B>   Do not include the machine directory in the path. The <B>setmdir</B> command manages this requirement automatically.</P>
<P>Windows&nbsp;95 Setup creates the startup floppy disk by modifying the boot sector and copying IO.SYS. After Setup, make sure that the startup disk for this configuration is write-protected. The following table lists the files on the startup disk for this configuration.</P>
<P><B>Files on the Startup Disk for a Shared Installation on a Floppy-Disk Computer </B></P>

<TABLE COLS="3" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="105pt" VALIGN="TOP"><COL WIDTH="121pt" VALIGN="TOP"><COL WIDTH="121pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>autoexec.bat<BR>config.sys<BR>command.com<BR>himem.sys<BR>ifshlp.sys<BR>io.sys</P></TD><TD VALIGN="TOP"><P>msdos.sys <BR>ndishlp.sys<BR>net.exe<BR>net.msg<BR>neth.msg<BR>protman.dos</P></TD><TD VALIGN="TOP"><P>protman.exe<BR>protocol.ini<BR>snapshot.exe<BR>system.dat (mini version)<BR>NDIS 2 adapter driver</P></TD></TR></TBODY></TABLE>
<P><BR></P><H4><A NAME="sec2"></A>Configuring a Remote-Boot Workstation for Client for NetWare Networks</H4><P>Windows&nbsp;95 can be installed on remote-boot workstations that start from Novell NetWare 3.x and 4.x servers. Remote-boot workstations contain a Remote Boot PROM that queries the network for instructions. Before installing Windows&nbsp;95 to run on a remote-boot workstation, you should first make sure that the workstation successfully starts and runs with ODI drivers over RIPL. </P>
<P>If you want to run a shared copy of Windows&nbsp;95 on a remote-boot workstation, the setup script should contain the following entries:</P>
<P><BR></P>
<pre><code>[network]
WorkstationSetup=1
HDBoot=0
RPLSetup=1</code></pre>
<P>Windows&nbsp;95 Setup creates the configuration required for starting and running a shared copy wholly from the network. Setup also creates this configuration on computers with NetWare-compatible clients if <B>HDBoot=1</B> is specified but there is no hard disk or floppy drive present or there is insufficient space on the hard disk to install the required files.</P>
<P>At system startup for a remote-boot workstation that will run Microsoft Client for NetWare Networks, the network provides instructions to create a RAM drive and then copies a disk image from the server to the workstation's RAM drive. Then the workstation continues booting from the RAM drive. The RAM drive is removed from memory after the operating system switches to protected mode. Windows&nbsp;95 Setup creates the disk image that is copied from the server to the workstation's RAM drive. For information about customizing boot images, see "Creating the Disk Image for RIPL" later in this chapter.</P>
<P>To accomplish these actions for remote-boot workstations, Setup adds the following line to the workstation's CONFIG.SYS to create the RAM drive:</P>
<P><BR></P>
<pre><code>device=a:\ramdrive.sys 1440</code></pre>
<P>The following lines are added to AUTOEXEC.BAT:</P>
<P></P>
<P><BR></P>
<pre><code>@mkdir <I>ramdrv</I>:\
@copy a:\ <I>ramdrv</I>:\</code></pre>
<P>When you run Windows&nbsp;95 Setup on a remote-boot workstation, a mini Registry is created and copied to the RAM drive. Windows&nbsp;95 Setup also copies other supporting startup files to the RAM drive. When Setup is finished, it creates a file containing a disk image of the workstation's RAM drive on the server. The startup disk image contains a reduced version of the computer's SYSTEM.DAT file, which contains the Registry information needed by IO.SYS and the real-mode network. After connecting to the workstation's machine directory, Windows&nbsp;95 uses the full Registry stored there. </P>
<P>The following shows an example of AUTOEXEC.BAT created for a remote-boot workstation:</P>
<P><BR></P>
<pre><code>@copy a:\ c:\
c:</code></pre>
<P>The following shows an example of WIN.BAT, which runs automatically after AUTOEXEC.BAT is run:</P>
<P><BR></P>
<pre><code>set comspec=c:\command.com
nwrpltrm
snapshot /R /S /B:C
net start nwredir
net use * /d
net use N: \\nwserverbasedsetup\sbsdist
path=n:\netsetup\rpl;n:\netsetup\rpl\command
setmdir
win.com</code></pre>
<P>The machine directory is created on the server. Windows&nbsp;95 Setup copies the files listed in the following table.</P>
<P><B>Startup Files for Remote-Boot Installations</B></P>

<TABLE COLS="3" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="105pt" VALIGN="TOP"><COL WIDTH="121pt" VALIGN="TOP"><COL WIDTH="121pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>autoexec.bat<BR>bootdrv.com<BR>config.sys<BR>command.com<BR>himem.sys<BR>ifshlp.sys<BR>io.sys</P></TD><TD VALIGN="TOP"><P>msdos.sys <BR>ndishlp.sys<BR>net.exe<BR>net.msg<BR>neth.msg<BR>nwrpltrm.com1<BR>protman.dos</P></TD><TD VALIGN="TOP"><P>protman.exe<BR>protocol.ini<BR>ramdrive.sys<BR>rplboot.sys2<BR>snapshot.exe<BR>system.dat<BR>NDIS 2 adapter driver</P></TD></TR></TBODY></TABLE>
<P><BR></P><P>1   This file runs during system startup to terminate the connection to the disk image.</P>
<P>2   Users looking at the boot image cannot see this file.   </P>
<P>For remote-boot workstations, the network adapter is considered the boot device, and the real-mode operating system files are stored with the disk image in the machine directory. The swap file and TEMP directory are also stored in the machine directory. To change the location for the swap file in this configuration, add a <B>pagingfile=</B><I>path</I> entry in the [386Enh] section of the SYSTEM.INI file that is stored in the machine directory.</P></FONT></BODY></HTML>
