<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>DOWNLOAD.CPP</title>
<link disabled rel=stylesheet href=../../../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>
<h2><a name="_code_context3961"></a>DOWNLOAD.CPP</h2>
<pre><code>// =========================================================================== <br>// File: DOWNLOAD.Cpp <br>// Defines the class behaviour for CBindStatusCallback.  <br> <br> <br>#include "stdafx.h" <br>#include "Mainfrm.h" <br>#include "download.h" <br>#include "winnls.h" <br>// #include "Util.H" <br> <br>// =========================================================================== <br>//                     CBindStatusCallback Implementation <br>// =========================================================================== <br> <br>// --------------------------------------------------------------------------- <br>// %%Function: CBindStatusCallback::CBindStatusCallback <br>// --------------------------------------------------------------------------- <br>CBindStatusCallback::CBindStatusCallback(CMainFrame * pMDIframewnd) <br>{ <br>    m_pbinding = NULL; <br>    m_pstm = NULL; <br>    m_cRef = 1; <br>    m_cbOld = 0; <br>m_pMDIframwnd=pMDIframewnd; <br>}  // CBindStatusCallback <br> <br>// --------------------------------------------------------------------------- <br>// %%Function: CBindStatusCallback::~CBindStatusCallback <br>// --------------------------------------------------------------------------- <br>CBindStatusCallback::~CBindStatusCallback() <br>{ <br>    if (m_pstm) <br>        m_pstm-&gt;Release(); <br>    if (m_pbinding) <br>        m_pbinding-&gt;Release(); <br>}  // ~CBindStatusCallback <br> <br> <br>// --------------------------------------------------------------------------- <br>// %%Function: CBindStatusCallback::QueryInterface <br>// --------------------------------------------------------------------------- <br> STDMETHODIMP <br>CBindStatusCallback::QueryInterface(REFIID riid, void** ppv) <br>{  <br>    *ppv = NULL; <br>     <br>    if (riid==IID_IUnknown || riid==IID_IBindStatusCallback) <br>        { <br>        *ppv = this; <br>        AddRef(); <br>        return S_OK; <br>        } <br>    return E_NOINTERFACE; <br>}  // CBindStatusCallback::QueryInterface <br> <br>// --------------------------------------------------------------------------- <br>// %%Function: CBindStatusCallback::OnStartBinding <br>// --------------------------------------------------------------------------- <br> STDMETHODIMP <br>CBindStatusCallback::OnStartBinding(DWORD grfBSCOption, IBinding* pbinding) <br>{ <br>m_pMDIframwnd-&gt;MyShowPane("Starting to Download File "); <br>return(NOERROR); <br>}  // CBindStatusCallback::OnStartBinding <br> <br>// --------------------------------------------------------------------------- <br>// %%Function: CBindStatusCallback::GetPriority <br>// --------------------------------------------------------------------------- <br> STDMETHODIMP <br>CBindStatusCallback::GetPriority(LONG* pnPriority)  <br>{ <br> return(NOERROR); <br>}  // CBindStatusCallback::GetPriority <br> <br>// --------------------------------------------------------------------------- <br>// %%Function: CBindStatusCallback::OnLowResource <br>// --------------------------------------------------------------------------- <br> STDMETHODIMP <br>CBindStatusCallback::OnLowResource(DWORD dwReserved) <br>{ <br>  return(NOERROR); <br>}  // CBindStatusCallback::OnLowResource <br> <br>// --------------------------------------------------------------------------- <br>// %%Function: CBindStatusCallback::OnStopBinding <br>// --------------------------------------------------------------------------- <br> STDMETHODIMP <br>CBindStatusCallback::OnStopBinding(HRESULT hrStatus, LPCWSTR pszError)  <br>{ <br>if (hrStatus) <br>m_pMDIframwnd-&gt;MyShowPane("File download Failed."); <br>else <br>m_pMDIframwnd-&gt;MyShowPane("File Downloaded"); <br>return(NOERROR); <br>}  // CBindStatusCallback::OnStopBinding <br> <br>// --------------------------------------------------------------------------- <br>// %%Function: CBindStatusCallback::GetBindInfo <br>// --------------------------------------------------------------------------- <br> STDMETHODIMP <br>CBindStatusCallback::GetBindInfo(DWORD* pgrfBINDF, BINDINFO* pbindInfo) <br>{ <br> return (NOERROR); <br>}  // CBindStatusCallback::GetBindInfo <br> <br>// --------------------------------------------------------------------------- <br>// %%Function: CBindStatusCallback::OnDataAvailable <br>// This function is called whenever data starts arriving. When the file download is <br>// complete then the BSCF_LASTDATANOTIFICATION comes and you can get the local cached <br>// File Name. <br>// --------------------------------------------------------------------------- <br> STDMETHODIMP <br> CBindStatusCallback::OnDataAvailable <br> ( <br> DWORD grfBSCF,  <br> DWORD dwSize,  <br> FORMATETC* pfmtetc,  <br> STGMEDIUM* pstgmed <br> )  <br> { <br>  return(NOERROR); <br> }  // CBindStatusCallback::OnDataAvailable <br> <br> <br>// --------------------------------------------------------------------------- <br>// %%Function: CBindStatusCallback::OnObjectAvailable <br>// --------------------------------------------------------------------------- <br> STDMETHODIMP <br>CBindStatusCallback::OnObjectAvailable(REFIID riid, IUnknown* punk)  <br>{ <br> return(NOERROR); <br>}  // CBindStatusCallback::OnObjectAvailable <br> <br>// --------------------------------------------------------------------------- <br>// %%Function: CBindStatusCallback::OnProgress <br>// --------------------------------------------------------------------------- <br>STDMETHODIMP  <br>CBindStatusCallback::OnProgress <br>(  <br>     ULONG ulProgress, <br>     ULONG ulProgressMax, <br>     ULONG ulStatusCode, <br>     LPCWSTR pwzStatusText <br>)  <br>{ <br>    char    msg[100]; <br>    wsprintf(msg,"Downloaded : %d bytes of %d ", ulProgress, (ulProgress&gt;ulProgressMax)?ulProgress:ulProgressMax); <br>m_pMDIframwnd-&gt;MyShowPane(msg); <br> <br> return(NOERROR); <br>}// CBindStatusCallback::OnProgress </code></pre>
<p>&nbsp;</p></body>
</HTML>
