<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>CacheSize and CacheStart Properties Example (Client/Server) (VC++)</title>
<link disabled rel=stylesheet href=msdn_ie3.css>
<style type="text/css">
@import url(msdn_ie4.css);
</style>
</HEAD>
<BODY>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

	<!--TOOLBAR_START-->
	<!--TOOLBAR_EXEMPT-->
	<!--TOOLBAR_END-->


<h1><a name="daprocachesizex"></a>CacheSize and CacheStart Properties Example (Client/Server) (VC++)</h1>
<p>
This example moves through all records in a <b>Recordset</b> twice; once with no cache and once with a 50 record cache. The example then displays the performance statistics for the uncached and cached runs through the <b>Recordset</b>.</p>
<pre><code>/*
CacheStart/CacheSize Properties:
This example moves through all records in a Recordset twice; once with no cache and once with a 50 
record cache.&nbsp; The example then displays the performance statistics for the uncached and cached runs 
through the Recordset.
*/

#include      &lt;stdio.h&gt;
#include      &lt;time.h&gt;
#include      &lt;afxole.h&gt;
#include      &lt;dbdao.h&gt;
#include      &lt;dbdaoerr.h&gt;

CdbDBEngine      dben;
CdbDatabase       dbsPubs;
CdbWorkspace    wspDefault;
CdbTableDef       tdfPerformanceTest;
CdbRecordset      rstRemote;
CString         strNoCache, strCache;
time_t            tmStart, tmNoCache, tmCache;
COleVariant      vVal;
LPTSTR            szPurpose = 
                  _T("This example moves through ")
                  _T("all records in the Recordset ")
                  _T("twice;\n")
                  _T("once with no cache and ")
                  _T("once with a 50 record cache."),
               szAnnounce = _T(
                  "Caching Performance Results:\n"),
               szAnnounceNoCache = _T(
                  "Time without caching: %ld\n"),
               szAnnounceCache = _T(
                  "Time with 50 record cache: %ld\n");

wspDefault = dben.Workspaces[0L];
dbsPubs = wspDefault.OpenDatabase(_T("PUBLISH.mdb"));
tdfPerformanceTest =    dbsPubs.CreateTableDef(_T("TestData"));
tdfPerformanceTest.SetConnect(
  _T("ODBC;DATABASE=pubs;UID=sa;PWD=;DSN=Publishers"));
tdfPerformanceTest.SetSourceTableName(
  _T("dbo.roysched"));
dbsPubs.TableDefs.Append(tdfPerformanceTest);
rstRemote = dbsPubs.OpenRecordset(_T("TestData"));

// Announce purpose of this test.
printf(szPurpose);

// Start uncached run.
tmStart = time(NULL);
for (int x = 0; x &lt; 2; x++)
{
rstRemote.MoveFirst();
while (!rstRemote.EOF())
   {
   vVal = rstRemote.GetField(0L);
   rstRemote.MoveNext();
   }
}
tmNoCache = time(NULL) - tmStart;

// Start cached run.
rstRemote.SetCacheSize(50);
tmStart = time(NULL);
for (int x = 0; x &lt; 2; x++)
{
rstRemote.MoveFirst();
rstRemote.SetCacheStart(rstRemote.GetBookmark());
rstRemote.FillCache();
while (!rstRemote.EOF())
   {
   vVal = rstRemote.GetField(0L);
   rstRemote.MoveNext();
   }
}
tmCache = time(NULL) - tmStart;

// Display performance results.
printf(szAnnounce);
printf(szAnnounceNoCache, (long)tmNoCache);
printf(szAnnounceCache, (long)tmCache);

rstRemote.Close();
dbsPubs.Close();
</code></pre>
</font></BODY>
</HTML>
