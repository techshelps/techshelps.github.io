<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>BeginTrans, CommitTrans, Rollback Methods (DAO)</title>
<link disabled rel=stylesheet href=msdn_ie3.css>
<style type="text/css">
@import url(msdn_ie4.css);
</style>
</HEAD>
<BODY>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

	<!--TOOLBAR_START-->
	<!--TOOLBAR_EXEMPT-->
	<!--TOOLBAR_END-->


<h1><a name="dvmthbegintrans"></a>BeginTrans, CommitTrans, Rollback Methods</h1>
<p>
<object id=alink_1 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="Text" value="Text:See Also">
<PARAM name="Flags" value=",,1">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="dvmthBeginTransC">
</object>&nbsp;&nbsp;&nbsp;<object id=alink_2 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="Text" value="Text:Example">
<PARAM name="Flags" value=",,1">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="dvmthBeginTransX">
</object>&nbsp;&nbsp;&nbsp;<object id=alink_3 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="Text" value="Text:Applies To">
<PARAM name="Flags" value=",,1">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="dvmthBeginTransA">
</object></p>
<p>
The transaction methods manage <a href="daglos04_9dta.htm">transaction</a> processing during a <a href="daglos04_4be6.htm">session</a> defined by a <a href="dadobj05_8945.htm">CdbWorkspace</a> object as follows:
<ul type=disc>
<li>
<b>BeginTrans</b> begins a new transaction.<br><br></li>
<li>
<b>CommitTrans</b> ends the <a href="daglos01_0q3y.htm">current transaction</a> and saves the changes.<br><br></li>
<li>
<b>Rollback</b> ends the current transaction and restores the databases in the <b>CdbWorkspace</b> object to the state they were in when the current transaction began.</li>
</ul>
<p class=label>
<b>Syntax</b></p>
<p>
<b>VOIDBeginTrans(VOID);</b></p>
<p>
<b>VOIDCommitTrans (LONG </b><i>lOptions </i><b>= -1);</b></p>
<p>
<b>VOIDRollback(VOID);</b></p>
<p class=label>
<b>Parameters</b></p>
<table border=1 cellpadding=5 cols=3 frame=below rules=rows width=587>
<tr valign=top>
<td class=label width=20%><b>Type</b></td>
<td class=label width=26%><b>Example</b></td>
<td class=label width=54%><b>Description</b></td>
</tr>
<tr valign=top>
<td width=20%><b>LONG</b></td>
<td width=26%><i>IOptions </i><b>=-1</b></td>
<td width=54%>Optional. Use the <b>dbForceOSFlush</b> constant to flush all updates to disk, instead of caching them.</td>
</tr>
</table><br>
<p class=label>
<b>Remarks</b></p>
<p>
You use these methods with a <b>CdbWorkspace</b> object when you want to treat a series of changes made to the databases in a session as one unit.</p>
<p>
Typically, you use transactions to maintain the integrity of your data when you must both <a href="daglos04_54kl.htm">update</a> records in two or more tables and ensure changes are completed (committed) in all tables or none at all (rolled back). For example, if you transfer money from one account to another, you might subtract an amount from one and add the amount to another. If either update fails, the accounts no longer balance. Use the <b>BeginTrans</b> method before updating the first record, and then, if any subsequent update fails, you can use the <b>Rollback</b> method to undo all of the updates. Use the <b>CommitTrans</b> method after you successfully update the last record.</p>
<p>
In a Microsoft Jet workspace, you can include the <b>dbForceOSFlush</b> constant with <b>CommitTrans</b>. This forces the database engine to immediately flush all updates to disk, instead of caching them temporarily. Without using this option, a user could get control back immediately after the application program calls <b>CommitTrans</b>, turn the computer off, and not have the data written to disk. While using this option may affect your application’s performance, it is useful in situations where the computer could be shut off before cached updates are saved to disk.</p>
<p class=indent>
<B><b>Caution</b></B> Within one <b>CdbWorkspace</b> object, transactions are always global to the <b>CdbWorkspace</b> and aren't limited to only one <a href="dadobj01_1qcu.htm">CdbConnection</a> or <a href="dadobj01_4mud.htm">CdbDatabase</a> object. If you perform operations on more than one connection or database within a <b>CdbWorkspace</b> transaction, resolving the transaction (that is, using the <b>CommitTrans</b> or <b>Rollback</b> method) affects all operations on all connections and databases within that workspace.</p>
<p>
After you use <b>CommitTrans</b>, you can't undo changes made during that transaction unless the transaction is nested within another transaction that is itself rolled back. If you nest transactions, you must resolve the current transaction before you can resolve a transaction at a higher level of nesting.</p>
<p>
If you want to have simultaneous transactions with overlapping, non-nested scopes, you can create additional <b>CdbWorkspace</b> objects to contain the concurrent transactions.</p>
<p>
If you close a <b>CdbWorkspace</b> object without resolving any pending transactions, the transactions are automatically rolled back.</p>
<p>
If you use the <b>CommitTrans</b> or <b>Rollback</b> method without first using the <b>BeginTrans</b> method, an error occurs.</p>
<p>
Some ISAM databases used in a <a href="daglos02_60it.htm">Microsoft Jet workspace</a> may not support transactions, in which case the <a href="daprop07_4ghf.htm">CdbTransactions</a> property of the <b>CdbDatabase</b> object or <a href="dadobj04_452s.htm">CdbRecordset</a> object is <b>False</b>. To make sure the database supports transactions, check the value of the <b>CdbTransactions</b> property of the <b>CdbDatabase</b> object before using the <b>BeginTrans</b> method. If you are using a <b>CdbRecordset</b> object based on more than one database, check the <b>CdbTransactions</b> property of the <b>CdbRecordset</b> object. If a <b>CdbRecordset</b> is based entirely on <a href="daglos02_0elh.htm">Microsoft Jet</a> tables, you can always use transactions. <b>CdbRecordset </b>objects based on tables created by other database products, however, may not support transactions. For example, you can't use transactions in a <b>CdbRecordset</b> based on a Paradox table. In this case, the <b>CdbTransactions</b> property is <b>False</b>. If the <b>CdbDatabase </b>or <b>CdbRecordset</b> doesn't support transactions, the methods are ignored and no error occurs.</p>
<p>
You can't nest transactions if you are accessing <a href="daglos03_23vp.htm">ODBC data sources</a> through the Microsoft Jet database engine.</p>
<p class=label>
<b>Notes</b>
<ul type=disc>
<li>
You can often improve the performance of your application by breaking operations that require disk access into transaction blocks. This buffers your operations and may significantly reduce the number of times a disk is accessed.<br><br></li>
<li>
In a Microsoft Jet workspace, transactions are logged in a file kept in the directory specified by the TEMP environment variable on the workstation. If the transaction log file exhausts the available storage on your TEMP drive, the database engine triggers a run-time error. At this point, if you use <b>CommitTrans</b>, an indeterminate number of operations are committed, but the remaining uncompleted operations are lost, and the operation has to be restarted. Using a <b>Rollback</b> method releases the transaction log and rolls back all operations in the transaction.</li>
</ul>
<p class=label>
<b>Usage</b></p>
<pre><code>#include &lt;afxole.h&gt;
#include &lt;dbdao.h&gt;

CdbWorkspace      ws;
BOOL            error;
...
ws.BeginTrans();      // Start working.
...                  // Make some changes.
if (error)
   ws.Rollback();   // Reject changes.
else
   ws.CommitTrans();    // Accept changes.
ws.Close();         // Close the workspace.
</code></pre>
</font></BODY>
</HTML>
