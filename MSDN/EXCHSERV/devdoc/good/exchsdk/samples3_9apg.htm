<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Using a Batch File to Install SMBAGENT</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_edk_using_a_batch_file_to_install_smbagent"></a>Using a Batch File to Install SMBAGENT</h3>
<p>
The following batch file consists of calls to the Microsoft Exchange Server sample applications listed above. The batch file uses the same sample applications as the keyboard commands. You can use the batch file to install your mailbox agent. </p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To install a new service using a batch file</h5>
<p class=indent1>
Prepare a file similar to the following and execute it on your server computer.</p>
<pre><code>@echo off
rem test smba inst utilities from exchsdk 
rem =====================================================================

rem check for Help request
if .%1.==.-?. goto usage

rem check if deleting
set deletemode=   
if .%1.==.. goto start
if .%1.==.delete. goto delete
if .%1.==.DELETE. goto delete
rem shouldn't fall through to here, show usage
goto usage

:delete
rem wants to delete
set deletemode=/delete

:start
echo checking for Organization and Site environment variables...
if .%Organization%.==.. goto usage
if .%Site%.==.. goto usage
if .%projroot%.==.. set projroot=c:\exchsdk
echo Organization is %Organization%
echo Site is %Site%
echo Projroot is %projroot%
echo delete status is %deletemode%
echo.

echo setting temporary variable for password
set userpassword=slapshot

echo moving to %projroot%\bin subdirectory
c:
cd %projroot%\bin

echo.
echo installing mailbox agent...
%projroot%\bin\mbinst /SITEDN=/o=%Organization%/ou=%Site% 
/DISPLAY_NAME=SampleMBA /RELATIVE_DN=/cn=Recipients/cn=SampleMBA 
/SERVER=%COMPUTERNAME% /EXTNAME=SampleMBA 
 %deletemode%

echo.
echo installing service (mailbox agent)...
%projroot%\bin\servinst /SITEDN=/o=%Organization%/ou=%Site% 
/OBJNAME=/cn=Recipients/cn=SampleMBA /OBJTYPE=agent 
/SERVICE=SampleMBA /DISPLAY_NAME=SampleMBA /DEPENDENCIES= 
/EXE=%projroot%\bin\smbagent.exe /SERVER=%COMPUTERNAME% 
/ACCOUNT=%USERDOMAIN%\%USERNAME% /PASSWORD=%userpassword% 
%deletemode%

echo.
echo installing extension (configuration) data (mailbox agent)...
%projroot%\bin\extninst /SITEDN=/o=%Organization%/ou=%Site% 
/DISPLAY_NAME=SampleMBA /MACHINE=i386 /NAME=SampleMBA 
/EXTDLL=%projroot%\bin\smbadmin.dll /SERVER=%COMPUTERNAME% 
%deletemode%

if .%1.==.delete. goto continue
cd\exchsrvr\add-ins
md SampleMBA
cd SampleMBA
md i386
cd i386
xcopy %projroot%\bin\smbadmin.dll .

:continue
cd %projroot%\bin


echo ----------------------------------------------

goto done

:usage
echo Installing the Sample Mailbox Agent
echo example: mbtest  [(delete)]
echo add delete if removing the smba
echo Mailbox agent will be named SampleMBA
echo.
echo Environment: these environment variables must be set to their 
proper values
echo Organization=Microsoft
echo Site=Site6 
echo projroot=[root directory for SDK] NOTE: this one is set when you 
install SDK
echo.
echo Assumptions:
echo server name is same as computer name: %computername%
echo addrtype is EDK
echo user domain and name are %userdomain% and %username%

:done
set userpassword=
set deletemode=
echo All done.
 </code></pre>
<p>&nbsp;</p></body>
</HTML>
