<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Limiting Unread Messages in the Gateway</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_gdk_limiting_unread_messages_in_the_gateway"></a>Limiting Unread Messages in the Gateway</h2>
<p>
Messages entering the gateway are transferred from the Microsoft Exchange Server to the gateway’s MTS-OUT folder in the server’s information store. The server limits the maximum number of unread messages in all the gateway’s MTS-OUT folders in the following way:
<ul>
<li>
It tracks the total number of unread messages (messages that have not had the <b>IMessage::SetReadFlag</b> function invoked) in all gateway folders.</li>
<li>
If the unread message total reaches the value in the MDB-Unread-Limit field of the gateway object, the server does not transfer additional messages to the gateway.</li>
<li>
After the limit has been reached, the server waits an amount of time specified in the MDB-Backoff-Interval field of the gateway object, before checking the number of unread messages in the receive folders, and continues waiting if the limit is still exceeded.</li>
</ul>
<p>
The information store transfers messages from an message transfer queue in the MTA to the information store for a gateway only when that gateway is logged on. To prevent messages from being stranded in the receive folder of an unresponsive gateway, a timer event is associated with each message that is transferred from the MTA to the information store. If this timer event is triggered, the information store returns a nondelivery report to the originator with the reason-code set to MAPI_REASON_TRANSFER_IMPOSSIBLE and the diagnostic-code set to MAPI_DIAG_MAXIMUM_TIME_EXPIRED. It then removes the message from the folder. </p>
<p>
A gateway cancels the timer event on a message by invoking the <b>IMessage::SetReadFlag</b> function on the message object. It does this by moving the message out of the receive folder or by copying the message. Before the timer is canceled, the message can be deleted by the information store at any time to invalidate the message object. </p>
<p>
The information store uses the Time-Out-Period field in the gateway object to set the timer on each message transferred from the message transfer queue to the information store. When a nondelivery report is generated by a time-out, these properties are not returned: 
<ul>
<li>
Properties added to a message and not saved with the <b>IMAPIProp::SaveChanges</b> function.</li>
<li>
Gateway-specific properties added to an MTE for internal use by the gateway.</li>
</ul>
<p>
A gateway may not add additional attachments to an MTE until after the timer has been canceled. This enables the information store to identify the original message content if a nondelivery report needs to be generated because of message time-out.</p>
<p>&nbsp;</p></body>
</HTML>
