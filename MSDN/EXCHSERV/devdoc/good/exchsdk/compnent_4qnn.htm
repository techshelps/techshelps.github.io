<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Exporting and Importing Changed Objects</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_edk_exporting_and_importing_changed_objects"></a>Exporting and Importing Changed Objects</h3>
<p>
When changes have been made to directory objects since a previous export operation, <a href="glossary_1oo4.htm#_edk_directory_access_functions">directory access functions</a> can detect these changes by checking each object’s <a href="glossary_1ool.htm#_edk_update_sequence_number_usn_">update sequence number (USN)</a>. The USN is a counter maintained by the directory on a specific server. It is incremented whenever an object in the directory is changed, and then written into the USN-Changed attribute of the changed object. The USN therefore indicates the order in which a given object was altered relative to other objects in the directory on that server. </p>
<h4>The USN-Changed and USN-Created Attributes</h4>
<p>
The USN-Created attribute is the value of USN-Changed that was assigned to the object at its creation. The USN-Created attribute does not change when the object is modified. The USN-Created attribute can be used in conjunction with USN-Changed to determine whether the object has been created or merely modified since the last export operation. This attribute can also be used to determine whether a deleted object existed at the time of the last export operation, or if it was both created and deleted since the last export operation. </p>
<h4>Deleted Objects and Tombstones</h4>
<p>
A deleted object remains in the directory for a time in the form of a <a href="glossary_1ook.htm#_edk_tombstone">tombstone</a> (an object with the Is-Deleted attribute set). Tombstones older than a certain age (the default is 30 days) are periodically deleted in a process known as garbage collection. If a directory synchronization program waits longer than the tombstone lifetime between updates, an object may be deleted and its tombstone removed before the directory synchronization program can read it. In this case, the foreign system may not be informed that the object has been deleted from the directory.</p>
<p>
However, a directory synchronization process can tell if any deleted objects have been removed by examining the object’s PR_EMS_AB_USN_LAST_OBJ_REM property. If this property is greater than the largest USN exported in the most recent directory synchronization, a deletion has been missed. The <a href="samples1_5kc3.htm">DIRSYNC</a> sample application does not check this attribute. <a href="glossary_1oo4.htm#_edk_directory_access_functions">Directory access functions</a> can generate a list of the changed objects by selecting only those objects with a USN greater than the largest USN returned during a previous export. When this list is generated for the first time, it includes all objects in the directory. For more information about USNs, see <a href="directry_3ek4.htm">Selecting Objects to Export</a> and <a href="directry_0n3d.htm">Accessing Directory Attributes with MAPI</a>. </p>
<h4>Choosing a Server for Object Export</h4>
<p>
<a href="glossary_1oo4.htm#_edk_directory_synchronization">Directory synchronization</a> should be carried out from the same server each time. The USN for an object is server specific — it applies to this object only on this server. The USNs for a single object on different servers are not synchronized and are not likely to be the same. Replicas of objects will probably have different USNs on different servers. When a changed object is replicated to another server, the USN for the object on the second server is updated, but is not likely to be the same as the USN on the first server. For this reason, exports from different servers to the same foreign site would use a different set of USNs and would export incorrect data.</p>
<p>
If the server for directory synchronization becomes unavailable, a new server is selected and the entire directory from that server is exported. Subsequent incremental synchronizations are performed from that server, or the same procedure is repeated to enable a new server.</p>
<h4>Exporting and Transferring Object Information</h4>
<p>
The <a href="glossary_1oo4.htm#_edk_directory_access_functions">directory access functions</a> create a formatted file that contains the information for all the exported objects. Alternately, they can pass the objects one-by-one to a caller-specified routine, which in turn can write them to a file in whatever format has been chosen. An export file generated in this manner can then be sent to another system, or it can be written directly to the foreign system’s import agent. </p>
<p>
Agents on remote Microsoft Exchange Server systems can also generate export lists in directory-import format. Many foreign systems can be programmed to generate such lists from their databases. These export files are then mailed to the local Microsoft Exchange Server system, received through a gateway, and then imported using directory access functions.</p>
<p>&nbsp;</p></body>
</HTML>
