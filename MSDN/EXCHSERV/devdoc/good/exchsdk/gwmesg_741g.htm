<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Sample Gateway Message Format</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_gdk_sample_gateway_message_format"></a>Sample Gateway Message Format</h1>
<p>
This appendix describes the format of messages in the Microsoft Exchange Server SDK sample gateway. These messages are based on RFC 822. The message format is as follows:</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=23%>Message Component</th>
<th align=left width=77%>Format</th>
</tr>
<tr valign=top>
<td width=23%>Message </td>
<td width=77%>Envelope Content</td>
</tr>
<tr valign=top>
<td width=23%>Envelope </td>
<td width=77%>TnefAttachName EnvOriginator EnvRecipients EnvDataLine</td>
</tr>
<tr valign=top>
<td width=23%>TnefAttachName </td>
<td width=77%><b>“X-Tnef-Attach:”</b> <b>&lt;EOL&gt;</b> |<br>
<b>“X-Tnef-Attach:” MAPIMAIL.DAT &lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>EnvOriginator</td>
<td width=77%>“<b>MAIL FROM:” </b>Address <b>&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>EnvRecipients </td>
<td width=77%>EnvRecip | EnvRecip EnvRecipients</td>
</tr>
<tr valign=top>
<td width=23%>EnvRecip </td>
<td width=77%><b>“RCPT TO:”</b> Address <b>&lt;EOL&gt; </b></td>
</tr>
<tr valign=top>
<td width=23%>EnvDataLine </td>
<td width=77%><b>“DATA:” &lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>Content </td>
<td width=77%>IPMContent | ReportContent</td>
</tr>
<tr valign=top>
<td width=23%>IPMContent </td>
<td width=77%>ClassIPM IPMHeader IPMBody TNEFAttach |<br>
ClassIPM IPMHeader IPMBody</td>
</tr>
<tr valign=top>
<td width=23%>ReportContent </td>
<td width=77%>ClassReport ReportHeader ReportBody TNEFAttach |<br>
ClassReport Report Header ReportBody</td>
</tr>
<tr valign=top>
<td width=23%>ClassIPM </td>
<td width=77%>“<b>X-Message-Class:IPM.”</b> SubClass<b>&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>ClassReport </td>
<td width=77%>“<b>X-Message-Class:Report.”</b> SubClass<b>&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>IPMHeader </td>
<td width=77%>IPMDate IPMSource IPMDestinations IPMHumanDetails</td>
</tr>
<tr valign=top>
<td width=23%>IPMDate </td>
<td width=77%>“<b>Date:”</b> DateTime <b>&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>DateTime </td>
<td width=77%>Day, <b>&lt;SP&gt; </b>Date <b>&lt;SP&gt; </b>Month <b>&lt;SP&gt; </b>Year <b>&lt;SP&gt; </b>Hours <b>“:” </b>Minutes <b>“:”</b> Seconds <b>“UT”</b></td>
</tr>
<tr valign=top>
<td width=23%>IPMSource </td>
<td width=77%>IPMID [IPMSubjectID] IPMTrace IPMFrom</td>
</tr>
<tr valign=top>
<td width=23%>IPMID </td>
<td width=77%><b>“X-Message-ID:” </b>MessageIdString <b>&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>IPMSubjectID </td>
<td width=77%><b>“X-Subject-Message-ID:” </b>MessageIdString <b>&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>IPMTraceEntries</td>
<td width=77%>IPMTraceEntry | IPMTraceEntry IPMTraceEntries</td>
</tr>
<tr valign=top>
<td width=23%>IPMFrom </td>
<td width=77%><b>“From:”</b> Address <b>&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>IPMTraceEntry</td>
<td width=77%>X400RcvdBy X400RcvdAt X400AttBy X400DefdAt</td>
</tr>
<tr valign=top>
<td width=23%>X400RcvdBy</td>
<td width=77%><b>“X400-Received-By:”</b> StringRepOfTraceInfo<b>&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>X400RcvdAt</td>
<td width=77%><b>“X400-Received-At:”</b> DateTime<b>&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>X400AttBy</td>
<td width=77%><b>“X400-Attempted-By:”</b> StringRepOfTraceInfo<b>&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>X400DefdAt</td>
<td width=77%><b>“X400-Deferred-At:”</b> DateTime<b>&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>StringRepOfTraceInfo </td>
<td width=77%>“<b>/P=“ </b>Prmd <b>“/A=“ </b>Admd <b>“/C=“ </b>Country <b>“/”</b> <b>“;”</b> Action</td>
</tr>
<tr valign=top>
<td width=23%>Action </td>
<td width=77%><b>“Redirected”</b> | <b>“Expanded”</b> | <b>“Relayed”</b> | <b>“Rerouted”</b></td>
</tr>
<tr valign=top>
<td width=23%>IPMDestinations</td>
<td width=77%>IPMDestination | IPMDestination IPMDestinations BlankLine</td>
</tr>
<tr valign=top>
<td width=23%>IPMDestination</td>
<td width=77%>IPMDestinationPrefix Address <b>&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>IPMDestinationPrefix </td>
<td width=77%>“<b>TO:” </b>| <b>“CC:” </b>| <b>“BCC:”</b></td>
</tr>
<tr valign=top>
<td width=23%>BlankLine</td>
<td width=77%> <b>&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>&lt;EOL&gt;</td>
<td width=77%><b>“\r\n”</b></td>
</tr>
<tr valign=top>
<td width=23%>IPMHumanDetails </td>
<td width=77%>IPMHumanDetails</td>
</tr>
<tr valign=top>
<td width=23%>ImportanceVal </td>
<td width=77%><b>“High” </b>| <b>“Normal” </b>| <b>“Low”</b></td>
</tr>
<tr valign=top>
<td width=23%>PriorityVal </td>
<td width=77%><b>“Normal” </b>| <b>“Non-Urgent” </b>| <b>“Urgent”</b></td>
</tr>
<tr valign=top>
<td width=23%>IPMBody </td>
<td width=77%>BodyText BodyText AttachmentText</td>
</tr>
<tr valign=top>
<td width=23%>BodyText</td>
<td width=77%>BodyHeader BodyLines BodyFooter</td>
</tr>
<tr valign=top>
<td width=23%>BodyHeader</td>
<td width=77%><b>“----beginbody:”</b> LengthOfTextInBytes(decimal represented as ASCII)</td>
</tr>
<tr valign=top>
<td width=23%>BodyLines</td>
<td width=77%>BodyLine BodyLines | BodyLine</td>
</tr>
<tr valign=top>
<td width=23%>BodyFooter</td>
<td width=77%><b>&lt;EOL&gt;“----endbody”&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>BodyLine</td>
<td width=77%>RegularLineOfText</td>
</tr>
<tr valign=top>
<td width=23%>AttachmentText</td>
<td width=77%>&lt;NULL&gt; |</td>
</tr>
<tr valign=top>
<td width=23%>AttachmentHeader</td>
<td width=77%> <b>“----beginattach:” </b>AttachId <b>“:” </b>AttachLength <b>&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>AttachId </td>
<td width=77%>BaseFileName</td>
</tr>
<tr valign=top>
<td width=23%>AttachmentTail</td>
<td width=77%><b>&lt;EOL&gt;“----endattach”&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>BaseFileName </td>
<td width=77%><i>The name of the file in 8.3 format.</i></td>
</tr>
<tr valign=top>
<td width=23%>AttachmentLength </td>
<td width=77%><i>The length of the file in bytes (decimal number represented as ASCII digits)</i></td>
</tr>
<tr valign=top>
<td width=23%>ReportHeader</td>
<td width=77%>IPMDate IPMSource IPMDesination IPMHumanDetails</td>
</tr>
<tr valign=top>
<td width=23%>ReportBody</td>
<td width=77%>NDRBodies | DRBodies | NRNBody | RNBody</td>
</tr>
<tr valign=top>
<td width=23%>NDRBodies</td>
<td width=77%>NDRBody NDRBodies | NDRBody</td>
</tr>
<tr valign=top>
<td width=23%>NDRBody</td>
<td width=77%>NDRNonDeliverLine NDRTextLine NDRDiagLine NDRCodeLine</td>
</tr>
<tr valign=top>
<td width=23%>NDRNonDeliverLine</td>
<td width=77%><b>“Your message was not delivered to:” </b>Address<b>&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>NDRTextLine</td>
<td width=77%><b>“for the following reason:” </b>ReportText<b>&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>NDRDiagLine</td>
<td width=77%><b>“Diagnostic code:” </b>DiagnosticCode<b>&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>NDRCodeLine</td>
<td width=77%><b>“NDR code:” </b>ReasonCode<b>&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>DRBodies</td>
<td width=77%>DRBody DRBodies | DRBody</td>
</tr>
<tr valign=top>
<td width=23%>DRBody</td>
<td width=77%>DRDeliverLine AtTimeLine</td>
</tr>
<tr valign=top>
<td width=23%>DRDeliverLine</td>
<td width=77%><b>“Your message was successfully delivered to:” </b>Address<b>&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>AtTimeLine</td>
<td width=77%><b>“at:” </b>DateTime<b>&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>NRNBody</td>
<td width=77%>NRNNotReadLine AtTimeLine NRNDiscardLine NRNCodeLine</td>
</tr>
<tr valign=top>
<td width=23%>NRNNotReadLine:</td>
<td width=77%><b>“Your message was not read by:” </b>Address<b>&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>NRNDiscardLine</td>
<td width=77%><b>“Discard code:” </b>DiscardCode<b>&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>NRNCodeLine</td>
<td width=77%><b>“Non-reciept code:” </b>NonReceiptCode<b>&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>RNBody</td>
<td width=77%>RNReadByLine AtTimeLine</td>
</tr>
<tr valign=top>
<td width=23%>RNReadByLine</td>
<td width=77%><b>“Your message was read by:” </b>Address<b>&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>TNEFAttach</td>
<td width=77%>TNEFHeader TNEFData</td>
</tr>
<tr valign=top>
<td width=23%>TNEFHeader</td>
<td width=77%><b>“MAPIMAIL.DAT:”&lt;EOL&gt;</b></td>
</tr>
<tr valign=top>
<td width=23%>TNEFData</td>
<td width=77%>binary TNEF data</td>
</tr>
</table><br>
<h4>Line Formatting Rules</h4>
<p>
The tag and data portion of a line (tag:data) is printed on one line, regardless of length. A line is terminated with the carriage return/new line sequence (\r\n).</p>
<p>
The message text data, binary attachment data, and TNEF data are handled individually. The message text is printed out exactly as it was formatted in the original message. No line breaks are added.</p>
<p>
The binary attachment data is encoded. Each byte in the original attachment is converted to a two-character hexadecimal representation of that byte. (For example, 256 becomes FF.) Each two-character hexadecimal representation is separated from the next one by an ASCII space. A total of 24 hexadecimal byte pairs are printed per line.</p>
<p>
The TNEF data is printed out directly by the TNEF encoding function. No formatting is done on the data printed out by TNEF.</p>
<p>
</p>
<p>&nbsp;</p></body>
</HTML>
