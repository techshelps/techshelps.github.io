<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Backing Up and Restoring Data</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_edk_backing_up_and_restoring_data"></a>Backing Up and Restoring Data</h1>
<p>
The Microsoft Exchange Server SDK provides functions for backing up and restoring data in the Microsoft Exchange Server <a href="glossary_1oo4.htm#_edk_directory">directory</a> and <a href="glossary_1oo9.htm#_edk_information_store">information store</a>. These functions perform backups online, which means that there is no need to stop the directory service or information-store service to back up directory or information-store data. Also, backup and restore operations can be performed remotely.</p>
<p>
<b>Files Needed to Call the Backup and Restore Functions</b></p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=26%>Files </th>
<th align=left width=74%>Purpose</th>
</tr>
<tr valign=top>
<td width=26%>EDBMSG.H </td>
<td width=74%>Error codes</td>
</tr>
<tr valign=top>
<td width=26%>EDBBCLI.H </td>
<td width=74%>Header file for the backup/restore functions</td>
</tr>
<tr valign=top>
<td width=26%>EDBBCLI.LIB </td>
<td width=74%>Static LIB of backup/restore functions</td>
</tr>
<tr valign=top>
<td width=26%>EDBBCLI.DLL </td>
<td width=74%>Backup/restore entry point DLL</td>
</tr>
</table><br>
<p>
The backup and restore functions provide three types of backup capabilities: full, incremental, and differential. 
<ul>
<li>
A full backup backs up the entire directory or entire information store and allows you to restore it from a single backup. </li>
<li>
An incremental backup backs up just the changes since the last full or incremental backup. Restoring incremental backups requires the original full backup plus all the incremental backups made since that time. </li>
<li>
A differential backup backs up the changes since the last full backup. Restoring a differential backup requires one differential backup and the original full backup.</li>
</ul>
<p>
The following table lists the backup and restore functions and what they are used for.</p>
<p>
<b>List of Backup and Restore Functions</b></p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=43%>Function</th>
<td width=57%><b>Purpose</b></td>
</tr>
<tr valign=top>
<td width=43%><a href="function_9e3p.htm"><b>BackupFree</b></a></td>
<td width=57%>Frees memory allocated during one of the backup functions.</td>
</tr>
<tr valign=top>
<td width=43%><a href="function_3gdh.htm"><b>HrBackupClose</b></a></td>
<td width=57%>Closes the current file being backed up.</td>
</tr>
<tr valign=top>
<td width=43%><a href="function_536s.htm"><b>HrBackupEnd</b></a></td>
<td width=57%>Cleans up after a backup operation has been performed. </td>
</tr>
<tr valign=top>
<td width=43%><a href="function_0qpf.htm"><b>HrBackupGetBackupLogs</b></a></td>
<td width=57%>Obtains the list of log files to be backed up. These are the only files that need to be backed up for a differential or incremental backup. </td>
</tr>
<tr valign=top>
<td width=43%><a href="function_21pv.htm"><b>HrBackupGetDatabaseNames</b></a></td>
<td width=57%>Returns the list of the attached databases on the remote machine. </td>
</tr>
<tr valign=top>
<td width=43%><a href="function_24f9.htm"><b>HrBackupOpenFile</b></a></td>
<td width=57%>Opens a remote file for backup and will perform whatever client and server side operations to prepare for the backup. </td>
</tr>
<tr valign=top>
<td width=43%><a href="function_1j39.htm"><b>HrBackupPrepare</b></a></td>
<td width=57%>Connects to a remote Microsoft Exchange Server database and prepares it for backup. </td>
</tr>
<tr valign=top>
<td width=43%><a href="function_7x2c.htm"><b>HrBackupRead</b></a></td>
<td width=57%>Reads one block from a backup file.</td>
</tr>
<tr valign=top>
<td width=43%><a href="function_2ib7.htm"><b>HrBackupTruncateLogs</b></a></td>
<td width=57%>Deletes the committed database log files. </td>
</tr>
<tr valign=top>
<td width=43%><a href="function_8u78.htm"><b>HrRestoreEnd</b></a></td>
<td width=57%>Cleans up after a restore operation has been performed. </td>
</tr>
<tr valign=top>
<td width=43%><a href="function_4l4j.htm"><b>HrRestoreGetDatabaseLocations</b></a></td>
<td width=57%>Returns the database locations for the server and service referred to by the handle <i>hbcRestoreContext</i>.</td>
</tr>
<tr valign=top>
<td width=43%><a href="function_517p.htm"><b>HrRestorePrepare</b></a></td>
<td width=57%>Connects to a remote Microsoft Exchange Server database and prepares it for restore. </td>
</tr>
<tr valign=top>
<td width=43%><a href="function_5auq.htm"><b>HrRestoreRegister</b></a></td>
<td width=57%>Registers a restore operation. </td>
</tr>
<tr valign=top>
<td width=43%><a href="function_2sx1.htm"><b>HrRestoreRegisterComplete</b></a></td>
<td width=57%>Completes a restore operation. </td>
</tr>
<tr valign=top>
<td width=43%><a href="function_8t5z.htm"><b>HrSetCurrentBackupLog</b></a></td>
<td width=57%>Sets the last log number that was backed up.</td>
</tr>
</table><br>
<p>
The directory and information store consist of the following files:
<ul>
<li>
A main database file. This file is named DIR.EDB for the directory, PRIV.EDB for the <a href="glossary_1oog.htm#_edk_private_information_store">private information store</a>, and PUB.EDB for the <a href="glossary_1oog.htm#_edk_public_information_store">public information store</a>. This file name is returned from the <a href="function_21pv.htm"><b>HrBackupGetDatabaseNames</b></a> function, and is passed in a call to the <a href="function_7x2c.htm"><b>HrBackupRead</b></a> function.</li>
<li>
Transaction log files, named EDB#####.LOG, where ##### is a 5-digit hexadecimal number from 00000 to FFFFF. One set of these files is used for the directory and one set is used for the private and public information stores combined. </li>
</ul>
<p>
</p>
<p>
Because the log files log the changes made to the database, the backup functions use the log files to perform incremental and differential backups. After a full or incremental backup, the log files must be purged (that is, the logs that have been written to the EDB file are deleted) with a call to the <a href="function_2ib7.htm"><b>HrBackupTruncateLogs</b></a> function.</p>
<p>
The location of the database and log files on a Microsoft Exchange Server computer can be changed dynamically by an administrator. The currently configured paths can be obtained using the <a href="function_4l4j.htm"><b>HrRestoreGetDatabaseLocations</b></a> function. For more information, see <a href="infostor_1khf.htm">Backup File Locations</a>.</p>
<p>&nbsp;</p></body>
</HTML>
