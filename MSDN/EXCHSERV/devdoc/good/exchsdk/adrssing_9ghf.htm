<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Mapping Inbound Addresses</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_gdk_mapping_inbound_addresses"></a>Mapping Inbound Addresses</h2>
<p>
Mapping addresses on inbound messages is similar to mapping addresses on outbound messages. The gateway must convert every address in the message into a form that Microsoft Exchange Server understands. Ideally, this form is the native Microsoft Exchange Server (EX) address format. At least one recipient on an inbound message should have a native address that corresponds to it. If that is not the case then there are no recipients that the gateway can deliver the message to.</p>
<p>
The gateway must deal with three classes of addresses in an inbound message:
<ul>
<li>
<b>Local recipients</b>  Local recipients are those for which there is a native Microsoft Exchange Server address corresponding to the recipient address in the inbound message. The gateway must convert these addresses to their native EX addresses before delivering the message to the server.</li>
<li>
<b>Foreign recipients</b>  Foreign recipients are those whose addresses in the inbound message do not correspond to any native Microsoft Exchange Server addresses. The gateway must create one-off addresses to represent these recipients before delivering the message to the server.</li>
<li>
<b>Originator</b>  The gateway must create a one-off address for the message’s originator before delivering the message to the server.</li>
</ul>
<p>
All MAPI-based systems, including Microsoft Exchange Server, require that the originator and each recipient of a message have a PR_ENTRYID property. However, the originator of a message from a foreign message system may not have entry ID in the server’s global address list. For a message coming from a foreign system to Microsoft Exchange Server, the gateway can:
<ul>
<li>
Use the address lookup function <b>HrGWResolveAddress</b> with the proxy address and the foreign system address type to look up the PR_ENTRYID property for the originator and each recipient.</li>
<li>
Attempt to generate a PR_ENTRYID property using the MAPI <b>IAddrBook::CreateOneOff</b> method if the previous action fails. </li>
</ul>
<p>
If the gateway cannot find or create the PR_ENTRYID property, it must take appropriate action as follows:
<ul>
<li>
<b>Originator</b>  Generate a nondelivery report for each Responsibility-TRUE recipient, and send the nondelivery report to the originator. This is because the gateway cannot generate a return address for replies to the message. (See <a href="reports_6ann.htm">Reports</a> for information about gateway reports.) Create a nondelivery report for each Responsibility-TRUE recipient.</li>
<li>
<b>Responsibility-TRUE recipient</b>  Generate a nondelivery report for the recipient.</li>
<li>
<b>Responsibility-FALSE recipient</b>  Drop the recipient from the message or place it in a purely textual field.</li>
</ul>
<p>&nbsp;</p></body>
</HTML>
