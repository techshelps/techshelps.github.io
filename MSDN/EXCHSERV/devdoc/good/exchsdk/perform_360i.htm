<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Using the Performance Monitor</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_edk_using_the_performance_monitor"></a>Using the Performance Monitor</h1>
<p>
The Windows NT Performance Monitor can help you isolate performance bottlenecks. Many Microsoft Exchange Server components create their own performance counters that provide more detailed information about performance bottlenecks. Using the Performance Monitor and the logging facility will help you identify problem areas. The main areas to consider when searching for bottlenecks are memory accesses, CPU usage, disk I/O, and network I/O. </p>
<h4>Using the Disk Performance Monitor</h4>
<p>
The Performance Monitor counters for disk monitoring are turned off by default because they erode Windows NT Server performance by 1 to 2 percent. The Performance Monitor should be turned off when you are not specifically monitoring disk performance.</p>
<p>
The Performance Monitor counters indicate the number and size of reads and writes that are being generated for a particular disk. They also show the percentage of time your application spends accessing a particular disk or disk strip set, as well as other information.</p>
<p>
To turn on disk performance monitoring for a Windows NT Server computer, type <b>diskperf -y</b> at a command prompt and restart the computer. You may want to start the disk performance monitor on all your development servers before you begin testing your application.</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To prepare for performance monitoring</h5>
<ol>
<li>
Start the Windows NT Performance Monitor.</li>
<li>
From the <b>View</b> menu, choose <b>Log</b>.</li>
<li>
From the <b>Edit</b> menu, choose <b>Add to Log</b>. Add counters for the following:<pre><code>Logical Disk
Memory
Processor
Redirector
Server
 </code></pre>
</li>
<li>
Choose <b>Done</b>.</li>
<li>
From the <b>Options</b> menu, choose <b>Log</b>. Enter a file name on a separate drive to isolate logging I/O. For example, if Microsoft Exchange Server resides on the C drive, enter logs on the D drive.</li>
<li>
Optional: Adjust the periodic update to be 1/100 of your time. For example, if your test requires 300 seconds, set the periodic update to three seconds. This makes it easier to view the data in one screen.</li>
<li>
Click <b>OK</b>.</li>
</ol>
<p>
</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To start performance monitoring and collect data</h5>
<ol>
<li>
Choose <b>Log</b> from the <b>Options</b> menu in the Windows NT Performance Monitor window.</li>
<li>
Click <b>Start Log</b>.</li>
<li>
Start your application. </li>
</ol>
<p>
<b>Note</b>  Before running a test, choose <b>Chart</b> from the <b>View</b> menu. Add basic counters such as:</p>
<pre><code>Processor:%Processor Time
Logical Disk:C,D
 </code></pre>
<p>
This allows you to monitor the test until it is completed and the counters return to idle levels. Also, when you get all the settings, save your layout by choosing <b>Save Workspace</b> from the <b>File</b> menu. This will allow you to restore the settings at a later date.</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To monitor the test</h5>
<p class=indent1>
To monitor a test in session, choose <b>Chart</b> from the <b>View</b> menu. </p>
<p>
</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To stop test logging</h5>
<ol>
<li>
From the <b>Log</b> menu, choose <b>View</b> when the test is finished.</li>
<li>
From the <b>Options</b> menu, choose <b>Log</b>.</li>
<li>
Click <b>Stop Log</b>.</li>
</ol>
<p>
</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To produce a view that gives you basic patterns</h5>
<ol>
<li>
From the <b>Options</b> menu, choose <b>Data From</b> and enter the log file name.</li>
<li>
From the <b>View</b> menu, choose <b>Chart</b>.</li>
<li>
From the <b>Edit</b> menu, choose <b>Add to Chart</b>. Enter the following: <pre><code>Processor:% Processor Time
Logical Disk:% Disk Time
Redirector:Bytes Total/sec
Memory:Pages/sec
 </code></pre>
</li>
</ol>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To analyze the data</h5>
<p class=indent1>
You can draw your first conclusions from the data results. For example, if the Percent Processor Time is listed at 100 percent during most of the test, your application is CPU-bound.</p>
<p>
</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To produce a view that allows you to look at all recorded data</h5>
<ol>
<li>
From the <b>Report</b> menu, choose <b>View</b>.</li>
<li>
From the <b>Add to Report</b> menu, choose <b>Edit</b>.</li>
<li>
For each object, add all counters for all instances.</li>
</ol>
<p>
</p>
<p>
For example, your test may have sent 100 messages. Multiply the Disk Bytes per second by the time interval as shown in Graph Time in the Chart View. Divide by 100 messages to determine the Disk I/O required per message.</p>
<h4>Isolating Problems</h4>
<p>
Analyze the data obtained for each component to identify the direct source of any problems. Recommendations for isolating problems include the following:
<ul>
<li>
Use a computer with multiple disks to isolate a component responsible for excessive disk I/O operations. Use the Microsoft Exchange Server optimizer (PERFWIZ.EXE) to move the <a href="glossary_1oo9.htm#_edk_information_store">information store</a> logs, information store databases, directory service logs and databases. The Microsoft Exchange Server <a href="glossary_1ood.htm#_edk_message_transfer_agent_mta_">message transfer agent (MTA)</a> can be used to separate the drives. You can then monitor each drive for I/O to discover which component accesses the disk most frequently. Set up Microsoft Exchange Server and Windows NT Server on one disk, a log file on a second disk, and stripe the remainder of your disks together to hold the database.</li>
<li>
Add process-specific or component-specific objects such as the Microsoft Exchange Server information store object when logging. This will provide you with more specific information about the component in question.</li>
<li>
To monitor a test in session, choose <b>Chart</b> from the <b>View</b> menu.</li>
</ul>
<p>
</p>
<p>
For more detailed information about the Performance Monitor, see <i>Optimizing Windows NT </i>in the <i>Windows NT Server Resource Kit</i>.</p>
<p>&nbsp;</p></body>
</HTML>
