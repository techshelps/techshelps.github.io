<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Importing and Exporting with DIRSYNC</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_edk_importing_and_exporting_with_dirsync"></a>Importing and Exporting with DIRSYNC</h2>
<p>
Building and running DIRSYNC demonstrates a basic mechanism for synchronizing directories between a Microsoft Exchange Server system and a foreign mail system, or between Microsoft Exchange Server and a nonmail database. For example, the DIRSYNC agent can be integrated into a mail <a href="glossary_1oo7.htm#_edk_gateway">gateway</a> application that coordinates <a href="glossary_1oo1.htm#_edk_address_book">address books</a> between Microsoft Exchange Server and a foreign system such as PROFS.</p>
<p>
The DIRSYNC sample application creates a file for export, or incorporates the changes from an import file to the directory. (Note: How the export file is used, or how to create the import file, is determined outside the scope of this sample application). The import and export files are identical, so if there is a Microsoft Exchange Server system at each end, DIRSYNC can be used both to export and import changes. </p>
<p>
The following instructions explain how to build a gateway, run DIRSYNC to create an export file, and use DIRSYNC to import that file into the other system to incorporate its changes into the address book for two Microsoft Exchange Server sites. For purposes of this example, the two sites are created within the same organization. The following objects are created:
<ul>
<li>
Testorg organization</li>
<li>
Site1 site</li>
<li>
Server1 server at Site1</li>
<li>
Site2 site</li>
<li>
Server2 server at Site2</li>
</ul>
<p>
</p>
<p>
In this example, the sample gateway is installed on Server1 and Server2 to connect the sites together for DIRSYNC.</p>
<p>
</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To create a gateway for DIRSYNC </h5>
<ol>
<li>
Gather the necessary information for creating the gateway:<ul>
<li>
<a href="glossary_1oof.htm#_edk_organization">Organization</a> name</li>
<li>
<a href="glossary_1ooj.htm#_edk_site">Site</a> name</li>
<li>
Display name for gateway</li>
<li>
<a href="glossary_1oo4.htm#_edk_distinguished_name_dn_">Distinguished name (DN)</a> for gateway</li>
<li>
Service account name</li>
<li>
Password for service account</li>
</ul>
</li>
<li>
Install the sample gateway on both Server1 and Server2 following the instructions found in <a href="samplgw_0rxv.htm">Sample Gateway and Applications</a>. </li>
<li>
In the <b>Address Type</b> field, type the address type for the other site. For example, if one site is EDK and the other is SMTP, the SMTP site will have EDK typed in this field and the EDK site will have SMTP typed here. A proxy generation DLL that generates addresses of the other type must be associated with each site. For more information, see the <i>Gateway Programmer's Reference</i>.<p>
For this example, set the address type of both servers to EDK, which allows the PROXYGEN.DLL to be used as the proxy generation DLL.
</li>
<li>
Verify that the sample gateway has been created on both servers by finding it in the Connections container within the <a href="glossary_1ood.htm#_edk_microsoft_exchange_server_administrator_program">Microsoft Exchange Server<i> </i>Administrator program</a> for each site. See the <i>Microsoft Exchange Server Administrator's Guide</i> for more information.</li>
<li>
Create the following mailboxes:<ul>
<li>
For Server1: Mailbox 11, Mailbox 12, Mailbox 13.</li>
<li>
For Server2: Mailbox 21, Mailbox 22.</li>
</ul>
</li>
</ol>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To create a mailbox</h5>
<ol>
<li>
Start the Administrator program and connect it to the server on which you plan to create the mailbox. </li>
<li>
Change to the Recipients container. </li>
<li>
From the <b>File</b> menu, choose <b>New Mailbox</b>.</li>
<li>
Enter the information for the new mailbox. You can attach it to an existing Windows NT account or create a new account.</li>
<li>
Verify that the new mailbox has been created by finding it in the Recipients' container.</li>
</ol>
<p>
</p>
<p>
The following procedure demonstrates how to connect the two sites together through the gateway.</p>
<p>
</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To connect two sites together through their gateways</h5>
<ol>
<li>
Start the Administrator program and connect it to Server1.</li>
<li>
Open the Connections container.</li>
<li>
Double-click the gateway icon to view its property sheet.</li>
<li>
Select the <b>Sample Gateway</b> property page. Find the <b>Directory</b> entry in the <b>Outbound</b> column. Change this entry to be the inbound directory of the other site. This path consists of the share name for the gateway plus \IN. For example: \\Server2\SAMPLEGW\IN.</li>
<li>
Follow the same procedure on Server2, connecting it to \\Server1\SAMPLEGW\IN. When you have finished, the OUT directory for each server should match the IN directory for the other server.</li>
</ol>
<p>
</p>
<p>
The following procedure demonstrates how to create a custom recipient on Server2 for Mailbox11. and a custom recipient on Server1 for Mailbox21. This allows the mailboxes to send test messages across the gateway.</p>
<p>
</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To create a custom recipient</h5>
<ol>
<li>
At Server1, open the Recipients container and double-click Mailbox11. Select <b>E-Mail Addresses</b>.</li>
<li>
Find the EDK address type for the foreign system. The address is Mailbox11@Site1.Testorg.com.</li>
<li>
Start the Administrator program on Server2.</li>
<li>
Open the Recipients container.</li>
<li>
From the <b>File</b> menu, select <b>New Custom Recipient</b>.</li>
<li>
Fill in the fields for the custom recipient to match Mailbox11 information.  The address of the custom recipient is the address you found on Server1, Mailbox11@Site1.Testorg.com. The address type is EDK.</li>
<li>
Click <b>OK</b>.</li>
<li>
Verify that the custom recipient has been created by making sure it appears in the Recipients container.</li>
<li>
Create a custom recipient on Server1 for Mailbox21 following the same procedure. This allows test messages to be sent in the opposite direction.</li>
</ol>
<p>
</p>
<p>
To make sure the gateway is operating properly, send several messages back and forth from Mailbox11 on Server1 through the gateway to Mailbox21 on Server2. When you start Microsoft Exchange client on the receiving computer, you should be able to see, open, and read the messages.</p>
<p>
After the gateway is operating between the two sites, begin synchronization by exporting all existing mailboxes from one server to the other, then updating that server as changes occur.</p>
<p>
</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To synchronize two sites</h5>
<ol>
<li>
Set up a new instance called INSTANCE1 (see the previous procedure). Use either the /SET command or the command line. This new instance should export information about mailboxes that have changed on Server1 to Server2. For example, export the Common-Name and Display-Name attributes for each mailbox to a file called SYNC1.</li>
<li>
Use INSTANCE1 to export all the existing mailboxes. This step should be followed even though custom recipients already exist at the other site. Add the /EXPFULL parameter on the command line (because this is the first export), but do not add it to the registry (because /EXPFULL will be used only once). For the first export, type the following command:<p>
<b>DIRSYNC /EXPFULL INSTANCE1</b>
</li>
<li>
Import the attributes you exported from Server1 to Server2. At Server2, set up a new instance, INSTANCE2, to import the attributes that were exported from Server1 by INSTANCE1 (that is, Common-name and Display-name). Use the same name for the import file, SYNC1, that you used for the export file in INSTANCE1. Copy SYNC1 from Server1 to Server2. Type the following command:<p>
<b>DIRSYNC INSTANCE2</b>
<p>
This command causes custom recipients for each mailbox exported from Server1 to be added to Server2.
</li>
<li>
Verify that the custom recipients have been added by opening the Recipients container of the Administrator program on Server2 and viewing each mailbox.</li>
<li>
On Server2, create INSTANCE3 to export changes to Server1. Again, export the Common-Name and Display-Name for each mailbox. Select a different name for the export file than you selected for the export file from Server1. For example: SYNC2.</li>
<li>
Export all the mailboxes from Server2 to Server1 using INSTANCE3 along with the /EXPFULL parameter on the command line:<p>
<b>DIRSYNC /EXPFULL INSTANCE3</b>
</li>
<li>
On Server1, create INSTANCE4 to import the changes from Server2 to Server1. Use the same file name, SYNC2, for your import file. </li>
<li>
Import the changes by copying SYNC2 from Server2 to Server1. Type the following command:<p>
<b>DIRSYNC INSTANCE4</b>
</li>
<li>
Make some incremental changes on Server1. For example, add a new mailbox, Mailbox14. Change the display name for Mailbox12 on Server1. Delete Mailbox11 on Server1.</li>
<li>
Export the incremental changes using INSTANCE1 but not including the /EXPFULL parameter. Type the following command:<p>
<b>DIRSYNC INSTANCE1</b>
</li>
<li>
Import these changes at Server2 by copying the newly created SYNC1 file from Server1 to Server2. Type the following command:<p>
<b>DIRSYNC INSTANCE2</b>
</li>
<li>
Create incremental changes at Server2 in the same way you created changes at Server1. Export these changes to a new SYNC2 file by typing the following command:<p>
<b>DIRSYNC INSTANCE3</b>
</li>
<li>
Import these changes at Server1 by copying the new SYNC2 file to Server1. Type the following command:<p>
<b>DIRSYNC INSTANCE4</b>
</li>
</ol>
<p>
</p>
<p>
After you have established an import and export instance at each server they can be used to synchronize the two servers as further changes occur.</p>
<p>
Should one server become disabled, another server at the site can be used for synchronizing, but the entire process — including the export of all the mailboxes — must be repeated between the servers. This is necessary because the attributes used to determine which mailboxes to export are specific to the now disabled server and the old instances cannot be used successfully.</p>
<h4>Using DIRSYNC with Multiple Instances</h4>
<p>
DIRSYNC can be used to demonstrate how a single directory synchronization agent can coordinate requests from several sources, such as from two instances of the same gateway or from different gateways, with each source represented by a separate Windows NT Registry instance. </p>
<p>
You can save multiple instances of DIRSYNC calls in the Windows NT Registry, but some precautions should be taken when running DIRSYNC with multiple instances:</p>
<p>
If you are making incremental updates, create a different instance to run DIRSYNC from another container. Otherwise, DIRSYNC will use the state information stored from the first container and this may produce unpredictable results. However, if you request a full update with the /EXPFULL flag, you can use a single DIRSYNC instance to export from multiple containers or multiple directories.</p>
<p>&nbsp;</p></body>
</HTML>
