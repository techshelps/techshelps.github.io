<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>C Bit Fields</title>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY>
<font face="verdana,arial,helvetica" size="2">
<h1><a name="_clang_c_bit_fields"></a><sup></sup>C Bit Fields</h1>
<p>
In addition to declarators for members of a structure or union, a structure declarator can also be a specified number of bits, called a “bit field.” Its length is set off from the declarator for the field name by a colon. A bit field is interpreted as an integral type. </p>
<p class=label>
<b>Syntax</b></p>
<p class=dt>
<i>struct-declarator</i> :</p>
<p class=indent>
<i>declarator</i><br>
<i>type-specifier declarator</i> <sub>opt</sub> <b>:</b> <i>constant-expression</i></p>
<p>
The <i>constant-expression</i> specifies the width of the field in bits. The <i>type-specifier</i> for the <i>declarator</i> must be <b>unsigned int</b>, <b>signed int</b>, or <b>int</b>, and the <i>constant-expression</i> must be a nonnegative integer value. If the value is zero, the declaration has no <i>declarator</i>. Arrays of bit fields, pointers to bit fields, and functions returning bit fields are not allowed. The optional <i>declarator</i> names the bit field. Bit fields can only be declared as part of a structure. The address-of operator (<b>&amp;</b>) cannot be applied to bit-field components. </p>
<p>
Unnamed bit fields cannot be referenced, and their contents at run time are unpredictable. They can be used as “dummy” fields, for alignment purposes. An unnamed bit field whose width is specified as 0 guarantees that storage for the member following it in the <i>struct-declaration-list</i> begins on an <b>int</b> boundary. </p>
<p>
Bit fields must also be long enough to contain the bit pattern. For example, these two statements are not legal:</p>
<pre><code>short a:17;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* Illegal! */
int long y:33;&nbsp;&nbsp;&nbsp;&nbsp; /* Illegal! */
</code></pre>
<p>
This example defines a two-dimensional array of structures named <code>screen</code>. </p>
<pre><code>struct 
{
 &nbsp;&nbsp; unsigned short icon : 8;
 &nbsp;&nbsp; unsigned short color : 4;
 &nbsp;&nbsp; unsigned short underline : 1;
 &nbsp;&nbsp; unsigned short blink : 1;
} screen[25][80];
</code></pre>
<p>
The array contains 2,000 elements. Each element is an individual structure containing four bit-field members: <code>icon</code>, <code>color</code>, <code>underline</code>, and <code>blink</code>. The size of each structure is two bytes.</p>
<p>
Bit fields have the same semantics as the integer type. This means a bit field is used in expressions in exactly the same way as a variable of the same base type would be used, regardless of how many bits are in the bit field. </p>
<p>
<b>Microsoft Specific —&gt;</b></p>
<p>
Bit fields defined as <b>int</b> are treated as signed. A Microsoft extension to the ANSI C standard allows <b>char</b> and <b>long</b> types (both <b>signed</b> and <b>unsigned</b>) for bit fields. Unnamed bit fields with base type <b>long</b>, <b>short</b>, or <b>char</b> (<b>signed</b> or <b>unsigned</b>) force alignment to a boundary appropriate to the base type.</p>
<p>
Bit fields are allocated within an integer from least-significant to most-significant bit. In the following code </p>
<pre><code>struct mybitfields
{
 &nbsp;&nbsp; unsigned short a : 4;
 &nbsp;&nbsp; unsigned short b : 5;
 &nbsp;&nbsp; unsigned short c : 7;
} test;

void main( void );
{
 &nbsp;&nbsp; test.a = 2;
 &nbsp;&nbsp; test.b = 31;
 &nbsp;&nbsp; test.c = 0;
}
</code></pre>
<p>
the bits would be arranged as follows:</p>
<pre><code>00000001 11110010
cccccccb bbbbaaaa
</code></pre>
<p>
Since the 8086 family of processors stores the low byte of integer values before the high byte, the integer <code>0x01F2</code> above would be stored in physical memory as <code>0xF2</code> followed by <code>0x01</code>.</p>
<p>
<b>END Microsoft Specific</b></p>
</font></BODY>
</HTML>
