<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>SQLBrowseConnect</title>
<link disabled rel=stylesheet href=msdn_ie3.css>
<style type="text/css">
@import url(msdn_ie4.css);
</style>
</HEAD>
<BODY>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

	<!--TOOLBAR_START-->
	<!--TOOLBAR_EXEMPT-->
	<!--TOOLBAR_END-->


<h1><a name="odbcsqlbrowseconnect"></a>SQLBrowseConnect</h1>
<p class=label>
<b>Conformance</b></p>
<p>
Version Introduced:ODBC 1.0<br>
Standards Compliance:ODBC</p>
<p class=label>
<b>Summary</b></p>
<p>
<b>SQLBrowseConnect</b> supports an iterative method of discovering and enumerating the attributes and attribute values required to connect to a data source. Each call to <b>SQLBrowseConnect</b> returns successive levels of attributes and attribute values. When all levels have been enumerated, a connection to the data source is completed and a complete connection string is returned by <b>SQLBrowseConnect</b>. A return code of SQL_SUCCESS or SQL_SUCCESS_WITH_INFO indicates that all connection information has been specified and the application is now connected to the data source.</p>
<p class=label>
<b>Syntax</b></p>
<p>
SQLRETURN <b>SQLBrowseConnect</b>(<br>
SQLHDBC<i>ConnectionHandle</i>,<br>
SQLCHAR *<i>InConnectionString</i>,<br>
SQLSMALLINT<i>StringLength1</i>,<br>
SQLCHAR *<i>OutConnectionString</i>,<br>
SQLSMALLINT<i>BufferLength</i>,<br>
SQLSMALLINT *<i>StringLength2Ptr</i>);</p>
<p class=label>
<b>Arguments</b></p>
<p class=dt>
<i>ConnectionHandle</i></p>
<p class=indent>
[Input]<br>
Connection handle.</p>
<p class=dt>
<i>InConnectionString</i></p>
<p class=indent>
[Input]<br>
Browse request connection string (see “<i>InConnectionString</i> Argument” in “Comments”).</p>
<p class=dt>
<i>StringLength1</i></p>
<p class=indent>
[Input]<br>
Length of *<i>InConnectionString</i>.</p>
<p class=dt>
<i>OutConnectionString</i></p>
<p class=indent>
[Output]<br>
Pointer to a buffer in which to return the browse result connection string (see “<i>OutConnectionString</i> Argument” in “Comments”).</p>
<p class=dt>
<i>BufferLength</i></p>
<p class=indent>
[Input]<br>
Length of the *<i>OutConnectionString</i> buffer.</p>
<p class=dt>
<i>StringLength2Ptr</i></p>
<p class=indent>
[Output]<br>
The total number of bytes (excluding the null-termination byte) available to return in *<i>OutConnectionString</i>. If the number of bytes available to return is greater than or equal to <i>BufferLength</i>, the connection string in *<i>OutConnectionString</i> is truncated to <i>BufferLength</i> minus the length of a null-termination character.</p>
<p class=label>
<b>Returns</b></p>
<p>
SQL_SUCCESS, SQL_SUCCESS_WITH_INFO, SQL_NEED_DATA, SQL_ERROR, or SQL_INVALID_HANDLE.</p>
<p class=label>
<b>Diagnostics</b></p>
<p>
When <b>SQLBrowseConnect</b> returns SQL_ERROR, SQL_SUCCESS_WITH_INFO, or SQL_NEED_DATA, an associated SQLSTATE value may be obtained by calling <b>SQLGetDiagRec</b> with a <i>HandleType</i> of SQL_HANDLE_STMT and a <i>Handle of ConnectionHandle</i>. The following table lists the SQLSTATE values commonly returned by <b>SQLBrowseConnect </b>and explains each one in the context of this function; the notation “(DM)” precedes the descriptions of SQLSTATEs returned by the Driver Manager. The return code associated with each SQLSTATE value is SQL_ERROR, unless noted otherwise.</p>
<table border=1 cellpadding=5 cols=3 frame=below rules=rows width=595>
<tr valign=top>
<td class=label width=22%><b>SQLSTATE</b></td>
<td class=label width=26%><b>Error</b></td>
<td class=label width=52%><b>Description</b></td>
</tr>
<tr valign=top>
<td width=22%>01000</td>
<td width=26%>General warning</td>
<td width=52%>Driver-specific informational message. (Function returns SQL_SUCCESS_WITH_INFO.)</td>
</tr>
<tr valign=top>
<td width=22%>01004</td>
<td width=26%>String data, right truncated</td>
<td width=52%>The buffer *<i>OutConnectionString</i> was not large enough to return entire browse result connection string, so the string was truncated. The buffer *<i>StringLength2Ptr</i> contains the length of the untruncated browse result connection string. (Function returns SQL_SUCCESS_WITH_INFO.)</td>
</tr>
<tr valign=top>
<td width=22%>01S00</td>
<td width=26%>Invalid connection string attribute</td>
<td width=52%>An invalid attribute keyword was specified in the browse request connection string (<i>InConnectionString</i>). (Function returns SQL_NEED_DATA.)<p>
An attribute keyword was specified in the browse request connection string (<i>InConnectionString</i>) that does not apply to the current connection level. (Function returns SQL_NEED_DATA.)</p>
</td>
</tr>
<tr valign=top>
<td width=22%>01S02</td>
<td width=26%>Value changed</td>
<td width=52%>The driver did not support the specified value of the <i>ValuePtr</i> argument in <b>SQLSetConnectAttr</b> and substituted a similar value. (Function returns SQL_SUCCESS_WITH_INFO.)</td>
</tr>
<tr valign=top>
<td width=22%>08001</td>
<td width=26%>Client unable to establish connection</td>
<td width=52%>The driver was unable to establish a connection with the data source.</td>
</tr>
<tr valign=top>
<td width=22%>08002</td>
<td width=26%>Connection name in use</td>
<td width=52%>(DM) The specified connection had already been used to establish a connection with a data source and the connection was open.</td>
</tr>
<tr valign=top>
<td width=22%>08004</td>
<td width=26%>Server rejected the connection</td>
<td width=52%>The data source rejected the establishment of the connection for implementation-defined reasons.</td>
</tr>
<tr valign=top>
<td width=22%>08S01</td>
<td width=26%>Communication link failure</td>
<td width=52%>The communication link between the driver and the data source to which the driver was attempting to connect failed before the function completed processing.</td>
</tr>
<tr valign=top>
<td width=22%>28000</td>
<td width=26%>Invalid authorization specification</td>
<td width=52%>Either the user identifier or the authorization string or both as specified in the browse request connection string (<i>InConnectionString</i>) violated restrictions defined by the data source.</td>
</tr>
<tr valign=top>
<td width=22%>HY000</td>
<td width=26%>General error</td>
<td width=52%>An error occurred for which there was no specific SQLSTATE and for which no implementation-specific SQLSTATE was defined. The error message returned by <b>SQLGetDiagRec</b> in the <i>*MessageText</i> buffer describes the error and its cause. </td>
</tr>
<tr valign=top>
<td width=22%>HY001</td>
<td width=26%>Memory allocation error</td>
<td width=52%>(DM) The Driver Manager was unable to allocate memory required to support execution or completion of the function.<p>
The driver was unable to allocate memory required to support execution or completion of the function.</p>
</td>
</tr>
<tr valign=top>
<td width=22%>HY013</td>
<td width=26%>Memory management error</td>
<td width=52%>The function call could not be processed because the underlying memory objects could not be accessed, possibly because of low memory conditions.</td>
</tr>
<tr valign=top>
<td width=22%>HY090</td>
<td width=26%>Invalid string or buffer length</td>
<td width=52%>(DM) The value specified for argument <i>StringLength1</i> was less than 0 and was not equal to SQL_NTS.<p>
(DM) The value specified for argument <i>BufferLength</i> was less than 0.</p>
</td>
</tr>
<tr valign=top>
<td width=22%>HYT00</td>
<td width=26%>Timeout expired</td>
<td width=52%>The login timeout period expired before the connection to the data source completed. The timeout period is set through <b>SQLSetConnectAttr</b>, SQL_ATTR_LOGIN_TIMEOUT.</td>
</tr>
<tr valign=top>
<td width=22%>HYT01</td>
<td width=26%>Connection timeout expired</td>
<td width=52%>The connection timeout period expired before the data source responded to the request. The connection timeout period is set through <b>SQLSetConnectAttr</b>, SQL_ATTR_CONNECTION_TIMEOUT.</td>
</tr>
<tr valign=top>
<td width=22%>IM001</td>
<td width=26%>Driver does not support this function</td>
<td width=52%>(DM) The driver corresponding to the specified data source name does not support the function.</td>
</tr>
<tr valign=top>
<td width=22%>IM002</td>
<td width=26%>Data source not found and no default driver specified</td>
<td width=52%>(DM) The data source name specified in the browse request connection string (<i>InConnectionString</i>) was not found in the system information, nor was there a default driver specification.<p>
(DM) ODBC data source and default driver information could not be found in the system information.</p>
</td>
</tr>
<tr valign=top>
<td width=22%>IM003</td>
<td width=26%>Specified driver could not be loaded</td>
<td width=52%>(DM) The driver listed in the data source specification in the system information, or specified by the <b>DRIVER</b> keyword, was not found or could not be loaded for some other reason.</td>
</tr>
<tr valign=top>
<td width=22%>IM004</td>
<td width=26%>Driver’s SQLAllocHandle on SQL_HANDLE<br>
_ENV failed</td>
<td width=52%>(DM) During <b>SQLBrowseConnect</b>, the Driver Manager called the driver’s <b>SQLAllocHandle</b> function with a <i>HandleType</i> of SQL_HANDLE_ENV and the driver returned an error.</td>
</tr>
<tr valign=top>
<td width=22%>IM005</td>
<td width=26%>Driver’s SQLAllocHandle on SQL_HANDLE<br>
_DBC failed</td>
<td width=52%>(DM) During <b>SQLBrowseConnect</b>, the Driver Manager called the driver’s <b>SQLAllocHandle</b> function with a <i>HandleType</i> of SQL_HANDLE_DBC and the driver returned an error.</td>
</tr>
<tr valign=top>
<td width=22%>IM006</td>
<td width=26%>Driver’s SQLSetConnectAttr failed</td>
<td width=52%>(DM) During <b>SQLBrowseConnect</b>, the Driver Manager called the driver’s <b>SQLSetConnectAttr</b> function and the driver returned an error.</td>
</tr>
<tr valign=top>
<td width=22%>IM009</td>
<td width=26%>Unable to load translation DLL</td>
<td width=52%>The driver was unable to load the translation DLL that was specified for the data source or for the connection.</td>
</tr>
<tr valign=top>
<td width=22%>IM010</td>
<td width=26%>Data source name too long</td>
<td width=52%>(DM) The attribute value for the DSN keyword was longer than SQL_MAX_DSN_LENGTH characters.</td>
</tr>
<tr valign=top>
<td width=22%>IM011</td>
<td width=26%>Driver name too long</td>
<td width=52%>(DM) The attribute value for the DRIVER keyword was longer than 255 characters.</td>
</tr>
<tr valign=top>
<td width=22%>IM012</td>
<td width=26%>DRIVER keyword syntax error</td>
<td width=52%>(DM) The keyword-value pair for the DRIVER keyword contained a syntax error.</td>
</tr>
</table><br>
<p class=label>
<b>Comments</b></p>
<h1><i>InConnectionString</i> Argument</h1>
<p>
A browse request connection string has the following syntax:</p>
<p>
<i>connection-string</i> ::= <i>attribute</i>[;] | <i>attribute</i>; <i>connection-string</i><br>
<i>attribute</i> ::= <i>attribute-keyword</i>=<i>attribute-value</i> | DRIVER=[{]<i>attribute-value[</i>}]<br>
<i>attribute-keyword</i> ::= DSN | UID | PWD<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | <i>driver-defined-attribute-keyword</i><br>
<i>attribute-value</i> ::= <i>character-string</i><br>
<i>driver-defined-attribute-keyword</i> ::= <i>identifier</i></p>
<p>
where <i>character-string</i> has zero or more characters; <i>identifier</i> has one or more characters; <i>attribute-keyword</i> is not case-sensitive; <i>attribute-value</i> may be case-sensitive; and the value of the <b>DSN</b> keyword does not consist solely of blanks. Because of connection string and initialization file grammar, keywords and attribute values that contain the characters <b>[]{}(),;?*=!@</b> should be avoided. Because of the grammar in the system information, keywords and data source names cannot contain the backslash (\) character. For an ODBC 2<i>.x</i> driver, braces are required around the attribute value for the DRIVER keyword.</p>
<p>
If any keywords are repeated in the browse request connection string, the driver uses the value associated with the first occurrence of the keyword. If the <b>DSN</b> and <b>DRIVER</b> keywords are included in the same browse request connection string, the Driver Manager and driver use whichever keyword appears first.</p>
<p>
For information about how an application chooses a data source or driver, see “<a href="odch06pr_4p82.htm">Choosing a Data Source or Driver</a>” in Chapter 6, “Connecting to a Data Source or Driver.”</p>
<h1><i>OutConnectionString</i> Argument</h1>
<p>
The browse result connection string is a list of connection attributes. A connection attribute consists of an attribute keyword and a corresponding attribute value. The browse result connection string has the following syntax:</p>
<p>
<i>connection-string</i> ::= <i>attribute</i>[;] | <i>attribute</i>; <i>connection-string</i><br>
<i>attribute</i> ::= [*]<i>attribute-keyword=attribute-value</i><br>
<i>attribute-keyword</i> ::= <i>ODBC-attribute-keyword</i><br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | <i>driver-defined-attribute-keyword</i><br>
<i>ODBC-attribute-keyword</i> = {UID | PWD}[:<i>localized-identifier</i>]<br>
<i>driver-defined-attribute-keyword</i> ::= <i>identifier</i>[:<i>localized-identifier</i>]<br>
<i>attribute-value</i> ::= {<i>attribute-value-list</i>} | ?<br>
(The braces are literal; they are returned by the driver.)<br>
<i>attribute-value-list</i> ::= <i>character-string</i> [:<i>localized-character string</i>] | <i>character-string</i> [:<i>localized-character string</i>], <i>attribute-value-list</i></p>
<p>
where <i>character-string</i> and <i>localized-character string</i> have zero or more characters; <i>identifier</i> and <i>localized-identifier</i> have one or more characters; <i>attribute-keyword</i> is not case-sensitive; and <i>attribute-value</i> may be case-sensitive. Because of connection string and initialization file grammar, keywords, localized identifiers, and attribute values that contain the characters <b>[]{}(),;?*=!@</b> should be avoided. Because of the grammar in the system information, keywords and data source names cannot contain the backslash (\) character.</p>
<p>
The browse result connection string syntax is used according to the following semantic rules:
<ul type=disc>
<li>
If an asterisk (*) precedes an <i>attribute-keyword</i>, the <i>attribute</i> is optional, and may be omitted in the next call to <b>SQLBrowseConnect</b>.<br><br></li>
<li>
The attribute keywords <b>UID</b> and <b>PWD</b> have the same meaning as defined in <b>SQLDriverConnect</b>.<br><br></li>
<li>
A <i>driver-defined-attribute-keyword</i> names the kind of attribute for which an attribute value may be supplied. For example, it might be <b>SERVER</b>, <b>DATABASE</b>, <b>HOST</b>, or <b>DBMS</b>.<br><br></li>
<li>
<i>ODBC-attribute-keywords</i> and <i>driver-defined-attribute-keywords</i> include a localized or user-friendly version of the keyword. This might be used by applications as a label in a dialog box. However, <b>UID</b>, <b>PWD</b>, or the <i>identifier</i> alone must be used when passing a browse request string to the driver.<br><br></li>
<li>
The {<i>attribute-value-list</i>} is an enumeration of actual values valid for the corresponding <i>attribute-keyword</i>. Note that the braces ({}) do not indicate a list of choices; they are returned by the driver. For example, it might be a list of server names or a list of database names.<br><br></li>
<li>
If the <i>attribute-value</i> is a single question mark (?), a single value corresponds to the <i>attribute-keyword</i>. For example, UID=JohnS; PWD=Sesame.<br><br></li>
<li>
Each call to <b>SQLBrowseConnect</b> returns only the information required to satisfy the next level of the connection process. The driver associates state information with the connection handle so that the context can always be determined on each call.</li>
</ul>
<h1>Using SQLBrowseConnect</h1>
<p>
<b>SQLBrowseConnect</b> requires an allocated connection. The Driver Manager loads the driver that was specified in or that corresponds to the data source name specified in the initial browse request connection string; for information about when this occurs, see the “Comments” section in <a href="odch21cpr_7stw.htm">SQLConnect</a>. It may establish a connection with the data source during the browsing process. If <b>SQLBrowseConnect</b> returns SQL_ERROR, outstanding connections are terminated and the connection is returned to an unconnected state.</p>
<p class=indent>
<b><B>Note&nbsp;&nbsp;&nbsp;</B>SQLBrowseConnect</b> does not support connection pooling. If <b>SQLBrowseConnect</b> is called while connection pooling is enabled, SQLSTATE HY000 (General error) will be returned.</p>
<p>
When <b>SQLBrowseConnect</b> is called for the first time on a connection, the browse request connection string must contain the <b>DSN</b> keyword or the <b>DRIVER</b> keyword. If the browse request connection string contains the <b>DSN</b> keyword, the Driver Manager locates a corresponding data source specification in the system information:
<ul type=disc>
<li>
If the Driver Manager finds the corresponding data source specification, it loads the associated driver DLL; the driver can retrieve information about the data source from the system information.<br><br></li>
<li>
If the Driver Manager cannot find the corresponding data source specification, it locates the default data source specification and loads the associated driver DLL; the driver can retrieve information about the default data source from the system information. “DEFAULT” is passed to the driver for the DSN.<br><br></li>
<li>
If the Driver Manager cannot find the corresponding data source specification and there is no default data source specification, it returns SQL_ERROR with SQLSTATE IM002 (Data source not found and no default driver specified).</li>
</ul>
<p>
If the browse request connection string contains the <b>DRIVER</b> keyword, the Driver Manager loads the specified driver; it does not attempt to locate a data source in the system information. Because the <b>DRIVER</b> keyword does not use information from the system information, the driver must define enough keywords so that a driver can connect to a data source using only the information in the browse request connection strings.</p>
<p>
On each call to <b>SQLBrowseConnect</b>, the application specifies the connection attribute values in the browse request connection string. The driver returns successive levels of attributes and attribute values in the browse result connection string; it returns SQL_NEED_DATA as long as there are connection attributes that have not yet been enumerated in the browse request connection string. The application uses the contents of the browse result connection string to build the browse request connection string for the next call to <b>SQLBrowseConnect</b>. All mandatory attributes (those not preceded by an asterisk in the <i>OutConnectionString</i> argument) must be included in the next call to <b>SQLBrowseConnect</b>. Note that the application cannot use the contents of previous browse result connection strings when building the current browse request connection string; that is, it cannot specify different values for attributes set in previous levels.</p>
<p>
When all levels of connection and their associated attributes have been enumerated, the driver returns SQL_SUCCESS, the connection to the data source is complete, and a complete connection string is returned to the application. The connection string is suitable to use in conjunction with <b>SQLDriverConnect</b> with the SQL_DRIVER_NOPROMPT option to establish another connection. The complete connection string cannot be used in another call to <b>SQLBrowseConnect</b>, however; if <b>SQLBrowseConnect</b> were called again, the entire sequence of calls would have to be repeated.</p>
<p>
<b>SQLBrowseConnect</b> also returns SQL_NEED_DATA if there are recoverable, nonfatal errors during the browse process; for example, an invalid password or attribute keyword supplied by the application. When SQL_NEED_DATA is returned and the browse result connection string is unchanged, an error has occurred and the application can call <b>SQLGetDiagRec</b> to return the SQLSTATE for browse-time errors. This permits the application to correct the attribute and continue the browse.</p>
<p>
An application can terminate the browse process at any time by calling <b>SQLDisconnect</b>. The driver will terminate any outstanding connections and return the connection to an unconnected state.</p>
<p>
For more information, see “<a href="odch06pr_1kqc.htm">Connecting With SQLBrowseConnect</a>” in Chapter 6, “Connecting to a Data Source or Driver.”</p>
<p>
If a driver supports <b>SQLBrowseConnect</b>, the driver keyword section in the system information for the driver must contain the <b>ConnectFunctions</b> keyword with the third character set to “Y.”</p>
<p class=label>
<b>Code Example</b></p>
<p>
In the following example, an application calls <b>SQLBrowseConnect</b> repeatedly. Each time <b>SQLBrowseConnect</b> returns SQL_NEED_DATA, it passes back information about the data it needs in *<i>OutConnectionString</i>. The application passes <i>OutConnectionString</i> to its routine <b>GetUserInput</b> (not shown). <b>GetUserInput</b> parses the information, builds and displays a dialog box, and returns the information entered by the user in *<i>InConnectionString</i>. The application passes the user’s information to the driver in the next call to <b>SQLBrowseConnect</b>. After the application has provided all necessary information for the driver to connect to the data source, <b>SQLBrowseConnect</b> returns SQL_SUCCESS and the application proceeds.</p>
<p>
For a more detailed example of connecting to a SQL Server driver by calling <b>SQLBrowseConnect</b>, see “<a href="odch06pr_3qsl.htm">SQL Server Browsing Example</a>” in Chapter 6, “Connecting to a Data Source or Driver.”</p>
<p>
For example, to connect to the data source Sales, the following actions might occur. First, the application passes the following string to <b>SQLBrowseConnect</b>:</p>
<pre><code>"DSN=Sales"
</code></pre>
<p>
The Driver Manager loads the driver associated with the data source Sales. It then calls the driver’s <b>SQLBrowseConnect</b> function with the same arguments it received from the application. The driver returns the following string in *<i>OutConnectionString</i>:</p>
<pre><code>"HOST:Server={red,blue,green};UID:ID=?;PWD:Password=?"
</code></pre>
<p>
The application passes this string to its <b>GetUserInput</b> routine, which builds a dialog box that asks the user to select the red, blue, or green server, and to enter a user ID and password. The routine passes the following user-specified information back in *<i>InConnectionString</i>, which the application passes to <b>SQLBrowseConnect</b>:</p>
<pre><code>"HOST=red;UID=Smith;PWD=Sesame"
</code></pre>
<p>
<b>SQLBrowseConnect</b> uses this information to connect to the red server as Smith with the password Sesame, and then returns the following string in *<i>OutConnectionString</i>:</p>
<pre><code>"*DATABASE:Database={SalesEmployees,SalesGoals,SalesOrders}"
</code></pre>
<p>
The application passes this string to its <b>GetUserInput</b> routine, which builds a dialog box that asks the user to select a database. The user selects empdata and the application calls <b>SQLBrowseConnect</b> a final time with this string:</p>
<pre><code>"DATABASE=SalesOrders"
</code></pre>
<p>
This is the final piece of information the driver needs to connect to the data source; <b>SQLBrowseConnect</b> returns SQL_SUCCESS and *<i>OutConnectionString</i> contains the completed connection string:</p>
<pre><code>"DSN=Sales;HOST=red;UID=Smith;PWD=Sesame;DATABASE=SalesOrders"

#define BRWS_LEN 100
SQLHENV&nbsp; henv;
SQLHDBC&nbsp; hdbc;
SQLHSTMT&nbsp;&nbsp; hstmt;
SQLRETURN&nbsp; retcode;
SQLCHAR&nbsp; szConnStrIn[BRWS_LEN], szConnStrOut[BRWS_LEN];
SQLSMALLINT&nbsp; cbConnStrOut;

/* Allocate the environment handle. */
retcode = SQLAllocHandle(SQL_HANDLE_ENV, SQL_NULL_HANDLE, &amp;henv);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
   
if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {
   /* Set the version environment attribute. */
   retcode = SQLSetEnvAttr(henv, SQL_ATTR_ODBC_VERSION, SQL_OV_ODBC3, 0);

   if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {
      /* Allocate the connection handle. */
      retcode = SQLAllocHandle(SQL_HANDLE_DBC, henv, &amp;hdbc);

      if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {

      /* Call SQLBrowseConnect until it returns a value other than */
      /* SQL_NEED_DATA (pass the data source name the first time). */
      /* If SQL_NEED_DATA is returned, call GetUserInput (not&nbsp; */
      /* shown) to build a dialog from the values in szConnStrOut. */
      /* The user-supplied values are returned in szConnStrIn,&nbsp;&nbsp; */
      /* which is passed in the next call to SQLBrowseConnect.&nbsp;&nbsp; */

         lstrcpy(szConnStrIn, "DSN=Sales");
         do {
            retcode = SQLBrowseConnect(hdbc, szConnStrIn, SQL_NTS,
             &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; szConnStrOut, BRWS_LEN, &amp;cbConnStrOut);
            if (retcode == SQL_NEED_DATA)
               GetUserInput(szConnStrOut, szConnStrIn);
         } while (retcode == SQL_NEED_DATA);

         if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO){

            /* Allocate the statement handle. */
            retcode = SQLAllocHandle(SQL_HANDLE_STMT, hdbc, &amp;hstmt);

            if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {
            /* Process data after successful connection */
               ...;
               ...;
               ...;
               SQLFreeHandle(SQL_HANDLE_STMT, hstmt);
            }
            SQLDisconnect(hdbc);
         }
      }
      SQLFreeHandle(SQL_HANDLE_DBC, hdbc);
   }
}
SQLFreeHandle(SQL_HANDLE_ENV, henv);
</code></pre>
<p class=label>
<b>Related Functions</b></p>
<table border=1 cellpadding=5 cols=2 frame=below rules=rows width=595>
<tr valign=top>
<td class=label width=48%><b>For information about</b></td>
<td class=label width=52%><b>See</b></td>
</tr>
<tr valign=top>
<td width=48%>Allocating a connection handle</td>
<td width=52%><a href="odch21bpr_689x.htm">SQLAllocHandle</a></td>
</tr>
<tr valign=top>
<td width=48%>Connecting to a data source</td>
<td width=52%><a href="odch21cpr_7stw.htm">SQLConnect</a></td>
</tr>
<tr valign=top>
<td width=48%>Disconnecting from a data source</td>
<td width=52%><a href="odch21dpr_26us.htm">SQLDisconnect</a></td>
</tr>
<tr valign=top>
<td width=48%>Connecting to a data source using a connection string or dialog box</td>
<td width=52%><a href="odch21dpr_4ed0.htm">SQLDriverConnect</a></td>
</tr>
<tr valign=top>
<td width=48%>Returning driver descriptions and attributes</td>
<td width=52%><a href="odch21dpr_3pwz.htm">SQLDrivers</a></td>
</tr>
<tr valign=top>
<td width=48%>Freeing a connection handle</td>
<td width=52%><a href="odch21fpr_6679.htm">SQLFreeHandle</a></td>
</tr>
</table><br>
</font></BODY>
</HTML>
