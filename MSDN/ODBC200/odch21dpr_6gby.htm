<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>SQLEndTran</title>
<link disabled rel=stylesheet href=msdn_ie3.css>
<style type="text/css">
@import url(msdn_ie4.css);
</style>
</HEAD>
<BODY>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

	<!--TOOLBAR_START-->
	<!--TOOLBAR_EXEMPT-->
	<!--TOOLBAR_END-->


<h1><a name="odbcsqlendtran"></a>SQLEndTran</h1>
<p class=label>
<b>Conformance</b></p>
<p>
Version Introduced:ODBC 3.0<br>
Standards Compliance:ISO 92</p>
<p class=label>
<b>Summary</b></p>
<p>
<b>SQLEndTran</b> requests a commit or rollback operation for all active operations on all statements associated with a connection. <b>SQLEndTran</b> can also request that a commit or rollback operation be performed for all connections associated with an environment.</p>
<p class=indent>
<B><b>Note</b></B> For more information about what the Driver Manager maps this function to when an ODBC 3.x application is working with an ODBC 2<i>.x</i> driver, see “<a href="odch17pr_6mpf.htm">Mapping Replacement Functions for Backward Compatibility of Applications</a>” in Chapter 17, “Programming Considerations.”</p>
<p class=label>
<b>Syntax</b></p>
<p>
SQLRETURN <b>SQLEndTran</b>(<br>
SQLSMALLINT<i>HandleType</i>,<br>
SQLHANDLE<i>Handle</i>,<br>
SQLSMALLINT<i>CompletionType</i>);</p>
<p class=label>
<b>Arguments</b></p>
<p class=dt>
<i>HandleType</i></p>
<p class=indent>
[Input]<br>
Handle type identifier. Contains either SQL_HANDLE_ENV if <i>Handle</i> is an environment handle, or SQL_HANDLE_DBC if <i>Handle</i> is a connection handle.</p>
<p class=dt>
<i>Handle</i></p>
<p class=indent>
[Input]<br>
The handle, of the type indicated by <i>HandleType</i>, indicating the scope of the transaction. See “Comments” for more information.</p>
<p class=dt>
<i>CompletionType</i></p>
<p class=indent>
[Input]<br>
One of the following two values:</p>
<p class=tl>
SQL_COMMIT<br>
SQL_ROLLBACK</P><p class=label>
<b>Returns</b></p>
<p>
SQL_SUCCESS, SQL_SUCCESS_WITH_INFO, SQL_ERROR, or SQL_INVALID_HANDLE.</p>
<p class=label>
<b>Diagnostics</b></p>
<p>
When <b>SQLEndTran</b> returns SQL_ERROR or SQL_SUCCESS_WITH_INFO, an associated SQLSTATE value may be obtained by calling <b>SQLGetDiagRec</b> with the appropriate <i>HandleType</i> and <i>Handle</i>. The following table lists the SQLSTATE values commonly returned by <b>SQLEndTran</b> and explains each one in the context of this function; the notation “(DM)” precedes the descriptions of SQLSTATEs returned by the Driver Manager. The return code associated with each SQLSTATE value is SQL_ERROR, unless noted otherwise.</p>
<table border=1 cellpadding=5 cols=3 frame=below rules=rows width=587>
<tr valign=top>
<td class=label width=22%><b>SQLSTATE</b></td>
<td class=label width=26%><b>Error</b></td>
<td class=label width=52%><b>Description</b></td>
</tr>
<tr valign=top>
<td width=22%>01000</td>
<td width=26%>General warning</td>
<td width=52%>Driver-specific informational message. (Function returns SQL_SUCCESS_WITH_INFO.)</td>
</tr>
<tr valign=top>
<td width=22%>08003</td>
<td width=26%>Connection not open</td>
<td width=52%>(DM) The <i>HandleType</i> was SQL_HANDLE_DBC, and the <i>Handle</i> was not in a connected state.</td>
</tr>
<tr valign=top>
<td width=22%>08007</td>
<td width=26%>Connection failure during transaction</td>
<td width=52%>The <i>HandleType</i> was SQL_HANDLE_DBC, and the connection associated with the <i>Handle</i> failed during the execution of the function and it cannot be determined whether the requested <b>COMMIT</b> or <b>ROLLBACK</b> occurred before the failure.</td>
</tr>
<tr valign=top>
<td width=22%>25S01</td>
<td width=26%>Transaction state unknown</td>
<td width=52%>One or more of the connections in <i>Handle</i> failed to complete the transaction with the outcome specified, and the outcome is unknown.</td>
</tr>
<tr valign=top>
<td width=22%>25S02</td>
<td width=26%>Transaction is still active</td>
<td width=52%>The driver was not able to guarantee that all work in the global transaction could be completed atomically, and the transaction is still active.</td>
</tr>
<tr valign=top>
<td width=22%>25S03</td>
<td width=26%>Transaction is rolled back</td>
<td width=52%>The driver was not able to guarantee that all work in the global transaction could be completed atomically, and all work in the transaction active in <i>Handle</i> was rolled back.</td>
</tr>
<tr valign=top>
<td width=22%>40001</td>
<td width=26%>Serialization failure</td>
<td width=52%>The transaction was rolled back due to a resource deadlock with another transaction.</td>
</tr>
<tr valign=top>
<td width=22%>40002</td>
<td width=26%>Integrity constraint violation</td>
<td width=52%>The <i>CompletionType</i> was SQL_COMMIT, and the commitment of changes caused integrity constraint violation. As a result, the transaction was rolled back.</td>
</tr>
<tr valign=top>
<td width=22%>HY000</td>
<td width=26%>General error</td>
<td width=52%>An error occurred for which there was no specific SQLSTATE and for which no implementation-specific SQLSTATE was defined. The error message returned by <b>SQLGetDiagRec</b> in the <i>*szMessageText</i> buffer describes the error and its cause.</td>
</tr>
<tr valign=top>
<td width=22%>HY001</td>
<td width=26%>Memory allocation error</td>
<td width=52%>The driver was unable to allocate memory required to support execution or completion of the function.</td>
</tr>
<tr valign=top>
<td width=22%>HY010</td>
<td width=26%>Function sequence error</td>
<td width=52%>(DM) An asynchronously executing function was called for a <i>StatementHandle</i> associated with the <i>ConnectionHandle</i> and was still executing when <b>SQLEndTran</b> was called.<p>
(DM) <b>SQLExecute</b>, <b>SQLExecDirect</b>, <b>SQLBulkOperations</b>, or <b>SQLSetPos</b> was called for a <i>StatementHandle</i> associated with the <i>ConnectionHandle</i> and returned SQL_NEED_DATA. This function was called before data was sent for all data-at-execution parameters or columns.</p>
</td>
</tr>
<tr valign=top>
<td width=22%>HY012</td>
<td width=26%>Invalid transaction operation code</td>
<td width=52%>(DM) The value specified for the argument <i>CompletionType</i> was neither SQL_COMMIT nor SQL_ROLLBACK.</td>
</tr>
<tr valign=top>
<td width=22%>HY013</td>
<td width=26%>Memory management error</td>
<td width=52%>The function call could not be processed because the underlying memory objects could not be accessed, possibly because of low memory conditions.</td>
</tr>
<tr valign=top>
<td width=22%>HY092</td>
<td width=26%>Invalid attribute/option identifier</td>
<td width=52%>(DM) The value specified for the argument <i>HandleType</i> was neither SQL_HANDLE_ENV nor SQL_HANDLE_DBC.</td>
</tr>
<tr valign=top>
<td width=22%>HYC00</td>
<td width=26%>Optional feature not implemented</td>
<td width=52%>The driver or data source does not support the <b>ROLLBACK</b> operation.</td>
</tr>
<tr valign=top>
<td width=22%>HYT01</td>
<td width=26%>Connection timeout expired</td>
<td width=52%>The connection timeout period expired before the data source responded to the request. The connection timeout period is set through <b>SQLSetConnectAttr</b>, SQL_ATTR_CONNECTION_TIMEOUT.</td>
</tr>
<tr valign=top>
<td width=22%>IM001</td>
<td width=26%>Driver does not support this function</td>
<td width=52%>(DM) The driver associated with the <i>ConnectionHandle</i> does not support the function.</td>
</tr>
</table><br>
<p class=label>
<b>Comments</b></p>
<p>
For an ODBC 3.x driver, if <i>HandleType</i> is SQL_HANDLE_ENV and <i>Handle</i> is a valid environment handle, then the Driver Manager will call <b>SQLEndTran</b> in each driver associated with the environment. The <i>Handle</i> argument for the call to a driver will be the driver’s environment handle. For an ODBC 2.<i>x</i> driver, if <i>HandleType</i> is SQL_HANDLE_ENV and <i>Handle</i> is a valid environment handle, and there are multiple connections in a connected state in that environment, then the Driver Manager will call <b>SQLTransact</b> in the driver once for each connection in a connected state in that environment. The <i>Handle</i> argument in each call will be the connection’s handle. In either case, the driver will attempt to commit or roll back transactions, depending on the value of <i>CompletionType</i>, on all connections that are in a connected state on that environment. Connections that are not active do not affect the transaction. </p>
<p class=indent>
<B><b>Note</b></B> <b>SQLEndTran</b> cannot be used to commit or roll back transactions on a shared environment. SQLSTATE HY092 (Invalid attribute/option identifier) will be returned if <b>SQLEndTran</b> is called with <i>Handle</i> set to either the handle of a shared environment, or the handle of a connection on a shared environment. </p>
<p>
The Driver Manager will return SQL_SUCCESS only if it receives SQL_SUCCESS for each connection. If the Driver Manager receives SQL_ERROR on one or more connections, it returns SQL_ERROR to the application, and the diagnostic information is placed in the diagnostic data structure of the environment. To determine which connection or connections failed during the commit or rollback operation, the application can call <b>SQLGetDiagRec</b> for each connection.</p>
<p class=indent>
<B><b>Note</b></B> The Driver Manager does not simulate a global transaction across all connections, and therefore does not use two-phase commit protocols.</p>
<p>
If <i>CompletionType</i> is SQL_COMMIT, <b>SQLEndTran</b> issues a commit request for all active operations on any statement associated with an affected connection. If <i>CompletionType</i> is SQL_ROLLBACK, <b>SQLEndTran</b> issues a rollback request for all active operations on any statement associated with an affected connection. If no transactions are active, <b>SQLEndTran</b> returns SQL_SUCCESS with no effect on any data sources. For more information, see “<a href="odch14pr_7tgz.htm">Committing and Rolling Back Transactions</a>” in Chapter 14, “Transactions.”</p>
<p>
If the driver is in manual-commit mode (by calling <b>SQLSetConnectAttr</b> with the SQL_ATTR_AUTOCOMMIT attribute set to SQL_AUTOCOMMIT_OFF), a new transaction is implicitly started when an SQL statement that can be contained within a transaction is executed against the current data source. For more information, see “<a href="odch14pr_37fp.htm">Commit Mode</a>” in Chapter 14, “Transactions.”</p>
<p>
To determine how transaction operations affect cursors, an application calls <b>SQLGetInfo</b> with the SQL_CURSOR_ROLLBACK_BEHAVIOR and SQL_CURSOR_COMMIT_BEHAVIOR options. For more information, see the following paragraphs and “<a href="odch14pr_26wj.htm">Effect of Transactions on Cursors and Prepared Statements</a>” in Chapter 14, “Transactions.”</p>
<p>
If the SQL_CURSOR_ROLLBACK_BEHAVIOR or SQL_CURSOR_COMMIT_BEHAVIOR value equals SQL_CB_DELETE, <b>SQLEndTran</b> closes and deletes all open cursors on all statements associated with the connection and discards all pending results. <b>SQLEndTran</b> leaves any statement present in an allocated (unprepared) state; the application can reuse them for subsequent SQL requests or can call <b>SQLFreeStmt</b> or <b>SQLFreeHandle</b> with a <i>HandleType</i> of SQL_HANDLE_STMT to deallocate them.</p>
<p>
If the SQL_CURSOR_ROLLBACK_BEHAVIOR or SQL_CURSOR_COMMIT_BEHAVIOR value equals SQL_CB_CLOSE, <b>SQLEndTran</b> closes all open cursors on all statements associated with the connection. <b>SQLEndTran</b> leaves any statement present in a prepared state; the application can call <b>SQLExecute</b> for a statement associated with the connection without first calling <b>SQLPrepare</b>.</p>
<p>
If the SQL_CURSOR_ROLLBACK_BEHAVIOR or SQL_CURSOR_COMMIT_BEHAVIOR value equals SQL_CB_PRESERVE, <b>SQLEndTran</b> does not affect open cursors associated with the connection. Cursors remain at the row they pointed to prior to the call to <b>SQLEndTran</b>.</p>
<p>
For drivers and data sources that support transactions, calling <b>SQLEndTran</b> with either SQL_COMMIT or SQL_ROLLBACK when no transaction is active returns SQL_SUCCESS (indicating that there is no work to be committed or rolled back) and has no effect on the data source.</p>
<p>
When a driver is in autocommit mode, the Driver Manager does not call <b>SQLEndTran</b> in the driver. <b>SQLEndTran</b> always returns SQL_SUCCESS regardless of whether it is called with a <i>CompletionType</i> of SQL_COMMIT or SQL_ROLLBACK.</p>
<p>
Drivers or data sources that do not support transactions (<b>SQLGetInfo</b> <i>option</i> SQL_TXN_CAPABLE is SQL_TC_NONE) are effectively always in autocommit mode, and therefore, always return SQL_SUCCESS for <b>SQLEndTran</b> regardless of whether they are called with a <i>CompletionType</i> of SQL_COMMIT or SQL_ROLLBACK. Such drivers and data sources do not actually roll back transactions when requested to do so. </p>
<p class=label>
<b>Related Functions</b></p>
<table border=1 cellpadding=5 cols=2 frame=below rules=rows width=587>
<tr valign=top>
<td class=label width=48%><b>For information about</b></td>
<td class=label width=52%><b>See</b></td>
</tr>
<tr valign=top>
<td width=48%>Returning information about a driver or data source</td>
<td width=52%><a href="odch21gpr_5fu7.htm">SQLGetInfo</a></td>
</tr>
<tr valign=top>
<td width=48%>Freeing a handle</td>
<td width=52%><a href="odch21fpr_6679.htm">SQLFreeHandle</a></td>
</tr>
<tr valign=top>
<td width=48%>Freeing a statement handle</td>
<td width=52%><a href="odch21fpr_84hg.htm">SQLFreeStmt</a></td>
</tr>
</table><br>
</font></BODY>
</HTML>
