<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>SQLCancel</title>
<link disabled rel=stylesheet href=msdn_ie3.css>
<style type="text/css">
@import url(msdn_ie4.css);
</style>
</HEAD>
<BODY>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

	<!--TOOLBAR_START-->
	<!--TOOLBAR_EXEMPT-->
	<!--TOOLBAR_END-->


<h1><a name="odbcsqlcancel"></a>SQLCancel</h1>
<p class=label>
<b>Conformance</b></p>
<p>
Version Introduced:ODBC 1.0<br>
Standards Compliance:ISO 92</p>
<p class=label>
<b>Summary</b></p>
<p>
<b>SQLCancel</b> cancels the processing on a statement.</p>
<p class=label>
<b>Syntax</b></p>
<p>
SQLRETURN <b>SQLCancel</b>(<br>
SQLHSTMT<i>StatementHandle</i>);</p>
<p class=label>
<b>Arguments</b></p>
<p class=dt>
<i>StatementHandle</i></p>
<p class=indent>
[Input]<br>
Statement handle.</p>
<p class=label>
<b>Returns</b></p>
<p>
SQL_SUCCESS, SQL_SUCCESS_WITH_INFO, SQL_ERROR, or SQL_INVALID_HANDLE.</p>
<p class=label>
<b>Diagnostics</b></p>
<p>
When <b>SQLCancel</b> returns SQL_ERROR or SQL_SUCCESS_WITH_INFO, an associated SQLSTATE value can be obtained by calling <b>SQLGetDiagRec</b> with a <i>HandleType</i> of SQL_HANDLE_STMT and a <i>Handle</i> of <i>StatementHandle</i>. The following table lists the SQLSTATE values commonly returned by <b>SQLCancel </b>and explains each one in the context of this function; the notation “(DM)” precedes the descriptions of SQLSTATEs returned by the Driver Manager. The return code associated with each SQLSTATE value is SQL_ERROR, unless noted otherwise.</p>
<table border=1 cellpadding=5 cols=3 frame=below rules=rows width=595>
<tr valign=top>
<td class=label width=22%><b>SQLSTATE</b></td>
<td class=label width=26%><b>Error</b></td>
<td class=label width=52%><b>Description</b></td>
</tr>
<tr valign=top>
<td width=22%>01000</td>
<td width=26%>General warning</td>
<td width=52%>Driver-specific informational message. (Function returns SQL_SUCCESS_WITH_INFO.)</td>
</tr>
<tr valign=top>
<td width=22%>HY000</td>
<td width=26%>General error</td>
<td width=52%>An error occurred for which there was no specific SQLSTATE and for which no implementation-specific SQLSTATE was defined. The error message returned by <a href="odch21gpr_6x0j.htm">SQLGetDiagRec</a> in the argument <i>*MessageText</i> buffer describes the error and its cause.</td>
</tr>
<tr valign=top>
<td width=22%>HY001</td>
<td width=26%>Memory allocation error</td>
<td width=52%>The driver was unable to allocate memory required to support execution or completion of the function.</td>
</tr>
<tr valign=top>
<td width=22%>HY013</td>
<td width=26%>Memory management error</td>
<td width=52%>The function call could not be processed because the underlying memory objects could not be accessed, possibly because of low memory conditions.</td>
</tr>
<tr valign=top>
<td width=22%>HY018</td>
<td width=26%>Server declined cancel request</td>
<td width=52%>The server declined the cancel request.</td>
</tr>
<tr valign=top>
<td width=22%>HYT01</td>
<td width=26%>Connection timeout expired</td>
<td width=52%>The connection timeout period expired before the data source responded to the request. The connection timeout period is set through <b>SQLSetConnectAttr</b>, SQL_ATTR_CONNECTION_TIMEOUT.</td>
</tr>
<tr valign=top>
<td width=22%>IM001</td>
<td width=26%>Driver does not support this function</td>
<td width=52%>(DM) The driver associated with the <i>StatementHandle</i> does not support the function.</td>
</tr>
</table><br>
<p class=label>
<b>Comments</b></p>
<p>
<b>SQLCancel</b> can cancel the following types of processing on a statement:
<ul type=disc>
<li>
A function running asynchronously on the statement.<br><br></li>
<li>
A function on a statement that needs data.<br><br></li>
<li>
A function running on the statement on another thread.</li>
</ul>
<p>
In ODBC 2.<i>x</i>, if an application calls <b>SQLCancel</b> when no processing is being done on the statement, <b>SQLCancel</b> has the same effect as <b>SQLFreeStmt</b> with the SQL_CLOSE option; this behavior is defined only for completeness and applications should call <b>SQLFreeStmt</b> or <b>SQLCloseCursor</b> to close cursors. In ODBC 3.x, this is not the case; a call to <b>SQLCancel</b> when no processing is being done on the statement is not treated as <b>SQLFreeStmt</b> with the SQL_CLOSE option, but has no effect at all. To close a cursor, an application should call <b>SQLCloseCursor</b>, not <b>SQLCancel</b>.</p>
<p>
When <b>SQLCancel</b> is called, diagnostic records are returned for a function running asynchronously in a statement, or for a function on a statement that needs data; diagnostic records are not returned, however, for a function running on a statement on another thread.</p>
<h1>Canceling Asynchronous Processing</h1>
<p>
After an application calls a function asynchronously, it calls the function repeatedly to determine whether it has finished processing. If the function is still processing, it returns SQL_STILL_EXECUTING. If the function has finished processing, it returns a different code.</p>
<p>
After any call to the function that returns SQL_STILL_EXECUTING, an application can call <b>SQLCancel</b> to cancel the function. If the cancel request is successful, the driver returns SQL_SUCCESS. This message does not indicate that the function was actually canceled; it indicates that the cancel request was processed. When or if the function is actually canceled is driver-dependent and data source&nbsp;–&nbsp;dependent. The application must continue to call the original function until the return code is not SQL_STILL_EXECUTING. If the function was successfully canceled, the return code is SQL_ERROR and SQLSTATE HY008 (Operation canceled). If the function completed its normal processing, the return code is SQL_SUCCESS or SQL_SUCCESS_WITH_INFO if the function succeeded or SQL_ERROR and a SQLSTATE other than HY008 (Operation canceled) if the function failed.</p>
<p>
For more information about asynchronous processing, see “<a href="odch09pr_5wdq.htm">Asynchronous Execution</a>” in Chapter 9, “Executing Statements.”</p>
<h1>Canceling Functions that Need Data</h1>
<p>
After <b>SQLExecute</b> or <b>SQLExecDirect</b> returns SQL_NEED_DATA and before data has been sent for all data-at-execution parameters, an application can call <b>SQLCancel</b> to cancel the statement execution. After the statement has been canceled, the application can call <b>SQLExecute</b> or <b>SQLExecDirect</b> again. For more information, see <a href="odch21bpr_6jhu.htm">SQLBindParameter</a>.</p>
<p>
After <b>SQLBulkOperations</b> or <b>SQLSetPos</b> returns SQL_NEED_DATA and before data has been sent for all data-at-execution columns, an application can call <b>SQLCancel</b> to cancel the operation. After the operation has been canceled, the application can call <b>SQLBulkOperations</b> or <b>SQLSetPos</b> again; canceling does not affect the cursor state or the current cursor position. For more information, see <a href="odch21bpr_9er7.htm">SQLBulkOperations</a> or <a href="odch21kpr_2rsj.htm">SQLSetPos</a>.</p>
<h1>Canceling Functions in Multithread Applications</h1>
<p>
In a multithread application, the application can cancel a function that is running synchronously on a statement. To cancel the function, the application calls <b>SQLCancel</b> with the same statement handle as that used by the target function, but on a different thread. How the function is canceled depends upon the driver and the operating system. As in canceling a function running asynchronously, the return code of the <b>SQLCancel</b> indicates only whether the driver processed the request successfully. Only SQL_SUCCESS or SQL_ERROR can be returned; no SQLSTATEs are returned. If the original function is canceled, it returns SQL_ERROR and SQLSTATE HY008 (Operation canceled).</p>
<p>
If an SQL statement is being executed when <b>SQLCancel</b> is called on another thread to cancel the statement execution, it is possible that the execution succeeds and returns SQL_SUCCESS, while the cancel is also successful. In this case, the Driver Manager assumes that the cursor opened by the statement execution is closed by the cancel, so the application will not be able to use the cursor.</p>
<p>
For more information about threading, see “<a href="odch17pr_3kkn.htm">Multithreading</a>” in Chapter 17, “Programming Considerations.”</p>
<p class=label>
<b>Related Functions</b></p>
<table border=1 cellpadding=5 cols=2 frame=below rules=rows width=595>
<tr valign=top>
<td class=label width=52%><b>For information about</b></td>
<td class=label width=48%><b>See</b></td>
</tr>
<tr valign=top>
<td width=52%>Binding a buffer to a parameter</td>
<td width=48%><a href="odch21bpr_6jhu.htm">SQLBindParameter</a></td>
</tr>
<tr valign=top>
<td width=52%>Performing bulk insert or update operations</td>
<td width=48%><a href="odch21bpr_9er7.htm">SQLBulkOperations</a></td>
</tr>
<tr valign=top>
<td width=52%>Executing an SQL statement</td>
<td width=48%><a href="odch21epr_35x0.htm">SQLExecDirect</a></td>
</tr>
<tr valign=top>
<td width=52%>Executing a prepared SQL statement</td>
<td width=48%><a href="odch21epr_0yg5.htm">SQLExecute</a></td>
</tr>
<tr valign=top>
<td width=52%>Freeing a statement handle</td>
<td width=48%><a href="odch21fpr_84hg.htm">SQLFreeStmt</a></td>
</tr>
<tr valign=top>
<td width=52%>Obtaining a field of a diagnostic record or a field of the diagnostic header</td>
<td width=48%><a href="odch21gpr_009w.htm">SQLGetDiagField</a></td>
</tr>
<tr valign=top>
<td width=52%>Obtaining multiple fields of a diagnostic data structure</td>
<td width=48%><a href="odch21gpr_6x0j.htm">SQLGetDiagRec</a></td>
</tr>
<tr valign=top>
<td width=52%>Returning the next parameter to send data for</td>
<td width=48%><a href="odch21ipr_11i9.htm">SQLParamData</a></td>
</tr>
<tr valign=top>
<td width=52%>Sending parameter data at execution time</td>
<td width=48%><a href="odch21jpr_2cf5.htm">SQLPutData</a></td>
</tr>
<tr valign=top>
<td width=52%>Positioning the cursor in a rowset, refreshing data in the rowset, or updating or deleting data in the result set</td>
<td width=48%><a href="odch21kpr_2rsj.htm">SQLSetPos</a></td>
</tr>
</table><br>
</font></BODY>
</HTML>
