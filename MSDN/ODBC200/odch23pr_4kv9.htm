<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>SQLCreateDataSource</title>
<link disabled rel=stylesheet href=msdn_ie3.css>
<style type="text/css">
@import url(msdn_ie4.css);
</style>
</HEAD>
<BODY>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

	<!--TOOLBAR_START-->
	<!--TOOLBAR_EXEMPT-->
	<!--TOOLBAR_END-->


<h1><a name="odbcsqlcreatedatasource"></a>SQLCreateDataSource</h1>
<p class=label>
<b>Conformance</b></p>
<p>
Version Introduced: ODBC 2.0</p>
<p class=label>
<b>Summary</b></p>
<p>
<b>SQLCreateDataSource</b> displays a dialog box with which the user can add a data source.</p>
<p class=label>
<b>Syntax</b></p>
<p>
BOOL <b>SQLCreateDataSource</b>(<br>
&nbsp;&nbsp;&nbsp;HWND&nbsp;&nbsp;&nbsp;<i>hwnd</i>,<br>
&nbsp;&nbsp;&nbsp;LPSTR&nbsp;&nbsp;&nbsp;<i>lpszDS</i>);</p>
<p class=label>
<b>Arguments</b></p>
<p class=dt>
<i>hwnd</i></p>
<p class=indent>
[Input]<br>
Parent window handle.</p>
<p class=dt>
<i>lpszDS</i></p>
<p class=indent>
[Input]<br>
Data source name. <i>lpszDS</i> can be a null pointer or an empty string.</p>
<p class=label>
<b>Returns</b></p>
<p>
<b>SQLCreateDataSource</b> returns TRUE if the data source is created. Otherwise, it returns FALSE.</p>
<p class=label>
<b>Diagnostics</b></p>
<p>
When <b>SQLCreateDataSource</b> returns FALSE, an associated <i>*pfErrorCode</i> value may be obtained by calling <b>SQLInstallerError</b>. The following table lists the <i>*pfErrorCode</i> values that can be returned by <b>SQLInstallerError </b>and explains each one in the context of this function.</p>
<table border=1 cellpadding=5 cols=3 frame=below rules=rows width=587>
<tr valign=top>
<td class=label width=30%><b><i>*pfErrorCode</i></b></td>
<td class=label width=24%><b>Error</b></td>
<td class=label width=46%><b>Description</b></td>
</tr>
<tr valign=top>
<td width=30%>ODBC_ERROR_<br>
GENERAL_ERR</td>
<td width=24%>General installer error</td>
<td width=46%>An error occurred for which there was no specific installer error.</td>
</tr>
<tr valign=top>
<td width=30%>ODBC_ERROR_<br>
INVALID_HWND</td>
<td width=24%>Invalid window handle</td>
<td width=46%>The <i>hwnd</i> argument was invalid or NULL.</td>
</tr>
<tr valign=top>
<td width=30%>ODBC_ERROR_<br>
INVALID_DSN</td>
<td width=24%>Invalid DSN</td>
<td width=46%>The <i>lpszDS</i> argument contained a string that was invalid for a DSN.</td>
</tr>
<tr valign=top>
<td width=30%>ODBC_ERROR_<br>
REQUEST_<br>
FAILED</td>
<td width=24%><i>Request</i> failed</td>
<td width=46%>The call to <b>ConfigDSN</b> with the ODBC_ADD_DSN option failed.</td>
</tr>
<tr valign=top>
<td width=30%>ODBC_ERROR_<br>
LOAD_LIBRARY_<br>
FAILED</td>
<td width=24%>Could not load the driver or translator setup library</td>
<td width=46%>The driver setup library could not be loaded.</td>
</tr>
<tr valign=top>
<td width=30%>ODBC_ERROR_<br>
USER_CANCELED</td>
<td width=24%>User canceled operation</td>
<td width=46%>User canceled creation of a new data source.</td>
</tr>
<tr valign=top>
<td width=30%>ODBC_ERROR_<br>
CREATE_DSN_<br>
FAILED</td>
<td width=24%>Could not create the requested DSN</td>
<td width=46%>Could not connect to the database; the call to <b>SQLDriverConnect</b> for a File DSN did not return a successful connection.<p>
Could not write to the file.</p>
</td>
</tr>
<tr valign=top>
<td width=30%>ODBC_ERROR_<br>
OUT_OF_MEM</td>
<td width=24%>Out of memory</td>
<td width=46%>The installer could not perform the function because of a lack of memory.</td>
</tr>
</table><br>
<p class=label>
<b>Comments</b></p>
<p>
If <i>hwnd</i> is null, <b>SQLCreateDataSource</b> returns FALSE. Otherwise, it displays the <b>Create New Data Source</b> dialog box with a wizard page for choosing the type of data source to be set up:</p>
<p>
<img src="ch23a.gif" border=0></p>
<p>
The default option is <b>File Data Source</b>. When a data source has been chosen, a wizard page containing a list of installed drivers is displayed:</p>
<p>
<img src="ch23b.gif" border=0></p>
<p>
If <b>Cancel</b> is clicked, then the dialog box disappears and <b>SQLCreateDataSource</b> returns FALSE with the error code of ODBC_ERROR_USER_CANCELED. If either the <b>User Data Source</b> or <b>System Data Source</b> option was selected, then the <b>Advanced</b> button is unavailable. </p>
<p>
When the <b>Next</b> button is clicked, then one of the following will occur, depending on which type of data source was selected:
<ul type=disc>
<li>
If <b>File Data Source</b> was selected, then a wizard page is displayed for the user to enter a file name.<br><br></li>
<li>
If either <b>User Data Source</b> or <b>System Data Source</b> was selected, then a wizard page displaying the type of data source and driver is displayed for review, and when <b>Finish</b> is clicked, the data source is set up.</li>
</ul>
<p>
If <b>Advanced</b> is clicked from the driver list wizard page, a wizard page is displayed for the user to enter driver-specific information. In the text box of this dialog box, type the driver and keywords separated by returns, as follows:</p>
<p>
<img src="ch23c.gif" border=0></p>
<p>
Additional driver-specific keywords can be found under the description of <b>SQLDriverConnect</b>. All but DSN are allowed.</p>
<p>
The default for the <b>Verify This Connection</b> option is TRUE. This default applies regardless of whether this wizard page is activated. If <b>OK</b> is clicked, then the string specified in the text box and the <b>Verify This Connection</b> option value are cached. (If the <b>X</b> button or <b>Cancel</b> is clicked, then newly entered driver-specific information is lost, because the string specified in the text box and the <b>Verify This Connection</b> option value are not cached.)</p>
<p>
If <b>File Data Source</b> was selected in the first wizard page, then after a driver has been selected and the keyword values have been entered in the Advanced wizard page, the user is prompted to enter a file name. Click <b>Browse</b> to search for a file name, in which case the default directory in the <b>Browse</b> box is specified by a combination of the path specified by CommonFileDir in HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion and “ODBC\DataSources”. (If CommonFileDir was “C:\Program Files\Common Files”, the default directory would be “C:\Program Files\Common Files\ODBC\Data Sources”.)</p>
<p>
When a file name has been entered and <b>Next</b> is clicked, then the file name entered is checked for validity against the standard file-naming rules of the operating system. If the file name is invalid, then an error message box notifies the user that an invalid file name was entered. After the user acknowledges the message box, the focus is returned to the wizard page in which the file name is entered. If the file name is valid, then a wizard page showing the selected keyword-value pairs is displayed for review.</p>
<p>
<img src="ch23d.gif" border=0></p>
<p>
If <b>Finish</b> is clicked, and <b>File Data Source</b> was selected as the data source type, and the <b>Verify this connection</b> option is TRUE, then <b>SQLDriverConnect</b> is called with the <b>SAVEFILE</b> and <b>DRIVER</b> keywords. The <i>DriverCompletion</i> argument is set to SQL_DRIVER_COMPLETE. The file name for the <b>SAVEFILE</b> keyword is the name that was entered or chosen, and, and the driver name for the <b>DRIVER</b> keyword is the name that was chosen. If a driver-specific connection string was specified in the Advanced wizard page, then that string is appended after the <b>DRIVER</b> keyword.</p>
<p>
If <b>SQLDriverConnect</b> returns SQL_SUCCESS, then the Driver Manager has created the File DSN. <b>SQLCreateDataSource</b> returns TRUE. If <b>SQLDriverConnect</b> does not return SQL_SUCCESS, then a warning message box indicates that a connection could not be made to the data source. A DSN with minimal connection information can still be created. This message box allows the user to either cancel or continue with the File DSN creation.</p>
<p>
If the user chooses to continue creating the DSN, then this process continues as if the <b>Verify this connection</b> option were set to FALSE. If the user chooses to cancel, then FALSE is returned for <b>SQLCreateDataSource</b> with an error code of ODBC_ERROR_CREATE_DSN_FAILED. </p>
<p>
If <b>File Data Source</b> was selected as the data source type, and the <b>Verify this connection</b> option is FALSE, then a File DSN is created with the <b>DRIVER</b> keyword and user-specified connect string (if any) from the Advanced wizard page. If the file creation was successful, TRUE is returned for <b>SQLCreateDataSource</b>. If the file creation was not successful, then an error message box notifies the user with whatever error was returned from the operating system. FALSE is returned for <b>SQLCreateDataSource</b> with an error code of ODBC_ERROR_CREATE_DSN_FAILED. For more information on file data sources, see “<a href="odch06pr_16lv.htm">Connecting Using File Data Sources</a>” in Chapter 6, “Connecting to a Data Source or Driver,” or see <a href="odch21dpr_4ed0.htm">SQLDriverConnect</a>.</p>
<p>
If <b>User</b> or <b>System Data Source</b> was selected as the data source type, then <b>ConfigDSN</b> in the driver setup library is called with the ODBC_ADD_DSN <i>fRequest</i>. For more information, see <a href="odch22pr_786m.htm">ConfigDSN</a> in Chapter 22, “Setup DLL Function Reference.”</p>
<p class=label>
<b>Related Functions</b></p>
<table border=1 cellpadding=5 cols=2 frame=below rules=rows width=587>
<tr valign=top>
<td class=label width=48%><b>For information about</b></td>
<td class=label width=52%><b>See</b></td>
</tr>
<tr valign=top>
<td width=48%>Managing data sources</td>
<td width=52%><a href="odch23pr_1kfn.htm">SQLManageDataSources</a></td>
</tr>
</table><br>
</font></BODY>
</HTML>
