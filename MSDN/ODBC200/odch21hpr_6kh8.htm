<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>SQLNativeSql</title>
<link disabled rel=stylesheet href=msdn_ie3.css>
<style type="text/css">
@import url(msdn_ie4.css);
</style>
</HEAD>
<BODY>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

	<!--TOOLBAR_START-->
	<!--TOOLBAR_EXEMPT-->
	<!--TOOLBAR_END-->


<h1><a name="odbcsqlnativesql"></a>SQLNativeSql</h1>
<p class=label>
<b>Conformance</b></p>
<p>
Version Introduced:ODBC 1.0<br>
Standards Compliance:ODBC</p>
<p class=label>
<b>Summary</b></p>
<p>
<b>SQLNativeSql</b> returns the SQL string as modified by the driver. <b>SQLNativeSql</b> does not execute the SQL statement.</p>
<p class=label>
<b>Syntax</b></p>
<p>
SQLRETURN <b>SQLNativeSql</b>(<br>
SQLHDBC<i>ConnectionHandle</i>,<br>
SQLCHAR *<i>InStatementText</i>,<br>
SQLINTEGER<i>TextLength1</i>,<br>
SQLCHAR *<i>OutStatementText</i>,<br>
SQLINTEGER<i>BufferLength</i>,<br>
SQLINTEGER *<i>TextLength2Ptr</i>);</p>
<p class=label>
<b>Arguments</b></p>
<p class=dt>
<i>ConnectionHandle</i></p>
<p class=indent>
[Input]<br>
Connection handle.</p>
<p class=dt>
<i>InStatementText</i></p>
<p class=indent>
[Input]<br>
SQL text string to be translated.</p>
<p class=dt>
<i>TextLength1</i></p>
<p class=indent>
[Input]<br>
Length of *<i>InStatementText</i> text string.</p>
<p class=dt>
<i>OutStatementText</i></p>
<p class=indent>
[Output]<br>
Pointer to a buffer in which to return the translated SQL string.</p>
<p class=dt>
<i>BufferLength</i></p>
<p class=indent>
[Input]<br>
Length of the *<i>OutStatementText</i> buffer. If the value returned in <i>*InStatementText</i> is a Unicode string (when calling <b>SQLNativeSqlW</b>), the <i>BufferLength</i> argument must be an even number. </p>
<p class=dt>
<i>TextLength2Ptr</i></p>
<p class=indent>
[Output]<br>
Pointer to a buffer in which to return the total number of bytes (excluding the null-termination byte) available to return in *<i>OutStatementText</i>. If the number of bytes available to return is greater than or equal to <i>BufferLength</i>, the translated SQL string in *<i>OutStatementText</i> is truncated to <i>BufferLength</i> minus the length of a null-termination character.</p>
<p class=label>
<b>Returns</b></p>
<p>
SQL_SUCCESS, SQL_SUCCESS_WITH_INFO, SQL_ERROR, or SQL_INVALID_HANDLE.</p>
<p class=label>
<b>Diagnostics</b></p>
<p>
When <b>SQLNativeSql</b> returns either SQL_ERROR or SQL_SUCCESS_WITH_INFO, an associated SQLSTATE value may be obtained by calling <b>SQLGetDiagRec</b> with a <i>HandleType</i> of SQL_HANDLE_DBC and a <i>Handle</i> of <i>ConnectionHandle</i>. The following table lists the SQLSTATE values commonly returned by <b>SQLNativeSql </b>and explains each one in the context of this function; the notation “(DM)” precedes the descriptions of SQLSTATEs returned by the Driver Manager. The return code associated with each SQLSTATE value is SQL_ERROR, unless noted otherwise.</p>
<table border=1 cellpadding=5 cols=3 frame=below rules=rows width=587>
<tr valign=top>
<td class=label width=22%><b>SQLSTATE</b></td>
<td class=label width=26%><b>Error</b></td>
<td class=label width=52%><b>Description</b></td>
</tr>
<tr valign=top>
<td width=22%>01000</td>
<td width=26%>General warning</td>
<td width=52%>Driver-specific informational message. (Function returns SQL_SUCCESS_WITH_INFO.)</td>
</tr>
<tr valign=top>
<td width=22%>01004</td>
<td width=26%>String data, right truncated</td>
<td width=52%>The buffer *<i>OutStatementText</i> was not large enough to return the entire SQL string, so the SQL string was truncated. The length of the untruncated SQL string is returned in *<i>TextLength2Ptr</i>. (Function returns SQL_SUCCESS_WITH_INFO.)</td>
</tr>
<tr valign=top>
<td width=22%>08003</td>
<td width=26%>Connection does not exist</td>
<td width=52%>The <i>ConnectionHandle</i> was not in a connected state.</td>
</tr>
<tr valign=top>
<td width=22%>08S01</td>
<td width=26%>Communication link failure</td>
<td width=52%>The communication link between the driver and the data source to which the driver was connected failed before the function completed processing.</td>
</tr>
<tr valign=top>
<td width=22%>22007</td>
<td width=26%>Invalid datetime format</td>
<td width=52%>*<i>InStatementText</i> contained an escape clause with an invalid date, time, or timestamp value.</td>
</tr>
<tr valign=top>
<td width=22%>24000</td>
<td width=26%>Invalid cursor state</td>
<td width=52%>The cursor referred to in the statement was positioned before the start of the result set or after the end of the result set. This error may not be returned by a driver having a native DBMS cursor implementation.</td>
</tr>
<tr valign=top>
<td width=22%>HY000</td>
<td width=26%>General error</td>
<td width=52%>An error occurred for which there was no specific SQLSTATE and for which no implementation-specific SQLSTATE was defined. The error message returned by <b>SQLGetDiagRec</b> in the <i>*MessageText</i> buffer describes the error and its cause.</td>
</tr>
<tr valign=top>
<td width=22%>HY001</td>
<td width=26%>Memory allocation <br>
error</td>
<td width=52%>The driver was unable to allocate memory required to support execution or completion of the function.</td>
</tr>
<tr valign=top>
<td width=22%>HY009</td>
<td width=26%>Invalid use of null pointer</td>
<td width=52%>(DM) *<i>InStatementText</i> was a null pointer.</td>
</tr>
<tr valign=top>
<td width=22%>HY013</td>
<td width=26%>Memory management error</td>
<td width=52%>The function call could not be processed because the underlying memory objects could not be accessed, possibly because of low memory conditions.</td>
</tr>
<tr valign=top>
<td width=22%>HY090</td>
<td width=26%>Invalid string or buffer length</td>
<td width=52%>(DM) The argument <i>TextLength1</i> was less than 0, but not equal to SQL_NTS. </td>
</tr>
<tr valign=top>
<td width=22%></td>
<td width=26%></td>
<td width=52%>(DM) The argument <i>BufferLength</i> was less than 0 and the argument <i>OutStatementText</i> was not a null pointer.</td>
</tr>
<tr valign=top>
<td width=22%>HY109</td>
<td width=26%>Invalid cursor position</td>
<td width=52%>The current row of the cursor had been deleted or had not been fetched. This error may not be returned by a driver having a native DBMS cursor implementation.</td>
</tr>
<tr valign=top>
<td width=22%>HYT01</td>
<td width=26%>Connection timeout expired</td>
<td width=52%>The connection timeout period expired before the data source responded to the request. The connection timeout period is set through <b>SQLSetConnectAttr</b>, SQL_ATTR_CONNECTION_TIMEOUT.</td>
</tr>
<tr valign=top>
<td width=22%>IM001</td>
<td width=26%>Driver does not support this function</td>
<td width=52%>(DM) The driver associated with the <i>ConnectionHandle</i> does not support the function.</td>
</tr>
</table><br>
<p class=label>
<b>Comments</b></p>
<p>
The following are examples of what <b>SQLNativeSql</b> might return for the following input SQL string containing the scalar function CONVERT. Assume that the column empid is of type INTEGER in the data source:</p>
<pre><code>SELECT { fn CONVERT (empid, SQL_SMALLINT) } FROM employee
</code></pre>
<p>
A driver for Microsoft SQL Server might return the following translated SQL string:</p>
<pre><code>SELECT convert (smallint, empid) FROM employee
</code></pre>
<p>
A driver for ORACLE Server might return the following translated SQL string:</p>
<pre><code>SELECT to_number (empid) FROM employee
</code></pre>
<p>
A driver for Ingres might return the following translated SQL string:</p>
<pre><code>SELECT int2 (empid) FROM employee
</code></pre>
<p>
For more information, see “<a href="odch09pr_98ku.htm">Direct Execution</a>” and “<a href="odch09pr_3k4u.htm">Prepared Execution</a>” in Chapter 9, “Executing Statements.”</p>
<p class=label>
<b>Related Functions</b></p>
<p>
None.</p>
</font></BODY>
</HTML>
