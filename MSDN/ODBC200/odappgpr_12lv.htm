<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Behavioral Changes and ODBC 3.x Drivers</title>
<link disabled rel=stylesheet href=msdn_ie3.css>
<style type="text/css">
@import url(msdn_ie4.css);
</style>
</HEAD>
<BODY>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

	<!--TOOLBAR_START-->
	<!--TOOLBAR_EXEMPT-->
	<!--TOOLBAR_END-->


<h1><a name="odbcbehavioral_changes_and_odbc_3.5_drivers"></a>Behavioral Changes and ODBC 3.x Drivers</h1>
<p>
The environment attribute SQL_ATTR_ODBC_VERSION indicates to the driver whether it needs to exhibit ODBC 2.<i>x </i>behavior or ODBC 3.x behavior. How the SQL_ATTR_ODBC_VERSION environment attribute is set depends on the application. ODBC 3.x applications must call <b>SQLSetEnvAttr</b> to set this attribute after they call <b>SQLAllocHandle</b> to allocate an environment handle and before they call <b>SQLAllocHandle</b> to allocate a connection handle; if they fail to do this, the Driver Manager returns SQLSTATE HY010 (Function sequence error) on the latter call to <b>SQLAllocHandle</b>.</p>
<p class=indent>
<B><b>Note&nbsp;&nbsp;&nbsp;</b></B>For more information on behavioral changes and how an application acts, see “<a href="odch17pr_4lgz.htm">Behavioral Changes</a>” in Chapter 17, “Programming Considerations.”</p>
<p>
ODBC 2.<i>x</i> applications and ODBC 2.<i>x</i> applications recompiled with the ODBC 3.x header files do not call <b>SQLSetEnvAttr</b>. However, they call <b>SQLAllocEnv</b> instead of <b>SQLAllocHandle</b> to allocate an environment handle. Therefore, when the application calls <b>SQLAllocEnv</b> in the Driver Manager, the Driver Manager calls <b>SQLAllocHandle</b> and <b>SQLSetEnvAttr</b> in the driver. Thus, ODBC 3.x drivers can always count on this attribute being set.</p>
<p>
If a standards-compliant application compiled with the ODBC_STD compile flag calls <b>SQLAllocEnv</b> (which may occur because <b>SQLAllocEnv</b> is not deprecated in ISO), the call is mapped to <b>SQLAllocHandleStd</b> at compile time. At run time, the application calls <b>SQLAllocHandleStd</b>. The Driver Manager sets the SQL_ATTR_ODBC_VERSION environment attribute to SQL_OV_ODBC3. A call to <b>SQLAllocHandleStd</b> is equivalent to a call to <b>SQLAllocHandle</b> with a <i>HandleType</i> of SQL_HANDLE_ENV and a call to <b>SQLSetEnvAttr</b> to set SQL_ATTR_ODBC_VERSION to SQL_OV_ODBC3. </p>
<p>
In certain driver architectures, there is a need for the driver to appear as either an ODBC 2.<i>x</i> driver or an ODBC 3.x driver, depending on the connection. The driver in this case may not actually be a driver, but a layer that resides between the Driver Manager and another driver. For example, it may mimic a driver, like ODBC Spy. In another example, it may act as a gateway, like EDA/SQL. Such drivers must be able to export <b>SQLAllocHandle</b>, to appear as an ODBC 3.x driver, and must be able to export <b>SQLAllocConnect</b>, <b>SQLAllocEnv</b>, and <b>SQLAllocStmt</b>, to appear as an ODBC 2.<i>x</i> driver. When an environment, connection, or statement is to be allocated, the Driver Manager checks to see if this driver exports <b>SQLAllocHandle</b>. Since the driver does, the Driver Manager calls <b>SQLAllocHandle</b> in the driver. If the driver is working with an ODBC 2.<i>x</i> driver, the driver must map the call to <b>SQLAllocHandle</b> to <b>SQLAllocConnect</b>, <b>SQLAllocEnv</b>, or <b>SQLAllocStmt</b>, as appropriate. It must also do nothing with the <b>SQLSetEnvAttr</b> call when behaving as an ODBC 2.<i>x</i> driver.</p>
</font></BODY>
</HTML>
