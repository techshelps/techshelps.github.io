<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>SQLInstallDriverEx</title>
<link disabled rel=stylesheet href=msdn_ie3.css>
<style type="text/css">
@import url(msdn_ie4.css);
</style>
</HEAD>
<BODY>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

	<!--TOOLBAR_START-->
	<!--TOOLBAR_EXEMPT-->
	<!--TOOLBAR_END-->


<h1><a name="odbcsqlinstalldriverex"></a>SQLInstallDriverEx</h1>
<p class=label>
<b>Conformance</b></p>
<p>
Version Introduced: ODBC 3.0</p>
<p class=label>
<b>Summary</b></p>
<p>
<b>SQLInstallDriverEx</b> adds information about the driver to the ODBCINST.INI entry in the system information and increments the driver’s <i>UsageCount</i> by 1. However, if a version of the driver already exists, but the <i>UsageCount</i> value for the driver does not exist, the new <i>UsageCount</i> value is set to 2. </p>
<p>
This function does not actually copy any files. It is the responsibility of the calling program to copy the driver’s files to the target directory properly.</p>
<p class=label>
<b>Syntax</b></p>
<p>
BOOL <b>SQLInstallDriverEx</b>(<br>
&nbsp;&nbsp;&nbsp;LPCSTR&nbsp;&nbsp;&nbsp;<i>lpszDriver</i>,<br>
&nbsp;&nbsp;&nbsp;LPCSTR&nbsp;&nbsp;&nbsp;<i>lpszPathIn</i>,<br>
&nbsp;&nbsp;&nbsp;LPSTR&nbsp;&nbsp;&nbsp;<i>lpszPathOut</i>,<br>
&nbsp;&nbsp;&nbsp;WORD&nbsp;&nbsp;&nbsp;<i>cbPathOutMax</i>,<br>
&nbsp;&nbsp;&nbsp;WORD *&nbsp;&nbsp;&nbsp;<i>pcbPathOut,</i><br>
&nbsp;&nbsp;&nbsp;<i>WORD</i>&nbsp;&nbsp;&nbsp;<i>fRequest,</i><br>
&nbsp;&nbsp;&nbsp;<i>LPDWORD</i>&nbsp;&nbsp;&nbsp;<i>lpdwUsageCount</i>);</p>
<p class=label>
<b>Arguments</b></p>
<p class=dt>
<i>lpszDriver</i></p>
<p class=indent>
[Input]<br>
The driver description (usually the name of the associated DBMS) presented to users instead of the physical driver name. The <i>lpszDriver</i> argument must contain a list of keyword-value pairs describing the driver.</p>
<p class=tl>
For more information, see “Comments.”</P><p class=dt>
<i>lpszPathIn</i></p>
<p class=indent>
[Input]<br>
Full path of the target directory of the installation, or a null pointer. If <i>lpszPathIn</i> is a null pointer, the drivers will be installed in the system directory.</p>
<p class=dt>
<i>lpszPathOut</i></p>
<p class=indent>
[Output]<br>
Path of the target directory where the driver should be installed. If the driver has not previously been installed, then <i>lpszPathOut</i> should be the same as <i>lpszPathIn</i>. If the driver was previously installed, then <i>lpszPathOut</i> is the path of the previous installation.</p>
<p class=dt>
<i>cbPathOutMax</i></p>
<p class=indent>
[Input]<br>
Length of <i>lpszPathOut</i>.</p>
<p class=dt>
<i>pcbPathOut</i></p>
<p class=indent>
[Output]<br>
Total number of bytes (excluding the null-termination character) available to return in <i>lpszPathOut</i>. If the number of bytes available to return is greater than or equal to <i>cbPathOutMax</i>, then the output path in <i>lpszPathOut</i> is truncated to <i>cbPathOutMax</i> minus the null-termination character. The <i>pcbPathOut</i> argument can be a null pointer.</p>
<p class=dt>
<i>fRequest</i></p>
<p class=indent>
[Input]<br>
Type of request. The <i>fRequest</i> argument must contain one of the following values:</p>
<p class=tl>
ODBC_INSTALL_INQUIRY: Inquire about where a driver can be installed.</P><p class=tl>
ODBC_INSTALL_COMPLETE: Complete the installation request.</P><p class=dt>
<i>lpdwUsageCount</i></p>
<p class=indent>
[Output]<br>
The usage count of the driver after this function has been called.</p>
<p class=label>
<b>Returns</b></p>
<p>
The function returns TRUE if it is successful, FALSE if it fails.</p>
<p class=label>
<b>Diagnostics</b></p>
<p>
When <b>SQLInstallDriverEx</b> returns FALSE, an associated <i>*pfErrorCode</i> value may be obtained by calling <b>SQLInstallerError</b>. The following table lists the <i>*pfErrorCode</i> values that can be returned by <b>SQLInstallerError </b>and explains each one in the context of this function.</p>
<table border=1 cellpadding=5 cols=3 frame=below rules=rows width=587>
<tr valign=top>
<td class=label width=26%><b><i>*pfErrorCode</i></b></td>
<td class=label width=25%><b>Error</b></td>
<td class=label width=49%><b>Description</b></td>
</tr>
<tr valign=top>
<td width=26%>ODBC_ERROR_<br>
GENERAL_ERR</td>
<td width=25%>General installer error</td>
<td width=49%>An error occurred for which there was no specific installer error.</td>
</tr>
<tr valign=top>
<td width=26%>ODBC_ERROR_<br>
INVALID_BUFF_<br>
LEN</td>
<td width=25%>Invalid buffer length</td>
<td width=49%>The <i>lpszPathOut</i> argument was not large enough to contain the output path. The buffer contains the truncated path.<p>
The <i>cbPathOutMax</i> argument was 0 and <i>fRequest</i> was ODBC_INSTALL_COMPLETE.</p>
</td>
</tr>
<tr valign=top>
<td width=26%>ODBC_ERROR_<br>
INVALID_<br>
REQUEST_TYPE</td>
<td width=25%>Invalid type of request</td>
<td width=49%>The <i>fRequest</i> argument was not one of the following:<p>
ODBC_INSTALL_INQUIRY<br>
ODBC_INSTALL_COMPLETE</p>
</td>
</tr>
<tr valign=top>
<td width=26%>ODBC_ERROR_<br>
INVALID_<br>
KEYWORD_<br>
VALUE</td>
<td width=25%>Invalid keyword-value pairs</td>
<td width=49%>The <i>lpszDriver</i> argument contained a syntax error.</td>
</tr>
<tr valign=top>
<td width=26%>ODBC_ERROR_<br>
INVALID_PATH</td>
<td width=25%>Invalid install path</td>
<td width=49%>The <i>lpszPathIn</i> argument contained an invalid path.</td>
</tr>
<tr valign=top>
<td width=26%>ODBC_ERROR_<br>
LOAD_LIBRARY_<br>
FAILED</td>
<td width=25%>Could not load the driver or translator <br>
setup library</td>
<td width=49%>The driver setup library could not be loaded.</td>
</tr>
<tr valign=top>
<td width=26%>ODBC_ERROR_<br>
INVALID_<br>
PARAM_<br>
SEQUENCE</td>
<td width=25%>Invalid parameter sequence</td>
<td width=49%>The <i>lpszDriver</i> argument did not contain a list of keyword-value pairs.</td>
</tr>
<tr valign=top>
<td width=26%> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ODBC_ERROR_<br>
USAGE_<br>
UPDATE_FAILED</td>
<td width=25%>Could not increment or decrement the component usage count</td>
<td width=49%>The installer failed to increment the driver’s usage count.</td>
</tr>
</table><br>
<p class=label>
<b>Comments</b></p>
<p>
The <i>lpszDriver</i> argument is a list of attributes in the form of keyword-value pairs. Each pair is terminated with a null byte and the entire list is terminated with a null byte (that is, two null bytes mark the end of the list). The format of this list is:</p>
<p>
<i>driver-desc</i><b>\</b>0Driver<b>=</b><i>driver-DLL-filename</i><b>\</b>0[Setup<b>=</b><i>setup-DLL-filename</i><b>\</b>0]</p>
<p>
&nbsp;&nbsp;&nbsp;[<i>driver-attr-keyword1</i><b>=</b><i>value1</i><b>\</b>0][<i>driver-attr-keyword2</i><b>=</b><i>value2</i><b>\</b>0]...<b>\</b>0</p>
<p>
where \0 is a null byte and <i>driver-attr-keywordn</i> is any driver attribute keyword described in “Driver Keyword Sections” in Chapter 18, “Installing ODBC Components.” The keywords must appear in the specified order. For example, suppose a driver for formatted text files has separate driver and setup DLLs and can use files with the .txt and .csv extensions. The <i>lpszDriver</i> argument for this driver might be:</p>
<pre><code>Text\0Driver=TEXT.DLL\0Setup=TXTSETUP.DLL\0FileUsage=1\0
FileExtns=*.txt,*.csv\0\0</code></pre>
<p>
Suppose that a driver for SQL Server does not have a separate setup DLL and does not have any driver attribute keywords. The <i>lpszDriver</i> argument for this driver might be:</p>
<pre><code>SQL Server\0Driver=SQLSRVR.DLL\0\0
</code></pre>
<p>
After <b>SQLInstallDriverEx</b> retrieves information about the driver from the <i>lpszDriver</i> argument, it adds the driver description to the [ODBC Drivers] section of the ODBCINST.INI entry in the system information. It then creates a section titled with the driver’s description and adds the full paths of the driver DLL and the setup DLL. Finally, it returns the path of the target directory of the installation but does not copy the driver files to it. The calling program must actually copy the driver files to the target directory.</p>
<p>
<b>SQLInstallDriverEx</b> increments the component usage count for the installed driver by 1. If a version of the driver already exists, but the component usage count for the driver does not exist, the new component usage count value is set to 2. </p>
<p>
The application setup program is responsible for physically copying the driver file, and maintaining the file usage count. If the driver file has not previously been installed, the application setup program must copy the file in the <i>lpszPathIn</i> path, and create the file usage count. If the file has previously been installed, the setup program merely increments the file usage count, and returns the path of the prior installation in the <i>lpszPathOut</i> argument.</p>
<p class=indent>
<B><b>Note&nbsp;&nbsp;&nbsp;</b></B>For more information about component usage counts and file usage counts, see “Usage Counting” in Chapter 18, “Installing ODBC Components.”</p>
<p>
If an older version of the driver file was previously installed by the application, the driver should be uninstalled, then reinstalled, so that the driver component usage count is valid. <b>SQLConfigDriver</b> (with an <i>fRequest</i> of ODBC_REMOVE_DRIVER) should first be called, then <b>SQLRemoveDriver</b> should be called to decrement the component usage count. <b>SQLInstallDriverEx</b> should then be called to reinstall the driver, incrementing the component usage count. The application setup program must physically replace the old file with the new file. The file usage count will remain the same, and any other application that used the older version file will now use the newer version.</p>
<p class=indent>
<B><b>Note&nbsp;&nbsp;&nbsp;</b></B>If the driver was previously installed, and <b>SQLInstallDriverEx</b> is called to install the driver in a different directory, the function will return TRUE, but <i>lpszPathOut</i> will include the directory where the driver was already installed. It will not include the directory entered in the <i>lpszDriver</i> argument.</p>
<p>
The length of the path in <i>lpszPathOut</i> in <b>SQLInstallDriverEx</b> allows for a two-phase install process, so an application can determine what <i>cbPathOutMax</i> should be by calling <b>SQLInstallDriverEx</b> with an <i>fRequest</i> of ODBC_INSTALL_INQUIRY mode. This will return the total number of bytes available in the <i>pcbPathOut</i> buffer. <b>SQLInstallDriverEx</b> can then be called with an <i>fRequest</i> of ODBC_INSTALL_COMPLETE and the <i>cbPathOutMax</i> argument set to the value in the <i>pcbPathOut</i> buffer, plus the null-termination character.</p>
<p>
If you choose not to use the two-phase model for <b>SQLInstallDriverEx</b>, then you must set <i>cbPathOutMax</i>, which defines the size of the storage for the path of the target directory, to the value _MAX_PATH, as defined in STDLIB.H, to prevent truncation.</p>
<p>
When <i>fRequest</i> is ODBC_INSTALL_COMPLETE, <b>SQLInstallDriverEx</b> does not allow <i>lpszPathOut</i> to be NULL (or <i>cbPathOutMax</i> to be 0). If <i>fRequest</i> is ODBC_INSTALL_COMPLETE, FALSE is returned when the number of bytes available to return is greater than or equal to <i>cbPathOutMax</i>, with the result that truncation occurs.</p>
<p>
After <b>SQLInstallDriverEx</b> has been called, and the application setup program has copied the driver file (if necessary), the driver setup DLL must call <b>SQLConfigDriver</b> to set the configuration for the driver.</p>
<p class=label>
<b>Related Functions</b></p>
<table border=1 cellpadding=5 cols=2 frame=below rules=rows width=587>
<tr valign=top>
<td class=label width=48%><b>For information about</b></td>
<td class=label width=52%><b>See</b></td>
</tr>
<tr valign=top>
<td width=48%>Installing the Driver Manager</td>
<td width=52%><a href="odch23pr_04z6.htm">SQLInstallDriverManager</a></td>
</tr>
</table><br>
</font></BODY>
</HTML>
