<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Usage Counting</title>
<link disabled rel=stylesheet href=msdn_ie3.css>
<style type="text/css">
@import url(msdn_ie4.css);
</style>
</HEAD>
<BODY>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

	<!--TOOLBAR_START-->
	<!--TOOLBAR_EXEMPT-->
	<!--TOOLBAR_END-->


<h1><a name="odbcusage_counting"></a>Usage Counting</h1>
<p>
Two types of usage counts are maintained in the registry for each component: a component usage count and one or more optional file usage counts. The component usage count helps the installer DLL maintain registry entries. It is stored in the UsageCount value under the ODBC Core, driver, and translator subkeys. For the format of the UsageCount value and more information about these subkeys, see “<a href="odch18pr_47eb.htm">Registry Entries for ODBC Components</a>” later in this chapter.</p>
<p>
When a component is first installed, the installer DLL creates a subkey for it and sets the data for the UsageCount value in that subkey to 1. When the component is installed again, the installer DLL increments the usage count. When the component is removed, the installer DLL decrements the usage count. If the usage count falls to 0, the installer DLL removes the subkey for the component.</p>
<p class=indent>
<B><b>Caution&nbsp;&nbsp;&nbsp;</b></B>An application should not physically remove Driver Manager files when the component usage count and the file usage count reach zero.</p>
<p>
File usage counts help determine when a file must actually be copied or deleted as opposed to incrementing or decrementing the usage count. This is important because ODBC components—and therefore the files in ODBC components—are shared and can be installed or removed by a variety of applications. The application can physically delete driver and translator files if the component usage count and the file usage count reach zero. Driver Manager files should not, however, be physically deleted when both the component usage count and the file usage count have reached zero, because these files may be used by other applications that have not incremented the file usage count.</p>
<p class=indent>
<B><b>Note&nbsp;&nbsp;&nbsp;</b></B>File usage counts are optional in Windows NT and Windows 95.</p>
<p>
File usage counts are maintained by the setup program after it calls <b>SQLInstallDriverManager</b>, <b>SQLInstallDriverEx</b>, <b>SQLInstallTranslatorEx</b>, <b>SQLRemoveDriverManager</b>, <b>SQLRemoveDriver</b>, or <b>SQLRemoveTranslator</b>.</p>
<p>
When a component is first installed, the setup program or installer DLL creates a value under the following key for each file in that component that is not already on the system:</p>
<p>
HKEY_LOCAL_MACHINE<br>
SOFTWARE<br>
Microsoft<br>
Windows<br>
CurrentVersion<br>
SharedDlls</p>
<p>
It sets the data for those values to 1 and copies the file to the system. When the component is installed again, the setup program or installer DLL increments the usage counts. When the component is removed, the setup program or installer DLL decrements the usage counts. If any usage count falls to 0, the setup program or installer DLL removes the value for the file, and if the component is a driver or a translator, deletes the file. Driver Manager files should not be deleted.</p>
<p>
The format of the file usage count value is:</p>
<table border=1 cellpadding=5 cols=3 frame=below rules=rows width=587>
<tr valign=top>
<td class=label width=22%><b>Name</b></td>
<td class=label width=23%><b>Data type</b></td>
<td class=label width=55%><b>Data</b></td>
</tr>
<tr valign=top>
<td width=22%><i>full-path</i></td>
<td width=23%>REG_DWORD</td>
<td width=55%><i>count</i></td>
</tr>
</table><br>
<p>
For example, suppose a driver for Informix uses the INFRMX32.DLL and INFRMX32.HLP files, and that this driver has been installed twice. The values under the SharedDlls subkey for the Informix driver would be:</p>
<pre><code>C:\WINDOWS\SYSTEM32\INFRMX32.DLL : REG_DWORD : 0x2
C:\WINDOWS\SYSTEM32\INFRMX32.HLP : REG_DWORD : 0x2
</code></pre>
</font></BODY>
</HTML>
