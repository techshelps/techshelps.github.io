<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>SQLFreeHandle</title>
<link disabled rel=stylesheet href=msdn_ie3.css>
<style type="text/css">
@import url(msdn_ie4.css);
</style>
</HEAD>
<BODY>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

	<!--TOOLBAR_START-->
	<!--TOOLBAR_EXEMPT-->
	<!--TOOLBAR_END-->


<h1><a name="odbcsqlfreehandle"></a>SQLFreeHandle</h1>
<p class=label>
<b>Conformance</b></p>
<p>
Version Introduced:ODBC 3.0<br>
Standards Compliance:ISO 92</p>
<p class=label>
<b>Summary</b></p>
<p>
<b>SQLFreeHandle</b> frees resources associated with a specific environment, connection, statement, or descriptor handle.</p>
<p class=indent>
<B><b>Note</b></B> This function is a generic function for freeing handles. It replaces the ODBC 2.0 functions <b>SQLFreeConnect </b>(for freeing a connection handle), and <b>SQLFreeEnv </b>(for freeing an environment handle). <b>SQLFreeConnect</b> and <b>SQLFreeEnv</b> are both deprecated in ODBC 3.x. <b>SQLFreeHandle</b> also replaces the ODBC 2.0 function<b> SQLFreeStmt </b>(with the SQL_DROP <i>Option</i>) for freeing a statement handle. For more information, see “Comments.” For more information about what the Driver Manager maps this function to when an ODBC 3.<i>x</i> application is working with an ODBC 2<i>.x</i> driver, see “<a href="odch17pr_6mpf.htm">Mapping Replacement Functions for Backward Compatibility of Applications</a>” in Chapter 17, “Programming Considerations.”</p>
<p class=label>
<b>Syntax</b></p>
<p>
SQLRETURN<b> SQLFreeHandle</b>(<br>
<b></b>SQLSMALLINT<b></b><i>HandleType</i>,<br>
SQLHANDLE<b></b><i>Handle</i>);</p>
<p class=label>
<b>Arguments</b></p>
<p class=dt>
<i>HandleType</i></p>
<p class=indent>
[Input]<br>
The type of handle to be freed by <b>SQLFreeHandle</b>. Must be one of the following values:<br>
SQL_HANDLE_ENV<br>
SQL_HANDLE_DBC<br>
SQL_HANDLE_STMT<br>
SQL_HANDLE_DESC</p>
<p class=tl>
If <i>HandleType</i> is not one of these values, <b>SQLFreeHandle</b> returns SQL_INVALID_HANDLE.</P><p class=dt>
<i>Handle</i></p>
<p class=indent>
[Input]<br>
The handle to be freed.</p>
<p class=label>
<b>Returns</b></p>
<p>
SQL_SUCCESS, SQL_ERROR, or SQL_INVALID_HANDLE.</p>
<p>
If <b>SQLFreeHandle</b> returns SQL_ERROR, the handle is still valid.</p>
<p class=label>
<b>Diagnostics</b></p>
<p>
When <b>SQLFreeHandle</b> returns SQL_ERROR, an associated SQLSTATE value may be obtained from the diagnostic data structure for the handle that <b>SQLFreeHandle</b> attempted to free, but could not. The following table lists the SQLSTATE values commonly returned by <b>SQLFreeHandle</b> and explains each one in the context of this function; the notation “(DM)” precedes the descriptions of SQLSTATEs returned by the Driver Manager. The return code associated with each SQLSTATE value is SQL_ERROR, unless noted otherwise.</p>
<table border=1 cellpadding=5 cols=3 frame=below rules=rows width=587>
<tr valign=top>
<td class=label width=22%><b>SQLSTATE</b></td>
<td class=label width=26%><b>Error</b></td>
<td class=label width=52%><b>Description</b></td>
</tr>
<tr valign=top>
<td width=22%>HY000</td>
<td width=26%>General error</td>
<td width=52%>An error occurred for which there was no specific SQLSTATE and for which no implementation-specific SQLSTATE was defined. The error message returned by <b>SQLGetDiagRec</b> in the <i>*MessageText</i> buffer describes the error and its cause.</td>
</tr>
<tr valign=top>
<td width=22%>HY001</td>
<td width=26%>Memory allocation error</td>
<td width=52%>The driver was unable to allocate memory required to support execution or completion of the function.</td>
</tr>
<tr valign=top>
<td width=22%>HY010</td>
<td width=26%>Function sequence error</td>
<td width=52%>(DM) The <i>HandleType</i> argument was SQL_HANDLE_ENV, and at least one connection was in an allocated or connected state. <b>SQLDisconnect</b> and <b>SQLFreeHandle</b> with a <i>HandleType</i> of SQL_HANDLE_DBC must be called for each connection before calling <b>SQLFreeHandle</b> with a <i>HandleType</i> of SQL_HANDLE_ENV.<p>
(DM) The <i>HandleType</i> argument was SQL_HANDLE_DBC, and the function was called before calling <b>SQLDisconnect</b> for the connection.</p>
<p>
(DM) The <i>HandleType</i> argument was SQL_HANDLE_STMT; an asynchronously executing function was called on the statement handle; and the function was still executing when this function was called.</p>
<p>
(DM) The <i>HandleType</i> argument was SQL_HANDLE_STMT; <b>SQLExecute</b>, <b>SQLExecDirect</b>, <b>SQLBulkOperations</b>, or <b>SQLSetPos</b> was called with the statement handle, and returned SQL_NEED_DATA. This function was called before data was sent for all data-at-execution parameters or columns.</p>
<p>
(DM) All subsidiary handles and other resources were not released before <b>SQLFreeHandle</b> was called.</p>
</td>
</tr>
<tr valign=top>
<td width=22%>HY013</td>
<td width=26%>Memory management error</td>
<td width=52%>The <i>HandleType</i> argument was SQL_HANDLE_STMT or SQL_HANDLE_DESC, and the function call could not be processed because the underlying memory objects could not be accessed, possibly because of low memory conditions.</td>
</tr>
<tr valign=top>
<td width=22%>HY017</td>
<td width=26%>Invalid use of an automatically allocated descriptor handle.</td>
<td width=52%>(DM) The <i>Handle</i> argument was set to the handle for an automatically allocated descriptor.</td>
</tr>
<tr valign=top>
<td width=22%>HYT01</td>
<td width=26%>Connection timeout expired</td>
<td width=52%>The connection timeout period expired before the data source responded to the request. The connection timeout period is set through <b>SQLSetConnectAttr</b>, SQL_ATTR_CONNECTION_TIMEOUT.</td>
</tr>
<tr valign=top>
<td width=22%>IM001</td>
<td width=26%>Driver does not support this function</td>
<td width=52%>(DM) The <i>HandleType</i> argument was SQL_HANDLE_DESC, and the driver was an ODBC 2.<i>x</i> driver.<p>
(DM) The <i>HandleType</i> argument was SQL_HANDLE_STMT, and the driver was not a valid ODBC driver.</p>
</td>
</tr>
</table><br>
<p class=label>
<b>Comments</b></p>
<p>
<b>SQLFreeHandle</b> is used to free handles for environments, connections, statements, and descriptors, as described in the following sections. For general information about handles, see “<a href="odch04pr_47qr.htm">Handles</a>” in Chapter 4, “ODBC Fundamentals.”</p>
<p>
An application should not use a handle after it has been freed; the Driver Manager does not check the validity of a handle in a function call.</p>
<h1>Freeing an Environment Handle</h1>
<p>
Prior to calling <b>SQLFreeHandle </b>with a <i>HandleType</i> of SQL_HANDLE_ENV, an application must call <b>SQLFreeHandle</b> with a <i>HandleType</i> of SQL_HANDLE_DBC for all connections allocated under the environment. Otherwise, the call to <b>SQLFreeHandle</b> returns SQL_ERROR, and the environment and any active connection remains valid. For more information, see “<a href="odch04pr_9ktv.htm">Environment Handles</a>” in Chapter 4, “ODBC Fundamentals” and “<a href="odch06pr_52w5.htm">Allocating the Environment Handle</a>” in Chapter 6, “Connecting to a Data Source or Driver.”</p>
<p>
When the Driver Manager processes the call to <b>SQLFreeHandle</b> with a <i>HandleType</i> of SQL_HANDLE_ENV, it checks the <b>TraceAutoStop</b> keyword in the [ODBC] section of the ODBC subkey of the system information. If it is set to 1, the Driver Manager disables tracing for all applications and sets the <b>Trace</b> keyword in the [ODBC] section of the ODBC subkey of the system information to 0. For information on what happens to tracing when <b>SQLFreeHandle</b> is called, see “<a href="odch19pr_7yrd.htm">ODBC Subkey</a>” in Chapter 19, “Configuring Data Sources.”</p>
<p>
If the environment is a shared environment, the application that calls <b>SQLFreeHandle</b> with a <i>HandleType</i> of SQL_HANDLE_ENV no longer has access to the environment after the call, but the environment’s resources are not necessarily freed. The call to <b>SQLFreeHandle</b> decrements the environment’s reference count, which is maintained by the Driver Manager. If the reference count does not reach zero, the shared environment is not freed, because it is still being used by another component. If the reference count reaches zero, the shared environment’s resources are freed.</p>
<h1>Freeing a Connection Handle</h1>
<p>
Prior to calling <b>SQLFreeHandle </b>with a <i>HandleType</i> of SQL_HANDLE_DBC, an application must call <b>SQLDisconnect</b> for the connection if there is a connection on this handle<i>.</i> Otherwise, the call to <b>SQLFreeHandle</b> returns SQL_ERROR and the connection remains valid.</p>
<p>
For more information, see “<a href="odch04pr_6v5f.htm">Connection Handles</a>” in Chapter 4, “ODBC Fundamentals” and “<a href="odch06pr_5hv6.htm">Disconnecting from a Data Source or Driver</a>” in Chapter 6, “Connecting to a Data Source or Driver.”</p>
<h1>Freeing a Statement Handle</h1>
<p>
A call to <b>SQLFreeHandle</b> with a <i>HandleType</i> of SQL_HANDLE_STMT frees all resources that were allocated by a call to <b>SQLAllocHandle</b> with a <i>HandleType</i> of SQL_HANDLE_STMT. When an application calls <b>SQLFreeHandle</b> to free a statement that has pending results, the pending results are deleted. When an application frees a statement handle, the driver frees the four automatically allocated descriptors associated with that handle. For more information, see “<a href="odch04pr_0zzn.htm">Statement Handles</a>” in Chapter 4, “ODBC Fundamentals” and “<a href="odch09pr_89yd.htm">Freeing a Statement Handle</a>” in Chapter 9, “Executing Statements.”</p>
<p>
Note that <b>SQLDisconnect</b> automatically drops any statements and descriptors open on the connection.</p>
<h1>Freeing a Descriptor Handle</h1>
<p>
A call to <b>SQLFreeHandle</b> with a <i>HandleType</i> of SQL_HANDLE_DESC frees the descriptor handle in <i>Handle</i>. The call to <b>SQLFreeHandle</b> does not release any memory allocated by the application that may be referenced by a pointer field (including SQL_DESC_DATA_PTR, SQL_DESC_INDICATOR_PTR, and SQL_DESC_OCTET_LENGTH_PTR) of any descriptor record of <i>Handle</i>. The memory allocated by the driver for fields that are not pointer fields is freed when the handle is freed. When a user-allocated descriptor handle is freed, all statements that the freed handle had been associated with revert to their respective automatically allocated descriptor handles.</p>
<p class=indent>
<B><b>Note</b></B> ODBC 2.<i>x</i> drivers do not support freeing descriptor handles, just as they do not support allocating descriptor handles.</p>
<p>
Note that <b>SQLDisconnect</b> automatically drops any statements and descriptors open on the connection. When an application frees a statement handle, the driver frees all the automatically generated descriptors associated with that handle.</p>
<p>
For more information about descriptors, see Chapter 13, “<a href="odch13pr_6l0z.htm">Descriptors</a>.”</p>
<p class=label>
<b>Code Example</b></p>
<p>
See <b>SQLBrowseConnect</b> and <b>SQLConnect</b>.</p>
<p class=label>
<b>Related Functions</b></p>
<table border=1 cellpadding=5 cols=2 frame=below rules=rows width=587>
<tr valign=top>
<td class=label width=48%><b>For information about</b></td>
<td class=label width=52%><b>See</b></td>
</tr>
<tr valign=top>
<td width=48%>Allocating a handle</td>
<td width=52%><a href="odch21bpr_689x.htm">SQLAllocHandle</a></td>
</tr>
<tr valign=top>
<td width=48%>Canceling statement processing</td>
<td width=52%><a href="odch21bpr_5b58.htm">SQLCancel</a></td>
</tr>
<tr valign=top>
<td width=48%>Setting a cursor name</td>
<td width=52%><a href="odch21jpr_26cl.htm">SQLSetCursorName</a></td>
</tr>
</table><br>
</font></BODY>
</HTML>
