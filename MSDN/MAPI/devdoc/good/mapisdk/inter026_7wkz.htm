<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IMAPITable::QueryRows</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_imapitable_queryrows"></a>IMAPITable::QueryRows</h2>
<p>
The <b>IMAPITable::QueryRows</b> method returns one or more rows from a table, beginning at the current cursor position.</p>
<h4>Quick Info</h4>
<p>
See <a href="inter026_44ry.htm"><b>IMAPITable : IUnknown</b></a>.</p>
<pre><code><b>HRESULT QueryRows(
  LONG</b><i> lRowCount</i><b>,</b>          
<b>  ULONG</b><i> ulFlags</i><b>,</b>           
<b>  LPSRowSet FAR *</b><i> lppRows  </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>lRowCount</i></dt>
<dd>
[in] Maximum number of rows to be returned.</dd>
<dt>
<i>ulFlags</i></dt>
<dd>
[in] Bitmask of flags that controls how rows are returned. The following flag can be set:
<dl>
<dt>
TBL_NOADVANCE</dt>
<dd>
Prevents the cursor from advancing as a result of the row retrieval. If the TBL_NOADVANCE flag is set, the cursor points to the first row returned. If the TBL_NOADVANCE flag is not set, the cursor points to the row following the last row returned.</dd>
</dl>
</dd>
<dt>
<i>lppRows</i></dt>
<dd>
[out] Pointer to a pointer to an <a href="structyp_2378.htm"><b>SRowSet</b></a> structure holding the table rows.
</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
S_OK</dt>
<dd>
The rows were successfully returned.</dd>
<dt>
MAPI_E_BUSY</dt>
<dd>
Another operation is in progress that prevents the row retrieval operation from starting. Either the operation in progress should be allowed to complete or it should be stopped.</dd>
<dt>
MAPI_E_INVALID_PARAMETER</dt>
<dd>
The <i>lRowCount</i> parameter is set to zero. </dd>
</dl>
<h4>Remarks</h4>
<p>
The <b>IMAPITable::QueryRows</b> method gets one or more rows of data from a table. The value of the <i>lRowCount</i> parameter affects the starting point for the retrieval. If <i>lRowCount</i> is positive, rows are read in a forward direction, starting at the current position. If <i>lRowCount</i> is negative, <b>QueryRows</b> resets the starting point by moving backward the indicated number of rows. After the cursor is reset, rows are read in forward order. </p>
<p>
The <b>cRows </b>member in the <a href="structyp_2378.htm"><b>SRowSet</b></a> structure pointed to by the <i>lppRows</i> parameter indicates the number of rows returned. If zero rows are returned:
<ul>
<li>
The cursor was already positioned at the beginning of the table and the value of <i>IRowCount</i> is negative.<p>
-Or-
</li>
<li>
The cursor was already positioned at the end of the table and the value of <i>IRowCount</i> is positive. </li>
</ul>
<p>
The number of columns and their ordering is the same for each row. If a property does not exist for a row or there is an error reading a property, the <b>SPropValue</b> structure for the property in the row contains the following values:
<ul>
<li>
PT_ERROR for the property type in the <b>ulPropTag</b> member.</li>
<li>
MAPI_E_NOT_FOUND for the <b>Value</b> member.</li>
</ul>
<p>
Memory used for the <a href="structyp_9sbp.htm"><b>SPropValue</b></a> structures in the row set pointed to by the <i>lppRows</i> parameter must be separately allocated and freed for each row. Use <a href="function_85yq.htm"><b>MAPIFreeBuffer</b></a> to free the property value structures and to free the row set. When a call to <b>QueryRows </b>returns zero, however, indicating the beginning or end of the table, only the <b>SRowSet</b> structure itself needs to be freed. For more information about how to allocate and free memory in an <b>SRowSet</b> structure, see <a href="extend_41ir.htm">Managing Memory for <b>ADRLIST</b> and <b>SRowSet</b> Structures</a>.</p>
<p>
The rows that are returned and the order in which they are returned depend on whether or not successful calls have been made to <a href="inter026_43lg.htm"><b>IMAPITable::Restrict</b></a> and <a href="inter026_3gmd.htm"><b>IMAPITable::SortTable</b></a>. <b>Restrict </b>filters rows from the view, causing <b>QueryRows</b> to return only the rows that match the criteria specified in the restriction. <b>SortTable</b> establishes a standard or categorized sort order, affecting the sequence of rows returned by <b>QueryRows</b>. The returned rows are in the order specified in the <a href="structyp_7y2c.htm"><b>SSortOrderSet</b></a> structure passed to <b>SortTable</b>.</p>
<p>
The columns returned for each row and the order in which they are returned depend on whether or not a successful call has been made to <a href="inter026_7x83.htm"><b>IMAPITable::SetColumns</b></a>. <b>SetColumns </b>establishes a column set, specifying the properties to be included in columns in the table and the order in which they should be included. If a <b>SetColumns</b> call has been made, the particular columns in each row and the order of those columns match the column set specified in the call. If no <b>SetColumns</b> call has been made, the table returns its default column set. </p>
<p>
If none of these calls has been made, <b>QueryRows</b> returns all of the rows in the table. Each row contains the default column set in default order. </p>
<p>
When the column set established in a call to <a href="inter026_7x83.htm"><b>IMAPITable::SetColumns</b></a> includes columns set to PR_NULL, the <a href="structyp_9sbp.htm"><b>SPropValue</b></a> array within the row set returned in <i>lppRows </i>will contain empty slots. </p>
<h4>Notes to Implementers</h4>
<p>
You can allow a caller to request an unsupported column to be included in the column set. When this occurs, place PT_ERROR in the property type portion of the property tag and MAPI_E_NOT_FOUND in the property value for the unsupported column. </p>
<p>
Treat the row count as a request rather than a requirement. You can return anywhere from zero rows, if there are no rows in the direction of the query, to the number requested. </p>
<p>
Return only the rows that the user will see when rows are requested from a categorized table view, allowing the caller to make valid assumptions about the scope of the data and avoid extra work. </p>
<h4>Notes to Callers</h4>
<p>
Usually you will end up with as many rows as you have specified in the <i>lRowCount</i> parameter. However, when memory or implementation limits are an issue or when the operation reaches the beginning or end of the table prematurely, <b>QueryRows </b>will return less rows than requested. </p>
<p>
If <b>QueryRows</b> returns MAPI_E_BUSY, call the <a href="inter026_7vla.htm"><b>IMAPITable::WaitForCompletion</b></a> method and retry the call to <b>QueryRows</b> when the asynchronous operation is complete. </p>
<p>
When calling <b>QueryRows</b>, be aware that the timing of asynchronous notifications can potentially cause the row set that you get back from <b>QueryRows</b> not to accurately represent the underlying data. For example, a call to <b>QueryRows</b> to a folder's contents table following the deletion of a message but prior to the receipt of the corresponding notification will cause the deleted row to be returned in the row set. Always wait for a notification to arrive before updating the user's view of the data. </p>
<p>
For more information about retrieving rows from tables, see <a href="tables_5eb7.htm">Retrieving Data from Table Rows</a>.</p>
<h4>See Also</h4>
<p>
<a href="structyp_6m49.htm"><b>ADRENTRY</b></a>, <a href="function_3wkz.htm"><b>FreeProws</b></a>, <a href="function_0dgz.htm"><b>HrQueryAllRows</b></a>, <a href="inter022_44c3.htm"><b>IMAPIProp::GetProps</b></a>, <a href="inter026_7x83.htm"><b>IMAPITable::SetColumns</b></a>, <a href="inter026_7vla.htm"><b>IMAPITable::WaitForCompletion</b></a>, <a href="function_85yq.htm"><b>MAPIFreeBuffer</b></a>, <a href="structyp_233r.htm"><b>SRow</b></a>, <a href="structyp_2378.htm"><b>SRowSet</b></a></p>
<p>&nbsp;</p></body>
</HTML>
