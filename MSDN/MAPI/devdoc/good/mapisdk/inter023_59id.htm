<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IMAPISession::OpenMsgStore</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_imapisession_openmsgstore"></a>IMAPISession::OpenMsgStore</h2>
<p>
The <b>IMAPISession::OpenMsgStore</b> method opens a message store and returns an <b>IMsgStore</b> pointer for further access.</p>
<h4>Quick Info</h4>
<p>
See <a href="inter023_64ry.htm"><b>IMAPISession : IUnknown</b></a>.</p>
<pre><code><b>HRESULT OpenMsgStore(
  ULONG</b><i> ulUIParam</i><b>,</b>      
<b>  ULONG</b><i> cbEntryID</i><b>,</b>      
<b>  LPENTRYID</b><i> lpEntryID</i><b>,</b>  
<b>  LPCIID</b><i> lpInterface</i><b>,</b>   
<b>  ULONG</b><i> ulFlags</i><b>,</b>        
<b>  LPMDB FAR *</b><i> lppMDB    </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>ulUIParam</i></dt>
<dd>
[in] Handle of the parent window for the common address dialog box and other related displays.</dd>
<dt>
<i>cbEntryID</i></dt>
<dd>
[in] Count of bytes in the entry identifier pointed to by the <i>lpEntryID</i> parameter<i>.</i></dd>
<dt>
<i>lpEntryID</i></dt>
<dd>
[in] Pointer to the entry identifier of the message store to be opened. The <i>lpEntryID</i> parameter must not be NULL.</dd>
<dt>
<i>lpInterface</i></dt>
<dd>
[in] Pointer to the interface identifier (IID) representing the interface to be used to access the message store. Passing NULL results in a pointer to its standard interface being returned in the <i>lppMDB</i> parameter. The standard interface for a message store is <b>IMsgStore</b>.</dd>
<dt>
<i>ulFlags</i></dt>
<dd>
[in] Bitmask of flags that controls how the object is opened. The following flags can be used:
<dl>
<dt>
MAPI_BEST_ACCESS</dt>
<dd>
Requests that the message store be opened with the maximum network permissions allowed for the user and the maximum client application access. For example, if the client has read/write access, the message store should be opened with read/write access; if the client has read-only access, the message store should be opened with read-only access. </dd>
<dt>
MAPI_DEFERRED_ERRORS</dt>
<dd>
Allows <b>OpenMsgStore</b> to return successfully, possibly before the message store is fully accessible to the calling client. If the message store is not accessible, making a subsequent object call can result in an error.</dd>
<dt>
MDB_NO_DIALOG</dt>
<dd>
Prevents the display of logon dialog boxes. If this flag is set, and <b>OpenMsgStore</b> does not have enough configuration information to open the message store without the user's help, it returns MAPI_E_LOGON_FAILED. If this flag is not set, the message store provider can prompt the user to correct a name or password, to insert a disk, or to perform other actions necessary to establish connection to the message store.</dd>
<dt>
MDB_NO_MAIL</dt>
<dd>
The message store should not be used for sending or receiving mail. When this flag is set, MAPI does not notify the MAPI spooler that this message store is being opened.</dd>
<dt>
MDB_TEMPORARY</dt>
<dd>
Instructs MAPI that the message store is not permanent and should not be added to the message store table. This flag is used to log on the message store so that information can be retrieved programmatically from the profile section. </dd>
<dt>
MDB_WRITE</dt>
<dd>
Requests read/write access to the message store.</dd>
</dl>
</dd>
<dt>
<i>lppMDB</i></dt>
<dd>
[out] Pointer to a pointer to the message store.
</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
S_OK</dt>
<dd>
The message store was successfully opened.</dd>
<dt>
MAPI_E_NO_ACCESS</dt>
<dd>
An attempt was made to access a message store for which the user has insufficient permissions.</dd>
<dt>
MAPI_E_NOT_FOUND</dt>
<dd>
The message store indicated by <i>lpEntryID</i> does not exist.</dd>
<dt>
MAPI_E_UNKNOWN_CPID</dt>
<dd>
The server is not configured to support the client's code page.</dd>
<dt>
MAPI_E_UNKNOWN_LCID</dt>
<dd>
The server is not configured to support the client's locale information.</dd>
<dt>
MAPI_W_ERRORS_RETURNED</dt>
<dd>
The call succeeded, but the message store provider has error information available. When this warning is returned, the call should be handled as successful. To get the error information from the provider, call the <a href="inter023_8lde.htm"><b>IMAPISession::GetLastError</b></a> method. To test for this warning, use the <b>HR_FAILED</b> macro. See <a href="extend_5k9z.htm">Using Macros for Error Handling</a>.
</dd>
</dl>
<h4>Remarks</h4>
<p>
The <b>IMAPISession::OpenMsgStore</b> method opens a particular message store. </p>
<h4>Notes to Callers</h4>
<p>
The default access level for message stores is read-only. If you set the MDB_WRITE flag, you may or may not be granted read/write access. The final level of access that MAPI assigns to the message store depends on your level of access, the message store itself, and the message store provider. </p>
<p>
If you call <b>OpenMsgStore</b> to open a message store with read-only access:
<ul>
<li>
The store's <a href="propb_01t7.htm">PR_STORE_SUPPORT_MASK</a> property will not have its STORE_MODIFY_OK and STORE_CREATE_OK bits set. </li>
<li>
Calls to open one of the message store's messages or folders using <a href="inter023_146x.htm"><b>IMAPISession::OpenEntry</b></a> with the MAPI_MODIFY flag set will fail.</li>
<li>
Calls to open one of the properties of the message store's messages or folders using <a href="inter022_15vd.htm"><b>IMAPIProp::OpenProperty</b></a> and the MAPI_MODIFY will fail.</li>
<li>
Calls to any of the following methods will fail: <p>
<a href="inter013_7wv9.htm"><b>IMAPIFolder::CreateMessage</b></a>
<p>
<a href="inter013_1ttf.htm"><b>IMAPIFolder::DeleteMessages</b></a>
<p>
<a href="inter013_9tpu.htm"><b>IMAPIFolder::CreateFolder</b></a>
<p>
<a href="inter013_0a42.htm"><b>IMAPIFolder::DeleteFolder</b></a>
<p>
<a href="inter013_6pmb.htm"><b>IMAPIFolder::SetMessageStatus</b></a>
<p>
<a href="inter022_6cxf.htm"><b>IMAPIProp::SetProps</b></a>
<p>
<a href="inter022_37xv.htm"><b>IMAPIProp::DeleteProps</b></a>
</li>
<li>
Calls to the following methods fail if the destination for the copied message is read-only, whether it be the same as the source message store or another read-only store:<p>
<a href="inter013_596b.htm"><b>IMAPIFolder::CopyMessages</b></a>
<p>
<a href="inter013_0mcy.htm"><b>IMAPIFolder::CopyFolder</b></a>
<p>
<a href="inter022_83qn.htm"><b>IMAPIProp::CopyTo</b></a>
</li>
</ul>
<p>&nbsp;</p></body>
</HTML>
