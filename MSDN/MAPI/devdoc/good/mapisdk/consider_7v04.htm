<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Creating a Distribution List</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_creating_a_distribution_list"></a>Creating a Distribution List</h2>
<p>
Clients can create a distribution list directly into a modifiable container such as the personal address book (PAB).</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To create a distribution list in the PAB</h5>
<ol>
<li>
Create a sized property tag array with one property tag, <a href="propa_4hkc.htm">PR_DEF_CREATE_DL</a>, as follows:</li>
</ol>
<pre><code>SizedPropTagArray(1, tagaDefaultDL) = 
{
    1,
    {
        PR_DEF_CREATE_DL
    }
};</code></pre>
<ol start=2>
<li>
Call <a href="inter006_89wi.htm"><b>IAddrBook::GetPAB</b></a> to retrieve the entry identifier of the PAB. If there is an error or <b>GetPAB</b> returns zero or NULL, do not continue. </li>
</ol>
<pre><code>LPENTRYID peidPAB = NULL;
ULONG cbeidPAB = 0;
lpIAddrBook-&gt;GetPAB(&amp;cbeidPAB, &amp;peidPAB);</code></pre>
<ol start=3>
<li>
Call <a href="inter006_4cc9.htm"><b>IAddrBook::OpenEntry</b></a> to open the PAB. The <i>ulObjType</i> output parameter should be set to MAPI_ABCONT.</li>
</ol>
<pre><code>ULONG ulObjType = 0;
LPABCONT lpPABCont = NULL;
lpIAddrBook-&gt;OpenEntry(cbeidPAB, peidPAB,
                NULL,
                MAPI_MODIFY,
                &amp;ulObjType,
                &amp;lpPABCont);</code></pre>
<ol start=4>
<li>
Call the PAB's <a href="inter022_44c3.htm"><b>IMAPIProp::GetProps</b></a> method to retrieve the PR_DEF_CREATE_DL property, the template that it uses to create a distribution list. </li>
</ol>
<pre><code>lpPABCont-&gt;GetProps(0,
            tagaDefaultDL,
            &amp;lpspvDefDLTpl);
</code></pre>
<ol start=5>
<li>
If <b>GetProps</b> fails:<ol type=a>
<li>
Call the PAB's <a href="inter022_15vd.htm"><b>IMAPIProp::OpenProperty</b></a> method to open the <a href="propa_6h83.htm">PR_CREATE_TEMPLATES</a> property with the <b>IMAPITable</b> interface.</li>
<li>
Create a property restriction to search for the row with the <a href="propa_4gkl.htm">PR_ADDRTYPE</a> column equal to "MAPIPDL." </li>
<li>
Call <a href="inter026_2lkn.htm"><b>IMAPITable::FindRow</b></a> to locate this row.</li>
</ol>
</li>
<li>
Save the entry identifier returned by either <b>GetProps</b> or <b>FindRow</b>.</li>
</ol>
<pre><code>peidDefDLTpl = lpspvDefDLTpl-&gt;Value.bin.pb;
cbeidDefDLTpl = lpspvDefDLTpl-&gt;Value.bin.cb;
</code></pre>
<ol start=7>
<li>
Call the PAB's <a href="inter003_8b21.htm"><b>IABContainer::CreateEntry</b></a> method to create a new entry using the template represented by the saved entry identifier. Do not assume that the object returned will be a distribution list rather than a messaging user when this call is remoted. Notice that the CREATE_CHECK_DUP flag is passed in the <i>ulFlags</i> parameter to prevent the entry from being added twice.</li>
</ol>
<pre><code>lpPABCont-&gt;CreateEntry(cbeidDefDLTpl,
                peidDefDLTPL,
                CREATE_CHECK_DUP_STRICT,
                &amp;lpNewPABEntry);</code></pre>
<ol start=8>
<li>
Call the new entry's <b>IUnknown::QueryInterface </b>method, passing IID_IDistList as the interface identifier, to determine if the entry is a distribution list and supports the <a href="inter008_5tf6.htm"><b>IDistList</b></a> interface. Because <b>CreateEntry</b> returns an <b>IMAPIProp</b> pointer rather than the more specific <b>IMailUser</b> or <b>IDistList</b> pointer, check that a distribution list object was created. If <b>QueryInterface</b> succeeds, you can be sure that you have created a distribution list rather than a messaging user.</li>
<li>
Call the distribution list's <a href="inter022_6cxf.htm"><b>IMAPIProp::SetProps</b></a> method to set its display name and other properties.</li>
<li>
Call the distribution list's <a href="inter003_8b21.htm"><b>IABContainer::CreateEntry</b></a> method to add one or more messaging users. </li>
<li>
Call the distribution list's <a href="inter022_5rqr.htm"><b>IMAPIProp::SaveChanges</b></a> method when you're ready to save it. To retrieve the entry identifier of the saved distribution list, set the KEEP_OPEN_READWRITE flag and then call <a href="inter022_44c3.htm"><b>IMAPIProp::GetProps</b></a> asking for the <a href="propa_8cv8.htm">PR_ENTRYID</a> property.</li>
<li>
Release the new distribution list and the PAB by calling their <b>IUnknown::Release</b> methods.</li>
<li>
Call <a href="function_85yq.htm"><b>MAPIFreeBuffer</b></a> to release the memory for the entry identifier of the PAB and the sized property tag array.</li>
</ol>
<p>&nbsp;</p></body>
</HTML>
