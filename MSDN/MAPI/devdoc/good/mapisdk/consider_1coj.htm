<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Tracking Conversations</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_tracking_conversations"></a>Tracking Conversations</h2>
<p>
Conversation tracking is collecting responses to a message. Clients should set two properties that aid in tracking conversations:</p>
<p class=indent1>
<a href="propa_1e77.htm">PR_CONVERSATION_TOPIC</a></p>
<p class=indent1>
<a href="propa_96m0.htm">PR_CONVERSATION_INDEX</a></p>
<p>
PR_CONVERSATION_TOPIC is the normalized subject of the message, the subject without the prefix strings. Set this property to the value of the message's <a href="propb_5xo4.htm">PR_NORMALIZED_SUBJECT</a> property. </p>
<p>
PR_CONVERSATION_INDEX indicates the position of the message within a particular conversation. It is a client's reponsibility to set PR_CONVERSATION_INDEX for each outgoing message, whether it is a new message, a forwarded message, or a reply. Clients can set this property manually or call <a href="function_8xfc.htm"><b>ScCreateConversationIndex</b></a>, a utility function provided by MAPI. </p>
<p>
<b>ScCreateConversationIndex</b> generates the value of a conversation index for any outgoing message. <b>ScCreateConversationIndex</b> implements the index as a header block that is 22 bytes in length, followed by zero or more child blocks each 5 bytes in length. </p>
<p>
The header block is composed of 22 bytes, divided into three parts:
<ul>
<li>
One reserved byte. Its value is 1.</li>
<li>
Five bytes for the current system time converted to the <b>FILETIME</b> structure format.</li>
<li>
Sixteen bytes holding a <b>GUID</b>, or globally unique identifier.</li>
<li>
Each child block is composed of 5 bytes, divided as follows:</li>
<li>
One bit containing a code representing the difference between the current time and the time stored in the header block. This bit will be 0 if the difference is less than .02 second and greater than two years and 1 if the difference is less than one second and greater than 56 years.</li>
<li>
Thirty one bits containing the difference between the current time and the time in the header block expressed in <b>FILETIME</b> units.This part of the child block is produced using one of two strategies, depending on the value of the first bit. If this bit is zero, <b>ScCreateConversationIndex</b> discards the high 15 bits and the low 18 bits. If this bit is one, the function discards the high 10 bits and the low 23 bits. </li>
<li>
Four bits containing a random number generated by calling the Win32 function <b>GetTickCount</b>.</li>
<li>
Four bits containing a sequence count that is taken from part of the random number.</li>
</ul>
<p>
If you choose to set the conversation indexes of messages manually, consider the following suggestions:
<ol>
<li>
Keep differences in the respondents' time zones transparent; use UTC times rather than local time.</li>
<li>
Indent each conversation group by the same amount.</li>
<li>
Sort responses to the same message date.</li>
<li>
Separate threads started at different times that happen to share the same topic. </li>
<li>
To implement a categorized sort so that messages are grouped by topic, sort by PR_CONVERSATION_TOPIC first and then by PR_CONVERSATION_INDEX. To present the results of the sort, set the PR_DEPTH property to 0 for messages with a conversation index that is 22 bytes in length. Then, for every 5-byte increment in the length, increment the value of the PR_DEPTH property by one. </li>
</ol>
<p>
The PR_ORIGINAL group of properties can also be used for conversation tracking. Set these properties to link reply or forwarded messages to the original message. All of the PR_ORIGINAL properties are optional. If you do not explicitly set, for example, <a href="propb_2m90.htm">PR_ORIGINAL_AUTHOR_ENTRYID</a>, the message store provider can use the default value, or the value of the <a href="propb_1pno.htm">PR_SENDER_ENTRYID</a> property. Likewise, if you do not set <a href="propb_9hd1.htm">PR_ORIGINAL_AUTHOR_NAME</a> or <a href="propb_2p7p.htm">PR_ORIGINAL_SUBMIT_TIME</a>, these properties can default to the values of the PR_SENDER_NAME and PR_CLIENT_SUBMIT_TIME properties, respectively. </p>
<p>&nbsp;</p></body>
</HTML>
