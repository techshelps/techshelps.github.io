<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IMAPIFolder::CopyFolder</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_imapifolder_copyfolder"></a>IMAPIFolder::CopyFolder</h2>
<p>
The <b>IMAPIFolder::CopyFolder</b> method copies or moves a subfolder.</p>
<h4>Quick Info</h4>
<p>
See <a href="inter013_9ohe.htm"><b>IMAPIFolder : IMAPIContainer</b></a>.</p>
<pre><code><b>HRESULT CopyFolder(
  ULONG</b><i> cbEntryID</i><b>,</b>            
<b>  LPENTRYID</b><i> lpEntryID</i><b>,</b>        
<b>  LPCIID</b><i> lpInterface</i><b>,</b>         
<b>  LPVOID</b><i> lpDestFolder</i><b>,</b>        
<b>  LPTSTR</b><i> lpszNewFolderName</i><b>,</b>   
<b>  ULONG</b><i> ulUIParam</i><b>,</b>            
<b>  LPMAPIPROGRESS</b><i> lpProgress</i><b>,</b>   
<b>  ULONG</b><i> ulFlags               </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>cbEntryID</i></dt>
<dd>
[in] Count of bytes in the entry identifier pointed to by the <i>lpEntryID</i> parameter.</dd>
<dt>
<i>lpEntryID</i></dt>
<dd>
[in] Pointer to the entry identifier of the subfolder to copy or move.</dd>
<dt>
<i>lpInterface</i></dt>
<dd>
[in] Pointer to the interface identifier (IID) representing the interface to be used to access the folder pointed to by the <i>lpDestFolder</i> parameter. Passing NULL results in the service provider returning the standard folder interface, <a href="inter013_9ohe.htm"><b>IMAPIFolder</b></a>. Valid values for <i>lpInterface </i>include IID_IUnknown, IID_IMAPIProp, IID_IMAPIContainer, or IID_IMAPIFolder.</dd>
<dt>
<i>lpDestFolder</i></dt>
<dd>
[in] Pointer to the open folder to receive the copied or moved subfolder.</dd>
<dt>
<i>lpszNewFolderName</i></dt>
<dd>
[in] Pointer to the name of the copied or moved folder in its new destination. If <i>lpszNewFolderName</i> is set to NULL, the name of the source subfolder is used for the name of the destination folder.</dd>
<dt>
<i>ulUIParam</i></dt>
<dd>
[in] Handle of the parent window for the progress indicator. The <i>ulUIParam</i> parameter is ignored unless the FOLDER_DIALOG flag in the <i>ulFlags</i> parameter is set. </dd>
<dt>
<i>lpProgress</i></dt>
<dd>
[in] Pointer to a progress object for displaying a progress indicator. If NULL is passed in <i>lpProgress</i>, the message store provider displays a progress indicator using the MAPI progress object implementation. The <i>lpProgress</i> parameter is ignored unless the FOLDER_DIALOG flag is set in <i>ulFlags</i>.</dd>
<dt>
<i>ulFlags</i></dt>
<dd>
[in] Bitmask of flags that controls the copy or move operation. The following flags can be set:
<dl>
<dt>
COPY_SUBFOLDERS</dt>
<dd>
All of the subfolders in the subfolder to be copied should also be copied. When COPY_SUBFOLDERS is not set for a copy operation, only the subfolder identified by <i>lpEntryID</i> is copied. With a move operation, the COPY_SUBFOLDERS behavior is the default regardless of whether the flag is set. </dd>
<dt>
FOLDER_DIALOG</dt>
<dd>
Requests the display of a progress indicator.</dd>
<dt>
FOLDER_MOVE</dt>
<dd>
The subfolder is to be moved rather than copied. If FOLDER_MOVE is not set, the subfolder is copied.</dd>
<dt>
MAPI_DECLINE_OK</dt>
<dd>
Informs the message store provider that if it implements <b>CopyFolder</b> by calling its support object's <a href="inter025_2zcf.htm"><b>IMAPISupport::DoCopyTo</b></a><b> </b>or<b> <a href="inter025_054j.htm">IMAPISupport::DoCopyProps</a> </b>method, it should instead immediately return MAPI_E_DECLINE_COPY from <b>CopyFolder</b>. </dd>
<dt>
MAPI_UNICODE</dt>
<dd>
The name of the destination folder is in Unicode format. If the MAPI_UNICODE flag is not set, the folder name is in ANSI format.
</dd>
</dl>
</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
S_OK</dt>
<dd>
The specified folder has been successfully copied or moved.</dd>
<dt>
MAPI_E_BAD_CHARWIDTH</dt>
<dd>
Either the MAPI_UNICODE flag was set and the message store provider does not support Unicode, or MAPI_UNICODE was not set and the message store provider only supports Unicode.</dd>
<dt>
MAPI_E_COLLISION</dt>
<dd>
The name of the folder being moved or copied is the same as that of a subfolder in the destination folder. The message store provider requires that folder names be unique.</dd>
<dt>
MAPI_E_DECLINE_COPY</dt>
<dd>
The provider implements this method by calling a support object method and the caller has passed the MAPI_DECLINE_OK flag.</dd>
<dt>
MAPI_E_FOLDER_CYCLE</dt>
<dd>
The source folder directly or indirectly contains the destination folder. Significant work might have been performed before this condition was discovered so the source and destination folder might be partially modified. </dd>
<dt>
MAPI_W_PARTIAL_COMPLETION</dt>
<dd>
The call succeeded, but not all entries were successfully copied. When this warning is returned, the call should be handled as successful. To test for this warning, use the <b>HR_FAILED</b> macro. See <a href="extend_5k9z.htm">Using Macros for Error Handling</a>.
</dd>
</dl>
<h4>Remarks</h4>
<p>
The <b>IMAPIFolder::CopyFolder</b> method copies or moves a subfolder from one location to another. The subfolder being copied or moved is added to the destination folder as a subfolder. </p>
<h4>Notes to Implementers</h4>
<p>
When the copy or move operation involves more than one folder, as indicated by the COPY_SUBFOLDERS flag being set, perform the operation as completely as possible for each folder. Sometimes one of the folders to be moved or copied does not exist or has already been moved or copied elsewhere. Do not stop the operation prematurely unless a failure occurs that is beyond your control, such as running out of memory, running out of disk space, or corruption in the message store.</p>
<p>
Try to retain all message entry identifiers in the copied messages. Preserving entry identifiers is not required, but it is recommended. </p>
<h4>Notes to Callers</h4>
<p>
Expect these return values under the following conditions:</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=48%>Condition</th>
<th align=left width=52%>Return value</th>
</tr>
<tr valign=top>
<td width=48%><b>CopyFolder</b> has successfully copied or moved every message and subfolder.</td>
<td width=52%>S_OK</td>
</tr>
<tr valign=top>
<td width=48%><b>CopyFolder</b> was unable to successfully copy or move every message and subfolder.</td>
<td width=52%>MAPI_W_PARTIAL_COMPLETION or MAPI_E_NOT_FOUND</td>
</tr>
<tr valign=top>
<td width=48%><b>CopyFolder </b>was unable to complete.</td>
<td width=52%>Any error value except MAPI_E_NOT_FOUND</td>
</tr>
</table><br>
<p>
When <b>CopyFolder</b> is unable to complete, do not assume that no work was done. <b>CopyFolder</b> might have been able to copy or move one or more of the messages and subfolders before encountering the error. </p>
<p>
If an entry identifier for a folder that doesn't exist is passed in <i>lpEntryID</i>, <b>CopyFolder</b> returns MAPI_W_PARTIAL_COMPLETION or MAPI_E_NOT_FOUND, depending on the message store's implementation.</p>
<p>
Depending on the message store provider, the entry identifier of the original message may or may not be preserved in the copied message. MAPI recommends that entry identifiers be preserved whenever possible, but it is not a requirement. You can generally depend on the following:
<ul>
<li>
When moving a folder between two different types of message stores, the entry identifier is guaranteed to change.</li>
<li>
When moving a folder between two message stores of the same type, the entry identifier almost always changes.</li>
<li>
When moving a folder to another location within the same message store, the entry identifier might or might not change, depending on the message store provider.</li>
</ul>
<p>&nbsp;</p></body>
</HTML>
