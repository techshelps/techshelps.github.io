<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Building a Restriction</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_mapi1book_building_a_restriction"></a>Building a Restriction</h3>
<p>
To build a restriction, a client application creates a hierarchy of one or more restriction structures of various types and passes a pointer to the hierarchy to the <a href="inter026_43lg.htm"><b>IMAPITable::Restrict</b></a> or <a href="inter026_2lkn.htm"><b>IMAPITable::FindRow</b></a> method. The illustration that follows and the code sample in <a href="tables_8up1.htm">Sample Restriction Code</a> demonstrate how a typical restriction is implemented with linked restriction structures of different types. In this example, a user of a client application is trying to find all messages that contain the word "volleyball" in the subject line and were sent to Sue from Sam. First, a generic <a href="structyp_45ny.htm"><b>SRestriction</b></a> structure is allocated. This structure becomes the basis for other calls to the <a href="function_11wl.htm"><b>MAPIAllocateMore</b></a> function to create linked <a href="structyp_45ny.htm"><b>SRestriction</b></a> and <a href="structyp_9sbp.htm"><b>SPropValue</b></a> structures that can be freed with a single call to <a href="function_85yq.htm"><b>MAPIFreeBuffer</b></a>. Because the criteria to apply to the set of messages is in three parts, the top level restriction structure is an <b>AND</b> restriction. The <a href="structyp_0v1q.htm"><b>SAndRestriction</b></a> structure's <b>cRes</b> member is set to 3 to indicate the three restrictions to evaluate and its <b>lpRes</b> member is set to a three member array of <b>SRestriction</b> structures.</p>
<p>
To search for messages that are sent to a particular recipient, it is necessary to search the recipient table for each message rather than the message itself. A subobject restriction is used to perform the recipient table search. Therefore, the first member of the array points to an <a href="structyp_3lim.htm"><b>SSubRestriction</b></a> structure with its <b>ulSubObject</b> member set to <a href="propa_1zw3.htm">PR_MESSAGE_RECIPIENTS</a>. Then, to specify what to look for in the recipient table, a content restriction is used. </p>
<p>
The second and third members of the array are more straightforward. They both point to content restriction structures, one to search for messages that have a <a href="propb_9orp.htm">PR_SENDER_NAME</a> property set to "Sam" and another that has a <a href="propb_3c8k.htm">PR_SUBJECT</a> property set to "volleyball."</p>
<p>
<img src="images/amapi_61.gif" border=0></p>
<p>&nbsp;</p></body>
</HTML>
