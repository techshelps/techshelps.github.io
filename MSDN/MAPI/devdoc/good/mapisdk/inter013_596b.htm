<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IMAPIFolder::CopyMessages</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_imapifolder_copymessages"></a>IMAPIFolder::CopyMessages</h2>
<p>
The <b>IMAPIFolder::CopyMessages</b> method copies or moves one or more messages.</p>
<h4>Quick Info</h4>
<p>
See <a href="inter013_9ohe.htm"><b>IMAPIFolder : IMAPIContainer</b></a>.</p>
<pre><code><b>HRESULT CopyMessages(
  LPENTRYLIST</b><i> lpMsgList</i><b>,</b>   
<b>  LPCIID</b><i> lpInterface</i><b>,</b>      
<b>  LPVOID</b><i> lpDestFolder</i><b>,</b>     
<b>  ULONG</b><i> ulUIParam</i><b>,</b>         
<b>  LPMAPIPROGRESS</b><i> lpProgress</i><b>,</b>   
<b>  ULONG</b><i> ulFlags            </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>lpMsgList</i></dt>
<dd>
[in] Pointer to an array of <a href="structyp_8o1g.htm"><b>ENTRYLIST</b></a> structures that identify the message or messages to copy or move.</dd>
<dt>
<i>lpInterface</i></dt>
<dd>
[in] Pointer to the interface identifier (IID) representing the interface to be used to access the destination folder pointed to by the <i>lpDestFolder</i> parameter. Passing NULL results in the service provider returning the standard folder interface, <a href="inter013_9ohe.htm"><b>IMAPIFolder</b></a>. Clients must pass NULL. Other callers can set the <i>lpInterface </i>parameter to IID_IUnknown, IID_IMAPIProp, IID_IMAPIContainer, or IID_IMAPIFolder.  </dd>
<dt>
<i>lpDestFolder</i></dt>
<dd>
[in] Pointer to the open folder to receive the copied or moved messages.</dd>
<dt>
<i>ulUIParam</i></dt>
<dd>
[in] Handle of the parent window for any dialog boxes or windows this method displays. The <i>ulUIParam</i> parameter is ignored unless the client sets the MESSAGE_DIALOG flag in the <i>ulFlags</i> parameter and passes NULL in the <i>lpProgress</i> parameter.</dd>
<dt>
<i>lpProgress</i></dt>
<dd>
[in] Pointer to a progress object for displaying a progress indicator. If NULL is passed in <i>lpProgress</i>, the message store provider displays a progress indicator using the MAPI progress object implementation. The <i>lpProgress</i> parameter is ignored unless the MESSAGE_DIALOG flag is set in <i>ulFlags</i>.</dd>
<dt>
<i>ulFlags</i></dt>
<dd>
[in] Bitmask of flags that controls how the copy or move operation is accomplished. The following flags can be set:
<dl>
<dt>
MAPI_DECLINE_OK</dt>
<dd>
Informs the message store provider to immediately return MAPI_E_DECLINE_COPY if it implements <b>CopyMessage</b> by calling the support object's <a href="inter025_2zcf.htm"><b>IMAPISupport::DoCopyTo</b></a><b> </b>or<b> <a href="inter025_054j.htm">IMAPISupport::DoCopyProps</a> </b>method.</dd>
<dt>
MESSAGE_DIALOG</dt>
<dd>
Displays a progress indicator as the operation proceeds.</dd>
<dt>
MESSAGE_MOVE</dt>
<dd>
The message or messages are to be moved rather than copied. If MESSAGE_MOVE is not set, the messages are copied.
</dd>
</dl>
</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
S_OK</dt>
<dd>
The message or messages have been successfully copied or moved.</dd>
<dt>
MAPI_E_DECLINE_COPY</dt>
<dd>
The provider implements this method by calling a support object method and the caller has passed the MAPI_DECLINE_OK flag.</dd>
<dt>
MAPI_W_PARTIAL_COMPLETION</dt>
<dd>
The call succeeded, but not all entries were successfully copied or moved. When this warning is returned, the call should be handled as successful. To test for this warning, use the <b>HR_FAILED</b> macro. See <a href="extend_5k9z.htm">Using Macros for Error Handling</a>.
</dd>
</dl>
<h4>Remarks</h4>
<p>
The <b>IMAPIFolder::CopyMessages</b> method copies or moves messages to another folder. </p>
<p>
Messages that are open with read/write access can be moved or copied. </p>
<h4>Notes to Implementers</h4>
<p>
If you are copying messages to another message store without using the <b>IMAPISupport::CopyMessages</b> method, you must first call <a href="inter013_1msz.htm"><b>IMAPIFolder::SetReadFlags</b></a> with the GENERATE_RECEIPT_ONLY flag set. The receiving message store is not responsible for generating read reports for the copied or moved messages. If you are calling <b>IMAPISupport::CopyMessages</b> to implement <b>IMAPIFolder::CopyMessages</b>, do not make the <b>SetReadFlags</b> call. MAPI will take care of it. </p>
<p>
Move or copy the messages in any order and generate read status reports in any order. That is, you can finish copying messages before generating any of the read status reports or send the reports before beginning the copy. However, read reports should be sent for all messages to be copied, regardless of whether or not the copy is successful.</p>
<p>
When the copy or move operation involves more than one message, perform the operation as completely as possible. Do not stop the operation prematurely unless a failure occurs that is beyond your control, such as running out of memory, running out of disk space, or corruption in the message store.</p>
<p>
Try to maintain entry identifiers across move or copy operations.</p>
<p>
Send notifications when moving or copying messages so that clients are forewarned that their calls to the messages' <a href="inter022_5rqr.htm"><b>IMAPIProp::SaveChanges</b></a> methods may fail.</p>
<p>
Do not include a message's status in the copy or move operation. Moving or copying a message status greatly affects performance.</p>
<h4>Notes to Callers</h4>
<p>
Use <b>CopyMessages</b> for populating search-results folders, where messages are often grouped by parent folder. </p>
<p>
Expect these return values under the following conditions:</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=48%>Condition</th>
<th align=left width=52%>Return value</th>
</tr>
<tr valign=top>
<td width=48%><b>CopyMessages</b> has successfully copied or moved every message.</td>
<td width=52%>S_OK</td>
</tr>
<tr valign=top>
<td width=48%><b>CopyMessages</b> was unable to successfully copy or move every message.</td>
<td width=52%>MAPI_W_PARTIAL_COMPLETION</td>
</tr>
<tr valign=top>
<td width=48%><b>CopyMessages </b>was unable to complete.</td>
<td width=52%>Any error value</td>
</tr>
</table><br>
<p>
When <b>CopyMessages</b> is unable to complete, do not assume that no work was done. <b>CopyMessages</b> might have been able to copy or move one or more messages before encountering the error. </p>
<p>&nbsp;</p></body>
</HTML>
