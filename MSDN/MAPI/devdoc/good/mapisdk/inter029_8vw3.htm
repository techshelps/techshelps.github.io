<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IMessage::ModifyRecipients</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_imessage_modifyrecipients"></a>IMessage::ModifyRecipients</h2>
<p>
The <b>IMessage::ModifyRecipients</b> method adds, deletes, or modifies message recipients.</p>
<h4>Quick Info</h4>
<p>
See <a href="inter029_525s.htm"><b>IMessage : IMAPIProp</b></a>.</p>
<pre><code><b>HRESULT ModifyRecipients(
  ULONG</b><i> ulFlags</i><b>,</b>   
<b>  LPADRLIST</b><i> lpMods </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>ulFlags</i></dt>
<dd>
[in] Bitmask of flags that controls the recipient changes. If zero is passed for the <i>ulFlags </i>parameter, <b>ModifyRecipients</b> replaces all existing recipients with the recipient list pointed to by the <i>lpMods</i> parameter. The following flags can be set for <i>ulFlags</i>:
<dl>
<dt>
MODRECIP_ADD</dt>
<dd>
The recipients pointed to by the <i>lpMods</i> parameter should be added to the recipient list. </dd>
<dt>
MODRECIP_MODIFY</dt>
<dd>
The recipients pointed to by the <i>lpMods</i> parameter should replace existing recipients. All of the existing properties are replaced by those in the corresponding <a href="structyp_6m49.htm"><b>ADRENTRY</b></a> structure. </dd>
<dt>
MODRECIP_REMOVE</dt>
<dd>
Existing recipients should be removed from the recipient list using as an index the <a href="propb_017o.htm">PR_ROWID</a> property included in the property value array of each recipient entry in the <i>lpMods</i> parameter. </dd>
</dl>
</dd>
<dt>
<i>lpMods</i></dt>
<dd>
[in] Pointer to an <a href="structyp_87n8.htm"><b>ADRLIST</b></a><b> </b>structure containing a list of recipients to be added, deleted, or modified in the message.
</dd>
</dl>
<h4>Return Value</h4>
<dl>
<dt>
S_OK</dt>
<dd>
The recipient list was successfully modified.
</dd>
</dl>
<h4>Remarks</h4>
<p>
The <b>IMessage::ModifyRecipients</b> method changes the message's recipient list. It is from this list, held in an <a href="structyp_87n8.htm"><b>ADRLIST</b></a> structure, that the recipient table is built.</p>
<p>
The <b>ADRLIST</b> structure contains one <a href="structyp_6m49.htm"><b>ADRENTRY</b></a> structure for each recipient and each <b>ADRENTRY</b> structure contains an array of property values describing the recipient properties. </p>
<p>
Recipients in the <b>ADRLIST</b> structure can be resolved or unresolved. The difference is in the number and type of properties that are included. An unresolved recipient contains only the <a href="propa_1yjp.htm">PR_DISPLAY_NAME</a> and <a href="propb_0n6t.htm">PR_RECIPIENT_TYPE</a> properties while a resolved recipient contains those two properties plus <a href="propa_4gkl.htm">PR_ADDRTYPE</a> and <a href="propa_8cv8.htm">PR_ENTRYID</a>. If <a href="propa_2t9v.htm">PR_EMAIL_ADDRESS</a> is available, it can be included also.</p>
<p>
By the time a message is submitted, it must include only resolved recipients in its recipient list. Unresolved recipients cause nondelivery reports to be created and sent to the original sender of the message. For more information about the name resolution process from the client perspective, see <a href="consider_3i1x.htm">Resolving a Name</a>. For more information from the perspective of the address book provider, see <a href="ab_94by.htm">Implementing Name Resolution</a>.</p>
<p>
In addition to resolved and unresolved recipients, a recipient can be NULL. That is, the <b>cValues</b> member of the <b>ADRENTRY</b> structure for the recipient is set to zero and the <b>rgPropVals</b> member is set to NULL. </p>
<h4>Notes to Callers</h4>
<p>
You can create a recipient list by calling <a href="inter025_2m2b.htm"><b>IAddrBook::Address</b></a> to display the common dialog box and prompt the user to select entries. The address list pointed to by the <i>lppAdrList</i> parameter to <b>Address</b> can be passed to <b>ModifyRecipients</b> as the <i>lpMods</i> parameter.</p>
<p>
When you specify properties for a recipient in the <a href="structyp_87n8.htm"><b>ADRLIST</b></a> structure, include all of the recipient's properties, not only the new or changed ones. When a recipient is modified, any properties not included in the <b>ADRLIST</b> structure are deleted. To retrieve the current set of properties for all of a message's recipients, call <a href="inter029_9zhh.htm"><b>GetRecipientTable</b></a> and retrieve all of the rows. Because an <b>SRowSet</b> is identical in structure to an <b>ADRLIST</b>, you can use them interchangeably.</p>
<p>
<b>ModifyRecipients</b> replaces all of the entries in the current recipient list with the information pointed to by <i>lpMods</i> when none of the flags are set in the <i>ulFlags</i> parameter. </p>
<h4>Notes to Callers</h4>
<p>
When you set the MODRECIP_MODIFY flag, <b>ModifyRecipients</b> replaces each entire recipient row with the associated row in the <a href="structyp_87n8.htm"><b>ADRLIST</b></a> structure passed in <i>lpMods</i>. Be careful to specify all of the properties that a recipient should have regardless of whether they have changed to prevent them from being unintentionally deleted.</p>
<p>
Following are some rules for setting the properties of the recipients in the <b>ADRLIST</b> structure: 
<ul>
<li>
Do not use PT_NULL as a property type. <b>ModifyRecipients </b>returns an error when encountering this value.</li>
<li>
Do not use PT_ERROR as a property type. <b>ModifyRecipients </b>ignores this value. </li>
<li>
Include the <a href="propb_017o.htm">PR_ROWID</a> property for all recipients when you set either the MODRECIP_REMOVE or MODRECIP_MODIFY flag in <i>ulFlags</i>. </li>
<li>
Do not include the PR_ROWID property for any of the recipients when you set the MODRECIP_ADD flag in <i>ulFlags</i> or when you pass zero in <i>ulFlags</i>.</li>
</ul>
<p>
If you include either the <a href="propa_4gkl.htm">PR_ADDRTYPE</a> property or <a href="propa_2t9v.htm">PR_EMAIL_ADDRESS</a> property for a recipient and one or both of these properties are inconsistent with the address type and address of the recipient as identified by <a href="propa_8cv8.htm">PR_ENTRYID</a>, the results are undefined. That is, there are three possibilities, depending on the service provider:
<ul>
<li>
The message will be delivered to the address described by the PR_ADDRTYPE and PR_EMAIL_ADDRESS properties.</li>
<li>
The message will be delivered to the recipient identified by PR_ENTRYID.</li>
<li>
The message will be declared undeliverable due to the ambiguity of the address information.</li>
</ul>
<p>
Use the allocation rules outlined in <a href="extend_41ir.htm">Managing Memory for <b>ADRLIST</b> and <b>SRowSet</b> Structures</a> to allocate memory for the recipient list. <b>ModifyRecipients</b> does not free the <b>ADRLIST</b> structure nor any of its substructures. The <b>ADRLIST</b> structure and each <a href="structyp_9sbp.htm"><b>SPropValue</b></a> structure must be separately allocated by using the <a href="function_8z3m.htm"><b>MAPIAllocateBuffer</b></a> function such that each can be freed individually. If the method requires additional space for any <b>SPropValue</b> structure, it can replace the <b>SPropValue</b> structure with a new one that can later be freed using <a href="function_85yq.htm"><b>MAPIFreeBuffer</b></a>. The original <b>SPropValue</b> structure should also be freed using <b>MAPIFreeBuffer</b>.</p>
<h4>See Also</h4>
<p>
<a href="structyp_6m49.htm"><b>ADRENTRY</b></a>, <a href="structyp_87n8.htm"><b>ADRLIST</b></a>, <a href="inter006_2fn7.htm"><b>IAddrBook::Address</b></a>, <a href="inter025_2m2b.htm"><b>IMAPISupport::Address</b></a>, <a href="function_8z3m.htm"><b>MAPIAllocateBuffer</b></a>, <a href="function_85yq.htm"><b>MAPIFreeBuffer</b></a>, <a href="structyp_9sbp.htm"><b>SPropValue</b></a></p>
<p>&nbsp;</p></body>
</HTML>
