<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>TNEF Processing</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_tnef_processing"></a>TNEF Processing</h2>
<p>
The following series of actions describe how transports use TNEF methods to process outgoing and incoming messages.</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To send a message that includes a TNEF stream</h5>
<ol>
<li>
Process the message properties that are supported by the messaging system.</li>
<li>
Mark the message in an implementation specific way so that the receiving transport provider can determine that the message requires TNEF processing. For example, a TNEF transport provider sending to an SMTP messaging system might add a custom header field like "X-CONTAINS-TNEF" to indicate that the message contains TNEF data.</li>
<li>
Obtain a TNEF object and uses it to encapsulate the message properties not supported by the messaging system into a TNEF stream.</li>
<li>
Encode the TNEF stream using the messaging system's attachment model. For example, if the underlying attachment model is to uuencode attachments and append them to the message text, then the transport provider must uuencode the TNEF stream into another attachment.<p>
The transport provider must also implement a method for recognizing which attachment contains the encoded TNEF stream when it receives a message. The standard way to mark this attachment is to give it an attachment filename of "WINMAIL.DAT". If your transport provider does this, any other TNEF-enabled transport providers that follow this convention will be able to interoperate with it.
</li>
<li>
Use <a href="inter041_0ai6.htm"><b>ITnef</b></a> interface methods to insert tags describing the positions of message attachments in the message text.</li>
<li>
Access the tagged message text through OLE <b>IStream</b> methods, and send it to the messaging system.</li>
</ol>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To retrieve encapsulated properties</h5>
<ol>
<li>
Write the properties supported by the messaging system into a new message, including the tagged message text that contains the encapsulated properties.</li>
<li>
Decode the TNEF stream from the proper attachment.</li>
<li>
Decode any other attachments and write them to new MAPI attachments on a message.</li>
<li>
Open the TNEF stream for decoding using the <a href="function_3qk8.htm"><b>OpenTnefStreamEx</b></a> function.</li>
<li>
Use the <a href="inter041_44c3.htm"><b>ITnef::ExtractProps</b></a> method to decode the TNEF stream and write the encapsulated properties into the new message. Any encoded properties that are duplicates of nonencoded properties will overwrite them when the encoded properties are decoded.</li>
<li>
Use the <a href="inter041_4k8p.htm"><b>ITnef::OpenTaggedBody</b></a> method to parse the message text to recover attachment positions from the tags in the message text.</li>
</ol>
<p>&nbsp;</p></body>
</HTML>
