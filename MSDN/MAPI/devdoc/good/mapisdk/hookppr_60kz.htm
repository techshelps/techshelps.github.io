<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Implementing the PreprocessMessage Function for Preprocessors</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_implementing_the_preprocessmessage_function_for_preprocessors"></a>Implementing the PreprocessMessage Function for Preprocessors</h2>
<p>
The MAPI spooler calls the <a href="function_82lh.htm"><b>PreprocessMessage</b></a> function for messages that meet the preprocessor's criteria for <a href="structyp_3p9g.htm"><b>MAPIUID</b></a> or address type. <b>PreprocessMessage</b> can do several things with the input message:
<ul>
<li>
Modify the input message. To modify the input message, the <b>PreprocessMessage</b> function calls the <a href="inter022_15vd.htm"><b>IMAPIProp::OpenProperty</b></a> method with the MAPI_MODIFY flag for one or more properties of the input message. It then modifies the values of those properties, and calls <a href="inter022_5rqr.htm"><b>IMAPIProp::SaveChanges</b></a> to make the changes permanent.</li>
<li>
Generate new messages to be sent as well. To generate new messages, the <b>PreprocessMessage</b> function must use its MAPI session pointer to access a message store provider through which it can create new message objects. New messages should be created using the default message store. These new message objects should be passed back to the MAPI spooler in the <i>lpppMessage</i> pointer, which is a pointer to an array of message object pointers. The original input message, however, should never be placed in this array.</li>
<li>
Prevent the input message from being sent. To prevent the input message from being sent, the <b>PreprocessMessage</b> function must remove all the recipients from the message's recipient list and set the <a href="propa_57zo.htm">PR_DELETE_AFTER_SUBMIT</a> property on the message. This will prevent the MAPI spooler from submitting the message to any transport providers.</li>
<li>
Modify the recipient list of a message.</li>
</ul>
<p>
If multiple message preprocessors are being used, the individual <b>PreprocessMessage</b> functions are called in the same order as the transports. This order can be modified programmatically if your preprocessor needs to be called at some specific point in the transport order. See <a href="inter023_6uk3.htm"><b>IMAPISession::AdminServices</b></a>, <a href="inter030_0ysy.htm"><b>IMsgServiceAdmin::MsgServiceTransportOrder</b></a> and <a href="inter042_0xbn.htm"><b>IXPLogon::AddressTypes</b></a> for details.</p>
<p>&nbsp;</p></body>
</HTML>
