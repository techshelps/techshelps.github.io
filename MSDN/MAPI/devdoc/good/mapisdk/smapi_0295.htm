<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Sending Messages with Simple MAPI</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_mapi1book_sending_messages_with_simple_mapi"></a>Sending Messages with Simple MAPI</h1>
<p>
To compose a message, a client application either creates a new message, forwards an existing message, or replies to an existing message. The new message can contain new material. Replying to existing messages involves creating a new message and copying the contents of the original message to it. All new messages can specify a return receipt as well.</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To send a message</h5>
<ol>
<li>
Create a <a href="smapiref_6n1b.htm"><b>MapiMessage</b></a> structure to contain the message.</li>
<li>
Create one or more <a href="smapiref_13tr.htm"><b>MapiRecipDesc</b></a> structures describing the recipients of the message and place them in the <b>lpRecips</b> member of the <b>MapiMessage</b> structure.</li>
<li>
Create a text string containing the subject, if any, and place it in the <b>lpszSubject</b> member of the <b>MapiMessage</b> structure.</li>
<li>
Create a text string containing the message text, if any, and place it in the <b>lpszNoteText</b> member of the <b>MapiMessage</b> structure.</li>
<li>
Create an array of <a href="smapiref_671b.htm"><b>MapiFileDesc</b></a> structures, if necessary, to contain any attachments and place it in the <b>lpFiles</b> member of the <b>MapiMessage</b> structure.</li>
<li>
Submit the message by calling the <a href="smapiref_8be4.htm"><b>MAPISendMail</b></a> function.</li>
</ol>
<p>
Sending messages can involve more or less effort on the part of your client, depending on the way you invoke various Simple MAPI functions to perform the above steps. For more information, see <a href="smapi_5m1x.htm">Controlled Sending of a Message: Simple MAPI Sample</a>.</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To create a new message</h5>
<ol>
<li>
Allocate a <a href="smapiref_6n1b.htm"><b>MapiMessage</b></a> structure.</li>
<li>
Fill in the <b>MapiMessage</b> structure members with values appropriate for the message the user wants to send.</li>
<li>
Submit the <b>MapiMessage</b> structure to the messaging system by calling the <a href="smapiref_8be4.htm"><b>MAPISendMail</b></a> function.</li>
</ol>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To forward an existing message</h5>
<ol>
<li>
Retrieve the message by calling the <a href="smapiref_5y98.htm"><b>MAPIReadMail</b></a> function.</li>
<li>
Modify the message as appropriate for forwarding:<ul>
<li>
Put one or more new recipients' addresses in the message's <b>lpRecips</b> member.</li>
<li>
Modify the subject line to indicate that the message has been forwarded.</li>
<li>
Allow the user to edit the message text.</li>
</ul>
</li>
<li>
Submit it to the messaging system by calling the <a href="smapiref_8be4.htm"><b>MAPISendMail</b></a> function.</li>
</ol>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To reply to a message</h5>
<ol>
<li>
Retrieve the message by calling the <a href="smapiref_5y98.htm"><b>MAPIReadMail</b></a> function.</li>
<li>
Modify the message as appropriate for replying:<ul>
<li>
Put the original sender's address into the <b>lpRecips</b> member.</li>
<li>
Change the subject line to indicate that the message is a reply to an earlier message.</li>
<li>
Allow the user to edit the message text.</li>
</ul>
</li>
<li>
Submit the message to the <a href="smapiref_8be4.htm"><b>MAPISendMail</b></a> function.</li>
</ol>
<p>
When your client submits a message to <b>MAPISendMail</b>, it has the option of requesting a return receipt. Return receipts are automatically generated messages that senders receive to inform them that messages they sent, for which a return receipt was requested, were delivered successfully to the recipient. To request a return receipt, include the MAPI_RECEIPT_REQUESTED flag in the <b>flFlags</b> member of the <b>MapiMessage</b> structure:</p>
<pre><code>// MapiMessage mymessage; declared and initialized elsewhere.
mymessage.flFlags |= MAPI_RECEIPT_REQUESTED;
 </code></pre>
<p>&nbsp;</p></body>
</HTML>
