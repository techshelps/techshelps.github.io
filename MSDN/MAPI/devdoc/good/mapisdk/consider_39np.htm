<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Opening a Message</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_opening_a_message"></a>Opening a Message</h2>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To open a message</h5>
<ol>
<li>
Retrieve the message's entry identifier from one of the following sources:<ul>
<li>
The row that represents the message in the contents table of its parent folder. For more information about working with a folder contents table, see <a href="tables_9i9f.htm">Contents Tables</a>.</li>
<li>
The <b>lpEntryID</b> member of the <a href="structyp_51ny.htm"><b>NEWMAIL_NOTIFICATION</b></a> structure that is sent with a new mail notification. For more information about receiving and handling notifications, see <a href="consider_4nw3.htm">Handling Notifications</a>.</li>
<li>
A call to the message's <a href="inter022_44c3.htm"><b>IMAPIProp::GetProps</b></a> method requesting the <a href="propa_8cv8.htm">PR_ENTRYID</a> property.</li>
</ul>
</li>
<li>
Call one of the following <b>OpenEntry</b> methods to open the message, setting <i>lpEntryID</i> to the message's entry identifier:<p>
<b>IMAPIFolder::OpenEntry</b>
<p>
<b>IMsgStore::OpenEntry</b>
<p>
<b>IMAPISession::OpenEntry</b>
<p>
The fastest method is usable only for incoming messages and involves calling the receive folder's <b>IMAPIFolder::OpenEntry</b> method. The next fastest method, calling the message store's <b>IMsgStore::OpenEntry</b> method, is usable for all messages as is the slowest method, calling <b>IMAPISession::OpenEntry</b>. 
</li>
</ol>
<p>
<b>Note</b>  Folders and their contents tables can be closed at any time without adversely affecting any of the messages that were opened from within them.</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To open a message that has been saved on disk</h5>
<ol>
<li>
Call <b>StgOpenStorage</b> to retrieve an <b>IStorage</b> interface pointer, passing the name of the message file for the <i>pwcsName</i> parameter.</li>
</ol>
<pre><code>LPSTORAGE pStorage = NULL;
HRESULT hr = StgOpenStorage (L"MESSAGE.MSG", NULL,
                             STGM_TRANSACTED |
                             STGM_READWRITE |
                             STGM_SHARE_EXCLUSIVE,
                             NULL, 0, &amp;pStorage);
</code></pre>
<ol start=2>
<li>
Call <b>OpenIMsgOnIStg</b> to retrieve an <b>IMessage</b> interface pointer to access the message.</li>
</ol>
<pre><code>LPMESSAGE pMessage = NULL;
LPMALLOC pMalloc = MAPIGetDefaultMalloc();
hr = OpenIMsgOnIStg (NULL, MAPIAllocateBuffer, MAPIAllocateMore,
                     MAPIFreeBuffer, pMalloc, NULL, pStorage,
                     NULL, 0, 0, &amp;pMessage);
</code></pre>
<p>&nbsp;</p></body>
</HTML>
