<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Sending a Reply</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_mapi1book_sending_a_reply"></a>Sending a Reply</h1>
<p>
Client applications typically support two types of replies: one that is sent only to the sender of the original message and one that is sent to all other recipients included in the recipient list of the original message in addition to the sender. This second type of reply is commonly referred to as a reply all message. </p>
<p>
To send a reply of either type, you implement some of the same tasks that you would when you send an original message. For example, you open the default message store and the outgoing message folder, typically the Outbox, and call the outgoing folder's <a href="inter013_7wv9.htm"><b>IMAPIFolder::CreateMessage</b></a> method to create the reply. Also, you open the folder that holds the original message, typically the Inbox. For information about opening different folders, see <a href="consider_4wqa.htm">Opening a Folder</a>.</p>
<p>
The main difference between creating a reply and creating an original message is that with a reply, most of the properties are either based on or copied directly from properties of the original message. Attachments — a message's <a href="propa_2c1f.htm">PR_MESSAGE_ATTACHMENTS</a> property — are specifically excluded. The recipient list for a reply all message is created from the original message's list with the recipient represented by the <a href="propb_5ird.htm">PR_RECEIVED_BY_SEARCH_KEY</a> property and all blind carbon copy recipients removed. The PR_RECEIVED_BY_SEARCH_KEY property represents the current user.</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To send a reply</h5>
<ol>
<li>
Open the default message store. See <a href="consider_77j9.htm">Opening the Default Message Store</a>.</li>
<li>
Open the Outbox folder. See <a href="consider_4wqa.htm">Opening a Folder</a>.</li>
<li>
Call the Outbox's<a href="inter013_7wv9.htm"> <b>IMAPIFolder::CreateMessage</b></a><b> </b>method to create the reply.</li>
<li>
Call the original message's <a href="inter022_83qn.htm"><b>IMAPIProp::CopyTo</b></a> method to copy the following properties to the reply message:<ul>
<li>
<a href="propa_9lvd.htm">PR_BODY</a> or <a href="propb_7vhg.htm">PR_RTF_COMPRESSED</a>, depending on whether or not you support Rich Text Format.</li>
<li>
<a href="propa_1zw3.htm">PR_MESSAGE_RECIPIENTS</a>, if the reply will go to the entire recipient list.</li>
<li>
<a href="propb_5xo4.htm">PR_NORMALIZED_SUBJECT</a>.</li>
</ul>
</li>
<li>
Do not include the following properties in your call to <b>IMAPIProp::CopyTo</b>:</li>
</ol>
<pre></pre>
<table cellspacing=4 cols=2>
<tr valign=top>
<td width=49%>PR_CLIENT_SUBMIT_TIME</td>
<td width=51%>PR_MESSAGE_DELIVERY_TIME</td>
</tr>
<tr valign=top>
<td width=49%>PR_MESSAGE_DOWNLOAD_TIME</td>
<td width=51%>PR_MESSAGE_FLAGS</td>
</tr>
<tr valign=top>
<td width=49%>PR_ORIGINATOR_DELIVERY_<br>
REPORT_REQUESTED</td>
<td width=51%>PR_RCVD_REPRESENTING properties</td>
</tr>
<tr valign=top>
<td width=49%>PR_READ_RECEIPT_ENTRYID</td>
<td width=51%>PR_READ_RECEIPT_REQUESTED</td>
</tr>
<tr valign=top>
<td width=49%>PR_RECEIVED_BY properties</td>
<td width=51%>PR_REPLY_RECIPIENT properties</td>
</tr>
<tr valign=top>
<td width=49%>PR_REPORT_ENTRYID</td>
<td width=51%>PR_SENDER properties</td>
</tr>
<tr valign=top>
<td width=49%>PR_SENT_REPRESENTING properties</td>
<td width=51%>PR_SENTMAIL_ENTRYID</td>
</tr>
<tr valign=top>
<td width=49%>PR_SUBJECT_PREFIX</td>
<td width=51%></td>
</tr>
</table><br>
<ol start=6>
<li>
Add separator text to whichever message body property you support — PR_BODY or PR_RTF_COMPRESSED.</li>
<li>
Call <a href="function_8xfc.htm"><b>ScCreateConversationIndex</b></a>, passing in the value of the original message's <a href="propa_96m0.htm">PR_CONVERSATION_INDEX</a> property.</li>
<li>
Set a prefix for the reply. If you are using the standard "RE:", concatenate these characters onto the beginning of <a href="propb_5xo4.htm">PR_NORMALIZED_SUBJECT</a> and set <a href="propb_3c8k.htm">PR_SUBJECT</a> to this new string. Do not set <a href="propb_4114.htm">PR_SUBJECT_PREFIX</a>. If you are using a nonstandard prefix, such as a string longer than three characters, store it in PR_SUBJECT_PREFIX. </li>
<li>
Set the PR_SENT_REPRESENTING properties to the corresponding values in the PR_RCVD_REPRESENTING properties. </li>
<li>
Set each of the entries in <a href="propb_3eib.htm">PR_REPLY_RECIPIENT_ENTRIES</a> and <a href="propb_5upf.htm">PR_REPLY_RECIPIENT_NAMES</a> to the entry identifier and display name of a primary recipient — a recipient whose type is MAPI_TO. <p>
Keep these properties synchronized. That is, PR_REPLY_RECIPIENT_ENTRIES and PR_REPLY_RECIPIENT_NAMES must contain the same number of entries, and an entry at a particular position in one of the properties must correspond to an entry at the same position in the other property.
</li>
<li>
If the reply is being sent only to the sender of the original message, create a single entry recipient list with the recipient represented by the original message's PR_SENT_REPRESENTING property. For more information about creating a recipient list, see <a href="consider_47jo.htm">Creating a Recipient List</a>.</li>
<li>
If the reply is a reply all, create a recipient list as follows:<ol type=a>
<li>
Call the original message's <a href="inter029_9zhh.htm"><b>IMessage::GetRecipientTable</b></a> method to access its recipient table.</li>
<li>
Call <a href="function_0dgz.htm"><b>HrQueryAllRows</b></a> to retrieve all of the rows in the table. Determine if each row represents a primary or carbon copy recipient and should remain in the list or if it represents a blind carbon copy recipient or the user and should be removed from the list. </li>
<li>
Differentiate between recipient types by looking at the <a href="propb_0n6t.htm">PR_RECIPIENT_TYPE</a> column. This column will be set to MAPI_TO for primary recipients, MAPI_CC for carbon copy recipients, and MAPI_BCC for blind carbon copy recipients. </li>
<li>
Compare the <a href="propb_960p.htm">PR_SEARCH_KEY</a> column with the <a href="propb_5ird.htm">PR_RECEIVED_BY_SEARCH_KEY</a> property of the original message to determine if the row represents the user.</li>
<li>
Remove unwanted rows from the recipient list by calling <a href="function_85yq.htm"><b>MAPIFreeBuffer</b></a> to free the memory associated with the corresponding entries in the recipient table's <a href="structyp_2378.htm"><b>SRowSet</b></a> structure. Set all of the values in the property value array to zero, all of the <b>cValues</b> members to zero, and all of the <b>lpProps</b> members in each <a href="structyp_233r.htm"><b>SRow</b></a> structure in the <b>SRowSet</b> to NULL.</li>
<li>
Add the sender to the recipient list, as represented by the original message's <a href="propb_799h.htm">PR_SENT_REPRESENTING_NAME</a> and <a href="propb_17hg.htm">PR_SENT_REPRESENTING_ENTRYID</a> properties. Check that the sender is not duplicated in the list.</li>
<li>
Call the reply message's<b> <a href="inter029_8vw3.htm">IMessage::ModifyRecipients</a> </b>method, setting the <i>ulFlags</i> parameter to zero, to create a new recipient list for the reply or forwarded message based on the list from the original message.</li>
</ol>
</li>
<li>
Call the reply's <a href="inter022_5rqr.htm"><b>IMAPIProp::SaveChanges</b></a> method to save the message or <a href="inter029_65ut.htm"><b>IMessage::SubmitMessage</b></a> to save and send it.</li>
</ol>
<p>
<b>Note</b>  Before calling <b>IMessage::ModifyRecipients</b> to store changes in the recipient list, you can allow users to make modifications through the message form. Users can add to the list or remove particular members. Allowing users to make changes to a recipient list is an optional client feature.</p>
<p>&nbsp;</p></body>
</HTML>
