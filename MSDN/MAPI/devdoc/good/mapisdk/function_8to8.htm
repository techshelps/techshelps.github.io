<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>MAPILogonEx</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_mapilogonex"></a>MAPILogonEx</h2>
<p>
The <b>MAPILogonEx</b> function logs a client application on to a session with the messaging system. </p>
<h4>Quick Info </h4>
<table cellspacing=4 cols=2>
<tr valign=top>
<td width=48%>Header file: </td>
<td width=52%>MAPIX.H </td>
</tr>
<tr valign=top>
<td width=48%>Implemented by: </td>
<td width=52%>MAPI </td>
</tr>
<tr valign=top>
<td width=48%>Called by: </td>
<td width=52%>Client applications </td>
</tr>
</table><br>
<pre><code><b>HRESULT MAPILogonEx(
  ULONG</b><i> ulUIParam</i><b>,</b>                
<b>  LPTSTR</b><i> lpszProfileName</i><b>,</b>         
<b>  LPTSTR</b><i> lpszPassword</i><b>,</b>            
<b>  FLAGS</b><i> flFlags</i><b>,</b>                  
<b>  LPMAPISESSION FAR *</b><i> lppSession  </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>ulUIParam</i></dt>
<dd>
[in] Handle to the window to which the logon dialog box is modal. If no dialog box is displayed during the call, the <i>ulUIParam</i> parameter is ignored. This parameter can be zero.</dd>
<dt>
<i>lpszProfileName</i></dt>
<dd>
[in] Pointer to a string containing the name of the profile to use when logging on. This string is limited to 64 characters.</dd>
<dt>
<i>lpszPassword </i></dt>
<dd>
[in] Pointer to a string containing the password of the profile. The <i>lpszPassword</i> parameter can be NULL whether or not the <i>lpszProfileName</i> parameter is NULL. This string is limited to 64 characters. </dd>
<dt>
<i>flFlags </i></dt>
<dd>
[in] Bitmask of flags used to control how logon is performed. The following flags can be set: 
<dl>
<dt>
MAPI_ALLOW_OTHERS </dt>
<dd>
The shared session should be returned, allowing subsequent clients to acquire the session without providing any user credentials. </dd>
<dt>
MAPI_EXPLICIT_PROFILE </dt>
<dd>
The default profile should not be used, and the user should be required to supply a profile. </dd>
<dt>
MAPI_EXTENDED </dt>
<dd>
Log on with extended capabilities. This flag should always be set. The older <b>MAPILogon</b> function is no longer available. </dd>
<dt>
MAPI_FORCE_DOWNLOAD </dt>
<dd>
An attempt should be made to download all of the user's messages before returning. If the MAPI_FORCE_DOWNLOAD flag is not set, messages can be downloaded in the background after the call to <b>MAPILogonEx</b> returns. </dd>
<dt>
MAPI_LOGON_UI </dt>
<dd>
A dialog box should be displayed to prompt the user for logon information if required. When the MAPI_LOGON_UI flag is not set, the calling client does not display a logon dialog box and returns an error value if the user is not logged on. MAPI_LOGON_UI and MAPI_PASSWORD_UI are mutually exclusive. </dd>
<dt>
MAPI_NEW_SESSION </dt>
<dd>
An attempt should be made to create a new MAPI session rather than acquire the shared session. If the MAPI_NEW_SESSION flag is not set, <b>MAPILogonEx</b> uses an existing shared session even if the <i>lpszprofileName</i> parameter is not NULL. </dd>
<dt>
MAPI_NO_MAIL </dt>
<dd>
MAPI should not inform the MAPI spooler of the session's existence. The result is that no messages can be sent or received within the session except through a tightly coupled store and transport pair. A calling client sets this flag if it is acting as an agent, if configuration work must be done, or if the client is browsing the available message stores. </dd>
<dt>
MAPI_NT_SERVICE </dt>
<dd>
The caller is running as a Windows NT service. Callers that are not running as a Windows NT service should not set this flag; callers that are running as a service must set this flag. </dd>
<dt>
MAPI_PASSWORD_UI </dt>
<dd>
A dialog box should be displayed to prompt the user for the profile password. MAPI_PASSWORD_UI cannot be set if MAPI_LOGON_UI is set because the calling client can only present one of the two dialog boxes. This dialog box does not allow the profile name to be changed; the <i>lpszProfileName</i> parameter must be non-NULL. </dd>
<dt>
MAPI_SERVICE_UI_ALWAYS </dt>
<dd>
<b>MAPILogonEx</b> should display a configuration dialog box for each message service in the profile. The dialog boxes are displayed after the profile has been chosen but before any message service is logged on. The MAPI common dialog box for logon also contains a check box that requests the same operation. </dd>
<dt>
MAPI_TIMEOUT_SHORT </dt>
<dd>
The logon should fail if blocked for more than a few seconds. </dd>
<dt>
MAPI_UNICODE </dt>
<dd>
The passed-in strings are in Unicode format. If the MAPI_UNICODE flag is not set, the strings are in ANSI format. </dd>
<dt>
MAPI_USE_DEFAULT </dt>
<dd>
The messaging subsystem should substitute the profile name of the default profile<i> </i>for the <i>lpszProfileName</i> parameter. The MAPI_EXPLICIT_PROFILE flag is ignored unless <i>lpszProfileName</i> is NULL or empty. </dd>
</dl>
</dd>
<dt>
<i>lppSession </i></dt>
<dd>
[out] Pointer to a pointer to the MAPI session interface. 
</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
S_OK</dt>
<dd>
The logon succeeded.</dd>
<dt>
MAPI_E_LOGON_FAILED</dt>
<dd>
The logon did not succeed, either because one or more of the parameters to <b>MAPILogonEx</b> were invalid or because there were too many sessions open already.</dd>
<dt>
MAPI_E_TIMEOUT</dt>
<dd>
MAPI serializes all logons through a mutex. This is returned if the MAPI_TIMEOUT_SHORT flag was set and another thread held the mutex. </dd>
<dt>
MAPI_E_USER_CANCEL</dt>
<dd>
The user canceled the operation, typically by clicking the <b>Cancel</b> button in a dialog box.
</dd>
</dl>
<h4>Remarks</h4>
<p>
MAPI client applications call the <b>MAPILogonEx</b> function to log on to a session with the messaging system. All strings passed in and returned to and from MAPI calls are null-terminated and must be specified in the current character set or code page of the calling client or provider's operating system.</p>
<p>
The <i>lpszProfileName</i> parameter is ignored if there is an existing previous session that called <b>MapiLogonEx</b> with the MAPI_ALLOW_OTHERS flag set and if the flag MAPI_NEW_SESSION is not set. If the <i>lpszProfileName</i> parameter is NULL or points to an empty string, and the <i>flFlags</i> parameter includes the MAPI_LOGON_UI flag, the <b>MAPILogonEx</b> function generates a logon dialog box with an empty field for the profile name. </p>
<p>
When logging on to a specific profile, a client should pass the MAPI_NEW_SESSION flag into <b>MAPILogonEx</b> in addition to the profile name. Otherwise, if another client has established a shared session by logging on with MAPI_ALLOW_OTHERS, the client will be logged on to the shared session instead of to the profile requested. </p>
<p>
The MAPI_EXPLICIT_PROFILE flag does not cause the default profile name to be used when <i>lpszProfileName</i> is NULL or empty unless the MAPI_USE_DEFAULT flag is also present. </p>
<p>
The MAPI_NO_MAIL flag has several effects that result in the following when not using the MAPI spooler: 
<ul>
<li>
No messages can be sent or delivered by the MAPI spooler during this session. Only tightly coupled store and transport providers can send and deliver messages. </li>
<li>
Server based stores might still send or deliver messages. </li>
<li>
Messages sent or delivered by server based stores are not processed by any hook providers. </li>
<li>
Per-message and per-recipient options for transports are not available. </li>
<li>
The status table does not contain entries for transport providers, and any transport functionality dependent on status objects (such as configuration) is not available. </li>
<li>
The message spooler row in the status table contains the STATUS_FAILURE value. </li>
<li>
Piggybacked logons are allowed, but those logons do not cause the previous logon to receive status object updates. </li>
</ul>
<p>
An agent should always log on using the MAPI_NO_MAIL flag. </p>
<h4>See Also </h4>
<p>
<a href="groups_4tbn.htm">MAPI Initialization Functions</a>, <a href="inter023_9f8l.htm"><b>IMAPISession::GetMsgStoresTable</b></a>, <a href="inter023_59id.htm"><b>IMAPISession::OpenMsgStore</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
