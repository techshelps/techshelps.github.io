<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Primary Identity</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_mapi1book_primary_identity"></a>Primary Identity</h1>
<p>
Most MAPI sessions have a particular service provider that supplies the primary identity for the session. Typically, it is an address book provider, which supplies identity through one of its messaging user objects or distribution lists. In fact, MAPI recommends that message services that include an address book provider use one of its objects for the primary identity. When a service provider that belongs to a message service supplies the primary identity, all of the other service providers in the message service share this identity. </p>
<p>
The MAPISVC.INF configuration file has entries relating to identity at both the message service and service provider level. Message service sections must include an entry that states whether or not the service can supply the primary identity; service provider sections include a similar entry only when the provider can supply an identity.</p>
<p>
The following table lists the entries that appear in the message service and service provider sections in the MAPISVC.INF file.</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=34%>Primary identity supplier</th>
<th align=left width=66%>PR_RESOURCE_FLAGS setting</th>
</tr>
<tr valign=top>
<td colspan=2 width=100%></td>
</tr>
<tr valign=top>
<td width=34%>Message service</td>
<td width=66%><pre><code>SERVICE_PRIMARY_IDENTITY</code></pre>
</td>
</tr>
<tr valign=top>
<td width=34%>Not the message service</td>
<td width=66%><pre><code>SERVICE_NO_PRIMARY_IDENTITY</code></pre>
</td>
</tr>
<tr valign=top>
<td width=34%>Service provider</td>
<td width=66%><pre><code>STATUS_PRIMARY_IDENTITY</code></pre>
</td>
</tr>
</table><br>
<p>
Although multiple message services can declare their ability to provide a session's primary identity, only one message service is selected to do so. This selection can occur:
<ul>
<li>
When a profile is created.</li>
<li>
When a client calls <a href="inter030_1zeh.htm"><b>IMsgServiceAdmin::SetPrimaryIdentity</b></a> to explicitly establish a particular message service as the provider of the session identity.</li>
</ul>
<p>
When a profile is created, MAPI designates the first message service to be configured that includes a provider with the STATUS_PRIMARY_IDENTITY flag set in its <a href="propb_4u5v.htm">PR_RESOURCE_FLAGS</a> property to supply the primary identity. Within the designated message service, the first provider to be configured with this resource flag set is chosen to provide the identity for the service. The STATUS_PRIMARY_IDENTITY flag is cleared for all other providers in the designated service and other message services in the profile. If at any time the provider supplying primary identity is removed from the profile, MAPI assigns the role to the next provider to be configured that can supply identity. This is determined by the appearance of the PR_RESOURCE_FLAGS=STATUS_PRIMARY_IDENTITY entry in the provider's section in MAPISRV.INF.</p>
<p>
When a client calls a message service's <b>IMsgServiceAdmin::SetPrimaryIdentity </b>method, it specifies the <a href="structyp_3p9g.htm"><b>MAPIUID</b></a> for a service provider within the target service. The service provider represented by the <b>MAPIUID</b> is assigned to supply the primary identity for the message service and for the session, and all of the other providers in the service will share this identity. </p>
<p>
Every provider in the message service responsible for supplying the primary identity updates its row in the status table to include the following properties.</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=48%>Primary identity property</th>
<th align=left width=52%>Set to</th>
</tr>
<tr valign=top>
<td width=48%><a href="propa_4sl5.htm">PR_IDENTITY_DISPLAY</a></td>
<td width=52%>Display name of the object supplying the primary identity.</td>
</tr>
<tr valign=top>
<td width=48%><a href="propa_0r7d.htm">PR_IDENTITY_SEARCH_KEY</a></td>
<td width=52%>Search key for the object supplying the primary identity.</td>
</tr>
<tr valign=top>
<td width=48%><a href="propa_3q1w.htm">PR_IDENTITY_ENTRYID</a></td>
<td width=52%>Entry identifier for the object supplying the primary identity.</td>
</tr>
</table><br>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To retrieve the entry identifier for the object supplying the primary identity</h5>
<ul>
<li>
Call the <a href="inter023_7x89.htm"><b>IMAPISession::QueryIdentity</b></a> method. <p>
<b>QueryIdentity</b> searches the status table for the row that contains the value STATUS_PRIMARY_IDENTITY in its PR_RESOURCE_FLAGS column and returns the corresponding PR_IDENTITY_ENTRYID as the entry identifier for the primary identity.
</li>
</ul>
<p>&nbsp;</p></body>
</HTML>
