<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IMAPISession::QueryIdentity</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_imapisession_queryidentity"></a>IMAPISession::QueryIdentity</h2>
<p>
The <b>IMAPISession::QueryIdentity</b> method returns the entry identifier of the object that provides the primary identity for the session.</p>
<h4>Quick Info</h4>
<p>
See <a href="inter023_64ry.htm"><b>IMAPISession : IUnknown</b></a>.</p>
<pre><code><b>HRESULT QueryIdentity(
  ULONG FAR *</b><i> lpcbEntryID</i><b>,</b>   
<b>  LPENTRYID FAR *</b><i> lppEntryID  </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>lpcbEntryID</i></dt>
<dd>
[out] Pointer to the count of bytes in the entry identifier pointed to by the <i>lppEntryID </i>parameter.</dd>
<dt>
<i>lppEntryID</i></dt>
<dd>
[out] Pointer to a pointer to the entry identifier of the object providing the primary identity. 
</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
S_OK</dt>
<dd>
The primary identity was successfully returned.</dd>
<dt>
MAPI_W_NO_SERVICE</dt>
<dd>
The call succeeded, but there is no primary identity for the session. When this warning is returned, the call should be handled as successful. To test for this warning, use the <b>HR_FAILED</b> macro. See <a href="extend_5k9z.htm">Using Macros for Error Handling</a>.
</dd>
</dl>
<h4>Remarks</h4>
<p>
The <b>IMAPSession::QueryIdentity</b> method retrieves the <a href="glossary_4s34.htm#_mapi1book_gly_primary_identity">primary identity</a> for the current session. The primary identity is an object, typically a messaging user, that represents the user of a session. Although many service providers in multiple message services can provide the primary identity for a session, MAPI designates a single service provider. The service provider supplying the primary identity sets the following:
<ul>
<li>
STATUS_PRIMARY_IDENTITY flag in the <a href="propb_4u5v.htm">PR_RESOURCE_FLAGS</a> property</li>
<li>
<a href="propa_4sl5.htm">PR_IDENTITY_DISPLAY</a></li>
<li>
<a href="propa_3q1w.htm">PR_IDENTITY_ENTRYID</a></li>
<li>
<a href="propa_0r7d.htm">PR_IDENTITY_SEARCH_KEY</a></li>
</ul>
<p>
If the service provider supplying the primary identity belongs to a message service, the other service providers in the message service also set the PR_IDENTITY properties. These properties are published in the session's status table. </p>
<p>
If possible, <b>QueryIdentity</b> returns the value for the <a href="propa_3q1w.htm">PR_IDENTITY_ENTRYID</a> property from the status row tagged with STATUS_PRIMARY_IDENTITY. If the PR_IDENTITY_ENTRYID property is missing from the primary identity row, <b>QueryIdentity</b> returns a one-off entry identifier built with other information from that row.</p>
<p>
If the STATUS_PRIMARY_IDENTITY flag is missing from all of the PR_RESOURCE_FLAG columns in the status table, <b>QueryIdentity</b> returns the first entry identifier that it finds. When there is no appropriate entry identifier to return, <b>QueryIdentity</b> succeeds with the warning MAPI_W_NO_SERVICE and points <i>lppEntryID</i> to a hard-coded entry identifier.</p>
<h4>Notes to Callers</h4>
<p>
You can call the <a href="inter030_1zeh.htm"><b>IMsgServiceAdmin::SetPrimaryIdentity</b></a> method to assign a message service the task of supplying the session's primary identity. </p>
<p>
Another way to retrieve the primary identity is by searching the status table for the row with the PR_RESOURCE_FLAGS columns set to STATUS_PRIMARY_IDENTITY. For more information on this alternate way of retrieving identity information, see <a href="consider_1koj.htm">Using the Status Table and Status Objects</a>.</p>
<p>
When you have finished using the entry identifier for the primary identity returned by <b>QueryIdentity</b>, free its memory by calling the <a href="function_85yq.htm"><b>MAPIFreeBuffer</b></a> function.</p>
<p>
For more information about identity in general, see <a href="extend_5kzd.htm">Primary Identity</a>. </p>
<p>
For more information about retrieving MAPI session identity, see <a href="consider_43jt.htm">Retrieving Primary and Provider Identity</a>. </p>
<h4>See Also</h4>
<p>
<a href="inter023_146x.htm"><b>IMAPISession::OpenEntry</b></a>, <a href="inter030_1zeh.htm"><b>IMsgServiceAdmin::SetPrimaryIdentity</b></a>, <a href="function_85yq.htm"><b>MAPIFreeBuffer</b></a></p>
<p>&nbsp;</p></body>
</HTML>
