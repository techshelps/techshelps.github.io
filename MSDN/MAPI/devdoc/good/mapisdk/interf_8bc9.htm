<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Component Object Model and MAPI</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_mapi1book_component_object_model_and_mapi"></a>Component Object Model and MAPI</h1>
<p>
The Platform SDK documentation includes a comprehensive discussion of the rules for implementing objects that conform to the Component Object Model (COM). These rules address how to:
<ul>
<li>
Design interfaces and objects.</li>
<li>
Implement <b>IUnknown</b>.</li>
<li>
Manage memory.</li>
<li>
Handle reference counting.</li>
<li>
Implement apartment threaded objects.</li>
</ul>
<p>
Although all MAPI objects are considered COM-based because they implement interfaces that inherit from <b>IUnknown</b>, MAPI deviates in some situations from the standard COM rules. This deviation allows developers more flexibility in their implementations. For example, a MAPI interface, like any COM interface, describes a contract between implementer and caller. Once the interface is created and published, its definition cannot and does not change. MAPI does not deviate from this description, but it relaxes the description somewhat. Implementers can choose to not implement particular methods, returning one of the following error values to the caller: </p>
<p class=indent1>
MAPI_E_NO_SUPPORT</p>
<p class=indent1>
MAPI_E_TOO_COMPLEX</p>
<p class=indent1>
MAPI_E_BAD_CHARWIDTH</p>
<p class=indent1>
MAPI_E_TYPE_NO_SUPPORT</p>
<p>
The other deviations from the standard COM rules are described in the following table.</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=48%>COM programming rule</th>
<th align=left width=52%>MAPI variation</th>
</tr>
<tr valign=top>
<td width=48%>All string parameters in interface methods should be Unicode.</td>
<td width=52%>MAPI interfaces are defined to permit either Unicode or ANSI string parameters. Any method that has a string parameter also has a <i>ulFlags</i> parameter; the width of the string parameters is indicated by the value of the MAPI_UNICODE flag in <i>ulFlags</i>. <br>
Most MAPI interfaces to not support Unicode and return MAPI_E_BAD_CHARWIDTH when the MAPI_UNICODE flag is set.</td>
</tr>
<tr valign=top>
<td width=48%>All interface methods should have a return type of HRESULT.</td>
<td width=52%>MAPI has one method that returns a non-HRESULT value: <a href="inter010_4y2h.htm"><b>IMAPIAdviseSink::OnNotify</b></a>.</td>
</tr>
<tr valign=top>
<td width=48%>Callers and implementers should allocate and free memory for interface parameters using the standard COM task allocators. </td>
<td width=52%>All MAPI methods use the linked allocators <a href="function_8z3m.htm"><b>MAPIAllocateBuffer</b></a>, <a href="function_11wl.htm"><b>MAPIAllocateMore</b></a>, and <a href="function_85yq.htm"><b>MAPIFreeBuffer</b></a> to manage memory for interface parameters. <br>
All MAPI implementations of interfaces defined by OLE, such as <b>IStream</b>, use the standard COM task allocators.</td>
</tr>
<tr valign=top>
<td width=48%>All out pointer parameters must explicitly be set to NULL when a method fails.</td>
<td width=52%>MAPI interfaces require that out pointer parameters either be set to NULL or remain unchanged when a method fails.<br>
All MAPI implementations of interfaces defined by OLE explicitly set out parameters to NULL on failure.</td>
</tr>
<tr valign=top>
<td width=48%>Implement aggregatable objects whenever possible.</td>
<td width=52%>MAPI interfaces are not aggregatable.</td>
</tr>
</table><br>
<p>&nbsp;</p></body>
</HTML>
