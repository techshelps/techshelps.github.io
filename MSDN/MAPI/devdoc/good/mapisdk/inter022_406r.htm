<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IMAPIProp::CopyProps</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_imapiprop_copyprops"></a>IMAPIProp::CopyProps</h2>
<p>
The <b>IMAPIProp::CopyProps</b> method copies or moves selected properties. </p>
<h4>Quick Info</h4>
<p>
See <a href="inter022_00tq.htm"><b>IMAPIProp : IUnknown</b></a>.</p>
<pre><code><b>HRESULT CopyProps(
  LPSPropTagArray</b><i> lpIncludeProps</i><b>,</b>        
<b>  ULONG</b><i> ulUIParam</i><b>,</b>                       
<b>  LPMAPIPROGRESS</b><i> lpProgress</i><b>,</b>             
<b>  LPCIID</b><i> lpInterface</i><b>,</b>                    
<b>  LPVOID</b><i> lpDestObj</i><b>,</b>                      
<b>  ULONG</b><i> ulFlags</i><b>,</b>                         
<b>  LPSPropProblemArray FAR *</b><i> lppProblems  </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>lpIncludeProps</i></dt>
<dd>
[in] Pointer to a property tag array specifying the properties to copy or move. <a href="propb_7kh8.htm">PR_NULL</a> cannot be included in the array. The <i>lpIncludeProps </i>parameter cannot be NULL.</dd>
<dt>
<i>ulUIParam</i></dt>
<dd>
[in] Handle of the parent window for the progress indicator. </dd>
<dt>
<i>lpProgress</i></dt>
<dd>
[in] Pointer to an implementation of a progress indicator. If NULL is passed in the <i>lpProgress</i> parameter, the progress indicator is displayed using the MAPI implementation. The <i>lpProgress</i> parameter is ignored unless the MAPI_DIALOG flag is set in the <i>ulFlags</i> parameter.</dd>
<dt>
<i>lpInterface</i></dt>
<dd>
[in] Pointer to the interface identifier (IID) representing the interface to be used to access the object pointed to by <i>lpDestObj</i>. The <i>lpInterface</i> parameter must not be NULL.</dd>
<dt>
<i>lpDestObj</i></dt>
<dd>
[in] Pointer to the object to receive the copied or moved properties.</dd>
<dt>
<i>ulFlags</i></dt>
<dd>
[in] Bitmask of flags that controls the copy or move operation. The following flags can be set:
<dl>
<dt>
MAPI_DECLINE_OK</dt>
<dd>
If <b>CopyProps</b> calls the <a href="inter025_054j.htm"><b>IMAPISupport::DoCopyProps</b></a> method to handle the copy or move operation, it should instead return immediately with the error value MAPI_E_DECLINE_COPY. The MAPI_DECLINE_OK flag is set by MAPI to limit recursion. Clients do not set this flag.</dd>
<dt>
MAPI_DIALOG</dt>
<dd>
Allows the display of a progress indicator.</dd>
<dt>
MAPI_MOVE</dt>
<dd>
<b>CopyProps</b> should perform a move operation rather than a copy operation. When this flag is not set, <b>CopyProps</b> performs a copy operation.</dd>
<dt>
MAPI_NOREPLACE</dt>
<dd>
Existing properties in the destination object should not be overwritten. When this flag is not set, <b>CopyProps</b> overwrites existing properties. </dd>
</dl>
</dd>
<dt>
<i>lppProblems</i></dt>
<dd>
[in, out] On input, can be NULL, indicating no need for error information, or a pointer to a pointer to an <a href="structyp_0omx.htm"><b>SPropProblemArray</b></a> structure. If <i>lppProblems</i> is a valid pointer on input, <b>CopyProps</b> returns detailed information about errors in copying one or more properties.
</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
S_OK</dt>
<dd>
Properties have been successfully copied or moved.</dd>
<dt>
MAPI_E_COLLISION</dt>
<dd>
A subobject cannot be copied because there is already a subobject existing in the destination object with the same display name (<a href="propa_1yjp.htm">PR_DISPLAY_NAME</a> property) as the subobject to be copied. </dd>
<dt>
MAPI_E_DECLINE_COPY</dt>
<dd>
The service provider does not implement the copy operation.</dd>
<dt>
MAPI_E_FOLDER_CYCLE</dt>
<dd>
The source object performing the copy or move operation directly or indirectly contains the destination object. Significant work might have been performed before this condition was discovered, so the source and destination objects might be partially modified. </dd>
<dt>
MAPI_E_INTERFACE_NOT_SUPPORTED</dt>
<dd>
The interface identified by the <i>lpInterface</i> parameter is not supported by the destination object. </dd>
<dt>
MAPI_E_NO_ACCESS</dt>
<dd>
An attempt was made to access an object for which the caller has insufficient permissions. This error is returned if the destination object is the same as the source object.
</dd>
</dl>
<p>
The following values can be returned in the <a href="structyp_0omx.htm"><b>SPropProblemArray</b></a> structure, but not as return values for <b>CopyProps</b>. These errors apply to a single property:
<dl>
<dt>
MAPI_E_BAD_CHARWIDTH</dt>
<dd>
Either the MAPI_UNICODE flag was set and <b>CopyProps</b> does not support Unicode, or MAPI_UNICODE was not set and <b>CopyProps</b> only supports Unicode.</dd>
<dt>
MAPI_E_COMPUTED</dt>
<dd>
The property cannot be modified by the caller because it is a read-only property, computed by the owner of the destination object. This error is not severe; the caller should allow the copy operation to continue.</dd>
<dt>
MAPI_E_INVALID_TYPE</dt>
<dd>
The property type is invalid.</dd>
<dt>
MAPI_E_UNEXPECTED_TYPE</dt>
<dd>
The property type is not the type expected by the caller.
</dd>
</dl>
<h4>Remarks</h4>
<p>
The <b>IMAPIProp::CopyProps</b> method copies or moves selected properties from the current object to a destination object. <b>CopyProps</b> is used mainly for replying to and forwarding messages, where only some of the properties from the original message travel with the reply or forwarded copy.</p>
<p>
Any subobjects in the source object are automatically included in the operation and copied or moved in their entirety, regardless of the use of properties indicated by the <b>SPropTagArray</b> structure. By default, <b>CopyProps</b> overwrites any properties in the destination object that match properties from the source object. If any of the copied or moved properties already exist in the destination object, the existing properties are overwritten by the new, unless the MAPI_NOREPLACE flag is set in the <i>ulFlags </i>parameter. Existing information in the destination object that is not overwritten is left untouched. </p>
<h4>Notes to Implementers</h4>
<p>
You can provide a full implementation of <b>CopyProps</b> or rely on the implementation that MAPI provides in its support object. If you want to use the MAPI implementation, call <a href="inter025_054j.htm"><b>IMAPISupport::DoCopyProps</b></a>. However, If you do delegate processing to <b>DoCopyProps</b> and you are passed the MAPI_DECLINE_OK flag, avoid the support call and return MAPI_E_DECLINE_COPY instead. You will be called with this flag by MAPI to avoid the possible recursion that can happen when copying folders. </p>
<p>
Because the copy operation can be lengthy, you are encouraged to display a progress indicator. Use the <b>IMAPIProgress</b> implementation passed in the <i>lpProgress</i> parameter, if there is one. If <i>lpProgress</i> is NULL, call <a href="inter025_3i1z.htm"><b>IMAPISupport::DoProgressDialog</b></a> to use the MAPI implementation.</p>
<h4>Notes to Callers</h4>
<p>
Do not set the MAPI_DECLINE_OK flag; it is used by MAPI in its calls to message store provider <b>CopyProps</b> implementations. </p>
<p>
Because copy and move operations can take time, it is wise to request the display of a progress indicator by setting the MAPI_DIALOG flag. You can set the <i>lpProgress</i> parameter to your implementation of <a href="inter021_7icu.htm"><b>IMAPIProgress</b></a>, if you have one, or to NULL. If <i>lpProgress</i> is NULL, <b>CopyProps</b> will use the default progress indicator provided by MAPI. </p>
<p>
You can suppress the display of a progress indicator by not setting the MAPI_DIALOG flag. <b>CopyProps</b> will ignore the <i>ulUIParam</i> and <i>lpProgress</i> parameters and avoid displaying the indicator.</p>
<p>
<b>CopyProps</b> can report global and individual errors, or errors that occur with one or more of the properties. These individual errors are placed in an <a href="structyp_0omx.htm"><b>SPropProblemArray</b></a> structure. You can suppress error reporting at the property level by passing NULL for the property problem array structure parameter rather than a valid pointer. </p>
<p>
If you want to receive information about errors, pass a valid <b>SPropProblemArray</b> structure pointer in the <i>lppProblems</i> parameter. When <b>CopyProps</b> returns S_OK, check for possible errors with individual properties in the structure. When <b>CopyProps</b> returns an error, no information is returned in the <b>SPropProblemArray</b> structure. Instead, call <a href="inter022_1hv6.htm"><b>IMAPIProp::GetLastError</b></a> to retrieve detailed error information. </p>
<p>
If <b>CopyProps</b> returns S_OK, free the returned <b>SPropProblemArray</b> structure by calling the <a href="function_85yq.htm"><b>MAPIFreeBuffer</b></a> function.</p>
<p>
If you are copying properties that are unique to the source object type, you must be sure that the destination object is of the same type. <b>CopyProps</b> does not prevent you from associating properties that typically belong to one type of object with another type of object. It is up to you to copy properties that make sense for the destination object. For example, you should not copy message properties to an address book container. </p>
<p>
To ensure that you are copying between objects of the same type, check that the source and destination object are the same type, either by comparing object pointers or calling <b>IUnknown::QueryInterface</b>. Set the interface identifier pointed to by <i>lpInterface</i> to the standard interface for the source object. Also, make sure that the object type — or <a href="propb_0okl.htm">PR_OBJECT_TYPE</a> property — is the same for the two objects. For example, if you are copying from a message, set <i>lpInterface</i> to IID_IMessage and the PR_OBJECT_TYPE for both objects to MAPI_MESSAGE.</p>
<p>
If an invalid pointer is passed in the <i>lpDestObj</i> parameter, the results are unpredictable.</p>
<p>
To copy a message's recipient list, call the message's <b>IMAPIProp::CopyProps</b> method and include the <a href="propa_1zw3.htm">PR_MESSAGE_RECIPIENTS</a> property in the property tag array. To copy the message's attachments, include the <a href="propa_2c1f.htm">PR_MESSAGE_ATTACHMENTS</a> property. </p>
<p>
To copy a folder or address book container's hierarchy or contents table, include <a href="propa_13sp.htm">PR_CONTAINER_HIERARCHY</a> or <a href="propa_4df7.htm">PR_CONTAINER_CONTENTS</a> in the property tag array. To include a folder's associated contents table, include the <a href="propa_8v03.htm">PR_FOLDER_ASSOCIATED_CONTENTS</a> property in the array. </p>
<h4>See Also</h4>
<p>
<a href="inter013_596b.htm"><b>IMAPIFolder::CopyMessages</b></a>, <a href="inter022_83qn.htm"><b>IMAPIProp::CopyTo</b></a>, <a href="inter022_1hv6.htm"><b>IMAPIProp::GetLastError</b></a>, <a href="structyp_0omx.htm"><b>SPropProblemArray</b></a>, <a href="structyp_23i1.htm"><b>SPropTagArray</b></a></p>
<p>&nbsp;</p></body>
</HTML>
