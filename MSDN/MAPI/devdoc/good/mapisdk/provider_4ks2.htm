<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Shutting Down a Service Provider</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_mapi1book_shutting_down_a_service_provider"></a>Shutting Down a Service Provider</h1>
<p>
When a client calls <b>IMAPISession::Logoff </b>to end the session and shut down all active service providers,<b> </b>MAPI in turn calls:
<ul>
<li>
<a href="inter004_44ti.htm"><b>IABLogon::Logoff</b></a> for address book providers.</li>
<li>
<a href="inter032_0c12.htm"><b>IMSLogon::Logoff</b></a> for message store providers.</li>
<li>
<a href="inter042_4spy.htm"><b>IXPLogon::TransportLogoff</b></a> for transport providers.</li>
</ul>
<p>
Each of these methods have similar implementations. The main tasks that a logoff method performs are:
<ol>
<li>
Releasing all open objects, including subobjects and status objects.</li>
<li>
Calling the support object's <b>IUnknown::Release</b> method to decrement its reference count.</li>
<li>
Removing all of your provider's registered <b>MAPIUID</b>s.</li>
<li>
Removing your provider's row in the status table.</li>
<li>
Performing any tasks that relate to cleaning up resources, such as:<ul>
<li>
Terminating a connection with a remote server.</li>
<li>
Decrementing the reference count on the logon object.</li>
<li>
Removing the logon object from the list of logon objects that your provider stores.</li>
<li>
In debug mode, issuing traces to locate objects that have leaked memory.</li>
</ul>
</li>
</ol>
<p>
When your logoff method returns, MAPI calls:
<ol>
<li>
Your logon object's <b>IUnknown::Release</b> method.</li>
<li>
Your provider object's <b>Shutdown</b> method to perform any final cleanup tasks. Depending on the type of your provider, the following method is called:<ul>
<li>
<a href="inter005_6lv2.htm"><b>IABProvider::Shutdown</b></a> for address book providers </li>
<li>
<a href="inter033_4s6m.htm"><b>IMSProvider::Shutdown</b></a> for message store providers </li>
<li>
<a href="inter043_4p0u.htm"><b>IXPProvider::Shutdown</b></a> for transport providers </li>
</ul>
</li>
<li>
Your provider object's <b>IUnknown::Release</b> method. </li>
</ol>
<p>
If your provider is a message store, a client call to <b>IMsgStore::StoreLogoff</b> will also initiate the shutdown process. <b>StoreLogoff</b> shuts down one particular message store provider and has no affect on the session. Only a message store provider can be shut down with this method; there is no explicit way for shutting down a particular address book or transport provider. For information about how to respond to a <b>StoreLogoff</b> call, see <a href="provider_67xu.htm">Shutting Down a Message Store Provider</a>.</p>
<p>
Your provider's DLL will be unloaded when MAPI calls the Win32 API function <b>FreeLibrary</b>, a call that is made after the last active client has called <b>MAPIUninitialize</b>. By this time, your service provider will have finished shutting down. </p>
<p>&nbsp;</p></body>
</HTML>
