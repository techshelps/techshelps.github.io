<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Validating and Initializing a Message Store</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_validating_and_initializing_a_message_store"></a>Validating and Initializing a Message Store</h2>
<p>
When you open a message store through the <a href="inter023_59id.htm"><b>IMAPISession::OpenMsgStore</b></a> method without setting the MDB_NO_MAIL flag, MAPI creates several folders and assigns them default names and roles. MAPI is responsible for creating these folders to avoid the incompatibilities that would inevitably occur if either clients or message store providers were responsible for the creation.</p>
<p>
Sometimes it is necessary to verify that the appropriate folders have been created and that they are valid. The <a href="function_0ihx.htm"><b>HrValidateIPMSubtree</b></a> function is available for this purpose. If you are validating the default message store, pass the MAPI_FULL_IPM_TREE flag. A more extensive group of folders is created for the default message store. When <b>HrValidateIPMSubtree</b> receives the MAPI_FULL_IPM_TREE flag, it checks for the following folders:
<ul>
<li>
Root folder for the IPM subtree</li>
<li>
Deleted Items folder in the IPM root folder</li>
<li>
Inbox folder in the IPM root folder</li>
<li>
Outbox folder in the IPM root folder</li>
<li>
Sent Items folder in the IPM root folder</li>
<li>
Folder views in the message store's root folder</li>
<li>
Common views in the message store's root folder</li>
<li>
Search folder in the message store's root folder</li>
</ul>
<p>
If the message store is not the default, you can either set or not set the MAPI_FULL_IPM_TREE flag. When this flag is not set, <b>HrValidateIPMSubtree</b> checks for only the root folder for the subtree, the Deleted Items folder, and the root folder for message store search results.</p>
<p>
To initialize a message store, store the following properties in memory so that they are readily available:</p>
<p class=indent1>
<a href="propb_0zzf.htm">PR_VALID_FOLDER_MASK</a></p>
<p class=indent1>
<a href="propb_01t7.htm">PR_STORE_SUPPORT_MASK</a></p>
<p>
These properties are bitmasks that describe features of the message store. PR_VALID_FOLDER_MASK has one bit set for every special folder that exists in the message store and has an assigned entry identifier that is valid. See <a href="consider_4wqa.htm">Opening a Folder</a> for more information about accessing these folders and their entry identifiers. </p>
<p>
PR_STORE_SUPPORT_MASK has one bit set for every feature supported in the message store. For example, if a message store supports notification and formatted text, its PR_STORE_SUPPORT_MASK will have the STORE_NOTIFY_OK and STORE_RTF_OK bits set. </p>
<p>
Other properties that should be stored locally include the entry identifiers for the folders that the PR_VALID_FOLDER_MASK property describes as valid. Each of these special folders, except for the Inbox folder, has an entry identifier property associated with it. For example, the entry identifier for the Outbox folder is its <a href="propa_9q90.htm">PR_IPM_OUTBOX_ENTRYID</a> property. Because these folders are the folders that will be opened frequently, it is a good idea to have their entry identifiers readily available. </p>
<p>&nbsp;</p></body>
</HTML>
