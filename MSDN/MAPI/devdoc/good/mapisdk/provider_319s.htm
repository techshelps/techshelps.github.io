<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Displaying Progress Step by Step</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_displaying_progress_step_by_step"></a>Displaying Progress Step by Step</h2>
<p>
To display a progress indicator, call <a href="inter021_0ppv.htm"><b>IMAPIProgress::GetFlags</b></a> to retrieve the current flags setting. </p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp; If the MAPI_TOP_LEVEL flag is set</h5>
<ol>
<li>
Set a variable equal to the total number of items to process in the operation. For example, if you are copying the contents of a folder, this value will be equal to the number of the subfolders in the folder plus the number of messages. </li>
<li>
Set a variable equal to 1000 divided by the number of items. </li>
<li>
If you are showing progress for subobjects, call the progress object's <a href="inter021_1wfn.htm"><b>IMAPIProgress::SetLimits</b></a> method and pass the following values for the three parameters:<ul>
<li>
Set the <i>lpulMin</i> parameter to 0.</li>
<li>
Set the <i>lpulMax</i> parameter to 1000.</li>
<li>
Set the <i>lpulFlags</i> parameter to MAPI_TOP_LEVEL.</li>
</ul>
</li>
<li>
For each object to be processed: <ol type=a>
<li>
Call <b>IMAPIProgress::SetLimits</b> and pass the following values for the three parameters:</li>
</ol>
</li>
</ol>
<table cellspacing=4 cols=1>
<tr valign=top>
<td width=100%><font face="Symbol">·</font>&nbsp;&nbsp;&nbsp;&nbsp;Set the <i>lpulMin</i> parameter to the variable set in step 2 multiplied by the current item minus 1. </td>
</tr>
<tr valign=top>
<td width=100%><font face="Symbol">·</font>&nbsp;&nbsp;&nbsp;&nbsp;Set the <i>lpulMax</i> parameter to the variable set in step 2 multiplied by the current object. </td>
</tr>
<tr valign=top>
<td width=100%><font face="Symbol">·</font>&nbsp;&nbsp;&nbsp;&nbsp;Set the <i>lpulFlags</i> parameter to 0.</td>
</tr>
</table><br>
<ol start=2 type=a>
<li>
Perform whatever processing should be done on this object. If this is a subobject and you want to display progress on subobjects, pass a pointer to the progress object in the <i>lpProgress</i> parameter to the method.</li>
<li>
Call <b>IMAPIProgress::Progress</b> and pass the following values for the three parameters:</li>
</ol>
<table cellspacing=4 cols=1>
<tr valign=top>
<td width=100%><font face="Symbol">·</font>&nbsp;&nbsp;&nbsp;&nbsp;Set the <i>ulValue</i> parameter to the variable set in step 2 multiplied by the current object.</td>
</tr>
<tr valign=top>
<td width=100%><font face="Symbol">·</font>&nbsp;&nbsp;&nbsp;&nbsp;Set the <i>ulCount</i> parameter to the current object. </td>
</tr>
<tr valign=top>
<td width=100%><font face="Symbol">·</font>&nbsp;&nbsp;&nbsp;&nbsp;Set the <i>ulTotal</i> parameter to the variable set in step 1, the total number of objects. </td>
</tr>
</table><br>
<p>
</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;If the MAPI_TOP_LEVEL flag is not set</h5>
<ol>
<li>
Call the progress object's <a href="inter021_935a.htm"><b>IMAPIProgress::GetMin</b></a> method to retrieve the minimum value for the display. </li>
<li>
Call <a href="inter021_92rc.htm"><b>IMAPIProgress::GetMax</b></a> to retrieve the maximum value for the display. </li>
<li>
Set a variable equal to the total number of objects to be processed. </li>
<li>
Set a variable equal to the result of subtracting the minimum value from the maximum value and then dividing by the total number of objects.</li>
<li>
For each object to be processed:<ol type=a>
<li>
If your provider is showing progress for subobjects, call <a href="inter021_1wfn.htm"><b>IMAPIProgress::SetLimits</b></a> and pass the following values for the three parameters:</li>
</ol>
</li>
</ol>
<table cellspacing=4 cols=1>
<tr valign=top>
<td width=100%><font face="Symbol">·</font>&nbsp;&nbsp;&nbsp;&nbsp;Set the <i>lpulMin</i> parameter to the minimum value plus the current item minus 1 multiplied by the variable set in step 4.</td>
</tr>
<tr valign=top>
<td width=100%><font face="Symbol">·</font>&nbsp;&nbsp;&nbsp;&nbsp;Set the <i>lpulMax</i> parameter to the minimum value plus the current unit multiplied by the variable set in step 4. </td>
</tr>
<tr valign=top>
<td width=100%><font face="Symbol">·</font>&nbsp;&nbsp;&nbsp;&nbsp;Set the <i>lpulFlags</i> parameter to 0.</td>
</tr>
</table><br>
<ol start=2 type=a>
<li>
Perform whatever processing should be done on this object. If the object is a subobject, and your provider displays progress for subobjects, pass a pointer to the progress object in the <i>lpProgress</i> parameter to the method.</li>
<li>
Call <a href="inter021_5esz.htm"><b>IMAPIProgress::Progress</b></a> and pass the following values for the three parameters:</li>
</ol>
<table cellspacing=4 cols=1>
<tr valign=top>
<td width=100%><font face="Symbol">·</font>&nbsp;&nbsp;&nbsp;&nbsp;Set the <i>ulValue</i> parameter to variable set in step 2 multiplied by the current object.</td>
</tr>
<tr valign=top>
<td width=100%><font face="Symbol">·</font>&nbsp;&nbsp;&nbsp;&nbsp;Set the <i>ulCount</i> parameter to 0. </td>
</tr>
<tr valign=top>
<td width=100%><font face="Symbol">·</font>&nbsp;&nbsp;&nbsp;&nbsp;Set the <i>ulTotal</i> parameter to 0.</td>
</tr>
</table><br>
<p>
</p>
<p>
The following code sample illustrates the logic required to show progress at all levels of an operation that copies the contents of a folder containing five subfolders. </p>
<pre><code>lpProgress-&gt;GetFlags (lpulFlags);
ulFlags = *lpulFlags;

/* Folder in charge of the display. It contains 5 subfolders. */
if (ulFlags &amp; MAPI_TOP_LEVEL)    
{
    ulItems = 5                         // 5 subfolders in this folder
    ulScale = (ulMax / ulItems)         // 200 because ulMax = 1000
    lpProgress-&gt;SetLimits(0, ulMax, MAPI_TOP_LEVEL)

    for (i = 1; i &lt;= ulItems; i++)      // for each subfolder to copy
    {
        lpProgress-&gt;SetLimits( (i - 1) * ulScale, i * ulScale, 0) 
        CopyOneFolder(lpFolder(i), lpProgress)
        lpProgress-&gt;Progress( i * ulScale, i, ulItems)
    }
}
else  
/* One of the subfolders to be copied. It contains 3 messages */
{
    lpProgress-&gt;GetMin(&amp;ulMin);
    lpProgress-&gt;GetMax(&amp;ulMax);
    ulItems = 3;
    ulDelta = (ulMax - ulMin) / ulItems;
    for (i = 1; i &lt;= ulItems; i++)
    {
        lpProgress-&gt;SetLimits(ulMin + (i - 1) * ulDelta, 
                              ulMin + i * ulDelta, 0)
        CopyOneFolder(lpFolder(i), lpProgress)

        /* Pass 0 for ulCount and ulTotal because this is not the */
        /* top level display and that information is unavailable  */
        lpProgress-&gt;Progress( i * ulDelta, 0, 0)
    }
}
 </code></pre>
<p>
</p>
<p>&nbsp;</p></body>
</HTML>
