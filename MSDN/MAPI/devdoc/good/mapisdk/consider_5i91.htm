<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Resending an Undelivered Message</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_mapi1book_resending_an_undelivered_message"></a>Resending an Undelivered Message</h1>
<p>
A transport provider sends a nondelivery report (NDR) when it cannot successfully deliver a message that you have submitted. It is up to the client whether or not users can attempt to resend these undelivered messages. If you support resending messages, you can either use a form provided by MAPI or implement your own. The MAPI form displays the names of the failed recipients and the reason for the delivery failure, if possible, and includes a button that, when selected, allows a user to resend the message. </p>
<p>
When a resent message is received, it should look exactly like the original message. The recipient should be unable to differentiate between a message that was delivered on its first attempt at transmission or a subsequent attempt. Replies on this message should work exactly as if the message had been sent successfully the first time.</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To resend an undelivered message</h5>
<ol>
<li>
Call <a href="inter013_7wv9.htm"><b>IMAPIFolder::CreateMessage</b></a> to create a new message.</li>
<li>
Copy all of the properties from the original message, excluding PR_MESSAGE_RECIPIENTS, the PR_SENDER properties, and the PR_SENT_REPRESENTING properties. Make the following property modifications:<ul>
<li>
Set <a href="propa_0ecz.htm">PR_MESSAGE_CLASS</a> to the report's <a href="propb_44vn.htm">PR_ORIG_MESSAGE_CLASS</a> property.</li>
<li>
Set the MSGSTATUS_RESEND flag in the <a href="propa_95wz.htm">PR_MESSAGE_FLAGS</a> property.</li>
<li>
Set <a href="propb_204k.htm">PR_ORIGINAL_ENTRYID</a> to the original message's <a href="propa_8cv8.htm">PR_ENTRYID</a> property.</li>
<li>
For each recipient, set MAPI_SUBMITTED in the <a href="propb_0n6t.htm">PR_RECIPIENT_TYPE</a> property. </li>
<li>
Duplicate each failed recipient. Change the PR_RECIPIENT_TYPE property for the duplicated recipient to MAPI_P1. Therefore, for each failed recipient there are now two entries in the recipient table: one with PR_RECIPIENT_TYPE set to its original value and the other with PR_RECIPIENT_TYPE set to MAPI_P1.</li>
</ul>
</li>
<li>
Call <a href="function_8xfc.htm"><b>ScCreateConversationIndex</b></a> to set up conversation tracking if desired.</li>
<li>
Call the new message's <a href="inter029_8vw3.htm"><b>IMessage::ModifyRecipients</b></a> method to update the recipient list.</li>
<li>
Call <a href="inter029_65ut.htm"><b>IMessage::SubmitMessage</b></a> to save and send the new message.</li>
</ol>
<p>&nbsp;</p></body>
</HTML>
