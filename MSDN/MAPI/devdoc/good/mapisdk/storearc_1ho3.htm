<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Creating and Storing Messages in Message Stores</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_mapi1book_creating_and_storing_messages_in_message_stores"></a>Creating and Storing Messages in Message Stores</h3>
<p>
How your message store provider creates and stores messages in the underlying storage mechanism depends heavily on the underlying storage mechanism itself. In general, you need only to write code to preserve the properties of a message and their values.</p>
<p>
When creating a new message, the message store provider needs to create it with the required properties for messages. A list of these properties can be found in the documentation for <a href="inter013_9ohe.htm"><b>IMAPIFolder : IMAPIContainer</b></a>. After that, client applications add any additional properties with <a href="inter022_00tq.htm"><b>IMAPIProp</b></a> methods.</p>
<p>
When saving a message to the underlying storage mechanism, the message store provider needs to iterate over the message's properties, and save them to the underlying storage mechanism such that they can be fully recovered if the message is later opened.</p>
<p>
MAPI requires that the properties on <a href="inter029_525s.htm"><b>IMessage</b></a> objects are transacted, meaning that changes made to them do not become permanent until the <a href="inter022_5rqr.htm"><b>IMAPIProp::SaveChanges</b></a> method is called on the message object. The message store provider is responsible for implementing this behavior. Usually this is not difficult; it simply means holding properties in memory while they are being modified and committing them to the underlying storage mechanism when <b>SaveChanges</b> is called.</p>
<p>
Some properties on message objects have special semantics for client applications with respect to the <b>SaveChanges</b> method:
<ul>
<li>
Some properties should be read/write before <b>SaveChanges</b> is called, but read-only afterwards. For example, PR_MESSAGE_FLAGS is set initially by the client application that creates the message (and thus is read/write) but can't be changed after the first call to <b>SaveChanges</b>.</li>
<li>
Some properties have special relations to properties on the folder they are in or to <b>IMAPIFolder</b> methods. For example, the <a href="propa_95wz.htm">PR_MESSAGE_FLAGS</a> property is related to the flags used on the <a href="inter013_7wv9.htm"><b>IMAPIFolder::CreateMessage</b></a> call. </li>
<li>
Some properties may not be available until <b>SaveChanges</b> is called for the first time. For example, the <a href="propa_8cv8.htm">PR_ENTRYID</a> property may not be available until <b>SaveChanges</b> is called.</li>
<li>
Some properties can have special relationships to other properties on the message object. For example, the <a href="propa_9lvd.htm">PR_BODY</a> property is usually derived from the <a href="propb_7vhg.htm">PR_RTF_COMPRESSED</a> property in message store providers that support Rich Text Format messages.</li>
<li>
Some properties are used by more than one object type related to message stores. For example, the <a href="propb_01t7.htm">PR_STORE_SUPPORT_MASK</a> property is required on folder and message objects as well as message store objects.</li>
</ul>
<p>
It is the responsibility of the message store provider to implement the correct semantics for such properties.</p>
<p>&nbsp;</p></body>
</HTML>
