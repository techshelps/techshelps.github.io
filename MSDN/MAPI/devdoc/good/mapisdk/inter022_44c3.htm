<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IMAPIProp::GetProps</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_imapiprop_getprops"></a>IMAPIProp::GetProps</h2>
<p>
The <b>IMAPIProp::GetProps</b> method retrieves the property value of one or more properties of an object.</p>
<h4>Quick Info</h4>
<p>
See <a href="inter022_00tq.htm"><b>IMAPIProp : IUnknown</b></a>.</p>
<pre><code><b>HRESULT GetProps(
  LPSPropTagArray</b><i> lpPropTagArray</i><b>,</b>   
<b>  ULONG</b><i> ulFlags</i><b>,</b>                   
<b>  ULONG FAR *</b><i> lpcValues</i><b>,</b>           
<b>  LPSPropValue FAR *</b><i> lppPropArray  </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>lpPropTagArray</i></dt>
<dd>
[in] Pointer to an array of property tags identifying the properties whose values are to be retrieved. The <i>lpPropTagArray</i> parameter must either be NULL, indicating that values for all properties of the object should be returned, or point to an <a href="structyp_23i1.htm"><b>SPropTagArray</b></a> structure containing one or more property tags.</dd>
<dt>
<i>ulFlags</i></dt>
<dd>
[in] Bitmask of flags that indicates the format for properties that have the type PT_UNSPECIFIED. The following flag can be set:
<dl>
<dt>
MAPI_UNICODE</dt>
<dd>
The string values for these properties should be returned in the Unicode format. If the MAPI_UNICODE flag is not set, the string values should be returned in the ANSI format.</dd>
</dl>
</dd>
<dt>
<i>lpcValues</i></dt>
<dd>
[out] Pointer to a count of property values pointed to by the <i>lppPropArray</i> parameter. If <i>lppPropArray</i> is NULL, the contents of the <i>lpcValues</i> parameter is zero.</dd>
<dt>
<i>lppPropArray</i></dt>
<dd>
[out] Pointer to a pointer to the retrieved property values.
</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
S_OK</dt>
<dd>
The property values were successfully retrieved.</dd>
<dt>
MAPI_W_ERRORS_RETURNED</dt>
<dd>
The call succeeded overall, but one or more properties could not be accessed. The <b>ulPropTag</b> member of the property value for each unaccessible property has a property type of PT_ERROR and an identifier of zero. When this warning is returned, the call should be handled as successful. To test for this warning, use the <b>HR_FAILED</b> macro. See <a href="extend_5k9z.htm">Using Macros for Error Handling</a>.</dd>
<dt>
MAPI_E_INVALID_PARAMETER</dt>
<dd>
Zero was passed in the <b>cValues</b> member of the <a href="structyp_23i1.htm"><b>SPropTagArray</b></a> structure pointed to by <i>lpPropTagArray</i>.
</dd>
</dl>
<h4>Remarks</h4>
<p>
The <b>IMAPIProp::GetProps</b> method gets the property values of one or more properties of an object. </p>
<p>
The property values are returned in the same order as they were requested. That is, the order of properties in the property tag array pointed to by <i>lpPropTagArray</i> matches the order in the array of property value structures pointed to by <i>lppPropArray</i>. </p>
<p>
The property types specified in the <b>aulPropTag</b> members of the property tag array indicate the type of value that should be returned in the <b>Value</b> member of each property value structure. However, if the caller does not know the type of a property, the type in the <b>aulPropTag</b> member can be set instead to PT_UNSPECIFIED. In retrieving the value, <b>GetProps</b> sets the correct type in the <b>ulPropTag</b> member of the property value structure for the property. </p>
<p>
If property types are specified in the <b>SPropTagArray</b> in <i>lpPropTagArray</i>, then the property values in the <b>SPropValue</b> returned in <i>lppPropArray</i> have types that exactly match the requested types, unless an error value is returned instead. </p>
<p>
String properties can have one of two property types: PT_UNICODE to represent the Unicode format and PT_STRING8 to represent the ANSI format. If the MAPI_UNICODE flag is set in the <i>ulFlags</i> parameter, whenever <b>GetProps</b> cannot determine the appropriate format for a string property, it returns its value in the Unicode format. <b>GetProps</b> cannot determine an exact string property type:
<ul>
<li>
If the <i>lpPropTagArray</i> parameter is set to NULL to request all properties.</li>
<li>
When the <b>aulPropTag</b> member includes the value PT_UNSPECIFIED as its property type in the property tag array.</li>
</ul>
<p>
If the <i>lpPropTagArray</i> parameter is set to NULL to retrieve all of the properties of the object and no properties exist, <b>GetProps</b>:
<ul>
<li>
Returns S_OK.</li>
<li>
Sets the count value in the <b>cValues</b> member of the property value structure to zero.</li>
<li>
Sets the contents of <i>lpcValues</i> to zero.</li>
<li>
Sets <i>lppPropArray</i> to NULL. </li>
<li>
Must not return multivalued properties with <b>cValues</b> set to zero. </li>
</ul>
<h4>Notes to Implementers</h4>
<p>
Call the <a href="function_8z3m.htm"><b>MAPIAllocateBuffer</b></a> function to allocate memory initially for the <a href="structyp_9sbp.htm"><b>SPropValue</b></a> structure pointed to by <i>lpPropTagArray</i>; call <a href="function_11wl.htm"><b>MAPIAllocateMore</b></a> to allocate any additional memory needed for the structure's members. </p>
<p>
Return MAPI_W_ERRORS_RETURNED if you cannot retrieve the value for one or more of the requested properties. In the property value structure, set the type in the <b>ulPropTag</b> member to PT_ERROR and the <b>Value</b> member to a status code describing the error. For example, if you need to convert a string to Unicode and do not support Unicode, set the <b>Value</b> member to MAPI_E_BAD_CHARWIDTH. If the property is too large, set it to MAPI_E_NOT_ENOUGH_MEMORY. If the object does not support the property, set it to MAPI_E_NOT_FOUND.</p>
<p>
A remote transport provider's implementation of the <b>GetProps</b> method must return the folder's property values for properties requested by the caller. Your implementation needs to:
<ul>
<li>
Allocate a property value array to return to the caller and store its address in the property value pointer parameter passed in for that purpose.</li>
<li>
Copy the property tags from the folder's properties into the property tags in the property value array according to the array of property tags passed to <b>GetProps</b>.</li>
<li>
Ensure that the property type is set for all property tags passed to <b>GetProps</b>. The caller can pass in a property type of PT_UNSPECIFIED, in which case <b>GetProps</b> must set the correct property type for that property tag.</li>
<li>
Set the value of each property in the property value array according to its tag. For example, if the property tag requested by the caller is PR_OBJECT_TYPE, <b>GetProps</b> can set the value to MAPI_FOLDER.</li>
<li>
If the caller passes in any property tags that your implementation does not handle, you can set the property tag to PT_ERROR for those properties, and set the property value to MAPI_E_NOT_FOUND.</li>
<li>
Return S_OK if no errors occurred or MAPI_W_ERRORS_RETURNED if there were errors.</li>
</ul>
<p>
A remote transport provider's implementation of the <b>GetProps</b> method needs to support the following properties at a minimum:  </p>
<table cellspacing=4 cols=2>
<tr valign=top>
<td width=48%><a href="propa_63eb.htm">PR_ACCESS</a></td>
<td width=52%><a href="propa_4w8c.htm">PR_ACCESS_LEVEL</a></td>
</tr>
<tr valign=top>
<td width=48%><a href="propa_6644.htm">PR_CONTENT_COUNT</a></td>
<td width=52%><a href="propa_7jzo.htm">PR_ASSOC_CONTENT_COUNT</a></td>
</tr>
<tr valign=top>
<td width=48%><a href="propa_0vhh.htm">PR_FOLDER_TYPE</a></td>
<td width=52%><a href="propb_0okl.htm">PR_OBJECT_TYPE</a></td>
</tr>
<tr valign=top>
<td width=48%><a href="propb_1z77.htm">PR_SUBFOLDERS</a></td>
<td width=52%><a href="propa_4j3i.htm">PR_CREATION_VERSION</a></td>
</tr>
<tr valign=top>
<td width=48%><a href="propa_4sdh.htm">PR_CREATION_TIME</a></td>
<td width=52%><a href="propa_1yjp.htm">PR_DISPLAY_NAME</a></td>
</tr>
<tr valign=top>
<td width=48%><a href="propa_7s6d.htm">PR_DISPLAY_TYPE</a></td>
<td width=52%></td>
</tr>
</table><br>
<p>
</p>
<h4>Notes to Callers</h4>
<p>
For properties of type PT_OBJECT, call the <a href="inter022_15vd.htm"><b>IMAPIProp::OpenProperty</b></a> method instead of <b>GetProps</b>. </p>
<p>
For secure properties, do not expect to retrieve them by calling <b>GetProps</b> with the <i>lppPropTagArray</i> parameter set to NULL. You must explicitly set a secure property's identifier in the <b>aulPropTag</b> member of its property tag array when calling <b>GetProps</b>. When and how a secure property is available is up to the service provider. </p>
<p>
Free the returned <b>SPropValue</b> structure by calling the <a href="function_85yq.htm"><b>MAPIFreeBuffer</b></a> function only if <b>GetProps</b> returns S_OK or MAPI_W_ERRORS_RETURNED.</p>
<p>
If <b>GetProps</b> returns MAPI_W_ERRORS_RETURNED because it could not access one or more properties, check the property tags of the returned properties. The failed properties will have the following values set in their property value structure:
<ul>
<li>
Property type in the <b>ulPropTag</b> member set to PT_ERROR.</li>
<li>
Property value in the <b>Value</b> member set to a status code for the error, such as MAPI_E_NOT_FOUND.</li>
</ul>
<p>
Properties that fail because they are too large to conveniently be returned in the property value structure have their <b>Value</b> member set to MAPI_E_NOT_ENOUGH_MEMORY. Typically, this occurs with string or binary properties of type PT_STRING8, PT_UNICODE, or PT_BINARY when the value of the property is 4K or larger. Call <a href="inter022_15vd.htm"><b>IMAPIProp::OpenProperty</b></a> to retrieve large properties.</p>
<p>
Not all implementations of <b>GetProps</b> support both the Unicode and ANSI formats for character strings. When a particular property requires string format conversion and <b>GetProps</b> cannot support it, the <b>Value</b> member for the property is set to MAPI_E_BAD_CHARWIDTH.</p>
<p>
For more information about using <b>GetProps</b> to access properties, see <a href="property_6ptf.htm">Retrieving Properties</a>.</p>
<h4>See Also</h4>
<p>
<a href="inter022_15vd.htm"><b>IMAPIProp::OpenProperty</b></a>, <a href="function_8z3m.htm"><b>MAPIAllocateBuffer</b></a>, <a href="function_11wl.htm"><b>MAPIAllocateMore</b></a>, <a href="function_85yq.htm"><b>MAPIFreeBuffer</b></a>, <a href="structyp_23i1.htm"><b>SPropTagArray</b></a>, <a href="structyp_9sbp.htm"><b>SPropValue</b></a></p>
<p>&nbsp;</p></body>
</HTML>
