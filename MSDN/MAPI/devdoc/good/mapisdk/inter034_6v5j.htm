<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IPersistMessage::InitNew</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_ipersistmessage_initnew"></a>IPersistMessage::InitNew</h2>
<p>
The <b>IPersistMessage::InitNew</b> method initializes a new message.</p>
<h4>Quick Info</h4>
<p>
See <a href="inter034_24ry.htm"><b>IPersistMessage : IUnknown</b></a>.</p>
<pre><code><b>HRESULT InitNew(
  LPMAPIMESSAGESITE</b><i> pMessageSite</i><b>,</b>   
<b>  LPMESSAGE</b><i> pMessage                </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>pMessageSite</i></dt>
<dd>
[in] Pointer to the message site that the form will use to work with the message in the viewer.</dd>
<dt>
<i>pMessage</i></dt>
<dd>
[in] Pointer to the new message.
</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
S_OK</dt>
<dd>
The new message was successfully initialized.
</dd>
</dl>
<h4>Remarks</h4>
<p>
Form viewers call the<i> </i><b>IPersistMessage::InitNew</b><i> </i>method when the user composes a new message belonging to a message class that is handled by the form. If the form object has a valid user interface pointer, the user interface for the message object should be displayed.</p>
<p>
<b>InitNew</b> should not be called when your form is in any state except the <a href="glossary_4s39.htm#_mapi1book_gly_uninitialized_state">Uninitialized state</a>. If the form is in one of the other states when <b>InitNew</b> is called, return E_UNEXPECTED.</p>
<h4>Notes to Implementers</h4>
<p>
Typically, messages that have unsaved properties are marked as dirty so that the client can display a dialog box prompting the user whether or not these properties should be saved. If the user indicates that a message should be saved, save the data, mark the message as clean, and exit normally.</p>
<p>
However, if processing for your newly initialized messages includes setting one or more computed properties and it is important for those properties to be saved, do not mark the messages as dirty. Because computed properties should be invisible to users, no dialog box should be displayed.</p>
<p>
If your form has a reference to an active message site other than the one that is passed into <b>InitNew</b>, release the original site because it will no longer be used. Store the pointers to the message site and message from the <i>pMessageSite</i> and <i>pMessage</i> parameters and call both objects' <b>IUnknown::AddRef</b> methods to increment their reference counts. </p>
<p>
Set the <a href="propa_95wz.htm">PR_MESSAGE_FLAGS</a> and <a href="propb_3c1f.htm">PR_MSG_STATUS</a> properties for the new message to something appropriate for your message class. Many message classes, for example, set PR_MESSAGE_FLAGS to MSGFLAG_UNSENT for new messages.</p>
<p>
Before returning, transition the form to the <a href="glossary_4s32.htm#_mapi1book_gly_normal_state">Normal state</a> if no errors have occurred. Send a new message notification to all registered viewers by calling their <a href="inter027_59ut.htm"><b>IMAPIViewAdviseSink::OnNewMessage</b></a> methods and return S_OK.</p>
<h4>Notes to Callers</h4>
<p>
After you have made a successful call to <b>InitNew</b>, you can assume that the following required properties, and no others, have been set for the form:</p>
<p class=indent1>
<a href="propa_57zo.htm">PR_DELETE_AFTER_SUBMIT</a> </p>
<p class=indent1>
<a href="propa_2b39.htm">PR_IMPORTANCE</a> </p>
<p class=indent1>
<a href="propb_5hyc.htm">PR_ORIGINATOR_DELIVERY_REPORT_REQUESTED</a> </p>
<p class=indent1>
<a href="propb_277d.htm">PR_PRIORITY</a> </p>
<p class=indent1>
<a href="propb_07qc.htm">PR_READ_RECEIPT_REQUESTED</a> </p>
<p class=indent1>
<a href="propb_9mk9.htm">PR_SENSITIVITY</a> </p>
<p class=indent1>
<a href="propb_4s2s.htm">PR_SENTMAIL_ENTRYID</a> </p>
<p>
For more information about the states of forms, see <a href="formsvr_1583.htm">Form States</a>. For more information on how storage objects are initialized, see the documentation for <b>IPersistStorage::InitNew</b> in the <i>OLE Programmer's Reference.</i> </p>
<p>&nbsp;</p></body>
</HTML>
