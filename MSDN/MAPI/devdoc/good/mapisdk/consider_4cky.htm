<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Writing a Remote Viewer</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_writing_a_remote_viewer"></a>Writing a Remote Viewer</h2>
<p>
A remote viewer is a window in a client application that provides controlled access to messages stored on another computer. This controlled access might be with a modem or other type of slow link. Rather than retrieve a complete selection of available messages every time a user opens a folder, the remote viewer first displays only the headers. The user then selects from the headers which of the messages to display in full. Remote viewer clients can allow their users to delete messages before they are ever downloaded. </p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To retrieve the headers of messages stored remotely</h5>
<ol>
<li>
Call <a href="inter023_04md.htm"><b>IMAPISession::GetStatusTable</b></a><b> </b>to access the status table.</li>
<li>
Call <a href="inter026_43lg.htm"><b>IMAPITable::Restrict</b></a><b> </b>to limit the status table to only those rows that have their <a href="propb_0oh1.htm">PR_RESOURCE_TYPE</a> column set to MAPI_TRANSPORT_PROVIDER. </li>
<li>
Call <a href="inter026_7x83.htm"><b>IMAPITable::SetColumns</b></a><b> </b>to include the following columns in the status table: <a href="propa_8cv8.htm">PR_ENTRYID</a>, <a href="propb_3lkj.htm">PR_RESOURCE_METHODS</a>, <a href="propb_0oh1.htm">PR_RESOURCE_TYPE</a>, <a href="propb_9aux.htm">PR_PROVIDER_DISPLAY</a>, and <a href="propb_2zj9.htm">PR_STATUS_CODE</a>.</li>
<li>
Call <a href="function_0dgz.htm"><b>HrQueryAllRows</b></a> to retrieve all the rows in the status table.</li>
<li>
Pass the entry identifier for each row in the table in a call to <a href="inter023_146x.htm"><b>IMAPISession::OpenEntry</b></a>. Because this interface is marshaled from the MAPI spooler's process context to the client's process context — unlike interfaces typically obtained from address book or message store providers — issues concerning multithreading are of more importance. </li>
<li>
Call the status object's <b>IUnknown::QueryInterface</b> method, passing IID_IMAPIFolder as the interface identifier, to retrieve the remote folder.<p>
The remote folder is not a complete folder implementation; it supports only a subset of folder methods and properties. One of the required methods, <a href="inter022_44c3.htm"><b>IMAPIProp::GetProps</b></a>, supports the retrieval of the following properties:
</li>
</ol>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=51%><a href="propa_63eb.htm">PR_ACCESS</a></th>
<th align=left width=49%><a href="propa_4w8c.htm">PR_ACCESS_LEVEL</a></th>
</tr>
<tr valign=top>
<td width=51%><a href="propa_6644.htm">PR_CONTENT_COUNT</a></td>
<td width=49%><a href="propa_7jzo.htm">PR_ASSOC_CONTENT_COUNT</a></td>
</tr>
<tr valign=top>
<td width=51%><a href="propa_0vhh.htm">PR_FOLDER_TYPE</a></td>
<td width=49%><a href="propb_0okl.htm">PR_OBJECT_TYPE</a></td>
</tr>
<tr valign=top>
<td width=51%><a href="propb_1z77.htm">PR_SUBFOLDERS</a></td>
<td width=49%><a href="propa_4j3i.htm">PR_CREATION_VERSION</a></td>
</tr>
<tr valign=top>
<td width=51%><a href="propa_4sdh.htm">PR_CREATION_TIME</a></td>
<td width=49%><a href="propa_1yjp.htm">PR_DISPLAY_NAME</a></td>
</tr>
<tr valign=top>
<td width=51%><a href="propa_7s6d.htm">PR_DISPLAY_TYPE</a></td>
<td width=49%></td>
</tr>
</table><br>
<p class=indent1>
Remote folders must also support the <a href="inter022_79v8.htm"><b>IMAPIProp::GetPropList</b></a>, <a href="inter011_0sx1.htm"><b>IMAPIContainer::GetContentsTable</b></a>, and <a href="inter013_6pmb.htm"><b>IMAPIFolder::SetMessageStatus</b></a> methods. Remote folder contents tables typically support the following columns:</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<td width=51%><a href="propa_8hkf.htm">PR_DISPLAY_TO</a></td>
<th align=left width=49%><a href="propa_8cv8.htm">PR_ENTRYID</a></th>
</tr>
<tr valign=top>
<td width=51%><a href="propa_404o.htm">PR_HASATTACH</a></td>
<td width=49%><a href="propa_2b39.htm">PR_IMPORTANCE</a></td>
</tr>
<tr valign=top>
<td width=51%><a href="propa_65h5.htm">PR_INSTANCE_KEY</a></td>
<td width=49%><a href="propa_0ecz.htm">PR_MESSAGE_CLASS</a></td>
</tr>
<tr valign=top>
<td width=51%><a href="propa_17ad.htm">PR_MESSAGE_DELIVERY_TIME</a></td>
<td width=49%><a href="propa_95wz.htm">PR_MESSAGE_FLAGS</a></td>
</tr>
<tr valign=top>
<td width=51%><a href="propa_4dd1.htm">PR_MESSAGE_DOWNLOAD_TIME</a></td>
<td width=49%><a href="propa_97fp.htm">PR_MESSAGE_SIZE</a></td>
</tr>
<tr valign=top>
<td width=51%><a href="propb_3c1f.htm">PR_MSG_STATUS</a></td>
<td width=49%><a href="propb_0okl.htm">PR_OBJECT_TYPE</a></td>
</tr>
<tr valign=top>
<td width=51%><a href="propb_5xo4.htm">PR_NORMALIZED_SUBJECT</a></td>
<th align=left width=49%><a href="propb_277d.htm">PR_PRIORITY</a></th>
</tr>
<tr valign=top>
<th align=left width=51%><a href="propb_9orp.htm">PR_SENDER_NAME</a></th>
<td width=49%><a href="propb_9mk9.htm">PR_SENSITIVITY</a></td>
</tr>
<tr valign=top>
<td width=51%><a href="propb_799h.htm">PR_SENT_REPRESENTING_NAME</a></td>
<td width=49%><a href="propb_3c8k.htm">PR_SUBJECT</a></td>
</tr>
</table><br>
<ol start=7>
<li>
Call the transport provider's <a href="inter024_6x2d.htm"><b>IMAPIStatus::ValidateState</b></a> method the first time that one of the transfer options is picked. Either the REFRESH_XP_HEADER_CACHE or PROCESS_XP_HEADER_CACHE process flag should be set as well as the SHOW_XP_SSESSION_UI flag to allow the user interface to be shown. </li>
</ol>
<p>
<b>Note</b>  To mark a particular message header for downloading or deletion, a client calls <a href="inter013_6pmb.htm"><b>IMAPIFolder::SetMessageStatus</b></a> and sets either the MSGSTATUS_REMOTE_DOWNLOAD or MSGSTATUS_REMOTE_DELETE flag.</p>
<p>&nbsp;</p></body>
</HTML>
