<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>OpenStreamOnFile</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_openstreamonfile"></a>OpenStreamOnFile</h2>
<p>
The <b>OpenStreamOnFile</b> function allocates and initializes an OLE <b>IStream</b> object to access the contents of a file. </p>
<h4>Quick Info</h4>
<table cellspacing=4 cols=2>
<tr valign=top>
<td width=48%>Header file: </td>
<td width=52%>MAPIUTIL.H </td>
</tr>
<tr valign=top>
<td width=48%>Implemented by: </td>
<td width=52%>MAPI </td>
</tr>
<tr valign=top>
<td width=48%>Called by: </td>
<td width=52%>Client applications and service providers </td>
</tr>
</table><br>
<pre><code><b>HRESULT STDMETHODCALLTYPE OpenStreamOnFile( 
  LPALLOCATEBUFFER</b><i> lpAllocateBuffer</i><b>,</b>   
<b>  LPFREEBUFFER</b><i> lpFreeBuffer</i><b>,</b>           
<b>  ULONG</b><i> ulFlags</i><b>,</b>                       
<b>  LPTSTR</b><i> lpszFileName</i><b>,</b>                 
<b>  LPTSTR</b><i> lpszPrefix</i><b>,</b>                   
<b>  LPSTREAM FAR *</b><i> lppStream</i>             
<b>); </b>
 </code></pre>
<h4>Parameters </h4>
<dl>
<dt>
<i>lpAllocateBuffer </i></dt>
<dd>
[in] Pointer to the <a href="function_8z3m.htm"><b>MAPIAllocateBuffer</b></a> function, to be used where required by MAPI to allocate memory. </dd>
<dt>
<i>lpFreeBuffer </i></dt>
<dd>
[in] Pointer to the <a href="function_85yq.htm"><b>MAPIFreeBuffer</b></a> function, to be used where required by MAPI to free memory. </dd>
<dt>
<i>ulFlags </i></dt>
<dd>
[in] Bitmask of flags used to control the creation or opening of the file to be accessed through the OLE <b>IStream</b> object. The following flags can be set: 
<dl>
<dt>
SOF_UNIQUEFILENAME </dt>
<dd>
A temporary file is to be created for the <b>IStream</b> object. If this flag is set, the STGM_CREATE and STGM_READWRITE flags should also be set. </dd>
<dt>
STGM_CREATE </dt>
<dd>
The file is to be created even if one already exists. If the <i>lpszFileName</i> parameter is not set, both this flag and STGM_DELETEONRELEASE must be set. If STGM_CREATE is set, the STGM_READWRITE flag must also be set. </dd>
<dt>
STGM_DELETEONRELEASE </dt>
<dd>
The file is to be deleted when the <b>IStream</b> object is released. If the <i>lpszFileName</i> parameter is not set, both this flag and STGM_CREATE must be set. </dd>
<dt>
STGM_READ </dt>
<dd>
The file is to be created or opened with read-only access. </dd>
<dt>
STGM_READWRITE </dt>
<dd>
The file is to be created or opened with read/write access. If this flag is not set, the STGM_CREATE flag must not be set either. </dd>
</dl>
</dd>
<dt>
<i>lpszFileName </i></dt>
<dd>
[in] The filename, including path and extension, of the file for which <b>OpenStreamOnFile</b> initializes the <b>IStream</b> object. If the SOF_UNIQUEFILENAME flag is set, <i>lpszFileName</i> contains the path to the directory in which to create a temporary file. If <i>lpszFileName</i> is NULL, <b>OpenStreamOnFile</b> obtains an appropriate path from the system, and both the STGM_CREATE and STGM_DELETEONRELEASE flags must be set. </dd>
<dt>
<i>lpszPrefix </i></dt>
<dd>
[in] The prefix for the filename on which <b>OpenStreamOnFile</b> initializes the <b>IStream</b> object. If set, the prefix must contain not more than three characters. If <i>lpszPrefix</i> is NULL, a prefix of "SOF" is used. </dd>
<dt>
<i>lppStream </i></dt>
<dd>
[out] Pointer to a pointer to an object exposing the <b>IStream</b> interface. 
</dd>
</dl>
<h4>Return Values </h4>
<dl>
<dt>
S_OK </dt>
<dd>
The call succeeded and has returned the expected value or values. </dd>
<dt>
MAPI_E_NO_ACCESS </dt>
<dd>
The file could not be accessed due to insufficient user permissions or because read-only files cannot be modified. </dd>
<dt>
MAPI_E_NOT_FOUND </dt>
<dd>
The designated file does not exist. 
</dd>
</dl>
<h4>Remarks </h4>
<p>
The <b>OpenStreamOnFile</b> function has two important uses, distinguished by the setting of the SOF_UNIQUEFILENAME flag. When this flag is not set, <b>OpenStreamOnFile</b> opens an <b>IStream</b> object on an existing file, for example to copy its contents to the <a href="propa_6eni.htm">PR_ATTACH_DATA_BIN</a> property of an attachment using the <b>IStream::CopyTo</b> method. In this case the <i>lpszFileName</i> parameter specifies the path and filename of the file. </p>
<p>
When SOF_UNIQUEFILENAME is set, <b>OpenStreamOnFile</b> creates a temporary file to hold data for an <b>IStream</b> object. For this usage, the <i>lpszFileName</i> parameter can optionally designate the path to the directory where the file is to be created, and the <i>lpszPrefix</i> parameter can optionally specify a prefix for the filename. </p>
<p>
When the calling client application or service provider is finished with the <b>IStream</b> object, it should free it by calling the OLE <b>IStream::Release</b> method. </p>
<p>
MAPI uses the functions pointed to by <i>lpAllocateBuffer</i> and <i>lpFreeBuffer</i> for most memory allocation and deallocation, in particular to allocate memory for use by client applications when calling object interfaces such as <a href="inter022_44c3.htm"><b>IMAPIProp::GetProps</b></a> and <a href="inter026_7wkz.htm"><b>IMAPITable::QueryRows</b></a>. </p>
<h4>Notes to Callers </h4>
<p>
The SOF_UNIQUEFILENAME flag is used to create a temporary file with a name unique to the messaging system. If this flag is set, the <i>lpszFileName</i> parameter specifes the path for the temporary file, and the <i>lpszPrefix</i> parameter contains the prefix characters of the filename. The constructed filename is &lt;prefix&gt;HHHH.TMP, where HHHH is a hexadecimal number. If <i>lpszFileName</i> is NULL, the file will be created in the temporary file directory that is returned from the Windows function <b>GetTempPath</b>, or the current directory if no temporary file directory has been designated. </p>
<p>
If the SOF_UNIQUEFILENAME flag is not set, <i>lpszPrefix</i> is ignored, and <i>lpszFileName</i> should contain the fully qualified path and filename of the file to be opened or created. The file will be opened or created based on the other flags that are set in <i>ulFlags</i>. </p>
<h4>See Also</h4>
<p>
<a href="groups_2zn7.htm">IStorage Functions</a> </p>
<p>&nbsp;</p></body>
</HTML>
