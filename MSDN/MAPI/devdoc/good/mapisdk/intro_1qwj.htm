<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>MAPI Sessions</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_mapi1book_mapi_sessions"></a>MAPI Sessions</h1>
<p>
Before your client application can call an underlying messaging system, it must establish a session, or connection, with the MAPI subsystem. Sessions are initiated when a user logs on, a process that consists of accessing a valid <a href="glossary_4s34.htm#_mapi1book_gly_profile">profile</a>, validating <a href="glossary_4s31.htm#_mapi1book_gly_messaging_system">messaging system</a> and <a href="glossary_4s31.htm#_mapi1book_gly_message_service">message service</a> credentials, and insuring that all of the profile's message services are properly configured. The client interface you use determines the logon call. MAPI clients call the <a href="function_8to8.htm"><b>MAPILogonEx</b></a> function, Simple MAPI clients call the <a href="smapiref_68tq.htm"><b>MAPILogon</b></a> function, CMC clients call the <a href="cmcref_3dbi.htm"><b>cmc_logon</b></a> function, and Active Messaging Library clients call the Session object's <b>Logon</b> method.</p>
<p>
MAPI supports the validation of credentials, such as passwords, as an optional feature. The use and implementation of passwords depends on the messaging system being used and the operating system. Some operating systems support security that is based on user accounts; others do not. Passwords can either be saved in the profile or entered by the user with every logon. </p>
<p>
The following table lists the MAPI operating systems and whether or not each type implements user account security.</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=51%>MAPI platform</th>
<th align=left width=49%>User account security</th>
</tr>
<tr valign=top>
<td width=51%>Windows 95</td>
<td class=indent1 width=49%>Yes</td>
</tr>
<tr valign=top>
<td width=51%>Windows NT</td>
<td class=indent1 width=49%>Yes</td>
</tr>
<tr valign=top>
<td width=51%>Windows 3.x</td>
<td class=indent1 width=49%>No</td>
</tr>
<tr valign=top>
<td width=51%>Windows for Workgroups 3.x</td>
<td class=indent1 width=49%>No</td>
</tr>
</table><br>
<p>
Message service configuration is one of the most important parts of the logon process. The profile is the initial source for configuration information. If information for a particular message service is missing, the logon process attempts to prompt the user to supply it, an attempt which is not always successful for two reasons. Prompting the user requires the display of a dialog box. It is possible for clients to disallow the display of a user interface by passing a flag into the logon call. A second possible reason for failure is the cancellation of the dialog box by the user before the needed information can be added.</p>
<p>
When a logon process fails once, the user is informed of the failure and given the opportunity to retry or correct the error condition. Once again, a user interface will be displayed, if possible, and the user will be prompted to enter whatever data is missing. If this second attempt proves unsuccessful, MAPI disables all <a href="glossary_4s37.htm#_mapi1book_gly_service_provider">service providers</a> in the message service for the duration of the session. In effect, the whole message service is disabled, meaning that none of the service providers in the message service can work. This is done because if one provider fails logon, the other providers usually also fail. The logon process can fail due to an invalid path for a necessary resource, an incompatible version of MAPI, an unavailable messaging server, or data corruption. </p>
<p>
Clients can specify one of two types of sessions to be established in the logon call: an individual session or a shared session. Individual sessions are private connections; there is a one-to-one relationship between a client application and the session it is using. As a consequence, client applications sharing a session also share a profile. Shared sessions are established once but can be "used" by other client applications who need to use them. The profile and credentials are specified only with the initial logon. </p>
<p>
MAPI also supports unified logon, in which a single initial logon to the messaging system results in access to multiple workgroup applications. When working with unified logon, users do not have to enter a name and password for each application they want to use.</p>
<p>
Clients can log on multiple times as the same user or as multiple users. MAPI does not prevent this. Some service providers, however, might not be as flexible, returning the error value MAPI_E_SESSION_LIMIT on subsequent logon attempts. Service providers with underlying hardware limitations can be required to enforce a session limit.</p>
<p>
The function calls for establishing a session have a collection of flags and parameters that control how the session is created. The client specifies an optional profile name, password, and a window handle that acts as the parent window for any dialog boxes that are displayed. The flags include MAPI_NEW_SESSION to request that a new, individual session be established rather than establishing a connection to a shared session, and two user interface flags, MAPI_LOGON_UI and MAPI_PASSWORD_UI. The user interface flags are set to request either a logon dialog box or a password dialog box.</p>
<p>
The following illustration shows how these various parameters and flags establish a MAPI session.</p>
<p>
<img src="images/amapi_47.gif" border=0></p>
<p>
For information about handling sessions from within a client application, see <a href="consider_1u93.htm">Session Handling</a>.</p>
<p>&nbsp;</p></body>
</HTML>
