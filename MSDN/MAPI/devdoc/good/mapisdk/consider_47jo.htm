<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Creating a Recipient List</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_creating_a_recipient_list"></a>Creating a Recipient List</h2>
<p>
A recipient list is an <a href="structyp_87n8.htm"><b>ADRLIST</b></a> structure that contains an array of property value structures for each message recipient — destination for the message. A recipient can represent a human user, a machine, or a folder. All messages to be sent require at least one recipient that has been through the name resolution process — a process for ensuring that the <a href="propa_8cv8.htm">PR_ENTRYID</a> property is included in the recipient's property value array.</p>
<p>
The properties of a recipient are a combination of address book properties and message properties. Recipient properties can apply either to all messages for a particular recipient or only to the current message. Both message store and transport providers can set recipient properties. </p>
<p>
Each recipient must have a core set of properties in its property value array by the time the message is ready to be sent. The required set of recipient properties include:</p>
<p class=indent1>
<a href="propa_4gkl.htm">PR_ADDRTYPE</a></p>
<p class=indent1>
<a href="propa_1yjp.htm">PR_DISPLAY_NAME</a></p>
<p class=indent1>
<a href="propa_2t9v.htm">PR_EMAIL_ADDRESS</a></p>
<p class=indent1>
<a href="propa_8cv8.htm">PR_ENTRYID</a></p>
<p class=indent1>
<a href="propb_0okl.htm">PR_OBJECT_TYPE</a></p>
<p class=indent1>
<a href="propb_960p.htm">PR_SEARCH_KEY</a></p>
<p>
These properties are used to access the recipient, send messages to it, and to compare it to others. Not all of these properties need to be available right away. You can add a recipient initially without knowing its entry identifier, relying on the name resolution process to assign this property. At some point before you send a message, call <a href="inter006_64v9.htm"><b>IAddrBook::ResolveName</b></a> to make sure that all of the recipients in your recipient list are resolved. For more information about resolving recipients, see <a href="consider_3i1x.htm">Resolving a Name</a>.</p>
<p>
Recipient lists can be created from messaging users or distribution list entries in an address book container or from one-offs. One-offs are recipients that are created either as temporary entries to be used only for addressing a single message or as entries to be added to a personal address book. The format for a one-off entry identifier and address is defined by MAPI. For information about these formats, see <a href="extend_6j03.htm">One-Off Addresses</a> and <a href="extend_9ks3.htm">One-Off Entry Identifiers</a>.</p>
<p>
You can allow users to build their recipient lists:
<ul>
<li>
Only with entries from the address book.</li>
<li>
Only with one-off entries.</li>
<li>
With a combination of address book recipients and one-offs.</li>
</ul>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To create a recipient list using the common address dialog box</h5>
<ol>
<li>
Allocate an <a href="structyp_9ze5.htm"><b>ADRPARM</b></a> structure and a pointer to an <a href="structyp_87n8.htm"><b>ADRLIST</b></a> structure.</li>
<li>
Zero the memory in the <b>ADRPARM</b> structure and set the <b>ADRLIST</b> pointer to NULL.</li>
<li>
Call <a href="inter006_2fn7.htm"><b>IAddrBook::Address</b></a><b> </b>to display the address dialog box and populate the <b>ADRPARM</b> structure.</li>
<li>
Call <a href="inter029_8vw3.htm"><b>IMessage::ModifyRecipients</b></a>, passing the <b>ADRLIST</b> pointer. This structure will contain the properties of each of the recipients selected by the user.</li>
</ol>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To create a recipient list programmatically</h5>
<ol>
<li>
Allocate an <a href="structyp_87n8.htm"><b>ADRLIST</b></a> structure that contains one <a href="structyp_6m49.htm"><b>ADRENTRY</b></a> structure for each of the recipients to be included in the list. Make each <b>ADRENTRY</b> structure large enough to hold each of the required properties and <a href="propb_0n6t.htm">PR_RECIPIENT_TYPE</a>.</li>
<li>
For each recipient, set the property value array for its <b>aEntries</b> member in the <b>ADRLIST</b> structure. For example, the following code sample shows how to include the entry identifier and display name in the array.</li>
</ol>
<pre><code>LPADRLIST lpAdrList = NULL;

hr = MAPIAllocateBuffer(numProps * sizeof(SPropValue), 
                (LPVOID FAR *(&amp;lpAdrList-&gt;aEntries[0].rgPropVals);

lpAdrList-&gt;aEntries[0].rgPropVals[0].ulPropTag = PR_ENTRYID;
lpAdrList-&gt;aEntries[0].rgPropVals[0].Value.bin     = RecipEID;

lpAdrList-&gt;aEntries[0].rgPropVals[1].ulPropTag = PR_DISPLAY_NAME;
lpAdrList-&gt;aEntries[0].rgPropVals[1].Value.LPSZ     = szDisplay;

lpAdrList-&gt;aEntries[0].cValues=numProps;
 </code></pre>
<ol start=3>
<li>
Call<b> <a href="inter029_8vw3.htm">IMessage::ModifyRecipients</a></b> with the MODRECIP_ADD flag set.</li>
</ol>
<p>&nbsp;</p></body>
</HTML>
