<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Opening Message Text</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_opening_message_text"></a>Opening Message Text</h2>
<p>
The text of a message is stored either in its <a href="propa_9lvd.htm">PR_BODY</a> property or <a href="propb_7vhg.htm">PR_RTF_COMPRESSED</a> property. If you support the Rich Text Format (RTF), open PR_RTF_COMPRESSED. If you do not support RTF, open PR_BODY. Because the text of a message can be large regardless of whether or not it is formatted, use <a href="inter022_15vd.htm"><b>IMAPIProp::OpenProperty</b></a> to open these properties.</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To display formatted message text</h5>
<ol>
<li>
If you are using a non-RTF aware message store, as indicated by the absence of the STORE_RTF_OK flag in the store's <a href="propb_01t7.htm">PR_STORE_SUPPORT_MASK</a> property:<ol type=a>
<li>
Call the message's<b> <a href="inter022_44c3.htm">IMAPIProp::GetProps</a></b> method to retrieve the <a href="propb_26ar.htm">PR_RTF_IN_SYNC</a> property. </li>
<li>
Call <a href="function_4yg3.htm"><b>RTFSync</b></a> to synchronize the message's <a href="propa_9lvd.htm">PR_BODY</a> property with the <a href="propb_7vhg.htm">PR_RTF_COMPRESSED</a> property. Pass the RTF_SYNC_BODY_CHANGED flag if the call to retrieve PR_RTF_IN_SYNC failed because the property does not exist or it is set to FALSE.</li>
<li>
If <b>RTFSync</b> returned TRUE — indicating that changes were made — call the message's<b> <a href="inter022_5rqr.htm">IMAPIProp::SaveChanges</a></b> method to permanently store them.</li>
</ol>
</li>
<li>
Regardless of whether or not you are using an RTF-aware message store:<ol type=a>
<li>
Call <a href="inter022_15vd.htm"><b>IMAPIProp::OpenProperty</b></a> to open the <a href="propb_7vhg.htm">PR_RTF_COMPRESSED</a> property. </li>
<li>
If PR_RTF_COMPRESSED is not available, call <b>OpenProperty</b> to open the <a href="propa_9lvd.htm">PR_BODY</a> property.</li>
<li>
Call the <a href="function_8lv1.htm"><b>WrapCompressedRTFStream</b></a> function to create an uncompressed version of the compressed RTF data, if available.</li>
<li>
Copy the formatted text from the stream to the appropriate place in the message form. </li>
</ol>
</li>
</ol>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To display plain message text</h5>
<ol>
<li>
Call the message's <a href="inter022_44c3.htm"><b>IMAPIProp::GetProps</b></a> method to retrieve the <a href="propa_9lvd.htm">PR_BODY</a> property.</li>
<li>
If <b>GetProps</b> returns either PT_ERROR for the property type in the property value structure or MAPI_E_NOT_ENOUGH_MEMORY, call the message's <a href="inter022_15vd.htm"><b>IMAPIProp::OpenProperty</b></a> method. Pass PR_BODY as the property tag and IID_IStream as the interface identifier. </li>
<li>
Copy the plain text from the stream to the appropriate place in the message form. </li>
</ol>
<p>&nbsp;</p></body>
</HTML>
