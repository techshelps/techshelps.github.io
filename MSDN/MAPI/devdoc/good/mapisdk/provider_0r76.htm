<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Starting a Service Provider</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_mapi1book_starting_a_service_provider"></a>Starting a Service Provider</h1>
<p>
At some point after a client starts a session with MAPI, your service provider will be started. Transport providers are started when a client makes a request for their services. Address book and message store providers are started during the client's logon process. A client calls <a href="inter023_01ij.htm"><b>IMAPISession::OpenAddressBook</b></a> to load each of the address book providers included in the profile and <a href="inter023_59id.htm"><b>IMAPISession::OpenMsgStore</b></a> to load a specific message store provider. Address book providers that are part of a message service are started before any of the other providers in the service.</p>
<p>
MAPI starts each service provider in the active profile by:
<ul>
<li>
Locating the name of its DLL in the profile. <p>
You are required to register the name of your provider DLL in the MAPISVC.INF configuration file to ensure that it appears in the profile. When your service provider is added to a profile, either individually or as part of a message service, all of the <b>[Service Provider]</b> sections from MAPISVC.INF that apply to your provider are copied into the profile. For more information about the structure of MAPISVC.INF, see <a href="appxfile_723q.htm">File Format of MAPISVC.INF</a>.
</li>
<li>
Calling the Windows API function <b>LoadLibrary </b>to load the DLL. <p>
Because MAPI calls <b>LoadLibrary</b> either every time it uses a service provider DLL, regardless of whether it has already been loaded, or only the first time, your service provider must not make assumptions about the number of times that it will be loaded. For every call to <b>LoadLibrary</b>, MAPI makes a call to the Windows API function <b>FreeLibrary</b> when a service provider DLL is no longer needed.
</li>
<li>
Calling the entry point function for the provider. <p>
MAPI calls your provider's entry point function to initiate the logon process. Entry point functions ensure that you are using a version of the service provider interface (SPI) that is compatible with the version being used by MAPI. These functions also return pointers to newly created provider objects. For information about creating an entry point function for your provider, see <a href="provider_7x9q.htm">Implementing a Service Provider Entry Point Function</a>.
</li>
</ul>
<p>&nbsp;</p></body>
</HTML>
