<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Supporting Formatted Text in Incoming Messages: Client Responsibilities</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_supporting_formatted_text_in_incoming_messages_client_responsibilities"></a>Supporting Formatted Text in Incoming Messages: Client Responsibilities </h2>
<p>
As messages are transferred between messaging systems, the MAPI spooler makes sure that the rich text formatting remains synchronized with the message text. The MAPI spooler calls the <b>RTFSync</b> function from within a wrapped version of the message that it passes to the transport provider. The transport provider saves the changes made to the message by calling the <b>IMAPIProp::SaveChanges</b> method and then routes it to the new recipient.</p>
<p>
When the recipient's RTF-aware client application opens the message to display the text, it must synchronize the text with the formatting and open either <a href="propb_7vhg.htm">PR_RTF_COMPRESSED</a> or <a href="propa_9lvd.htm">PR_BODY</a>, depending on which property is available. </p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To open a message, RTF-aware clients</h5>
<ol>
<li>
Call <a href="function_4yg3.htm"><b>RTFSync</b></a> to synchronize the message text with the formatting if the message store is not RTF-aware. The RTF_SYNC_BODY_CHANGED flag should be passed in the <i>ulFlags</i> parameter if the <a href="propb_26ar.htm">PR_RTF_IN_SYNC</a> property is missing or set to FALSE. Clients working with RTF-aware message stores need not make the <b>RTFSync </b>call because the message store takes care of it.</li>
<li>
Call <a href="inter022_5rqr.htm"><b>IMAPIProp::SaveChanges</b></a> if the message text has been updated.</li>
<li>
Call <a href="inter022_15vd.htm"><b>IMAPIProp::OpenProperty</b></a> to open the <a href="propb_7vhg.htm">PR_RTF_COMPRESSED</a> property. If PR_RTF_COMPRESSED is not available, you should open the <a href="propa_9lvd.htm">PR_BODY</a> property instead to display the message content.</li>
<li>
Call the <a href="function_8lv1.htm"><b>WrapCompressedRTFStream</b></a> function to create an uncompressed version of the compressed RTF data, if available.</li>
<li>
Display the uncompressed RTF data or the plain text data to the user.</li>
</ol>
<p>
<b>RTFSync</b> returns a Boolean value that indicates whether or not the message has been updated. If this value returns TRUE, call <b>SaveChanges</b> at some point to make the update permanent. The call does not have to be made immediately after <b>RTFSync</b> returns.</p>
<p>
<b>Note</b>  Because so many components handle the formatted text before you receive it, there is the possibility of corruption. This corruption could come from the message store provider, a third party application, a gateway, or a transmission error.</p>
<p>&nbsp;</p></body>
</HTML>
