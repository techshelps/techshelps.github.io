<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Read-Only Message Stores</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_mapi1book_read_only_message_stores"></a>Read-Only Message Stores</h1>
<p>
A read-only message store is one in which neither the MAPI client nor the MAPI spooler can create, modify or delete the objects in the message store. There are many reasons why you might want to implement a read-only message store. For example, a credit reporting firm could use a read-only store to allow its customers or employees to see but not change individual credit reports. Choosing to make a read-only message store has implications for the structure of the store provider and for the store itself. For example, a read-only message store can't have an Outbox folder because then MAPI clients would request that new outgoing messages be created in that folder. Similarly, it is the store provider's responsibility to ensure the integrity of the underlying storage mechanism.</p>
<p>
There are three flags that can be set in the message store's <a href="propb_01t7.htm">PR_STORE_SUPPORT_MASK</a> property which support different levels of read-only access. the STORE_READONLY flag indicates that all <a href="inter022_00tq.htm"><b>IMAPIProp</b></a> interfaces on objects within the message store are read-only. The STORE_MODIFY_OK flag indicates that existing messages in the message store may be modified, but new folders and messages may not be created. The STORE_CREATE_OK flag indicates that new messages and folders may be created, but indicates nothing about whether existing objects may be modified.</p>
<p>
The fact that MAPI clients and the MAPI spooler may not be able to create, modify or delete objects in the message store does not mean that the contents of the underlying storage mechanism never change. Nor does it mean that your store provider never needs write access to the underlying storage mechanism. In some circumstances those two conditions may apply, but not in the general case of a read-only message store. What level of access your store provider requires and whether or not your store provider ever changes data in the underlying storage mechanism depends mainly on the specific nature of your store provider.</p>
<p>
For example, if you are writing a store provider to give MAPI clients access to a database stored on a CD-ROM device, then the underlying storage mechanism cannot change and your store provider can only have read access to it. If, however, you are writing a store provider to give MAPI clients read-only access to a public folder database but the store provider needs to keep track of the read/unread status of messages for each user, then the store provider will need to write new data to the underlying storage mechanism. However, in neither example does the store provider ever have to create, modify, or delete folders or messages at the request of MAPI clients or the MAPI spooler.</p>
<p>
The list of reasons that a store provider would need to write data to an underlying storage mechanism that is otherwise read-only is fairly short:
<ul>
<li>
To store the read/unread status of messages.</li>
<li>
To implement read/non-read notifications.  </li>
<li>
To store views.</li>
<li>
To cache persistent indexes for user defined folder sort orders.</li>
<li>
To store what order a folder's contents are sorted in (supporting <a href="inter013_12t0.htm"><b>IMAPIFolder::SaveContentsSort</b></a>).</li>
<li>
To store search criteria, search state, and results, if the message store provider supports searches (supporting <a href="inter011_2psx.htm"><b>IMAPIContainer::SetSearchCriteria</b></a>).</li>
</ul>
<p>
If your message store provider can never write data to the underlying storage mechanism, it will need to implement these features using a separate storage mechanism outside of the underlying storage mechanism. For example, a read-only message store provider could store the read/unread status of messages in the store in a file on the user's computer. This strategy presents additional difficulties but may be the only feasable way for read-only message store providers to implement some features. For example, keeping the contents of the separate storage mechanism synchronized with the objects in the message store is more difficult than storing the read/unread status directly in the message store itself.</p>
<p>
Searching presents an additional complication for read-only message store providers. Clients use the folder specified in the message store object's <a href="propa_3gro.htm">PR_FINDER_ENTRYID</a> property to locate the folder used for search results. Read-only message store providers often cannot install a permanent search-results folder into the message store. In that situation, the message store provider should store an entry identifier in the PR_FINDER_ENTRYID property that it can recognize when clients open folders so that it can dynamically create a search-results folder instead of reading one from the underlying storage mechanism. However, since many read-only message store providers create all their folders dynamically, this is usually not too much of a burden.</p>
<p>
The fact that your message store provider is read-only is advertised in the store provider object's <a href="propb_01t7.htm">PR_STORE_SUPPORT_MASK</a> property. However, do not count on clients to respect that property; your store provider's code should enforce the read-only status of the underlying storage mechanism.</p>
<p>&nbsp;</p></body>
</HTML>
