<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Searching a Message Store</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_searching_a_message_store"></a>Searching a Message Store</h2>
<p>
Client applications can search through one or more folders looking for messages that match search criteria. The most straightforward search technique involves applying a restriction to define criteria and placing the results into a search-results folder, created explicitly for this search or for a prior search. Not all message stores support this technique. To determine whether or not the message store you are using supports using search-results folders, call its <a href="inter022_44c3.htm"><b>IMAPIProp::GetProps</b></a> method to retrieve the <a href="propb_01t7.htm">PR_STORE_SUPPORT_MASK</a> property. If the STORE_SEARCH_OK flag is set, searching is supported. If it is not set, you'll need an alternate approach such as manually inspecting the target folders. </p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To search one or more folders in a message store</h5>
<ol>
<li>
If you have a search-results folder from a previous search, skip to step 2. Otherwise, to create a search-results folder:<ol type=a>
<li>
Retrieve the entry identifier for the search-results root folder by calling the message store's <a href="inter022_44c3.htm"><b>IMAPIProp::GetProps</b></a> method and requesting <a href="propa_3gro.htm">PR_FINDER_ENTRYID</a>.</li>
<li>
Call <a href="inter031_3se1.htm"><b>IMsgStore::OpenEntry</b></a> to open the folder represented by PR_FINDER_ENTRYID.</li>
<li>
Call the folder's <a href="inter013_9tpu.htm"><b>IMAPIFolder::CreateFolder</b></a> method to create a search-results folder with the FOLDER_SEARCH flag set.</li>
</ol>
</li>
<li>
Build a restriction to hold your search criteria. </li>
<li>
Create an array of entry identifiers that represent the folders to search. This step is unnecessary if the search-results folder has been used before and you want to search the same folders.</li>
<li>
Call the search-results folder's <a href="inter011_2psx.htm"><b>IMAPIContainer::SetSearchCriteria</b></a> method, pointing <i>lpContainerList </i>to the entry identifier array and <i>lpRestriction</i> to the restriction. </li>
<li>
If you have registered for search complete notifications with the message store, wait for the notification to arrive.</li>
<li>
View the results of the search by calling the search-results folder's <a href="inter011_0sx1.htm"><b>IMAPIContainer::GetContentsTable</b></a> method to access its contents table.</li>
<li>
Call the contents table's <a href="inter026_7wkz.htm"><b>IMAPITable::QueryRows</b></a> method<b> </b>to retrieve the messages that satisfy the search criteria.</li>
</ol>
<p>&nbsp;</p></body>
</HTML>
