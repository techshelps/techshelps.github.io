<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IMAPISupport::SpoolerNotify</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_imapisupport_spoolernotify"></a>IMAPISupport::SpoolerNotify</h2>
<p>
The <b>IMAPISupport::SpoolerNotify</b> method notifies the MAPI spooler of a change in status or a request for service.</p>
<h4>Quick Info</h4>
<p>
See <a href="inter025_8uge.htm"><b>IMAPISupport : IUnknown</b></a>.</p>
<pre><code><b>HRESULT SpoolerNotify(
  ULONG</b><i> ulFlags</i><b>,</b>  
<b>  LPVOID</b><i> lpvData  </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>ulFlags</i></dt>
<dd>
[in] Bitmask of flags that indicates the type of notification. All of the flags except for NOTIFY_NEWMAIL_RECEIVED can be set by transport providers; only NOTIFY_NEWMAIL_RECEIVED and NOTIFY_READTOSEND are valid for message store providers.
<p>
The following flags are valid for the <i>ulFlags</i> parameter::

<dl>
<dt>
NOTIFY_CONFIG_CHANGE</dt>
<dd>
Registers a request to change the transport provider's configuration. </dd>
<dt>
NOTIFY_CRITICAL_ERROR</dt>
<dd>
An unrecoverable error has occurred to the transport provider. Because both NOTIFY_SENTDEFERRED and NOTIFY_CRITICAL_ERROR use the <i>lpvData</i> parameter for transport provider calls, these flags are mutually exclusive.</dd>
<dt>
NOTIFY_CRITSEC</dt>
<dd>
Requests a critical section for the transport provider. The <i>lpvData</i> parameter is undefined and should be NULL.</dd>
<dt>
NOTIFY_NEWMAIL</dt>
<dd>
The MAPI spooler should download any newly received messages at the next available time. The <i>lpvData</i> parameter is undefined and should be set to NULL.</dd>
<dt>
NOTIFY_NEWMAIL_RECEIVED</dt>
<dd>
A new message has been received in the message store. The <i>lpvData</i> parameter points to a <a href="structyp_51ny.htm"><b>NEWMAIL_NOTIFICATION</b></a> structure describing the message. This flag is used for message store providers that are tightly coupled with transport providers and is ignored if the store provider logged on with the MAPI_NO_MAIL flag set.</dd>
<dt>
NOTIFY_NONCRIT</dt>
<dd>
Releases a critical section that was obtained with a previous call to <b>SpoolerNotify</b> with <i>ulFlags</i> set to NOTIFY_CRITSEC. The <i>lpvData</i> parameter is undefined and should be set to NULL.</dd>
<dt>
NOTIFY_READYTOSEND</dt>
<dd>
The transport or message store provider is ready to send messages. The <i>lpvData</i> parameter is undefined and should be set to NULL.</dd>
<dt>
NOTIFY_SENTDEFERRED</dt>
<dd>
A previously deferred message should now be sent and the transport provider should be notified when it is ready to be delivered with a call to <a href="inter042_18v9.htm"><b>IXPLogon::SubmitMessage</b></a>. The entry identifier of the deferred message is contained in an <a href="structyp_86bd.htm"><b>SBinary</b></a> structure pointed to by <i>lpvData</i>. Because both NOTIFY_SENTDEFERRED and NOTIFY_CRITICAL_ERROR use the <i>lpvData</i> parameter, these flags are mutually exclusive.</dd>
</dl>
</dd>
<dt>
<i>lpvData</i></dt>
<dd>
[in] Pointer to associated data applicable to a notification. The <i>lpvData</i> parameter points to valid data only when the following flags are set; <i>lpvData</i> is NULL when <i>ulFlags</i> is set to the other notification types:

<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=48%>Setting for <i>ulFlags</i></th>
<th align=left width=52%>Value for <i>lpvData</i></th>
</tr>
<tr valign=top>
<td width=48%>NOTIFY_CRITICAL_ERROR</td>
<td width=52%>Information about the error.</td>
</tr>
<tr valign=top>
<td width=48%>NOTIFY_NEWMAIL_RECEIVED</td>
<td width=52%><a href="structyp_51ny.htm"><b>NEWMAIL_NOTIFICATION</b></a> structure with information about the newly delivered message.</td>
</tr>
<tr valign=top>
<td width=48%>NOTIFY_SENTDEFERRED</td>
<td width=52%><a href="structyp_86bd.htm"><b>SBinary</b></a> structure with entry identifier of deferred message.</td>
</tr>
</table><br>

</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
S_OK</dt>
<dd>
The notification was successful.
</dd>
</dl>
<h4>Remarks</h4>
<p>
The <b>IMAPISupport::SpoolerNotify</b> method is implemented for message store and transport provider support objects. These providers call <b>SpoolerNotify</b> to notify the MAPI spooler of a change in status or a request for service. <b>SpoolerNotify</b> is called primarily by transport providers and may be called at any time during the session.</p>
<h4>Notes to Transport Providers</h4>
<p>
If you have changed your configuration, call <b>SpoolerNotify</b> and set <i>ulFlags</i> to NOTIFY_CONFIG_CHANGED. <b>SpoolerNotify</b> responds by calling your <a href="inter042_0xbn.htm"><b>IXPLogon::AddressTypes</b></a> method to query for a change in supported address types and the <a href="inter023_9ier.htm"><b>IMAPISession::MessageOptions</b></a> method to ask MAPI to display your configuration properties to the user.</p>
<p>
If you need a critical section to ensure uninterrupted processing, call <b>SpoolerNotify</b> with <i>ulFlags</i> set to NOTIFY_CRITSEC. Setting this flag informs the MAPI spooler that it should not call your <a href="inter042_250l.htm"><b>IXPLogon::Idle</b></a> and <a href="inter042_2fos.htm"><b>IXPLogon::Poll</b></a> methods. While you have a critical section open, return MAPI_E_BUSY whenever your <a href="inter024_6x2d.htm"><b>IMAPIStatus::ValidateState</b></a> method is called. When you have finished with the critical section, make another call to <b>SpoolerNotify</b> with <i>ulFlags</i> set to NOTIFY_NONCRIT.</p>
<p>
For example, if you are a remote transport provider in the process of uploading messages, you might need to allow a user to enter a telephone number for establishing the remote connection. Before looping through your dialog box procedure, declare a critical section. When the user closes the dialog box, terminating the dialog box procedure, release the critical section.</p>
<p>
When you set <i>ulFlags</i> to NOTIFY_CRITICAL_ERROR, the MAPI spooler makes no further calls to your provider except to release it. If you call <b>SpoolerNotify</b> with this flag set from <a href="inter042_1a1x.htm"><b>IXPLogon::StartMessage</b></a> or <a href="inter042_18v9.htm"><b>IXPLogon::SubmitMessage</b></a>, return with an appropriate error value from the <b>StartMessage </b>or<b> SubmitMessage </b>call immediately after the <b>SpoolerNotify</b> call. </p>
<p>
If you have recovered from a condition that previously caused you to fail, call <b>SpoolerNotify</b> with <i>ulFlags</i> set to NOTIFY_READYTOSEND. This flag indicates that you are again ready to handle messages. </p>
<h4>Notes to Message Store Providers</h4>
<p>
Call <b>SpoolerNotify</b>, passing the NOTIFY_READYTOSEND flag in <i>ulFlags</i>, before you make your first call to <a href="inter025_5q5w.htm"><b>IMAPISupport::PrepareSubmit</b></a> in <b>IMessage::SubmitMessage</b>. This call to <b>SpoolerNotify</b> only needs to be made once per session.</p>
<p>
If you are tightly coupled with a transport provider and you call <b>SpoolerNotify </b>with <i>ulFlags</i> set to NOTIFY_NEWMAIL_RECEIVED, the MAPI spooler opens the new message and begins processing the new message hook function. When processing is complete, the MAPI spooler calls your <a href="inter031_0x7w.htm"><b>IMsgStore::NotifyNewMail</b></a> method to inform you of your own new message.</p>
<p>
For more information about calling <b>SpoolerNotify</b>, see any of the following topics:</p>
<p>
<a href="xp_8h0k.htm">Implementing the FlushQueues Method</a></p>
<p>
<a href="xp_13n6.htm">Interacting with the MAPI Spooler</a></p>
<p>
<a href="xp_38h8.htm">Message Reception Model</a></p>
<h4>See Also</h4>
<p>
<a href="inter031_0x7w.htm"><b>IMsgStore::NotifyNewMail</b></a>, <a href="inter042_1a1x.htm"><b>IXPLogon::StartMessage</b></a>, <a href="inter042_18v9.htm"><b>IXPLogon::SubmitMessage</b></a></p>
<p>&nbsp;</p></body>
</HTML>
