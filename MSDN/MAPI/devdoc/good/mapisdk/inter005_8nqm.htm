<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IABProvider::Logon</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_iabprovider_logon"></a>IABProvider::Logon</h2>
<p>
The <b>IABProvider::Logon</b> method establishes a connection to an active session.</p>
<h4>Quick Info</h4>
<p>
See <a href="inter005_5wdq.htm"><b>IABProvider : IUnknown</b></a>.</p>
<pre><code><b>HRESULT Logon(
  LPMAPISUP</b><i> lpMAPISup</i><b>,</b>          
<b>  ULONG</b><i> ulUIParam</i><b>,</b>              
<b>  LPTSTR</b><i> lpszProfileName</i><b>,</b>       
<b>  ULONG</b><i> ulFlags</i><b>,</b>                
<b>  ULONG FAR *</b><i> lpulcbSecurity</i><b>,</b>   
<b>  LPBYTE FAR *</b><i> lppbSecurity</i><b>,</b>    
<b>  LPMAPIERROR FAR *</b><i> lppMAPIError</i><b>,</b>   
<b>  LPABLOGON FAR *</b><i> lppABLogon    </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>lpMAPISup</i></dt>
<dd>
[in] Pointer to the address book provider's support object.</dd>
<dt>
<i>ulUIParam</i></dt>
<dd>
[in] Handle of the parent window for the logon dialog box that <b>Logon</b> displays if permitted. The <i>ulUIParam</i> parameter contains the value of the parameter of the same name passed to MAPI in the preceding call to the <a href="function_8to8.htm"><b>MAPILogonEx</b></a> function. </dd>
<dt>
<i>lpszProfileName </i></dt>
<dd>
[in] Pointer to the name of the session profile.</dd>
<dt>
<i>ulFlags</i></dt>
<dd>
[in] Bitmask of flags that controls how the logon is performed. The following flags can be set:
<dl>
<dt>
AB_NO_DIALOG</dt>
<dd>
The provider should not display a dialog box during logon. If this flag is not set, the provider can display a dialog box to prompt the user for missing configuration information.</dd>
<dt>
MAPI_DEFERRED_ERRORS</dt>
<dd>
Allows <b>Logon</b> to return successfully, possibly before the logon process is complete. </dd>
<dt>
MAPI_UNICODE</dt>
<dd>
All strings should be in Unicode format. If the MAPI_UNICODE flag is not set, the strings should be in ANSI format.</dd>
</dl>
</dd>
<dt>
<i>lpulcbSecurity</i></dt>
<dd>
[in, out] Pointer to the size, in bytes, of the security credentials structure pointed to by the <i>lppbSecurity</i> parameter. On input, the value must be nonzero; on output, the value must be zero. In both cases the pointers must be valid.</dd>
<dt>
<i>lppbSecurity</i></dt>
<dd>
[in, out] Pointer to a pointer to security credentials. On input, the value must be nonzero; on output, the value must be zero. In both cases the pointer must be valid.</dd>
<dt>
<i>lppMAPIError</i></dt>
<dd>
[out] Pointer to a pointer to a <a href="structyp_0qpe.htm"><b>MAPIERROR</b></a> structure. The <i>lppMAPIError</i> parameter can be set to NULL if there is no <b>MAPIERROR</b> structure to return.</dd>
<dt>
<i>lppABLogon</i></dt>
<dd>
[out] Pointer to a pointer to the provider's logon object.
</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
S_OK</dt>
<dd>
A connection to an active session was successfully established.</dd>
<dt>
MAPI_E_FAILONEPROVIDER</dt>
<dd>
The provider cannot log on, but MAPI can continue to log on the other providers in the message service to which the provider belongs. </dd>
<dt>
MAPI_E_UNCONFIGURED</dt>
<dd>
The provider does not have enough information to complete the logon. MAPI calls the provider's message service entry function.</dd>
<dt>
MAPI_E_UNKNOWN_CPID</dt>
<dd>
The server is not configured to support the client's code page.</dd>
<dt>
MAPI_E_UNKNOWN_LCID</dt>
<dd>
The server is not configured to support the client's locale information.</dd>
<dt>
MAPI_E_USER_CANCEL</dt>
<dd>
The user canceled the operation, typically by clicking the <b>Cancel</b> button in the logon dialog box.
</dd>
</dl>
<h4>Remarks</h4>
<p>
Connections are established with each of the address book providers in the session profile when a client calls the <a href="inter023_01ij.htm"><b>IMAPISession::OpenAddressBook</b></a> method. <b>OpenAddressBook</b> then calls each provider's <b>IABProvider::Logon</b> method.</p>
<p>
The profile name pointed to by the <i>lpszProfileName</i> parameter is displayed in the character set of the user's client as indicated by the presence or absence of the MAPI_UNICODE flag in the <i>ulFlags</i> parameter.</p>
<h4>Notes to Implementers</h4>
<p>
In your implementation of<b> IABProvider::Logon</b>, call <a href="inter025_91no.htm"><b>IMAPISupport::SetProviderUID</b></a> to register a unique identifier, or <a href="structyp_3p9g.htm"><b>MAPIUID</b></a>. Each of your objects will have an entry identifier that includes this <b>MAPIUID</b>. MAPI uses the <b>MAPIUID</b> to match an object with its provider. For example, when a client calls <b>IMAPISession::OpenEntry</b> to open a messaging user, <b>OpenEntry</b> examines the <b>MAPIUID</b> portion of the entry identifier passed in and matches it with a <b>MAPIUID</b> registered by an address book provider.</p>
<p>
If a client logs on to your provider more than once, you may choose to register a different <b>MAPIUID </b>for each logon. Registering unique <b>MAPIUID</b>s enables MAPI to correctly route requests to the appropriate provider instance. However, you may choose to have every logon object share one <b>MAPIUID</b>. In this case, you must be able to handle the routing yourself rather than relying on MAPI. For more information on creating one or more <b>MAPIUID</b>s, see <a href="provider_57cj.htm">Registering Service Provider Unique Identifiers</a>.</p>
<p>
The support object that MAPI passes to your <b>IABProvider::Logon</b> method in the <i>lpMAPISup</i> parameter provides access to many of the methods included in the <a href="inter025_8uge.htm"><b>IMAPISupport</b></a> interface. MAPI creates a support object specially tailored to your type of provider. For example, if you need to log on to an underlying messaging system or directory service when you establish your connection, you can call <a href="inter025_6rvy.htm"><b>IMAPISupport::OpenProfileSection</b></a> to retrieve security credentials for this particular logon session.</p>
<p>
If <b>IABProvider::Logon</b> is successful, be sure to call the support object's <b>IUnknown::AddRef</b> method to increment its reference count. This allows your provider to hold onto the support object pointer for the remainder of the session. If you do not call this <b>AddRef</b> method, MAPI will unload your provider.</p>
<p>
You can include the profile name passed in the <i>lpszProfileName</i> parameter in error dialog boxes, logon screens, or other user interfaces. To use the profile name, copy it to storage that you have allocated. </p>
<p>
Create a logon object and return a pointer to it in the <i>lppABLogon</i> parameter. MAPI uses this logon object to make calls to the methods in your <b>IABLogon</b> implementation.</p>
<p>
If you require a password during logon, display a logon dialog box only if the AB_NO_DIALOG flag is not set. If the user cancels the logon process, typically by clicking the <b>Cancel</b> button in the dialog box, return MAPI_E_USER_CANCEL from <b>Logon</b>.</p>
<p>
Typically, when an address book provider cannot log on, MAPI disables the message service to which the failing provider belongs. That is, MAPI will not try to establish connections for any of the other providers belonging to the service for the rest of the session's lifetime. However, if your provider fails to establish a connection and you wish not to disable the entire service, return either MAPI_E_FAILONEPROVIDER or MAPI_E_UNCONFIGURED. MAPI will not disable the message service to which the provider belongs. </p>
<p>
Return MAPI_E_FAILONEPROVIDER if an error occurs that is not serious enough to prevent the other providers in the message service from establishing connections. Return MAPI_E_UNCONFIGURED if necessary configuration information is missing from the profile and you cannot display a dialog box to prompt the user. MAPI will respond by calling your provider's message service entry point function with MSG_SERVICE_CONFIGURE set as the <i>ulContext</i> parameter to give the service a chance to configure itself, either programmatically or using a property sheet. When the message service entry point function has finished, MAPI retries the logon. </p>
<h4>See Also</h4>
<p>
<a href="inter004_44ti.htm"><b>IABLogon::Logoff</b></a>, <a href="inter004_422h.htm"><b>IABLogon::OpenEntry</b></a>, <a href="inter025_6rvy.htm"><b>IMAPISupport::OpenProfileSection</b></a>, <a href="inter025_91no.htm"><b>IMAPISupport::SetProviderUID</b></a>, <a href="function_7nnd.htm"><b>MSGSERVICEENTRY</b></a></p>
<p>&nbsp;</p></body>
</HTML>
