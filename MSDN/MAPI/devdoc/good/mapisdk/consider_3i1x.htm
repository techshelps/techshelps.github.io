<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Resolving a Name</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_resolving_a_name"></a>Resolving a Name</h2>
<p>
When a message is addressed, a recipient list is built with properties relating to each recipient. By the time the message is sent, one of those properties must be the recipient's long-term entry identifier. To ensure that each recipient includes the <a href="propa_8cv8.htm">PR_ENTRYID</a> property, pass the <a href="structyp_87n8.htm"><b>ADRLIST</b></a> structure describing your recipient list in the contents of the <i>lpAdrList</i> parameter in a call to <a href="inter006_64v9.htm"><b>IAddrBook::ResolveName</b></a>.</p>
<p>
<b>ResolveName</b> begins processing by ignoring the entries in the <b>ADRLIST</b> structure that have already been resolved, as indicated by the presence of an entry identifier in the corresponding <a href="structyp_6m49.htm"><b>ADRENTRY</b></a> structure's <b>SPropValue</b> array. Next, <b>ResolveName</b> automatically assigns one-off entry identifiers to two types of recipients:
<ul>
<li>
Recipients with an address formatted as an Internet address</li>
<li>
Recipients with an address formatted as follows: <pre><code>displayname[address type:e-mail address]
 </code></pre>
</li>
</ul>
<p>
For all remaining entries, <b>ResolveName</b> searches the address book for an exact match on the display name. <b>ResolveName</b> uses the <a href="propa_0grs.htm">PR_AB_SEARCH_PATH</a> property to determine the set of containers to search and the search order. MAPI calls the <a href="inter003_0ss3.htm"><b>IABContainer::ResolveNames</b></a> method of every container to attempt to resolve all of the names. Because some containers do not support <b>ResolveNames</b>, if the container returns MAPI_E_NO_SUPPORT, MAPI applies a <a href="propa_1gtu.htm">PR_ANR</a> property restriction against its contents table. All address book containers are required to support name resolution with this restriction. Once all the names are resolved, no further container calls are made. If all the containers have been called, but ambiguous or unresolved names remain, MAPI displays a dialog box if possible to prompt the user to resolve the remaining names.</p>
<p>
The PR_ANR restriction matches the value of the PR_ANR property against the display name in the <b>ADRLIST</b> structure. Limiting the view of a container's contents table with the PR_ANR property restriction causes the address book provider to perform a "best guess" type of search, matching against the property that makes sense for the provider. For example, one address book provider might always match names in the recipient list against PR_DISPLAY_NAME while another might allow an administrator to select the property.</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To set a PR_ANR property restriction on an address book container's contents table</h5>
<ol>
<li>
Create an <a href="structyp_45ny.htm"><b>SRestriction</b></a> structure as shown in the following code:<pre><code>SRestriction SRestrict;

SRestrict.rt = RES_PROPERTY;
SRestrict.res.resProperty.relop = RELOP_EQ;
SRestrict.res.resProperty.ulPropTag = PR_ANR;
SRestrict.res.resProperty.lpProp-&gt;ulPropTag = PR_ANR;
SRestrict.res.resProperty.lpProp-&gt;Value.LPSZ = lpszName;
 </code></pre>
</li>
<li>
Call the contents table's <a href="inter026_43lg.htm"><b>IMAPITable::Restrict</b></a><b> </b>method, passing the <b>SRestriction</b> structure as the <i>lpRestriction </i>parameter.</li>
</ol>
<p>&nbsp;</p></body>
</HTML>
