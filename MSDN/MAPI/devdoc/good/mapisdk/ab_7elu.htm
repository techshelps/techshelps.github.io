<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Acting as a Host Address Book Provider</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_acting_as_a_host_address_book_provider"></a>Acting as a Host Address Book Provider</h2>
<p>
A host provider is an address book provider that includes recipients from other providers in its containers and relies on the implementation of the recipients by the other providers to partially control their maintenance. A host provider uses the template identifiers of these foreign recipients to bind the data for these recipients to code in the foreign provider. This binding process is initiated when your provider retrieves the <a href="propb_8810.htm">PR_TEMPLATEID</a> property of a recipient and passes it in a call to <a href="inter025_8aec.htm"><b>IMAPISupport::OpenTemplateID</b></a>.  </p>
<p>
When your provider calls <b>IMAPISupport::OpenTemplateID</b>, MAPI matches the <b>MAPIUID</b> within the template identifier with a <b>MAPIUID</b> registered by a provider and calls the provider's <a href="inter004_5j1g.htm"><b>IABLogon::OpenTemplateID</b></a> method. The foreign provider might return a pointer to your provider's property object or its own property object implementation, an implementation that wraps your provider's object. The returned pointer is placed in the contents of the <i>lppMAPIPropNew</i> parameter.</p>
<p>
Your provider can choose whether or not to call <b>IMAPISupport::OpenTemplateID</b> with the FILL_ENTRY flag set. Set this flag when the recipient is being created or when a long time has passed since your provider has refreshed the recipient's properties. A common use of the FILL_ENTRY flag is to keep a recipient in your provider synchronized with the original. Implementing this type of synchronization schedule enhances performance. </p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To keep a foreign recipient synchronized</h5>
<ol>
<li>
Determine an appropriate interval for periodic updates. </li>
<li>
Timestamp each call to <a href="inter025_8aec.htm"><b>IMAPISupport::OpenTemplateID</b></a>. </li>
<li>
Evaluate whether or not it is necessary to perform a full update based on the amount of time that has expired since the last call. If a full update is necessary, call <b>IMAPISupport::OpenTemplateID</b> with the FILL_ENTRY flag. If it is not necessary, do not set the flag on the call.</li>
</ol>
<p>
</p>
<p>
When a client makes a request for one of the copied recipient's properties, your provider can choose whether to handle the request itself or use the code supplied by the foreign provider. Your provider can expect the foreign provider to intercept most, if not all, calls to <b>IMAPIProp</b> except for <b>IMAPIProp::OpenProperty</b>. A call to <b>OpenProperty</b> requesting the PR_DETAILS_TABLE property is always forwarded to your provider.</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To access template identifier code</h5>
<ol>
<li>
Open the recipient and call its<b> <a href="inter022_44c3.htm">IMAPIProp::GetProps</a></b> method to retrieve the <a href="propb_8810.htm">PR_TEMPLATEID</a> property. If <b>GetProps</b> fails because PR_TEMPLATEID is unavailable, the foreign provider does not support a template identifier and related code for this recipient. Your provider will need to use its implementation of the recipient for all maintenance.</li>
<li>
If the template identifier is returned from <b>GetProps</b>, pass it and a pointer to the recipient's <b>IMAPIProp</b> implementation in a call to the <a href="inter025_8aec.htm"><b>IMAPISupport::OpenTemplateID</b></a> method. Set the FILL_ENTRY flag if most or all of the recipient's properties need to be updated, such as at creation time or if they have not been updated for a while.</li>
<li>
If <b>OpenTemplateID</b> returns the foreign provider's <b>IMAPIProp</b> implementation, return to the client a pointer to this implementation. </li>
<li>
If <b>OpenTemplateID</b> does not return an implementation, typically because the foreign provider is not in the profile, return to the client a pointer to your provider's <b>IMAPIProp</b> implementation. The client should be able to work with the object's properties using either interface. </li>
</ol>
<p>
</p>
<p>&nbsp;</p></body>
</HTML>
