<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Opening a Message Store</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_opening_a_message_store"></a>Opening a Message Store</h2>
<p>
Depending on the profile, a client will need to open one or more message stores during a typical session. Opening a message store means gaining access to a pointer to its <b>IMsgStore</b> implementation. The <a href="inter031_1jg0.htm"><b>IMsgStore</b></a> interface provides methods for notification, making folder assignments, and accessing folders and messages. </p>
<p>
Clients open message stores at logon and when a profile is being modified. If your client allows users to add message stores to the profile during an active session, you can either open them immediately or ignore them until the next session. By registering for notifications on the message store table, you will be alerted to the availability of a new message store.</p>
<p>
To open a message store, you must have its entry identifier available. Most clients access the entry identifiers for the message stores they wish to open through the message store table. However, some message stores document the format of their entry identifiers, thereby allowing clients to bypass the message store table and construct the necessary entry identifier. They can pass this entry identifier directly to <b>IMAPISession::OpenMsgStore</b> and MAPI automatically creates a profile section for the provider without associating it with any message service.</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To retrieve an entry identifier from the message store table</h5>
<ol>
<li>
Call <a href="inter023_9f8l.htm"><b>IMAPISession::GetMsgStoresTable</b></a> to open the message store table.</li>
<li>
Call <a href="inter026_7x83.htm"><b>IMAPITable::SetColumns</b></a><b> </b>to limit the table to a small column set that includes the following columns:<p class=indent1>
PR_PROVIDER_DISPLAY or PR_DISPLAY_NAME</p>
<p class=indent1>
PR_ENTRYID properties</p>
<p class=indent1>
PR_MDB_PROVIDER</p>
<p class=indent1>
PR_RESOURCE_FLAGS</p>
</li>
<li>
Build a restriction to filter out the row that represents the message store to be opened. To look for the default message store, see <a href="consider_77j9.htm">Opening the Default Message Store</a>. To look for a message store by name, apply any of the following property restrictions:<ul>
<li>
Match <a href="propb_9aux.htm">PR_PROVIDER_DISPLAY</a> with the general name for this type of message store. For example, PR_PROVIDER_DISPLAY might be set to "Personal Folders."</li>
<li>
Match <a href="propa_7whe.htm">PR_MDB_PROVIDER</a> with the specific name for this type of message store. For example, PR_MDB_PROVIDER might be set to "Microsoft Exchange Personal Folders."</li>
<li>
Match <a href="propa_1yjp.htm">PR_DISPLAY_NAME</a> with the name for this particular message store. For example, PR_DISPLAY_NAME might be set to "My Messages for Fiscal Year 1995."</li>
</ul>
</li>
<li>
Call <a href="function_0dgz.htm"><b>HrQueryAllRows</b></a> to retrieve the appropriate row from the message store table. The entry identifier for the row will be included in the property value array for the <b>aRow</b> member of the row set pointed to by the <i>pprows</i> parameter.</li>
<li>
Call <a href="function_3wkz.htm"><b>FreePRows</b></a> to free the row set pointed to by <i>pprows</i>.</li>
<li>
Release the message store table by calling its<b> IUnknown::Release</b> method. </li>
</ol>
<p>
If you have created a custom entry identifier for the message store to be opened, call the <a href="function_7z8k.htm"><b>WrapStoreEntryID</b></a> function to convert it to a standard entry identifier.</p>
<p>
Once you have a message store's entry identifier, call one of the following methods to open it:</p>
<p class=indent1>
<a href="inter023_59id.htm"><b>IMAPISession::OpenMsgStore</b></a> </p>
<p class=indent1>
<a href="inter023_146x.htm"><b>IMAPISession::OpenEntry</b></a> </p>
<p>
Call <b>OpenMsgStore</b> if you need to specify a variety of special options for the message store. <b>OpenMsgStore</b> allows you to suppress the display of dialog boxes, identify the message store as temporary or as a nonmessaging store, set access levels, and to defer errors. <b>OpenEntry</b> allows you only to set access levels and defer errors.</p>
<p>
Setting the MDB_NO_MAIL flag indicates to MAPI that the message store will not be used for sending or receiving messages. MAPI does not inform the MAPI spooler about the existence of this message store. The MDB_TEMPORARY flag designates a message store as temporary, implying that it cannot be used to store permanent information. Temporary message stores do not appear in the message store table. </p>
<p>&nbsp;</p></body>
</HTML>
