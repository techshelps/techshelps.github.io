<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Implementing a Control Object</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_mapi1book_implementing_a_control_object"></a>Implementing a Control Object</h1>
<p>
Control objects, or objects that support the <a href="inter012_4lym.htm"><b>IMAPIControl</b></a> interface, are implemented by providers to add functionality to a button that appears on a MAPI dialog box. Control objects can only be implemented for buttons.</p>
<p>
<b>IMAPIControl</b> has three methods: <b>GetLastError</b>, <b>GetState</b>, and <b>Activate</b>. </p>
<p>
MAPI calls <b>IMAPIControl::GetState </b>to determine whether or not to disable the button. <b>GetState</b> is called:
<ul>
<li>
When the dialog box on which the button appears is first displayed.</li>
<li>
When a display table notification is issued for the button. </li>
</ul>
<p>
</p>
<p>
Set the contents of the <i>lpulState</i> parameter to MAPI_DISABLED if the user cannot interact with the button and MAPI_ENABLED if the user can interact. </p>
<p>
When the user clicks the button, MAPI calls <b>Activate</b>. <b>Activate</b> performs the task that has been associated with the button. This task can be anything appropriate for your provider, such as displaying a dialog box or updating a property. If the task is unsuccessful because the user has canceled it, return MAPI_E_USER_CANCEL. With other causes of failure, return the appropriate error value. </p>
<p>
If the task is successful and it is linked to a property change that is reflected in another control on the dialog box, call <a href="inter040_4hyx.htm"><b>ITableData::HrNotify</b></a>. <b>HrNotify</b> is called to issue a display table notification with the changed property's PR_CONTROL_ID in the <a href="structyp_65o0.htm"><b>TABLE_NOTIFICATION</b></a> structure. Do not place the new property value in the structure; return it instead when <b>IMAPIProp::GetProps</b> is called. Although typically a display table notification cannot be used to disable or enable a control, it can be used with a button. MAPI will refresh the changed control to respond to the notification. </p>
<p>
MAPI calls the control's <b>GetLastError</b> method when <b>Activate</b> returns an error other than MAPI_E_USER_CANCEL. If <b>GetLastError</b> places extended error information in the <b>MAPIERROR</b> structure that it returns in the contents of the <i>lppMAPIError</i> parameter, MAPI displays it for the user.</p>
<p>&nbsp;</p></body>
</HTML>
