<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Allocating and Freeing Memory</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_allocating_and_freeing_memory"></a>Allocating and Freeing Memory</h2>
<p>
In addition to specifying how to allocate and free memory, MAPI defines a model for knowing when memory passed between public interface method and API function calls should be freed. The model applies only to memory allocated for parameters that are not pointers to interfaces, such as strings and pointers to structures. Interface pointers use the reference counting mechanism implemented through <b>IUnknown</b>. When allocating and freeing non-MAPI related memory internally within a client application or service provider, use whatever mechanism makes sense. </p>
<p>
The model defines parameters as one of three types. They can be input parameters, set by the caller with information to be used by the called function or method, output parameters, set by the called function or method and returned to the caller, or input-output parameters, a combination of the two types. Output parameters are frequently pointers to data or pointers to pointers to data. Although the called function is responsible for allocating the data for output parameters, the caller allocates the memory for the pointer. </p>
<p>
The rules for allocating and releasing memory for these types of parameters are explained in the following table.</p>
<table cellspacing=4 cols=3>
<tr valign=top>
<th align=left width=16%>Type</th>
<th align=left width=44%>Memory allocation</th>
<th align=left width=40%>Memory release</th>
</tr>
<tr valign=top>
<td width=16%>Input</td>
<td width=44%>Caller is responsible and can use any mechanism.</td>
<td width=40%>Caller is responsible and can use any mechanism.</td>
</tr>
<tr valign=top>
<td width=16%>Output</td>
<td width=44%>Called function is responsible and must use <a href="function_8z3m.htm"><b>MAPIAllocateBuffer</b></a>.</td>
<td width=40%>Caller is responsible and must use <a href="function_85yq.htm"><b>MAPIFreeBuffer</b></a>.</td>
</tr>
<tr valign=top>
<td width=16%>Input-output</td>
<td width=44%>Caller is responsible for the initial allocation and called function can reallocate if necessary using <b>MAPIAllocateBuffer</b>.</td>
<td width=40%>Called function is responsible for initial freeing if reallocation is necessary. Caller must free the final return value.</td>
</tr>
</table><br>
<p>
During failure conditions, implementers of interface methods need to pay attention to output and input-output parameters since the caller generally has no way to clean them up. If an error is returned, then each output or input-output parameter must either be left at the value initialized by the caller or set to a value that can be cleaned up without any action on the part of the caller. For example, an output pointer-parameter of <code>void ** ppv</code><b> </b>must be left as it was on input or can be set to NULL (<code>*ppv = NULL</code>).</p>
<p>&nbsp;</p></body>
</HTML>
