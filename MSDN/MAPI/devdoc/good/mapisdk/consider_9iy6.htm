<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Logging On</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_mapi1book_logging_on"></a>Logging On</h3>
<p>
Client applications log on to the MAPI subsystem by calling the <a href="function_8to8.htm"><b>MAPILogonEx</b></a> function. <b>MAPILogonEx</b> validates the profile selection and the configuration of each service provider in the profile. Once configured, MAPI starts the address book providers before starting the message store providers. Transport providers are started when their services are first required. </p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To choose a profile</h5>
<ul>
<li>
Pass in a character string that represents the name of the profile in the <i>lpszProfileName</i> parameter to <b>MAPILogonEx</b>.<p>
– Or –
</li>
<li>
Allow the user to enter the profile by passing NULL in the <i>lpszProfileName</i> parameter and setting the MAPI_LOGON_UI flag.<p>
– Or –
</li>
<li>
Select the default profile by passing NULL in the <i>lpszProfileName</i> parameter and setting the MAPI_EXPLICIT_PROFILE flag.</li>
</ul>
<p>
If you require a specific profile other than the default profile, you must save its name in your own configuration database or use a specific naming convention. MAPI does not expose any profile attributes other than the name and default flag in the profile table, and the default profile flag is reserved for messaging client and related IPM applications.</p>
<p>
If the selected profile requires a password, you can specify it in one of two ways.</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To specify a password</h5>
<ul>
<li>
Pass in a character string that represents the password in the <i>lpszPassword</i> parameter.<p>
– Or –
</li>
<li>
Allow the user to enter the password by passing NULL in the <i>lpszProfileName</i> parameter and setting the MAPI_PASSWORD_UI flag.</li>
</ul>
<p>
Clients that supply partial profile, password, or provider configuration information to <a href="function_8to8.htm"><b>MAPILogonEx</b></a> must prompt the user for the additional data by allowing a dialog box to be displayed. If information is missing and <b>MAPILogonEx</b> cannot prompt the user to supply it, the logon fails. Clients that do not need user input can suppress the dialog box display. </p>
<p>
The flags that <b>MAPILogonEx</b> uses to enable a user interface are mutually exclusive; only one can be set. Leaving these flags unset suppresses the display of a user interface, causing <b>MAPILogonEx</b> to fail if necessary information is missing. That is, if you disable the user interface and pass NULL for the <i>lpszProfileName</i> parameter and do not set the MAPI_EXPLICIT_PROFILE flag, <b>MAPILogonEx</b> will fail because it cannot retrieve a profile name. </p>
<p>
The session that <b>MAPILogonEx</b> establishes can be an individual messaging session, a shared messaging session, or a nonmessaging session. Individual messaging sessions are private connections between your client and the MAPI subsystem and can be established by setting the MAPI_NEW_SESSION flag in the call to <b>MAPILogonEx</b>.</p>
<p>
Shared messaging sessions are connections that multiple messaging clients can use. Shared sessions are typically established for clients that are members of a workgroup and use the same profile. To establish a new session as a shared session, set the MAPI_ALLOW_OTHERS flag. </p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To use an existing shared session</h5>
<ul>
<li>
Do not set the MAPI_NEW_SESSION flag.</li>
<li>
Do not set the MAPI_ALLOW_OTHERS flag.</li>
<li>
Pass NULL for the <i>lpszProfileName</i> parameter.</li>
<li>
Pass NULL for the <i>lpszPassword</i> parameter.</li>
</ul>
<p>
Nonmessaging sessions allow clients to access the MAPI subsystem, but do not allow messages to be sent or received. Configuration or administration applications are examples of clients that might need to establish nonmessaging sessions. To request a nonmessaging session, set the MAPI_NO_MAIL flag. Setting this flag logs your client on without informing the MAPI spooler. Clients that log on to MAPI with this flag cannot expect to ever receive read status reports.</p>
<p>
The MAPI_NO_MAIL flag should only be set:
<ul>
<li>
If your client will not send or receive messages during the session.</li>
<li>
If your client has complete control over the contents of the profile and messages are sent and received using only the Microsoft Exchange default message store and transport providers. </li>
</ul>
<p>
A messaging client can share a session with a nonmessaging client. The characteristics of one member of a shared session are not affected by the characteristics of other members. That is, if you log on with the MAPI_NO_MAIL and MAPI_ALLOW_OTHERS flags set, a messaging client logging on to your session has no affect on the operation of your client and vice versa. The messaging client will still be able to send and receive messages and your client will not.</p>
<p>
<b>MAPILogonEx</b> defines a few other flags that you can set: 
<ul>
<li>
MAPI_FORCE_DOWNLOAD indicates that incoming messages should be downloaded before <b>MAPILogonEx</b> returns. Not setting this flag causes messages to be downloaded in the background at a later time.</li>
<li>
MAPI_SERVICE_UI_ALWAYS requests that every message service in the profile display a configuration dialog box.</li>
<li>
MAPI_NT_SERVICE indicates that your client is implemented as a Windows NT service. This flag must be set if your client is a service.</li>
</ul>
<p>
With every successful logon, <b>MAPILogonEx</b> returns a pointer to a MAPI session. You can use this pointer to call the methods of the <a href="inter023_64ry.htm"><b>IMAPISession</b></a> interface. Session pointers, regardless of the type of session, are unique to the clients that receive them and are not valid across tasks.</p>
<p>&nbsp;</p></body>
</HTML>
