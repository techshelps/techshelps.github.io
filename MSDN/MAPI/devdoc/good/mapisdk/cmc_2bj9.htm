<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Receiving a Message: CMC Sample</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_receiving_a_message_cmc_sample"></a>Receiving a Message: CMC Sample</h2>
<p>
The following code example demonstrates how you can list, retrieve, and delete the first unread message in the Inbox.</p>
<pre><code>/* Local variables used */

CMC_message_summary     *pMsgSummary;
CMC_message             *pMessage;
CMC_uint32              iCount;
CMC_session_id          Session;
CMC_return_code         Status;

/* Read the first unread message and delete it. */

iCount  = 5; /* Maximum number of messages to get summary info about. */

Status = cmc_list(
              Session,               /* Session handle                */
              NULL,                  /* List ALL message types.       */
              CMC_LIST_UNREAD_ONLY,  /* Get only unread messages.     */
              NULL,                  /* Starting at the top           */
              &amp;iCount,               /* Input/output message count    */
              0,                     /* No UI will be used.           */
              &amp;pMsgSummary,          /* Return message summary list.  */
              NULL);                 /* No extensions                 */
    /* Error handling */

Status = cmc_read(
              Session,                            /* Session ID       */
              pMsgSummary-&gt;message_reference,     /* Message to read  */
              CMC_MSG_AND_ATT_HDRS_ONLY,    /* Don't get attach files.*/
              &amp;pMessage,                          /* Returned message */
              0,                                  /* No UI            */
              NULL);                              /* No extensions    */
    /* Error handling */

Status = cmc_act_on(
              Session,                           /* Session ID        */
              pMsgSummary-&gt;message_reference,    /* Message to delete */
              CMC_ACT_ON_DELETE,                 /* Message to read   */
              0,                                 /* No flags          */
              0,                                 /* No UI             */
              NULL);                             /* No extensions     */
    /* Error handling */

/* Free the memory returned by the implementation. */

Status = cmc_free(pMsgSummary);
Status = cmc_free(pMessage);


/* Do the same thing without the list call, because the read call can 
   get the first unread message. */

Status = cmc_read(
             Session,                  /* Session ID                  */
             NULL,                     /* Read the first message.     */
             CMC_READ_FIRST_UNREAD_MESSAGE | /* Get first unread msg. */
             CMC_MSG_AND_ATT_HDRS_ONLY,/* Don't get attach files.     */
             &amp;pMessage,                /* Returned message            */
             0,                        /* No UI                       */
             NULL);                    /* No extensions               */
    /* Error handling */

Status = cmc_act_on(
              Session,                           /* Session ID        */
              pMessage-&gt;message_reference,       /* Message to delete */
              CMC_ACT_ON_DELETE,                 /* Message to read   */
              0,                                 /* No flags          */
              0,                                 /* No UI             */
              NULL);                             /* No extensions     */
    /* Error handling */

/* Free the memory returned by the implementation. */

Status = cmc_free(pMessage);
 </code></pre>
<p>&nbsp;</p></body>
</HTML>
