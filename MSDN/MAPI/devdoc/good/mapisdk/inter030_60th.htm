<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IMsgServiceAdmin::CreateMsgService</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_imsgserviceadmin_createmsgservice"></a>IMsgServiceAdmin::CreateMsgService</h2>
<p>
The <b>IMsgServiceAdmin::CreateMsgService</b> method adds a message service to the current profile.</p>
<h4>Quick Info</h4>
<p>
See <a href="inter030_7bxq.htm"><b>IMsgServiceAdmin : IUnknown</b></a>.</p>
<pre><code><b>HRESULT CreateMsgService(
  LPTSTR</b><i> lpszService</i><b>,</b>   
<b>  LPTSTR</b><i> lpszDisplayName</i><b>,</b>   
<b>  ULONG</b><i> ulUIParam</i><b>,</b>      
<b>  ULONG</b><i> ulFlags         </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>lpszService</i></dt>
<dd>
[in] Pointer to the name of the message service to add. This message service name must appear in the <b>[Services]</b> section of the MAPISVC.INF file.</dd>
<dt>
<i>lpszDisplayName</i></dt>
<dd>
[in] Pointer to the display name of the message service to add. The <i>lpszDisplayName</i> parameter is ignored if the message service has set <a href="propa_1yjp.htm">PR_DISPLAY_NAME</a>  in the MAPISVC.INF file.</dd>
<dt>
<i>ulUIParam</i></dt>
<dd>
[in] Handle of the parent window for any dialog boxes or windows this method displays.</dd>
<dt>
<i>ulFlags</i></dt>
<dd>
[in] Bitmask of flags that controls how the message service is installed. The following flags can be set:
<dl>
<dt>
MAPI_UNICODE</dt>
<dd>
The names are in Unicode format. If the MAPI_UNICODE flag is not set, the names are in ANSI format.</dd>
<dt>
SERVICE_UI_ALLOWED</dt>
<dd>
Allows the display of the message service's configuration property sheet only if the service is not completely configured.
</dd>
</dl>
</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
S_OK</dt>
<dd>
The call succeeded and has returned the expected value or values.</dd>
<dt>
MAPI_E_NOT_FOUND</dt>
<dd>
The message service name is not in the <b>[Services]</b> section of MAPISVC.INF.
</dd>
</dl>
<h4>Remarks</h4>
<p>
The <b>IMsgServiceAdmin::CreateMsgService</b> method adds a message service to the current profile. <b>CreateMsgService</b> calls the message service's entry point function to perform any service-specific configuration tasks. If the SERVICE_UI_ALLOWED flag is set in the <i>ulFlags</i> parameter, the message service being installed can display a property sheet to enable the user to configure its settings. </p>
<p>
The list of providers that make up a message service and the properties for each are contained within the MAPISVC.INF file. <b>CreateMsgService</b> first creates a new profile section for the message service and then copies all of the information for that service from the MAPISVC.INF file into the profile, creating new sections for each provider. </p>
<p>
After all the information has been copied from MAPISVC.INF, the message service's entry point function is called with the MSG_SERVICE_CREATE value set in the <i>ulContext</i> parameter. If the SERVICE_UI_ALLOWED flag is set in the <b>CreateMsgService </b>method's <i>ulFlags</i> parameter, then the values in the <b>CreateMsgService</b> <i>ulUIParam</i> and <i>ulFlags</i> parameters are also passed when the message service's entry point function is called. Service providers should display their configuration property sheets so users can configure the message service. </p>
<h4>Notes to Callers</h4>
<p>
<b>CreateMsgService</b> does not return the <a href="structyp_3p9g.htm"><b>MAPIUID</b></a> for the message service added to the profile. </p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To retrieve the MAPIUID for the created message service</h5>
<ol>
<li>
Call <a href="inter030_4did.htm"><b>IMsgServiceAdmin::GetMsgServiceTable</b></a> to get the message service administration table. </li>
<li>
Locate the row that represents the message service by placing a restriction on the table that matches the <a href="propb_18yt.htm">PR_SERVICE_NAME</a> property with the name of the message service. </li>
<li>
Retrieve the service's <a href="propb_357o.htm">PR_SERVICE_UID</a> property. </li>
<li>
Pass the value of the PR_SERVICE_UID property in the <i>lpUid</i> parameter to <a href="inter030_4cv9.htm"><b>IMsgServiceAdmin::ConfigureMsgService</b></a> to configure the service.</li>
</ol>
<p>&nbsp;</p></body>
</HTML>
