<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Handling an Incoming Message</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_mapi1book_handling_an_incoming_message"></a>Handling an Incoming Message</h1>
<p>
An incoming message is a message that has been sent across one or more messaging systems. It may have been sent only to you or to many other recipients. Incoming messages are placed in a receive folder designated to hold messages of a particular class. You can set up a different receive folder for each message class that you handle or use one folder for all of the classes. </p>
<p>
If you have registered for new mail notifications with the message store, you will be notified whenever a message is placed in a receive folder. If you have not registered for new mail notifications, you must open the appropriate receive folder periodically to manually check for the arrival of new messages.</p>
<p>
Clients register for new mail notifications by setting the parameters to <a href="inter031_43l1.htm"><b>IMsgStore::Advise</b></a><b> </b>as follows: 
<ul>
<li>
Set <i>cbEntryID</i> to 0.</li>
<li>
Set <i>lpEntryID</i> to NULL.</li>
<li>
Set<i> ulEventMask </i>to<i> </i>fnevNewMail.</li>
</ul>
<p>
The <i>lpNotifications</i> parameter in the call to your <a href="inter010_4y2h.htm"><b>IMAPIAdviseSink::OnNotify</b></a><b> </b>method points to a <a href="structyp_51ny.htm"><b>NEWMAIL_NOTIFICATION</b></a> structure that contains information about the incoming message, such as its message class, its entry identifier, the entry identifier of its parent folder, and the contents of its <a href="propa_95wz.htm">PR_MESSAGE_FLAGS</a> property. For more information about registering for and handling notifications, see <a href="consider_4nw3.htm">Handling Notifications</a>. </p>
<p>
Before displaying an incoming message to a user, determine if its message class is a class that your client supports. If not, ignore the message. If the class is one that you support, you can open and display the message with a form that is appropriate for the message class of the message. The choice of forms is based on message class. Messages that belong to the IPM class use a default form implemented by MAPI. Messages that belong to custom classes defined by clients can use either client-defined specialized forms or the MAPI default form.</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To open and display an incoming message</h5>
<ol>
<li>
Call <a href="inter031_7acy.htm"><b>IMsgStore::GetReceiveFolder</b></a> to retrieve the entry identifier of the receive folder for the message class of the message and pass this entry identifier to <a href="inter031_3se1.htm"><b>IMsgStore::OpenEntry</b></a> to open the folder. See <a href="consider_4wqa.htm">Opening a Folder</a> for more information.</li>
<li>
Call the receive folder's <a href="inter011_0sx1.htm"><b>IMAPIContainer::GetContentsTable</b></a> method to retrieve its contents table. Call the table's <a href="inter026_7wkz.htm"><b>IMAPITable::QueryRows</b></a> method to retrieve all the rows in the table. For more information about contents tables in general, see <a href="tables_9i9f.htm">Contents Tables</a>. For more information about displaying a contents table, see <a href="consider_3aw5.htm">Displaying a Folder Contents Table</a>.</li>
<li>
If your client is interactive, allow the user to select a message from the table and determine the form to be used to display that message. Clients can use the default form provided by MAPI or a custom form. For more information, see <a href="consider_8cs3.htm">Handling MAPI Forms</a>.</li>
<li>
Call <b>IMsgStore::OpenEntry</b> to open the message. For more information, see <a href="consider_39np.htm">Opening a Message</a>.</li>
<li>
Process the message text. See <a href="consider_8h6c.htm">Opening Message Text</a>.</li>
<li>
Render each of the message attachments. See <a href="consider_3ib8.htm">Rendering an Attachment in Plain Text</a> or <a href="consider_99is.htm">Rendering an Attachment in Formatted Text</a>.</li>
<li>
Open an attachment if desired. See <a href="consider_6hh0.htm">Opening an Attachment</a>.</li>
</ol>
<p>&nbsp;</p></body>
</HTML>
