<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Receiving Messages with TNEF Custom Attachment Processing</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_mapi1book_receiving_messages_with_tnef_custom_attachment_processing"></a>Receiving Messages with TNEF Custom Attachment Processing</h3>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To receive a TNEF message with customized attachment processing</h5>
<ol>
<li>
Import all the transmittable properties — those that the messaging system supports — from the incoming message into a new MAPI message. This includes the message text, which contains the TNEF data stream.</li>
<li>
Identify and decode the special attachment that contains the TNEF stream.</li>
<li>
Extract all the attachments from the incoming message into MAPI attachments on the new MAPI message. The recovered filenames, or other identifying markers on the attachments, should be placed into the <a href="propa_88px.htm">PR_ATTACH_TRANSPORT_NAME</a> property of the new attachments so that the <b>ExtractProps</b> method can later associate the correct attachment with the attachment tags encoded in the message text.</li>
<li>
Create an OLE <b>IStream</b> object to wrap around the decoded TNEF stream and use that object along with the new MAPI message in a call to the <a href="function_3qk8.htm"><b>OpenTnefStreamEx</b></a> function.</li>
<li>
Call the <a href="inter041_44c3.htm"><b>ITnef::ExtractProps</b></a> method to recover the nontransmittable properties on the message from the TNEF data stream.</li>
<li>
Call the <a href="inter041_4k8p.htm"><b>ITnef::OpenTaggedBody</b></a> method with the MAPI_CREATE and MAPI_MODIFY flags set. This call removes the attachment tags from the message text and converts them into attachment position information in the MAPI message.</li>
<li>
Deliver the message through the MAPI spooler.</li>
</ol>
<p>&nbsp;</p></body>
</HTML>
