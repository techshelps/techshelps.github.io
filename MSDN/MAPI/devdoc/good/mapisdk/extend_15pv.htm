<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Supporting Formatted Text: Gateway Responsibilities</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_supporting_formatted_text_gateway_responsibilities"></a>Supporting Formatted Text: Gateway Responsibilities</h2>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To handle Rich Text Format for outgoing messages, gateways</h5>
<ol>
<li>
Retrieve only a message's <a href="propb_7vhg.htm">PR_RTF_COMPRESSED</a> property from the message store. The main advantage in retrieving only the PR_RTF_COMPRESSED property is that the message text does not need to be sent between machines if the gateway and the message store exist on different machines.</li>
<li>
Generate the message text from the formatted text either by calling the RTF library function <b>HrTextFromCompressedRTFStream</b> or, if the message is stored locally, <a href="function_4yg3.htm"><b>RTFSync</b></a>. The RTF_SYNC_RTF_CHANGED flag should be set in the call to <b>RTFSync</b>.</li>
<li>
Make any irreversible modifications to the message text, such as dropping unsupported characters. </li>
<li>
Ensure that both <a href="propb_26ar.htm">PR_RTF_IN_SYNC</a> and all of the RTF auxilliary properties are either set or absent.</li>
<li>
If any modifications were made, call <b>RTFSync</b> with both the RTF_SYNC_RTF_CHANGED and RTF_SYNC_BODY_CHANGED flags set. <b>RTFSync</b> will recalculate the RTF auxilliary properties from the modified text. </li>
<li>
Make any reversable modifications to the message text, such as inserting attachment placeholders and performing nondestructive code page conversions.</li>
<li>
Send the message.</li>
</ol>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To handle Rich Text Format for incoming messages, gateways</h5>
<ol>
<li>
Reverse any message text modifications that were made directly before the message was sent. </li>
<li>
Call <a href="function_4yg3.htm"><b>RTFSync</b></a> if the message contains both the <a href="propb_7vhg.htm">PR_RTF_COMPRESSED</a> and <a href="propa_9lvd.htm">PR_BODY</a> properties. </li>
<li>
Update the message in the message store with the PR_RTF_COMPRESSED property if the message contains it; update with the PR_BODY property only if PR_RTF_COMPRESSED is absent.</li>
<li>
Discard PR_BODY if the message contains both this property and PR_RTF_COMPRESSED.</li>
</ol>
<p>
Gateways call <b>RTFSync</b> to avoid transmitting both the message text and formatted text if the message store is on a different machine. If the gateway is local, it can set both properties and allow the message store to perform the synchronization.</p>
<p>&nbsp;</p></body>
</HTML>
