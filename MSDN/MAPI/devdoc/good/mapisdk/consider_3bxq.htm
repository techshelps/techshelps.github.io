<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Handling Message Store Notification</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_handling_message_store_notification"></a>Handling Message Store Notification</h2>
<p>
To register for message store notifications, call either the <a href="inter023_5spx.htm"><b>IMAPISession::Advise</b></a> or <a href="inter031_43l1.htm"><b>IMsgStore::Advise</b></a> method and specify a message store, folder, or message entry identifier in the contents of the <i>lpEntryID</i> parameter. Message store providers support both object and table notifications. Whether you register with particular message store objects, with the folder hierarchy and contents tables that describe these objects, or with both objects and tables depends on the notifications you expect to see, the calls you make to perform operations, and how the message store provider supports notification. </p>
<p>
Because MAPI allows flexibility in how providers support notifications, be aware that you will not always receive the same type of notification in response to a particular event from all message store providers. Some message store providers do not support notifications at all. To determine if the message store you are using supports notification, look for the STORE_NOTIFY_OK bit in its <a href="propb_01t7.htm">PR_STORE_SUPPORT_MASK</a> property.</p>
<p>
At one end of the spectrum of message store providers that support notification are the providers that generate "rich" notifications; these providers send descriptive notifications for all registered advise sources. At the other end are the message store providers that support limited notifications; these providers send general notifications for a restricted number of advise sources. </p>
<p>
For example, if you copy a message to a folder with which you have registered to receive both object copied and object moved notifications, you may or may not receive the object copied notification. Whether or not you receive it depends on:
<ul>
<li>
The method that you called to perform the copy. This could be <a href="inter013_596b.htm"><b>IMAPIFolder::CopyMessages</b></a>, <a href="inter022_83qn.htm"><b>IMAPIProp::CopyTo</b></a>, or <a href="inter022_406r.htm"><b>IMAPIProp::CopyProps</b></a>.</li>
<li>
How the message store provider implements the copy method.</li>
<li>
Whether or not the message store provider supports object copied notifications on folders.</li>
</ul>
<p>
Because there are no strict guidelines that describe how to implement event notification for message store providers, clients cannot expect consistent behavior. MAPI does make recommendations as to how message store providers implement event notification and the following table outlines these recommendations. Read the table as follows: after you perform the operation in the first column, expect to receive a notification of the type listed in the second column if you have registered for that type with the object listed in the third column. For example, after you have created a folder, you will receive an <i>fnevObjectCreated</i> notification only if you have registered for <i>fnevObjectCreated</i> notifications with the message store.</p>
<table cellspacing=4 cols=3>
<tr valign=top>
<th align=left width=33%>Operation</th>
<th align=left width=29%>Event type</th>
<th align=left width=38%>Advise source</th>
</tr>
<tr valign=top>
<td width=33%>Create a folder</td>
<td width=29%><i>fnevObjectCreated</i></td>
<td width=38%>Message store</td>
</tr>
<tr valign=top>
<td width=33%>Delete a folder</td>
<td width=29%><i>fnevObjectDeleted</i></td>
<td width=38%>Message store<br>
Deleted folder </td>
</tr>
<tr valign=top>
<td width=33%>Move a folder from one folder to another</td>
<td width=29%><i>fnevObjectMoved</i></td>
<td width=38%>Message store<br>
Moved folder</td>
</tr>
<tr valign=top>
<td width=33%>Copy a folder from one folder to another</td>
<td width=29%><i>fnevObjectCopied</i></td>
<td width=38%>Message store and copied folder (no <i>fnevObjectCreated</i> notification sent for the new copy of the folder)</td>
</tr>
<tr valign=top>
<td width=33%>Change in a computed folder property (PR_SUBFOLDERS, PR_CONTENT_UNREAD,  PR_CONTENT_COUNT)</td>
<td width=29%><i>fnevObjectModified</i></td>
<td width=38%>Message store<br>
Changed folder<br>
(No notification to parent folder)</td>
</tr>
<tr valign=top>
<td width=33%>Create a message</td>
<td width=29%><i>fnevObjectCreated</i></td>
<td width=38%>Message store </td>
</tr>
<tr valign=top>
<td width=33%>Delete a message, causing a change in the parent folder's PR_CONTENT_COUNT property</td>
<td width=29%><i>fnevObjectDeleted</i></td>
<td width=38%>Message store<br>
Deleted message </td>
</tr>
<tr valign=top>
<td width=33%>Move a message from one folder to another</td>
<td width=29%><i>fnevObjectMoved</i></td>
<td width=38%>Message store<br>
Moved message</td>
</tr>
<tr valign=top>
<td width=33%>Copy a message from one folder to another</td>
<td width=29%><i>fnevObjectCopied</i></td>
<td width=38%>Message store<br>
Copied message<br>
(No <i>fnevObjectCreated</i> notification for new copy of the message)</td>
</tr>
<tr valign=top>
<td width=33%>Save a message, causing a change in the parent folder's PR_CONTENT_COUNT property</td>
<td width=29%><i>fnevObjectCreated</i></td>
<td width=38%>Message store on first save only</td>
</tr>
<tr valign=top>
<td width=33%>Save a message</td>
<td width=29%><i>fnevObjectModified</i></td>
<td width=38%>Message store on saves after the first save<br>
Changed message<br>
(No notification to parent folder)</td>
</tr>
<tr valign=top>
<td width=33%>Complete a search operation</td>
<td width=29%><i>fnevSearchComplete</i></td>
<td width=38%>Message store<br>
Search folder</td>
</tr>
<tr valign=top>
<td width=33%>New message</td>
<td width=29%><i>fnevNewMail</i></td>
<td width=38%>Message store </td>
</tr>
</table><br>
<p>
<b>Note</b>  When you receive an object modified notification, remember that the property tag array portion of the <a href="structyp_5tm6.htm"><b>OBJECT_NOTIFICATION</b></a> structure pointed to by the <i>lpNotifications</i> parameter in the <b>OnNotify</b> call may or may not be NULL. Message store providers are not required to insert property information in this array and most do not. Make sure your <b>OnNotify</b> method can handle the case where the <i>lpPropTagArray</i> pointer is NULL.</p>
<p>
For most, if not all object notifications, update the view of the affected folder or folders.</p>
<p>&nbsp;</p></body>
</HTML>
