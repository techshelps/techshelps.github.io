<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IXPProvider::TransportLogon</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_ixpprovider_transportlogon"></a>IXPProvider::TransportLogon</h2>
<p>
The <b>IXPProvider::TransportLogon</b> method establishes a session in which a client application logs on to a transport provider.</p>
<h4>Quick Info</h4>
<p>
See <a href="inter043_3zji.htm"><b>IXPProvider : IUnknown</b></a>.</p>
<pre><code><b>HRESULT TransportLogon(
  LPMAPISUP</b><i> lpMAPISup</i><b>,</b>              
<b>  ULONG</b><i> ulUIParam</i><b>,</b>                  
<b>  LPTSTR</b><i> lpszProfileName</i><b>,</b>           
<b>  ULONG FAR *</b><i> lpulFlags</i><b>,</b>            
<b>  LPMAPIERROR FAR *</b><i> lppMAPIError</i><b>,</b>   
<b>  LPXPLOGON FAR *</b><i> lppXPLogon        </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>lpMAPISup</i></dt>
<dd>
[in] Pointer to the transport provider's support object for callback functions within MAPI for this session. This object remains valid until the transport provider releases it.</dd>
<dt>
<i>ulUIParam</i></dt>
<dd>
[in] Handle of the parent window for any dialog boxes or windows this method displays. The <i>ulUIParam </i>parameter can be non-null, for example when the LOGON_SETUP flag is set in the <i>lpulFlags</i> parameter.</dd>
<dt>
<i>lpszProfileName</i></dt>
<dd>
[in] Pointer to the profile name of the user. The <i>lpszProfileName </i>parameter is used primarily when a dialog box must be presented.</dd>
<dt>
<i>lpulFlags</i></dt>
<dd>
[in, out] Bitmask of flags that controls how the logon session is established. The following flags can be set on input by the MAPI spooler:
<dl>
<dt>
LOGON_NO_CONNECT</dt>
<dd>
The user account is logging on to this transport provider for purposes other than transmission and reception of messages. The transport provider should not attempt to make any connections to other messaging systems.</dd>
<dt>
LOGON_NO_DIALOG</dt>
<dd>
No dialog box should be displayed even if the currently saved user credentials are invalid or insufficient for logon.</dd>
<dt>
LOGON_NO_INBOUND</dt>
<dd>
The transport provider does not need to initialize for reception of messages and should not accept incoming messages. The MAPI spooler can use the <a href="inter042_5cah.htm"><b>IXPLogon::TransportNotify</b></a> method later on to signal the transport provider to enable inbound message processing.</dd>
<dt>
LOGON_NO_OUTBOUND</dt>
<dd>
The transport provider does not need to initialize for sending messages, as the MAPI spooler does not provide any. If a client application requires a connection to a remote provider during the composition of a message so that it can make <a href="inter042_0xbn.htm"><b>IXPLogon::AddressTypes</b></a> or <a href="inter042_8gvn.htm"><b>IXPLogon::RegisterOptions</b></a> method calls, the transport provider should make the connection. The MAPI spooler can use <b>TransportNotify</b> to signal the transport provider when outbound operations can begin.</dd>
<dt>
MAPI_UNICODE</dt>
<dd>
The passed-in string for the profile name is in Unicode format. If the MAPI_UNICODE flag is not set, the string is in ANSI format.
</dd>
</dl>
</dd>
</dl>
<p>
The following flags can be set on output by the transport provider:
<dl>
<dt>
LOGON_SP_IDLE</dt>
<dd>
Requests that the MAPI spooler frequently call the transport provider's <a href="inter042_250l.htm"><b>IXPLogon::Idle</b></a> method for idle-time processing.</dd>
<dt>
LOGON_SP_POLL</dt>
<dd>
Requests that the MAPI spooler frequently call the <a href="inter042_2fos.htm"><b>IXPLogon::Poll</b></a> method on the returned logon object to check for new messages. If this flag is not set, the MAPI spooler only checks for new messages when the transport provider uses the <a href="inter025_5b7d.htm"><b>IMAPISupport::SpoolerNotify</b></a> method to notify the spooler that there are new messages to process. A transport provider effectively becomes send-only by not setting this flag and by not notifying the MAPI spooler of message receipt.</dd>
<dt>
LOGON_SP_RESOLVE</dt>
<dd>
Requests that the MAPI spooler resolve to full addresses all message addresses for recipients not supported by this transport provider, so that the transport provider can construct a reply path for all recipients.</dd>
<dt>
MAPI_UNICODE</dt>
<dd>
The returned strings in the <a href="structyp_0qpe.htm"><b>MAPIERROR</b></a> structure, if any, are in Unicode format. If the MAPI_UNICODE flag is not set, the strings are in ANSI format.</dd>
<dt>
<i>lppMAPIError</i></dt>
<dd>
[out] Pointer to a pointer to the returned <b>MAPIERROR</b> structure, if any, containing version, component, and context information for the error. The <i>lppMAPIError </i>parameter can be set to NULL if there is no <b>MAPIERROR</b> structure to return.</dd>
<dt>
<i>lppXPLogon</i></dt>
<dd>
[out] Pointer to the pointer to the returned transport provider logon object. 
</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
S_OK</dt>
<dd>
The call succeeded and has returned the expected value or values.</dd>
<dt>
MAPI_E_FAILONEPROVIDER</dt>
<dd>
This provider cannot log on, but this error should not disable the service. </dd>
<dt>
MAPI_E_UNCONFIGURED</dt>
<dd>
The profile does not contain enough information for the logon to complete. MAPI calls the provider's message service entry point function.</dd>
<dt>
MAPI_E_UNKNOWN_CPID</dt>
<dd>
The provider cannot support the client's code page.</dd>
<dt>
MAPI_E_UNKNOWN_LCID</dt>
<dd>
The provider cannot support the client's locale information.</dd>
<dt>
MAPI_E_USER_CANCEL</dt>
<dd>
The user canceled the operation, typically by clicking the <b>Cancel</b> button in a dialog box.
</dd>
</dl>
<h4>Remarks</h4>
<p>
The MAPI spooler calls the <b>IXPProvider::TransportLogon</b> method to establish a logon session for a user.</p>
<p>
Most transport providers use the <a href="inter025_6rvy.htm"><b>IMAPISupport::OpenProfileSection</b></a> method provided with the support object pointed to by the <i>lpMAPISup</i> parameter for saving and retrieving user identity information, server addresses, and credentials. Using <b>OpenProfileSection</b> enables a transport provider to save arbitrary information and associate it with a logon to a particular resource. For example, a provider can use <b>OpenProfileSection</b> to save the account name and password associated with a particular session and any server names or other necessary information needed to access resources for that session. MAPI hides information associated with a resource from outside access. The profile section made available through <i>lpMAPISup</i> is managed by the MAPI spooler so data related to this user context is separated from data for other contexts.</p>
<p>
The transport provider must call the <b>IUnknown::AddRef</b> method on the support object and keep a copy of the pointer to this object as part of the provider logon object. </p>
<p>
The profile display name in <i>lpszProfileName</i> is provided so the transport provider can use it in error messages or logon dialog boxes. If the provider retains this name, it must be copied to storage allocated by the provider. </p>
<p>
Transport providers that are tightly coupled with other service providers may need to do additional work at logon to establish the proper credentials required for operations between companion providers.</p>
<p>
Usually, transport providers are opened when the user first logs on to a profile. Because the first logon to a profile thus generally precedes logon to any message store, the MAPI spooler usually calls <b>TransportLogon</b> with both the LOGON_NO_INBOUND and LOGON_NO_OUTBOUND flags set in <i>lpulFlags</i>. Later, when the appropriate message stores are available in the profile session, the MAPI spooler calls <b>TransportNotify</b> to initiate inbound and outbound operations for the transport provider.</p>
<p>
Passing the LOGON_NO_CONNECT flag in <i>lpulFlags</i> signals offline operation of the transport provider. This flag indicates no external connections should be made; if the transport provider cannot establish a session without an external connection, it should return an error value for the logon. </p>
<p>
A transport provider should set the LOGON_SP_IDLE flag in <i>lpulFlags</i> at initialization time if it is designed to use time that the system otherwise spends idle. Such time is often used to handle automatic operations, such as automatic message downloading, timed message downloading, or timed message submission. If this flag is set, the MAPI spooler calls <b>Idle</b> when system idle time occurs to initiate such operations. The MAPI spooler does not call <b>Idle</b> at regular intervals; rather, it is called only during true idle time, so providers should not work on any assumption about how frequently their <b>Idle</b> methods will be called. Providers that support idle-time operations should supply a configuration user interface for it in their provider property sheet.</p>
<p>
If the transport provider logon succeeds, the provider should return in the <i>lppXPLogon</i> parameter a pointer to a logon object. The MAPI spooler will use this object for further provider access. If <b>TransportLogon</b> displays a logon dialog box and the user cancels logon — typically by clicking the <b>Cancel</b> button in the dialog box — the provider should return MAPI_E_USER_CANCEL.</p>
<p>
For most error values returned from <b>TransportLogon</b>, MAPI disables the message services to which the provider belongs. MAPI will not call any providers belonging to that service for the remainder of the MAPI session. In contrast, when <b>TransportLogon</b> returns the MAPI_E_FAILONEPROVIDER error value from its logon, MAPI does not disable the message service to which the provider belongs. <b>TransportLogon</b> should return MAPI_E_FAILONEPROVIDER if it encounters an error that does not warrant disabling the entire service for the remainder of the session.</p>
<p>
If a provider returns MAPI_E_UNCONFIGURED from its logon, MAPI will call the provider's message service entry function and then retry the logon. MAPI passes MSG_SERVICE_CONFIGURE as the context, to give the service a chance to configure itself. If the client has chosen to allow a user interface on the logon, the service can present its configuration property sheet so the user can enter configuration information. </p>
<p>
If the provider finds that all the required information is not in the profile, it should return MAPI_E_UNCONFIGURED so that MAPI calls the provider's message service entry point function. </p>
<h4>See Also</h4>
<p>
<a href="inter025_6rvy.htm"><b>IMAPISupport::OpenProfileSection</b></a>, <a href="inter025_5b7d.htm"><b>IMAPISupport::SpoolerNotify</b></a>,<b> <a href="inter042_0xbn.htm">IXPLogon::AddressTypes</a></b>, <a href="inter042_250l.htm"><b>IXPLogon::Idle</b></a>,<b> <a href="inter042_2fos.htm">IXPLogon::Poll</a></b>, <a href="inter042_8gvn.htm"><b>IXPLogon::RegisterOptions</b></a>, <a href="inter042_5cah.htm"><b>IXPLogon::TransportNotify</b></a>, <a href="structyp_0qpe.htm"><b>MAPIERROR</b></a></p>
<p>
</p>
<p>&nbsp;</p></body>
</HTML>
