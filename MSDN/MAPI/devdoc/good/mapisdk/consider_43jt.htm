<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Retrieving Primary and Provider Identity</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_retrieving_primary_and_provider_identity"></a>Retrieving Primary and Provider Identity</h2>
<p>
Service providers, typically address book providers, have the option of supplying an identity that can be used to represent the session in a variety of situations. Three properties describe a provider's identity:</p>
<p class=indent1>
<a href="propa_3q1w.htm">PR_IDENTITY_ENTRYID</a></p>
<p class=indent1>
<a href="propa_4sl5.htm">PR_IDENTITY_DISPLAY</a></p>
<p class=indent1>
<a href="propa_0r7d.htm">PR_IDENTITY_SEARCH_KEY</a></p>
<p>
These properties are set to the entry identifier, display name, and search key of the corresponding identity object, which is typically a messaging user. Providers that supply an identity also set the STATUS_PRIMARY_IDENTITY flag in their <a href="propb_4u5v.htm">PR_RESOURCE_FLAGS</a> property.</p>
<p>
Depending on your needs, you might use a particular provider's identity or the primary identity for the session. For example, you can use the primary identity to include it on printouts. You can use a provider's identity also for display purposes or to retrieve properties, such as <a href="propb_63qg.htm">PR_RESOURCE_PATH</a>. PR_RESOURCE_PATH, if set, contains the path to files used or created by the provider. Retrieve the PR_RESOURCE_PATH property for the provider supplying the primary identity when you want to locate files that pertain to the user of the session.</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To retrieve the identity of a specific provider</h5>
<ol>
<li>
Call <a href="inter023_04md.htm"><b>IMAPISession::GetStatusTable</b></a> to access the status table.</li>
<li>
Build a restriction using an <a href="structyp_6fxq.htm"><b>SPropertyRestriction</b></a> structure to match the <a href="propb_5yud.htm">PR_PROVIDER_DLL_NAME</a> column with the name of the specified provider. </li>
<li>
Call <a href="inter026_2lkn.htm"><b>IMAPITable::FindRow</b></a> to locate the provider's row. The provider's identity will be stored in the <a href="propa_3q1w.htm">PR_IDENTITY_ENTRYID</a> column, if it exists.</li>
</ol>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To retrieve the primary identity for a session</h5>
<ul>
<li>
Call <a href="inter023_7x89.htm"><b>IMAPISession::QueryIdentity</b></a>. <p>
<b>QueryIdentity</b> bases session identity on the existence of the STATUS_PRIMARY_IDENTITY value in the <a href="propb_4u5v.htm">PR_RESOURCE_FLAGS</a> column for one of the rows in the status table. If none of the status rows have this value set, <b>QueryIdentity</b> assigns identity to the first service provider that sets the three PR_IDENTITY properties. If no service provider supplies an identity, <b>QueryIdentity</b> returns MAPI_W_NO_SERVICE. When this happens, you should create a character string to represent a generic user that can serve as the primary identity.
</li>
</ul>
<p>
<b>Note</b>  Do not call <b>QueryIdentity</b> during session start up; it will unnecessarily increase the amount of time it takes to start your session. This is because to access the status table and query for the PR_IDENTITY properties, the MAPI spooler must be available. The extra time it takes to start up the MAPI spooler will add to your start up time.</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To explicitly set the primary identity for a session</h5>
<ul>
<li>
Call <a href="inter030_1zeh.htm"><b>IMsgServiceAdmin::SetPrimaryIdentity</b></a>. Pass the <b>MAPIUID</b> for the target service provider. </li>
</ul>
<p>&nbsp;</p></body>
</HTML>
