<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Validating Object Pointers</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_validating_object_pointers"></a>Validating Object Pointers</h2>
<p>
The need to validate object pointers arises when calls are made to retrieve MAPI objects or when private method calls are made within your client or service provider. It is always a good idea to validate these pointers. However, unlike parameter validation, MAPI does not provide a single API function to use. Instead there is a recommended series of steps to ensure that object pointers given to your client or service provider are valid. Not all steps are appropriate for all situations; the vtable verification step, for example, is unnecessary in C++.</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To validate object pointers</h5>
<ol>
<li>
Check that the object pointer points to the correct amount of writeable memory.</li>
<li>
Check that the vtable of the object contains the expected number of readable entries.</li>
<li>
Check that one or more methods in the vtable have the expected address.</li>
<li>
Check that the object's reference count is nonzero. </li>
</ol>
<p>
MAPI provides two API functions for validating pointer memory: <b>IsBadWritePtr</b> and <b>IsBadReadPtr</b>. The following C code sample illustrates how to validate an object pointer using all of the steps outlined above and these two API functions.</p>
<pre><code>if (IsBadWritePtr(lpMyObject, sizeof(MYOBJECT)))
    return failure

if (IsBadReadPtr(lpMyObject-&gt;lpVtbl, size(MYOBJECT_Vtbl)))
    return failure

if (lpMyObject-&gt;lpVtbl-&gt;SetProps != MYOBJECT_SetProps)
    return failure

if (lpMyObject-&gt; cRef == 0)
    return failure
 </code></pre>
<p>&nbsp;</p></body>
</HTML>
