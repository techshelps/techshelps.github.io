<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PreprocessMessage</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_preprocessmessage"></a>PreprocessMessage</h2>
<p>
The <b>PreprocessMessage</b> function prototype defines a function that preprocesses message contents or the format of a message. </p>
<h4>Quick Info </h4>
<table cellspacing=4 cols=2>
<tr valign=top>
<td width=48%>Header file: </td>
<td width=52%>MAPISPI.H </td>
</tr>
<tr valign=top>
<td width=48%>Defined function implemented by: </td>
<td width=52%>Transport providers </td>
</tr>
<tr valign=top>
<td width=48%>Defined function called by: </td>
<td width=52%>MAPI spooler </td>
</tr>
</table><br>
<pre><code><b>HRESULT PreprocessMessage(
  LPVOID</b><i> lpvSession</i><b>,</b>                 
<b>  LPMESSAGE</b><i> lpMessage</i><b>,</b>               
<b>  LPADRBOOK</b><i> lpAdrBook</i><b>,</b>               
<b>  LPMAPIFOLDER</b><i> lpFolder</i><b>,</b>             
<b>  LPALLOCATEBUFFER</b><i> AllocateBuffer</i><b>,</b>   
<b>  LPALLOCATEMORE</b><i> AllocateMore</i><b>,</b>       
<b>  LPFREEBUFFER</b><i> FreeBuffer</i><b>,</b>           
<b>  ULONG FAR *</b><i> lpcOutbound</i><b>,</b>           
<b>  LPMESSAGE FAR * FAR *</b><i> lpppMessage</i><b>,</b>   
<b>  LPADRLIST FAR *</b><i> lppRecipList</i>       
<b>);</b>
 </code></pre>
<h4>Parameters </h4>
<dl>
<dt>
<i>lpvSession </i></dt>
<dd>
[in] Pointer to the session to be used. </dd>
<dt>
<i>lpMessage </i></dt>
<dd>
[in] Pointer to the message to be preprocessed. </dd>
<dt>
<i>lpAdrBook </i></dt>
<dd>
[in] Pointer to the address book from which the user should select recipients for the message. </dd>
<dt>
<i>lpFolder </i></dt>
<dd>
[in, out] Pointer to a folder. On input, the <i>lpFolder</i> parameter points to the folder that contains messages to be preprocessed. On output, <i>lpFolder</i> points to the folder where preprocessed messages have been placed. </dd>
<dt>
<i>lpAllocateBuffer </i></dt>
<dd>
[in] Pointer to the <a href="function_8z3m.htm"><b>MAPIAllocateBuffer</b></a> function, to be used to allocate memory. </dd>
<dt>
<i>lpAllocateMore </i></dt>
<dd>
[in] Pointer to the <a href="function_11wl.htm"><b>MAPIAllocateMore</b></a> function, to be used to allocate additional memory where required. </dd>
<dt>
<i>lpFreeBuffer </i></dt>
<dd>
[in] Pointer to the <a href="function_85yq.htm"><b>MAPIFreeBuffer</b></a> function, to be used to free memory. </dd>
<dt>
<i>lpcOutbound </i></dt>
<dd>
[out] Pointer to the number of messages in the array pointed to by the <i>lpppMessage </i>parameter. </dd>
<dt>
<i>lpppMessage </i></dt>
<dd>
[out] Pointer to a pointer to an array of pointers to preprocessed or otherwise generated messages. </dd>
<dt>
<i>lppRecipList </i></dt>
<dd>
[out] Pointer to an optional returned <a href="structyp_87n8.htm"><b>ADRLIST</b></a> structure, listing preprocessor-detected recipients for which the message is undeliverable. For more information on the contents of this list, see the <a href="inter025_7chf.htm"><b>IMAPISupport::StatusRecips</b></a> method. 
</dd>
</dl>
<h4>Remarks </h4>
<p>
A transport-provider message preprocessor can present a progress indicator during message preprocessing. However, it should never present a dialog box requiring user interaction during message preprocessing. </p>
<p>
When a preprocessor adds large amounts of data to an outbound message, certain procedures should be followed. This type of message can be stored in a server-based message store, causing the preprocessor to access a remote store, a time-consuming procedure. To avoid having to do so, the preprocessor should have an option that enables it to store data that takes a large amount of space in a local message store and to provide a reference to that local store in the message. </p>
<p>
The preprocessor should not release any of the objects originally passed to the <b>PreprocessMessage</b> – based function. </p>
<p>
Before the MAPI spooler can call a <b>PreprocessMessage</b> function, the transport provider must have registered the function in a call to the <a href="inter025_53qq.htm"><b>IMAPISupport::RegisterPreprocessor</b></a> method. After calling a <b>PreprocessMessage</b> function, the spooler cannot continue submitting a message until the function returns. </p>
<p>
The MAPI spooler owns the task of submitting messages. This means the original message is never placed in an array of message pointers and that a call to the <b>SubmitMessage</b> methods is never required. </p>
<h4>See Also </h4>
<p>
<a href="groups_0nzn.htm">Preprocessor Functions</a>, <a href="inter006_23e8.htm"><b>IAddrBook : IMAPIProp</b></a>, <a href="inter013_9ohe.htm"><b>IMAPIFolder : IMAPIContainer</b></a>, <a href="inter025_8uge.htm"><b>IMAPISupport : IUnknown</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
