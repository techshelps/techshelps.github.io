<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IABLogon::PrepareRecips</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_iablogon_preparerecips"></a>IABLogon::PrepareRecips</h2>
<p>
The <b>IABLogon::PrepareRecips</b> method prepares a recipient list for later use by the messaging system.</p>
<h4>Quick Info</h4>
<p>
See <a href="inter004_8ofi.htm"><b>IABLogon : IUnknown</b></a>.</p>
<pre><code><b>HRESULT PrepareRecips(
  ULONG</b><i> ulFlags</i><b>,</b>                    
<b>  LPSPropTagArray</b><i> lpPropTagArray</i><b>,</b>   
<b>  LPADRLIST</b><i> lpRecipList             </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>ulFlags</i></dt>
<dd>
Reserved; must be zero.</dd>
<dt>
<i>lpPropTagArray</i></dt>
<dd>
[in] Pointer to an <a href="structyp_23i1.htm"><b>SPropTagArray</b></a> structure containing an array of property tags indicating the properties that require updating, if any. The <i>lpPropTagArray</i> parameter can be NULL.</dd>
<dt>
<i>lpRecipList</i></dt>
<dd>
[in] Pointer to an <a href="structyp_87n8.htm"><b>ADRLIST</b></a> structure holding the recipient list.
</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
S_OK</dt>
<dd>
The recipient list was successfully prepared.</dd>
<dt>
MAPI_E_NOT_FOUND</dt>
<dd>
One or more of the recipients in the <i>lpRecipList</i> parameter does not exist.
</dd>
</dl>
<h4>Remarks</h4>
<p>
A client calls the MAPI <a href="inter006_98fn.htm"><b>IAddrBook::PrepareRecips</b></a> method to modify or rearrange a set of properties for one or more recipients. The recipients may or may not be part of the recipient list of an outgoing message. MAPI transfers this call to an address book provider's <a href="#_mapi1book_iablogon_preparerecips"><b>IABLogon::PrepareRecips</b></a> method. </p>
<p>
<b>PrepareRecips</b> performs four main tasks:
<ul>
<li>
Ensures that all recipients in the address list pointed to by <i>lpRecipList</i> have a long-term entry identifier. </li>
<li>
Ensures that all recipients have the properties specified in the property tag array pointed to by <i>lpPropTagArray</i>.</li>
<li>
Ensures that the properties from the property tag array appear before any other properties that existed prior to the call.</li>
<li>
Ensures that the order of the properties in each recipient's <a href="structyp_6m49.htm"><b>ADRENTRY</b></a> structure in the <a href="structyp_87n8.htm"><b>ADRLIST</b></a> structure is the same as in the property tag array.</li>
</ul>
<p>
</p>
<p>
The <b>ADRLIST</b> structure in the <i>lpRecipList</i> parameter contains one <b>ADRENTRY</b> structure for each recipient. Each <b>ADRENTRY</b> structure contains an array of <a href="structyp_9sbp.htm"><b>SPropValue</b></a> structures to describe the recipient's properties. When <b>PrepareRecips</b> returns, the <b>SPropValue</b> structure array for each recipient includes the properties from the <i>lpPropTagArray</i> followed by the other properties for the recipient.</p>
<h4>Notes to Implementers</h4>
<p>
Implementing <b>PrepareRecips</b> involves placing properties in a specific order, retrieving property values, and converting short-term entry identifiers to long-term entry identifiers. The properties that are included in the <i>lpPropTagArray</i> parameter should appear at the beginning of the property value array associated with each recipient's <b>ADRENTRY</b> structure in the <i>lpRecipList</i> parameter. If values for these properties do not exist, open the associated messaging user or distribution list by using its entry identifier and retrieve the missing property values.</p>
<p>
Allocate each <a href="structyp_9sbp.htm"><b>SPropValue</b></a> structure passed in <i>lpPropTagArray</i> separately so that the structures can be freed individually. If you must allocate additional space for any <b>SPropValue</b> structure — for example, to store the data for a string property — use <a href="function_8z3m.htm"><b>MAPIAllocateBuffer</b></a> to allocate additional space for the full property tag array. Use the <a href="function_85yq.htm"><b>MAPIFreeBuffer</b></a> function to free the original property tag array and then use <a href="function_11wl.htm"><b>MAPIAllocateMore</b></a> to allocate any additional memory required.</p>
<h5><img src="../../images/wedge.gif" border=0>&nbsp;&nbsp;&nbsp;&nbsp;To implement IABLogon::PrepareRecips</h5>
<ol>
<li>
Check for entries in the <i>lpPropTagArray</i> parameter. If the property tag array is empty, there is no work to do. Return with a success value. </li>
<li>
Process each recipient in the <i>lpRecipList</i> parameter. There is one <b>ADRENTRY</b> structure member for each recipient in the list. Ignore the following types of recipients:<ul>
<li>
Recipients without an entry identifier in the <i>rgPropVals</i> member of their <b>ADRENTRY</b> structure, that is, unresolved recipients.</li>
<li>
Recipients with an entry identifier that does not belong to your provider. These recipients will be passed on to another address book provider.</li>
</ul>
</li>
<li>
Open the recipient and retrieve the properties already set for the recipient.</li>
<li>
Merge the property value array specified in the <i>lpPropTagArray</i> with the array of properties returned from <b>GetProps</b>. If the same property exists in both property arrays, use the value from <i>lpPropTagArray</i>.</li>
<li>
If the <i>lpPropTagArray</i> property value array is big enough to hold all of the necessary properties, just replace it with the merged array. If the <i>lpPropTagArray</i> property value array is not big enough, replace it with a newly allocated array. Make sure the new array has an updated value in each of its <b>cValues</b> members. </li>
<li>
If you do not recognize one or more of the properties in the <i>lpPropTagArray</i> parameter, set the property type in the recipient's <b>ADRENTRY</b> structure to PT_ERROR and the property value either to MAPI_E_NOT_FOUND or to another value giving a more specific reason for the unavailability. For information about PT_ERROR, see <a href="appprop_3n3n.htm">List of Property Types</a>.</li>
</ol>
<p>
<b>Note</b>  Never reallocate the <b>ADRLIST</b> structure that is passed into <b>PrepareRecips</b> or change its number of entries. </p>
<h4>See Also</h4>
<p>
<a href="structyp_87n8.htm"><b>ADRLIST</b></a>, <a href="inter022_44c3.htm"><b>IMAPIProp::GetProps</b></a>, <a href="propa_8cv8.htm">PR_ENTRYID</a>, <a href="structyp_9sbp.htm"><b>SPropValue</b></a></p>
<p>&nbsp;</p></body>
</HTML>
