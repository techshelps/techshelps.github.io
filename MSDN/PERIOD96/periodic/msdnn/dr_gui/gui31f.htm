<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 2.0">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>SetCommState, SetCommState, Wherefore Art Thou?</title>

<meta name=href content="msdn_ie4.css">                
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD><basefont face="verdana,arial,helvetica" size=2 color="#000000">

<BODY bgcolor="#FFFFFF">
<font face="verdana,arial,helvetica" size="2">

<p><font color="#000000" size="5" face="verdana,arial,helvetica">SetCommState,
SetCommState, Wherefore Art Thou?</font><font
color="#000000" face="verdana,arial,helvetica"> </font></p>

<h2><font color="#000000" size="2" face="verdana,arial,helvetica">Dear
Dr. GUI:</font><font color="#000000"
face="verdana,arial,helvetica"> </font></h2>

<p><font color="#000000" size="2" face="verdana,arial,helvetica">I
recently wrote a communication application with Visual C++ 4.1
and MFC 4.0. I call the <b>SetCommState</b> function in my
application. I compiled the .CPP file that includes the call to
the <b>SetCommState</b> function, but it failed. Then I added a
line to the .CPP file:</font><font color="#000000"
face="verdana,arial,helvetica"> </font></p>

<p><font color="#000000" size="2" face="Courier New">#include
&lt;winbase.h&gt;</font><font color="#000000"
face="verdana,arial,helvetica"> </font></p>

<p><font color="#000000" size="2" face="verdana,arial,helvetica">and
compiled the code again; it also failed.</font><font
color="#000000" face="verdana,arial,helvetica"> </font></p>

<p><font color="#000000" size="2" face="verdana,arial,helvetica">I
don't know what's wrong. How can I do this?</font><font
color="#000000" face="verdana,arial,helvetica"> </font></p>

<p><font color="#000000" size="2" face="verdana,arial,helvetica">Qun
Liu</font><font color="#000000" face="verdana,arial,helvetica"> </font></p>

<h2><font size="2" face="verdana">Dr. GUI replies:</font></h2>

<p><font color="#000000" size="2" face="verdana,arial,helvetica">You
are probably getting errors like:</font><font color="#000000"
face="verdana,arial,helvetica"> </font></p>

<p><font color="#000000" size="2" face="Courier New">error C2065:
'SetCommState' : undeclared identifier</font><font
color="#000000" face="verdana,arial,helvetica"> </font></p>

<p><font color="#000000" size="2" face="Courier New">error C2064:
term does not evaluate to a function</font><font color="#000000"
face="verdana,arial,helvetica"> </font></p>

<p><font color="#000000" size="2" face="verdana,arial,helvetica">For
optimization purposes, AppWizard (versions 4.0 and later) adds a
symbol called VC_EXTRALEAN to STDAFX.H. This symbol speeds up
compilation by excluding less frequently used declarations.
VC_EXTRALEAN is defined in AFXV_W32.H as:</font></p>

<p><font color="#000000" size="3" face="Courier New"><br>
</font><font color="#000000" size="2" face="Courier New">#ifdef
VC_EXTRALEAN</font><font color="#000000"
face="verdana,arial,helvetica"> <br>
</font><font color="#000000" size="2" face="Courier New">#define
WIN32_EXTRA_LEAN</font><font color="#000000"
face="verdana,arial,helvetica"> <br>
</font><font color="#000000" size="2" face="Courier New">#define
NOSERVICE</font><font color="#000000"
face="verdana,arial,helvetica"> <br>
</font><font color="#000000" size="2" face="Courier New">#define
NOMCX</font><font color="#000000" face="verdana,arial,helvetica">
<br>
</font><font color="#000000" size="2" face="Courier New">#define
NOIME</font><font color="#000000" face="verdana,arial,helvetica">
<br>
</font><font color="#000000" size="2" face="Courier New">#define
NOSOUND</font><font color="#000000"
face="verdana,arial,helvetica"> <br>
</font><font color="#000000" size="2" face="Courier New">#define
NOCOMM</font><font color="#000000" face="verdana,arial,helvetica">
<br>
</font><font color="#000000" size="2" face="Courier New">#define
NOKANJI</font><font color="#000000"
face="verdana,arial,helvetica"> <br>
</font><font color="#000000" size="2" face="Courier New">#define
NORPC</font><font color="#000000" face="verdana,arial,helvetica">
<br>
</font><font color="#000000" size="2" face="Courier New">#define
NOPROXYSTUB</font><font color="#000000"
face="verdana,arial,helvetica"> <br>
</font><font color="#000000" size="2" face="Courier New">#define
NOIMAGE</font><font color="#000000"
face="verdana,arial,helvetica"> <br>
</font><font color="#000000" size="2" face="Courier New">#define
NOTAPE</font><font color="#000000" face="verdana,arial,helvetica">
<br>
&nbsp; <br>
</font><font color="#000000" size="2" face="Courier New">#ifndef
NO_ANSIUNI_ONLY</font><font color="#000000"
face="verdana,arial,helvetica"> <br>
</font><font color="#000000" size="2" face="Courier New">#ifdef
_UNICODE</font><font color="#000000"
face="verdana,arial,helvetica"> <br>
</font><font color="#000000" size="2" face="Courier New">#define
UNICODE_ONLY</font><font color="#000000"
face="verdana,arial,helvetica"> <br>
</font><font color="#000000" size="2" face="Courier New">#else</font><font
color="#000000" face="verdana,arial,helvetica"> <br>
</font><font color="#000000" size="2" face="Courier New">#define
ANSI_ONLY</font><font color="#000000"
face="verdana,arial,helvetica"> <br>
</font><font color="#000000" size="2" face="Courier New">#endif</font><font
color="#000000" face="verdana,arial,helvetica"> <br>
</font><font color="#000000" size="2" face="Courier New">#endif
//!NO_ANSIUNI_ONLY</font><font color="#000000"
face="verdana,arial,helvetica"> <br>
&nbsp; <br>
</font><font color="#000000" size="2" face="Courier New">#endif
//VC_EXTRALEAN</font><font color="#000000"
face="verdana,arial,helvetica"> </font></p>

<p><font color="#000000" size="2" face="verdana,arial,helvetica">Note
that NOCOMM is defined along with VC_EXTRALEAN. In WINBASE.H, <b>SetCommState</b>
is not declared if NOCOMM is defined.</font><font color="#000000"
face="verdana,arial,helvetica"> </font></p>

<p><font color="#000000" size="2" face="verdana,arial,helvetica">One
solution is to remove the #define VC_EXTRALEAN line from
stdafx.h. This keeps the Communication, Registry, and other areas
of the Win32 APIs that are not directly used by MFC in the
project. But your builds will be substantially slower if you do
this.</font><font color="#000000" face="verdana,arial,helvetica">
</font></p>

<p><font color="#000000" size="2" face="verdana,arial,helvetica">An
alternative is to replace the &quot;#define VC_EXTRALEAN&quot;
line with the set of #define lines listed above and then
selectively remove any #define that should not be included. For
instance, if the Communication APIs are called, you may have all
the #define lines listed above except the &quot;#define
NOCOMM&quot; line in the stdafx.h.</font><font color="#000000"
face="verdana,arial,helvetica"> </font></p>

<p><font color="#000000" size="2" face="verdana,arial,helvetica">This
is also documented in the Microsoft Knowledge Base article
Q151666&#151;PRB: C2065/C2064 &quot;Errors when Using Win32 APIs
in MFC Program.&quot;</font><font color="#000000"
face="verdana,arial,helvetica"> </font></p>
</font></body>
</html>
