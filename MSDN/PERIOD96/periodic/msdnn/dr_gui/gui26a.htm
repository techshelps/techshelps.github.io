<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 2.0">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>The Mummy Meets
Hieroglyphics: Font Missing Pixels</title>

<meta name=href content="msdn_ie4.css">                
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD><basefont face="verdana,arial,helvetica" size=2 color="#000000">

<BODY bgcolor="#FFFFFF">
<font face="verdana,arial,helvetica" size="2">

<font size="5" face="verdana,arial,helvetica">The Mummy Meets
Hieroglyphics: Font Missing Pixels</font>

<h2><font size="2" face="verdana,arial,helvetica">Dear Dr. GUI:</font></h2>

<p><font size="2" face="verdana,arial,helvetica">When I use the Courier
New font, at some font sizes some glyphs are showing up with
missing pixels. The problem is reproducible. It usually happens
when the glyph is one pixel in width or height. Is this a bug
with the font hinting? Here is a bitmap illustrating what is
happening. </font></p>

<p align="center"><font size="2" face="verdana,arial,helvetica"><img
src="26a_1.gif" width="229" height="72"></font></p>

<p><font size="2" face="verdana,arial,helvetica">And here is the code
that produced this effect: </font></p>

<pre><font size="2" face="Courier">  case WM_PAINT:
{
PAINTSTRUCT ps;
HDC hDC = BeginPaint(hWnd, &amp;ps);
RECT rect;
HFONT hf, hfOld;

GetClientRect(hWnd, &amp;rect);

SetMapMode(hDC, MM_ISOTROPIC);
SetWindowExtEx(hDC, 1250, 1250, NULL);
SetViewportExtEx(hDC, rect.right, rect.bottom, NULL);
SetViewportOrgEx(hDC, 0,0,NULL);

hf = CreateFont(3000/7,
              3000/30,
              0,
              0,
              FW_DEMIBOLD,
              0,
              0,
              0,
              ANSI_CHARSET,
              OUT_TT_PRECIS,
              CLIP_DEFAULT_PRECIS,
              DEFAULT_QUALITY,
              DEFAULT_PITCH,
              &quot;Courier New&quot;);

hfOld = SelectObject(hDC, hf);

TextOut(hDC,500,500,&quot;This is a test of font scaling&quot;,
   strlen(&quot;This is a test of font scaling&quot;));

SelectObject(hDC, hfOld);
DeleteObject(hf);
EndPaint(hWnd, &amp;ps);
}
break;</font></pre>

<h2><font size="2" face="verdana,arial,helvetica">Dr. GUI replies:</font></h2>

<p><font size="2" face="verdana,arial,helvetica">I have always been
fascinated with hieroglyphics, although I have to admit that I
generally associate them with the Mummy (the monster, not Billy).
This of course makes me think of my childhood days watching
horror movies. I would, without fail, find myself cowering behind
the gray-and-salmon overstuffed chair just waiting for the door
to crash in as the Mummy, Frankenstein, or Wolfman sought to rip
the arms and legs off my puny nine-year-old frame. Whoa, did you
hear something? Was that your door or mine?! </font></p>

<p><font size="2" face="verdana,arial,helvetica">This problem can be the
result of a number of factors, including: </font></p>

<p><font size="2" face="verdana,arial,helvetica"> The Courier New font
has rather thin strokes to begin with. </font></p>

<p><font size="2" face="verdana,arial,helvetica"> The application
program compresses the font in the x direction. </font></p>

<p><font size="2" face="verdana,arial,helvetica"> For performance
reasons, the hinting turns off dropout control at large
pixel-per-em (ppem) sizes. </font></p>

<p><font size="2" face="verdana,arial,helvetica"> The rasterizer uses
the y direction to determine the ppem size. </font></p>

<p><font size="2" face="verdana,arial,helvetica">The bottom line here is
that while the font/rasterizer thinks that the glyphs are big
enough to disable dropout control safely, the compression makes
the strokes even thinner than usual, causing dropouts. A couple
of technically possible, but not bloody likely (some casual
doctor talk here), solutions are: </font></p>

<p><font size="2" face="verdana,arial,helvetica"> Change the rasterizer
to use the lesser of (x,y) to determine ppem size. But hey, you
can't change the rasterizer in the first place! </font></p>

<p><font size="2" face="verdana,arial,helvetica"> Change the font to
leave dropout control set to the maximum size of 255 ppem. (This
would be a large performance hit, and there would still be
problems with extreme compression&#151;not to mention the fact
that you can't change the font!) </font></p>

<p><font size="2" face="verdana,arial,helvetica">Some more plausible
solutions would include: </font></p>

<p><font size="2" face="verdana,arial,helvetica"> Don't x-compress the
font. (Set the second parameter of <b>CreateFont</b> (<i>nWidth</i>)
to 0, which will use the default width, which is what the font
designer had in mind to begin with.) </font></p>

<p><font size="2" face="verdana,arial,helvetica"> Choose a different
font. (One without such thin, waifish, Kate-Moss-like strokes.) </font></p>
</font></body>
</html>
