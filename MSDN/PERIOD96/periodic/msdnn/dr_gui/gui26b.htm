<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 2.0">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Destructicons: Closing
Down in Win95</title>

<meta name=href content="msdn_ie4.css">                
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD><basefont face="verdana,arial,helvetica" size=2 color="#000000">

<BODY bgcolor="#FFFFFF">
<font face="verdana,arial,helvetica" size="2">

<font size="5" face="verdana,arial,helvetica">Destructicons: Closing
Down in Win95</font>

<h2><font size="2" face="verdana,arial,helvetica">Dear Dr. GUI:</font></h2>

<p><font size="2" face="verdana,arial,helvetica">We're finding that under
Windows 95, if you use the &quot;Start-&gt;Shutdown-&gt;Close all
Programs and Logon as different user&quot; option to log out of
Windows and log back on, the destructors for our
App/Doc/Frame/... don't get called! </font></p>

<p><font size="2" face="verdana,arial,helvetica">I guess I could either <b>SendMessage</b>(WM_CLOSE)
to the frame during <b>OnEndSession</b> or <b>DestroyWindow</b>
the frame there, but that still means the application's
destructor won't be called. (Luckily, we aren't doing much of
anything in the app destructor&#151;most of the work is in our
doc's constructor, which should be called with this workaround,
me thinks.) </font></p>

<p><font size="2" face="verdana,arial,helvetica">Gman </font></p>

<h2><font size="2" face="verdana,arial,helvetica">Dr. GUI replies:</font></h2>

<p><font size="2" face="verdana,arial,helvetica">Destructicons. Obviously
a play on my kid's toy Decepticons. These are little toy trucks,
forklifts, and Cessna airplanes that unfold into robots. My kid
loves them. I despise them. Each morning I run the gauntlet from
my bed to the bathroom, dodging the stupid things, wondering if I
had a tetanus shot recently. These silly things even have names:
Optimus Prime, Trashcan, Prime Directive, Destined-for-garbage.
Perhaps I should talk about destructors. </font></p>

<p><font size="2" face="verdana,arial,helvetica">Yes, the destructors for
the applications are not being called. The idea is that a user
wants to exit Windows 95 without watching all 20 programs that
are running disappear from the desktop one-by-one. </font></p>

<p><font size="2" face="verdana,arial,helvetica">Sending WM_CLOSE would
be pretty sloppy, as the user will notice your application
disappear from the desktop before the desktop goes away, which
would be different from other applications out there. The
following suggestions will help you clean up after yourself in a
reliable way: </font></p>

<p><font size="2" face="verdana,arial,helvetica">· Handle most of the
cleanup in your document's <b>OnCloseDocument</b> or its
destructor (your document's destructor will be called unless you
have set <b>CDocument::m_bAutoDelete</b> to FALSE). </font></p>

<p><font size="2" face="verdana,arial,helvetica">· Have the
application-related shutdown done in <b>ExitInstance</b> (yes, it
will be called). </font></p>

<p><font size="2" face="verdana,arial,helvetica">Finally, consider using <b>CWinApp::CloseAllDocuments</b>.
It is even passed a flag that indicates that the Windows session
is ending. </font></p>
</font></body>
</html>
