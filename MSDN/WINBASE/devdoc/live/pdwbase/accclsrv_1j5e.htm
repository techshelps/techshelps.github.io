<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>BuildSecurityDescriptor</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_buildsecuritydescriptor"></a>BuildSecurityDescriptor</h1>
<p>
The<b> BuildSecurityDescriptor</b> function allocates and initializes a new security descriptor. A security descriptor is an opaque structure that contains the security information associated with an object. The function can initialize the new security descriptor by merging specified security information with the information in an existing security descriptor. If you don't specify an existing security descriptor, the function initializes a new security descriptor based on the specified security information. </p>
<p>
<b>BuildSecurityDescriptor</b> creates a self-relative security descriptor, which means that the security descriptor stores a <a href="accctrl_6i5u.htm"><b>SECURITY_DESCRIPTOR</b></a> structure and associated security information in a contiguous block of memory. The self-relative format makes the security descriptor suitable for storing in a stream. </p>
<pre><code><b>DWORD BuildSecurityDescriptor(
  PTRUSTEE</b><i> pOwner</i><b>,  </b>// identifies owner for new security descriptor
<b>  PTRUSTEE</b><i> pGroup</i><b>,  </b>// identifies group for new security descriptor
<b>  ULONG</b><i> cCountOfAccessEntries</i><b>,</b>
<b>                    </b>// number of access-control entries in the list
<b>  PEXPLICIT_ACCESS</b><i> pListOfAccessEntries</i><b>,</b>
<b>                    </b>// pointer to list of access-control entries for 
                    // DACL
<b>  ULONG</b><i> cCountOfAuditEntries</i><b>,</b>
<b>                    </b>// number of audit-control entries in the list
<b>  PEXPLICIT_ACCESS</b><i> pListOfAuditEntries</i><b>,</b>
<b>                    </b>// pointer to list of audit-control entries for 
                    // SACL
<b>  PSECURITY_DESCRIPTOR</b><i> pOldSD</i><b>,</b>
<b>                    </b>// pointer to an existing security descriptor
<b>  PULONG</b><i> pSizeNewSD</i><b>,</b>
<b>                    </b>// pointer to the size of the new security 
                    // descriptor
<b>  PSECURITY_DESCRIPTOR *</b><i> pNewSD</i>
<i>                    </i>// pointer that receives the new security 
                    // descriptor
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>pOwner</i></dt>
<dd>
Pointer to a <a href="accctrl_6hki.htm"><b>TRUSTEE</b></a> structure that identifies the owner for the new security descriptor. If the structure uses the TRUSTEE_IS_NAME form, <b>BuildSecurityDescriptor</b> looks up the <a href="accctrl_5lyq.htm"><b>SID</b></a> associated with the specified trustee name.
<p>
If this parameter is NULL, the function uses the owner SID from the original security descriptor pointed to by <i>pOldSD</i>. If <i>pOldSD</i> is NULL, or if the owner SID in <i>pOldSD</i> is NULL, the owner SID is NULL in the new security descriptor.
</dd>
<dt>
<i>pGroup</i></dt>
<dd>
Pointer to a <b>TRUSTEE</b> structure that identifies the primary group SID for the new security descriptor. If the structure uses the TRUSTEE_IS_NAME form, <b>BuildSecurityDescriptor</b> looks up the SID associated with the specified trustee name.
<p>
If this parameter is NULL, the function uses the group SID from the original security descriptor pointed to by <i>pOldSD</i>. If <i>pOldSD</i> is NULL, or if the group SID in <i>pOldSD</i> is NULL, the group SID is NULL in the new security descriptor.
</dd>
<dt>
<i>cCountOfAccessEntries</i></dt>
<dd>
Specifies the number of <a href="acctlnt4_1xf6.htm"><b>EXPLICIT_ACCESS</b></a> structures in the <i>pListOfAccessEntries</i> array<i>. </i></dd>
<dt>
<i>pListOfAccessEntries</i></dt>
<dd>
Pointer to an array of <b>EXPLICIT_ACCESS</b> structures that describe access control information for the DACL of the new security descriptor. The function creates the new DACL by merging the information in the array with the DACL in <i>pOldSD</i>, if any. If <i>pOldSD</i> is NULL, or if the DACL in <i>pOldSD</i> is NULL, the function creates a new DACL based solely on the information in the array. For a description of the rules for creating an <a href="accctrl_4h6a.htm"><b>ACL</b></a> from an array of <b>EXPLICIT_ACCESS</b> structures, see the <a href="acctlnt4_9y5o.htm"><b>SetEntriesInAcl</b></a> function. 
<p>
If <i>pListOfAccessEntries</i> is NULL, the new security descriptor gets the DACL from <i>pOldSD</i>. In this case, if <i>pOldSD</i> is NULL, or if the DACL in <i>pOldSD</i> is NULL, the new DACL is NULL.
</dd>
<dt>
<i>cCountOfAuditEntries</i></dt>
<dd>
Specifies the number of <a href="acctlnt4_1xf6.htm"><b>EXPLICIT_ACCESS</b></a> structures in the <i>pListOfAuditEntries</i> array<i>. </i></dd>
<dt>
<i>pListOfAuditEntries</i></dt>
<dd>
Pointer to an array of <b>EXPLICIT_ACCESS</b> structures that describe audit control information for the SACL of the new security descriptor. The function creates the new SACL by merging the information in the array with the SACL in <i>pOldSD</i>, if any. If <i>pOldSD</i> is NULL, or the SACL in <i>pOldSD</i> is NULL, the function creates a new SACL based solely on the information in the array. 
<p>
If <i>pListOfAuditEntries</i> is NULL, the new security descriptor gets the SACL from <i>pOldSD</i>. In this case, if <i>pOldSD</i> is NULL, or the SACL in <i>pOldSD</i> is NULL, the new SACL is NULL.
</dd>
<dt>
<i>pOldSD</i></dt>
<dd>
Pointer to an existing self-relative <a href="accctrl_6i5u.htm"><b>SECURITY_DESCRIPTOR</b></a> structure and its associated security information. The function builds the new security descriptor by merging the specified owner, group, access-control, and audit-control information with the information in this security descriptor. This parameter can be NULL.</dd>
<dt>
<i>pSizeNewSD</i></dt>
<dd>
Pointer to a <b>ULONG</b> variable that receives the size, in bytes, of the returned security descriptor.</dd>
<dt>
<i>pNewSD</i></dt>
<dd>
Pointer to a variable that receives a pointer to the new security descriptor. The function allocates memory for the new security descriptor. You must call the <a href="memman_2339.htm"><b>LocalFree</b></a> function to free the returned buffer.
</dd>
</dl>
<h4>Return Values</h4>
<p>
If the function succeeds, the return value is ERROR_SUCCESS.</p>
<p>
If the function fails, the return value is a nonzero error code defined in WINERROR.H. </p>
<h4>Remarks</h4>
<p>
The <b>BuildSecurityDescriptor</b> function is intended for trusted servers that implement or expose security on their own objects. The function uses self-relative security descriptors suitable for serializing into a stream and storing to disk, as a trusted server might require. </p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 4.0 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in aclapi.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use advapi32.lib.<br>
<b>&nbsp;&nbsp;Unicode: </b>Implemented as Unicode and ANSI versions on Windows NT.</p>
<h4>See Also</h4>
<p>
<a href="accclsrv_64vg.htm">Client/Server Access Control Overview</a>, <a href="accclsrv_0hv7.htm">Client/Server Access Control Functions</a>, <a href="accctrl_4h6a.htm"><b>ACL</b></a>, <a href="acctlnt4_1xf6.htm"><b>EXPLICIT_ACCESS</b></a>, <a href="memman_2339.htm"><b>LocalFree</b></a>, <a href="accctrl_6i5u.htm"><b>SECURITY_DESCRIPTOR</b></a>, <a href="acctlnt4_9y5o.htm"><b>SetEntriesInAcl</b></a>, <a href="accctrl_5lyq.htm"><b>SID</b></a>, <a href="accctrl_6hki.htm"><b>TRUSTEE</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
