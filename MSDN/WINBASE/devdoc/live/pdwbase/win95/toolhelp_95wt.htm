<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Snapshots of the System</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_win32_snapshots_of_the_system"></a>Snapshots of the System</h2>
<p>
Snapshots are at the core of the tool help functions. A snapshot is a read-only copy of the current state of one or more of the following lists that reside in system memory: processes, threads, modules, and heaps. </p>
<p>
Processes that use tool help functions access these lists from snapshots instead of directly from the operating system. The lists in system memory change when processes are started and ended, threads are created and destroyed, executable modules are loaded and unloaded from system memory, and heaps are created and destroyed. The use of information from a snapshot prevents inconsistencies. Otherwise, changes to a list could possibly cause a thread to incorrectly traverse the list or cause an access violation (a GP fault). For example, if an application traverses the thread list while other threads are created or terminated, information that the application is using to traverse the thread list might become outdated and could cause an error for the application traversing the list.</p>
<p>
You can take a snapshot of the system memory by using the <a href="toolhelp_5450.htm"><b>CreateToolhelp32Snapshot</b></a> function. You can control the content of a snapshot by specifying one or more of the following values when calling this function: 
<ul>
<li>
TH32CS_SNAPHEAPLIST </li>
<li>
TH32CS_SNAPMODULE </li>
<li>
TH32CS_SNAPPROCESS </li>
<li>
TH32CS_SNAPTHREAD </li>
</ul>
<p>
The TH32CS_SNAPHEAPLIST and TH32CS_SNAPMODULE values are process specific. When these values are specified, the heap and module lists of the specified process are included in the snapshot. If you specify zero as the process identifier, the current process is used. The TH32CS_SNAPTHREAD value always creates a system-wide snapshot even if a process identifier is passed to <b>CreateToolhelp32Snapshot</b>.</p>
<p>
You can enumerate the heap or module state for all processes by specifying the TH32CS_SNAPALL value and the current process. Then, for each process in the snapshot that is not the current process, you can call <a href="toolhelp_5450.htm"><b>CreateToolhelp32Snapshot</b></a> again, specifying the process identifier and the TH32CS_SNAPHEAPLIST or TH32CS_SNAPMODULE value.</p>
<p>
You can retrieve an extended error status code for <b>CreateToolhelp32Snapshot</b> by using the <a href="../errors_3uwi.htm"><b>GetLastError</b></a> function. </p>
<p>
When your process finishes using a snapshot, you should destroy it by using the <a href="../handobj_289x.htm"><b>CloseHandle</b></a> function. Not destroying a snapshot causes the process to leak memory until the process exits, at which time the system reclaims the memory. </p>
<p>
<b>Note</b>  The snapshot handle acts like a file handle and is subject to the same rules regarding which processes and threads it is valid in.</p>
<p>&nbsp;</p></body>
</HTML>
