<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Device Messages and Device Change Events</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_win32_device_messages_and_device_change_events"></a>Device Messages and Device Change Events</h2>
<p>
Device messages are system messages that notify applications and other components of device change events. These events occur whenever the system detects a change to the system hardware such as when the user docks or undocks a laptop computer, or inserts or removes a device such as a PCMCIA card. Change events can occur while the system is running or when the system resumes operation after temporarily being suspended.</p>
<p>
To help ensure that applications and installable drivers do not lose data when devices become unavailable, the system monitors the hardware configuration and sends device message to the applications and installable drivers to notify them of the changes and to give them the opportunity to prepare for the changes before they occur. </p>
<p>
For each event, the system broadcasts a <a href="sysmsgs_9vhh.htm">WM_DEVICECHANGE</a> message to all applications and installable drivers. In this message, the <i>wParam</i> parameter identifies the event type and the <i>lParam</i> parameter is usually the address of event-specific data. </p>
<p>
The event-specific data identifies the device and provides additional detail about the event. The format of this data depends on the device type, but the first few bytes always has the same format as the <a href="sysmsgs_43jm.htm"><b>DEV_BROADCAST_HDR</b></a> structure. This means you can always check the <b>dbch_devicetype</b> member in the data to determine the device type.</p>
<p>
The system sends a <a href="sysmsgs_0818.htm">DBT_DEVICEARRIVAL</a> message (that is, a WM_DEVICECHANGE message with <i>wParam</i> set to DBT_DEVICEARRIVAL) whenever a device has been inserted and is available for use. Applications typically check the device type and begin using the device immediately if appropriate.</p>
<p>
The system sends a <a href="sysmsgs_1qzp.htm">DBT_DEVICEQUERYREMOVE</a> message to request permission to remove a device. If an application determines that it needs the device, it can deny this request and cancel the removal by returning BROADCAST_QUERY_DENY. To determine whether it needs the device, an application can display a dialog box to prompt the user for instructions. If the application does not need the device, it must return TRUE. The system immediately sends a <a href="sysmsgs_1xr8.htm">DBT_DEVICEQUERYREMOVEFAILED</a> message if any application or driver canceled a previous request to remove a device. </p>
<p>
The system sends a <a href="sysmsgs_9hbb.htm">DBT_DEVICEREMOVEPENDING</a> message as a last warning before a device is removed. At this point, the application cannot cancel the removal, so if it is using the device it must prepare for its removal to prevent loss of data. This is especially important when a network connection is being removed. The application must determine whether any of its open files or pipes are on that connection. It can do this by comparing the network resource identifier in the event-specific data of the message with the resource identifiers previously obtained for the files and pipes. The system sends a <a href="sysmsgs_0c11.htm">DBT_DEVICEREMOVECOMPLETE</a> message when a device has been removed and is no longer available.</p>
<p>
The system sends a <a href="sysmsgs_7ajr.htm">DBT_QUERYCHANGECONFIG</a> message to request permission to change the current configuration (dock or undock). Any application can return BROADCAST_QUERY_DENY to deny the request and cancel the change. If an application denies the request, the system sends a <a href="sysmsgs_3gro.htm">DBT_CONFIGCHANGECANCELED</a> message. If the current configuration has changed, due to a dock or undock, the system sends a <a href="sysmsgs_25gk.htm">DBT_CONFIGCHANGED</a> message. </p>
<p>
The system sends <a href="sysmsgs_32g3.htm">DBT_DEVICETYPESPECIFIC</a> message whenever a device-specific event occurs. </p>
<p>&nbsp;</p></body>
</HTML>
