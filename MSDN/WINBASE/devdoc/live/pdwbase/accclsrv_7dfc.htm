<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>CreatePrivateObjectSecurityEx</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_createprivateobjectsecurityex"></a>CreatePrivateObjectSecurityEx</h1>
<p>
<span style=color:#FF0000>[This is preliminary documentation and subject to change.]</span> </p>
<p>
The <b>CreatePrivateObjectSecurityEx</b> function allocates and initializes a self-relative security descriptor for a new private object. A protected server calls this function when it creates a new private object. </p>
<p>
The <b>CreatePrivateObjectSecurityEx</b> function is identical to the <b>CreatePrivateObjectSecurity</b> function except for the following:
<ul>
<li>
<b>CreatePrivateObjectSecurityEx</b> can specify the object type GUID of the new object</li>
<li>
<b>CreatePrivateObjectSecurityEx</b> can specify flags that control how ACEs are inherited from the security descriptor of the parent container.</li>
</ul>
<pre><code><b>BOOL CreatePrivateObjectSecurityEx(
  PSECURITY_DESCRIPTOR</b><i> ParentDescriptor</i><b>, </b>
<b>                            </b>// security descriptor of parent object
<b>  PSECURITY_DESCRIPTOR</b><i> CreatorDescriptor</i><b>, </b>
<b>                            </b>// current security descriptor of object
<b>  PSECURITY_DESCRIPTOR </b>*<i>NewDescriptor</i><b>, </b>
<b>                            </b>// receives the new security descriptor
<b>  GUID *</b><i> ObjectType</i><b>,        </b>// type of object
<b>  BOOL</b><i> IsContainerObject</i><b>,   </b>// identifies container objects
<b>  ULONG</b><i> AutoInheritFlags</i><b>,   </b>// identifies container objects
<b>  HANDLE</b><i> Token</i><b>,             </b>// identifies container objects
<b>  PGENERIC_MAPPING</b><i> GenericMapping</i><b>  </b>// map generic to specific rights
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>ParentDescriptor</i></dt>
<dd>
Pointer to the security descriptor for the parent container of the object. If there is no parent container, this parameter is NULL. </dd>
<dt>
<i>CreatorDescriptor</i></dt>
<dd>
Pointer to a security descriptor provided by the creator of the object. If the object's creator does not explicitly pass security information for the new object, this parameter can be NULL. Alternatively, this parameter can point to a default security descriptor.</dd>
<dt>
<i>NewDescriptor</i></dt>
<dd>
Pointer to a variable that receives a pointer to the newly allocated self-relative security descriptor. The caller must call the <a href="accclsrv_4ozd.htm"><b>DestroyPrivateObjectSecurity</b></a> function to free this security descriptor.</dd>
<dt>
<i>ObjectType</i></dt>
<dd>
Pointer to a <object id=alink_1 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="DefaultTopic" value="../../notopic_0pk4.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_rpc_guid">
</object><a href=JavaScript:alink_1.Click()><b>GUID</b></a> structure that identifies the type of object associated with <i>CurrentSecurityDescriptor</i>. Set <i>ObjectType</i> to NULL if the object does not have a GUID.</dd>
<dt>
<i>IsContainerObject</i></dt>
<dd>
Specifies whether the new object can contain other objects. A value of TRUE indicates that the new object is a container. A value of FALSE indicates that the new object is not a container.</dd>
<dt>
<i>AutoInheritFlags</i></dt>
<dd>
A set of bit flags that control how ACEs are inherited from <i>ParentDescriptor</i>. This parameter can be a combination of the following values. 
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=16%>Value</th>
<th align=left width=84%>Meaning</th>
</tr>
<tr valign=top>
<td colspan=2 width=100%>SEF_DACL_AUTO_INHERIT</td>
</tr>
<tr valign=top>
<td width=16%></td>
<td width=84%>If this flag is set, the new DACL contains ACEs inherited from the DACL of the <i>ParentDescriptor</i>, as well as any explicit ACEs specified in the DACL of the <i>CreatorDescriptor</i>. If this flag is not set, the new DACL does not inherit ACEs.</td>
</tr>
<tr valign=top>
<td colspan=2 width=100%>SEF_SACL_AUTO_INHERIT</td>
</tr>
<tr valign=top>
<td width=16%></td>
<td width=84%>If this flag is set, the new SACL contains ACEs inherited from the SACL of the <i>ParentDescriptor</i>, as well as any explicit ACEs specified in the SACL of the <i>CreatorDescriptor</i>. If this flag is not set, the new SACL does not inherit ACEs.</td>
</tr>
<tr valign=top>
<td colspan=2 width=100%>SEF_DEFAULT_DESCRIPTOR_FOR_OBJECT</td>
</tr>
<tr valign=top>
<td width=16%></td>
<td width=84%>If this flag is set, the <i>CreatorDescriptor</i> is the default descriptor for the type of object specified by <i>ObjectType</i>. As such, the <i>CreatorDescriptor</i> is ignored if the <i>ParentDescriptor</i> has any object-specific ACEs for the type of object specified by the <i>ObjectType</i>-parameter. If no such ACEs are inherited, the <i>CreatorDescriptor</i> is handled as though this flag were not specified.</td>
</tr>
<tr valign=top>
<td colspan=2 width=100%>SEF_AVOID_PRIVILEGE_CHECK</td>
</tr>
<tr valign=top>
<td width=16%></td>
<td width=84%>If this flag is set, the function does not perform privilege checking. The <i>Token</i> parameter can be NULL. This flag is useful while implementing automatic inheritance to avoid checking privileges on each child updated.</td>
</tr>
</table><br>

</dd>
<dt>
<i>Token</i></dt>
<dd>
Identifies the access token for the client process on whose behalf the object is being created. If this is an impersonation token, it must be at SecurityIdentification level or higher. For a full description of the SecurityIdentification impersonation level, see the <a href="accclsrv_1rsi.htm"><b>SECURITY_IMPERSONATION_LEVEL</b></a> enumerated type.
<p>
The client token contains default security information, such as the default owner, primary group, and DACL. The function uses these defaults if the information is not in the input security descriptors. The token must be open for TOKEN_QUERY access. 
</dd>
<dt>
<i>GenericMapping</i></dt>
<dd>
Pointer to a <a href="accclsrv_29rm.htm"><b>GENERIC_MAPPING</b></a> structure that specifies the mapping from each generic right to specific rights for the object. 
</dd>
</dl>
<h4>Return Values</h4>
<p>
If the function succeeds, the return value is nonzero.</p>
<p>
If the function fails, the return value is zero. To get extended error information, call <a href="errors_3uwi.htm"><b>GetLastError</b></a>. </p>
<h4>Remarks</h4>
<p>
The <a href="accclsrv_5vcp.htm"><b>CreatePrivateObjectSecurity</b></a> function is identical to calling the <b>CreatePrivateObjectSecurityEx</b> function with <i>ObjectType</i> set to NULL and <i>AutoInheritFlags</i> set to zero. </p>
<p>
The <i>AutoInheritFlags</i> are distinct from the similarly named bits in the <b>Control</b> member of the <a href="accctrl_6i5u.htm"><b>SECURITY_DESCRIPTOR</b></a> structure. For an explanation of the control bits, see <a href="acctrlow_7u5u.htm"><b>SECURITY_DESCRIPTOR_CONTROL</b></a>.</p>
<p>
If <i>AutoInheritFlags</i> specifies the SEF_DACL_AUTO_INHERIT bit, the function applies the following rules to the DACL in the new security descriptor:
<ul>
<li>
The SE_DACL_AUTO_INHERITED flag is set in the <b>Control</b> member of the new security descriptor.</li>
<li>
The DACL of the new security descriptor inherits ACEs from the <i>ParentDescriptor</i> regardless of whether <i>CreatorDescriptor</i> is the default security descriptor or was explicitly specified by the creator. The new DACL is a combination of the parent and creator DACLs as defined by the rules of inheritance. </li>
<li>
Inherited ACEs are marked as INHERITED_ACE.</li>
</ul>
<p>
If <i>AutoInheritFlags</i> specifies the SEF_SACL_AUTO_INHERIT bit, the function applies similar rules to the new SACL.</p>
<p>
To create a security descriptor for a new object, call <b>CreatePrivateObjectSecurityEx</b> with <i>ParentDescriptor</i> set to the security descriptor of the parent container and <i>CreatorDescriptor</i> set to the security descriptor proposed by the creator of the object. </p>
<p>
To verify the current security descriptor on an object, call <b>CreatePrivateObjectSecurityEx</b> with <i>ParentDescriptor</i> set to the security descriptor of the parent container and <i>CreatorDescriptor</i> set to the current security descriptor of the object. This call ensures that the ACEs are appropriately inherited from parent to child security descriptors. </p>
<p>
If the <i>CreatorDescriptor</i> security descriptor contains a SACL, <i>Token</i> must have the SE_SECURITY_NAME privilege enabled, and the caller's token must have the SE_AUDIT_NAME privilege enabled. The <b>CreatePrivateObjectSecurityEx</b> function checks these privileges, and may generate audits if they are not enabled. </p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 5.0 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in winbase.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use advapi32.lib.</p>
<h4>See Also</h4>
<p>
<a href="accclsrv_64vg.htm">Client/Server Access Control Overview</a>, <a href="accclsrv_0hv7.htm">Client/Server Access Control Functions</a>, <a href="accclsrv_4ozd.htm"><b>DestroyPrivateObjectSecurity</b></a>, <a href="accclsrv_29rm.htm"><b>GENERIC_MAPPING</b></a>, <a href="accclsrv_87p5.htm"><b>GetPrivateObjectSecurity</b></a>, <a href="accctrl_2jvy.htm"><b>GetTokenInformation</b></a>, <a href="accctrl_0zam.htm"><b>OpenProcessToken</b></a>, <a href="accctrl_6i5u.htm"><b>SECURITY_DESCRIPTOR</b></a>, <a href="accclsrv_1rsi.htm"><b>SECURITY_IMPERSONATION_LEVEL</b></a>, <a href="accclsrv_2xx4.htm"><b>SetPrivateObjectSecurityEx</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
