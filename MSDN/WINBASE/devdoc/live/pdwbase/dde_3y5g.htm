<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Notifying the Client that Data Has Changed</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_win32_notifying_the_client_that_data_has_changed"></a>Notifying the Client that Data Has Changed</h3>
<p>
When the client establishes a link by using the <a href="dde_73j9.htm">WM_DDE_ADVISE</a> message, with the <b>fDeferUpd</b> member not set (that is, equal to zero) in the <a href="dde_9f1u.htm"><b>DDEDATA</b></a> structure, the client has requested the server send the data item each time the item's value changes. In such cases, the server renders the new value of the data item in the previously specified format and sends the client a <a href="dde_3kkh.htm">WM_DDE_DATA</a> message, as shown in the following example. </p>
<pre><code>// Allocate the size of a DDE data header, plus data (a string), 
// plus a &lt;CR&gt;&lt;LF&gt;&lt;NULL&gt; 
 
if (!(hData = GlobalAlloc(GMEM_MOVEABLE | GMEM_DDESHARE, 
        sizeof(DDEDATA) + lstrlen(szItemValue) + 3))) 
{
    return; 
}
if (!(lpData = (DDEDATA FAR*) GlobalLock(hData))) 
{ 
    GlobalFree(hData); 
    return; 
} 

lpData-&gt;fAckReq = bAckRequest;       // as in original WM_DDE_ADVISE 
lpData-&gt;cfFormat = CF_TEXT; 
lstrcpy(lpData-&gt;Value, szItemValue); // copies value to be sent 
lstrcat(lpData-&gt;Value, "\r\n");      // CR/LF for CF_TEXT format 
GlobalUnlock(hData); 

if ((atomItem = GlobalAddAtom(szItemName)) != 0) 
{ 
    if (!PostMessage(hwndClientDDE, 
            WM_DDE_DATA, 
            (WPARAM) hwndServerDDE, 
            PackDDElParam(WM_DDE_DATA, (UINT) hData, atomItem))) 
    { 
        GlobalFree(hData); 
        GlobalDeleteAtom(atomItem); 
        FreeDDElParam(WM_DDE_DATA, lParam); 
    } 
} 
 
if (atomItem == 0) 
{ 

    // Handle errors. 
 
} 
 </code></pre>
<p>
In this example, the client processes the item value as appropriate. If the <b>fAckReq</b> flag for the item is set, the client sends the server a positive <a href="dde_678r.htm">WM_DDE_ACK</a> message. </p>
<p>
When the client establishes the link, with the <b>fDeferUpd</b> member set (that is, equal to 1), the client has requested that only a notification, not the data itself, be sent each time the data changes. In such cases, when the item value changes, the server does not render the value but simply sends the client a <a href="dde_3kkh.htm">WM_DDE_DATA</a> message with a null data handle, as illustrated in the following example. </p>
<pre><code>if (bDeferUpd)      // check whether flag was set in WM_DDE_ADVISE
{
    if ((atomItem = GlobalAddAtom(szItemName)) != 0) 
    { 
        if (!PostMessage(hwndClientDDE, 
                WM_DDE_DATA, 
                (WPARAM) hwndServerDDE, 
                PackDDElParam(WM_DDE_DATA, 0, 
                    atomItem)))                  // NULL data
        {
            GlobalDeleteAtom(atomItem); 
            FreeDDElParam(WM_DDE_DATA, lParam); 
        } 
    } 
} 
 
if (atomItem == 0) 
{ 

     // Handle errors. 

} 
 </code></pre>
<p>
As necessary, the client can request the latest value of the data item by issuing a normal <a href="dde_3gvo.htm">WM_DDE_REQUEST</a> message, or it can simply ignore the notice from the server that the data has changed. In either case, if <b>fAckReq</b> is equal to 1, the client is expected to send a positive <a href="dde_678r.htm">WM_DDE_ACK</a> message to the server. </p>
<p>&nbsp;</p></body>
</HTML>
