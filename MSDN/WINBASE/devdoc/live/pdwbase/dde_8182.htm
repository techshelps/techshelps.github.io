<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Submitting an Item to the Server</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_win32_submitting_an_item_to_the_server"></a>Submitting an Item to the Server</h3>
<p>
The client may send an item value to the server by using the <a href="dde_27mt.htm">WM_DDE_POKE</a> message. The client renders the item to be sent and sends the WM_DDE_POKE message, as illustrated in the following example. </p>
<pre><code>if (!(hPokeData = GlobalAlloc(GMEM_MOVEABLE | GMEM_DDESHARE, 
        (LONG) sizeof(DDEPOKE) + lstrlen(szValue) + 2))) 
{
    return; 
}
 
if (!(lpPokeData = (DDEPOKE FAR*) GlobalLock(hPokeData))) 
{ 
    GlobalFree(hPokeData); 
    return; 
} 
 
lpPokeData-&gt;fRelease = TRUE; 
lpPokeData-&gt;cfFormat = CF_TEXT; 
lstrcpy((LPSTR) lpPokeData-&gt;Value, (LPSTR) szValue); 
 
// Each line of CF_TEXT data is terminated by CR/LF. 
 
lstrcat((LPSTR) lpPokeData-&gt;Value, (LPSTR) "\r\n"); 
GlobalUnlock(hPokeData); 
if ((atomItem = GlobalAddAtom((LPSTR) szItem)) != 0) 
{ 
 
        if (!PostMessage(hwndServerDDE, 
                WM_DDE_POKE, 
                (WPARAM) hwndClientDDE, 
                PackDDElParam(WM_DDE_POKE, (UINT) hPokeData, 
                    atomItem))) 
        { 
            GlobalDeleteAtom(atomItem); 
            GlobalFree(hPokeData); 
        } 
} 
 
if (atomItem == 0) 
{ 

    // Handle errors. 

} 
</code></pre>
<p>
<b>Note</b>&nbsp;&nbsp;Sending data by using a <a href="dde_27mt.htm">WM_DDE_POKE</a> message is essentially the same as sending it by using <a href="dde_3kkh.htm">WM_DDE_DATA</a>, except that WM_DDE_POKE is sent from the client to the server. </p>
<p>
If the server is able to accept the data-item value in the format rendered by the client, the server processes the item value as appropriate and sends the client a positive <a href="dde_678r.htm">WM_DDE_ACK</a> message. If it is unable to process the item value, because of its format or for other reasons, the server sends the client a negative WM_DDE_ACK message. </p>
<pre><code>UnpackDDElParam(WM_DDE_POKE, lParam, (PUINT) &amp;hPokeData, 
    (PUINT) &amp;atomItem); 
GlobalGetAtomName(atomItem, szItemName, ITEM_NAME_MAX_SIZE); 
if (!(lpPokeData = (DDEPOKE FAR*) GlobalLock(hPokeData)) 
        || lpPokeData-&gt;cfFormat != CF_TEXT 
        || !IsItemSupportedByServer(szItemName)) 
{ 
    PostMessage(hwndClientDDE, 
        WM_DDE_ACK, 
        (WPARAM) hwndServerDDE, 
        PackDDElParam(WM_DDE_ACK, 0, atomItem)); // negative ACK  
} 
 
lstrcpy(szItemValue, lpPokeData-&gt;Value); // copies value 
bRelease = lpPokeData-&gt;fRelease; 
GlobalUnlock(hPokeData); 
if (bRelease) 
{ 
    GlobalFree(hPokeData); 
} 
 
PostMessage(hwndClientDDE, 
    WM_DDE_ACK, 
    (WPARAM) hwndServerDDE, 
    PackDDElParam(WM_DDE_ACK, 
         0x8000, atomItem));    // positive ACK 
 </code></pre>
<p>
In this example, the server calls <a href="atoms_9mlh.htm"><b>GlobalGetAtomName</b></a> to retrieve the name of the item the client sent. The server then determines whether it supports the item and whether the item is rendered in the correct format (that is, CF_TEXT). If the item is not supported and not rendered in the correct format, or if the server cannot lock the memory for the data, the server sends a negative acknowledgment back to the client application. Note that in this case, sending a negative acknowledgement is correct because <a href="dde_27mt.htm">WM_DDE_POKE</a> messages are always assumed to have the <b>fAckReq</b> member set. The server should ignore the member. </p>
<p>
If a server sends a negative acknowledgement in response to a WM_DDE_POKE message, the client is responsible for freeing the memory (but not the <i>lParam</i> parameter) referenced by the WM_DDE_POKE message associated with the negative acknowledgement. </p>
<p>&nbsp;</p></body>
</HTML>
