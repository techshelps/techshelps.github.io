<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Composition String</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_win32_composition_string"></a>Composition String</h2>
<p>
The composition string is the current text in the composition window. This is the text that the IME converts to final characters. Each composition string consists of one or more <i>clauses</i>, where a clause is the smallest combination of characters that the IME can convert to a final character. You can get and set the composition string and get and set the composition string by using the <a href="ime_9753.htm"><b>ImmGetCompositionString</b></a> and <a href="ime_5vqf.htm"><b>ImmSetCompositionString</b></a> functions.</p>
<p>
As the user enters text in the composition window, the IME tracks the status of the composition string. This status includes attribute information, clause information, typing information, and cursor position. You can retrieve the composition status by using the <b>ImmGetCompositionString</b> function. </p>
<p>
In the <i>attribute information</i> array, all characters of one clause must have the same attribute. The <i>attribute information</i> is an array of 8-bit values that specifies the status of characters in the composition string. There is one value for each byte in the string, including one byte each for the lead and second bytes of any double-byte characters in the string. For each value in the array, bits 0 through 3 can be one combination of these values:</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<td colspan=2 width=100%>ATTR_INPUT</td>
</tr>
<tr valign=top>
<td width=12%></td>
<td width=88%>Character being entered by the user. It is yet to be converted by the IME.</td>
</tr>
<tr valign=top>
<td colspan=2 width=100%>ATTR_INPUT_ERROR</td>
</tr>
<tr valign=top>
<td width=12%></td>
<td width=88%>Character is the error character and cannot be converted by the IME.</td>
</tr>
<tr valign=top>
<td colspan=2 width=100%>ATTR_TARGET_CONVERTED</td>
</tr>
<tr valign=top>
<td width=12%></td>
<td width=88%>Character converted by the IME. The user has selected this character and the IME has converted it.</td>
</tr>
<tr valign=top>
<td colspan=2 width=100%>ATTR_CONVERTED</td>
</tr>
<tr valign=top>
<td width=12%></td>
<td width=88%>A converted character. The IME has already converted this character.</td>
</tr>
<tr valign=top>
<td colspan=2 width=100%>ATTR_TARGET_NOTCONVERTED</td>
</tr>
<tr valign=top>
<td width=12%></td>
<td width=88%>Character being converted. The user has selected this character but the IME has not yet converted it. </td>
</tr>
<tr valign=top>
<td colspan=2 width=100%>ATTR_FIXEDCONVERTED</td>
</tr>
<tr valign=top>
<td width=12%></td>
<td width=88%>Characters that will not be converted. The IME will not convert these characters anymore.</td>
</tr>
</table><br>
<p>
All other values are reserved. In Japanese, any unconverted character having the ATTR_INPUT attribute is a Hiragana, Katakana, or alphanumeric character. In Korean, this character is a Hangeul character that is not converted by IME yet. In Traditional and Simplified Chinese, each IME may limit its character in some range.</p>
<p>
You can retrieve the composition status by using the <b>ImmGetCompositionString</b> function.</p>
<p>
The <i>clause information</i> is an array of 32-bit values that specify the positions of the clauses in the composition string. There is one value for each clause and a final value that specifies the length of the full string. Each value in the array specifies the offset, in bytes, from the beginning of the string to the clause. The first value is always 0 because the first clause always starts at the beginning of the string. For example, if a string has two clauses, the clause information has three values: the first value is 0, the second value is the offset of the second clause, and the third value is the length of the string.</p>
<p>
The <i>typing information</i> a null-terminated character string representing the characters entered at the keyboard. </p>
<p>
The <i>cursor position</i> is a value indicating the position of the cursor relative to the characters in the composition string. The value is the offset, in bytes, from the beginning of the string. If this value is 0, the cursor is immediately before the first character in the string. If the value is equal to the length of the string, the cursor is immediately after the last character. If -1, the cursor is not present.</p>
<p>
You can set the composition string or elements of the composition status by using the <a href="ime_5vqf.htm"><b>ImmSetCompositionString</b></a> function. To ensure that the composition window updates it appearance based on these changes, the function allows for generating a notification message to be sent to the window. Applications that set a combination of composition status elements typically set the <i>fNotify</i> parameter to FALSE for all but the last call to this function so that only one notification message is generated for the composition window. </p>
<p>
Finally, the edit control supports two messages for changing the IME's handling of composition strings. See <object id=alink_1 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="DefaultTopic" value="../../notopic_0pk4.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_win32_em_getimestatus">
</object><a href=JavaScript:alink_1.Click()>EM_GETIMESTATUS</a> and <object id=alink_2 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="DefaultTopic" value="../../notopic_0pk4.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_win32_em_setimestatus">
</object><a href=JavaScript:alink_2.Click()>EM_SETIMESTATUS</a> for more information. For more information on the edit control, see <object id=alink_3 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="DefaultTopic" value="../../notopic_0pk4.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_win32_edit_controls">
</object><a href=JavaScript:alink_3.Click()>Edit Controls</a>.</p>
<p>&nbsp;</p></body>
</HTML>
