<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Modifying an Object's ACLs</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_win32_modifying_an_object_s_acls"></a>Modifying an Object's ACLs</h2>
<p>
<span style=color:#FF0000>[This is preliminary documentation and subject to change.]</span> </p>
<p>
The following example adds an access-denied ACE to the DACL of an object. The example uses the <a href="accctrl_5ghk.htm"><b>GetNamedSecurityInfoEx</b></a> function to get the access-control information from the existing DACL. Then it initializes an <a href="accctrl_2xgy.htm"><b>ACTRL_ACCESS_ENTRY</b></a> structure with information about the access-denied ACE to be added. The <a href="accctrl_8khg.htm"><b>SetEntriesInAccessList</b></a> function merges the new ACE information into the existing access-control information. The example then calls the <a href="accctrl_9jqw.htm"><b>SetNamedSecurityInfoEx</b></a> function to set the new access-control information in the object's DACL.</p>
<pre><code>ACTRL_ACCESS_ENTRY      AccessEntry;
PACTRL_ACCESS           pOldAccessList, pNewAccessList;
DWORD                   dwErr;

// Get the current DACL information from the object.

dwRes = GetNamedSecurityInfoEx(
    TEXT("myfile"),    // name of the object
    </code>SE_FILE_OBJECT<code>,    // type of object</code>
<code>    DACL_SECURITY_INFORMATION,   // type of information to set</code>
<code>    NULL,              // provider is Windows NT</code>
<code>    NULL,              // name or GUID of property or property set</code>
<code>    &amp;pOldAccessList,   // receives existing DACL information </code>
<code>    NULL,              // receives existing SACL information </code>
<code>    NULL,              // receives name of owner</code>
<code>    NULL);             // receives name of group</code>

<code>// Initialize the access list entry.</code>

<code>ZeroMemory(&amp;AccessEntry, sizeof(ACTRL_ACCESS_ENTRY) );</code>
<code>BuildTrusteeWithName(&amp;(AccessEntry.Trustee), "ludwig");</code>
<code>AccessEntry.Inheritance = NO_INHERITANCE;</code>
<code>AccessEntry.fAccessFlags = ACTRL_ACCESS_DENIED;</code>

<code>// Set provider-independent standard rights.</code>

<code>AccessEntry.Access = ACTRL_READ_CONTROL | ACTRL_SYNCHRONIZE | </code>
<code>    ACTRL_CHANGE_ACCESS | ACTRL_DELETE; </code>

<code>// Set provider-independent rights for file objects.</code>

<code>AccessEntry.Access |= ACTRL_FILE_READ | ACTRL_FILE_READ_ATTRIB | </code>
<code>    ACTRL_FILE_READ_PROP |</code> <code>ACTRL_FILE_WRITE | </code>
<code>    ACTRL_FILE_APPEND | ACTRL_FILE_WRITE_ATTRIB | </code>
<code>    ACTRL_FILE_WRITE_PROP;</code>

<code>// Build an access list from the access list entry.</code>

<code>dwErr = SetEntriesInAccessList(</code>
<code>     1,                  // Number of entries in array</code>
<code>     AccessEntry,        // array of entries</code>
<code>     SET_ACCESS,         // replace any existing items</code>
<code>     NULL,               // property name</code>
<code>     pOldAccessList,     // existing access list</code>
<code>     &amp;pNewAccessList);   // new access list</code>

<code>// Set the access-control information in the object's DACL.</code>

<code>dwRes = SetNamedSecurityInfoEx(</code>
<code>    TEXT("myfile"),              // name of the object</code>
<code>    SE_FILE_OBJECT,              // type of object</code>
<code>    DACL_SECURITY_INFORMATION,   // type of information to set</code>
<code>    NULL,                        // name of provider</code>
<code>    pNewAccessList,              // new access list </code>
<code>    NULL,                        // audit list</code>
<code>    NULL,                        // name of owner</code>
<code>    NULL,                        // name of group</code>
<code>    NULL);                       // pointer to OVERLAPPED structure</code>

<code>// Free the returned buffers.</code>

<code>if (pOldAccessList) </code>
<code>    LocalFree(pOldAccessList);</code>
<code>if (pNewAccessList) </code>
<code>    LocalFree(pNewAccessList);</code>
<code> </code></pre>
<p>
You can use similar code to remove all ACEs for a specified trustee. Initialize an <a href="accctrl_2xgy.htm"><b>ACTRL_ACCESS_ENTRY</b></a> structure to identify the trustee, then call <a href="accctrl_8khg.htm"><b>SetEntriesInAccessList</b></a> function with the REVOKE_ACCESS flag. </p>
<p>
The code to modify an object's SACL is similar except that it uses the <a href="accctrl_4eno.htm"><b>SetEntriesInAuditList</b></a> function and the <a href="accctrl_5vn6.htm"><b>ACTRL_AUDIT</b></a> structure.</p>
<p>
For securable objects, such as DS objects, you can use similar code to add <a href="accctrl_17zn.htm">object-specific ACEs</a> to an object's ACL. To add object-specific ACEs, you need to create an array of <b>ACTRL_ACCESS_ENTRY</b> structures and call <b>SetEntriesInAccessList</b> for each property or property set that needs its own ACEs. For example, you would make one <b>SetEntriesInAccessList</b> call to add ACEs that control access to the object itself, and another call to add ACEs that control access to a property on the object. </p>
<p>
Note that the <a href="accctrl_96ig.htm"><b>GetSecurityInfoEx</b></a>, <a href="accctrl_5ghk.htm"><b>GetNamedSecurityInfoEx</b></a>, <a href="accctrl_8r3s.htm"><b>SetSecurityInfoEx</b></a>, and <a href="accctrl_9jqw.htm"><b>SetNamedSecurityInfoEx</b></a> functions allow you to get and set ACL information for a specified type of sub-object. For example, you could call <b>GetSecurityInfoEx</b> to get the ACEs that apply to a specified property on an object, merge in a new ACE for that property, and call <b>SetSecurityInfoEx</b> to attach the modified property-specific ACL information to the object.</p>
<p>
</p>
<p>&nbsp;</p></body>
</HTML>
