<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Termination-Handler Syntax</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_win32_termination_handler_syntax"></a>Termination-Handler Syntax</h3>
<p>
The <b>try</b> and <b>finally</b> keywords are used to construct a termination handler. The following example shows the structure of a <b>try</b>-<b>finally</b> termination handler. </p>
<pre><code>try 
{ 
    // guarded body of code 
 
} 
finally 
{ 
    // finally block 
 
} 
 </code></pre>
<p>
As with the <b>try</b>-<b>except</b> statement, both the <b>try</b> block and the <b>finally</b> block require braces ({}), and using a <b>goto</b> statement to jump into either block is not permitted. </p>
<p>
The <b>try</b> block contains the guarded body of code that is protected by the termination handler. A function can have any number of <b>try</b>-<b>finally</b> statements, and these termination handling structures can be nested within the same function or in different functions. </p>
<p>
The <b>finally</b> block is executed whenever the flow of control leaves the <b>try</b> block. However, the <b>finally</b> block is not executed if you call any of the following functions within the <b>try</b> block: <a href="prothred_8dv7.htm"><b>ExitProcess</b></a>, <a href="prothred_531g.htm"><b>ExitThread</b></a>, or <b>abort</b>. </p>
<p>
The <b>finally</b> block is executed in the context of the function in which the <b>try</b>-<b>finally</b> statement is located. This means that the <b>finally</b> block can access that function's local variables. Execution of the <b>finally</b> block can terminate by any of the following means. 
<ul>
<li>
Execution of the last statement in the block and continuation to the next instruction </li>
<li>
Use of a control statement (<b>return</b>, <b>break</b>, <b>continue</b>, or <b>goto</b>) </li>
<li>
Use of <b>longjmp</b> or a jump to an exception handler </li>
</ul>
<p>
If execution of the <b>try</b> block terminates because of an exception that invokes the exception-handling block of a frame-based exception handler, the <b>finally</b> block is executed before the exception-handling block is executed. Similarly, a call to the <b>longjmp</b> C run-time library function from the <b>try</b> block causes execution of the <b>finally</b> block before execution resumes at the target of the <b>longjmp</b> operation. If <b>try</b> block execution terminates due to a control statement (<b>return</b>, <b>break</b>, <b>continue</b>, or <b>goto</b>), the <b>finally</b> block is executed. </p>
<p>
The <a href="structex_1zxq.htm"><b>AbnormalTermination</b></a> function can be used within the <b>finally</b> block to determine whether the <b>try</b> block terminated sequentially — that is, whether it reached the closing brace (}). Leaving the <b>try</b> block because of a call to <b>longjmp</b>, a jump to an exception handler, or a <b>return</b>, <b>break</b>, <b>continue</b>, or <b>goto</b> statement, is considered an abnormal termination. Note that failure to terminate sequentially causes the system to search through all stack frames in reverse order to determine whether any termination handlers must be called. This can result in performance degradation due to the execution of hundreds of instructions. </p>
<p>
To avoid abnormal termination of the <b>try-finally</b> block, execution should continue to the end of the block. You can also execute the <b>leave</b> statement. The <b>leave</b> statement allows for immediate termination of the <b>try</b> block without causing abnormal termination and its performance penalty. Check your compiler documentation to determine if the <b>leave</b> statement is supported. </p>
<p>
If execution of the <b>finally</b> block terminates because of the <b>return</b> control statement, it is equivalent to a <b>goto</b> to the closing brace in the enclosing function. Therefore, the enclosing function will return. </p>
<p>&nbsp;</p></body>
</HTML>
