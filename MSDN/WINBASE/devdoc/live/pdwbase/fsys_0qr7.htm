<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Sparse File Operations</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_win32_sparse_file_operations"></a>Sparse File Operations</h3>
<p>
<span style=color:#FF0000>[This is preliminary documentation and subject to change.]</span> </p>
<p>
You can determine whether a file system supports sparse files by calling the <a href="fsys_6wfi.htm"><b>GetVolumeInformation</b></a> function and examining the FILE_SUPPORTS_SPARSE_FILES bit flag.</p>
<p>
Most applications are not aware of sparse-files and will not create sparse files. The fact that an application is reading a sparse file is transparent to the application. An application that is aware of sparse-files should determine whether its data set is suitable to be kept in a sparse file. After that determination is made, the application must explicitly declare a file as sparse, using the <a href="devio_5351.htm"><b>FSCTL_SET_SPARSE</b></a> operation.</p>
<p>
After an application has set a file to be sparse, the application can use the <a href="devio_9wbl.htm"><b>FSCTL_SET_ZERO_DATA</b></a> operation to set a region of the file to zero. In addition, the application can use the <a href="devio_056b.htm"><b>FSCTL_QUERY_ALLOCATED_RANGES</b></a> operation to speed searches for nonzero data in the sparse file.</p>
<p>
When you perform a write operation (with a function or operation other than <b>FSCTL_SET_ZERO_DATA</b>) whose data consists nothing but zeros, zeros will be written to the disk for the entire length of the write. To zero out a range of the file and maintain sparseness, use <b>FSCTL_SET_ZERO_DATA</b>.</p>
<p>
A sparse aware application may also set an existing file to be sparse. If an application sets an existing file to be sparse, it should then scan the file for regions which contain zeros, and use <b>FSCTL_SET_ZERO_DATA</b> to reset those regions, and possibly deallocate some physical disk storage. An application upgraded to sparse file awareness should perform this conversion.</p>
<p>
When you perform a read operation from a zeroed-out portion of a sparse file may not read from the hard drive. Instead, the system recognizes that the portion of the file to be read contains zeros, and it returns a buffer full of zeros without actually reading from the disk.</p>
<p>
As with any other file, the system can write data to or read data from any position in a sparse file. Nonzero data being written to a previously zeroed portion of the file may result in allocation of disk space. Zeros being written over nonzero data (with <b>FSCTL_SET_ZERO_DATA</b>) may result in a deallocation of disk space.</p>
<p>
<b>Note</b>&nbsp;&nbsp;It is up to the application to maintain sparseness by writing zeros with <b>FSCTL_SET_ZERO_DATA</b>.</p>
<p>
<b>Note</b>&nbsp;&nbsp;Defragmenting tools which handle compressed files on NTFS file systems will correctly handle sparse files on NTFS 5.0 volumes.</p>
<p>&nbsp;</p></body>
</HTML>
