<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>LockServiceDatabase</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_lockservicedatabase"></a>LockServiceDatabase</h1>
<p>
The <b>LockServiceDatabase</b> function locks the specified service control manager database. </p>
<pre><code><b>SC_LOCK LockServiceDatabase(
  SC_HANDLE</b><i> hSCManager</i>   // handle of service control manager 
                         // database
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>hSCManager</i></dt>
<dd>
Handle to the service control manager database. The <a href="services_4c36.htm"><b>OpenSCManager</b></a> function returns this handle, which must have SC_MANAGER_LOCK access. 
</dd>
</dl>
<h4>Return Values</h4>
<p>
If the function succeeds, the return value is a lock to the specified service control manager database.</p>
<p>
If the function fails, the return value is NULL. To get extended error information, call <a href="errors_3uwi.htm"><b>GetLastError</b></a>. </p>
<h4>Errors</h4>
<p>
The following error code can be set by the service control manager. Other error codes can be set by registry functions that are called by the service control manager. </p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=60%>Value</th>
<th align=left width=40%>Meaning</th>
</tr>
<tr valign=top>
<td width=60%>ERROR_ACCESS_DENIED</td>
<td width=40%>The specified handle was not opened with SC_MANAGER_LOCK access.</td>
</tr>
<tr valign=top>
<td width=60%>ERROR_INVALID_HANDLE</td>
<td width=40%>The specified handle is invalid.</td>
</tr>
<tr valign=top>
<td width=60%>ERROR_SERVICE_DATABASE_LOCKED</td>
<td width=40%>The database is locked.</td>
</tr>
</table><br>
<h4>Remarks</h4>
<p>
The <b>LockServiceDatabase</b> function tries to request ownership of the service control manager database lock. Only one process at a time can own a lock at any given time. </p>
<p>
A lock is a protocol used by setup and configuration programs and the service control manager to serialize access to the service tree in the registry. The only time the service control manager requests ownership of the lock is when it is starting a service. Setup and configuration programs are expected to acquire ownership of a lock before using the <a href="services_5gh3.htm"><b>ChangeServiceConfig</b></a> or <a href="acctrlow_2jcp.htm"><b>SetServiceObjectSecurity</b></a> function to reconfigure a service. They should also acquire ownership of a lock before using the registry functions to reconfigure a service. The lock prevents the service control manager from starting a service while it is being reconfigured. </p>
<p>
A call to the <a href="services_8ox1.htm"><b>StartService</b></a> function to start a service in a locked database fails. No other service control manager functions are affected by a lock. </p>
<p>
The lock is held until the SC_LOCK handle is specified in a subsequent call to the <b>UnlockServiceDatabase</b> function. If a process that owns a lock terminates, the service control manager automatically cleans up and releases ownership of the lock. </p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 3.1 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in winsvc.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use advapi32.lib.</p>
<h4>See Also</h4>
<p>
<a href="services_0p0z.htm">Services Overview</a>, <a href="services_2uwj.htm">Service Functions</a>, <a href="services_5gh3.htm"><b>ChangeServiceConfig</b></a>, <a href="services_4c36.htm"><b>OpenSCManager</b></a>, <a href="services_1jg3.htm"><b>QueryServiceLockStatus</b></a>, <a href="acctrlow_2jcp.htm"><b>SetServiceObjectSecurity</b></a>, <a href="services_8ox1.htm"><b>StartService</b></a>, <a href="services_6izp.htm"><b>UnlockServiceDatabase</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
