<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>AdjustTokenPrivileges</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_adjusttokenprivileges"></a>AdjustTokenPrivileges</h1>
<p>
The <b>AdjustTokenPrivileges</b> function enables or disables privileges in the specified access token. Enabling or disabling privileges in an access token requires TOKEN_ADJUST_PRIVILEGES access. </p>
<pre><code><b>BOOL AdjustTokenPrivileges(
  HANDLE</b><i> TokenHandle</i><b>,  </b>// handle to token that contains privileges
<b>  BOOL</b><i> DisableAllPrivileges</i><b>,</b>
<b>                       </b>// flag for disabling all privileges
<b>  PTOKEN_PRIVILEGES</b><i> NewState</i><b>,</b>
<b>                       </b>// pointer to new privilege information
<b>  DWORD</b><i> BufferLength</i><b>,  </b>// size, in bytes, of the <i>PreviousState</i> buffer
<b>  PTOKEN_PRIVILEGES</b><i> PreviousState</i><b>,</b>
<b>                       </b>// receives original state of changed 
                       // privileges
<b>  PDWORD</b><i> ReturnLength</i>  // receives required size of the 
                       // <i>PreviousState</i> buffer
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>TokenHandle</i></dt>
<dd>
Identifies the access token that contains the privileges to be modified. The handle must have TOKEN_ADJUST_PRIVILEGES access to the token. If the <i>PreviousState</i> parameter is not NULL, the handle must also have TOKEN_QUERY access.</dd>
<dt>
<i>DisableAllPrivileges</i></dt>
<dd>
Specifies whether the function disables all of the token's privileges. If this value is TRUE, the function disables all privileges and ignores the <i>NewState</i> parameter. If it is FALSE, the function modifies privileges based on the information pointed to by the <i>NewState</i> parameter. </dd>
<dt>
<i>NewState</i></dt>
<dd>
Pointer to a <a href="accctrl_5436.htm"><b>TOKEN_PRIVILEGES</b></a> structure that specifies an array of privileges and their attributes. If the <i>DisableAllPrivileges</i> parameter is FALSE, <b>AdjustTokenPrivileges</b> enables or disables these privileges for the token. If you set the SE_PRIVILEGE_ENABLED attribute for a privilege, the function enables that privilege; otherwise, it disables the privilege. 
<p>
If <i>DisableAllPrivileges</i> is TRUE, the function ignores this parameter. 
</dd>
<dt>
<i>BufferLength</i></dt>
<dd>
Specifies the size, in bytes, of the buffer pointed to by the <i>PreviousState</i> parameter. This parameter can be NULL if the <i>PreviousState</i> parameter is NULL. </dd>
<dt>
<i>PreviousState</i></dt>
<dd>
Pointer to a buffer that the function fills with a <b>TOKEN_PRIVILEGES</b> structure containing the previous state of any privileges the function modifies. This parameter can be NULL. 
<p>
If you specify a buffer that is too small to receive the complete list of modified privileges, the function fails and does not adjust any privileges. In this case, the function sets the variable pointed to by the <i>ReturnLength</i> parameter to the number of bytes required to hold the complete list of modified privileges. 
</dd>
<dt>
<i>ReturnLength</i></dt>
<dd>
Pointer to a variable that receives the required size, in bytes, of the buffer pointed to by the <i>PreviousState</i> parameter. This parameter can be NULL if <i>PreviousState</i> is NULL. 
</dd>
</dl>
<h4>Return Values</h4>
<p>
If the function succeeds, the return value is nonzero. To determine whether the function adjusted all of the specified privileges, call <a href="errors_3uwi.htm"><b>GetLastError</b></a>, which returns one of the following values when the function succeeds:</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=49%>Value</th>
<th align=left width=51%>Description</th>
</tr>
<tr valign=top>
<td class=indent1 width=49%>ERROR_SUCCESS</td>
<td width=51%>The function adjusted all specified privileges.</td>
</tr>
<tr valign=top>
<td class=indent1 width=49%>ERROR_NOT_ALL_ASSIGNED</td>
<td width=51%>The token does not have one or more of the privileges specified in the <i>NewState</i> parameter. The function may succeed with this error value even if no privileges were adjusted. The <i>PreviousState</i> parameter indicates the privileges that were adjusted.</td>
</tr>
</table><br>
<p>
If the function fails, the return value is zero. To get extended error information, call <b>GetLastError</b>. </p>
<h4>Remarks</h4>
<p>
The<b> AdjustTokenPrivileges</b> function cannot add new privileges to the access token. It can only enable or disable the token's existing privileges. To determine the token's privileges, call the <a href="accctrl_2jvy.htm"><b>GetTokenInformation</b></a> function. </p>
<p>
Note that the <i>NewState</i> parameter can specify privileges that the token does not have, without causing the function to fail. In this case, the function adjusts the privileges that the token does have, ignores the other privileges, and returns success. Call the <b>GetLastError</b> function to determine whether the function adjusted all of the specified privileges. The <i>PreviousState</i> parameter indicates the privileges that were adjusted.</p>
<p>
The <i>PreviousState</i> parameter retrieves a <a href="accctrl_5436.htm"><b>TOKEN_PRIVILEGES</b></a> structure containing the the original state of the adjusted privileges. To restore the original state, pass the <i>PreviousState</i> pointer as the <i>NewState</i> parameter in a subsequent call to the <b>AdjustTokenPrivileges</b> function </p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 3.1 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in winbase.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use advapi32.lib.</p>
<h4>See Also</h4>
<p>
<a href="accctrl_2hf0.htm">Access Control Overview</a>, <a href="accctrl_6cmr.htm">Access Control Functions</a>, <a href="accctrl_4iur.htm"><b>AdjustTokenGroups</b></a>, <a href="accctrl_2jvy.htm"><b>GetTokenInformation</b></a>, <a href="accctrl_0zam.htm"><b>OpenProcessToken</b></a>, <a href="accctrl_8bam.htm"><b>OpenThreadToken</b></a>, <a href="accctrl_9j5a.htm"><b>SetTokenInformation</b></a>, <a href="accctrl_5436.htm"><b>TOKEN_PRIVILEGES</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
