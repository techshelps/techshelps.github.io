<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Using Mutex Objects</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_win32_using_mutex_objects"></a>Using Mutex Objects</h2>
<p>
You can use a mutex object to protect a shared resource from simultaneous access by multiple threads or processes. Each thread must wait for ownership of the mutex before it can execute the code that accesses the shared resource. For example, if several threads share access to a database, the threads can use a mutex object to permit only one thread at a time to write to the database. </p>
<p>
In the following example, a process uses the <a href="synchro_1a2g.htm"><b>CreateMutex</b></a> function to create a named mutex object or open a handle to an existing mutex object. </p>
<pre><code>HANDLE hMutex; 

// Create a mutex with no initial owner.

hMutex = CreateMutex( 
    NULL,                       // no security attributes
    FALSE,                      // initially not owned
    "MutexToProtectDatabase");  // name of mutex

if (hMutex == NULL) 
{
    // Check for error.
}
 </code></pre>
<p>
When a thread of this process writes to the database, as in the next example, it first requests ownership of the mutex. If it gets ownership, the thread writes to the database and then releases its ownership. </p>
<p>
The example uses the <b>try</b>-<b>finally</b> structured exception-handling syntax to ensure that the thread properly releases the mutex object. The <b>finally</b> block of code is executed no matter how the <b>try</b> block terminates (unless the <b>try</b> block includes a call to the <a href="prothred_7h2c.htm"><b>TerminateThread</b></a> function). This prevents the mutex object from being abandoned inadvertently.</p>
<pre><code>BOOL FunctionToWriteToDatabase(HANDLE hMutex) 
{ 
    DWORD dwWaitResult; 

    // Request ownership of mutex.
 
    dwWaitResult = WaitForSingleObject( 
        hMutex,   // handle to mutex
        5000L);   // five-second time-out interval
 
    switch (dwWaitResult) 
    {
        // The thread got mutex ownership.
        case WAIT_OBJECT_0: 
            try { 
                // Write to the database.
            } 

            finally { 
                // Release ownership of the mutex object.
                if (! ReleaseMutex(hMutex)) { 
                    // Deal with error.
                } 

            break; 
        } 

        // Cannot get mutex ownership due to time-out.
        case WAIT_TIMEOUT: 
            return FALSE; 

        // Got ownership of the abandoned mutex object.
        case WAIT_ABANDONED: 
            return FALSE; 
    }

    return TRUE; 
}
 </code></pre>
<p>&nbsp;</p></body>
</HTML>
