<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>QueryServiceConfig</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_queryserviceconfig"></a>QueryServiceConfig</h1>
<p>
The <b>QueryServiceConfig</b> function retrieves the configuration parameters of the specified service. </p>
<pre><code><b>BOOL QueryServiceConfig(
  SC_HANDLE</b><i> hService</i><b>,  </b>// handle of service
<b>  LPQUERY_SERVICE_CONFIG</b><i> lpServiceConfig</i><b>,</b>
<b>                       </b>// address of service config. structure
<b>  DWORD</b><i> cbBufSize</i><b>,     </b>// size of service configuration buffer
<b>  LPDWORD</b><i> pcbBytesNeeded</i>   // address of variable for bytes needed
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>hService</i></dt>
<dd>
Handle to the service. This handle is returned by the <a href="services_8isl.htm"><b>OpenService</b></a> or <a href="services_3p9h.htm"><b>CreateService</b></a> function, and it must have SERVICE_QUERY_CONFIG access. </dd>
<dt>
<i>lpServiceConfig</i></dt>
<dd>
Pointer to a buffer that receives the <a href="services_5vci.htm"><b>QUERY_SERVICE_CONFIG</b></a> structure in which the service configuration information is returned, plus the strings to which its members point. </dd>
<dt>
<i>cbBufSize</i></dt>
<dd>
Specifies the size, in bytes, of the buffer pointed to by the <i>lpServiceConfig</i> parameter. </dd>
<dt>
<i>pcbBytesNeeded</i></dt>
<dd>
Pointer to a variable that receives the number of bytes needed to return all the configuration information if the function fails. 
</dd>
</dl>
<h4>Return Values</h4>
<p>
If the function succeeds, the return value is nonzero.</p>
<p>
If the function fails, the return value is zero. To get extended error information, call <a href="errors_3uwi.htm"><b>GetLastError</b></a>. </p>
<h4>Errors</h4>
<p>
The following error codes can be set by the service control manager. Others can be set by the registry functions that are called by the service control manager. </p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=50%>Value</th>
<th align=left width=50%>Meaning</th>
</tr>
<tr valign=top>
<td width=50%>ERROR_ACCESS_DENIED</td>
<td width=50%>The specified handle was not opened with SERVICE_QUERY_CONFIG access.</td>
</tr>
<tr valign=top>
<td width=50%>ERROR_INSUFFICIENT_BUFFER</td>
<td width=50%>There is more service configuration information than would fit into the <i>lpServiceConfig</i> buffer. The number of bytes required to get all the information is returned in the <i>pcbBytesNeeded</i> parameter. Nothing is written to the <i>lpServiceConfig</i> buffer.</td>
</tr>
<tr valign=top>
<td width=50%>ERROR_INVALID_HANDLE</td>
<td width=50%>The specified handle is invalid.</td>
</tr>
</table><br>
<h4>Remarks</h4>
<p>
The <b>QueryServiceConfig</b> function returns the service configuration information kept in the registry for a particular service. This configuration information is first set by a service control program using the <b>CreateService</b> function. This information may have been updated by a service configuration program using the <a href="services_5gh3.htm"><b>ChangeServiceConfig</b></a> function. </p>
<p>
If the service was running when the configuration information was last changed, the information returned by <b>QueryServiceConfig</b> will not reflect the current configuration of the service. Instead, it will reflect the configuration of the service when it is next run. The <b>DisplayName</b> key is an exception to this. When the <b>DisplayName</b> key is changed, it takes effect immediately, regardless of whether the service is running. </p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 3.1 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in winsvc.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use advapi32.lib.<br>
<b>&nbsp;&nbsp;Unicode: </b>Implemented as Unicode and ANSI versions on Windows NT.</p>
<h4>See Also</h4>
<p>
<a href="services_0p0z.htm">Services Overview</a>, <a href="services_2uwj.htm">Service Functions</a>, <a href="services_5gh3.htm"><b>ChangeServiceConfig</b></a>, <a href="services_3p9h.htm"><b>CreateService</b></a>, <a href="services_8isl.htm"><b>OpenService</b></a>, <a href="services_5vci.htm"><b>QUERY_SERVICE_CONFIG</b></a>, <a href="acctrlow_1vcp.htm"><b>QueryServiceObjectSecurity</b></a>, <a href="services_8coj.htm"><b>QueryServiceStatus</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
