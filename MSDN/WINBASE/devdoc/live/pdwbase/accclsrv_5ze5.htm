<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>AccessCheckAndAuditAlarm</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_accesscheckandauditalarm"></a>AccessCheckAndAuditAlarm</h1>
<p>
The <b>AccessCheckAndAuditAlarm</b> function determines whether a security descriptor grants a specified set of access rights to the client being impersonated by the calling thread. If the security descriptor has a SACL with ACEs that apply to the client, the function generates any necessary audit messages in the security event log. Alarms are not supported in the current version of Windows NT. </p>
<pre><code><b>BOOL AccessCheckAndAuditAlarm(
  LPCTSTR</b><i> SubsystemName</i><b>,     </b>// subsystem name
<b>  LPVOID</b><i> HandleId</i><b>,           </b>// object's handle identifier
<b>  LPTSTR</b><i> ObjectTypeName</i><b>,     </b>// type of object
<b>  LPTSTR</b><i> ObjectName</i><b>,         </b>// name of object
<b>  PSECURITY_DESCRIPTOR</b><i> SecurityDescriptor</i><b>,</b>
<b>                             </b>// address of security descriptor
<b>  DWORD</b><i> DesiredAccess</i><b>,       </b>// mask for requested access rights
<b>  PGENERIC_MAPPING</b><i> GenericMapping</i><b>,</b>
<b>                             </b>// address of GENERIC_MAPPING
<b>  BOOL</b><i> ObjectCreation</i><b>,       </b>// flag is TRUE if creating an object
<b>  LPDWORD</b><i> GrantedAccess</i><b>,     </b>// retrieves mask of granted rights
<b>  LPBOOL</b><i> AccessStatus     </i>   // retrieves results of access check
<b>  LPBOOL</b><i> pfGenerateOnClose</i>   // retrieves flag for audit generation
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>SubsystemName</i></dt>
<dd>
Pointer to a null-terminated string specifying the name of the subsystem calling the function. This string appears in any audit message that the function generates.</dd>
<dt>
<i>HandleId</i></dt>
<dd>
Pointer to a unique 32-bit value representing the client's handle to the object. If the access is denied, the system ignores this value. </dd>
<dt>
<i>ObjectTypeName</i></dt>
<dd>
Pointer to a null-terminated string specifying the type of object being created or accessed. This string appears in any audit message that the function generates.</dd>
<dt>
<i>ObjectName</i></dt>
<dd>
Pointer to a null-terminated string specifying the name of the object being created or accessed. This string appears in any audit message that the function generates.</dd>
<dt>
<i>SecurityDescriptor</i></dt>
<dd>
Pointer to the <a href="accctrl_6i5u.htm"><b>SECURITY_DESCRIPTOR</b></a> structure against which access is checked. </dd>
<dt>
<i>DesiredAccess</i></dt>
<dd>
Access mask that specifies the access rights to check. This mask must have been mapped by the <a href="accclsrv_8757.htm"><b>MapGenericMask</b></a> function to contain no generic access rights.
<p>
If this parameter is MAXIMUM_ALLOWED, the function sets the <i>GrantedAccess</i> access mask to indicate the maximum access rights the security descriptor allows the client.
</dd>
<dt>
<i>GenericMapping</i></dt>
<dd>
Pointer to the <a href="accclsrv_29rm.htm"><b>GENERIC_MAPPING</b></a> structure associated with the object for which access is being checked. </dd>
<dt>
<i>ObjectCreation</i></dt>
<dd>
Specifies a flag that determines whether the calling application will create a new object when access is granted. A value of TRUE indicates the application will create a new object. A value of FALSE indicates the application will open an existing object. </dd>
<dt>
<i>GrantedAccess</i></dt>
<dd>
Pointer to an access mask that receives the granted access rights. If <i>AccessStatus</i> returns FALSE, the function sets the access mask to zero. If the function fails, it does not set the access mask. </dd>
<dt>
<i>AccessStatus</i></dt>
<dd>
Pointer to a variable that receives the results of the access check. If the security descriptor allows the requested access rights to the client, <i>AccessStatus</i> returns TRUE. Otherwise, <i>AccessStatus</i> returns FALSE. </dd>
<dt>
<i>pfGenerateOnClose</i></dt>
<dd>
Pointer to a flag set by the audit-generation routine when the function returns. Pass this flag to the <a href="accclsrv_2vvx.htm"><b>ObjectCloseAuditAlarm</b></a> function when the object handle is closed. 
</dd>
</dl>
<h4>Return Values</h4>
<p>
If the function succeeds, the return value is nonzero.</p>
<p>
If the function fails, the return value is zero. To get extended error information, call <a href="errors_3uwi.htm"><b>GetLastError</b></a>. </p>
<h4>Remarks</h4>
<p>
The <b>AccessCheckAndAuditAlarm</b> function requires the calling process to have the SE_AUDIT_NAME privilege enabled. The test for this privilege is performed against the primary token of the calling process, not the impersonation token of the thread. </p>
<p>
The <b>AccessCheckAndAuditAlarm</b> function fails if the calling thread is not impersonating a client. </p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 3.1 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in winbase.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use advapi32.lib.<br>
<b>&nbsp;&nbsp;Unicode: </b>Implemented as Unicode and ANSI versions on Windows NT.</p>
<h4>See Also</h4>
<p>
<a href="accclsrv_64vg.htm">Client/Server Access Control Overview</a>, <a href="accclsrv_0hv7.htm">Client/Server Access Control Functions</a>, <a href="accclsrv_5jjf.htm"><b>AccessCheck</b></a>, <a href="accclsrv_29rm.htm"><b>GENERIC_MAPPING</b></a>, <a href="accclsrv_8757.htm"><b>MapGenericMask</b></a>, <a href="accclsrv_2vvx.htm"><b>ObjectCloseAuditAlarm</b></a>, <a href="accclsrv_3625.htm"><b>ObjectOpenAuditAlarm</b></a>, <a href="accclsrv_6gdp.htm"><b>ObjectPrivilegeAuditAlarm</b></a>, <a href="accclsrv_9vhn.htm"><b>PrivilegeCheck</b></a>, <a href="accclsrv_68od.htm"><b>PrivilegedServiceAuditAlarm</b></a>, <a href="accctrl_6i5u.htm"><b>SECURITY_DESCRIPTOR</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
