<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>AdjustTokenGroups</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_adjusttokengroups"></a>AdjustTokenGroups</h1>
<p>
The <b>AdjustTokenGroups</b> function adjusts groups in the specified access token. TOKEN_ADJUST_GROUPS access is required to enable or disable groups in an access token. </p>
<pre><code><b>BOOL AdjustTokenGroups(
  HANDLE</b><i> TokenHandle</i><b>,      </b>// handle to token that contains groups
<b>  BOOL</b><i> ResetToDefault</i><b>,     </b>// flag for default settings
<b>  PTOKEN_GROUPS</b><i> NewState</i><b>,  </b>// address of address of new group 
                           // information
<b>  DWORD</b><i> BufferLength</i><b>,      </b>// size of buffer for previous information
<b>  PTOKEN_GROUPS</b><i> PreviousState</i><b>,</b>
<b>                           </b>// address of previous group information
<b>  PDWORD</b><i> ReturnLength</i>      // address of required buffer size
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>TokenHandle</i></dt>
<dd>
Identifies the access token containing the groups to be modified. The handle must have TOKEN_ADJUST_GROUPS access to the token. If the <i>PreviousState</i> parameter is not NULL, the handle must also have TOKEN_QUERY access.</dd>
<dt>
<i>ResetToDefault</i></dt>
<dd>
Specifies whether the groups are to be set to their default enabled and disabled states. If this value is TRUE, the groups are set to their default states and the <i>NewState</i> parameter is ignored. If this value is FALSE, the groups are set according to the information pointed to by the <i>NewState</i> parameter. </dd>
<dt>
<i>NewState</i></dt>
<dd>
Pointer to a <a href="accctrl_2eia.htm"><b>TOKEN_GROUPS</b></a> structure containing the groups whose states are to be set. If the <i>ResetToDefault</i> parameter is FALSE, the function sets each of the groups to the value of that group's SE_GROUP_ENABLED attribute in the <b>TOKEN_GROUPS</b> structure. If <i>ResetToDefault</i> is TRUE, this parameter is ignored. </dd>
<dt>
<i>BufferLength</i></dt>
<dd>
Specifies the size, in bytes, of the buffer pointed to by the <i>PreviousState</i> parameter. This parameter can be NULL if the <i>PreviousState</i> parameter is NULL. </dd>
<dt>
<i>PreviousState</i></dt>
<dd>
Pointer to a buffer receiving a <a href="accctrl_2eia.htm"><b>TOKEN_GROUPS</b></a> structure containing the previous state of any groups the function modifies. This parameter can be NULL. 
<p>
If a buffer is specified but it does not contain enough space to receive the complete list of modified groups, no group states are changed and the function fails. In this case, the function sets the variable pointed to by the <i>ReturnLength</i> parameter to the number of bytes required to hold the complete list of modified groups. 
</dd>
<dt>
<i>ReturnLength</i></dt>
<dd>
Pointer to a variable set by the function that contains the actual number of bytes needed for the buffer pointed to by the <i>PreviousState</i> parameter. This parameter can be NULL and is ignored if <i>PreviousState</i> is NULL. 
</dd>
</dl>
<h4>Return Values</h4>
<p>
If the function succeeds, the return value is nonzero.</p>
<p>
If the function fails, the return value is zero. To get extended error information, call <a href="errors_3uwi.htm"><b>GetLastError</b></a>. </p>
<h4>Remarks</h4>
<p>
The information retrieved in the <i>PreviousState</i> parameter is formatted as a <b>TOKEN_GROUPS</b> structure. This means a pointer to the buffer can be passed as the <i>NewState</i> parameter in a subsequent call to the <b>AdjustTokenGroups</b> function, restoring the original state of the groups. </p>
<p>
The <i>NewState</i> parameter can list groups to be changed that are not present in the access token. This does not affect the successful modification of the groups in the token. </p>
<p>
Mandatory groups cannot be disabled. They are identified by the SE_GROUP_MANDATORY attribute in the <b>TOKEN_GROUPS</b> structure. If an attempt is made to disable any mandatory groups, <b>AdjustTokenGroups</b> fails and leaves the state of all groups unchanged. </p>
<p>
You cannot enable a group that has the SE_GROUP_USE_FOR_DENY_ONLY attribute.</p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 3.1 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in winbase.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use advapi32.lib.</p>
<h4>See Also</h4>
<p>
<a href="accctrl_2hf0.htm">Access Control Overview</a>, <a href="accctrl_6cmr.htm">Access Control Functions</a>, <a href="accctrl_6xbn.htm"><b>AdjustTokenPrivileges</b></a>, <a href="accctrl_2jvy.htm"><b>GetTokenInformation</b></a>, <a href="accctrl_0zam.htm"><b>OpenProcessToken</b></a>, <a href="accctrl_8bam.htm"><b>OpenThreadToken</b></a>, <a href="accctrl_9j5a.htm"><b>SetTokenInformation</b></a>, <a href="accctrl_2eia.htm"><b>TOKEN_GROUPS</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
