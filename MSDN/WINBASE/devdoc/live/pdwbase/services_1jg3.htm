<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>QueryServiceLockStatus</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_queryservicelockstatus"></a>QueryServiceLockStatus</h1>
<p>
The <b>QueryServiceLockStatus</b> function retrieves the lock status of the specified service control manager database. </p>
<pre><code><b>BOOL QueryServiceLockStatus(
  SC_HANDLE</b><i> hSCManager</i><b>,    </b>// handle of svc. ctrl. mgr. database
<b>  LPQUERY_SERVICE_LOCK_STATUS</b><i> lpLockStatus</i><b>,</b>
<b>                           </b>// address of lock status structure
<b>  DWORD</b><i> cbBufSize</i><b>,         </b>// size of service configuration buffer
<b>  LPDWORD</b><i> pcbBytesNeeded</i>   // address of variable for bytes needed
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>hSCManager</i></dt>
<dd>
Handle to the service control manager database. The <a href="services_4c36.htm"><b>OpenSCManager</b></a> function returns this handle, which must have SC_MANAGER_QUERY_LOCK_STATUS access.</dd>
<dt>
<i>lpLockStatus</i></dt>
<dd>
Pointer to a buffer that receives the <a href="services_3zaq.htm"><b>QUERY_SERVICE_LOCK_STATUS</b></a> structure in which the lock status of the specified database is returned, plus the strings to which its members point. </dd>
<dt>
<i>cbBufSize</i></dt>
<dd>
Specifies the size, in bytes, of the buffer pointed to by the <i>lpLockStatus</i> parameter. </dd>
<dt>
<i>pcbBytesNeeded</i></dt>
<dd>
Pointer to a variable that receives the number of bytes needed to return all the lock status information, if the function fails. 
</dd>
</dl>
<h4>Return Values</h4>
<p>
If the function succeeds, the return value is nonzero.</p>
<p>
If the function fails, the return value is zero. To get extended error information, call <a href="errors_3uwi.htm"><b>GetLastError</b></a>. </p>
<h4>Errors</h4>
<p>
The following error codes can be set by the service control manager. Other error codes can be set by the registry functions that are called by the service control manager. </p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=12%>Value</th>
<th align=left width=88%>Meaning</th>
</tr>
<tr valign=top>
<td colspan=2 width=100%>ERROR_ACCESS_DENIED</td>
</tr>
<tr valign=top>
<td width=12%></td>
<td width=88%>The specified handle was not opened with SC_MANAGER_QUERY_LOCK_STATUS access.</td>
</tr>
<tr valign=top>
<td colspan=2 width=100%>ERROR_INSUFFICIENT_BUFFER</td>
</tr>
<tr valign=top>
<td width=12%></td>
<td width=88%>There is more lock status information than would fit into the <i>lpLockStatus</i> buffer. The number of bytes required to get all the information is returned in the <i>pcbBytesNeeded</i> parameter. Nothing is written to the <i>lpLockStatus</i> buffer.</td>
</tr>
<tr valign=top>
<td colspan=2 width=100%>ERROR_INVALID_HANDLE</td>
</tr>
<tr valign=top>
<td width=12%></td>
<td width=88%>The specified handle is invalid.</td>
</tr>
</table><br>
<h4>Remarks</h4>
<p>
The <b>QueryServiceLockStatus</b> function returns a <b>QUERY_SERVICE_LOCK_STATUS</b> structure that indicates whether the specified database is locked. If the database is locked, the structure provides the account name of the user that owns the lock and the length of time that the lock has been held. </p>
<p>
A process calls the <b>LockServiceDatabase</b> function to acquire ownership of a service control manager database lock and the <b>UnlockServiceDatabase</b> function to release the lock. </p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 3.1 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in winsvc.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use advapi32.lib.<br>
<b>&nbsp;&nbsp;Unicode: </b>Implemented as Unicode and ANSI versions on Windows NT.</p>
<h4>See Also</h4>
<p>
<a href="services_0p0z.htm">Services Overview</a>, <a href="services_2uwj.htm">Service Functions</a>, <a href="services_5uw5.htm"><b>LockServiceDatabase</b></a>, <a href="services_4c36.htm"><b>OpenSCManager</b></a>, <a href="services_3zaq.htm"><b>QUERY_SERVICE_LOCK_STATUS</b></a>, <a href="services_6izp.htm"><b>UnlockServiceDatabase</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
