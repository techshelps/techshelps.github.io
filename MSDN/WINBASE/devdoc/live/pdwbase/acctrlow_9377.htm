<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Denying Access Using Low-Level Functions</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_win32_denying_access_using_low_level_functions"></a>Denying Access Using Low-Level Functions</h2>
<p>
This example uses the low-level access-control functions to attach an empty DACL to a file object. The effect of an empty DACL is to deny all access to the object.</p>
<p>
The example allocates a buffer for the security descriptor and calls the <a href="acctrlow_5fw2.htm"><b>InitializeSecurityDescriptor</b></a> function to initialize the buffer. Then it allocates a buffer for the ACL and calls the <a href="acctrlow_6p7w.htm"><b>InitializeAcl</b></a> function to initialize that buffer. Next, it calls the <a href="acctrlow_0fxo.htm"><b>SetSecurityDescriptorDacl</b></a> function to attach the ACL to the security descriptor; and calls the <a href="acctrlow_9kvt.htm"><b>SetFileSecurity</b></a> function to attach the security descriptor to a file.</p>
<pre><code>PSECURITY_DESCRIPTOR pSD; 
PACL pACL; 
DWORD cbACL = 1024; 
 
// Initialize a security descriptor.  
 
pSD = (PSECURITY_DESCRIPTOR) LocalAlloc(LPTR, 
    SECURITY_DESCRIPTOR_MIN_LENGTH);   // defined in WINNT.H  
if (pSD == NULL) { 
    ErrorHandler("LocalAlloc"); 
    goto Cleanup; 
} 
 
if (!InitializeSecurityDescriptor(pSD, 
        SECURITY_DESCRIPTOR_REVISION)) { // defined in WINNT.H  
    ErrorHandler("InitializeSecurityDescriptor"); 
    goto Cleanup; 
} 
 
// Initialize a DACL.  
 
pACL = (PACL) LocalAlloc(LPTR, cbACL); 
if (pACL == NULL) { 
    ErrorHandler("LocalAlloc"); 
    goto Cleanup; 
} 
 
if (!InitializeAcl(pACL, cbACL, ACL_REVISION2)) { 
    ErrorHandler("InitializeAcl"); 
    goto Cleanup; 
} 
 
// Add an empty ACL to the SD to deny access.  
 
if (!SetSecurityDescriptorDacl(pSD, 
        TRUE,     // fDaclPresent flag   
        pACL, 
        FALSE)) { // not a default DACL  
    ErrorHandler("SetSecurityDescriptorDacl"); 
    goto Cleanup; 
} 
 
// Use the new SD as the file's security info.  
 
if (!SetFileSecurity(lpszTestFile, 
        DACL_SECURITY_INFORMATION, 
        pSD)) { 
    ErrorHandler("SetFileSecurity"); 
    goto Cleanup; 
} 
 
Cleanup: 
    if(pSD != NULL) 
        LocalFree((HLOCAL) pSD); 
    if(pACL != NULL) 
        LocalFree((HLOCAL) pACL); 
 </code></pre>
<p>&nbsp;</p></body>
</HTML>
