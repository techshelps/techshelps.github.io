<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Searching for Files and Changing File Attributes</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_win32_searching_for_files_and_changing_file_attributes"></a>Searching for Files and Changing File Attributes</h2>
<p>
The following example copies all text files in the current directory to a new directory of read-only files named \TEXTRO. Files in the new directory are changed to read only, if necessary. </p>
<p>
The application uses the <a href="filesio_6g6x.htm"><b>GetCurrentDirectory</b></a> function to retrieve the current directory path. This function is also used to return to the current directory after changing to the \TEXTRO directory. </p>
<p>
The application then creates the \TEXTRO directory by using the <a href="filesio_4sft.htm"><b>CreateDirectory</b></a> function. </p>
<p>
The application searches the current directory for all .TXT files by using the <a href="filesio_4qcl.htm"><b>FindFirstFile</b></a> and <a href="filesio_4ndx.htm"><b>FindNextFile</b></a> functions. Each .TXT file is copied to the \TEXTRO directory. After a file is copied, the <a href="filesio_9pgz.htm"><b>GetFileAttributes</b></a> function determines whether the file is read only. If the file is not read only, the application changes directories to \TEXTRO and converts the copied file to read only by using the <a href="filesio_9a2b.htm"><b>SetFileAttributes</b></a> function. </p>
<p>
After all .TXT files in the current directory have been copied, the application closes the search handle by using the <a href="filesio_45d1.htm"><b>FindClose</b></a> function. </p>
<pre><code>WIN32_FIND_DATA FileData; 
HANDLE hSearch; 
DWORD dwAttrs; 
char szDirPath[] = "c:\\TEXTRO\\"; 
char szNewPath[MAX_PATH]; 
char szHome[MAX_PATH]; 
 
BOOL fFinished = FALSE; 
 
// Create a new directory. 
 
if (!CreateDirectory(szDirPath, NULL)) 
{ 
    ErrorHandler("Couldn't create new directory."); 
} 
 
// Start searching for .TXT files in the current directory. 
 
hSearch = FindFirstFile("*.txt", &amp;FileData); 
if (hSearch == INVALID_HANDLE_VALUE) 
{ 
    ErrorHandler("No .TXT files found."); 
} 
 
// Copy each .TXT file to the new directory 
// and change it to read only, if not already. 
 
while (!fFinished) 
{ 
    lstrcpy(szNewPath, szDirPath); 
    lstrcat(szNewPath, FileData.cFileName); 
    if (CopyFile(FileData.cFileName, szNewPath, FALSE))
    { 
        dwAttrs = GetFileAttributes(FileData.cFileName); 
        if (!(dwAttrs &amp; FILE_ATTRIBUTE_READONLY)) 
        { 
            SetFileAttributes(szNewPath, 
                dwAttrs | FILE_ATTRIBUTE_READONLY); 
        } 
    } 
    else 
    { 
        ErrorHandler("Couldn't copy file."); 
    } 
 
    if (!FindNextFile(hSearch, &amp;FileData)) 
    {
        if (GetLastError() == ERROR_NO_MORE_FILES) 
        { 
            MessageBox(hwnd, "No more .TXT files.", 
                "Search completed.", MB_OK); 
            fFinished = TRUE; 
        } 
        else 
        { 
            ErrorHandler("Couldn't find next file."); 
        } 
    }
} 
 
// Close the search handle. 
 
if (!FindClose(hSearch)) 
{ 
    ErrorHandler("Couldn't close search handle."); 
} 
 </code></pre>
<p>&nbsp;</p></body>
</HTML>
