<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>String Management</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_win32_string_management"></a>String Management</h2>
<p>
To carry out a DDE task, many DDEML functions require access to strings. For example, a client must specify a service name and a topic name when it calls the <a href="ddemlib_9i9g.htm"><b>DdeConnect</b></a> function to request a conversation with a server. An application specifies a string by passing a string handle (HSZ) rather than a pointer in a DDEML function. A <i>string handle</i> is a <b>DWORD</b> value, assigned by the system, that identifies a string. </p>
<p>
An application can obtain a string handle for a particular string by calling the <a href="ddemlib_85et.htm"><b>DdeCreateStringHandle</b></a> function. This function registers the string with the system and returns a string handle to the application. The application can pass the handle to DDEML functions that must access the string. The following example obtains string handles for the System topic string and the service name string.</p>
<pre><code>HSZ hszServName; 
HSZ hszSysTopic; 

hszServName = DdeCreateStringHandle( 
    idInst,         // instance identifier 
    "MyServer",     // string to register 
    CP_WINANSI);    // Windows ANSI code page 
 
hszSysTopic = DdeCreateStringHandle( 
    idInst,         // instance identifier 
    SZDDESYS_TOPIC, // System topic 
    CP_WINANSI);    // Windows ANSI code page 
 </code></pre>
<p>
The <i>idInst</i> parameter in the preceding example specifies the instance identifier obtained by the <a href="ddemlib_2v6t.htm"><b>DdeInitialize</b></a> function. </p>
<p>
An application's DDE callback function receives one or more string handles during most DDE transactions. For example, a server receives two string handles during the <a href="ddemlib_73g4.htm">XTYP_REQUEST</a> transaction: one identifies a string specifying a topic name, and the other identifies a string specifying an item name. An application can obtain the length of the string that corresponds to a string handle and copy the string to an application-defined buffer by calling the <a href="ddemlib_0n6v.htm"><b>DdeQueryString</b></a> function, as shown in the following example. </p>
<pre><code>DWORD idInst; 
DWORD cb; 
HSZ hszServ; 
PSTR pszServName; 

cb = DdeQueryString(idInst, hszServ, (LPSTR) NULL, 0, 
    CP_WINANSI) + 1; 
pszServName = (PSTR) LocalAlloc(LPTR, (UINT) cb); 
DdeQueryString(idInst, hszServ, pszServName, cb, CP_WINANSI); 
</code></pre>
<p>
An instance-specific string handle cannot be mapped from string handle to string and back to string handle. For instance, although <a href="ddemlib_0n6v.htm"><b>DdeQueryString</b></a> creates a string from a string handle and then <a href="ddemlib_85et.htm"><b>DdeCreateStringHandle</b></a> creates a string handle from that string, the two handles are not the same, as shown in the following example. </p>
<pre><code>DWORD idInst; 
DWORD cb; 
HSZ hszInst, hszNew; 
PSZ pszInst; 

DdeQueryString(idInst, hszInst, pszInst, cb, CP_WINANSI); 
hszNew = DdeCreateStringHandle(idInst, pszInst, CP_WINANSI); 

// hszNew != hszInst ! 
 </code></pre>
<p>
To compare the values of two string handles, use the <a href="ddemlib_2z77.htm"><b>DdeCmpStringHandles</b></a> function.</p>
<p>
A string handle passed to an application's DDE callback function becomes invalid when the callback function returns. An application can save a string handle for use after the callback function returns by using the <a href="ddemlib_34yt.htm"><b>DdeKeepStringHandle</b></a> function. </p>
<p>
When an application calls <a href="ddemlib_85et.htm"><b>DdeCreateStringHandle</b></a>, the system enters the specified string into a string table and generates a handle that it uses to access the string. The system also maintains a usage count for each string in the string table. </p>
<p>
When an application calls <b>DdeCreateStringHandle</b> and specifies a string that already exists in the table, the system increments the usage count rather than adding another occurrence of the string. (An application can also increment the usage count by using <b>DdeKeepStringHandle</b>.) When an application calls the <a href="ddemlib_9sdh.htm"><b>DdeFreeStringHandle</b></a> function, the system decrements the usage count. </p>
<p>
A string is removed from the table when its usage count equals zero. Because more than one application can obtain the handle of a particular string, an application must not free a string handle more times than it has created or retained the handle. Otherwise, the application can cause the string to be removed from the table, denying other applications access to the string. </p>
<p>
The DDEML string-management functions are based on the atom manager and are subject to the same size restrictions as are atoms. </p>
<p>&nbsp;</p></body>
</HTML>
