<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>WritePrivateProfileStruct</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_writeprivateprofilestruct"></a>WritePrivateProfileStruct</h1>
<p>
The <b>WritePrivateProfileStruct</b> function copies data into the specified key in the given section of an initialization file. As it copies the data, the function calculates a checksum and appends it to the end of the data. The <a href="regapi_8hbo.htm"><b>GetPrivateProfileStruct</b></a> function uses the checksum to ensure the integrity of the data. This function is provided for compatibility with 16-bit Windows-based applications. Win32-based applications should store initialization information in the registry. </p>
<pre><code><b>BOOL WritePrivateProfileStruct(
  LPCTSTR</b><i> lpszSection</i><b>,</b>
<b>                    </b>// pointer to section name
<b>  LPCTSTR</b><i> lpszKey</i><b>,  </b>// pointer to key name
<b>  LPVOID</b><i> lpStruct</i><b>,  </b>// pointer to buffer that contains data to add
<b>  UINT</b><i> uSizeStruct</i><b>, </b>// size, in bytes, of the buffer
<b>  LPCTSTR</b><i> szFile    </i>// pointer to initialization filename
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>lpszSection</i></dt>
<dd>
Pointer to a null-terminated string containing the name of the section to which the string will be copied. If the section does not exist, it is created. The name of the section is case independent, the string can be any combination of uppercase and lowercase letters. </dd>
<dt>
<i>lpszKey</i></dt>
<dd>
Pointer to the null-terminated string containing the name of the key to be associated with a string. If the key does not exist in the specified section, it is created. If this parameter is NULL, the entire section, including all keys and entries within the section, is deleted. </dd>
<dt>
<i>lpStruct</i></dt>
<dd>
Pointer to a buffer that contains the data to copy. If this parameter is NULL, the given key is deleted.</dd>
<dt>
<i>uSizeStruct</i></dt>
<dd>
Specifies the size, in bytes, of the buffer pointed to by the <i>lpStruct</i> parameter. </dd>
<dt>
<i>szFile</i></dt>
<dd>
Pointer to a null-terminated string that names the initialization file. If this parameter is NULL, the given information is copied into the WIN.INI file.
</dd>
</dl>
<h4>Return Values</h4>
<p>
If the function successfully copies the string to the initialization file, the return value is nonzero.</p>
<p>
If the function fails, or if it flushes the cached version of the most recently accessed initialization file, the return value is zero. To get extended error information, call <a href="errors_3uwi.htm"><b>GetLastError</b></a>. </p>
<h4>Remarks</h4>
<p>
<b>Windows 95:</b> Windows 95 keeps a cached version of WIN.INI to improve performance. If all three parameters are NULL, the function flushes the cache. The function always returns FALSE after flushing the cache, regardless of whether the flush succeeds or fails.</p>
<p>
A section in the initialization file must have the following form: </p>
<pre><code>[section]
key=string
      .
      .
      . 
 </code></pre>
<p>
If the <i>szFile</i> parameter does not contain a full path and filename for the file, <b>WritePrivateProfileString</b> searches the Windows directory for the file. If the file does not exist, this function creates the file in the Windows directory. </p>
<p>
If <i>szFile</i> contains a full path and filename and the file does not exist, <b>WriteProfileString</b> creates the file. The specified directory must already exist. </p>
<p>
<b>Windows NT:</b> The Win32 profile functions (<b>Get/WriteProfile*</b>, <b>Get/WritePrivateProfile*</b>) use the following steps to locate initialization information:
<ol>
<li>
Look in the registry for the name of the initialization file, say MYFILE.INI, under <b>IniFileMapping</b>: <p>
<b>HKEY_LOCAL_MACHINE</b>\<b>Software</b>\<b>Microsoft</b>\<br>
        <b>Windows NT</b>\<b>CurrentVersion</b>\<b>IniFileMapping\myfile.ini</b>
</li>
<li>
Look for the section name specified by <i>lpAppName</i>. This will be a named value under <b>myfile.ini</b>, or a subkey of <b>myfile.ini</b>, or will not exist.</li>
<li>
If the section name specified by <i>lpAppName </i>is a named value under <b>myfile.ini</b>, then that value specifies where in the registry you will find the keys for the section.</li>
<li>
If the section name specified by <i>lpAppName </i>is a subkey of <b>myfile.ini</b>, then named values under that subkey specify where in the registry you will find the keys for the section. If the key you are looking for does not exist as a named value, then there will be an unnamed value (shown as <b>&lt;No Name&gt;</b>) that specifies the default location in the registry where you will find the key.</li>
<li>
If the section name specified by <i>lpAppName </i>does not exist as a named value or as a subkey under <b>myfile.ini</b>, then there will be an unnamed value (shown as <b>&lt;No Name&gt;</b>) under <b>myfile.ini</b> that specifies the default location in the registry where you will find the keys for the section.</li>
<li>
If there is no subkey for MYFILE.INI, or if there is no entry for the section name, then look for the actual MYFILE.INI on the disk and read its contents.</li>
</ol>
<p>
When looking at values in the registry that specify other registry locations, there are several prefixes that change the behavior of the .INI file mapping:
<ul>
<li>
! - this character forces all writes to go both to the registry and to the .INI file on disk.</li>
<li>
# - this character causes the registry value to be set to the value in the Windows 3.1 .INI file when a new user logs in for the first time after setup.</li>
<li>
@ - this character prevents any reads from going to the .INI file on disk if the requested data is not found in the registry.</li>
<li>
USR: - this prefix stands for HKEY_CURRENT_USER, and the text after the prefix is relative to that key.</li>
<li>
SYS: - this prefix stands for HKEY_LOCAL_MACHINE\SOFTWARE, and the text after the prefix is relative to that key.</li>
</ul>
<h4>See Also</h4>
<p>
<a href="regapi_9bzt.htm">Registry Overview</a>, <a href="regapi_59mb.htm">Registry Functions</a>, <a href="regapi_7fxj.htm"><b>GetPrivateProfileString</b></a>, <a href="regapi_1aav.htm"><b>WriteProfileString</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
