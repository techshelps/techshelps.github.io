<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>DeviceIoControl</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_deviceiocontrol"></a>DeviceIoControl</h1>
<p>
The <b>DeviceIoControl</b> function sends a control code directly to a specified device driver, causing the corresponding device to perform the specified operation. </p>
<pre><code><b>BOOL DeviceIoControl(
  HANDLE</b><i> hDevice</i><b>,              </b>// handle to device of interest
<b>  DWORD</b><i> dwIoControlCode</i><b>,       </b>// control code of operation to perform
<b>  LPVOID</b><i> lpInBuffer</i><b>,           </b>// pointer to buffer to supply input data
<b>  DWORD</b><i> nInBufferSize</i><b>,         </b>// size, in bytes, of input buffer
<b>  LPVOID</b><i> lpOutBuffer</i><b>,          </b>// pointer to buffer to receive output data
<b>  DWORD</b><i> nOutBufferSize</i><b>,        </b>// size, in bytes, of output buffer
<b>  LPDWORD</b><i> lpBytesReturned</i><b>,     </b>// pointer to variable to receive byte count
<b>  LPOVERLAPPED</b><i> lpOverlapped</i>    // pointer to structure for asynchronous operation
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>hDevice</i></dt>
<dd>
Handle to the device that is to perform the operation. Call the <a href="filesio_7wmd.htm"><b>CreateFile</b></a> function to obtain a device handle. </dd>
<dt>
<i>dwIoControlCode</i></dt>
<dd>
Specifies the control code for the operation. This value identifies the specific operation to be performed and the type of device on which the operation is to be performed. The following values are defined: 
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=59%>Value</th>
<th align=left width=41%>Meaning</th>
</tr>
<tr valign=top>
<td width=59%><a href="devio_8b3j.htm"><b>FSCTL_ALLOW_EXTENDED_DASD_IO</b></a></td>
<td width=41%>Signals the file system driver not to perform any I/O boundary checks on partition read or write calls. Instead, boundary checks are performed by the device driver. </td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_44ms.htm"><b>FSCTL_DELETE_REPARSE_POINT</b></a></td>
<td width=41%>Deletes a reparse point for a file or directory.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_35id.htm"><b>FSCTL_DISMOUNT_VOLUME</b></a></td>
<td width=41%>Dismounts a volume.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_0e05.htm"><b>FSCTL_ENABLE_UPGRADE</b></a> </td>
<td width=41%>Enables or disables upgrading an NTFS volume to NTFS version 5.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_0ka6.htm"><b>FSCTL_GET_COMPRESSION</b></a></td>
<td width=41%>Obtains the compression state of a file or directory</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_8rse.htm"><b>FSCTL_GET_HFS_INFORMATION</b></a></td>
<td width=41%>Returns Macintosh Finder information about the file associated with the input handle. </td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_56d0.htm"><b>FSCTL_GET_REPARSE_POINT</b></a></td>
<td width=41%>Returns reparse point data for a file or directory.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_02w5.htm"><b>FSCTL_LOCK_VOLUME</b></a></td>
<td width=41%>Locks a volume.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_056b.htm"><b>FSCTL_QUERY_ALLOCATED_RANGES</b></a></td>
<td width=41%>Scans a file for ranges of the file for which disk space is allocated.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_1js2.htm"><b>FSCTL_QUERY_FAT_BPB</b></a></td>
<td width=41%>Returns the first 36 bytes of a FAT16 or FAT12 volume.</td>
</tr>
<tr valign=top>
<td width=59%><b>FSCTL_READ_COMPRESSION</b></td>
<td width=41%>Reserved for future use.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_627i.htm"><b>FSCTL_SET_COMPRESSION</b></a></td>
<td width=41%>Sets the compression state of a file or directory.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_4qyc.htm"><b>FSCTL_SET_REPARSE_POINT</b></a></td>
<td width=41%>Sets a reparse point on a file or directory.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_5351.htm"><b>FSCTL_SET_SPARSE</b></a></td>
<td width=41%>Marks a file as a sparse file.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_9wbl.htm"><b>FSCTL_SET_ZERO_DATA</b></a></td>
<td width=41%>Sets a range of a files bytes to zeroes.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_5kbp.htm"><b>FSCTL_UNLOCK_VOLUME</b></a></td>
<td width=41%>Unlocks a volume.</td>
</tr>
<tr valign=top>
<td width=59%><b>FSCTL_WRITE_COMPRESSION</b></td>
<td width=41%>Reserved for future use.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_35h5.htm"><b>IOCTL_DISK_CHECK_VERIFY</b></a></td>
<td width=41%>Obsolete. Use IOCTL_STORAGE_CHECK_VERIFY</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_7odd.htm"><b>IOCTL_DISK_EJECT_MEDIA</b></a></td>
<td width=41%>Obsolete. Use IOCTL_STORAGE_EJECT_MEDIA</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_3sfn.htm"><b>IOCTL_DISK_FORMAT_TRACKS</b></a></td>
<td width=41%>Formats a contiguous set of disk tracks.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_4o6x.htm"><b>IOCTL_DISK_GET_DRIVE_GEOMETRY</b></a></td>
<td width=41%>Obtains information on the physical disk's geometry.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_5xdg.htm"><b>IOCTL_DISK_GET_DRIVE_LAYOUT</b></a></td>
<td width=41%>Provides information about each partition on a disk.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_1kqb.htm"><b>IOCTL_DISK_GET_MEDIA_TYPES</b></a></td>
<td width=41%>Obsolete. Use IOCTL_STORAGE_GET_MEDIA_TYPES</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_0nsf.htm"><b>IOCTL_DISK_GET_PARTITION_INFO</b></a></td>
<td width=41%>Obtains disk partition information.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_2vj5.htm"><b>IOCTL_DISK_LOAD_MEDIA</b></a></td>
<td width=41%>Obsolete. Use IOCTL_STORAGE_LOAD_MEDIA</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_8crw.htm"><b>IOCTL_DISK_MEDIA_REMOVAL</b></a></td>
<td width=41%>Obsolete. Use IOCTL_STORAGE_MEDIA_REMOVAL</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_5lph.htm"><b>IOCTL_DISK_PERFORMANCE</b></a></td>
<td width=41%>Provides disk performance information.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_490z.htm"><b>IOCTL_DISK_REASSIGN_BLOCKS</b></a></td>
<td width=41%>Maps disk blocks to spare-block pool.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_7sms.htm"><b>IOCTL_DISK_SET_DRIVE_LAYOUT</b></a></td>
<td width=41%>Partitions a disk.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_39pr.htm"><b>IOCTL_DISK_SET_PARTITION_INFO</b></a></td>
<td width=41%>Sets the disk partition type.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_41dl.htm"><b>IOCTL_DISK_VERIFY</b></a></td>
<td width=41%>Performs logical format of a disk extent.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_53lg.htm"><b>IOCTL_SERIAL_LSRMST_INSERT</b></a></td>
<td width=41%>Enables or disables placement of a line and modem status data into the data stream.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_6kft.htm"><b>IOCTL_STORAGE_CHECK_VERIFY</b></a></td>
<td width=41%>Checks for change in a removable-media device.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_2ko1.htm"><b>IOCTL_STORAGE_EJECT_MEDIA</b></a></td>
<td width=41%>Ejects media from a SCSI device.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_0joz.htm"><b>IOCTL_STORAGE_GET_MEDIA_TYPES</b></a></td>
<td width=41%>Obtains information about media support.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_5x5t.htm"><b>IOCTL_STORAGE_LOAD_MEDIA</b></a></td>
<td width=41%>Loads media into a device.</td>
</tr>
<tr valign=top>
<td width=59%><a href="devio_6yek.htm"><b>IOCTL_STORAGE_MEDIA_REMOVAL</b></a></td>
<td width=41%>Enables or disables the media eject mechanism.</td>
</tr>
</table><br>


<p>
For more detailed information on each control code, see its topic. In particular, each topic provides details on the usage of the <i>lpInBuffer</i>, <i>nInBufferSize</i>, <i>lpOutBuffer</i>, <i>nOutBufferSize</i>, and <i>lpBytesReturned</i> parameters.
</dd>
<dt>
<i>lpInBuffer</i></dt>
<dd>
Pointer to a buffer that contains the data required to perform the operation. 
<p>
This parameter can be NULL if the <i>dwIoControlCode</i> parameter specifies an operation that does not require input data. 
</dd>
<dt>
<i>nInBufferSize</i></dt>
<dd>
Size, in bytes, of the buffer pointed to by <i>lpInBuffer</i>. </dd>
<dt>
<i>lpOutBuffer</i></dt>
<dd>
Pointer to a buffer that receives the operation's output data. 
<p>
This parameter can be NULL if the <i>dwIoControlCode</i> parameter specifies an operation that does not produce output data. 
</dd>
<dt>
<i>nOutBufferSize</i></dt>
<dd>
Size, in bytes, of the buffer pointed to by <i>lpOutBuffer</i>. </dd>
<dt>
<i>lpBytesReturned</i></dt>
<dd>
Pointer to a variable that receives the size, in bytes, of the data stored into the buffer pointed to by <i>lpOutBuffer</i>. 
<p>
If <i>lpOverlapped</i> is NULL, <i>lpBytesReturned</i> cannot be NULL. Even when an operation produces no output data, and <i>lpOutBuffer</i> can be NULL, the <b>DeviceIoControl</b> function makes use of the variable pointed to by <i>lpBytesReturned</i>. After such an operation, the value of the variable is without meaning. 

<p>
If <i>lpOverlapped</i> is not NULL, <i>lpBytesReturned</i> can be NULL. If this is an overlapped operation, you can get the number of bytes returned by calling <a href="synchro_75v8.htm"><b>GetOverlappedResult</b></a>. If <i>hDevice</i> is associated with an I/O completion port, you can get the number of bytes returned by calling <a href="filesio_071v.htm"><b>GetQueuedCompletionStatus</b></a>.
</dd>
<dt>
<i>lpOverlapped</i></dt>
<dd>
Pointer to an <a href="synchro_8tf6.htm"><b>OVERLAPPED</b></a> structure. 
<p>
If <i>hDevice</i> was opened with the FILE_FLAG_OVERLAPPED flag, this parameter must point to a valid <b>OVERLAPPED</b> structure. In this case, <b>DeviceIoControl</b> is performed as an overlapped (asynchronous) operation. If the device was opened with FILE_FLAG_OVERLAPPED and <i>lpOverlapped</i> is NULL, the function fails in unpredictable ways.

<p>
If <i>hDevice</i> was opened without specifying the FILE_FLAG_OVERLAPPED flag, this parameter is ignored and the <b>DeviceIoControl</b> function does not return until the operation has been completed, or an error occurs. 

</dd>
</dl>
<h4>Return Values</h4>
<p>
If the function succeeds, the return value is nonzero.</p>
<p>
If the function fails, the return value is zero. To get extended error information, call <a href="errors_3uwi.htm"><b>GetLastError</b></a>. </p>
<h4>Remarks</h4>
<p>
If <i>hDevice</i> was opened with FILE_FLAG_OVERLAPPED and the <i>lpOverlapped</i> parameter points to an <b>OVERLAPPED</b> structure, <b>DeviceIoControl</b> is performed as an overlapped (asynchronous) operation. In this case, the <b>OVERLAPPED</b> structure must contain a handle to a manual-reset event object created by a call to the <b>CreateEvent</b> function. For more information on manual-reset event objects, see <a href="synchro_4q3y.htm">Synchronization</a>. </p>
<p>
<b>Windows CE:</b> No specific values are defined for the <i>dwIoControlCode </i>parameter. However, the writer of a custom device driver can define <i>IOCTL_XXXX</i> control codes, per the CTL_CODE macro. These control codes can then be advertised, and an application can use these control codes with <b>DeviceIoControl</b> to perform the driver-specific functions. </p>
<p>
The <i>lpOverlapped</i> parameter is ignored and should be NULL.</p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 3.1 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Requires Windows 95 or later.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Requires version 1.0 or later.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in winbase.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use kernel32.lib.</p>
<h4>See Also</h4>
<p>
<a href="devio_23ec.htm">Device Input and Output Overview</a>, <a href="devio_8rg3.htm">Device Input and Output Functions</a>, <a href="synchro_8ub8.htm"><b>CreateEvent</b></a>, <a href="filesio_7wmd.htm"><b>CreateFile</b></a>, <a href="synchro_75v8.htm"><b>GetOverlappedResult</b></a>, <a href="filesio_071v.htm"><b>GetQueuedCompletionStatus</b></a>, <a href="synchro_8tf6.htm"><b>OVERLAPPED</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
