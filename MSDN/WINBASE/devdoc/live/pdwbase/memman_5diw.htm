<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>VirtualFreeEx</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_virtualfreeex"></a>VirtualFreeEx</h1>
<p>
The <b>VirtualFreeEx</b> function releases, decommits, or both, a region of memory within the virtual address space of a specified process. </p>
<p>
The difference between the <b>VirtualFreeEx</b> function and the <a href="memman_0dr9.htm"><b>VirtualFree</b></a> function is that <b>VirtualFree</b> frees memory within the address space of the calling process, while <b>VirtualFreeEx</b> lets you specify a process. </p>
<pre><code><b>BOOL VirtualFreeEx(
  HANDLE</b><i> hProcess</i><b>,  </b>// process within which to free memory
<b>  LPVOID</b><i> lpAddress</i><b>, </b>// starting address of memory region to free
<b>  DWORD</b><i> dwSize</i><b>,     </b>// size, in bytes, of memory region to free
<b>  DWORD</b><i> dwFreeType</i>  // type of free operation
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>hProcess</i></dt>
<dd>
Handle to a process. The function frees memory within the virtual address space of this process. 
<p>
You must have PROCESS_VM_OPERATION access to this process. If you do not, the function fails.
</dd>
<dt>
<i>lpAddress</i></dt>
<dd>
Pointer to the starting address of the region of memory to free. 
<p>
If the MEM_RELEASE flag is set in the <i>dwFreeType</i> parameter, <i>lpAddress</i> must be the base address returned by the <a href="memman_8ptk.htm"><b>VirtualAllocEx</b></a> function when the region was reserved. 
</dd>
<dt>
<i>dwSize</i></dt>
<dd>
Specifies the size, in bytes, of the region of memory to free.
<p>
If the MEM_RELEASE flag is set in the <i>dwFreeType</i> parameter, <i>dwSize</i> must be zero. The function frees the entire region that was reserved in the initial allocation call to <b>VirtualAllocEx</b>.

<p>
If the MEM_DECOMMIT flag is set, the function decommits all memory pages that contain one or more bytes in the range from the <i>lpAddress</i> parameter to (<i>lpAddress</i>+<i>dwSize</i>). This means, for example, that a 2-byte region of memory that straddles a page boundary causes both pages to be decommitted. 

<p>
The function decommits the entire region that was reserved by <a href="memman_8ptk.htm"><b>VirtualAllocEx</b></a>. If the following three conditions are met:
</dd>
</dl>
<ul>
<li>
the MEM_DECOMMIT flag is set</li>
<li>
<i>lpAddress</i> is the base address returned by the <b>VirtualAllocEx</b> function when the region was reserved</li>
<li>
<i>dwSize</i> is zero <p>
The entire region the enters the reserved state. 
</li>
</ul>
<dl>
<dt>
<i>dwFreeType</i></dt>
<dd>
Set of bit flags that specifies the type of free operation. You must set one of the following two flags: 
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=33%>Flag</th>
<th align=left width=67%>Meaning</th>
</tr>
<tr valign=top>
<td width=33%>MEM_DECOMMIT</td>
<td width=67%>The function decommits the specified region of pages. The pages enter the reserved state. </td>
</tr>
<tr valign=top>
<td width=33%></td>
<td width=67%>The function does not fail if you attempt to decommit an uncommitted page. This means that you can decommit a range of pages without first determining their current commitment state.</td>
</tr>
<tr valign=top>
<td width=33%>MEM_RELEASE</td>
<td width=67%>The function releases the specified region of pages. The pages enter the free state.<p>
If you specify this flag, <i>dwSize</i> must be zero, and <i>lpAddress</i> must point to the base address returned by the <a href="memman_8ptk.htm"><b>VirtualAllocEx</b></a> function when the region was reserved. The function fails if either of these conditions is not met.</p>
</td>
</tr>
<tr valign=top>
<td width=33%></td>
<td width=67%>If any pages in the region are currently committed, the function first decommits and then releases them. <p>
The function does not fail if you attempt to release pages that are in different states, some reserved and some committed. This means that you can release a range of pages without first determining their current commitment state.  </p>
</td>
</tr>
</table><br>

</dd>
</dl>
<h4>Return Values</h4>
<p>
If the function succeeds, the return value is a nonzero value.</p>
<p>
If the function fails, the return value is zero. To get extended error information, call <a href="errors_3uwi.htm"><b>GetLastError</b></a>. </p>
<h4>Remarks</h4>
<p>
Each page of memory in a process's virtual address space is in one of three states: </p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=18%>State</th>
<th align=left width=82%>Meaning</th>
</tr>
<tr valign=top>
<td width=18%>Free</td>
<td width=82%>The page is neither committed nor reserved. The page is not accessible to the process. Attempting to read from or write to a free page results in an access violation exception.<p>
You can use the <b>VirtualFreeEx</b> function to put reserved or committed memory pages into the free state. </p>
</td>
</tr>
<tr valign=top>
<td width=18%>Reserved</td>
<td width=82%>The page is reserved. The range of addresses cannot be used by other allocation functions. The page is not accessible and has no physical storage associated with it.  Attempting to read from or write to a free page results in an access violation exception.<p>
You can use the <b>VirtualFreeEx</b> function to put committed memory pages into the reserved state, and to put reserved memory pages into the free state. </p>
</td>
</tr>
<tr valign=top>
<td width=18%>Committed</td>
<td width=82%>The page is committed. Physical storage in memory or in the paging file on disk is allocated for the page, and access is controlled by a protection code. <p>
The system initializes and loads each committed page into physical memory only at the first attempt to read from or write to that page. </p>
<p>
When a process terminates, the system releases all storage for committed pages. </p>
<p>
You can use the <a href="memman_8ptk.htm"><b>VirtualAllocEx</b></a> function to put committed memory pages into either the reserved or free state. </p>
</td>
</tr>
</table><br>
<p>
The <b>VirtualFreeEx</b> function can perform the following operations: 
<ul>
<li>
Decommit a region of committed or uncommitted pages. After this operation, the pages are in the reserved state.</li>
<li>
Release a region of reserved pages. After this operation, the pages are in the free state.</li>
<li>
Decommit and release a region of committed or uncommitted pages. After this operation, the pages are in the free state.</li>
</ul>
<p>
The <b>VirtualFreeEx</b> function can decommit a range of pages that are in different states, some committed and some uncommitted. This means that you can decommit a range of pages without first determining the current commitment state of each page. Decommitting a page releases its physical storage, either in memory or in the paging file on disk. </p>
<p>
If a page is decommitted but not released, its state changes to reserved. You can subsequently call <a href="memman_8ptk.htm"><b>VirtualAllocEx</b></a> to commit it, or <b>VirtualFreeEx </b>to release it. Attempting to read from or write to a reserved page results in an access violation exception. </p>
<p>
The <b>VirtualFreeEx</b> function can release a range of pages that are in different states, some reserved and some committed. This means that you can release a range of pages without first determining the current commitment state of each page.  The entire range of pages originally reserved by the <b>VirtualAllocEx</b> function must be released at the same time. </p>
<p>
If a page is released, its state changes to free, and it is available for subsequent allocation operations. Attempting to read from or write to a free page results in an access violation exception. </p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 4.0 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in winbase.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use kernel32.lib.</p>
<h4>See Also</h4>
<p>
<a href="memman_6oz8.htm">Memory Management Overview</a>, <a href="memman_60kz.htm">Memory Management Functions</a>, <a href="memman_66qr.htm"><b>GlobalAlloc</b></a>, <a href="memman_38kl.htm"><b>GlobalFree</b></a>, <a href="memman_3elf.htm"><b>VirtualAlloc</b></a>, <a href="memman_8ptk.htm"><b>VirtualAllocEx</b></a>, <a href="memman_0dr9.htm"><b>VirtualFree</b></a>, <a href="memman_5ist.htm"><b>VirtualFreeVlm</b></a></p>
<p>&nbsp;</p></body>
</HTML>
