<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Restricted Tokens</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_win32_restricted_tokens"></a>Restricted Tokens</h3>
<p>
<span style=color:#FF0000>[This is preliminary documentation and subject to change.]</span> </p>
<p>
A restricted token is a primary or impersonation access token that has been modified by the <a href="accctrl_1h9q.htm"><b>CreateRestrictedToken</b></a> function. A process or impersonating thread running in the security context of a restricted token is restricted in its ability to access securable objects or perform privileged operations. <b>CreateRestrictedToken</b> can restrict a token in the following ways:
<ul>
<li>
Remove <a href="accctrl_42pf.htm">privileges</a> from the token. </li>
<li>
Apply the deny-only attribute to SIDs in the token so they cannot be used to access secured objects. For more information about the deny-only attribute, see <a href="accctrl_79ym.htm">SID Attributes in an Access Token</a>.</li>
<li>
Specify a list of restricting SIDs, which can limit access to securable objects. </li>
</ul>
<p>
The system uses the list of restricting SIDs when it checks the token's access to a securable object. When a restricted process or thread tries to access a securable object, the system performs two access checks: one using the token's enabled SIDs, and another using the list of restricting SIDs. Access is granted only if both access checks allow the requested access rights. For more information about access checks, see <a href="accctrl_6790.htm">Checking a Thread's Access to an Object</a>.  </p>
<p>
You can use a restricted primary token in a call to the <a href="prothred_6pf6.htm"><b>CreateProcessAsUser</b></a> function. Typically, the process that calls <b>CreateProcessAsUser</b> must have the SE_ASSIGNPRIMARYTOKEN_NAME privilege, which is usually held only by system code or by services running in the LocalSystem account. However, if the <b>CreateProcessAsUser</b> call specifies a restricted version of the caller's primary token, this privilege is not required. This enables ordinary applications to create restricted processes.</p>
<p>
You can also use a restricted primary or impersonation token in the <b>ImpersonateLoggedOnUser</b> function. </p>
<p>&nbsp;</p></body>
</HTML>
