<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>ReadDirectoryChangesW</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_readdirectorychangesw"></a>ReadDirectoryChangesW</h1>
<p>
The <b>ReadDirectoryChangesW</b> function returns information describing the changes occurring within a directory.</p>
<pre><code><b>BOOL ReadDirectoryChangesW(
  HANDLE</b><i> hDirectory</i><b>,    </b>// handle to the directory to be watched
<b>  LPVOID</b><i> lpBuffer</i><b>,      </b>// pointer to the buffer to receive the read 
                        // results
<b>  DWORD</b><i> nBufferLength</i><b>,  </b>// length of <i>lpBuffer</i>
<b>  BOOL</b><i> bWatchSubtree</i><b>,   </b>// flag for monitoring directory or 
                        // directory tree
<b>  DWORD</b><i> dwNotifyFilter</i><b>, </b>// filter conditions to watch for
<b>  LPDWORD</b><i> lpBytesReturned</i><b>,  </b>// number of bytes returned
<b>  LPOVERLAPPED</b><i> lpOverlapped</i><b>,</b>
<b>                        </b>// pointer to structure needed for 
                        // overlapped I/O
<b>  LPOVERLAPPED_COMPLETION_ROUTINE</b><i> lpCompletionRoutine</i>
<i>                        </i>// pointer to completion routine
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>hDirectory</i></dt>
<dd>
Handle to the directory to be watched. This directory must be opened with the FILE_LIST_DIRECTORY access right.</dd>
<dt>
<i>lpBuffer</i></dt>
<dd>
Specifies the address of the formatted buffer in which the read results are to be returned. The structure of this buffer is defined by the <a href="filesio_9ysy.htm"><b>FILE_NOTIFY_INFORMATION</b></a> structure. This buffer is filled either synchronously or asynchronously, depending on how the directory is opened and what value is given to the <i>lpOverlapped</i> parameter. For more information, see the Remarks section.</dd>
<dt>
<i>nBufferLength</i></dt>
<dd>
Specifies the length of the buffer pointed to by the <i>lpBuffer </i>parameter.</dd>
<dt>
<i>bWatchSubtree</i></dt>
<dd>
Specifies whether the <b>ReadDirectoryChangesW</b> function will monitor the directory or the directory tree. If TRUE is specified, the function monitors the directory tree rooted at the specified directory. If FALSE is specified, the function monitors only the directory specified by the <i>hDirectory</i> parameter. </dd>
<dt>
<i>dwNotifyFilter</i></dt>
<dd>
Specifies filter criteria the function checks to determine if the wait operation has completed. This parameter can be one or more of the following values:
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=57%>Value</th>
<th align=left width=43%>Meaning</th>
</tr>
<tr valign=top>
<td width=57%>FILE_NOTIFY_CHANGE_FILE_NAME</td>
<td width=43%>Any filename change in the watched directory or subtree causes a change notification wait operation to return. Changes include renaming, creating, or deleting a file. </td>
</tr>
<tr valign=top>
<td width=57%>FILE_NOTIFY_CHANGE_DIR_NAME</td>
<td width=43%>Any directory-name change in the watched directory or subtree causes a change notification wait operation to return. Changes include creating or deleting a directory.</td>
</tr>
<tr valign=top>
<td width=57%>FILE_NOTIFY_CHANGE_ATTRIBUTES</td>
<td width=43%>Any attribute change in the watched directory or subtree causes a change notification wait operation to return.</td>
</tr>
<tr valign=top>
<td width=57%>FILE_NOTIFY_CHANGE_SIZE</td>
<td width=43%>Any file-size change in the watched directory or subtree causes a change notification wait operation to return. The operating system detects a change in file size only when the file is written to the disk. For operating systems that use extensive caching, detection occurs only when the cache is sufficiently flushed.</td>
</tr>
<tr valign=top>
<td width=57%>FILE_NOTIFY_CHANGE_LAST_WRITE</td>
<td width=43%>Any change to the last write-time of files in the watched directory or subtree causes a change notification wait operation to return. The operating system detects a change to the last write-time only when the file is written to the disk. For operating systems that use extensive caching, detection occurs only when the cache is sufficiently flushed.</td>
</tr>
<tr valign=top>
<td width=57%>FILE_NOTIFY_CHANGE_LAST_ACCESS</td>
<td width=43%>Any change to the last access time of files in the watched directory or subtree causes a change notification wait operation to return.</td>
</tr>
<tr valign=top>
<td width=57%>FILE_NOTIFY_CHANGE_CREATION</td>
<td width=43%>Any change to the creation time of files in the watched directory or subtree causes a change notification wait operation to return.</td>
</tr>
<tr valign=top>
<td width=57%>FILE_NOTIFY_CHANGE_SECURITY</td>
<td width=43%>Any security-descriptor change in the watched directory or subtree causes a change notification wait operation to return.</td>
</tr>
</table><br>

</dd>
<dt>
<i>lpBytesReturned</i></dt>
<dd>
For synchronous calls, this parameter specifies the number of bytes transferred into the <i>lpBuffer </i>parameter. For asynchronous calls, this parameter is undefined. You must use an asynchronous notification technique to retrieve the number of bytes transferred.</dd>
<dt>
<i>lpOverlapped</i></dt>
<dd>
Pointer to an <a href="synchro_8tf6.htm"><b>OVERLAPPED</b></a> structure that supplies data to be used during asynchronous operation. Otherwise, this value is NULL. The <b>Offset</b> and <b>OffsetHigh</b> members of this structure are not used.</dd>
<dt>
<i>lpCompletionRoutine</i></dt>
<dd>
Pointer to a completion routine to be called when the operation has been completed or canceled and the calling thread is in an alertable wait state. For more information about this completion routine, see <a href="filesio_1v1h.htm"><b>FileIOCompletionRoutine</b></a>.
</dd>
</dl>
<h4>Return Values</h4>
<p>
If the function succeeds, the return value is nonzero. For synchronous calls, this means that the operation succeeded. For asynchronous calls, this indicates that the operation was successfully queued.</p>
<p>
If the function fails, the return value is zero. To get extended error information, call <a href="errors_3uwi.htm"><b>GetLastError</b></a>.</p>
<h4>Remarks</h4>
<p>
To obtain a handle to a directory, use the <a href="filesio_7wmd.htm"><b>CreateFile</b></a><b> </b>function with FILE_FLAG_BACKUP_SEMANTICS as follows:</p>
<pre><code>hDir = CreateFile(
  DirName,                            // pointer to the file name
  FILE_LIST_DIRECTORY,                // access (read-write) mode
  FILE_SHARE_READ|FILE_SHARE_DELETE,  // share mode
  NULL,                               // security descriptor
  OPEN_EXISTING,                      // how to create
  FILE_FLAG_BACKUP_SEMANTICS,         // file attributes
  NULL                                // file with attributes to copy
);
 </code></pre>
<p>
A call to <b>ReadDirectoryChangesW</b> can be completed synchronously or asynchronously. To specify asynchronous completion, open the directory with <b>CreateFile</b> as shown above, but additionally specify the FILE_FLAG_OVERLAPPED attribute in the <i>dwFlagsAndAttributes</i> parameter. Then specify an <a href="synchro_8tf6.htm"><b>OVERLAPPED</b></a> structure when you call <b>ReadDirectoryChangesW</b>. </p>
<p>
Upon successful synchronous completion, the <i>lpBuffer</i> parameter is a formatted buffer and the number of bytes written to the buffer is available in <i>lpBytesReturned</i>. If the number of bytes transferred is zero, the buffer was too small to provide detailed information on all the changes that occurred in the directory or subtree. In this case, you should compute the changes by enumerating the directory or subtree.</p>
<p>
For asynchronous completion, you can receive notification in one of three ways:
<ul>
<li>
Using the <a href="synchro_75v8.htm"><b>GetOverlappedResult</b></a> function. To receive notification through <b>GetOverlappedResult</b>, do not specify a completion routine in the <i>lpCompletionRoutine</i> parameter. Be sure to set the <b>hEvent</b> member of the <a href="synchro_8tf6.htm"><b>OVERLAPPED</b></a> structure to a unique event. </li>
<li>
Using the <a href="filesio_071v.htm"><b>GetQueuedCompletionStatus</b></a><b> </b>function. To receive notification through <b>GetQueuedCompletionStatus</b>, do not specify a completion routine in <i>lpCompletionRoutine</i>. Associate the directory handle <i>hDirectory</i> with a completion port by calling the <a href="filesio_4k1g.htm"><b>CreateIoCompletionPort</b></a> function. </li>
<li>
Using a completion routine. To receive notification through a completion routine, do not associate the directory with a completion port. Specify a completion routine in <i>lpCompletionRoutine</i>. This routine is called whenever the operation has been completed or canceled while the thread is in an alertable wait state. The <b>hEvent</b> member of the <b>OVERLAPPED</b> structure is not used by the system, so you can use it yourself.</li>
</ul>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 4.0 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in winbase.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use kernel32.lib.</p>
<h4>See Also</h4>
<p>
<a href="filesio_2xm7.htm">File I/O Overview</a>, <a href="filesio_3n5f.htm">File Functions</a>, <a href="filesio_7wmd.htm"><b>CreateFile</b></a>, <a href="filesio_4k1g.htm"><b>CreateIoCompletionPort</b></a>,<b> <a href="filesio_9ysy.htm">FILE_NOTIFY_INFORMATION</a></b>, <a href="filesio_1v1h.htm"><b>FileIOCompletionRoutine</b></a>, <a href="synchro_75v8.htm"><b>GetOverlappedResult</b></a>, <a href="filesio_071v.htm"><b>GetQueuedCompletionStatus</b></a>, <a href="synchro_8tf6.htm"><b>OVERLAPPED</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
