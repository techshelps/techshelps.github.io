<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>ObjectPrivilegeAuditAlarm</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_objectprivilegeauditalarm"></a>ObjectPrivilegeAuditAlarm</h1>
<p>
The <b>ObjectPrivilegeAuditAlarm</b> function generates an audit message in the security event log. A protected server can use this function to log attempts by a client to use a specified set of privileges with an open handle to a private object. Alarms are not supported in the current version of Windows NT. </p>
<pre><code><b>BOOL ObjectPrivilegeAuditAlarm(
  LPCTSTR</b><i> SubsystemName</i><b>,      </b>// pointer to string for subsystem name
<b>  LPVOID</b><i> HandleId</i><b>,            </b>// pointer to handle identifier
<b>  HANDLE</b><i> ClientToken</i><b>,         </b>// handle to client's access token
<b>  DWORD</b><i> DesiredAccess</i><b>,        </b>// mask for desired access rights
  <b>PPRIVILEGE_SET</b> <i>Privileges</i><b>,</b>  // pointer to privileges
<b>  BOOL</b><i> AccessGranted</i>          // flag for results
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>SubsystemName</i></dt>
<dd>
Pointer to a null-terminated string specifying the name of the subsystem calling the function. This string appears in the audit message.</dd>
<dt>
<i>HandleId</i></dt>
<dd>
Pointer to a unique 32-bit value representing the client's handle to the object. </dd>
<dt>
<i>ClientToken</i></dt>
<dd>
Identifies an access token representing the client that requested the operation. This handle must have been obtained by opening the token of a thread impersonating the client. The token must be open for TOKEN_QUERY access. The function uses this token to get the identity of the client for the audit message.</dd>
<dt>
<i>DesiredAccess</i></dt>
<dd>
Specifies an access mask indicating the privileged access types being used or whose use is being attempted. The access mask can be mapped by the <a href="accclsrv_8757.htm"><b>MapGenericMask</b></a> function so it does not contain any generic access types. </dd>
<dt>
<i>Privileges</i></dt>
<dd>
Pointer to a <a href="accclsrv_9ss2.htm"><b>PRIVILEGE_SET</b></a> structure containing the privileges that the client attempted to use. The names of the privileges appear in the audit message. </dd>
<dt>
<i>AccessGranted</i></dt>
<dd>
Specifies a flag indicating whether the client's attempt to use the privileges was successful. If this flag is TRUE, the audit message indicates success. If this flag is FALSE, the audit message indicates failure. 
</dd>
</dl>
<h4>Return Values</h4>
<p>
If the function succeeds, the return value is nonzero.</p>
<p>
If the function fails, the return value is zero. To get extended error information, call <a href="errors_3uwi.htm"><b>GetLastError</b></a>. </p>
<h4>Remarks</h4>
<p>
The <b>ObjectPrivilegeAuditAlarm</b> function does not check the client's access to the object or check the client's access token to determine whether the privileges are held or enabled. Typically, you would call the <b>PrivilegeCheck</b> function to determine whether the specified privileges are enabled in the access token, call the <b>AccessCheck</b> function to check the client's access to the object, and then call <b>ObjectPrivilegeAuditAlarm</b> to log the results. </p>
<p>
The <b>ObjectPrivilegeAuditAlarm</b> function requires the calling process to have SE_AUDIT_NAME privilege enabled. The test for this privilege is always performed against the primary token of the calling process, not the impersonation token of the thread. This allows the calling process to impersonate a client during the call. </p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 3.1 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in winbase.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use advapi32.lib.<br>
<b>&nbsp;&nbsp;Unicode: </b>Implemented as Unicode and ANSI versions on Windows NT.</p>
<h4>See Also</h4>
<p>
<a href="accclsrv_64vg.htm">Client/Server Access Control Overview</a>, <a href="accclsrv_0hv7.htm">Client/Server Access Control Functions</a>, <a href="accclsrv_5jjf.htm"><b>AccessCheck</b></a>, <a href="accclsrv_5ze5.htm"><b>AccessCheckAndAuditAlarm</b></a>, <a href="accclsrv_8757.htm"><b>MapGenericMask</b></a>, <a href="accclsrv_2vvx.htm"><b>ObjectCloseAuditAlarm</b></a>, <a href="accclsrv_3625.htm"><b>ObjectOpenAuditAlarm</b></a>, <a href="accclsrv_9vhn.htm"><b>PrivilegeCheck</b></a>, <a href="accclsrv_68od.htm"><b>PrivilegedServiceAuditAlarm</b></a>, <a href="accclsrv_9ss2.htm"><b>PRIVILEGE_SET</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
