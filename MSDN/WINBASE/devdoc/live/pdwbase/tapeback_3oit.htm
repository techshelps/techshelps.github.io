<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PrepareTape</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_preparetape"></a>PrepareTape</h1>
<p>
The <b>PrepareTape</b> function prepares the tape to be accessed or removed. </p>
<pre><code><b>DWORD PrepareTape(
  HANDLE</b><i> hDevice</i><b>,     </b>// handle of open device
<b>  DWORD</b><i> dwOperation</i><b>,  </b>// preparation method
<b>  BOOL</b><i> bImmediate</i>     // return after operation begins
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>hDevice</i></dt>
<dd>
Identifies the device preparing the tape. This handle is created by using the <a href="filesio_7wmd.htm"><b>CreateFile</b></a> function. </dd>
<dt>
<i>dwOperation</i></dt>
<dd>
Specifies how the tape device is to be prepared. This parameter can be one of the following values: 
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=29%>Value</th>
<th align=left width=71%>Meaning</th>
</tr>
<tr valign=top>
<td width=29%>TAPE_FORMAT</td>
<td width=71%>Performs a low-level format of the tape. Currently, only the QIC117 device supports this feature.</td>
</tr>
<tr valign=top>
<td width=29%>TAPE_LOAD</td>
<td width=71%>Loads the tape and moves the tape to the beginning.</td>
</tr>
<tr valign=top>
<td width=29%>TAPE_LOCK</td>
<td width=71%>Locks the tape ejection mechanism so that the tape is not ejected accidentally.</td>
</tr>
<tr valign=top>
<td width=29%>TAPE_TENSION</td>
<td width=71%>Adjusts the tension by moving the tape to the end of the tape and back to the beginning. This option is not supported by all devices. This value is ignored if it is not supported.</td>
</tr>
<tr valign=top>
<td width=29%>TAPE_UNLOAD</td>
<td width=71%>Moves the tape to the beginning for removal from the device. After a successful unload operation, the device returns errors to applications that attempt to access the tape, until the tape is loaded again.</td>
</tr>
<tr valign=top>
<td width=29%>TAPE_UNLOCK</td>
<td width=71%>Unlocks the tape ejection mechanism.</td>
</tr>
</table><br>

</dd>
<dt>
<i>bImmediate</i></dt>
<dd>
Specifies whether to return as soon as the preparation begins. If this parameter is TRUE, the function returns immediately. If it is FALSE, the function does not return until the operation has been completed. 
</dd>
</dl>
<h4>Return Values</h4>
<p>
If the function succeeds, the return value is NO_ERROR.</p>
<p>
If the function fails, the return value is one of the following error codes: </p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=55%>Error</th>
<th align=left width=45%>Description</th>
</tr>
<tr valign=top>
<td width=55%>ERROR_BEGINNING_OF_MEDIA</td>
<td width=45%>An attempt to access data before the beginning-of-medium marker failed.</td>
</tr>
<tr valign=top>
<td width=55%>ERROR_BUS_RESET</td>
<td width=45%>A reset condition was detected on the bus.</td>
</tr>
<tr valign=top>
<td width=55%>ERROR_END_OF_MEDIA</td>
<td width=45%>The end-of-tape marker was reached during an operation.</td>
</tr>
<tr valign=top>
<td width=55%>ERROR_FILEMARK_DETECTED</td>
<td width=45%>A filemark was reached during an operation.</td>
</tr>
<tr valign=top>
<td width=55%>ERROR_SETMARK_DETECTED</td>
<td width=45%>A setmark was reached during an operation.</td>
</tr>
<tr valign=top>
<td width=55%>ERROR_NO_DATA_DETECTED</td>
<td width=45%>The end-of-data marker was reached during an operation.</td>
</tr>
<tr valign=top>
<td width=55%>ERROR_PARTITION_FAILURE</td>
<td width=45%>The tape could not be partitioned.</td>
</tr>
<tr valign=top>
<td width=55%>ERROR_INVALID_BLOCK_LENGTH</td>
<td width=45%>The block size is incorrect on a new tape in a multivolume partition.</td>
</tr>
<tr valign=top>
<td width=55%>ERROR_DEVICE_NOT_PARTITIONED</td>
<td width=45%>The partition information could not be found when a tape was being loaded.</td>
</tr>
<tr valign=top>
<td width=55%>ERROR_MEDIA_CHANGED</td>
<td width=45%>The tape that was in the drive has been replaced or removed.</td>
</tr>
<tr valign=top>
<td width=55%>ERROR_NO_MEDIA_IN_DRIVE</td>
<td width=45%>There is no media in the drive.</td>
</tr>
<tr valign=top>
<td width=55%>ERROR_NOT_SUPPORTED</td>
<td width=45%>The tape driver does not support a requested function.</td>
</tr>
<tr valign=top>
<td width=55%>ERROR_UNABLE_TO_LOCK_MEDIA</td>
<td width=45%>An attempt to lock the ejection mechanism failed.</td>
</tr>
<tr valign=top>
<td width=55%>ERROR_UNABLE_TO_UNLOAD_MEDIA</td>
<td width=45%>An attempt to unload the tape failed.</td>
</tr>
<tr valign=top>
<td width=55%>ERROR_WRITE_PROTECT</td>
<td width=45%>The media is write protected.</td>
</tr>
</table><br>
<h4>Remarks</h4>
<p>
Some tape devices do not support certain tape operations. See your tape device documentation and use the <a href="tapeback_110z.htm"><b>GetTapeParameters</b></a> function to determine your tape device's capabilities.  </p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 3.1 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in winbase.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use kernel32.lib.</p>
<h4>See Also</h4>
<p>
<a href="tapeback_0rlc.htm">Tape Backup Overview</a>, <a href="tapeback_1rw3.htm">Tape Backup Functions</a>, <a href="filesio_7wmd.htm"><b>CreateFile</b></a>, <a href="tapeback_110z.htm"><b>GetTapeParameters</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
