<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>PrivilegedServiceAuditAlarm</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_privilegedserviceauditalarm"></a>PrivilegedServiceAuditAlarm</h1>
<p>
The <b>PrivilegedServiceAuditAlarm</b> function generates an audit message in the security event log. A protected server can use this function to log attempts by a client to use a specified set of privileges.</p>
<p>
Alarms are not supported in the current version of Windows NT. </p>
<pre><code><b>BOOL PrivilegedServiceAuditAlarm(
  LPCTSTR</b><i> SubsystemName</i><b>,      </b>// address of string for subsystem name
<b>  LPCTSTR</b><i> ServiceName</i><b>,        </b>// address of string for service name
<b>  HANDLE</b><i> ClientToken</i><b>,         </b>// handle of access token
<b>  PPRIVILEGE_SET</b><i> Privileges</i><b>,  </b>// address of privileges
<b>  BOOL</b><i> AccessGranted</i>          // flag for granted access rights
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>SubsystemName</i></dt>
<dd>
Pointer to a null-terminated string specifying the name of the subsystem calling the function. This information appears in the security event log record.</dd>
<dt>
<i>ServiceName</i></dt>
<dd>
Pointer to a null-terminated string specifying the name of the privileged subsystem service. This information appears in the security event log record.</dd>
<dt>
<i>ClientToken</i></dt>
<dd>
Identifies an access token representing the client that requested the operation. This handle must have been obtained by opening the token of a thread impersonating the client. The token must be open for TOKEN_QUERY access. The function uses this token to get the identity of the client for the security event log record.</dd>
<dt>
<i>Privileges</i></dt>
<dd>
Pointer to a <a href="accclsrv_9ss2.htm"><b>PRIVILEGE_SET</b></a> structure containing the privileges that the client attempted to use. The names of the privileges appear in the security event log record. </dd>
<dt>
<i>AccessGranted</i></dt>
<dd>
Specifies a flag indicating whether the client's attempt to use the privileges was successful. If this flag is TRUE, the security event log record indicates success. If this flag is FALSE, the security event log record indicates failure. 
</dd>
</dl>
<h4>Return Values</h4>
<p>
If the function succeeds, the return value is nonzero.</p>
<p>
If the function fails, the return value is zero. To get extended error information, call <a href="errors_3uwi.htm"><b>GetLastError</b></a>. </p>
<h4>Remarks</h4>
<p>
The <b>PrivilegedServiceAuditAlarm</b> function does not check the client's access token to determine whether the privileges are held or enabled. Typically, you would first call the <b>PrivilegeCheck</b> function to determine whether the specified privileges are enabled in the access token, and then call <b>PrivilegedServiceAuditAlarm</b> to log the results.  </p>
<p>
The <b>PrivilegedServiceAuditAlarm</b> function requires the calling process to have SE_AUDIT_NAME privilege enabled. The test for this privilege is always performed against the primary token of the calling process. This allows the calling process to impersonate a client during the call. </p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 3.1 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in winbase.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use advapi32.lib.<br>
<b>&nbsp;&nbsp;Unicode: </b>Implemented as Unicode and ANSI versions on Windows NT.</p>
<h4>See Also</h4>
<p>
<a href="accclsrv_64vg.htm">Client/Server Access Control Overview</a>, <a href="accclsrv_0hv7.htm">Client/Server Access Control Functions</a>, <a href="accclsrv_6gdp.htm"><b>ObjectPrivilegeAuditAlarm</b></a>, <a href="accclsrv_9vhn.htm"><b>PrivilegeCheck</b></a>, <a href="accclsrv_9ss2.htm"><b>PRIVILEGE_SET</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
