<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>RegisterServiceCtrlHandler</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_registerservicectrlhandler"></a>RegisterServiceCtrlHandler</h1>
<p>
A Win32-based service calls the <b>RegisterServiceCtrlHandler</b> function to register a function to handle its service control requests. </p>
<pre><code><b>SERVICE_STATUS_HANDLE RegisterServiceCtrlHandler(
  LPCTSTR</b><i> lpServiceName</i><b>,             </b>// address of name of service
<b>  LPHANDLER_FUNCTION</b><i> lpHandlerProc</i>   // address of handler function
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>lpServiceName</i></dt>
<dd>
Pointer to a null-terminated string that names the service run by the calling thread. This is the service name that the service control program specified in the <a href="services_3p9h.htm"><b>CreateService</b></a> function when creating the service. </dd>
<dt>
<i>lpHandlerProc</i></dt>
<dd>
Pointer to the handler function to be registered. For more information, see  <a href="services_18oi.htm"><b>Handler</b></a>.
</dd>
</dl>
<h4>Return Values</h4>
<p>
If the function succeeds, the return value is a service status handle.</p>
<p>
If the function fails, the return value is zero. To get extended error information, call <a href="errors_3uwi.htm"><b>GetLastError</b></a>. </p>
<h4>Errors</h4>
<p>
The following error codes can be set by the service control manager. Other error codes can be set by the registry functions that are called by the service control manager. </p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=53%>Value</th>
<th align=left width=47%>Meaning</th>
</tr>
<tr valign=top>
<td width=53%>ERROR_INVALID_NAME</td>
<td width=47%>The specified service name is invalid.</td>
</tr>
<tr valign=top>
<td width=53%>ERROR_SERVICE_DOES_NOT_EXIST</td>
<td width=47%>The specified service does not exist.</td>
</tr>
</table><br>
<h4>Remarks</h4>
<p>
The <a href="services_61pq.htm"><b>ServiceMain</b></a> function of a new service should immediately call the <b>RegisterServiceCtrlHandler</b> function to register a control handler function with the control dispatcher. This enables the control dispatcher to invoke the specified function when it receives control requests for this service. The threads of the calling process can use the service status handle returned by this function to identify the service in subsequent calls to the <a href="services_90oj.htm"><b>SetServiceStatus</b></a> function. </p>
<p>
This function must be called before the first <b>SetServiceStatus</b> call because it returns a service status handle for the caller to use so that no other service can inadvertently set this service status. In addition, the control handler must be in place to field control requests by the time the service specifies the controls it accepts through the <b>SetServiceStatus</b> function. </p>
<p>
When the control handler function is invoked with a control request, it must call <b>SetServiceStatus</b> to notify the service control manager of its current status, regardless of whether the status of the service has changed. </p>
<p>
The service status handle does not have to be closed. </p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 3.1 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in winsvc.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use advapi32.lib.<br>
<b>&nbsp;&nbsp;Unicode: </b>Implemented as Unicode and ANSI versions on Windows NT.</p>
<h4>See Also</h4>
<p>
<a href="services_0p0z.htm">Services Overview</a>, <a href="services_2uwj.htm">Service Functions</a>, <a href="services_3p9h.htm"><b>CreateService</b></a>, <a href="services_18oi.htm"><b>Handler</b></a>, <a href="services_61pq.htm"><b>ServiceMain</b></a>, <a href="services_90oj.htm"><b>SetServiceStatus</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
