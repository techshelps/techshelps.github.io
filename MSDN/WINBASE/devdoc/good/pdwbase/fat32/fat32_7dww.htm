<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>SetDPB_GetSetActFATandMirr (FAT32)</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="funcs_0000000101001f00"></a>SetDPB_GetSetActFATandMirr (FAT32) </h1>
<p>
[Windows 95 only.]</p>
<p>
Allows the active FAT and FAT mirror properties of a FAT32 drive to be read and changed. This call is invalid on FAT12 and FAT16 drives. </p>
<p>
This sub-function is called when the SetDPB_Function field of the <a href="fat32_6uk0.htm">SDPDFormatStruc (FAT32)</a> structure is set to 3. </p>
<h4>Parameters</h4>
<dl>
<dt>
<i>SetDPB_Value1</i> </dt>
<dd>
The SetDPB_Value1 field in the SPDPFormatStruc structure determines the SET behavior. If the SetDPB_Value1 field is set to 0xFFFFFFFF, then no changes are made and the ActiveFat and FAT mirror property are returned to SetDPB_Value2. 
<p>
<b>Failure Conditions:</b> 

<p>
The low four bits of this value are the zero-based ActiveFAT number. If the ActiveFAT number is greater than or equal to the number of FATs on the drive, the call will fail. 

<p>
Bit 0x00000080 is the "Disable FAT Mirror" bit. If any bits other than 0x80 and the low four bits are set, the call will fail. 

<p>
If the FAT Mirror is enabled (bit 0x80 clear) and the ActiveFAT value specified in SetDPB_Value1 is not zero, the call will fail. 
</dd>
<dt>
<i>SetDPB_Value2</i> </dt>
<dd>
Used as a return field for the previous ActiveFAT and FAT mirror properties. Bits 0 through 3 indicate the active FAT number, bit 7 indicates the mirror state, and all other bits are reserved. If SetDPB_Value1 is 0xFFFFFFFF, the previous state is also the current state. 
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=50%>Bit 7</th>
<th align=left width=50%>Description </th>
</tr>
<tr valign=top>
<td width=50%>Set </td>
<td width=50%>Enable FAT Mirroring </td>
</tr>
<tr valign=top>
<td width=50%>Clear </td>
<td width=50%>Disable FAT Mirroring </td>
</tr>
</table><br>

</dd>
</dl>
<h4>Return Values</h4>
<p>
If the function is unsuccessful, the function sets the carry flag and returns ERROR_GEN_FAILURE (error code 31) to AX. Receiving ERROR_GEN_FAILURE as the return value indicates that a disk error occurred during the attempt to write. In this case, the DPB mirror property is changed, but not properly written to disk. If the function fails, it is recommended that the caller re-write the value returned to SetDBP_Value2 to attempt to undo the change. </p>
<h4>Remarks</h4>
<p>
<b>Side Effects of Set Form:</b> </p>
<p>
The BPB(s) and boot sector(s) of the drive are also written. This is because the ActiveFAT and FAT mirror properties are also stored in the BPB. </p>
<p>
If the FAT Mirror is being enabled (that is, bit 0x80 is set in the current state, and bit 0x80 is clear in SetDPB_Value1.) this call will copy the active FAT sectors to all of the other FATs. This process can be very slow. </p>
<p>
Note that the device driver may also contain these values as part of its current device parameters. This call will have no effect on the FAT Mirror properties held by the device driver. As a result, it is recommended to immediately follow the set form of the call with a SetDeviceParameters Generic IOCTL call to set the current BPB that the BuildBPB routine of the device returns. </p>
<p>
Next Free DPB variable is reset to 2, and the Free Count DPB is reset to 0xFFFFFFFF. </p>
<p>
The assembler calling sequence for all Int 21h 7304h sub-functions is almost identical. See the main listing for a sample. (<a href="fat32_719s.htm">Int 21h Function 7304h Set_DPBForFormat (FAT32)</a>) </p>
<p>&nbsp;</p></body>
</HTML>
