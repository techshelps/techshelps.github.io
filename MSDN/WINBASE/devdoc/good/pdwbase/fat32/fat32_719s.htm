<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Int 21h Function 7304h Set_DPBForFormat (FAT32)</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="funcs_0000000101001b00"></a>Int 21h Function 7304h Set_DPBForFormat (FAT32) </h1>
<p>
[Windows 95 only.]</p>
<p>
Implements a sub-function to perform DPB operations. </p>
<p>
There are five sub-functions that can be implemented. The buffer at ES:DI must contain a <a href="fat32_6uk0.htm">SDPDFormatStruc (FAT32)</a> structure. The value in the DWORD field, <i>SetDPB_Function</i>, determines which sub-function is called. </p>
<pre><code>mov  dx, seg Buffer
mov  es, dx
mov  di, offset Buffer   ;See below

mov  es:[di].SDPDFormatStruc.SetDPB_Level, ExpectLevel   ;See below

mov  ax, word ptr Value1 ; initialize SDPDFormatStruc values.
                         ; See specific sub-function for details.

mov  word ptr es:[di].SDPDFormatStruc.SetDPB_Value1, ax
mov  ax, word ptr Value1 + 2
mov  word ptr es:[di].SDPDFormatStruc.SetDPB_Value1+2, ax

mov  ax, word ptr SubFunction
mov  word ptr es:[di].SDPDFormatStruc.SetDPB_Function, ax
mov  word ptr es:[di].SDPDFormatStruc.SetDPB_Function+2, 0

mov  dl, DriveNum       ;See below
mov  cx, BufferSize     ;See below
mov  ax, 7304h          ;Set_DPBForFormat
int 21h
</code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>Buffer</i> </dt>
<dd>
The address of a buffer containing a SDPDFormatStruc structure at ES:DI. </dd>
<dt>
<i>ExpectLevel</i> </dt>
<dd>
The expected return level value. This should be 0. </dd>
<dt>
<i>DriveNum </i></dt>
<dd>
The 1-based drive number (0=default; 1=A, 2=B, and so on). </dd>
<dt>
<i>BufferSize </i></dt>
<dd>
The size of the buffer, in bytes. </dd>
</dl>
<h4>Remarks</h4>
<p>
<b>Selecting a Sub-Function:</b> </p>
<p>
The value in the SetDPB_Function field of the SDPDFormatStruc structure determines which sub-function is implemented. </p>
<table cellspacing=4 cols=2>
<tr valign=top>
<td width=50%>0</td>
<td width=50%><a href="fat32_74fk.htm">SetDPB_SetAllocInfo</a> </td>
</tr>
<tr valign=top>
<td width=50%>1</td>
<td width=50%><a href="fat32_77lc.htm">SetDPB_SetDPBFrmBPB</a> </td>
</tr>
<tr valign=top>
<td width=50%>2</td>
<td width=50%><a href="fat32_7ar4.htm">SetDPB_ForceMediaChng</a> </td>
</tr>
<tr valign=top>
<td width=50%>3</td>
<td width=50%><a href="fat32_7dww.htm">SetDPB_GetSetActFATandMirr</a> </td>
</tr>
<tr valign=top>
<td width=50%>4</td>
<td width=50%><a href="fat32_89io.htm">SetDPB_GetSetRootDirClus</a> </td>
</tr>
</table><br>
<p>
It is important to be aware of the state of the file system when using this call. If sectors of the drive are cached, or if there are files open, the function may produce unexpected results. To avoid this, ensure that the application closes all files and calls DiskReset to flush and invalidate any caches. </p>
<p>
The SDPDFormatStruc also contains four ULONG fields: SetDPB_Value1, SetDPB_Value2, SetDPB_Value3, and SetDPB_Value4. Set these appropriately according to the requirements for each of the sub-functions. </p>
<p>
When calling this function with <b>DeviceIoControl</b>, set the <i>dwloControlCode</i> parameter to VWIN32_DIOC_DOS_IOCTL (defined as 6 in VWIN32.H). For more information on this, see <b>Using VWIN32 to Carry Out MS-DOS Functions</b>. </p>
<p>&nbsp;</p></body>
</HTML>
