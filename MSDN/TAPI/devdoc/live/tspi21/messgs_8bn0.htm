<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>LINE_NEWCALL</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_tspi_line_newcall"></a>LINE_NEWCALL</h1>
<p>
The LINE_NEWCALL message is sent to the <a href="func3_7q7o.htm"><b>LINEEVENT</b></a> callback function whenever a new call that TAPI has not originated arrives on a line that TAPI has open. This must be the first message sent regarding that call. TAPI writes the <i>htCall</i> opaque handle to the location passed by the service provider as <i>dwParam2</i>. This gives the service provider the <i>htCall</i> value to be used in subsequent messages.</p>
<pre><code>LINE_NEWCALL
htLine = (HTAPILINE) hLineDevice;
htCall = (HTAPICALL) 0;
dwMsg = (DWORD) LINE_NEWCALL;
dwParam1 = (DWORD)(HDRVCALL) hdCall;
dwParam2 = (DWORD)(LPHTAPICALL) &amp;htCall;
dwParam3 = (DWORD) 0;
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>htLine</i></dt>
<dd>
The TAPI opaque object handle to the line device.</dd>
<dt>
<i>htCall</i></dt>
<dd>
Unused.</dd>
<dt>
<i>dwMsg</i></dt>
<dd>
The value LINE_NEWCALL.</dd>
<dt>
<i>dwParam1</i></dt>
<dd>
The service provider's opaque handle for the call, of type <a href="datype_6j8s.htm">HDRVCALL</a>. TAPI passes this value as the <i>hdCall</i> parameter to identify the call in subsequent procedures it invokes to operate on the call.</dd>
<dt>
<i>dwParam2</i></dt>
<dd>
A pointer of type LPHTAPICALL pointing to a <a href="datype_80z0.htm">HTAPICALL</a>. TAPI writes the TAPI opaque handle for the call to the indicated location. The service provider must save this value and pass it as the <i>htCall</i> parameter to identify the call in subsequent events it reports for the call.
<p>
This parameter can also acquire a value of NULL (see the following Remarks section).
</dd>
<dt>
<i>dwParam3</i></dt>
<dd>
Unused.
</dd>
</dl>
<h4>Remarks</h4>
<p>
The service provider should send the <a href="messgs_7gth.htm">LINE_CALLSTATE</a> message as the next message for this call. The LINE_NEWCALL event is unusual in that it also passes a value back to the service provider.</p>
<p>
This function reports any new calls that originate in the service provider (inbound, outbound, initiated at the phone, and so on) for which TAPI and the service provider have not yet exchanged opaque handles. The handles are exchanged so that TAPI and the service provider can subsequently make requests and report events involving the call. Because these new calls are not necessarily inbound, the calls can initially be in <i>any</i> state, not necessarily the <i>offering</i> state. If the service provider starts and discovers that one or more calls are already active on the line, it informs TAPI of them with LINE_NEWCALL messages followed by LINE_CALLSTATE messages indicating the current state. A new outgoing call, initiated on the phone by the user, would be reported with a LINE_NEWCALL message, and the initial LINE_CALLSTATE message would indicate that the call was in <b>DIALTONE</b> state (and then continuing on from there).</p>
<p>
If the service provider passes a large number of calls to TAPI in a very short amount of time (during the same interrupt cycle), TAPI can become backlogged in processing those calls. When this happens, TAPI signals to the service provider to wait a short time before sending any more calls. It signals this by writing a value of NULL, instead of a valid <a href="datype_80z0.htm">HTAPICALL</a>, into the location pointed to by the <i>dwParam2</i> parameter of LINE_NEWCALL. This indicates that the attempt to process the newly offered call handle was not successful, most likely due to a temporary inability to allocate memory. The service provider can respond by dropping the call or by resending the LINE_NEWCALL message after a scheduling delay (during which time the service provider should yield the processor to allow TAPI to process other pending actions). In any case, no further messages regarding the new call can be passed to TAPI until the handle exchange succeeds. When the location pointed to by <i>dwParam2</i> acquires a non-NULL value, the service provider knows that this value is a valid HTAPICALL handle to the call.</p>
<p>
There is no directly corresponding message at the TAPI level. This message is used at the TSPI level to uniquely and unambiguously introduce a new incoming call to TAPI and retrieve the TAPI opaque identifier for the call.</p>
<h4>See Also</h4>
<p>
<a href="messgs_7gth.htm">LINE_CALLSTATE</a>, <a href="func3_7q7o.htm"><b>LINEEVENT</b></a></p>
<p>&nbsp;</p></body>
</HTML>
