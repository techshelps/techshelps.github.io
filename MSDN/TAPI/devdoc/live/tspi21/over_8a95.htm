<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Structures in TSPI</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_tspi_structures_in_tspi"></a>Structures in TSPI</h2>
<p>
A service provider uses structures to receive and return the data associated with a telephony request. In many cases, the members in a structure vary in length or number depending on the context of the specific request.</p>
<p>
The structures do not contain pointers.</p>
<pre><code>DWORD  dwTotalSize;
    DWORD  dwNeededSize;
    DWORD  dwUsedSize;
       // fixed size fields
    DWORD  dwField1Size;
    DWORD  dwField1Offset;
       // fixed size fields
    DWORD  dwField2Size;
    DWORD  dwField2Offset;
       // common extensions
       // var sized field1
       // var sized field2
 </code></pre>
<p>
A structure consists of a fixed set of members, followed by zero or more variable members.</p>
<p>
The first three fixed members specify the size of the structure. The <b>dwTotalSize</b> member, set by the application and verified by TAPI, specifies the total size in bytes of memory allocated for the structure. The <b>dwNeededSize</b> member specifies the total size in bytes needed for the data to be filled into the structure. The <b>dwUsedSize</b> member indicates the total size in bytes of the data that is actually filled in.</p>
<p>
Each variable member has a pair of corresponding fixed members that specify the size and the offset, in bytes, from the beginning of the structure to the variable member.</p>
<p>
Before passing a structure to the service provider, TAPI ensures that the memory for the structure is writable and that the value in <b>dwTotalSize</b> covers at least the fixed part of the structure. TAPI sets the <b>dwUsedSize</b> and the <b>dwNeededSize</b> members to the size of the fixed part.</p>
<p>
If the service provider is responsible for filling in a variable member, TAPI sets the corresponding size and offset members to zero. If the service provider fills in the variable member, it must set the corresponding size and offset members to appropriate values. The service provider must <i>not</i> truncate a variable member to make it fit into the available space.</p>
<p>
The service provider must:
<ul>
<li>
Set the fixed and variable members for which it is responsible.</li>
<li>
Update the <b>dwUsedSize</b> member if it sets variable members. This must be the size of all fixed members, plus the size of all variable members the service provider was able to copy to the available space.</li>
<li>
Update the <b>dwNeededSize</b> member if it has any variable members. This must be the size of all fixed members plus the size of all variable members, not just those copied to the available space.</li>
</ul>
<p>
The service provider must start variable members immediately after the fixed members of the structure, and leave any extra space at the end of the allocated memory so that TAPI can use it for the variable-length members for which it is responsible. It can place the variable members in any order, but the members must be contiguous.</p>
<p>
If the service provider detects an error, it must return the appropriate error return; no members need to be filled in. Insufficient space for variable members is not an error. The service provider simply sets <b>dwUsedSize</b> and <b>dwNeededSize</b> as appropriate and returns SUCCESS. Unless an error occurs, the service provider must set all fixed members for which it is responsible.</p>
<p>
TAPI sets the fixed and variable members that it is responsible for <i>after</i> the service provider.</p>
<p>&nbsp;</p></body>
</HTML>
