<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>TSPI_lineConditionalMediaDetection</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_tspi_tspi_lineconditionalmediadetection"></a>TSPI_lineConditionalMediaDetection</h1>
<p>
The <b>TSPI_lineConditionalMediaDetection</b> function is invoked by TAPI whenever a client application uses LINEMAPPER as the <i>dwDeviceID</i> in a <b>lineOpen</b> function to request that lines be scanned to find one that supports the desired media modes and call parameters. TAPI scans based on the union of the desired media mode and the other media modes currently being monitored on the line, to give the service provider the opportunity to indicate if it cannot simultaneously monitor for all of the requested media modes. If the service provider can monitor for the indicated set of media modes and support the capabilities indicated in <i>lpCallParams</i>, it replies with a success indication. It leaves the active media monitoring modes for the line unchanged.</p>
<pre><code><b>LONG TSPI_lineConditionalMediaDetection(
  HDRVLINE</b><i> hdLine</i><b>,                     </b>
<b>  DWORD</b><i> dwMediaModes</i><b>,                  </b>
<b>  LPLINECALLPARAMS const</b><i> lpCallParams  </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>hdLine</i></dt>
<dd>
The service provider's handle to the line on which media monitoring and parameter capabilities are to be set.</dd>
<dt>
<i>dwMediaModes</i></dt>
<dd>
The media mode(s) currently of interest to the calling application. This parameter uses the following LINEMEDIAMODE_ constants: 
<dl>
<dt>
LINEMEDIAMODE_UNKNOWN </dt>
<dd>
Unclassified calls. </dd>
<dt>
LINEMEDIAMODE_INTERACTIVEVOICE </dt>
<dd>
Interactive voice media type (manages live voice calls). </dd>
<dt>
LINEMEDIAMODE_AUTOMATEDVOICE </dt>
<dd>
Voice data managed by an automated application. In cases where the service provider does not distinguish between automated or interactive voice, this should be treated the same as interactive voice. </dd>
<dt>
LINEMEDIAMODE_DATAMODEM </dt>
<dd>
Calls with the data modem media mode. </dd>
<dt>
LINEMEDIAMODE_G3FAX </dt>
<dd>
Calls of the group 3 fax media type. </dd>
<dt>
LINEMEDIAMODE_TDD </dt>
<dd>
Calls with the TDD (Telephony Devices for the Deaf) media mode. </dd>
<dt>
LINEMEDIAMODE_G4FAX </dt>
<dd>
Calls of the group 4 fax media type. </dd>
<dt>
LINEMEDIAMODE_DIGITALDATA </dt>
<dd>
Calls of the digital data media type. </dd>
<dt>
LINEMEDIAMODE_TELETEX </dt>
<dd>
Calls with the teletex media mode. </dd>
<dt>
LINEMEDIAMODE_VIDEOTEX </dt>
<dd>
Calls with the videotex media mode. </dd>
<dt>
LINEMEDIAMODE_TELEX </dt>
<dd>
Calls with the telex media mode. </dd>
<dt>
LINEMEDIAMODE_MIXED </dt>
<dd>
Calls with the ISDN mixed media mode. </dd>
<dt>
LINEMEDIAMODE_ADSI </dt>
<dd>
Calls with the ADSI (Analog Display Services Interface) media mode. </dd>
<dt>
LINEMEDIAMODE_VOICEVIEW </dt>
<dd>
Calls with the VoiceView media mode. </dd>
</dl>
</dd>
<dt>
<i>lpCallParams</i></dt>
<dd>
A pointer to a structure of type <a href="struc1_8d82.htm"><b>LINECALLPARAMS</b></a>. It describes the call parameters that the line device should be able to provide. The only relevant fields of <i>lpCallParams</i> for the purposes of this test are the following:
<p>
<b>dwBearerMode</b>

<p>
<b>dwMinRate</b>

<p>
<b>dwMaxRate</b>

<p>
<b>dwMediaMode</b>

<p>
<b>dwCallParamFlags</b>

<p>
<b>dwAddressMode</b>

<p>
If <b>dwAddressMode</b> is LINEADDRESSMODE_ADDRESSID, any address on the line is acceptable. If <b>dwAddressMode</b> is LINEADDRESSMODE_DIALABLEADDR, indicating that a specific originating address (phone number) is searched for, or if it is a provider-specific extension, then <b>dwOrigAddressSize/Offset</b> and the portion of the variable part they refer to are also relevant. If <b>dwAddressMode</b> is a provider-specific extension, additional information can be contained in the <b>dwDeviceSpecific</b> variably sized field. All other fields are irrelevant to the function.

</dd>
</dl>
<h4>Return Values</h4>
<p>
Returns zero if the function succeeds or an error number if an error occurs. Possible return values are as follows: </p>
<p>
LINEERR_INVALLINEHANDLE, LINEERR_OPERATIONFAILED, LINEERR_NODRIVER, LINEERR_RESOURCEUNAVAIL, LINEERR_NOMEM, LINEERR_INVALMEDIAMODE, LINEERR_OPERATIONUNAVAIL. </p>
<h4>Remarks</h4>
<p>
A TAPI <b>lineOpen</b> function that specifies a device identifier of LINEMAPPER typically results in calling this procedure for multiple line devices to hunt for a suitable line, possibly also opening as-yet unopened lines. A success result indicates that the line is suitable for the calling application's requirements. </p>
<p>
<b>Note</b>&nbsp;&nbsp;The media monitoring modes demanded at the TSPI level are the union of monitoring modes demanded by multiple applications at the TAPI level. As a consequence, it is most common for multiple media mode flags to be set simultaneously at this level. The service provider must test to determine if it can support at least the specified set, regardless of what modes are currently in effect. TAPI ensures that the <i>dwMediaModes</i> parameter has at least one bit set and that no reserved bits are set. It is the service provider's responsibility to do any further validity checks on the media modes, such as checking whether any media modes are supported by the service provider.</p>
<p>
The <b>TSPI_lineConditionalMediaDetection</b> function checks the bits set in the <b>dwCallParamFlags</b> member of the <a href="struc1_8d82.htm"><b>LINECALLPARAMS</b></a> structure and handles the following cases:</p>
<p>
The <b>TSPI_lineConditionalMediaDetection</b> function returns success if passing the same bit values to the <a href="func2_0r8s.htm"><b>TSPI_lineMakeCall</b></a> function would also return success.</p>
<p>
If the SECURE, ORIGOFFHOOK, and DESTOFFHOOK bits are set and the <i>dwAddressMode</i> parameter is LINEADDRESSMODE_ADDRESSID, the function returns success if it can succeed on one or more addresses on the line.</p>
<p>
If the SECURE, ORIGOFFHOOK, and DESTOFFHOOK bits are set and the <i>dwAddressMode</i> parameter is LINEADDRESSMODE_DIALABLEADDR, the function returns success if it can succeed on the address identified by the <i>dwOrigAddress</i> parameter.</p>
<p>
The service provider returns an error (for example, LINEERR_RESOURCEUNAVAIL) if, at the time this function is called, it is impossible to place a new call on the specified line device (if it would return LINEERR_CALLUNAVAIL or LINEERR_RESOURCEUNAVAIL should <b>TSPI_lineMakeCall</b> be invoked immediately after opening the line).</p>
<p>
There is no directly corresponding function at the TAPI level. This procedure corresponds to the test implied for each individual line by the <b>lineOpen</b> procedure when it is called with the device identifier LINEMAPPER.</p>
<h4>See Also</h4>
<p>
<a href="struc1_8d82.htm"><b>LINECALLPARAMS</b></a>, <a href="cnstant_4cxf.htm">LINEMEDIAMODE_ Constants</a>, <a href="func2_0r8s.htm"><b>TSPI_lineMakeCall</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
