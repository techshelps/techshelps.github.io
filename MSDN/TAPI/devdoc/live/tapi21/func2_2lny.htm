<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>lineOpen</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_lineopen"></a>lineOpen</h1>
<p>
The <b>lineOpen</b> function opens the line device specified by its device identifier and returns a line handle for the corresponding opened line device. This line handle is used in subsequent operations on the line device. </p>
<pre><code><b>LONG lineOpen(
  HLINEAPP</b><i> hLineApp</i><b>,                   </b>
<b>  DWORD</b><i> dwDeviceID</i><b>,                    </b>
<b>  LPHLINE</b><i> lphLine</i><b>,                     </b>
<b>  DWORD</b><i> dwAPIVersion</i><b>,                  </b>
<b>  DWORD</b><i> dwExtVersion</i><b>,                  </b>
<b>  DWORD</b><i> dwCallbackInstance</i><b>,            </b>
<b>  DWORD</b><i> dwPrivileges</i><b>,                  </b>
  <b>DWORD</b> <i>dwMediaModes</i><b>,                  </b>
<b>  LPLINECALLPARAMS const</b><i> lpCallParams  </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>hLineApp</i> </dt>
<dd>
A handle to the application's registration with TAPI. </dd>
<dt>
<i>dwDeviceID</i> </dt>
<dd>
Identifies the line device to be opened. It can either be a valid device identifier or the value: 
<dl>
<dt>
LINEMAPPER </dt>
<dd>
This value is used to open a line device in the system that supports the properties specified in <i>lpCallParams</i>. The application can use <a href="func1_99r8.htm"><b>lineGetID</b></a> to determine the identifier of the line device that was opened. 
</dd>
</dl>
</dd>
<dt>
<i>lphLine</i> </dt>
<dd>
A pointer to an HLINE handle that is then loaded with the handle representing the opened line device. Use this handle to identify the device when invoking other functions on the open line device. </dd>
<dt>
<i>dwAPIVersion</i> </dt>
<dd>
The API version number under which the application and Telephony API have agreed to operate. This number is obtained with <a href="func2_329a.htm"><b>lineNegotiateAPIVersion</b></a>. </dd>
<dt>
<i>dwExtVersion</i> </dt>
<dd>
The extension version number under which the application and the service provider agree to operate. This number is zero if the application does not use any extensions. This number is obtained with <a href="func2_76i6.htm"><b>lineNegotiateExtVersion</b></a>. </dd>
<dt>
<i>dwCallbackInstance</i> </dt>
<dd>
User-instance data passed back to the application with each message associated with this line or with addresses or calls on this line. This parameter is not interpreted by the Telephony API. </dd>
<dt>
<i>dwPrivileges</i> </dt>
<dd>
The privilege the application wants for the calls it is notified for. This parameter can be a combination of the LINECALLPRIVILEGE_ constants. For applications using TAPI version 2.0 or later, values for this parameter can also be combined with the LINEOPENOPTION_ constants: 
<dl>
<dt>
LINECALLPRIVILEGE_NONE </dt>
<dd>
The application can make only outgoing calls. </dd>
<dt>
LINECALLPRIVILEGE_MONITOR </dt>
<dd>
The application can monitor only incoming and outgoing calls. </dd>
<dt>
LINECALLPRIVILEGE_OWNER </dt>
<dd>
The application can own only incoming calls of the types specified in <i>dwMediaModes</i>. </dd>
<dt>
LINECALLPRIVILEGE_MONITOR + LINECALLPRIVILEGE_OWNER </dt>
<dd>
The application can own only incoming calls of the types specified in <i>dwMediaModes</i>, but if it is not an owner of a call, it is a monitor. </dd>
<dt>
LINEOPENOPTION_SINGLEADDRESS </dt>
<dd>
The application is interested only in new calls that appear on the address specified by the <b>dwAddressID</b> member in the <a href="struc1_1tgy.htm"><b>LINECALLPARAMS</b></a> structure pointed to by the <i>lpCallParams</i> parameter (which must be specified). If LINEOPENOPTION_SINGLEADDRESS is specified but either <i>lpCallParams</i> is invalid or the included <b>dwAddressID</b> does not exist on the line, the open fails with LINERR_INVALADDRESSID. 
<p>
In addition to setting the <b>dwAddressID</b> member of the <b>LINECALLPARAMS</b> structure to the desired address, the application must also set <b>dwAddressMode</b> in <b>LINECALLPARAMS</b> to LINEADDRESSMODE_ADDRESSID. 

<p>
The LINEOPENOPTION_SINGLEADDRESS option affects only TAPI's assignment of initial call <i>ownership</i> of calls created by the service provider using a LINE_NEWCALL message. An application that opens the line with LINECALLPRIVILEGE_MONITOR continues to receive monitoring handles to all calls created on the line. Furthermore, the application is not restricted in any way from making calls or performing other operations that affect other addresses on the opened line. 
</dd>
<dt>
LINEOPENOPTION_PROXY </dt>
<dd>
The application is willing to handle certain types of requests from other applications that have the line open, as an adjunct to the service provider. Requests are delivered to the application using <a href="msgs_6tro.htm">LINE_PROXYREQUEST</a> messages; the application responds to them by calling <a href="func2_83ad.htm"><b>lineProxyResponse</b></a>, and can also generate TAPI messages to other applications having the line open by calling <a href="func2_59d1.htm"><b>lineProxyMessage</b></a>. 
<p>
When this option is specified, the application must also indicate which specific proxy requests it is prepared to handle. It does so by passing, in the <i>lpCallParams</i> parameter, a pointer to a <a href="struc1_1tgy.htm"><b>LINECALLPARAMS</b></a> structure in which the <b>dwDevSpecificSize</b> and <b>dwDevSpecificOffset</b> members have been set to delimit an array of <b>DWORD</b>s. Each element of this array shall contain one of the LINEPROXYREQUEST_ constants. For example, a proxy handler application that supports all five of the Agent-related functions would pass in an array of five <b>DWORD</b>s (<b>dwDevSpecificSize</b> would be 20 decimal) containing the five defined LINEPROXYREQUEST_ values. 

<p>
The proxy request handler application can run on any machine that has authorization to control the line device. However, requests are always routed through the server on which the service provider is executing that actually controls the line device. Thus, it is most efficient if the application handling proxy requests (such as ACD agent control) executes directly on the server along with the service provider. 

<p>
Subsequent attempts, by the same application or other applications, to open the line device and register to handle the same proxy requests as an application that is already registered fail with LINEERR_NOTREGISTERED. 

<p>
To stop handling requests on the line, the application simply calls <a href="func1_9sth.htm"><b>lineClose</b></a>. 

</dd>
</dl>

<p>
Other flag combinations return the LINEERR_INVALPRIVSELECT error. 
</dd>
<dt>
<i>dwMediaModes</i> </dt>
<dd>
The media mode or modes of interest to the application. This parameter is used to register the application as a potential target for incoming call and call handoff for the specified media mode. This parameter is meaningful only if the bit LINECALLPRIVILEGE_OWNER in <i>dwPrivileges</i> is set (and ignored if it is not). This parameter uses the following LINEMEDIAMODE_ constants: 
<dl>
<dt>
LINEMEDIAMODE_UNKNOWN </dt>
<dd>
The application can handle calls of unknown media type (unclassified calls). </dd>
<dt>
LINEMEDIAMODE_INTERACTIVEVOICE </dt>
<dd>
The application can handle calls of the interactive voice media type. That is, it manages voice calls with the human user on this end of the call. </dd>
<dt>
LINEMEDIAMODE_AUTOMATEDVOICE </dt>
<dd>
Voice energy is present on the call. The voice is locally handled by an automated application. </dd>
<dt>
LINEMEDIAMODE_DATAMODEM </dt>
<dd>
The application can handle calls with the data-modem media mode. </dd>
<dt>
LINEMEDIAMODE_G3FAX </dt>
<dd>
The application can handle calls of the group 3 fax media type. </dd>
<dt>
LINEMEDIAMODE_TDD </dt>
<dd>
The application can handle calls with the TDD (Telephony Devices for the Deaf) media mode. </dd>
<dt>
LINEMEDIAMODE_G4FAX </dt>
<dd>
The application can handle calls of the group 4 fax media type. </dd>
<dt>
LINEMEDIAMODE_DIGITALDATA </dt>
<dd>
The application can handle calls of the digital-data media type. </dd>
<dt>
LINEMEDIAMODE_TELETEX </dt>
<dd>
The application can handle calls with the teletex media mode. </dd>
<dt>
LINEMEDIAMODE_VIDEOTEX </dt>
<dd>
The application can handle calls with the videotex media mode. </dd>
<dt>
LINEMEDIAMODE_TELEX </dt>
<dd>
The application can handle calls with the telex media mode. </dd>
<dt>
LINEMEDIAMODE_MIXED </dt>
<dd>
The application can handle calls with the ISDN mixed media mode. </dd>
<dt>
LINEMEDIAMODE_ADSI </dt>
<dd>
The application can handle calls with the ADSI (Analog Display Services Interface) media mode. </dd>
<dt>
LINEMEDIAMODE_VOICEVIEW </dt>
<dd>
The media mode of the call is VoiceView. 
</dd>
</dl>
</dd>
<dt>
<i>lpCallParams</i> </dt>
<dd>
A pointer to a structure of type <a href="struc1_1tgy.htm"><b>LINECALLPARAMS</b></a>. This pointer is only used if LINEMAPPER is used; otherwise <i>lpCallParams</i> is ignored. It describes the call parameter that the line device should be able to provide. 
</dd>
</dl>
<h4>Return Values</h4>
<p>
Returns zero if the request succeeds or a negative error number if an error occurs. Possible return values are: </p>
<p>
LINEERR_ALLOCATED, LINEERR_LINEMAPPERFAILED, LINEERR_BADDEVICEID, LINEERR_NODRIVER, LINEERR_INCOMPATIBLEAPIVERSION, LINEERR_NOMEM, LINEERR_INCOMPATIBLEEXTVERSION, LINEERR_OPERATIONFAILED, LINEERR_INVALAPPHANDLE, LINEERR_RESOURCEUNAVAIL, LINEERR_INVALMEDIAMODE, LINEERR_STRUCTURETOOSMALL, LINEERR_INVALPOINTER, LINEERR_UNINITIALIZED, LINEERR_INVALPRIVSELECT, LINEERR_REINIT, LINEERR_NODEVICE, LINEERR_OPERATIONUNAVAIL.</p>
<h4>Remarks</h4>
<p>
If LINEERR_ALLOCATED is returned, the line cannot be opened due to a "persistent" condition, such as that of a serial port being exclusively opened by another process. If LINEERR_RESOURCEUNAVAIL is returned, the line cannot be opened due to a dynamic resource overcommitment such as in DSP processor cycles or memory. This overcommitment can be transitory, caused by monitoring of media mode or tones, and changes in these activities by other applications can make it possible to reopen the line within a short time period. If LINEERR_REINIT is returned and TAPI reinitialization has been requested (for example, as a result of adding or removing a telephony service provider), then <b>lineOpen</b> requests are rejected with this error until the last application shuts down its usage of the API (using <a href="func2_0m26.htm"><b>lineShutdown</b></a>); at that time the new configuration becomes effective and applications are once again permitted to call <a href="func1_8th4.htm"><b>lineInitializeEx</b></a>. </p>
<p>
Opening a line always entitles the application to make calls on any address available on the line. The ability of the application to deal with incoming calls or to be the target of call handoffs on the line is determined by the <i>dwMediaModes</i> parameter. The <b>lineOpen</b> function registers the application as having an interest in monitoring calls or receiving ownership of calls that are of the specified media modes. If the application just wants to monitor calls, then it can specify LINECALLPRIVILEGE_MONITOR. If the application just wants to make outgoing calls, it can specify LINECALLPRIVILEGE_NONE. If the application is willing to control unclassified calls (calls of unknown media mode), it can specify LINECALLPRIVILEGE_OWNER and LINEMEDIAMODE_UNKNOWN. Otherwise, the application should specify the media mode it is interested in handling. </p>
<p>
The media modes specified with <b>lineOpen</b> add to the default value for the provider's media mode monitoring for initial incoming call type determination. The <a href="func2_94wx.htm"><b>lineMonitorMedia</b></a> function modifies the mask that controls <a href="msgs_3w9t.htm">LINE_MONITORMEDIA</a> messages. If a line device is opened with owner privilege and an extension media mode is not registered, then the error LINEERR_INVALMEDIAMODE is returned. </p>
<p>
An application that has successfully opened a line device can always initiate calls using <a href="func1_0fsc.htm"><b>lineMakeCall</b></a>, <a href="func2_2q5n.htm"><b>lineUnpark</b></a>, <a href="func2_2j00.htm"><b>linePickup</b></a>, and <a href="func2_84kl.htm"><b>lineSetupConference</b></a> (with a NULL <i>hCall</i>), as well as use <a href="func1_6nvo.htm"><b>lineForward</b></a> (assuming that doing so is allowed by the device capabilities, line state, and so on). </p>
<p>
A single application can specify multiple flags simultaneously to handle multiple media modes. Conflicts can arise if multiple applications open the same line device for the same media mode. These conflicts are resolved by a priority scheme in which the user assigns relative priorities to the applications. Only the highest priority application for a given media mode will ever receive ownership (unsolicited) of a call of that media mode. Ownership can be received when an incoming call first arrives or when a call is handed off. </p>
<p>
Any application (including any lower priority application) can always acquire ownership with <a href="func1_88s3.htm"><b>lineGetNewCalls</b></a> or <a href="func1_97xv.htm"><b>lineGetConfRelatedCalls</b></a>. If an application opens a line for monitoring at a time that calls exist on the line, <a href="msgs_1eud.htm">LINE_CALLSTATE</a> messages for those existing calls are not automatically generated to the new monitoring application. The application can query the number of current calls on the line to determine how many calls exist, and, if it wants, it can call <b>lineGetNewCalls</b> to obtain handles to these calls. </p>
<p>
An application that handles automated voice should also select the interactive voice open mode and be assigned the lowest priority for interactive voice. The reason for this is that service providers report all voice media modes as interactive voice. If media mode determination is not performed by the application for the UNKNOWN media type, and no interactive voice application has opened the line device, voice calls would be unable to reach the automated voice application, and would be dropped. </p>
<p>
The same application, or different instantiations of the same application, can open the same line multiple times with the same or different parameters. </p>
<p>
When an application opens a line device it must specify the negotiated API version and, if it wants to use the line's extensions, it should specify the line's device-specific extension version. These version numbers should have been obtained with <a href="func2_329a.htm"><b>lineNegotiateAPIVersion</b></a> and <a href="func2_76i6.htm"><b>lineNegotiateExtVersion</b></a>. Version numbering allows the mixing and matching of different application versions with different API versions and service provider versions. </p>
<p>
LINEMAPPER allows an application to select a line indirectly—by means of the services it wants from it. When opening a line device using LINEMAPPER, the following is true: All members from beginning of the <b>LINECALLPARAMS</b> data structure through <b>dwAddressMode</b> are relevant. If <b>dwAddressMode</b> is LINEADDRESSMODE_ADDRESSID it means that any address on the line is acceptable, otherwise if <b>dwAddressMode</b> is LINEADDRESSMODE_DIALABLEADDR, indicating that a specific originating address (phone number) is searched for, or if it is a provider-specific extension, then <b>dwOrigAddressSize/Offset</b> and the portion of the variable part they refer to are also relevant. If <b>dwAddressMode</b> is a provider-specific extension, additional information can be contained in the <b>dwDeviceSpecific</b> variably sized member. </p>
<h4>QuickInfo</h4>
<p>
&nbsp;&nbsp;<b>Version:</b> Use TAPI version 1.4 and later.<br>
&nbsp;&nbsp;<b>Header:</b> Declared in tapi.h.<br>
&nbsp;&nbsp;<b>Import Library:</b> Link with tapi32.lib.</p>
<h4>See Also</h4>
<p>
<a href="quickref_9s85.htm">TAPI Reference Overview</a>, <a href="quickref_7uzp.htm">Basic Telephony Services Reference</a>, <a href="msgs_1eud.htm">LINE_CALLSTATE</a>, <a href="msgs_3w9t.htm">LINE_MONITORMEDIA</a>, <a href="msgs_6tro.htm">LINE_PROXYREQUEST</a>, <a href="struc1_1tgy.htm"><b>LINECALLPARAMS</b></a>, <a href="func1_9sth.htm"><b>lineClose</b></a>, <a href="func1_6nvo.htm"><b>lineForward</b></a>, <a href="func1_97xv.htm"><b>lineGetConfRelatedCalls</b></a>, <a href="func1_88s3.htm"><b>lineGetNewCalls</b></a>, <a href="func1_8th4.htm"><b>lineInitializeEx</b></a>, <a href="func1_0fsc.htm"><b>lineMakeCall</b></a>, <a href="func2_94wx.htm"><b>lineMonitorMedia</b></a>, <a href="func2_329a.htm"><b>lineNegotiateAPIVersion</b></a>, <a href="func2_76i6.htm"><b>lineNegotiateExtVersion</b></a>, <a href="func2_2j00.htm"><b>linePickup</b></a>, <a href="func2_59d1.htm"><b>lineProxyMessage</b></a>, <a href="func2_83ad.htm"><b>lineProxyResponse</b></a>, <a href="func2_84kl.htm"><b>lineSetupConference</b></a>, <a href="func2_0m26.htm"><b>lineShutdown</b></a>, <a href="func2_2q5n.htm"><b>lineUnpark</b></a></p>
<p>&nbsp;</p></body>
</HTML>
