<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Passthrough Mode</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_win32_passthrough_mode"></a>Passthrough Mode</h2>
<p>
When a call is active in LINEBEARERMODE_PASSTHROUGH, the service provider gives direct access to the attached hardware for control by the application. Applications can use this mode for temporary direct control over asynchronous modems, accessed through the Win32 Communication functions, for the purpose of configuring or using special features not otherwise supported by the service provider, such as facsimile (Class 1, 2, and so on). This bearer mode is supported by the Universal Modem Driver (UNIMODEM) service provider. </p>
<p>
Service providers that support LINEBEARERMODE_PASSTHROUGH indicate it in the <b>dwBearerModes</b> member of the <a href="struc2_30mq.htm"><b>LINEDEVCAPS</b></a> structure. When LINEBEARERMODE_PASSTHROUGH is indicated, the Unimodem service provider will also include in the <b>DevSpecific</b> area of the <b>LINEDEVCAPS</b> structure the registry key used to access information about the modem associated with the line device, in the following format: </p>
<pre><code>struct {
    DWORD dwContents;   // Set to 1 (indicates containing key) 
    DWORD dwKeyOffset;  // Offset to key from start of this
                        // structure (not from start of
                        // LINEDEVCAPS structure). 8 in
                        // our case. 
    BYTE rgby[...];     // place containing null-terminated
                        // registry key. 
}
 </code></pre>
<p>
For example: </p>
<pre><code>00000001 00000008 74737953 435c6d65  ........System\C
    65727275 6f43746e 6f72746e 7465536c  urrentControlSet
    7265535c 65636976 6c435c73 5c737361  urrentControlSet
    65646f4d 30305c6d xx003030 xxxxxxxx  Modem\0000. 
 </code></pre>
<p>
This registry key could then be opened using this function: </p>
<pre><code>RegOpenKey(HKEY_LOCAL_MACHINE, pszDevSpecificRegKey, &amp;phkResult)
 </code></pre>
<p>
Passthrough mode is invoked most often using the <a href="func1_0fsc.htm"><b>lineMakeCall</b></a> function, by setting the LINEBEARERMODE_PASSTHROUGH bit in the <b>dwBearerMode</b> member of the <a href="struc1_1tgy.htm"><b>LINECALLPARAMS</b></a> structure pointed to by the <i>lpCallParams</i> parameter. When this is done, the service provider will open the serial port to the modem and immediately place the call into LINECALLSTATE_CONNECTED. The application can then use the <a href="func1_99r8.htm"><b>lineGetID</b></a> function with the device class "comm/datamodem" to obtain an open Win32 file handle to read from and write to the comm port. </p>
<p>
Passthrough mode can be invoked in response to an incoming call as well. Generally, applications will invoke passthrough mode while the call is in LINECALLSTATE_OFFERING, before the call has been answered. Instead of calling <a href="func1_17zm.htm"><b>lineAnswer</b></a>, the application calls <a href="func2_59v7.htm"><b>lineSetCallParams</b></a>, passing LINEBEARERMODE_PASSTHROUGH as the <i>dwBearerMode</i> parameter. When this is done, as with <b>lineMakeCall</b>, the call will immediately be placed into LINECALLSTATE_CONNECTED by the service provider, and the application can obtain a handle to the open port using <b>lineGetID</b>. The <b>lineSetCallParams</b> function can be called when the call is in LINECALLSTATE_OFFERING, LINECALLSTATE_ACCEPTED, or LINECALLSTATE_CONNECTED. </p>
<p>
Passthrough mode is normally terminated by calling <a href="func1_0zhs.htm"><b>lineDrop</b></a> on the call handle obtained from <a href="func1_0fsc.htm"><b>lineMakeCall</b></a> or the first <a href="msgs_1eud.htm">LINE_CALLSTATE</a> message (if the call was an incoming call). The service provider will close the port, and restore the modem to its default state. The application must call <b>CloseHandle</b> on the handle it received from <a href="func1_99r8.htm"><b>lineGetID</b></a>. </p>
<p>
Passthrough mode can also be terminated by calling <a href="func2_59v7.htm"><b>lineSetCallParams</b></a> with the <i>dwBearerMode</i> parameter set to LINEBEARERMODE_VOICE. The media mode set by <a href="func2_5bl1.htm"><b>lineSetMediaMode</b></a> is presumed to be in effect. If LINEMEDIAMODE_DATAMODEM is active, the service provider will take over the call as though it was a data modem call already in progress; if <b>lineDrop</b> is subsequently called, the service provider will issue the appropriate modem commands or interface state changes to drop a data call. </p>
<p>&nbsp;</p></body>
</HTML>
