<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>phoneInitializeEx</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_phoneinitializeex"></a>phoneInitializeEx</h1>
<p>
The <b>phoneInitializeEx</b> function initializes the application's use of TAPI for subsequent use of the phone abstraction. It registers the application's specified notification mechanism and returns the number of phone devices available to the application. A phone device is any device that provides an implementation for the phone-prefixed functions in the Telephony API. </p>
<pre><code><b>LONG phoneInitializeEx(
  LPHPHONEAPP</b><i> lphPhoneApp</i><b>,                             </b>
<b>  HINSTANCE</b><i> hInstance</i><b>,                                 </b>
<b>  PHONECALLBACK</b><i> lpfnCallback</i><b>,                          </b>
<b>  LPCSTR</b><i> lpszFriendlyAppName</i><b>,                          </b>
<b>  LPDWORD</b><i> lpdwNumDevs</i><b>,                                 </b>
<b>  LPDWORD</b><i> lpdwAPIVersion</i><b>,                              </b>
<b>  LPPHONEINITIALIZEEXPARAMS</b><i> lpPhoneInitializeExParams  </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>lphPhoneApp</i> </dt>
<dd>
A pointer to a location that is filled with the application's usage handle for TAPI. </dd>
<dt>
<i>hInstance</i> </dt>
<dd>
The instance handle of the client application or DLL. The application or DLL can pass NULL for this parameter, in which case TAPI uses the module handle of the root executable of the process. </dd>
<dt>
<i>lpfnCallback</i> </dt>
<dd>
The address of a callback function that is invoked to determine status and events on the line device, addresses, or calls, when the application is using the "hidden window" method of event notification (for more information see <a href="func2_5o4j.htm"><b>phoneCallbackFunc</b></a>). This parameter is ignored and should be set to NULL when the application chooses to use the "event handle" or "completion port" event notification mechanisms. </dd>
<dt>
<i>lpszFriendlyAppName</i> </dt>
<dd>
A pointer to a NULL-terminated ASCII string that contains only displayable ASCII characters. If this parameter is not NULL, it contains an application-supplied name for the application. This name is provided in the <a href="struc2_0702.htm"><b>PHONESTATUS</b></a> structure to indicate, in a user-friendly way, which application has ownership of the phone device. If <i>lpszFriendlyAppName</i> is NULL, the application's module filename is used instead (as returned by the Windows API <b>GetModuleFileName</b>). </dd>
<dt>
<i>lpdwNumDevs</i> </dt>
<dd>
A pointer to a <b>DWORD</b>-sized location. Upon successful completion of this request, this location is filled with the number of phone devices available to the application. </dd>
<dt>
<i>lpdwAPIVersion</i> </dt>
<dd>
A pointer to a <b>DWORD</b>-sized location. The application must initialize this <b>DWORD</b>, before calling this function, to the highest API version it is designed to support (for example, the same value it would pass into <i>dwAPIHighVersion</i> parameter of <a href="func2_223y.htm"><b>phoneNegotiateAPIVersion</b></a>). Artificially high values must not be used; the value must be accurately set (for this release, to 0x00020000). TAPI translates any newer messages or structures into values or formats supported by the application's version. Upon successful completion of this request, this location is filled with the highest API version supported by TAPI (for this release, 0x00020000), thereby allowing the application to detect and adapt to having been installed on a system with an older version of TAPI. </dd>
<dt>
<i>lpPhoneInitializeExParams</i> </dt>
<dd>
A pointer to a structure of type <a href="struc2_3hte.htm"><b>PHONEINITIALIZEEXPARAMS</b></a> containing additional parameters used to establish the association between the application and TAPI (specifically, the application's selected event notification mechanism and associated parameters). 
</dd>
</dl>
<h4>Return Values</h4>
<p>
Returns zero if the request succeeds or a negative error number if an error occurs. Possible return values are: </p>
<p>
PHONEERR_INVALAPPNAME, PHONEERR_OPERATIONFAILED, PHONEERR_INIFILECORRUPT, PHONEERR_INVALPOINTER, PHONEERR_REINIT, PHONEERR_NOMEM, PHONEERR_INVALPARAM.</p>
<h4>Remarks</h4>
<p>
Applications must select one of three mechanisms by which TAPI notifies the application of telephony events: Hidden Window, Event Handle, or Completion Port. </p>
<p>
The Hidden Window mechanism is selected by specifying PHONEINITIALIZEEXOPTION_USEHIDDENWINDOW in the <b>dwOptions</b> member in the <a href="struc2_3hte.htm"><b>PHONEINITIALIZEEXPARAMS</b></a> structure. In this mechanism (which is the only mechanism available to TAPI version 1.<i>x</i> applications), TAPI creates a window in the context of the application during the <b>phoneInitializeEx</b> function, and subclasses the window so that all messages posted to it are handled by a WNDPROC in TAPI itself. When TAPI has a message to deliver to the application, TAPI posts a message to the hidden window. When the message is received (which can happen only when the application calls the Windows <b>GetMessage</b> API), Windows switches the process context to that of the application and invokes the WNDPROC in TAPI. TAPI then delivers the message to the application by calling the <b>PhoneCallbackProc</b>, a pointer to which the application provided as a parameter in its call to <b>phoneInitializeEx</b> (or <a href="func2_9zs5.htm"><b>phoneInitialize</b></a>, for TAPI version 1.3 and 1.4 applications). This mechanism requires the application to have a message queue (which is not desirable for service processes) and to service that queue regularly to avoid delaying processing of telephony events. The hidden window is destroyed by TAPI during the <a href="func2_7gku.htm"><b>phoneShutdown</b></a> function. </p>
<p>
The Event Handle mechanism is selected by specifying PHONEINITIALIZEEXOPTION_USEEVENT in the <b>dwOptions</b> member in the <a href="struc2_3hte.htm"><b>PHONEINITIALIZEEXPARAMS</b></a> structure. In this mechanism, TAPI creates an event object on behalf of the application, and returns a handle to the object in the <b>hEvent</b> member in <b>PHONEINITIALIZEEXPARAMS</b>. The application must not manipulate this event in any manner (for example, must not call <b>SetEvent</b>, <b>ResetEvent</b>, <b>CloseHandle</b>, and so on) or undefined behavior results; the application can only wait on this event using functions such as <b>WaitForSingleObject</b> or <b>MsgWaitForMultipleObjects</b>. TAPI signals this event whenever a telephony event notification is pending for the application; the application must call <a href="func2_3ep1.htm"><b>phoneGetMessage</b></a> to fetch the contents of the message. The event is reset by TAPI when no events are pending. The event handle is closed and the event object destroyed by TAPI during the <b>phoneShutdown</b> function. The application is not required to wait on the event handle that is created; the application could choose instead to call <b>phoneGetMessage</b> and have it block waiting for a message to be queued. </p>
<p>
The Completion Port mechanism is selected by specifying PHONEINITIALIZEEXOPTION_USECOMPLETION PORT in the <b>dwOptions</b> member in the <a href="struc2_3hte.htm"><b>PHONEINITIALIZEEXPARAMS</b></a> structure. In this mechanism, whenever a telephony event needs to be sent to the application, TAPI sends it to the application using <b>PostQueuedCompletionStatus</b> to the completion port that the application specified in the <b>hCompletionPort</b> member in <b>PHONEINITIALIZEEXPARAMS</b>, tagged with the completion key that the application specified in the <b>dwCompletionKey</b> member in <b>PHONEINITIALIZEEXPARAMS</b>. The application must have previously created the completion port using <b>CreateIoCompletionPort</b>. The applications retrieves events using <b>GetQueuedCompletionStatus</b>. Upon return from <b>GetQueuedCompletionStatus</b>, the application has the specified <b>dwCompletionKey</b> written to the <b>DWORD</b> pointed to by the <i>lpCompletionKey</i> parameter, and a pointer to a <a href="struc2_5trm.htm"><b>PHONEMESSAGE</b></a> structure returned to the location pointed to by <i>lpOverlapped</i>. After the application has processed the event, the application must call <b>LocalFree</b> to release the memory used to contain the <b>PHONEMESSAGE</b> structure. Because the application created the completion port (thereby allowing it to be shared for other purposes), the application must close it; the application must not close the completion port until after calling <a href="func2_7gku.htm"><b>phoneShutdown</b></a>. </p>
<p>
When a multithreaded application is using the Event Handle mechanism and more than one thread is waiting on the handle, or the Completion Port notification mechanism and more than one thread is waiting on the port, it is possible for telephony events to be processed out of sequence. This is not due to the sequence of delivery of events from TAPI, but would be caused by the time slicing of threads or the execution of threads on separate processors. </p>
<p>
If PHONEERR_REINIT is returned and TAPI reinitialization has been requested (for example, as a result of adding or removing a telephony service provider), then <b>phoneInitializeEx</b> requests are rejected with this error until the last application shuts down its usage of the API (using <b>phoneShutdown</b>). At that time, the new configuration becomes effective and applications are once again permitted to call <b>phoneInitializeEx</b>. </p>
<p>
If the PHONEERR_INVALPARAM error value is returned, the specified <i>hInstance</i> parameter is invalid. </p>
<p>
The application can refer to individual phone devices by using phone device identifiers that range from zero to <i>dwNumDevs</i> minus one. An application should not assume that these phone devices are capable of any particular TAPI function without first querying their device capabilities by <b>phoneGetDevCaps</b>. </p>
<p>
For information about the listing of service dependencies, see <a href="overvw1_8jsj.htm">Service Dependencies.</a> </p>
<h4>QuickInfo</h4>
<p>
&nbsp;&nbsp;<b>Version:</b> Use TAPI version 2.0 and later<br>
&nbsp;&nbsp;<b>Header:</b> Declared in tapi.h.<br>
&nbsp;&nbsp;<b>Import Library:</b> Link with tapi32.lib.</p>
<h4>See Also</h4>
<p>
<a href="quickref_9s85.htm">TAPI Reference Overview</a>, <a href="quickref_352r.htm">Supplementary Phone Services Functions</a>, <a href="func2_5o4j.htm"><b>phoneCallbackFunc</b></a>, <a href="func2_0eib.htm"><b>phoneGetDevCaps</b></a>, <a href="func2_3ep1.htm"><b>phoneGetMessage</b></a>, <a href="struc2_3hte.htm"><b>PHONEINITIALIZEEXPARAMS</b></a>, <a href="struc2_5trm.htm"><b>PHONEMESSAGE</b></a>, <a href="func2_223y.htm"><b>phoneNegotiateAPIVersion</b></a>, <a href="func2_7gku.htm"><b>phoneShutdown</b></a>, <a href="struc2_0702.htm"><b>PHONESTATUS</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
