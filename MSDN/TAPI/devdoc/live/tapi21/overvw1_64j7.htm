<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Receiving Calls</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_win32_receiving_calls"></a>Receiving Calls</h2>
<p>
After an application has opened a line device and, while doing so, registered a privilege other than <i>none</i>, and a media mode, it is notified when a call arrives on that line. Specifically, applications that have the line open with LINECALLPRIVILEGE_MONITOR will receive a <a href="msgs_1eud.htm">LINE_CALLSTATE</a> message for every call that arrives on the line. An application that has opened the line with LINECALLPRIVILEGE_OWNER receives a LINE_CALLSTATE message only if it has become an owner of the call or is the target of a directed handoff. In this notification, TAPI gives the application a handle to the incoming call, and the application keeps this handle until the application deallocates the call. </p>
<p>
<b>Note</b>&nbsp;&nbsp;To assist in object-oriented implementations of TAPI, in versions 2.0 and later TAPI initially sends a <a href="msgs_7vqk.htm">LINE_APPNEWCALL</a> message (instead of a <a href="msgs_1eud.htm">LINE_CALLSTATE</a> message) to the application to notify it of a new call handle. </p>
<p>
Applications are informed of call arrivals and all other call-state events with the LINE_CALLSTATE message. This message provides the call handle, the application's privilege to the call, and the call's new state. For an unanswered incoming call, the call state is <i>offering</i>. An application can invoke <a href="func1_5zov.htm"><b>lineGetCallInfo</b></a> to obtain information about an offering call before accepting it. This function call also causes the call information in the <a href="struc1_0twy.htm"><b>LINECALLINFO</b></a> data structure to be updated. By knowing the call state and other information, the application can determine whether the call needs to be answered. </p>
<p>
The call information stored in <b>LINECALLINFO</b> includes, among other things, the following items: 
<ul>
<li>
<i>Bearer mode, rate</i> This is the bearer mode (voice, data) and data rate (in bits per second) of the call, for digital data calls. </li>
<li>
<i>Media mode</i> The current media mode of the call. <i>Unknown</i> is the mode specified if this information is unknown, and the other set bits indicate which media modes might possibly exist on the call. For more information, see Multiple-Application Programming. </li>
<li>
<i>Call origin</i> Indicates whether the call originated from an internal caller, an external caller, or an unknown caller. </li>
<li>
<i>Reason for the call</i> Describes why the call is occurring. Possible reasons are: <ul>
<li>
Direct call </li>
<li>
Transferred from another number </li>
<li>
Busy—forwarded from another number </li>
<li>
Unconditionally forwarded from another number </li>
<li>
The call was picked up from another number </li>
<li>
A call completion request </li>
<li>
A callback reminder </li>
</ul>
<p>
The reason for the call is given as <i>unknown</i> if this information is not known. 
</li>
<li>
<i>Caller-ID</i> Parameter that identifies the originating party of a call. This can be in a variety of (name or number) formats, determined by what the switch or network provides. </li>
<li>
<i>Called-ID</i> Parameter that identifies the party originally dialed by the caller. </li>
<li>
<i>Connected-ID</i> Parameter that identifies the party to which the call was actually connected. This may be different from the called party if the call was diverted. </li>
<li>
<i>Redirection-ID</i> Parameter that identifies to the caller the number to which the call is now diverted (redirected). </li>
<li>
<i>Redirecting-ID</i> Parameter that identifies to the caller the original destination from which the call was diverted (redirected). </li>
<li>
<i>User-user information</i> User-user information sent by the remote station (ISDN). </li>
</ul>
<p>
The <a href="msgs_1eud.htm">LINE_CALLSTATE</a> message also notifies monitoring applications about the existence and state of outgoing (and incoming) calls established by other applications or established manually by the user—for example, on an attached phone device (if the telephony hardware and the service provider support monitoring of actions on external equipment). The call state of such calls reflects the actual state of the call as follows: An incoming call for which ownership is given to another application is indicated to the monitor applications as initially being in the <i>offering</i> state. An outgoing call placed by another application would normally first appear to the monitoring applications in the <i>dialtone</i> state. </p>
<p>
The fact that a call is offered does not necessarily imply that the user is being alerted. Once alerting (ringing) has begun, a separate <a href="msgs_7het.htm">LINE_LINEDEVSTATE</a> message is sent with a <i>ringing</i> indication to inform the application. It may be necessary, in some telephony environments, for the application to accept the call (with <a href="func1_4838.htm"><b>lineAccept</b></a>) before ringing starts. The application can determine whether or not this is necessary by checking the LINEADDRCAPFLAGS_ACCEPTTOALERT bit. </p>
<p>
Depending on the telephony environment, not all the information about a call may be available at the time the call is initially offered. For example, if caller ID is provided by the network between the first and second ring, caller ID will be unknown at the time the call is first offered. When it becomes known shortly thereafter, a <a href="msgs_22cv.htm">LINE_CALLINFO</a> message notifies the application about the change in party-ID information of the call. </p>
<p>&nbsp;</p></body>
</HTML>
