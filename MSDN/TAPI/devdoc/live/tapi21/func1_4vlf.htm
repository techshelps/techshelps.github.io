<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>lineGatherDigits</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_linegatherdigits"></a>lineGatherDigits</h1>
<p>
The <b>lineGatherDigits</b> function initiates the buffered gathering of digits on the specified call. The application specifies a buffer in which to place the digits and the maximum number of digits to be collected. </p>
<pre><code><b>LONG lineGatherDigits(
  HCALL</b><i> hCall</i><b>,               </b>
<b>  DWORD</b><i> dwDigitModes</i><b>,        </b>
<b>  LPSTR</b><i> lpsDigits</i><b>,           </b>
<b>  DWORD</b><i> dwNumDigits</i><b>,         </b>
<b>  LPCSTR</b><i> lpszTerminationDigits</i><b>,  </b>
<b>  DWORD</b><i> dwFirstDigitTimeout</i><b>,  </b>
<b>  DWORD</b><i> dwInterDigitTimeout  </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>hCall</i> </dt>
<dd>
A handle to the call on which digits are to be gathered. The application must be an owner of the call. The call state of <i>hCall</i> can be any state. </dd>
<dt>
<i>dwDigitModes</i> </dt>
<dd>
The digit mode(s) to be monitored. Note that <i>dwDigitModes</i> is allowed to have one or more flags set. This parameter uses the following LINEDIGITMODE_ constants: 
<dl>
<dt>
LINEDIGITMODE_PULSE </dt>
<dd>
Detect digits as audible clicks that are the result of the use of rotary pulse sequences. Valid digits for pulse mode are '0' through '9'. </dd>
<dt>
LINEDIGITMODE_DTMF </dt>
<dd>
Detect digits as DTMF tones. Valid digits for DTMF mode are '0' through '9', 'A', 'B', 'C', 'D', '*', '#'. 
</dd>
</dl>
</dd>
<dt>
<i>lpsDigits</i> </dt>
<dd>
A pointer to the buffer where detected digits are to be stored as ASCII characters. Digits may not show up in the buffer one at a time as they are collected. Only after a <a href="msgs_9myb.htm">LINE_GATHERDIGITS</a> message is received should the content of the buffer be assumed to be valid. If <i>lpsDigits</i> is NULL, the digit gathering currently in progress on the call is terminated and <i>dwNumDigits</i> is ignored. Otherwise, <i>lpsDigits</i> is assumed to have room for <i>dwNumDigits</i> digits. </dd>
<dt>
<i>dwNumDigits</i> </dt>
<dd>
The number of digits to be collected before a LINE_GATHERDIGITS message is sent to the application. The <i>dwNumDigits</i> parameter is ignored when <i>lpsDigits</i> is NULL. This function fails if <i>dwNumDigits</i> is zero. </dd>
<dt>
<i>lpszTerminationDigits</i> </dt>
<dd>
Specifies a NULL-terminated string of termination digits as ASCII characters. If one of the digits in the string is detected, that termination digit is appended to the buffer, digit collection is terminated, and the <a href="msgs_9myb.htm">LINE_GATHERDIGITS</a> message is sent to the application. 
<p>
Valid characters for pulse mode are '0' through '9'. Valid characters for DTMF mode are '0' through '9', 'A', 'B', 'C', 'D', '*', '#'. If this pointer is NULL, or if it points to an empty string, the function behaves as though no termination digits were supplied. 
</dd>
<dt>
<i>dwFirstDigitTimeout</i> </dt>
<dd>
The time duration in milliseconds in which the first digit is expected. If the first digit is not received in this timeframe, digit collection is aborted and a LINE_GATHERDIGITS message is sent to the application. The buffer only contains the NULL character, indicating that no digits were received and the first digit timeout terminated digit gathering. The call's line-device capabilities specify the valid range for this parameter or indicate that timeouts are not supported. </dd>
<dt>
<i>dwInterDigitTimeout</i> </dt>
<dd>
The maximum time duration in milliseconds between consecutive digits. If no digit is received in this timeframe, digit collection is aborted and a LINE_GATHERDIGITS message is sent to the application. The buffer only contains the digits collected up to this point followed by a NULL character, indicating that an interdigit timeout terminated digit gathering. The call's line-device capabilities specify the valid range for this parameter or indicate that timeouts are not supported. 
</dd>
</dl>
<h4>Return Values</h4>
<p>
Returns zero if the request succeeds or a negative error number if an error occurs. Possible return values are: </p>
<p>
LINEERR_INVALCALLHANDLE, LINEERR_NOMEM, LINEERR_INVALCALLSTATE, LINEERR_NOTOWNER, LINEERR_INVALDIGITMODE, LINEERR_OPERATIONUNAVAIL, LINEERR_INVALDIGITS, LINEERR_OPERATIONFAILED, LINEERR_INVALPARAM, LINEERR_RESOURCEUNAVAIL, LINEERR_INVALPOINTER, LINEERR_UNINITIALIZED.</p>
<h4>Remarks</h4>
<p>
Digit collection is terminated when the requested number of digits has been collected. It is also terminated when one of the digits detected matches a digit in <i>szTerminationDigits</i> before the specified number of digits has been collected. The detected termination digit is also placed in the buffer and the partial buffer is returned. </p>
<p>
Another way of canceling digit collection occurs when one of the timeouts expires. The <i>dwFirstDigitTimeout</i> expires if the first digit is not received in this time period. The <i>dwInterDigitTimout</i> expires if the second, third, (and so forth) digit is not received within that time period from the previously detected digit, and a partial buffer is returned. </p>
<p>
A fourth method for terminating digit collection is by calling this function again while collection is in progress. The old collection session is terminated, any digits collected up to that point are copied to the buffer supplied from the previous call to this function, and the buffer is delivered when the LINE_GATHERDIGITS message is sent to the application. The mechanism for terminating digit gathering without initiating another gathering of the digits is to invoke this function with <i>lpsDigits</i> equal to NULL. </p>
<p>
This function is considered successful if digit collection has been correctly initiated, not if digit collection has terminated. In all cases where a partial buffer is returned, valid digits (if any) are followed by an ASCII NULL character. </p>
<p>
Although this function can be invoked in any call state, digits can typically only be gathered while the call is in the <i>connected</i> state. </p>
<p>
The message LINE_GATHERDIGITS is sent only to the application that initiated the request. It is also sent when partial buffers are returned because of timeouts or matching termination digits, or when the request is canceled by another <b>lineGatherDigits</b> request on the call. Only one gather-digits request can be active on a call at any given time across all applications that are owners of the call. Given the asynchronous behavior of the operation, an application that issues multiple <b>lineGatherDigits</b> requests in quick succession may be able to do so and receive several LINE_GATHERDIGITS messages later. While this would be unusual application behavior, the application is able to count the number of these messages to allow cancel messages to be matched with the earlier requests. In any case, only the most recent request should be assumed to be valid. </p>
<p>
<b>Note</b>&nbsp;&nbsp;When an application invokes any asynchronous operation that writes data back into application memory, the application must keep that memory available for writing until a LINE_REPLY or LINE_GATHERDIGITS message is received.</p>
<p>
An application can use <a href="func2_3vg3.htm"><b>lineMonitorDigits</b></a> to enable or disable unbuffered digit detection. Each time a digit is detected in this fashion, a <a href="msgs_8icz.htm">LINE_MONITORDIGITS</a> message is sent to the application. Both buffered and unbuffered digit detection can be simutaneously enabled for the same call. </p>
<p>
Gathering of digits on a conference call applies only to the <i>hConfCall</i>, not to the individual participating calls. </p>
<p>
If the <b>lineGatherDigits</b> function is used to cancel a previous request to gather digits, the function copies any digits collected up to that point to the buffer specified in the original function call. The function then sends a LINE_GATHERDIGITS message to the application, regardless of whether the <i>lpszDigits</i> parameter in the second call specifies a NULL or different address. </p>
<h4>QuickInfo</h4>
<p>
&nbsp;&nbsp;<b>Version:</b> Use TAPI version 1.4 and later.<br>
&nbsp;&nbsp;<b>Header:</b> Declared in tapi.h.<br>
&nbsp;&nbsp;<b>Import Library:</b> Link with tapi32.lib.</p>
<h4>See Also</h4>
<p>
<a href="quickref_9s85.htm">TAPI Reference Overview</a>, <a href="quickref_2bg3.htm">Supplementary Line Services Functions</a>, <a href="msgs_9myb.htm">LINE_GATHERDIGITS</a>, <a href="msgs_2ayh.htm">LINE_REPLY</a>, <a href="msgs_8icz.htm">LINE_MONITORDIGITS</a>, <a href="func2_3vg3.htm"><b>lineMonitorDigits</b></a></p>
<p>&nbsp;</p></body>
</HTML>
