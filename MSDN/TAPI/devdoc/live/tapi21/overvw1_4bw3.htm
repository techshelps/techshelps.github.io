<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Closing Lines</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_win32_closing_lines"></a>Closing Lines</h2>
<p>
An application should close a line it has open in the following cases: 
<ul>
<li>
<b>Before exiting</b> An application should always close all lines it has open before it becomes inactive. </li>
<li>
<b>For non-TAPI applications</b> TAPI applications should cooperate with non-TAPI applications that use media stream devices such as COM ports. If your TAPI device is a serial device accessed through a COM port (such as a modem) and the line is open, the service provider needs to have the COM port open. But with the COM port open, non-TAPI applications and console applications are prevented from accessing the COM port. Therefore, a TAPI application should open the line (and keep it open) only if it is waiting for incoming calls or it is actively engaged in placing an outgoing call. </li>
<li>
Non-telephony communications applications may need to share resources with telephony applications. </li>
</ul>
<p>
The data structure <a href="struc2_30mq.htm"><b>LINEDEVCAPS</b></a> contains a capabilities bit (LINEDEVCAPFLAGS_CLOSEDROP) that tells whether closing a line while a call is still active causes calls on the line to be dropped. If TRUE, the service provider drops (clears) all active calls on the line when the last application having that line open closes it using the <a href="func1_9sth.htm"><b>lineClose</b></a> function. If the bit is set to FALSE, the service provider does not drop active calls on the line; instead, it leaves these calls active and under the control of an external device or devices, such as phones. </p>
<p>
Therefore, an application can examine <b>LINEDEVCAPS</b> to detect in advance whether closing a line will cause this active call to be dropped. The application should warn all appropriate users that the call is about to be dropped, perhaps by displaying an <b>OK/Cancel</b> dialog box that lets the user keep the line open. </p>
<p>
For example, if a desktop computer and a phone set are both connected directly to an analog line (in a party-line configuration), the service provider should set the flag to FALSE, as the offhook phone would automatically keep the call active even after the computer is shut down. </p>
<p>
As another example, a user is speaking on the phone on a call owned by an active application. The user decides to leave the office for the day and shuts down the system. The operating system in turn shuts down the active telephony application, which attempts to close the lines it has open. Whether the call is automatically disconnected depends on whether the LINEDEVCAPFLAGS_CLOSEDROP bit in <a href="struc2_30mq.htm"><b>LINEDEVCAPS</b></a> is set or not and whether the phone is offhook. </p>
<p>
If other applications are monitoring the call, the service provider will not even be informed that one application has closed the line. It is only when the last application that has a handle to the call closes the line that the service provider is informed (with <b>TSPI_lineClose</b>). At that point, it is up to the service provider to handle any remaining calls. If the service provider is required to drop the calls, it should do so but it should first warn applications about this requirement with the LINEDEVCAPFLAGS_CLOSEDROP flag. </p>
<p>
Closing an application should ideally perform the following cleanup tasks: 
<ul>
<li>
<b>Dispose</b> of all calls. </li>
<li>
<b>Close</b> all open lines and phones. </li>
<li>
<b>Shut down</b> the usage of the Telephony API. </li>
</ul>
<p>
Failure to do so may leave calls in indeterminate states. </p>
<p>&nbsp;</p></body>
</HTML>
