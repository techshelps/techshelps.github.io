<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Summary of Memory Allocation Rules</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_rpc_summary_of_memory_allocation_rules"></a>Summary of Memory Allocation Rules</h1>
<p>
The following table summarizes key rules regarding memory allocation:</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=48%>MIDL element</th>
<th align=left width=52%>Description</th>
</tr>
<tr valign=top>
<td width=48%>Top-level <b>ref</b> pointers</td>
<td width=52%>Must be non-null pointers.</td>
</tr>
<tr valign=top>
<td width=48%>Function return value</td>
<td width=52%>New memory is always allocated for pointer return values.</td>
</tr>
<tr valign=top>
<td width=48%><b>unique</b>,<b> out</b> or <b>ptr</b>,<b> out</b> pointer</td>
<td width=52%>Not allowed by MIDL.</td>
</tr>
<tr valign=top>
<td width=48%>Non-top-level <b>unique</b>,<b> in</b>,<b> out</b> or <b>ptr</b>,<b> in</b>,<b> out</b> pointer that changes from null to non-null</td>
<td width=52%>Client stubs allocate new memory on client on return.</td>
</tr>
<tr valign=top>
<td width=48%>Non-top-level <b>unique</b>,<b> in</b>,<b> out</b> pointer that changes from non-null to null</td>
<td width=52%>Memory is orphaned on client; client application is responsible for freeing memory and preventing leaks.</td>
</tr>
<tr valign=top>
<td width=48%>Non-top-level<b> ptr</b>,<b> in</b>,<b> out </b>pointer that changes from non-null to null</td>
<td width=52%>Memory will be orphaned on client if not aliased; client application is responsible for freeing and preventing memory leaks in this case.</td>
</tr>
<tr valign=top>
<td width=48%><b>ref</b> pointers</td>
<td width=52%>Client-application layer usually allocates.</td>
</tr>
<tr valign=top>
<td width=48%>Non-null <b>in</b>,<b> out </b>pointer</td>
<td width=52%>Stubs attempt to write into existing storage on client. If <b>string</b> and size increases beyond size allocated on the client, it will cause a GP-fault on return.</td>
</tr>
</table><br>
<p>
The following table summarizes the effects of key IDL and ACF attributes on memory management:</p>
<table cellspacing=4 cols=3>
<tr valign=top>
<th align=left width=28%>MIDL feature</th>
<th align=left width=34%>Client issues</th>
<th align=left width=38%>Server issues</th>
</tr>
<tr valign=top>
<td width=28%><object id=alink_1 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="DefaultTopic" value="../../../notopic_0pk4.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_rpc_allocate">
</object><a href=JavaScript:alink_1.Click()><b>allocate</b></a><b>(single_node)</b>, <b>allocate(all_nodes)</b></td>
<td width=34%>Determines whether one or many calls are made to the memory functions.</td>
<td width=38%>Same as client, except private memory can often be used for <b>allocate (single_node) [in]</b> and <b>[in</b>,<b>out] </b>data.</td>
</tr>
<tr valign=top>
<td width=28%><b>allocate(free)</b> or <b>allocate(dont_free)</b></td>
<td width=34%>(None; affects server)</td>
<td width=38%>Determines whether memory on the server is freed after each remote procedure call.</td>
</tr>
<tr valign=top>
<td width=28%>array attributes <object id=alink_2 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="DefaultTopic" value="../../../notopic_0pk4.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_rpc_max_is">
</object><a href=JavaScript:alink_2.Click()><b>max_is</b></a> and <object id=alink_3 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="DefaultTopic" value="../../../notopic_0pk4.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_rpc_size_is">
</object><a href=JavaScript:alink_3.Click()><b>size_is</b></a></td>
<td width=34%>(None; affects server)</td>
<td width=38%>Determines size of memory to be allocated.</td>
</tr>
<tr valign=top>
<td width=28%><object id=alink_4 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="DefaultTopic" value="../../../notopic_0pk4.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_rpc_byte_count">
</object><a href=JavaScript:alink_4.Click()><b>byte_count</b></a></td>
<td width=34%>Client must allocate buffer; not allocated or freed by client stubs.</td>
<td width=38%>ACF parameter attribute determines size of buffer allocated on server.</td>
</tr>
<tr valign=top>
<td width=28%><object id=alink_5 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="DefaultTopic" value="../../../notopic_0pk4.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_rpc_enable_allocate">
</object><a href=JavaScript:alink_5.Click()><b>enable_allocate</b></a></td>
<td width=34%>Usually, none. However, the client may be using a different memory management environment.</td>
<td width=38%>Server uses a different memory management environment. <b>RpcSmAllocate</b> should be used for allocations.</td>
</tr>
<tr valign=top>
<td width=28%><object id=alink_6 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="DefaultTopic" value="../../../notopic_0pk4.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_rpc_in">
</object><a href=JavaScript:alink_6.Click()><b>in</b></a> attribute</td>
<td width=34%>Client application responsible for allocating memory for data.</td>
<td width=38%>Allocated on server by stubs.</td>
</tr>
<tr valign=top>
<td width=28%><object id=alink_7 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="DefaultTopic" value="../../../notopic_0pk4.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_rpc_out_idl">
</object><a href=JavaScript:alink_7.Click()><b>out</b></a> attribute</td>
<td width=34%>Allocated on client by stubs.</td>
<td width=38%><b>out</b>-only pointer must be <b>ref</b> pointer; allocated on server by stubs.</td>
</tr>
<tr valign=top>
<td width=28%><object id=alink_8 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="DefaultTopic" value="../../../notopic_0pk4.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_rpc_ref">
</object><a href=JavaScript:alink_8.Click()><b>ref</b></a> attribute</td>
<td width=34%>Memory referenced by pointer must be allocated by client application.</td>
<td width=38%>Top-level and first-level reference pointers managed by stubs.</td>
</tr>
<tr valign=top>
<td width=28%><object id=alink_9 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="DefaultTopic" value="../../../notopic_0pk4.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_rpc_unique">
</object><a href=JavaScript:alink_9.Click()><b>unique</b></a> attribute</td>
<td width=34%>Non-null to null can result in orphaned memory; null to non-null causes client stub to call <a href="ov-memmg_3rhh.htm"><b>midl_user_allocate</b></a>.</td>
<td width=38%>(Affects client)</td>
</tr>
<tr valign=top>
<td width=28%><object id=alink_10 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="DefaultTopic" value="../../../notopic_0pk4.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_rpc_ptr">
</object><a href=JavaScript:alink_10.Click()><b>ptr</b></a> attribute</td>
<td width=34%>(See <object id=alink_11 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="DefaultTopic" value="../../../notopic_0pk4.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_rpc_unique">
</object><a href=JavaScript:alink_11.Click()><b>unique</b></a>)</td>
<td width=38%>(See <object id=alink_12 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="DefaultTopic" value="../../../notopic_0pk4.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_rpc_unique">
</object><a href=JavaScript:alink_12.Click()><b>unique</b></a>)</td>
</tr>
</table><br>
<p>
</p>
<p>
</p>
<p>&nbsp;</p></body>
</HTML>
