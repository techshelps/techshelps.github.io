<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Server Context Rundown Routine</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_rpc_server_context_rundown_routine"></a>Server Context Rundown Routine</h2>
<p>
If communication breaks down while the server is maintaining context on behalf of the client, a cleanup routine may be needed to reset the context information. This cleanup routine is called a "context rundown routine." When a connection breaks, the server runtime will call this routine on every context handle opened by the client.</p>
<p>
The context rundown routine is required, and is implicitly declared and named, when you apply the <b>context_handle</b> attribute to a type definition. The server will <i>not </i>call the context rundown routine if the <b>context_handle </b>attribute was applied directly to a parameter.</p>
<p>
The context rundown routine syntax is:</p>
<p>
<b>void</b> __RPC_USER <i>type-id</i><b>_rundown</b> (<i>type-id</i>);</p>
<p>
Note that the type name determines the name of the context rundown routine. </p>
<h4>Example</h4>
<p>
In this example, the context rundown routine calls the RemoteClose procedure used in the example in <a href="ov-handl_1ak3.htm">Context Handles</a>. This procedure closes the file handle, frees the memory associated with the file, and assigns NULL to the context handle. The NULL value tells the runtime that the context handle has been deleted so that the rundown routine will not be called when the connection is removed. Your context rundown routine could perform other tasks, such as logging an event when a connnection fails.</p>
<pre><code>//file: cxhndp.c (fragment of file containing remote procedures)
//The rundown routine is associated with the context handle type.  
void __RPC_USER PCONTEXT_HANDLE_TYPE_rundown(PCONTEXT_HANDLE_TYPE phContext)
{
    printf("Client died with an open file, closing it..\n");
RemoteClose(&amp;phContext);
assert(phContext == 0);
}
 </code></pre>
<h4>See Also</h4>
<p>
<object id=alink_1 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="DefaultTopic" value="../../../notopic_0pk4.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_rpc_context_handle">
</object><a href=JavaScript:alink_1.Click()><b>context_handle</b></a>, <a href="ov-handl_1ak3.htm">Context Handles</a></p>
<p>&nbsp;</p></body>
</HTML>
