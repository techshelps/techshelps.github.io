<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IDBPromptInitialize::PromptDataSource</title>
<link disabled rel=stylesheet href=msdn_ie3.css>
<style type="text/css">
@import url(msdn_ie4.css);
</style>
</HEAD>
<BODY>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

	<!--TOOLBAR_START-->
	<!--TOOLBAR_EXEMPT-->
	<!--TOOLBAR_END-->


<h1><a name="idbpromptinitializepromptdatasource"></a>IDBPromptInitialize::PromptDataSource</h1>
<p>
Opens the <b>Data Link Properties</b> dialog box. Returns a connection string.</p>
<pre><code><b>HRESULT PromptDataSource(

&nbsp;&nbsp;&nbsp;IUnknown *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b><i>pUnkOuter</i>
<b>&nbsp;&nbsp;&nbsp;HWND</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>hWndParent,</i>
<b>&nbsp;&nbsp;&nbsp;DBPROMPTOPTIONS</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>dwPromptOptions,</i>
<b>&nbsp;&nbsp;&nbsp;ULONG</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>cSourceTypeFilter,</i>
<b>&nbsp;&nbsp;&nbsp;DBSOURCETYPE *</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>rgSourceTypeFilter,</i>
<b>&nbsp;&nbsp;&nbsp;LPCOLESTR </b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>pwszszzProviderFilter,</i>
<b>&nbsp;&nbsp;&nbsp;REFIID</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>riid,</i>
<b>&nbsp;&nbsp;&nbsp;IUnknown **</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>ppDataSource</i><b>);</b></code></pre>
<p class=label>
<b>Parameters</b></p>
<p class=dt>
<i>pUnkOuter [in]</i></p>
<p class=indent>
A pointer to the controlling <b>IUnknown</b> interface if the data source object is being created as a part of an aggregate; otherwise, it is a null pointer.</p>
<p class=dt>
<i>hWndParent [in]</i></p>
<p class=indent>
The parent window handle for dialog boxes to be displayed. The dialog box will always be centered within this window.</p>
<p class=dt>
<i>dwPromptOptions [in]</i></p>
<p class=indent>
Specifies whether to prompt with the <b>Create New Data Link</b> wizard or the <b>Data Link Properties</b> dialog box.</p>
<table border=1 cellpadding=5 cols=2 frame=below rules=rows width=563>
<tr valign=top>
<td class=label width=55%><b>Value</b></td>
<td class=label width=45%><b>Meaning</b></td>
</tr>
<tr valign=top>
<td width=55%>DBPROMPTOPTIONS_WIZARDSHEET</td>
<td width=45%>Prompt with <b>Create New Data Link</b> wizard.</td>
</tr>
<tr valign=top>
<td width=55%>DBPROMPTOPTIONS_PROPERTYSHEET</td>
<td width=45%>Prompt with <b>Data Link Properties</b> dialog box.</td>
</tr>
</table><br>
<p class=dt>
<i>cSourceTypeFilter [in]</i></p>
<p class=indent>
Count of elements in <i>rgSourceTypeFilter</i>. The only valid value is zero.</p>
<p class=indent>
This is reserved for future use.</p>
<p class=dt>
<i>rgSourceTypeFilter [in]</i></p>
<p class=indent>
This parameter is ignored unless <i>cSourceTypeFilter</i> is greater than zero. Otherwise, this parameter points to a valid array of DBSOURCETYPE values. If it is non-null, the providers presented to the user will be limited to those that match the SOURCE_TYPEs specified in <i>rgSourceTypeFilter.</i></p>
<p class=indent>
This is reserved for future use.</p>
<p class=dt>
<i>pwszszzProviderFilter [in]</i></p>
<p class=indent>
A double null-terminated string of ProgIDs.</p>
<p class=indent>
This parameter must be null, or point to a valid string. If it is non-null, the providers presented to the user will be limited to those that match the providers' ProgIDs specified in p<i>wszszzProviderFilter.</i> If only one provider is specified, and <b>DBPROMPTOPTIONS_WIZARDSHEET</b> is specified, the provider selection page is not displayed.</p>
<p class=dt>
<i>riid [in]</i></p>
<p class=indent>
The requested interface for the data link returned in *<i>ppDataSource</i>.</p>
<p class=dt>
<i>ppDatasource [in, out]</i></p>
<p class=indent>
A pointer to a data source object (DSO).</p>
<p class=indent>
If *<i>ppDataSource</i> is null on entry, then <b>Prompt</b> generates a new DSO based on the information specified by the user, and returns a pointer to that DSO in *<i>ppDataSource</i>.</p>
<p class=indent>
If *<i>ppDataSource</i> is non-null on entry, <b>Prompt</b> uses the properties returned by <b>IProperties::GetProperties()</b> as initial values. If the user selects a different provider, <b>Prompt</b> will release the original *<i>ppDataSource</i> and create a new data source. On exit, *<i>ppDataSource</i> will be set to a pointer to the interface specified by <i>riid</i>. </p>
<p class=label>
<b>Return Code</b></p>
<p class=dt>
S_OK</p>
<p class=indent>
The method succeeded.</p>
<p class=dt>
E_FAIL</p>
<p class=indent>
A provider-specific error occurred.</p>
<p class=dt>
DB_E_CANCELED</p>
<p class=indent>
The user canceled the dialog.</p>
<p class=dt>
E_NOINTERFACE</p>
<p class=indent>
The data source did not support the interface specified in <i>riid</i>.</p>
<p class=indent>
<i>riid</i> was IID_NULL.</p>
<p class=indent>
*<i>ppDatasource</i> was not null and did not indicate an OLE DB data source generated from <b>IDataInitialize</b> or <b>IDBPromptInitialize</b>.</p>
<p class=dt>
DB_E_NOAGGREGATION</p>
<p class=indent>
<i>pUnkOuter</i> was not a null pointer and <i>riid</i> was something other than IID_IUnknown.</p>
<p class=indent>
<i>pUnkOuter</i> was not a null pointer and the provider does not support aggregation.</p>
<p class=dt>
E_INVALIDARG</p>
<p class=indent>
<i>ppDatasource</i> was a null pointer.</p>
<p class=indent>
<i>cSourceTypeFilter</i> was not zero and <i>rgSourceTypeFilter</i> was a null pointer.</p>
<p class=indent>
An element in <i>rgSourceTypeFilter</i> was not a valid filter.</p>
<p class=indent>
<i>dwPromptOptions</i> was an invalid value.</p>
<p class=label>
<b>Comments</b></p>
<p>
None.</p>
<p class=label>
<b>Code Example</b></p>
<p>
The following code fragment shows how a consumer might use <b>IDBPromptInitialize::PromptDataSource</b> to prompt the user for connection information:</p>
<pre><code>// First CoCreate the OLE DB Service Component Manager
//

HRESULT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=S_OK;
IDataInitialize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*pIDataInitialize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=NULL;

hr = CoCreateInstance(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLSID_DataLinks, 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NULL, 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLSCTX_INPROC_SERVER, 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IID_IDataInitialize, 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reinterpret_cast&lt;void **&gt;(pIDataInitialize));


// CreateDBInstance to instantiate previously stored provider
//

CLSID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clsidProvider&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(GetProviderCLSID());
IDBProperties &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*pIDBProperties&nbsp;&nbsp;&nbsp;=NULL;

hr = pIDataInitialize-&gt;CreateDBInstance(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; clsidProvider,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NULL,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CLSCTX_INPROC_SERVER,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NULL,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IID_IDBProperties,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; reinterpret_cast&lt;void **&gt;(&amp;pIDBProperties));


// Set some previously stored properties
//

ULONG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cPropertySets&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (GetPropertySetsCount());
DBPROPSET&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (*rgPropertySets) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (GetPropertySets());

hr = pIDBProperties-&gt;SetProperties(cPropertySets, rgPropertySets);


// Prompt the user to view/edit the connection information
//

IDBPromptInitialize&nbsp;&nbsp;&nbsp;*pIDBPromptInitialize&nbsp;&nbsp;&nbsp;=NULL;

hr = pIDataInitialize -&gt;QueryInterface(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IID_IDBPromptInitialize, 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reinterpret_cast&lt;void **&gt;(&amp;pIDBPromptInitialize));

hr = pIDBPromptInitialize-&gt;PromptDataSource(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NULL,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hWndParent,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DBPROMPTOPTIONS_WIZARD,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0, NULL, 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NULL,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IID_IDBProperties,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;pIDBProperties);
</code></pre>
</font></BODY>
</HTML>
