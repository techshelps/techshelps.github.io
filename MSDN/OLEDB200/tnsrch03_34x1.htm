<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Searched Case</title>
<link disabled rel=stylesheet href=msdn_ie3.css>
<style type="text/css">
@import url(msdn_ie4.css);
</style>
</HEAD>
<BODY>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

	<!--TOOLBAR_START-->
	<!--TOOLBAR_EXEMPT-->
	<!--TOOLBAR_END-->


<h1><a name="searchedcase"></a>Searched Case</h1>
<p>
In the simple case expression example, a measure called “PerfRating” exists, which contains a numerical rating from 1 to 5 for each salesperson. Assume that this rating is based on the percentage by which each salesperson beat her budgeted sales. Anything above 100% is a performance rating of 5; from 51% to 100% is 4, from 1% to 50% is 3, from -24% to 0% is 2, and -25% or less is 1.</p>
<p>
The simple CASE statement is not capable of expressing this logic because the when operand of the simple WHEN clause is a value expression, rather than a search condition. In the searched case, the when operand is a search condition. Clearly, a case operand is no longer needed. </p>
<p>
The construct of the searched case clause is:</p>
<pre><code>&lt;searched_case&gt; ::= CASE
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;searched_when_clause&gt;...
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [ &lt;else_clause&gt; ]
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; END

&lt;searched_when_clause&gt; ::= WHEN &lt;search_condition&gt; THEN &lt;result&gt;
</code></pre>
<p>
The expansion of other nonterminals is the same as that for the simple case. The following example uses searched case to generate a performance rating for each sales rep, based on the logic explained above:</p>
<pre><code>WITH MEMBER [Measures].[PerfTemp] AS 
 &nbsp;&nbsp;&nbsp;&nbsp; ([Measures].[Sales] - [Measures].[BudgetedSales])/
 &nbsp;&nbsp;&nbsp;&nbsp; [Measures].[BudgetedSales]*100
WITH MEMBER [Measures].[PerfRating] AS 
 &nbsp;&nbsp;&nbsp;&nbsp; CASE
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN [Measures].[PerfTemp] &gt; 100 THEN 5
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN [Measures].[PerfTemp] &gt; 50&nbsp; THEN 4
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN [Measures].[PerfTemp] &gt; 0&nbsp;&nbsp; THEN 3
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHEN [Measures].[PerfTemp] &gt; -25 THEN 2
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ELSE 1
 &nbsp;&nbsp;&nbsp;&nbsp; END
SELECT {[Measures].[Sales], [Measures].[PerfRating]}
 &nbsp;&nbsp;&nbsp;&nbsp; ON COLUMNS,
 &nbsp;&nbsp;&nbsp;&nbsp; SalesPerson.MEMBERS ON ROWS
FROM SalesCube
WHERE ([1997], [Geography].[All], [Products].[All])
</code></pre>
<p>
Note that the WHEN clauses are evaluated in the order specified; that is, the value of CASE is the result of the first searched when clause whose search condition is TRUE. That happens when the second WHEN clause in the above example just checks to see if PerfTemp &gt; 50, rather than checking if PerfTemp &gt; 50 AND PerfTemp &lt;= 100. </p>
<p>
As with simple case, if no ELSE is specified, and the search conditions of all the WHEN clauses is FALSE, then the result of the CASE is an empty cell value. For more information, see “Empty Cells” in this chapter.</p>
<p>
Finally, the simple case can be rewritten as a searched case. The simple case</p>
<p>
<b>CASE</b> <i>case_operand<br>
</i> &nbsp; <b>WHEN</b> <i>when_operand1</i><b> THEN </b><i>result1</i><br>
 &nbsp; <b>WHEN</b> <i>when_operand2</i><b> THEN </b><i>result2</i><br>
 &nbsp; <b>...<br>
END</b></p>
<p>
is equivalent to the following searched case:</p>
<p>
<b>CASE <br>
</b> &nbsp; <b>WHEN </b><i>case_operand</i><b> = </b><i>when_operand1</i><b> THEN </b><i>result1</i><br>
 &nbsp; <b>WHEN </b><i>case_operand</i><b> = </b><i>when_operand2</i><b> THEN </b><i>result2</i><br>
 &nbsp; <b>...<br>
END</b></p>
</font></BODY>
</HTML>
