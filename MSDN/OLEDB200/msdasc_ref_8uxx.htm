<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IDataInitialize::GetDataSource</title>
<link disabled rel=stylesheet href=msdn_ie3.css>
<style type="text/css">
@import url(msdn_ie4.css);
</style>
</HEAD>
<BODY>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

	<!--TOOLBAR_START-->
	<!--TOOLBAR_EXEMPT-->
	<!--TOOLBAR_END-->


<h1><a name="idatainitializegetdatasource"></a>IDataInitialize::GetDataSource</h1>
<p>
Given a connection string, instantiates and returns a data source object.</p>
<pre><code><b>HRESULT GetDataSource(

&nbsp;&nbsp;&nbsp;IUnknown</b> *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>pUnkOuter</i>,
<b>&nbsp;&nbsp;&nbsp;DWORD</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>dwClsCtx,</i>
<b>&nbsp;&nbsp;&nbsp;LPCOLESTR</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>pwszInitializationString</i>,
<b>&nbsp;&nbsp;&nbsp;REFID</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>riid</i>,
<b>&nbsp;&nbsp;&nbsp;IUnknown</b> **&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>ppDataSource</i>);
</code></pre>
<p class=label>
<b>Parameters</b></p>
<p class=dt>
<i>pUnkOuter [in]</i></p>
<p class=indent>
A pointer to the controlling <b>IUnknown</b> interface if the data source object is being created as a part of an aggregate; otherwise, it is a null pointer.</p>
<p class=dt>
<i>dwClsCtx [in]</i></p>
<p class=indent>
CLSCTX values.</p>
<p class=dt>
<i>pwszInitializationString [in]</i></p>
<p class=indent>
A pointer to a connection string containing the information to be used for creating, and setting properties on a data source object. If this is NULL, an instance of the OLE DB provider for ODBC data is returned with default properties set.</p>
<p class=dt>
<i>riid [in]</i></p>
<p class=indent>
The requested IID for the data source object returned in *<i>ppDataSource</i>.</p>
<p class=dt>
<i>ppDataSource [in, out]</i></p>
<p class=indent>
A pointer to a data source object.</p>
<p class=indent>
If <i>*ppDataSource</i> is null on entry, then <b>GetDataSource</b> generates a new data source object based on the information in <i>pwszInitializationString</i>, and returns a pointer to that data source object in <i>ppDataSource</i>.</p>
<p class=indent>
If <i>*ppDataSource</i> is null and no provider is specified in <i>pwszInitializationString</i>, the data source object will be defaulted to the OLE DB Provider for ODBC.</p>
<p class=indent>
If <i>*ppDataSource</i> is non-null and provider is specified in <i>pwszInitializationString</i>, then the data source specified by <i>*ppDataSource</i> will be used.</p>
<p class=indent>
If <i>*ppDataSource</i> is non-null on entry, and a provider is specified in <i>pwszInitializationString</i>, <b>GetDataSource</b> checks to see if the specified provider matches the data source object passed in <i>*ppDatasource</i>. If so, <b>GetDataSource</b> sets the specified properties on the existing data source object. If not, <b>GetDataSource</b> returns an error and leaves <i>*ppDatasource</i> untouched.</p>
<p class=label>
<b>Return Code</b></p>
<p class=dt>
S_OK</p>
<p class=indent>
The method succeeded.</p>
<p class=dt>
E_FAIL</p>
<p class=indent>
A provider-specific error occurred.</p>
<p class=dt>
E_NOINTERFACE</p>
<p class=indent>
The data source did not support the interface specified in <i>riid</i>.</p>
<p class=indent>
<i>riid</i> was IID_NULL.</p>
<p class=indent>
*<i>ppDatasource</i> was not null and did not indicate an OLE DB data source generated from <b>IDataInitialize</b> or <b>IDBPromptInitialize</b>.</p>
<p class=dt>
DB_E_NOAGGREGATION</p>
<p class=indent>
<i>pwszInitializationString</i> specified a provider, <i>pUnkOuter</i> was not a null pointer, and <i>riid</i> was something other than IID_IUnknown.</p>
<p class=indent>
<i>pwszInitializationString</i> specified a provider,<i> pUnkOuter</i> was not a null pointer, and the provider does not support aggregation.</p>
<p class=indent>
<i>pwszInitializationString</i> specified a provider, <i>pUnkOuter</i> was not a null pointer, and <i>dwClsCtx</i> was CLSCTX_LOCAL_SERVER or CLSCTX_REMOTE_SERVER.</p>
<p class=dt>
E_INVALIDARG</p>
<p class=indent>
<i>pwszInitializationString</i> specified a provider and<i> dwClsCtx</i> was not a valid value.</p>
<p class=indent>
<i>ppDatasource</i> was a null pointer.</p>
<p class=dt>
REGDB_E_CLASSNOTREG</p>
<p class=indent>
The provider indicated in <i>pwszInitializationString</i> was not found.</p>
<p class=indent>
<i>dwClsCtx</i> indicated a server type not supported by the provider specified in <i>pwszInitializationString</i>. </p>
<p class=dt>
DB_E_ERRORSOCCURRED</p>
<p class=indent>
A property specified in <i>pwszInitializationString</i> was not supported by the provider.</p>
<p class=indent>
A property or value specified in <i>pwszInitializationString</i> was invalid or not supported by the provider.</p>
<p class=indent>
*<i>ppDatasource</i> indicated a data source that was already initialized.</p>
<p class=indent>
A property specified in <i>pwszInitializationString</i> was a read-only property and the property was not set to its default value.</p>
<p class=indent>
It was not possible to set a property specified in <i>pwszInitializationString</i>.</p>
<p class=indent>
One or more properties specified in <i>pwszInitializationString</i> conflicted with an existing property or one another.</p>
<p class=label>
<b>Comments</b></p>
<p>
None.</p>
<p class=label>
<b>Code Example</b></p>
<p>
The following code fragment shows how a consumer might use <b>IDataInitialize</b> to connect to a data source object:</p>
<pre><code>HRESULT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=S_OK;
IDBInitialize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*pIDBInitialize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=NULL;
IdataInitialize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*pIDataInitialize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=NULL;

hr = CoCreateInstance(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLSID_MSDAINITIALIZE,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NULL,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLSCTX_INPROC_SERVER,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IID_IDBInitialize,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reinterpret_cast&lt;IUnknown **&gt;(pIDataInitialize));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!SUCCEEDED(hr))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return hr;

hr = pIDataInitialize-&gt;GetDataSource(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NULL,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLSCTX_INPROC_SERVER,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L"Provider=MSDAORA;User ID=Oracle;Data Source=\\ORACLE",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IID_IDBInitialize,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reinterpret_cast&lt;void **&gt;(pIDBInitialize));
</code></pre>
</font></BODY>
</HTML>
