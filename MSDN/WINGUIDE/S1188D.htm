<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Registering Application State Information</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD><BODY bgcolor="#FFFFFF" >

	<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

<H2>Registering Application State Information</H2><P>  </P>
<P>Use the registry to store state information for your application. Typically, the data you store here will be information you may have stored in initialization (.INI) files in previous releases of Windows. Create subkeys under the <B>Software</B> subkey in the <B>HKEY_LOCAL_MACHINE</B> and <B>HKEY_CURRENT_USER</B> keys that include information about your application.</P>
<P CLASS="syn"><B>HKEY_LOCAL_MACHINE<BR></B>    <B>Software</B><BR>        <B><I>CompanyName<BR></I></B>            <B><I>ProductName<BR></I></B>                <B><I>Version</I></B><BR><B>...</B><B><I><BR></I></B><B>HKEY_CURRENT_USER<BR></B>    <B>Software</B><BR>        <B><I>CompanyName<BR></I></B>            <B><I>ProductName<BR></I></B>                <B><I>Version</I></B></P>
<P>Use your application's <B>HKEY_LOCAL_MACHINE</B> entry as the location to store computer-specific data and the <B>HKEY_CURRENT _USER</B> entry to store user-specific data. The latter key allows you to store settings to tailor your application for individual users working with the same computer. Under your application's subkey, you can define your own structure for the information. Although the system still supports initialization files for backward compatibility, use the registry wherever possible to store your application's state information instead.</P>
<P>Use these keys to save your application's state whenever appropriate, such as when the user closes its primary window. In most cases, it is best to restore a window to its previous state when the user reopens it.</P>
<P>When the user shuts down the system with your application's window open, you may optionally store information in the registry so that the application's state is restored when the user starts up Windows. (The system does this for folders.) To have your application's state restored, store your window and application state information under its registry entries when the system notifies your application that it is shutting down. Store the state information in your application's entries under <B>HKEY_CURRENT_USER</B> and add a value name–value pair to the <B>RunOnce</B> subkey that corresponds to your application. When the user restarts the system, it runs the command line you supply. Once your application runs, you can use the data you stored to restore its state.</P>
<P CLASS="syn"><B>HKEY_CURRENT_USER</B><BR>    <B>Software</B><BR>        <B>Microsoft</B><BR>            <B>Windows</B><BR>                <B>CurrentVersion</B><BR>                    <B>RunOnce</B> <I>application</I> <I>identifier</I> = <I>command</I> <I>line</I></P>
<P>If you have multiple instances open, you can include value name entries for each or consolidate them as a single entry and use command-line switches that are most appropriate for your application. For example, you can include entries like the following.</P>
<P CLASS="syn">WordPad Document 1 = C:\Program Files\Wordpad.exe Letter to Bill /restore<BR>WordPad Document 2 = C:\Program Files\Wordpad.exe Letter to Paul /restore<BR>Paint = C:\Program Files\Paint.exe Abstract.bmp Cubist.bmp</P>
<P>As long as you provide a valid command-line string that your application can process, you can format the entry in a way that best fits your application.</P>
<P>You can also include a <B>RunOnce</B> entry under the <B>HKEY_LOCAL_ MACHINE</B> key. When using this entry, however, the system runs the application before starting up. You can use this entry for applications that may need to query the user for information that affects how Windows starts. Just remember that any entry here will affect all users of the computer.</P>
<P><B>RunOnce</B> entries are automatically removed from the registry once the system starts up. Therefore, you need not remove or update the entries, but your application must always save its state when the user shuts down the system. The system also supports a <B>Run</B> subkey in both the <B>HKEY_CURRENT_USER</B> and <B>HKEY_LOCAL_ MACHINE </B>keys. The system runs any value name entries under this subkey after the system starts up, but does not remove those entries from the registry. For example, a virus check program can be installed to run automatically after the system starts up. You can also support this functionality by placing a file or shortcut to a file in the Startup folder. The registry stores the location of the Startup folder, as a value in <B>HKEY_CURRENT_USER \Software\Microsoft\ Windows\CurrentVersion\Explorer\Shell Folders</B>.</P>
<P>  </P>
<P><B>Note</B>   <img src="NOTE.gif"><BR>The system's ability to restore an application's state depends on the availability of the application and its data files. If they have been deleted or the user has logged in over the network where the same files are not available, the system may not be able to restore the state.</P>
<P>  </P>
<P> </P></FONT>
	</BODY>

</HTML>
