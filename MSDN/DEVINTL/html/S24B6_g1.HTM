<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Setting the Input Context</title>
<style>@import url(../msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="../msdn_ie3.css"></HEAD>

<BODY bgcolor="#FFFFFF">

<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

<h3>Setting the Input Context</h3>

<p>In order to get or set IME status information, composition
strings, or window positions, your application needs to send an
input context handle to most API calls. Calling <i>ImmGetContext</i>
will retrieve the default input context the system has created
and associated with all the windows of a particular thread. After
you are finished with the input context, you need to release it
by calling <i>ImmReleaseContext</i>. Be forewarned that the
system's default input context is a shared resource; any changes
you make to it will affect other windows in the same thread. To
avoid this, you can create a custom input context. Changes you
make to a custom input context will affect only those windows you
associate with it.</p>

<p>Before you associate a window with a custom input context,
it's a good idea to save the window's default input context. You
might need it later&#151;for example, if you destroy your custom
input context and need to restore the default.</p>

<p>To create an input context, call <i>ImmCreateContext</i>. To
associate this context with a window, call <i>ImmAssociateContext</i>.
After you have associated an input context with a window, the
system will automatically provide the input context whenever the
window gets the focus. The system generates a WM_IME_SETCONTEXT
message; the input context is contained in the <i>lParam</i>. If
you make changes to the input context, you should call <i>ImmNotifyIME</i>
so that the IME can remain synchronized. To destroy the custom
input context before you terminate your application, you must
call <i>ImmDestroyContext</i>.</p>

<p>Applications that are fully IME-aware should handle most
WM_IME messages, which tell the application that something has
changed and that the application should query the system to get
updated information. For example, the IME generates WM_IME
messages when an IME user interface window moves, when the user
turns the IME on or off, or when the user sends a string to the
application. The table below lists some of these messages and the
functions your application should call in response to them. For
more detailed information, consult the FULLIME example that ships
with the Far East Windows 95 PDK, and <font class="MissingLink" meta="dev0z">Appendixes N</font> and <font class="MissingLink" meta="dev0aa">O</font> in this
book.</p>

<table border="0" cellpadding="7" cols="2">
    <tr>
        <td valign="top"><b>Functions for Processing WM_IME
        Messages</b></td>
    </tr>
</table>

<table border="0" cellpadding="7" cols="3">
    <tr>
        <td valign="top"><b><i>WM_IME Message </i></b></td>
        <td valign="top"><em><strong>Submessage</strong></em></td>
        <td valign="top"><em><strong>Function for Processing
        Message</strong></em></td>
    </tr>
    <tr>
        <td valign="top">WM_IME_OPENCANDIDATE</td>
        <td valign="top">&nbsp;</td>
        <td valign="top"><i>ImmGetCandidateListCount</i></td>
    </tr>
    <tr>
        <td valign="top">WM_IME_CHANGECANDIDATE</td>
        <td valign="top">&nbsp;</td>
        <td valign="top"><i>ImmGetCandidateListCount</i></td>
    </tr>
    <tr>
        <td valign="top">WM_IME_COMPOSITION</td>
        <td valign="top">&nbsp;</td>
        <td valign="top"><i>ImmGetCompositionString</i></td>
    </tr>
    <tr>
        <td valign="top">WM_IME_COMPOSITIONFULL</td>
        <td valign="top">&nbsp;</td>
        <td valign="top"><i>SendMessage, </i>with<i>
        WM_IME_CONTROL </i>and<i> </i>IME_SETCOMPOSITION<i> </i>WINDOW</td>
    </tr>
    <tr>
        <td valign="top">WM_IME_SETCONTEXT</td>
        <td valign="top">&nbsp;</td>
        <td valign="top"><i>ImmIsUIMessage</i></td>
    </tr>
    <tr>
        <td valign="top">WM_IME_NOTIFY</td>
        <td valign="top">IMN_CHANGECANDIDATE</td>
        <td valign="top"><i>ImmGetCandidateListCount, </i></td>
    </tr>
    <tr>
        <td valign="top">&nbsp;</td>
        <td valign="top">&nbsp;</td>
        <td valign="top"><i>ImmGetCandidateList</i></td>
    </tr>
    <tr>
        <td valign="top">&nbsp;</td>
        <td valign="top">IMN_GUIDELINE</td>
        <td valign="top"><i>ImmGetGuideline</i></td>
    </tr>
    <tr>
        <td valign="top">&nbsp;</td>
        <td valign="top">IMN_OPENCANDIDATE</td>
        <td valign="top"><i>ImmGetCandidateListCount, </i></td>
    </tr>
    <tr>
        <td valign="top">&nbsp;</td>
        <td valign="top">&nbsp;</td>
        <td valign="top"><i>ImmGetCandidateList</i></td>
    </tr>
    <tr>
        <td valign="top">&nbsp;</td>
        <td valign="top">IMN_OPENSTATUSWINDOW</td>
        <td valign="top"><i>ImmGetConversionStatus</i></td>
    </tr>
    <tr>
        <td valign="top">&nbsp;</td>
        <td valign="top">IMN_SETCOMPOSITIONFONT</td>
        <td valign="top"><i>ImmGetCompositionFont</i></td>
    </tr>
    <tr>
        <td valign="top">&nbsp;</td>
        <td valign="top">IMN_SETCOMPOSITIONWINDOW</td>
        <td valign="top"><i>ImmGetCompositionWindow</i></td>
    </tr>
    <tr>
        <td valign="top">&nbsp;</td>
        <td valign="top">IMN_SETCONVERSIONMODE</td>
        <td valign="top"><i>ImmGetConversionStatus</i></td>
    </tr>
    <tr>
        <td valign="top">&nbsp;</td>
        <td valign="top">IMN_SETOPENSTATUS</td>
        <td valign="top"><i>ImmGetOpenStatus</i></td>
    </tr>
    <tr>
        <td valign="top">&nbsp;</td>
        <td valign="top">IMN_SETSENTENCEMODE</td>
        <td valign="top"><i>ImmGetConversionStatus</i></td>
    </tr>
    <tr>
        <td valign="top">&nbsp;</td>
        <td valign="top">IMN_SETSTATUSWINDOWPOS</td>
        <td valign="top"><i>ImmGetStatusWindowPos</i></td>
    </tr>
    <tr>
        <td valign="top">&nbsp;</td>
        <td valign="top">IMN_SETCANDIDATEPOS</td>
        <td valign="top"><i>ImmGetCandidateWindow</i></td>
    </tr>
</table>
</FONT></BODY>
</html>
