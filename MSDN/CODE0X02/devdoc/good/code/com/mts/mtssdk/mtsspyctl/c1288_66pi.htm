<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>MTSSPYPROPPAGE.CPP</title>
<link disabled rel=stylesheet href=../../../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>
<h2><a name="_code_context1296"></a>MTSSPYPROPPAGE.CPP</h2>
<pre><code>// MtsSpyPropPage.cpp : Implementation of CMtsSpyPropPage <br>#include "stdafx.h" <br>#include "MtsSpyCtl.h" <br>#include "MtsAudit.h" <br>#include "MtsSpy.h" <br>#include "MtsSpyPropPage.h" <br>#include "mtsevents.h" <br>#include "MtsSink.h" <br>#include "objsink.h" <br>#include "PackageSink.h" <br>#include "PackageInfo.h" <br> <br>TCHAR * szColNames[] =  <br>{ <br>_T("Count"), <br>_T("Event"), <br>_T("TickCount"), <br>_T("Package"), <br>_T("Parameter"), <br>_T("Value") <br>}; <br>///////////////////////////////////////////////////////////////////////////// <br>// CMtsSpyPropPage <br> <br>LRESULT CMtsSpyPropPage::OnInitDialog(UINT uMsg, WPARAM wParam, LPARAM lParam, BOOL&amp; bHandled) <br>{ <br> <br>bHandled = FALSE; <br> <br>m_ppUnk[0]-&gt;QueryInterface(IID_IMtsSpy, (void**)&amp;m_pSpy); <br>_ASSERTE(m_pSpy); <br>CComBSTR bstr; <br>m_pSpy -&gt; get_LogFile(&amp;bstr); <br>SetDlgItemText(IDC_LOG_FILE, bstr); <br> <br>// grid lines <br>BOOL bVal; <br>m_pSpy -&gt; get_ShowGridLines(&amp;bVal); <br>SendDlgItemMessage(IDC_SHOW_GRID_LINES, BM_SETCHECK,  (bVal) ? BST_CHECKED : BST_UNCHECKED); <br> <br>// show on screen <br>m_pSpy -&gt; get_ShowOnScreen(&amp;bVal); <br>SendDlgItemMessage(IDC_SHOW_ON_SCREEN, BM_SETCHECK,  (bVal) ? BST_CHECKED : BST_UNCHECKED); <br> <br>// log to file <br>m_pSpy -&gt; get_LogToFile(&amp;bVal); <br>SendDlgItemMessage(IDC_LOG_TO_FILE, BM_SETCHECK,  (bVal) ? BST_CHECKED : BST_UNCHECKED); <br> <br>int i; <br>for (i=0;i&lt;sizeof(szColNames)/sizeof(szColNames[0]);i++) <br>SendDlgItemMessage(IDC_COLUMN_NAMES, CB_ADDSTRING, 0, (LPARAM)(LPTSTR)szColNames[i]); <br> <br> <br>SendDlgItemMessage(IDC_COLUMN_NAMES, CB_SETCURSEL, 0, 0); <br>BOOL bH; <br>OnSelectColumn(CBN_SELCHANGE, 0,0, bH); <br>return 0; <br>} <br> <br>LRESULT CMtsSpyPropPage::OnSelectColumn(WORD wNotifyCode, WORD wID, HWND hWndCtl, BOOL&amp; bHandled) <br>{ <br>if (wNotifyCode == CBN_SELCHANGE) <br>{ <br>int nSel = SendDlgItemMessage(IDC_COLUMN_NAMES, CB_GETCURSEL, 0, 0L);    <br>if (nSel != CB_ERR) <br>{ <br>// get the width <br> <br>long lWidth; <br>_ASSERTE(m_pSpy); <br>m_pSpy -&gt; get_ColWidth(nSel, &amp;lWidth); <br>SetDlgItemInt(IDC_WIDTH, lWidth); <br>} <br> <br>} <br> <br>return 0; <br>} <br> <br> <br>STDMETHODIMP CMtsSpyPropPage::Apply() <br>{ <br>ATLTRACE(_T("CMtsSpyPropPage::Apply\n")); <br>for (UINT i = 0; i &lt; m_nObjects; i++) <br>{ <br> <br>CComQIPtr&lt;IMtsSpy, &amp;IID_IMtsSpy&gt; pSpy(m_ppUnk[i]); <br>BSTR bstr; <br>GetDlgItemText(IDC_LOG_FILE, bstr); <br>pSpy -&gt; put_LogFile(bstr); <br>::SysFreeString(bstr); <br>// grid lines <br>BOOL bVal = (SendDlgItemMessage(IDC_SHOW_GRID_LINES, BM_GETCHECK) == BST_CHECKED); <br>pSpy -&gt; put_ShowGridLines(bVal); <br> <br>// log to file <br>bVal = (SendDlgItemMessage(IDC_LOG_TO_FILE, BM_GETCHECK) == BST_CHECKED); <br>pSpy -&gt; put_LogToFile(bVal); <br> <br>// show on screen <br>bVal = (SendDlgItemMessage(IDC_SHOW_ON_SCREEN, BM_GETCHECK) == BST_CHECKED); <br>pSpy -&gt; put_ShowOnScreen(bVal); <br> <br>int j; <br>UINT nWidth; <br>for (j=0;j&lt;sizeof(szColNames)/sizeof(szColNames[0]);j++) <br>{ <br> <br>nWidth = SendDlgItemMessage(IDC_COLUMN_NAMES, CB_GETITEMDATA, j) ; <br>if (nWidth) <br>{ <br>pSpy -&gt; put_ColWidth(j,nWidth); <br>SendDlgItemMessage(IDC_COLUMN_NAMES, CB_SETITEMDATA, j, 0);  <br>} <br>} <br> <br>} <br>SetDirty(FALSE); <br>m_bDirty = FALSE; <br>return S_OK; <br>} </code></pre>
<p>&nbsp;</p></body>
</HTML>
