<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>RMOPTIONS.H</title>
<link disabled rel=stylesheet href=../../../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>
<h2><a name="_code_context1235"></a>RMOPTIONS.H</h2>
<pre><code><br>/******************************************************************************\ <br>******************************************************************************** <br>* Filename: rmoptions.h <br>* <br>* Description:  <br> <br>Contains a class that encapsulates all options for the CopyFileRm <br>Automatically persists/loads itself to/from the registry <br> <br>* <br>* This file is provided as part of the Microsoft Transaction Server <br>* Software Development Kit <br>* <br>*THIS CODE AND INFORMATION IS PROVIDED "AS IS" WITHOUT  <br>*WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED,  <br>*INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES  <br>*OF MERCHANTABILITY AND/OR FITNESS FOR A  PARTICULAR  <br>*PURPOSE. <br>* <br>* Copyright (C) 1997 Microsoft Corporation, All rights reserved <br>******************************************************************************** <br>\******************************************************************************/ <br>class CRmOptions <br>{ <br>private: <br>HKEY m_hKey; <br>CComBSTR m_sLogDir; <br>CComBSTR m_sRecDir; <br>public: <br> <br>CComBSTR &amp; GetLogDir(){return m_sLogDir;} <br>CComBSTR &amp; GetRecDir(){return m_sRecDir;} <br> <br>BOOL SetLogDir(BSTR sLogDir) <br>{ <br> <br>m_sLogDir = sLogDir; <br>_ASSERTE(m_hKey); <br>if (!m_sLogDir.m_str) <br>{ <br>_ASSERTE(0); <br>return FALSE; <br>} <br> <br>LPTSTR lpszValueName = _T("LogDir"); <br>if (RegSetValueEx(m_hKey, lpszValueName, NULL, REG_SZ, (BYTE *)m_sLogDir.m_str, m_sLogDir.Length() * 2) == 0) <br>return TRUE; <br>return FALSE; <br> <br>} <br> <br>BOOL SetRecDir(BSTR sRecDir) <br>{ <br> <br>m_sRecDir = sRecDir; <br>_ASSERTE(m_hKey); <br>if (!m_sRecDir.m_str) <br>{ <br>_ASSERTE(0); <br>return FALSE; <br>} <br> <br>LPTSTR lpszValueName = _T("RecoverDir"); <br>if (RegSetValueEx(m_hKey, lpszValueName, NULL, REG_SZ, (BYTE *)m_sRecDir.m_str, m_sRecDir.Length() * 2) == 0) <br>return TRUE; <br> <br>return FALSE; <br> <br>} <br> <br> <br>CRmOptions() <br>{ <br>LPTSTR sKey= L"Software\\Microsoft\\CopyFileRm"; <br>DWORD dwDisp; <br>LONG lRes = RegCreateKeyEx( HKEY_CURRENT_USER, sKey, NULL, NULL, REG_OPTION_NON_VOLATILE, KEY_ALL_ACCESS,NULL, &amp;m_hKey, &amp;dwDisp); <br>_ASSERTE(m_hKey); <br>TCHAR szDir[MAX_PATH]; <br>DWORD dw = 0; <br>DWORD dwType = 0; <br>TCHAR* lpszValueName = L"LogDir"; <br>lRes = RegQueryValueEx(m_hKey, (TCHAR*)lpszValueName, NULL, &amp;dwType,  <br>NULL, &amp;dw); <br>if (lRes == ERROR_SUCCESS) <br>{ <br>_ASSERTE(dwType == REG_SZ); <br>TCHAR* lpsz = szDir; <br>lRes = RegQueryValueEx(m_hKey, (TCHAR*)lpszValueName, NULL, &amp;dwType, (BYTE*)lpsz, &amp;dw); <br>_ASSERTE(lRes == ERROR_SUCCESS); <br>} <br>else <br>{ <br>GetTempPath(MAX_PATH, szDir); // if it is not in the registery, put it in the temp directory <br>} <br> <br>m_sLogDir = szDir; <br>dw = 0; <br>dwType = REG_SZ; <br>lpszValueName = L"RecoverDir"; <br>lRes = RegQueryValueEx(m_hKey, (TCHAR*)lpszValueName, NULL, &amp;dwType, NULL, &amp;dw); <br>if (lRes == ERROR_SUCCESS) <br>{ <br>_ASSERTE(dwType == REG_SZ); <br>TCHAR* lpsz = szDir; <br>lRes = RegQueryValueEx(m_hKey, (TCHAR*)lpszValueName, NULL, &amp;dwType, (BYTE*)lpsz, &amp;dw); <br>_ASSERTE(lRes == ERROR_SUCCESS); <br>} <br>else <br>{ <br>GetTempPath(MAX_PATH, szDir); // if it is not in the registery, put it in the temp directory <br> <br>} <br> <br>m_sRecDir = szDir; <br>} <br> <br>~CRmOptions() <br>{ <br>RegCloseKey(m_hKey); <br>} <br> <br>}; </code></pre>
<p>&nbsp;</p></body>
</HTML>
