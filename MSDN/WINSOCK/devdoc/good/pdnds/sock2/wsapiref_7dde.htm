<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>ioctlsocket</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_ioctlsocket_2"></a>ioctlsocket</h1>
<p>
The Windows Sockets <b>ioctlsocket</b> function controls the I/O mode of a socket.</p>
<pre><code><b>int ioctlsocket (
  SOCKET</b><i> s</i><b>,         </b>
<b>  long</b><i> cmd</i><b>,         </b>
<b>  u_long FAR*</b><i> argp  </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>s</i></dt>
<dd>
[in] A descriptor identifying a socket.</dd>
<dt>
<i>cmd</i></dt>
<dd>
[in] The command to perform on the socket <i>s</i>.</dd>
<dt>
<i>argp</i></dt>
<dd>
[in/out] A pointer to a parameter for <i>cmd</i>.
</dd>
</dl>
<h4>Remarks</h4>
<p>
The <b>ioctlsocket</b> function can be used on any socket in any state. It is used to set or retrieve operating parameters associated with the socket, independent of the protocol and communications subsystem. Here are the supported commands to use in the <i>cmd</i> parameter and their semantics:
<dl>
<dt>
FIONBIO</dt>
<dd>
Use with a nonzero <i>argp</i> parameter to enable the nonblocking mode of socket <i>s</i>. The <i>argp</i> parameter is zero if nonblocking is to be disabled. The <i>argp</i> parameter points to an unsigned long value. When a socket is created, it operates in blocking mode by default (nonblocking mode is disabled). This is consistent with BSD sockets.
<p>
The <a href="wsapiref_6jn6.htm"><b>WSAAsyncSelect</b></a> and <a href="wsapiref_34aa.htm"><b>WSAEventSelect</b></a> functions automatically set a socket to nonblocking mode. If <b>WSAAsyncSelect</b> or <b>WSAEventSelect</b> has been issued on a socket, then any attempt to use <b>ioctlsocket</b> to set the socket back to blocking mode will fail with WSAEINVAL. To set the socket back to blocking mode, an application must first disable <b>WSAAsyncSelect</b> by calling <b>WSAAsyncSelect</b> with the <i>lEvent</i> parameter equal to zero, or disable <b>WSAEventSelect</b> by calling <b>WSAEventSelect</b> with the <i>lNetworkEvents</i> parameter equal to zero.
</dd>
<dt>
FIONREAD</dt>
<dd>
Use to determine the amount of data pending in the network's input buffer that can be read from socket <i>s</i>. The <i>argp</i> parameter points to an unsigned long value in which <b>ioctlsocket</b> stores the result. If <i>s</i> is stream oriented (for example, type SOCK_STREAM), FIONREAD returns the amount of data that can be read in a single call to the <a href="wsapiref_2i9e.htm"><b>recv</b></a> function; this might not be the same as the total amount of data queued on the socket. If <i>s</i> is message oriented (for example, type SOCK_DGRAM), FIONREAD returns the size of the first datagram (message) queued on the socket.</dd>
<dt>
SIOCATMARK</dt>
<dd>
Use to determine whether or not all out-of-band data has been read. (See section <a href="ovrvw3_7gfm.htm">Windows Sockets 1.1 Blocking Routines &amp; EINPROGRESS</a> for a discussion on Out of Band (OOB) data.) This applies only to a stream oriented socket (for example, type SOCK_STREAM) that has been configured for in-line reception of any out-of-band data (SO_OOBINLINE). If no out-of-band data is waiting to be read, the operation returns TRUE. Otherwise, it returns FALSE, and the next <a href="wsapiref_2i9e.htm"><b>recv</b></a> or <a href="wsapiref_88oi.htm"><b>recvfrom</b></a> performed on the socket will retrieve some or all of the data preceding the "mark." The application should use the SIOCATMARK operation to determine whether any data remains. If there is any normal data preceding the "urgent" (out of band) data, it will be received in order. (A <b>recv</b> or <b>recvfrom</b> will never mix out-of-band and normal data in the same call.) The <i>argp</i> parameter points to an unsigned long value in which <b>ioctlsocket</b> stores the boolean result.
</dd>
</dl>
<h4>Compatibility</h4>
<p>
This <b>ioctlsocket</b> function performs only a subset of functions on a socket when compared to the <b>ioctl </b>function found in Berkeley sockets. The <b>ioctlsocket</b> function has no command parameter equivalent to the FIOASYNC of <b>ioctl</b>, and SIOCATMARK is the only socket-level command that is supported by <b>ioctlsocket</b>.</p>
<h4>Return Values</h4>
<p>
Upon successful completion, the <b>ioctlsocket</b> returns zero. Otherwise, a value of SOCKET_ERROR is returned, and a specific error code can be retrieved by calling <a href="wsapiref_2tiq.htm"><b>WSAGetLastError</b></a>.</p>
<h4>Error Codes</h4>
<table cellspacing=4 cols=2>
<tr valign=top>
<td width=41%>WSANOTINITIALISED</td>
<td width=59%>A successful <a href="wsapiref_1v8y.htm"><b>WSAStartup</b></a> must occur before using this function.</td>
</tr>
<tr valign=top>
<td width=41%>WSAENETDOWN</td>
<td width=59%>The network subsystem has failed.</td>
</tr>
<tr valign=top>
<td width=41%>WSAEINPROGRESS</td>
<td width=59%>A blocking Windows Sockets 1.1 call is in progress, or the service provider is still processing a callback function.</td>
</tr>
<tr valign=top>
<td width=41%>WSAENOTSOCK</td>
<td width=59%>The descriptor <i>s</i> is not a socket.</td>
</tr>
<tr valign=top>
<td width=41%>WSAEFAULT</td>
<td width=59%>The <i>argp</i> parameter is not a valid part of the user address space.</td>
</tr>
</table><br>
<h4>QuickInfo</h4>
<p>
&nbsp;&nbsp;<b>Windows NT:</b>  Yes<br>
&nbsp;&nbsp;<b>Windows:</b> Yes<br>
&nbsp;&nbsp;<b>Windows CE:</b>  Use version 1.0 and later.<br>
&nbsp;&nbsp;<b>Header:</b> Declared in winsock2.h.<br>
&nbsp;&nbsp;<b>Import Library:</b> Link with ws2_32.lib.</p>
<h4>See Also</h4>
<p>
<a href="wsapiref_8qcy.htm"><b>getsockopt</b></a>, <a href="wsapiref_94aa.htm"><b>setsockopt</b></a>, <a href="wsapiref_2qr6.htm"><b>socket</b></a>, <a href="wsapiref_6jn6.htm"><b>WSAAsyncSelect</b></a>, <a href="wsapiref_34aa.htm"><b>WSAEventSelect</b></a>, <a href="wsapiref_6ik2.htm"><b>WSAIoctl</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
