<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Enhanced Functionality During Connection Setup and Teardown</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_win32_enhanced_functionality_during_connection_setup_and_teardown_2"></a>Enhanced Functionality During Connection Setup and Teardown</h2>
<p>
The <a href="wsapiref_3fn6.htm"><b>WSAAccept</b></a> function lets an application obtain caller information such as caller ID and QOS before deciding whether to accept an incoming connection request. This is done with a callback to an application-supplied condition function.</p>
<p>
User-to-user data specified by parameters in the <a href="wsapiref_8kc2.htm"><b>WSAConnect</b></a> function and the condition function of <b>WSAAccept</b> can be transferred to the peer during connection establishment, provided this feature is supported by the service provider.</p>
<p>
It is also possible (for protocols that support this) to exchange user data between the endpoints at connection teardown time. The end that initiates the teardown can call the <a href="wsapiref_0kqa.htm"><b>WSASendDisconnect</b></a> function to indicate that no more data be sent and to initiate the connection teardown sequence. For certain protocols, part of this teardown sequence is the delivery of disconnect data from the teardown initiator. After receiving notice that the remote end has initiated the teardown sequence (typically by the FD_CLOSE indication), the <a href="wsapiref_5ysy.htm"><b>WSARecvDisconnect</b></a> function can be called to receive the disconnect data, if any.</p>
<p>
To illustrate how disconnect data can be used, consider the following scenario. The client half of a client/server application is responsible for terminating a socket connection. Coincident with the termination, it provides (using disconnect data) the total number of transactions it processed with the server. The server in turn responds with the cumulative total of transactions that it has processed with all clients. The sequence of calls and indications might occur as follows:</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=48%>Client Side</th>
<th align=left width=52%>Server Side</th>
</tr>
<tr valign=top>
<td width=48%>(1) Invoke <a href="wsapiref_0kqa.htm"><b>WSASendDisconnect</b></a> to conclude session and supply transaction total</td>
<td width=52%></td>
</tr>
<tr valign=top>
<td width=48%></td>
<td width=52%>(2) Get FD_CLOSE, <b>recv</b> with a return value of zero, or <a href="errors_0oaa.htm#_win32_wsaediscon_2">WSAEDISCON</a> error return from <a href="wsapiref_4z1u.htm"><b>WSARecv</b></a> indicating graceful shutdown in progress</td>
</tr>
<tr valign=top>
<td width=48%></td>
<td width=52%>(3) Invoke <a href="wsapiref_5ysy.htm"><b>WSARecvDisconnect</b></a> to get client's transaction total</td>
</tr>
<tr valign=top>
<td width=48%></td>
<td width=52%>(4) Compute cumulative grand total of all transactions</td>
</tr>
<tr valign=top>
<td width=48%></td>
<td width=52%>(5) Invoke <b>WSASendDisconnect</b> to transmit grand total</td>
</tr>
<tr valign=top>
<td width=48%>(6) Receive FD_CLOSE indication</td>
<td width=52%>(5a) Invoke closesocket</td>
</tr>
<tr valign=top>
<td width=48%>(7) Invoke <b>WSARecvDisconnect</b> to receive and store cumulative grand total of transactions</td>
<td width=52%></td>
</tr>
<tr valign=top>
<td width=48%>(8) Invoke <a href="wsapiref_714i.htm"><b>closesocket</b></a></td>
<td width=52%></td>
</tr>
</table><br>
<p>
Note that step (5a) must follow step (5), but has no timing relationship with step (6), (7), or (8).</p>
<p>&nbsp;</p></body>
</HTML>
