<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>WSPEventSelect</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_wspeventselect_2"></a>WSPEventSelect</h1>
<p>
The <b>WSPEventSelect</b> function specifies an event object to be associated with the supplied set of network events.</p>
<pre><code><b>int WSPEventSelect (
  SOCKET</b><i> s</i><b>,</b>              
<b>  WSAEVENT</b><i> hEventObject</i><b>,</b>   
<b>  long</b><i> lNetworkEvents</i><b>,</b>   
<b>  LPINT</b><i> lpErrno</i>          
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>s</i></dt>
<dd>
[in] A descriptor identifying the socket.</dd>
<dt>
<i>hEventObject</i></dt>
<dd>
[in] A handle identifying the event object to be associated with the supplied set of network events.</dd>
<dt>
<i>lNetworkEvents</i></dt>
<dd>
[in] A bitmask which specifies the combination of network events in which the Windows Sockets SPI client has interest.</dd>
<dt>
<i>lpErrno</i></dt>
<dd>
[out] A pointer to the error code.
</dd>
</dl>
<h4>Remarks</h4>
<p>
This function is used to specify an event object, <i>hEventObject</i>, to be associated with the selected network events, <i>lNetworkEvents</i>. The socket for which an event object is specified is identified by <i>s</i>. The event object is set when any of the nominated network events occur.</p>
<p>
<b>WSPEventSelect</b> operates very similarly to <a href="wsspiref_74du.htm"><b>WSPAsyncSelect</b></a>, the difference being in the actions taken when a nominated network event occurs. Whereas <b>WSPAsyncSelect</b> causes a Windows Sockets SPI client-specified Windows message to be posted, <b>WSPEventSelect</b> sets the associated event object and records the occurrence of this event in an internal network event record. A Windows Sockets SPI client can use <a href="wsspiref_2rjm.htm"><b>WSPEnumNetworkEvents</b></a> to retrieve the contents of the internal network event record and thus determine which of the nominated network events have occurred.</p>
<p>
<b>WSPEventSelect</b> is the only function that causes network activity and errors to be recorded and retrievable through <b>WSPEnumNetworkEvents</b>. See the descriptions of <a href="wsspiref_2q2a.htm"><b>WSPSelect</b></a> and <a href="wsspiref_74du.htm"><b>WSPAsyncSelect</b></a> to find out how those functions report network activity and errors.</p>
<p>
This function automatically sets socket <i>s</i> to nonblocking mode, regardless of the value of <i>lNetworkEvents</i>.</p>
<p>
The <i>lNetworkEvents</i> parameter is constructed by OR'ing any of the values specified in the following list.</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=41%>Value</th>
<th align=left width=59%>Meaning</th>
</tr>
<tr valign=top>
<td width=41%>FD_READ</td>
<td width=59%>Issue notification of readiness for reading</td>
</tr>
<tr valign=top>
<td width=41%>FD_WRITE</td>
<td width=59%>Issue notification of readiness for writing</td>
</tr>
<tr valign=top>
<td width=41%>FD_OOB</td>
<td width=59%>Issue notification of the arrival of out-of-band data</td>
</tr>
<tr valign=top>
<td width=41%>FD_ACCEPT</td>
<td width=59%>Issue notification of incoming connections</td>
</tr>
<tr valign=top>
<td width=41%>FD_CONNECT</td>
<td width=59%>Issue notification of completed connection</td>
</tr>
<tr valign=top>
<td width=41%>FD_CLOSE</td>
<td width=59%>Issue notification of socket closure</td>
</tr>
<tr valign=top>
<td width=41%>FD_QOS</td>
<td width=59%>Issue notification of socket Quality of Service (QOS) changes</td>
</tr>
<tr valign=top>
<td width=41%>FD_GROUP_QOS</td>
<td width=59%>Reserved for future use with socket groups: Issue notification of socket group Quality of Service (QOS) changes</td>
</tr>
<tr valign=top>
<td width=41%>FD_ROUTING<br>
_INTERFACE_CHANGE</td>
<td width=59%>Issue notification of routing interface changes for the specified destination(s)</td>
</tr>
<tr valign=top>
<td width=41%>FD_ADDRESS_LIST<br>
_CHANGE</td>
<td width=59%>Issue notification of local address list changes for the socket's address family</td>
</tr>
</table><br>
<p>
Issuing a <b>WSPEventSelect</b> for a socket cancels any previous <a href="wsspiref_74du.htm"><b>WSPAsyncSelect</b></a> or <b>WSPEventSelect</b> for the same socket and clears the internal network event record. For example, to associate an event object with both reading and writing network events, the Windows Sockets SPI client must call <b>WSPEventSelect</b> with both FD_READ and FD_WRITE, as follows:</p>
<pre><code>rc = WSPEventSelect(s, hEventObject, FD_READ|FD_WRITE);\
 </code></pre>
<p>
It is not possible to specify different event objects for different network events. The following code will <i>not</i> work; the second call will cancel the effects of the first, and only FD_WRITE network event will be associated with hEventObject2:</p>
<pre><code>rc = WSPEventSelect(s, hEventObject1, FD_READ);
rc = WSPEventSelect(s, hEventObject2, FD_WRITE);   //bad
 </code></pre>
<p>
To cancel the association and selection of network events on a socket, <i>lNetworkEvents</i> should be set to zero, in which case the <i>hEventObject</i> parameter will be ignored.</p>
<pre><code>rc = WSPEventSelect(s, hEventObject, 0);
 </code></pre>
<p>
Closing a socket with <a href="wsspiref_533m.htm"><b>WSPCloseSocket</b></a> also cancels the association and selection of network events specified in <b>WSPEventSelect</b> for the socket. The Windows Sockets SPI client, however, still must call <b>WSACloseEvent</b> to explicitly close the event object and free any resources.</p>
<p>
Since an accepted (<a href="wsspiref_2j1u.htm"><b>WSPAccept</b></a><b>)</b> socket has the same properties as the listening socket used to accept it, any <b>WSPEventSelect</b> association and network events selection set for the listening socket apply to the accepted socket. For example, if a listening socket has <b>WSPEventSelect</b> association of <i>hEventOject</i> with FD_ACCEPT, FD_READ, and FD_WRITE, then any socket accepted on that listening socket will also have FD_ACCEPT, FD_READ, and FD_WRITE network events associated with the same <i>hEventObject</i>. If a different <i>hEventObject</i> or network events are needed, the Windows Sockets SPI client should call <b>WSPEventSelect</b>, passing the accepted socket and the new information.</p>
<h4>Return Values</h4>
<p>
The return value is zero if the Windows Sockets SPI client's specification of the network events and the associated event object was successful. Otherwise, the value SOCKET_ERROR is returned, and a specific error number is available in <i>lpErrno</i>.</p>
<h4>Comments</h4>
<p>
Having successfully recorded the occurrence of the network event and signaled the associated event object, no further actions are taken for that network event until the Windows Sockets SPI client makes the function call which implicitly re-enables the setting of that network event and signaling of the associated event object.</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=41%>Network Event</th>
<th align=left width=59%>Re-enabling function</th>
</tr>
<tr valign=top>
<td width=41%>FD_READ</td>
<td width=59%><a href="wsspiref_854i.htm"><b>WSPRecv</b></a> or <a href="wsspiref_6lbm.htm"><b>WSPRecvFrom</b></a></td>
</tr>
<tr valign=top>
<td width=41%>FD_WRITE</td>
<td width=59%><a href="wsspiref_2dpu.htm"><b>WSPSend</b></a> or <a href="wsspiref_68he.htm"><b>WSPSendTo</b></a></td>
</tr>
<tr valign=top>
<td width=41%>FD_OOB</td>
<td width=59%><b>WSPRecv</b> or <b>WSPRecvFrom</b></td>
</tr>
<tr valign=top>
<td width=41%>FD_ACCEPT</td>
<td width=59%><a href="wsspiref_2j1u.htm"><b>WSPAccept</b></a> unless the error code returned is WSATRY_AGAIN indicating that the condition function returned CF_DEFER</td>
</tr>
<tr valign=top>
<td width=41%>FD_CONNECT</td>
<td width=59%>NONE</td>
</tr>
<tr valign=top>
<td width=41%>FD_CLOSE</td>
<td width=59%>NONE</td>
</tr>
<tr valign=top>
<td width=41%>FD_QOS</td>
<td width=59%><a href="wsspiref_9baq.htm"><b>WSPIoctl</b></a> with SIO_QOS</td>
</tr>
<tr valign=top>
<td width=41%>FD_GROUP_QOS</td>
<td width=59%>Reserved for future use with socket groups: <b>WSPIoctl</b> with SIO_GROUP_QOS</td>
</tr>
<tr valign=top>
<td width=41%>FD_ROUTING<br>
_INTERFACE_CHANGE</td>
<td width=59%><b>WSPIoctl</b> with command SIO_ROUTING_INTERFACE_CHANGE</td>
</tr>
<tr valign=top>
<td width=41%>FD_ADDRESS_LIST<br>
_CHANGE</td>
<td width=59%><b>WSPIoctl</b> with command SIO_ADDRESS_LIST_CHANGE</td>
</tr>
</table><br>
<p>
Any call to the re-enabling routine, even one which fails, results in re-enabling of recording and signaling for the relevant network event and event object, respectively.</p>
<p>
For FD_READ, FD_OOB, and FD_ACCEPT network events, network event recording and event object signaling are "level-triggered." This means that if the re-enabling routine is called and the relevant network condition is still valid after the call, the network event is recorded and the associated event object is signaled. This allows a Windows Sockets SPI client to be event-driven and not be concerned with the amount of data that arrives at any one time. Consider the following sequence:
<ol>
<li>
Service provider receives 100 bytes of data on socket <b>s</b>, records the FD_READ network event and signals the associated event object.</li>
<li>
The Windows Sockets SPI client issues <a href="wsspiref_854i.htm"><b>WSPRecv</b></a>( s, buffptr, 50, 0) to read 50 bytes.</li>
<li>
The service provider records the FD_READ network event and signals the associated event object again since there is still data to be read.</li>
</ol>
<p>
With these semantics, a Windows Sockets SPI client need not read all available data in response to an FD_READ network event—a single <a href="wsspiref_854i.htm"><b>WSPRecv</b></a> in response to each FD_READ network event is appropriate.</p>
<p>
The FD_QOS and FD_GROUP_QOS events are considered edge triggered. A message will be posted exactly once when a QOS change occurs. Further indications will <i>not</i> be issued until either the service provider detects a further change in QOS or the Windows Sockets SPI client renegotiates the QOS for the socket.</p>
<p>
The FD_ROUTING_INTERFACE_CHANGE and FD_ADDRESS_LIST_CHANGE events are considered "edge triggered" as well. A message will be posted exactly once when a change occurs AFTER the Windows Socket SPI client has request the notification by issuing <b>WSAIoctl</b> with SIO_ROUTING_INTERFACE_CHANGE or SIO_ADDRESS_LIST_CHANGE correspondingly.. Further messages will not be forthcoming until the SPI client reissues the IOCTL AND another change is detected since the IOCTL has been issued.</p>
<p>
If a network event has already happened when the Windows Sockets SPI client calls <b>WSPEventSelect</b> or when the re-enabling function is called, then a network event is recorded and the associated event object is signaled as appropriate. For example, consider the following sequence: 
<ol>
<li>
A Windows Sockets SPI client calls <a href="wsspiref_1n8y.htm"><b>WSPListen</b></a></li>
<li>
A connect request is received but not yet accepted</li>
<li>
The Windows Sockets SPI client calls <b>WSPEventSelect </b>specifying that it is interested in the FD_ACCEPT network event for the socket. The service provider records the FD_ACCEPT network event and signals the associated event object immediately.</li>
</ol>
<p>
The FD_WRITE network event is handled slightly differently. An FD_WRITE network event is recorded when a socket is first connected with <a href="wsspiref_0meq.htm"><b>WSPConnect</b></a> or accepted with <a href="wsspiref_2j1u.htm"><b>WSPAccept</b></a>, and then after a <a href="wsspiref_2dpu.htm"><b>WSPSend</b></a> or <a href="wsspiref_68he.htm"><b>WSPSendTo</b></a> fails with WSAEWOULDBLOCK and buffer space becomes available. Therefore, a Windows Sockets SPI client can assume that sends are possible starting from the first FD_WRITE network event setting and lasting until a send returns WSAEWOULDBLOCK. After such a failure the Windows Sockets SPI client will find out that sends are again possible when an FD_WRITE network event is recorded and the associated event object is signaled.</p>
<p>
The FD_OOB network event is used only when a socket is configured to receive out-of-band data separately. If the socket is configured to receive out-of-band data in-line, the out-of-band (expedited) data is treated as normal data and the Windows Sockets SPI client should register an interest in, and will get, FD_READ network event, not FD_OOB network event. A Windows Sockets SPI client can set or inspect the way in which out-of-band data is to be handled by using <a href="wsspiref_5hte.htm"><b>WSPSetSockOpt</b></a> or <a href="wsspiref_53w2.htm"><b>WSPGetSockOpt</b></a> for the SO_OOBINLINE option.</p>
<p>
The error code in an FD_CLOSE network event indicates whether the socket close was graceful or abortive. If the error code is zero, then the close was graceful; if the error code is WSAECONNRESET, then the socket's virtual circuit was reset. This only applies to connection-oriented sockets such as SOCK_STREAM.</p>
<p>
The FD_CLOSE network event is recorded when a close indication is received for the virtual circuit corresponding to the socket. In TCP terms, this means that the FD_CLOSE is recorded when the connection goes into the FIN WAIT or CLOSE WAIT states. This results from the remote end performing a <a href="wsspiref_4dma.htm"><b>WSPShutdown</b></a> on the send side or a <a href="wsspiref_533m.htm"><b>WSPCloseSocket</b></a>.</p>
<p>
Service providers shall record ONLY an FD_CLOSE network event to indicate closure of a virtual circuit, they shall <i>not</i> record an FD_READ network event to indicate this condition.</p>
<p>
The FD_QOS or FD_GROUP_QOS network event is recorded when any field in the flow specification associated with socket <i>s</i> or the socket group that <i>s</i> belongs to has changed, respectively. This change must be made available to Windows Sockets SPI clients through the <a href="wsspiref_9baq.htm"><b>WSPIoctl</b></a> function with SIO_GET_QOS and/or SIO_GET_GROUP_QOS to retrieve the current QOS for socket <i>s</i> or for the socket group <i>s</i> belongs to, respectively.</p>
<p>
The FD_ROUTING_INTERFACE_CHANGE nework event is recorded when the local interface that should be used to reach the destination specified in <b>WSAIoctl</b> with SIO_ROUTING_INTERFACE_CHANGE changes AFTER such IOCTL has been issued.</p>
<p>
The FD_ADDRESS_LIST_CHANGE network event is recorded when the list of addresses of socket's protocol family to which the Windows Socket SPI client can bind changes <i>after</i> <b>WSAIoctl</b> with SIO_ADDRESS_LIST_CHANGE has been issued.</p>
<h4>Error Codes</h4>
<table cellspacing=4 cols=2>
<tr valign=top>
<td width=37%>WSAENETDOWN</td>
<td width=63%>The network subsystem has failed.</td>
</tr>
<tr valign=top>
<td width=37%>WSAEINVAL</td>
<td width=63%>Indicates that one of the specified parameters was invalid, or the specified socket is in an invalid state.</td>
</tr>
<tr valign=top>
<td width=37%>WSAEINPROGRESS</td>
<td width=63%>A blocking Windows Sockets call is in progress, or the service provider is still processing a callback function.</td>
</tr>
<tr valign=top>
<td width=37%>WSAENOTSOCK</td>
<td width=63%>The descriptor is not a socket.</td>
</tr>
</table><br>
<h4>QuickInfo</h4>
<p>
&nbsp;&nbsp;<b>Windows NT:</b>  Yes<br>
&nbsp;&nbsp;<b>Windows:</b> Yes<br>
&nbsp;&nbsp;<b>Windows CE:</b>  Unsupported.<br>
&nbsp;&nbsp;<b>Header:</b> Declared in ws2spi.h.</p>
<h4>See Also</h4>
<p>
<a href="wsspiref_2rjm.htm"><b>WSPEnumNetworkEvents</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
