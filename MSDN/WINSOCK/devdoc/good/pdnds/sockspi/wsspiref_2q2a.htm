<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>WSPSelect</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_wspselect_2"></a>WSPSelect</h1>
<p>
The <b>WSPSelect</b> function determines the status of one or more sockets.</p>
<pre><code><b>int WSPSelect (
  int</b><i> nfds</i><b>,</b>                             
<b>  fd_set FAR *</b><i> readfds</i><b>,</b>                 
<b>  fd_set FAR *</b><i> writefds</i><b>,</b>                
<b>  fd_set FAR *</b><i> exceptfds</i><b>,</b>               
<b>  const struct timeval FAR *</b><i> timeout</i><b>,</b>   
<b>  LPINT</b><i> lpErrno                         </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>nfds</i></dt>
<dd>
[in] This argument is ignored and included only for the sake of compatibility.</dd>
<dt>
<i>readfds</i></dt>
<dd>
[in/out] An optional pointer to a set of sockets to be checked for readability.</dd>
<dt>
<i>writefds</i></dt>
<dd>
[in/out] An optional pointer to a set of sockets to be checked for writability</dd>
<dt>
<i>exceptfds</i></dt>
<dd>
[in/out] An optional pointer to a set of sockets to be checked for errors.</dd>
<dt>
<i>timeout</i></dt>
<dd>
[in] The maximum time for <b>WSPSelect</b> to wait, or NULL for a blocking operation.</dd>
<dt>
<i>lpErrno</i></dt>
<dd>
[out] A pointer to the error code.
</dd>
</dl>
<h4>Remarks</h4>
<p>
This function is used to determine the status of one or more sockets. For each socket, the caller can request information on read, write or error status. The set of sockets for which a given status is requested is indicated by an fd_set structure. All entries in an fd_set correspond to sockets created by the service provider (that is, the <b>WSAPROTOCOL_INFOW</b> structures describing their protocols have the same <i>providerId</i> value). Upon return, the structures are updated to reflect the subset of these sockets which meet the specified condition, and <b>WSPSelect</b> returns the total number of sockets meeting the conditions. A set of macros is provided for manipulating an fd_set. These macros are compatible with those used in the Berkeley software, but the underlying representation is completely different.</p>
<p>
The parameter <i>readfds</i> identifies those sockets which are to be checked for readability. If the socket is currently <b>WSPListen</b>ing, it will be marked as readable if an incoming connection request has been received, so that a <b>WSPAccept</b> is guaranteed to complete without blocking. For other sockets, readability means that queued data is available for reading so that a <b>WSPRecv</b> or <b>WSPRecvfrom</b> is guaranteed not to block.</p>
<p>
For connection-oriented sockets, readability can also indicate that a close request has been received from the peer. If the virtual circuit was closed gracefully, then a <b>WSPRecv</b> will return immediately with zero bytes read. If the virtual circuit was reset, then a <b>WSPRecv</b> will complete immediately with an error code, such as WSAECONNRESET. The presence of out-of-band data will be checked if the socket option SO_OOBINLINE has been enabled (see <b>WSPSetSockOpt</b>).</p>
<p>
The parameter <i>writefds</i> identifies those sockets which are to be checked for writability. If a socket is <b>WSPConnect</b>ing, writability means that the connection establishment successfully completed. If the socket is not in the process of <b>WSPConnect</b>ing, writability means that a <b>WSPSend</b> or <b>WSPSendTo</b> are guaranteed to succeed. However, they can block on a blocking socket if the <i>len</i> exceeds the amount of outgoing system buffer space available. [It is not specified how long these guarantees can be assumed to be valid, particularly in a multithreaded environment.]</p>
<p>
The parameter <i>exceptfds</i> identifies those sockets which are to be checked for the presence of out-of-band data or any exceptional error conditions. Note that out-of-band data will only be reported in this way if the option SO_OOBINLINE is FALSE. If a socket is <b>WSPConnect</b>ing (nonblocking), failure of the connect attempt is indicated in <i>exceptfds.</i> This specification does not define which other errors will be included.</p>
<p>
Any two of <i>readfds</i>, <i>writefds</i>, or <i>exceptfds</i> can be given as NULL if no descriptors are to be checked for the condition of interest. At least one must be non-NULL, and any non-NULL descriptor set must contain at least one socket descriptor.</p>
<p>
Summary: A socket will be identified in a particular set when <b>WSPSelect</b> returns if:</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<td width=20%><i>readfds</i>:</td>
<td width=80%>If WSPListening, a connection is pending, WSPAccept will succeed<p>
Data is available for reading (includes OOB data if SO_OOBINLINE is enabled)</p>
<p>
Connection has been closed/reset/terminated</p>
</td>
</tr>
<tr valign=top>
<td width=20%><i>writefds</i>:</td>
<td width=80%>If WSPConnecting (nonblocking), connection has succeeded<p>
Data can be sent</p>
</td>
</tr>
<tr valign=top>
<td width=20%><i>exceptfds</i>:</td>
<td width=80%>If WSPConnecting (nonblocking), connection attempt failed<p>
OOB data is available for reading (only if SO_OOBINLINE is disabled)</p>
</td>
</tr>
</table><br>
<p>
Three macros and one upcall function are defined in the header file <b>ws2spi.h</b> for manipulating and checking the descriptor sets. The variable FD_SETSIZE determines the maximum number of descriptors in a set. (The default value of FD_SETSIZE is 64, which can be modified by #defining FD_SETSIZE to another value before #including <b>ws2spi.h</b>.) Internally, socket handles in a fd_set are not represented as bit flags as in Berkeley Unix. Their data representation is opaque. Use of these macros will maintain software portability between different socket environments. The macros to manipulate and check fd_set contents are:
<dl>
<dt>
<b>FD_CLR(</b><i>s</i><b>, </b>*<i>set</i><b>)</b></dt>
<dd>
Removes the descriptor <i>s</i> from <i>set</i>.</dd>
<dt>
<b>FD_SET(</b><i>s</i><b>, </b>*<i>set</i><b>)</b></dt>
<dd>
Adds descriptor <i>s</i> to <i>set</i>.</dd>
<dt>
<b>FD_ZERO(</b>*<i>set</i><b>)</b></dt>
<dd>
Initializes the <i>set</i> to the NULL set.
</dd>
</dl>
<p>
The upcall function used to check the membership is:
<dl>
<dt>
<b>int</b> <b>WPUFDIsSet (</b> <b>SOCKET</b> <i>s</i>, <b>FD_SET FAR *</b> <i>set</i> <b>)</b>;</dt>
<dd>
which will return nonzero if <i>s</i> is a member of the <i>set</i> or otherwise zero.
</dd>
</dl>
<p>
The parameter <i>timeout</i> controls how long the <b>WSPSelect</b> can take to complete. If <i>timeout</i> is a null pointer, <b>WSPSelect</b> will block indefinitely until at least one descriptor meets the specified criteria. Otherwise, <i>timeout</i> points to a struct timeval which specifies the maximum time that <b>WSPSelect</b> should wait before returning. When <b>WSPSelect</b> returns, the contents of the struct timeval are not altered. If the timeval is initialized to {0, 0}, <b>WSPSelect</b> will return immediately; this is used to "poll" the state of the selected sockets. If this is the case, then the <b>WSPSelect</b> call is considered nonblocking and the standard assumptions for nonblocking calls apply. For example, the blocking hook will <i>not</i> be called, and the Windows Sockets provider will <i>not</i> yield.</p>
<h4>Return Values</h4>
<p>
<b>WSPSelect</b> returns the total number of descriptors which are ready and contained in the fd_set structures, or SOCKET_ERROR if an error occurred. If the return value is SOCKET_ERROR, a specific error code is available in <i>lpErrno</i>.</p>
<h4>Comments</h4>
<p>
<b>WSPSelect</b> has no effect on the persistence of socket events registered with <b>WSPAsyncSelect</b> or <b>WSPEventSelect</b>.</p>
<h4>Error Codes</h4>
<table cellspacing=4 cols=2>
<tr valign=top>
<td width=38%>WSAEFAULT</td>
<td width=62%>The Windows Sockets service provider was unable to allocated needed resources for its internal operations, or the <i>readfds</i>, <i>writefds</i>, <i>exceptfds</i> or <i>timeval</i> parameters are not part of the user address space.</td>
</tr>
<tr valign=top>
<td width=38%>WSAENETDOWN</td>
<td width=62%>The network subsystem has failed.</td>
</tr>
<tr valign=top>
<td width=38%>WSAEINVAL</td>
<td width=62%>The <i>timeout</i> value is not valid, or all three descriptor parameters were NULL.</td>
</tr>
<tr valign=top>
<td width=38%>WSAEINTR</td>
<td width=62%>The (blocking) call was canceled through <b>WSPCancelBlockingCall</b>.</td>
</tr>
<tr valign=top>
<td width=38%>WSAEINPROGRESS</td>
<td width=62%>A blocking Windows Sockets call is in progress, or the service provider is still processing a callback function.</td>
</tr>
<tr valign=top>
<td width=38%>WSAENOTSOCK</td>
<td width=62%>One of the descriptor sets contains an entry which is not a socket.</td>
</tr>
</table><br>
<h4>QuickInfo</h4>
<p>
&nbsp;&nbsp;<b>Windows NT:</b>  Yes<br>
&nbsp;&nbsp;<b>Windows:</b> Yes<br>
&nbsp;&nbsp;<b>Windows CE:</b>  Unsupported.<br>
&nbsp;&nbsp;<b>Header:</b> Declared in ws2spi.h.</p>
<h4>See Also</h4>
<p>
<a href="wsspiref_2j1u.htm"><b>WSPAccept</b></a>, <a href="wsspiref_0meq.htm"><b>WSPConnect</b></a>, <a href="wsspiref_854i.htm"><b>WSPRecv</b></a>, <a href="wsspiref_6lbm.htm"><b>WSPRecvFrom</b></a>, <a href="wsspiref_2dpu.htm"><b>WSPSend</b></a>, <a href="wsspiref_68he.htm"><b>WSPSendTo</b></a>, <a href="wsspiref_3p0y.htm"><b>WSPEventSelect</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
