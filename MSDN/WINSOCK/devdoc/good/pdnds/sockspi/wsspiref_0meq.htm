<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>WSPConnect</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_wspconnect_2"></a>WSPConnect</h1>
<p>
The <b>WSPConnect</b> function establishes a connection to a peer, exchanges connect data, and specifies needed quality of service based on the supplied flow specification.</p>
<pre><code><b>int WSPConnect (
  SOCKET</b><i> s</i><b>,</b>                           
<b>  const struct sockaddr FAR *</b><i> name</i><b>,</b>   
<b>  int</b><i> namelen</i><b>,</b>                        
<b>  LPWSABUF</b><i> lpCallerData</i><b>,</b>              
<b>  LPWSABUF</b><i> lpCalleeData</i><b>,</b>              
<b>  LPQOS</b><i> lpSQOS</i><b>,</b>                       
<b>  LPQOS</b><i> lpGQOS</i><b>,</b>                       
<b>  LPINT</b><i> lpErrno                       </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>s</i></dt>
<dd>
[in] A descriptor identifying an unconnected socket.</dd>
<dt>
<i>name</i></dt>
<dd>
[in] The name of the peer to which the socket is to be connected.</dd>
<dt>
<i>namelen</i></dt>
<dd>
[in] The length of the <i>name</i>.</dd>
<dt>
<i>lpCallerData</i></dt>
<dd>
[in] A pointer to the user data that is to be transferred to the peer during connection establishment.</dd>
<dt>
<i>lpCalleeData</i></dt>
<dd>
[out] A pointer to a buffer into which any user data received from the peer during connection establishment can be copied.</dd>
<dt>
<i>lpSQOS</i></dt>
<dd>
[in] A pointer to the flow specifications for socket <i>s</i>, one for each direction.</dd>
<dt>
<i>lpGQOS</i></dt>
<dd>
[in] Reserved for future use with socket groups: A pointer to the flow specifications for the socket group (if applicable).</dd>
<dt>
<i>lpErrno</i></dt>
<dd>
[out] A pointer to the error code.
</dd>
</dl>
<h4>Remarks</h4>
<p>
This function is used to create a connection to the specified destination, and to perform a number of other ancillary operations that occur at connect time as well. If the socket, <i>s</i>, is unbound, unique values are assigned to the local association by the system, and the socket is marked as bound.</p>
<p>
For connection-oriented sockets (for example, type SOCK_STREAM), an active connection is initiated to the specified host using <i>name</i> (an address in the name space of the socket; for a detailed description, please see <a href="wsspiref_2iuq.htm"><b>WSPBind</b></a>). When this call completes successfully, the socket is ready to send/receive data. If the address field of the <i>name</i> structure is all zeroes, <b>WSPConnect</b> will return the error WSAEADDRNOTAVAIL. Any attempt to re-connect an active connection will fail with the error code WSAEISCONN.</p>
<p>
For connection-oriented, nonblocking sockets it is often not possible to complete the connection immediately. In such a case, this function returns with the error WSAEWOULDBLOCK but the operation proceeds. When the success or failure outcome becomes known, it may be reported in one of several ways depending on how the client registers for notification. If the client uses <a href="wsspiref_2q2a.htm"><b>WSPSelect</b></a> success is reported in the <i>writefds</i> set and failure is reported in the <i>exceptfds</i> set. If the client uses <a href="wsspiref_74du.htm"><b>WSPAsyncSelect</b></a> or <a href="wsspiref_3p0y.htm"><b>WSPEventSelect</b></a>, the notification is announced with FD_CONNECT and the error code associated with the FD_CONNECT indicates either success or a specific reason for failure.</p>
<p>
For a connectionless socket (for example, type SOCK_DGRAM), the operation performed by <b>WSPConnect</b> is to establish a default destination address so that the socket can be used with subsequent connection-oriented send and receive operations <b>(<a href="wsspiref_2dpu.htm">WSPSend</a></b>,<a href="wsspiref_854i.htm"><b>WSPRecv</b></a><b>)</b>. Any datagrams received from an address other than the destination address specified will be discarded. If the address field of the <i>name</i> structure is all zeroes, the socket will be "dis-connected" — the default remote address will be indeterminate, so <a href="wsspiref_2dpu.htm"><b>WSPSend</b></a> and <a href="wsspiref_854i.htm"><b>WSPRecv</b></a> calls will return the error code WSAENOTCONN, although <a href="wsspiref_68he.htm"><b>WSPSendTo</b></a> and <a href="wsspiref_6lbm.htm"><b>WSPRecvFrom</b></a> can still be used. The default destination can be changed by simply calling <b>WSPConnect</b> again, even if the socket is already "connected". Any datagrams queued for receipt are discarded if <i>name</i> is different from the previous <b>WSPConnect</b>.</p>
<p>
For connectionless sockets, <i>name</i> can indicate any valid address, including a broadcast address. However, to connect to a broadcast address, a socket must have <a href="wsspiref_5hte.htm"><b>WSPSetSockOpt</b></a> SO_BROADCAST enabled. Otherwise, <b>WSPConnect</b> will fail with the error code WSAEACCES.</p>
<p>
On connectionless sockets, exchange of user to user data is not possible and the corresponding parameters will be silently ignored.</p>
<p>
The Windows Sockets SPI client is responsible for allocating any memory space pointed to directly or indirectly by any of the parameters it specifies.</p>
<p>
The <i>lpCallerData</i> is a value parameter which contains any user data that is to be sent along with the connection request. If <i>lpCallerData</i> is NULL, no user data will be passed to the peer. The <i>lpCalleeData</i> is a result parameter which will reference any user data passed back from the peer as part of the connection establishment. <i>lpCalleeData-&gt;len</i> initially contains the length of the buffer allocated by the Windows Sockets SPI client and pointed to by <i>lpCalleeData-&gt;buf</i>. <i>lpCalleeData-&gt;len</i> will be set to zero if no user data has been passed back. The <i>lpCalleeData </i>information will be valid when the connection operation is complete. For blocking sockets, this will be when the <b>WSPConnect</b> function returns. For nonblocking sockets, this will be after the FD_CONNECT notification has occurred. If <i>lpCalleeData</i> is NULL, no user data will be passed back. The exact format of the user data is specific to the address family to which the socket belongs and/or the applications involved.</p>
<p>
At connect time, a Windows Sockets SPI client can use the <i>lpSQOS</i> and/or <i>lpGQOS</i> parameters to override any previous QOS specification made for the socket through <a href="wsspiref_9baq.htm"><b>WSPIoctl</b></a> with either the SIO_SET_QOS or SIO_SET_GROUP_QOS opcodes.</p>
<p>
<i>lpSQOS</i> specifies the flow specifications for socket <i>s</i>, one for each direction, followed by any additional provider-specific parameters. If either the associated transport provider in general or the specific type of socket in particular cannot honor the QOS request, an error will be returned as indicated below. The sending or receiving flow specification values will be ignored, respectively, for any unidirectional sockets. If no provider-specific parameters are supplied, the <i>buf</i> and <i>len</i> fields of <i>lpSQOS-&gt;ProviderSpecific</i> should be set to NULL and zero, respectively. A NULL value for <i>lpSQOS</i> indicates no application supplied QOS.</p>
<p>
Reserved for future use with socket groups: <i>lpGQOS</i> specifies the flow specifications for the socket group (if applicable), one for each direction, followed by any additional provider-specific parameters. If no provider-specific parameters are supplied, the <i>buf</i> and <i>len</i> fields of <i>lpGQOS-&gt;ProviderSpecific</i> should be set to NULL and zero, respectively. A NULL value for <i>lpGQOS</i> indicates no application-supplied group QOS. This parameter will be ignored if <i>s</i> is not the creator of the socket group.</p>
<h4>Comments</h4>
<p>
When connected sockets break (that is, become closed for whatever reason), they should be discarded and recreated. It is safest to assume that when things go awry for any reason on a connected socket, the Windows Sockets SPI client must discard and recreate the needed sockets in order to return to a stable point.</p>
<h4>Return Values</h4>
<p>
If no error occurs, <b>WSPConnect</b> returns zero. Otherwise, it returns SOCKET_ERROR, and a specific error code is available in <i>lpErrno</i>.</p>
<p>
On a blocking socket, the return value indicates success or failure of the connection attempt. If the return error code indicates the connection attempt failed (that is, WSAECONNREFUSED, WSAENETUNREACH, WSAETIMEDOUT) the Windows Sockets SPI client can call <b>WSPConnect</b> again for the same socket.</p>
<h4>Error Codes</h4>
<table cellspacing=4 cols=2>
<tr valign=top>
<td width=41%>WSAENETDOWN</td>
<td width=59%>The network subsystem has failed.</td>
</tr>
<tr valign=top>
<td width=41%>WSAEADDRINUSE</td>
<td width=59%>The local address of the socket is already in use and the socket was not marked to allow address reuse with SO_REUSEADDR. This error usually occurs at the time of <a href="../sock2/wsapiref_6vzm.htm"><b>bind</b></a>, but could be delayed until this function if the <b>bind</b> was to a partially wild-card address (involving ADDR_ANY) and if a specific address needs to be "committed" at the time of this function..</td>
</tr>
<tr valign=top>
<td width=41%>WSAEINTR</td>
<td width=59%>The (blocking) call was canceled through <a href="wsspiref_1njm.htm"><b>WSPCancelBlockingCall</b></a>.</td>
</tr>
<tr valign=top>
<td width=41%>WSAEINPROGRESS</td>
<td width=59%>A blocking Windows Sockets call is in progress, or the service provider is still processing a callback function.</td>
</tr>
<tr valign=top>
<td width=41%>WSAEALREADY</td>
<td width=59%>A nonblocking <b>WSPConnect</b> call is in progress on the specified socket.<p>
In order to preserve backward compatibility, this error is reported as WSAEINVAL to Windows Sockets 1.1 applications that link to either WINSOCK.DLL or WSOCK32.DLL</p>
</td>
</tr>
<tr valign=top>
<td width=41%>WSAEADDRNOTAVAIL</td>
<td width=59%>The remote address is not a valid address (for example, ADDR_ANY).</td>
</tr>
<tr valign=top>
<td width=41%>WSAEAFNOSUPPORT</td>
<td width=59%>Addresses in the specified family cannot be used with this socket.</td>
</tr>
<tr valign=top>
<td width=41%>WSAECONNREFUSED</td>
<td width=59%>The attempt to connect was rejected.</td>
</tr>
<tr valign=top>
<td width=41%>WSAEFAULT</td>
<td width=59%>The <i>name </i>or the <i>namelen </i>argument is not a valid part of the user address space, the <i>namelen</i> argument is too small, the buffer length for <i>lpCalleeData</i>, <i>lpSQOS</i>, and <i>lpGQOS</i> are too small, or the buffer length for <i>lpCallerData</i> is too large.</td>
</tr>
<tr valign=top>
<td width=41%>WSAEINVAL</td>
<td width=59%>The parameter <i>s</i> is a listening socket, or the destination address specified is not consistent with that of the constrained group the socket belongs to.</td>
</tr>
<tr valign=top>
<td width=41%>WSAEISCONN</td>
<td width=59%>The socket is already connected (connection-oriented sockets only).</td>
</tr>
<tr valign=top>
<td width=41%>WSAENETUNREACH</td>
<td width=59%>The network cannot be reached from this host at this time.</td>
</tr>
<tr valign=top>
<td width=41%>WSAENOBUFS</td>
<td width=59%>No buffer space is available. The socket cannot be connected.</td>
</tr>
<tr valign=top>
<td width=41%>WSAENOTSOCK</td>
<td width=59%>The descriptor is not a socket.</td>
</tr>
<tr valign=top>
<td width=41%>WSAEOPNOTSUPP</td>
<td width=59%>The flow specifications specified in <i>lpSQOS</i> and <i>lpGQOS</i> cannot be satisfied.</td>
</tr>
<tr valign=top>
<td width=41%>WSAEPROTONOSUPPORT</td>
<td width=59%>The <i>lpCallerData</i> augment is not supported by the service provider.</td>
</tr>
<tr valign=top>
<td width=41%>WSAETIMEDOUT</td>
<td width=59%>Attempt to connect timed out without establishing a connection.</td>
</tr>
<tr valign=top>
<td width=41%>WSAEWOULDBLOCK </td>
<td width=59%>The socket is marked as nonblocking and the connection cannot be completed immediately. It is possible to <a href="wsspiref_2q2a.htm"><b>WSPSelect</b></a> the socket while it is connecting by <b>WSPSelect</b>ing it for writing.</td>
</tr>
<tr valign=top>
<td width=41%>WSAEACCES</td>
<td width=59%>Attempt to connect datagram socket to broadcast address failed because <b>WSPSetSockOpt</b> SO_BROADCAST is not enabled.</td>
</tr>
</table><br>
<h4>QuickInfo</h4>
<p>
&nbsp;&nbsp;<b>Windows NT:</b>  Yes<br>
&nbsp;&nbsp;<b>Windows:</b> Yes<br>
&nbsp;&nbsp;<b>Windows CE:</b>  Unsupported.<br>
&nbsp;&nbsp;<b>Header:</b> Declared in ws2spi.h.</p>
<h4>See Also</h4>
<p>
<a href="wsspiref_2j1u.htm"><b>WSPAccept</b></a>, <a href="wsspiref_2iuq.htm"><b>WSPBind</b></a>, <a href="wsspiref_092q.htm"><b>WSPGetSockName</b></a>, <a href="wsspiref_53w2.htm"><b>WSPGetSockOpt</b></a>, <a href="wsspiref_46ia.htm"><b>WSPSocket</b></a>, <a href="wsspiref_2q2a.htm"><b>WSPSelect</b></a>, <a href="wsspiref_3p0y.htm"><b>WSPEventSelect</b></a>, <a href="wsspiref_2rjm.htm"><b>WSPEnumNetworkEvents</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
