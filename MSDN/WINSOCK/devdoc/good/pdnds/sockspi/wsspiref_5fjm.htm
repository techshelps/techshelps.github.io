<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>WSPRecvDisconnect</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_wsprecvdisconnect_2"></a>WSPRecvDisconnect</h1>
<p>
The <b>WSPRecvDisconnect</b> function terminates reception on a socket and retrieves the disconnect data, if the socket is connection oriented.</p>
<pre><code><b>int WSPRecvDisconnect (
  SOCKET</b><i> s</i><b>,</b>                           
<b>  LPWSABUF</b><i> lpInboundDisconnectData</i><b>,</b>   
<b>  LPINT</b><i> lpErrno                       </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>s</i></dt>
<dd>
[in] A descriptor identifying a socket.</dd>
<dt>
<i>lpInboundDisconnectData</i></dt>
<dd>
[out] A pointer to a buffer into which disconnect data is to be copied.</dd>
<dt>
<i>lpErrno</i></dt>
<dd>
[out] A pointer to the error code.
</dd>
</dl>
<h4>Remarks</h4>
<p>
<b>WSPRecvDisconnect</b> is used on connection-oriented sockets to disable reception, and retrieve any incoming disconnect data from the remote party.</p>
<p>
After this function has been successfully issued, subsequent receives on the socket will be disallowed. This has no effect on the lower protocol layers. For TCP, the TCP window is not changed and incoming data will be accepted (but not acknowledged) until the window is exhausted. For UDP, incoming datagrams are accepted and queued. In no case will an ICMP error packet be generated.</p>
<p>
To successfully receive incoming disconnect data, a Windows Sockets SPI client must use other mechanisms to determine that the circuit has been closed. For example, a client needs to receive an FD_CLOSE notification, or get a zero return value, or a WSAEDISCON error code from <b>WSPRecv</b>.</p>
<p>
Note that <b>WSPRecvDisconnect</b> does not close the socket, and resources attached to the socket will <i>not</i> be freed until <b>WSPCloseSocket</b> is invoked.</p>
<h4>Comments</h4>
<p>
<b>WSPRecvDisconnect</b> does not block regardless of the SO_LINGER setting on the socket.</p>
<p>
A Windows Sockets SPI client should not rely on being able to re-use a socket after it has been <b>WSPRecvDisconnect</b>ed. In particular, a Windows Sockets provider is not required to support the use of <b>WSPConnect</b> on such a socket.</p>
<h4>Return Values</h4>
<p>
If no error occurs, <b>WSPRecvDisconnect</b> returns zero. Otherwise, a value of SOCKET_ERROR is returned, and a specific error code is available in <i>lpErrno</i>.</p>
<h4>Error Codes</h4>
<table cellspacing=4 cols=2>
<tr valign=top>
<td width=37%>WSAENETDOWN</td>
<td width=63%>The network subsystem has failed.</td>
</tr>
<tr valign=top>
<td width=37%>WSAEFAULT</td>
<td width=63%>The buffer referenced by the parameter <i>lpInboundDisconnectData</i> is too small.</td>
</tr>
<tr valign=top>
<td width=37%>WSAENOPROTOOPT</td>
<td width=63%>The disconnect data is not supported by the indicated protocol family. </td>
</tr>
<tr valign=top>
<td width=37%>WSAEINPROGRESS</td>
<td width=63%>A blocking Windows Sockets call is in progress, or the service provider is still processing a callback function.</td>
</tr>
<tr valign=top>
<td width=37%>WSAENOTCONN</td>
<td width=63%>The socket is not connected (connection-oriented sockets only).</td>
</tr>
<tr valign=top>
<td width=37%>WSAENOTSOCK</td>
<td width=63%>The descriptor is not a socket.</td>
</tr>
</table><br>
<h4>QuickInfo</h4>
<p>
&nbsp;&nbsp;<b>Windows NT:</b>  Yes<br>
&nbsp;&nbsp;<b>Windows:</b> Yes<br>
&nbsp;&nbsp;<b>Windows CE:</b>  Unsupported.<br>
&nbsp;&nbsp;<b>Header:</b> Declared in ws2spi.h.</p>
<h4>See Also</h4>
<p>
<a href="wsspiref_0meq.htm"><b>WSPConnect</b></a>, <a href="wsspiref_46ia.htm"><b>WSPSocket</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
