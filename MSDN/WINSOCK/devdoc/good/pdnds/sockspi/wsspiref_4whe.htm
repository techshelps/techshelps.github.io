<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>NSPSetService</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_nspsetservice_2"></a>NSPSetService</h1>
<p>
The <b>NSPSetService</b> function registers or deregisters a service instance within a name space.</p>
<pre><code><b>int NSPSetService (
  LPGUID</b><i> lpProviderId</i><b>,</b>                         
<b>  LPWSASERVICECLASSINFOW</b><i> lpServiceClassInfo</i><b>,</b>   
<b>  LPWSAQUERYSETW</b><i> lpqsRegInfo</i><b>,</b>                  
<b>  WSAESETSERVICEOP</b><i> essOperation</i><b>,</b>               
<b>  DWORD</b><i> dwControlFlags</i>                         
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>lpProviderId</i></dt>
<dd>
[in] Pointer to the GUID of the specific name space provider that this service is being registered in.</dd>
<dt>
<i>lpServiceClasslnfo</i></dt>
<dd>
[in] Contains service class schema information.</dd>
<dt>
<i>lpqsRegInfo</i></dt>
<dd>
[in] Specifies property information to be updated upon registration.</dd>
<dt>
<i>essOperation</i></dt>
<dd>
[in] an enumeration whose values include:
<dl>
<dt>
RNRSERVICE_REGISTER</dt>
<dd>
Register the service. For SAP, this means sending out a periodic broadcast. This is a NOP for the DNS name space. For persistent data stores this means updating the address information.</dd>
<dt>
RNRSERVICE_DEREGISTER</dt>
<dd>
Deregister the service. For SAP, this means stop sending out the periodic broadcast. This is a NOP for the DNS name space. For persistent data stores this means deleting address information.</dd>
<dt>
RNRSERVICE_DELETE</dt>
<dd>
Delete the service from dynamic name and persistent spaces. For services represented by multiple CSADDR_INFO structures (using the SERVICE_MULTIPLE flag), only the supplied address will be deleted, and this must match exactly the corresponding CSADD_INFO structure that was supplied when the service was registered.</dd>
</dl>
</dd>
<dt>
<i>dwControlFlags</i></dt>
<dd>
[in] A set of control flags whose values include:
<dl>
<dt>
SERVICE_MULTIPLE</dt>
<dd>
Controls scope of operation. When clear, service addresses are managed as a group. A register or deregister invalidates all existing addresses before adding the given address set. When set, the action is only performed on the given address set. A register does not invalidate existing addresses and a deregister only invalidates the given set of addresses.
</dd>
</dl>
</dd>
</dl>
<p>
The available values for <i>essOperation</i> and <i>dwControlFlags</i> combine to give meanings as shown in the following table:</p>
<table cellspacing=4 cols=4>
<tr valign=top>
<th align=left width=25%>Operation</th>
<th align=left width=21%>Flags</th>
<th align=left width=28%>Service already exists</th>
<th align=left width=26%>Service does not exist</th>
</tr>
<tr valign=top>
<td width=25%>RNRSERVICE<br>
_REGISTER</td>
<td width=21%>none</td>
<td width=28%>Overwrite the object. Use only addresses specified. Object is REGISTERED.</td>
<td width=26%>Create a new object. Use only addresses specified. Object is REGISTERED.</td>
</tr>
<tr valign=top>
<td width=25%>RNRSERVICE<br>
_REGISTER</td>
<td width=21%>SERVICE<br>
_MULTIPLE</td>
<td width=28%>Update object. Add new addresses to existing set. Object is REGISTERED.</td>
<td width=26%>Create a new object. Use all addresses specified. Object is REGISTERED.</td>
</tr>
<tr valign=top>
<td width=25%>RNRSERVICE<br>
_DEREGISTER</td>
<td width=21%>none</td>
<td width=28%>Remove all addresses, but do not remove object from name space. Object is DEREGISTERED.</td>
<td width=26%>WSASERVICE<br>
_NOT_FOUND</td>
</tr>
<tr valign=top>
<td width=25%>RNRSERVICE<br>
_DEREGISTER</td>
<td width=21%>SERVICE<br>
_MULTIPLE</td>
<td width=28%>Update object. Remove only addresses that are specified. Only mark object as DEREGISTERED if no addresses present. Do not remove from the name space.</td>
<td width=26%>WSASERVICE<br>
_NOT_FOUND</td>
</tr>
<tr valign=top>
<td width=25%>RNRSERVICE<br>
_DELETE</td>
<td width=21%>none</td>
<td width=28%>Remove object from the name space.</td>
<td width=26%>WSASERVICE<br>
_NOT_FOUND</td>
</tr>
<tr valign=top>
<td width=25%>RNRSERVICE<br>
_DELETE</td>
<td width=21%>SERVICE<br>
_MULTIPLE</td>
<td width=28%>Remove only addresses that are specified. Only remove object from the name space if no addresses remain.</td>
<td width=26%>WSASERVICE<br>
_NOT_FOUND</td>
</tr>
</table><br>
<h4>Remarks</h4>
<p>
SERVICE_MULTIPLE lets an application manage its addresses independently. This is useful when the application wants to manage its protocols individually or when the service resides on more than one machine. For instance, when a service uses more than one protocol, it may find that one listening socket aborts but the others remain operational. In this case, the service could deregister the aborted address without affecting the other addresses.</p>
<p>
When using SERVICE_MULTIPLE, an application must not let stale addresses remain in the object. This can happen if the application aborts without issuing a DEREGISTER request. When a service registers, it should store its addresses. On its next invocation, the service should explicitly deregister these old stale addresses before registering new addresses.</p>
<h4>Service Properties</h4>
<p>
The following table describes how service property data is represented in a WSAQUERYSET structure. Fields labeled as <i>(Optional) </i>can be supplied with a NULL pointer.</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=44%>WSAQUERYSET Field Name</th>
<th align=left width=56%>Service Property Description</th>
</tr>
<tr valign=top>
<td width=44%><i>dwSize</i></td>
<td width=56%>Must be set to sizeof(WSAQUERYSET). This is a versioning mechanism.</td>
</tr>
<tr valign=top>
<td width=44%><i>dwOuputFlags</i></td>
<td width=56%>Not applicable and ignored.</td>
</tr>
<tr valign=top>
<td width=44%><i>lpszServiceInstanceName</i></td>
<td width=56%>Referenced string contains the service instance name.</td>
</tr>
<tr valign=top>
<td width=44%><i>lpServiceClassId</i></td>
<td width=56%>The GUID corresponding to this service class.</td>
</tr>
<tr valign=top>
<td width=44%><i>lpVersion</i></td>
<td width=56%><i>(Optional)</i> Supplies service instance version number.</td>
</tr>
<tr valign=top>
<td width=44%><i>lpszComment</i></td>
<td width=56%><i>(Optional) </i>An optional comment string.</td>
</tr>
<tr valign=top>
<td width=44%><i>dwNameSpace</i></td>
<td width=56%>Ignored for this operation.</td>
</tr>
<tr valign=top>
<td width=44%><i>lpNSProviderId</i></td>
<td width=56%>Ignored for this operation, provider ID is contained in the <i>lpProviderId </i>parameter.</td>
</tr>
<tr valign=top>
<td width=44%><i>lpszContext</i></td>
<td width=56%><i>(Optional) </i>Specifies the starting point of the query in a hierarchical name space.</td>
</tr>
<tr valign=top>
<td width=44%><i>dwNumberOfProtocols</i></td>
<td width=56%>Ignored.</td>
</tr>
<tr valign=top>
<td width=44%><i>lpafpProtocols</i></td>
<td width=56%>Ignored<i>.</i></td>
</tr>
<tr valign=top>
<td width=44%><i>lpszQueryString</i></td>
<td width=56%>Ignored.</td>
</tr>
<tr valign=top>
<td width=44%><i>dwNumberOfCsAddrs</i></td>
<td width=56%>The number of elements in the array of CSADDRO_INFO structures referenced by <i>lpcsaBuffer</i>.</td>
</tr>
<tr valign=top>
<td width=44%><i>lpcsaBuffer</i></td>
<td width=56%>A pointer to an array of CSADDRO_INFO structures which contain the address[es] that the service is listening on. </td>
</tr>
<tr valign=top>
<td width=44%><i>lpBlob</i></td>
<td width=56%><i>(Optional) </i>This is a pointer to a provider-specific entity.</td>
</tr>
</table><br>
<p>
<b>Note</b>  It is legal for the iProtocol field of the CSADDR_INFO structure to contain the manifest constant IPROTOCOL_ANY, signifying a wildcard value. The name space provider should substitute a value that is reasonable for the given the address family and socket type. </p>
<h4>Return Values</h4>
<p>
The function should return NO_ERROR (zero) if the routine succeeds. It should return SOCKET_ERROR (-1) if the routine fails and it must set the appropriate error code using <b>SetLastError</b>.</p>
<h4>Error Codes</h4>
<table cellspacing=4 cols=2>
<tr valign=top>
<td width=49%>WSAEACCES</td>
<td width=51%>The calling routine does not have sufficient privileges to install the service.</td>
</tr>
<tr valign=top>
<td width=49%>WSAEINVAL</td>
<td width=51%>One or more parameters were invalid or missing for this provider.</td>
</tr>
<tr valign=top>
<td width=49%>WSA_NOT_ENOUGH_MEMORY </td>
<td width=51%>Not enough free memory available to perform this operation.</td>
</tr>
<tr valign=top>
<td width=49%>WSASERVICE_NOT_FOUND</td>
<td width=51%>No such service is known. The service cannot be found in the specified name space.</td>
</tr>
</table><br>
<h4>QuickInfo</h4>
<p>
&nbsp;&nbsp;<b>Windows NT:</b>  Yes<br>
&nbsp;&nbsp;<b>Windows:</b> Yes<br>
&nbsp;&nbsp;<b>Windows CE:</b>  Unsupported.<br>
&nbsp;&nbsp;<b>Header:</b> Declared in ws2spi.h.</p>
<p>&nbsp;</p></body>
</HTML>
