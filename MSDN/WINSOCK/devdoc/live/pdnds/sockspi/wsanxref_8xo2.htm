<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>TCP/IP Raw Sockets</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_win32_tcp_ip_raw_sockets_2"></a>TCP/IP Raw Sockets</h3>
<p>
The TCP/IP service providers may support SOCK_RAW type of the socket. There are two types of such sockets: the first one assumes known protocol type as written in IP header, the second one allows any protocol number. An example of the first type of socket is ICMP, an example of the second type would be an experimental protocol which is not supported by the service provider.</p>
<p>
If TCP/IP service provider supports SOCK_RAW sockets for the AF_INET family, the corresponding protocol(s) should be included in the list returned by <a href="../../../good/pdnds/sock2/wsapiref_0f76.htm"><b>WSAEnumProtocols</b></a>.<b> </b>The <i>ipProtocol</i> field of the <a href="../../../good/pdnds/sock2/strucetc_4cfm.htm"><b>WSAPROTOCOL_INFO</b></a> structure may be set to 0 if the service provider allows an application to specify any value for the<i> protocol</i> parameter for the <a href="../../../good/pdnds/sock2/wsapiref_2qr6.htm"><b>socket</b></a>,<b> <a href="../../../good/pdnds/sock2/wsapiref_533m.htm">WSASocket</a> </b>and<b> <a href="../../../good/pdnds/sockspi/wsspiref_46ia.htm">WSPSocket</a> </b>functions. </p>
<p>
<b>Note</b>&nbsp;&nbsp;An application may not specify zero (0) as the <i>protocol</i> parameter for the <b>socket</b>,<b> WSASocket</b>, and<b> WSPSocket </b>functions if SOCK_RAW sockets are used.</p>
<p>
The following rules are applied to the operations over SOCK_RAW sockets:
<ul>
<li>
when an application sends a datagram it may or may not include the IP header at the front of the outgoing datagrams depending on the IP_HDRINCL option set for the socket.</li>
<li>
an application always gets the IP header at front of each received datagram regardless of the IP_HDRINCL option.</li>
<li>
received datagrams are copied into all SOCK_RAW sockets which satisfy the following conditions:<ul>
<li>
the protocol number specified for the socket should match the protocol number in the IP header of the received datagram;</li>
<li>
if a local IP address is defined for the socket, it should correspond to the destination address as specified in the IP header of the received datagram. An application may specify the local IP address by calling <a href="../../../good/pdnds/sock2/wsapiref_6vzm.htm"><b>bind</b></a> functions. If no local IP address is specified for the socket, the datagrams are copied into the socket regardless of the destination IP address in the IP header of the received datagram; </li>
<li>
if a foreign address is defined for the socket, it should correspond to the source address as specified in IP header of the received datagram. An application may specify the foreign IP address by calling <b>connect</b> functions. If no foreign IP address is specified for the socket, the datagrams are copied into the socket regardless of the source IP address in the IP header of the received datagram.</li>
</ul>
</li>
</ul>
<p>
It is important to understand that SOCK_RAW sockets may get many 'unexpected' datagrams. For example, a PING program may use SOCK_RAW socket to send ICMP echo requests. While the application is expecting ICMP echo responses, all the other ICMP messages (like ICMP HOST_UNREACHABLE) may be delivered to this application also. Moreover, if several SOCK_RAW sockets are open on a machine at the same time, the same datagrams may be delivered to all the open sockets. An application must have a mechanism to recognize 'its' datagram and to ignore all the others. Such mechanism may include inspecting the received IP header, using unique IDs in the ICMP header (ProcessID, for example), etc.</p>
<p>&nbsp;</p></body>
</HTML>
