<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Modifying and Inserting Records with DBStorage</title>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css">
<br>
</HEAD>
<BODY BGCOLOR=#FFFFFF TEXT=#000000>

<h3><a name="com_compref_evvc"></a><sup></sup>Modifying and Inserting Records with DBStorage</h3>
<p>
To modify records using <b>DBStorage</b>, read a record into a <b>Dictionary</b> or <b>OrderForm</b> object (using <b>GetData</b>, <b>LookupData</b>, or <b>LookupMultipleData</b>), modify the contents of the object, and then pass the object to <b>CommitData</b> to update the row.</p>
<p>
To insert a new record into the database, initialize the appropriate data object, and then pass the object to <b>InsertData</b> to insert the row.</p>
<p>
The following example adds an item to a shopping basket. First, a <b>DBStorage</b> object is created to access the database of active shopping baskets. Next, the <b>GetData</b> method is used to retrieve the basket for the current customer. Assuming the basket already exists, it is returned as an <b>OrderForm</b> object called <code>mscsOrderForm</code>. It the basket does not already exist in the database, then an empty <b>OrderForm</b> object is created.</p>
<p>
Next, the item is added to the <b>OrderForm</b> using the <b>OrderForm</b> object’s <b>AddItem</b> method. Finally, the <b>OrderForm</b> is written to storage. If the <b>OrderForm</b> is new, the data is inserted using the <b>InsertData</b> method; if the order form already existed in the basket database, the revised data is committed using the <b>CommitData</b> method:</p>
<pre><code>REM  Create and initialize the OrderForm storage object
set mscsOrderFormStorage = Server.CreateObject("Commerce.DBStorage")
call mscsOrderFormStorage.InitStorage(MSCSSite.DefaultConnectionString, "Clocktower_basket", "shopper_id", "Commerce.OrderForm", "marshalled_order", "date_changed")

REM  Create an OrderForm for the shopper’s basket
created = 0
on error resume next
set mscsOrderForm = mscsOrderFormStorage.GetData(null, mscsShopperID)
on error goto 0
if IsEmpty(mscsOrderForm) then
   set mscsOrderForm = Server.CreateObject("Commerce.OrderForm")
   mscsOrderForm.shopper_id = mscsShopperID
   created = 1
end if

REM  Add the item to the basket
call mscsOrderForm.AddItem(product_sku, product_qty, 0)

REM  Update the database
if created = 0 then
   call mscsOrderFormStorage.CommitData(NULL, mscsOrderForm)
else
   call mscsOrderFormStorage.InsertData(NULL, mscsOrderForm)
end if

Response.Redirect mscsPage.URL("basket.asp")
</code></pre>
<p>
The <b>CommitData </b>and <b>InsertData</b> methods can store the data from the specified object into the database in two ways.
<ul>
<li>
&upsilon;First, if the <b>InitStorage</b> method specifies a <i>MarshallColumn </i>parameter, then <b>CommitData </b>and <b>InsertData</b> serialize all the data in the object into binary form and store it into the database column specified by this parameter. (If this argument is not supplied, then no data is stored in serialized form.)</li>
<li>
&upsilon;Second, if the names of any items in the object exactly match the names of columns in the database, then the data in these items is stored into the corresponding columns.  For example, if the order form contains a value called ship_to_name, and if your database table contains a column named <i>ship_to_name</i>, the <b>DBStorage</b> object saves the value in the <b>ship_to_name</b> entry of the order form into that column.</li>
</ul>
<p>
If the <i>MarshallColumn </i>parameter is specified and matching columns exist, then the corresponding data is stored both ways.</p>
<!-----------------------------Copyright 1997-1998 Microsoft Corporation------------------------------>
<hr>
<center><font size=-1>
<A HREF="sdklegal.htm">&copy; 1997-1998 Microsoft Corporation. All rights reserved.</A>
</font></center>
<br>
<br>
<p>&nbsp;</p></body>
</HTML>
