<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>The Sample Agent Script</title>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css">
<br>
</HEAD>
<BODY BGCOLOR=#FFFFFF TEXT=#000000>
<h1>The Sample Agent Script</h1>
<p>
This script acts as the agent during the refresh cycle.&nbsp; The code in its entirety is listed below.&nbsp; </p>
<p>
During the refresh cycle, this agent will gather the specified files in the specified directory for inclusion in the <b>Channel</b> object running the cycle.&nbsp; It additionally uses the <b>WrapSSIFilter</b> COM class to gather bibliographic information encountered in each file it adds.</p>
<p>
The first section of the script checks that the <b>RefreshOptions</b> have been set in an acceptable way for the agent to use.&nbsp; In this case, it makes sure the keys "Files" and "Directory" are set and that the associated values are of the correct data type.</p>
<p>
It then creates a <b>Scripting.FileSystemObject</b> class object to access the file system and the listed files.&nbsp; For each file passed in the <b>RefreshOptions </b>collection under the key "Files", it adds the file as an <b>Item</b> object to the <b>Items</b> collection for the <b>Channel</b>.</p>
<p>
After setting some properties such as the <b>HREF</b> and <b>Title</b>, it then uses the <b>WrapSSIFilter</b> COM object to scan the file for bibliographic tags and information.</p>
<pre><code>On Error Resume Next
Dim g_oPushFilter
Set g_oPushFilter = CreateObject("Push.WrapSSIFilter")
On Error Goto 0
Err.Clear

If Util.IsValidData(Options("Files"), vbArray + vbVariant) AND _
 &nbsp; Util.IsValidData(Options("Directory"), vbString) Then

 &nbsp;&nbsp; Dim strFile, oFileSystem
 &nbsp;&nbsp; Set oFileSystem = CreateObject("Scripting.FileSystemObject")

 &nbsp;&nbsp; For Each strFile in Options("Files")
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim oItem
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Set oItem = Channel.AddItem()

 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REM Set Item properties
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oItem.DeleteOnRefresh = TRUE
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oItem.HREF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = strFile
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oItem.Title&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = strFile
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetIFilterProperties g_oPushFilter, oItem, oFileSystem.GetFile(Options("Directory") &amp; strFile)

 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' Please refer to the SDK for properties that can be set on Item.
 &nbsp;&nbsp; Next

End If


REM
REM This procedure sets additional Item properties found by the IFilter object
REM
Sub SetIFilterProperties(ByVal oPushFilter, ByVal oItem, ByVal oFile)

 &nbsp;&nbsp; Dim fFilterLoaded, vtData, strAuth, strKwdit

 &nbsp;&nbsp; If VarType(oPushFilter) &lt;&gt; vbObject Then
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oItem.Title = oFile.Name
 &nbsp;&nbsp; Else
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fFilterLoaded = TRUE

 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REM
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REM Load the filename into the filter and extract HTM tag properties
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REM
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; On Error Resume Next
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oPushFilter.load oFile.Path, 0
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Err.Number &lt;&gt; 0 Then
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fFilterLoaded = FALSE
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Err.Clear
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; On Error Goto 0

 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If fFilterLoaded = FALSE Then
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oItem.Title = oFile.Name
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REM
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REM Filter is loaded, set the properties retrieved from the file Filter
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REM

 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REM set the Title
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vtData = oPushFilter.GetProperty("title")
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If util.IsValidData(vtData, vbString) Then
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oItem.Title = vtData
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oItem.Title = oFile.Name
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If

 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REM set the authors
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vtData = oPushFilter.GetProperty("authors")
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If util.IsValidData(vtData, (vbArray+vbVariant)) Then
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For each strAuth in vtData
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oItem.Authors.Add strAuth
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Next
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If

 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REM set the abstract
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vtData = oPushFilter.GetProperty("abstract")
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If util.IsValidData(vtData, vbString) Then
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oItem.Abstract = vtData
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If

 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REM set the Keywords
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vtData = oPushFilter.GetProperty("Keywords")
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If util.IsValidData(vtData, (vbArray+vbVariant)) Then
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For each strKwdit in vtData
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oItem.Keywords.Add strKwdit
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Next
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If 'fFilterLoaded
 &nbsp;&nbsp; End If 'g_bUseFilter
End Sub</code></pre>
<!-----------------------------Copyright 1997-1998 Microsoft Corporation------------------------------>
<hr>
<center><font size=-1>
<A HREF="sdklegal.htm">&copy; 1997-1998 Microsoft Corporation. All rights reserved.</A>
</font></center>
<br>
<br>
</BODY>
</HTML>
