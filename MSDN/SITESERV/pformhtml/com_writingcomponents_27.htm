<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Commerce Server 3.0 and the Billing API</title>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css">
<br>
</HEAD>
<BODY BGCOLOR=#FFFFFF TEXT=#000000>

<h1><a name="com_writingcomponents_twmr"></a><sup></sup>Commerce Server 3.0 and the Billing API</h1>
<p>
Microsoft® Site Server version 2.0 included a library (billingapi.lib) that exports the Billing Application Programming Interface (API).  The Billing API defines a collection of C-language routines for writing billing events to a file on Site Server.</p>
<p>
Site Server 3.0 includes a new version of this library, which has been updated to use the Commerce Server order processing pipeline (OPP). Applications built using the older library need only to re-link to the new one. This library file can be found in \Microsoft Site Server\SiteServer\Commerce\SDK\Commerce\lib\i386.</p>
<p>
As currently implemented, the Billing API passes billing events to the OPP. Parameters passed to Billing API routines map to name/value pairs on the <b>OrderForm</b> that is passed to the OPP.</p>
<p>
Consequently, in addition to re-linking to the new version of the Billing API library, you need to create the pipeline that processes Billing API events, and to register this pipeline in the Microsoft® Windows NT® system registry by writing the following value to \HKEY_LOCAL_MACHINE\Software\Microsoft\Microsoft Site Server 3.0<br>
\Commerce Server 3.0\. The value that you write to this key should be named <b>PCF</b>, and its value should be a string that evaluates to the fully qualified path to the pipeline configuration file that is used to process billing events.</p>
<p>
After you have re-linked your applications to this library, and registered a pipeline to process Billing API events, Billing API routines invoke this pipeline and pass it an <b>OrderForm</b> initialized with name/value pairs that map to parameters passed to the Billing API routines.</p>
<p>
The following table describes the name/value pairs on the <b>OrderForm</b>, and the Billing API parameters to which they map.</p>
<table cellspacing=4 cols=3 width=464>
<tr valign=top>
<th align=left width=31%>Name</th>
<th align=left width=34%>Parameter</th>
<th align=left width=35%>Description</th>
</tr>
<tr valign=top>
<td colspan=3 width=100%></td>
</tr>
<tr valign=top>
<td width=31%>shopper_id</td>
<td width=34%>hAcctUid</td>
<td width=35%>Unique identifier for member (hAcct).</td>
</tr>
<tr valign=top>
<td width=31%>_billing_event</td>
<td width=34%>BeventId</td>
<td width=35%>Billing Event ID. Always TRANSACTIONEVENT.</td>
</tr>
<tr valign=top>
<td width=31%>vendor_id</td>
<td width=34%>hVendorID</td>
<td width=35%>Unique identifier for vendor (hAcct).</td>
</tr>
<tr valign=top>
<td width=31%>Purchase_type</td>
<td width=34%>DwEkind</td>
<td width=35%>Vendor Event ID (see the Billing API documentation).</td>
</tr>
<tr valign=top>
<td width=31%>Quantity</td>
<td width=34%>iNumUnits</td>
<td width=35%>Number of units.</td>
</tr>
<tr valign=top>
<td width=31%>MeasureID</td>
<td width=34%>Measure</td>
<td width=35%>Measure of each unit (see the Billing API documentation).</td>
</tr>
<tr valign=top>
<td width=31%>_oadjust_adjustedprice</td>
<td width=34%>dwUnitPrice</td>
<td width=35%>Price of each unit.</td>
</tr>
<tr valign=top>
<td width=31%>currencycode</td>
<td width=34%>iCurrencyCode</td>
<td width=35%>Type of currency used for the billing.</td>
</tr>
<tr valign=top>
<td width=31%>date_begin</td>
<td width=34%>dtbegin</td>
<td width=35%>End time for member’s actions. Win32® FILETIME data type.</td>
</tr>
<tr valign=top>
<td width=31%>date_end</td>
<td width=34%>dtend</td>
<td width=35%>End time for member’s actions. Win32 FILETIME data type.</td>
</tr>
<tr valign=top>
<td width=31%>event_desc</td>
<td width=34%>lpscDescription</td>
<td width=35%>Text description of the event.</td>
</tr>
<tr valign=top>
<td width=31%>_billing_result</td>
<td width=34%>Method result.</td>
<td width=35%>Return value from the billing system (see the table of return codes for routines defined in the Billing API documentation).</td>
</tr>
<tr valign=top>
<td width=31%>_product_name</td>
<td width=34%>lpszProductID</td>
<td width=35%>Text name of the product just purchased.</td>
</tr>
<tr valign=top>
<td width=31%>Token</td>
<td width=34%>Token</td>
<td width=35%>Token that was modified to give access to the product.</td>
</tr>
<tr valign=top>
<td width=31%>TransIPaddr</td>
<td width=34%>The dwIPaddr field of the TRANSACTION_ID structure.</td>
<td width=35%>IP address of the server that is processing the billing event.</td>
</tr>
<tr valign=top>
<td width=31%>TransTime</td>
<td width=34%>The ftUnique (FILETIME) member of the TRANSACTION_ID structure.</td>
<td width=35%>Time that the billing event was generated.</td>
</tr>
<tr valign=top>
<td width=31%>payment_method</td>
<td width=34%></td>
<td width=35%>Billing in the case of a BSMS component.</td>
</tr>
<tr valign=top>
<td width=31%>_billing_action</td>
<td width=34%></td>
<td width=35%>Identifies the Billing API 1.0 name of the routine that caused the pipeline to run. See Billing Action Values for a list of these values.</td>
</tr>
</table><br>
<!-----------------------------Copyright 1997-1998 Microsoft Corporation------------------------------>
<hr>
<center><font size=-1>
<A HREF="sdklegal.htm">&copy; 1997-1998 Microsoft Corporation. All rights reserved.</A>
</font></center>
<br>
<br>
<p>&nbsp;</p></body>
</HTML>
