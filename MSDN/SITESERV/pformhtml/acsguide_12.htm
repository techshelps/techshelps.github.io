<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Creating Personalized Channel Subscriptions</title>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css">
<br>
</HEAD>
<BODY BGCOLOR=#FFFFFF TEXT=#000000>

<h1><a name="pu_guide_creating_personalized_channel_subscriptions"></a>Creating Personalized Channel Subscriptions</h1>
<p>
The following extended example demonstrates the power available using the Active Channel Server objects in an ASP environment to allow users to select personalized channel subscriptions.&nbsp; </p>
<p>
Assume we have a page here that presents a simple form the user can use to select channels from a project.&nbsp; It would be nice to have the GUID values and channel Titles put in the <b>Application</b> collection for reference by the selector page.&nbsp; Here's how we could do this in the Global.Asa file.&nbsp; Assume a simple set of channels: one top-level, and a few in the subchannels collection.</p>
<p>
<b><i>Global.Asa</i></b></p>
<pre><code>&lt;SCRIPT LANGUAGE="VBScript" RUNAT=SERVER&gt;
Sub Application_OnStart
 Set IDispHelper = CreateObject("Push.CDFGenHelper")
 IDispHelper.Load("Project1")
 Set Application("Project1") = IDispHelper

 ' get the project out to get guids and titles
 Set IDispProject = IDispHelper.Project

 ' add guid=title key/value pairs to a dictionary
 Set ChannelTitles = CreateObject("Scripting.Dictionary")
 ChannelTitles(IDispProject.Channel.GUID) = IDispProject.Channel.Title
 For each channel in IDispProject.Channel.subchannels
  ChannelTitles(channel.GUID) = channel.Title
 Next
 Set IDispProject = nothing&nbsp; 'remove this reference
 Set Application("Channel Titles") = ChannelTitles
 …
End Sub
&lt;/SCRIPT&gt;
</code></pre>
<p>
Now we can display the Titles and use the GUID values for an HTML form via an ASP page:</p>
<p>
<b><i>Selection.asp</i></b></p>
<pre><code>&lt;HTML&gt;
&lt;HEAD&gt;
&lt;TITLE&gt;Select Only the Channels You Want&lt;/TITLE&gt;
&lt;/HEAD&gt;
&lt;BODY&gt;
Select The Channels You'd Like to Subscribe to:&lt;br&gt;
&lt;FORM METHOD="POST" ACTION="addthem.asp"&gt;
&lt;% For Each Key in Application("Channel Titles")
Response.write("&lt;INPUT TYPE=\"CheckBox\" Name=\"ChanSelection\" VALUE=\"" 
&amp; Key &amp; "\"&gt;" &amp; Application("Channel Titles")(key) &amp; "&lt;br&gt;")
%&gt;
&lt;INPUT TYPE=SUBMIT&gt;
&lt;/FORM&gt;
&lt;/HTML&gt;
</code></pre>
<p>
Now we can use the "addthem.asp" file to add the channels to the users directory data.&nbsp; We then can redirect them to a CDF generating ASP page</p>
<p>
<b><i>addthem.asp</i></b></p>
<pre><code>&lt;% 
 &nbsp; ' Get the directory property name used to hold the channel selections 
 &nbsp; ' and style from the CDFGenHelper.&nbsp; Its in the Application collection

 &nbsp; Application("Helper").GetSelectionListPropName( ListProp, StyleProp)

 &nbsp; '&nbsp; Create the user's AUO
 &nbsp; const AUOClass = "membership.userobjects"
 &nbsp; Set IDispUserObjects=Server.CreateObject(AUOClass)
 &nbsp; ' add the guid list to the user's data
 &nbsp; '&nbsp; The Form collection should have a nice array of values
 &nbsp; '&nbsp; from the checkbox.

 &nbsp; IDispUserObjects.PutEx 2, ListProp,(Request.Form("ChanSelection"))
 &nbsp; IDispUserObjects.Put StyleProp, 0&nbsp; ' inclusive list
 &nbsp; IDispUserObjects.SetInfo
  
 &nbsp; Set IDispUserObjects = nothing
 &nbsp; 
 &nbsp; Response.Clear
 &nbsp; Response.Redirect = "generateCDF.asp"
 &nbsp; Response.end
%&gt;

</code></pre>
<p>
The contents of the "generateCDF.asp" are then listed below.&nbsp; This script actually generates the custom CDF string for the user using their selections stored in the directory database. Way back in the first code example, the dispinterface on an instance of the <b>CDFGenHelper</b> class was added to the <b>Application</b> collection under the name "Project1".&nbsp; This interface is referred to when the <b>Run</b> method is invoked below.</p>
<p>
<b><i>generateCDF.asp</i></b></p>
<pre><code>&lt;% Set ICDFGenerator = Server.CreateObject("Push.CDFGenerator")
 &nbsp;&nbsp;&nbsp; ICDFGenerator.Run "Project1"
%&gt;
</code></pre>
<!-----------------------------Copyright 1997-1998 Microsoft Corporation------------------------------>
<hr>
<center><font size=-1>
<A HREF="sdklegal.htm">&copy; 1997-1998 Microsoft Corporation. All rights reserved.</A>
</font></center>
<br>
<br>
</BODY>
</HTML>
