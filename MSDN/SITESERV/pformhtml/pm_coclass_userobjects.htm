<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>CoClass UserObjects (Membership.UserObjects.1)</title>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css">
<br>
</HEAD>
<BODY BGCOLOR=#FFFFFF TEXT=#000000>

<h1><a name="pm_class_userobjects"></a>Class UserObjects</h1>
<p>
<b>COM Class Identification</b></p>
<p>
The following values identify this COM class.&nbsp; These values are set in the registry with the Site Server 3.0 product installation.</p>
<p class=dt>
<i>COM Class Logical Name</i></p>
<p class=indent>
UserObjects</p>
<p class=dt>
<i>Programmatic Identifier</i></p>
<p class=indent>
Membership.UserObjects.1</p>
<p class=dt>
<i>CLSID</i></p>
<p class=indent>
77BD6B36-B1B5-11D0-BBD6-00C04FB615E5</p>
<p>
<b>Type Information</b></p>
<p class=dt>
Type Library location </p>
<p class=indent>
"c:\microsoft site server\bin\p&amp;m\auo.dll"</p>
<p class=dt>
IDL file</p>
<p class=indent>
&nbsp;<i>AUO.idl</i> (comes with this SDK)</p>
<p class=dt>
Type Library name</p>
<p class=indent>
&nbsp;<i>AUO 1.0 Type Library</i></p>
<p>
<b>Class Overview</b></p>
<p>
This class defines a Component Object Model (COM) object that programmers and scripters can use to easily store and retrieve information about users.</p>
<p>
<b>AUO Providers</b></p>
<p>
An object of this class relies on a set of configuration entries referred to as Active User Objects (AUO) <i>providers</i> to define the specific access details to information about users.&nbsp; When configuring the AUO, administrators supply an instance-unique AUO <i>alias</i> to identify the specific AUO provider configuration.&nbsp; Programmers and scripters may then access the targeted information using this <i>alias</i>.&nbsp; </p>
<p>
Each AUO provider configuration is comprised of information used to bind to a specific COM object that implements the <i>Active Directory Service Interfaces</i> (ADSI).&nbsp; It is specifically through these COM objects that <i>all </i>management and transport of data occurs. In the simplest case, the AUO is simply a set of "helper" COM objects that assist programmers in gaining access to a particular ADSI implemented COM object with a minimum of fuss.&nbsp; Further, the ADSI interfaces define only <i>general</i> information about the expected behavior of ADSI implemented COM objects, allowing developers to implement the details in any fashion they so desire.&nbsp; The AUO system makes <i>no</i> assumptions about the actual implementations used COM objects that implement the ADSI interfaces.&nbsp; The AUO objects, specifically <b>UserObjects</b> and <b>SchemaObjects</b>, are strictly <i>clients</i> of the bound ADSI COM objects, or fetch and return interfaces on ADSI objects.</p>
<p>
<b>The Default Provider</b></p>
<p>
The one <i>provider</i> definition that has special status is the <i>default</i> AUO provider.&nbsp; Programmers or scripts need not specify this provider in programs or scripts directly.&nbsp; Instead, they may interact with the <b>UserObjects</b> or <b>SchemaObjects</b> objects <i>as if they were the corresponding ADSI object.&nbsp; </i>However, if an interface on the actual ADSI object is required by an application, it can always be requested by the <b>IUserObjects::GetObjectEx </b>(or <b>IADsContainer::GetObject</b> implemented by the <b>UserObjects</b> object) method with the empty string "".&nbsp; This provider configuration normally points to user data in the appropriate Membership Directory service and works in conjunction with the Membership Server attribute or property cache to provide high-speed access and synchronization.&nbsp; The <b>IADs</b> and <b>IADsContainer </b>interface implemented by the <b>UserObjects</b> coclass provides this service <i>only for the ADSI object specified by the configuration of the default AUO provider</i>.&nbsp; </p>
<p>
<b>The Active Directory Service Interfaces (ADSI)</b></p>
<p>
The <b>UserObjects</b> coclass relies on other COM objects that implement the Active Directory Service COM Interfaces (ADSI) for <i>all</i> connectivity to data stores.&nbsp; (I.e. directory services, databases, etc)&nbsp; As its name suggests, an instance of the <b>UserObjects</b> coclass acts as a <i>collection</i> of ADSI COM objects that implement ADSI interfaces and provide connectivity services.&nbsp; However, it also simultaneously masquerades as the ADSI object defined by the <i>default</i> AUO provider and the current user.&nbsp; All invocations made on the <b>UserObject</b> <a href="pm_coclass_userobjects_2.htm">IADs</a> interface are delegated to the actual ADSI COM object.&nbsp; If the Membership system is configured to have the AUO check the Membership service property cache, the <b>Get/GetEx</b> methods implemented on the <b>UserObjects</b> object first check there for a requested attribute.&nbsp; If this feature is disabled, the call goes directly to the ADSI object in a standard COM "delegation" fashion.&nbsp; If the user's ADSI object also is an ADSI <i>container</i> object, the <a href="pm_coclass_userobjects_3.htm">IADsContainer</a> interface implemented on the <b>UserObjects</b> coclass will delegate these calls as well.</p>
<p>
<b>Constructing the ADs Paths to the Objects</b></p>
<p>
<b>Example</b></p>
<p>
A hypothetical example may help make these ideas concrete.&nbsp; Assume there are two directory service "containers" that store data about users.&nbsp; Assume the <i>Suffix</i> value is set to "1" for each AUO provider that defines the paths to user information in these databases.&nbsp; The <i>ADsPathPrefix </i>and <i>Name</i> of the corresponding AUO provider entries could be</p>
<table border=0 cellpadding=5 cols=2 frame=below rules=all width=603>
<tr valign=top>
<td width=15%><b><i>Alias</i></b></td>
<td width=85%><b><i>ADsPathPrefix</i></b></td>
</tr>
<tr valign=top>
<td width=15%>""</td>
<td width=85%>"LDAP://ldapsvr1:389/o=company1/ou=accounting" </td>
</tr>
<tr valign=top>
<td width=15%>"Secure"</td>
<td width=85%>"LDAP://ldapsvr1:443/o=company1/ou=401ks"</td>
</tr>
</table><br>
<p>
Note that the <i>default</i> AUO alias is specified by the "" alias. (I.e. the empty string)</p>
<p>
Next assume a registered user with username "JohnS" (i.e. has REMOTE_USER="JohnS") requests an ASP page that uses the <b>UserObjects</b> object to personalize his 401k page.&nbsp; When the script programmer instructs the <b>UserObjects</b> object to fetch some properties from a directory, it binds the appropriate ADSI object by combining the two sets of information.&nbsp; Take the following ASP script example:</p>
<pre><code>Hello &lt;%= UserObjects.Get "givenName" %&gt;, your current 401k balance is
&lt;%= UserObjects.GetObjectEx("Secure").Get("Balance") %&gt;.</code></pre>
<p>
In the first call, the <b>UserObjects</b> object constructs the complete ADs path from the ADsPathPrefix from default provider and the value of REMOTE_USER as follows:</p>
<p>
<i>ADsPath 1</i></p>
<p class=indent>
"LDAP://ldasvr1:389/o=company1/ou=accounting" + "/cn=JohnS"</p>
<p>
When the script parser hits the line </p>
<p>
<code>UserObjects.Get "givenName"</code></p>
<p>
the script invokes the <b>Get</b> method on the class <b>UserObjects</b> object's <b>IADs</b> interface.&nbsp; In this case, the <b>Get</b> method in the <b>UserObjects</b> object requests the "givenName" attribute from the Membership virtual server cache first. If not found there, it then <i>binds</i> the ADSI object shown above in <i>ADsPath 1</i> and passes on the <b>Get</b> invocation to the actual ADSI object <b>IADs</b> interface.&nbsp; In either case, the attribute value is returned or an error is raised.</p>
<p>
In the second call, the <b>UserObjects</b> object constructs the complete using the AUO entry with the alias of "Secure" and the current username as follows:</p>
<p class=dt>
<i>ADsPath 2</i></p>
<p class=indent>
"LDAP://ldapsvr1:443/o=company/ou=401k" + "/cn=JohnS"</p>
<p>
In this case, we must explicitly ask for this ADSI object via the <b>GetObjectEx</b> method using the <i>alias </i>"Secure."&nbsp; This method simply returns the <b>IDispatch</b> interface to <i>the ADSI object bound by the above ADs Path 2</i>.&nbsp; </p>
<p>
<b>ADSI Security Issues</b></p>
<p>
ADSI implements a set of security features to restrict access to information by unauthorized accounts stored in directory services.&nbsp; Essentially, how one goes about <i>binding</i> to an ADSI object determines what type of credentials are presented to the underlying directory service.&nbsp; A complete discussion of ADSI security features is beyond the scope of this reference.&nbsp; For a complete discussion of ADSI related security issues, see the <i>ADSI 2.0 SDK</i> documentation found in the <i>Platform SDK</i> under<i> Network and Distributed Services</i>.</p>
<p>
The <b>UserObjects</b> class implements the following checklist when determining which credentials to present when binding to ADSI objects.&nbsp; The list is in order of precedence.</p>
<p>
First and foremost,
<ul type=disc>
<li>
If the AUO provider has the <i>BindAsUsername</i> value currently set, the <b>UserObjects</b> object binds ADSI objects using these values.&nbsp; The <i>BindAsUsername</i> and <i>BindAsPassword</i> values can be set for the AUO entry permanently with an instance of the <a href="pmclassesref.htm">AuoConfig</a> class or with the <b>IUserObjects::BindAs</b> method at runtime.&nbsp; <br><br></li>
<li>
That not being the case, <br><br></li>
<li>
If the programmer uses the <b>SetUserName</b> method to change the username within the <b>UserObjects</b> object at runtime, it subsequently binds to <i>all</i> ADSI objects <i>anonymously</i>.&nbsp; (i.e. no credentials are presented when binding) Note that this only applies if the initial condition was not met.&nbsp; If the <i>BindAsUsername</i> value is set for the provider, then these values are used to bind irrespective of whether <b>SetUserName</b> has been called or not.&nbsp; This allows programmers and scripters to use the "auto user-create" feature of the AUO within a secured directory service.<br><br></li>
<li>
Otherwise, the <b>UserObjects</b> object uses the current username and password as credentials to bind to ADSI objects.</li>
</ul>
<p>
<b><i>When</i> ADSI Objects are Bound</b></p>
<p>
The actual ADSI objects are not bound until a method is explicitly invoked on either the <b>IADs</b> or <b>IADsContainer</b> interfaces of a <b>UserObjects</b> object.&nbsp; This is often referred to a "lazy" binding.&nbsp; It is best to think of it as "bound when requested by a method."</p>
<p>
<b>Creating Instances of this Class</b></p>
<p>
Normally, a web site programmer would have a built-in ASP Server-class object create the instance of the <b>Membership.UserObjects</b> class:&nbsp; (VBScript example)</p>
<pre><code>&lt;% Set UserObject = Server.CreateObject(“Membership.UserObjects”)
</code></pre>
<p>
However, this class is a bona fide COM object, and programmers can create instances&nbsp; in any context using the normal COM library methods.</p>
<!-----------------------------Copyright 1997-1998 Microsoft Corporation------------------------------>
<hr>
<center><font size=-1>
<A HREF="sdklegal.htm">&copy; 1997-1998 Microsoft Corporation. All rights reserved.</A>
</font></center>
<br>
<br>
</BODY>
</HTML>
