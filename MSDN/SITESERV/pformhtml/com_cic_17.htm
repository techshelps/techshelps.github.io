<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Creating a Receiving Agent for SMTP Transport</title>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css">
<br>
</HEAD>
<BODY BGCOLOR=#FFFFFF TEXT=#000000>

<h3><a name="com_cic_kavw"></a>Creating a Receiving Agent for SMTP Transport</h3>
<p>
The <b>SendSMTP</b> component can send e-mail to any mail recipient. However, in order to receive a business data object and pass it to an application on the receive side, the receiving mail system must invoke the receive pipeline. </p>
<p>
If you are using Microsoft® Exchange 5.5, you can run a Visual Basic script to invoke an <b>OrderPipeline</b> object (but not an <b>MtsPipeline</b> or <b>MtsTxPipeline</b>) on the Exchange server when mail arrives in the designated mailbox to process the received messages. Commerce Server includes the Recvsmtp.vbs example script, which is installed into \Microsoft Site Server\SiteServer\Commerce\. The following procedure describes how to use this script with an Exchange 5.5 mail server and Microsoft Outlook 8.03 installed on a client computer that connects to the Exchange server.</p>
<h5>To create a receiving agent</h5>
<ol>
<li>
Create a new alias (for this example, name this alias <b>Client1</b>) on the Exchange 5.5 server (<b>Server1</b>) to monitor and program the receiving script.</li>
<li>
Start the Outlook 8.03 client on any computer on the network. Log on with a profile that chooses the alias <b>Client1</b> on <b>Server1</b>. </li>
<li>
Create a public folder called <b>CIReceive</b> (for “Commerce Interchange Receive”).<ul>
<li>
&upsilon;On the <b>File</b> menu, point to <b>New</b>, and then click <b>Folder</b>.</li>
<li>
&upsilon;In the <b>Make this folder a subfolder of</b> box, expand <b>Public Folders</b>, and then click <b>All Public Folders</b>.</li>
<li>
&upsilon;In the <b>Name</b> box, type a name for the new folder.</li>
<li>
&upsilon;Click <b>OK</b> to create the folder.</li>
</ul>
</li>
<li>
Grant users permissions to run scripts.<ul>
<li>
&upsilon;In the Administrator window, select the <b>System Folders</b> container for your organization.</li>
<li>
&upsilon;Click <b>Events Root</b>, and then select the <b>EventConfig</b> folder that corresponds to the Microsoft Exchange Server computer on which the folder owner should be granted permission.</li>
<li>
&upsilon;On the <b>File</b> menu, click <b>Properties</b>.</li>
<li>
&upsilon;Click <b>Client Permissions</b>.</li>
<li>
&upsilon;Click <b>Add</b>, and then select the user (<b>Client1</b>) who will have permission to run applications or other event handlers on this server.</li>
<li>
&upsilon;In the <b>Roles</b> box, select the <b>Editor</b> role. This enables the user to create scripts that handle events on this server. </li>
</ul>
</li>
<li>
Make the chosen public folder accept mail.<ul>
<li>
&upsilon;In the Administrator window, select the <b>Public Folders</b> container for your organization.</li>
<li>
&upsilon;Select the <b>CIReceive </b>folder that you created in Step 3.</li>
<li>
&upsilon;On the <b>File</b> menu, click <b>Properties</b>.</li>
<li>
&upsilon;Click the <b>Advanced</b> tab. Clear the <b>Hide from address book</b> check box.</li>
<li>
&upsilon;Click the <b>E-mail Address</b> tab. Write down the e-mail address corresponding to SMTP (<b>CIReceive@org1.com</b>, in this example). Use this e-mail address for the <b>SMTP Host</b> when configuring the <b>SendSMTP</b> component for your Commerce Interchange transmit pipeline</li>
</ul>
</li>
<li>
Create a new script.<ul>
<li>
&upsilon;Using the Outlook client, select the <b>CIReceive</b> public folder.</li>
<li>
&upsilon;On the <b>File</b> menu, click <b>Properties</b>.</li>
<li>
&upsilon;Click the <b>Agents</b> tab, and then click <b>New</b>.</li>
<li>
&upsilon;Type a name for the new agent.</li>
<li>
&upsilon;Select the event <b>A new item is posted in the folder</b> to enable the agent to respond when a new item is posted.</li>
<li>
&upsilon;Click <b>Edit Script</b>. If Microsoft® Visual InterDev™ is installed, it is started with a blank script that you can edit. If it is not installed, Notepad is started with a blank script. </li>
<li>
&upsilon;Copy the Visual Basic script from \Microsoft Site Server\SiteServer\Commerce\recvsmtp.vbs, and then paste it into the blank file. Make any desired changes, and then save the file and exit from Visual InterDev or Notepad.</li>
<li>
&upsilon;Click <b>OK</b> to save the new agent.</li>
</ul>
</li>
</ol>
<!-----------------------------Copyright 1997-1998 Microsoft Corporation------------------------------>
<hr>
<center><font size=-1>
<A HREF="sdklegal.htm">&copy; 1997-1998 Microsoft Corporation. All rights reserved.</A>
</font></center>
<br>
<br>
<p>&nbsp;</p></body>
</HTML>
