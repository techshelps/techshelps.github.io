<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>GetAd Method</title>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css">
<br>
</HEAD>
<BODY BGCOLOR=#FFFFFF TEXT=#000000>

<h1><a name="ad_getad_method"></a>GetAd Method</h1>
<p>
The <b>GetAd </b>method selects the most appropriate advertisement and returns HTML text that can be inserted into the calling page.</p>
<p>
<b>Syntax</b></p>
<p>
<i>AdServerObject</i><b>.GetAd(</b>[<i>Response</i>]<i>, </i>[<i>TagList</i>]<i>,</i> [<i>History</i>]<b>)</b></p>
<p>
<b>Parameters</b></p>
<p class=dt>
<i>Response</i></p>
<p class=indent>
Optional. The ASP-intrinsic <b>Response</b> object, required for logging ad impression events to the IIS log file. The log file is later used by Usage Analyst. If this argument is omitted, the method does not log the ad impression event to the log file.</p>
<p class=dt>
<a href="adsrv_coref_14.htm"><i>TagList</i></a></p>
<p class=indent>
Optional. An array of text strings that specify the types of ads to be served and&nbsp; the way in which the ads are displayed on the page. </p>
<p class=dt>
<i>History</i></p>
<p class=indent>
Optional. A string Variant that contains the user's advertisement viewing history. The string is a comma-separated list of the campaign item ids (ciids) of the ads that have already been selected for the current user. The string is usually persisted only for the duration of a user session.</p>
<p>
<b>Examples</b></p>
<p>
The following example requests an ad from <b>AdServer</b> and enables it to record events for the returned ad to the IIS log file.&nbsp; </p>
<pre><code>&lt;% =Ad.GetAd(Response) %&gt;
</code></pre>
<p>
The following example creates a tag list, then passes this list to the <b>GetAd </b>method to specify a preference for ads targeted at people interested in sports and living in the Northwest region.</p>
<pre><code>&lt;% Set Ad = Application("Ad") %&gt;
&lt;% Taglist = Array("PageGroup.Sports", "Region.Northwest") %&gt;
&lt;% =Ad.GetAd (Response, TagList ) %&gt;
</code></pre>
<p>
The following example retrieves the visitor’s history string from the <b>Session </b>object, and makes a request for an ad that takes into consideration the visitor’s history. The AdServer uses the history string to exclude overexposed ads, delivers an ad, and appends the newly delivered ad to the history string. The last line of the script then resets the history to include the latest ad.</p>
<pre><code>&nbsp;&nbsp;&lt;% Dim HistoryString %&gt;
  &lt;% HistoryString = Session("HistoryString") %&gt;
 &nbsp;&lt;% = Ad.GetAd(Response, Null, HistoryString) %&gt;
 &nbsp;&lt;% Session("HistoryString") = HistoryString %&gt; 
</code></pre>
<p>
<b>Remarks</b></p>
<p>
In order for the <b>GetAd</b> method to log the impression event, you must set the logging properties for the Web site to enable URI Query. </p>
<p>
If the ad being served can be clicked (that is, if the campaign item was specified as type IMG or BUYNOW in the Ad Manager), this method creates an HREF tag that includes the value of the <b>RedirectURL</b> property. For example, AdServer creates the following HREF tag for a clickable Trey Research ad on the Ad Samples default.asp page. The URL of the click-through page, in this case /adsamples/Trey.asp, which is passed as a parameter to the Adredir.asp page is set on the Campaign Item page in the Ad Manager.</p>
<pre><code>&lt;A HREF<b>="</b>/adsamples/adredir.asp?ciid=4&amp;url=/adsamples/Trey.asp" TARGET=_top&gt;
</code></pre>
<p>
If the <b>GetAd </b>method cannot determine an appropriate ad, it returns the ad specified by the <b>DefaultAd</b> property. In this case, the <b>RedirectURL</b> property is not used.</p>
<p>
<b>See Also</b></p>
<p>
<a href="adsrv_coref_8.htm">RedirectURL</a>, <a href="adsrv_coref_6.htm">DefaultAd</a>, <a href="adsrv_coref_14.htm">Taglist Argument</a></p>
<!-----------------------------Copyright 1997-1998 Microsoft Corporation------------------------------>
<hr>
<center><font size=-1>
<A HREF="sdklegal.htm">&copy; 1997-1998 Microsoft Corporation. All rights reserved.</A>
</font></center>
<br>
<br>
</BODY>
</HTML>
