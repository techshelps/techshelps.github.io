<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Creating a Custom Channel Agent</title>
<style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css">
<br>
</HEAD>
<BODY BGCOLOR=#FFFFFF TEXT=#000000>

<h1><a name="pu_guide_building_a_custom_channel_agent"></a>Creating a Custom Channel Agent</h1>
<p>
The example below demonstrates building and using a custom Channel Agent.&nbsp; For the purposes of this SDK, a <i>custom channel agent </i>is any agent other than the agents that come installed with Site Server 3.0.</p>
<p>
This example agent will scan a specified folder for all Microsoft Word files and include them as content in a channel during a refresh cycle.&nbsp; In this case, the project is set up using a Windows Scripting Host Script (WSH).&nbsp; The top-level <a href="pushclassesref_8.htm">Channel</a> object is configured to run the agent as a "customagent" meaning that the <a href="pushclassesref_23.htm">RefreshScript</a> property will point to the script's location on the file system.&nbsp; 
<ul type=disc>
<li>
In the first code segment, a Windows Scripting Host (WSH) script is shown that creates an instance of the <b>Project</b> class.&nbsp; It then sets the top-level <b>Channel</b> object's <b>RefreshType</b> property to "userscript." (i.e. custom agent that the programmer specifies)&nbsp; It sets a few hypothetical options for the custom agent, and then executes the refresh cycle on the project.&nbsp; <br><br></li>
<li>
In the second code sample, the hypothetical custom agent is listed. In this example, the agent will scan the directory specified in the <b>RefreshOptions</b> collection under the key "DocsDir."&nbsp; In that directory, it will add all word documents it encounters into the <b>Channel</b> object as <b>Item</b> objects.&nbsp; This example could be used to keep subscribers abreast of say the latest specifications or memos present in the directory specified.&nbsp; </li>
</ul>
<p>
It should be stressed that this example is for illustration purposes only.&nbsp; Usually, it would be easier to build the <b>Project</b> object and <b>Channel</b> using one of the administrative tools such as MMC or WebAdmin.&nbsp; However, for testing purposes, the procedure listed below is quite useful.</p>
<h4>Building the Channel and Running the Refresh Cycle</h4>
<p>
(VBScript and Windows Scripting Host)</p>
<pre><code>' File: sample.vbs
' This WSH script builds a Project object, sets up the
'&nbsp; top level channel object's refresh information, 
'&nbsp; and runs the refresh cycle on the project
'&nbsp;&nbsp; 
'&nbsp;&nbsp; It will scan the specified directory for all 
'&nbsp;&nbsp;&nbsp; word documents (.doc) and automatically incorporate
'&nbsp;&nbsp;&nbsp; them into the channel</code></pre>
<p>
<code><br>
Option Explicit<br>
Dim Project<br>
Dim Channel<br>
Dim Options<br>
<br>
' Set up the Project with useful info<br>
Set Project = CreateObject("Push.Project")<br>
Project.Name="Test Project"<br>
Project.CDFFile="c:\channels\LatestSpecs.cdf"<br>
Project.Schedule.Startdate=#1/1/1998 19:00:00#<br>
Project.Schedule.IntervalTime = 360<br>
' suggest to subscribers that they 'check in'<br>
' every 6 hours for new content<br>
<br>
Set Channel = Project.Channel<br>
Set Options = Channel.RefreshOptions<br>
<br>
' Some useful (and hypothetical) Bibliographic info<br>
Channel.Base = "file://\\somemachine\TechSpecs\"<br>
Channel.Title="The Latest Specs on Widgets"<br>
Channel.Abstract="This channel contains all the latest specification documents for the Widget research"<br>
Channel.Authors.Add "Dr. John Doe"<br>
Channel.Authors.Add "Dr. Jane Doe"<br>
<br>
<br>
' Set up the refresh information<br>
<br>
Channel.RefreshType="USERSCRIPT"<br>
<br>
'&nbsp; here we will specify a custom script<br>
'&nbsp;&nbsp; that is listed below.&nbsp; The path to the<br>
'&nbsp;&nbsp;&nbsp; agent script is "c:\agentscripts\CustomTechRefresh"<br>
<br>
Channel.RefreshScript="c:\scripts\CustomTechRefresh"<br>
<br>
Options("DocsDir") = "c:\TechSpecs"<br>
 ' this option specifies where to find the .doc files<br>
<br>
'&nbsp; Now we run the refresh explicitly<br>
Project.Refresh<br>
<br>
' finished adding the items.&nbsp; Let's Schedule the refresh<br>
'&nbsp; on the server for every 6 hours<br>
call Project.SetTask("SomeUser",720,0)<br>
Project.Task.Update "password"<br>
'&nbsp; task should now be scheduled.&nbsp; The refresh cycle<br>
'&nbsp; will occur every 6 hours starting a 12 am midnight <br>
'&nbsp; every day<br>
<br>
Project.Save "TestProject"<br>
' save the project<br>
<br>
</code></p>
<h4>The Custom Agent</h4>
<p>
The code listed below is the custom agent.&nbsp; Notice the use of the built-in objects.</p>
<pre><code>' File: c:\scripts\CustomTechRefresh
'
'&nbsp; This script is an agent called by a Push.Channel object
'&nbsp;&nbsp; to refresh its content.&nbsp; It checks first to make sure
'&nbsp;&nbsp; a valid "DocDir" option is passed, and if so, does the 
'&nbsp;&nbsp; following:
'&nbsp;&nbsp;&nbsp; deletes all items marked with "DeleteonFresh" set to TRUE
'&nbsp;&nbsp;&nbsp; Scans the directory for .doc files
'&nbsp;&nbsp;&nbsp; Adds any it finds as items to the Channel object on whose
'&nbsp;&nbsp;&nbsp; behalf the agent is being run.

If not util.IsValidData(Options("DocDir"), vbString ) Then
  RaiseError("A valid string was not passed to the agent")
End If

Set fs = createobject("Scripting.FileSystemObject")
set folder = fs.GetFolder(Options("DocDir"))
For each File in folder.files
  NameExt = split(File.Name,".")
  If UBound(NameExt) &gt; 0 Then
 &nbsp;&nbsp; If NameExt(UBound(NameExt)) = "doc" Then
 &nbsp;&nbsp;&nbsp;&nbsp; Set Item = Channel.AddItem
 &nbsp;&nbsp;&nbsp;&nbsp; Item.HREF=File.Name
 &nbsp;&nbsp;&nbsp;&nbsp; Item.Title=File.Name
 &nbsp;&nbsp; End If
 &nbsp; End If
Next</code></pre>
<!-----------------------------Copyright 1997-1998 Microsoft Corporation------------------------------>
<hr>
<center><font size=-1>
<A HREF="sdklegal.htm">&copy; 1997-1998 Microsoft Corporation. All rights reserved.</A>
</font></center>
<br>
<br>
</BODY>
</HTML>
