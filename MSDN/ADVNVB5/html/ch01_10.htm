<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text-html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Tip 9: Trace the stack.</title>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY BGCOLOR=#FFFFFF TEXT=#000000>
<FONT FACE="Verdana,Arial,Helvetica" SIZE="2">
<h1><a name="tip9tracestack."></a>Tip 9: Trace the stack.</h1>
<p>
As you saw in the log file in Listing 1-3 on page 21, we dump the VBA call stack when we hit an unexpected error because it can be useful for working out later what went wrong and why. We build an internal representation of VBA’s stack (because VBA’s stack is not actually available—shame), using two fundamental routines: <i>TrTraceIn </i>and <i>TrTraceOut</i>. Here they are in a typical routine:</p>
<pre><code>Public Sub Testing()

' Set up general error handler.
On Error GoTo Error_General_Testing:

    Const sProcSig = MODULE &amp; " General.Testing"
    Call TrTraceIn(sProcSig)
    
    ' ========== Body Code Starts ==========
    §
    ' ========== Body Code Ends ==========
    
    Call TrTraceOut(sProcSig)
    Exit Sub
    
' Error handler
Error_General_Testing:
    §
End Sub</code></pre>
<p>
These routines are inserted by hand or by using the same internal tool I mentioned earlier in Tip 2 that adds line numbers to code. Notice that <i>sProcSig </i>is being passed into these routines so that the stack can be built containing the name of the module and routine.</p>
<p>
The stack frame object we use internally (not shown here) uses a Visual Basic collection with a class wrapper for its implementation. The class name we use is <i>CStackFrame</i>. As a prefix, <i>C</i> means class, and its single instance is named <i>oStackFrame</i>. We drop the <i>o</i> prefix if we’re replacing a standard class such as <i>Err </i>or <i>App</i>.</p>
<h1></h1>
</BODY>
</HTML>
