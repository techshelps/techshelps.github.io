<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text-html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Listing logins not in the database</title>
<style>@import url(stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="stylesheets/msdn_ie3.css"></HEAD>
<BODY BGCOLOR=#FFFFFF TEXT=#000000>
<FONT FACE="Verdana,Arial,Helvetica" SIZE="2">
<h1><a name="listingloginsnotindatabase"></a>Listing logins not in the database</h1>
<p>
If you want to know what users don’t have access to the database, you have to run an SQL SELECT statement like the one shown here that compares all of the logins to the users in the database. This comparison does not account for users who are aliased.</p>
<pre><code>SELECT&nbsp;name,&nbsp;suid&nbsp;FROM&nbsp;master.dbo.syslogins&nbsp;
WHERE&nbsp;suid&nbsp;NOT&nbsp;IN&nbsp;(SELECT&nbsp;suid&nbsp;FROM&nbsp;sysusers)

name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;suid&nbsp;&nbsp;&nbsp;
------------------------------&nbsp;------&nbsp;
probe&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
SimonR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;13&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
repl_publisher&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;16382&nbsp;&nbsp;
repl_subscriber&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;16383&nbsp;&nbsp;</code></pre>
<p>
This provides the data you can use to populate the ListView control on your security form.</p>
<pre><code>Private&nbsp;envPiEnvironment&nbsp;As&nbsp;rdoEnvironment
Private&nbsp;conPiConnection&nbsp;&nbsp;As&nbsp;rdoConnection

Private&nbsp;Sub&nbsp;Form_Load()
&nbsp;&nbsp;&nbsp;&nbsp;Dim&nbsp;rsLogins&nbsp;As&nbsp;rdoResultset
&nbsp;&nbsp;&nbsp;&nbsp;Dim&nbsp;strSQL&nbsp;&nbsp;&nbsp;As&nbsp;String

&nbsp;&nbsp;&nbsp;&nbsp;Set&nbsp;envPiEnvironment&nbsp;=&nbsp;rdoEngine.rdoEnvironments(0)
&nbsp;&nbsp;&nbsp;&nbsp;Set&nbsp;conPiConnection&nbsp;=&nbsp;envPiEnvironment.OpenConnection(&nbsp;_
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"DSName",&nbsp;rdDriverNoPrompt,&nbsp;False,&nbsp;"uid=;pwd=;")

&nbsp;&nbsp;&nbsp;&nbsp;'&nbsp;Retrieve&nbsp;the&nbsp;logins&nbsp;not&nbsp;in&nbsp;the&nbsp;database.
&nbsp;&nbsp;&nbsp;&nbsp;strSQL&nbsp;=&nbsp;"SELECT&nbsp;name,&nbsp;suid&nbsp;FROM&nbsp;master.dbo.syslogins&nbsp;"&nbsp;&amp;&nbsp;_
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;WHERE&nbsp;suid&nbsp;NOT&nbsp;IN&nbsp;(SELECT&nbsp;suid&nbsp;FROM&nbsp;sysusers)"
&nbsp;&nbsp;&nbsp;&nbsp;Set&nbsp;rsLogins&nbsp;=&nbsp;conPiConnection.OpenResultset(strSQL,&nbsp;_
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rdOpenForwardOnly,&nbsp;rdConcurReadOnly,&nbsp;rdExecDirect)

&nbsp;&nbsp;&nbsp;&nbsp;Do&nbsp;Until&nbsp;rsLogins.EOF
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Call&nbsp;lsvLogins.ListItems.Add(,&nbsp;rsLogins!Name,&nbsp;_
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rsLogins!Name,&nbsp;,&nbsp;"Person")
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rsLogins.MoveNext
&nbsp;&nbsp;&nbsp;&nbsp;Loop

&nbsp;&nbsp;&nbsp;&nbsp;'&nbsp;...&nbsp;More&nbsp;code&nbsp;follows

&nbsp;&nbsp;&nbsp;&nbsp;rsLogins.Close
End&nbsp;Sub</code></pre>
<p>
You can see from the code how easy it is to open a connection to the ODBC data source, passing no user ID and no password, which invokes integrated security.</p>
<p>
When you open the resultset, specify settings for a forward-only (rdOpenForwardOnly), read-only (rdConcurReadOnly) resultset that is to be created without making a temporary stored procedure (rdExecDirect). These settings are chosen because you’re going to copy the data out of the resultset into the ListView control and then close the resultset. This routine is executed only once, in the Form_Load procedure, so you don’t have to be able to run the statement again (hence the use of rdExecDirect).</p>
<h1></h1>
</BODY>
</HTML>
