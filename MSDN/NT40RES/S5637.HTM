<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Loading the Kernel</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY BGCOLOR="#FFFFFF"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><FORM NAME="x"><OBJECT CLASSID="clsid:9c2ac687-ceef-11cf-96d9-00a0c903b016" NAME="iv"></OBJECT></FORM>
<H3>Loading the Kernel</H3><P CLASS="t">When you press ENTER on the <B>Hardware Profile/Configuration Recovery </B>menu or the boot loader automatically makes the selection for you, the computer is in the Kernel load phase of Windows&nbsp;NT startup. You see several dots as the boot loader loads the Windows&nbsp;NT Kernel (Ntoskrnl.exe) and the hardware adaption layer (Hal.dll) into memory. It does not initialize these programs yet. Next, the boot loader loads the Registry key HKEY_LOCAL_MACHINE\SYSTEM from <I>%systemroot%</I>\System32\Config\System.</P>
<P CLASS="t">At this point, the boot loader creates the control set it will use to initialize the computer. The value in the HKEY_LOCAL_MACHINE\SYSTEM\Select subkey determines which control set in HKEY_LOCAL_MACHINE\SYSTEM to use. The loader uses the control set identified by the Default value, unless you are starting by using the Last Known Good Configuration. In this case, the value under LastKnownGood specifies the control set. Based on your selection and the value of the corresponding Select subkey, the loader determines which ControlSet00<I>x</I> to use. It sets the value of Current in the Select subkey to the number of the control set it will use. </P>
<P CLASS="t">See "Control Sets in the Registry," presented later in this chapter, for more information about the Select subkey and control sets.</P>
<P CLASS="t">At this time, the boot loader scans all of the services in the Registry subkey HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services for device drivers with a Start value of 0x0, which indicates that they should be loaded but not initialized. Device drivers with these values are typically low-level hardware device drivers, such as hard disk device drivers. The Group value for each device driver determines the order in which the boot loader loads them. The Registry subkey HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\ ServiceGroupOrder defines the loading order. </P>
<P CLASS="t">On x86-based computers, the loading of these device drivers into memory is done using BIOS INT 13 calls in real mode (or by Ntbootdd.sys).</P>
<P CLASS="t">On RISC-based computers, OSLOADER calls firmware primitives to find and load the critical files into memory. </P>
<P CLASS="t">The <I>Windows&nbsp;NT Workstation Resource Kit</I> CD contains more information about the Registry in the Help file Regentry.hlp. When you install the Resource Kit, double-clicking the Registry Help File icon opens the Regentry.hlp. </P></BODY></HTML>
