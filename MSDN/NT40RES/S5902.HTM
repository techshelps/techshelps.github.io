<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>MS-DOS Environment</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY BGCOLOR="#FFFFFF"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><FORM NAME="x"><OBJECT CLASSID="clsid:9c2ac687-ceef-11cf-96d9-00a0c903b016" NAME="iv"></OBJECT></FORM>
<H3>MS-DOS Environment</H3><P CLASS="t">MS-DOS-based applications run on Windows&nbsp;NT&nbsp;4.0 in a process called an <I>NT</I>&nbsp;<I>Virtual DOS Machine</I> (NTVDM). NTVDM is a 32-bit Windows application that simulates an Intel 486 computer running MS-DOS.</P>
<P CLASS="t">Each MS-DOS application runs in a separate NTDVM process, although all are named Ntvdm.exe by default. An unlimited number of NTVDM processes can be run. Each runs in its own address space. This protects the applications from each other and protects the rest of the operating system from the NTVDMs. </P>
<P></P>
<P CLASS="t"><B>Note</B></P>
<P>You can change the name of the process in which MS-DOS applications run by editing the configuration registry. For details, see "Monitoring MS-DOS Applications" in Chapter 9, "The Art of Performance Monitoring."</P>
<P></P>
<P CLASS="t">When Windows&nbsp;NT is running on an Intel 486 or higher processor, a processor mode called <I>Virtual-86</I> mode is available. This mode allows direct execution of most instructions in an MS-DOS-based application. A few instructions  (such as I/O instructions) must be emulated in order to communicate with the hardware. On RISC processors, NTVDM emulates all Intel 486 instructions in addition to providing a virtual hardware environment.</P>
<P CLASS="t">An NTVDM running a MS-DOS application consists of three threads: an application thread on which the MS-DOS application runs, a <I>heartbeat</I> thread which simulates the timer interrupts to the MS-DOS application, and a console thread which handles console I/O for the application.</P>
<P CLASS="t">To run MS-DOS-based applications, the NTVDM creates a virtual computer including support for:</P>
<UL><LI>Intel <I>x</I>86 instructions, provided by the Instruction Execution Unit </LI></UL><UL><LI>Read-only memory basic input and output (ROM BIOS) interrupt services, provided by the MS-DOS emulation module </LI></UL><UL><LI>MS-DOS Interrupt 21 services, provided by the MS-DOS emulation module</LI></UL><UL><LI>Virtual hardware for devices, such as the screen and keyboard, provided by Virtual Device Drivers</LI></UL><P></P>
<P><img src="xwr_d12.gif"></P>
<P>Figure 5.8    Structure of an MS-DOS NTVDM</P>
<P></P>
<P CLASS="t">On Intel 486-based computers, character-based applications can run either in a window or in a full screen. Graphic applications can run only in full screen. If an application in a window changes its video mode, it is automatically switched to full screen. On RISC-based computers, character-based and graphic applications run only in a window.</P></BODY></HTML>
