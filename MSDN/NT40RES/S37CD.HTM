<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Saving and Restoring Keys</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY BGCOLOR="#FFFFFF"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><FORM NAME="x"><OBJECT CLASSID="clsid:9c2ac687-ceef-11cf-96d9-00a0c903b016" NAME="iv"></OBJECT></FORM>
<H3>Saving and Restoring Keys</H3><P CLASS="t">You can use <B>Regedt32</B> or <B>Regedit</B> to save all or part of a Registry subtree to a file. This file can then be used to restore that Registry or the Registry of another computer by replacing a damaged key with the contents of the file. If you save the key to a file by using <B>Regedt32</B>, you can also load the file into <B>Regedt32</B> on any computer to examine its contents or to edit it.</P>
<P CLASS="t"><B>Regedt32</B> and <B>Regedit</B> save Registry keys in different formats and use different methods for restoring the Registry. Decide which tool you will use before beginning the process. You cannot save a key to a file with one tool and use the other tool to restore a Registry with that file.</P>
<UL><LI><B>Regedt32</B> saves Registry keys in a compressed format similar to that used by the system for its own hive files. You can load these files into <B>Regedt32</B> on any computer to examine or edit them. You can also use <B>Regedt32</B> to restore a damaged Registry key by replacing the damaged key with the contents of the saved file.</LI><LI><B>Regedit</B> saves Registry keys to a text file with a .reg filename extension. You cannot view or edit the contents of a .reg file from within <B>Regedit</B>, but you can view the file contents in any text editor, such as Notepad. (You should not edit a .reg file unless you know the format.) You can also use <B>Regedit</B> to replace Registry keys with the contents of a .reg file by importing the file into the Registry. </LI></UL><P></P>
<P CLASS="t">The remainder of this section describes how to save and restore Registry keys by using <B>Regedt32</B> and <B>Regedit</B>.</P>
<H4><A NAME="sec0"></A>Using Regedt32 to Save and Restore Registry Keys</H4><P CLASS="t">To save a Registry key and its subkeys to a hive file, use the <B>Save Key</B> command in <B>Regedt32</B>. You can then use the <B>Load Hive</B> command in <B>Regedt32</B> to view and edit the file and use the <B>Restore </B>command to replace a Registry key with the file contents.</P>
<P></P>
<P CLASS="t"><B>Note</B></P>
<P>Do not confuse the hive files you create by using the <B>Save Key</B> command with the hive files created by the system for its own use. The system hive file of a remote computer, usually stored in <I>Systemroot</I>\System32\Config and <I>Systemroot</I>\Profiles, can be loaded or restored only while Windows&nbsp;NT is not running on that computer.</P>
<P></P>
<P CLASS="t">Changes in the Registry are saved automatically, whether you make changes by using a Registry editor or by changing settings in applications. The <B>Save Key</B> command is used specifically to save portions of the Registry as a file on disk.</P>
<P CLASS="t">To use the <B>Save Key</B> command, you need Backup permissions, which you have if you are logged on as a member of the Administrators group. </P>
<P CLASS="t">You can use the <B>Save Key</B> command on any key. However, you cannot save volatile keys. A <I>volatile</I> key is one that is created when the system starts and deleted when it stops. Some volatile keys have nonvolatile subkeys that can be saved. For example, the HKEY_LOCAL_MACHINE\Hardware key is volatile, but you can save the nonvolatile subkeys under that key. To view the entire Hardware key for debugging, save it in a text file by using the <B>Save Subtree As</B> command on the <B>Registry</B> menu, as described later in this chapter.</P>
<H5 CLASS="h4"><A NAME="sec1"></A>To save a Registry key by using Regedt32</H5><P>    1.    Select the key that you want to save as a hive file on a disk.</P>
<P>    2.    From the <B>Registry</B> menu, click <B>Save Key</B>, then type a filename for the saved file in the <B>Save Key</B> dialog box.</P>
<P></P>
<P CLASS="t"><B>Note</B></P>
<P>When saving a hive file on a remote computer, use a path relative to the remote computer, not to the local computer. For example, if you are using your G: drive to connect to \\Text01\Public to save Hive.tst, enter <B>\\Text01\Public\Hive.tst</B>, not <B>G:\Hive.tst</B>. The G:\Hive.tst entry directs <B>Regedt32</B> to save the file on the G: drive of the remote computer, not the G: drive of the local computer.</P>
<P></P>
<P></P>
<P CLASS="t">The selected key is now saved as a file. When you use the <B>Load Hive</B> command, you can select the filename for any files that you saved by using the <B>Save Key</B> command.</P>
<P></P>
<P CLASS="t">For example, as part of system maintenance, you use the <B>Save Key</B> command to save a key as a file. When the key that you saved is ready to be returned to the system, you use the <B>Restore</B> command.</P>
<P CLASS="t">You can use the <B>Restore</B> command to make a hive file a part of the system configuration by loading the data from the hive file into an existing key. The contents of the file overwrite and replace the contents of the Registry key, except for the key name.</P>
<P CLASS="t">To use the <B>Restore</B> command, you need Restore permissions, which you have if you are logged on as a member of the Administrators group.</P>
<H5 CLASS="h4"><A NAME="sec2"></A>To restore a key by using Regedt32</H5><P>    1.    Select the key you want to restore from a hive file.</P>
<P>    2.    From the <B>Registry</B> menu, click <B>Restore</B>, then enter the name of the hive file from which data will be taken to overwrite the key.</P>
<P></P>
<P CLASS="t"><B>Note</B></P>
<P>When restoring a hive from a file on a remote computer, use a path relative to the remote computer, not to the local computer. </P>
<P></P>
<P></P>
<P CLASS="t">You cannot restore a key while the system is using it or any of its subkeys. For example, you cannot restore the SAM or Security keys because the system is always using these keys. The <B>Restore</B> command is used only for special conditions, such as to restore user profiles on a damaged system. To switch to a backup version of a hive, use <B>Regrest.exe</B>, a tool distributed on the <I>Windows&nbsp;NT Workstation Resource Kit</I> CD. For more information about <B>Regrest</B>, see Rktools.hlp, a Help file for tools on the <I>Windows&nbsp;NT Workstation Resource Kit</I> CD.</P>
<H4><A NAME="sec3"></A>Using Regedit to Save Registry Keys</H4><P CLASS="t">You can save Registry keys and their subkeys by using the <B>Export Registry</B> command in <B>Regedit</B>. This command saves a specific branch or the entire Registry in a text file with a .reg filename extension. Later, you can use the <B>Import Registry</B> command to rebuild a key or the entire Registry from an exported Registry file.</P>
<P CLASS="t">You can run <B>Regedit</B> from the <B>Regedit</B> window within Windows&nbsp;NT or from a command prompt. This section describes both methods.</P>
<H5 CLASS="h4"><A NAME="sec4"></A>To save a Registry key by using the Regedit window</H5><P>    1.    From the <B>Registry</B> menu, click <B>Export Registry File.</B> </P>
<P>    2.    In the <B>Export Range</B> box of the <B>Export Registry File</B> dialog box, specify the part of the Registry you want to save. </P>
<UL><LI>Click <B>All</B> to save the entire Registry </LI></UL><P>– Or –</P>
<UL><LI>Click <B>Selected Branch</B> to save a subtree, key, or subkey. </LI></UL><P>The <B>Selected Branch</B> edit box displays the name of the Registry keys or subkeys that were selected when you clicked the command. You can save that key or type the name of any key over it. (<B>Regedit</B> saves the key you select and all of the subkeys and value entries it contains.)</P>
<P>    3.    Type a path and filename for the Registry file in the <B>File name</B> edit box, or navigate to a folder by using the Windows&nbsp;NT Explorer interface in the <B>Export Registry File</B> dialog box, then type a filename. </P>
<P><B>Regedit</B> appends the .reg filename extension to the filename you enter.</P>
<P>    4.    Click <B>Save</B> to return to <B>Regedit</B>.</P>
<P></P>
<H5 CLASS="h4"><A NAME="sec5"></A>To save a Registry key by using Regedit from a command prompt.</H5><P> <FONT FACE="symbol">·</FONT>    Run <B>Regedit</B> from a command prompt to export Registry keys to .reg files. Use the following format:</P>
<P><B>regedit /e</B> <I>Filename</I>.reg [<I>Registry key</I><B>]</B></P>
<P>The <I>Registry key</I> field is optional. The default is to export the entire Registry to a file.</P>
<P></P>
<H4><A NAME="sec6"></A>Using Regedit to Restore Registry Keys</H4><P CLASS="t">You can restore or replace a Registry key by importing a .reg file containing that key into the Registry. The contents of the Registry key are overwritten and replaced by the contents of the .reg file. If the Registry that is being restored is running on a computer that can still run Windows&nbsp;NT, use the <B>Regedit</B> window to restore the key. However, you can also run <B>Regedit</B> from the command prompt, if necessary.</P>
<P CLASS="t">This section describes the <B>Regedit</B> window interface method first, then the command prompt method.</P>
<P CLASS="t"><B>Warning   </B>Use extreme caution in restoring keys. As with any Registry changes, an error can prevent Windows&nbsp;NT from loading and running, or prevent users from logging on to the system.</P>
<H5 CLASS="h4"><A NAME="sec7"></A>To restore a Registry key by using the Regedit window</H5><P>    1.    From the <B>Registry</B> menu, click <B>Import Registry File</B>.</P>
<P>    2.    Locate the .reg file you are using to restore the Registry key, then click <B>OK</B>.</P>
<P></P>
<H5 CLASS="h4"><A NAME="sec8"></A>To restore a Registry key by using Regedit from a command prompt</H5><P> <FONT FACE="symbol">·</FONT>    If the Registry is damaged or if the system no longer starts, run <B>Regedit</B> from a command prompt to diagnose and correct the problem. From the command line, use <B>Regedit</B> commands to export, import, or create a Registry. </P>
<P></P>
<P CLASS="t">You can also import Registry keys to .reg files from a command prompt. Use the following format:</P>
<P CLASS="t"><B>regedit /i</B> <I>filename</I><B>.reg</B></P>
<P CLASS="t">– Or –</P>
<P CLASS="t"><B>regedit /c</B> <I>filename</I><B>.reg</B></P>
<P CLASS="t">The <B>/i</B> (import) switch is used to import .reg files that contain a part of the Registry. The Registry keys (and their contents) saved in the .reg file overwrite only the analogous keys in the Registry. Please note that this command does not have a field to specify a Registry key. All of the Registry keys (and their subkeys and values) saved in the .reg file overwrite the analogous keys in the Registry. You cannot specify that only a subset of the keys be replaced.</P>
<P CLASS="t">The <B>/c</B> (complete) switch assumes that the .reg file contains a copy of an entire Registry. The contents of the .reg file overwrite all keys in the Registry.</P>
<P CLASS="t"><B>Caution   </B>Use the <B>regedit&nbsp;/c</B> command with extreme care, and only when you are sure that the .reg file specified contains a complete image of the Registry. The <B>regedit&nbsp;/c </B>command replaces the entire contents of the Registry. </P></BODY></HTML>
