<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Monitoring the Nonpaged PoolJBJB</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY BGCOLOR="#FFFFFF"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><FORM NAME="x"><OBJECT CLASSID="clsid:9c2ac687-ceef-11cf-96d9-00a0c903b016" NAME="iv"></OBJECT></FORM>
<H3>Monitoring the Nonpaged PoolJBJB</H3><P CLASS="t">The nonpaged pool is an area of kernel-mode operating system memory reserved for objects that cannot be paged to disk. The size of the nonpaged pool is adjusted by the Virtual Memory Manager based on the amount of physical memory in the computer and on the demand for pool space by applications and services. On workstations, the absolute size of the nonpaged pool is not relevant to performance monitoring. However <I>pool leaks</I>, which are characterized by continuous, unexplained growth in the nonpaged pool, are a concern. Pool leaks usually result from an application error. They can cause a memory shortage because space occupied by the pool is no longer available to other processes.</P>
<P CLASS="t">For more information about memory pools, see "Terms and Concepts" earlier in this chapter.</P>
<P></P>
<P CLASS="t"><B>Note</B></P>
<P>The size of the nonpaged pool usually is not a concern on workstations, but can be a factor on servers where the number of trusting account (user) domains depends on the size of the nonpaged pool. For more information, see "Number of Trusted Domains" in Windows&nbsp;NT Networking Guide, Chapter 2, "Network Security and Domain Planning."</P>
<P></P>
<P CLASS="t">Many performance monitoring tools monitor the paged and nonpaged memory pools. Process Explode (Pview.exe), Process Monitor (Pmon.exe) and Process Viewer (Pviewer.exe), tools included the Windows NT Resource Kit 4.0 CD, display the amount of space in the pools allocated to each process. Task Manager and Performance Monitor display the total size of each memory pool as well as the space allocated to each process. Although their display formats vary widely, all of the these tools collect their data from the same internal counters.</P>
<P></P>
<P CLASS="t"><B>Important</B></P>
<P>The internal counters that measure the size of the nonpaged pool for each process are not precise. The counter values are estimates which count duplicated object handles as well as space for the object. Also, because the process pool size counts are rounded to page size, pool space is overestimated when a process is using part of a page. Therefore, it is important to monitor <I>changes</I> in pool size for a process, not the absolute value. Total pool size counts are precise. Therefore, the sum of pool sizes for each process might not equal the value for the whole system. </P>
<P></P>
<P CLASS="t">In Task Manager, the current size of the nonpaged pool is listed in the Kernel Memory box on the Performance tab. On the Processes tab, you can add a column to monitor the size of the nonpaged pool allocated to each process. For more information, see "Task Manager" in MESMESChapter 11, "Performance Monitoring Tools."</P>
<P CLASS="t">Performance Monitor lets you to log changes in pool size over time. Pool size changes slowly, so you might have to log for several hours or even days to catch a pool leak. Use these Performance Monitor counters to monitor the pool size:</P>
<UL><LI>Memory: Pool Nonpaged Bytes</LI></UL><UL><LI>Memory: Pool Nonpaged Allocations</LI></UL><UL><LI>Process: Pool Nonpaged Bytes</LI></UL><P></P>
<P CLASS="t">The counters on the Memory object monitor the total size of the nonpaged pool and the number of allocations of pool space for the whole system. The counter on the Process object monitors nonpaged pool space allocated to each process.</P>
<P CLASS="t">To use Performance Monitor to monitor the nonpaged pool for leaks, follow these procedures:</P>
<UL><LI>Record the size of the nonpaged pool when the system starts. Then log the Memory and Process objects for several days at a 60-second interval. You should be able to associate any increases in the size of the pool, as indicated by Nonpaged Pool Bytes, with the start of a process, as indicated by Process: % Processing Time. When processes are stopped, you should see a decrease in pool size.</LI></UL><UL><LI>Set a Performance Monitor alarm to notify you when Nonpaged Pool Bytes increases by more than 10% from its value at system startup.</LI></UL><P></P>
<P CLASS="t">After the system is started, the nonpaged pool should increase in size only when a process is started. When the process ends, the nonpaged pool should return to its original size. Any other unexplained growth in the nonpaged pool is considered to be abnormal.</P>
<P CLASS="t">Pool leaks typically occur when an application creates objects, then fails to close their handles when it is done with them, or when an application repeatedly opens a file or other object unnecessarily. Each time the application attempts to open the objectMESMES, more space is allocated for the same object in the nonpaged pool. The bytes allocated for the pool come from physical memory, and an unnecessarily large pool denies those bytes to the operating system and applications.</P>
<P CLASS="t">Windows NT dynamically adjusts the size of the paged and nonpaged memory pools for optimum performance. However, you can change the size of the paged and nonpaged pools on Windows&nbsp;NT Workstations and Servers by editing the Registry. Use Regedt32 or Regedit, tools installed with Windows&nbsp;NT, to edit the Registry. Editing the Registry might cause serious system problems that require reinstalling Windows&nbsp;NT. The values for this Registry entry are entered in bytes.</P>
<P CLASS="t">The registry parameters for paged and nonpaged pool are in:</P>

<TABLE COLS="2" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="85pt" VALIGN="TOP"><COL WIDTH="262pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P>Subtree</P></TD><TD VALIGN="TOP"><P>HKEY_LOCAL_MACHINE</P></TD></TR><TR><TD VALIGN="TOP"><P>Key</P></TD><TD VALIGN="TOP"><P>\System\CurrentControlSet\Control\SessionManager<BR>\MemoryManagerment</P></TD></TR><TR><TD VALIGN="TOP"><P>Name</P></TD><TD VALIGN="TOP"><P>NonPagedPoolSize<BR>PagedPoolSize</P></TD></TR><TR><TD VALIGN="TOP"><P>Type</P></TD><TD VALIGN="TOP"><P>REG_DWORD</P></TD></TR></TBODY></TABLE>
<P CLASS="spacing"><BR></P><P></P></BODY></HTML>
