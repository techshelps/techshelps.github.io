<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>User Mode and Privileged Mode</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY BGCOLOR="#FFFFFF"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><FORM NAME="x"><OBJECT CLASSID="clsid:9c2ac687-ceef-11cf-96d9-00a0c903b016" NAME="iv"></OBJECT></FORM>
<H3>User Mode and Privileged Mode</H3><P CLASS="t">Another aspect of thread behavior is whether it is running in user mode or privileged mode:</P>
<UL><LI><I>User mode</I> is the processing mode in which applications run. Threads running in user mode are running in their own application code or the code of another user mode process, such as an environment subsystem. Processes running in user mode cannot access hardware directly and must call operating system functions to switch their threads to privileged mode to use operating system services.</LI></UL><UL><LI><I>Privileged</I> or <I>kernel mode</I> is the processing mode that allows code to have direct access to all hardware and memory in the system. The Windows&nbsp;NT Executive runs in privileged mode. Application threads must be switched to privileged mode to run in operating system code. Applications call privileged-mode operating system services for essential functions such as drawing windows, receiving information about user keyboard and mouse input, and checking security. </LI></UL><P CLASS="t">For more information about user mode and kernel mode, see "Windows NT Workstation Architecture," earlier in this book.</P>
<P CLASS="t">You can determine the percentage of time that threads of a process are running in user and privileged mode. Process Viewer (Pviewer.exe), a tool on the Windows NT Resource Kit 4.0 CD in the Performance Tools group, displays the proportion of user and privileged time for each running process and, separately, for each thread in the process. It can monitor local and remote computers and requires no setup. For more information about Process Viewer, see Chapter 11, "Performance Monitoring Tools," and Rktools.hlp.</P>
<P><img src="xwr_l19.gif"></P>
<P></P>
<P CLASS="t">Performance Monitor has % Privileged Time and % User Time counters on the System, Processor, Process, and Thread objects. These counters are described in "Understanding the Processor Counters" earlier in this chapter.</P>
<P CLASS="t">In the user time and privileged time counters, Performance Monitor displays the proportion of total processor time that the process is spending in user or privileged mode. While Process Viewer values sum to 100%, Performance Monitor values sum to their percentage of processor time.</P>
<P CLASS="t">The following figure is a Performance Monitor report on the proportion of user and privileged time for three processes.</P>
<P><img src="xwr_l38.gif"></P>
<P CLASS="t">In this example, Perfmon, the Performance Monitor process is running mainly (80%) in privileged mode, perhaps collecting data from the Performance Library which resides in the Windows&nbsp;NT Executive. Taskmgr, the Task Manager process is also running mainly in privileged mode (70%), though this proportion varies significantly as the process runs. In contrast, CpuStres, the process for the CPU Stress test tool, runs entirely in user mode all of the time.</P>
<P CLASS="t">The following graph shows the proportion of user and privileged time for each thread of the Task Manager process.</P>
<P><img src="xwr_l37.gif"></P></BODY></HTML>
