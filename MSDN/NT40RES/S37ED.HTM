<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Backing Up and Restoring Registry Hives</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY BGCOLOR="#FFFFFF"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><FORM NAME="x"><OBJECT CLASSID="clsid:9c2ac687-ceef-11cf-96d9-00a0c903b016" NAME="iv"></OBJECT></FORM>
<H3>Backing Up and Restoring Registry Hives</H3><P CLASS="t">You might need to restore backed-up versions of Registry hives. This can occur, for example, when a new computer replaces an old one, when a disk controller or hard disk becomes corrupted, or when an electrical failure erases large parts of a disk. This section describes how to back up and restore Registry hives.</P>
<P CLASS="t">How this restoration is done depends on what hardware is available and what file system is in use. You can, of course, restore only what you have backed up. </P>
<P></P>
<P CLASS="t"><B>Important</B></P>
<P>Back up all important files, including system files, frequently and consistently.</P>
<P>Your regular backup routine should include using Disk Administrator to create an uncompressed backup of the System hive. (In Disk Administrator, from the <B>Partition</B> menu, click <B>Configuration</B>, then click <B>Save</B>.) Also, the Emergency Repair Disk includes a compressed version of the System hive. For details, see Disk Administrator Help, and Chapter 20 of this book, "Preparing for and Performing Recovery."</P>
<P></P>
<H4><A NAME="sec0"></A>Backing Up Registry Hives</H4><P CLASS="t">You can make a Registry hive backup in one of four ways:</P>
<UL><LI>Use a tape drive and the Windows&nbsp;NT Backup program. To automatically include a copy of the local Registry files in the backup set, select the <B>Backup Local Registry</B> option in the <B>Backup Information</B> dialog box. This is the preferred method for creating backups if you have a tape drive. </LI></UL><UL><LI>If you do not have a tape drive, use a utility that backs up the Registry, such as the Repair Disk Utility (<B>Rdisk.exe</B>), which is automatically installed when you install Windows&nbsp;NT. You can also use <B>Regback.exe</B>, a tool included on the <I>Windows&nbsp;NT Workstation Resource Kit</I> CD. For more information, see Repair Disk Utility Help or Rktools.hlp on the <I>Windows&nbsp;NT Workstation Resource Kit</I> CD. </LI></UL><P></P>
<UL><LI>Use a different operating system to start the computer. Then copy all files in the <I>Systemroot</I>\System32\Config directory to a safe backup location. For example, use another instance of Windows&nbsp;NT if the Registry is stored on an NTFS partition, or use MS-DOS if the Registry is stored on a FAT partition.</LI></UL><UL><LI>In <B>Regedt32</B>, use the <B>Save Key</B> command, which backs up Registry keys manually.</LI></UL><P>For each key immediately below HKEY_LOCAL_MACHINE and HKEY_USERS, click the key, and then, from the <B>Registry</B> menu, click <B>Save Key</B>. Choose filenames that match the key names. For example, save the System key to \Backdir\System. </P>
<P></P>
<P CLASS="t"><B>Note</B></P>
<P>Volatile subkeys, that is, those created each time the system starts and deleted when it stops, cannot be saved. However, you can save the nonvolatile subkeys of volatile keys. For example, although the HKEY_LOCAL_MACHINE\Hardware key is volatile, you can save nonvolatile subkeys under that key.</P>
<P></P>
<P></P>
<H4><A NAME="sec1"></A>Restoring Hives from Backup Files</H4><P CLASS="t">If you have a good set of backup files, which you update regularly, you can restore Registry hives that are damaged or missing. </P>
<P CLASS="t">But you cannot use Registry Editor to fully restore hives, because you must use the <B>ReplaceKey</B> operation to restore active parts of the Registry. Registry Editor cannot perform this operation.</P>
<P CLASS="t">To restore a damaged system, you must first restore the basic operating system installation. To do this, you can use the Emergency Repair Disk to restore your system to its postinstallation status, or you can simply run Windows&nbsp;NT Setup again. If you rerun Setup, the system starts the computer but lacks changes made since you first set it up. You can recover most of those changes if you copy files from backups by using the Windows&nbsp;NT Backup program for tape backups or by copying from disk backups.</P>
<P></P>
<P> </P>
<P CLASS="t"><B>Tip</B></P>
<P>To update the Emergency Repair Disk after making changes that affect the Registry, use the Repair Disk Utility (<B>Rdisk.exe</B>), a tool included in Windows&nbsp;NT. If you use the <B>rdisk</B><B><I> </I></B>command alone (no switches), it backs up the System and Software hives only. If you use <B>rdisk /s</B>, it backs up the SAM and Security hives as well. However, if the system includes many user accounts, the file might be too large to fit on the single floppy disk required for the Emergency Repair Disk update process.</P>
<P></P>
<P></P>
<P CLASS="t">However, you cannot merely copy the backups of Registry hive files, because those files are protected while Windows&nbsp;NT is running. So, after the system and all of the additional files such as device drivers are restored, you must restore the Registry. You can do this in one of the following ways, depending on which backup mechanism you used:</P>
<UL><LI>For tape backups, you can use Windows&nbsp;NT Restore to restore the Registry. </LI></UL><UL><LI>Start the computer by using an alternative instance of the operating system (or using MS-DOS if the system files are on a FAT partition). Copy the files to the <I>Systemroot</I>\System32\Config directory. Then restart the computer by using the regular operating system.</LI></UL><P></P>
<UL><LI>Use <B>Regrest.exe</B>, a tool included on the <I>Windows&nbsp;NT Workstation Resource Kit</I> CD. <B>Regrest</B> replaces the default files installed by Windows&nbsp;NT Setup with data from backup files, and saves the default files under other filenames. To see the restored Registry, restart the computer after running <B>Regrest</B>.</LI></UL><P></P></BODY></HTML>
