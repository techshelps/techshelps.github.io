<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Using Sysdiff</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY BGCOLOR="#FFFFFF"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><FORM NAME="x"><OBJECT CLASSID="clsid:9c2ac687-ceef-11cf-96d9-00a0c903b016" NAME="iv"></OBJECT></FORM>
<H2>Using Sysdiff</H2><P>Sysdiff is used in several steps. </P>
<P>    1.    First, run <B>sysdiff /snap </B>to take a snapshot of the Windows&nbsp;NT retail version of the system after it has been installed on a reference computer. The reference computer needs to be of the same general hardware type (x86, MIPS, Alpha, or PowerPC) as the destination computers. The %systemroot% (for example, C:\Winnt) must be the same on the reference and destination computers.</P>
<P>    2.    Then, after the system has been customized by installing applications, run <B>sysdiff /diff </B>again to create the difference file. </P>
<P>    3.    Finally, run <B>sysdiff /apply</B> as part of an Unattended Setup to apply the difference file to a new installation. The <B>sysdiff /apply</B> command can also be run at any time after installation is complete.</P>
<P>Alternately, run <B>sysdiff /inf</B> to create an INF and add the files included in the difference file to the $OEM$ directory tree. Then invoke the INF with a command in the $OEM$\Cmdlines.txt file, or at any time after installation is complete.</P>
<P>    4.    Optionally, you can run <B>sysdiff /dump</B> to dump the difference file information in a form that you can read. Use the <B>sysdiff /dump</B> command to review the contents of the difference file. </P>
<P></P>
<P CLASS="t">If you want to distribute computers or hard disks that are ready for GUI-mode setup, use the <B>winnt /u</B> or <B>winnt32 /u</B> command to install your customized version of Windows&nbsp;NT Workstation, including the difference file — but stop the process after text mode Setup is complete by turning off the computer. Then duplicate the hard disk, using the <B>xcopy</B> command. The duplicated disks will include all the information copied during text mode, including the contents of the $OEM$ directory and its subdirectories. These directories will be deleted, along with other temporary directories used by Setup, after GUI mode setup is completed. GUI mode setup proceeds the first time the computer is turned on.</P>
<P CLASS="t">The sysdiff process is shown in the following illustrations (Figures 2.1 and 2.2).</P>
<P><img src="xwr_b01.gif"></P>
<P>Figure 2.1    Pre-installation using sysdiff</P>
<P><img src="xwr_b02.gif"></P>
<P>Figure 2.2    Creating and applying a sysdiff package</P>
<H3><A NAME="sec0"></A>To create the snapshot file</H3><P>    1.    Install the retail version of Windows&nbsp;NT Workstation or Windows&nbsp;NT Server on a computer of the same general type (x86, Alpha, MIPS, or PowerPC) as the destination computers. </P>
<P>    2.    At the command prompt, type the following command:</P>
<P CLASS="spacing"><BR></P>
<PRE><B>sysdiff /snap</B> [<B>/log:</B><I>log_file</I>] <I>snapshot_file</I>
</PRE>
<P>where:</P>
<P CLASS="term2"><B>log_file </B></P>
<P CLASS="dt2">is the name of an optional log file created by <B>sysdiff</B>.</P>
<P CLASS="term2"><B>snapshot_file</B></P>
<P CLASS="dt2">is the name of the file containing the snapshot of the system. Specify any valid Win32-based filename.</P>
<P></P>
<H3><A NAME="sec1"></A>To create the difference file</H3><P>    1.    After the snapshot file has been created, install the applications that you want to include in the distributed version of the system.</P>
<P>    2.    At the command prompt, type the following command:</P>
<P CLASS="spacing"><BR></P>
<PRE><B>sysdiff /diff</B> [/c:<I>title</I>] [<B>/log:</B><I>log_file</I>] <I>snapshot_file</I> <I>difference_file</I>
</PRE>
<P>where:</P>
<P CLASS="term2"><B>/c:<I>title</I></B></P>
<P CLASS="dt2">specifies a title for the difference package</P>
<P CLASS="term2"><B><I>log_file</I> </B></P>
<P CLASS="dt2">is the name of an optional log file created by <B>sysdiff</B>.</P>
<P CLASS="term2"><B><I>snapshot_file</I></B></P>
<P CLASS="dt2">is the name of the file containing the snapshot of the system. This file must be created from the same installation as you modified in step one. If you use a file created on another computer or from another installation, <B>sysdiff </B>will fail.</P>
<P CLASS="term2"><B><I>difference_file</I></B></P>
<P CLASS="dt2">is the name of the file containing the differences between the system as it existed when the snapshot file was created and the system as it currently exists. Specify any valid Win32&reg;-based filename.</P>
<P></P>
<H3><A NAME="sec2"></A>To apply the difference file</H3><P>    1.    Place the difference file in a subdirectory of the $OEM$\$$ directory. </P>
<P>    2.    Add the following command to the $OEM$\Cmdlines.txt file:</P>
<P CLASS="spacing"><BR></P>
<PRE><B>sysdiff /apply /m</B> [<B>/log:</B><I>log_file </I>] <I>difference_file</I>
</PRE>
<P>where:</P>
<P CLASS="spacing"><BR></P>
<PRE></PRE>
<P CLASS="term2"><B>/m</B></P>
<P CLASS="dt2">causes the file changes in the per-user profile structure to be mapped to the Default User profile structure, rather than to the profile structure for the user logged on when the difference file was created. </P>
<P CLASS="dt2">For example, if you were logged on as Administrator when you installed the applications to be included in the difference file, then the .lnk files and other user profile files would be created in the %WinDir%\Profiles\Administrator directory (where %WinDir%\ is the value of the %USERPROFILE% environment variable). But this directory does not yet exist when the files are copied during GUI-mode setup. For a preinstallation, these files should be placed into %WinDir%\Profiles\Default User instead of %WinDir%\Profiles\Administrator. By using the <B>/m</B> switch to place the files in the Default User profile structure, you ensure that the applications are available to all users when they first log in.</P>
<P CLASS="term2"><B><I>log_file</I></B></P>
<P CLASS="dt2">is the name of a log file to which <B>sysdiff</B> writes information describing its actions. This parameter is optional.</P>
<P CLASS="term2"><B><I>difference_file</I></B></P>
<P CLASS="dt2">specifies a file generated by an earlier invocation of <B>sysdiff /diff</B>. The %SystemRoot% must be the same as it was on the system that was used to generate the original <I>difference_file</I>. For example, if a difference file was generated on a Windows&nbsp;NT Workstation installation in C:\Winnt, then that difference file can be applied on other computers only if those computers are running Windows&nbsp;NT installed in C:\Winnt. </P>
<P></P>
<P CLASS="t"><B>Note</B></P>
<P>You can also run the <B>sysdiff /apply</B> command from the command line. For example, you can use this command to apply a difference file that contains applications to an existing installation of Windows&nbsp;NT Workstation 4.0.</P>
<P></P>
<P></P>
<H3><A NAME="sec3"></A>To create an INF</H3><P>Run the following command:</P>
<P CLASS="spacing"><BR></P>
<PRE>SYSDIFF /inf /m [/u] sysdiff_file oem_root
</PRE>
<P>where:</P>
<P CLASS="term2"><B>/m</B></P>
<P CLASS="dt2">causes the file changes in the per-user profile structure to be mapped to the Default User profile structure, rather than to the profile structure for the user logged on when the difference file was created. </P>
<P CLASS="dt2">For example, if you were logged on as Administrator when you installed the applications to be included in the difference file, then the .lnk files and other user profile files would be created in the %WinDir%\Profiles\Administrator directory (where %WinDir%\ is the value of the %USERPROFILE% environment variable). But this directory does not yet exist when the files are copied during GUI-mode setup. For a preinstallation, these files should be placed into %WinDir%\Profiles\Default User instead of %WinDir%\Profiles\Administrator. By using the <B>/m</B> switch to place the files in the Default User profile structure, you ensure that the applications are available to all users when they first log in.</P>
<P CLASS="term2"><B>/u</B></P>
<P CLASS="dt2">specifies that the INF file be generated as a Unicode text file. By default, the file is generated using the system ANSI codepage.</P>
<P CLASS="term2"><B><I>sysdiff_file</I></B></P>
<P CLASS="dt2">is a Win32 path to a file that was created by sysdiff's difference mode.</P>
<P CLASS="term2"><B><I>oem_root</I></B></P>
<P CLASS="dt2">is the Win32 path of a directory. The $OEM$ structure will be created in this directory, and the INF will be placed there with the name Instapp.inf.</P>
<P></P>
<P CLASS="t">The output of this command is a file with the name <I>dif_file</I>.inf, where <I>dif_file</I> is the name of the difference file (without the three character filename extension). If the difference filename is more than eight characters long, it will be truncated to eight characters. For example, if <I>sysdiff_file</I> was named Custom.dif, the INF created by the <B>sysdiff /inf</B> command will be Custom.inf. If <I>sysdiff_file</I> was named Marketing.dif, the INF created by the <B>sysdiff /inf</B> command will be Custom_m.inf.</P>
<P CLASS="t">Because the INF file is copied during text mode Setup, it should be placed in the $OEM$\Textmode directory and listed in the Txtsetup.oem file in that directoryTMTM. On x86 machines,<B> </B>Txtsetup.oem<B> </B>and all files listed in it must also be listed in the [OEMBootFiles] section of the answer file.</P>
<H3><A NAME="sec4"></A>To invoke the INF</H3><P>Add a line to $OEM$\Cmdlines.txt to invoke the INF you created from the sysdff difference file. The command is of the same form as you would use to invoke any Windows&nbsp;95-style INF. The format is as follows:</P>
<P CLASS="spacing"><BR></P>
<PRE>"RUNDLL32 syssetup,SetupInfObjectInstallAction <I>section</I> 128 <I>inf</I>"
</PRE>
<P CLASS="t">where:</P>
<P CLASS="term1"><B><I>Section </I></B></P>
<P CLASS="dt1">specifies the name of the section in the INF file.</P>
<P CLASS="term1"><B><I>Inf</I></B></P>
<P CLASS="dt1">specifies the name of the INF file. This should be specified as a relative path to avoid invoking Setup's default INF rules, which look for an unqualified filename in the system inf directory instead of the current directory. For example, specify <B>..\newtools.inf</B>, not just <B>newtools.inf</B>.</P>
<P></P>
<P CLASS="t">The command is always enclosed in double quotation marks.</P>
<H3><A NAME="sec5"></A>To dump the contents of a difference file</H3><P> <FONT FACE="symbol">·</FONT>    Use the command,</P>
<P CLASS="spacing"><BR></P>
<PRE>sysdiff /dump <I>difference_file dump_file</I>
</PRE>
<P>This creates a text file with the name specified in the dump_file parameter that contains information regarding the contents of the difference file.</P></BODY></HTML>
