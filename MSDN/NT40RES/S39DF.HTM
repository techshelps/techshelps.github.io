<HTML><HEAD><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>The NTFS File System</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY BGCOLOR="#FFFFFF"><FONT FACE="Verdana, Arial, Helvetica" SIZE="2"><FORM NAME="x"><OBJECT CLASSID="clsid:9c2ac687-ceef-11cf-96d9-00a0c903b016" NAME="iv"></OBJECT></FORM>
<H3>The NTFS File System</H3><P CLASS="t">The Windows&nbsp;NT file system (NTFS) provides a combination of performance, reliability, and compatibility not found in the FAT file system. It is designed to quickly perform standard file operations such as read, write, and search — and even advanced operations such as file-system recovery — on very large hard disks. </P>
<P CLASS="t">The NTFS file system includes security features required for file servers and high-end personal computers in a corporate environment. The NTFS file system also supports data access control and ownership privileges that are important for the integrity of critical data. While folders shared on a Windows&nbsp;NT computer are assigned particular permissions, NTFS files and folders can have permissions assigned whether they are shared or not. NTFS is the only file system on Windows&nbsp;NT that allows you to assign permissions to individual files. However, when you move or copy a file from an NTFS to a FAT volume, permissions and other attributes unique to the NTFS file system are lost.</P>
<P CLASS="t">The NTFS file system has a simple, yet very powerful design. Basically, everything on the volume is a file and everything in a file is an attribute, from the data attribute, to the security attribute, to the file name attribute. Every sector on an NTFS volume that is allocated belongs to some file. Even the file system metadata (information that describes the file system itself) is part of a file. </P>
<H4><A NAME="sec0"></A>Structure of an NTFS Volume</H4><P CLASS="t">Like the FAT file system, the NTFS file system uses clusters as the fundamental unit of disk allocation. In the NTFS file system, the default cluster size depends on the volume size. In Disk Administrator, you can specify a cluster size up to 4K. If you use the command prompt program <B>format</B> to format your NTFS volume, you can specify any cluster size shown in the next table. </P>
<P CLASS="t">The default cluster sizes for the NTFS file system are shown in the following table.</P>

<TABLE COLS="4" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="144pt" VALIGN="TOP"><COL WIDTH="109pt" VALIGN="TOP"><COL WIDTH="94pt" VALIGN="TOP"><COL WIDTH="0pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P CLASS="th"><B>Partition size</B></P></TD><TD VALIGN="TOP"><P CLASS="th"><B>Sectors per cluster</B></P></TD><TD VALIGN="TOP"><P CLASS="th"><B>Cluster size</B></P></TD></TR><TR><TD COLSPAN="4" VALIGN="TOP"><P></P></TD></TR><TR><TD VALIGN="TOP"><P>512 MB or less</P></TD><TD VALIGN="TOP"><P>1</P></TD><TD VALIGN="TOP"><P>512 bytes</P></TD></TR><TR><TD VALIGN="TOP"><P>513 MB - 1024 MB (1GB)</P></TD><TD VALIGN="TOP"><P>2</P></TD><TD VALIGN="TOP"><P>1K</P></TD></TR><TR><TD VALIGN="TOP"><P>1025 MB - 2048 MB (2GB)</P></TD><TD VALIGN="TOP"><P>4</P></TD><TD VALIGN="TOP"><P>2K</P></TD></TR><TR><TD VALIGN="TOP"><P>2049 MB - 4096 MB (4GB)</P></TD><TD VALIGN="TOP"><P>8</P></TD><TD VALIGN="TOP"><P>4K</P></TD></TR><TR><TD VALIGN="TOP"><P>4097 MB - 8192 MB (8GB)</P></TD><TD VALIGN="TOP"><P>16</P></TD><TD VALIGN="TOP"><P>8K</P></TD></TR><TR><TD VALIGN="TOP"><P>8193 MB - 16,384 MB (16GB)</P></TD><TD VALIGN="TOP"><P>32</P></TD><TD VALIGN="TOP"><P>16K</P></TD></TR><TR><TD VALIGN="TOP"><P>16,385 MB - 32,768 MB (32GB)</P></TD><TD VALIGN="TOP"><P>64</P></TD><TD VALIGN="TOP"><P>32K</P></TD></TR><TR><TD VALIGN="TOP"><P>&gt; 32, 768 MB</P></TD><TD VALIGN="TOP"><P>128</P></TD><TD VALIGN="TOP"><P>64K</P></TD></TR></TBODY></TABLE>
<P CLASS="spacing"><BR></P><P></P>
<P></P>
<P CLASS="t"><B>Note</B></P>
<P>You cannot use NTFS compression when your cluster size is greater than 4K. See "NTFS Compression" in Chapter 18, "Choosing a File System," for more information.</P>
<P></P>
<P CLASS="t">Formatting a volume with the NTFS file system results in the creation of several system files and the Master File Table (MFT), which contains information about all the files and folders on the NTFS volume. </P>
<P CLASS="t">The first information on an NTFS volume is the Partition Boot Sector, which starts at sector 0 and can be up to 16 sectors long. It consists of two structures:</P>
<UL><LI>The BIOS Parameter Block, which contains information on the volume layout and file system structures. </LI></UL><UL><LI>Code that describes how to find and load the startup files for whatever operating system is being loaded. For Windows&nbsp;NT on x86-based computers, this code loads NTLDR. </LI></UL><P></P>
<P CLASS="t">The first file on an NTFS volume is the Master File Table (MFT). The next section of this chapter, "Master File Table and the NTFS System Files," contains more information.</P>
<P CLASS="t">The following figure illustrates the layout of an NTFS volume when formatting has finished.</P>
<P><img src="xwr_p05.gif"></P>
<P>Figure 17.8    NTFS volume layout</P>
<H4><A NAME="sec1"></A>Master File Table (MFT) and NTFS System Files</H4><P CLASS="t">When you format an NTFS volume, the format program creates a set of files that contains the metadata used to implement the file system structure. The NTFS file system reserves the first 16 records in the MFT for the information about these metadata files. The NTFS file system uses approximately 1&nbsp;MB for the metadata files and the first 16 records in the MFT. The next table describes these records.</P>
<P>Table 17.1    NTFS System Files</P>

<TABLE COLS="5" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="59pt" VALIGN="TOP"><COL WIDTH="52pt" VALIGN="TOP"><COL WIDTH="62pt" VALIGN="TOP"><COL WIDTH="173pt" VALIGN="TOP"><COL WIDTH="0pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD COLSPAN="5" VALIGN="TOP"><P></P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="th"><B>System file</B></P></TD><TD VALIGN="TOP"><P CLASS="th"><B>Filename</B></P></TD><TD VALIGN="TOP"><P CLASS="th"><B>MFT record</B></P></TD><TD VALIGN="TOP"><P CLASS="th"><B>Purpose of the file</B></P></TD></TR><TR><TD COLSPAN="5" VALIGN="TOP"><P></P></TD></TR><TR><TD VALIGN="TOP"><P>Master File Table</P></TD><TD VALIGN="TOP"><P>$Mft</P></TD><TD VALIGN="TOP"><P>0</P></TD><TD VALIGN="TOP"><P>A list of all contents of the NTFS volume.</P></TD></TR><TR><TD VALIGN="TOP"><P>Master File Table2</P></TD><TD VALIGN="TOP"><P>$MftMirr</P></TD><TD VALIGN="TOP"><P>1</P></TD><TD VALIGN="TOP"><P>A mirror of the first three records of the MFT, used to guarantee access to the MFT in the case of a single-sector failure.</P></TD></TR><TR><TD VALIGN="TOP"><P>Log File</P></TD><TD VALIGN="TOP"><P>$LogFile</P></TD><TD VALIGN="TOP"><P>2</P></TD><TD VALIGN="TOP"><P>A list of transaction steps used for NTFS recoverability.</P></TD></TR><TR><TD VALIGN="TOP"><P>Volume </P></TD><TD VALIGN="TOP"><P>$Volume</P></TD><TD VALIGN="TOP"><P>3</P></TD><TD VALIGN="TOP"><P>The volume name, NTFS version, and other information about the volume.</P></TD></TR><TR><TD VALIGN="TOP"><P>Attribute Definition Table</P></TD><TD VALIGN="TOP"><P>$AttrDef</P></TD><TD VALIGN="TOP"><P>4</P></TD><TD VALIGN="TOP"><P>A table of attribute names, numbers, and descriptions.</P></TD></TR><TR><TD VALIGN="TOP"><P>Root Filename Index</P></TD><TD VALIGN="TOP"><P>$.</P></TD><TD VALIGN="TOP"><P>5</P></TD><TD VALIGN="TOP"><P>Root folder.</P></TD></TR><TR><TD VALIGN="TOP"><P>Cluster Bitmap</P></TD><TD VALIGN="TOP"><P>$Bitmap</P></TD><TD VALIGN="TOP"><P>6</P></TD><TD VALIGN="TOP"><P>A representation of the volume, showing which clusters are in use.</P></TD></TR><TR><TD VALIGN="TOP"><P>Partition Boot Sector</P></TD><TD VALIGN="TOP"><P>$Boot</P></TD><TD VALIGN="TOP"><P>7</P></TD><TD VALIGN="TOP"><P>The bootstrap for the volume, if this is a bootable volume.</P></TD></TR><TR><TD VALIGN="TOP"><P>Bad Cluster File</P></TD><TD VALIGN="TOP"><P>$BadClus</P></TD><TD VALIGN="TOP"><P>8</P></TD><TD VALIGN="TOP"><P>A location where all the bad clusters in the volume are located.</P></TD></TR><TR><TD VALIGN="TOP"><P>Quota Table</P></TD><TD VALIGN="TOP"><P>$Quota</P></TD><TD VALIGN="TOP"><P>9</P></TD><TD VALIGN="TOP"><P>Disk quota usage for each user on a volume. Currently unused.</P></TD></TR><TR><TD VALIGN="TOP"><P>Upcase Table</P></TD><TD VALIGN="TOP"><P>$Upcase</P></TD><TD VALIGN="TOP"><P>10</P></TD><TD VALIGN="TOP"><P>Used for converting lowercase characters to the matching Unicode uppercase characters.</P></TD></TR><TR><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P></P></TD><TD VALIGN="TOP"><P>11-15</P></TD><TD VALIGN="TOP"><P>Reserved for future use.</P></TD></TR></TBODY></TABLE>
<P CLASS="spacing"><BR></P><P></P>
<P CLASS="t">The first record of the MFT describes the MFT itself, followed by the MFT mirror record. If the first MFT record is corrupted, the NTFS file system reads the second record to find the MFT mirror file, which is a copy of the first three records of the MFT. The locations of the data segments for both the MFT and the MFT mirror file are recorded in the Partition Boot Sector. A duplicate of the Partition Boot Sector is located at the end of the volume (Windows&nbsp;NT version 4.0) or the logical center of the volume (Windows&nbsp;NT version 3.51 and earlier).</P>
<P CLASS="t">The third record of the MFT is the log file, which the operating system uses to restore consistency to the NTFS file system in the event of a system crash. The log file size depends upon the volume size, and can be as large as 4 MB. The log file is discussed in more detail in the section titled "NTFS Recoverability" in Chapter 18, "Choosing a File System."</P>
<P CLASS="t">The MFT contains records that describe each file on an NTFS volume. The NTFS file system allocates space for each of the MFT records based upon the cluster size. The attributes of a file are written to the allocated space in the MFT. Small files and folders, such as the file illustrated in Figure 17.9, can be contained entirely within the MFT record. </P>
<P><img src="xwr_p06.gif"></P>
<P>Figure 17.9    MFT Record for a Small File or Folder</P>
<P CLASS="t">Records for folders are contained within the MFT, just like records for files. All of the information for small folders reside entirely within the MFT record. Large folders are organized into B-trees, having records with pointers to external clusters containing folder entries that could not be contained within the MFT structure.</P>
<H4><A NAME="sec2"></A>NTFS File Attributes</H4><P CLASS="t">The NTFS file system views each file (or folder) as a set of file attributes. Elements such as the file's name, its security information, and even its data, are all file attributes. Each attribute is identified by an attribute type code and, optionally, an attribute name. </P>
<P CLASS="t">When a file's attributes can fit within the MFT file record, they are called resident attributes. For example, information such as filename and time stamp are always included in the MFT file record. When all of the information for a file is too large to fit in the MFT file record, some of its attributes are nonresident. The nonresident attributes are allocated one or more clusters of disk space elsewhere in the volume. NTFS creates the Attribute List attribute to describe the location of all of the attribute records.</P>
<P CLASS="t">Table 17.2 lists all of the file attributes currently defined by the NTFS file system. This list is extensible, meaning that other file attributes can be defined in the future.</P>
<P></P>
<P>Table 17.2    NTFS File Attribute Types</P>

<TABLE COLS="3" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="60pt" VALIGN="TOP"><COL WIDTH="287pt" VALIGN="TOP"><COL WIDTH="0pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD COLSPAN="3" VALIGN="TOP"><P></P></TD></TR><TR><TD VALIGN="TOP"><P CLASS="th"><B>Attribute type</B></P></TD><TD VALIGN="TOP"><P CLASS="th"><B>Description</B></P></TD></TR><TR><TD COLSPAN="3" VALIGN="TOP"><P></P></TD></TR><TR><TD VALIGN="TOP"><P>Standard Information</P></TD><TD VALIGN="TOP"><P>Includes time stamps, link count, and so on.</P></TD></TR><TR><TD VALIGN="TOP"><P>Attribute List</P></TD><TD VALIGN="TOP"><P>Lists the location of all of the attribute records when they do not all fit in the MTF record.</P></TD></TR><TR><TD VALIGN="TOP"><P>Filename</P></TD><TD VALIGN="TOP"><P>A repeatable attribute for both long and short filenames. The long name of the file can be up to 255 Unicode characters. The short name is the MS-DOS- readable, eight-plus-three, case-insensitive name for this file. Additional names, or hard links, required by POSIX can also be included as additional filename attributes.</P></TD></TR><TR><TD VALIGN="TOP"><P>Security Descriptor </P></TD><TD VALIGN="TOP"><P>Shows information about who can access the file, who owns the file, and so on.</P></TD></TR><TR><TD VALIGN="TOP"><P>Data</P></TD><TD VALIGN="TOP"><P>Contains file data. NTFS allows multiple data attributes per file. Each file typically has one unnamed data attribute. In addition, a file can have one or more named data attributes, using a particular syntax.</P></TD></TR><TR><TD VALIGN="TOP"><P>Index Root</P></TD><TD VALIGN="TOP"><P>Used to implement folders.</P></TD></TR><TR><TD VALIGN="TOP"><P>Index Allocation</P></TD><TD VALIGN="TOP"><P>Used to implement folders.</P></TD></TR><TR><TD VALIGN="TOP"><P>Volume Information</P></TD><TD VALIGN="TOP"><P>Used only in the $Volume system file and includes information such as the version and name of the volume.</P></TD></TR><TR><TD VALIGN="TOP"><P>Bitmap</P></TD><TD VALIGN="TOP"><P>Provides a map representing records in use on the MFT or folder.</P></TD></TR><TR><TD VALIGN="TOP"><P>Extended Attribute Information</P></TD><TD VALIGN="TOP"><P>Used by file servers that are linked with OS/2 systems. This attribute type isn't used by Windows&nbsp;NT.</P></TD></TR><TR><TD VALIGN="TOP"><P>Extended Attributes</P></TD><TD VALIGN="TOP"><P>Used by file servers that are linked with OS/2 systems. This attribute type isn't used by Windows&nbsp;NT.</P></TD></TR></TBODY></TABLE>
<P CLASS="spacing"><BR></P><P></P>
<H4><A NAME="sec3"></A>Filenames on NTFS Volumes</H4><P CLASS="t">By default, Windows&nbsp;NT version 3.5 and later support MS-DOS-readable filenames on all NTFS volumes. To improve performance on volumes with many long, similar names, you can disable this feature by setting the NtfsDisable8dot3NameCreation parameter of the following Registry entry to 1:</P>
<P CLASS="spacing"><BR></P>
<PRE>HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\FileSystem
</PRE>
<P CLASS="t">Windows&nbsp;NT does not generate short (eight-plus-three) filenames for files created by POSIX-based applications on an NTFS volume. This means that MS-DOS-based and Windows-based applications cannot view these filenames if they are not valid eight-plus-three filenames. If you want to use files that are created by a POSIX application with MS-DOS-based or Windows-based applications, be sure to use standard MS-DOS eight-plus-three naming conventions.</P>
<P CLASS="t">For general information about long and short filenames for both FAT and NTFS volumes, see the section "Generating and Viewing Short Filenames," presented later in this chapter.</P></BODY></HTML>
