<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IExchExtAdvancedCriteria::QueryRestriction</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_mapi1book_iexchextadvancedcriteria_queryrestriction"></a>IExchExtAdvancedCriteria::QueryRestriction</h2>
<p>
Returns a restriction object and a text version of the restriction. </p>
<h4>Quick Info</h4>
<p>
See <a href="ref-c01k_8jam.htm"><b>IExchExtAdvancedCriteria : IUnknown</b></a>.</p>
<pre><code><b>HRESULT QueryRestriction(
  LPVOID</b><i> lpvAllocBase</i><b>,</b>                 
<b>  LPSRestriction FAR *</b><i> lppres</i><b>,</b>         
<b>  LPSPropTagArray FAR *</b><i> lppPropTags</i><b>,</b>   
<b>  LPMAPINAMEID FAR * FAR *</b><i> lppPropNames</i><b>,</b>   
<b>  BOOL *</b><i> lpfNot</i><b>,</b>                       
<b>  LPTSTR</b><i> lpszDesc</i><b>,</b>                     
<b>  ULONG</b><i> cchDesc</i><b>,</b>                       
<b>  ULONG</b><i> ulFlags                        </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>lpvAllocBase</i></dt>
<dd>
[in] Pointer to the memory allocation base to be used when allocating memory for the restriction data. For more information on allocating memory, see <object id=alink_1 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink">
<PARAM name="DefaultTopic" value="../../notopic_0pk4.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_mapi1book_managing_memory">
</object><a href=JavaScript:alink_1.Click()>Managing Memory</a> in the <i>MAPI Programmer's Reference</i>.</dd>
<dt>
<i>lppres</i></dt>
<dd>
[out] Pointer to where to return a pointer to the advanced criteria restriction.</dd>
<dt>
<i>lppPropTags</i></dt>
<dd>
[out] Pointer to where to return a pointer to a MAPI property tag array containing the property tags of any named properties involved in the restriction. This parameter is used by Microsoft Exchange to find property tags which need to be remapped should the restriction be applied to a different store.</dd>
<dt>
<i>lppPropNames</i></dt>
<dd>
[out] Pointer to where to return an array of MAPI property <b>NAMEID</b> structures that define the properties whose tags are given in the <i>lppPropTags</i> parameter. This value is used by Microsoft Exchange to obtain the appropriate new property tags should the restriction be applied to a different store.</dd>
<dt>
<i>lpfNot</i></dt>
<dd>
[out] Pointer to a variable that returns TRUE if the user only wants messages that do not meet the criteria specified in the structure pointed to by the <i>lpres </i>parameter.</dd>
<dt>
<i>lpszDesc</i></dt>
<dd>
[out] Pointer to a buffer which the extension should fill with a string containing a text description of the restriction.</dd>
<dt>
<i>cchDesc</i></dt>
<dd>
[in] Maximum length of the <i>lpszDesc </i>parameter.</dd>
<dt>
<i>ulFlags</i></dt>
<dd>
[in] Bitmask of flags. The following flag can be set:
<dl>
<dt>
EXCHEXT_UNICODE </dt>
<dd>
Microsoft Exchange sets the <i>ulFlags</i> parameter to this value if it wants the extension to fill the <i>lpszDesc</i> parameter with a Unicode string.
</dd>
</dl>
</dd>
</dl>
<h4>Remarks</h4>
<p>
Microsoft Exchange calls the <b>IExchExtAdvancedCriteria::QueryRestriction</b> method when the criteria which the user has specified must be instantiated as a restriction. For example, when the user closes the Advanced dialog box, Microsoft Exchange prompts the extension object to return the current restriction. The restriction is a MAPI construct specifying a query. Memory for the returned restriction object must be allocated with the <b>MAPIAllocateMore </b>function using the <i>pvAllocBase</i> parameter as the base. <b>QueryRestriction</b> can be called zero, one, or multiple times depending on the context and the user's choices.</p>
<p>
The text version this method returns is a user-readable representation of the query that the user composed in the Advanced dialog box. The format of the text version depends on the complexity of the criteria. For example, it could be a description in plain text English or in SQL language.</p>
<p>
If no restriction is defined, the function should return S_OK with a null restriction in <i>lppres</i>. If EXCHEXT_S_NOCRITERIA is returned, the operation will be stopped. Extensions can selectively install themselves in different contexts in the Exchange client, such as: EECONTEXT_TASK, EECONTEXT_VIEWER, etc. By installing in a particular context, the extension needs to instantiate a new set of interface objects, such as <b>IExchExtCommands</b>, to handle the methods in that particular object. For example, if an extension is installed into EECONTEXT_VIEWER and EECONTEXT_SENDNOTEMESSAGE, it needs to remember which commands it has installed into which context so that it can respond to the <b>IExchExtCommands::DoCommand</b> method.</p>
<p>&nbsp;</p></body>
</HTML>
