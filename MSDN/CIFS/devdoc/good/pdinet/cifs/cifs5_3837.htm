<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>MOVE:  Rename File</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_cifs_83"></a>MOVE:  Rename File</h3>
<p>
The source file is copied to the destination and the source is subsequently deleted.</p>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=50%>Client Request<br>
==================================</td>
<td width=50%>Description<br>
=================================</td>
</tr>
<tr valign=top>
<td width=50%>UCHAR WordCount;</td>
<td width=50%>Count of parameter words = 3</td>
</tr>
<tr valign=top>
<td width=50%>USHORT Tid2;</td>
<td width=50%>Second (target) file id</td>
</tr>
<tr valign=top>
<td width=50%>USHORT OpenFunction;</td>
<td width=50%>what to do if target file exists</td>
</tr>
<tr valign=top>
<td width=50%>USHORT Flags;</td>
<td width=50%>Flags to control move operations:</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%>0 - target must be a file</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%>1 - target must be a directory</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%>2 - reserved (must be 0)</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%>3 - reserved (must be 0)</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%>4 - verify all writes</td>
</tr>
<tr valign=top>
<td width=50%>USHORT ByteCount;</td>
<td width=50%>Count of data bytes;    min = 2</td>
</tr>
<tr valign=top>
<td width=50%>UCHAR Format1;</td>
<td width=50%>0x04</td>
</tr>
<tr valign=top>
<td width=50%>STRING OldFileName[];</td>
<td width=50%>Old file name</td>
</tr>
<tr valign=top>
<td width=50%>UCHAR FormatNew;</td>
<td width=50%>0x04</td>
</tr>
<tr valign=top>
<td width=50%>STRING NewFileName[];</td>
<td width=50%>New file name</td>
</tr>
</table><br>
<p>
<i>OldFileName</i> is copied to <i>NewFileName</i>, then <i>OldFileName</i> is deleted.  Both <i>OldFileName</i> and  <i>NewFileName</i> must refer to paths on the same server.  <i>NewFileName</i> can refer to either a file or a directory.  All file components except the last must exist; directories will not be created.</p>
<p>
<i>NewFileName</i> can be required to be a file or a directory by the Flags field.</p>
<p>
The <i>tid</i> in the header is associated with the source while <i>tid2</i> is associated with the destination.  These fields may contain the same or differing valid values. <i>tid2</i> can be set to -1 indicating that this is to be the same <i>tid</i> as in the SMB header.  This allows use of the move protocol with <code>SMB_TREE_CONNECT_ANDX.</code></p>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=50%>Server Response<br>
==================================</td>
<td width=50%>Description<br>
=================================</td>
</tr>
<tr valign=top>
<td width=50%>UCHAR WordCount;</td>
<td width=50%>Count of parameter words = 1</td>
</tr>
<tr valign=top>
<td width=50%>USHORT Count;</td>
<td width=50%>Number of files moved</td>
</tr>
<tr valign=top>
<td width=50%>USHORT ByteCount;</td>
<td width=50%>Count of data bytes;    min = 0</td>
</tr>
<tr valign=top>
<td width=50%>UCHAR ErrorFileFormat;</td>
<td width=50%>0x04  (only if error)</td>
</tr>
<tr valign=top>
<td width=50%>STRING ErrorFileName[];</td>
<td width=50%>Pathname of file where error occurred</td>
</tr>
</table><br>
<p>
The source path must refer to an existing file or files.  Wildcards are permitted.  Source files specified by wildcards are processed until an error is encountered. If an error is encountered, the expanded name of the file is returned in ErrorFileName.  Wildcards are not permitted in <i>newfilename</i>.</p>
<p>
<i>OpenFunction</i> controls what should happen if the destination file exists.  If (<i>OpenFunction</i> &amp; 0x30) == 0, the operation should fail if the destination exists.  If (<i>OpenFunction</i> &amp; 0x30) == 0x20, the destination file should be overwritten.</p>
<h4>Errors</h4>
<p>
ERRDOS/ERRfilexists<br>
ERRDOS/ERRbadfile<br>
ERRDOS/ERRnoaccess<br>
ERRDOS/ERRnofiles<br>
ERRDOS/ERRbadshare<br>
ERRHRD/ERRnowrite<br>
ERRSRV/ERRnoaccess<br>
ERRSRV/ERRinvdevice<br>
ERRSRV/ERRinvid<br>
ERRSRV/ERRbaduid<br>
ERRSRV/ERRnosupport<br>
ERRSRV/ERRaccess</p>
<p>&nbsp;</p></body>
</HTML>
