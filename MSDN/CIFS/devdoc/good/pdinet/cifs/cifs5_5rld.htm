<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>WRITE_AND_CLOSE:  Write Bytes and Close File</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_cifs_131"></a><i></i>WRITE_AND_CLOSE:  Write Bytes and Close File</h2>
<p>
This request is used to first write the specified bytes and then close the file.</p>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=50%>Client Request<br>
==================================</td>
<td width=50%>Description<br>
=================================</td>
</tr>
<tr valign=top>
<td width=50%>UCHAR WordCount;</td>
<td width=50%>Count of parameter words = 6</td>
</tr>
<tr valign=top>
<td width=50%>USHORT Fid;</td>
<td width=50%>File handle</td>
</tr>
<tr valign=top>
<td width=50%>USHORT Count;</td>
<td width=50%>Number of bytes to write</td>
</tr>
<tr valign=top>
<td width=50%>ULONG Offset;</td>
<td width=50%>Offset in file of first byte to write</td>
</tr>
<tr valign=top>
<td width=50%>UTIME LastWriteTime;</td>
<td width=50%>Time of last write</td>
</tr>
<tr valign=top>
<td width=50%>USHORT ByteCount;</td>
<td width=50%>1 (for pad) + value of Count</td>
</tr>
<tr valign=top>
<td width=50%>UCHAR Pad;</td>
<td width=50%>To force to doubleword boundary</td>
</tr>
<tr valign=top>
<td width=50%>UCHAR Buffer[ Count ];</td>
<td width=50%>Data to write</td>
</tr>
</table><br>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=50%>Client Request<br>
==================================</td>
<td width=50%>Description<br>
=================================</td>
</tr>
<tr valign=top>
<td width=50%>UCHAR WordCount;</td>
<td width=50%>Count of parameter words = 12</td>
</tr>
<tr valign=top>
<td width=50%>USHORT Fid;</td>
<td width=50%>File handle</td>
</tr>
<tr valign=top>
<td width=50%>USHORT Count;</td>
<td width=50%>Number of bytes to write</td>
</tr>
<tr valign=top>
<td width=50%>ULONG Offset;</td>
<td width=50%>Offset in file of first byte to write</td>
</tr>
<tr valign=top>
<td width=50%>UTIME LastWriteTime;</td>
<td width=50%>Time of last write</td>
</tr>
<tr valign=top>
<td width=50%>ULONG Reserved[3];</td>
<td width=50%>Reserved, must be 0</td>
</tr>
<tr valign=top>
<td width=50%>USHORT ByteCount;</td>
<td width=50%>1 (for pad) + value of Count</td>
</tr>
<tr valign=top>
<td width=50%>UCHAR Pad;</td>
<td width=50%>To force to doubleword boundary</td>
</tr>
<tr valign=top>
<td width=50%>UCHAR Buffer[Count];</td>
<td width=50%>Data to write</td>
</tr>
</table><br>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=50%>Server Response<br>
==================================</td>
<td width=50%>Description<br>
=================================</td>
</tr>
<tr valign=top>
<td width=50%>UCHAR WordCount;</td>
<td width=50%>Count of parameter words = 1</td>
</tr>
<tr valign=top>
<td width=50%>USHORT Count;</td>
<td width=50%>Count of bytes actually written</td>
</tr>
<tr valign=top>
<td width=50%>USHORT ByteCount;</td>
<td width=50%>Count of data bytes = 0</td>
</tr>
</table><br>
<p>
Since clients can formulate the request in either of two ways, <i>wordcount</i> must be used in order to correctly locate the data to be written.</p>
<p>
<i>count</i> specifies the number of bytes to be written.  <i>offset</i> is the offset in the file of the first byte to be written.  Since <i>offset</i> is 32 bits, this request is inappropriate for general use in a very large file.</p>
<p>
If <i>lastwritetime</i> and <i>lastwritedate</i> are 0, the server should allow its local operating system to set the file's times.  Otherwise, the server should set the time to the values requested.  Failure to set the times, even if requested by the client in this message, should not result in an error response from the server.</p>
<p>
If <i>count</i> is 0, the file is truncated (or extended) to <i>offset</i>.</p>
<p>
If an error occurs on the write, the file should still be closed.</p>
<p>&nbsp;</p></body>
</HTML>
