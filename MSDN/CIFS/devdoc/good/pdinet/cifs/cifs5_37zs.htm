<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>TRANS2_QUERY_FS_INFORMATION: Get File System Information</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_cifs_68"></a>TRANS2_QUERY_FS_INFORMATION: Get File System Information</h3>
<p>
This transaction requests information about a filesystem on the server.</p>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=50%>Client Request<br>
==================================</td>
<td width=50%>Value<br>
=================================</td>
</tr>
<tr valign=top>
<td width=50%>WordCount;</td>
<td width=50%>15</td>
</tr>
<tr valign=top>
<td width=50%>TotalParameterCount;</td>
<td width=50%>2 or 4</td>
</tr>
<tr valign=top>
<td width=50%>MaxSetupCount;</td>
<td width=50%>0</td>
</tr>
<tr valign=top>
<td width=50%>SetupCount;</td>
<td width=50%>1 or 2</td>
</tr>
<tr valign=top>
<td width=50%>Setup[0];</td>
<td width=50%>TRANS2_QUERY_FS_INFORMATION </td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%>Parameter Block Encoding<br>
==================================</td>
<td width=50%>Description<br>
=================================</td>
</tr>
<tr valign=top>
<td width=50%>USHORT Information Level;</td>
<td width=50%>Level of information requested</td>
</tr>
</table><br>
<p>
The  filesystem is identified by <i>Tid</i> in the SMB header.</p>
<p>
<i>MaxDataCount</i> in the transaction request must be large enough to accommodate the response.</p>
<p>
The encoding of the response parameter block depends on the <i>InformationLevel</i> requested.  Information levels whose values are greater than 0x102 are mapped to corresponding calls to <code>NtQueryVolumeInformationFile</code> calls by the server.  The two levels below 0x102 are described below.  The requested information is placed in the <i>Data</i> portion of the transaction response.</p>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=78%>InformationLevel<br>
<br>
=============================</td>
<td width=22%>Value<br>
<br>
======</td>
</tr>
<tr valign=top>
<td width=78%>SMB_INFO_ALLOCATION</td>
<td width=22%>1</td>
</tr>
<tr valign=top>
<td width=78%>SMB_INFO_VOLUME</td>
<td width=22%>2</td>
</tr>
<tr valign=top>
<td width=78%>SMB_QUERY_FS_VOLUME_INFO</td>
<td width=22%>0x102</td>
</tr>
<tr valign=top>
<td width=78%>SMB_QUERY_FS_SIZE_INFO</td>
<td width=22%>0x103</td>
</tr>
<tr valign=top>
<td width=78%>SMB_QUERY_FS_DEVICE_INFO</td>
<td width=22%>0x104</td>
</tr>
<tr valign=top>
<td width=78%>SMB_QUERY_FS_ATTRIBUTE_INFO</td>
<td width=22%>0x105</td>
</tr>
</table><br>
<p>
The following sections describe the <i>InformationLevel</i> dependent encoding of the data part of the transaction response.</p>
<h4>SMB_INFO_ALLOCATION</h4>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=29%>Data Block Encoding<br>
===================</td>
<td width=71%>Description<br>
================================================</td>
</tr>
<tr valign=top>
<td width=29%>ULONG idFileSystem;</td>
<td width=71%>File system identifier.  NT server always returns 0</td>
</tr>
<tr valign=top>
<td width=29%>ULONG cSectorUnit;</td>
<td width=71%>Number of sectors per allocation unit</td>
</tr>
<tr valign=top>
<td width=29%>ULONG cUnit;</td>
<td width=71%>Total number of allocation units</td>
</tr>
<tr valign=top>
<td width=29%>ULONG cUnitAvail;</td>
<td width=71%>Total number of available allocation units</td>
</tr>
<tr valign=top>
<td width=29%>USHORT cbSector;</td>
<td width=71%>Number of bytes per sector</td>
</tr>
</table><br>
<h4>SMB_INFO_VOLUME</h4>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=29%>Data Block Encoding<br>
===================</td>
<td width=71%>Description<br>
================================================</td>
</tr>
<tr valign=top>
<td width=29%>ULONG ulVsn;</td>
<td width=71%>Volume serial number</td>
</tr>
<tr valign=top>
<td width=29%>UCHAR cch;</td>
<td width=71%>Number of  characters in Label</td>
</tr>
<tr valign=top>
<td width=29%>STRING Label;</td>
<td width=71%>The volume label</td>
</tr>
</table><br>
<h4>SMB_QUERY_FS_VOLUME_INFO</h4>
<pre><code>typedef struct {
    LARGE_INTEGER VolumeCreationTime;
    ULONG VolumeSerialNumber;
    ULONG VolumeLabelLength;
    BOOLEAN SupportsObjects;
    WCHAR VolumeLabel[1];
} FILE_FS_VOLUME_INFORMATION;
</code></pre>
<h4>SMB_QUERY_FS_SIZE_INFO</h4>
<pre><code>typedef struct {
    LARGE_INTEGER TotalAllocationUnits;
    LARGE_INTEGER AvailableAllocationUnits;
    ULONG SectorsPerAllocationUnit;
    ULONG BytesPerSector;
} FILE_FS_SIZE_INFORMATION;</code></pre>
<h4>SMB_QUERY_FS_DEVICE_INFO</h4>
<pre><code>typedef struct {
    DEVICE_TYPE DeviceType;
    ULONG Characteristics;
} FILE_FS_DEVICE_INFORMATION;
</code></pre>
<p>
Where <i>Characteristics</i> is the sum of any of the following:</p>
<pre><code>FILE_REMOVABLE_MEDIA            0x00000001
FILE_READ_ONLY_DEVICE           0x00000002
FILE_FLOPPY_DISKETTE            0x00000004
FILE_WRITE_ONCE_MEDIA           0x00000008
FILE_REMOTE_DEVICE              0x00000010
FILE_DEVICE_IS_MOUNTED          0x00000020
FILE_VIRTUAL_VOLUME             0x00000040
</code></pre>
<h4>SMB_QUERY_FS_ATTRIBUTE_INFO</h4>
<pre><code>typedef struct {
    ULONG FileSystemAttributes;
    LONG MaximumComponentNameLength;
    ULONG FileSystemNameLength;
    WCHAR FileSystemName[1];
} FILE_FS_ATTRIBUTE_INFORMATION;
</code></pre>
<p>
Where <i>FileSystemAttributes</i> is the sum of any of the following:</p>
<pre><code>FILE_CASE_SENSITIVE_SEARCH      0x00000001
FILE_CASE_PRESERVED_NAMES       0x00000002
FILE_UNICODE_ON_DISK            0x00000004
FILE_PERSISTENT_ACLS            0x00000008
FILE_FILE_COMPRESSION           0x00000010
FILE_VOLUME_QUOTAS              0x00000020
FILE_VOLUME_IS_COMPRESSED       0x00008000
</code></pre>
<h4>Errors</h4>
<p>
ERRSRV/invnid&nbsp;&nbsp;&nbsp;&nbsp;- TID was invalid</p>
<p>
ERRSRV/baduid&nbsp;&nbsp;&nbsp;&nbsp;- UID was invalid</p>
<p>
ERRHRD/ERRnotready&nbsp;&nbsp;&nbsp;&nbsp;- the file system has been removed</p>
<p>
ERRHRD/ERRdata&nbsp;&nbsp;&nbsp;&nbsp;- disk I/O error</p>
<p>
ERRSRV/ERRaccess&nbsp;&nbsp;&nbsp;&nbsp;- user does not have the right to perform this operation</p>
<p>
ERRSRV/ERRinvdevice&nbsp;&nbsp;&nbsp;&nbsp;- resource identified by TID is not a file system</p>
<p>&nbsp;</p></body>
</HTML>
