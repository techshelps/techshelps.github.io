<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>OPEN_ANDX:  Open File</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_cifs_115"></a><i></i>OPEN_ANDX:  Open File</h2>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=50%>Client Request<br>
==================================</td>
<td width=50%>Description<br>
=================================</td>
</tr>
<tr valign=top>
<td width=50%>UCHAR WordCount;</td>
<td width=50%>Count of parameter words = 15</td>
</tr>
<tr valign=top>
<td width=50%>UCHAR AndXCommand;</td>
<td width=50%>Secondary (X) command;  0xFF = none</td>
</tr>
<tr valign=top>
<td width=50%>UCHAR AndXReserved;</td>
<td width=50%>Reserved (must be 0)</td>
</tr>
<tr valign=top>
<td width=50%>USHORT AndXOffset;</td>
<td width=50%>Offset to next command WordCount</td>
</tr>
<tr valign=top>
<td width=50%>USHORT Flags;</td>
<td width=50%>Additional information: bit set-<br>
0 - return additional info<br>
1 - exclusive oplock requested<br>
2 - batch oplock requested</td>
</tr>
<tr valign=top>
<td width=50%>USHORT DesiredAccess;</td>
<td width=50%>File open mode</td>
</tr>
<tr valign=top>
<td width=50%>USHORT SearchAttributes;</td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%>USHORT FileAttributes;</td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%>UTIME CreationTime;</td>
<td width=50%>Creation timestamp for file if it gets created</td>
</tr>
<tr valign=top>
<td width=50%>USHORT OpenFunction;</td>
<td width=50%>Action to take if file exists</td>
</tr>
<tr valign=top>
<td width=50%>ULONG AllocationSize;</td>
<td width=50%>Bytes to reserve on create or truncate</td>
</tr>
<tr valign=top>
<td width=50%>ULONG Reserved[2];</td>
<td width=50%>Must be 0</td>
</tr>
<tr valign=top>
<td width=50%>USHORT ByteCount;</td>
<td width=50%>Count of data bytes;    min = 1</td>
</tr>
<tr valign=top>
<td width=50%>UCHAR BufferFormat</td>
<td width=50%>0x04</td>
</tr>
<tr valign=top>
<td width=50%>STRING FileName;</td>
<td width=50%></td>
</tr>
</table><br>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=50%>Server Response<br>
==================================</td>
<td width=50%>Description<br>
=================================</td>
</tr>
<tr valign=top>
<td width=50%>UCHAR WordCount;</td>
<td width=50%>Count of parameter words = 15</td>
</tr>
<tr valign=top>
<td width=50%>UCHAR AndXCommand;</td>
<td width=50%>Secondary (X) command;  0xFF = none</td>
</tr>
<tr valign=top>
<td width=50%>UCHAR AndXReserved;</td>
<td width=50%>Reserved (must be 0)</td>
</tr>
<tr valign=top>
<td width=50%>USHORT AndXOffset;</td>
<td width=50%>Offset to next command WordCount</td>
</tr>
<tr valign=top>
<td width=50%>USHORT Fid;</td>
<td width=50%>File handle</td>
</tr>
<tr valign=top>
<td width=50%>USHORT FileAttributes;</td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%>UTIME LastWriteTime;</td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%>ULONG DataSize;</td>
<td width=50%>Current file size</td>
</tr>
<tr valign=top>
<td width=50%>USHORT GrantedAccess;</td>
<td width=50%>Access permissions actually allowed</td>
</tr>
<tr valign=top>
<td width=50%>USHORT FileType;</td>
<td width=50%>Type of file opened</td>
</tr>
<tr valign=top>
<td width=50%>USHORT DeviceState;</td>
<td width=50%>State of the named pipe</td>
</tr>
<tr valign=top>
<td width=50%>USHORT Action;</td>
<td width=50%>Action taken</td>
</tr>
<tr valign=top>
<td width=50%>ULONG ServerFid;</td>
<td width=50%>Server unique file id</td>
</tr>
<tr valign=top>
<td width=50%>USHORT Reserved;</td>
<td width=50%>Reserved (must be 0)</td>
</tr>
<tr valign=top>
<td width=50%>USHORT ByteCount;</td>
<td width=50%>Count of data bytes = 0</td>
</tr>
</table><br>
<p>
<i>DesiredAccess</i> describes the access the client desires for the file (see section 3.6 - Access Mode Encoding).</p>
<p>
<i>OpenFunction</i> specifies the action to be taken depending on whether or not the file exists (see section 3.8 - Open Function Encoding).  <i>Action</i> in the response specifies the action as a result of the Open request (see section 3.9 - Open Action Encoding). </p>
<p>
<i>SearchAttributes</i> indicates the attributes that the file must have to be found while searching to see if it exists.  The encoding of this field is described in the "File Attribute Encoding" section elsewhere in this document.  If <i>searchattributes</i> is zero then only normal files are returned.  If the system file, hidden or directory attributes are specified then the search is inclusive -- both the specified type(s) of files and normal files are returned.</p>
<p>
<i>filetype</i> returns the kind of resource actually opened:</p>
<table border=1 cellspacing=4 cols=3 frame=box rules=cols>
<tr valign=top>
<td width=38%>Name<br>
==========================</td>
<td width=11%>Value<br>
======</td>
<td width=51%>Description<br>
==================================</td>
</tr>
<tr valign=top>
<td width=38%>FileTypeDisk</td>
<td width=11%>0</td>
<td width=51%>Disk file or directory as defined in the attribute field</td>
</tr>
<tr valign=top>
<td width=38%>FileTypeByteModePipe</td>
<td width=11%>1</td>
<td width=51%>Named pipe in byte mode</td>
</tr>
<tr valign=top>
<td width=38%>FileTypeMessageModePipe</td>
<td width=11%>2</td>
<td width=51%>Named pipe in message mode</td>
</tr>
<tr valign=top>
<td width=38%>FileTypePrinter</td>
<td width=11%>3</td>
<td width=51%>Spooled printer</td>
</tr>
<tr valign=top>
<td width=38%>FileTypeUnknown</td>
<td width=11%>0xFFFF</td>
<td width=51%>Unrecognized resource type</td>
</tr>
</table><br>
<p>
If bit0 of <i>flags</i> is clear, the <i>FileAttributes</i>, <i>LastWriteTime</i>, <i>DataSize</i>, <i>FileType</i>, and <i>DeviceState</i> have indeterminate values in the response.</p>
<p>
This SMB can request an oplock on the opened file.  Oplocks are fully described in the "Oplocks" section elsewhere in this document, and there is also discussion of oplocks in the SMB_COM_LOCKING_ANDX SMB description.  <i>bit1</i> and <i>bit2</i> of the <i>flags</i> field are used to request oplocks during open.</p>
<p>
The following SMBs may follow SMB_COM_OPEN_ANDX:</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<td width=43%>SMB_COM_READ</td>
<td width=57%>SMB_COM_READ_ANDX</td>
</tr>
<tr valign=top>
<td width=43%>SMB_COM_IOCTL</td>
<td width=57%></td>
</tr>
</table>
<p>&nbsp;</p></body>
</HTML>
