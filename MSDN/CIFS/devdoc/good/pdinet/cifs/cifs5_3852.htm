<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>NT_TRANSACT_NOTIFY_CHANGE: Request Change Notification</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_cifs_96"></a>NT_TRANSACT_NOTIFY_CHANGE: Request Change Notification</h3>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=50%>Client Setup Words<br>
==================================</td>
<td width=50%>Description<br>
=================================</td>
</tr>
<tr valign=top>
<td width=50%>ULONG CompletionFilter;</td>
<td width=50%>Specifies operation to monitor</td>
</tr>
<tr valign=top>
<td width=50%>USHORT Fid;</td>
<td width=50%>Fid of directory to monitor</td>
</tr>
<tr valign=top>
<td width=50%>BOOLEAN WatchTree;</td>
<td width=50%>TRUE = watch all subdirectories too</td>
</tr>
<tr valign=top>
<td width=50%>UCHAR Reserved;</td>
<td width=50%>MBZ</td>
</tr>
</table><br>
<p>
This command notifies the client when the directory specified by <i>Fid</i> is modified.  It also returns the name(s) of the file(s) that changed.  The command completes once the directory has been modified based on the supplied <i>CompletionFilter</i>.  The command is a "single shot" and therefore needs to be reissued to watch for more directory changes.</p>
<p>
A directory file must be opened before this command may be used.  Once the directory is open, this command may be used to begin watching files and subdirectories in the specified directory for changes.  The first time the command is issued, the <i>MaxParameterCount</i> field in the transact header determines the size of the buffer that will be used at the server to buffer directory change information between issuances of the notify change commands.</p>
<p>
When a change that is in the <i>CompletionFilter</i> is made to the directory, the command completes.  The names of the files that have changed since the last time the command was issued are returned to the client.  The <i>ParameterCount</i> field of the response indicates the number of bytes that are being returned.  If too many files have changed since the last time the command was issued, then zero bytes are returned and an alternate status code is returned in the <i>Status</i> field of the response.</p>
<p>
The <i>CompletionFilter</i> is a mask created as the sum of any of the following flags:</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<td width=59%><code>FILE_NOTIFY_CHANGE_FILE_NAME</code></td>
<td width=41%><code>0x00000001</code></td>
</tr>
<tr valign=top>
<td width=59%><code>FILE_NOTIFY_CHANGE_DIR_NAME</code></td>
<td width=41%><code>0x00000002</code></td>
</tr>
<tr valign=top>
<td width=59%><code>FILE_NOTIFY_CHANGE_NAME</code></td>
<td width=41%><code>0x00000003</code></td>
</tr>
<tr valign=top>
<td width=59%><code>FILE_NOTIFY_CHANGE_ATTRIBUTES</code></td>
<td width=41%><code>0x00000004</code></td>
</tr>
<tr valign=top>
<td width=59%><code>FILE_NOTIFY_CHANGE_SIZE</code></td>
<td width=41%><code>0x00000008</code></td>
</tr>
<tr valign=top>
<td width=59%><code>FILE_NOTIFY_CHANGE_LAST_WRITE</code></td>
<td width=41%><code>0x00000010</code></td>
</tr>
<tr valign=top>
<td width=59%><code>FILE_NOTIFY_CHANGE_LAST_ACCESS</code></td>
<td width=41%><code>0x00000020</code></td>
</tr>
<tr valign=top>
<td width=59%><code>FILE_NOTIFY_CHANGE_CREATION</code></td>
<td width=41%><code>0x00000040</code></td>
</tr>
<tr valign=top>
<td width=59%><code>FILE_NOTIFY_CHANGE_EA</code></td>
<td width=41%><code>0x00000080</code></td>
</tr>
<tr valign=top>
<td width=59%><code>FILE_NOTIFY_CHANGE_SECURITY</code></td>
<td width=41%><code>0x00000100</code></td>
</tr>
<tr valign=top>
<td width=59%><code>FILE_NOTIFY_CHANGE_STREAM_NAME</code></td>
<td width=41%><code>0x00000200</code></td>
</tr>
<tr valign=top>
<td width=59%><code>FILE_NOTIFY_CHANGE_STREAM_SIZE</code></td>
<td width=41%><code>0x00000400</code></td>
</tr>
<tr valign=top>
<td width=59%><code>FILE_NOTIFY_CHANGE_STREAM_WRITE</code></td>
<td width=41%><code>0x00000800</code></td>
</tr>
</table><br>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=50%>Server Response<br>
==================================</td>
<td width=50%>Description<br>
==================================</td>
</tr>
<tr valign=top>
<td width=50%>ParameterCount</td>
<td width=50%># of bytes of change data</td>
</tr>
<tr valign=top>
<td width=50%>Parameters[ ParameterCount ]</td>
<td width=50%>FILE_NOTIFY_INFORMATION structures</td>
</tr>
</table><br>
<p>
The response contains FILE_NOTIFY_INFORMATION structures, as defined below.  The NextEntryOffset field of the structure specifies the offset, in bytes, from the start of the current entry to the next entry in the list.  If this is the last entry in the list, this field is zero.  Each entry in the list must be longword aligned, so NextEntryOffset must be a multiple of four.</p>
<pre><code>typedef struct {
    ULONG NextEntryOffset;
    ULONG Action;
    ULONG FileNameLength;
    WCHAR FileName[1];
} FILE_NOTIFY_INFORMATION;
</code></pre>
<p>
Where <i>Action</i> describes what happened to the file named <i>FileName</i>:</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<td width=68%><code>FILE_ACTION_ADDED</code></td>
<td width=32%><code>0x00000001</code></td>
</tr>
<tr valign=top>
<td width=68%><code>FILE_ACTION_REMOVED</code></td>
<td width=32%><code>0x00000002</code></td>
</tr>
<tr valign=top>
<td width=68%><code>FILE_ACTION_MODIFIED</code></td>
<td width=32%><code>0x00000003</code></td>
</tr>
<tr valign=top>
<td width=68%><code>FILE_ACTION_RENAMED_OLD_NAME</code></td>
<td width=32%><code>0x00000004</code></td>
</tr>
<tr valign=top>
<td width=68%><code>FILE_ACTION_RENAMED_NEW_NAME</code></td>
<td width=32%><code>0x00000005</code></td>
</tr>
<tr valign=top>
<td width=68%><code>FILE_ACTION_ADDED_STREAM</code></td>
<td width=32%><code>0x00000006</code></td>
</tr>
<tr valign=top>
<td width=68%><code>FILE_ACTION_REMOVED_STREAM</code></td>
<td width=32%><code>0x00000007</code></td>
</tr>
<tr valign=top>
<td width=68%><code>FILE_ACTION_MODIFIED_STREAM</code></td>
<td width=32%><code>0x00000008</code></td>
</tr>
</table><br>
<p>&nbsp;</p></body>
</HTML>
