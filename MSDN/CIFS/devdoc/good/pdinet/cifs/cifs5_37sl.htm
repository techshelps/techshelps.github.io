<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Opportunistic Locks</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_cifs_25"></a><i></i>Opportunistic Locks</h2>
<p>
Network performance can be increased if the client can locally buffer file data.  For example, the client does not have to write information into a file on the server if the client knows that no other process is accessing the data.  Likewise, the client can buffer read-ahead data from the file if the client knows that no other process is writing the data.</p>
<p>
The mechanism which allows clients to dynamically alter their buffering strategy in a consistent manner is knows as "opportunistic locks", or <i>oplocks</i> for short.  Versions of the CIFS file sharing protocol including and newer than the "LANMAN1.0" dialect support oplocks.</p>
<p>
There are three different types of oplocks:
<ul>
<li>
An<i> exclusive</i> oplock allows a client to open a file for exclusive access and allows the client to perform arbitrary buffering</li>
<li>
A<i> batch </i>oplock allows a client to keep a file open on the server even though the local accessor on the client machine has closed the file.</li>
<li>
A<i> Level II </i>oplock indicates there are multiple readers of a file, and no writers.  Level II oplocks are supported if the negotiated dialect is <code>NT LM 0.12</code> or later.</li>
</ul>
<p>
When a client opens a file, it requests the server to grant it a particular type of oplock on the file.  The response from the server indicates the type of oplock granted to the client.  The client uses the granted oplock type to adjust its buffering policy.</p>
<p>
The <code>SMB_COM_LOCKING_ANDX</code> SMB is used to convey oplock break and response information.</p>
<p>&nbsp;</p></body>
</HTML>
