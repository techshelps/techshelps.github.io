<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>TRANS2_OPEN2: Create or Open File with Extended Attributes</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_cifs_126"></a><i></i>TRANS2_OPEN2: Create or Open File with Extended Attributes</h2>
<p>
This transaction is used to open or create a file having extended attributes.</p>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=42%>Client Request<br>
============================</td>
<td width=58%>Value<br>
=======================================</td>
</tr>
<tr valign=top>
<td width=42%>WordCount</td>
<td width=58%>15</td>
</tr>
<tr valign=top>
<td width=42%>TotalDataCount</td>
<td width=58%>Total size of extended attribute list</td>
</tr>
<tr valign=top>
<td width=42%>DataOffset</td>
<td width=58%>Offset to extended attribute list in this request</td>
</tr>
<tr valign=top>
<td width=42%>SetupCount</td>
<td width=58%>1</td>
</tr>
<tr valign=top>
<td width=42%>Setup[0]</td>
<td width=58%>TRANS2_OPEN2</td>
</tr>
<tr valign=top>
<td width=42%></td>
<td width=58%></td>
</tr>
<tr valign=top>
<td width=42%></td>
<td width=58%></td>
</tr>
<tr valign=top>
<td width=42%>Parameter Block Encoding<br>
============================</td>
<td width=58%>Description<br>
=======================================</td>
</tr>
<tr valign=top>
<td width=42%>USHORT Flags; </td>
<td width=58%>Additional information: bit set-</td>
</tr>
<tr valign=top>
<td width=42%></td>
<td width=58%>0 - return additional info</td>
</tr>
<tr valign=top>
<td width=42%></td>
<td width=58%>1 - exclusive oplock requested</td>
</tr>
<tr valign=top>
<td width=42%></td>
<td width=58%>2 - batch oplock requested</td>
</tr>
<tr valign=top>
<td width=42%></td>
<td width=58%>3 - return total length of EAs</td>
</tr>
<tr valign=top>
<td width=42%>USHORT DesiredAccess;</td>
<td width=58%>Requested file access</td>
</tr>
<tr valign=top>
<td width=42%>USHORT Reserved1;</td>
<td width=58%>Ought to be zero.  Ignored by the server.</td>
</tr>
<tr valign=top>
<td width=42%>USHORT FileAttributes;</td>
<td width=58%>Attributes for file if create</td>
</tr>
<tr valign=top>
<td width=42%>SMB_TIME CreationTime;</td>
<td width=58%>Creation time to apply to file if create</td>
</tr>
<tr valign=top>
<td width=42%>SMB_DATE CreationDate;</td>
<td width=58%>Creation date to apply to file if create</td>
</tr>
<tr valign=top>
<td width=42%>USHORT OpenFunction;</td>
<td width=58%>Open function</td>
</tr>
<tr valign=top>
<td width=42%>ULONG AllocationSize;</td>
<td width=58%>Bytes to reserve on create or truncate</td>
</tr>
<tr valign=top>
<td width=42%>USHORT Reserved [5];</td>
<td width=58%>Must be zero</td>
</tr>
<tr valign=top>
<td width=42%>STRING FileName;</td>
<td width=58%>Name of file to open or create</td>
</tr>
<tr valign=top>
<td width=42%>UCHAR Data[ TotalDataCount ]</td>
<td width=58%>FEAList structure for file to be created</td>
</tr>
</table><br>
<p>
If secondary requests are required, they must contain 0 parameter bytes, and the <i>fid</i> in the secondary request is 0xFFFF.</p>
<p>
<i>desiredaccess</i> is encoded as described in the "Access Mode Encoding" section elsewhere in this document.</p>
<p>
<i>fileattributes</i> are encoded as described in the "File Attribute Encoding" section elsewhere in this document.</p>
<p>
<i>openfunction</i> specifies the action to be taken depending on whether or not the file exists (see section 3.7) . </p>
<p>
<i>action</i> in the response specifies the action as a result of this request (see section 3.8).</p>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=39%>Response Parameter Block<br>
==========================</td>
<td width=61%>Description<br>
=========================================</td>
</tr>
<tr valign=top>
<td width=39%>USHORT Fid;</td>
<td width=61%>File handle</td>
</tr>
<tr valign=top>
<td width=39%>USHORT FileAttributes;</td>
<td width=61%>Attributes of file</td>
</tr>
<tr valign=top>
<td width=39%>SMB_TIME CreationTime;</td>
<td width=61%>Last modification time</td>
</tr>
<tr valign=top>
<td width=39%>SMB_DATE CreationDate;</td>
<td width=61%>Last modification date</td>
</tr>
<tr valign=top>
<td width=39%>ULONG DataSize;</td>
<td width=61%>Current file size</td>
</tr>
<tr valign=top>
<td width=39%>USHORT GrantedAccess;</td>
<td width=61%>Access permissions actually allowed</td>
</tr>
<tr valign=top>
<td width=39%>USHORT FileType;</td>
<td width=61%>Type of file</td>
</tr>
<tr valign=top>
<td width=39%>USHORT DeviceState;</td>
<td width=61%>State of IPC device (e.g. pipe)</td>
</tr>
<tr valign=top>
<td width=39%>USHORT Action;</td>
<td width=61%>Action taken</td>
</tr>
<tr valign=top>
<td width=39%>ULONG Reserved;</td>
<td width=61%></td>
</tr>
<tr valign=top>
<td width=39%>USHORT EaErrorOffset;</td>
<td width=61%>Offset into EA list if EA error</td>
</tr>
<tr valign=top>
<td width=39%>ULONG EaLength;</td>
<td width=61%>Total EA length for opened file</td>
</tr>
</table><br>
<p>
<i>filetype</i> returns the kind of resource actually opened:</p>
<table border=1 cellspacing=4 cols=3 frame=box rules=cols>
<tr valign=top>
<td width=35%>Name<br>
=======================</td>
<td width=10%>Value<br>
======</td>
<td width=55%>Description<br>
=====================================</td>
</tr>
<tr valign=top>
<td width=35%>FileTypeDisk</td>
<td width=10%>0</td>
<td width=55%>Disk file or directory as defined in the attribute field</td>
</tr>
<tr valign=top>
<td width=35%>FileTypeByteModePipe</td>
<td width=10%>1</td>
<td width=55%>Named pipe in byte mode</td>
</tr>
<tr valign=top>
<td width=35%>FileTypeMessageModePipe</td>
<td width=10%>2</td>
<td width=55%>Named pipe in message mode</td>
</tr>
<tr valign=top>
<td width=35%>FileTypePrinter</td>
<td width=10%>3</td>
<td width=55%>Spooled printer</td>
</tr>
<tr valign=top>
<td width=35%>FileTypeUnknown</td>
<td width=10%>0xFFFF</td>
<td width=55%>Unrecognized resource type</td>
</tr>
</table><br>
<p>
<i>DeviceState</i> is applicable only if the <i>FileType</i> is FileTypeByteModePipe or FileTypeMessageModePipe and is encoded as in section 3.9.</p>
<p>
If an error was detected in the incoming EA list, the offset of the error is returned in <i>EaErrorOffset</i>.</p>
<p>
If <i>bit0</i> of <i>flags</i> in the request is clear, the <i>FileAttributes</i>, <i>creationtime</i>, <i>creationdate</i>, <i>datasize</i>, <i>grantedaccess</i>, <i>filetype</i>, and <i>devicestate</i> have indeterminate values in the response.  Similarly, if <i>bit3</i> of the request is clear, <i>ealength</i> in the response has an indeterminate value in the response.</p>
<p>
This SMB can request an oplock on the opened file.  Oplocks are fully described in the "Oplocks" section elsewhere in this document, and there is also discussion of oplocks in the SMB_COM_LOCKING_ANDX SMB description.  <i>bit1</i> and <i>bit2</i> of the <i>flags</i> field are used to request oplocks during open.</p>
<p>&nbsp;</p></body>
</HTML>
