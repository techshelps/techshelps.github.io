<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>TRANS2_FIND_FIRST2: Search Directory using Wildcards</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_cifs_93"></a>TRANS2_FIND_FIRST2: Search Directory using Wildcards</h3>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=50%>Client Request<br>
==================================</td>
<td width=50%>Value<br>
==================================</td>
</tr>
<tr valign=top>
<td width=50%>WordCount</td>
<td width=50%>15</td>
</tr>
<tr valign=top>
<td width=50%>TotalDataCount</td>
<td width=50%>Total size of extended attribute list</td>
</tr>
<tr valign=top>
<td width=50%>SetupCount</td>
<td width=50%>1</td>
</tr>
<tr valign=top>
<td width=50%>Setup[0]</td>
<td width=50%>TRANS2_FIND_FIRST2</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%>Parameter Block Encoding<br>
==================================</td>
<td width=50%>Description<br>
==================================</td>
</tr>
<tr valign=top>
<td width=50%>USHORT SearchAttributes;</td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%>USHORT SearchCount;</td>
<td width=50%>Maximum number of entries to return</td>
</tr>
<tr valign=top>
<td width=50%>USHORT Flags;</td>
<td width=50%>Additional information:</td>
</tr>
<tr valign=top>
<td width=50%> </td>
<td width=50%>Bit 0 - close search after this request</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%>Bit 1 - close search if end of search reached</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%>Bit 2 - return resume keys for each entry found</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%>Bit 3 - continue search from previous ending place</td>
</tr>
<tr valign=top>
<td width=50%></td>
<td width=50%>Bit 4 - find with backup intent</td>
</tr>
<tr valign=top>
<td width=50%>USHORT InformationLevel;</td>
<td width=50%>See below</td>
</tr>
<tr valign=top>
<td width=50%>ULONG SearchStorageType;</td>
<td width=50%></td>
</tr>
<tr valign=top>
<td width=50%>STRING FileName;</td>
<td width=50%>Pattern for the search</td>
</tr>
<tr valign=top>
<td width=50%>UCHAR Data[ TotalDataCount ]</td>
<td width=50%>FEAList if InformationLevel is <code>QUERY_EAS_FROM_LIST</code></td>
</tr>
</table><br>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=50%>Response Parameter Block<br>
==================================</td>
<td width=50%>Description<br>
==================================</td>
</tr>
<tr valign=top>
<td width=50%>USHORT Sid;</td>
<td width=50%>Search handle</td>
</tr>
<tr valign=top>
<td width=50%>USHORT SearchCount;</td>
<td width=50%>Number of entries returned</td>
</tr>
<tr valign=top>
<td width=50%>USHORT EndOfSearch;</td>
<td width=50%>Was last entry returned?</td>
</tr>
<tr valign=top>
<td width=50%>USHORT EaErrorOffset;</td>
<td width=50%>Offset into EA list if EA error</td>
</tr>
<tr valign=top>
<td width=50%>USHORT LastNameOffset;</td>
<td width=50%>Offset into data to file name of last entry, if server needs it to resume search; else 0</td>
</tr>
<tr valign=top>
<td width=50%>UCHAR Data[ TotalDataCount ]</td>
<td width=50%>Level dependent info about the matches found in the search</td>
</tr>
</table><br>
<p>
This request allows the client to search for the file(s) which match the file specification.  The search can be continued if necessary with <code>TRANS2_FIND_NEXT2. </code>There are numerous levels of information which may be obtained for the returned files, the desired level is specified in the <i>InformationLevel</i> field of the request.</p>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=65%>InformationLevel Name<br>
=================================</td>
<td width=35%>Value<br>
====================</td>
</tr>
<tr valign=top>
<td width=65%><code>SMB_INFO_STANDARD</code></td>
<td width=35%>1</td>
</tr>
<tr valign=top>
<td width=65%><code>SMB_INFO_QUERY_EA_SIZE</code></td>
<td width=35%>2</td>
</tr>
<tr valign=top>
<td width=65%><code>SMB_INFO_QUERY_EAS_FROM_LIST</code></td>
<td width=35%>3</td>
</tr>
<tr valign=top>
<td width=65%><code>SMB_FIND_FILE_DIRECTORY_INFO</code></td>
<td width=35%>0x101</td>
</tr>
<tr valign=top>
<td width=65%><code>SMB_FIND_FILE_FULL_DIRECTORY_INFO</code></td>
<td width=35%>0x102</td>
</tr>
<tr valign=top>
<td width=65%><code>SMB_FIND_FILE_NAMES_INFO</code></td>
<td width=35%>0x103</td>
</tr>
<tr valign=top>
<td width=65%><code>SMB_FIND_FILE_BOTH_DIRECTORY_INFO</code></td>
<td width=35%>0x104</td>
</tr>
</table><br>
<p>
The following sections detail the data returned for each InformationLevel. The requested information is placed in the <i>data</i> portion of the transaction response. Note: a client which does not support long names can only request <code>SMB_INFO_STANDARD.</code>  </p>
<h4>SMB_INFO_STANDARD</h4>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=48%>Response Field<br>
================================</td>
<td width=52%>Description<br>
==================================</td>
</tr>
<tr valign=top>
<td width=48%>SMB_DATE CreationDate;</td>
<td width=52%>Date when file was created</td>
</tr>
<tr valign=top>
<td width=48%>SMB_TIME CreationTime;</td>
<td width=52%>Time when file was created</td>
</tr>
<tr valign=top>
<td width=48%>SMB_DATE LastAccessDate;</td>
<td width=52%>Date of last file access</td>
</tr>
<tr valign=top>
<td width=48%>SMB_TIME LastAccessTime;</td>
<td width=52%>Time of last file access</td>
</tr>
<tr valign=top>
<td width=48%>SMB_DATE LastWriteDate;</td>
<td width=52%>Date of last write to the file</td>
</tr>
<tr valign=top>
<td width=48%>SMB_TIME LastWriteTime;</td>
<td width=52%>Time of last write to the file</td>
</tr>
<tr valign=top>
<td width=48%>ULONG  DataSize;</td>
<td width=52%>File Size</td>
</tr>
<tr valign=top>
<td width=48%>ULONG AllocationSize;</td>
<td width=52%>Size of filesystem allocation unit</td>
</tr>
<tr valign=top>
<td width=48%>USHORT Attributes;</td>
<td width=52%>File Attributes</td>
</tr>
<tr valign=top>
<td width=48%>UCHAR FileNameLength;</td>
<td width=52%>Length of filename in bytes</td>
</tr>
<tr valign=top>
<td width=48%>STRING FileName;</td>
<td width=52%>Name of found file</td>
</tr>
</table><br>
<h4>SMB_INFO_QUERY_EA_SIZE</h4>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=49%>Response Field<br>
=================================</td>
<td width=51%>Description<br>
==================================</td>
</tr>
<tr valign=top>
<td width=49%>SMB_DATE CreationDate;</td>
<td width=51%>Date when file was created</td>
</tr>
<tr valign=top>
<td width=49%> SMB_TIME CreationTime;</td>
<td width=51%>Time when file was created</td>
</tr>
<tr valign=top>
<td width=49%> SMB_DATE LastAccessDate;</td>
<td width=51%>Date of last file access</td>
</tr>
<tr valign=top>
<td width=49%> SMB_TIME LastAccessTime;</td>
<td width=51%>Time of last file access</td>
</tr>
<tr valign=top>
<td width=49%> SMB_DATE LastWriteDate;</td>
<td width=51%>Date of last write to the file</td>
</tr>
<tr valign=top>
<td width=49%> SMB_TIME LastWriteTime;</td>
<td width=51%>Time of last write to the file</td>
</tr>
<tr valign=top>
<td width=49%> ULONG DataSize;</td>
<td width=51%>File Size</td>
</tr>
<tr valign=top>
<td width=49%> ULONG AllocationSize;</td>
<td width=51%>Size of filesystem allocation unit</td>
</tr>
<tr valign=top>
<td width=49%> USHORT Attributes;</td>
<td width=51%>File Attributes</td>
</tr>
<tr valign=top>
<td width=49%> ULONG EaSize;</td>
<td width=51%>Size of file's EA information</td>
</tr>
<tr valign=top>
<td width=49%> UCHAR FileNameLength;</td>
<td width=51%>Length of filename in bytes</td>
</tr>
<tr valign=top>
<td width=49%> STRING FileName;</td>
<td width=51%>Name of found file</td>
</tr>
</table><br>
<h4>SMB_INFO_QUERY_EAS_FROM_LIST</h4>
<p>
This request returns the same information as <code>SMB_INFO_QUERY_EA_SIZE</code>, but only for files which have an EA list which match the EA information in the <i>data</i> part of the request.</p>
<h4>SMB_FIND_FILE_DIRECTORY_INFO</h4>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=49%>Response Field<br>
=================================</td>
<td width=51%>Description<br>
==================================</td>
</tr>
<tr valign=top>
<td width=49%>ULONG NextEntryOffset;</td>
<td width=51%>Offset from this structure to beginning of next one</td>
</tr>
<tr valign=top>
<td width=49%>ULONG FileIndex;</td>
<td width=51%></td>
</tr>
<tr valign=top>
<td width=49%>LARGE_INTEGER CreationTime;</td>
<td width=51%>file creation time</td>
</tr>
<tr valign=top>
<td width=49%>LARGE_INTEGER LastAccessTime;</td>
<td width=51%>last access time</td>
</tr>
<tr valign=top>
<td width=49%>LARGE_INTEGER LastWriteTime;</td>
<td width=51%>last write time</td>
</tr>
<tr valign=top>
<td width=49%>LARGE_INTEGER ChangeTime;</td>
<td width=51%>last attribute change time</td>
</tr>
<tr valign=top>
<td width=49%>LARGE_INTEGER EndOfFile;</td>
<td width=51%>file size</td>
</tr>
<tr valign=top>
<td width=49%>LARGE_INTEGER AllocationSize;</td>
<td width=51%>size of filesystem allocation information </td>
</tr>
<tr valign=top>
<td width=49%>ULONG ExtFileAttributes;</td>
<td width=51%>Extended file attributes (see section 3.11)</td>
</tr>
<tr valign=top>
<td width=49%>ULONG FileNameLength;</td>
<td width=51%>Length of filename in bytes</td>
</tr>
<tr valign=top>
<td width=49%>STRING FileName;</td>
<td width=51%>Name of the file</td>
</tr>
</table><br>
<h4>SMB_FIND_FILE_FULL_DIRECTORY_INFO</h4>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=49%>Response Field<br>
=================================</td>
<td width=51%>Description<br>
==================================</td>
</tr>
<tr valign=top>
<td width=49%>ULONG NextEntryOffset;</td>
<td width=51%>Offset from this structure to beginning of next one</td>
</tr>
<tr valign=top>
<td width=49%>ULONG FileIndex;</td>
<td width=51%></td>
</tr>
<tr valign=top>
<td width=49%>LARGE_INTEGER CreationTime;</td>
<td width=51%>file creation time</td>
</tr>
<tr valign=top>
<td width=49%>LARGE_INTEGER LastAccessTime;</td>
<td width=51%>last access time</td>
</tr>
<tr valign=top>
<td width=49%>LARGE_INTEGER LastWriteTime;</td>
<td width=51%>last write time</td>
</tr>
<tr valign=top>
<td width=49%>LARGE_INTEGER ChangeTime;</td>
<td width=51%>last attribute change time</td>
</tr>
<tr valign=top>
<td width=49%>LARGE_INTEGER EndOfFile;</td>
<td width=51%>file size</td>
</tr>
<tr valign=top>
<td width=49%>LARGE_INTEGER AllocationSize;</td>
<td width=51%>size of filesystem allocation information </td>
</tr>
<tr valign=top>
<td width=49%>ULONG ExtFileAttributes;</td>
<td width=51%>Extended file attributes (see section 3.11)</td>
</tr>
<tr valign=top>
<td width=49%>ULONG FileNameLength;</td>
<td width=51%>Length of filename in bytes</td>
</tr>
<tr valign=top>
<td width=49%>ULONG EaSize;</td>
<td width=51%>Size of file's extended attributes</td>
</tr>
<tr valign=top>
<td width=49%>STRING FileName;</td>
<td width=51%>Name of the file</td>
</tr>
</table><br>
<h4>SMB_FIND_FILE_BOTH_DIRECTORY_INFO</h4>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=49%>Response Field<br>
=================================</td>
<td width=51%>Description<br>
==================================</td>
</tr>
<tr valign=top>
<td width=49%>ULONG NextEntryOffset;</td>
<td width=51%>Offset from this structure to beginning of next one</td>
</tr>
<tr valign=top>
<td width=49%>ULONG FileIndex;</td>
<td width=51%></td>
</tr>
<tr valign=top>
<td width=49%>LARGE_INTEGER CreationTime;</td>
<td width=51%>file creation time</td>
</tr>
<tr valign=top>
<td width=49%>LARGE_INTEGER LastAccessTime;</td>
<td width=51%>last access time</td>
</tr>
<tr valign=top>
<td width=49%>LARGE_INTEGER LastWriteTime;</td>
<td width=51%>last write time</td>
</tr>
<tr valign=top>
<td width=49%>LARGE_INTEGER ChangeTime;</td>
<td width=51%>last attribute change time</td>
</tr>
<tr valign=top>
<td width=49%>LARGE_INTEGER EndOfFile;</td>
<td width=51%>file size</td>
</tr>
<tr valign=top>
<td width=49%>LARGE_INTEGER AllocationSize;</td>
<td width=51%>size of filesystem allocation information </td>
</tr>
<tr valign=top>
<td width=49%>ULONG ExtFileAttributes;</td>
<td width=51%>Extended file attributes (see section 3.11)</td>
</tr>
<tr valign=top>
<td width=49%>ULONG FileNameLength;</td>
<td width=51%>Length of FileName in bytes</td>
</tr>
<tr valign=top>
<td width=49%>ULONG EaSize;</td>
<td width=51%>Size of file's extended attributes</td>
</tr>
<tr valign=top>
<td width=49%>UCHAR ShortNameLength;</td>
<td width=51%>Length of file's short name in bytes</td>
</tr>
<tr valign=top>
<td width=49%>UCHAR Reserved</td>
<td width=51%></td>
</tr>
<tr valign=top>
<td width=49%>WCHAR ShortName[12];</td>
<td width=51%>File's 8.3 conformant name in Unicode</td>
</tr>
<tr valign=top>
<td width=49%>STRING FileName;</td>
<td width=51%>Files full length name</td>
</tr>
</table><br>
<h4>SMB_FIND_FILE_NAMES_INFO</h4>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=49%>Response Field<br>
=================================</td>
<td width=51%>Description<br>
==================================</td>
</tr>
<tr valign=top>
<td width=49%>ULONG NextEntryOffset;</td>
<td width=51%>Offset from this structure to beginning of next one</td>
</tr>
<tr valign=top>
<td width=49%>ULONG FileIndex;</td>
<td width=51%></td>
</tr>
<tr valign=top>
<td width=49%>ULONG FileNameLength;</td>
<td width=51%>Length of FileName in bytes</td>
</tr>
<tr valign=top>
<td width=49%>STRING FileName;</td>
<td width=51%>Files full length name</td>
</tr>
</table>
<p>&nbsp;</p></body>
</HTML>
