<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>WRITE_ANDX:  Write Bytes to file or resource</title>
<link disabled rel=stylesheet href=../../../backsdk3.css>
<style type="text/css">
@import url(../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_cifs_76"></a>WRITE_ANDX:  Write Bytes to file or resource</h3>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=46%>Client Request<br>
===============================</td>
<td width=54%>Description<br>
====================================</td>
</tr>
<tr valign=top>
<td width=46%>UCHAR WordCount;</td>
<td width=54%>Count of parameter words = 12 or 14</td>
</tr>
<tr valign=top>
<td width=46%>UCHAR AndXCommand;</td>
<td width=54%>Secondary (X) command;  0xFF = none</td>
</tr>
<tr valign=top>
<td width=46%>UCHAR AndXReserved;</td>
<td width=54%>Reserved (must be 0)</td>
</tr>
<tr valign=top>
<td width=46%>USHORT AndXOffset;</td>
<td width=54%>Offset to next command WordCount</td>
</tr>
<tr valign=top>
<td width=46%>USHORT Fid;</td>
<td width=54%>File handle</td>
</tr>
<tr valign=top>
<td width=46%>ULONG Offset;</td>
<td width=54%>Offset in file to begin write</td>
</tr>
<tr valign=top>
<td width=46%>ULONG Reserved;</td>
<td width=54%>Must be 0</td>
</tr>
<tr valign=top>
<td width=46%>USHORT WriteMode;</td>
<td width=54%>Write mode bits:</td>
</tr>
<tr valign=top>
<td width=46%></td>
<td width=54%>0 - write through</td>
</tr>
<tr valign=top>
<td width=46%>USHORT Remaining;</td>
<td width=54%>Bytes remaining to satisfy request</td>
</tr>
<tr valign=top>
<td width=46%>USHORT Reserved;</td>
<td width=54%></td>
</tr>
<tr valign=top>
<td width=46%>USHORT DataLength;</td>
<td width=54%>Number of data bytes in buffer (&gt;=0)</td>
</tr>
<tr valign=top>
<td width=46%>USHORT DataOffset;</td>
<td width=54%>Offset to data bytes</td>
</tr>
<tr valign=top>
<td width=46%>ULONG OffsetHigh;</td>
<td width=54%>Upper 32 bits of offset (only present if WordCount = 14)</td>
</tr>
<tr valign=top>
<td width=46%>USHORT ByteCount;</td>
<td width=54%>Count of data bytes</td>
</tr>
<tr valign=top>
<td width=46%>UCHAR Pad[];</td>
<td width=54%>Pad to SHORT or LONG</td>
</tr>
<tr valign=top>
<td width=46%>UCHAR Data[DataLength];</td>
<td width=54%>Data to write</td>
</tr>
</table><br>
<table border=1 cellspacing=4 cols=2 frame=box rules=cols>
<tr valign=top>
<td width=46%>Server Response<br>
===============================</td>
<td width=54%>Description<br>
====================================</td>
</tr>
<tr valign=top>
<td width=46%>UCHAR WordCount;</td>
<td width=54%>Count of parameter words = 6</td>
</tr>
<tr valign=top>
<td width=46%>UCHAR AndXCommand;</td>
<td width=54%>Secondary (X) command;  0xFF = none</td>
</tr>
<tr valign=top>
<td width=46%>UCHAR AndXReserved;</td>
<td width=54%>Reserved (must be 0)</td>
</tr>
<tr valign=top>
<td width=46%>USHORT AndXOffset;</td>
<td width=54%>Offset to next command WordCount</td>
</tr>
<tr valign=top>
<td width=46%>USHORT Count;</td>
<td width=54%>Number of bytes written</td>
</tr>
<tr valign=top>
<td width=46%>USHORT Remaining;</td>
<td width=54%>Reserved</td>
</tr>
<tr valign=top>
<td width=46%>ULONG Reserved;</td>
<td width=54%></td>
</tr>
<tr valign=top>
<td width=46%>USHORT ByteCount;</td>
<td width=54%>Count of data bytes = 0</td>
</tr>
</table><br>
<p>
A <i>ByteCount</i> of 0 does not truncate the file.  Rather a zero length write merely transfers zero bytes of information to the file.  A request such as SMB_COM_WRITE must be used to truncate the file.</p>
<p>
If <i>WriteMode</i> has bit0 set in the request and <i>Fid</i> refers to a disk file, the response is not sent from the server until the data is on stable storage.</p>
<p>
If the negotiated dialect is <code>NT LM 0.12</code> or later, the 14 word format of this SMB may be used to access portions of files requiring offsets expressed as 64 bits. Otherwise, the OffsetHigh field must be omitted from the request.</p>
<p>
The following are the valid <i>AndXCommand</i> values for this SMB:</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<td width=51%>SMB_COM_READ</td>
<td width=49%>SMB_COM_READ_ANDX</td>
</tr>
<tr valign=top>
<td width=51%>SMB_COM_LOCK_AND_READ</td>
<td width=49%>SMB_COM_WRITE_ANDX</td>
</tr>
<tr valign=top>
<td width=51%>SMB_COM_CLOSE</td>
<td width=49%></td>
</tr>
<tr valign=top>
<td width=51%></td>
<td width=49%></td>
</tr>
</table><br>
<h4>Errors</h4>
<p>
ERRDOS/ERRnoaccess<br>
ERRDOS/ERRbadfid<br>
ERRDOS/ERRlock<br>
ERRDOS/ERRbadaccess<br>
ERRSRV/ERRinvid<br>
ERRSRV/ERRbaduid</p>
<p>&nbsp;</p></body>
</HTML>
