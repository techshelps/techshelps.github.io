<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>DsGetDcName</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_dsgetdcname"></a>DsGetDcName</h1>
<p>
<span style=color:#FF0000>[This is preliminary documentation and subject to change.]</span> </p>
<p>
The <b>DsGetDcName</b> function returns the name of a domain controller (DC) in a specified domain. You can supply DC selection criteria are to this function to indicate preference for a DC with particular characteristics.</p>
<pre><code><b>DWORD DsGetDcName(
  LPCTSTR</b> <i>ComputerName</i>,
<b>  LPCTSTR</b> <i>DomainName</i>,
<b>  GUID</b> <i>*DomainGuid</i>,
<b>  LPCTSTR</b> <i>SiteName</i>,
<b>  ULONG</b> <i>Flags</i>,
<b>  PDOMAIN_CONTROLLER_INFO</b> <i>*DomainControllerInfo</i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>ComputerName</i></dt>
<dd>
Pointer to a null-terminated string that specifies the name of the remote server to process this function. Typically, this parameter should be specified as NULL.</dd>
<dt>
<i>DomainName</i></dt>
<dd>
Pointer to a null-terminated string that specifies the name of the domain to query. This name can either be a DNS-style name (for example, microsoft.com.) or a flat-style name (for example, microsoft). If a DNS-style name is specified, the name may be specified with or without a trailing period. 
<p>
If NULL is specified <i>and</i> the DS_GC_SERVER_REQUIRED flag is specified, <i>DomainName</i> defaults to the tree name of the primary domain of <i>ComputerName</i>.

<p>
If NULL is specified and the DS_GC_SERVER_REQUIRED flag is <i>not</i> specified, <i>DomainName</i> defaults to the domain name of the primary domain of <i>ComputerName</i>.
</dd>
<dt>
<i>DomainGuid</i></dt>
<dd>
Pointer to a <object id=alink_1 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="DefaultTopic" value="../../notopic_0pk4.htm">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="_rpc_guid">
</object><a href=JavaScript:alink_1.Click()><b>GUID</b></a> structure that specifies the Domain GUID of the domain being queried. This value renames the domain. That is, if this value is specified and <i>DomainName</i> has been renamed, <b>DsGetDcName</b> attempts to locate a DC in the domain having the GUID specified by <i>DomainGuid</i>.</dd>
<dt>
<i>SiteName</i></dt>
<dd>
Pointer to a null-terminated string that specifies the name of the site the returned DC should be physically near. The parameter should typically be the name of the site where the client is located. If not specified, <i>SiteName</i> defaults to the site of <i>ComputerName</i>.</dd>
<dt>
<i>Flags</i> </dt>
<dd>
Passes additional information to be used to process the request. This parameter can be a combination of the following values.
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=57%>Value</th>
<th align=left width=43%>Meaning</th>
</tr>
<tr valign=top>
<td width=57%>DS_FORCE_REDISCOVERY</td>
<td width=43%>Use this flag when an additional domain controller becomes available or where a domain controller has been detected to be unavailable. This function only guarantees the DC returned when the DC was initially entered into the cache. Do not specify this flag unless you have recently called this function without this flag. You should attempt to access the cached domain controller.  Only if that access fails should you call again with this flag.</td>
</tr>
<tr valign=top>
<td width=57%>DS_DIRECTORY_SERVICE_REQUIRED</td>
<td width=43%>Requires that the returned DC support Windows NT 5.0 or later.</td>
</tr>
<tr valign=top>
<td width=57%>DS_DIRECTORY_SERVICE_PREFERRED</td>
<td width=43%>Prefers that the returned DC support directory service functions (Windows NT 5.0 or later). If no such DC is available, an earlier version of the DC returns. If a DC that supports a DS is not available, <b>DsGetDcName</b> returns the name of a non-DS DC. However, <b>DsGetDcName</b> returns only the non-DS DC information after the attempt to find a DS DC times out.</td>
</tr>
<tr valign=top>
<td width=57%>DS_GC_SERVER_REQUIRED</td>
<td width=43%>Requires that the returned DC be a global catalog (GC) server for the tree of domains with this domain as the root. This flag may not be set if any of the following flags are set: DS_WRITABLE_REQUIRED, DS_FDC_REQUIRED, or DS_PDC_REQUIRED.</td>
</tr>
<tr valign=top>
<td width=57%>DS_PDC_REQUIRED</td>
<td width=43%>Requires that the returned DC be the primary domain controller (PDC) for the domain. This flag may not be set if any of the following flags are set: DS_WRITABLE_REQUIRED, DS_FDC_REQUIRED, or DS_GC_SERVER_REQUIRED.</td>
</tr>
<tr valign=top>
<td width=57%>DS_WRITABLE_REQUIRED</td>
<td width=43%>Requires that the returned DC host a writable copy of the DS (or SAM). If the specified <i>DomainName</i> is a flat name, this flag is the same as DS_PDC_REQUIRED. If the specified <i>DomainName</i> is a DNS name, this flag finds writable DCs. Only the PDC is writable in a Windows NT 5.0 "mixed mode" domain. All DCs are writable in a Windows NT 5.0 "non-mixed mode" domain. In future releases of Windows NT, certain DCs may be configured as "read only"; such DCs are not writableIn future releases of Windows NT, certain DCs may be configured as "read only"; such DCs will not list themselves as writable. This flag may not be set if any of the following flags are set: DS_PDC_REQUIRED, DS_FDC_REQUIRED, or DS_GC_SERVER_REQUIRED.</td>
</tr>
<tr valign=top>
<td width=57%>DS_FDC_REQUIRED</td>
<td width=43%>Requires that the returned DC be the floating domain controller (FDC) for the domain. In a mixed domain with a Windows NT 3.x or Windows NT 4.0 PDC and one or more Windows NT 5.0 BDCs, one of the Windows NT 5.0 PDCs plays the special role of replicating account changes from the PDC. That DC is called the "floating" DC because the function "floats" to another Windows NT 5.0 BDC automatically if the current FDC becomes unavailable.This flag may not be set if any of the following flags are set: DS_PDC_REQUIRED, DS_WRITABLE_REQUIRED, or DS_GC_SERVER_REQUIRED.</td>
</tr>
<tr valign=top>
<td width=57%>DS_IP_REQUIRED</td>
<td width=43%>Requires that the IP address of the discovered DC be returned in <b>DomainControllerAddress</b><i> </i>of the <a href="ntlmapi_8ghe.htm"><b>DOMAIN_CONTROLLER_INFO</b></a> structure.</td>
</tr>
<tr valign=top>
<td width=57%>DS_KDC_REQUIRED</td>
<td width=43%>Requires that the returned DC be currently running the Kerberos Key Distribution Center service.</td>
</tr>
<tr valign=top>
<td width=57%>DS_TIMESERV_REQUIRED</td>
<td width=43%>Requires that the returned DC be currently running the Windows Time service.</td>
</tr>
<tr valign=top>
<td width=57%>DS_IS_FLAT_NAME </td>
<td width=43%>Specifies that the <i>DomainName</i> parameter is a flat name. As such, the IP/DNS compatible locator will not be attempted. This flag may not be specified with the DS_IS_DNS_NAME flag.  It is valid to not set DS_IS_FLAT_NAME and DS_IS_DNS_NAME; however, <b>DsGetDcName</b> will take longer to find a DC in that case because it has to search for both the DNS-style and flat name.  It is potentially ambiguous to specify neither flag. When this flag is specified, <b>DsGetDcName</b> is NOT search for the DNS-style name of the domain</td>
</tr>
<tr valign=top>
<td width=57%>DS_IS_DNS_NAME</td>
<td width=43%>Specifies that the <i>DomainName</i> parameter is a DNS name.   This flag may not be specified with the DS_IS_FLAT_NAME flag.</td>
</tr>
</table><br>

</dd>
<dt>
<i>DomainControllerInfo</i></dt>
<dd>
Pointer to a variable that receives a pointer to a <a href="ntlmapi_8ghe.htm"><b>DOMAIN_CONTROLLER_INFO</b></a> structure describing the domain controller selected.  The returned structure must be deallocated using <a href="ntlmapi_0lk5.htm"><b>NetApiBufferFree</b></a>.
</dd>
</dl>
<h4>Remarks</h4>
<p>
The <b>DsGetDcName</b> function is sent to the Netlogon service on the remote computer specified by <i>ComputerName</i>.</p>
<p>
<b>DsGetDcName</b> does not require any particular access to the specified domain. By default, this function does not ensure that the returned domain controller is currently available. Rather, the caller should attempt to use the returned domain controller. If the domain controller is not available, the caller should repeat the <b>DsGetDcName</b> function, specifying the DS_FORCE_REDISCOVERY flag.</p>
<h4>Return Values</h4>
<p>
If the function returns domain controller information, the return value is NO_ERROR.</p>
<p>
If the function fails, the return value is one of the following error codes.</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=56%>Value</th>
<th align=left width=44%>Meaning</th>
</tr>
<tr valign=top>
<td colspan=2 width=100%></td>
</tr>
<tr valign=top>
<td width=56%>ERROR_NO_SUCH_DOMAIN</td>
<td width=44%>No DC is available for the specified domain or the domain does not exist.</td>
</tr>
<tr valign=top>
<td width=56%>ERROR_INVALID_DOMAINNAME </td>
<td width=44%>The format of the specified <i>DomainName</i> is invalid.</td>
</tr>
<tr valign=top>
<td width=56%>ERROR_INVALID_COMPUTERNAME </td>
<td width=44%>The format of the specified <i>ComputerName</i> is invalid.</td>
</tr>
<tr valign=top>
<td width=56%>ERROR_INVALID_FLAGS </td>
<td width=44%>The <i>Flags</i> parameter has conflicting or superfluous bits set.</td>
</tr>
<tr valign=top>
<td width=56%>ERROR_NOT_ENOUGH_MEMORY</td>
<td width=44%>Insufficient memory is available.</td>
</tr>
</table><br>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 5.0 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in dsgetdc.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use netapi32.lib.<br>
<b>&nbsp;&nbsp;Unicode: </b>Implemented as Unicode and ANSI versions on Windows NT.</p>
<h4>See Also</h4>
<p>
<a href="ntlmapi_7o4f.htm">Networking (Net) Overview</a>, <a href="ntlmapi_0bn7.htm">Net Functions</a>, <a href="ntlmapi_4qzp.htm"><b>DsGetSiteName</b></a>, <a href="ntlmapi_59ut.htm"><b>DSValidateSubnetName</b></a></p>
<p>&nbsp;</p></body>
</HTML>
