<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Directory Service (Ds) Functions</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h3><a name="_win32_directory_service_ds_functions"></a>Directory Service (Ds) Functions</h3>
<p>
The Directory Service (DS) functions provide a mechanism for locating a domain controller (DC) in a Windows NT domain. The architecture interacts with clients as well as servers in all versions of Windows NT.The following functions allow developers to work with the domain controller in the directory service:</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=37%>Function </th>
<th align=left width=63%>Description </th>
</tr>
<tr valign=top>
<td width=37%><a href="ntlmapi_3vol.htm"><b>DsGetDcName</b></a> </td>
<td width=63%>Returns the name of a domain controller (DC) in a specified domain. The <b>DsGetDcName</b> function provides information from the <a href="ntlmapi_8ghe.htm"><b>DOMAIN_CONTROLLER_INFO</b></a> structure. </td>
</tr>
<tr valign=top>
<td width=37%><a href="ntlmapi_4qzp.htm"><b>DsGetSiteName</b></a> </td>
<td width=63%>Returns the name of the site for either the domain controller, member workstation, or the member server.</td>
</tr>
<tr valign=top>
<td width=37%><a href="ntlmapi_59ut.htm"><b>DsValidateSubnetName</b></a> </td>
<td width=63%>Validates a subnet name of a valid IP address.</td>
</tr>
</table><br>
<p>
The DC locator (<b>DsGetDcName</b>) is implemented by the Netlogon service. Each DC registers its DNS name on the DNS server and its Netbios name using a transport-specific mechanism (for example, in WINS). The DC locator looks up the name, then sends a datagram to (or "pings") the DC that registered the name. For Netbios domain names, the datagram is a mailslot message. For DNS domain names, the datagram is an LDAP UDP search. Each such DC responds indicating that it is currently operational. The first DC to respond is returned to the caller.</p>
<p>
The returned DC is cached so that subsequent callers need not repeat the precedingalgorithm, and to encourage all callers to use that same DC. This ensures that a single client has a consistent view of the contents of the DC.</p>
<p>
When searching for a DC by DNS domain name, the DC locator will attempt to find a DC in the "closest" site. Each DC registers additional DNS records indicating what site that the DC is in and what sites the DC includes. The DC locator first searches for this site-specific DNS record before searching for the DNS record that is not site-specific (thus preferring a DC in that site).  When the DC locator sends a datagram to the DC, the DC looks up the IP address of the client in the Configuration/Sites/Subnet container of the DS to find a subnet object.  The <b>SiteObject</b> property of the subnet object defines the name of the site that contains the client. The DC responds to the ping with the name of the site that contains the client, along with an indicator of whether this DC covers that site. If the DC does not include that site and the DC locator has not yet attempted to find a DC in that site, the DC locator tries again to find a DC in the site.</p>
<p>
To find the name of the site containing the client,use the <b>DsGetSiteName</b> function.<b> </b>The names of the objects in the Configuration/Sites<b>/</b>Subnet container must be valid subnet names.<b> </b>The <b>DsValidateSubnetName</b> function indicates whether a specified subnet name is valid.</p>
<p>&nbsp;</p></body>
</HTML>
