<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>WNetUseConnection</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_wnetuseconnection"></a>WNetUseConnection</h1>
<p>
The <b>WNetUseConnection</b> function makes a connection to a network resource. The function can redirect a local device to the network resource.</p>
<p>
The <b>WNetUseConnection</b> function is similar to the <a href="networks_84z7.htm"><b>WNetAddConnection3</b></a> function. The main difference is that <b>WNetUseConnection</b> can automatically select an unused local device to be redirected to the network resource.</p>
<p>
<b>Windows 95:<br>
</b>For Windows 95, the <i>lpUserName</i><b> </b>and<b> </b><i>lpPassword</i> parameters are in reverse order from those in the Windows NT version as follows:</p>
<pre><code><b>DWORD WNetUseConnection(
  HWND</b><i> hwndOwner</i><b>,               </b>
<b>  LPNETRESOURCE</b><i> lpNetResource</i><b>,  </b>
<b>  LPTSTR</b><i> lpUserName</i><b>,            </b>
<b>  LPTSTR</b><i> lpPassword</i><b>,            </b>
<b>  DWORD</b><i> dwFlags</i><b>,                </b>
<b>  LPTSTR</b><i> lpAccessName</i><b>,          </b>
<b>  LPDWORD</b><i> lpBufferSize</i><b>,         </b>
<b>  LPDWORD</b><i> lpResult              </i>
<b>);</b>
 </code></pre>
<p>
For Windows NT the parameter order is as follows:</p>
<pre><code><b>DWORD WNetUseConnection(
  HWND</b><i> hwndOwner</i><b>,               </b>
<b>  LPNETRESOURCE</b><i> lpNetResource</i><b>,  </b>
<b>  LPTSTR</b><i> lpPassword</i><b>,            </b>
<b>  LPTSTR</b><i> lpUserName</i><b>,            </b>
<b>  DWORD</b><i> dwFlags</i><b>,                </b>
<b>  LPTSTR</b><i> lpAccessName</i><b>,          </b>
<b>  LPDWORD</b><i> lpBufferSize</i><b>,         </b>
<b>  LPDWORD</b><i> lpResult              </i>
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>hwndOwner</i></dt>
<dd>
Specifies a window that the provider of network resources can use as an owner window for dialog boxes. Use this parameter if CONNECT_INTERACTIVE is set.</dd>
<dt>
<i>lpNetResource</i></dt>
<dd>
Pointer to a <a href="networks_0nle.htm"><b>NETRESOURCE</b></a> structure that specifies details of the proposed connection. The structure contains information about the network resource, the local device, and the network resource provider. 
<p>
You must specify the following members of the <b>NETRESOURCE</b> structure: 

<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=40%>Member</th>
<th align=left width=60%>Description </th>
</tr>
<tr valign=top>
<td width=40%><b>dwType</b></td>
<td width=60%>Specifies the type of resource to connect to. It is most efficient to use a specific resource type (such as RESOURCETYPE_DISK or RESOURCETYPE_PRINT). However, if <b>lpLocalName</b> is NULL or points to an empty string and CONNECT_REDIRECT is not set, <b>dwType</b> can be RESOURCETYPE_ANY. This method works only if the function does not automatically choose a device to redirect to the network resource.</td>
</tr>
<tr valign=top>
<td width=40%><b>lpLocalName</b></td>
<td width=60%>Points to a null-terminated string that specifies the name of a local device to be redirected, such as "F:" or "LPT1." The string is treated in a case-insensitive manner. If the string is empty or if <b>lpLocalName</b> is NULL, a connection to the network occurs without redirection. If CONNECT_REDIRECT is set or the network requires a redirected local device, the function chooses a local device to redirect and returns the name of the device in <i>lpAccessName</i>. </td>
</tr>
<tr valign=top>
<td width=40%><b>lpRemoteName</b></td>
<td width=60%>Points to a null-terminated string that specifies the network resource to connect to. The string can be up to MAX_PATH characters in length. The string must follow the network provider's naming conventions.</td>
</tr>
<tr valign=top>
<td width=40%><b>lpProvider</b></td>
<td width=60%>Points to a null-terminated string that specifies the network provider to connect to. If <b>lpProvider</b> is NULL or points to an empty string, the operating system attempts to determine the correct provider by parsing the string pointed to by <b>lpRemoteName</b>.</td>
</tr>
<tr valign=top>
<td width=40%></td>
<td width=60%>You should set this member only if you know for certain which network provider you want to use. Otherwise, let the operating system determine which network provider the network name maps to.</td>
</tr>
<tr valign=top>
<td width=40%></td>
<td width=60%>If this member is not NULL, the operating system attempts to make a connection only to the named network provider.</td>
</tr>
</table><br>


<p>
The <b>WNetUseConnection </b>function ignores the other members of the <a href="networks_0nle.htm"><b>NETRESOURCE</b></a> structure.
</dd>
<dt>
<i>lpPassword</i></dt>
<dd>
Pointer to a null-terminated string that specifies a password to be used in making the network connection.
<p>
If <i>lpPassword</i> is NULL, the function uses the current default password associated with the user specified by <i>lpUserName.</i>

<p>
If <i>lpPassword</i> points to an empty string, the function does not use a password.

<p>
If the connection fails because of an invalid password and CONNECT_INTERACTIVE is set, the function displays a dialog box asking the user to type the password.
</dd>
<dt>
<i>lpUserName</i></dt>
<dd>
Pointer to a null-terminated string that specifies a user name to be used in making the connection. 
<p>
If <i>lpUserName</i> is NULL, the function uses the default user name. The user context for the process provides the default user name. 

<p>
The <i>lpUserName</i> parameter is specified when users want to connect to a network resource for which they have been assigned a user name or account other than the default user name or account. 

<p>
The user-name string represents a security context. It may be specific to a network provider.
</dd>
<dt>
<i>dwFlags</i></dt>
<dd>
Specifies any combination of the following values:
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=46%>Value</th>
<th align=left width=54%>Meaning</th>
</tr>
<tr valign=top>
<td width=46%>CONNECT_INTERACTIVE</td>
<td width=54%>If this flag is set, the operating system may interact with the user for authentication purposes.</td>
</tr>
<tr valign=top>
<td width=46%>CONNECT_PROMPT</td>
<td width=54%>This flag instructs the system not to use any default settings for user names or passwords without offering the user the chance to supply an alternative. This flag is ignored unless CONNECT_INTERACTIVE is set.</td>
</tr>
<tr valign=top>
<td width=46%>CONNECT_REDIRECT</td>
<td width=54%>This flag forces the redirection of a local device when making the connection. If <i>lpLocalName</i> specifies a local device to redirect, this flag has no effect, because the operating system attempts to redirect the specified device anyway. Otherwise, if the operating system automatically chooses a local device, <i>lpAccessName</i> must point to a return buffer and <b>dwType</b> must not be RESOURCETYPE_ANY.<p>
If this flag is not set, a local device is automatically chosen for redirection only if the network requires a local device to be redirected.</p>
</td>
</tr>
<tr valign=top>
<td width=46%>CONNECT_UPDATE_PROFILE</td>
<td width=54%>This flag instructs the operating system to store the network resource connection.<p>
If this bit flag is set, the operating system automatically attempts to restore the connection when the user logs on. The system remembers only successful connections that redirect local devices. It does not remember unsuccessful connections and deviceless connections. A deviceless connection occurs when <i>lpLocalName</i><b> </b>is NULL or points to an empty string.</p>
<p>
If this bit flag is clear, the operating system will not automatically restore the connection at logon.</p>
</td>
</tr>
</table><br>

</dd>
<dt>
<i>lpAccessName</i></dt>
<dd>
Specifies the name of a buffer that receives system requests on the connection. 
<p>
If <i>lpLocalName</i> specifies a local device, this buffer is optional, and will have the local device name copied into it. If <i>lpLocalName</i> does not specify a device and the network requires a local device redirection, or if CONNECT_REDIRECT is set, this buffer is required and the name of the redirected local device is returned here. Otherwise, the name copied into the buffer is that of a remote resource. If specified, this buffer must be at least as large as the string pointed to by the <i>lpRemoteName</i> parameter.
</dd>
<dt>
<i>lpBufferSize</i></dt>
<dd>
Specifies the size, in characters, of the <i>lpAccessName</i> buffer passed in. If the call fails because the buffer is not large enough, the function uses this location to return the required buffer size.</dd>
<dt>
<i>lpResult</i></dt>
<dd>
Pointer to a <b>DWORD</b> that returns additional information about the connection. This parameter can be a combination of the following values:
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=46%>Value</th>
<th align=left width=54%>Meaning</th>
</tr>
<tr valign=top>
<td width=46%>CONNECT_LOCALDRIVE</td>
<td width=54%>If this flag is set, the connection was made using a local device redirection. If the <i>lpAccessName</i> parameter points to a buffer, the local device name is copied to the buffer.</td>
</tr>
</table><br>

</dd>
</dl>
<h4>Return Values</h4>
<p>
If the function succeeds, the return value is NO_ERROR.</p>
<p>
If the function fails, the return value is one of the following error codes.</p>
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=47%>Value</th>
<th align=left width=53%>Meaning</th>
</tr>
<tr valign=top>
<td width=47%>ERROR_ACCESS_DENIED</td>
<td width=53%>Access to the network resource was denied.</td>
</tr>
<tr valign=top>
<td width=47%>ERROR_ALREADY_ASSIGNED</td>
<td width=53%>The local device specified by<b> lpLocalName</b> is already connected to a network resource.</td>
</tr>
<tr valign=top>
<td width=47%>ERROR_BAD_DEVICE</td>
<td width=53%>The value specified by <b>lpLocalName</b> is invalid.</td>
</tr>
<tr valign=top>
<td width=47%>ERROR_BAD_NET_NAME</td>
<td width=53%>The value specified by <b>lpRemoteName</b> is not acceptable to any network resource provider. The resource name is invalid, or the named resource cannot be located.</td>
</tr>
<tr valign=top>
<td width=47%>ERROR_BAD_PROVIDER</td>
<td width=53%>The value specified by <b>lpProvider</b> does not match any provider.</td>
</tr>
<tr valign=top>
<td width=47%>ERROR_CANCELLED</td>
<td width=53%>The attempt to make the connection was canceled by the user through a dialog box from one of the network resource providers or by a called resource.</td>
</tr>
<tr valign=top>
<td width=47%>ERROR_EXTENDED_ERROR</td>
<td width=53%>A network-specific error occurred. To get a description of the error, call the <a href="networks_735e.htm"><b>WNetGetLastError</b></a> function.</td>
</tr>
<tr valign=top>
<td width=47%>ERROR_INVALID_ADDRESS</td>
<td width=53%>The caller passed in a pointer to a buffer that could not be accessed.</td>
</tr>
<tr valign=top>
<td width=47%>ERROR_INVALID_PARAMETER</td>
<td width=53%>This error is a result of one of the following conditions:<ol>
<li>
The <b>lpRemoteName</b> member is NULL; <i>lpAccessName</i> is not NULL, but <i>lpBufferSize</i> is either NULL or points to zero.</li>
<li>
The <b>dwType</b> member is neither RESOURCETYPE_DISK nor RESOURCETYPE_PRINT. In addition, CONNECT_REDIRECT is set in <i>dwFlags</i>, <b>lpLocalName</b> is NULL, or the connection is to a network that requires the redirecting of a local device.</li>
</ol>
</td>
</tr>
<tr valign=top>
<td width=47%>ERROR_INVALID_PASSWORD</td>
<td width=53%>The specified password is invalid and CONNECT_INTERACTIVE is not set.</td>
</tr>
<tr valign=top>
<td width=47%>ERROR_MORE_DATA</td>
<td width=53%>The <i>lpAccessName </i>buffer is too small. If a local device is redirected, the buffer needs to be large enough to contain the local device name. Otherwise, the buffer needs to be large enough to contain either the string pointed to by <b>lpRemoteName</b> or the name of the connectable resource whose alias is pointed to by <b>lpRemoteName</b>. If this status is returned, then no connection has been made.</td>
</tr>
<tr valign=top>
<td width=47%>ERROR_NO_MORE_ITEMS</td>
<td width=53%>The operating system cannot automatically choose a local redirection because all the valid local devices are in use.</td>
</tr>
<tr valign=top>
<td width=47%>ERROR_NO_NET_OR_BAD_PATH</td>
<td width=53%>A network component has not started, or the specified name could not be handled.</td>
</tr>
<tr valign=top>
<td width=47%>ERROR_NO_NETWORK</td>
<td width=53%>There is no network present.</td>
</tr>
</table><br>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Use version 3.1 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Use Windows 95 or later.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in winnetwk.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use mpr.lib.</p>
<h4>See Also</h4>
<p>
<a href="networks_7t5r.htm">Windows Networking (WNet) Overview</a>, <a href="networks_0u43.htm">Windows Networking Functions</a>, <a href="networks_3epa.htm"><b>WNetAddConnection</b></a>,<b> <a href="networks_84z6.htm">WNetAddConnection2</a></b>,<b> <a href="networks_84z7.htm">WNetAddConnection3</a></b>,<b> <a href="networks_5vou.htm">WnetCancelConnection</a></b>,<b> <a href="networks_84a6.htm">WNetGetConnection</a></b>,<b> <a href="networks_735e.htm">WNetGetLastError</a></b></p>
<p>&nbsp;</p></body>
</HTML>
