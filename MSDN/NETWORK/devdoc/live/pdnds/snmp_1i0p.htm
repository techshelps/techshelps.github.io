<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>SnmpExtensionQuery</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_win32_snmpextensionquery"></a>SnmpExtensionQuery</h1>
<p>
The Microsoft SNMP service calls the <b>SnmpExtensionQuery</b> function to resolve SNMP requests that contain variables within one or more of the SNMP extension agent's registered MIB subtrees. This function is an element of the SNMP Extension Agent API. </p>
<p>
<b>Note</b>&nbsp;&nbsp;The extension agent must export the <b>SnmpExtensionQuery</b> function if the extension agent runs on Windows NT 3.51 or 4.0. However, it is recommended that you use the <a href="snmp_6c3c.htm"><b>SnmpExtensionQueryEx</b></a> function, which supports SNMP version 2C (SNMPv2C) data types and multiphase SNMP SET operations. </p>
<pre><code><b>BOOL  SnmpExtensionQuery(
  BYTE</b><i> bPduType</i><b>,                  </b>// SNMPv1 PDU request type
<b>  SnmpVarBindList</b><i> *pVarBindList</i><b>,  </b>// pointer to variable bindings
<b>  AsnInteger32</b><i> *pErrorStatus</i><b>,     </b>// pointer to SNMPv1 error status
<b>  AsnInteger32</b><i> *pErrorIndex       </i>// pointer to the error index
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>bPduType </i></dt>
<dd>
[in] Specifies the SNMP version 1 (SNMPv1) PDU request type. This parameter can be one of the following values. 
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=55%>Value</th>
<th align=left width=45%>Meaning</th>
</tr>
<tr valign=top>
<td width=55%>SNMP_PDU_GET</td>
<td width=45%>Retrieve the value or values of the specified variables. </td>
</tr>
<tr valign=top>
<td width=55%>SNMP_PDU_GETNEXT</td>
<td width=45%>Retrieve the value or values of the lexicographic successor of the specified variable. </td>
</tr>
<tr valign=top>
<td width=55%>SNMP_PDU_SET</td>
<td width=45%>Write a value within a specific variable. </td>
</tr>
</table><br>


<p>
Note that PDU request types have been renamed. For additional information, see <a href="snmp_0msz.htm#_win32_modified_snmp_pdu_request_types">Modified SNMP PDU Request Types</a>. 
</dd>
<dt>
<i>pVarBindList </i></dt>
<dd>
[in/out] Pointer to the variable bindings list.</dd>
<dt>
<i>pErrorStatus</i></dt>
<dd>
[out] Pointer to a variable in which the error status result will be returned. This parameter can be one of the following values defined by SNMPv1. 
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=60%>Value</th>
<th align=left width=40%>Meaning</th>
</tr>
<tr valign=top>
<td width=60%>SNMP_ERRORSTATUS_NOERROR</td>
<td width=40%>The agent reports that no errors occurred during transmission. </td>
</tr>
<tr valign=top>
<td width=60%>SNMP_ERRORSTATUS_TOOBIG</td>
<td width=40%>The agent could not place the results of the requested operation into a single SNMP message.</td>
</tr>
<tr valign=top>
<td width=60%>SNMP_ERRORSTATUS_NOSUCHNAME</td>
<td width=40%>The requested operation identified an unknown variable.</td>
</tr>
<tr valign=top>
<td width=60%>SNMP_ERRORSTATUS_BADVALUE</td>
<td width=40%>The requested operation tried to change a variable but it specified either a syntax or value error.</td>
</tr>
<tr valign=top>
<td width=60%>SNMP_ERRORSTATUS_READONLY</td>
<td width=40%>The requested operation tried to change a variable that was not allowed to change according to the community profile of the variable.</td>
</tr>
<tr valign=top>
<td width=60%>SNMP_ERRORSTATUS_GENERR</td>
<td width=40%>An error other than one of those listed here occurred during the requested operation.</td>
</tr>
</table><br>

</dd>
<dt>
<i>pErrorIndex</i></dt>
<dd>
[out] Pointer to a variable in which the error index result will be returned. 
</dd>
</dl>
<h4>Return Values</h4>
<p>
If the function succeeds, the return value is TRUE. </p>
<p>
If the function fails, the return value is FALSE. </p>
<h4>Remarks</h4>
<p>
When the SNMP service receives an SNMP PDU request, it calls the <b>SnmpExtensionQuery </b>function to process the request. The extension agent must follow the rules in RFC 1157 to either resolve the variable bindings or generate an error. </p>
<p>
If the extension agent cannot resolve the variable bindings on a <b>Get Next</b> request, it must change the <b>name</b> field of the <a href="snmp_05pu.htm"><b>SnmpVarBind</b></a><b> </b>structure to the value of the object identifier immediately following that of the currently supported MIB subtree view. For example, if the extension agent supports view ".1.3.6.1.4.1.77.1", a <b>Get Next </b>request on ".1.3.6.1.4.1.77.1.5.1" would result in a modified <b>name</b> field of ".1.3.6.1.4.1.77.2". This signals the SNMP service to continue the attempt to resolve the variable bindings with other extension agents.</p>
<p>
It is important to note that the SNMP service and the extension agent may need to exchange dynamically allocated memory during a call to the <b>SnmpExtensionQuery</b> function. The service dynamically allocates the object identifier in each <a href="snmp_05pu.htm"><b>SnmpVarBind</b></a> structure it passes to the extension agent. However, the extension agent must release this memory in order to replace the object identifier when it processes a <b>Get</b><i> </i><b>Next</b> request. The extension agent allocates dynamic memory for variable-length object types. The SNMP service releases this memory after the object is placed in the response PDU. </p>
<p>
In order to avoid heap corruption and memory leaks, both the SNMP service and the extension agent must use memory allocation routines that resolve to the same heap. The extension agent must use the <a href="snmp_1dwj.htm"><b>SnmpUtilMemAlloc</b></a> function to allocate memory that it passes to the SNMP service. It must use the <a href="snmp_5cmd.htm"><b>SnmpUtilMemFree</b></a> function to release the memory the service passes back to the extension agent. These functions are located in the utility dynamic-link library SNMPAPI.DLL. </p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Requires version 3.1 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Requires Windows 95 or later.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in snmp.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>User-defined.</p>
<h4>See Also </h4>
<p>
<a href="snmp_7yov.htm">Simple Network Management Protocol (SNMP) Overview</a>, <a href="snmp_8w6r.htm">SNMP Functions</a>, <a href="snmp_05pu.htm"><b>SnmpVarBind</b></a>, <a href="snmp_4xmc.htm"><b>SnmpExtensionInit</b></a>, <a href="snmp_1dwj.htm"><b>SnmpUtilMemAlloc</b></a>, <a href="snmp_5cmd.htm"><b>SnmpUtilMemFree</b></a></p>
<p>&nbsp;</p></body>
</HTML>
