<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Tip 27: Determining When a Key or Mouse Button Is Pressed</title>
                <style>@import url(msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="msdn_ie3.css">
</HEAD>
<BODY>

<h1><sup><a name="msdn_msdn27"></a></sup>Tip 27: Determining When a Key or Mouse Button Is Pressed</h1>
<p>
Created: March 1, 1995</p>
<h2>Abstract</h2>
<p>
When developing an application in Visual Basic®, you may need to interrupt a time-consuming function or react to a certain keypress. It is always a user-friendly option if you allow your user to exit out of these long processes gracefully. The Windows® <b>GetAsyncKeyState</b> application programming interface (API) function can be used to detect when the user has pressed a certain key on the keyboard or clicked a mouse button.</p>
<h2>Monitoring the Keyboard and Mouse Activities</h2>
<p>
The Windows® <b>GetAsyncKeyState</b> application programming interface (API) function can tell you if a user has clicked a mouse button or pressed a specific key on the keyboard. To declare this function within your program, include the following <b>Declare</b> statement in the Global Module or General Declarations section of a Visual Basic® form:</p>
<pre><code>Declare Function GetAsyncKeyState Lib "User" (ByVal Key As Integer) As Integer
</code></pre>
<p>
Note that this <b>Declare</b> statement must be typed as one single line of text.</p>
<p>
The <b>GetAsyncKeyState</b> function determines if the specific key was pressed since the last call to this function. It can also tell you if one of the mouse buttons was pressed. This function takes only one argument—an integer value that represents the key code of the virtual key or mouse button you want to test.</p>
<p>
<b>GetAsyncKeyState</b> returns a non-zero value if the specified key or button is currently pressed. It will also return a non-zero value if the key or button was pressed since the last call to this function. The CONSTANT.TXT file contains a list of the virtual key constants.</p>
<h2>Example Program</h2>
<p>
The following Visual Basic program shows how you can perform a function within your program until a specific keystroke is detected on the keyboard. In this example program, the <b>DoEvents</b> function is called to put the program in a constant loop. When you press the ESC (escape) key, the program is terminated.
<ol>
<li>
Start a new project in Visual Basic. Form1 is created by default.<br><br></li>
<li>
Add the following <b>Constant </b>and <b>Declare</b> statements to the General Declarations section of Form1 (note that the <b>Declare</b> statement must be typed as one single line of text):<pre><code>Declare Function GetAsyncKeyState Lib "User" (ByVal Key As Integer) As Integer
Const KEY_ESCAPE = &amp;H1B
</code></pre>
</li>
<li>
Add a Text Box control to Form1. Text1 is created by default.<br><br></li>
<li>
Add a Command Button control to Form1. Command1 is created by default.<br><br></li>
<li>
Add the following code to the Click event for Command1:<pre><code>Sub Command1_Click()
 &nbsp;&nbsp; Text1.Text = "Press ESCAPE to quit"&nbsp;&nbsp;&nbsp; 
 &nbsp;&nbsp; Do While DoEvents()
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If GetAsyncKeyState(KEY_ESCAPE) Then
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Text1.Text = "ESCAPE pressed"
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Exit Sub
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If
 &nbsp;&nbsp; Loop
End Sub
</code></pre>
</li>
</ol>
</BODY>
</HTML>
