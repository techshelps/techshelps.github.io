<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Appendix C: Using Vbsql.ocx</title>
                <style>@import url(msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="msdn_ie3.css">
</HEAD>
<BODY>
<h1>Appendix C: Using Vbsql.ocx</h1>
<p>
The following example uses the bcp functions of Vbsql.ocx to copy the authors table in the <b>pubs</b> database to a file called Authors.sav. For this code example to work you must have the file Vbsql.ocx present and registered on your computer. With a code module open in Microsoft Access, click <b>References</b> on the <b>Tools</b> menu and be sure that Vbsql.ocx is checked in the list of Available References. If the file does not appear in the list, browse for it, and select it.</p>
<p>
Some lines of code below exceed the printed page. Such lines use an underscore as a line continuation character. </p>
<pre><code>'Connection declarations
Declare Function SqlLogin Lib "VBSQL.OCX" () As Long
Declare Function SQLSETLUSER Lib "VBSQL.OCX" Alias_
 "SqlSetLUser" (ByVal Login As Long, User As String) As Long
Declare Function SqlSetLPwd Lib "VBSQL.OCX" (ByVal Login As_
 Long, Pwd As String) As Long
Declare Function SqlSetLApp Lib "VBSQL.OCX" (ByVal Login As_
 Long, App As String) As Long
Declare Function SqlOpen Lib "VBSQL.OCX" (ByVal Login As Long,_
 Server As String) As Long
'bcp declarations
Declare Function SqlbcpInit Lib "VBSQL.OCX" (ByVal SqlConn As_
 Long, TblName As String, HFile As String, ErrFile As String, ByVal_
 Direction As Integer) As Long
Declare Function SqlbcpExec Lib "VBSQL.OCX" (ByVal SqlConn_
 As Long, RowsCopied As Long) As Long
Declare Function SqlbcpColfmt Lib "VBSQL.OCX" (ByVal SqlConn_
 As Long, ByVal FColumn As Long, ByVal FType As Long, ByVal_
 FPLen As Long, ByVal FCLen As Long, FTerm As String, ByVal_
 FTLen As Long, ByVal TCol As Long) As Long
Declare Function SqlbcpColumns Lib "VBSQL.OCX" (ByVal_
 SqlConn As Long, ByVal ColCount As Long) As Long
'Global values for bcp in and out and succeed and fail
Global Const DBIN&amp; = 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>' </b>transfer from client to server
Global Const DBOUT&amp; = 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' transfer from server to client
Global Const SUCCEED&amp; = 1
Global Const FAIL&amp; = 0
'Connection closing declarations
Declare Sub SqlClose Lib "VBSQL.OCX" (ByVal SqlConn As Long)
Declare Sub SqlExit Lib "VBSQL.OCX" ()
Declare Sub SqlWinExit Lib "VBSQL.OCX" ()

Function bcp_out()
 &nbsp;&nbsp; Dim Loginrec As Long
 &nbsp;&nbsp; Dim SqlConn As Long
 &nbsp;&nbsp; Dim Result As Long
 &nbsp;&nbsp; Dim RowsCopied As Long
 &nbsp;&nbsp; Dim strServer As String
 &nbsp;&nbsp; 
 &nbsp;&nbsp; On Error GoTo bcp_out_err

'Specify the login parameters
 &nbsp;&nbsp; Loginrec = SqlLogin
 &nbsp;&nbsp; strServer = InputBox("Enter the name of your server.""Server_
 Name?")
 &nbsp;&nbsp; Result = SQLSETLUSER(Loginrec, "sa")
 &nbsp;&nbsp; Result = SqlSetLPwd(Loginrec, "")
 &nbsp;&nbsp; Result = SqlSetLApp(Loginrec, "AccExamp")
'Open a connection to SQL Server
 &nbsp;&nbsp; SqlConn = SqlOpen(Loginrec, strServer)
 &nbsp;&nbsp; If SqlConn = 0 Then MsgBox "Failed to open connection to_
 server." &amp; Chr$(10) &amp; "Check server name."
'Initialize bcp.
 &nbsp;&nbsp; Result = SqlbcpInit(SqlConn, "pubs..authors", "c:\authors.sav",_
 "c:\bcperr.txt", DBOUT)
 &nbsp;&nbsp; If Result = FAIL Then
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MsgBox "bcp Init failed!"
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GoTo bcp_out_err
 &nbsp;&nbsp; End If
'Execute the bulk-copy.
 &nbsp;&nbsp; Result = SqlbcpExec(SqlConn, RowsCopied)
 &nbsp;&nbsp; If Result = FAIL Then
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MsgBox "Incomplete bulk-copy. Only " &amp; RowsCopied &amp; " rows_
 copied."
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GoTo bcp_out_err
 &nbsp;&nbsp; End If
'Close the connection
 &nbsp;&nbsp; SqlClose (SqlConn)
Exit Function
bcp_out_err:
 &nbsp;&nbsp; MsgBox "Error " &amp; Err &amp; ": " &amp; Err.Description
'Close the connection
 &nbsp;&nbsp; SqlClose (SqlConn)
End Function
</code></pre>
</BODY>
</HTML>
