<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Tip 57: Creating a "Virus" to Prevent Unauthorized Use of Your Computer</title>
                <style>@import url(msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="msdn_ie3.css">
</HEAD>
<BODY>

<h1><sup><a name="msdn_msdn57"></a></sup>Tip 57: Creating a "Virus" to Prevent Unauthorized Use of Your Computer</h1>
<p>
Created: April 17, 1995</p>
<h2>Abstract</h2>
<p>
This article explains how you can design an application in Visual Basic® that acts like a virus. You can use this program to prevent unauthorized users from using your system for more than 10 minutes.</p>
<h2>A 10-Minute Virus Stops Others from Using Your Computer</h2>
<p>
If you are working in an office situation where other users have access to your computer system, you may want to develop a Visual Basic® application that can prevent unauthorized use of your computer.</p>
<p>
The MSDNBUG.EXE virus program interrupts the currently running Windows®-based application after the computer has been running for 10 minutes. The program immediately displays a stay-on-top form that remains on the screen until the virus program is terminated by holding down the ALT key and typing 169 on the numeric keypad while the focus is on the <b>Picture Box</b> control. In addition, once the virus program has been actuated, the Timer control is used to display a message about not removing the diskette in drive B. This message box is displayed approximately once every second. Again, the user cannot remove the diskette in drive B or return to the previously running Windows-based application—the only alternative is to reboot the computer system, and the user is warned not to do this to prevent further "damage" to the hard drive's contents.</p>
<h2>Example Program</h2>
<p>
The program below is a sample virus application written in Visual Basic. Because the program is added to the StartUp group on the Windows desktop, it will be executed each time the computer is turned on. After the user has been working on the computer for 10 minutes, the virus will interrupt the currently running application and display its screen. If the user attempts to remove a diskette from drive B, the program will also display a message box telling the user not to remove the diskette because it has a hidden file that is needed to restore the computer to its normal condition. The program can be terminated only by holding down the ALT key and typing 169 on the numeric keypad.
<ol>
<li>
Create a new project in Visual Basic. Form1 is created by default. Set the following properties for Form1:<p class=tl>
<b>Caption:</b> WARNING: FATAL VIRUS DETECTED<br>
<b>ClipControls:</b> False<br>
<b>ControlBox:</b> False<br>
<b>KeyPreview: </b>True<br>
<b>MaxButton: </b>False<br>
<b>MinButton:</b> False<br>
<b>Visible:</b> False</P></li>
<li>
Add the following <b>Dim</b>, <b>Constant</b>, and <b>Declare</b> statements to the General Declarations section of Form1 (note that the <b>Declare</b> statement must be typed as a single line of code):<pre><code>Declare Function SetWindowPos Lib "User" (ByVal hWnd As Integer, ByVal 
 &nbsp; hWndInsertAfter As Integer, ByVal X As Integer, ByVal Y As Integer, ByVal CX 
 &nbsp; As Integer, ByVal CY As Integer, ByVal wFlags As Integer) As Integer

Const SWP_NOSIZE = &amp;H1
Const SWP_NOMOVE = &amp;H2
Const SWP_NOACTIVATE = &amp;H10
Dim FunLoad As Integer
Dim Hwnd_Topmost As Integer
Dim Wp As Integer
Dim NumTimerEvents As Integer
</code></pre>
</li>
<li>
Add the following code to the Form_Load event for Form1 (note that the Wp line must be typed as a single line of code):<pre><code>Sub Form_Load()
  Hwnd_Topmost = -1
  Wp = SetWindowPos(Form1.hWnd, Hwnd_Topmost, 0, 0, 0, 0, SWP_NOSIZE + 
 &nbsp;&nbsp; SWP_NOMOVE + SWP_NOACTIVATE)
  Form1.Hide
  Timer1.Interval = 65535
  Timer1.Enabled = True
  NumTimerEvents = 0
End Sub
</code></pre>
</li>
<li>
Add the following code to the KeyPress event for Form1:<pre><code>Sub Form_KeyPress(KeyAscii As Integer)
  If KeyAscii = 3 Then FunLoad = True
End Sub
</code></pre>
</li>
<li>
Add the following code to the Unload event for Form1:<pre><code>Sub Form_Unload(cancel As Integer)
  If Not FunLoad Then cancel = True: End
End Sub
</code></pre>
</li>
<li>
Add a <b>Label</b> control to Form1. Label1 is created by default. Set the following properties for Label1:<p class=tl>
<b>AutoSize: </b>False<br>
<b>BorderStyle: </b>0-None<br>
<b>Caption: </b>WARNING: The diskette in drive B has the MSDN virus.</P></li>
<li>
Add a second <b>Label</b> control to Form1. Label2 is created by default. Set the following properties for Label2:<p class=tl>
<b>BorderStyle: </b>0-None<br>
<b>AutoSize: </b>False<br>
<b>Caption: </b>This virus has corrupted the directory of all files on the hard drive of this computer. This virus copies the original information to a hidden file on the diskette that is required for recovery of the hard drive. DO NOT TURN OFF THE COMPUTER. Please contact Customer Support at (360) 297-4717 for instructions (Monday to Friday, 8 a.m. to 4 p.m. Eastern time).</P></li>
<li>
Add a <b>Picture Box</b> control to Form1. Picture1 is created by default. Set the following properties for Picture1:<p class=tl>
<b>BorderStyle: </b>1-Fixed Single<br>
<b>Picture: </b>C:\VB\METAFILE\BUSINESS\COMPUTERS.WMF</P></li>
<li>
Add the following code to the KeyPress event for Picture1 (note that the Wp line must be typed as a single line of code):<pre><code>Sub Picture1_KeyPress(KeyAscii As Integer)
If KeyAscii &lt;&gt; 169 Then Exit Sub
  Hwnd_Topmost = -2
  Wp = SetWindowPos(Form1.hWnd, Hwnd_Topmost, 0, 0, 0, 0, SWP_NOSIZE + 
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SWP_NOMOVE + SWP_NOACTIVATE)
  End
End Sub
</code></pre>
</li>
<li>
Add a Timer control to Form1. Timer1 is created by default. Set the following properties for Timer1:<p class=tl>
<b>Enabled: </b>True<br>
<b>Interval: </b>1000</P></li>
<li>
Add the following code to the Timer event for Timer1 (please note that the MsgBox line must be typed as a single line of code):<pre><code>Sub Timer1_Timer()
  Const Max_Intervals = 5&nbsp;&nbsp;&nbsp;&nbsp; '5 minutes
  NumTimerEvents = NumTimerEvents + 1
  If NumTimerEvents &gt;= Max_Intervals Then

On Error Resume Next
'If the diskette has been removed, the timer is reset 
'to display the error message box once every second.
If Len(Dir("B:*.*")) = 0 Then
  If Visible Then
 &nbsp;&nbsp;&nbsp;&nbsp; Timer1.Interval = 1000
 &nbsp;&nbsp;&nbsp;&nbsp; MsgBox "The virus-infected diskette has been removed from the PC -- 
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; recovery may not be possible.", 16, "MSDN Virus"
  End If
Else
  Visible = True
  WindowState = 2

End If
On Error GoTo 0
End If

End Sub
</code></pre>
</li>
<li>
Create an executable program file by selecting File/Make EXE File from the Visual Basic menu. Save the program file as MSDNBUG.EXE.<br><br></li>
<li>
Add the MSDNBUG.EXE program to the StartUp group on your Windows desktop.</li>
</ol>
</BODY>
</HTML>
