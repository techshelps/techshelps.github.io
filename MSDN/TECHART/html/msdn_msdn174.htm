<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Tip 174: Using the GetKeyState Function to Determine the State of Virtual Keys</title>
                <style>@import url(msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="msdn_ie3.css">
</HEAD>
<BODY>

<h1><sup><a name="msdn_msdn174"></a></sup>Tip 174: Using the GetKeyState Function to Determine the State of Virtual Keys</h1>
<p>
December 5, 1995</p>
<h2>Abstract</h2>
<p>
This article explains how to retrieve the current state of any virtual key in a Microsoft® Visual Basic® application.</p>
<h2>Determining the State of Virtual Keys</h2>
<p>
The Microsoft® Windows® application programming interface (API) <b>GetKeyState</b> function can be used in a Microsoft Visual Basic® application to retrieve the current state of any virtual key. To use this function, include the following <b>Declare</b> statement in the General Declarations section of your form:</p>
<pre><code>Private Declare Function GetKeyState Lib "user32" (ByVal nVirtKey As Long) As
 &nbsp; Integer
</code></pre>
<p>
The <b>GetKeyState</b> function will return the state (key is up, key is down, key is toggled on or off) of the virtual key you pass to the function.</p>
<p>
In the example program below, you want to retrieve the state of the three toggle keys—caps lock, num lock, and scroll lock. To do this, you call the <b>GetKeyState</b> function with the virtual-key code for each individual key you want to test. For example, to retrieve the state of the caps lock key, you execute the statement:</p>
<pre><code>Key = GetKeyState(VK_CAPITAL)
</code></pre>
<p>
The value returned by the <b>GetKeyState</b> function can then be tested. If the low-order bit is 1, then the toggle key is on. If the low-order bit is 0, then the toggle key is off. Therefore, you can use the statement:</p>
<pre><code>If Key And 1 Then
</code></pre>
<p>
to test if the toggle key is on.</p>
<h2>Example Program</h2>
<p>
This program shows how to use the <b>GetKeyState</b> function to determine whether a toggle key (caps lock, num lock, scroll lock) is on or off.
<ol>
<li>
Create a new project in Visual Basic. Form1 is created by default.<br><br></li>
<li>
Add the following <b>Constant </b>and <b>Declare</b> statements to the General Declarations section of Form1 (note that the <b>Declare</b> statement must be typed as a single line of code):<pre><code>Private Declare Function GetKeyState Lib "user32" (ByVal nVirtKey As Long) 
 &nbsp; As Integer
Const VK_NUMLOCK = &amp;H90
Const VK_SCROLL = &amp;H91
Const VK_CAPITAL = &amp;H14
</code></pre>
</li>
<li>
Add a <b>Command Button</b> control to Form1. Command1 is created by default.<br><br></li>
<li>
Add the following code to the Click event for Command1.<pre><code>Private Sub Command1_Click()
 &nbsp;&nbsp; Dim Key As Integer

 &nbsp;&nbsp; Key = GetKeyState(VK_NUMLOCK)
 &nbsp;&nbsp; If Key And 1 Then
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; text1.Text = "Num Lock is On"
 &nbsp;&nbsp; Else
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; text1.Text = "Num Lock is Off"
 &nbsp;&nbsp; End If

 &nbsp;&nbsp; Key = GetKeyState(VK_SCROLL)
 &nbsp;&nbsp; If Key And 1 Then
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Text2.Text = "Scroll Lock is On"
 &nbsp;&nbsp; Else
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Text2.Text = "Scroll Lock is Off"
 &nbsp;&nbsp; End If

 &nbsp;&nbsp; Key = GetKeyState(VK_CAPITAL)
 &nbsp;&nbsp; If Key And 1 Then
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Text3.Text = "Caps Lock is On"
 &nbsp;&nbsp; Else
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Text3.Text = "Caps Lock is Off"
 &nbsp;&nbsp; End If
End Sub
</code></pre>
</li>
<li>
Add three <b>Text Box</b> controls to Form1. Text1, Text2, and Text3 are created by default.</li>
</ol>
<p>
Run the example program by pressing f5. Click the <b>Command Button</b>. The state of the num lock, scroll lock, and caps lock keys appears in the corresponding <b>Text Box</b> controls.</p>
</BODY>
</HTML>
