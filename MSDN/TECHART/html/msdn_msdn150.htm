<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Tip 150: Determining How Many Items Can Be Displayed in the List Box Control</title>
                <style>@import url(msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="msdn_ie3.css">
</HEAD>
<BODY>

<h1><sup><a name="msdn_msdn150"></a></sup>Tip 150: Determining How Many Items Can Be Displayed in the List Box Control</h1>
<p>
September 5, 1995</p>
<h2>Abstract</h2>
<p>
The <b>List Box</b> control in Microsoft® Visual Basic® allows you to display a list of items to the user of your program. When you design a <b>List Box</b> control in a Visual Basic program, you can use the Microsoft Windows® application programming interface (API) <b>SendMessage</b> function to determine the size of individual items in the control. This article explains how you can calculate the number of items that can be displayed in the control, based on the size of each entry.</p>
<h2>Determining How Many Entries Can Be Stored in a List Box</h2>
<p>
The <b>List Box</b> control allows you to display a list of items to your user. For example, you can store a list of vendors in a <b>List Box</b> control. When your Microsoft® Visual Basic® program is running, you can add or remove entries from the vendor list.</p>
<p>
When you design your application, you can set the initial size of the <b>List Box</b> control. Usually you would make the <b>List Box</b> large enough to display several entries. At run time, you can programmatically determine how many entries you can display at one time in the control. To do this, you need to determine the height of an entry in the <b>List Box</b> control by sending an LB_GETITEMHEIGHT message to the control.</p>
<p>
Because you want to find the height of an entry in the <b>List Box</b> control, you use the Microsoft Windows® application programming interface (API) <b>SendMessage</b> function to send an LB_GETITEMHEIGHT message to that control. After the program calls the function, the entry's height is returned as a long value. Then, to calculate how many entries can be displayed in the <b>List Box</b> control, you must divide the height of the <b>List Box </b>by the height of the entry. When making this calculation, you first need to account for the height (which is one pixel) of the top and bottom borders of the <b>List Box</b>. Therefore, you subtract two from the height of the <b>List Box</b> control. Next, you divide the height of the <b>List Box</b> by the height of the entry. The result of this calculation gives you the number of items you can display in the <b>List Box</b> control.</p>
<h2>Example Program</h2>
<p>
This program shows how to calculate the number of items that can be displayed in a <b>List Box</b> control.
<ol>
<li>
Create a new project in Visual Basic. Form1 is created by default.<br><br></li>
<li>
Add the following <b>Constant </b>and <b>Declare</b> statements to the General Declarations section of Form1 (note that the <b>Declare</b> statement must be typed as a single line of code):<pre><code>Private Declare Function SendMessage Lib "user32" Alias "SendMessageA" 
 &nbsp; (ByVal hwnd As Long, ByVal wMsg As Long, ByVal wParam As Integer,
 &nbsp; ByVal lParam As Long) As Long
Const LB_GETITEMHEIGHT = &amp;H1A1
</code></pre>
</li>
<li>
Add the following code to the Form_Load event for Form1 (note that the <b>Items =</b> line must be typed as a single line of code):<pre><code>Private Sub Form_Load()
 &nbsp;&nbsp; Dim ItemHeight As Long
 &nbsp;&nbsp; Dim Items As Integer
 &nbsp;&nbsp; 
 &nbsp;&nbsp; ItemHeight = SendMessage(List1.hwnd, LB_GETITEMHEIGHT, 0, 0&amp;)
 &nbsp;&nbsp; Items = (List1.Height - 2 * Screen.TwipsPerPixelY)
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; / (Screen.TwipsPerPixelY * ItemHeight)
 &nbsp;&nbsp; Text1.Text = "Maximum # entries : " &amp; Str(Items)
 &nbsp;&nbsp; 
 &nbsp;&nbsp; List1.AddItem "Item #1"
 &nbsp;&nbsp; List1.AddItem "Item #2"
 &nbsp;&nbsp; List1.AddItem "Item #3"
 &nbsp;&nbsp; 
End Sub
</code></pre>
</li>
<li>
Add a <b>Text Box</b> control to Form1. Text1 is created by default.<br><br></li>
<li>
Add a <b>List Box</b> control to Form1. List1 is created by default.<br><br></li>
<li>
Add a <b>Command Button</b> control to Form1. Command1 is created by default.<br><br></li>
<li>
Add the following code to the Click event for Command1 (note that the <b>Items =</b> line must be typed as a single line of code):<pre><code>Private Sub Command1_Click()
 &nbsp;&nbsp; Dim ItemHeight As Long
 &nbsp;&nbsp; Dim Items As Integer
 &nbsp;&nbsp; Dim X As Integer
 &nbsp;&nbsp; 
 &nbsp;&nbsp; ItemHeight = SendMessage(List1.hwnd, LB_GETITEMHEIGHT, 0, 0&amp;)
 &nbsp;&nbsp; Items = (List1.Height - 2 * Screen.TwipsPerPixelY)
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; / (Screen.TwipsPerPixelY * ItemHeight)
 &nbsp;&nbsp; X = List1.ListCount
 &nbsp;&nbsp; X = X + 1
 &nbsp;&nbsp; If X &lt;= Items Then
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; List1.AddItem "Item #" &amp; Str(X)
 &nbsp;&nbsp; End If
End Sub
</code></pre>
</li>
</ol>
<p>
Run the example program by pressing f5. Three items are displayed in the <b>List Box</b> control. In addition, the <b>Text Box</b> control shows the maximum number of items that can be displayed in the <b>List Box</b> control at any one time. Each time you click the command button, you add a new item to the <b>List Box</b> control. However, if the number of items stored in the <b>List Box</b> control equals the maximum number of items that can actually be displayed, you can add no more new entries to the list.</p>
<h2>Additional References</h2>
<p>
"LB_GETITEMHEIGHT." (MSDN Library, SDK Documentation, Platform SDK)</p>
<p>
<a href="msdn_listbox.htm">"List Box Controls."</a> (MSDN Library, Technical Articles)</p>
<p>
"SendMessage." (MSDN Library, SDK Documentation, Platform SDK)</p>
</BODY>
</HTML>
