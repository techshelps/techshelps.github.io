<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Tip 30: Retrieving the Default Printer's Name from WIN.INI</title>
                <style>@import url(msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="msdn_ie3.css">
</HEAD>
<BODY>

<h1><sup><a name="msdn_msdn30"></a></sup>Tip 30: Retrieving the Default Printer's Name from WIN.INI</h1>
<p>
Created: March 1, 1995</p>
<h2>Abstract</h2>
<p>
The WIN.INI initialization file contains many settings used by Windows® when it is first loaded into memory. These settings tell Windows, among many other things, what type of printer you have attached to the computer system. You can retrieve the name of the printer from the WIN.INI file and use it in your Visual Basic® application. This article explains how you can determine the printer's name.</p>
<h2>Using GetProfileString to Determine Printer Name</h2>
<p>
The WIN.INI initialization file is divided into sections. Each section's name is surrounded by bracket ([&nbsp;]) characters. Directly below the section name are one or more entries and their parameters, separated by an equal sign. Windows® stores the name of the printer in the WINDOWS section of the WIN.INI file. The "device=" entry contains the printer's name, as follows:</p>
<pre><code>[windows]
device=Canon Bubble-Jet BJ-300,CANON330,LPT1:
</code></pre>
<p>
In a Visual Basic® application, the Windows application programming interface (API) <b>GetProfileString</b> function can be used to retrieve the printer's name from the WIN.INI file. In the example above, the printer's name is Canon 330.</p>
<p>
To declare this function within your program, include the following <b>Declare</b> statement in the Global Module or General Declarations section of your Visual Basic program:</p>
<pre><code>Declare Function GetProfileString Lib "Kernel" (ByVal lpAppName As String, ByVal 
 &nbsp; lpKeyName As Any, ByVal lpDefault As String, ByVal lpReturnedString
 &nbsp; As String, ByVal nSize As Integer) As Integer
</code></pre>
<p>
Note that this <b>Declare</b> statement must be typed as one single line of text.</p>
<p>
To call the <b>GetProfileString</b> function, you must pass five arguments that describe which section and entry of the WIN.INI file you want to retrieve information from. These parameters are as follows:</p>
<table border=1 cellpadding=5 cols=2 frame=below rules=rows>
<tr valign=top>
<td width=19%><i>lpApplicationName</i></td>
<td width=81%>A string containing the section name. Not case-sensitive.</td>
</tr>
<tr valign=top>
<td width=19%><i>lpKeyName</i></td>
<td width=81%>A string containing the entry name to retrieve. Not case-sensitive. If this is a long value set to zero, a list of all entries found in the specified section will be returned in <i>lpReturnedString</i>.</td>
</tr>
<tr valign=top>
<td width=19%><i>lpDefault</i></td>
<td width=81%>A string containing the default value to return if no entry is found.</td>
</tr>
<tr valign=top>
<td width=19%><i>lpReturnedString</i></td>
<td width=81%>A string buffer that will hold the information the function retrieves.</td>
</tr>
<tr valign=top>
<td width=19%><i>nSize</i></td>
<td width=81%>An integer value set to the maximum number of characters to be stored in <i>lpReturnedString</i></td>
</tr>
</table><br>
<p>
After calling the <b>GetProfileString</b> function, an integer value is returned that is set to the number of characters that were stored in the <i>lpReturnedString</i> buffer. This count value does not include the terminating NULL byte. Each entry returned in <i>lpReturnedString</i> is terminated by a NULL character. When retrieving more than one entry at a single time, The last entry in the buffer is marked with two NULL bytes to signal the end of the list.</p>
<p>
In our case, we want to call the <b>GetProfileString</b> function to retrieve the printer's name. Therefore, we execute the following statement:</p>
<pre><code>RC = GetProfileString("windows", "device", "", Temp, 255)
</code></pre>
<p>
This statement tells <b>GetProfileString</b> that we want to retrieve the parameter for the DEVICE entry in the WINDOWS section of the WIN.INI initialization. It also tells the function to store the information in the Temp string buffer and that this buffer is set to a maximum length of 255 characters.</p>
<h2>Example Program</h2>
<p>
The following Visual Basic program shows how you can retrieve the name of the printer from the WIN.INI initialization file.
<ol>
<li>
Start a new project in Visual Basic. Form1 is created by default.<br><br></li>
<li>
Add a Text Box control to Form1. Text1 is created by default.<br><br></li>
<li>
Add the following <b>Declare</b> statement to the general declarations section of Form1 (note that this <b>Declare</b> statement must be typed as one single line of text):<pre><code>Declare Function GetProfileString Lib "Kernel" (ByVal lpAppName As String, ByVal 
 &nbsp; lpKeyName As Any, ByVal lpDefault As String, ByVal lpReturnedString
 &nbsp; As String, ByVal nSize As Integer) As Integer
</code></pre>
</li>
<li>
Add the following code to the Form_Load event for Form1:<pre><code>Sub Form_Load()
 &nbsp;&nbsp; Dim Temp As String
 &nbsp;&nbsp; Dim RC As Integer
 &nbsp;&nbsp; Dim P1 As Integer, P2 As Integer&nbsp;&nbsp; 'Get current printer device name
 &nbsp;&nbsp; Temp = Space$(255)
 &nbsp;&nbsp; RC = GetProfileString("windows", "device", "", Temp, 255)
 &nbsp;&nbsp; Temp = Left$(Temp, RC)
 &nbsp;&nbsp; 
 &nbsp;&nbsp; If RC = 0 Then&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'no printer
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Text1.Text = "No default printer"
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Exit Sub
 &nbsp;&nbsp; End If&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'Extract just the driver name
 &nbsp;&nbsp; P1 = InStr(Temp, ",")
 &nbsp;&nbsp; P2 = InStr(P1 + 1, Temp, ",")
 &nbsp;&nbsp; Text1.Text = Mid$(Temp, P1 + 1, P2 - P1 - 1)
End Sub
</code></pre>
</li>
</ol>
<p>
To execute this demonstration program, press the F5 function key. Visual Basic will display the name of your printer in the text box.</p>
</BODY>
</HTML>
