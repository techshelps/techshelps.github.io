<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Tip 187: Determining Whether an Application Was Closed from the Control Menu</title>
                <style>@import url(msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="msdn_ie3.css">
</HEAD>
<BODY>

<h1><sup><a name="msdn_msdn187"></a></sup>Tip 187: Determining Whether an Application Was Closed from the Control Menu</h1>
<p>
December 5, 1995</p>
<h2>Abstract</h2>
<p>
This article explains how to prevent the user of your Microsoft® Visual Basic® application from unintentionally quitting the application.</p>
<h2>The Query_Unload Event</h2>
<p>
When running an application, you can select the <b>Close</b> command from the Control-menu box in the upper-left corner of a window to quit the application. When running a Microsoft® Windows® 95–based application, you can click the Close button located at the right end of the title bar. These actions terminate the application immediately.</p>
<p>
In a Microsoft Visual Basic® application, the Query_Unload event is triggered when the user tries to quit an application that is running. The <i>UnloadMode</i> variable in the Query_Unload event indicates how this event was triggered by containing one of the five values in the following table.</p>
<table border=1 cellpadding=5 cols=2 frame=below rules=rows>
<tr valign=top>
<td class=label width=13%><b>Value</b></td>
<td class=label width=87%><b>Description</b></td>
</tr>
<tr valign=top>
<td width=13%>0</td>
<td width=87%>The user chose the <b>Close</b> command on the Control-menu box.</td>
</tr>
<tr valign=top>
<td width=13%>1</td>
<td width=87%>The application used the Query_Unload method itself.</td>
</tr>
<tr valign=top>
<td width=13%>2</td>
<td width=87%>The operating system is being shut down.</td>
</tr>
<tr valign=top>
<td width=13%>3</td>
<td width=87%>The application is being shut down by the Task Manager.</td>
</tr>
<tr valign=top>
<td width=13%>4</td>
<td width=87%>An MDI form, which closes all child forms belonging to it, is being closed.</td>
</tr>
</table><br>
<p>
For example, when the user chooses the <b>Close</b> command from the Control-menu box to quit an application, the <i>UnloadMode</i> variable contains a value of zero.</p>
<h2>Example Program</h2>
<p>
This program shows how to prevent a user from accidentally choosing the <b>Close</b> command on the program's Control-menu box.
<ol>
<li>
Create a new project in Visual Basic. Form1 is created by default.<br><br></li>
<li>
Add the following code to the Query_Unload event for Form1:<pre><code>Private Sub Form_QueryUnload(Cancel As Integer, UnloadMode As Integer)
 &nbsp;&nbsp; Dim I As Integer
 &nbsp;&nbsp; If (UnloadMode = FORM_CONTROLMENU) Then
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; I = MsgBox("Exit " &amp; App.Title &amp; " ?", 4, App.EXEName)
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If I = 7 Then
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Cancel = True
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MsgBox "Program was not terminated"
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If I = 6 Then
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Cancel = False
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MsgBox "Program was terminated"
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If
 &nbsp;&nbsp; End If
End Sub
</code></pre>
</li>
</ol>
<p>
Run the example program by pressing F5. Form1 appears on the screen. Either click the File menu and click the <b>Close</b> command or click the Close button in the upper right-hand corner of the form. The program displays a message box asking whether you really want to quit the program. If you click the Yes button, the program is immediately terminated. If you click the No button, however, the program continues to run.</p>
</BODY>
</HTML>
