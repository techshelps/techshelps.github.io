<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Tip 81: Repairing and Compressing a Microsoft Access Database from Visual Basic</title>
                <style>@import url(msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="msdn_ie3.css">
</HEAD>
<BODY>

<h1><sup><a name="msdn_msdn81"></a></sup>Tip 81: Repairing and Compressing a Microsoft Access Database from Visual Basic</h1>
<p>
May 8, 1995</p>
<h2>Abstract</h2>
<p>
Within a Visual Basic® application, you can compress and repair a Microsoft® Access® database (.MDB) file. This article explains how you can accomplish these two tasks in Visual Basic.</p>
<h2>Repairing and Compacting Access Files</h2>
<p>
On occasion, a Microsoft® Access® database file can become damaged. For example, a database can become damaged if the computer system is powered down without first closing the database file. The <b>RepairDatabase</b> statement provided in Visual Basic® can be used to repair a previously corrupted database file. You need only pass the name of the .MDB file to the statement to repair it.</p>
<p>
When records are deleted from a database file, the file can become defragmented. You can compress a defragmented database file by using Visual Basic's <b>CompactDatabase</b> statement. <b>CompactDatabase</b>'s main purpose is to compress a Microsoft Access file, but it can also be used to change the database's sort order, encrypt/decrypt the database, or create a Microsoft Access 1.0 compatible file.</p>
<p>
The <b>CompactDatabase</b> statement requires four arguments, as follows:</p>
<table border=1 cellpadding=5 cols=3 frame=below rules=rows>
<tr valign=top>
<td width=18%><i>SourceFile</i></td>
<td colspan=2 width=82%>The database's complete path and filename.</td>
</tr>
<tr valign=top>
<td width=18%><i>DestFile</i></td>
<td colspan=2 width=82%>The database's new path and filename.</td>
</tr>
<tr valign=top>
<td width=18%><i>Locale</i></td>
<td colspan=2 width=82%>The sorting order to be used.</td>
</tr>
<tr valign=top>
<td width=18%><i>Options</i></td>
<td colspan=2 width=82%>Set to one of the following values:</td>
</tr>
<tr valign=top>
<td width=18%></td>
<td width=27%>DB_ENCRYPT</td>
<td width=55%>Encrypt database.</td>
</tr>
<tr valign=top>
<td width=18%></td>
<td width=27%>DB_DECRYPT</td>
<td width=55%>Decrypt database.</td>
</tr>
<tr valign=top>
<td width=18%></td>
<td width=27%>DB_VERSION10</td>
<td width=55%>Create a compatible Access 1.0 database file.</td>
</tr>
</table><br>
<p>
When the <b>CompactDatabase</b> statement is executed, it copies each valid record from the original database file to the new database file. Note that these two filenames must be different and that the security settings of the original file are automatically transferred to the new file.</p>
<h2>Example Program</h2>
<p>
The program below shows how to repair and/or compact a Microsoft Access database (.MDB) file. To repair a damaged database file, click the "Repair" command button; to compress (remove deleted records) a database file, click the "Compact" command button.
<ol>
<li>
Create a new project in Visual Basic. Form1 is created by default.<br><br></li>
<li>
Add a <b>Common Dialog</b> control to Form1. CommonDialog1 is created by default.<br><br></li>
<li>
Add a <b>Command Button</b> control to Form1. Command1 is created by default. Set its <b>Caption</b> property to "Repair".<br><br></li>
<li>
Add the following code to the Click event for Command1:<pre><code>Private Sub Command1_Click()
 &nbsp;&nbsp; On Error GoTo Repair_Error
 &nbsp;&nbsp; Dim MDB_Name As String
 &nbsp;&nbsp; 
 &nbsp;&nbsp; CommonDialog1.Filter = "Access (*.mdb)|*.mdb"
 &nbsp;&nbsp; CommonDialog1.Flags = &amp;H1000
 &nbsp;&nbsp; CommonDialog1.FilterIndex = 1
 &nbsp;&nbsp; CommonDialog1.Action = 1
 &nbsp;&nbsp; 
 &nbsp;&nbsp; If CommonDialog1.FileName &lt;&gt; "" Then
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Screen.MousePointer = 11
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MDB_Name = CommonDialog1.FileName
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RepairDatabase (MDB_Name)
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Screen.MousePointer = 0
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MsgBox "Database repaired successfully", 64, "Repair"
 &nbsp;&nbsp; End If
 &nbsp;&nbsp; Screen.MousePointer = 0
 &nbsp;&nbsp; Exit Sub
Repair_Error:
 &nbsp;&nbsp; MsgBox "Error when repairing database", 16, "Error"
 &nbsp;&nbsp; Screen.MousePointer = 0
 &nbsp;&nbsp; Exit Sub
End Sub
</code></pre>
</li>
<li>
Add a second <b>Command Button</b> control to Form1. Command2 is created by default. Set its <b>Caption</b> property to "Compact".<br><br></li>
<li>
Add the following code to the Click event for Command2:<pre><code>Private Sub Command2_Click()
 &nbsp;&nbsp; On Error GoTo Compact_Error
 &nbsp;&nbsp; 
 &nbsp;&nbsp; Dim MDB_Name As String
 &nbsp;&nbsp; Dim MDB_NewName As String
 &nbsp;&nbsp; Dim MDB_Local As String
 &nbsp;&nbsp; Dim MDB_Options As String
 &nbsp;&nbsp; 
 &nbsp;&nbsp; MDB_NewName = "c:\dummy.mdb"
 &nbsp;&nbsp; CommonDialog1.Filter = "Access (*.MDB)|*.mdb"
 &nbsp;&nbsp; CommonDialog1.Flags = &amp;H1000
 &nbsp;&nbsp; CommonDialog1.FilterIndex = 1
 &nbsp;&nbsp; CommonDialog1.Action = 1
 &nbsp;&nbsp; 
 &nbsp;&nbsp; If CommonDialog1.FileName &lt;&gt; "" Then
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MDB_Name = CommonDialog1.FileName
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CompactDatabase MDB_Name, MDB_NewName &amp; MDB_Local &amp; MDB_Options
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Kill MDB_Name
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Name MDB_NewName &amp; MDB_Local &amp; MDB_Options As MDB_Name
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MsgBox "Database compressed OK", 64, "Compact"
 &nbsp;&nbsp; End If
 &nbsp;&nbsp; Exit Sub
Compact_Error:
 &nbsp;&nbsp; MsgBox "Unable to compress database", 16, "Error"
 &nbsp;&nbsp; Exit Sub
End Sub
</code></pre>
</li>
</ol>
</BODY>
</HTML>
