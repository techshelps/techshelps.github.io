<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Tip 125: Retrieving a Compressed File's Original Name</title>
                <style>@import url(msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="msdn_ie3.css">
</HEAD>
<BODY>

<h1><sup><a name="msdn_msdn125"></a></sup>Tip 125: Retrieving a Compressed File's Original Name</h1>
<p>
July 1, 1995</p>
<h2>Abstract</h2>
<p>
When designing a Microsoft® Visual Basic® application, you may need to use an installation program to compress and decompress files needed by your program. This article explains how to retrieve the original file name of a compressed file.</p>
<h2>Using the GetExpandedName API Function</h2>
<p>
The MS-DOS® COMPRESS.EXE program allows you to compress one or more files on disk. Compressed files take up less space on your disk, and they are typically used to create installation programs.</p>
<p>
The Microsoft® Windows®-based LZEXPAND.DLL function library contains several routines to open, close, read, and write compressed files. However, you need to first determine the file's original, uncompressed name.</p>
<p>
The Windows application programming interface (API) function <b>GetExpandedName</b> can retrieve the original name of a compressed file. Compressed files are stored on disk with the last character in the file name extension set to an underscore ("_") character. When you run the COMPRESS.EXE program, you have the option of using the "/r" command line parameter. This command line parameter tells COMPRESS.EXE to create the file with an underscore character as the last character in the file name.</p>
<p>
To use the <b>GetExpandedName</b> function in a Microsoft Visual Basic® application, add the following <b>Declare</b> statement to the General Declarations section of your form (note that this <b>Declare</b> statement must be typed as a single line of code):</p>
<pre><code>Private Declare Function GetExpandedName Lib "LZEXPAND.DLL" (ByVal lpszSource 
 &nbsp; As String, ByVal lpszBuffer As String) As Integer
</code></pre>
<p>
The <b>GetExpandedName</b> function requires two arguments, as follows.</p>
<table border=1 cellpadding=5 cols=2 frame=below rules=rows>
<tr valign=top>
<td width=22%><i>lpszSource</i></td>
<td width=78%>A string containing the compressed file's name</td>
</tr>
<tr valign=top>
<td width=22%><i>lpszBuffer</i></td>
<td width=78%>A string to hold the complete file's name</td>
</tr>
</table><br>
<p>
After this function is called, a value greater than zero will be returned if the operation was successful. If the function was not successful, a negative value will be returned.</p>
<h2>Example Program</h2>
<p>
This program shows how to retrieve the full name of a file that was previously compressed by the COMPRESS.EXE program.
<ol>
<li>
Create a new project in Visual Basic. Form1 is created by default.<br><br></li>
<li>
Add the following <b>Declare</b> statement to the General Declarations section of Form1 (note that this <b>Declare</b> statement must be typed as a single line of code):<pre><code>Private Declare Function GetExpandedName Lib "LZEXPAND.DLL" (ByVal lpszSource 
 &nbsp; As String, ByVal lpszBuffer As String) As Integer
</code></pre>
</li>
<li>
Add a <b>Text Box</b> control to Form1. Text1 is created by default.<br><br></li>
<li>
Add a <b>Command Button</b> control to Form1. Command1 is created by default.<br><br></li>
<li>
Add the following code to the Click event for Command1:<pre><code>Private Sub Command1_Click()
 &nbsp;&nbsp; Dim Temp As String
 &nbsp;&nbsp; Dim X As Integer
 &nbsp;&nbsp; 
 &nbsp;&nbsp; Text1.Text = ""
 &nbsp;&nbsp; Temp = Space$(128)
 &nbsp;&nbsp; X = GetExpandedName("C:\TEMP\MYFILE.DL_", Temp)
 &nbsp;&nbsp; Text1.Text = "Filename: " &amp; Temp
End Sub
</code></pre>
</li>
</ol>
<p class=indent>
<B><b>Note</b></B>&nbsp;&nbsp;&nbsp;This program assumes that you have a previously compressed file called MYFILE.DL_ stored in the C:\TEMP directory.</p>
<p>
Run the example program by pressing F5. Click the command button. The full name of the compressed file will be displayed in the <b>Text Box</b> control.</p>
<h2>Additional Reference</h2>
<p>
Knowledge Base Q93426. "Use COMPRESS-r to Avoid Error: Could not execute: SETUP1.EX2."</p>
</BODY>
</HTML>
