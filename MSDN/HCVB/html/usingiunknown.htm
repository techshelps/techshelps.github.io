<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text-html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Using IUknown</title>
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY BGCOLOR=#FFFFFF TEXT=#000000>

<font face="verdana,arial,helvetica" size="2"><h1><a name="usingiunknown"></a>Using IUnknown</h1>
<BR>
First you must use IUnknown every time you connect to a class. There is no Set statement in B--. There is an assignment operator, but assigning any object isn’t enough. Let’s say that you had the following code in Visual Basic:</p>
<pre><code>Dim toughluck As CHardway, toobad As CHardway<BR>Set toughluck = New CHardway<BR>Set toobad = toughluck</code></pre>
<BR>
Here’s how you might do the same thing:</p>
<pre><code>‘’ Dim toughluck As CHardway, toobad As CHardway<BR>Dim toughluck As CLSID_CHardway = 0, toobad As CLSID_CHardway = 0<BR>’’ Set toughluck = New CHardway<BR>toughluck = CreateInstance(CLSID_CHardway, IID_IHardway)<BR>If toughluck = 0 Then GoTo ErrorHandler<BR>’’ Set toobad = toughluck<BR>toobad = IUnknown(toughluck).QueryInterface(IID_IHardway) <BR>If toobad = 0 Then Goto ErrorHandler</code></pre>
<BR>
It doesn’t look like much fun, does it?</p>
<BR>
(If the casting syntax <i>IUnknown(object).Method </i>looks unintelligible, just <BR>take it on faith for now. We’ll see how Visual Basic can get a similar syntax in <BR>“Interface casting” on page 585.</p>
<BR>
You don’t have to do any of this crap in Visual Basic. You don’t have to call the imaginary CreateInstance function to create a new instance. You don’t have to call QueryInterface to make sure your object variable actually supports the appropriate interface. You don’t have to call Release and AddRef to do reference counting.</p>
<BR>
Notice that although classes have class IDs, QueryInterface doesn’t care about them. Class IDs are a mechanism for creating objects, but once the object is created, the interface is all that counts. You can see a little more about how this works by looking at the implementation of a class in B--.</p>
</font></BODY>
</HTML>
