<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>CoLockObjectExternal</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_com_colockobjectexternal"></a>CoLockObjectExternal</h1>
<p>
Called either to lock an object to ensure that it stays in memory, or to release such a lock. Call <b>CoLockObjectExternal</b> to place a strong lock on an object to ensure that it stays in memory.</p>
<pre><code><b>STDAPI CoLockObjectExternal(
  IUnknown *</b><i> pUnk</i><b>,  </b>//Pointer to object to be locked or unlocked
<b>  BOOL</b><i> fLock</i><b>,       </b>//TRUE = lock, FALSE = unlock
<b>  BOOL</b><i> fLastUnlockReleases</i>
<i>                    </i>//TRUE = release all pointers to object
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>pUnk</i></dt>
<dd>
[in] Pointer to the <a href="if_r2z_9dwu.htm"><b>IUnknown</b></a> interface on the object to be locked or unlocked.</dd>
<dt>
<i>fLock</i></dt>
<dd>
[in] Whether the object is to be locked or released. Specifying TRUE holds a reference to the object (keeping it in memory), locking it independently of external or internal <b>AddRef/Release</b> operations, registrations, or revocations. If <i>fLock</i> is TRUE, <i>fLastLockReleases</i> is ignored. FALSE releases a lock previously set with a call to this function.</dd>
<dt>
<i>fLastUnlockReleases</i></dt>
<dd>
[in] Whether a given lock is the last reference that is supposed to keep an object alive. If it is, TRUE releases all pointers to the object (there may be other references that are not supposed to keep it alive).
</dd>
</dl>
<h4>Return Values</h4>
<p>
This function supports the standard return values E_INVALIDARG, E_OUTOFMEMORY, and E_UNEXPECTED, as well as the following:
<dl>
<dt>
S_OK</dt>
<dd>
The object was locked successfully.
</dd>
</dl>
<h4>Remarks</h4>
<p>
The<b> CoLockObjectExternal</b> function prevents the reference count of an object from going to zero, thereby "locking" it into existence until the lock is released. The same function (with different parameters) releases the lock. The lock is implemented by having the system call <a href="if_r2z_3rja.htm"><b>IUnknown::AddRef</b></a> on the object. The system then waits to call <a href="if_r2z_59np.htm"><b>IUnknown::Release</b></a> on the object until a later call to <b>CoLockObjectExternal</b> with <i>fLock</i> set to FALSE. This function can be used to maintain a reference count on the object on behalf of the end user, because it acts outside of the object, as does the user.</p>
<p>
The<b> CoLockObjectExternal</b> function <i>must</i> be called in the process in which the object actually resides (the EXE process, not the process in which handlers may be loaded). </p>
<p>
Calling <b>CoLockObjectExternal</b> sets a strong lock on an object. A strong lock keeps an object in memory, while a weak lock does not. Strong locks are required, for example, during a silent update to an OLE embedding. The embedded object's container must remain in memory until the update process is complete. There must also be a strong lock on an application object to ensure that the application stays alive until it has finished providing services to its clients. All external references place a strong reference lock on an object.</p>
<p>
The<b> CoLockObjectExternal</b> function is typically called in the following situations:
<ul>
<li>
Object servers should call <b>CoLockObjectExternal</b> with both <i>fLock</i> and <i>fLastLockReleases</i> set to TRUE when they become visible. This call creates a strong lock on behalf of the user. When the application is closing, free the lock with a call to <b>CoLockObjectExternal</b>, setting <i>fLock</i> to FALSE and <i>fLastLockReleases</i> to TRUE.</li>
<li>
A call to <b>CoLockObjectExternal</b> on the server can also be used in the implementation of <a href="if_o_8gxe.htm"><b>IOleContainer::LockContainer</b></a>. </li>
</ul>
<p>
There are several things to be aware of when you use <b>CoLockObjectExternal</b> in the implementation of <b>IOleContainer::LockContainer</b>. An embedded object would call <b>IOleContainer::LockContainer </b>on its container to keep it running (to lock it) in the absence of other reasons to keep it running. When the embedded object becomes visible, the container must weaken its connection to the embedded object with a call to the <a href="api3_9b1w.htm"><b>OleSetContainedObject</b></a> function, so other connections can affect the object.</p>
<p>
Unless an application manages all aspects of its application and document shutdown completely with calls to <b>CoLockObjectExternal</b>, the container must keep a private lock count in <b>IOleContainer::LockContainer</b> so that it exits when the lock count reaches zero and the container is invisible. Maintaining all aspects of shutdown, and thereby avoiding keeping a private lock count, means that <b>CoLockObjectExternal </b>should be called whenever one of the following conditions occur:
<ul>
<li>
A document is created and destroyed or made visible or invisible.</li>
<li>
An application is started and shut down by the user.</li>
<li>
A pseudo-object is created and destroyed.</li>
</ul>
<p>
For debugging purposes, it may be useful to keep a count of the number of external locks (and unlocks) set on the application.</p>
<p>
<b>Note</b>&nbsp;&nbsp;The end user has explicit control over the lifetime of an application, even if there are external locks on it. That is, if a user decides to close the application (File, Exit), it <i>must</i> shut down. In the presence of external locks (such as the lock set by <b>CoLockObjectExternal</b>), the application can call the <a href="api1_4mk4.htm"><b>CoDisconnectObject</b></a> function to force these connections to close prior to shutdown.</p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Use version 3.1 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Use Windows 95 or later.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in objbase.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Included as a resource in ole32.dll.</p>
<h4>See Also</h4>
<p>
<a href="if_o_8gxe.htm"><b>IOleContainer::LockContainer</b></a>, <a href="api3_9b1w.htm"><b>OleSetContainedObject</b></a> </p>
<p>
</p>
<p>
</p>
<p>&nbsp;</p></body>
</HTML>
