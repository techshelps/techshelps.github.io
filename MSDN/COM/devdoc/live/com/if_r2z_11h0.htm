<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IStorage::Commit</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_com_istorage_commit"></a>IStorage::Commit</h2>
<p>
Ensures that any changes made to a storage object open in transacted mode are reflected in the parent storage; for a root storage, reflects the changes in the actual device, for example, a file on disk. For a root storage object opened in direct mode, this method has no effect except to flush all memory buffers to the disk. For non-root storage objects in direct mode, this method has no effect.</p>
<pre><code><b>HRESULT Commit(
  DWORD</b><i> grfCommitFlags  </i>//Specifies how changes are to be committed
<b>);</b>
 </code></pre>
<h4>Parameter</h4>
<dl>
<dt>
<i>grfCommitFlags</i></dt>
<dd>
[in] Controls how the changes are committed to the storage object. See the <a href="enums_1ktf.htm"><b>STGC</b></a> enumeration for a definition of these values.</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
S_OK</dt>
<dd>
Changes to the storage object were successfully committed to the parent level. If STGC_CONSOLIDATE was specified, the storage was successfully consolidated, or the storage was already too compact to consolidate further.</dd>
<dt>
STG_S_MULTIPLEOPENS</dt>
<dd>
The commit operation succeeded, but the storage could not be consolidated because it had been opened multiple times using the STGM_NOSNAPSHOT flag.
<p>

</dd>
<dt>
STG_S_CANNOTCONSOLIDATE</dt>
<dd>
The commit operation succeeded, but the storage could not be consolidated due to an incorrect storage mode. For compound files, the storage may have been opened using the STGM_NOSCRATCH flag, or the storage may not be the outermost transacted level.</dd>
<dt>
STG_S_CONSOLIDATIONFAILED</dt>
<dd>
The commit operation succeeded, but the storage could not be consolidated due to an internal error (for example, a memory allocation failure).</dd>
<dt>
E_PENDING</dt>
<dd>
Asynchronous storage only: Part or all of the data to be committed is currently unavailable. For more information, see <a href="if_f2n_5xdf.htm"><b>IFillLockBytes</b></a> and <a href="asyncstg_86cl.htm">Asynchronous Storage</a>. </dd>
<dt>
STG_E_INVALIDFLAG</dt>
<dd>
The value for the <i>grfCommitFlags</i> parameter is not valid.</dd>
<dt>
STG_E_INVALIDPARAMETER</dt>
<dd>
One of the parameters was not valid.</dd>
<dt>
STG_E_NOTCURRENT</dt>
<dd>
Another open instance of the storage object has committed changes. As a result, the current commit operation may overwrite previous changes.</dd>
<dt>
STG_E_MEDIUMFULL</dt>
<dd>
No space left on device to commit.</dd>
<dt>
STG_E_TOOMANYOPENFILES</dt>
<dd>
The commit operation could not be completed because there are too many open files.</dd>
<dt>
STG_E_REVERTED</dt>
<dd>
The storage object has been invalidated by a revert operation above it in the transaction tree.</dd>
</dl>
<h4>Remarks</h4>
<p>
<b>IStorage::Commit</b> makes permanent changes to a storage object that is in transacted mode, in which changes are accumulated in a buffer, and not reflected in the storage object until there is a call to this method. The alternative is to open an object in direct mode, in which changes are immediately reflected in the storage object and so does not require a commit operation. Calling this method on a storage opened in direct mode has no effect, unless it is a root storage, in which case it ensures that changes in memory buffers are written to the underlying storage device.</p>
<p>
The commit operation publishes the current changes in this storage object and its children to the next level up in the storage hierarchy. To undo current changes before committing them, call <b>IStorage::Revert</b> to roll back to the last-committed version.</p>
<p>
Calling <b>IStorage::Commit</b> has no effect on currently-opened nested elements of this storage object. They are still valid and can be used. However, the <b>IStorage::Commit</b> method does not automatically commit changes to these nested elements. The commit operation publishes only known changes to the next higher level of the storage hierarchy. Thus, transactions to nested levels must be committed to this storage object before they can be committed to higher levels.</p>
<p>
In commit operations, you need to take steps to ensure that data is protected during the commit process:
<ul>
<li>
When committing changes to root storage objects, the caller must check the return value to determine whether the operation has been completed successfully, and if not, that the old committed contents of the <a href="if_r2z_9b8l.htm"><b>IStorage</b></a> are still intact and can be restored.</li>
<li>
If this storage object was opened with some of its items excluded, then the caller is responsible for rewriting them before calling commit. Write mode is required on the storage opening for the commit to succeed.</li>
<li>
Unless prohibiting multiple simultaneous writers on the same storage object, an application calling this method should specify at least STGC_ONLYIFCURRENT in the <i>grfCommitFlags</i> parameter to prevent the changes made by one writer from inadvertently overwriting the changes made by another.</li>
</ul>
<p>
If the STGC_CONSOLIDATE flag is not supported by a storage implementation, then calling <b>IStorage::Commit</b> with STGC_CONSOLIDATE specified in the <i>grfCommitFlags </i>parameter<i> </i>returns the value STG_E_INVALIDFLAG.</p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Use version 3.1 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Use Windows 95 or later.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in objidl.h.</p>
<h4>See Also<i> </i></h4>
<p>
<a href="if_r2z_954e.htm"><b>IStorage - Compound File Implementation</b></a>, <a href="enums_1ktf.htm"><b>STGC</b></a>, <a href="if_r2z_56no.htm"><b>IStorage::Revert</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
