<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IStorage::CopyTo</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_com_istorage_copyto"></a>IStorage::CopyTo</h2>
<p>
Copies the entire contents of an open storage object to another storage object.</p>
<pre><code><b>HRESULT CopyTo(
  DWORD</b><i> ciidExclude</i><b>,  </b>//Number of elements in <i>rgiidExclude</i>
<b>  IID const *</b><i> rgiidExclude</i><b>,</b>
<b>                      </b>//Array of interface identifiers (IIDs)
<b>  SNB</b><i> snbExclude</i><b>,     </b>//Points to a block of stream names in the 
                      // storage object
<b>  IStorage *</b><i> pstgDest </i>//Points to destination storage object
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>ciidExclude</i></dt>
<dd>
[in] The number of elements in the array pointed to by <i>rgiidExclude</i>. If <i>rgiidExclude</i> is NULL, then <i>ciidExclude</i> is ignored.</dd>
<dt>
<i>rgiidExclude</i></dt>
<dd>
[in] An array of interface identifiers that either the caller knows about and does not want to be copied or  that the storage object does not support but whose state the caller will later explicitly copy. The array can include <b>IStorage</b>, indicating that only stream objects are to be copied, and <b>IStream</b>, indicating that only storage objects are to be copied. An array length of zero indicates that only the state exposed by the <a href="if_r2z_9b8l.htm"><b>IStorage</b></a> object is to be copied; all other interfaces on the object are to be ignored. Passing NULL indicates that all interfaces on the object are to be copied. </dd>
<dt>
<i>snbExclude</i></dt>
<dd>
[in] A string name block (refer to <a href="structs_3x7m.htm">SNB</a>) that specifies a block of storage or stream objects that are not to be copied to the destination. These elements are not created at the destination. If IID_IStorage is in the <i>rgiidExclude </i>array, this parameter is ignored. This parameter may be NULL.</dd>
<dt>
<i>pstgDest</i></dt>
<dd>
[in] Points to the open storage object into which this storage object is to be copied. The destination storage object can be a different implementation of the <a href="if_r2z_9b8l.htm"><b>IStorage</b></a> interface from the source storage object. Thus, <b>IStorage::CopyTo</b> can only use publicly available methods of the destination storage object. If <i>pstgDest </i>is open in transacted mode, it can be reverted by calling its <a href="if_r2z_56no.htm"><b>IStorage::Revert</b></a> method.</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
S_OK</dt>
<dd>
The storage object was successfully copied.</dd>
<dt>
E_PENDING</dt>
<dd>
Asynchronous Storage only: Part or all of the data to be copied is currently unavailable. For more information see <a href="if_f2n_5xdf.htm"><b>IFillLockBytes</b></a> and <a href="asyncstg_86cl.htm">Asynchronous Storage</a>. </dd>
<dt>
STG_E_ACCESSDENIED</dt>
<dd>
The destination storage object is a child of the source storage object.</dd>
<dt>
STG_E_INSUFFICIENTMEMORY</dt>
<dd>
The copy was not completed due to a lack of memory.</dd>
<dt>
STG_E_INVALIDPOINTER</dt>
<dd>
The pointer specified for the storage object was invalid.</dd>
<dt>
STG_E_INVALIDPARAMETER</dt>
<dd>
One of the parameters was invalid.</dd>
<dt>
STG_E_TOOMANYOPENFILES</dt>
<dd>
The copy was not completed because there are too many open files.</dd>
<dt>
STG_E_REVERTED</dt>
<dd>
The storage object has been invalidated by a revert operation above it in the transaction tree. </dd>
<dt>
STG_E_MEDIUMFULL</dt>
<dd>
The copy was not completed because the storage medium is full.</dd>
</dl>
<h4>Remarks</h4>
<p>
This method merges elements contained in the source storage object with those already present in the destination. The layout of the destination storage object may differ from the source storage object.</p>
<p>
The copy process is recursive, invoking <b>IStorage::CopyTo</b> and <a href="if_r2z_3lkf.htm"><b>IStream::CopyTo</b></a> on the elements nested inside the source.</p>
<p>
When copying a stream on top of an existing stream with the same name, the existing stream is first removed and then replaced with the source stream.  When copying a storage on top of an existing storage with the same name, the existing storage is not removed. As a result,, after the copy operation, the destination <a href="if_r2z_9b8l.htm"><b>IStorage</b></a> contains older elements, unless they were replaced by newer ones with the same names.</p>
<p>
A storage object may expose interfaces other than <b>IStorage</b>, including <b>IRootStorage</b>, <b>IPropertyStorage</b>, or <b>IPropertySetStorage</b>. The <i> rgiidExclude<b> </b></i>parameter provides a way to exclude any or all of these additional interfaces from the copy operation.</p>
<p>
A caller with a newer or more efficient copy of an existing substorage or stream object may want to exclude the current versions of these objects from the copy operation. The <i>snbExclude</i> and <i>rgiidExclude </i>parameters provide two different ways of excluding a storage objects existing storages or streams.</p>
<h5>Note to Callers</h5>
<p>
The most common way to use this method is to copy everything possible from the source to the destination, as in most Full Save and SaveAs operations. The following example illustrates this call:</p>
<pre><code>pstg-&gt;CopyTo(0, Null, Null, pstgDest)
 </code></pre>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Use version 3.1 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Use Windows 95 or later.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in objidl.h.</p>
<h4>See Also</h4>
<p>
<a href="if_r2z_954e.htm"><b>IStorage - Compound File Implementation</b></a>, <a href="if_r2z_44q7.htm"><b>IStorage::MoveElementTo</b></a>, <a href="if_r2z_56no.htm"><b>IStorage::Revert</b></a> </p>
<p>&nbsp;</p></body>
</HTML>
