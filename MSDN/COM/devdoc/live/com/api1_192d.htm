<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>CoGetInstanceFromIStorage</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_com_cogetinstancefromistorage"></a>CoGetInstanceFromIStorage</h1>
<p>
Creates a new object and initializes it from a storage object through an internal call to <a href="if_p2q_34pw.htm"><b>IPersistStorage::Load</b></a>.</p>
<pre><code><b>HRESULT CoGetInstanceFromIStorage(
  COSERVERINFO *</b><i> pServerInfo</i><b>,</b>
<b>                         </b>//Pointer to COSERVERINFO struct indicating 
                         // remote system
<b>  CLSID *</b><i> pclsid</i><b>,        </b>//Pointer to the CLSID of the object to be 
                         // created
<b>  Iunknown *</b><i> punkOuter</i><b>,  </b>//If part of an aggregate, pointer to the 
                         // controlling IUnknown
<b>  DWORD</b><i> dwClsCtx</i><b>,        </b>//Values taken from the CLSCTX enumeration
<b>  Istorage *</b><i> pstg</i><b>,       </b>//Pointer to storage from which object is 
                         // to be initialized
<b>  ULONG</b><i> cmq</i><b>,             </b>//Number of MULTI_QI structures in 
                         // <i>rgmqResults</i>
<b>  MULTI_QI *</b><i> rgmqResults </i>//Array of MULTI_QI structures
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>pServerInfo</i></dt>
<dd>
[in] Pointer to a <a href="structs_34vj.htm"><b>COSERVERINFO</b></a> structure that specifies the machine on which to instantiate the object and the authentication setting to be used. May be NULL, in which case the object is either instantiated (1) on the current machine, (2) at the machine specified under the <a href="reg_7an9.htm"><b>RemoteServerName</b></a> named-value for the class in the registry, or (3) at the machine where the storage object pointed to by <i>pstg</i> is located if the class is registered with <a href="reg_3o9x.htm"><b>ActivateAtStorage</b></a> specified or has no local registry information.</dd>
<dt>
<i>pclsid</i></dt>
<dd>
[in] Pointer to the class identifier (CLSID) of the object to be created. May be NULL, in which case there is a call to <a href="if_r2z_3ook.htm"><b>IStorage:Stat</b></a><b> </b>to find the class of the object.</dd>
<dt>
<i>punkOuter</i></dt>
<dd>
[in] When non-NULL, indicates the instance is being created as part of an aggregate, and <i>punkOuter</i> is to be used as the pointer to the new instance's controlling <b>IUnknown</b>. Aggregation is currently not supported cross-process or cross-machine. When instantiating an object out of process, CLASS_E_NOAGGREGATION will be returned if <i>punkOuter</i> is non-NULL.</dd>
<dt>
<i>dwClsCtx</i></dt>
<dd>
Values taken from the <a href="enums_152w.htm"><b>CLSCTX</b></a> enumeration.</dd>
<dt>
<i>pstg</i></dt>
<dd>
Pointer to storage to initialize the object with using <a href="if_p2q_34pw.htm"><b>IPersistStorage::Load</b></a>. May not be NULL.</dd>
<dt>
<i>cmq</i></dt>
<dd>
Number of MULTI_QI structures in <i>rgmqResults</i>. Must be greater than zero.</dd>
<dt>
<i>rgmqResults</i></dt>
<dd>
Array of <a href="structs_8y09.htm"><b>MULTI_QI</b></a> structures. Each structure has three members: the identifier for a requested interface (pIID), the location to return the interface pointer (<i>pItf</i>) and the return value of the call to <b>QueryInterface</b> (<i>hr</i>).
</dd>
</dl>
<h4>Return Values</h4>
<p>
This function supports the standard return value E_INVALIDARG, as well as the following:
<dl>
<dt>
S_OK </dt>
<dd>
Indicates success.</dd>
<dt>
CO_S_NOTALLINTERFACES</dt>
<dd>
At least one, but not all of the interfaces requested in the <i>rgmqResults</i> array were successfully retrieved. The <i>hr</i> field of each of the MULTI_QI structures in <i>rgmqResults</i> indicates with S_OK or E_NOINTERFACE whether the specific interface pointer was retrieved.</dd>
<dt>
E_NOINTERFACE</dt>
<dd>
None of the interfaces requested in the <i>rgmqResults</i> array were successfully retrieved.
</dd>
</dl>
<h4>Remarks</h4>
<p>
<b>CoGetInstanceFromIStorage</b> creates a new object and initializes it from a storage object through a call to <a href="if_p2q_34pw.htm"><b>IPersistStorage::Load</b></a>. This function is similar to creating an instance using <a href="api1_5ry0.htm"><b>CoCreateInstanceEx</b></a> followed by a call to<b> IPersistStorage::Load</b>, with the following important distinctions:
<ul>
<li>
Fewer network round trips are required by thisfunction when instantiating remotely.</li>
<li>
In the case where <i>dwClsCtx</i> is set to CLSCTX_REMOTE_SERVER and <i>pServerInfo</i> is NULL, if the class is registered with the <a href="reg_3o9x.htm"><b>ActivateAtStorage</b></a> named value or has no associated registry information, this function will instantiate an object on the same machine where the storage object pointed to by <i>pstg</i> resides, providing the least possible network traffic. For example, if <i>pstg</i> were obtained through a call to <a href="api4_8hd1.htm"><b>StgCreateDocfile</b></a>, specifying "\\myserver\users\johndo\file", the object would be instantiated on the "myserver" machine, and the object would access the storage object directly.</li>
</ul>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Use version 4.0 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Use Windows 95 or later. Available as a redistributable for Windows 95.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in objbase.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Included as a resource in ole32.dll.</p>
<h4>See Also</h4>
<p>
<a href="api1_5ry0.htm"><b>CoCreateInstanceEx</b></a>, <a href="api1_765h.htm"><b>CoGetInstanceFromFile</b></a>, <a href="enums_152w.htm"><b>CLSCTX</b></a>, <a href="comext_4ws3.htm"><b>Instance Creation Helper Functions</b></a> </p>
<p>
</p>
<p>
</p>
<p>&nbsp;</p></body>
</HTML>
