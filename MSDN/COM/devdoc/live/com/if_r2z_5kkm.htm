<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IServerSecurity::RevertToSelf</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_com_iserversecurity_reverttoself"></a>IServerSecurity::RevertToSelf</h2>
<p>
Restores a thread's authentication information. </p>
<pre><b><code>HRESULT RevertToSelf( )
 </code></b></pre>
<h4>Return Values</h4>
<p>
This method supports the standard return value E_FAIL, as well as the following: 
<dl>
<dt>
S_OK</dt>
<dd>
Success.
</dd>
</dl>
<h4>Remarks</h4>
<p>
In Windows NT 4, <b>IServerSecurity::RevertToSelf</b> sets the thread token to NULL. In Windows NT 5, <b>RevertToSelf</b> restores the thread's authentication information. This behavior is described as follows. </p>
<p>
<b>RevertToSelf</b> restores the authentication information on a thread to the authentication information on the thread before impersonation began. If the server does not call <b>RevertToSelf</b> before the end of the current call, it will be called automatically by COM. </p>
<p>
When <a href="if_r2z_1h84.htm"><b>ImpersonateClient</b></a> is called on a thread that is not currently impersonating, COM saves the token currently on the thread. A subsequent call to <b>RevertToSelf</b> restores the saved token, and <a href="if_r2z_8t7r.htm"><b>IsImpersonating</b></a> will then return false. This means that if a series of impersonation calls are made using different <b>IServerSecurity</b> objects, <b>RevertToSelf</b> will restore the token that was on the thread when the first call to <b>ImpersonateClient</b> was made. Also, only one <b>RevertToSelf</b> call is needed to undo any number of <b>ImpersonateClient</b> calls. </p>
<p>
This method will only revert impersonation changes made by <a href="if_r2z_1h84.htm"><b>IServerSecurity::ImpersonateClient</b></a>. If the thread token is modified by other means (through the <b>SetThreadToken</b> or <b>RpcImpersonateClient</b> Win32 functions) the result of this function is undefined.</p>
<p>
<b>RevertToSelf</b> affects only the current method invocation. If there are nested method invocations, each invocation can have its own impersonation token and DCOM will correctly restore the impersonation token before returning to them (regardless of whether or not <b>CoRevertToSelf</b> or<b> IServerSecurity::RevertToSelf</b> was called).</p>
<p>
It is important to understand that an instance of <b>IServerSecurity</b> is valid on any thread in the apartment until the call represented by <b>IServerSecurity</b> completes. However, impersonation is local to a particular thread for the duration of the current call on that thread. Therefore, if two threads in the same apartment use the same <b>IServerSecurity</b> instance to call <b>IServerSecurity::ImpersonateClient</b>, one thread can call <b>RevertToSelf</b> without affecting the other. </p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Use version 4.0 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Use Windows 95 or later. Available as a redistributable for Windows 95.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in objidl.h.</p>
<h4>See Also</h4>
<p>
<a href="api1_2pd2.htm"><b>CoRevertToSelf</b></a> </p>
<p>
</p>
<p>
</p>
<p>&nbsp;</p></body>
</HTML>
