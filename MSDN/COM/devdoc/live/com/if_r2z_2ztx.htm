<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IRootStorage::SwitchToFile</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_com_irootstorage_switchtofile"></a>IRootStorage::SwitchToFile</h2>
<p>
Copies the current file associated with the storage object to a new file. The new file is then used for the storage object and any uncommitted changes.</p>
<pre><code><b>HRESULT SwitchToFile(
  LPOLESTR</b><i> pszFile  </i>//Filename for the new file
<b>);</b>
 </code></pre>
<h4>Parameter</h4>
<dl>
<dt>
<i>pszFile</i></dt>
<dd>
Specifies the filename for the new file. It cannot be the name of an existing file. If NULL, this method creates a temporary file with a unique name, and you can call <a href="if_r2z_3ook.htm"><b>IStorage::Stat</b></a> to retrieve the name of the temporary file.</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
S_OK</dt>
<dd>
The file was successfully copied.</dd>
<dt>
STG_E_MEDIUMFULL</dt>
<dd>
The file was not copied because of insufficient space on the storage device.</dd>
<dt>
STG_E_ACCESSDENIED</dt>
<dd>
The file was not copied because the caller does not have permission to access storage device.</dd>
<dt>
STG_E_INVALIDPOINTER </dt>
<dd>
The file was not copied because the <i>pszFile</i> pointer is invalid.</dd>
<dt>
STG_E_FILEALREADYEXISTS</dt>
<dd>
The file was not copied because the new filename (<i>pszFile</i>) points to an existing file.</dd>
</dl>
<h4>Remarks</h4>
<p>
The <b>IRootStorage::SwitchToFile</b> method copies the file associated with the storage object. A COM container calls <b>SwitchToFile</b> to perform a full save on a file in a low-memory situation. Typically, this is done only after a normal full save operation (i.e., save to temporary file, delete original file, rename temporary file) has failed with an E_OUTOFMEMORY error.</p>
<p>
It is illegal to call <b>SwitchToFile</b> if the storage object or anything contained within it has been marshalled to another process. As a consequence, before calling <b>SwitchToFile</b>, the container must call the <a href="if_p2q_1z1h.htm"><b>IPersistStorage::HandsOffStorage</b></a> method for any element within the storage object that is loaded or running. The <b>HandsOffStorage</b> method forces the element to release its storage pointers and enter the hands-off storage mode. The container must also release all pointers to streams or storages that are contained in this root storage. After the full save operation is completed, the container returns the contained elements to normal storage mode.</p>
<p>
When storing storage objects on NTFS systems in native structured storage format, the files are automatically converted for all non-NTFS partitions, for example FAT partitions. The <b>IRootStorage::SwitchToFile</b> method is not supported for NTFS native structured storage files.</p>
<p>
</p>
<h5>Notes to Implementers</h5>
<p>
If you are implementing your own storage objects, the <a href="if_r2z_63s5.htm"><b>IRootStorage</b></a> methods (including <b>QueryInterface</b>, <b>AddRef</b>, and <b>Release</b>) must not consume additional memory or file handles.</p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Use version 3.1 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Use Windows 95 or later.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in objidl.h.</p>
<h4>See Also</h4>
<p>
<a href="if_p2q_1z1h.htm"><b>IPersistStorage::HandsOffStorage</b></a>, <a href="if_p2q_115w.htm"><b>IPersistStorage::SaveCompleted</b></a>, <a href="if_r2z_11h0.htm"><b>IStorage::Commit</b></a>, <a href="if_r2z_3ook.htm"><b>IStorage::Stat</b></a> </p>
<p>
</p>
<p>
</p>
<p>&nbsp;</p></body>
</HTML>
