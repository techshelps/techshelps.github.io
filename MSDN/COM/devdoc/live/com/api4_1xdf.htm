<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>StgOpenStorageOnILockBytes</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_com_stgopenstorageonilockbytes"></a>StgOpenStorageOnILockBytes</h1>
<p>
Opens an existing storage object that does not reside in a disk file, but instead has an underlying byte array provided by the caller.</p>
<pre><code><b>WINOLEAPI StgOpenStorageOnILockBytes(
  ILockBytes *</b><i> plkbyt</i><b>,</b>   //Points to the ILockBytes interface on the 
                         // underlying byte array
<b>  IStorage *</b><i> pStgPriority</i><b>,</b>   //Points to a previous opening of a 
                             // root storage object
<b>  DWORD</b><i> grfMode</i><b>,</b>         //Specifies the access mode for the object
<b>  SNB</b><i> snbExclude</i><b>,</b>        //Points to an SNB structure specifying 
                         // elements to be excluded
<b>  DWORD</b><i> reserved</i><b>,</b>        //Reserved, must be zero
<b>  IStorage **</b><i> ppstgOpen  </i>//Points to location for returning the 
                         // storage object
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>plkbyt</i></dt>
<dd>
[in] <b>ILockBytes</b> pointer to the underlying byte array object that contains the storage object to be opened.</dd>
<dt>
<i>pStgPriority</i></dt>
<dd>
[in] Most often NULL. If not NULL, this parameter is used instead of the <i>plkbyt</i> parameter to specify the storage object to open. In this case, it points to the <b>IStorage</b> interface on a previously opened root storage object, most often one that was opened in priority mode.
<p>
After the <b>StgOpenStorageOnILockBytes </b>function returns, the storage object specified in the <i>pStgPriority</i> parameter on function entry is invalid, and can no longer be used; use the one specified in the <i>ppStgOpen</i> parameter instead.
</dd>
<dt>
<i>grfMode</i></dt>
<dd>
[in] Specifies the access mode to use to open the storage object.</dd>
<dt>
<i>snbExclude</i></dt>
<dd>
[in] Can be NULL. If not NULL, this parameter points to a block of elements in this storage that are to be excluded as the storage object is opened. This exclusion occurs independent of whether a snapshot copy happens on the open. .</dd>
<dt>
<i>reserved</i></dt>
<dd>
[in] Indicates reserved for future use; must be zero.</dd>
<dt>
<i>ppstgOpen</i></dt>
<dd>
[out] Points to the location of an <b>IStorage</b> pointer to the opened storage on successful return.</dd>
</dl>
<h4>Return Values</h4>
<dl>
<dt>
S_OK</dt>
<dd>
The storage object was successfully opened.</dd>
<dt>
STG_E_FILENOTFOUND</dt>
<dd>
The specified byte array does not exist.</dd>
<dt>
STG_E_ACCESSDENIED</dt>
<dd>
Access denied because the caller has insufficient permission, or another caller has the file open and locked.</dd>
<dt>
STG_E_LOCKVIOLATION</dt>
<dd>
Access denied because another caller has the file open and locked.</dd>
<dt>
STG_E_SHAREVIOLATION</dt>
<dd>
Access denied because another caller has the file open and locked.</dd>
<dt>
STG_E_FILEALREADYEXISTS</dt>
<dd>
The byte array exists but is not a storage object.</dd>
<dt>
STG_E_TOOMANYOPENFILES</dt>
<dd>
The storage object was not opened because there are too many open files.</dd>
<dt>
STG_E_INSUFFICIENTMEMORY</dt>
<dd>
The storage object was not opened due to a lack of memory.</dd>
<dt>
STG_E_INVALIDNAME</dt>
<dd>
Either  <i>pwcsName</i> or <i>snbExclude</i> contains an invalid name.</dd>
<dt>
STG_E_INVALIDPOINTER</dt>
<dd>
Either <i>snbExclude</i>, <i>pwcsName</i>, <i>pstgPriority</i>, or <i>ppStgOpen contains an invalid pointer</i>.</dd>
<dt>
STG_E_INVALIDFLAG</dt>
<dd>
The <i>grfMode</i> parameter contains a bad flag combination.</dd>
<dt>
STG_E_INVALIDFUNCTION</dt>
<dd>
The access mode STGM_DELETEONRELEASE was specified in the <i>grfMode</i> parameter.</dd>
<dt>
STG_E_OLDDLL</dt>
<dd>
The DLL being used to open this storage object is a version prior to the one used to create it.</dd>
<dt>
STG_E_OLDFORMAT</dt>
<dd>
The storage object being opened was created by the Beta 1 storage provider. This format is no longer supported.</dd>
</dl>
<p>
This function can also return any file system errors, or Win32 errors wrapped in an HRESULT, or <a href="if_f2n_9q9f.htm"><b>ILockBytes</b></a> interface error return values.</p>
<h4>Remarks</h4>
<p>
<b>StgOpenStorageOnILockBytes</b> opens the specified root storage object. The storage object is opened according to the access mode in the <i>grfMode</i> parameter; a pointer to the IStorage interface on the opened storage object is supplied through the <i>ppstgOpen</i> parameter.</p>
<p>
The storage object must have been previously created by the <a href="api4_5ar7.htm"><b>StgCreateDocfileOnILockBytes</b></a> function.</p>
<p>
Except for specifying a programmer-provided byte-array object, <b>StgOpenStorageOnILockBytes</b> is similar to the <b>StgOpenStorage</b> function. For more information, refer to <a href="api4_0hb9.htm"><b>StgOpenStorage</b></a>. </p>
<p>
<b>Windows CE:</b> The <b>StgCreateDocfileOnILockBytes</b> and <b>StgOpenStorageOnILockBytes</b> functions are not available for the non-desktop compatible implementation via CESYSGEN.</p>
<p>
Passing into this function any invalid and, under some circumstances, NULL pointers will result in unexpected termination of the application. For more information about handling exceptions, see Programming Considerations.</p>
<p>
</p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Use version 3.1 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Use Windows 95 or later.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Use version 2.0 or later.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in objbase.h.<br>
<b>&nbsp;&nbsp;Import Library: </b>Use ole32.lib.</p>
<h4>See Also</h4>
<p>
<a href="api4_0hb9.htm"><b>StgOpenStorage</b></a>, <a href="api4_5ar7.htm"><b>StgCreateDocfileOnILockBytes</b></a> </p>
<p>
</p>
<p>
</p>
<p>&nbsp;</p></body>
</HTML>
