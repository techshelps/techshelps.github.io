<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Property Sheets and Property Pages</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_com_property_sheets_and_property_pages"></a>Property Sheets and Property Pages</h1>
<p>
An object's properties are exposed to clients the same as methods through either COM interfaces or the object's <b>IDispatch</b> implementation, allowing properties to be changed by programs calling these methods. The OLE technology of property pages provides the means to build a user interface for an object's properties according to Windows user interface standards. Thus, the properties are exposed to end users. An object's property sheet is a tabbed-dialog where each tab corresponds to a specific property page. The OLE model for working with property pages consists of these features:
<ul>
<li>
Each property page is managed by an in-process object that implements either <a href="if_p2q_06qt.htm"><b>IPropertyPage</b></a> or <a href="if_p2q_1zoy.htm"><b>IPropertyPage2</b></a>. Each page is identified with its own unique CLSID.</li>
<li>
An object specifies its support for property pages by implementing <a href="if_r2z_4boz.htm"><b>ISpecifyPropertyPages</b></a>. Through this interface the caller can obtain a list of CLSIDs identifying the specific property pages that the object supports. If the object specifies a property page CLSID, the object must be able to receive property changes from the property page.</li>
<li>
Any piece of code (client or object) that wishes to display an object's property sheet passes the object's <b>IUnknown </b>pointer (or an array if multiple objects are to be affected) along with an array of page CLSIDs to <a href="api3_81t1.htm"><b>OleCreatePropertyFrame</b></a><b> </b>or <a href="api3_34tw.htm"><b>OleCreatePropertyFrameIndirect</b></a>, which creates the tabbed-dialog box.</li>
<li>
The property frame dialog instantiates a single instance of each property page, using <b>CoCreateInstance</b> on each CLSID. The property frame obtains at least an <b>IPropertyPage</b> pointer for each page. In addition, the frame creates a property page site object in itself for each page. Each site implements <a href="if_p2q_6d7p.htm"><b>IPropertyPageSite</b></a> and this pointer is passed to each page. The page then communicates with the site through this interface pointer.</li>
<li>
Each page is also made aware of the object or objects for which it has been invoked; that is, the property frame passes the <b>IUnknown </b>pointers of the objects to each page. When instructed to apply changes to the objects, each page queries for the appropriate interface pointer and passes new property values to the objects in whatever way is desired. There are no stipulations on how such communication has to happen.</li>
<li>
An object can also support per property browsing through the <a href="if_p2q_3uxz.htm"><b>IPerPropertyBrowsing</b></a> interface permitting the object to specify which property should receive initial focus when the property page is displayed and to specify string's and values that can be displayed by the client in its own user interface.</li>
</ul>
<p>
These features are illustrated in the following diagram:</p>
<p>
<img src="images/sheetpgs.gif" border=0></p>
<p>
These interfaces are defined as follows:</p>
<pre><code>interface ISpecifyPropertyPages : IUnknown 
    { 
    HRESULT GetPages([out] CAUUID *pPages); 
    }; 
 
 
interface IPropertyPage : IUnknown 
    { 
    HRESULT SetPageSite([in] IPropertyPageSite *pPageSite); 
    HRESULT Activate([in] HWND hWndParent, [in] LPCRECT prc 
        , [in] BOOL bModal); 
    HRESULT Deactivate(void); 
    HRESULT GetPageInfo([out] PROPPAGEINFO *pPageInfo); 
    HRESULT SetObjects([in] ULONG cObjects 
        , [in, max_is(cObjects)] IUnknown **ppunk); 
    HRESULT Show([in] UINT nCmdShow); 
    HRESULT Move([in] LPCRECT prc); 
    HRESULT IsPageDirty(void); 
    HRESULT Apply(void); 
    HRESULT Help([in] LPCOLESTR pszHelpDir); 
    HRESULT TranslateAccelerator([in] LPMSG pMsg); 
    } 
 
interface IPropertyPageSite : IUnknown 
    { 
    HRESULT OnStatusChange([in] DWORD dwFlags); 
    HRESULT GetLocaleID([out] LCID *pLocaleID); 
    HRESULT GetPageContainer([out] IUnknown **ppUnk); 
    HRESULT TranslateAccelerator([in] LPMSG pMsg); 
    } 
 </code></pre>
<p>
The <b>ISpecifyPropertyPages::GetPages</b> method returns a counted array of UUID (GUID) values each of which describe the CLSID of a property page that the object would like displayed. Whoever invokes the property sheet with <b>OleCreatePropertyFrame</b> or <b>OleCreatePropertyFrameIndirect </b>passes this array to the API function. Note that if the caller wishes to display property pages for multiple objects, it must only pass the intersection of the CLSID lists of all the objects to these API functions. In other words, the caller must only invoke property pages that are common to all objects.</p>
<p>
In addition, the caller passes the <b>IUnknown</b> pointers to the affected objects to the API functions as well. Both API functions create a property frame dialog and instantiate a page site with <b>IPropertyPageSite</b> for each page it will load. Through this interface a property page can:
<ul>
<li>
retrieve the current language used in the property sheet through <b>GetLocaleID</b>,</li>
<li>
ask the frame to process keystrokes through <b>TranslateAccelerator</b>,</li>
<li>
notify the frame of changes in the page through <b>OnStatusChange</b>,</li>
<li>
obtain an interface pointer for the frame itself through <b>GetPageContainer</b>, although there are no interfaces defined for the frame at this time for this function always returns E_NOTIMPL</li>
</ul>
<p>
The property frame instantiates each property page object and obtain each page's <b>IPropertyPage </b>interface. Through this interface the frame informs the page of its page site (<b>SetPageSite</b>), retrieves page dimensions and strings (<b>GetPageInfo</b>), passes the interface pointers to the affected objects (<b>SetObjects</b>), tells the page when to create and destroy its controls (<b>Activate </b>and <b>Deactivate</b>), instructs the page to show or reposition itself (<b>Show</b> and <b>Move)</b>, instructs the page to apply its current values to the affected objects (<b>Apply</b>), checks on the page's dirty status (<b>IsPageDirty</b>), invokes help (<b>Help</b>), and passes keystrokes to the page (<b>TranslateAccelerator</b>).</p>
<p>
An object can also support per-property browsing which provides:
<ol type=a>
<li>
a way (through <a href="if_p2q_3uxz.htm"><b>IPerPropertyBrowsing</b></a><b> </b>and <b>IPropertyPage2</b>) to specify which property on which property page should be given the initial focus when a property sheet is first displayed</li>
<li>
a way (through <b>IPerPropertyBrowsing</b>) for the object to specify predefined values and corresponding descriptive strings that could be displayed in a client's own user interface for properties.</li>
</ol>
<p>
An object can choose to support (b) without supporting (a), such as when the object has no property sheet.</p>
<p>
The <b>IPropertyPage2 </b>and <b>IPerPropertyBrowsing </b>interfaces are defined as follows:</p>
<pre><code>interface IPerPropertyBrowsing : IUnknown 
    { 
    HRESULT GetDisplayString([in] DISPID dispID 
        , [out] BSTR *pbstr); 
    HRESULT MapPropertyToPage([in] DISPID dispID 
        , [out] CLSID *pclsid); 
    HRESULT GetPredefinedStrings([in] DISPID dispID 
        , [out] CALPOLESTR *pcaStringsOut 
        , [out] CADWORD *pcaCookiesOut); 
    HRESULT GetPredefinedValue([in] DISPID dispID 
        , [in] DWORD dwCookie, [out] VARIANT *pvarOut); 
    } 
 
interface IPropertyPage2 : IPropertyPage 
    { 
    HRESULT EditProperty([in] DISPID dispID); 
    } 
 </code></pre>
<p>
To specify its support for such capabilities, the object implements <b>IPerPropertyBrowsing</b>. Through this interface, the caller can request the information necessary to achieve the browsing, such as predefined strings (<b>GetPredefinedStrings</b>) and values (<b>GetPredefinedValues</b>) as well as a display string for a given property (<b>GetDisplayString</b>).</p>
<p>
In addition, the client can obtain the CLSID of the property page that allows the user to edit a given property identified with a DISPID (<b>MapPropertyToPage</b>). The client then instructs the property frame to activate that page initially by passing the CLSID and the DISPID to <b>OleCreatePropertyFrameIndirect</b>. The frame activates that page first and passes the DISPID to the page through <b>IPropertyPage2::EditProperty</b>. The page then sets the focus to that property's editing field. In this way, a client can jump from a property name in its own user interface to the property page that can manipulate that property.</p>
<p>&nbsp;</p></body>
</HTML>
