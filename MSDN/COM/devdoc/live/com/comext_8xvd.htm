<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>How Cloaking Determines Client Identity</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h4><a name="_com_how_cloaking_determines_client_identity"></a>How Cloaking Determines Client Identity</h4>
<p>
When a secure call is made and the server asks the client for its identity, it usually gets the identity tied to the proxy. (Sometimes the authentication service performs a translation from the real identity, but generally the proxy identity is the identity the server sees.) The proxy presents an identity to the server that depends on the type of cloaking that is set and other factors. </p>
<p>
The following table summarizes the fact that the identity of the client is a function of the cloaking flag set, the process token, the presence or absence of a thread token, and whether the proxy identity has been previously set. The following table shows the resulting proxy identity (client identity) when these factors vary.</p>
<table cellspacing=4 cols=4>
<tr valign=top>
<th align=left width=36%>Cloaking Flags</th>
<th align=left width=20%>Thread Token Presence</th>
<th align=left width=21%>Proxy Identity<br>
Previously Set</th>
<th align=left width=23%>Proxy Identity<br>
(client identity)</th>
</tr>
<tr valign=top>
<td width=36%>cloaking not set</td>
<td width=20%>don't care</td>
<td width=21%>don't care</td>
<td width=23%>process token or authentication identity</td>
</tr>
<tr valign=top>
<td width=36%>EOAC_STATIC_CLOAKING</td>
<td width=20%>present</td>
<td width=21%>No</td>
<td width=23%>thread token</td>
</tr>
<tr valign=top>
<td width=36%>EOAC_STATIC_CLOAKING</td>
<td width=20%>present</td>
<td width=21%>Yes</td>
<td width=23%>current proxy identity</td>
</tr>
<tr valign=top>
<td width=36%>EOAC_STATIC_CLOAKING</td>
<td width=20%>not present</td>
<td width=21%>No</td>
<td width=23%>process token</td>
</tr>
<tr valign=top>
<td width=36%>EOAC_STATIC_CLOAKING</td>
<td width=20%>not present</td>
<td width=21%>Yes</td>
<td width=23%>current proxy identity</td>
</tr>
<tr valign=top>
<td width=36%>EOAC_DYNAMIC_CLOAKING</td>
<td width=20%>present</td>
<td width=21%>don't care</td>
<td width=23%>thread token</td>
</tr>
<tr valign=top>
<td width=36%>EOAC_DYNAMIC_CLOAKING</td>
<td width=20%>not present</td>
<td width=21%>don't care </td>
<td width=23%>process token</td>
</tr>
</table><br>
<p>
The following rules explain exactly how the proxy identity is determined:
<ul>
<li>
If the application called <b>CoSetProxyBlanket</b> and specified the authentication information parameter (<i>pAuthInfo</i>), use that information. (You cannot set both cloaking and authentication identity on a call to <b>CoSetProxyBlanket</b> or <b>CoInitializeSecurity</b>.) </li>
<li>
If <b>CoSetProxyBlanket</b> was called but the authentication information was not specified and static cloaking is set, and there was a thread token when <b>CoSetProxyBlanket</b> was called, use the thread token from the <b>CoSetProxyBlanket</b> call.</li>
<li>
If <b>CoSetProxyBlanket</b> was called but the authentication information was not specified and dynamic cloaking is set, and there is a current thread token, use that thread token.</li>
<li>
If <i>pAuthInfo</i> was set in <b>CoInitializeSecurity</b>, use the authentication information from <b>CoInitializeSecurity</b>.</li>
<li>
If <i>pAuthInfo</i> was not set in <b>CoInitializeSecurity</b> but static cloaking was set, if this is the first call on the proxy and there is a thread token now, use the current thread token. If this is not the first call on the proxy, use the token chosen on the first call.</li>
<li>
If <i>pAuthInfo</i> was not set in <b>CoInitializeSecurity</b> but dynamic cloaking was set, and if there is a current thread token, use the current thread token.</li>
<li>
If none of the preceding applies, use the process token.</li>
</ul>
<p>&nbsp;</p></body>
</HTML>
