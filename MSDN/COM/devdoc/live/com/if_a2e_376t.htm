<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>IDataObject::DAdvise</title>
<link disabled rel=stylesheet href=../../backsdk3.css>
<style type="text/css">
@import url(../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_com_idataobject_dadvise"></a>IDataObject::DAdvise</h2>
<p>
Called by an object supporting an advise sink to create a connection between a data object and the advise sink. This enables the advise sink to be notified of changes in the data of the object.</p>
<pre><code><b>HRESULT DAdvise(
  FORMATETC *</b><i> pFormatetc</i><b>,  </b>//Pointer to data of interest to the 
                           // advise sink
<b>  DWORD</b><i> advf</i><b>,              </b>//Flags that specify how the notification 
                           // takes place
<b>  IAdviseSink *</b><i> pAdvSink</i><b>,  </b>//Pointer to the advise sink
<b>  DWORD *</b><i> pdwConnection    </i>//Pointer to a token that identifies this 
                           // connection
<b>);</b>
 </code></pre>
<h4>Parameters</h4>
<dl>
<dt>
<i>pFormatetc</i></dt>
<dd>
[in] Pointer to a <a href="structs_14v7.htm"><b>FORMATETC</b></a> structure that defines the format, target device, aspect, and medium that will be used for future notifications. For example, one sink may want to know only when the bitmap representation of the data in the the data object changes. Another sink may be interested in only the metafile format of the same object. Each advise sink is notified when the data of interest changes. This data is passed back to the advise sink when notification occurs.</dd>
<dt>
<i>advf</i></dt>
<dd>
[in] DWORD that specifies a group of flags for controlling the advisory connection. Valid values are from the enumeration <a href="enums_923q.htm"><b>ADVF</b></a>. However, only some of the possible <b>ADVF</b> values are relevant for this method. The following table briefly describes the relevant values. Refer to <b>ADVF</b> for a more detailed description.
<table cellspacing=4 cols=2>
<tr valign=top>
<th align=left width=37%>ADVF Value</th>
<th align=left width=63%>Description</th>
</tr>
<tr valign=top>
<td width=37%>ADVF_NODATA</td>
<td width=63%>Asks the data object to avoid sending data with the notifications. Typically data is sent. This flag is a way to override the default behavior. When ADVF_NODATA is used, the <a href="enums_986c.htm">TYMED</a> member of the <a href="structs_0gfh.htm"><b>STGMEDIUM</b></a> structure that is passed to OnDataChange will usually contain TYMED_NULL. The caller can then retrieve the data with a subsequent <a href="if_a2e_1jz5.htm"><b>IDataObject::GetData</b></a> call.</td>
</tr>
<tr valign=top>
<td width=37%>ADVF_ONLYONCE</td>
<td width=63%>Causes the advisory connection to be destroyed after the first change notification is sent. An implicit call to <a href="if_a2e_3kmd.htm"><b>IDataObject::DUnadvise</b></a> is made on behalf of the caller to remove the connection. </td>
</tr>
<tr valign=top>
<td width=37%>ADVF_PRIMEFIRST</td>
<td width=63%>Asks for an additional initial notification. The combination of ADVF_ONLYONCE and ADVF_PRIMEFIRST provides, in effect, an asynchronous <a href="if_a2e_1jz5.htm"><b>IDataObject::GetData</b></a> call.</td>
</tr>
<tr valign=top>
<td width=37%>ADVF_DATAONSTOP</td>
<td width=63%>When specified with ADVF_NODATA, this flag causes a last notification with the data included to to be sent before the data object is destroyed.<p>
If used without ADVF_NODATA,<b> IDataObject::DAdvise</b> can be implemented in one of the following ways:</p>
</td>
</tr>
<tr valign=top>
<td width=37%></td>
<td width=63%><ul>
<li>
<font face="Symbol">·</font>   the ADVF_DATAONSTOP can be ignored.</li>
</ul>
</td>
</tr>
<tr valign=top>
<td width=37%></td>
<td width=63%><ul>
<li>
<font face="Symbol">·</font>   the object can behave as if ADVF_NODATA was specified.</li>
</ul>
</td>
</tr>
<tr valign=top>
<td width=37%></td>
<td width=63%><ul>
<li>
<font face="Symbol">·</font>   a change notification is sent only in the shutdown case. Data changes prior to shutdown do not cause a notification to be sent.</li>
</ul>
</td>
</tr>
</table><br>

</dd>
<dt>
<i>pAdvSink</i></dt>
<dd>
[in] Pointer to the <b>IAdviseSink</b> interface on<b> </b>the advisory sink that will receive the change notification.</dd>
<dt>
<i>pdwConnection</i></dt>
<dd>
[out] Pointer to a DWORD token that identifies this connection. You can use this token later to delete the advisory connection (by passing it to <a href="if_a2e_3kmd.htm"><b>IDataObject::DUnadvise</b></a>). If this value is zero, the connection was not established.
</dd>
</dl>
<h4>Return Values</h4>
<p>
This method supports the standard return values E_INVALIDARG, E_UNEXPECTED, and E_OUTOFMEMORY, as well as the following: 
<dl>
<dt>
S_OK</dt>
<dd>
The advisory connection was created.</dd>
<dt>
E_NOTIMPL</dt>
<dd>
This method is not implemented on the data object.</dd>
<dt>
DV_E_LINDEX</dt>
<dd>
Invalid value for <i>lindex</i>; currently, only -1 is supported.</dd>
<dt>
DV_E_FORMATETC</dt>
<dd>
Invalid value for <i>pFormatetc</i>.</dd>
<dt>
OLE_E_ADVISENOTSUPPORTED</dt>
<dd>
The data object does not support change notification.
</dd>
</dl>
<h4>Remarks</h4>
<p>
<b>IDataObject::DAdvise</b> creates a change notification connection between a data object and the caller. The caller provides an advisory sink to which the notifications can be sent when the object's data changes. </p>
<p>
Objects used simply for data transfer typically do not support advisory notifications and return OLE_E_ADVISENOTSUPPORTED from <b>IDataObject::DAdvise</b>.</p>
<h5>Notes to Callers</h5>
<p>
The object supporting the advise sink calls <b>IDataObject::DAdvise</b> to set up the connection, specifying the format, aspect, medium, and/or target device of interest in the<b> <a href="structs_14v7.htm">FORMATETC</a></b> structure passed in. If the data object does not support one or more of the requested attributes or the sending of notifications at all, it can refuse the connection by returning OLE_E_ADVISENOTSUPPORTED.</p>
<p>
Containers of linked objects can set up advisory connections directly with the bound link source or indirectly through the standard OLE link object that manages the connection. Connections set up with the bound link source are not automatically deleted. The container must explicitly call <b>IDataObject::DUnAdvise</b> on the bound link source to delete an advisory connection. The OLE link object, manipulated through the <a href="if_o_0r1n.htm"><b>IOleLink</b></a> interface, is implemented in the default handler. Connections set up through the OLE link object are destroyed when the link object is deleted.</p>
<p>
The OLE default link object creates a "wildcard advise" with the link source so OLE can maintain the time of last change. This advise is specifically used to note the time that anything changed. OLE ignores all data formats that may have changed, noting only the time of last change. To allow wildcard advises, set the <b>FORMATETC</b> members as follows before calling <b>IDataObject::DAdvise</b>:</p>
<pre><code>cf == 0; 
ptd == NULL; 
dwAspect ==-1; 
lindex == -1 
tymed == -1; 
 </code></pre>
<p>
The advise flags should also include ADVF_NODATA. Wildcard advises from OLE should always be accepted by applications. </p>
<h5>Notes to Implementers</h5>
<p>
To simplify the implementation of <b>DAdvise</b> and the other notification methods in <a href="if_a2e_24z8.htm"><b>IDataObject</b></a> (<b>DUnadvise</b> and <b>EnumAdvise</b>) that supports notification, OLE provides an advise holder object that manages the registration and sending of notifications. To get a pointer to this object, call the helper function <a href="api2_2y7m.htm"><b>CreateDataAdviseHolder</b></a> on the first invocation of <b>DAdvise</b>. This supplies a pointer to the object's <b>IDataAdviseHolder</b> interface. Then, delegate the call to the <a href="if_a2e_18o5.htm"><b>IDataAdviseHolder::Advise</b></a> method in the data advise holder, which creates, and subsequently manages, the requested connection.</p>
<h4>QuickInfo</h4>
<p>
<b>&nbsp;&nbsp;Windows NT: </b>Use version 3.1 or later.<br>
<b>&nbsp;&nbsp;Windows: </b>Use Windows 95 or later.<br>
<b>&nbsp;&nbsp;Windows CE: </b>Unsupported.<br>
<b>&nbsp;&nbsp;Header: </b>Declared in objidl.h.</p>
<h4>See Also</h4>
<p>
<a href="enums_923q.htm"><b>ADVF</b></a>, <a href="structs_14v7.htm"><b>FORMATETC</b></a>, <a href="api2_2y7m.htm"><b>CreateDataAdviseHolder</b></a>, <a href="if_a2e_2tgl.htm"><b>IAdviseSink::OnDataChange</b></a>, <a href="if_a2e_3kmd.htm"><b>IDataObject::DUnAdvise</b></a> </p>
<p>
</p>
<p>
</p>
<p>&nbsp;</p></body>
</HTML>
