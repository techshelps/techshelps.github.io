<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>EXTENSION_CONTROL_BLOCK</title>
<link disabled rel=stylesheet href=../../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h1><a name="_in_extension_control_block"></a>EXTENSION_CONTROL_BLOCK</h1>
<p>
This structure is used by IIS and the extension to exchange information.</p>
<pre><code>typedef struct _EXTENSION_CONTROL_BLOCK 
{DWORD     cbSize;                // Size of this struct.
DWORD     dwVersion;              // Version info of this spec
HCONN     ConnID;                 // Context number not to be modified!
DWORD     dwHttpStatusCode;       // HTTP Status code
CHAR      lpszLogData[HSE_LOG_BUFFER_LEN];// null terminated log info specific to this Extension DLL
LPSTR     lpszMethod;             // REQUEST_METHOD
LPSTR     lpszQueryString;        // QUERY_STRING
LPSTR     lpszPathInfo;           // PATH_INFO
LPSTR     lpszPathTranslated;     // PATH_TRANSLATED
DWORD     cbTotalBytes;           // Total bytes indicated from client
DWORD     cbAvailable;            // Available number of bytes
LPBYTE    lpbData;                // Pointer to cbAvailable bytes
LPSTR     lpszContentType;        // Content type of client data
BOOL (WINAPI * GetServerVariable);
BOOL (WINAPI * WriteClient);  
BOOL (WINAPI * ReadClient);  
BOOL (WINAPI * ServerSupportFunction);
} 
 </code></pre>
<h4>Members</h4>
<dl>
<dt>
<b>cbSize </b>(IN)</dt>
<dd>
The size of this structure.</dd>
<dt>
<b>dwVersion </b>(IN)</dt>
<dd>
The version information of this specification. The HIWORD has the major version number and the LOWORD has the minor version number.</dd>
<dt>
<b>connID </b>(IN)</dt>
<dd>
A unique number assigned by the HTTP server which should not be modified.</dd>
<dt>
<b>dwHttpStatusCode</b> (OUT)</dt>
<dd>
The status of the current transaction when the request is completed.</dd>
<dt>
<b>lpszLogData</b> (OUT)</dt>
<dd>
Buffer of size HSE_LOG_BUFFER_LEN. Contains a null-terminated log information string, specific to the ISAPI Extension, of the current transaction. This log information will be entered in the HTTP server log. Maintaining a single log file with both HTTP server and ISAPI extension transactions is very useful for administration purposes.</dd>
<dt>
<b>lpszMethod</b> (IN)</dt>
<dd>
The HTTP method with which the request was made, for example, GET, or POST. This is equivalent to the CGI variable REQUEST_METHOD. </dd>
<dt>
<b>lpszQueryString</b> (IN)</dt>
<dd>
A null-terminated string that contains the query information. This is the part of the URL string that appears after the questions mark (?). This is equivalent to the CGI variable QUERY_STRING.</dd>
<dt>
<b>lpszPathInfo</b> (IN)</dt>
<dd>
A null-terminated string that contains extra path information given by the client. This is the part of the string that appears between the DLL/script name in the URL and the question mark (?). The value is equivalent to the CGI variable PATH_INFO.</dd>
<dt>
<b>lpszPathTranslated</b> (IN)</dt>
<dd>
A null-terminated string that contains the translated path. This is equivalent to the CGI variable PATH_TRANSLATED.</dd>
<dt>
<b>cbTotalBytes</b> (IN)</dt>
<dd>
The total number of bytes to be received from the client. This is equivalent to the CGI variable CONTENT_LENGTH. If this value is 0xffffffff, then there are 4 gigabytes or more of available data. In this case, <b>ReadClient</b> should be called until no more data is returned.</dd>
<dt>
<b>cbAvailable</b> (IN)</dt>
<dd>
The available number of bytes (out of a total of <b>cbTotalBytes</b>) in the buffer pointed to by <b>lpbData</b>. If <b>cbTotalBytes</b> is the same as <b>cbAvailable</b>, the <b>lpbData</b> variable will point to a buffer that contains all the data as sent by the client. Otherwise, <b>cbTotalBytes</b> will contain the total number of bytes of data received. The ISAPI extensions will then need to use the callback function <b>ReadClient</b> to read the rest of the data (beginning from an offset of <b>cbAvailable</b>). With IIS 4.0, you can also use the asynchronous <b>ReadClient </b>facility through <b>ServerSupportFunction </b>with the HSE_REQ_ASYNC_READ_CLIENT value set.</dd>
<dt>
<b>lpbData</b> (IN)</dt>
<dd>
Points to a buffer of size <b>cbAvailable</b> that has the data sent by the client. </dd>
<dt>
<b>lpszContentType</b> (IN)</dt>
<dd>
A null-terminated string containing the content type of the data sent by the client. This is equivalent to the CGI variable CONTENT_TYPE.</dd>
<dt>
<b>GetServerVariable</b></dt>
<dd>
<a href="appref_504l.htm"><b>GetServerVariable</b></a> retrieves information about a connection or about the server itself.</dd>
<dt>
<b>WriteClient</b></dt>
<dd>
<a href="appref_7vjo.htm"><b>WriteClient</b></a> sends the data present in the given buffer to the client that made the request.</dd>
<dt>
<b>ReadClient</b></dt>
<dd>
<a href="appref_235g.htm"><b>ReadClient</b></a> reads data from the body of the client's HTTP request.</dd>
<dt>
<b>ServerSupportFunction</b></dt>
<dd>
<a href="appref_4gtq.htm"><b>ServerSupportFunction</b></a> returns data for several auxiliary functions not covered by other callback functions.
</dd>
</dl>
<h4>Remarks</h4>
<p>
When IIS receives a request for an ISAPI extension, it tries to include the amount of data in the lpbData parameter as is specified in the MD_UPLOAD_READAHEAD_SIZE property of the metabase. The default value for this property is 48K, however, it can be set to any size in the range of 0 bytes to 4GB.</p>
<p>&nbsp;</p></body>
</HTML>
