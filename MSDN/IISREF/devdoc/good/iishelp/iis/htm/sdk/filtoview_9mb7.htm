<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Obtaining Server Variables</title>
<link disabled rel=stylesheet href=../../../../../backsdk3.css>
<style type="text/css">
@import url(../../../../../backsdk4.css);
</style>
</HEAD>
<BODY BGCOLOR = #FFFFFF TEXT = #000000>

<h2><a name="_in_obtaining_server_variables"></a>Obtaining Server Variables</h2>
<p>
Server variables provide information about the HTTP server environment. Frequently an ISAPI filter will need to determine the value of a server variable before it can process event information. The following code would return the value of the SERVER_PORT_SECURE server variable.</p>
<pre><code>DWORD WINAPI 
HttpFilterProc(
  PHTTP_FILTER_CONTEXT pfc, 
  DWORD NotificationType, 
  LPVOID pvNotification
)
{
    HTTP_FILTER_PREPROC_HEADERS *pHeaders = 
    pvNotification;
    char szServerName[1024], szUrl[1024], szSecure[2], 
    szLocationHeader[1034], szRequest[1024];
    DWORD dwBuffSize;
    dwBuffSize = 1024;
    pfc-&gt;GetServerVariable(pfc, "URL", szRequest, &amp;dwBuffSize);
    // Determine if request was sent over secure port
    dwBuffSize = 2;
    pfc-&gt;GetServerVariable(pfc, "SERVER_PORT_SECURE", szSecure,
    &amp;dwBuffSize);
        if (szSecure[0] == '1')    // Request is on a secure port,
        do not process further 
            return SF_STATUS_REQ_NEXT_NOTIFICATION;
            dwBuffSize = 1024;
            pfc-&gt;GetServerVariable(pfc, "SERVER_NAME",
            szServerName, &amp;dwBuffSize);
            // pfc-&gt;GetServerVariable(pfc, "HTTP_HOST",
            szServerName, &amp;dwBuffSize);
            dwBuffSize = 1024;
            pHeaders-&gt;GetHeader(pfc, "url", szUrl, &amp;dwBuffSize);

               wsprintf(szLocationHeader, "Location:
               https://%s%s\r\n\r\n", szServerName, szUrl);
               pfc-&gt;AddResponseHeaders(pfc, szLocationHeader, 0);

               pfc-&gt;ServerSupportFunction(pfc,
               SF_REQ_SEND_RESPONSE_HEADER, "302 Object Moved",
               (DWORD)"Please resubmit the request using a secure
               port.", 0);
    
               return SF_STATUS_REQ_FINISHED;
}</code></pre>
<p>&nbsp;</p></body>
</HTML>
