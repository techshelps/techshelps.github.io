<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text-html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Setting Options</title>
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>	<BODY bgcolor="#FFFFFF" link=#003399 vlink=#996699>

	<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

	<!--TOOLBAR_START-->
	<!--TOOLBAR_EXEMPT-->
	<!--TOOLBAR_END--><h3><a name="jb2setting_options"></a>Setting Options</h3>
<p>
You use the <i>options</i> argument of the <b>CompactDatabase</b> method to specify various operations for Microsoft Jet to perform as part of the compact process. Using the <i>options</i> argument, you can encrypt and decrypt database files, and specify the version of the data format for the compacted database. You cannot use the <b>CompactDatabase</b> method to convert a database to a previous version.</p>
<p>
<b>Caution   </b>Because the <b>CompactDatabase</b> method doesn’t convert Microsoft Access-specific objects such as forms, reports, macros, and modules, you shouldn’t use the <b>CompactDatabase</b> method to convert a database containing such objects. To convert a database containing Microsoft Access objects, open the database in Microsoft Access and use the <b>Convert Database</b> command (<b>Tools</b> menu, <b>Database Utilities</b> submenu).</p>
<p>
The following table lists the constants you can use in the<i> options</i> argument.</p>
<table>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>Constant</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>Description</b></font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>dbEncrypt</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Encrypts the database while compacting.</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>dbDecrypt</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Decrypts the database while compacting.</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>dbVersion10</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Creates a database that uses the Microsoft Jet 1.0 file format while compacting.</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>dbVersion11</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Creates a database that uses the Microsoft Jet 1.1 file format while compacting.</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>dbVersion20</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Creates a database that uses the Microsoft Jet 2.0 file format while compacting.</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>dbVersion30</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Creates a database that uses the Microsoft Jet&nbsp;3.0 file format while compacting. This option also applies to databases created with Microsoft Jet&nbsp;3.5.</font></td>
</tr>
</table><br>
<p>
If you omit an encryption constant or include both <b>dbDecrypt</b> and <b>dbEncrypt</b>, the new database will have the same encryption as the old database.</p>
<p>
<b>See Also   </b>For more information on database encryption and Microsoft Jet security features, see Chapter&nbsp;10, “Managing Security.”</p>
<p>
The following code example uses the <b>CompactDatabase</b> method to compact a database to a temporary file and then renames that temporary file to the original name if the compacting process is successful.</p>
<p>
Note that this code calls the CanOpenDbExclusively function defined in Chapter&nbsp;2, “Introducing Data Access Objects.” This function determines whether the database can be open exclusively for compacting.</p>
<pre><FONT FACE="Courier New" SIZE="3">Function CompactDb(strDbPath As String) As Boolean
&#09;Dim dbs As Database
&#09;Dim intLength As Integer
&#09;Dim varPosition As Variant
&#09;Dim strDbTemp As String, strDbCompacted As String
&#09;Dim strDbBackup As String
&#09;Dim strMsg As String
&#09;Const conPermissionDenied As Integer = 70
&#09;
&#09;On Error GoTo Err_CompactDb
&#09;' Initialize string for message.
&#09;strMsg = &quot;Database &quot; &amp; strDbPath &amp; &quot; cannot be opened exclusively. &quot; _
&#09;&#09;&amp; &quot;The database may have already been opened by you or another user.&quot;

&#09;' Compact the database to a temporary file.
&#09;intLength = Len(strDbPath)
&#09;varPosition = InStr(strDbPath, &quot;.mdb&quot;)
&#09;If varPosition &gt; 0 Then
&#09;&#09;strDbTemp = Left(strDbPath, varPosition - 1)
&#09;&#09;
&#09;&#09;' Create backup file before compacting.
&#09;&#09;strDbBackup = strDbTemp &amp; &quot;.bak&quot;
&#09;&#09;FileCopy strDbPath, strDbBackup
&#09;&#09;
&#09;&#09;' Check whether database can be opened exclusively.
&#09;&#09;' This line calls a function defined in Chapter&nbsp;2.
&#09;&#09;If Not CanOpenDbExclusively(strDbPath) Then
&#09;&#09;&#09;MsgBox strMsg
&#09;&#09;&#09;GoTo Exit_CompactDb
&#09;&#09;End If
&#09;&#09;
&#09;&#09;' Compact to new file.
&#09;&#09;strDbCompacted = strDbTemp &amp; &quot;Compacted.mdb&quot;
&#09;&#09;DBEngine.CompactDatabase strDbPath, strDbCompacted
&#09;&#09;
&#09;&#09;' Delete uncompacted database.
&#09;&#09;Kill strDbPath
&#09;&#09;
&#09;&#09;' Rename compacted database to original name.
&#09;&#09;Name strDbCompacted As strDbPath
&#09;End If
&#09;CompactDb = True
&#09;
Exit_CompactDb:
&#09;On Error Resume Next
&#09;dbs.Close
&#09;Set dbs = Nothing
&#09;Exit Function
&#09;
Err_CompactDb:
&#09;If Err = conPermissionDenied Then
&#09;&#09;MsgBox strMsg
&#09;Else
&#09;&#09;MsgBox &quot;Error &quot; &amp; Err &amp; &quot;: &quot; &amp; vbCrLf &amp; Err.Description
&#09;End If
&#09;CompactDb = False
&#09;Resume Exit_CompactDb
End Function</font></pre>
<p>
<b>Tip   </b>If your hard disk is badly fragmented, it’s a good idea to defragment it using a program such as Microsoft Disk Defragmenter before compacting the database. This allows for the data to be written not only sequentially in the database, but also sequentially on disk should space allow.</p>
</BODY>
</HTML>
