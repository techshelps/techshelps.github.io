<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text-html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Repairing Databases</title>
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>	<BODY bgcolor="#FFFFFF" link=#003399 vlink=#996699>

	<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

	<!--TOOLBAR_START-->
	<!--TOOLBAR_EXEMPT-->
	<!--TOOLBAR_END--><h2><a name="jb2repairing_databases"></a>Repairing Databases</h2>
<p>
Accidents happen. Users reboot workstations, power goes out, and disk drives go bad. If any of these occur while Microsoft Jet is writing data, then Microsoft Jet may mark the database as potentially corrupt.</p>
<p>
When Microsoft Jet begins a write operation, it sets a flag, and resets the flag when the operation is complete. If a write operation is interrupted, the flag remains set. When you try to open that database again, Microsoft Jet determines that the flag is set and reports that the database is corrupt. In most cases, the data in the database is not actually corrupt, but the set flag alerts Microsoft Jet that corruption may have occurred.</p>
<p>
You can use the <b>RepairDatabase</b> method to check for corruption. This method takes an inventory of the objects in the database, checking each one for integrity. If no corruption has occurred, the <b>RepairDatabase</b> method resets the write flag. If corruption has occurred, then Microsoft Jet attempts to repair the database.</p>
<p>
<b>Important   </b>Before using the <b>RepairDatabase</b> method, take the following items into consideration:
<ul>
<li>
Always make a back-up copy of the database.<br><br></li>
<li>
Do not use the <b>RepairDatabase</b> method on a replicated database. If you do, the database is no longer replicable and you will not be able to synchronize it with other replicas in the replica set. If you suspect a replica is corrupted, delete the replica and create a new replica from another replica in the set. The <b>RepairDatabase</b> method modifies certain system tables in the .mdb file. If the database were to remain a member of the replica set after this modification of the system tables, the other replicas in the set would become corrupt. The <b>RepairDatabase</b> method prevents this possibility by stopping the database from being replicable, and thus preventing synchronizations with other replicas.<br><br></li>
<li>
In Microsoft Jet 2.<i>x</i>, it was recommended that you repair a database before compacting it. This is because the <b>RepairDatabase</b> method and the corresponding menu command in that version can recover truncated records of data. However, this is not true for Microsoft Jet&nbsp;3.0 and 3.5 file formats. For this reason, you should only repair a Microsoft Jet&nbsp;3.0 or 3.5 database if an error message indicates that this is necessary.</li>
</ul>
<p>
The syntax for the <b>RepairDatabase</b> method is:</p>
<p>
<b>DBEngine.RepairDatabase</b> <i>databasename</i></p>
<p>
In this syntax, <i>databasename</i> is the path and file name of the database to be repaired.</p>
<p>
The following code attempts to open a database. If the database is marked as corrupt, the procedure calls the <b>RepairDatabase</b> method. In this example, strDbPath is the path to the database.</p>
<pre><FONT FACE="Courier New" SIZE="3">Function RepairAndOpen(strDbPath As String) As Boolean
&#09;Dim dbs As Database
&#09;Const conDatabaseCorrupt As Integer = 3049

&#09;On Error Resume Next
&#09;Set dbs = OpenDatabase(strDbPath)
&#09;If Err.Number &lt;&gt; 0 Then
&#09;&#09;' If it is a corruption error, then attempt to repair.
&#09;&#09;If Err = conDatabaseCorrupt Then
&#09;&#09;&#09;MsgBox &quot;Database is corrupt. Attempting repair...&quot;
&#09;&#09;&#09;DBEngine.RepairDatabase strDbPath
&#09;&#09;&#09;Err.Clear
&#09;&#09;&#09;' Attempt to open database again.
&#09;&#09;&#09;Set dbs = OpenDatabase(strDbPath)
&#09;&#09;&#09;' Check whether another error occurred.
&#09;&#09;&#09;If Err.Number &lt;&gt; 0 Then
&#09;&#09;&#09;&#09;MsgBox &quot;Database cannot be opened.&quot; &amp; vbCrLf _
&#09;&#09;&#09;&#09;&#09;&amp; Err.Number &amp; &quot;: &quot; &amp; Err.Description
&#09;&#09;&#09;&#09;RepairAndOpen = False
&#09;&#09;&#09;&#09;Exit Function
&#09;&#09;&#09;End If
&#09;&#09;Else
&#09;&#09;&#09;MsgBox &quot;Database cannot be opened.&quot; &amp; vbCrLf _
&#09;&#09;&#09;&#09;&amp; Err.Number &amp; &quot;: &quot; &amp; Err.Description
&#09;&#09;&#09;RepairAndOpen = False
&#09;&#09;&#09;Exit Function
&#09;&#09;End If
&#09;End If
&#09;&#09;
&#09;dbs.Close
&#09;Set dbs = Nothing
&#09;RepairAndOpen = True&#09;Err
End Function</font></pre>
<p>
<b>Note   </b>In Microsoft Jet&nbsp;3.0, using the <b>RepairDatabase</b> method or command before compacting the database could result in a database that could no longer be opened. This problem, which happens only rarely due to duplicate indexes on a database’s system tables, has been resolved in Microsoft Jet&nbsp;3.5. An updated release of Microsoft Jet&nbsp;3.0 that corrects this problem is available on http://www.microsoft.com/kb/articles/q151/1/86.htm for users of Microsoft Access&nbsp;95 and other programs that use Microsoft Jet&nbsp;3.0.</p>
</BODY>
</HTML>
