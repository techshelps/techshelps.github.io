<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text-html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>The Connection Object and the Connections Collection</title>
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>	<BODY bgcolor="#FFFFFF" link=#003399 vlink=#996699>

	<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

	<!--TOOLBAR_START-->
	<!--TOOLBAR_EXEMPT-->
	<!--TOOLBAR_END--><h3><a name="jb2the_connection_object_and_the_connections_collection"></a>The Connection Object and the Connections Collection</h3>
<p>
After you’ve created an ODBCDirect workspace, you can connect to an ODBC data source. To connect to an ODBC data source, you can use the <b>OpenConnection</b> method to open a new <b>Connection</b> object, or you can use the <b>OpenDatabase</b> method to open a new <b>Database</b> object. This section explains how to use the <b>Connection</b> object. For information on how to use a <b>Database</b> object, see the following section, “The Database Object and the Databases Collection.”</p>
<p>
A <b>Connection</b> object represents a connection to an ODBC database in an ODBCDirect workspace. The <b>Connections</b> collection contains all currently open <b>Connection</b> objects. When you open a <b>Connection</b> object, it is automatically appended to the <b>Connections</b> collection of the <b>Workspace</b> object. When you close a <b>Connection</b> object with the <b>Close</b> method, it is removed from the <b>Connections</b> collection.</p>
<p>
<b>Note   </b>Before you close a <b>Connection</b> object, close all open <b>Recordset</b> objects within it.</p>
<p>
When you open a <b>Connection</b> object, a corresponding <b>Database</b> object is also created and appended to the <b>Databases</b> collection in the same workspace. This allows you to use the features of both the <b>Connection</b> and <b>Database</b> objects. For information on how to use the <b>Database</b> object from an ODBCDirect workspace and how to switch between <b>Connection</b> and <b>Database</b> objects, see the following section “The Database Object and the Databases Collection.”</p>
<p>
The <b>Connection</b> object provides the following advantages for accessing ODBC data:
<ul>
<li>
<b>Asynchronous Connection   </b>Your application can connect to an ODBC data source asynchronously. Rather than pausing execution while the connection is established, your code can continue to perform other operations, and can later check to determine whether the connection was made successfully.<br><br></li>
<li>
<b>Asynchronous Queries   </b>Your application can run queries against your ODBC data source asynchronously. Rather than pausing execution while a long query runs, your code can perform other tasks, and then check later to determine whether the query has run successfully.<br><br></li>
<li>
<b>QueryDef Objects   </b>You can define <b>QueryDef</b> objects that represent queries in the ODBC data source.</li>
</ul>
<p>
Use the <b>OpenConnection</b> method to create a <b>Connection</b> object. The syntax of the <b>OpenConnection</b> method is:</p>
<p>
<b>Set</b> <i>connection</i> <b>=</b> <i>workspace</i>.<b>OpenConnection</b> <b>(</b><i>name</i>, <i>options</i>, <i>readonly</i>, <i>connect</i><b>)</b></p>
<p>
The <i>connection</i> argument is the name of the new <b>Connection</b> object. The <i>workspace</i> argument is the name of an ODBCDirect <b>Workspace</b> object from which you’re creating the new <b>Connection</b> object.</p>
<p>
The <i>name</i> argument indicates the name of the registered data source. You can reference the new <b>Connection</b> object by using either the data source name (DSN) or the <b>Connection</b> object’s ordinal position within its collection. The <i>options</i> argument determines if and when to prompt the user to establish the connection, and whether or not to open the connection asynchronously. The <i>readonly</i> argument controls the updatability of the data accessed through the connection. Set this argument to <b>True</b> to prevent updates; set it to <b>False</b> to allow updates.</p>
<p>
The <i>connect</i> argument is a valid connection string that supplies parameters to the ODBC Driver Manager. These parameters can include user name, password, default database, and DSN, which overrides the value provided in the <i>name</i> argument.</p>
<p>
The connection string must start with <code>&quot;ODBC;&quot;</code>, and must contain a series of values needed by the driver to access the data. The actual connection string can vary depending on the data source you’re trying to access; different ODBC data sources require different parameters in the <i>connect</i> argument. Usually, the minimum requirement is a user ID, a password, and a DSN, as shown in the following example:</p>
<pre><FONT FACE="Courier New" SIZE="3">ODBC;UID=JamesK;PWD=OpenSesame;DSN=MasterData</font></pre>
<p>
When the ODBC driver processes the connection string and one or more of the parameters required by the data source is missing, the driver displays a dialog box that asks for the information. If you don’t want this dialog box displayed, you must make sure that the connection string has all the required information.</p>
<p>
<b>Note   </b>If you are trying to connect to a Microsoft SQL Server database that uses integrated security, omit the user ID (<code>UID</code>) and password (<code>PWD</code>) values because your Windows&nbsp;NT user name and password are automatically used. For example, the connection string may look something like the following:</p>
<pre><FONT FACE="Courier New" SIZE="3">ODBC;UID=;PWD=;DATABASE=Pubs;DSN=Pubs</font></pre>
<p>
<b>See Also   </b>For more information about formatting connection strings, see Chapter&nbsp;8, “<a href="c8_body.htm">Accessing External Data</a>.”</p>
<p>
The following example illustrates how to use the <b>OpenConnection</b> method to open a new <b>Connection</b> object.</p>
<pre><FONT FACE="Courier New" SIZE="3">Function OpenPubsConnection() As Boolean
&#09;Dim wrk As Workspace, cnn As Connection, rst As Recordset, fld As Field
&#09;Dim strConnect As String, strSQL As String

&#09;On Error GoTo Err_OpenPubsConnection
&#09;' Create connect string.
&#09;strConnect = &quot;ODBC;DSN=Pubs;UID=SA;PWD=;DATABASE=Pubs&quot;
&#09;' Create SQL string.
&#09;strSQL = &quot;SELECT * FROM Authors WHERE State = 'CA';&quot;

&#09;' Create ODBCDirect workspace.
&#09;Set wrk = DBEngine.CreateWorkspace(&quot;NewODBCDirect&quot;, &quot;Admin&quot;, &quot;&quot;, dbUseODBC)
&#09;' Open connection.
&#09;Set cnn = wrk.OpenConnection(&quot;Pubs&quot;, dbDriverNoPrompt, False, strConnect)
&#09;' Open recordset on connection.
&#09;Set rst = cnn.OpenRecordset(strSQL, dbOpenDynaset)
&#09;' Print values in recordset.
&#09;Do Until rst.EOF
&#09;&#09;For Each fld In rst.Fields
&#09;&#09;&#09;Debug.Print fld.Name, fld.Value
&#09;&#09;Next fld
&#09;&#09;Debug.Print
&#09;&#09;rst.MoveNext
&#09;Loop
&#09;OpenPubsConnection = True

Exit_OpenPubsConnection:
&#09;On Error Resume Next
&#09;rst.Close
&#09;cnn.Close
&#09;Exit Function

Err_OpenPubsConnection:
&#09;VerboseErrorHandler
&#09;OpenPubsConnection = False
&#09;Resume Exit_OpenPubsConnection
End Function</font></pre>
<p>
After you’ve created a <b>Connection</b> object, you can open <b>Recordset</b> objects and run queries using the <b>Connection</b> object.</p>
<p>
<b>Note   </b>Most servers don’t support string expressions surrounded by double quotation marks (&quot;) in SQL statements such as:</p>
<pre><FONT FACE="Courier New" SIZE="3">SELECT * FROM Authors WHERE State = &quot;CA&quot;</font></pre>
<p>
When using a Microsoft Jet workspace, Microsoft Jet translates double quotation marks into single quotation marks (') before sending the statement to the server. However, when using an ODBCDirect workspace, no translation is performed and an error will occur. When writing SQL statements to be executed using an ODBCDirect connection, make sure to use single quotation marks around strings in SQL statements as shown in the following example:</p>
<pre><FONT FACE="Courier New" SIZE="3">SELECT * FROM Authors WHERE State = 'CA'</font></pre>
</BODY>
</HTML>
