<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text-html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Crosstab Queries</title>
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>	<BODY bgcolor="#FFFFFF" link=#003399 vlink=#996699>

	<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

	<!--TOOLBAR_START-->
	<!--TOOLBAR_EXEMPT-->
	<!--TOOLBAR_END--><h4><a name="jb2crosstab_queries"></a>Crosstab Queries</h4>
<p>
A crosstab query summarizes tabular data and places it into a columnar format. In a crosstab query, matching values can be counted, summed, averaged, compared to other values, and so on.</p>
<p>
Suppose you want to know the average salary paid for various employee classifications in different countries. One way to do this is to create a standard SELECT query that uses the GROUP BY clause for the Country and Title fields, and averages the values in the Salary field:</p>
<pre><FONT FACE="Courier New" SIZE="3">SELECT 
&#09;Employees.Country, 
&#09;Employees.Title, 
&#09;Avg(Employees.Salary) AS AvgOfSalary
FROM Employees
GROUP BY Employees.Country, Employees.Title;</font></pre>
<p>
This query results in the following table.</p>
<table>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>Country</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>Title</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>AvgOfSalary</b></font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
UK</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Sales Manager</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$59,600.00</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
UK</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Sales Representative</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$47,500.00</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
USA</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Inside Sales Coordinator</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$39,000.00</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
USA</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Sales Representative</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$48,960.00</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
USA</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Vice President, Sales</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$85,000.00</font></td>
</tr>
</table><br>
<p>
It’s difficult, however, to make certain kinds of comparisons. The Country field information is repeated for each row, and in order to compare the average salary for various titles across countries, you must match numbers that are physically distant from one another on the page. You may easily overlook the fact that no sales manager is listed for the United States.</p>
<p>
A crosstab query solves this problem by organizing the data so that the summarized information is placed in contiguous columns across the page. The following crosstab query produces the same information as the first query, but in a much more readable format:</p>
<pre><FONT FACE="Courier New" SIZE="3">TRANSFORM Avg(Employees.Salary) AS AvgOfSalary
SELECT Employees.Title
FROM Employees
GROUP BY Employees.Title
PIVOT Employees.Country;</font></pre>
<p>
The contents of the Country field become column headings. The Title field (specified in the SELECT clause) becomes the row heading and the values are the average of the Salary field.</p>
<table>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>Title</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>UK</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>USA</b></font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Inside Sales Coordinator</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$39,000.00</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Sales Manager</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$59,600.00</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Sales Representative</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$47,500.00</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$48,960.00</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Vice President, Sales</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$85,000.00</font></td>
</tr>
</table><br>
<p>
To support crosstab operations, Microsoft Jet includes these two extensions to the standard SQL language:
<ul>
<li>
The TRANSFORM statement. Specifies that the query is a crosstab query. The first statement following the TRANSFORM statement must be an aggregate function, such as <b>Avg</b>, <b>Sum</b>, <b>Min</b>, <b>Max</b>, or <b>Count</b>, which summarizes the selected data.<br><br></li>
<li>
The PIVOT clause. Specifies the field or expression used to create the column headings in the query’s result set.</li>
</ul>
<p>
By default, Microsoft Jet presents the summarized columns in alphabetical order from left to right. Missing values are returned as <b>Null</b>. In the previous example, because no sales managers exist in the United States, there is no salary to average. The value in the USA column for Sales Manager is <b>Null</b>.</p>
<p>
Column headings are based on the actual values contained in the field specified by the PIVOT clause. If values are missing, no column is created. For example, if your company has offices in Germany, but no employees were selected whose country is Germany, no column would be created for Germany.</p>
<p>
You can force Microsoft Jet to create columns in an order other than alphabetical and force the creation of columns even if there is no data for that column value by using the optional IN clause with the PIVOT clause. The previous crosstab query can be revised as follows:</p>
<pre><FONT FACE="Courier New" SIZE="3">TRANSFORM Avg(Employees.Salary) AS AvgOfSalary 
SELECT Employees.Title 
FROM Employees 
GROUP BY Employees.Title 
PIVOT Employees.Country IN ('UK','Germany','France','USA');</font></pre>
<p>
This query results in the following table.</p>
<table>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>Title</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>UK</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>Germany</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>France</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>USA</b></font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Inside Sales Coordinator</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$39,000.00</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Sales Manager</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$59,600.00</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Sales Representative</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$47,500.00</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$48,960.00</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Vice President, Sales</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$85,000.00</font></td>
</tr>
</table><br>
<p>
The target of the SELECT statement used to create the column headings can be an expression as well as an actual field name. A common use of this feature is to create groupings that don’t exist in the data. For example, you can group all orders into month groupings in the following manner:</p>
<pre><FONT FACE="Courier New" SIZE="3">TRANSFORM Count(*) 
SELECT Orders.EmployeeID
FROM Orders
GROUP BY Orders.EmployeeID
PIVOT Format(OrderDate,'mmm');</font></pre>
<p>
The following table illustrates a portion of the columns and rows returned by this query.</p>
<table>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>Employee</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>Apr</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>Aug</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>Dec</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>Feb</b></font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Davolio, Nancy</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
  9</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
8</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
17</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
12</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Fuller, Andrew</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
19</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
4</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
12</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
  5</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Leverling, Janet</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
13</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
6</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
13</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
14</font></td>
</tr>
</table><br>
<p>
The column headings in this query are created with the <b>Format</b> function, which turns the value of the OrderDate field into a three-letter month abbreviation. All orders within a given month (even if they were placed in different years) are summarized together.</p>
<p>
Because the IN clause wasn’t used with the PIVOT clause, the months are displayed alphabetically. A more complete query, which combines a WHERE clause to limit the selection to orders within a given year and displays the columns in calendar order, is as follows:</p>
<pre><FONT FACE="Courier New" SIZE="3">TRANSFORM Count(*) 
SELECT Orders.EmployeeID 
FROM Orders 
WHERE Orders.OrderDate Between #1/1/96# And #12/31/96# 
GROUP BY Orders.EmployeeID 
PIVOT Format(OrderDate,'mmm') IN ('Jan','Feb','Mar','Apr',
&#09;'May','Jun','Jul','Aug','Sep','Oct','Nov','Dec');</font></pre>
<p>
The following table shows a portion of the result from this query.</p>
<table>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>Employee</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>Jan</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>Feb</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>Mar</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>Apr</b></font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Davolio, Nancy</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
1</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
2</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
5</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
3</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Fuller, Andrew</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
3</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
2</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
3</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
3</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Leverling, Janet</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
9</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
7</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
5</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
3</font></td>
</tr>
</table><br>
</BODY>
</HTML>
