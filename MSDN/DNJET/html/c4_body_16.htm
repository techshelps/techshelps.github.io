<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text-html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><title>Joining Tables and Queries</title>
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>	<BODY bgcolor="#FFFFFF" link=#003399 vlink=#996699>

	<FONT FACE="Verdana, Arial, Helvetica" SIZE="2">

	<!--TOOLBAR_START-->
	<!--TOOLBAR_EXEMPT-->
	<!--TOOLBAR_END--><h4><a name="jb2joining_tables_and_queries"></a>Joining Tables and Queries</h4>
<p>
In addition to joins based on permanent tables, Microsoft Jet supports joins between tables and saved queries, or even between two queries. Queries can be based on other queries, which can further be based on other queries, and so on. Microsoft Jet automatically resolves all references to queries and tables.</p>
<p>
Microsoft Jet <b>QueryDef</b> objects can be treated, for the most part, as if they were tables in the database. A <b>QueryDef</b> object performs the function of a view in SQL. <b>QueryDef</b> and <b>TableDef</b> objects occupy the same “name space” within a Microsoft Jet database. This means that you can’t have a <b>TableDef</b> object and a <b>QueryDef</b> object with the same name, for example. Generally, wherever you can use a base table, you can use a query based on that table instead.</p>
<p>
Suppose you want to find the percentage of your total sales of certain products that were generated by particular customers. One way to do this is to create the four queries shown in this section. The first query totals orders by customer and product:</p>
<pre><FONT FACE="Courier New" SIZE="3">SELECT 
&#09;Orders.CustomerID, 
&#09;[Order Details].ProductID, 
&#09;Sum((UnitPrice*Quantity) - (Discount*(UnitPrice*Quantity))) AS ExtPrice 
FROM Orders 
INNER JOIN [Order Details] 
ON Orders.OrderID = [Order Details].OrderID 
GROUP BY Orders.CustomerID, [Order Details].ProductID;</font></pre>
<p>
Save this query as a permanent <b>QueryDef</b> object in the database with the name SelectCustomersOrdersTotals. You can now treat this query as if it were a table. The sample output it produces may be:</p>
<table>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>Customer</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>Product</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>ExtPrice</b></font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
ALFKI</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Aniseed Syrup</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$  60.00</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
ALFKI</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Grandma’s Boysenberry Spread</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$399.95</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
ALFKI</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Rössle Sauerkraut</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$774.95</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
ALFKI</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Chartreuse verte</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$377.75</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
ALFKI</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Spegesild</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$  23.75</font></td>
</tr>
</table><br>
<p>
Now you have to find the order totals for each ProductID value. Create a permanent <b>QueryDef</b> object called SelectOrdersTotals with the following SQL statement:</p>
<pre><FONT FACE="Courier New" SIZE="3">SELECT 
&#09;[Order Details].ProductID, 
&#09;Sum((UnitPrice*Quantity) - Discount) AS ExtPrice 
FROM Orders 
INNER JOIN [Order Details] 
ON Orders.OrderID = [Order Details].OrderID 
GROUP BY [Order Details].ProductID;</font></pre>
<p>
Part&nbsp;of the output produced by this query may be:</p>
<table>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>Product</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>ExtPrice</b></font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Chai</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$14,274.65</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Chang</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$18,554.70</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Aniseed Syrup</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$  3,079.80</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Chef Anton’s Cajun Seasoning</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$  9,423.30</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Chef Anton’s Gumbo Mix</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$  5,800.40</font></td>
</tr>
</table><br>
<p>
Now you can create a third <b>QueryDef</b> object called SelectPercentOfTotal, which joins SelectOrdersTotals with SelectCustomersOrdersTotals:</p>
<pre><FONT FACE="Courier New" SIZE="3">SELECT 
&#09;SelectCustomersOrdersTotals.CustomerID, 
&#09;SelectCustomersOrdersTotals.ProductID, 
&#09;SelectCustomersOrdersTotals.ExtPrice AS CustTotal, 
&#09;SelectOrdersTotals.ExtPrice AS ProdTotal, 
&#09;Format(CustTotal/ProdTotal, '#.###') AS PercentOfTot 
FROM SelectOrdersTotals 
INNER JOIN SelectCustomersOrdersTotals 
ON SelectOrdersTotals.ProductID = SelectCustomersOrdersTotals.ProductID;</font></pre>
<p>
Part&nbsp;of the output from this query may be:</p>
<table>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>Customer</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>Product</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>CustTotal</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>ProdTotal</b></font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>PercentOfTot</b></font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Alfreds Futterkiste</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Aniseed Syrup</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$  60.00</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$  3,079.80</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
.019</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Alfreds Futterkiste</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Grandma’s Boysenberry Spread</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$399.95</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$  7,344.63</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
.054</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Alfreds Futterkiste</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Rössle Sauerkraut</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$774.95</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$26,864.35</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
.029</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Alfreds Futterkiste</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Chartreuse verte</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$377.75</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$13,148.80</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
.029</font></td>
</tr>
<tr valign=top>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Alfreds Futterkiste</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
Spegesild</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$  23.75</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
$  6,142.28</font></td>
<td><FONT FACE="Verdana, Arial, Helvetica" SIZE="2">
.004</font></td>
</tr>
</table><br>
<p>
Finally, you can join this third <b>QueryDef</b> object back to the Customers and Products tables to pick up the CompanyName and ProductName fields:</p>
<pre><FONT FACE="Courier New" SIZE="3">SELECT 
&#09;SelectPercentOfTotal.*, 
&#09;Products.ProductName, 
&#09;Customers.CompanyName 
FROM (SelectPercentOfTotal 
&#09;INNER JOIN Customers 
&#09;ON SelectPercentOfTotal.CustomerID = Customers.CustomerID) 
INNER JOIN Products 
ON SelectPercentOfTotal.ProductID = Products.ProductID;</font></pre>
</BODY>
</HTML>
