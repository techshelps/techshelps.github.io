<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>Chapter 5.&nbsp; Implementing QoS</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch04lev1sec7.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch05lev1sec1.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><TR><TD valign="top"><a name="ch05"></a>
<H2 class="docChapterTitle">Chapter 5. Implementing QoS</h2>
<p class="docText"><a name="iddle1751"></a>The rapid adoption of IP communications and the deployment of more complex and bandwidth-demanding applications led to a tremendous increase in network use. In a network with limitless resources, this would not be an issue. Although the technology is available to throw bandwidth and more powerful switching nodes at the problem, that is not always the best solution. A TCP session, for example, tries to use as much bandwidth as is available, to the detriment of other IP flows using the same links. Regardless of bandwidth, links can become congested due to various factors such as backing up failed paths in the network or handling the unpredictable traffic resulting from a security attack. At the same time, upgrading links and network nodes to handle higher bandwidths usually is an expensive proposition. Companies will try to make the most of the existent infrastructure and increase their return on investments (ROI). Concerted proactive measures can limit the probability that congestion will occur, but ultimately, traffic congestion is a fact of life in any network. Under such circumstances, the network operator must decide how to manage it and how to allocate the network resources based on traffic types. Congestion-management mechanisms should be considered regardless of the bandwidth available.</p>
<p class="docText">Networks provide a service to applications by transporting their data. Different application types have different expectations from this service; they demand a certain quality of service (QoS). These expectations are for the entire path of the traffic, making QoS an end-to-end concept. Applications such as interactive voice communications, audio, and video are sensitive to delay and delay variations (jitter), but they can afford to lose randomly a small percentage of the traffic. At the other end of the spectrum are the mission-critical applications that need reliable, no-loss data transfers.</p>
<p class="docText">The service level needs of any type of traffic can generally be quantified through a set of parameters such as the following:</p>
<ul><li><p class="docList">Service availability, which represents the percentage of uptime for the service</p></li><li><p class="docList">Packet delivery ratio</p></li><li><p class="docList">Round-trip time</P></li><li><p class="docList">Jitter, which measures delay variations</P></LI></ul>
<p class="docText">For any given service, the target values for such parameters are listed in a service level agreement (SLA). The SLA can represent the internal network performance goals of an enterprise. It can also represent a contractual agreement between a service provider and its customers.</p>
<p class="docText"><a name="iddle1182"></a><a name="iddle1188"></a><a name="iddle1189"></a><a name="iddle1271"></a><a name="iddle1427"></a><a name="iddle1442"></a><a name="iddle1497"></a><a name="iddle1718"></a><a name="iddle1925"></a><a name="iddle1966"></a>To meet the requirements of SLAs, the network has to be able to identify different types of traffic, to reserve bandwidth, to improve the loss characteristics, to avoid and manage congestion, and to prioritize the traffic. These functions are performed by routers and switches across the entire network in the context of an end-to-end QoS deployment model. Two such models are identified in the case of IPv4:</p>
<ul><LI><p class="docText"><span class="docEmphStrong">Integrated services (IntServ) (RFC1633)</span> Rely on a signaling mechanism to reserve the necessary resource prior to forwarding the traffic across the network. This approach simulates the operational concepts of a circuit switched environment.</p></li><li><p class="docText"><span class="docEmphStrong">Differentiated services (DiffServ) (RFC 2475)</span> Rely on policies that are defined on the network nodes and on packets being matched against and switched based on these policies.</p></LI></UL>
<p class="docText">Network elements leverage several mechanisms that enable them to support the implementation of these IP QoS models, as follows:</P>
<ul><li><p class="docText"><span class="docEmphStrong">Classification and marking</span> Classification is used to separate packets based on certain characteristics such as Source or Destination Address, predefined patterns of the 8 bits in the Type of Service (ToS) IP header field (IP precedence or differentiated services code point, DSCP) and higher-layer protocol information. The ToS field of a packet header can be overwritten by routers with a value relevant to the QoS policies defined in that network. This action on a packet is called <span class="docEmphasis">marking</span>.</p></li><li><p class="docText"><span class="docEmphStrong">Traffic conditioning (policing and shaping)</span> The policing function enables the router to force inbound and outbound traffic to stay within a defined profile. Any traffic that does not observe the constraints of the profile is dropped. Through shaping, the router avoids downstream congestion by buffering traffic that does not fit a defined profile.</p></li><li><p class="docText"><span class="docEmphStrong">Congestion avoidance</span> A mechanism that routers can implement to detect the possible buildup of congestion by monitoring the use of output buffers. If the buffers are getting full, the low-priority packets are dropped to save resources for the high-priority ones.</p></li><li><p class="docText"><span class="docEmphStrong">Congestion management</span> The way the router handles an overflow of traffic. This functionality is implemented through various queuing algorithms.</p></li></ul>
<p class="docText"><a class="docLink" href="#ch05fig01">Figure 5-1</a> schematically captures these mechanisms as they operate within a router.</P>
<a name="ch05fig01"></a><P><center>
<H5 class="docFigureTitle">Figure 5-1. QoS Mechanisms in a Router</H5>
<p class="docText"><div class="v1"><a target="_self" href="images/05fig01_alt.jpg">[View full size image]</a></div><img border="0" alt="" id="158039035251" width="500" height="261" SRC="images/05fig01.jpg"></P>
</center></p><br>
<p class="docText">These mechanisms are implemented the same way in both versions of IP. A number of books focus specifically on this topic, such as <span class="docEmphasis">IP Quality of Service</span>, by Srinivas Vegesna. <a class="docLink" href="#ch05table01">Table 5-1</a> lists the QoS features supported by Cisco platforms both IPv4 and IPv6 along with layer 2 QoS features.</p>
<a name="ch05table01"></a><p><table cellspacing="0" class="allBorders" border="1" RULES="all" cellpadding="4"><caption><h5 class="docTableTitle">Table 5-1. QoS Mechanisms and Their Implementation in Cisco Devices</h5></caption><colgroup><col width="150"><col width="200"><col width="75"><col width="75"></colgroup><thead><tr><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">QoS Mechanism</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Implementation Notes</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">IPv4</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">IPv6</p></th></tr></thead><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Classification</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Precedence</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></td></tr><TR><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><td class="docTableCell" align="left" valign="top"><p class="docText">DSCP</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></td></tr><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText">Network-based application recognition (NBAR)</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">X</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">N/A</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Marking</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Class-based marking (CBM)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</P></TD></tr><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><TD class="docTableCell" align="left" valign="top"><p class="docText">Committed access rate (CAR)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</TD></tr><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText">Policy-based routing (PBR)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText">Policing and shaping</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Rate limiting</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></td></tr><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><TD class="docTableCell" align="left" valign="top"><p class="docText">Class-based policing (CBP)</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">X</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></td></TR><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText">Generic traffic shaping (GTS)</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">X</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">N/A</p></td></tr><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText">Frame Relay traffic shaping (FRTS)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">X</P></TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Congestion avoidance</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Weighted random early detection (WRED)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></TD></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText">Congestion management (queuing)</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">First in, first out (FIFO)</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">X</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></TD></TR><TR><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText"><a name="iddle1762"></a>Priority queuing (PQ)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">N/A</p></td></tr><tr><td class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Custom queuing (CQ)</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">X</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">N/A</p></td></tr><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText">Flow-based weighted fair queue (FBWFQ)</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">X</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">X</P></td></tr><tr><td class="docTableCell" align="left" valign="top">&nbsp;</TD><td class="docTableCell" align="left" valign="top"><p class="docText">Class-based weighted fair queue (CBWFQ)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">X</p></td></tr><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText">Low-latency queue (LLQ)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></TD></TR><TR><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><td class="docTableCell" align="left" valign="top"><p class="docText">Modified Deficit Round Robin (MDRR)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Layer 2 QoS</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">ATM</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</P></td></tr><tr><td class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Frame Relay</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></td></tr><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText">Ethernet 802.1p (CoS)</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">X</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">X</P></td></tr><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText">Cable (DOCSIS)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">N/A</P></td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText">Link-efficiency mechanisms</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Compressed Real Time Protocol (cRTP)</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">N/A</P></TD></TR><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText">Link fragmentation and interleaving (LFI)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">X</p></td></tr></table></p><BR>
<p class="docText"><a class="docLink" href="#ch05table01">Table 5-1</a> shows that in Cisco products only a limited number of IPv4 QoS features are not available for IPv6 at the time of this writing.</P>
<p class="docText">Because of the many similarities between IPv4 and IPv6 QoS, this chapter focuses on the few things that differentiate them today. This chapter covers the following topics:</P>
<UL><LI><p class="docList">A review of differences between IPv6 and IPv4 QoS</p></li><li><p class="docList">A discussion on the implementation of QoS for IPv6 over MPLS deployments</p></li><li><p class="docList">Examples of configuring IPv6 QoS in a native environment and in an MPLS-based environment</p></li><li><p class="docList">IPv6 QoS deployment considerations</p></li></ul>
<p class="docText">It is assumed that the reader is familiar with fundamental concepts of IPv4 QoS. You can apply this knowledge directly toward deploying IPv6 QoS.</P>

</TD></TR></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch04lev1sec7.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch05lev1sec1.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
</body></html>