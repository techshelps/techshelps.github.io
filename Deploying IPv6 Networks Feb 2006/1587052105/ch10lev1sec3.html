<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>Retrieving Information from Routers and Switches</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch10lev1sec2.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch10lev1sec4.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><TD valign="top"><a name="ch10lev1sec3"></a>
<h3 class="docSection1Title">Retrieving Information from Routers and Switches</H3>
<p class="docText">You can retrieve information from IPv6 devices in many ways, and they are the same as for IPv4:</P>
<ul><LI><p class="docList">SNMP and MIBs</p></li><LI><p class="docList">NetFlow or IPfix</P></LI><li><p class="docList">Connection to the device and execution of locally available commands</p></li><LI><p class="docList">Specific applications can provide additional information: ping, traceroute, and so on.</p></li></UL>
<a name="ch10lev2sec3"></a>
<H4 class="docSection2Title">SNMP and MIBs</h4>
<p class="docText">The Simple Network Management Protocol (SNMP) is a request-reply-based protocol running over UDP (ports 161 and 162), although TCP operation is also possible. SNMP is used by the NMS to access or modify data in the managed devices via objects called Management Information Bases (MIBs). A MIB is a hierarchy of information that describes an SNMP-manageable object. Each object is associated with a unique object identifier descriptor (OID). The MIB is organized as a tree; the leafs are the object instances representing a resource (interface address, interface name, event, and so on). MIBs are either standard (described in RFCs) or enterprise specific. Given the relatively slow progress of IPv6 MIB definitions, a large number of enterprise-specific MIBs have been published, including several Cisco ones.</p>
<p class="docText">SNMP is an asymmetric protocol, operating between a management station and an agent, the device being managed. Typically, the agent is a router or a switch that implements a few simple packet types and a generic get-or-set function on its MIB variables. The management station provides the user interface. Simple management stations can be built with UNIX command-line utilities. More complex (and expensive) ones collect MIB data over time and use graphical user interfaces (GUIs) to draw network maps.</p>
<p class="docText">An SNMP operation takes the form of a protocol data unit (PDU). Version 1 SNMP supports five possible PDUs:</p>
<UL><li><p class="docList"><span class="docEmphStrong">GetRequest/SetRequest</span> supplies a list of objects and, possibly, values they are to be set to.</p></LI><li><p class="docList"><span class="docEmphStrong">GetResponse</span> informs the management station of the results of a GetRequest or SetRequest.</P></li><li><p class="docList"><span class="docEmphStrong">GetNextRequest</span> is used to perform table transversal.</p></li><li><p class="docList"><span class="docEmphStrong">Trap</span> is the only PDU sent by an agent on its own initiative. It is used to notify the management station of an unusual event.</p></li></ul>
<p class="docText">SNMP version 2 (SNMPv2) is an evolution of the SNMPv1. SNMPv2 introduces two new operations: GetBulk and Inform. The GetBulk operation is used to retrieve large blocks of data. The Inform operation allows two SNMP entities to exchange acknowledged information. SNMP version 3 (SNMPv3) adds security and remote-configuration capabilities.</p>
<p class="docText">There are two distinct aspects for supporting IPv6 SNMP: the transport of SNMP protocol over IPv6 and the IPv6 MIBs support.</p>
<a name="ch10lev3sec1"></a>
<h5 class="docSection3Title">SNMP over IPv6</h5>
<p class="docText">Because SNMP runs over UDP, an SNMP over IPv6 implementation is mostly about UDP over IPv6 support (and in the router case, some configuration tweaks).</p>
<p class="docText">Cisco routers now support SNMP over IPv6. For SNMP GetRequest and SetRequest, which are initiated by the NMS, the router simply responds with the same transport protocol (UDP over IPv6, for instance) used by the incoming request. When sending an SNMP trap, the router needs to be configured with an IPv6 destination, as illustrated in the <a class="docLink" href="#ch10ex01">Example 10-1</a>.</p>
<a name="ch10ex01"></a><h5 class="docExampleTitle">Example 10-1. SNMP Configuration Example</H5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>snmp-server community public RO
snmp-server enable traps syslog
snmp-server enable traps mpls ldp
snmp-server enable traps mpls traffic-eng
snmp-server enable traps mpls vpn
<span class="docEmphMark">snmp-server host 2001:400::1 version 2c public</span></pre><BR>

</td></TR></table></P>
<p class="docText">On the NMS side, most SNMP application programming interfaces (APIs) support SNMP over IPv6:</p>
<UL><li><p class="docList">Sun's Java J2SDK/JRE 1.4</p></LI><LI><p class="docList">FreeBSD</P></li><li><p class="docList">Linux</p></LI><li><p class="docList">Windows</p></LI></UL>
<a name="ch10note02"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">Running SNMP over IPv6 is required only for IPv6-only devices. In the most common case, IPv6-managed devices are dual stack, and need to report management data for both IPv4 and IPv6. Historically, these devices have been configured for IPv4 first and have IPv4 connectivity to the NMS: Enabling of IPv6 can and should be done without disturbing the existing NMS/device transport and configuration. Because the transport (UDP) and the content (MIBs) are independent of each other, you can keep the IPv4 transport to carry SNMP IPv6 data.</p>
</div><br>

<a name="ch10lev3sec2"></a>
<h5 class="docSection3Title">IPv6 MIBs</H5>
<p class="docText">More than 100 MIBs are available to check for IPv6 support, and they can be classified as follows:</p>
<ul><LI><p class="docList">MIBs that do not have any address dependencies</p></LI><li><p class="docList">MIBs where ipAddress should just be replaced by inetAddress</p></li><li><p class="docList">MIBs that require major redesign to handle both IPv4 and IPv6 protocols</p></li><li><p class="docList">MIBs that require a specific IPv6 version</p></li></ul>
<p class="docText">RFC 3796 provides a survey of IPv4 address usage in existing IETF documents, including many MIBs.</p>
<p class="docText">Current IETF work is putting emphasis on MIB-2 MIBs (basic MIBs such as IP, UDP, TCP, ICMP) to support IPv6. Unfortunately, that work has been going on for quite a long time, because the initial approach of creating separate MIBs for IPv6 (with an ipv6Address) has evolved toward creating unified MIBs that cover both IPv4 and IPv6. <a class="docLink" href="#ch10fig02">Figure 10-2</a> illustrates that evolution.</p>
<a name="ch10fig02"></a><p><center>
<h5 class="docFigureTitle">Figure 10-2. IPv6 Basic MIB History</h5>
<p class="docText"><div class="v1"><a target="_self" href="images/10fig02_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="284" SRC="images/10fig02.jpg"></P>
</center></p><br>
<p class="docText">Two sets of basic MIBs are defined for supporting IPv6-related information. One set is based on RFC 2465 for textual convention of the IPv6 address (OCTET STRING [SIZE (16)]). The basic IPv6 MIBs supporting that textual convention are as follows:</p>
<UL><li><p class="docList">IPV6-TC (RFC 2465)</P></LI><li><p class="docList">IPV6-TCP-MIB (RFC 2452)</P></li><li><p class="docList">IPV6-UDP-MIB (RFC 2554)</P></LI><LI><p class="docList">IPV6-MIB (RFC 2465)</p></li><li><p class="docList">IPV6-ICMP-MIB (RFC 2466)</P></li></ul>
<p class="docText">The second set is based on RFC 3291 for textual convention of both IPv4 and IPv6, through an inetAddress structure, which includes a type (1 for IPv4, 2 for IPv6) and an address. These MIBs are sometimes referred to as <span class="docEmphasis">unified MIBs.</span></P>
<p class="docText">The basic IPv6 MIBs supporting that textual convention are as follows:</P>
<ul><li><p class="docList">INET-ADDRESS-MIB (RFC 3291) (defines basic generic types for Internet address (IPv4, IPv6, DNS)</p></li><LI><p class="docList">IP-MIB (draft-ietf-ipv6-rfc2011-update)</p></li><LI><p class="docList">TCP-MIB (RFC 4022)</p></LI><li><p class="docList">UDP-MIB (RFC 4113)</p></li><li><p class="docList">IP-FORWARD-MIB (draft-ietf-ipv6-rfc2096-update)</p></li></ul>
<p class="docText">At the time of this writing, both the IP-MIB and the IP-FORWARD-MIB are in the IETF Editor Queue, as Proposed Standards, which means close to completion.</p>
<p class="docText">Although some network equipment (Hitachi, NEC, Juniper) and NMS (HP-OV) vendors currently support IPv6-specific MIBs (based on RFC 2465), others, including Cisco routers, support some version of the unified MIBs (based on RFC 3291). Because the latter are not yet published RFCs, the support remains private, and based on various version of the Internet Draft. Cisco, for example, implemented the draft version for &quot;IP Forwarding Table MIB&quot; and &quot;IP MIB&quot; as a private MIB (update-00). However, because the unified MIBs are becoming standard, Cisco actively works on their support, and it is expected that the NMSs (HP-OV and so on) will integrate them.</p>

<a name="ch10lev3sec3"></a>
<h5 class="docSection3Title">BGP and Other MIBs</h5>
<p class="docText">The BGP IPv6 MIBs are lagging behind the needs of today's networks. The BGP multiprotocol extensions (MP-BGP) enable BGP to exchange routing information for different types of address families (for instance, IPv6), identified by an Address Family Identifier (AFI) and Subsequent Address Family Identifier (SAFI). RFC 1657 describes BGP4 MIBs, without the multiprotocol bits required to report information about IPv6 and VPNv6 (as well as VPNv4 and multicast). An update of RFC 1657 is currently in the IETF RFC queue (draft-ietf-idr-bgp4-mib), but it also fails to provide MP-BGP information (still uses ipAddress).</p>
<p class="docText">On the other end, an MP-BGP MIB (draft-ietf-idr-bgp4-mibv2) is revising RFC 1657 with much larger ambitions. For several significant capabilities, such as BGP communities (RFC 1997), autonomous system confederation (RFC 3065), BGP multiprotocol extensions (RFC 2858), and route reflection (RFC 2796), the document proposes object types to manage those extended capabilities and their operation. As far as BGP IPv6 (AFI:IPv6, SAFI:Unicast), 6PE (AFI:IPv6, SAFI:label), and VPNv6 (AFI:IPv6, SAFI:VPN), the support of BGP multiprotocol extensions, which relies on inetAddress will be an important first step toward managing these features.</p>
<p class="docText">In addition, draft-ietf-idr-bgp4-mibv2 allows transport-independent address indices consistent with the AFI and SAFI mechanisms of that extension. Some router vendors implement this MIB as a private MIB. Cisco implements another BGP MIB (CISCO-BGP4-MIB), which also handles multiprotocol BGP, with a different format. The following excerpt shows the SAFI support in this MIB:</p>
<div class="docText"><pre>CbgpSafi ::= INTEGER {
        unicast(1),
        multicast(2),
        unicastAndMulticast(3),
        vpn(128)
        }</pre></div><br>
<p class="docText">In theory, nothing prevents the MIB (and the corresponding address, defined as OCTET STRING(SIZE[0..255]), from supporting IPv6 and VPNv6 addresses. In practice, at the time of this writing, the Cisco SNMP agent does not expose the IPv6, 6PE, and VPNv6 BGP information.</P>
<p class="docText">Some other MIBs, such as IP Tunnel MIB, are not yet at a point where they are ready for publication.</p>
<p class="docText">Many MIBs require further study, although they would be useful for managing IPv6 networks:</p>
<ul><LI><p class="docList">OSPFv3 MIB</p></LI><LI><p class="docList">Tunnel MIBs (including BGP tunnels such as 6PE and 6VPE)</p></LI><li><p class="docList">The VPN MIB</p></LI><LI><p class="docList">Cisco Express Forwarding MIBs</P></li></ul>

<a name="ch10lev3sec4"></a>
<h5 class="docSection3Title">IPv6 MIB Example</H5>
<p class="docText">Using one of the numerous MIB browsers available, you can obtain MIB-2 content from a Cisco router. In the following example, the CISCO-IETF-IP-FORWARD-MIB is loaded into the MIB browser. <a class="docLink" href="#ch10ex02">Example 10-2</a> shows an excerpt of the MIB for the route entry:</p>
<a name="ch10ex02"></a><h5 class="docExampleTitle">Example 10-2. CISCO-IETF-IP-FORWARD-MIB Route-Entry Example</H5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>CInetCidrRouteEntry ::= SEQUENCE {
        cInetCidrRouteInstance     Unsigned32,
        cInetCidrRouteDestType     InetAddressType,
        cInetCidrRouteDest         InetAddress,
        cInetCidrRoutePfxLen       InetAddressPrefixLength,
        cInetCidrRouteNextHopType  InetAddressType,
        cInetCidrRouteNextHop      InetAddress,
        cInetCidrRouteIfIndex      InterfaceIndex,
        cInetCidrRouteType         INTEGER,
        cInetCidrRouteProto        IANAipRouteProtocol,
        cInetCidrRouteAge          Integer32,
        cInetCidrRouteNextHopAS    InetAutonomousSystemNumber,
        cInetCidrRouteMetric1      Integer32,
        c<span class="docEmphasis">InetCidrRouteMetric2</span>      Integer32,
        cInetCidrRouteMetric3      Integer32,
        cInetCidrRouteMetric4      Integer32,
        cInetCidrRouteMetric5      Integer32,
        cInetCidrRouteStatus       RowStatus
    }</pre><br>

</td></TR></table></p>
<p class="docText">Using the MIB browser, you can execute a (series of) GET-NEXT and display the resulting tree, as shown in <a class="docLink" href="#ch10fig03">Figure 10-3</a>.</p>
<a name="ch10fig03"></a><P><center>
<h5 class="docFigureTitle">Figure 10-3. MIB Example Using a MIB Browser</H5>
<p class="docText"><div class="v1"><a target="_self" href="images/10fig03_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="300" SRC="images/10fig03.jpg"></p>
</center></p><br>
<p class="docText">For a better understanding of the MIB browsing result, it is possible to execute the <span class="docEmphStrong">show ipv6 cef</span> command on the router. The resulting output, shown in <a class="docLink" href="#ch10fig03">Figure 10-3</a>, contains details about the router forwarding table that relate directly to the MIB-2 content.</p>
<p class="docText">For example, CAFE:10::/64 appears in the MIB with the ASN.1 notation as follows:</p>
<ul><li><p class="docList">Prefix202.254.0.16.0.0.0.0.0.0.0.0.0.0.0.0</p></li><li><p class="docList">Length64</p></li><li><p class="docList">If index13 (Loopback0)</p></li></UL>
<a name="ch10note03"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">The unified MIB-2 MIBs are defined for both IPv4 and IPv6. In theory, the devices should respond to SNMP queries with values for both protocols. However, current Cisco implementations retrieve only IPv6 (type 2) addresses for the MIB-2, although the IPv4-only MIBs must be used to retrieve IPv4 data.</p>
</div><br>


<a name="ch10lev2sec4"></a>
<H4 class="docSection2Title">NetFlow</h4>
<p class="docText">Cisco IOS NetFlow provides network administrators with access to information concerning IP flows within their data networks. NetFlow includes three key components that perform the following functions:</P>
<UL><li><p class="docList">Flow caching collects IP data flows entering router or switch interfaces and prepares data for export. It enables the accumulation of data on flows with unique characteristics, such as IP addresses, application, and class of service (CoS). When enabled for IPv6 traffic, flow caching can record IPv6 flows, and aggregate them according to the configured aggregation policy. The flows captured on the routers are then exported to a flow collector.</P></li><li><p class="docList">Flow collector and data analysis captures exported data from multiple routers, filters and aggregates the data according to customer policies, and then stores this summarized or aggregated data.</P></LI><LI><p class="docList">Flow analyzer displays and analyzes NetFlow data collected from flow collector files. This allows users to complete near real-time visualization or trending analysis of recorded and aggregated flow data.</p></li></ul>
<p class="docText"><a class="docLink" href="#ch10fig04">Figure 10-4</a> highlights these three components in the network.</P>
<a name="ch10fig04"></a><p><center>
<h5 class="docFigureTitle">Figure 10-4. NetFlow Architecture</H5>
<p class="docText"><div class="v1"><a target="_self" href="images/10fig04_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="421" SRC="images/10fig04.jpg"></P>
</center></p><br>
<p class="docText">Typical flow information found in a NetFlow data record includes the following:</p>
<ul><LI><p class="docList">Source and destination IPv6 address</p></li><LI><p class="docList">Source and destination TCP/UDP ports</p></LI><li><p class="docList">Type of service (ToS)</p></li><li><p class="docList">Packet and byte counts</p></li><li><p class="docList">Start and end time stamps</p></li><li><p class="docList">Input and output interface numbers</p></li><li><p class="docList">TCP flags and encapsulated protocol (TCP/UDP)</p></li><LI><p class="docList">Routing information (next-hop address, source autonomous system number, destination autonomous system number, source prefix mask, destination prefix mask)</p></li></ul>
<p class="docText">The basic output of NetFlow is a flow record. Several different formats for flow records have evolved as NetFlow has matured. The most recent evolution of the NetFlow flow-record format is known as version 9. IPv6 flows can only be reported under that version. The distinguishing feature of the NetFlow v9 format is that it is template based. <a class="docLink" href="#ch10table01">Table 10-1</a> lists the IPv6-specific NetFlow fields that can be collected and exported.</P>
<a name="ch10table01"></a><p><table cellspacing="0" class="allBorders" border="1" RULES="all" cellpadding="4"><caption><H5 class="docTableTitle">Table 10-1. IPv6 NetFlow Fields</H5></caption><colgroup><col width="175"><col width="75"><col width="75"><col width="175"></colgroup><thead><tr><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Field Type</P></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Value</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Length (Bytes)</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Description</P></th></TR></thead><TR><td class="docTableCell" align="left" valign="top"><p class="docText">IPV6_SRC_ADDR</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">27</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">16</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">IPv6 source address</p></td></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText">IPV6_DST_ADDR</P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">28</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">16</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">IPv6 destination address</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">IPV6_SRC_MASK</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">29</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">1</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Length of the IPv6 source mask in contiguous bits</p></TD></TR><tr><TD class="docTableCell" align="left" valign="top"><p class="docText">IPV6_DST_MASK</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">30</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">1</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Length of the IPv6 destination mask in contiguous bits</p></td></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText">IPV6_FLOW_LABEL</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">31</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">3</P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">IPv6 flow label as per RFC 2460 definition</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">IP_PROTOCOL_VERSION</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">60</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">1</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Internet Protocol version set to 4 for IPv4, set to 6 for IPv6 (If not present in the template, version 4 is assumed.)</p></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">DIRECTION</P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">61</P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">1</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Flow direction: 0ingress flow; 1egress flow</P></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">IPV6_NEXT_HOP</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">62</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">16</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">IPv6 address of the next-hop router</P></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText">BPG_IPV6_NEXT_HOP</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">63</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">16</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Next-hop router in the BGP domain</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">IPV6_OPTION_HEADERS</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">64</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">4</P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Bit-encoded field identifying IPv6 option headers found in the flow</P></td></TR></table></p><br>
<p class="docText">The IPv6 option headers are reported into a 32-bit field, as shown in <a class="docLink" href="#ch10table02">Table 10-2</a>, only when the router is configured to do so. This is because this recording can impact the router performances; to obtain the option headers in the IPv6 packet, the router's forwarding component has to scan the complete chain of headers, although only the first one is usually looked at in a transit node. This scanning might lead certain hardware routers to punt the IPv6 packets to a software path, with some performance consequences.</P>
<a name="ch10table02"></a><P><table cellspacing="0" class="allBorders" border="1" RULES="all" cellpadding="4"><caption><H5 class="docTableTitle">Table 10-2. NetFlow Encoding of IPv6 Option Header</h5></caption><colgroup><col width="50"><col width="275"><col width="175"></colgroup><thead><tr><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Bit</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Option</P></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Option Header Value</p></th></tr></thead><TR><TD class="docTableCell" align="left" valign="top"><p class="docText">1</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Fragmentation header (not first fragment)</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">44</p></TD></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText">2</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Routing header</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">43</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">3</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Fragmentation header (first fragment)</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">44</p></TD></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText">4</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Cannot reach layer 4</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">No readable value</P></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText">6</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Hop-by-hop option header</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">0</p></td></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText">7</P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Destination option header</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">60</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">8</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Payload compression header</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">108</p></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">9</P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Authentication header</P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">51</p></td></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText">10</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Encrypted Security Payload</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">50</P></TD></tr></table></p><br>
<p class="docText"><a class="docLink" href="#ch10table02">Table 10-2</a> shows how the field IPV6_OPTION_HEADERS is encoded.</p>
<p class="docText"><a class="docLink" href="#ch10ex03">Example 10-3</a> shows how to configure option header reporting on the Cisco router.</P>
<a name="ch10ex03"></a><h5 class="docExampleTitle">Example 10-3. NetFlow Option Header Reporting Configuration</h5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><TD>


<pre>interface Ethernet3/0
 no ip address
 ipv6 address 2001:100::/64 eui-64
 ipv6 flow ingress
 <span class="docEmphMark">ipv6 flow mask options-headers 0x24</span></pre><br>

</td></tr></table></p>
<p class="docText">In this example, the option headers for routing header and hop-by-hop header are recorded.</p>
<p class="docText">There are many ways to operate NetFlow on the routers:</p>
<ul><li><p class="docList">You could capture raw flows and store them in the IPv6 NetFlow cache before exporting them to the collector. The following configuration example shows how to configure the raw IPv6 NetFlow cache on a Cisco router and export v9 records.</p><a name="ch10ex04"></a><h5 class="docExampleTitle">Example 10-4. NetFlow Configuration for Raw Flow Capture</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>interface Ethernet3/0
 ip address 100.1.1.2 255.255.255.0
 ipv6 address 2001:100::2/64
 <span class="docEmphMark">ipv6 flow ingress</span>
 <span class="docEmphMark">ipv6 flow egress </span>
!
<span class="docEmphMark">ip flow-export version 9</span>
<span class="docEmphMark">ipv6 flow-export source FastEthernet0/0</span>
<span class="docEmphMark">ipv6 flow-export destination 172.18.102.245 10000</span></pre><br>

</TD></tr></table></p><p class="docList">With a configured frequency, the NetFlow routers export the raw data to the NetFlow Collector (in this example, 172.18.102.245). The collector can then aggregate the flows and produce statistics and alerts. Several IPv6 NetFlow Collectors, including Cisco NFC, are reviewed in the section &quot;<a class="docLink" href="ch10lev1sec4.html#ch10lev2sec7">Flow Analysis Using NetFlow</a>.&quot;</p></LI><li><p class="docList">Flows can be aggregated on the NetFlow routers before they are exported to the collector. A specific aggregation cache is then created on the router and mapped onto the chosen aggregation scheme. <a class="docLink" href="#ch10ex05">Example 10-5</a> illustrates how this can be done.</P><a name="ch10ex05"></a><H5 class="docExampleTitle">Example 10-5. NetFlow Configuration with Flow Aggregation</h5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>ipv6 flow-aggregation cache bgp_nexthop
  cache entries 100000
  export version 9
  enabled
ipv6 flow-export source FastEthernet0/0
ipv6 flow-export destination 172.18.102.245 10000</pre><BR>

</TD></TR></table></p><p class="docList">On the router, a distinct aggregation cache is created for each IPv6 aggregation scheme (autonomous system, BGP next hop, protocol port, source prefix, destination prefix, prefix). <a class="docLink" href="#ch10table03">Table 10-3</a> lists fields set for each of the IPv6 aggregation caches.</p><a name="ch10table03"></a><p><table cellspacing="0" class="allBorders" border="1" RULES="all" cellpadding="4"><caption><H5 class="docTableTitle">Table 10-3. NetFlow Aggregation Schemes</h5></caption><colgroup><col width="195"><col width="50"><col width="105"><col width="50"><col width="50"><col width="50"><col width="50"></colgroup><thead><tr><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Field/Aggregation Scheme</P></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Autonomous System</P></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">BGP Next Hop</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Protocol Port</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Source Prefix</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Destination Prefix</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Prefix</P></th></tr></thead><tr><TD class="docTableCell" align="left" valign="top"><p class="docText">Protocol Version</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Direction</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></P></td><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></P></td><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></P></TD><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Source Prefix</p></TD><td class="docTableCell" align="left" valign="top">&nbsp;</TD><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></td><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Destination Prefix</P></td><td class="docTableCell" align="left" valign="top">&nbsp;</td><TD class="docTableCell" align="left" valign="top">&nbsp;</td><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><td class="docTableCell" align="left" valign="top">&nbsp;</TD><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></P></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText">Protocol</p></td><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></TD><td class="docTableCell" align="left" valign="top">&nbsp;</td><TD class="docTableCell" align="left" valign="top">&nbsp;</td><TD class="docTableCell" align="left" valign="top">&nbsp;</td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Source Port</p></td><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></td><td class="docTableCell" align="left" valign="top">&nbsp;</td><TD class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top">&nbsp;</td></TR><tr><TD class="docTableCell" align="left" valign="top"><p class="docText">Destination Port</P></td><TD class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></P></td><td class="docTableCell" align="left" valign="top">&nbsp;</td><TD class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top">&nbsp;</TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Source Interface</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></TD><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></td><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Destination Interface</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></P></td><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><td class="docTableCell" align="left" valign="top">&nbsp;</TD><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></P></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText">Source BGP Autonomous System</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></P></td><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></td><TD class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></P></td><TD class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Destination BGP Autonomous System</p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></td><TD class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top">&nbsp;</td><TD class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></TD></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText">Source Prefix Mask</P></TD><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top">&nbsp;</TD><td class="docTableCell" align="left" valign="top">&nbsp;</td><TD class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></P></td><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></P></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Destination Prefix Mask</P></td><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></td></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText">BGP Next Hop</p></TD><td class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn01">[*]</a></sup></p></TD><td class="docTableCell" align="left" valign="top">&nbsp;</td><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top">&nbsp;</td></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Next Hop</P></TD><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top">&nbsp;</td><TD class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top">&nbsp;</TD><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn02">[X]</a></sup></P></td><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn02">[X]</a></sup></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">OR'd TCP Flags</p></td><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText"><sup class="docFootnote"><a class="docLink" href="#ch10tn02">[X]</a></sup></p></TD><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top">&nbsp;</TD><td class="docTableCell" align="left" valign="top">&nbsp;</TD></TR></table></p><BR><blockquote><p class="docFootnote"><sup><a name="ch10tn01">[*]</a></sup> : fields recorded and part of the aggregated record key</p></blockquote><blockquote><p class="docFootnote"><sup><a name="ch10tn02">[X]</a></sup> : fields recorded but not part of the key</p></blockquote></LI><LI><p class="docList">A third option, useful in testing phases but not recommended in real-life deployments, is to obtain router statistics and counters via the router command-line interface (CLI). <a class="docLink" href="#ch10ex06">Example 10-6</a> shows the detailed output of the <span class="docEmphStrong">show</span> NetFlow command.</P><a name="ch10ex06"></a><h5 class="docExampleTitle">Example 10-6. NetFlow Cache Display</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><td>


<pre>Router#<span class="docEmphStrong">show ipv6 flow cache</span>
IP packet size distribution (10761 total packets):
   1-32   64   96  128  160  192  224  256  288  320  352  384  416  448  480
   .000 .280 .307 .377 .034 .000 .000 .000 .000 .000 .000 .000 .000 .000 .000
    512  544  576 1024 1536 2048 2560 3072 3584 4096 4608
   .000 .000 .000 .000 .000 .000 .000 .000 .000 .000 .000
IP Flow Switching Cache, 475168 bytes
  25 active, 4071 inactive, 3324 added
  53962 ager polls, 0 flow alloc failures
  Active flows timeout in 30 minutes
  Inactive flows timeout in 15 seconds
IP Sub Flow Cache, 33928 bytes
  0 active, 1024 inactive, 0 added, 0 added to flow
  0 alloc failures, 0 force free
  1 chunk, 1 chunk added
SrcAddress     InpIf DstAddress     OutIf Prot SrcPrt DstPrt Packets
2001:400::2    Local 2001:400::1    Et3/0 0x3A 0x0000 0x8100 5
2001:300::2    Local 2001:300::1    Et3/0 0x3A 0x0000 0x8100 5
2001:200::2    Local 2001:200::1    Et3/0 0x3A 0x0000 0x8100 5
2001:300::1    Et3/0 FF02::1:FF00:2 Local 0x3A 0x0000 0x8700 2
2001:400::1    Et3/0 FF02::1:FF00:2 Local 0x3A 0x0000 0x8700 2
2001:400::1    Et3/0 2001:400::2    Local 0x06 0x2B00 0x0017 88
2001:400::2    Local 2001:400::1    Et3/0 0x06 0x0017 0x2B00 38
2001:300::2    Local 2001:300::1    Et3/0 0x06 0x0017 0x2B01 29
2001:300::1    Et3/0 2001:300::2    Local 0x06 0x2B01 0x0017 70
2001:500::72A  Et7/0 2001:800::25C  Eth8/00x06 0x2B01 0x0017 123</pre><br>

</TD></TR></table></p></li></ul>
<p class="docText">Out of the three methods reviewed, the first one (export raw data) should be preferred, as long as the interface for exporting the data can handle the overhead of massive flow export. If it cannot, aggregating flows on the router before exporting them will reduce this overhead while using router resources. Accessing NetFlow counters via a router's CLI should be reserved to testing and troubleshooting situations.</p>
<a name="ch10note04"></a><div class="docNote"><p class="docNoteTitle">Note</P>

<p class="docText">With the current version of Cisco NetFlow, the v9 records containing the raw or aggregated IPv6 fields are currently sent over IPv4 UDP.</p>
</div><br>
<a name="ch10note05"></a><div class="docNote"><p class="docNoteTitle">Note</P>

<p class="docText">Unlike IPv4, the IPv6 main cache (with no aggregation configured on the router) can aggregate addresses based on a configured mask length. This capability was required with IPv6 because of the larger address space. Flows that differ only by a source or destination within the same prefix range (bounded by the configured mask length) are aggregated <span class="docEmphasis">at capture time</span>. The following example shows how this can be configured.</p>
<a name="ch10ex07"></a><H5 class="docExampleTitle">Example 10-7. NetFlow Mask-Length Configuration</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>Router#<span class="docEmphStrong">show running</span>
interface Ethernet3/0
 no ip address
 ipv6 address 2001:100::/64 eui-64
 ipv6 flow ingress
 <span class="docEmphMark"> ipv6 flow mask destination maximum 64</span>
 <span class="docEmphMark"> ipv6 flow mask source maximum 64 </span>
end</pre><br>

</td></tr></table></p>
<p class="docText">For performance reasons, it is recommended to turn this option on, unless there is a good reason for recording full prefixes.</p>
<p class="docText">Note that flows with unrecorded option headers are also aggregated at capture time.</p>
</div><br>

<a name="ch10lev2sec5"></a>
<h4 class="docSection2Title">IPfix</h4>
<p class="docText">The IPfix protocol defines how IP flow information can be exported from routers, measurement probes, and other devices. It is intended to provide this information as input for various applications. IPfix is a general data-transport protocol, easily extensible to suit the needs of different applications.</p>
<p class="docText">IPfix is currently being defined at the IETF in the Internet Draft draft-ietf-ipfix-protocol. It has all provisions to support IPv6 addresses and all flexibility to fit future IPv6 needs. When available, it will possibly replace NetFlow as the next-generation flow-analysis tool. However, at the time of this writing, no production implementation of IPfix was yet available, and the Internet Draft has not yet established standards.</p>
<p class="docText">Service-usage accounting is one of the major applications for which the IPfix protocol has been developed. IPfix data provides fine-grained measurements (for example, flow records include details such as IP addresses, packet and byte counts, time stamps, type of service [ToS], and application ports) for highly flexible and detailed resource-usage accounting.</P>
<p class="docText">Internet service providers (ISPs) can use this information to migrate from single-fee, flat-rate billing to more flexible charging mechanisms based on time of day, bandwidth usage, application usage, quality of service (QoS), and so forth. Enterprise customers can use this information for departmental chargeback or cost allocation for resource usage.</p>
<p class="docText">For accounting purposes, it would be advantageous to have the ability to use IPfix flow records as accounting input in an authentication, authorization, and accounting (AAA) infrastructure. AAA servers could provide the mapping between user and flow information.</p>
<p class="docText">The IPfix protocol specification has been designed to be transport protocol independent (TCP, UDP, SCTP). However, only SCTP (Stream Control Transmission Protocol) transport is mandated by the specification, because it is the only reliable transport protocol that includes congestion-avoidance mechanisms. There should be no problem in reporting IPv6 data with IPfix, provided only that the transport protocol being used to carry IPfix is running on the IPv6 network.</p>

<a name="ch10lev2sec6"></a>
<H4 class="docSection2Title">Other Protocols (Telnet/SSH/RSH/TFTP/FTP)</h4>
<p class="docText">There exists a collection of well-known protocols that can be used to extract management information from routers. They do not define the format of what is being uploaded (or downloaded), but they provide access to devices where specific commands can be executed. Similar to the other retrieval tools, even when they connect to the router over IPv4, they have the ability to retrieve IPv6 information.</P>
<p class="docText">Here is a list of the most common such protocols, with a status of their IPv6 support on Cisco routers.</P>
<ul><LI><p class="docText"><span class="docEmphStrong">Telnet</span> Telnet can be used to log in to a device, such as a router, to obtain console access. Using the local user interface, one can then obtain device data and/or configure it. The data can be, for instance, a configuration file, local counters, local cache, link status, and so on.</p><p class="docList">Cisco routers support both IPv6 Telnet client and server connections. A vty interface and password must be created to enable Telnet access to an IPv6 router. The following configuration illustrates how to enable the IPv6 Telnet server on a Cisco router.</p><a name="ch10ex08"></a><H5 class="docExampleTitle">Example 10-8. IPv6 Telnet Configuration</H5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>Router#<span class="docEmphStrong">show running</span>
ipv6 host sophia 2001:100::1
line vty 0 4
  password mypassw
  login</pre><br>

</TD></tr></table></p><p class="docList">A Telnet client can connect using <span class="docEmphStrong">telnet Router</span> and execute a local command (for instance, to retrieve interface statistics), as shown in <a class="docLink" href="#ch10ex09">Example 10-9</a>.</P><a name="ch10ex09"></a><H5 class="docExampleTitle">Example 10-9. Displaying Router Statistics over a Telnet Session</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>Router#<span class="docEmphStrong">show interfaces accounting</span>
FastEthernet0/0
ProtocolPkts InChars In Pkts Out Chars Out
IP     232      13920      13179    1055192
ARP    0        0          2        120
CDP    1295     488215     1295     624190
IPv6   87       7343       10821    1154992
Serial3/0
ProtocolPkts InChars In Pkts Out Chars Out
IP       1032152  172480455    971046    99846637
CDP      11848    4703656      11851     4633741
IPv6     72565    6178060      72582     6304396</pre><BR>

</td></tr></table></P></li><LI><p class="docText"><span class="docEmphStrong">SSH</span> Secure Shell can be handy for connecting to a device over a secure connection and retrieving information. On Cisco routers, configuring SSH for IPv6 is not different from its configuration for IPv4. It requires the following:</p><dl><dd><p class="docList">- An IPsec (Data Encryption Standard [DES, 3DES] or AES) encryption-software Cisco router image.</p></dd><dd><p class="docList">- A host name and host domain must be configured.</p></dd><dd><p class="docList">- A Rivest, Shamir, and Adelman (RSA) key pair, which automatically enables SSH, must be generated for the router.</p></dd></dl></li><li><p class="docText"><span class="docEmphStrong">RSH</span> Remote Shell enables users to execute commands remotely. Remote Copy (RCP) enables users to copy files to and from a file system residing on a remote host or server on the network. <a class="docLink" href="#ch10ex10">Example 10-10</a> illustrates an IPv4 RSH configuration that enables IPv6 command execution on the server side (Router-B). The example also shows an IPv6 command executed on the client side (Router-A) to display interface status.</p><a name="ch10ex10"></a><h5 class="docExampleTitle">Example 10-10. Configuring a Server for RSH and Executing Commands Remotely</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>Router-B#<span class="docEmphStrong">show running | include ip rcmd</span>
ip rcmd rcp-enable
ip rcmd rsh-enable
ip rcmd remote-host Router-A 50.1.1.1 Router-A enable

Router-A#<span class="docEmphStrong">rsh 50.1.1.2 /user Router-A show ipv6 interface brief</span>
Ethernet0/0                [up/up]
    FE80::A8BB:CCFF:FE01:F600
    2001:100::72B
Ethernet1/0                [up/up]
    unassigned
Loopback0                  [up/up]
    FE80::A8BB:CCFF:FE01:F600
    2001:101::123</pre><br>

</td></tr></table></P><p class="docList">Note that although <a class="docLink" href="#ch10ex10">Example 10-10</a> shows how to configure RSH over an IPv4 transport, RSH over an IPv6 transport is not yet supported on Cisco IOS routers at the time of this writing.</p></li><li><p class="docText"><span class="docEmphStrong">TFTP</span> It can be used to download or upload files to/from a device such as a router. On Cisco routers, IPv6 supports TFTP file downloading and uploading using the <span class="docEmphStrong">copy EXEC</span> command. The <span class="docEmphStrong">copy EXEC</span> command accepts a destination IPv6 address or IPv6 host name as an argument and saves the running configuration of the router to an IPv6 TFTP server, as follows:</P><div class="docText"><pre>Router#<span class="docEmphStrong">copy running-config tftp://[2001:100::1]/running-config</span></pre></div></li><LI><p class="docText"><span class="docEmphStrong">FTP</span> FTP can also be used to upload/download information to/from devices. Although FTP runs over TCP, having IPv6 TCP support is not enough to get FTP working over IPv6. FTP messages include a host address, and the initial FTP specification assumed network addresses of 32 bits in length. RFC 2428 specifies FTP extensions for IPv6. On Cisco routers, at the time of this writing, FTP over IPv6 is not yet supported.</P></li></UL>
<p class="docText">In many cases, Looking Glass can be set up to enable authorized users to access IPv6-enabled devices from a web interface and to run specific commands. Looking Glass typically uses Telnet, SSH, or RSH to execute the request on the device. The IPv6 information can be acquired over IPv4 or IPv6. The example illustrated in <a class="docLink" href="#ch10fig05">Figure 10-5</a> shows one of these Looking Glass outputs used on the regional Picardie (France) IPv6 network.</p>
<a name="ch10fig05"></a><p><center>
<H5 class="docFigureTitle">Figure 10-5. IPv6 Looking Glass</H5>
<p class="docText"><div class="v1"><a target="_self" href="images/10fig05_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="369" SRC="images/10fig05.jpg"></P>
</center></p><br>


</TD></TR></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch10lev1sec2.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch10lev1sec4.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
</body></html>