<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>Learning the Technology</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch15lev1sec3.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch15lev1sec5.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><TD valign="top"><a name="ch15lev1sec4"></a>
<h3 class="docSection1Title">Learning the Technology</H3>
<p class="docText">While visiting Japan (refer to <a class="docLink" target="_blank" href="http://www.v6pc.jp/en/showcase/showroom/index.html">http://www.v6pc.jp/en/showcase/showroom/index.html</a> and <a class="docLink" target="_blank" href="http://www.ipv6style.jp/en/action/20030328/index.shtml">http://www.ipv6style.jp/en/action/20030328/index.shtml</a> for details), the CEO saw a demonstration of IPv6. Back from his trip to Asia, he asks the IT team to study the impact of this new technology. He is interested in the potential application of some of the new industrial and consumer devices, such as IP video surveillance cameras and industrial sensors, as well as the mobility aspect of accessing those resources.</P>
<p class="docText">IT team members have participated in a couple of IPv6 events, but no fiscal-year budget has been planned for any IPv6-related activity. It is decided to open a trial with several tasks to <a name="iddle1327"></a>educate the team about IPv6 in real life and evaluate the integration of the technology for deployment of new applications.</p>
<p class="docText">The tasks are defined to tackle the following topics:</P>
<ul><li><p class="docList">Configuration and management of IPv6 routers on a single site</P></LI><LI><p class="docList">Configuration and management of IPv6 hosts on a single site with a defined set of applications</p></li><li><p class="docList">Configuration of IPv6 Internet connectivity, including security setup</P></li><li><p class="docList">Expansion of IPv6 between selected AC sites and evaluation of &quot;transition&quot; mechanisms</P></LI></ul>
<p class="docText">A team leader is chosen at the San Francisco headquarters to manage the project. Initial project tasks consist of the following:</p>
<ul><li><p class="docList">Provisioning the appropriate equipment</P><dl><dd><p class="docList">- <span class="docEmphStrong">Routers</span></p><p class="docList">Cisco 2821 routersnamed R7 and R5, as shown on <a class="docLink" href="#ch15fig03">Figure 15-3</a>with 256 MB of memory and 64 MB of Flash, integrated 10/100/1000 Mbps Ethernet interfaces, loaded with Cisco IOS 12.4(2)T Advanced Enterprise Services image.</p><a name="ch15fig03"></a><P><center>
<h5 class="docFigureTitle">Figure 15-3. Initial Test Bed Network Diagram</H5>
<p class="docText"><div class="v1"><a target="_self" href="images/15fig03_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="301" SRC="images/15fig03.jpg"></p>
</center></p></dd><dd><p class="docList">- <span class="docEmphStrong">Hosts</span></p><p class="docList">IPv6-enabled laptops running Microsoft Windows XP SP1 will be used. Other operating systems can be selected for evaluation, too. If both Microsoft Windows XP and Linux need to be validated on a single PC, a user can run Linux Knoppix v3.9, which boots from a CD-ROM.</p><p class="docList">IPv6 video surveillance camera, such as Panasonic BB-HCM381.</p></dd><dd><p class="docList">- <span class="docEmphStrong">Miscellaneous</span></p><p class="docList">Layer 2 switch to connect the equipment.</p><p class="docList">802.11 access point to validate IPv6 over WiFi operation.</p></dd></dl></li><li><p class="docList"><span class="docEmphStrong">Selecting a set of IPv6 applications</span></p><p class="docList">Although all current operating systems do support dual stack, it does not mean all applications can benefit from the IPv6 network layer. At the time of this writing, several websites (for instance, the 6NET Project, at <a class="docLink" target="_blank" href="http://www.ipv6.org/v6-apps.html193.55.253.34/WP5Apps/Applications.html">http://www.ipv6.org/v6-apps.html193.55.253.34/WP5Apps/Applications.html</a>) provide a list of software, either commercial or experimental, that can be installed to evaluate IPv6. The AC IT team will start the testing with the following well-known basic applications:</p><dl><dd><span class="docText">- <span class="docEmphStrong">Ping</span> Available from all implementations; basic requirement to check the connectivity between devices.<br><br></span></dd><dd><span class="docText">- <span class="docEmphStrong">Traceroute</span> <a name="iddle1065"></a><a name="iddle1321"></a>Available from all implementations; basic requirement to verify the Internet connectivity.<br><BR></span></dd><dd><span class="docText">- <span class="docEmphStrong">Web browser</span> Such as Internet Explorer 6.0 and Mozilla Firefox 1.0.4 to access well-known IPv6 websites as well as the IPv6 video camera.<br><br></span></dd><dd><span class="docText">- <span class="docEmphStrong">Multimedia streaming</span> For instance, Videolan Client 0.8.1 as its client version allows generating a network stream using IPv6 unicast and multicast or Microsoft Windows Media &amp; Server version 9.0 or 10.0.<br><BR></span></dd></dl></li><LI><p class="docList">Define an IPv6 addressing scheme for the trial.</P><dl><dd><p class="docList">- To meet the objectives of the different tasks and get full IPv6 Internet connectivity during the trial, an addressing scheme must be selected. It can be either a production prefix assigned by a provider, or 6to4 prefixes as introduced in <a class="docLink" href="ch03.html#ch03">Chapter 3</a>, &quot;Delivering IPv6 Unicast Services&quot; (RFC 3056). It is decided to go with 6to4 because of the simplicity of the mechanism, no dependency on a service provider because each site with a global IPv4 address can configure these prefixes, and the 6to4 tunneling is commonly available on various platforms.</p></dd><dd><p class="docList">- The test bed will be expanded later to include ISATAP and manually configured tunnels; the IPv6 addressing scheme is planned for these extensions as shown in <a class="docLink" href="#ch15table02">Table 15-2</a>.</P><a name="ch15table02"></a><p><table cellspacing="0" class="allBorders" border="1" RULES="all" cellpadding="4"><caption><h5 class="docTableTitle">Table 15-2. Addressing Scheme for the IPv6 Trial</H5></caption><colgroup><col width="125"><col width="100"><col width="100"><col width="100"><col width="125"></colgroup><thead><TR><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Site</P></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">6to4 Prefix 2002::/16</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Public IPv4 address (82.121.150.27) from R7 interface Lo0</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Subnet ID</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Interface ID</P></th></tr></thead><tr><TD class="docTableCell" align="left" valign="top"><p class="docText">Router R7 6to4 router</P>
<p class="docText">Native IPv6 on VLAN2</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">2002</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">5279:961B:</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">0001</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Can be EUI-64 or manual or privacy (hosts)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Router R5 ISATAP</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">2002</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">5279:961B:</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">8888</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">ISATAP value</P></td></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Routers R7 and R5 configured tunnel link</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">2002</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">5279:961B:</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">0003</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Can be EUI-64 or manual</P></TD></tr></table></p><br></dd><dd><p class="docList">- It is well understood by the AC IT team that this addressing scheme is a temporary solution defined for this trial. Mechanisms such as 6to4 and ISATAP have inherent limitations (for instance, the lack of IPv6 multicast support or the mandatory need to keep an IPv4 address to build the IPv6 address or prefix). This may not be suitable for a production deployment.</p></dd></dl></LI></ul>
<p class="docText">With all the equipment now ready, the trial can begin with a setup as shown in <a class="docLink" href="#ch15fig03">Figure 15-3</a>. Routers and hosts are attached on a layer 2 switch configured with two VLANs, one for the IPv6 test segment, the other to enable external IPv4 connectivity on the DMZ segment. For security reasons, the initial setup does not permit communications between the IPv6 segment and AC internal network.</p>
<p class="docText">A first router, a Cisco 2821 (router R7 in <a class="docLink" href="#ch15fig03">Figure 15-3</a>), is set up for a basic IPv6 configuration, as shown in <a class="docLink" href="#ch15ex01">Example 15-1</a>, which consists of the following:</P>
<ul><LI><p class="docList">Enabling IPv6 routing on Cisco IOS routers through the <span class="docEmphStrong">ipv6 unicast-routing</span> command, and IPv6 Cisco Express Forwarding (CEF).</p><a name="ch15note01"></a><div class="docNote"><p class="docNoteTitle">Note</p>
<p class="docText">IPv6 CEF requires IP CEF to be configured to enable fast processing of IPv6 packets.</p>
</div><br></li><li><p class="docList">An interface GigaEthernet 0/1.2 configured for native IPv6 to act as gateway on VLAN2, where the IPv6 hosts will be attached</p></li><li><p class="docList">An interface Tunnel0 configured as a 6to4 tunnel with the IPv6 address of the interface GigaEthernet 0/1.2 and IPv4 address of interface Loopback0</p></li><li><p class="docList">A static route for 6to4 prefix 2002::/16 pointing on Tunnel0</p></li><li><p class="docList">A default route ::/0 pointing to the 6to4 relay anycast address as documented in <a class="docLink" href="ch03.html#ch03">Chapter 3</a></P></li></ul>
<a name="ch15ex01"></a><h5 class="docExampleTitle">Example 15-1. IPv6 Configuration of Router R7</H5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><TD>


<pre>R7#<span class="docEmphStrong">show running</span>
<span class="docEmphMark">ip cef</span>
<span class="docEmphMark">ipv6 unicast-routing</span>
<span class="docEmphMark">ipv6 cef</span>
!
interface Tunnel0
 no ip address
 no ip redirects
 ipv6 unnumbered GigabitEthernet0/1.2
 tunnel source Loopback0
 <span class="docEmphMark">tunnel mode ipv6ip 6to4</span>
!
interface Loopback0
 ip address 82.121.150.27 255.255.255.255
!
interface GigabitEthernet0/1.2
description === IPv6 vlan ===
 encapsulation dot1Q 2
<span class="docEmphMark">ipv6 address 2002:5279:961B:1::/64 eui-64</span>
!
<span class="docEmphMark">ipv6 route 2002::/16 Tunnel0</span>
<span class="docEmphMark">ipv6 route ::/0 2002:C058:6301::</span>
R7#</pre><br>

</TD></tr></table></p>
<p class="docText"><a class="docLink" href="#ch15ex02">Example 15-2</a> displays the status of the IPv6 interfaces on router R7 and illustrates their IPv6 addresses.</P>
<a name="ch15ex02"></a><H5 class="docExampleTitle">Example 15-2. IPv6 Interface Status on Router R7</H5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>R7#<span class="docEmphStrong">show ipv6 interface</span>
<span class="docEmphMark">GigabitEthernet0/1.2 is up, line protocol is up</span>
  Description: === 6to4 vlan ===
  <span class="docEmphMark">IPv6 is enabled, link-local address is FE80::20D:BDFF:FE99:F5F9</span>
  <span class="docEmphMark">Global unicast address(es):</span>
    <span class="docEmphMark">2002:5279:961B:1:20D:BDFF:FE99:F5F9, subnet is 2002:5279:961B:1::/64 [EUI]</span>
  Joined group address(es):
    FF02::1
    FF02::2
    FF02::1:FF99:F5F9
  MTU is 1500 bytes
  ICMP error messages limited to one every 100 milliseconds
  ICMP redirects are enabled
  ND DAD is enabled, number of DAD attempts: 1
  ND reachable time is 30000 milliseconds
  ND advertised reachable time is 0 milliseconds
  ND advertised retransmit interval is 0 milliseconds
  ND router advertisements are sent every 200 seconds
  ND router advertisements live for 1800 seconds
Hosts use stateless autoconfig for addresses.
<span class="docEmphMark">Tunnel0 is up, line protocol is up</span>
  <span class="docEmphMark">IPv6 is enabled, link-local address is FE80::5279:961B</span>
        <span class="docEmphMark">Interface is unnumbered. Using address of GigabitEthernet0/1.2</span>
  <span class="docEmphMark">No global unicast address is configured</span>
  Joined group address(es):
    FF02::1
    FF02::2
    FF02::1:FF79:961B
  MTU is 1480 bytes
  ICMP error messages limited to one every 100 milliseconds
  ICMP redirects are enabled
  ND DAD is not supported
  ND reachable time is 30000 milliseconds
  Hosts use stateless autoconfig for addresses.</pre><BR>

</td></tr></table></P>
<p class="docText"><a name="iddle1330"></a><a class="docLink" href="#ch15ex03">Example 15-3</a> shows how to verify the status of the two static IPv6 routes on router R7.</P>
<a name="ch15ex03"></a><h5 class="docExampleTitle">Example 15-3. IPv6 Routing Status on Router R7</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><TD>


<pre>R7#<span class="docEmphStrong">show ipv6 route</span>
IPv6 Routing Table - 6 entries
Codes: C - Connected, L - Local, S - Static, R - RIP, B - BGP
       U - Per-user Static route
       I1 - ISIS L1, I2 - ISIS L2, IA - ISIS interarea, IS - ISIS summary
       O - OSPF intra, OI - OSPF inter, OE1 - OSPF ext 1, OE2 - OSPF ext 2
       ON1 - OSPF NSSA ext 1, ON2 - OSPF NSSA ext 2
<span class="docEmphMark">S   ::/0 [1/0]</span>
     <span class="docEmphMark">via 2002:C058:6301::1</span>
<span class="docEmphMark">S   2002::/16 [1/0]</span>
     <span class="docEmphMark">via ::, Tunnel0</span>
C   2002:5279:961B:1::/64 [0/0]
           via ::, GigabitEthernet0/1.2
L   2002:5279:961B:1:20D:BDFF:FE99:F5F9/128 [0/0]
     via ::, GigabitEthernet0/1.2
L   FE80::/10 [0/0]
     via ::, Null0
L   FF00::/8 [0/0]
     via ::, Null0</pre><br>

</td></TR></table></p>
<p class="docText">After setting up IPv6 on router R7, it is now the time to look at an IPv6 host configuration; the example is done on Microsoft Windows XP SP1. Hosts will get their IPv6 address through the stateless autoconfiguration.</P>
<p class="docText">The IPv6 address is built after receiving Router Advertisement messages. There are three IPv6 addresses set on the interface:</p>
<ul><li><p class="docList">Link-local</p></li><li><p class="docList">Global permanent</p></li><li><p class="docList">Global temporary (privacy address as defined in RFC 3041)</p></li></ul>
<p class="docText"><a name="iddle1716"></a><a name="iddle1965"></a>The gateway address is the link-local address of router R7.</p>
<p class="docText">The value %4 at the end of the link-local and gateway addresses indicates the index of the interface on the PC.</p>
<p class="docText">Netsh CLI is the recommended interface to set and display IPv6 parameters on Windows XP, but <span class="docEmphStrong">ipconfig</span> commands can also be used, as shown in <a class="docLink" href="#ch15ex04">Example 15-4</a>.</p>
<a name="ch15ex04"></a><H5 class="docExampleTitle">Example 15-4. Checking IPv6 Configuration on Microsoft Windows XP</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><TD>


<pre>C:\&gt;<span class="docEmphStrong">ipv6 install</span>
C:\&gt;<span class="docEmphStrong">ipconfig</span>
Windows IP Configuration
Ethernet adapter Wireless Network Connection:
        Connection-specific DNS Suffix  . :
        IP Address. . . . . . . . . . . . : 10.87.94.8
        Subnet Mask . . . . . . . . . . . : 255.255.255.0
        IP Address. . . . . . . . . . . . : <span class="docEmphMark">2002:5279:961b:1:f86e:7f1e:e4b3:6aa9</span>
        IP Address. . . . . . . . . . . . : <span class="docEmphMark">2002:5279:961b:1:202:8aff:fead:a836</span>
        IP Address. . . . . . . . . . . . : <span class="docEmphMark">fe80::202:8aff:fead:a836%4</span>
        Default Gateway . . . . . . . . . : 10.87.94.254
                                            <span class="docEmphMark">fe80::20d:bdff:fe99:f5f9%4</span>
C:\WINDOWS\system32&gt;<span class="docEmphStrong">netsh</span>
netsh&gt;<span class="docEmphStrong">interface ipv6</span>
netsh interface ipv6&gt;<span class="docEmphStrong">show address</span>
Querying active state...
Interface 4: Wireless Network Connection
Addr Type  DAD State  Valid Life   Pref. Life   Address
---------  ---------- ------------ ------------ -----------------------------
<span class="docEmphMark">Temporary Preferred    d23h34m50s   23h33m14s 2002:5279:961b:1:f86e:7f1e:e4b3:6aa9</span>
<span class="docEmphMark">Public    Preferred  29d23h59m39s 6d23h59m39s 2002:5279:961b:1:202:8aff:fead:a836 </span>
<span class="docEmphMark">Link      Preferred      infinite    infinite fe80::202:8aff:fead:a836  </span></pre><br>

</TD></TR></table></p>
<p class="docText">To verify the operation of IPv6, you can use the following:</P>
<ul><li><p class="docList">Ping6 on Windows XP. In <a class="docLink" href="#ch15ex05">Example 15-5</a>, we are pinging a well-known IPv6 Internet website named <a class="docLink" target="_blank" href="http://www.ipv6tf.org">www.ipv6tf.org</a>.</P></LI><LI><p class="docList">Traceroute on Windows XP to the same destination IPv6 host, as shown in <a class="docLink" href="#ch15ex06">Example 15-6</a>.</p></li></ul>
<a name="ch15ex05"></a><H5 class="docExampleTitle">Example 15-5. Verifying Operation with IPv6 Ping</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><TD>


<pre>C:\&gt;<span class="docEmphStrong">ping6 www.ipv6tf.org</span>
Pinging www.ipv6tf.org [2001:7f9:1000:1::103]
from 2002:5279:961b:1:f86e:7f1e:e4b3:6aa9 with 32 bytes of data:
Reply from 2001:7f9:1000:1::103: bytes=32 time=415ms
Reply from 2001:7f9:1000:1::103: bytes=32 time=379ms
Reply from 2001:7f9:1000:1::103: bytes=32 time=388ms
Reply from 2001:7f9:1000:1::103: bytes=32 time=407ms
Ping statistics for 2001:7f9:1000:1::103:
    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
    Minimum = 379ms, Maximum = 415ms, Average = 397ms</pre><br>

</td></tr></table></p>
<a name="ch15ex06"></a><H5 class="docExampleTitle">Example 15-6. Verifying Operation with IPv6 Traceroute</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><td>


<pre>C:\&gt;<span class="docEmphStrong">tracert www.ipv6tf.org</span>
Tracing route to www.ipv6tf.org [2001:7f9:1000:1::103]
over a maximum of 30 hops:

1     2 ms     2 ms     2 ms 2002:5279:961b:1:20d:bdff:fe99:f5f9
2   161 ms   162 ms   160 ms 3ffe:c15:c002:5000::2
3   223 ms   223 ms   223 ms 3ffe:c00:8023:29::2
4   323 ms   323 ms  321 ms us-nyc02a-re1-fe-0-0.ipv6.aorta.net [2001:730:0:4::1]
5   317 ms   314 ms   315 ms nl-ams06d-re1-t-9.ipv6.aorta.net [2001:730::1:61]
6   314 ms   314 ms   314 ms telianet-gw1.nl.ipv6.aorta.net [2001:730::1:35]
7   397 ms   507 ms   406 ms 2001:6c0:800:2009::2
8   396 ms   385 ms   384 ms 2001:7f9:1000:1::103
Trace complete.</pre><BR>

</td></tr></table></p>
<p class="docText">Then, an IPv6 video camera is attached to the IPv6 LAN segment. Bidirectional accessreception of the images, transmission of zoom commandsof the IPv6 video camera can be demonstrated as shown in <a class="docLink" href="#ch15fig04">Figure 15-4</a>.</p>
<a name="ch15fig04"></a><p><center>
<h5 class="docFigureTitle">Figure 15-4. IPv6 Video Camera View and Control</h5>
<p class="docText"><div class="v1"><a target="_self" href="images/15fig04_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="318" SRC="images/15fig04.jpg"></p>
</center></p><br>
<p class="docText">Other applications such as web browsing or video streaming can now be installed and verified on an IPv6 network layer.</p>
<a name="ch15lev2sec2"></a>
<h4 class="docSection2Title">Expanding the Test Bed</h4>
<p class="docText"><a name="iddle1279"></a><a name="iddle1325"></a>After successfully being able to communicate between the AC isolated IPv6 LAN segment and the IPv6 Internet, the test bed could now be expanded to include the following:</p>
<ul><LI><p class="docList">IPv6 hosts located on the AC headquarters campus</p></li><li><p class="docList">An AC DNS server able to register an IPv6 AAAA record</P></li><LI><p class="docList">Extension of IPv6 to remote locations</P></li></UL>
<a name="ch15lev3sec3"></a>
<h5 class="docSection3Title">Domain Name Service (DNS)</h5>
<p class="docText">The update of DNS service to support IPv6 is one of the mandatory elements of a successful IPv6 deployment. Several functions must be considered. First, the DNS servers must be IPv6 capable (for example, a server running BIND 9 release or at least one of its derivatives). The DNS database has to be populated with the new AAAA record type, which contains the address of the IPv6 hosts. Then (optionally but recommended), the IPv6 network layer needs to be supported on the DNS servers and clients.</P>
<p class="docText">DNS servers on the AC network are currently running BIND version 9.3.1, so the task is limited to the configuration of IPv6 registers on the DNS server and the registration of the IPv6 resources in the database.</P>
<a name="ch15note02"></a><div class="docNote"><p class="docNoteTitle">Note</P>

<p class="docText">Microsoft Windows XP does not support IPv6 network layer for its DNS Resolver application. The DNS Resolver runs over an IPv6 network layer on .NET Server 2003 (and in the future on the LongHorn release).</p>
</div><br>
<p class="docText">When querying DNS, an application might receive both IPv4 (A) and IPv6 (AAAA) records, which leaves the decision to prefer one over the other to the operating system. Failure to resolve DNS for one stack can potentially lead to a fallback to the other IP stack. Experience shows that it does not always work (perhaps because of a stack or a network connectivity issue). For this reason, AC would start the deployment with a specific naming for IPv6 resources: <a class="docLink" target="_blank" href="http://www.ipv6.ac.com">www.ipv6.ac.com</a> to avoid impacting end users. It is also a way to control the deployment of IPv6 applications, because, generally, names are preferred over IPv6 addresses by end users accessing a given resource. It is expected that .ipv6 can be removed in the future.</p>
<p class="docText"><a class="docLink" href="#ch15ex07">Example 15-7</a> illustrates a DNS record for an IPv6 news website, showing the following:</P>
<ul><li><p class="docList">AAAA record for <a class="docLink" target="_blank" href="http://ipv6.hs247.com">ipv6.hs247.com</a></P></LI><li><p class="docList">A plus AAAA records for <a class="docLink" target="_blank" href="http://www.hs247.com">www.hs247.com</a></p></li><li><p class="docList">A record for ipv4.hs247.com</P></li></ul>
<a name="ch15ex07"></a><H5 class="docExampleTitle">Example 15-7. DNS Lookup to Resolve a Name and IPv6 Address</h5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>C:\WINDOWS\system32&gt;<span class="docEmphStrong">nslookup</span>
Default Server:  dns-sjk.cisco.com
Address:  171.68.226.120
&gt; <span class="docEmphStrong">set type=all</span>
&gt; <span class="docEmphStrong">ipv6.hs247.com</span>
Server:  dns-sjk.cisco.com
Address:  171.68.226.120
Non-authoritative answer:
<span class="docEmphMark">ipv6.hs247.com  AAAA IPv6 address = 2001:1638::4:2</span>
hs247.com       nameserver = ns1.rdns.de
hs247.com       nameserver = ns2.rdns.de
ns2.rdns.de     internet address = 84.200.3.7
&gt;
&gt; <span class="docEmphStrong">www.hs247.com</span>
Server:  dns-sjk.cisco.com
Address:  171.68.226.120
Non-authoritative answer:
<span class="docEmphMark">www.hs247.com   AAAA IPv6 address = 2001:1638::4:2</span>
<span class="docEmphMark">www.hs247.com   internet address = 82.211.48.7</span>
hs247.com       nameserver = ns2.rdns.de
hs247.com       nameserver = ns1.rdns.de
ns2.rdns.de     internet address = 84.200.3.7
&gt;
&gt; <span class="docEmphStrong">ipv4.hs247.com</span>
Server:  dns-sjk.cisco.com
Address:  171.68.226.120
Non-authoritative answer:
<span class="docEmphMark">ipv4.hs247.com  internet address = 82.211.48.7</span>
hs247.com       nameserver = ns1.rdns.de
hs247.com       nameserver = ns2.rdns.de
ns2.rdns.de     internet address = 84.200.3.7
&gt;</pre><br>

</td></tr></table></p>

<a name="ch15lev3sec4"></a>
<h5 class="docSection3Title">ISATAP Router</h5>
<p class="docText"><a name="iddle1334"></a><a name="iddle1470"></a>The first step of the trial is to enable IPv6 connectivity to the Internet for hosts located on an isolated segment. The next step is to evaluate IPv6 communications within the headquarters campus. The population of end users selected to participate in this evaluation is too small to justify an upgrade of all layer 3 switches on the campus. Nevertheless, to meet the objectives of its increasing number of users, the AC IT team set upon the intraneta second Cisco 2821 (R5)shown in <a class="docLink" href="#ch15fig05">Figure 15-5</a>as an ISATAP router for use by internal AC users with manual configuration of the service. It is decided not to declare the ISATAP router into DNS to avoid the potential use of IPv6 through automatic tunneling. The IT team intends to keep the support costs and the test participants under control.</p>
<a name="ch15fig05"></a><p><center>
<h5 class="docFigureTitle">Figure 15-5. ISATAP Router in the AC Network</h5>

<p class="docText">
<img border="0" alt="" width="500" height="332" SRC="images/15fig05.jpg"></p>

</center></p><br>
<p class="docText"><a class="docLink" href="#ch15ex08">Example 15-8</a> shows the minimum required setting on router R5 for an ISATAP tunnel.</P>
<a name="ch15ex08"></a><h5 class="docExampleTitle">Example 15-8. ISATAP Configuration on Router R5</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><td>


<pre>R5#
ip cef
ipv6 unicast-routing
ipv6 cef
!
interface Tunnel100
no ip address
no ip redirects
       ipv6 address 2002:5279:961B:8888::/64 eui-64
no ipv6 nd suppress-ra
tunnel source Loopback0
       <span class="docEmphMark">tunnel mode ipv6ip isatap</span>
!
interface Loopback0
 ip address 10.151.151.7 255.255.255.255
!</pre><BR>

</TD></tr></table></P>
<p class="docText">After configuring router R5, you can check the status of interface Tunnel100, which is the ISATAP tunnel, as shown in <a class="docLink" href="#ch15ex09">Example 15-9</a>.</p>
<a name="ch15ex09"></a><h5 class="docExampleTitle">Example 15-9. Displaying ISATAP Tunnel Status</H5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><td>


<pre>R5# <span class="docEmphStrong">show ipv6 interface Tunnel100</span>
<span class="docEmphMark">Tunnel100 is up, line protocol is up</span>
  <span class="docEmphMark">IPv6 is enabled, link-local address is FE80::5EFE:5279:961B</span>
  <span class="docEmphMark">Global unicast address(es):</span>
<span class="docEmphMark">2002:5279:961B:8888:0:5EFE:5279:961B, subnet is</span>
<span class="docEmphMark">2002:5279:961B:8888::/64 [EUI]</span>
  Joined group address(es):
    FF02::1
    FF02::2
    FF02::D
    FF02::16
    FF02::1:FF79:961B
  MTU is 1480 bytes
  ICMP error messages limited to one every 100 milliseconds
  ICMP redirects are enabled
  ND DAD is not supported
  ND reachable time is 30000 milliseconds
  ND advertised reachable time is 0 milliseconds
  ND advertised retransmit interval is 0 milliseconds
  ND router advertisements live for 1800 seconds
Hosts use stateless autoconfig for addresses.</pre><br>

</td></TR></table></p>
<p class="docText">After an ISATAP router is operational, you can enable ISATAP on Windows XP. You do so with the following command, which manually enables the use of ISATAP:</p>
<div class="docText"><pre>C:\&gt;<span class="docEmphStrong">netsh interface ipv6 isatap set router 10.151.151.7</span></pre></div><BR>
<p class="docText">When executed on PC 10.149.2.60, you can check the ISATAP interface status (interface #2) as shown in <a class="docLink" href="#ch15ex10">Example 15-10</a>.</P>
<a name="ch15ex10"></a><h5 class="docExampleTitle">Example 15-10. ISATAP Status on Windows XP</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><TD>


<pre>C:\&gt;<span class="docEmphStrong">ipv6 if 2</span>
<span class="docEmphMark">Interface 2: Automatic Tunneling Pseudo-Interface</span>
{48FCE3FC-EC30-E50E-F1A7-71172AEEE3AE}
  does not use Neighbor Discovery
  uses Router Discovery
  routing preference 1
  <span class="docEmphMark">EUI-64 embedded IPv4 address: 10.149.2.60</span>
  router link-layer address: 10.151.151.7
    preferred <span class="docEmphMark">global 2002:5279:961B:8888:0:5efe:10.149.2.60</span>, life 16m14s (public)
    preferred link-local fe80::5efe:10.149.2.60, life infinite
  link MTU 1480 (true link MTU 65515)
  current hop limit 64
  reachable time 31500ms (base 30000ms)
  retransmission interval 1000ms
  DAD transmits 0
C:\&gt;</pre><br>

</td></TR></table></p>
<a name="ch15note03"></a><div class="docNote"><p class="docNoteTitle">Note</P>

<p class="docText">This ISATAP router can later benefit the remote users connecting to the headquarters sites via VPN using the Cisco VPN Client 4.x. They can set up an ISATAP tunnel to R5 over the established IPv4 VPN (see <a class="docLink" href="ch07.html#ch07">Chapter 7</a>, &quot;VPN IPv6 Architecture and Services&quot;).</p>
</div><br>

<a name="ch15lev3sec5"></a>
<h5 class="docSection3Title">IPv6 Internet-to-Campus Connectivity</h5>
<p class="docText"><a name="iddle1191"></a><a name="iddle1332"></a>After the ISATAP router R5 is operational, the overall campus has local IPv6 connectivity. To complete the trial and enable the connection with the IPv6 Internet through the 6to4 router (R7), additional configurations are required:</p>
<ul><li><p class="docList">To enable the communication between routers R7 and R5, which are on different sides of an IPv4-only firewall, the firewall must be configured to enable protocol 41 forwarding between the IPv4 addresses of both router R5 and R7. This particular setup blocks any other tunneled IPv6 connection not going through these two IT-controlled routers.</p><a name="ch15note04"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">Configuration of the firewall is not shown because it depends on the type of device installed to perform the functions. Moreover, this configuration involves only IPv4-related settings.</p>
</div><br></li><li><p class="docList">After the IPv4-only firewall is set up to allow protocol 41 to go through, a tunnel can be manually configured between R5 and R7 routers, as shown in <a class="docLink" href="#ch15fig06">Figure 15-6</a>. This provides the campus with access to the IPv6 Internet. Optionally, a dynamic routing protocol can be enabled to pass IPv6 routing information through the tunnel (for example, RIPng).</p><a name="ch15fig06"></a><p><center>
<H5 class="docFigureTitle">Figure 15-6. Expansion of the IPv6 Test Bed</h5>
<p class="docText"><div class="v1"><a target="_self" href="images/15fig06_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="265" SRC="images/15fig06.jpg"></p>
</center></p></LI></ul>
<p class="docText">The manually configured tunnel setup between routers R7 and R5 is shown on interfaces Tunnel10 in <a class="docLink" href="#ch15ex11">Example 15-11</a>. RIPng is also enabled on the interfaces to exchange routing information.</P>
<a name="ch15ex11"></a><H5 class="docExampleTitle">Example 15-11. Manually IPv6 Configured Tunnel Setup on Routers R5 and R7</h5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>On router R7
R7#
ip cef
ipv6 unicast-routing
ipv6 cef
!
<span class="docEmphMark">ipv6 router rip v6</span>
!
interface Tunnel10
 no ip address
 ipv6 address 2002:5279:961B:3::1/64
 <span class="docEmphMark">ipv6 rip v6 enable</span>
 tunnel source GigabitEthernet0/1.1
 tunnel destination 172.16.2.1
 <span class="docEmphMark">tunnel mode ipv6ip</span>
!
interface GigabitEthernet0/1.2
description === IPv6 vlan ===
 encapsulation dot1Q 2
ipv6 address 2002:5279:961B:1::/64 eui-64
<span class="docEmphMark">ipv6 rip v6 enable</span>
!
interface GigabitEthernet0/1.1
encapsulation dot1Q 1
 ip address 172.16.1.1 255.255.255.252
R7#
On Router R5
R5#
ip cef
ipv6 unicast-routing
ipv6 cef
!
<span class="docEmphMark">ipv6 router rip v6</span>
!
interface Tunnel10
 no ip address
 ipv6 address 2002:5279:961B:3::2/64
 <span class="docEmphMark">ipv6 rip v6 enable</span>
 tunnel source GigabitEthernet0/1
 tunnel destination 172.16.1.1
 <span class="docEmphMark">tunnel mode ipv6ip</span>
!
interface GigabitEthernet0/1
 ip address 172.16.2.1 255.255.255.252</pre><BR>

</TD></TR></table></p>
<ul><li><p class="docList">The IPv6 access to AC must be fully secured before opening the IPv6 IA to its users. Generally, the firewall does not inspect IP in IP traffic. It requires the IPv6 traffic to be filtered on R5 or R7 before it can be encapsulated in the manually configured tunnel. This can be done by setting reflexive ACLs or the via the Cisco IOS Firewall <a name="iddle1034"></a><a name="iddle1340"></a><a name="iddle1776"></a>IPv6 feature set (see <a class="docLink" href="ch09.html#ch09">Chapter 9</a>, &quot;Securing IPv6 Networks&quot;). Note that 6to4 tunnels can only be secured, by setting IPv4 IPsec between 6to4 routers, if used in a close environment that does not reach the IPv6 Internet through 6to4 relay.</P></li></ul>

<a name="ch15lev3sec6"></a>
<H5 class="docSection3Title">Expanding the IPv6 Intranet Testing</H5>
<p class="docText">With the ISATAP router up and running, all sites may now have active IPv6 end users. Nevertheless, the solution is not optimal for the remote sites because it creates a single IPv6 subnet that connects all IPv6 hosts in an overlay of the IPv4 infrastructure. An easy alternative to expand the test bed to remote locations is to set manually configured tunnels between their WAN gateway routers and the headquarters ones. For instance:</p>
<ul><li><p class="docList">One remote site is linked to the San Francisco headquarters through a leased line. It is an opportunity to test a dual-stack configuration over a PPP connection. Routers on both ends of the links are upgraded to the same Cisco IOS release as routers R5 and R7, and then IPv6 is enabled between sites.</p></LI><li><p class="docList">A remote site with broadband access will have a manually configured tunnel that runs over the VPN IPsec-encrypted tunnel. An alternative is to create a secure 6to4 tunnel (see <a class="docLink" href="ch03.html#ch03">Chapter 3</a>), but that would mean the site is not part of the intranet because the headquarters' 6to4 router (R7) is on the DMZ.</p></LI><li><p class="docList">Because the final IPv6 test network is limited to those two to three sites, static routes are good enough. Nevertheless, it is easy to turn on a routing protocol such as RIPng over the tunnels, as shown between R5 and R7 in the previous configuration.</P></li></ul>


<a name="ch15lev2sec3"></a>
<h4 class="docSection2Title">Lessons from the Trial</h4>
<p class="docText">The main conclusion at the end of the trial is that the basic IPv6 setup appears to be an easy task as long as all the prerequisite releases of software are installed. At the same time, it is clear that there is a need for more IPv6-capable applications. Evaluated operating system releases have a really limited set of applications able to run over an IPv6 network layer. It is an expected that the Microsoft next-generation operating system and Linux evolutions will result in all applications becoming more IP version agnostic. Based on the technology evaluation, the following guidelines were set:</p>
<ul><li><p class="docList">Better to focus on IPv6 deployment by beginning with one or more applications that can run over IPv6 and is either benefiting to the enterprise business or could lower the cost of support when run over IPv6.</p></li><li><p class="docList">AC will set criteria on acquisitions of new or updated applications as well as networking equipment. Products must integrate the support of IPv6, although it may not be deployed in the short term.</p></li><li><p class="docList"><a name="iddle1337"></a>Transition mechanisms such as 6to4 or ISATAP are easy to configure but they have some inherent limitations in terms of feature capabilities:</p><dl><dd><p class="docList">- Do not correspond to an IPv6 global prefix as allocated by the Registries and are not optimized for routing on production IPv6 Internet</p></dd><dd><p class="docList">- No support for IPv6 multicast</P></dd><dd><p class="docList">- Require an IPv4 address in case of ISATAP to set the interface ID value</p></dd><dd><p class="docList">- Add the tunnel overhead and may not deliver the best performances for communications</p></dd><dd><p class="docList">- Make troubleshooting more complex as an operator needs to understand both IPv4 and IPv6 topology to identify a problem</p></dd></dl></LI></ul>
<p class="docText">For the preceding reasons, summarized in <a class="docLink" href="#ch15table03">Table 15-3</a>, on a long-term basis AC will prefer a dual-stack infrastructure when cost is not an issue.</P>
<a name="ch15table03"></a><P><table cellspacing="0" class="allBorders" border="1" RULES="all" cellpadding="4"><caption><h5 class="docTableTitle">Table 15-3. Lessons Learned from Trialing Tunnels</H5></caption><colgroup><col width="130"><col width="185"><col width="185"></colgroup><thead><tr><th class="thead" scope="col" align="left" valign="top">&nbsp;</th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">6to4</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">ISATAP</P></th></TR></thead><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Scope</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">WAN</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Campus</P></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Traffic impact</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Return path through 6to4 relay may not be optimum</P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Dependent of the campus IPv4 infrastructure</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Address format</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Specific prefix</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Specific interface ID</p></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText">Renumbering when moving to production</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes, prefix</P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes, interface ID</P></td></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Multicast support</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">No</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">No</P></td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText">Security</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Can be secured by IPv4 IPsec when not using a 6to4 relay</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Follows host security</p></TD></tr></table></P><br>


<a href="22971536.html"><img src="images/pixel.jpg" alt="" width="1" height="1" border="0"></a></TD></TR></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch15lev1sec3.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch15lev1sec5.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
</body></html>