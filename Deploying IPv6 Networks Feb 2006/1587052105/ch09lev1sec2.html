<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>Tools Available for Securing IPv6 Networks</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch09lev1sec1.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch09lev1sec3.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><TD valign="top"><a name="ch09lev1sec2"></a>
<h3 class="docSection1Title" id="570594-982">Tools Available for Securing IPv6 Networks</H3>
<p class="docText">The threat analysis leads to the conclusion that more similarities than differences exist between IPv4 and IPv6 as far as security is concerned. Until end-to-end IPsec and a reliable key-distribution protocol is consistently deployed for IPv6, the proven IPv4 security best practices and tools should be used to secure the IPv6 networks, too. It is thus important to evaluate the IPv6 readiness of these tools. Although perimeter security is critical, security policies and tools are implemented and used in multiple parts of the network.</P>
<a name="ch09lev2sec5"></a>
<h4 class="docSection2Title">IPsec for IPv6</H4>
<p class="docText">IPsec is the networking community's answer to the need for secured communication. It was defined in RFC 2401, and conceptually it operates under the same principles in IPv4 and in IPv6.</p>
<a name="ch09lev3sec17"></a>
<h5 class="docSection3Title">IPsec Concepts</H5>
<p class="docText">The implementation of IPsec has two elements:</P>
<UL><li><p class="docList">Authentication Header (AH) is defined in RFC 2402, and it provides source authentication, connectionless integrity, and protection against replay. In IPv6, it is implemented through an AH extension header.</p></li><LI><p class="docList">Encapsulating Security Payload (ESP) is defined in RFC 2406, and it provides confidentiality, source authentication, connectionless integrity, and replay protection. In IPv6, it is implemented through an ESP extension header.</p></li></UL>
<p class="docText">You can use AH by itself (if regulations do not allow traffic to be encrypted and the use of an ESP).</P>
<p class="docText">There are two modes of securing the traffic between two hosts:</p>
<ul><li><p class="docText"><span class="docEmphStrong">Transport mode</span> In transport mode, IPsec is used end to end between the hosts. In this case, only the payload of the packet is secured. This is the model promoted by IPv6.</p></LI><li><p class="docText"><span class="docEmphStrong">Tunnel mode</span> In tunnel mode, the packets from a host are transported over a trusted network to a security gateway. They are then encapsulated in another packet and securely transported to the destination or to another security gateway that places them on another trusted network for the destination. In this case, the entire original packet, payload, and header are secured. This model is commonly used in IPv4 networks today.</p></LI></ul>
<p class="docText">In both cases, the process of securing the communication is started by establishing a security association (SA), which is a unidirectional logical connection that encompasses all the participating elements. These elements include the authentication algorithm, authentication key, encryption algorithm, encryption key, and so on. These parameters are negotiated between the two participants in the SA. In transport mode, a host clearly has to establish multiple SAs. It can differentiate between them by using a Security Parameters Index (SPI). These two IDs, the SA and the SPI, are referenced in every IPsec-protected packet.</P>
<p class="docText">In IPv6, two EHs were defined to support IPsec. <a class="docLink" href="#ch09fig03">Figure 9-3</a> shows their format.</p>
<a name="ch09fig03"></a><p><center>
<h5 class="docFigureTitle">Figure 9-3. Authentication and Encapsulating Security Payload EHs</h5>
<p class="docText"><div class="v1"><a target="_self" href="images/09fig03_alt.jpg">[View full size image]</a></div><img border="0" alt="" id="158039035251" width="500" height="347" SRC="images/09fig03.jpg"></p>
</center></p><br>
<p class="docText">The sequence number is a variable that is initialized to zero when the SA is set up. It ticks up with every packet sent, and that helps keep track of out-of-sequence packets and of played-back packets.</p>
<a name="ch09note15"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">The security key is one important element needed for authentication and encryption. Work is still being done to identify a reliable protocol for key distribution. Cisco IOS routers use Internet Security Association and Key Management Protocol (ISAKMP; IKEv1), as defined in RFC 2408, to provide key management and authentication. However, without a generally adopted authentication scheme, its use is limited in the public domain. Manually configured keys are always an option, but they pose provisioning and management challenges.</p>
</div><br>

<a name="ch09lev3sec18"></a>
<h5 class="docSection3Title">Using IPv4 IPsec to Secure IPv6 Tunnels</h5>
<p class="docText">IPsec is frequently deployed in today's IPv4 networks to secure communication over VPNs. It is used for access VPNs as well as inter-site VPNs. IPv6 transition mechanisms can leverage such an infrastructure to achieve a certain level of security, even in the absence of IPv6 IPsec.</p>
<p class="docText">Remote IPv4 hosts access private networks by establishing an encrypted access VPN to a gateway set up for these purposes. If the same host is enabled for IPv6, it can thread an IPv6 tunnel through this IPv4-secured communication channel. Because the IPv4 VPN places the remote host on the private network, a natural IPv6 tunnel choice is the Intra-Site Automatic Tunnel Addressing Protocol (ISATAP), which is suitable for intra-site communication. In practice, however, you can use any type of IPv6 tunnel as long as it is supported by the host and a gateway is set up for it inside the private network.</p>
<p class="docText">The configurations for the IPv4 access VPN and the IPv6 tunnel are completely independent. The IPv4 VPN configuration is beyond the scope of this book, but there are plenty of examples in references dedicated to this topic (refer, for example, to <span class="docEmphasis">IPSec VPN Design</span> by Vijay Bollapragada, <span class="docEmphasis">et al</span>.). <a class="docLink" href="ch03.html#ch03">Chapter 3</a>, &quot;Delivering IPv6 Unicast Services,&quot; contains router configuration examples for the various IPv6 tunnel types. From a host perspective, the tunnel configuration depends on the particular operating system used. For example, if ISATAP is used in the topology shown in <a class="docLink" href="ch03lev1sec3.html#ch03fig11">Figure 3-11</a> (<a class="docLink" href="ch03.html#ch03">Chapter 3</a>) and the host is running Windows XP, the host tunnel configuration would be just one line entered in the command window:</P>
<div class="docText"><pre>netsh interface ipv6 isatap set router 200.13.13.1</pre></div><br>
<p class="docText">In this example, the IPv4 VPN initiated by the host is terminated at the edge of the private network not identified in <a class="docLink" href="ch03lev1sec3.html#ch03fig11">Figure 3-11</a>.</p>
<a name="ch09note16"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">The IPv4 MTU of the host is usually lowered for the IPv4 VPN. The same should be done for the IPv6 MTU to avoid fragmentation.</P>
</div><br>
<p class="docText">The &quot;Topologies Examples&quot; section of <a class="docLink" href="ch07.html#ch07">Chapter 7</a> shows an example of how to secure the IPv6 traffic between two routers by setting up an IPv6 tunnel through an inter-site IPv4 IPsec VPN. Although the example discusses the case of a manually configured tunnel, the same concept applies to any IPv6 tunnel type, static or dynamic. The example uses a static crypto map, which implies the fact that the routers have fixed IPv4 addresses and are using shared keys. You can implement dynamic maps when the routers acquire their IPv4 addresses dynamically, as in the case of remote sites provisioned every time they connect to the network.</P>

<a name="ch09lev3sec19"></a>
<H5 class="docSection3Title">Securing Routerto-Router Communication with IPv6 IPsec</h5>
<p class="docText">Until IPv6 IPsec is extensively and uniformly deployed as suggested by RFC 2460, it can still be used on a smaller scale. IPv6 IPsec can be leveraged to secure both the control and the data plane between two routers. The &quot;<a class="docLink" href="ch04lev1sec4.html#ch04lev2sec3">OSPFv3</a>&quot; section of <a class="docLink" href="ch04.html#ch04">Chapter 4</a>, &quot;IPv6 Routing Protocols,&quot; shows an example of using IPsec (with static key) to secure a routing protocol. Cisco IOS software also offers a mechanism for securing the data traffic between two routers through a new type of tunnel that employs IPv6 IPsec. IKEv1 is used for key management. <a class="docLink" href="#ch09fig04">Figure 9-4</a> shows a topology in which this feature is used between Routers A and B.</P>
<a name="ch09fig04"></a><p><center>
<h5 class="docFigureTitle">Figure 9-4. Using IPv6 IPsec to Secure the Data Exchange Between Two Routers</H5>
<p class="docText"><div class="v1"><a target="_self" href="images/09fig04_alt.jpg">[View full size image]</a></div><img border="0" alt="" id="158039035251" width="500" height="389" SRC="images/09fig04.jpg"></P>
</center></P><br>
<p class="docText"><a name="iddle1058"></a><a name="iddle1890"></a>Except for the tunnel itself, the configuration of this feature is similar to that used in securing the communication between two routers with IPv4 IPsec. On Router A, the steps to configure the IPsec portion are as follows:</p>
<ul><LI><p class="docList">Create the ISAKMP policy. Pre-shared keys are used in this example:</p><div class="docText"><pre>crypto isakmp policy 1
  authentication pre-share</pre></div></li><LI><p class="docList">Define the pre-shared key and the address of the peer:</P><div class="docText"><pre>crypto isakmp key myPreshareKey0 address ipv6 2001:B:1::1/128</pre></div></li><li><p class="docList">Configure the IPsec transform set that will be offered during negotiation to support ESP/3DES and the integrity algorithm:</p><div class="docText"><pre>crypto ipsec transform-set 3des ah-sha-hmac esp-3des</pre></div></li><LI><p class="docList">Define the IPsec parameters that are to be used for IPsec encryption between the two IPsec routers:</p><div class="docText"><pre><span class="docEmphMark">crypto ipsec profile ExampleIPsec</span>
  set transform-set 3des</pre></div></li></UL>
<p class="docText"><a class="docLink" href="#ch09fig04">Figure 9-4</a> shows the tunnel interface configuration for each router.</p>
<p class="docText">The operation of this feature is similar to the IPv4 one, so the same troubleshooting commands and methods apply in the case of IPv6 IPsec (refer to <span class="docEmphasis">IPSec VPN Design</span> by V. Bollapragada, <span class="docEmphasis">et al</span>.). This is a useful tool to secure the inter-site communication.</P>


<a name="ch09lev2sec6"></a>
<h4 class="docSection2Title">Access Control Lists</h4>
<p class="docText">Access control lists have proven themselves to be versatile instruments in identifying targeted traffic for further or particular processing or for filtering. For the most part, the IPv6 ACLs are similar to the IPv4 ACLs, but a few differences are worth pointing out:</p>
<ul><li><p class="docList">The packet header format offers several extra fields that should be recognized by the ACLs.</p></li><li><p class="docList">New ICMP types are supported.</p></li><li><p class="docList">The implicit rules of the ACLs need to account for the fact that the ND process relies on a layer 3 protocol (ICMPv6).</p></li><li><p class="docList">The use of multiple addresses per interface has to be accounted for when designing the ACLs.</p></LI><li><p class="docList">IPv6's renumbering features can present challenges for ACLs when two different prefixes coexist on a given network segment.</p></li><LI><p class="docList">The existence of potentially multiple EHs makes the ACL matching against the first fragment nondeterministic.</p></LI></UL>
<p class="docText">The differences between the IPv4 and IPv6 ACLs stem from the IPv6 protocol specificities that have been discussed throughout this book.</p>
<a name="ch09lev3sec20"></a>
<H5 class="docSection3Title">Extended IPv6 ACLs and Stateful Filtering</h5>
<p class="docText"><a name="iddle1055"></a><a name="iddle1059"></a><a name="iddle1354"></a><a name="iddle1944"></a>Extended ACLs are supported for IPv6 in a similar way to IPv4. Numbered ACLs are not supported for IPv6. Additional parameters are available to deal with some of the IPv6 protocol and operational specifics listed earlier.</p>
<a name="ch09ex01"></a><H5 class="docExampleTitle">Example 9-1. Options Available in Cisco IOS Command Line When Configuring an IPv6 Access List</H5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>Router(config)#<span class="docEmphStrong">ipv6 access-list EXAMPLE</span>
Router(config-ipv6-acl)#<span class="docEmphStrong">permit host 2001:1::1 2001:2::/64 ?</span>
  dscp        Match packets with given dscp value
  flow-label  Flow label
  fragments   Check non-initial fragments
  log         Log matches against this entry
  log-input   Log matches against this entry, including input
  reflect     Create reflexive access list entry
  routing     Routing header
  sequence    Sequence number for this entry
  time-range  Specify a time-range</pre><br>

</TD></tr></table></p>
<p class="docText">The implicit rules at the end of the IPv6 ACLs reflect the operational importance of ND. They permit the neighbor advertisement and neighbor solicitation ICMP traffic, as shown here:</P>
<div class="docText"><pre>permit icmp any any nd-na
permit icmp any any nd-ns
deny ipv6 any any</pre></div><BR>
<p class="docText">Similar to IPv4, if the packet does not meet any of the matching criteria, it is dropped by default.</p>
<a name="ch09note17"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">The implicit rules for the IPv6 ACLs do not take into account the fact that IPv6 hosts need to do PMTU Discovery. To allow the PMTU Discovery process to work through the filters, the ICMPv6 Type 2 (Packet Too Big) packets have to be allowed through in both directions.</p>
</div><br>
<p class="docText">Stateful filtering is supported with IPv6 ACLs, too. The <span class="docEmphStrong">reflect</span> option enables an ACL's <span class="docEmphStrong">permit</span> statement to generate an access entry for the return packets of a flow it allowed through (refer to the book <span class="docEmphasis">Implementing Cisco IPv6 Networks</span> by Regis Desmeules). This dynamic access entry can be in turn applied to other ACLs with the use of the keyword <span class="docEmphStrong">evaluate</span>, as shown in <a class="docLink" href="#ch09ex02">Example 9-2</a>.</P>
<a name="ch09ex02"></a><h5 class="docExampleTitle">Example 9-2. Reflexive Access List Configuration Example</h5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><TD>


<pre>interface FastEthernet6/1.10
 ipv6 address 2001:1::1/64
 ipv6 traffic-filter <span class="docEmphStrong">IN</span> in
 ipv6 traffic-filter <span class="docEmphStrong">OUT</span> out

ipv6 access-list <span class="docEmphStrong">IN</span>
  permit tcp any eq www host 2001:2::1 reflect <span class="docEmphStrong">REF</span>
ipv6 access-list <span class="docEmphStrong">OUT</span>
  evaluate <span class="docEmphStrong">REF</span></pre><br>

</td></tr></table></p>
<p class="docText"><a name="iddle1056"></a><a name="iddle1060"></a><a name="iddle1379"></a><a name="iddle1445"></a><a name="iddle1878"></a>Based on the ACL called IN, any www TCP connection request that comes inbound interface FastEthernet6/1.10 for the server 2001:2::1 will be allowed through. For each connection, a dynamic permit entry is built under REF for the reply packet coming from the server. REF is included in the ACL called OUT, which will apply the return path dynamic entry outbound on the interface.</p>
<p class="docText">The reflexive ACL entries are active for a period of time (3 minutes by default) or until a FIN is detected for a TCP session.</p>
<a name="ch09note18"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">The implicit <span class="docEmphStrong">deny any any</span> does not apply at the end of reflexive ACLs. Multiple <span class="docEmphStrong">evaluate</span> entries are allowed per ACL.</p>
</div><br>
<p class="docText">Time-based ACLs can be created for IPv6 in the same fashion as for IPv4. They identify ACLs that are valid only for certain time intervals.</p>

<a name="ch09lev3sec21"></a>
<h5 class="docSection3Title">IPv6 ACLs and Fragmentation</h5>
<p class="docText">When IP packets are fragmented, not all the fragments contain the information relevant to the ACL matching process. In IPv4, most of the layer 3 and layer 4 information is available in the first fragment, so the ACL can perform a full match on it. The noninitial fragments typically would not contain the layer 4 information, so at most a match can be done on the layer 3 header. Because a host cannot use the noninitial fragments if the first fragment was filtered, it is safe to apply an ACL statement that contains layer 4 criteria only on the first fragment. The keyword <span class="docEmphStrong">fragment</span> in an IPv4 ACL indicates that after the layer 3 information is checked, all noninitial fragments are permitted or pushed through the subsequent ACL line depending on whether the statement is a <span class="docEmphStrong">permit</span> or a <span class="docEmphStrong">deny</span> (refer to the Cisco document &quot;Access Control Lists and IP Fragments&quot; at <a class="docLink" target="_blank" href="http://www.cisco.com">Cisco.com</a>).</p>
<p class="docText">In IPv6, on the other hand, the router has to first parse through several Next headers before reaching the Fragmentation header to extract the information on the fragment. Then it must parse through some more EHs to get to the upper-layer information. Therefore, the first fragment might not contain all the necessary information. In IPv6 ACLs, the keyword <span class="docEmphStrong">fragment</span> has the same meaning as in IPv4 with the exception that the filter applies to all noninitial fragments as well if the upper-layer protocol cannot be determined from the first fragment.</p>
<a name="ch09note19"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">IPv6 supports a new keyword, <span class="docEmphStrong">undetermined-transport</span>, for matching IPv6 packets for which the layer 4 information could not be extracted.</P>
</div><br>
<p class="docText"><a name="iddle1044"></a><a name="iddle1054"></a>Firewalls can handle fragmented packets comprehensively. They can track all fragments by source address, destination address, protocol, and IP ID. This allows both the PIX and the Cisco IOS Firewall to apply the filtering policies to all fragments without any of the assumptions mentioned earlier.</p>

<a name="ch09lev3sec22"></a>
<h5 class="docSection3Title">IPv6 Access List Example</H5>
<p class="docText">The concepts presented in this section of the chapter are captured in a practical example for the topology shown in <a class="docLink" href="#ch09fig05">Figure 9-5</a>.</p>
<a name="ch09fig05"></a><P><center>
<H5 class="docFigureTitle">Figure 9-5. Topology for the Access List Example</h5>
<p class="docText"><div class="v1"><a target="_self" href="images/09fig05_alt.jpg">[View full size image]</a></div><img border="0" alt="" id="158039035251" width="500" height="238" SRC="images/09fig05.jpg"></P>
</center></p><br>
<p class="docText">The edge router (ER) has to implement the following policies with the help of ACLs:</P>
<UL><LI><p class="docList">Stop traffic with unique-local source addresses from leaving the internal network. It should log any attempts to do so to track misconfigured hosts.</p></li><li><p class="docList">Block any outside traffic with the routing EH.</P></li><li><p class="docList">Deny any outside traffic with undetermined transport.</P></LI><li><p class="docList">Allow only DNS traffic from 2001:B:1::/64 to reach the DNS server and for the DNS to reply to that traffic.</p></li><li><p class="docList">Allow only WWW traffic from 2001:B:1::/64 to reach the web server daily between 8 a.m. and 5 p.m.</P></li><li><p class="docList">Allow traffic necessary to support the PMTU Discovery process.</P></li><LI><p class="docList">Secure the Telnet access to the router.</p></li><li><p class="docList">Permit all traffic sourced from inside of the network if it uses the global unicast address.</p></li></ul>
<p class="docText">These conditions are met with the ACL and interface configuration shown in <a class="docLink" href="#ch09ex03">Example 9-3</a>.</p>
<a name="ch09ex03"></a><h5 class="docExampleTitle">Example 9-3. Access List Configuration Implementing the Policies Listed Above</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>interface FastEthernet0/0
 ipv6 address 2001:1:1::1/64
 ipv6 traffic-filter <span class="docEmphStrong">EXAMPLE-IN</span> in
 ipv6 traffic-filter <span class="docEmphStrong">EXAMPLE-OUT</span> out
!
interface FastEthernet0/1
 ipv6 address 2001:A:1::1/64
 ipv6 address FD01:A:1::1/64
!
ipv6 access-list <span class="docEmphStrong">EXAMPLE-IN</span>
 deny ipv6 any any routing deny
 ipv6 any any undetermined-transport
 permit udp 2001:B:1::/64 host 2001:A:1::D eq domain reflect REF-D
 permit tcp 2001:B:1::/64 host 2001:A:1::F eq www time-range TimeExample reflect
   REF-T
 permit icmp any 2001:A:1::/64 packet-too-big
!
ipv6 access-list <span class="docEmphStrong">EXAMPLE-OUT</span>
 deny ipv6 FD00::/8 any log
 evaluate REF-D
 evaluate REF-T
 permit ipv6 2001:A:1::/64 any
 permit icmp any any nd-na
 permit icmp any any nd-ns
 deny ipv6 any any
!
ipv6 access-list <span class="docEmphStrong">VTY-protection</span>
 permit tcp FD00::/8 any eq telnet
 permit icmp any any nd-na
 permit icmp any any nd-ns
 deny ipv6 any any log
!
time-range TimeExample
 periodic daily 8:00 to 17:00
!
line vty 0 4
 ipv6 access-class <span class="docEmphStrong">VTY-protection</span> in</pre><br>

</td></tr></table></P>
<p class="docText"><a name="iddle1357"></a><a name="iddle1891"></a>The output of <span class="docEmphStrong">show ipv6 access-list</span> summarizes the filtering policies configured on the router.</p>


<a name="ch09lev2sec7"></a>
<h4 class="docSection2Title">Firewall Functions</h4>
<p class="docText">Firewalls have been mentioned as powerful tools used to enforce security policies at the edge of the network. <a class="docLink" href="ch09.html#ch09fig01">Figure 9-1</a> depicts the most commonly deployed security topology in IPv4, with the focus on the firewall. Such perimeter defenses will most likely be used in IPv6 networks, too.</P>
<p class="docText">Two types of firewalls are offered through Cisco products: Cisco IOS Firewall features and the PIX family of products. Both these options are widely used in IPv4 networks, and now they support IPv6, too.</p>
<a name="ch09lev3sec23"></a>
<H5 class="docSection3Title">Cisco IOS Firewall</H5>
<p class="docText"><a name="iddle1178"></a><a name="iddle1356"></a>The Cisco IOS Firewall capabilities are often used in current IPv4 deployments. Many of these capabilities have been extended to support IPv6 (refer to the Cisco document &quot;Implementing Security for IPv6&quot; at <a class="docLink" target="_blank" href="http://www.cisco.com">Cisco.com</a>):</p>
<UL><li><p class="docList">Packet fragment inspection uses the virtual fragment reassembly (VFR) to check for out-of-sequence fragments and duplicated fragments to identify possible DoS attacks.</p><a name="ch09note20"></a><div class="docNote"><p class="docNoteTitle">Note</P>

<p class="docText">The Cisco IOS Firewall inspects the following IPv6 packet header fields: Traffic Class, Flow Label, Payload Length, Next Header, Hop Limit, and Source/Destination Address.</P>
</div><BR></li><li><p class="docList">IPv6 DoS attack mitigation is implemented in exactly the same way as in IPv4.</p></LI><li><p class="docList">Tunneled packet inspection is not performed inside the encapsulating IPv4 packet, but it can be done on the decapsulated IPv6 packet.</p></LI><LI><p class="docList">Stateful inspection of UDP, TCP, ICMP, and FTP sessions.</p></li><li><p class="docList">Stateful inspections of packets that are translated between IPv4 and IPv6.</p></LI><li><p class="docList">It handles EHs, Routing, Hop-by-Hop, Options, and Fragment headers.</p></LI><li><p class="docList">Port-to-application mapping (PAM) is a feature that enables network administrators to customize the TCP and UDP ports being used (that is, so that they are different from the well-known ports). This feature enables them to exercise content-based access control even on a wider range of ports.</P></li></ul>
<a name="ch09note21"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">Cisco IOS Intrusion Detection System (IDS) does not support IPv6 at the time of this writing.</p>
</div><br>
<p class="docText">Cisco IOS Firewall can perform these firewall features for both IPv4 and IPv6 at the same time and on the same interfaces.</p>
<p class="docText">Cisco IOS Firewall feature configuration involves several considerations. You can modify various parameters that are used for decision making in the inspection process in the global configuration, as shown in <a class="docLink" href="#ch09ex04">Example 9-4</a>.</p>
<a name="ch09ex04"></a><h5 class="docExampleTitle">Example 9-4. Cisco IOS Firewall Feature Configuration Options</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>Router(config)#<span class="docEmphStrong">ipv6 inspect ?</span>
  alert-off       Disable alert
  audit-trail     Enable the logging of session information (addresses and
                  bytes)
  hashtable-size  Specify size of hashtable

  max-incomplete  Specify maximum number of incomplete connections before
                  clamping
  name            Specify an inspection rule
  one-minute      Specify one-minute-sample watermarks for clamping
  routing-header  Enable session routing header inspection
  tcp             Config timeout values for tcp connections
  udp             Config timeout values for udp flows</pre><br>

</td></tr></table></P>
<a name="ch09note22"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">It is also important to enable audit capabilities of the router that would track the inspect process. The feature is enabled with the global configuration command <span class="docEmphStrong">ipv6 inspect audit-trail</span>.</p>
</div><br>
<p class="docText">You can define inspection policies to include the various protocols recognized. The policy defined in <a class="docLink" href="#ch09ex05">Example 9-5</a> is named FW-EXAMPLE, and it includes inspection of all supported protocols: FTP, UDP, TCP and ICMP.</P>
<a name="ch09ex05"></a><h5 class="docExampleTitle">Example 9-5. Security Policy Configuration Example</H5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><TD>


<pre>Router(config)#<span class="docEmphStrong">ipv6 inspect name FW-EXAMPLE ftp timeout 100</span>
Router(config)#<span class="docEmphStrong">ipv6 inspect name FW-EXAMPLE udp timeout 100</span>
Router(config)#<span class="docEmphStrong">ipv6 inspect name FW-EXAMPLE tcp timeout 100</span>
Router(config)#<span class="docEmphStrong">ipv6 inspect name FW-EXAMPLE icmp timeout 60</span>
Router#<span class="docEmphStrong">show ipv6 inspect all</span>
<span class="docEmphMark">Session audit trail is enabled</span>
<span class="docEmphMark">Session alert is enabled</span>
Routing Header inspection is disabled
one-minute (sampling period) thresholds are [400:500] connections
max-incomplete sessions thresholds are [400:500]
max-incomplete tcp connections per host is 50. Block-time 0 minute.
tcp synwait-time is 30 sec -- tcp finwait-time is 5 sec
tcp idle-time is 3600 sec -- udp idle-time is 30 sec
icmp idle-time is 10 sec
Session hash table size is 1021
Inspection Rule Configuration
 Inspection name FW-EXAMPLE
    <span class="docEmphMark">ftp alert is on audit-trail is on timeout 100</span>
    <span class="docEmphMark">udp alert is on audit-trail is on timeout 100</span>
    <span class="docEmphMark">tcp alert is on audit-trail is on timeout 100</span>
    <span class="docEmphMark">icmp alert is on audit-trail is on timeout 60</span></pre><br>

</td></TR></table></P>
<p class="docText">After it has been defined, the policy is applied inbound or outbound to the interfaces of interest, as shown in <a class="docLink" href="#ch09ex06">Example 9-6</a>.</P>
<a name="ch09ex06"></a><h5 class="docExampleTitle">Example 9-6. Applying Security Policies to Router Interfaces</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><td>


<pre>Router(config-subif)#<span class="docEmphStrong">interface FastEthernet6/1.10</span>
Router(config-subif)#<span class="docEmphStrong">ipv6 inspect FW-EXAMPLE in</span>
Router#<span class="docEmphStrong">show ipv6 inspect interface</span>
Interface Configuration
 Interface FastEthernet6/1.10
  <span class="docEmphMark">Inbound inspection rule is FW-EXAMPLE</span>
    ftp alert is on audit-trail is on timeout 100
    udp alert is on audit-trail is on timeout 100
    tcp alert is on audit-trail is on timeout 100
    icmp alert is on audit-trail is on timeout 60
  Outgoing inspection rule is not set</pre><br>

</TD></TR></table></p>
<p class="docText"><a name="iddle1359"></a><a name="iddle1717"></a>To troubleshoot the inspection process, you can turn on the corresponding <span class="docEmphStrong">debug</span>. In <a class="docLink" href="#ch09ex07">Example 9-7</a>, the router is inspecting ICMPv6 traffic.</p>
<a name="ch09ex07"></a><h5 class="docExampleTitle">Example 9-7. Sample Debug of the Packet-Inspection Process</h5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>Router#<span class="docEmphStrong">debug ipv6 inspect icmp</span>
Mar 10 17:48:43.797: CBAC sis 69E1EAC4 L4 inspect result: PASS packet 6724896C (
2001:2:2:1::1:0) (2001:2:C1:A001::2:0) bytes 1448 icmp
Mar 10 17:48:45.797: CBAC sis 69E1EAC4 L4 inspect result: PASS packet 67249D34 (
2001:2:2:1::1:0) (2001:2:C1:A001::2:0) bytes 1448 icmp</pre><BR>

</td></TR></table></p>
<p class="docText">The other important tool used to properly inspect the traffic is the virtual reassembly process, which has to be enabled on the interface, as shown in <a class="docLink" href="#ch09ex08">Example 9-8</a>.</p>
<a name="ch09ex08"></a><h5 class="docExampleTitle">Example 9-8. Enabling Virtual Reassembly on a Router Interface</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>Router(config-subif)#<span class="docEmphStrong">interface FastEthernet6/1.10</span>
Router(config-subif)#<span class="docEmphStrong">ipv6 virtual-reassembly</span>
Router#<span class="docEmphStrong">show ipv6 virtual-reassembly FastEthernet6/1.10</span>
%Interface FastEthernet6/1.10
   IPv6 configured concurrent reassemblies (max-reassemblies): 64
   IPv6 configured fragments per reassembly (max-fragments): 16
   IPv6 configured reassembly timeout (timeout): 3 seconds
   IPv6 configured drop fragments: OFF
   IPv6 current reassembly count:1
   IPv6 current fragment count:3
   IPv6 total reassembly count:25
   IPv6 total reassembly timeout count:0</pre><br>

</td></tr></table></p>
<p class="docText"><a class="docLink" href="#ch09ex08">Example 9-8</a> captures the output of the <span class="docEmphStrong">show virtual-reassembly</span> command for the interface of interest. It lists the number of packets processed and the number of fragments that are being processed at the time.</p>

<a name="ch09lev3sec24"></a>
<h5 class="docSection3Title">PIX Firewall</h5>
<p class="docText">The PIX Firewall is a device dedicated to implementing perimeter security policies. It is widely deployed in existent IPv4 networks, so it is important to understand its IPv6 capabilities. PIX Firewalls will most likely be used to secure IPv6 services, too.</p>
<p class="docText"><a name="iddle1022"></a><a name="iddle1108"></a><a name="iddle1766"></a><a name="iddle1889"></a><a name="iddle2036"></a><a name="iddle2063"></a>PIX software release 7.0 is the first to support IPv6. It can perform security checks of IPv6 headers and EHs, multiple protocol (ICMP, UDP, TCP, SMTP, and HTTP) inspection, and through the adaptive security algorithm (ASA) it can perform stateful application inspection. For device-management purposes, the HTTP, SSH, and Telnet clients were also modified to support IPv6.</P>
<a name="ch09note23"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">In the PIX 7.0 software release, the Cisco Firewall does not support multicast except for what is necessary for autoconfiguration and ND. Multicast security can be implemented on the edge routers.</p>
</div><br>
<p class="docText">The IPv6 instructions for the PIX are Cisco IOS Firewall based, so they match the commands described in the &quot;Access Lists&quot; section of this chapter.</P>


<a name="ch09lev2sec8"></a>
<h4 class="docSection2Title">Authentication, Authorization, and Accounting</H4>
<p class="docText">The authentication, authorization, and accounting (AAA) functions are critical in any deployment. AAA is used to manage users and devices or to collect service-usage information for billing. At the same time, AAA is a security tool, too. No large-scale IPv6 deployment could be rolled out without available AAA supporting IPv6.</P>
<p class="docText">In the first phase of the Cisco IPv6 implementation, the IPv6 AAA features were implemented by extending some of the vendor-specific attributes (VSAs) used for IPv4. Some of these VSAs have counterpart attributes that are RFC 3162 compliant and implemented for RADIUS. <a class="docLink" href="#ch09table02">Table 9-2</a> summarizes the IPv6 RADIUS attributes and VSAs, and includes a brief description of their scope (refer to the Cisco document &quot;Cisco IOS IPv6 Configuration Library&quot; at <a class="docLink" target="_blank" href="http://www.cisco.com">Cisco.com</a>).</p>
<a name="ch09table02"></a><P><table cellspacing="0" class="allBorders" border="1" RULES="all" cellpadding="4"><caption><h5 class="docTableTitle">Table 9-2. IPv6 AAA and RADIUS Attributes</h5></caption><colgroup><col width="150"><col width="100"><col width="250"></colgroup><thead><TR><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">RADIUS Attributes (RFC 3162)</P></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">VSAs</P></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Description</p></th></tr></thead><tr><TD class="docTableCell" align="left" valign="top"><p class="docText">NAS-IPv6-Address</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText"></P></td><td class="docTableCell" align="left" valign="top">&nbsp;</td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Framed-Interface-Id</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText"></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">It is a per-user attribute used during IPv6 Control Protocol (IPv6CP) negotiation to indicate the IPv6 interface identifier to be configured.</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Framed-IPv6-Prefix</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">IPv6 Prefix#</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">It is a per-user attribute used to indicate the prefix to be configured on the user in the case of virtual access. This prefix is advertised in the ND messages. The network access server (NAS) installs a static route for the prefix.</p></td></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Login-IPv6-Host</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText"></P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">It is a per-user attributed that indicates the system that the user connects with when the Login-Service attribute is present.</P></td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><a name="iddle1896"></a><a name="iddle1936"></a><a name="iddle1951"></a><a name="iddle2025"></a><a name="iddle2035"></a>Framed-IPv6-Route</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">IPv6 Route</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">It is a per-user attribute that specifies the routing information that should be configured for the user on the NAS.</p></TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Framed-IPv6-Pool</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">IPv6 Pool</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">It is a per-user attribute that identifies a pool from which prefixes are assigned to the user. The pool can be configured on routers or RADIUS servers.</p></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">IPv6 ACL</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">It specifies a full ACL that is applied to an interface while a user is logged in.</p></td></tr></table></p><br>
<p class="docText">The configuration of these attributes is straightforward. <a class="docLink" href="#ch09ex09">Example 9-9</a> shows a user's profile configured on the RADIUS servers. When the user connects to the NAS via PPP, it is provided with the global prefix 2001:A:1::/64. An ACL will be applied outbound to stop any traffic sourced from the unique-local addresses used internally.</p>
<a name="ch09ex09"></a><H5 class="docExampleTitle">Example 9-9. RADIUS Server User Profile Example</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><TD>


<pre>user@isp.net Password = secret
        Service-Type = Framed,
        Framed-Protocol = PPP,
        Cisco-AVpair = "ipv6:prefix#1=2001:A:1::/64",
        Cisco-AVPair = "ipv6:outacl#1=deny FD00::/8 any"</pre><br>

</TD></TR></table></p>
<p class="docText">These AAA features are important, particularly in the case of broadband deployments where large numbers of users have to be managed.</P>
<a name="ch09note24"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">The RADIUS server must be IPv6 aware to be able to handle some of the IPv6-specific attributes.</p>
</div><BR>
<p class="docText">The other option for implementing the AAA functions is to use Terminal Access Controller Access Control System Plus (TACACS+). Despite being more versatile than RADIUS, TACACS+ is not as commonly deployed because it is more resource intensive (requires more processing and memory). At the time of this writing, TACACS+ is not implemented for IPv6 on Cisco IOS software.</P>

<a name="ch09lev2sec9"></a>
<H4 class="docSection2Title">Unicast Reverse Path Forwarding</h4>
<p class="docText">Security policies that implement source address verification are important in eliminating spoofing attacks. These policies prevent spoofing of the source addresses at the prefix level. They should be implemented as close as possible to the location of unsecured devices and hosts.</p>
<p class="docText">An access network is a typical scenario where such policies can be applied. The service provider operating the network wants to make sure that its customers do not attempt to spoof an address on a different prefix from their own. <a class="docLink" href="#ch09fig06">Figure 9-6</a> shows the case where Host A is stopped from sending traffic using the address of Host B as a source address.</p>
<a name="ch09fig06"></a><P><center>
<h5 class="docFigureTitle">Figure 9-6. Securing an Access Network from Internally Sourced Spoofing Attacks</h5>
<p class="docText"><div class="v1"><a target="_self" href="images/09fig06_alt.jpg">[View full size image]</a></div><img border="0" alt="" id="158039035251" width="500" height="415" SRC="images/09fig06.jpg"></P>
</center></P><br>
<p class="docText">The intent is to verify at the access router that customer packets received on an interface have a source address that belongs to the prefixes known (based on the routing table) to be out that interface. Access lists can, of course, be applied inbound to filter the traffic accordingly; however, this can involve management and provisioning burdens. Another way to achieve the same goal in a dynamic manner is to implement for unicast a mechanism similar to Reverse Path Forwarding (RPF) used in multicast forwarding. Unicast Reverse Path Forwarding (uRPF) checks the routing information to verify that the prefix of an inbound packet's source address is known to be reachable out the interface it was received on. The actual reverse lookup is done in the Cisco Express Forwarding (CEF) forwarding table.</p>
<a name="ch09note25"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">All equal-cost paths are considered valid by the reverse lookup.</p>
</div><BR>
<p class="docText">If the reverse path calculated for the source address does not match the interface on which the packet was received or the source address cannot be identified (malformed source address), the packet is dropped.</p>
<p class="docText"><a name="iddle1205"></a><a name="iddle1768"></a><a name="iddle1894"></a><a name="iddle1970"></a>This feature implements dynamically the functions of an inbound ACL. It is currently available in Cisco IOS software for both IPv4 and IPv6, and it represents a simple one-line interface configuration, as shown on <a class="docLink" href="#ch09fig06">Figure 9-6</a>. If an ACL is designated at the end of the command <span class="docEmphStrong">ipv6 verify unicast reverse-path</span>, the router applies it to the packet that failed the RPF check. The advantage of using the ACL option is that the ACL can be configured to log the matches and provide information that can be used to track policy violators.</p>
<a name="ch09ex10"></a><H5 class="docExampleTitle">Example 9-10. uRPF Configuration Example</h5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>interface ATM0/0/0.1 point-to-point
 ipv6 address 2001:1:1:1::1/64
 ipv6 verify unicast reverse-path exampleRPF
 pvc 1/32
encapsulation aal5snap
<span class="docEmphMark">ipv6 access-list exampleRPF</span>
 <span class="docEmphMark">permit ipv6 2001:1:1:1::/64 any log-input</span>
 <span class="docEmphMark">deny ipv6 any any log-input</span></pre><br>

</td></tr></table></p>
<p class="docText">The ACL can simply be configured to permit all traffic and log it, in which case the violators of uRPF are let through but the violation is logged.</p>
<a name="ch09note26"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">The uRPF, as discussed so far, operates in what is called a <span class="docEmphasis">strict mode</span>. In strict mode, the router verifies that the source address exists in the Forwarding Information Base (FIB) and that it is also known to be reachable out its interface that received the packet. The verification requirements can be relaxed, leading to a &quot;loose mode&quot; uRPF where the router only verifies a source's reachability by checking for its existence in the FIB table and not the interface it belongs to. The Cisco IOS command to enable the feature is <span class="docEmphStrong">ipv6 verify unicast reachable-via &lt;<span class="docEmphasis">reachability-options</span>&gt;</span>.</p>
</div><br>
<p class="docText">Depending on platform, the performance impact of enabling these features should be considered.</p>

<a name="ch09lev2sec10"></a>
<h4 class="docSection2Title">Protecting the Control Plane with Rate Limiting</h4>
<p class="docText">To defend the network infrastructure from attacks, it is important to protect the control-plane resources of the network elements. Router resources (memory/CPU) on the line card or the route processor can be depleted by being overwhelmed with traffic that appears to be important to the control plane. Under such circumstances, the critical processes that maintain the router's integration in the network can be severely impacted.</p>
<p class="docText">This type of threat has been identified in the case of IPv4. IPv6 introduces new venues to attack a router's control plane, such as flooding it with router solicitation traffic or packets with the routing header.</p>
<a name="ch09note27"></a><div class="docNote"><p class="docNoteTitle">Note</P>

<p class="docText"><a name="iddle1858"></a>A router can be configured using the <span class="docEmphStrong">no ipv6 source-route</span> command to stop processing packets that contain the source routing header.</p>
</div><br>
<p class="docText">At first, IPv6 services are likely to be considered of lower priority than the existent revenue-generating IPv4 services. This means that a router's control plane has to be particularly protected against IPv6 threats.</p>
<p class="docText">Certain types of traffic can be intelligently filtered out, but others cannot be identified a priori as a potential threat. In some of these cases, the attack is identified simply by the high rate of traffic received by the router. One defense against these flooding attacks is to limit that rate of traffic accepted by the router and thus preserve a minimum amount of CPU and memory for the control-plane operation.</P>
<p class="docText">The implementation of such mitigation plans depends on platform. Some platforms incorporate rate-limiting protection mechanisms in their default behavior, whereas others need to be configured for it. Some implement it in hardware, whereas others configure it in software. Cisco IOS command line offers a dedicated interface for configuring traffic rate limiting specifically for protecting a router's control plane, as shown here:</p>
<div class="docText"><pre>Router(config)#<span class="docEmphStrong">control-plane</span>
Router(config-cp)#<span class="docEmphStrong">service-policy input &lt;policy-name&gt;</span></pre></div><BR>
<p class="docText">This interface leverages the standard QoS tools. A service policy has to be defined based on the guidelines discussed in <a class="docLink" href="ch05.html#ch05">Chapter 5</a>, &quot;Implementing QoS.&quot;</P>


</TD></TR></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch09lev1sec1.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch09lev1sec3.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
</body></html>