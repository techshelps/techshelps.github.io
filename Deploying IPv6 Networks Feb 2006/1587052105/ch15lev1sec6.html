<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>Design and Setup</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch15lev1sec5.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch15lev1sec7.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><TD valign="top"><a name="ch15lev1sec6"></a>
<h3 class="docSection1Title">Design and Setup</H3>
<p class="docText">Lessons learned during the trial period were positive enough to get the management approval for an IPv6 integration project. As with any networking project, there are several steps to go through before advertising IPv6 as a production service. One initial step is to develop a <a name="iddle1066"></a><a name="iddle1322"></a>design of the IPv6 intranet and issue AC policies before the start of the rollout. This section does not indicate the amount of time required to achieve each phase. It is assumed that several months would be needed, depending on parameters such as IT department workload, cost control, and the availability of stable and affordable commercial solutions. Mandatory steps include the following:</P>
<ul><LI><p class="docList">Definition of the IPv6 addressing scheme and rules</p></li><LI><p class="docList">Guidelines for IPv6 integration on existing intranet, including</P><dl><dd><p class="docList">- Selection of routing protocol(s)</P></dd><dd><p class="docList">- High-availability options on AC LANs</p></dd></dl></li><li><p class="docList">Planning of IPv6 services to be set up, compliant with the requirements defined by the AC IT department:</P><dl><dd><span class="docText">- <span class="docEmphStrong">Security</span> Must provide a level of security equivalent with to that for IPv4 from day one for every site that is updated. Must also cope with the specifics of IPv6, including new services such as IP mobility.<br><br></span></dd><dd><span class="docText">- <span class="docEmphStrong">Network management</span> Integration of the IPv6 configuration and traffic management in the actual IPv4 NMS system is mandatory. Optionally, SNMP and management applications could run over an IPv6 network layer. Networking devices must support Management Information Bases (MIBs) for IPv6 statistics.<BR><BR></span></dd><dd><span class="docText">- <span class="docEmphStrong">Multicast</span> IPv4 multicast is an experimental service on the AC network. The operational side of dealing with multicast through NAT to cover the remote site was seen as too complex. IPv6 multicast service should become the de facto production service for multicast. AC expects to decrease the cost of operations and ease the full deployment of multicast.<br><br></span></dd><dd><span class="docText">- <span class="docEmphStrong">Mobility</span> This is a new service for AC. It will start as experimental. The purpose is to enable the deployment of new appliances and expand Internet connectivity in the AC fleet of vehicles.<br><br></span></dd><dd><span class="docText">- <span class="docEmphStrong">QoS</span> The goal is to ensure optimal operation of applications independently of the network layer protocol. Same QoS rules must apply to both IP versions.<BR><br></span></dd></dl></li></UL>
<a name="ch15note05"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">Because of the large number of options when designing an enterprise or commercial intranet, this section is not an exhaustive list of actions. You should tailor these guidelines to your own environment and add any necessary additional steps.</P>
</div><br>
<a name="ch15lev2sec6"></a>
<h4 class="docSection2Title">IPv6 Addressing</h4>
<p class="docText">Similar to the IPv4 design, one of the first actions is to define an address scheme. The next section introduces the AC plans for prefix and host address assignments.</p>
<a name="ch15lev3sec7"></a>
<h5 class="docSection3Title">Prefix-Assignment Scheme</h5>
<p class="docText">At the time of this writing, the Registries only allocate an IPv6 prefixa ::/32 or greater address spaceto ISPs, NRNs, and government agencies, meaning an enterprise must get an IPv6 prefix (::/48) from its ISP. Part of the IPv6negotiation with T-World was the subscription of a prefix for AC; it is assigned 2001:0DB8:ACAC::/48.</p>
<p class="docText">The remaining 16 bits' significance has to be defined. They will be partitioned based on the scheme shown in <a class="docLink" href="#ch15table04">Table 15-4</a>.</p>
<a name="ch15table04"></a><p><table cellspacing="0" class="allBorders" border="1" RULES="all" cellpadding="4"><caption><h5 class="docTableTitle">Table 15-4. AC Corporation IPv6 Addressing Scheme</h5></caption><colgroup><col width="200"><col width="200"><col width="100"></colgroup><thead><tr><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Region ID (3 Bits)</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Headquarters and Attached Sites (5 Bits)</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Link ID per Site (8 Bits)</p></th></TR></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText">North America (000)</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">San Francisco (00000)</P>
<p class="docText">Atlanta (00100)</P>
<p class="docText">Montreal (10000)</p>
</TD><td class="docTableCell" align="left" valign="top"><p class="docText">00-FF</p></TD></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Europe (001)</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Budapest (00000)</p>
<p class="docText">Paris (00100)</p>
</TD><TD class="docTableCell" align="left" valign="top"><p class="docText">00-FF</p></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText">Asia-Pacific (010)</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Hong Kong (00000)</p>
<p class="docText">Sydney (00100)</P>
<p class="docText">Tokyo (10000)</p>
</td><td class="docTableCell" align="left" valign="top"><p class="docText">00-FF</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Africa and Middle East (011)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Dubai (00000)</p>
<p class="docText">Johannesburg (00100)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">00-FF</P></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText">Latin and Central America (100)</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Buenos Aires (00000)</p>
<p class="docText">Mexico City (00100)</P>
</td><td class="docTableCell" align="left" valign="top"><p class="docText">00-FF</P></TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Reserved for future (101111)</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Reserved for future</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">00-FF</p></td></tr></table></p><BR>

<a name="ch15lev3sec8"></a>
<h5 class="docSection3Title">Address Configuration Rules</h5>
<p class="docText">Although IPv6 specifications define the support of stateful and stateless autoconfiguration mechanisms to assign an IPv6 address to a host interface, as discussed in <a class="docLink" href="ch03.html#ch03">Chapter 3</a>, most of the host implementations only support the stateless option. This means there are only two modes of IPv6 address allocation that can be practically considered for a deployment: manual or stateless.</P>
<p class="docText">With the prefix provided, the host needs an interface ID. There are several ways in which the interface ID can be selected. It can be manually configured, it can be derived from the MAC address following the EUI-64 rules, or it can be built using the &quot;privacy extensions&quot; defined in RFC 3041 (as described in <a class="docLink" href="ch02.html#ch02">Chapter 2</a>, &quot;An IPv6 Refresher&quot;). Remember that an IPv6 host interface may have a set of unicast addresses in use.</p>
<p class="docText"><a name="iddle1291"></a><a name="iddle1326"></a>The following guidelines were established for selecting interface IDs in the AC IPv6 network:</P>
<ul><li><p class="docList">DNS servers and network management stations get an IPv6 address manually configured. For resources not to be known from the Internet (for instance, NMSs), it is recommended to not set an obvious interface ID, such as x::1/128, to avoid easy distributed denial-of-service (DDoS) attacks.</p></li><li><p class="docList">Application servers get an IPv6 interface ID manually configured unless they support Dynamic DNS, in which later case they can use stateless autoconfiguration with EUI-64.</p></li><li><p class="docList">Networking devices can use EUI-64 as the interface ID, but at least one interfacetypically loopbackmust have an address with the interface ID manually configured for network management purposes. This eliminates the device reachability dependency on its hardware information. A complete swap of hardware can take place in case of failure, and the device will remain reachable by the NMS after the device configuration is reloaded.</p></li><li><p class="docList">On point-to-point links, the 2001:0DB8:ACAC:nnnn::/64 prefix will be preferred to keep the configuration simple and aligned with the IPv6 address architecture (RFC 3513). For more information, refer also to RFC 3627.</p></li><li><p class="docList">Hosts actually configured through DHCP for IPv4 get their IPv6 address through stateless autoconfiguration.</p></LI><li><p class="docList">Hosts supporting &quot;privacy extensions&quot; interface IDs must have a default value of 24 hours. Privacy extensions is a new capability, and its impact on traceability and managing DDoS threats may not be fully understood. Nevertheless, the basic policies related to the use of privacy extensions are as follows:</p><dl><dd><p class="docList">- No host ACL should be used unless it only permits a specific IPv6 address and deny all.</p></dd><dd><p class="docList">- A user-tracking network management application is required to identify the hosts.</P></dd></dl></li></UL>


<a name="ch15lev2sec7"></a>
<H4 class="docSection2Title">Dual-Stack Deployment</h4>
<p class="docText">The initial trial lessons and list of identified services AC intends to run over IPv6 led the team to choose a dual-stack approach. After running a network inventory, the needs to upgrade some hardware and software releases are known by the AC IT team and adequately budgeted in association with other programs for the next fiscal year.</P>
<p class="docText">On campus LANs, layer 3 switches will be configured to run native IPv6for instance, Catalyst 6500 series with supervisor engine 720 and native Cisco IOS 12.2(18)SXE release or Catalyst 3750 series and Cisco IOS 12.2(25)SEA release as minimum.</p>
<p class="docText"><a name="iddle1341"></a><a name="iddle1737"></a><a name="iddle1839"></a>Remote sites connected through leased lines will get their router software releases updated to support dual-stack operation. To reduce the labor costs, this upgrade will be associated with the update program to the Cisco 1800 and 2800 series. The minimum release to match AC service needs is Cisco IOS 12.4(2)T. <a class="docLink" href="#ch15table05">Table 15-5</a> summarizes the platform/IOS mapping targeted for the deployment.</p>
<a name="ch15table05"></a><P><table cellspacing="0" class="allBorders" border="1" RULES="all" cellpadding="4"><caption><H5 class="docTableTitle">Table 15-5. Platforms and Minimum Cisco IOS Software Used in the IPv6 Deployment</H5></caption><colgroup><col width="200"><col width="150"><col width="150"></colgroup><thead><tr><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Network Location</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Hardware Platform</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Software(IOS)</P></th></tr></thead><tr><TD class="docTableCell" align="left" valign="top"><p class="docText">Main campus</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Catalyst 6500</p>
<p class="docText">SUP-720</p>
<p class="docText">Cisco 3750</P>
</td><td class="docTableCell" align="left" valign="top"><p class="docText">12.2(18)SXE</P>
<p class="docText">12.2(25)SEA</p>
</TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Remote sites' WAN router</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Cisco 1800</p>
<p class="docText">Cisco 2800</p>
</td><td class="docTableCell" align="left" valign="top"><p class="docText">12.4(2)T</p>
<p class="docText">12.4(2)T</p></td></tr></table></p><BR>
<p class="docText">Remote sites connected via broadband access will have an IPv6-configured tunnel setup. Because IPv4 is the primary service and is already protected via the VPN tunnel between site-to-site routers to one of the main AC campuses, there is no local access security concern about adding IPv6 services. The configured tunnel allows the allocation of global IPv6 prefixes in accordance with AC rules. The addition of a global IPv6 prefix to those sites that are configured with a single static IPv4 address on the WAN link and private address on LAN ease the potential deployment of multicast and peer-to-peer applications. The IPv6 manually configured tunnels do not have to be terminated on the same device as the IPv4 IPsec VPN tunnel. When possible, they will get terminated on a Catalyst 6500 supervisor engine 720 that does support this tunnel mechanism in hardware.</p>

<a name="ch15lev2sec8"></a>
<h4 class="docSection2Title">Routing Protocols</h4>
<p class="docText">To keep the learning curve and operational process at a minimal level, similar routing protocols will be deployed for IPv6 and IPv4, meaning EIGRP for IGP and MP-BGP4 for peering with T-World (see <a class="docLink" href="ch04.html#ch04">Chapter 4</a>, &quot;IPv6 Routing Protocols,&quot; for details and configuration on these protocols).</P>
<p class="docText">In the final phase of the project, the entire network is converted to dual stack. In an effort to keep the operational and management tasks as simple as possible, it is decided to align the IPv4 and IPv6 topologies for all routers and links in the network. The routing protocol parameters are configured to get all traffic flowing through similar paths. This decision is taken to ease the operational support, to avoid complex troubleshooting where communications between two nodes could work for a given IP version but not the other because different paths followed through the network.</p>

<a name="ch15lev2sec9"></a>
<H4 class="docSection2Title">First-Hop Router Redundancy</H4>
<p class="docText"><a name="iddle1328"></a><a name="iddle1638"></a><a name="iddle1639"></a><a name="iddle1640"></a><a name="iddle1665"></a><a name="iddle1773"></a><a name="iddle1814"></a>IPv6 hosts on a broadcast link learn about the presence of one or more gateways by receiving Router Advertisements (RAs) sent using the IPv6 Neighbor Discovery Protocol (see <a class="docLink" href="ch02.html#ch02">Chapter 2</a>). The Router Advertisements are periodically sent via multicast at a rate high enough to ensure that hosts learn about the routers in the span of a few minutes, which therefore removes the need to set a &quot;default gateway&quot; (as in the case of IPv4). The selection of a given router depends on the host IPv6 stack implementation. On the other hand, by default, RAs are not sent frequently enough to rely on the absence of the router advertisement to detect router failures. Therefore, there is a need for tuning the ND process and leveraging additional protocols to improve the availability of first-hop routers:</p>
<UL><li><p class="docList">Tuning ICMPv6 and Neighbor Discovery</p></LI><LI><p class="docList">Configuring Default Router Selection</P></li><li><p class="docList">Enabling one of the first-hop redundancy router protocols: Cisco Hot Standby Router Protocol (HSRP), Cisco Gateway Load Balancing Protocol (GLBP), or Virtual Router Redundancy Protocol (VRRP)</p></LI></ul>
<a name="ch15note06"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">IETF Mobile IPv6 specification (RFC 3775) reduces the minimum RA interval significantly.</P>
</div><BR>
<a name="ch15lev3sec9"></a>
<h5 class="docSection3Title">Tuning Neighbor Discovery</h5>
<p class="docText">Neighbor Discovery (<a class="docLink" href="ch02.html#ch02">Chapter 2</a>) includes a mechanism called Neighbor Unreachability Detection (NUD), which is used to detect the failure of a neighbor node (router or host) or the forwarding path to a neighbor. This is done by sending Neighbor Solicitation messages to the neighbor node. To reduce the overhead of sending Neighbor Solicitations, the messages are only sent to neighbors to whom the node is actively sending traffic and only after there has been no positive indication that the router is up for a period of time. Using the default parameter<span class="docEmphStrong">ipv6 nd reachable-time</span>it will take a host about 30 seconds to learn that a router is unreachable before it will switch to another router. This delay would be noticeable to users and can cause some transport protocol implementations to time out.</p>
<p class="docText">In the absence of any other first-hop router redundancy protocol, such as Cisco HSRP, tuning of NUD is a useful alternative. Setting of the <span class="docEmphStrong">ipv6 nd reachable-time</span> parameter to a more aggressive value allows the speedup of the switchover time, but it has the downside of significantly increasing the overhead of ND traffic. This would be specially noticeable when there are hundreds of hosts on a link (because they all would try to determine the reachability of their gateways). A good tradeoff between potential ND bursts and switchover times seems to be 15 seconds versus the 30-second default value.</p>
<p class="docText"><a class="docLink" href="#ch15ex12">Example 15-12</a> shows how to configure the ND Reachable timer on a router's interface.</P>
<a name="ch15ex12"></a><h5 class="docExampleTitle">Example 15-12. ND Reachable Timer Configuration</h5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><TD>


<pre>R1#
!
interface GigabitEthernet0/1
ipv6 address 2001:DB8:ACAC:1::/64 eui-64
<span class="docEmphMark">ipv6 nd reachable-time 15000</span>
!</pre><br>

</td></tr></table></p>
<a name="ch15note07"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText"><a name="iddle1228"></a><a name="iddle1287"></a><a name="iddle1324"></a>There is no reason to tune other IPv6 ND timers to achieve first-hop router redundancy.</p>
</div><br>
<p class="docText">On an AC network, this will only be configured when Cisco HSRP for IPv6 or other first-hop redundancy mechanisms are not available on layer 3 switches or routers; otherwise, default value are kept.</p>

<a name="ch15lev3sec10"></a>
<h5 class="docSection3Title">Configuring Default Router Selection</h5>
<p class="docText">Because IPv6 ND did not initially specify a way to set a default router, IPv6 hosts learn about all routers available on a LAN through the ND RA mechanism. It is the responsibility of the hosts to maintain a default router list from which one is selected for forwarding traffic to off-link destinations. The selection for a destination is then cached, and the implementation of selecting gateways can be round robin or &quot;always the same.&quot;</p>
<p class="docText">This is simple and works well in most cases, but in some situations, it is suboptimal:</p>
<ul><li><p class="docList">Some form of traffic engineering is desired (for example, when two routers on a link provide equivalent, but not equal-cost, routing). Policy may dictate that one is preferred. These are two relevant examples:</p><dl><dd><p class="docList">- &quot;Accidentally&quot; deploying a new router before it has been fully configured could lead to hosts adopting it as a default router and traffic being black-holed. Management may want to indicate that some routers are more preferred than others.</P></dd><dd><p class="docList">- Multiple routers that route to distinct sets of prefixes. Redirects (sent by nonoptimal routers for a destination) mean that hosts can choose any router and the system will work. But traffic patterns may mean that choosing one of the routers would lead to considerably fewer redirects.</p></dd></dl></li><li><p class="docList">The IPv6 router selection IETF Internet Draft (draft-ietf-ipv6-router-selection) defines two optional extensions to ND RA messages:</P><dl><dd><span class="docText">- <span class="docEmphasis">Default Router Preferences (DRP)</span> A coarse preference metric for default routers. This is an extremely simple extensionjust the definition of a few unused bits in existing RA messages to address the first example mentioned above.<br><BR></span></dd><dd><span class="docText">- <span class="docEmphasis">More-Specific Routes (MSR)</span> <a name="iddle1560"></a><a name="iddle1594"></a>An option to allow routers to specify routes more specific than the default route, together with a lifetime; a coarse preference metric for each such routes to address the second case mentioned above.<BR><br></span></dd></dl></LI></ul>
<p class="docText">Both are backward compatible with the existing RA mechanism and host behavior. DRP can be implemented without implementing MSR.</p>
<a name="ch15note08"></a><div class="docNote"><p class="docNoteTitle">Note</P>

<p class="docText">At the time of this writing, Cisco IOS software only implements the DRP function. On the host side, the feature is also supported on Microsoft Windows XP and .NET Server 2003.</P>
</div><BR>
<p class="docText">By default, Cisco IOS routers send RAs with a preference of <span class="docEmphStrong">medium</span>. The <span class="docEmphStrong">no</span> version of the command returns the configuration to the default value. On AC LANs, the routers managed by the IT will be set to <span class="docEmphStrong">high</span> to avoid basic misconfiguration in case a new router is added to a segment.</p>
<p class="docText"><a class="docLink" href="#ch15ex13">Example 15-13</a> shows router preference set up to <span class="docEmphStrong">high</span> on a router's interface loaded with Cisco IOS Release 12.4(2)T.</p>
<a name="ch15ex13"></a><h5 class="docExampleTitle">Example 15-13. Router Preference Setup</H5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><TD>


<pre>R1#
!
interface Ethernet0/0
ipv6 address 2001:DB8:ACAC:10::/64 eui-64
ipv6 nd reachable-time 15000
<span class="docEmphMark">ipv6 nd router-preference High</span>
!</pre><BR>

</td></tr></table></p>
<p class="docText"><a class="docLink" href="#ch15ex14">Example 15-14</a> shows the command to check the configuration of both ND reachable timer and router preference.</p>
<a name="ch15ex14"></a><H5 class="docExampleTitle">Example 15-14. Display of ND Reachable Timer and Router Preference Setup</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><td>


<pre>R1#<span class="docEmphStrong">show ipv6 inter e0/0</span>
Ethernet0/0 is up, line protocol is up
  IPv6 is enabled, link-local address is FE80::A8BB:CCFF:FE00:1F00
  Global unicast address(es):
    2001:DB8:ACAC:10:A8BB:CCFF:FE00:1F00, subnet is 2001:DB8:ACAC:10::/64 [EUI]
  Joined group address(es):
    FF02::1
    FF02::2
    FF02::1:FF00:1F00
  MTU is 1500 bytes
  ICMP error messages limited to one every 100 milliseconds
  ICMP redirects are enabled
  ICMP unreachables are sent
  ND DAD is enabled, number of DAD attempts: 1
<span class="docEmphMark">ND reachable time is 15000 milliseconds</span>
<span class="docEmphMark">ND advertised default router preference is High</span></pre><BR>

</td></tr></table></p>

<a name="ch15lev3sec11"></a>
<h5 class="docSection3Title">Enabling Cisco HSRP for IPv6</h5>
<p class="docText"><a name="iddle1177"></a>A first-hop redundancy protocol, such as Cisco HSRP, can provide a much faster switchover to an alternate router than can be obtained using standard ND procedures. Using HSRP, a backup router can take over for a failed default router in about 10 seconds using default parameters, or less than 1 second if millisecond HSRP timers are used. This is done without any interaction with the hosts, and with a minimum amount of HSRP traffic.</p>
<p class="docText">Most IPv4 hosts have a single router IP address configured as the default gateway. When Cisco HSRP is set up, the HSRP virtual IPv4 address is configured as the hosts' default gateway rather than the router IP address.</p>
<p class="docText">Most changes to HSRP for IPv6 are to the ND functions (Neighbor Advertisement, Router Advertisement, and ICMPv6 redirects).</p>
<p class="docText">An HSRP IPv6 group has a virtual MAC addressblock different from the Cisco HSRP one for IPv4that is derived from the HSRP group number. A virtual IPv6 link-local address is also derived, by default, from the HSRP virtual MAC address.</p>
<a name="ch15note09"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">The Cisco HSRP for IPv6 virtual MAC address block0005.73A0.0000 through 0005.73A0.0FFFUDP port number 2029, has been provisionally allocated to HSRP IPv6 by the IANA.</p>
</div><br>
<p class="docText">A common way to form an IPv6 link-local address is by appending an interface ID to the prefix FE80::/64. The interface ID for an HSRP group is based on the EUI-64 identifier derived from the HSRP group virtual MAC address. The EUI-64 is formed as shown in <a class="docLink" href="ch02.html#ch02">Chapter 2</a>. For the MAC address 0005.73A0.0001, the interface ID is 00-05-73-FF-FE-A0-00-01, and the IPv6 link-local address is FE80::5:73FF:FEA0:1. Note that the U/L it is set to 0, indicating local significance.</p>
<p class="docText">Periodic RAs are sent for the HSRP virtual IPv6 link-local address when the HSRP group is active. These RAs stop after a final RA is sent when the group leaves the active state. No restrictions occur for the interface IPv6 link-local address other than that mentioned for the RAs. Other protocols continue to receive and send packets to this address.</p>
<p class="docText">In the case of IPv4, simple load sharing may be achieved by using two HSRP groups and configuring half the hosts with one virtual IP address and half the hosts with the other virtual IP address. In contrast, on IPv6 this happens by default. If there are two HSRP IPv6 groups on a link, the hosts learn of both through IPv6 ND RA messages. They are either multicast periodically, or solicited by hosts. Then a host chooses to use onedepending on the IPv6 stack implementationsuch that the load is shared among the advertised routers. Typically, a host may use a round-robin scheme to decide which to use from the list of learned routers.</p>
<p class="docText">Cisco HSRP is an efficient mechanism designed to provide high availability of first-hop routers for IPv6 hosts. It is therefore decided that on AC LANs, when several routers are available on a given links for IPv6 hosts, HSRP for IPv6 will be configured as shown in <a class="docLink" href="#ch15fig07">Figure 15-7</a>.</P>
<a name="ch15fig07"></a><p><center>
<h5 class="docFigureTitle">Figure 15-7. High Availability on AC LANs</h5>

<p class="docText">
<img border="0" alt="" width="500" height="298" SRC="images/15fig07.jpg"></P>

</center></p><BR>
<p class="docText"><a class="docLink" href="#ch15ex15">Example 15-15</a> shows a configuration for routers R1 and R2 that requires a Cisco IOS Release 12.4(4)T as minimum:</P>
<a name="ch15ex15"></a><h5 class="docExampleTitle">Example 15-15. Cisco HSRP for IPv6 Configuration</H5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><TD>


<pre>Router R1
R1#
!
interface Ethernet0/0
ipv6 address 2001:DB8:ACAC:10::/64 eui-64
ipv6 nd reachable-time 15000
ipv6 nd router-preference High
<span class="docEmphMark">standby version 2</span>
<span class="docEmphMark">standby 0 ipv6 autoconfig</span>
!
R1#
Router R2
R2#
!
interface Ethernet0/0
ipv6 address 2001:DB8:ACAC:10::/64 eui-64
ipv6 nd reachable-time 15000
ipv6 nd router-preference High
<span class="docEmphMark">standby version 2</span>
<span class="docEmphMark">standby 0 ipv6 autoconfig</span>
!
R2#</pre><BR>

</TD></tr></table></p>
<p class="docText"><a name="iddle1342"></a><a name="iddle1862"></a>To verify the HSRP activation, the <span class="docEmphStrong">show standby</span> command can be used, as shown in <a class="docLink" href="#ch15ex16">Example 15-16</a>.</p>
<a name="ch15ex16"></a><H5 class="docExampleTitle">Example 15-16. Display of Cisco HSRP for IPv6 Setup</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><TD>


<pre>Router R1
R1#<span class="docEmphStrong">show standby</span>
Ethernet0/0 - Group 0 (version 2)
  State is Standby
    1 state change, last state change 1d23h
  Virtual IP address is FE80::5:73FF:FEA0:0
  Active virtual MAC address is 0005.73a0.0000
    Local virtual MAC address is 0005.73a0.0000 (v2 IPv6 default)
  Hello time 3 sec, hold time 10 sec
    Next hello sent in 1.436 secs
  Preemption disabled
  Active router is FE80::A8BB:CCFF:FE00:6900, priority 100 (expires in 8.048 sec)
    MAC address is aabb.cc00.6900
  Standby router is local
  Priority 100 (default 100)
  IP redundancy name is "hsrp-Et0/0-0" (default)
R1#
Router R2
R2#<span class="docEmphStrong">show standby</span>
Ethernet0/0 - Group 0 (version 2)
  State is Active
    2 state changes, last state change 1d23h
  Virtual IP address is FE80::5:73FF:FEA0:0
  Active virtual MAC address is 0005.73a0.0000
    Local virtual MAC address is 0005.73a0.0000 (v2 IPv6 default)
  Hello time 3 sec, hold time 10 sec
    Next hello sent in 2.872 secs
  Preemption disabled
  Active router is local
  Standby router is FE80::A8BB:CCFF:FE00:6600, priority 100 (expires in 7.540 sec)
  Priority 100 (default 100)
  IP redundancy name is "hsrp-Et0/0-0" (default)</pre><br>

</td></tr></table></p>
<p class="docText">Network managers may want to configure another FHRP protocol to achieve a similar behavior. On Cisco IOS implementations, alternatives are either VRRP, if interoperability with other vendors' routers is required, or Cisco GLBP, when multiple upstream paths are available to improve performance by facilitating better use of network resources. Then, additional configuration options, such as Enhanced Object Tracking, can be turned on when available for IPv6.</P>


<a name="ch15lev2sec10"></a>
<h4 class="docSection2Title">Securing the IPv6 Deployment</h4>
<p class="docText">As extensively described in <a class="docLink" href="ch09.html#ch09">Chapter 9</a>, IPv6 security is a mix of challenges, both those that are IPv4 similar and potentially new challenges. By default, IPv4 security policies will be applied to IPv6 as well on the AC intranet. The IPv6 deployment will also benefit from all the underlying security mechanisms already in place for IPv4 (for example, AC has already secured the layer 2 access of its network with the wireless infrastructure).</P>
<p class="docText"><a name="iddle1338"></a><a name="iddle1606"></a>Products currently deployed as IPv4 firewalls have to be upgraded to a software release supporting IPv6. When not possible, the upgrade of the current hardware to a new generation of firewall with IPv6 support must be planned. The IPv4 configuration of the firewalls has to be updated to block uncontrolled IPv6 over IPv4 tunnels from being set up across the AC network perimeter. Devices performing intrusion detection system (IDS) functions should also be evaluated for an immediate upgrade to IPv6 support.</p>
<p class="docText">The IPv6-specific security guidelines outlined in <a class="docLink" href="ch09.html#ch09">Chapter 9</a> are also formalized and implemented by the operation team in the AC network. With regard to security challenges raised by the new services deployed over IPv6, multicast and Mobile IP have to be addressed. The most important aspects of securing the multicast service relate to multicast domain management. The control and data multicast traffic has to be contained at the boundaries and blocked from entering the network. The RPs have to also be protected against possible DDoS. For the experimental deployment of MIPv6, an extended ACL will be edited to filter on the routing header Type field, permitting type = 2 (MIPv6) and denying type = 0 (source route) as available on Cisco IOS Release 12.4(2)T. See <a class="docLink" href="ch09.html#ch09">Chapter 9</a> for configuration details.</P>
<p class="docText">The Cisco 2821 router configured as an ISATAP router in the initial trial will be kept up and running, adding IPv6 connectivity to the Cisco VPN Client usersnot be confused with the VPN tunnels configured on broadband access routers located at remote sites.</p>

<a name="ch15lev2sec11"></a>
<h4 class="docSection2Title">Multicast</h4>
<p class="docText">On the AC intranet, IPv4 multicast is an experimental service. It started a couple of months ago to stream audio and video files from headquarters to the rest of the world for scheduled training on new AC products and services as well as internal management broadcasts. In reality, the IPv4-based service is supported only at a limited number of locations (because of its operational challenges). The service trial shows it to be too complex to manage IPv4 multicast across the NAT/PAT devices. AC expects to decrease the cost of operations for the service by running it over IPv6. The same commercial applications as in the case of IPv4 multicast are already available, so it is now a matter of network support.</p>
<p class="docText">The first applications of the multicast service revolve around content distribution that would be well supported by a Source Specific Multicast (SSM) model. However, AC plans to roll out collaborative applications, which means the multicast sources might not always be located in the AC's data centers and with a well-known address. For this reason, AC opted for an Any Source Multicast (ASM) multicast design.</p>
<p class="docText">To avoid the transport of delay/jitter-sensitive traffic across large distances and over expensive circuits, AC's worldwide network is segmented into three areas, which represent independent multicast domains. This approach also provides the three regions with a certain level of independence that allows them to tailor content to the respective markets. Each domain is outfitted with content servers at a headquarters location as described in <a class="docLink" href="#ch15table06">Table 15-6</a>. It was also decided not to support the multicast traffic of other applications in crossing the boundaries of these domains.</p>
<a name="ch15table06"></a><p><table cellspacing="0" class="allBorders" border="1" RULES="all" cellpadding="4"><caption><h5 class="docTableTitle">Table 15-6. Multicast Server Distribution in AC's Network</h5></caption><colgroup><col width="250"><col width="250"></colgroup><thead><tr><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Region</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Served by Multimedia Server</p></th></tr></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Africa and Middle East</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Paris</p></TD></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText">Asia-Pacific</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Hong Kong</p></TD></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Europe</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Paris</p></td></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Latin and Central America</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">San Francisco</P></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText">North America</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">San Francisco</p></td></tr></table></p><br>
<p class="docText">For content-distribution purposes, two streaming servers are located per data center in the San Francisco, Paris, and Hong Kong headquarters. Content is actually created in San Francisco and then distributed to the other two locations over night. Each data center is responsible to stream the multimedia content in its respective region.</p>
<p class="docText">The service in each region will be similarly designed and will follow the guidelines and examples shown in <a class="docLink" href="ch06.html#ch06">Chapter 6</a>, &quot;Providing IPv6 Multicast Services.&quot; It will also rely on the existent IPv6 IGP for routing information and RPF calculation. The following protocols are used to support the multicast service:</p>
<ul><li><p class="docList">PIM Sparse Mode (PIM-SM) on routers and layer 3 switches. It starts running automatically when the network element is enabled to support multicast through the global command <span class="docEmphStrong">ipv6 multicast-routing</span>.</p></li><li><p class="docList">The Rendezvous Point (RP) mapping to the multicast group addresses is a key aspect in shaping the service design. The independent domain approach chosen for this deployment would warrant an elegant and dynamic solution based on BSR as described in <a class="docLink" href="ch06.html#ch06">Chapter 6</a>. The concern, however, is with the multiple remote locations present within each multicast domain that connect to the main campuses over smaller bandwidth pipes and use lower-end network elements with limited resources. To limit the impact of BSR flooding and the state maintained for it, AC decided to select an embedded RP approach.</p></LI><li><p class="docList">Although MLDv2 is supported by default on the Cisco routers, at the time of planning the deployment most stacks actually support only MLDv1. AC decided to use both at its access layer.</p></li><LI><p class="docList">To optimize the use of resources for multicast forwarding, MLD snooping is turned on by default on all layer 2 switches deployed on AC LANs. This policy refers in particular to the Cisco Catalyst 6500 with supervisor engine 720 and Catalyst 3750 or 3560 series installed on all sites. The feature is enabled with the global configuration command <span class="docEmphStrong">ipv6 mld snooping</span>.</p></LI></UL>
<p class="docText">The servers acting as sources for the multicasted content are located in the data centers of the three local headquarters serving each region. A prefix is allocated for these multicast resources in each data center, and it is identified by convention through bits 57 through 64 of the IPv6 address being set as DD:</p>
<UL><li><p class="docList">San Francisco: 2001:DB8:ACAC:00DD::/64</p></LI><LI><p class="docList">Paris: 2001:DB8:ACAC:24DD::/64</P></li><li><p class="docList">Hong Kong: 2001:DB8:ACAC:80DD::/64</p></LI></ul>
<p class="docText">The two gateways serving the server segment are set to be the RPs for the multicast groups used in that domain. A second prefix is used to identify these RPs. For this prefix, bits 57 through 64 are set to DF. The loopback interfaces of the RPs are assigned this prefix with the interface ID set as ::F. In the case of an embedded RP-based deployment, the multicast group addresses derive from the RP unicast address, as described in <a class="docLink" href="ch06.html#ch06">Chapter 6</a>. <a class="docLink" href="#ch15table07">Table 15-7</a> summarizes the prefixes relevant to the multicast service.</p>
<a name="ch15table07"></a><P><table cellspacing="0" class="allBorders" border="1" RULES="all" cellpadding="4"><caption><H5 class="docTableTitle">Table 15-7. Prefixes Used with the Multicast Service</h5></caption><colgroup><col width="125"><col width="125"><col width="125"><col width="125"></colgroup><thead><tr><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Region</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Multicast Servers</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">RP</P></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Multicast Groups</p></th></tr></thead><TR><td class="docTableCell" align="left" valign="top"><p class="docText">San Francisco:</P>
<p class="docText">-North America</p>
<p class="docText">-Latin and Central America</p>
</td><td class="docTableCell" align="left" valign="top"><p class="docText">2001:DB8:ACAC:00DD::/64</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">2001:DB8:ACAC:DF::F/128</p>
<p class="docText">2001:DB8:ACAC:DF::F/127</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">FF75:F40:2001:DB8:ACAC:DF:<span class="docEmphStrong">G</span></p>
<p class="docText">-Where <span class="docEmphStrong">G</span> is the 32 bits group ID</p></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Paris:</p>
<p class="docText">-Africa and Middle East</p>
<p class="docText">-Europe</P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">2001:DB8:ACAC:24DD::/64</P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">2001:DB8:ACAC:24DF::F/128</p>
<p class="docText">2001:DB8:ACAC:24DF::F/127</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">FF75:F40:2001:DB8:ACAC:24DF:<span class="docEmphStrong">G</span></P>
<p class="docText">-Where <span class="docEmphStrong">G</span> is the 32 bits group ID</p></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Hong Kong:</p>
<p class="docText">-Asia-Pacific</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">2001:DB8:ACAC:80DD::/64</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">2001:DB8:ACAC:80DF::F/128</P>
<p class="docText">2001:DB8:ACAC:80DF::F/127</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">FF75:F40:2001:DB8:ACAC:80DF:<span class="docEmphStrong">G</span></p>
<p class="docText">-Where <span class="docEmphStrong">G</span> is the 32 bits group ID</P></td></tr></table></p><br>
<p class="docText"><a class="docLink" href="#ch15ex17">Example 15-17</a> shows the relevant configuration of the RP router in the San Francisco data center.</p>
<a name="ch15ex17"></a><h5 class="docExampleTitle">Example 15-17. IPv6 Multicast Configuration</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>RP-1#
<span class="docEmphMark">ipv6 multicast-routing</span>
!
<span class="docEmphMark">ipv6 pim rp-address 2001:DB8:ACAC:DF::F</span>
!
interface Loopback0
 no ip address
 ipv6 address <span class="docEmphMark">2001:DB8:ACAC:DF::F/128</span>
 ipv6 enable
!</pre><br>

</td></tr></table></p>
<p class="docText"><a name="iddle1292"></a><a name="iddle1335"></a>The two segment gateways provide a certain level of redundancy for the RP functionality. The primary RP has the loopback address configured with the longer prefix /128, whereas the backup has its configured with the same address but the /127 prefix length. This means that as long as the primary is active, the longer prefix match will send all the PIM traffic to it. If it fails, the IGP will redirect it to its backup.</p>
<a name="ch15note10"></a><div class="docNote"><p class="docNoteTitle">Note</P>

<p class="docText">This mechanism provides a coarse level of redundancy. <a class="docLink" href="ch06.html#ch06">Chapter 6</a> discusses its implications, such as source re-registration upon RP failure.</p>
</div><br>
<p class="docText">An important aspect of implementing the multicast design described is the multicast domain control. All types of multicast traffic, other than that with link-local scope, have to be blocked from traversing the border between AC's network and the IPv6 Internet. Moreover, to enforce the rules defined for the content services, the FF75:: multicast traffic has to be stopped from crossing the border between the three domains identified. The domain control is implemented with the help of eACLS on the relevant WAN routers. This can be easily done considering the well-defined scope and structure of the multicast addresses used.</p>
<p class="docText">The troubleshooting steps described in <a class="docLink" href="ch06.html#ch06">Chapter 6</a> can be used in the case of this deployment. This embedded-RP design simplifies significantly to service, making its support much easier than the alternative BSR-based design.</P>

<a name="ch15lev2sec12"></a>
<h4 class="docSection2Title">Network Management</H4>
<p class="docText">A complex aspect of running a dual-stack network is its management. Hopefully, the new IP version is an addition to existent IPv4 services on the AC intranet so that there is no need to natively manage the equipment over an IPv6 network layer. Nevertheless, the NMS is upgraded to dual stack as well and configured with a manual IPv6 address to follow AC addressing rules. Other steps to update the management infrastructure to support IPv6 include the following:</P>
<ul><LI><p class="docList">Releases of HP OpenView and Cisco Network Management applications are upgraded to the most recent versions, which include IPv6 applications as described in <a class="docLink" href="ch10.html#ch10">Chapter 10</a>, &quot;Managing IPv6 Networks.&quot;</p></li><LI><p class="docList">Additional scripts are written to handle IPv6 configurations on networking devices.</P></LI><li><p class="docList">The user-tracking application available from Cisco LMS 2.5 is leveraged to monitor the hosts configured with &quot;privacy extension&quot; addresses.</p></li><LI><p class="docList">Network Analyzer modules already deployed in AC's network will be updated to handle IPv6 protocols.</p></li></UL>
<p class="docText">Overall, the NM policies and procedures have to be updated to reflect the specificities of IPv6.</P>

<a name="ch15lev2sec13"></a>
<h4 class="docSection2Title">Mobility</h4>
<p class="docText"><a name="iddle1333"></a><a name="iddle1443"></a>One of AC management's expectations about the integration of IPv6 is the deployment of new appliances supported through IP mobility. New generations of smart phones and PDAs, allocated to employees enabled with various wireless access technologies, should provide easy access intranet resources. The recent development of mobile router, such as Cisco MAR 3200, would also enable the AC fleet of vehicles to stay connected while being outfitted with a multitude of data collection and data delivery devices. Applications such as video security, maintenance, and tracking represent an opportunity to optimize resources. Because the implementations are still in their infancy, the AC IT team will begin an experimental service to learn the technology and validate the design.</p>
<p class="docText">In the beginning, only the San Francisco headquarters will be configured for MIPv6. If the experiment is deemed successful, the service will be expanded to other regional headquarters. Minimum steps to be achieved include the following:</p>
<UL><li><p class="docList">A new Ethernet segment is created on the DMZ that represents the MIPv6 home network.</p></LI><li><p class="docList">An IPv6 prefix, 2001:0DB8:ACAC:00FF::/64, is assigned to this segment.</P></li><li><p class="docList">A Cisco 2821 router running Cisco IOS Release 12.4(2)T is configured, as shown in <a class="docLink" href="#ch15ex18">Example 15-18</a>, as MIPv6 home agent for the experiment. See <a class="docLink" href="ch08.html#ch08">Chapter 8</a>, &quot;Advanced ServicesIPv6 Mobility,&quot; for details about the MIPv6 protocol.</p><a name="ch15ex18"></a><h5 class="docExampleTitle">Examble 15-18. Router MIPv6 Home Agent Basic Setup</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>MIPv6#
<span class="docEmphMark">ipv6 mobile home-agent</span>
!
interface GigabitEthernet0/0
ip address 10.151.1.7 255.255.255.0
ipv6 address 2001:0DB8:ACAC:00FF::/64 EUI-64
 <span class="docEmphMark">ipv6 mobile home-agent preference 1 </span>
 <span class="docEmphMark">ipv6 mobile home-agent </span>
!
Checking the Mobile IPv6 Home Agent availability
MIPv6#<span class="docEmphStrong">show ipv6 mobile home-agents</span>
Home Agent information for GigabitEthernet0/0
  Configured:
    FE80::20F:35FF:FE2D:38C9
    preference 1 lifetime 1800
      global address 2001:0DB8:ACAC:00FF:20F:35FF:FE2D:38C9/64
No Discovered Home Agents
MIPv6#<span class="docEmphStrong">show ipv6 mobile globals</span>
Mobile IPv6 Global Settings:
  1 Home Agent service on following interfaces:
    GigabitEthernet0/0
  Bindings:
    Maximum number is unlimited.
    1 bindings are in use
    1 bindings peak
    Binding lifetime permitted is 262140 seconds
    Recommended refresh time is 300 seconds</pre><br>

</td></tr></table></p></li><li><p class="docList">A laptop with WiFi and 3G interfaces loaded with Microsoft Windows XP SP1 and Mobile IPv6 technology preview acts as Mobile Node. <a class="docLink" href="#ch15ex19">Example 15-19</a> are the commands and displays from the Windows MIPv6 client.</p></LI></ul>
<a name="ch15ex19"></a><h5 class="docExampleTitle">Example 15-19. Microsoft Windows XP MIPv6 Client Technology Preview Configuration</h5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><TD>


<pre>Disabling IPSec authentication as it is not yet supported on Cisco IOS for Mobile IPv6
C:\&gt; <span class="docEmphStrong">ipv6 gpu MIPv6Security off</span>
Manual HA Configuration
C:\&gt; ipv6 hau &lt;HoA&gt; &lt;HA&gt;
C:\&gt;<span class="docEmphStrong">ipv6 hau 2001:DB8:ACAC:00FF:20c:29ff:feb9:8d7c</span>
  <span class="docEmphStrong">2001:DB8:ACAC:FF:20F:35FF:FE2D:38C9</span>
Display MIPv6 Home Agent configuration
C:\&gt;<span class="docEmphStrong">ipv6 ha</span>
<span class="docEmphMark">Home Address: 2001:DB8:ACAC:00FF:20c:29ff:feb9:8d7c</span>
  <span class="docEmphMark">Home Agent: 2001:DB8:ACAC:FF:20F:35FF:FE2D:38C9</span>
  ESPTunnelSPI: 0
  ESPTunnelSPD: 0
C:\&gt;
Display MIPv6 Binding Updates
C:\&gt; <span class="docEmphStrong">ipv6 bu</span>
<span class="docEmphMark">Home Address: 2001:DB8:ACAC:00FF:20c:29ff:feb9:8d7c</span>
  <span class="docEmphMark">Host: 2001:DB8:ACAC:FF:20F:35FF:FE2D:38C9</span>
    <span class="docEmphMark">CoA      : 6/2006:1::20c:29ff:feb9:8d7c </span>
    Expires  : 47s
    Comments : HOME_AGENT
    RRState  : NO_RR ACTIVE</pre><BR>

</td></TR></table></p>
<p class="docText">The purpose of the test is to enable the Mobile Node to reach its home network either from any internal AC subnet or any external location. <a class="docLink" href="#ch15ex20">Example 15-20</a> shows a <span class="docEmphStrong">Ping6</span> when the Mobile Node is away from its home network sent toward a node sitting on the home network shown in <a class="docLink" href="#ch15fig08">Figure 15-8</a>.</p>
<a name="ch15ex20"></a><H5 class="docExampleTitle">Example 15-20. MIPv6 Testing</H5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>Ping6 command
C:\&gt; <span class="docEmphStrong">ping6 -t 2001:DB8:ACAC:FF:20d:60ff:fefa:e15b</span>
Pinging 2001:DB8:ACAC:FF:20d:60ff:fefa:e15b
from 2001:DB8:ACAC:FF:20c:29ff:feb9:8d7c with 32 bytes of data:
Reply from 2001:DB8:ACAC:FF:20d:60ff:fefa:e15b bytes=32 time=137ms
Reply from 2001:DB8:ACAC:FF:20d:60ff:fefa:e15b bytes=32 time=137ms
Ping statistics for 2001:DB8:ACAC:FF:20d:60ff:fefa:e15b
    Packets: Sent = 2, Received = 2, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
    Minimum = 119ms, Maximum = 137ms, Average = 128ms
Ctrl+C
C:\&gt;
Display of MIPv6 Binding Cache during ping6
C:\&gt; ipv6 bc
<span class="docEmphMark">Home Address: 2001:DB8:ACAC:FF:20c:29ff:feb9:8d7c</span>
  <span class="docEmphMark">Host: 2001:DB8:ACAC:FF:20d:60ff:fefa:e15b</span>
    <span class="docEmphMark">CoA      : 6/2006:1::20c:29ff:feb9:8d7c</span>
    Expires  : 27s
    BU_Rexmits   : 2
    RRState  : AWAIT_ACK SEND_BU
<span class="docEmphMark">Host: 2001:DB8:ACAC:FF:20F:35FF:FE2D:38C9</span>
    <span class="docEmphMark">CoA      : 6/2006:1::20c:29ff:feb9:8d7c</span>
    Expires  : 39s
    <span class="docEmphMark">Comments : HOME_AGENT</span>
    RRState  : NO_RR ACTIVE</pre><br>

</TD></tr></table></p>
<a name="ch15fig08"></a><P><center>
<H5 class="docFigureTitle">Figure 15-8. Mobile IPv6 Test Bed</h5>
<p class="docText"><div class="v1"><a target="_self" href="images/15fig08_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="349" SRC="images/15fig08.jpg"></p>
</center></p><br>
<p class="docText">This section gave a basic example of IP mobility configuration. Real production deployment with a large number of devices will present more challenges than a single mobile-node test. AC will continue the experimentation with more complex settings and challenges, such as the following:</P>
<ul><li><p class="docList">Adding multiple mobile nodes with various implementations of MIPv6 for a large-scale evaluation: Microsoft Mobile PC 2003 and its Mobile IPv6 Technology Preview and Linux MIPv6.</P></li><LI><p class="docList">Adding a Mobile RouterCisco MAR 3200as MIPv6 client. An IPv6 video camera will be attached to one of the MAR 3200 Ethernet interfaces to demonstrate video surveillance in a truck.</p></li><li><p class="docList"><a name="iddle1339"></a><a name="iddle1753"></a>At the time of writing, MIPv6 implementation on Cisco IOS does not include an authentication mechanism such as IPsec or Light Authentication. This will be validated when available on a commercial Cisco IOS release. Note that Microsoft Mobile IPv6 Technology Preview allows disabling the IPsec authentication.</p></li><li><p class="docList">Security rules to protect the AC intranet from attacks when IP mobility is a production service. To begin with, extended ACLs to differentiate routing option header type 2 (MIPv6) from type 0 (source routing) are set on access routers.</p></li></ul>
<p class="docText">Although there is still a long way to go before running an IP mobility production service, this represents a strong opportunity for innovation, helping AC to keep its technology leadership with its market through improved processes.</p>

<a name="ch15lev2sec14"></a>
<h4 class="docSection2Title">QoS</h4>
<p class="docText">As discussed in <a class="docLink" href="ch05.html#ch05">Chapter 5</a>, &quot;Implementing QoS,&quot; the architectural model is similar between IPv4 and IPv6. The initial QoS setup on the AC network was done to guarantee the bandwidth of the IP telephony traffic and limit the throughput of the experimental IPv4 multicast traffic over the WAN links. Packets sent over both versions of IP consume the same resources, meaning that if one application is considered mission critical, its traffic has to be protected whatever the network layer version. With the assumption in mind that applications should be protocol agnostic, the AC network team decided that all QoS rules must be applied the same way to both versions of IP. This eases the integration of IPv6-capable applications because no further action is needed after the QoS rules are set for IPv4 (as long as IPv6 QoS is supported on routers and switches).</p>
<p class="docText">QoS is really an internal service for the AC intranet. It was defined to guarantee the bandwidth of IP telephony and control the throughput of multicast streams in locations where it was enabled. Class of service (CoS) definition has been limited to a minimum, as follows:</p>
<ul><LI><p class="docText"><span class="docEmphStrong">All traffic</span> DSCP=0</p><p class="docList">This should be the default for all traffic except as indicated below. Traffic flowing from and to the Internet is re-marked on the AC edge router with DSCP=0.</p></li><LI><p class="docText"><span class="docEmphStrong">IP telephony</span> DSCP=5</p><p class="docList">This is reserved to the IP telephony traffic. This is the original QoS value set by the IP phones and must be preserved through the intranet.</P></LI><li><p class="docText"><span class="docEmphStrong">Management traffic</span> DSCP=7</P><p class="docList">The default value is intact for the network management traffic, (for example, routing protocol) that generates by default packets with such a value.</p></li></UL>
<p class="docText">On Cisco IOS routers supporting IPv6 QoS through the Modular QoS CLI (MQC), the default action for QoS is to apply the same rules for both IPv4 and IPv6.</P>
<p class="docText"><a name="iddle1329"></a><a name="iddle1344"></a><a name="iddle1976"></a>On AC LANs, the IP QoS to 802.1Q/p CoS correspondence is enabled to guarantee the bandwidth of the IP telephony. On Catalyst 6500 running Cisco IOS Release 12.2(18)SXE and higher, the correspondence between IPv6 Traffic Class field and 802.1Q CoS is supported for all CEF switched packets.</P>
<a name="ch15note11"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">To treat an application separately for IPv4 and IPv6, the network manager must add a match criteria with the <span class="docEmphStrong">match protocol ip</span> and <span class="docEmphStrong">match protocol ipv6</span> commands in a match-all class map.</p>
</div><br>
<p class="docText">See <a class="docLink" href="ch05.html#ch05">Chapter 5</a> for a more detailed discussion about IPv6 QoS and its configuration.</P>


</TD></TR></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch15lev1sec5.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch15lev1sec7.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
</body></html>