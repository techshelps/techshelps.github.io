<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>Translation Mechanisms (NAT-PT)</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch03lev1sec4.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch04.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><TR><TD valign="top"><a name="ch03lev1sec5"></a>
<H3 class="docSection1Title">Translation Mechanisms (NAT-PT)</h3>
<p class="docText">Transition mechanisms reviewed so far enable end-to-end IPv6 connectivity. They are based on native IPv6 integration in a network, also called dual stack, or IPv6 encapsulation over IPv4 (manual or automatic tunnels). There is a potential scenario (third- and fourth-generation mobile phone networks, for instance) where IPv6-only devices need to communicate with IPv4-only nodes or resources. Such scenarios drive the need for translation mechanisms that enable communication between equipment that supports only one of the IP versions.</p>
<p class="docText">Even when hosts can be migrated to a dual stack at the networking layer, some applications will remain IPv4 only, just because their implementation relies too much on IPv4 addresses, or a recompilation cannot be implemented.</p>
<p class="docText">In such environments, you can use a different set of mechanisms, based on protocol translation rather than tunneling. These mechanisms include the following:</p>
<ul><li><p class="docList">Bump-in-the-Stack (BIS), specified in RFC 2767</p></li><li><p class="docList">SOCKs-based gateway, specified in RFC 3089 and RFC 1928</p></li><li><p class="docList">TCP-UDP Relay, specified in RFC 3142</P></li><li><p class="docList">Network Address Translation-Protocol Translation (NAT-PT), specified in RFC 2765 and RFC 2766</P></LI></ul>
<p class="docText">These mechanisms fall into two categories: those that have an impact on hosts, generally only on one end of the communication; and those that do not. BIS and SOCKS-based gateways belong to the first category, whereas TCP-UDP Relay and NAT-PT belong to the second. Cisco IOS software implements only NAT-PT because the other translation mechanisms are either not relevant to Cisco IOS software or they are not really deployed. For these reasons, this section focuses only on NAT-PT.</p>
<p class="docText">NAT-PT enables IPv6-only hosts to communicate with IPv4-only hosts and applications. It is described in RFC 2766 and uses the IP translation mechanism referred as stateless IP/ICMP translation algorithm (SIIT), specified in RFC 2765.</p>
<p class="docText"><a class="docLink" href="#ch03table04">Tables 3-4</a> and <a class="docLink" href="#ch03table05">3-5</a> present header translation rules, from IPv4 to IPv6 and in reverse.</p>
<a name="ch03table04"></a><P><table cellspacing="0" class="allBorders" border="1" RULES="all" cellpadding="4"><caption><h5 class="docTableTitle">Table 3-4. Header Translation IPv4 to IPv6</h5></caption><colgroup><col width="200"><col width="200"></colgroup><thead><tr><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">IPv6 Header Fields</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Values</P></th></TR></thead><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Version</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">6</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Traffic Class</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">TOS</p></td></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText">Flow Label</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">0</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Payload Length</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Total lengthheader length</p></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Next Header</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Protocol</p></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText">Hop Limit</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">TTL</p></TD></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Source Address</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NAT-PT</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Destination Address</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NAT-PT</p></td></TR></table></P><BR>
<a name="ch03table05"></a><P><table cellspacing="0" class="allBorders" border="1" RULES="all" cellpadding="4"><caption><H5 class="docTableTitle">Table 3-5. Header Translation IPv6 to IPv4</h5></caption><colgroup><col width="200"><col width="300"></colgroup><thead><tr><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">IPv4 Header Fields</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Values</p></th></tr></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Version</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">4</p></td></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText">IHL</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">5 (no options)</p></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText">TOS</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Traffic class</P></TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Total Length</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Payload length + length of the IPv4 header</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Identification</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">0</p></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText">Flags</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">More Fragments Flag=0 Don't Fragment Flag=1</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Fragment Offset</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">0</p></td></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText">TTL</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Hop limit</p></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Protocol</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Next Header field</P></TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Checksum</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Computed</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Source Address</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NAT-PT</p></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText">Destination Address</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">NAT-PT</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Options</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Not translated</p></td></TR></table></p><br>
<p class="docText">Any IPv4 option is ignored during the protocol-translation process. IPv4 fragmented packets are translated using the IPv6 fragment header. Most ICMPv4 control messages are discarded during translation, except echo requests and replies which are mapped into IPv6 with the proper code (128, 129). Error messages are translated whenever possible. The reverse translation is done pretty much the same way. The IPv4 checksum computation is performed after the header has been translated.</P>
<p class="docText">The way addresses (source and destination) get translated is configuration controlled, or dynamic. In the simple case, explicit mapping is provided at the NAT-PT for both source and destination, in both directions.</P>
<p class="docText">Like for NAT, NAT-PT operates in various modes: static, where one IPv4 address is used to communicate with the IPv4-only host; and dynamic, where a pool of addresses is available, and dynamically bound to active flows; and PAT (Port Address Translation), where a single IPv4 address is used, and a TCP/UDP port number serves as a discriminator.</p>
<p class="docText">NAT-PT can also be used as the DNS application-level gateway (ALG) to translate the DNS transaction. The DNS query for an AAAA record gets translated into a query for an A record. Upon receiving a response with an IPv4 address, the NAT-PT builds an IPv6 address by prefixing it with the global NAT-PT prefix and sends the response to the IPv6 host. At the same time, it creates a dynamic entry for translating the destination.</p>
<p class="docText">For the destination, when communication is initiated from the IPv6 host, the IPv6 destination can embed the IPv4 address.</p>
<p class="docText"><a class="docLink" href="#ch03fig18">Figure 3-18</a> illustrates the case of dynamic NAT-PT using a pool of addresses.</p>
<a name="ch03fig18"></a><P><center>
<h5 class="docFigureTitle">Figure 3-18. NAT-PT</h5>
<p class="docText"><div class="v1"><a target="_self" href="images/03fig18_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="179" SRC="images/03fig18.jpg"></p>
</center></p><BR>
<p class="docText"><a class="docLink" href="#ch03ex31">Example 3-31</a> presents the NAT-PT configuration of the router shown in <a class="docLink" href="#ch03fig18">Figure 3-18</a>.</P>
<a name="ch03ex31"></a><H5 class="docExampleTitle">Example 3-31. NAT-PT Router Configuration</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>interface Ethernet0/0
 ipv6 address 3ffe:100:200:1::2/64
 ipv6 enable
 ipv6 nat
!
interface Ethernet1/0
 ip address 192.168.1.2 255.255.255.0
 ipv6 nat
!Entry for static mapping of v4 source-&gt;v6-
ipv6 nat v4v6 source 192.168.1.1 3ffe:b00:1::1
!Entry for mapping of v6 source-&gt;dynamic v4
ipv6 nat v6v4 source list pt1 pool v4pool
ipv6 nat v6v4 pool v4pool 10.50.10.1 10.50.10.10 prefix-length 24
ipv6 nat translation udp-timeout 600
ipv6 nat prefix 3ffe:b00:1::/96
!
ipv6 access-list pt1
 permit ipv6 3ffe:100:200:1::/64 any</pre><br>

</td></tr></table></p>
<p class="docText">NAT-PT involves many of the same issues as NAT, covered in depth in <a class="docLink" href="ch01.html#ch01">Chapter 1</a>, &quot;The Case for IPv6An Updated Perspective.&quot; These issues are also listed in draft-aoun-v6ops-natpt-deprecate (a work in progress in IETF). Whenever you have an alternative solution, you should favor it over NAT-PT. For instance, if there is any possibility to set up the hosts with dual-stack IPv4 and IPv6, other mechanisms (described in section &quot;<a class="docLink" href="ch03lev1sec3.html#ch03lev1sec3">IPv6 Network Access</a>&quot;) such as ISATAP or Teredo should be preferred. NAT-PT is not supported when an IPv6-only network is trying to communicate to another IPv6-only network via an IPv4 backbone or vice versa, because it would require a double translation. In such cases, tunneling mechanisms (described in the section &quot;<a class="docLink" href="ch03lev1sec4.html#ch03lev1sec4">IPv6 over the Backbone</a>&quot;) should be preferred.</p>
<p class="docText">However, a gap exists between a technical alternative and its operational feasibility. This gap may be filled by NAT-PT during the transitioning period. Consider, for example, the case of IPv6-only devices that should communicate with a node connected to an IPv6 unsupported data link layer (for example, Token Ring). For economical reasons, it may be valuable to run NAT-PT between devices, while waiting for the host to be upgraded to its next generation (thus ridding it of Token Ring).</p>
<p class="docText">You can integrate IPv6 into existing infrastructures in various ways. It is expected that dual-stack networks will become the standard approach, but various transition mechanisms are available today to lower the cost of the first steps toward IPv4 and IPv6 coexistence. This chapter has summarized those mechanisms to enable you to evaluate their use in different deployment scenarios as depicted in the second part of this book.</p>

</TD></TR></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch03lev1sec4.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch04.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
</body></html>