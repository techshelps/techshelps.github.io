<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>Internet Control Message Protocol for IPv6</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch02lev1sec2.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch02lev1sec4.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><TR><TD valign="top"><a name="ch02lev1sec3"></a>
<H3 class="docSection1Title">Internet Control Message Protocol for IPv6</h3>
<p class="docText">ICMPv6 is an integral part of the IPv6 architecture and must be completely supported by all IPv6 implementations. It combines functionalities supported in IPv4 under different protocols: ICMP (Internet Control Message Protocol version 4), IGMP (Internet Group Membership Protocol), and ARP (Address Resolution Protocol). ICMPv6 runs over IPv6, unicast, and multicast. As such, it is nonreliable, and cannot be used for features that require reliability. ICMPv6 is described in RFC 2463. <a class="docLink" href="#ch02table09">Table 2-9</a>, lists the RFCs that define ICMPv6 functionalities and the codes identifying the ICMPv6 types used for these functionalities.</p>
<a name="ch02table09"></a><p><table cellspacing="0" class="allBorders" border="1" RULES="all" cellpadding="4"><caption><h5 class="docTableTitle">Table 2-9. Comparison Between ICMPv4 and ICMPv6</h5></caption><colgroup><col width="250"><col width="75"><col width="75"><col width="75"><col width="75"></colgroup><thead><tr><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Name</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">v6 Type</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">v4 Type</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">IPv4 RFC</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">IPv6 RFC</p></th></tr></thead><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Destination Unreachable</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">1</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">3</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 792</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 2463</P></TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Packet Too Big</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">2</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NA</p></td><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 2463</p></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText">Time Exceeded</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">3</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">11</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 792</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 2463</p></TD></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText">Parameter Problem</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">4</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">12</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 792</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">RFC 2463</P></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Source Quench</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NC</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">4</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 792</p></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</TD></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Alternate Host Address</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NC</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">6</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 792</p></td><TD class="docTableCell" align="left" valign="top">&nbsp;</td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText">Timestamp</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NC</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">13</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 792</P></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Timestamp Reply</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NC</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">14</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 792</p></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</TD></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Information Request</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NC</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">15</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 792</p></td><TD class="docTableCell" align="left" valign="top">&nbsp;</td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText">Information Reply</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NC</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">16</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 792</P></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Address Mask Request</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NC</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">17</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 950</p></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</TD></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Address Mask Reply</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NC</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">18</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 950</p></td><TD class="docTableCell" align="left" valign="top">&nbsp;</td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText">Traceroute</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NC</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">30</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 1393</P></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Datagram Conversion Error</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NC</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">31</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 1475</p></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</TD></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Mobile Host Redirect</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NC</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">32</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 3775</p></td><TD class="docTableCell" align="left" valign="top">&nbsp;</td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText">Where-Are-You</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NC</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">33</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 1788</P></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">I-Am-Here</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NC</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">34</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 1788</p></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</TD></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Mobile Registration Request</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NC</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">35</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 1788</p></td><TD class="docTableCell" align="left" valign="top">&nbsp;</td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText">Mobile Registration Reply</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NC</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">36</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 1788</P></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Domain Name Request</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NC</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">37</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 1788</p></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</TD></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Domain Name Reply</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NC</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">38</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 1788</p></td><TD class="docTableCell" align="left" valign="top">&nbsp;</td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText">Photuris</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NC</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">40</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 2521</P></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Echo Request</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">128</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">8</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 792</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">RFC 2463</P></TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Echo Reply</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">129</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">0</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 792</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 2463</p></TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Multicast Listener Query</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">130</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NA</p></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 2710</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Multicast Listener Report</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">131</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NA</p></td><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top"><p class="docText">RFC 2710</P></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Multicast Listener Done</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">132</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NA</p></td><td class="docTableCell" align="left" valign="top">&nbsp;</TD><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 2710</p></TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Router Solicitation</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">133</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">10</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">RFC 1256</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 2461</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Router Advertisement</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">134</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">9</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">RFC 1256</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">RFC 2461</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Neighbor Solicitation</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">135</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NA</p></TD><td class="docTableCell" align="left" valign="top">&nbsp;</td><TD class="docTableCell" align="left" valign="top"><p class="docText">RFC 2461</P></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Neighbor Advertisement</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">136</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">NA</P></TD><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 2461</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Redirect Message</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">137</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">5</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">RFC 792</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 2461</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Router Renumbering</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">138</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NA</P></td><td class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top"><p class="docText">RFC 2894</p></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText">ICMP Node Information Query</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">139</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">NA</P></td><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 2894</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">ICMP Node Information Response</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">140</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">NA</P></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 2894</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Inverse Neighbor Discovery Solicitation Message</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">141</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NA</P></td><td class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top"><p class="docText">RFC 3122</p></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText">Inverse Neighbor Discovery Advertisement</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">142</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">NA</P></td><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 3122</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Version 2 Multicast Listener Report</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">143</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">NA</P></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 3810</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Home Agent Address Discovery Request Message</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">144</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NA</P></td><td class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top"><p class="docText">RFC 3775</p></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText">Home Agent Address Discovery Reply Message</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">145</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">NA</P></td><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 3775</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Mobile Prefix Solicitation</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">146</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">NA</P></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><td class="docTableCell" align="left" valign="top"><p class="docText">RFC 3775</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Mobile Prefix Advertisement</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">147</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">NA</P></td><td class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top"><p class="docText">RFC 3775</p></td></tr></table></p><BR>
<p class="docText">Similar to ICMPv4, ICMPv6 enables IPv6 nodes to report errors and performs various control-plane functions. Many of the existing ICMPv4 functionalities have been carried over to ICMPv6, although some were simplified and many more added. This reengineering of ICMP could have been driven independently of the protocol version. However, the IPv4 legacy made that approach unrealistic, so a new protocol type (Next Header) was defined specifically for ICMPv6 (protocol type 58 for ICMPv6, instead of 1 for ICMPv4). In this context, ICMPv6 ended up being a different protocol than ICMPv4. Some features are similar to their IPv4 counterpart (some of the error messages such as Destination Unreachable). Some features are not carried over, mostly because they never became popular (traceroute as defined in RFC 1393, for instance). New features (such as link-layer address resolution, or packet too big) were introduced, leading to some fundamental design differences from IPv4.</p>
<p class="docText"><a class="docLink" href="#ch02table09">Table 2-9</a> presents a comparison between ICMPv6 and ICMPv4. In the ICMPv6 column, the ICMPv4 messages that are not considered in IPv6 are marked NC. In the ICMPv4 column, the ICMPv6 messages that were not adopted are marked NA.</p>
<p class="docText">The ICMPv6 types 1 to 127 are reserved for errors, and values starting at 128 are for control and information reporting.</p>
<p class="docText">Regardless of message type, all ICMPv6 messages share the same message header format as shown in <a class="docLink" href="#ch02fig18">Figure 2-18</a>.</p>
<a name="ch02fig18"></a><P><center>
<H5 class="docFigureTitle">Figure 2-18. ICMPv6 Packet Format</H5>
<p class="docText"><div class="v1"><a target="_self" href="images/02fig18_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="180" SRC="images/02fig18.jpg"></p>
</center></p><br>
<p class="docText">The IPv6 header has a value of 58 in the Next Header field if the upper-layer protocol of the payload data is ICMPv6.</p>
<p class="docText">If the message is a response to an ICMPv6 messages sent to one of the node's unicast addresses, the SA is the same address. Otherwise, the SA is calculated using the source address selection algorithm (see the &quot;SAS Algorithm&quot; section later in this chapter).</p>
<p class="docText">The Type field, shown in <a class="docLink" href="#ch02fig18">Figure 2-18</a>, can take one of the values enumerated in <a class="docLink" href="#ch02table09">Table 2-9</a>, and the code depends on each message.</p>
<p class="docText">The Checksum, unlike ICMPv4, includes the pseudo-header, a set of important fields from the IPv6 header, in addition to the ICMPv6 entire message. The inclusion of the pseudo-header enables ICMPv6 to check the integrity of essential elements of the IPv6 header in the absence of a layer 3 header checksum (see the &quot;<a class="docLink" href="ch02lev1sec2.html#ch02lev1sec2">IPv6 Packet Format</a>&quot; section earlier in the chapter).</p>
<a name="ch02lev2sec6"></a>
<h4 class="docSection2Title">ICMPv6 Error Messages</h4>
<p class="docText">One of ICMP's functions is to deliver error messages that help the operation of a network. Currently, ICMPv6 uses four error messages:</p>
<ul><li><p class="docList">Destination Unreachable</p></li><LI><p class="docList">Packet Too Big</P></LI><LI><p class="docList">Time Exceeded</P></li><li><p class="docList">Parameter Problem</p></li></ul>
<p class="docText">The scope, use, and format of these messages are discussed in the following subsections.</p>
<a name="ch02lev3sec16"></a>
<h5 class="docSection3Title">Destination Unreachable</h5>
<p class="docText">IPv6 is as unreliable as IPv4 is, in the sense that sometimes packets get dropped on the path to their destination. In many cases, this is a transient problem due to network congestion or transient connectivity loss and can be recovered by higher-level protocols, such as TCP. In some cases, however, a feedback mechanism is required. For example, the destination specified in the packet can be wrong, or the routing protocol may be failing to distribute routing information to it. ICMP Destination Unreachable provides such feedback mechanism, in the same way as in IPv4. The ICMP Unreachable message provides a reason code to help the source troubleshoot the problem and take appropriate action. <a class="docLink" href="#ch02table10">Table 2-10</a> lists the ICMP code values.</p>
<a name="ch02table10"></a><p><table cellspacing="0" class="allBorders" border="1" RULES="all" cellpadding="4"><caption><h5 class="docTableTitle">Table 2-10. ICMP Codes for the &quot;<a class="docLink" href="#ch02lev3sec16">Destination Unreachable</a>&quot; Message</h5></caption><colgroup><col width="35"><col width="200"><col width="265"></colgroup><thead><TR><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Code</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Short Description</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Explanation</P></th></TR></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText">0</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">No route to destination</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The packet was dropped because no route was matching the destination.</p></TD></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText">1</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Communication with destination administratively prohibited</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Filters blocked the packet.</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">3</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Address unreachable</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">The link-layer address could not be resolved.</P></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">4</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Port unreachable</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The destination port specified in the UDP or TCP header was invalid or does not exist on the destination host.</p></td></TR></table></p><br>
<p class="docText">Note that ICMPv6 has fewer codes than ICMPv4, mainly because some IPv4 messages are not applicable to IPv6. For instance, &quot;Fragmentation Needed and DF Set&quot; cannot apply to IPv6 because fragmentation does not occur on intermediate routers. In addition to the reason code, the message also includes the original datagram portion that fit into the 1280-byte packet.</P>

<a name="ch02lev3sec17"></a>
<H5 class="docSection3Title">Time Exceeded</h5>
<p class="docText">As in IPv4, an IPv6 datagram might loop in the network (because of improper routing configuration, or transient routing states in large networks). The ICMPv6 Time Exceeded was carried over from ICMPv4, designed to prevent packets from looping indefinitely in the network. A Hop Count field in the IPv6 header is decremented by each hop until it eventually reaches 0, in which case the datagram is dropped and the ICMPv6 Time Exceeded is sent back to the source.</p>
<a name="ch02note18"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">As in ICMPv4, the Time Exceeded message was diverted from its original goal, to provide a fairly inefficient but useful way to trace paths in the network (namely, traceroute). A UDP packet is sent to destination many times, by increasing the Hop Count field from 1 to &quot;whatever it takes to reach the destination.&quot; Each node on the path will successively send back an ICMPv6 Time Exceeded message, enabling the source to identify each router on the path.</p>
</div><BR>

<a name="ch02lev3sec18"></a>
<h5 class="docSection3Title">Packet Too Big</h5>
<p class="docText">One of the numerous changes brought by IPv6 relates to the packet-fragmentation process. Unlike IPv4, in which any router on the path to the destination could fragment a packet, should it not fit the MTU of the outgoing link, IPv6 does not provision for this functionality. Although it was convenient for hosts to rely on fragmentation performed by routers, wherever needed, this was also concentrating a lot of processing burden on the routers. Routers have to keep state and use additional memory for the fragmentation process. This being said, it cannot be sufficient to not support the fragmentation feature in the middle of the network. Some feedback mechanism becomes required so that a router on the path to the destination can signal to the originating host that packets need to be fragmented. The Packet Too Big ICMPv6 message is used for that purpose. It contains the MTU for the failing link and the original datagram portion that fit into the 1280-byte packet.</p>
<p class="docText">The ICMPv6 message is primarily an error message. However, it was slightly diverted from its original purpose, to enable hosts to discover the minimum MTU on a path to a particular destination. This is the PMTU Discovery functionality, described in RFC 1981. In short, the idea is that a host assumes the path MTU (PMTU) is the MTU of the first hop in the path. Upon receiving Packet Too Big ICMPv6 messages, it reduces the PMTU and fragments packets accordingly. It keeps going until it stops receiving the Packet Too Big messages.</p>
<p class="docText">The PMTU process on a Cisco router is shown in <a class="docLink" href="#ch02ex09">Example 2-9</a> through the output of the IPv6 ICMP debug.</P>
<a name="ch02ex09"></a><H5 class="docExampleTitle">Example 2-9. PMTU Discovery Performed by a Cisco Router</H5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>Router#<span class="docEmphStrong">ping</span>
Protocol [ip]: <span class="docEmphStrong">ipv6</span>
Target IPv6 address: <span class="docEmphStrong">9009::72e</span>
Repeat count [5]: <span class="docEmphStrong">2</span>
Datagram size [100]: <span class="docEmphMark"><span class="docEmphStrong">1400</span></span>
<span class="docEmphMark">!note that the MTU on one of the routers(biot) on the path has been set to 1300</span>
00:03:21: ICMPv6: Received ICMPv6 packet from FE80::A8BB:CCFF:FE01:F600, type 134
Type escape sequence to abort.
Sending 5, 1400-byte ICMP Echos to 9009::72E, timeout is 2 seconds:
B!!!!
Success rate is 80 percent (4/5), round-trip min/avg/max = 16/20/28 ms
Router#
00:03:23: ICMPv6: Sending echo request to 9009::72E
00:03:23: ICMPv6: Received ICMPv6 packet from 9009::72D, type 2
00:03:23: ICMPv6: <span class="docEmphMark">Received ICMP too big from 9009::72D about 9009::72E, MTU=1300</span>
00:03:23: ICMPv6: Sending echo request to 9009::72E
00:03:23: ICMPv6: Received ICMPv6 packet from 9009::72E, type 129
00:03:23: ICMPv6: Received echo reply from 9009::72E
!The &#171; Packet Too Big &#187; message has enabled the caching of a Path MTU for that
!destination, that can be displayed using the command below
Router#<span class="docEmphStrong">show ipv6 mtu</span>
 MTU     Since    Destination Address
1300    00:00:07  9009::72E</pre><br>

</td></tr></table></p>

<a name="ch02lev3sec19"></a>
<h5 class="docSection3Title">Parameter Problem</h5>
<p class="docText">As in ICPMv4, the Parameter Problem messages provide a way for routers to report more generic issues not covered by the first three messages described previously. The ICMPv6 message can point out (by signaling the offset of that field) any field anomaly in the IPv6 header that prevented the datagram from being processed further. The following code values enable the complaining node to provide additional indications.</p>
<a name="ch02table11"></a><p><table cellspacing="0" class="allBorders" border="1" RULES="all" cellpadding="4"><caption><h5 class="docTableTitle">Table 2-11. ICMP Codes for the &quot;<a class="docLink" href="#ch02lev3sec19">Parameter Problem</a>&quot; Message</h5></caption><colgroup><col width="50"><col width="200"><col width="300"></colgroup><thead><tr><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Code</P></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Short Description</P></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Explanation</P></th></TR></thead><TR><td class="docTableCell" align="left" valign="top"><p class="docText">0</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Erroneous header field encountered</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The field pointed by the Pointer field is in error.</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">1</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Unrecognized next header type encountered</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">The next header is not recognized.</p></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText">2</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Unrecognized IPv6 option encountered</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">The IPv6 option is not recognized.</p></td></tr></table></p><br>


<a name="ch02lev2sec7"></a>
<h4 class="docSection2Title">ICMPv6 Informational Messages</h4>
<p class="docText">The Echo Request and Echo Reply found in ICMPv4 have been carried over to ICMPv6. As in ICMPv4, these two messages are widely used to perform simple connectivity diagnostics, via the <span class="docEmphStrong">ping</span> command. The format of the messages is pretty much unchanged. Besides a type (1) and a code (1), the messages contain an identifier and a sequence number, plus some optional data, copied back from the Request into the Reply.</p>
<p class="docText">Many more informational messages have been specified in various RFCs for the benefit of a large variety of protocols, such as Neighbor Discovery, MIPv6, and multicast. Those are covered in detail in the corresponding sections.</p>

<a name="ch02lev2sec8"></a>
<h4 class="docSection2Title">Source Address Selection Algorithm</h4>
<p class="docText">One of the specificities of IPv6 is that a node can commonly have multiple addresses to choose from when selecting the source or destination of a packet. Multiple unicast addresses can be assigned to the same interface, and they may have different reachability scopes (link-local or global). Dual-stack nodes might even have a choice between IPv4 and IPv6 addresses, in particular if the DNS server has provided both of them for a given name. Multihoming is likely to enable multiple addresses per node, and MIPv6 introduces home address and care-of address in the same node.</p>
<p class="docText">Two algorithms have been specified in RFC 3484, one for source address selection (SAS) and one for destination address selection (DAS). This section details the former (SAS), because it is commonly used by ICMPv6 to select the SA to use before generating an error or informational message. Many other aspects of IPv6 operation, besides ICMP, are required to deal with SAS, or have ramifications for SAS, and in some cases, encounter issues with SAS. MIPv6 and VPNv6 represent two examples, so the SAS topic will be brought up again in the respective sections.</p>
<p class="docText">The algorithm presented here describes the current state of SAS. The SAS algorithm does not take precedence over the application or upper-layer choice. For instance, in the ICMP case, a response to a query just uses the SA that is the DA of the corresponding request. When used, the algorithm is provided with a list of candidate addresses, and applies to this list a set of rules to select the candidate that matches the maximum number of these rules. If a rule has no matching candidates, a candidate address from the list before the rule was applied is chosen.</p>
<p class="docText"><a class="docLink" href="#ch02fig19">Figure 2-19</a> provides a logic diagram of the SAS algorithm.</P>
<a name="ch02fig19"></a><P><center>
<H5 class="docFigureTitle">Figure 2-19. Source Address Selection Algorithm</H5>
<p class="docText"><div class="v1"><a target="_self" href="images/02fig19_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="720" SRC="images/02fig19.jpg"></P>
</center></p><br>
<p class="docText">As mentioned in the &quot;<a class="docLink" href="ch02lev1sec1.html#ch02lev1sec1">IPv6 Addressing</a>&quot; section of this chapter, the addresses of site-local scope have been deprecated and replaced by unique-local addresses, with global scope. These addresses have not yet explicitly found their way into SAS, but they should be considered in the context of the scope rule.</p>

<a name="ch02lev2sec9"></a>
<h4 class="docSection2Title">Conclusion on ICMPv6</h4>
<p class="docText">ICMPv6 has not fundamentally diverged from ICMPv4. It is still a messaging protocol, connectionless, and used for many different purposes (from error reporting to diagnostic and network operations). Messages are structured the same way as in ICMPv4, with a type, code, and body; some message types have been carried over from ICMPv4, and some new ones have been defined.</p>
<p class="docText">However, the uses of ICMPv6, in particular by the Neighbor Discovery Protocol (NDP), are greater than ICMPv4 uses. Whether this is the right approach and the right protocol to perform things as diverse as address resolution, error reporting, autoconfiguration, MIPv6 tasks, and so forth remains to be seen on the deployment side.</p>


<a href="22971536.html"><img src="images/pixel.jpg" alt="" width="1" height="1" border="0"></a></TD></TR></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch02lev1sec2.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch02lev1sec4.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
</body></html>