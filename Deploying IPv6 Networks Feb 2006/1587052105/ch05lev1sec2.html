<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>QoS for IPv6 over MPLS</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch05lev1sec1.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch05lev1sec3.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><TR><TD valign="top"><a name="ch05lev1sec2"></a>
<H3 class="docSection1Title">QoS for IPv6 over MPLS</h3>
<p class="docText">MPLS does not define any new QoS architecture. DiffServ architectures as defined in RFC 2474 and RFC 2475 still apply in the MPLS environment. However, MPLS has a number of characteristics and specific mechanisms that enable unique capabilities. For these reasons, RFC 3270 was written to describe MPLS support of DiffServ. This specification allows support of DiffServ for both IPv4 and IPv6 traffic transported over an MPLS network. Using DiffServ in an MPLS environment for IPv6 traffic is not different regardless of whether the LSP is set up using IPv4 protocols (this is the case for 6PE and for 6VPE) or set up using IPv6 protocols. In fact, there are no interactions at all between MPLS DiffServ, which deals with the MPLS shim layer, and the LSP setup mechanisms itself; this enables DiffServ to be used indistinctly on traffic using label paths set up by LDP IPv4, LDP IPv6, RSVP, or even manually set up.</p>
<p class="docText">MPLS-TE offers the means to set up paths with explicitly reserved bandwidth across an MPLS core. The RSVP signaling used by MPLS-TE can be IPv4 or IPv6. At the time of this writing, IPv6 RSVP is not yet supported on Cisco routers. However, because 6PE and 6VPE use IPv4-signaled LSP, they benefit seamlessly from IPv4 MPLS-TE setup mechanisms, including IPv4 RSVP. However, the mechanisms to achieve tunnel selection for certain IPv6 traffic may be IPv6 specific. This is the case, for instance, when the operational choice is to have tunnels dedicated on a pernetwork layer basis. Those mechanisms are detailed in the RSVP-TE section.</p>
<p class="docText">The next sections cover DiffServ and MPLS-TE in the 6PE/6VPE context and provide configuration examples for both.</p>
<a name="ch05lev2sec4"></a>
<h4 class="docSection2Title">Using DiffServ in a 6PE or 6VPE Environment</h4>
<p class="docText"><a name="iddle1006"></a><a name="iddle1015"></a>MPLS DiffServ can extend the IP DiffServ mechanisms to allow service providers to deliver QoS-based service without interfering with the customer's traffic marking. In the MPLS network, QoS information is carried in the MPLS shim header as described in RFC 3270 and shown in the <a class="docLink" href="#ch05table03">Table 5-3</a>.</p>
<a name="ch05table03"></a><center><h5 class="docTableTitle">Table 5-3. MPLS Shim Header</h5></center><img border="0" alt="" SRC="images/05tab03.jpg"><div class="v1"><a href="ch05lev1sec2.html#ch05table03">[View Full Width]</a></div>
<p class="docText">The MPLS header is 4 bytes, out of which 3 bits are used for DiffServ and referred to as the Exp field. These bits help define the QoS treatment (PHB) that a node should give to a packet. You can think of this as a sort of hierarchical PHB, where the Exp field is used for QoS treatment inside the MPLS core, and at the egress boundary, whereas DSCP is used outside the core, and at the ingress boundary.</p>
<p class="docText">Using DiffServ on the MPLS ingress boundary for differentiating IPv6 traffic is almost exactly the same as using it outside an MPLS environment. Packets need to be classified, which may take place prior to reaching the MPLS edge router or at the MPLS edge router itself. In both cases, the MPLS Exp field must be filled, either by simply copying it from the DSCP field or by applying any sort of classification rule. Because the Exp field is only 3 bits (compared to 6 bits for DSCP), you can just copy the class-selector bits into the Exp field, or decide to &quot;map&quot; the DSCP into the Exp field based on a predefined scheme. The former is the default behavior and good enough in environments where the CEs are managed by the service provider or simply trusted to deliver DSCP classes directly valid in the core network. The latter is used when the CE is untrusted and can also provide some flexibility to distinguish core classes based on dropping precedence. However, it requires additional packet classification and conditioning at the PE (6PE or 6VPE). This is sometimes referred to as the <span class="docEmphasis">pipe model</span>. In some cases, the Exp bits can even be used exclusively to encode the dropping precedence.</p>
<a name="ch05note05"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">Note that 3 bits allow up to 8 classes in the core, which so far has been plentiful in known core QoS deployments.</P>
</div><br>
<a name="ch05lev3sec7"></a>
<h5 class="docSection3Title">Configuration Example</H5>
<p class="docText">The following example shows how you can implement DiffServ in a 6PE or 6VPE network. Let's assume that the CE is unmanaged and does not always set the proper values for the DSCP field. Therefore, the SP wants to classify and mark explicitly the MPLS Exp field for traffic coming from this CE.</P>
<p class="docText">The first step is to classify incoming traffic from the CE. This is done using the following ALCs that identify the following:</p>
<a name="ch05pro02"></a><ul class="doclist" start=""><li>RTP traffic under the UDP ports 16383 or 16384<br><br>
</LI><li>Traffic to 2001:300::/64 or with flow label set to 1111<br><br>
</li><LI>BGP traffic<BR><BR>
</li></ul>
<p class="docText"><a class="docLink" href="#ch05ex06">Example 5-6</a> shows the configuration of the ACLs identifying these three traffic types.</p>
<a name="ch05ex06"></a><h5 class="docExampleTitle">Example 5-6. Access Lists Identifying Three Traffic Types</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>ipv6 access-list RTP
 permit udp any any eq 16383
 permit udp any any eq 16384
!
ipv6 access-list BUSINESS
 permit ipv6 any 2001:300::/64
 permit ipv6 any any flow-label 1111
!
ipv6 access-list RP
 sequence 20 permit tcp any eq bgp any</pre><br>

</td></tr></table></p>
<p class="docText">On the 6PE, the following four access classes are defined:</p>
<a name="ch05pro03"></a>




<table border="0" class="docText"><tr><TD width="25" valign="top"><div class="docText"><B>1. </b></div></TD><TD><div class="docText">VoIP<BR><br>
</div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>2. </b></div></td><td><div class="docText">Business Data<br><br>
</div></td></tr><TR><td width="25" valign="top"><div class="docText"><b>3. </b></div></TD><TD><div class="docText">Management Traffic<br><br>
</div></td></tr><TR><td width="25" valign="top"><div class="docText"><b>4. </b></div></td><td><div class="docText">Internet<BR><BR>
</div></TD></tr></table>
<p class="docText">The Internet class uses the default class, which is always present on Cisco routers. The traffic for classes 1 to 3 is classified based on the DSCP values and access lists above, using the class maps shown in <a class="docLink" href="#ch05ex07">Example 5-7</a>.</p>
<a name="ch05ex07"></a><h5 class="docExampleTitle">Example 5-7. Configuration of the Four Access Classes Defined for the 6PE QoS Example</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre><span class="docEmphMark">class-map match-any voip</span>
 match  dscp cs5
 match access-group name RTP
!
<span class="docEmphMark">class-map match-any business</span>
 match access-group name BUSINESS
 match dscp af31
 match dscp af32
 match dscp af33
!
<span class="docEmphMark">class-map match-any management</span>
 match dscp 6
 match access-group name RP</pre><br>

</td></tr></table></p>
<p class="docText">In the MPLS core network, another four classes (could be fewer) are defined, and specific Exp fields are associated to each:</p>
<a name="ch05pro04"></a>




<table border="0" class="docText"><tr><td width="25" valign="top"><div class="docText"><B>1. </b></div></TD><TD><div class="docText">Real-Time (RT) for Voice and Video (EXP=5)<BR><BR>
</div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>2. </b></div></td><td><div class="docText">Business Class data (BU) for golden customers or golden applications (EXP=3)<br><br>
</div></td></tr><tr><TD width="25" valign="top"><div class="docText"><b>3. </b></div></td><TD><div class="docText">Control Traffic (CTRL) for BGP and SNMP (EXP=6)<BR><br>
</div></td></tr><tr><TD width="25" valign="top"><div class="docText"><b>4. </b></div></td><td><div class="docText">Internet data (STD) for anything else (EXP=0)<br><BR>
</div></TD></TR></table>
<p class="docText">Note that the MPLS core classes apply to both IPv4 and IPv6 traffic, and in most cases preexist to the enabling of 6PE or 6VPE. A policy map is configured referring the set of classes defined on the access, and setting the Exp field in labels imposed at the 6PE/6VPE as shown in <a class="docLink" href="#ch05ex08">Example 5-8</a>.</p>
<a name="ch05ex08"></a><h5 class="docExampleTitle">Example 5-8. Policy Identifying the Exp Bits to be Assigned to Tagged IPv6 Packets Belonging to the Four Access QoS Classes</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>policy-map <span class="docEmphStrong">CE1</span>
 class voip
  set mpls experimental imposition 5
 class management
  set mpls experimental imposition 6
 class business
  set mpls experimental imposition 3
 class class-default
  set mpls experimental imposition 0</pre><br>

</td></tr></table></p>
<p class="docText">The policy map is then applied inbound to the 6PE interface facing the CE:</p>
<div class="docText"><pre>interface Serial0/0
 ip address 50.1.1.2 255.255.255.0
 service-policy input <span class="docEmphStrong">CE1</span>
 ipv6 address 2001:10::72B/64</pre></div><br>
<p class="docText">Core policies are also defined on the 6PE router, consistent with the ones on each P-router in the core, as shown in <a class="docLink" href="#ch05ex09">Example 5-9</a>.</p>
<a name="ch05ex09"></a><h5 class="docExampleTitle">Example 5-9. Configuration of the Four Core Classes and the Corresponding Policies Defined for the 6PE QoS Example</H5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><TD>


<pre><span class="docEmphMark">class-map match-any RT</span>
 match mpls experimental topmost 5
!
<span class="docEmphMark">class-map match-any MNGT</span>
 match mpls experimental topmost 6
<span class="docEmphMark">class-map match-any BUS</span>

 match mpls experimental topmost 3
!
<span class="docEmphMark">policy-map TO-CORE</span>
<span class="docEmphMark">class RT</span>
   police 64000
  priority 64
!
<span class="docEmphMark">class MNGT</span>
  bandwidth 10
  police cir 10000
    exceed-action drop
!
<span class="docEmphMark">class BUS</span>
  bandwidth 154
  police cir 154000
    conform-action transmit
    exceed-action drop</pre><BR>

</td></tr></table></p>
<p class="docText"><a name="iddle1008"></a><a name="iddle1019"></a><a name="iddle1852"></a>The policy is applied outbound on the core-facing interface, as shown in <a class="docLink" href="#ch05ex10">Example 5-10</a>.</p>
<a name="ch05ex10"></a><h5 class="docExampleTitle">Example 5-10. Applying QoS Policies on the Core-Facing Interface of the 6PE Router</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>interface Serial2/0
 ip address 40.1.1.2 255.255.255.0
 ip router isis
 <span class="docEmphMark">service-policy output TO-CORE</span>
 tag-switching ip</pre><br>

</td></tr></table></P>
<p class="docText">At the egress 6PE or 6VPE, the DSCP field can be overwritten based on specific policies, including the value of the Exp field, or simply left to the value they had at the ingress PE, before entering the MPLS network.</p>
<p class="docText">Note that in the preceding example, the PE is explicitly setting the Exp field. In fact, in most cases, the SP will just carry the DSCP field, with the advantage that no classification needs to take place at the PE. So the ingress input policies and corresponding policy map (CE1) are not necessary.</p>


<a name="ch05lev2sec5"></a>
<H4 class="docSection2Title">Using RSVP-TE in a 6PE or 6VPE Environment</H4>
<p class="docText">IP routing protocols are not good at optimizing network utilization and performance. Although they can recover from network failures, they typically select the shortest path to a destination, ignoring other paths. Amazingly, loop-avoidance mechanisms rely significantly on the assumption that all nodes within a routing area have a consistent view of the topology, hence will be using the same path to the destination. Shortest-path routing often leads to unbalanced traffic distribution across the network, creating congestion hot spots in some areas, while some links are underutilized.</p>
<p class="docText"><a name="iddle1360"></a><a name="iddle1592"></a><a name="iddle1967"></a>One well-known issue related to the topic is the so-called <span class="docEmphasis">fish problem</span>, named after the shape of the typical topology that illustrates it. In <a class="docLink" href="#ch05fig04">Figure 5-4</a>, traffic flowing from 6PE2 to 6PE1 and beyond will tend to use only one path (for instance, via P1).</p>
<a name="ch05fig04"></a><p><center>
<h5 class="docFigureTitle">Figure 5-4. Using RSVP-TE with 6PE</H5>
<p class="docText"><div class="v1"><a target="_self" href="images/05fig04_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="244" SRC="images/05fig04.jpg"></p>
</center></p><br>
<p class="docText">Load balancing may sometimes help improve the traffic distribution, but is certainly not the panacea, particularly when unequal cost paths are available. In the most common case, label binding is based on routing information, and MPLS performs destination-based forwarding. However, by enabling source-routing-like mechanisms via the label switch path (LSP), MPLS offers good opportunities to resolve the issue of bandwidth optimization. When more flexible (or rather more controlled) forwarding policies are required, RSVP-TE provides alternative for label binding, other than exclusively based on routing information. With RSVP-TE, you can define forwarding policies at a granularity of a flow or group of flows. This technology is referred to as MPLS <span class="docEmphasis">traffic engineering.</span> One or many tunnels are set up between edge routers (PEs) or between core routers (Ps), explicitly or automatically, based on available and required bandwidth. The traffic between tunnels' endpoints can then select a particular tunnel based on a variety of criteria. Those criteria encompass different strategies:</p>
<UL><LI><p class="docList">Applications driven (for instance, by looking at UDP or TCP port numbers)</P></li><li><p class="docList">Customers driven (for instance, by looking at source/destination, or at the incoming interface [at PE-CE boundary])</p></li><li><p class="docList">Network layer driven (for instance, IPv4 or IPv6)</p></li><li><p class="docList">QoS driven (using the DSCP or Exp fields, respectively, in the IP [IPv4 or IPv6] or in the MPLS headers)</p></li></ul>
<p class="docText">One common MPLS-based approach for traffic engineering is the overlay model. Service providers build a virtual network that includes a full mesh of logically connected PEs.</p>
<p class="docText">These logical connections can be MPLS explicit routes enforced via bandwidth reservation. The MPLS LSPs explicitly set up using RSVP-TE can be used to replace the LSP routes provided by the combination of an interior gateway protocol (IGP) and LDP to enable more efficient resource utilization.</p>
<p class="docText">Both <a class="docLink" href="ch03.html#ch03">Chapter 3</a>, &quot;Delivering IPv6 Unicast Services&quot; and <a class="docLink" href="ch07.html#ch07">Chapter 7</a>, &quot;VPN IPv6 Architecture and Services,&quot; review in detail the way IPv6 traffic can use IPv4-signaled LSPs. A direct consequence is that whichever mechanism is available at the IPv4 LSP level can be beneficial to 6PE and 6VPE. As far as MPLS-TE is concerned, RSVP-TE can be used in the IPv4-based MPLS core to optimize the bandwidth and for fast-reroute purposes. The tunnels are set up exactly as they would be for providing the service to IPv4 traffic. In fact, it is recommended that the tunnels be set up for both IPv4 and IPv6 at the same time because the criteria to select these tunnels have less to do with the network layer than with applications, type of traffic, or specific customer.</p>
<p class="docText">There are (at least) two methods for selecting the RSVP-TE tunnels for IPv6 (6PE or 6VPE) traffic:</P>
<UL><LI><p class="docList">The egress 6PE (or 6VPE) could advertise several different BGP next hops for different sets of reachable destinations. These next hops (IPv4-mapped IPv6 addresses) can then be used as the tail end of RSVP tunnels by the ingress 6PE.</P></LI><li><p class="docList">The ingress 6PE could set up multiple TE tunnels to the egress 6PE and select one or the other based on MPLS QoS after label imposition.</p></li></ul>
<p class="docText">Examples of each are provided in the next sections.</p>
<a name="ch05lev3sec8"></a>
<h5 class="docSection3Title">Using Multiple BGP Next Hops</h5>
<p class="docText">The egress 6PE can explicitly set up the next hop announced in BGP updates, based, for instance, on prefixes being advertised. The following configuration provides an example of this technique.</p>
<p class="docText">A route map is defined that sets different next hops for different match criteria as shown in <a class="docLink" href="#ch05ex11">Example 5-11</a>.</p>
<a name="ch05ex11"></a><h5 class="docExampleTitle">Example 5-11. Route Maps and Corresponding Access Lists Identifying the TE Tunnel-Selection Criteria</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><td>


<pre>PE1#
ipv6 prefix-list list-te1 seq 5 permit 2001:100::/64
!
ipv6 prefix-list list-te2 seq 5 permit 2001:200::/64
route-map NH-TE-SELECT permit 10
 match ipv6 address prefix-list list-te1
 set ipv6 next-hop ::FFFF:200.8.8.1
!
route-map NH-TE-SELECT permit 20
 match ipv6 address prefix-list list-te2
 set ipv6 next-hop ::FFFF:200.9.9.1</pre><br>

</TD></TR></table></p>
<p class="docText">The route map is applied on prefixes announced by the 6PE, as shown in <a class="docLink" href="#ch05ex12">Example 5-12</a>.</p>
<a name="ch05ex12"></a><h5 class="docExampleTitle">Example 5-12. Applying the Route-Maps Defined in <a class="docLink" href="#ch05ex11">Example 5-11</a> to the Prefixes Advertised by the 6PE Router</h5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>PE1#
router bgp 100
 neighbor 200.10.10.1 remote-as 100
 neighbor 200.10.10.1 update-source Loopback0
 !
address-family ipv6
 neighbor 200.10.10.1 activate
 neighbor 200.10.10.1 route-map NH-TE-SELECT out
 neighbor 200.10.10.1 send-label</pre><br>

</td></TR></table></P>
<p class="docText">At the ingress PE, two RSVP-TE tunnels are set up, as shown in <a class="docLink" href="#ch05ex13">Example 5-13</a>.</P>
<a name="ch05ex13"></a><h5 class="docExampleTitle">Example 5-13. Two TE Tunnels Configured on the PE Router</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>interface Tunnel1
 ip unnumbered Loopback0
 tunnel destination 200.11.11.1
 tunnel mode mpls traffic-eng
 tunnel mpls traffic-eng priority 7 7
 tunnel mpls traffic-eng bandwidth 10
 tunnel mpls traffic-eng path-option 1 explicit name te1
 tunnel mpls traffic-eng record-route
!
interface Tunnel2
 ip unnumbered Loopback0
 tunnel destination 200.11.11.1
 tunnel mode mpls traffic-eng
 tunnel mpls traffic-eng priority 7 7
 tunnel mpls traffic-eng bandwidth 10
 tunnel mpls traffic-eng path-option 1 explicit name te2</pre><br>

</td></tr></table></p>
<p class="docText">In this example, the tunnel paths are explicitly configured as shown in <a class="docLink" href="#ch05ex14">Example 5-14</a>.</p>
<a name="ch05ex14"></a><h5 class="docExampleTitle">Example 5-14. Explicit Configuration of the Tunnel Paths</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><TD>


<pre>ip explicit-path name te1 enable
 next-address 30.1.1.3
 next-address 40.1.1.2
!
ip explicit-path name te2 enable
 next-address 31.1.1.3
 next-address 41.1.1.2</pre><BR>

</TD></TR></table></P>
<p class="docText">And static routes are configured to select the tunnel based on the next hop received from the egress PE (PE1):</p>
<div class="docText"><pre>ip route 200.8.8.1 255.255.255.255 Tunnel1
ip route 200.9.9.1 255.255.255.255 Tunnel2</pre></div><br>
<p class="docText"><a name="iddle1164"></a><a name="iddle1208"></a>At the ingress PE2, you can display the detailed LSP used by the forwarding plane (CEF) for destination 2001:100::/64 and 2001:200::/64. The output of the <span class="docEmphStrong">show ipv6 cef</span> command provides the following information:</p>
<a name="ch05ex15"></a><h5 class="docExampleTitle">Example 5-15. IPv6 CEF Information for Prefix 2001:100::/64</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>PE2#<span class="docEmphStrong">show ipv6 cef 2001:100::/64 internal</span>
  recursive via 200.8.8.1[IPv4:Default] label 17, fib 024AC3E8, 1 terminal fib
    attached to Tunnel1, adjacency IP midchain out of Tunnel1 027F4918
  output chain: label 17 TAG midchain out of Tunnel1 027F47A8 label 16 TAG adj out
   of Ethernet0/0, addr 30.1.1.3 027F4D68
PE2#show ipv6 cef 2001:200::/64 internal
  recursive via 200.9.9.1[IPv4:Default] label 16, fib 024AC360, 1 terminal fib
    attached to Tunnel2, adjacency IP midchain out of Tunnel2 027F44C8
  output chain: label 16 TAG midchain out of Tunnel2 027F4358 label 16 TAG adj out
of Ethernet2/0, addr 31.1.1.3 027F4A88</pre><br>

</td></tr></table></p>
<p class="docText">Note that the two paths are distinct from the start, one via interface Ethernet0/0 and the other via interface Ethernet2/0.</P>

<a name="ch05lev3sec9"></a>
<h5 class="docSection3Title">COS-Based TE Tunnel Selection (CBTS)</h5>
<p class="docText">The idea of CBTS is to allow different parallel tunnels between the same head end and the same tail end to each carry a different subset of the class of service (CoS).</P>
<p class="docText">At ingress PE, the CBTS configuration involves the following:</P>
<ul><li><p class="docList">Create multiple TE tunnels with the same head end and same tail end. Existing TE attributes are configured completely independently for each tunnel (bandwidth, bandwidth pools, preemption priorities, path options, and so on).</p></li><LI><p class="docList">Indicate on each of these tunnels which DiffServ code points are to be transported.</p></li><li><p class="docList">Make these tunnels visible to routing. This can be achieved using Autoroute (every prefix via the tail end of the tunnel is routed via the tunnel) or using static routes pointing to the tunnels.</p></LI></UL>
<p class="docText">At the ingress PE, one tunnel is then selected over the other based on the Exp field value found in the topmost label of each packet. As previously discussed, packets arriving unlabeled (IPv6 packets) at ingress 6PE can be classified and marked with a particular Exp value while the label stack is being imposed, so that CBTS <span class="docEmphasis">at the same node</span> can then use this value to further select the tunnel matching the corresponding code points.</P>
<p class="docText">In the following example, tunnels (tunnel1 and tunnel2) are configured the same way as in <a class="docLink" href="#ch05ex13">Example 5-13</a>, and again, CEF has parallel paths to get to a particular destination prefix, via tunnel1 or tunnel2. But in CBTS case, each tunnel gets the additional command highlighted in <a class="docLink" href="#ch05ex16">Example 5-16</a>.</p>
<a name="ch05ex16"></a><h5 class="docExampleTitle">Example 5-16. Tunnel Configuration Example in the CBTS Scenario</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>interface Tunnel1
 ip unnumbered Loopback0
 tunnel destination 200.11.11.1
 tunnel mode mpls traffic-eng
 tunnel mpls traffic-eng priority 7 7
 tunnel mpls traffic-eng bandwidth  10
 tunnel mpls traffic-eng path-option 1 explicit name te1
 tunnel mpls traffic-eng record-route
 <span class="docEmphMark">tunnel mpls traffic-eng exp 3</span>
!
interface Tunnel2
 ip unnumbered Loopback0
 tunnel destination 200.11.11.1
 tunnel mode mpls traffic-eng
 tunnel mpls traffic-eng priority 7 7
 tunnel mpls traffic-eng bandwidth  10
 tunnel mpls traffic-eng path-option 1 explicit name te2
 <span class="docEmphMark">tunnel mpls traffic-eng exp 5</span></pre><br>

</td></tr></table></p>
<p class="docText">Then, as in the DiffServ example, traffic is classified and the Exp field is set, so that some of this traffic is put into tunnel1 and some into tunnel2 (see <a class="docLink" href="#ch05ex17">Example 5-17</a>).</p>
<a name="ch05ex17"></a><h5 class="docExampleTitle">Example 5-17. Configuration of Policies Setting the Exp Bits Used for Tunnel Selection in the CBTS Scenario</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><TD>


<pre><span class="docEmphMark">policy-map CE1</span>
 class tunnel1
  set mpls experimental imposition 3
 class tunnel2
  set mpls experimental imposition 5
!
interface Serial0/0
 ip address 50.1.1.2 255.255.255.0
 <span class="docEmphMark">service-policy input CE1</span>
ipv6 address 2001:10::72B/64</pre><BR>

</TD></TR></table></p>
<p class="docText">In this example, classification (class map for class tunnel1 and tunnel2) is not shown, but would be similar to the examples detailed in DiffServ sections. The CE1 policy is applied inbound on the CE-facing interface.</p>
<a name="ch05note06"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">At the time of this writing, CBTS, when used in conjunction with 6PE or 6VPE, is not yet available on Cisco routers. The feature will become available in the near future.</p>
</div><br>



<a href="22971536.html"><img src="images/pixel.jpg" alt="" width="1" height="1" border="0"></a></TD></TR></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch05lev1sec1.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch05lev1sec3.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
</body></html>