<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>Neighbor Discovery Protocol</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch02lev1sec3.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch03.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><TR><TD valign="top"><a name="ch02lev1sec4"></a>
<H3 class="docSection1Title">Neighbor Discovery Protocol</h3>
<p class="docText">IPv6 Neighbor Discovery (ND) was first designed and published almost 10 years ago, as RFC 1970. It has been revised since then as RFC 2461, and a new version, focusing on fixes rather than revisions, is underway as RFC 2461bis. Some extensions have been described in <span class="docEmphasis">Inverse Neighbor Discovery</span> (RFC 3122), <span class="docEmphasis">Default Router Selection</span> (RFC4191), and <span class="docEmphasis">Autoconfiguration</span> (RFC 2462).</p>
<p class="docText">In these 10 years, the focus of the Internet community has shifted significantly, and areas that did not get much attention, such as security and mobility, are now the focus of most of the efforts. This change of focus has led to a number of extensions, clarifications, and interactions described in various RFCs and Internet Drafts: <span class="docEmphasis">Extension for Mobility</span> <span class="docEmphasis">in MIPv6</span> (RFC 3775), <span class="docEmphasis">Security Features in Secure Neighbor Discovery (SEND)</span> (RFC 3971), <span class="docEmphasis">Detecting Network Attachment (DNA)</span> (RFC 4135), <span class="docEmphasis">Protocol for Carrying Authentication for Network Access (PANA)</span> (RFC 4058), and <span class="docEmphasis">Optimistic DAD</span> (draft-ietf-ipv6-optimistic-dad).</p>
<p class="docText">The IPv6 NDP provides a number of integrated key features for router and host operations, when attached to the same link. Some of these features, such as address resolution and redirect, are seen in IPv4, under specific distinct protocols such as ARP and ICMP Redirect, respectively. Other featuresfor instance, prefix discovery and neighbor unreachability detectionare new, although some could be achieved by other means with IPv4, too. <a class="docLink" href="#ch02table12">Table 2-12</a> lists these features and their correspondence in IPv4.</p>
<a name="ch02table12"></a><p><table cellspacing="0" class="allBorders" border="1" RULES="all" cellpadding="4"><caption><h5 class="docTableTitle">Table 2-12. IPv6 NDP Feature Counterpart in IPv4</h5></caption><colgroup><col width="150"><col width="200"><col width="200"></colgroup><thead><tr><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">IPv6 ND Feature</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Short Description</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">IPv4</p></th></tr></thead><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Router discovery</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Enables hosts to locate routers on attached links</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">ICMP Router Discovery (RFC 1256)</p>
<p class="docText">Routing protocols snooping</P></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Prefix discovery</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Enables hosts to learn prefixes used on attached links</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Not available</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Parameter discovery</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Enables nodes to learn parameters such as link MTU or hop limit</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">PMTU Discovery (RFC 1191)</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText">Address autoconfiguration</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Enables hosts to configure automatically an address</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Not available</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Address resolution</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Enables nodes to determine link-layer address for on-link destinations</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">ARP</p></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText">Next-hop determination</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Enables nodes to determine the next hop for a given destination</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">ARP cache for on-link prefixes</P>
<p class="docText">Default router otherwise</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Neighbor unreachability detection</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Enables nodes to detect that a neighbor is no longer reachable</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Dead Gateway Detection (RFC 816, RFC 1122)</p></td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText">Duplicate address detection</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Enables nodes to determine addresses already in use</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">ARP with source=0</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Redirect</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Enables routers to inform hosts of a better next hop on the link for a particular destination</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">ICMP Redirect</p></TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Default router and more specific route selection</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Enables routers to inform multihomed hosts of better default routers and more specific routes</p></td><td class="docTableCell" align="left" valign="top">&nbsp;</td></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText">Proxying nodes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Accepts packets on behalf of other nodes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Proxy-ARP</p></td></tr></table></p><br>
<p class="docText">NDP applies to both hosts and routers in different ways. <a class="docLink" href="#ch02table13">Table 2-13</a> attempts to separate hosts and router roles, with regard to the preceding list of features.</p>
<a name="ch02table13"></a><p><table cellspacing="0" class="allBorders" border="1" RULES="all" cellpadding="4"><caption><h5 class="docTableTitle">Table 2-13. Host and Router Roles with Regard to NDP</H5></caption><colgroup><col width="145"><col width="145"><col width="145"><col width="115"></colgroup><thead><TR><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Host Algorithms</P></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Host-Host Communication</P></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Host-Router Communication</P></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Node-Node Communication</p></th></tr></thead><tr><td class="docTableCell" align="left" valign="top" rowspan="2"><p class="docText">Default router selection</p></td><td class="docTableCell" align="left" valign="top" rowspan="2"><p class="docText">Neighbor unreachability detection</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Router discovery</p></td><TD class="docTableCell" align="left" valign="top" rowspan="2"><p class="docText">Address resolution</p></td></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Default router selection</p></td></tr><TR><td class="docTableCell" align="left" valign="top" rowspan="3"><p class="docText">Next-hop determination</p></td><td class="docTableCell" align="left" valign="top" rowspan="3"><p class="docText">Duplicate address detection</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Prefix discovery</p></td><td class="docTableCell" align="left" valign="top" rowspan="3"><p class="docText">Redirect</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Parameter discovery</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">More-specific route</p></TD></TR></table></P><BR>
<p class="docText">One of the fundamental differences between IPv6 ND and its IPv4 counterpart suite of protocols (ARP, IPCP, and so on) is the positioning in the IP protocol stack. Although IPv4 same-link-related protocols are split between ARP/RARP, right above the link layer, and ICMP, running above IP, IPv6 ND is implemented entirely within ICMPv6. <a class="docLink" href="#ch02fig20">Figure 2-20</a> highlights differences between the protocol stacks.</P>
<a name="ch02fig20"></a><p><center>
<h5 class="docFigureTitle">Figure 2-20. IPv4 and IPv6 Protocol Stack Comparison</h5>
<p class="docText"><div class="v1"><a target="_self" href="images/02fig20_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="332" SRC="images/02fig20.jpg"></p>
</center></p><br>
<p class="docText">The reasons for the ND positioning within the stack are numerous, but if only one should be mentioned, it is simplicity. Why make address resolution (ARP and RARP in IPv4) a special case if this can be avoided? When <span class="docEmphasis">within ICMP</span> rather than <span class="docEmphasis">next to</span> IP, this feature can benefit from any service provided by IP, including security (Authentication Header), multicast, and so on.</p>
<p class="docText">To secure the various functions in NDP, Secure Neighbor Discovery has introduced a set of specific ND options. They are used to protect NDP messages. Although this IPv6 refresher does not go into more detail about these options, you can refer to RFC 3971 for more information about SEND.</p>
<a name="ch02lev2sec10"></a>
<h4 class="docSection2Title">Protocol Operations Summary</h4>
<p class="docText">The NDP enables each node on the link to perform ND, to build the knowledge necessary to make proper decisions when sending IPv6 packets to a neighbor. This knowledge represents a compilation of advertisements received from routers and nodes. These advertisements can be solicited or unsolicited. This information is stored on the following lists maintained by nodes:</p>
<ul><LI><p class="docList">List of on-link IPv6 addresses and corresponding link-layer addresses</p></li><LI><p class="docList">Neighbors status (reachable, unreachable)</P></li><li><p class="docList">For hosts in particular:</p><dl><dd><p class="docList">- List of on-link prefixes</p></dd><dd><p class="docList">- List of on-link routers</P></dd><dd><p class="docList">- List of default routers (on-link routers willing to be default routers)</p></dd></dl></li></ul>
<p class="docText">To obtain the above information, the following messages are used in the NDP:</p>
<UL><LI><p class="docList">Router solicitation (RS)</P></li><li><p class="docList">Router advertisement (RA)</p></li><li><p class="docList">Neighbor solicitation (NS)</p></li><li><p class="docList">Neighbor advertisement (NA)</p></li><li><p class="docList">Redirect</p></li><li><p class="docList">Inverse neighbor solicitation (INS)</P></LI><LI><p class="docList">Inverse neighbor advertisement (INA)</P></LI></ul>
<p class="docText">The positioning of NDP above IPv6/ICMP raises a couple of questions that deserve clarification.</p>
<p class="docText">When the link-layer address matching a given destination address is not known, a node seeking that association has to send its query to a wider audience. In IPv4, this is done using MAC-level broadcasts. In IPv6, the node uses multicasts for this query. The multicast group used is the solicited-node (with link-local scope), as described in the &quot;<a class="docLink" href="ch02lev1sec1.html#ch02lev1sec1">IPv6 Addressing</a>&quot; section.</p>
<a name="ch02note19"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">Note that after the link-layer address is known for a prefix, the neighbor query might be sent again, to confirm the association (IP address, link-layer address). In that case, the query is directly unicasted to the destination.</p>
</div><br>
<p class="docText">Another issue arises when a node is using NDP to acquire its own address (see the section &quot;<a class="docLink" href="#ch02lev3sec25">Autoconfiguration</a>&quot;). It needs a source address to use for its query but has none yet. In such cases, it can use the IPv6 unspecified address (::) for the packet SA.</p>
<p class="docText">Whereas address resolution messages are sent to the solicited-node multicast address (with link-local scope), other NDP messages are expected to reach all nodes or all routers. At the same time, the SA can be either a global or the link-local address of the sender: The latter is always preferred, to minimize the node's dependency on renumbering. Here is a list of all special addresses, sources, and destinations that a node can use in NDP exchanges:</p>
<ul><li><p class="docList">All-nodes multicast address (FF02::1, destination)</p></li><LI><p class="docList">All-routers multicast address (FF02::2, destination)</p></li><LI><p class="docList">Solicited-node multicast address (destination)</P></li><li><p class="docList">Link-local address (source or destination)</p></li><LI><p class="docList">Unspecified address (::, source)</p></li></ul>
<p class="docText">Finally, two algorithms are leveraged by the IPv6 nodes to process the information gathered through NDP:</p>
<UL><LI><p class="docList">Next-hop determination algorithm</P></li><li><p class="docList">Default router selection</p></li></ul>

<a name="ch02lev2sec11"></a>
<h4 class="docSection2Title">Comparison with IPv4</h4>
<p class="docText">IPv6 NDP provides a number of improvements over the corresponding IPv4 protocols, as follows:</p>
<ul><li><p class="docList">Router discovery becomes an integrated part of the protocol, enabling hosts to identify their default router.</p></li><li><p class="docList">Additional information, such as MTU or link-layer address, has been inserted in the ND messages, reducing the number of required exchanges on the link to achieve the same result as in IPv4. Here are a few examples:</p><dl><dd><p class="docList">- The link-layer address of the router is carried in RA message. So all nodes on the link, without any further message flow, know it.</P></dd><dd><p class="docList">- The target link-layer address, inserted in the redirect message, saves the receiver (being redirected) any extra address-resolution exchange.</P></dd><dd><p class="docList">- The MTU, carried in the RA, enables all nodes on a link to use a consistent MTU.</P></dd></dl></LI><LI><p class="docList">The address resolution uses multicast groups (solicited-node multicast address), embedding part of the target address. Most likely, therefore, only a few (most of the time only the target address owner) nodes will get interrupted with such address-resolution queries. Compare this with IPv4 ARP, which has no other choice than broadcasting (link-layer broadcast) the address-resolution requests (because ARP sits directly above the link layer). One hopes that the IPv6 way of resolving link-layer addresses will make subnets with a much larger number of hosts more manageable by drastically limiting link-layer broadcasts that host software layers have to handle.</p></li><li><p class="docList">Some new features such as address autoconfiguration and neighbor unreachability detection are part of the base protocol, simplifying configurations and improving robustness of packet delivery.</p></li><li><p class="docList">Router advertisements and Redirect messages carry router addresses in the form of link-local addresses, which makes the router association in the host more robust to renumbering (of global prefixes). In IPv4, the default gateway information has to be modified on the host every time the network changes its addressing scheme.</p></li><li><p class="docList">The positioning of address resolution above ICMP makes it possible to use standard IP authentication and security mechanisms for ND messages. Such mechanisms are not available in ARP for IPv4.</p></li></ul>

<a name="ch02lev2sec12"></a>
<H4 class="docSection2Title">Router and Prefix Discovery</h4>
<p class="docText">Router discovery enables hosts to locate neighboring (on-link) routers and learn prefixes and parameters related to address configuration.</p>
<p class="docText">Two messages have been defined for router and prefix discovery: the router solicitation (RS) message and the router advertisement (RA) message.</P>
<p class="docText">Routers advertise themselves periodically (with a slight randomization to avoid synchronization, which could leave some time intervals with no routers being advertised) out of each interface by sending RAs. These unsolicited RAs are sent to the all-nodes &quot;link-local scope multicast address&quot; (FF02::1). In addition to providing the router address, RAs can contain useful information for hosts to perform next-hop determination, such as the following:</P>
<ul><li><p class="docList">List of candidate routers for default router (see the algorithm described in the &quot;<a class="docLink" href="#ch02lev3sec21">Default Router Selection</a>&quot; section)</p></li><LI><p class="docList">Parameters that should be used for autoconfiguration (see the &quot;<a class="docLink" href="#ch02lev3sec25">Autoconfiguration</a>&quot; section)</p></li><li><p class="docList">List of on-link prefixes (see the &quot;<a class="docLink" href="#ch02lev3sec20">Next-Hop Determination</a>&quot; section later in this chapter). This information makes the router discovery messages useful in the prefix discovery process.</p></LI></UL>
<p class="docText">The RA messages can also be sent as a response to a query (RS) from a host. This option proves particularly useful in mobility, to accelerate autoconfiguration. These solicited RAs are sent either to the all-nodes address or to the unicast address of the host, which issued the RS. As the RS is soliciting a response from on-link routers, it is typically sent to the all-routers multicast group. <a class="docLink" href="#ch02fig21">Figure 2-21</a> shows the flow for a solicited and for an unsolicited RA exchange.</P>
<a name="ch02fig21"></a><p><center>
<h5 class="docFigureTitle">Figure 2-21. Router Advertisement Flow</h5>
<p class="docText"><div class="v1"><a target="_self" href="images/02fig21_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="350" SRC="images/02fig21.jpg"></p>
</center></p><br>
<a name="ch02note20"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">In the case of a solicited RA, when the RS does not provide any IPv6 SA (typical for hosts that rely on RAs to autoconfigure themselves), the RA response is sent to all nodes.</p>
</div><br>
<p class="docText"><a class="docLink" href="#ch02fig22">Figure 2-22</a> shows a simple example of a Cisco router (Valbonne) sending a periodic RA to a host (host1). The interface configuration is grayed, the NDP debugging is enabled, and the <span class="docEmphStrong">debug</span> output is shown below the RA flow.</p>
<a name="ch02fig22"></a><p><center>
<h5 class="docFigureTitle">Figure 2-22. Router Advertisement Example</h5>
<p class="docText"><div class="v1"><a target="_self" href="images/02fig22_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="215" SRC="images/02fig22.jpg"></p>
</center></P><BR>
<p class="docText"><a class="docLink" href="#ch02fig22">Figure 2-22</a> shows a <span class="docEmphStrong">debug</span> trace interleaved with the RA flow.</P>
<p class="docText">The <span class="docEmphStrong">show ipv6 routers</span> command is used on a Cisco router to display RA information received from other on-link routers. Only the router sends RAs, and only the hosts install them in their database. So in the configuration in <a class="docLink" href="#ch02fig22">Figure 2-22</a>, this command applies only to host1 (a Cisco router in host mode). <a class="docLink" href="#ch02ex10">Example 2-10</a> shows the output of this command.</P>
<a name="ch02ex10"></a><H5 class="docExampleTitle">Example 2-10. Host Perspective of Advertised Routers.</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>host1#<span class="docEmphStrong">show ipv6 routers</span>
Router FE80::A8BB:CCFF:FE01:F600 on Ethernet0/0, last update 2 min
  Hops 64, Lifetime 1800 sec, AddrFlag=0, OtherFlag=0, MTU=1500
  Reachable time 0 msec, Retransmit time 0 msec
  Prefix 2001:100::/64 onlink autoconfig
    Valid lifetime 2592000, preferred lifetime 604800
  Prefix 2001:200::/64 onlink autoconfig
    Valid lifetime 2592000, preferred lifetime 604800</pre><br>

</td></tr></table></p>

<a name="ch02lev2sec13"></a>
<h4 class="docSection2Title">Address Resolution</h4>
<p class="docText">The neighbor solicitation and neighbor advertisement packets are used to perform several critical node operations:</p>
<ul><LI><p class="docList">Link-layer address resolution</p></li><LI><p class="docList">Duplicate address detection (DAD)</P></li><li><p class="docList">Neighbor unreachability detection (NUD)</p></li></UL>
<p class="docText">DAD and NUD are described in next sections. ND link-layer resolution provides a similar service to ARP in IPv4, although using a slightly different method.</p>
<p class="docText">Two ICMPv6 messages have been defined for IPv6 address resolution: the neighbor solicitation (NS) message and the neighbor advertisement (NA) message. The NS is the query and contains the target (queried) IPv6 address. The NA is the response and contains the link-layer address of the matching interface.</p>
<p class="docText">When a node has concluded that a particular next hop or destination IPv6 address is on-link (see the section &quot;<a class="docLink" href="#ch02lev3sec20">Next-Hop Determination</a>&quot; later in this chapter), it sends out an NS on the identified link, to obtain the link-layer address matching the IPv6 address. The expected response is an NA.</p>
<p class="docText">The NS is a multicast to the solicited-node multicast group, embedding the rightmost 24 bits of the queried IPv6 address. There are potentially multiple nodes subscribed to the same solicited-node multicast address, with the &quot;owner&quot; of that address being one of them. The owner will get the NS along with the other members of the multicast group, and answer with an NA.</p>
<a name="ch02note21"></a><div class="docNote"><p class="docNoteTitle">Note</P>

<p class="docText">NDP is a nonreliable protocol. On most link types, this is fine, because the probability of &quot;losing&quot; a message, such as an NS or NA, is low. On wireless links, however, this may become an issue. In particular, DAD could conclude that an address is free to use, whereas in fact, the NA was lost.</P>
</div><BR>
<p class="docText">A host can also send an unsolicited NA. This could happen when the node wishes to inform the other nodes on the link about a change in their link-layer address. The unsolicited NA is sent to all-nodes multicast address.</p>
<p class="docText">After the node has received the NA, the neighbor from whom it has been received is considered &quot;reachable.&quot; Monitoring the reachability is the purpose of NUD. See the sections &quot;<a class="docLink" href="#ch02lev3sec23">Neighbor Unreachability Detection</a>&quot; and &quot;<a class="docLink" href="#ch02lev3sec24">The State Machine for Reachability</a>&quot; for details. <a class="docLink" href="#ch02fig23">Figure 2-23</a> shows the flow for the address-resolution process.</p>
<a name="ch02fig23"></a><p><center>
<h5 class="docFigureTitle">Figure 2-23. Address-Resolution Flow</h5>
<p class="docText"><div class="v1"><a target="_self" href="images/02fig23_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="335" SRC="images/02fig23.jpg"></p>
</center></p><br>
<p class="docText">On Cisco routers, the association (layer 3 address, link-layer address) is stored in the neighbor cache. The command <span class="docEmphStrong">show ipv6 neighbor</span> executed on each router lists the neighbor cache content. In <a class="docLink" href="#ch02ex11">Example 2-11</a>, the biot neighbor cache has two entries that relate to router valbonne: 2001:200::72b and FE80::A8BB:CCFF:FE01:F600. They are listed in &quot;reachable&quot; state along with the corresponding link-layer address.</p>
<a name="ch02ex11"></a><h5 class="docExampleTitle">Example 2-11. Example of IPv6 Neighbor Cache</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>biot#<span class="docEmphStrong">show ipv6 neighbor</span>
IPv6 Address                   Age   Link-layer          AddrStateInterface
2001:200::72B                  0     aabb.cc01.f600      REACH Et0/0
FE80::A8BB:CCFF:FE01:F600      0     aabb.cc01.f600      REACH Et0/0</pre><BR>

</TD></TR></table></P>

<a name="ch02lev2sec14"></a>
<H4 class="docSection2Title">Redirecting a Host to a Better Next Hop</h4>
<p class="docText">Routers send redirect messages to inform hosts of a better next hop, whether another router or the final destination itself, should it be on-link. The IPv6 redirect mechanism is similar to the IPv4 redirect mechanism. Only one message, the redirect message, is necessary to achieve the redirect functionality. It contains the IP address that is a better next hop and the IP address of the destination that is redirected. If the link-layer address of the better next hop (R2) is known, it can be inserted in the redirect packet sent by the router (R1) issuing the redirect message.</p>
<a name="ch02note22"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">In theory, the previously described process could save an address-resolution exchange between the host and the router R2. In practice, the benefit may be limited. The router R2 is likely, at some point, to route some traffic back to the host. To do so, it will need to initiate an NS/NA exchange to determine the host link-layer address. This flow would have been unnecessary had the host initiated an address-resolution flow to find R2's link-layer address. The link-layer address of the initiator of the NS can indeed also be inserted, as an option, in the NS packet.</p>
</div><br>
<p class="docText"><a class="docLink" href="#ch02fig24">Figure 2-24</a> shows the flow for the redirect message.</p>
<a name="ch02fig24"></a><p><center>
<h5 class="docFigureTitle">Figure 2-24. Redirect Flow</h5>
<p class="docText"><div class="v1"><a target="_self" href="images/02fig24_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="334" SRC="images/02fig24.jpg"></p>
</center></p><br>

<a name="ch02lev2sec15"></a>
<H4 class="docSection2Title">Inverse Neighbor Discovery</h4>
<p class="docText">As mentioned earlier, ND fulfills, for IPv6, the same functionality as ARP does for IPv4. In this context, similar reasons that drove an inverse-ARP protocol led to extensions to IPv6 ND called IPv6 Inverse Neighbor Discovery (IND). The details of this extension are specified in RFC 3122.</p>
<p class="docText">The IPv6 IND enables a node to learn IPv6 addresses for which it knows the link-layer address. To achieve this, it sends solicitations and receives advertisements. The IND was originally developed for Frame Relay networks, but may also apply to other data-link technologies with similar behavior. Two messagesthe inverse neighbor discovery solicitation (INS) and the inverse neighbor discovery advertisement (INA)have been defined. The INS contains the source link-layer address and the target link-layer address (for which the sender expect to get an IPv6 address). The response (INA) contains the source link-layer address, the target link-layer address, and a target address list. It contains the list of one or more IPv6 addresses of the interface identified by the target link-layer address in the INS message that prompted the INA.</P>
<p class="docText">Note that at the time of this writing, RFC 3122 is not supported on Cisco routers.</P>

<a name="ch02lev2sec16"></a>
<h4 class="docSection2Title">Proxy Neighbor Discovery</h4>
<p class="docText">An IPv4 node has the capability to proxy subnets for hosts that do not understand subnet (or are misconfigured) or default routers. This function is sometimes referred to as <span class="docEmphasis">proxy-ARP</span> and is specified in RFC 1027. IPv6 does not carry over that concept; instead, it requires IPv6 hosts to process RAs and to come up with a default router to which nonlocal traffic can be sent. Furthermore, proxying an entire subnet might be, for many systems, impractical. They could set the interface in promiscuous mode, or all-multicast mode, to receive all NSs, but, besides performance issues this potentially raises, not all systems support these modes.</p>
<p class="docText">In some cases, however, it might prove useful for a router to act on behalf of nodes that are away from the link but want neighbors to believe they are not. A classical example is a mobile node that has moved off-link. To achieve this limited proxy address-resolution function, the router just has to register to the solicited-node multicast addresses it wants to proxy and answer NSs on their behalf.</p>

<a name="ch02lev2sec17"></a>
<H4 class="docSection2Title">Neighbor Discovery Algorithms</h4>
<p class="docText">A number of ND algorithms have been defined to describe the expected behavior of both hosts and routers in a variety of operational situations. The following subsections discuss these algorithms:</p>
<a name="ch02lev3sec20"></a>
<h5 class="docSection3Title">Next-Hop Determination</h5>
<p class="docText">As in IPv4, a node that needs to forward a packet must find out whether the destination is on-link or off-link. In the latter case, it must subsequently find an on-link neighbor (next hop) that can forward the packet to the destination. Finally, it has to resolve the on-link destination address, or the on-link next hop, into a link-layer address.</P>
<p class="docText">Unlike IPv4, a destination (or next hop) can be on-link, without the forwarding node having a prefix matching the destination address. An address will be considered on-link by a node if</P>
<UL><li><p class="docList">It is covered by one of its link's prefixes.</p></li><li><p class="docList">It received an NA for that address.</p></li><li><p class="docList">It received <span class="docEmphasis">any</span> ND message from that address.</p></li><li><p class="docList">It received an RA with this prefix in the prefix information option.</p></li><li><p class="docList">It received a redirect message with a target equal to that address.</p></LI></UL>
<p class="docText">The algorithm used to forward a packet is set fairly differently on hosts or routers. A router has a routing table and a neighbor cache (same as ARP cache for IPv4). The first one (the Routing Information Base, or RIB) contains next hops for a given destination match (longest match); the latter contains link-layer addresses for on-link nodes, either final destination or next hops. Cisco routers also have a forwarding table (Forwarding Information Base, or FIB), which takes the RIB one step further by pre-resolving recursive entries to accelerate the forwarding process. In routers, regular routing mechanisms take precedence over information obtained from neighboring routers via prefix discovery or router discovery mechanisms. Then NS/NA messages enable link-layer resolution.</P>
<p class="docText"><a class="docLink" href="#ch02ex12">Example 2-12</a> shows the routing tables and the neighbors of a router in <a class="docLink" href="#ch02fig24">Figure 2-24</a>.</P>
<a name="ch02ex12"></a><H5 class="docExampleTitle">Example 2-12. Routing and Neighbor Information on an IPv6 Router</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>valbonne#<span class="docEmphStrong">show ipv6 route</span>
IPv6 Routing Table - default - 7 entries
Codes: C - Connected, L - Local, S - Static, R - RIP, B - BGP
       U - Per-user Static route
       I1 - ISIS L1, I2 - ISIS L2, IA - ISIS interarea, IS - ISIS summary
       O - OSPF intra, OI - OSPF inter, OE1 - OSPF ext 1, OE2 - OSPF ext 2
       ON1 - OSPF NSSA ext 1, ON2 - OSPF NSSA ext 2
C   2001:100::/64 [0/0]
     via Ethernet0/0, directly connected
L   2001:100::72B/128 [0/0]
     via Ethernet0/0, receive
C   2001:200::/64 [0/0]
     via Ethernet0/0, directly connected
L   2001:200::72B/128 [0/0]
     via Ethernet0/0, receive
L   FF00::/8 [0/0]
     via Null0, receive
valbonne#<span class="docEmphStrong">show ipv6 neighbors</span>
IPv6 Address                 Age   Link-layer Addr  State  Interface
2001:200::72A                1     aabb.cc01.f400   STALE  Et0/0
FE80::A8BB:CCFF:FE01:F400    1     aabb.cc01.f400   STALE  Et0/0</pre><br>

</td></tr></table></p>
<p class="docText">On hosts, on the other hand, no such thing as a routing table or routing protocols should be necessary.</p>
<p class="docText">RFC 2461 describes a set of conceptual data structures to enable next-hop determination in hosts:</p>
<ul><li><p class="docText"><span class="docEmphStrong">Destination cache</span> Contains destinations to which traffic has been forwarded recently, with the next hop (neighbor) that was chosen providing linkage into the neighbor cache. This cache is updated with information obtained from redirect messages.</P></li><li><p class="docText"><span class="docEmphStrong">Prefix list</span> Contains the list of prefixes that match the on-link addresses. This list is built from RA messages.</P></LI><li><p class="docText"><span class="docEmphStrong">Default router list</span> Contains the list of on-link routers to which packets can be sent.</p></li></ul>
<p class="docText"><a class="docLink" href="#ch02fig25">Figure 2-25</a> shows a host model of the next-hop determination algorithm, based on RFC 2461.</P>
<a name="ch02fig25"></a><p><center>
<h5 class="docFigureTitle">Figure 2-25. Next-Hop Determination Algorithm</h5>
<p class="docText"><div class="v1"><a target="_self" href="images/02fig25_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="387" SRC="images/02fig25.jpg"></p>
</center></P><BR>
<p class="docText">The host first does a lookup into the destination cache, in case the destination of the packet has been seen recently. If so, the destination cache provides the next hop that was used (may be the destination itself), and a subsequent lookup into the neighbor cache is likely to provide the link-layer address. This path, shown in bold, will be the most exercised on an established flow. If the destination is not in the destination cache, it is searched in the prefix list (maintained from information received in RAs). As a last resort, a default router is selected, from among all on-link routers (known by sending RAs), via default router selection.</P>

<a name="ch02lev3sec21"></a>
<h5 class="docSection3Title">Default Router Selection</h5>
<p class="docText">Again, this is a host-specific algorithm. Routers just rely on routing protocols (and routing tables) to make proper next-hop determinations.</p>
<p class="docText">Unlike IPv4, a default gateway does not have to be defined on an IPv6 host. The procedure for a host to select a router as the next hop for its traffic is described in the &quot;Default Router Preference and More-Specific Routes&quot; Internet Draft. It identifies three distinct types of hosts:</p>
<ul><li><p class="docText"><span class="docEmphStrong">Type A</span> Hosts that ignore default router preference, as well as more specific routes listed in the RA option Route Information. (See the section &quot;<a class="docLink" href="#ch02lev2sec12">Router and Prefix Discovery</a>&quot; for details.) These hosts simply run the router selection algorithm as described in RFC 2461. Basically, a type A host selects a default router from its default router list (built from RAs received from routers sharing a link with the host). It should prefer a reachable router if any are available (known as <span class="docEmphasis">reachable,</span> according to the state machine; see the section &quot;<a class="docLink" href="#ch02lev3sec24">The State Machine for Reachability</a>&quot;) or any other router on the list, if available. If the selected router is not known as reachable, it should be selected in a round-robin fashion from among all the routers on the list (thus ensuring that all routers on the list are probed by the neighbor unreachability detection algorithm).</p></li><li><p class="docText"><span class="docEmphStrong">Type B</span> Same as type A hosts, where the default router list is augmented by the preference (Low, Medium, High) received in the RAs. The default router selection can be based on this preference rather than being round robin.</p></li><li><p class="docText"><span class="docEmphStrong">Type C</span> Hosts that implement a routing table. When they receive an RA with a number of occurrences of the Route Information option, they install a default route, ::/0, pointing to the router that issued the RA; they also install (or remove if the lifetime is 0) one route to the prefix found in the Route Information option, per occurrence. When a type C host does next-hop determination and consults its routing table for an off-link destination, it first prefers reachable routers over nonreachable routers; then it uses the longest-matching prefix; after that, it uses route-preference values.</p></li></UL>
<p class="docText">Note that hosts of different types, receiving the same RA packets (multicast on the link), might end up making different decisions when selecting a default router.</P>
<a name="ch02note23"></a><div class="docNote"><p class="docNoteTitle">Note</P>

<p class="docText">As mentioned previously, each router on the link may advertise a list of prefixes as well as offer itself as the default router. A dual-homed host could potentially receive disjoint prefix lists from two or more routers, and pick up one prefix from one list for autoconfiguration, forming an SA. It could then use this address (selected using SAS) to leave the subnet, via the router (selected as the default router) <span class="docEmphasis">that did not advertise</span> the prefix used to form this address.</P>
</div><BR>

<a name="ch02lev3sec22"></a>
<h5 class="docSection3Title">Duplicate Address Detection</h5>
<p class="docText">The NS and NA messages are also used to perform duplicate address detection (DAD), as described in RFC 2462. DAD is performed on all unicast addresses prior to assigning them to an interface. The basic principle is that a node sends an NS to query about an IPv6 address ownership, and assigns the address to one of its own interfaces only if no NA was received for it.</p>
<p class="docText">Optimistic DAD is proposing a modification of the existing IPv6 ND (RFC 2461) and stateless address autoconfiguration (RFC 2462) algorithms. The intention is to minimize address configuration delays in the successful case (the address chosen by the node is unique), and to reduce disruption as far as possible in the failure case. Optimistic DAD is only performed on automatically configured addresses. It is a useful optimization because DAD is far more likely to succeed than fail for a well-distributed random address or for an interface IDbased address constructed in the modified EUI-64 format from the unique MAC.</p>
<a name="ch02note24"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">DAD must not be performed on anycast addresses because by definition an anycast address can belong to multiple nodes.</p>
</div><br>

<a name="ch02lev3sec23"></a>
<h5 class="docSection3Title">Neighbor Unreachability Detection</h5>
<p class="docText">Communication with a neighbor may fail for a number of reasons. If the path (on the link) to the destination has failed, recovery may be possible. The recovery mechanism to invoke when a failure has been detected differs depending on whether the neighbor is also the final destination. If it is, the address resolution should be re-initiated. Otherwise, a different next hop should be selected. This falls under the next-hop determination algorithm (explained in &quot;<a class="docLink" href="#ch02lev3sec20">Next-Hop Determination</a>&quot; section), where two mechanisms can be used. Routers typically use their routing table, whereas hosts run the router selection algorithm (see the &quot;<a class="docLink" href="#ch02lev3sec21">Default Router Selection</a>&quot; section).</p>
<p class="docText">The neighbor unreachability detection (NUD), however, deals with detecting the failure. Reachability of a neighbor is obtained in two possible ways. The first method is a confirmation from an upper layer that communication is happening with this neighbor (for instance, received TCP packets acknowledging previously sent packets). The second method is the receipt of an NA as a response to an NS sent by the node looking for reachability confirmation. Any other methods, such as RAs, cannot be used to confirm reachability of a neighbor. A neighbor then remains reachable for a limited amount of time, unless new confirmations come in. If the confirmation is not received in a timely manner, the neighbor is considered unreachable, and recovery mechanisms take place. The complete state diagram for neighbor entries in the ND cache is detailed in the next section.</p>

<a name="ch02lev3sec24"></a>
<h5 class="docSection3Title">The State Machine for Reachability</H5>
<p class="docText">The neighbor cache maintains a list of neighbors to which traffic has been sent recently. <a class="docLink" href="#ch02fig26">Figure 2-26</a> shows a state diagram of the neighbor cache.</p>
<a name="ch02fig26"></a><p><center>
<H5 class="docFigureTitle">Figure 2-26. ND Cache Entry State Diagram</H5>

<p class="docText">
<img border="0" alt="" width="500" height="488" SRC="images/02fig26.jpg"></p>

</center></p><br>
<p class="docText">In <a class="docLink" href="#ch02fig26">Figure 2-26</a>, the following events will generate transition from one of the five states (INCOMPLETE, REACHABLE, DELAY, STALE, and PROBE):</p>
<UL><li><p class="docText"><span class="docEmphStrong">NA1</span> Receiving an NA with Solicited=0</p></li><li><p class="docText"><span class="docEmphStrong">NA2</span> Receiving an NA with Solicited=1</P></LI><LI><p class="docText"><span class="docEmphStrong">NA3</span> Receiving an NA with Solicited=1 and</p><dl><dd><p class="docList">- Override=1 or</p></dd><dd><p class="docList">- Override=0 and link-layer same as cached</p></dd></dl></li><li><p class="docText"><span class="docEmphStrong">NA4</span> Receiving an NA with Solicited=1, Override=0, and link-layer different from cached</p></li><li><p class="docText"><span class="docEmphStrong">NA5</span> Receiving an NA with Solicited=0, Override=1, and link-layer different from cached</p></li><li><p class="docText"><span class="docEmphStrong">O</span> Receiving other ND packets, such as NS, RS, RA, redirect, with link-layer different from cached</p></li><li><p class="docText"><span class="docEmphStrong">S</span> Sending packet</P></LI><LI><p class="docText"><span class="docEmphStrong">T</span> Timeout (Note that each state has a timer, started when entering the state.)</P></LI><li><p class="docText"><span class="docEmphStrong">Te</span> Timeout with retries exhausted</p></li><li><p class="docText"><span class="docEmphStrong">U</span> Upper-layer reachability confirmation</p></li></ul>
<p class="docText">The typical life of an entry is shown (in bold) in the state diagram of <a class="docLink" href="#ch02fig26">Figure 2-26</a>. An entry is a mapping between an IPv6 address and a link-layer address. The entry is created INCOMPLETE (link-layer unknown), and an NS is sent to obtain the link-layer address. As soon as the response (NA) is received, the entry moves to REACHABLE state, and traffic can be forwarded. If the router sees no traffic for that neighbor for a certain period of time (typically 30 seconds), the entry moves to the STALE state. From there, it can either move back directly to REACHABLE (typically upon upper-layer reachability confirmation) or to DELAY (if a packet is to be sent to this neighbor), where a new NS is issued, or it can be deleted (in our example) after a certain amount of time in STALE (typically hours).</p>

<a name="ch02lev3sec25"></a>
<h5 class="docSection3Title">Autoconfiguration</h5>
<p class="docText">The address autoconfiguration is used to automatically assign addresses to a host. Address autoconfiguration is specified in RFC 2462. It uses the NDP (specifically RAs) to obtain the prefix to build an address on, and again ND (specifically NS and NA messages) to test that the built address is not already in use. The default mechanism for autoconfiguration is stateless. Another mechanism, stateful, can be used and is specified in RFC 3315. Both mechanisms are described in <a class="docLink" href="ch03.html#ch03">Chapter 3</a>, &quot;Delivering IPv6 Unicast Services,&quot; in the section &quot;<a class="docLink" href="ch03lev1sec2.html#ch03lev2sec1">Host IPv6 Address Provisioning</a>.&quot;</p>


<a name="ch02lev2sec18"></a>
<h4 class="docSection2Title">Neighbor Discovery at a Glance</H4>
<p class="docText"><a class="docLink" href="#ch02table14">Table 2-14</a> summarizes ND information for quick reference.</p>
<a name="ch02table14"></a><p><table cellspacing="0" class="allBorders" border="1" RULES="all" cellpadding="4"><caption><H5 class="docTableTitle">Table 2-14. NDP at a Glance</H5></caption><colgroup><col width="85"><col width="140"><col width="50"><col width="50"><col width="85"><col width="140"></colgroup><thead><tr><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Message Name</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Goal</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">ICMP Code</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Sender</P></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Target</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Options</p></th></tr></thead><tr><TD class="docTableCell" align="left" valign="top"><p class="docText">Router solicitation (RS)</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Prompt routers to send RA quickly</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">133</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Nodes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">All routers</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">SLLA<sup class="docFootnote"><a class="docLink" href="#ch02tn01">[1]</a></sup></p></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText">Router Advertisement (RA)</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Advertise:</p>
<p class="docText">Default router</p>
<p class="docText">On-link prefixes</p>
<p class="docText">Reachable prefixes</p>
<p class="docText">Oeration parameters</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">134</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Routers</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Sender of the RS</P>
<p class="docText">or</P>
<p class="docText">All nodes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">SLLA</p>
<p class="docText">MTU</P>
<p class="docText">Prefix information</p>
<p class="docText">Route information</p>
<p class="docText">Advertisement interval</p>
<p class="docText">Home agent information</p></TD></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Neighbor solicitation (NS)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Request the link-layer address of a target node</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">135</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Nodes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Solicited node</p>
<p class="docText">or</P>
<p class="docText">Target node</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">SLLA</P></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Neighbor advertisement (NA)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Respond to NA</p>
<p class="docText">Advertise link-layer address changes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">136</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Nodes</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Sender of the NS</p>
<p class="docText">or</p>
<p class="docText">All nodes</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">TLLA<sup class="docFootnote"><a class="docLink" href="#ch02tn02">[2]</a></sup></p></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText">Redirect</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Inform hosts of a better first hop</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">137</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Routers</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Host that triggered the redirect</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">TLLA</p>
<p class="docText">Redirected header</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText">Inverse neighbor solicitation (INS)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Request an IPv6 address corresponding to a link-layer address</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">141</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Nodes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">All nodes</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">SLLA<sup class="docFootnote"><a class="docLink" href="#ch02tn03">[3]</a></sup></P>
<p class="docText">TLLA<sup class="docFootnote"><a class="docLink" href="#ch02tn03">[3]</a></sup></P>
<p class="docText">MTU</p>
<p class="docText">Source address list</p></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Inverse neighbor advertisement (INA)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Respond to an INA</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">142</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Nodes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Sender of the INS</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">SLLA<sup class="docFootnote"><a class="docLink" href="#ch02tn03">[3]</a></sup></p>
<p class="docText">TLLA<sup class="docFootnote"><a class="docLink" href="#ch02tn03">[3]</a></sup></p>
<p class="docText">Target address list<sup class="docFootnote"><a class="docLink" href="#ch02tn03">[3]</a></sup></p>
<p class="docText">MTU</p></td></TR></table></P><BR><blockquote><p class="docFootnote"><sup><a name="ch02tn01">[1]</a></sup> SLLA: Source link-layer address</P></blockquote><blockquote><p class="docFootnote"><sup><a name="ch02tn02">[2]</a></sup> TLLA: Target link-layer address</P></blockquote><blockquote><p class="docFootnote"><sup><a name="ch02tn03">[3]</a></sup> Option required</p></blockquote>
<p class="docText">IPv6 is not limited, in the least, to the protocols reviewed in this chapter. However, this chapter covered the fundamental elements, to provide you with the tools to understand the most relevant differences between IPv6 and IPv4. With these tools in mind, the next chapters review IPv6 network services, all built &quot;on top of&quot; IPv6 addressing, ICMPv6, and the Neighbor Discovery Protocol.</p>


</TD></TR></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch02lev1sec3.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch03.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
</body></html>