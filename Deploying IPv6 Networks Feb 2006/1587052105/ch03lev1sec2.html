<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>IPv6 Provisioning</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch03lev1sec1.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch03lev1sec3.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><TR><TD valign="top"><a name="ch03lev1sec2"></a>
<H3 class="docSection1Title">IPv6 Provisioning</h3>
<p class="docText">To gain IPv6 access and to benefit from IPv6 services, a node needs to be provided with the following information:</p>
<ul><li><p class="docList">Acquire the IPv6 address information for the node.</p></li><li><p class="docList">To be able to perform name-to-address mapping, the node needs to know the addresses of Domain Name System (DNS) recursive name servers.</p></li><li><p class="docList">Finally, the node might have to keep accurate time for security purposes, which requires the addresses of Network Time Protocol (NTP) servers.</p></li></UL>
<p class="docText">These three provisioning aspects are independent of whether the &quot;IPv6 node&quot; is a host or a customer router. The information, other than the IPv6 address, mentioned in the bulleted list and necessary for the proper operation of the node is commonly referred to as <span class="docEmphasis">other configuration</span> information.</p>
<a name="ch03lev2sec1"></a>
<h4 class="docSection2Title">Host IPv6 Address Provisioning</H4>
<p class="docText">Providing IP addresses to hosts is an important aspect of deploying IP-based services. Manual configuration is always an option; however, it is not scalable and it is not easily adaptable to addressing changes. For this reason, IPv4 most often relies on Dynamic Host Configuration Protocol (DHCP) for address provisioning. The same mechanism is available for IPv6; it is called <span class="docEmphasis">stateful DHCP</span>, and it is discussed later in this section.</P>
<p class="docText">As more and more devices and appliances become IP enabled, it is likely that many of them will not have the resources to support complicated provisioning mechanisms. At the same time, the nature of some of these devices and appliances would require them to have plug-and-play capabilities. As a promoter of wider adoption of IP, IPv6 took this provisioning scenario into consideration and developed a simple autoconfiguration mechanism commonly referred to as <span class="docEmphasis">stateless autoconfiguration</span>.</p>
<a name="ch03lev3sec1"></a>
<h5 class="docSection3Title">Stateless Autoconfiguration</h5>
<p class="docText"><a name="iddle1945"></a><a name="iddle1946"></a>Stateless autoconfiguration operation is described in RFC 2462, and it relies on the Neighbor Discovery Protocol (NDP) reviewed in <a class="docLink" href="ch02.html#ch02">Chapter 2</a>, &quot;An Ipv6 Refresher&quot; It is a simple IPv6 address provisioning mechanism that can be used with any type of hosts.</p>
<a name="ch03lev4sec1"></a>
<H5 class="docSection4Title">Stateless Autoconfiguration Operation</h5>
<p class="docText">In the context of this provisioning mechanism, IPv6-capable hosts rely on Router Advertisement (RA) messages to obtain the information needed for autoconfiguration. To acquire an IPv6 address, a host will follow three steps:</p>
<a name="ch03pro01"></a><ul class="doclist" start=""><li><span class="docEmphStrong">Discover a prefix used on the link</span>. This step is explained in detail in the &quot;<a class="docLink" href="ch02lev1sec4.html#ch02lev2sec12">Router and Prefix Discovery</a>&quot; section of <a class="docLink" href="ch02.html#ch02">Chapter 2</a>. The host can listen to periodic RAs sent by routers on the link or it can poll for routers with the help of Router Solicitation messages. The prefixes information is extracted from the RA messages.<br><BR>
</LI><LI><span class="docEmphStrong">Generate an interface ID</span>. To have a full IPv6 address, the host must add an interface identifier to a prefix learned from the routers on the link. The various options available for creating an interface ID are reviewed in the addressing section of <a class="docLink" href="ch02.html#ch02">chapter 2</a>. Examples of those options are build a EUI-64 ID based on the MAC address, or randomly generate the address.<br><br>
</li><li><span class="docEmphStrong">Verify the uniqueness of the generated IPv6 address</span>. The IPv6 address that resulted from the previous two steps must be unique on the link. The Duplicate Address Detection (DAD) mechanism described in the section with the same name in <a class="docLink" href="ch02.html#ch02">Chapter 2</a> is used by the host before starting to use its new IPv6 address.<br><br>
</li></ul>
<p class="docText">By default, Cisco routers are sending RAs that can be used by hosts for stateless autoconfiguration. This functionality can be turned off for each router interface with the IOS command <span class="docEmphStrong">ipv6 nd suppress-ra</span>. Other parameters relevant to this provisioning mechanism can be modified with the option available for the <span class="docEmphStrong">ipv6 nd</span> command.</p>

<a name="ch03lev4sec2"></a>
<h5 class="docSection4Title">IPv6 Address Renumbering</h5>
<p class="docText">Address renumbering is a fact of life in any network. For various reasonssuch as network changes, user-distribution changes, and network mergersthe IP addressing scheme must be changed. This process can consume significant resources of the network operations team. For this reason, any mechanism that simplifies renumbering would prove valuable. In the case of IPv6, stateless autoconfiguration provides the means to advertise the deprecation of a prefix at a certain day and time and to advertise a new prefix from that moment onward. This is done through the interface configuration command <span class="docEmphStrong">ipv6 nd prefix</span> &lt;<span class="docEmphasis">ipv6-prefix/prefix-length</span>&gt; at &lt;<span class="docEmphasis">valid-date-time</span>&gt; &lt;<span class="docEmphasis">preferred-date-time</span>&gt;.</p>
<a name="ch03note01"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText"><a name="iddle1180"></a><a name="iddle1184"></a><a name="iddle1266"></a><a name="iddle1748"></a>A router must have the means to track dates and time if it is using this renumbering mechanisms. Date and time can be set on the router or learned via NTP. At the time of this writing, NTP over IPv6 is not supported by Cisco products. On the other hand, if the routers are dual stack, they can leverage the IPv4 infrastructure to communicate with a clock source.</p>
</div><BR>
<p class="docText">The router advertises shorter and shorter lifetimes for the prefix as the date configured for its removal is approaching. Hosts on that link deprecate the prefix because of its lifetime expiration and learn a new prefix from the new router RAs.</P>
<p class="docText">In the context of today's IPv6 address-allocation rules, an enterprise might have to perform renumbering every time it changes ISPs. Updating the IPv6 addresses is just one aspect of the complex process of renumbering. Network administrators also have to modify, for example, QoS policies, access control lists (ACLs), DNS entries, and so on. This explains the interest shown by the Internet Engineering Task Force (IETF) in evaluating the renumbering options of IPv6. An example of such work is &quot;Procedures for Renumbering an IPv6 Network without a Flag Day,&quot; a draft in the IETF RFC editor's queue at the time of this writing.</P>


<a name="ch03lev3sec2"></a>
<H5 class="docSection3Title">Stateful DHCP</H5>
<p class="docText">Stateful DHCP is a client/server-based mechanism that provides managed provisioning of hosts. Its operation for IPv6 is described in RFC 3315. The value provided by DHCP consists in the fact that provisioning is done through a centralized resource. This resource is easier to manage than having to make changes on all customer-facing router interfaces in the case of stateless autoconfiguration. DHCP can offer a host not only the IPv6 prefix, but also other relevant information as well over the same message exchange. The disadvantage of using this provisioning mechanism is that it requires a more complex host implementation.</p>
<a name="ch03note02"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">At the time of this writing, stateful DHCP is not commonly available on IPv6 stacks. For this reason deployments favor the stateless autoconfiguration (for IPv6 prefix information) in combination with stateless DHCP (for other configuration information) rather than stateful DHCP.</p>
<p class="docText">Cisco routers do not act as DHCP servers for IPv6 stateful autoconfiguration; however, the Cisco Network Registrar (CNR) can currently perform that function.</p>
</div><br>
<p class="docText"><a name="iddle1088"></a><a name="iddle1225"></a><a name="iddle1260"></a><a name="iddle1296"></a><a name="iddle1781"></a><a name="iddle1932"></a>Although conceptually similar, there are several differences between IPv4 DHCP and IPv6 DHCP:</p>
<ul><li><p class="docList">Some message types, such as DHCP-DISCOVER and DHCP-OFFER, are not used in IPv6 anymore. Instead, a host discovers the DHCP server with the help of a DHCP SOLICIT, message and the server replies with a DHCP-ADVERTISE message.</p></li><li><p class="docList">In IPv6 DHCP, addresses are provided through message options.</p></LI><li><p class="docList">An IPv6 host can request multiple addresses from the IPv6 DHCP server at the same time.</p></LI></UL>
<p class="docText"><a class="docLink" href="#ch03fig01">Figure 3-1</a> shows the message exchange between a client and the DHCP server for both provisioning and renewal. The SOLICIT message sent by the client has the role of discovering a DHCP server. It is sent to the reserved, link-local scope multicast address FF02::1:2. In this example, the client requests a nontemporary address (IA-NA). The client selects a server from all the ones that replied with an ADVERTISE message, and it requests the information of interest (nontemporary address, DNS server address, and domain list). The server provides the information in a REPLY message.</p>
<a name="ch03fig01"></a><p><center>
<h5 class="docFigureTitle">Figure 3-1. DHCPv6 Client-Server Message Exchange</h5>
<p class="docText"><div class="v1"><a target="_self" href="images/03fig01_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="433" SRC="images/03fig01.jpg"></P>
</center></p><br>
<a name="ch03note03"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">For each IPv6 address received from the DHCPv6 server, the client performs Duplicate Address Detection.</p>
</div><BR>
<p class="docText"><a name="iddle1728"></a><a name="iddle1745"></a>As far as the client is considered, the DHCPv6 server is located on the same link (this is the reason why it sends the SOLICIT message to a link-local scope multicast destination address). However, this is most often not the case. DHCP-based provisioning is done for all links from a centralized location, which means that the DHCP server is not on the same link as most hosts.</P>
<p class="docText">When the DHCPv6 server is not on the same link with the client, the routers on the link must be configured to relay the client SOLICIT messages to the DHCP server. The interface configuration command for enabling this functionality is <span class="docEmphStrong">ipv6 dhcp relay destination</span> &lt;<span class="docEmphasis">ipv6-address</span>&gt; &lt;<span class="docEmphasis">interface-type interface number</span>&gt;. If the unicast address of the DHCP server is known, the router is configured to forward the client messages directly to the server. Multiple DHCPv6 server addresses can be configured at the same time, in which case the router unicasts the client messages to each server. The router can also be configured to forward the client DHCPv6 messages to another DHCP relay router. If the address of the DHCP server is not known, the relay router can be configured, with the help of the interface command mentioned previously, to forward the client messages to the All-DHCP-Servers reserved multicast address FF05::1:3.</P>
<p class="docText">By default, the Cisco router interface advertises the information necessary for stateless autoconfiguration. To make sure that attached hosts use only stateful DHCP for provisioning, you must configure the router interface with <span class="docEmphStrong">ipv6 nd managed-config-flag</span>. In this case, the RAs inform hosts that they must use DHCPv6 to acquire provisioning information, including the IPv6 address.</p>
<a name="ch03note04"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">Stopping the router from transmitting RAs is not a practical option for forcing hosts to use stateful DHCP. On one hand, the host protocol stacks might not switch to stateful DHCP if they do not receive a reply to their router solicitations. On the other, this approach impacts the operation of other link-local functions such as router discovery.</p>
</div><br>


<a name="ch03lev2sec2"></a>
<h4 class="docSection2Title">Router IPv6 Address Provisioning: Prefix Delegation</h4>
<p class="docText">Prefix delegation (PD) is a mechanism developed to provide automated delegation of IP address blocks. The delegation is done from an ISP to its customer. The ISP does not require any knowledge of the customer's internal network topology.</p>
<p class="docText">In the IPv4 world, it is typical that the ISP only assigns a single address to the customer. Customers with more than one device are forced to use NAT. Static or long-lived address blocks are typically delegated manually. That is, when the service is ordered, the ISP informs the customer via e-mail or snail mail what the address block is. The customer then has to manually configure the network with the given network prefix.</p>
<p class="docText">Not only is this approach error prone, it is also expensive. Because there is little reason to try to conserve address space for IPv6, it is expected that all users will be allocated a <a name="iddle1262"></a><a name="iddle1265"></a><a name="iddle1746"></a><a name="iddle1782"></a><a name="iddle1851"></a>long-lived address block. Therefore, a scalable way of delegating address blocks is needed. The requirements for prefix delegation can be found in RFC 3769.</p>
<p class="docText">Various PD proposals were made in the IETF. An initial proposal was made for a protocol based on Internet Control Message Protocol (ICMP). It soon became clear that the requirements and mechanisms suggested for prefix delegation would best be implemented based on DHCP. Address assignment does not, after all, differ greatly from PD. The existing DHCP messages and the DHCP address options were used as a template to create DHCP-based prefix delegation, described in RFC 3633.</p>
<a name="ch03lev3sec3"></a>
<h5 class="docSection3Title">Protocol Description</h5>
<p class="docText">The PD protocol runs between a Customer Edge (CE) and a Provider Edge (PE) router. In PD terminology, the CE is called a Requesting Router (RR) and the PE router a Delegating Router (DR). The RR acts as the DHCP client, and requests prefixes from the DR (DHCP server). The DR verifies the authenticity and the profile of the RR with a AAA server, and that server provides the prefix. The DR injects a route into the provider's routing system for the delegated prefix on behalf of the RR. That way, a dynamic routing protocol between the RR and the DR is not needed; however, the RR and the DR must be directly connected. This restriction is comparable to DHCP, as described in RFC 3315, which allows DHCP relays in the path between the DHCP client and the DHCP server. <a class="docLink" href="#ch03fig02">Figure 3-2</a> shows this PD process.</p>
<a name="ch03fig02"></a><p><center>
<H5 class="docFigureTitle">Figure 3-2. DHCP-PD Architecture</H5>
<p class="docText"><div class="v1"><a target="_self" href="images/03fig02_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="346" SRC="images/03fig02.jpg"></P>
</center></P><BR>
<p class="docText"><a name="iddle1263"></a><a name="iddle1295"></a><a name="iddle1410"></a><a name="iddle1767"></a>For a nondirectly connected CE-PE configuration, a DHCP relay option has been proposed. It provides enough information to the PE so that it can inject the route for the delegated prefix. Another alternative is to use a routing protocol between the CE and the PE. That is not as straightforward as it might first seem. One would need a mechanism to negotiate which of the many dynamic routing protocols to use (manual configuration isn't acceptable because it would defeat the purpose of a fully automated solution). Making the CE responsible for injecting routing information into the provider routing system might not be a good idea. It not only requires the customer to be able to configure their routers correctly, it also requires the provider to trust the customer not to be tempted to inject routes for prefixes not belonging to it. The latter case can be solved by applying route filters on the PE. Because that also requires explicit knowledge of the delegated prefix on the PE, it might as well also inject the route on behalf of the CE. The PE can also apply source-address validation on incoming traffic.</p>
<p class="docText">A requesting router is identified by its DHCP Unique Identifier (DUID). This is an identifier created by the RR itself, or it can be manually configured based on information from the ISP. The DUID must be stored in stable storage so that is does not change (for example, after a reboot).</p>
<p class="docText">DHCP-PD protocol message exchanges work just as DHCP address assignment. The RR (DHCP client) sends a SOLICIT message including PD options, and the DR (or DRs) on the link replies with an ADVERTISE message. The RR then sends a REQUEST, again with the PD option included, and the DR delegates the prefix and includes it in a REPLY message. Similar to DHCP, an Identity Association Prefix Delegation (IA-PD) is used by the client to indicate the scope of its request. The association is labeled with an identifier (IAID) that is used throughout the message exchange. <a class="docLink" href="#ch03fig03">Figure 3-3</a> shows the PD process.</p>
<a name="ch03fig03"></a><p><center>
<h5 class="docFigureTitle">Figure 3-3. DHCP-PD Message Exchange</h5>
<p class="docText"><div class="v1"><a target="_self" href="images/03fig03_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="373" SRC="images/03fig03.jpg"></p>
</center></p><br>
<p class="docText">The SOLICIT and ADVERTISE messages represent the process of the RR discovering DHCP-PD servers (DR). In cases where an RR can have access to at most one DR (as is the case of point-to-point uplinks), the discovery process can be eliminated and the four steps of negotiation can be shortened to two messages. This shortened process is called DHCP-PD Rapid Commit and it can be used only if the DR supports the DHCP Rapid Commit feature. In the case of Rapid Commit, the router provides the prefix in response to the SOLICIT.</p>
<p class="docText">Each delegated prefix has an associated valid and preferred lifetime, which constitutes an agreement about the length of time over which the RR is allowed to use the prefix. An RR can request an extension of the lifetimes on a delegated prefix and is required to terminate the use of a delegated prefix if the valid lifetime of the prefix expires.</p>
<p class="docText">When a prefix is about to expire, the RR sends a RENEW message. The delegating router replies with a REPLY message containing the prefix option with new lifetimes. During a network renumbering, the DR includes both the old and the new prefixes in the message. The old one has shorter lifetimes, and after some time, typically a few weeks, the old prefix expires, and only the new prefix is used.</p>
<p class="docText"><a name="iddle1267"></a><a name="iddle1381"></a><a name="iddle1729"></a><a name="iddle1747"></a>Other DHCP options might, of course, also be included in these messages. For example, DNS configuration options or Simple Network Time Protocol (SNTP) configuration options can be sent to the CE device. The CE device can run a stateless DHCP server on its downstream interfaces and relay these options to hosts on downstream links.</P>

<a name="ch03lev3sec4"></a>
<h5 class="docSection3Title">Requesting Router</h5>
<p class="docText">The RR has to be configured to run DHCP-PD on its upstream interface (the interface facing the provider). The RR assigns a slice of the acquired prefix to each of its IPv6-enabled downstream links. The mechanism used for assigning the prefixes is called <span class="docEmphasis">general prefixes</span>.</P>
<p class="docText"><a class="docLink" href="#ch03ex01">Example 3-1</a> shows an RR configuration. The CE has one upstream interface, Serial2/0, and two downstream interfaces, Ethernet0/0 and Ethernet1/0.</P>
<a name="ch03ex01"></a><h5 class="docExampleTitle">Example 3-1. Configuration of a DHCP-PD RR</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><TD>


<pre>hostname CE
ipv6 unicast-routing
!
interface Serial2/0
 ! Upstream interfaceISP
 ipv6 address autoconfig default
 <span class="docEmphMark">ipv6 dhcp client pd genpfx-foo</span>
!
interface Ethernet0/0
 ! Downstream 1
 <span class="docEmphMark">ipv6 address genpfx-foo 0:0:0:1::1/64</span>
!
interface Ethernet1/0
 ! Downstream 2
 <span class="docEmphMark">ipv6 address genpfx-foo 0:0:0:2::1/64</span>
!</pre><br>

</td></tr></table></p>
<p class="docText">No manual configuration of the delegated prefix is required. The upstream interface is configured as a DHCP-PD client. The prefix (or prefixes) received via the PD protocol is given a name, genpfx-foo. The <span class="docEmphStrong">ipv6 address</span> commands on the downstream interfaces refer to this named prefix when configuring their own addresses. The general prefix gives the first part of the prefix, and the address command provides the last part of the address. Let's assume a /48 prefix. The address specified in the address command is 0:0:0:1::1. The first 48 bits are being replaced by the prefix or prefixes received by DHCP. The next 16 bits are 0001, and the last 64 bits, the interface identifier, are set to ::1.</P>
<p class="docText">It might be easier to see how this works with the following example.</P>
<a name="ch03ex02"></a><H5 class="docExampleTitle">Example 3-2. General Prefix Acquired by a Router via DHCP-PD</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>CE#<span class="docEmphStrong">show ipv6 general-prefix</span>
IPv6 Prefix genpfx-foo, acquired via DHCP PD
 2001:DB8:FF01::/48 Valid lifetime 2591201, preferred lifetime 604001</pre><br>

</td></tr></table></p>
<p class="docText">As you can see, the prefix acquired with DHCP-PD is 2001:DB8:FF01::/48. The lifetime values of the prefix (<span class="docEmphStrong">valid</span>, the amount of time the prefix is valid; <span class="docEmphStrong">preferred</span>, the amount of time the valid prefix is preferred) are provided by the DR in the reply, as shown in <a class="docLink" href="#ch03fig03">Figure 3-3</a>. Two /64 prefixes from the delegated /48 are assigned by the CE to its interfaces Ethernet0/0 and Ethernet1/0, as shown in <a class="docLink" href="#ch03ex03">Example 3-3</a>.</p>
<a name="ch03ex03"></a><h5 class="docExampleTitle">Example 3-3. Using the General Prefix to Provision Router Interfaces</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>CE#<span class="docEmphStrong">show ipv6 interface Ethernet0/0</span>
Ethernet0/0 is up, line protocol is up
 IPv6 is enabled, link-local address is FE80::A8BB:CCFF:FE02:8A00
 Global unicast address(es):
 <span class="docEmphMark">2001:DB8:FF01:1::1, subnet is 2001:DB8:FF01:1::/64 [PRE]</span>
  valid lifetime 2591041 preferred lifetime 603841
CE#<span class="docEmphStrong">show ipv6 interface Ethernet1/0</span>
Ethernet1/0 is up, line protocol is up
 IPv6 is enabled, link-local address is FE80::A8BB:CCFF:FE02:8A01
 Global unicast address(es):
 <span class="docEmphMark">2001:DB8:FF01:2::1, subnet is 2001:DB8:FF01:2::/64 [PRE]</span>
  valid lifetime 2591005 preferred lifetime 603805</pre><BR>

</TD></TR></table></P>
<p class="docText"><a name="iddle1112"></a><a name="iddle1152"></a>Note that if two prefixes were delegated, that would result in two addresses on every Ethernet interface, each generated from the general prefix command based on the prefixes, and the information given in the address command. Both prefixes will be advertised in RAs sent out on the interface.</P>
<p class="docText">The <span class="docEmphStrong">ipv6 address autoconfig default</span> command on the upstream Serial2/0 interface uses stateless address autoconfiguration to configure a global address on the interface. The <span class="docEmphStrong">default</span> keyword in this command leads to a default route being installed. The default route points out the configured interface and the next hop is the delegating router. <a class="docLink" href="#ch03ex04">Example 3-4</a> shows the result of this autoconfiguration process and the details of the routing table.</p>
<a name="ch03ex04"></a><h5 class="docExampleTitle">Example 3-4. Stateless Autoconfiguration Process on Upstream Interface of CE Router</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>CE#<span class="docEmphStrong">show ipv6 interface Serial2/0</span>
Serial2/0 is up, line protocol is up
 IPv6 is enabled, link-local address is FE80::A8BB:CCFF:FE02:8A00
 Global unicast address(es):
 2001:DB8::A8BB:CCFF:FE02:8A00, subnet is 2001:DB8::/64 [PRE]
  valid lifetime 2591995 preferred lifetime 604795
CE#<span class="docEmphStrong">show ipv6 route</span>
IPv6 Routing Table - 10 entries
Codes: C - Connected, L - Local, S - Static, R - RIP, B - BGP
  U - Per-user Static route
  I1 - ISIS L1, I2 - ISIS L2, IA - ISIS interarea, IS - ISIS summary
  O - OSPF intra, OI - OSPF inter, OE1 - OSPF ext 1, OE2 - OSPF ext 2
  ON1 - OSPF NSSA ext 1, ON2 - OSPF NSSA ext 2
<span class="docEmphMark">S ::/0 [1/0]</span>
  <span class="docEmphMark">via FE80::A8BB:CCFF:FE02:8B00, Serial2/0</span>
C 2001:DB8::/64 [0/0]
  via ::, Serial2/0
L 2001:DB8::A8BB:CCFF:FE02:8A00/128 [0/0]
  via ::, Serial2/0
S 2001:DB8:FF01::/48 [1/0]
  via ::, Null0
C 2001:DB8:FF01:1::/64 [0/0]
  via ::, Ethernet0/0
L 2001:DB8:FF01:1::1/128 [0/0]
  via ::, Ethernet0/0
C 2001:DB8:FF01:2::/64 [0/0]
  via ::, Ethernet1/0
L 2001:DB8:FF01:2::1/128 [0/0]
  via ::, Ethernet1/0</pre><br>

</td></tr></table></p>
<p class="docText">The output shows that a default route has been installed pointing to the DR. A /48 route toward the Null0 interface has been installed for the delegated prefix. This so-called <span class="docEmphasis">black hole route</span> makes sure that the RR has routing information for the entire delegated address block. Otherwise, it would forward traffic along the default route for parts of the /48 that are not configured on the CE yet. The DR has a routing entry for the /48 toward the CE, so without the black hole route, you would have a routing loop. The output of the <span class="docEmphStrong">show ipv6 dhcp interface</span> command provides the information relevant to the DHCP client, as shown in <a class="docLink" href="#ch03ex05">Example 3-5</a>.</p>
<a name="ch03ex05"></a><h5 class="docExampleTitle">Example 3-5. DHCP-PD Client-Relevant Information on the Upstream Interface</H5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><TD>


<pre>CE#<span class="docEmphStrong">show ipv6 dhcp interface Serial2/0</span>
Serial2/0 is in client mode
 State is OPEN
 Renew will be sent in 3d11h
 List of known servers:
 Reachable via address: FE80::A8BB:CCFF:FE02:8B00
 <span class="docEmphMark">DUID: 00030001AABBCC028B00</span>
 Preference: 0
 Configuration parameters:
  <span class="docEmphMark">IA PD: IA ID 0x00040001, T1 302400, T2 483840</span>
  <span class="docEmphMark">Prefix: 2001:DB8:FF01::/48</span>
    <span class="docEmphMark">preferred lifetime 604800, valid lifetime 2592000</span>
    <span class="docEmphMark">expires at Nov 26 2004 12:03 AM (2590299 seconds)</span>
  <span class="docEmphMark">DNS server: 2001:DB8:100::1</span>
 <span class="docEmphMark">Prefix name: genpfx-foo</span>
 <span class="docEmphMark">Rapid-Commit: disabled</span></pre><BR>

</td></tr></table></p>
<p class="docText"><a name="iddle1229"></a><a name="iddle1264"></a><a name="iddle1730"></a><a name="iddle1744"></a>The preceding output lists all the options received and the state of the DHCP protocol machine. If this output does not give enough information for troubleshooting, you can use the output of <span class="docEmphStrong">debug ipv6 dhcp</span> to capture the dynamics of the delegating process.</p>

<a name="ch03lev3sec5"></a>
<H5 class="docSection3Title">Delegating Router</h5>
<p class="docText">How does the DR get the larger address block from which it can delegate prefixes? There are several options:</p>
<ul><li><p class="docText"><span class="docEmphStrong">Manual configuration with static binding</span> The DUID and associated prefix are configured on the delegated router for each customer.</P></LI><LI><p class="docText"><span class="docEmphStrong">Using a prefix pool</span> A pool of prefixes is configured on the DR. A new prefix is allocated from the pool dynamically. To store the state of the pool on a remote server, use the ipv6 dhcp database &lt;URI&gt; command.</p></li><li><p class="docText"><span class="docEmphStrong">Interaction with AAA</span> The DUID or the PPP username (for link types such as PPP, which already does authentication) can be used to do a lookup from a RADIUS server. This way no customer-specific configuration is needed on the delegating router.</p></li><li><p class="docText"><span class="docEmphStrong">DHCP</span> As an alternative to the above, the delegating router functionality could be running on a central DHCP server. The PE router acts as a DHCP relay. Note that the PE router still needs to inject a route for the prefix into the provider routing system. A PD-specific relay option is under development to solve this problem.</p></li></ul>
<p class="docText"><a class="docLink" href="#ch03ex06">Example 3-6</a> shows the configuration of a DR using a prefix pool.</p>
<a name="ch03ex06"></a><h5 class="docExampleTitle">Example 3-6. Configuration of DHCP-PD Delegating Router Using Pool of Addresses</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><TD>


<pre>ipv6 unicast-routing
!
<span class="docEmphMark">ipv6 dhcp pool pd-pool</span>
 <span class="docEmphMark">prefix-delegation pool pfx-pool</span>
 <span class="docEmphMark">dns-server 2001:DB8:100::1</span>
!
<span class="docEmphMark">ipv6 local pool pfx-pool 2001:DB8:FF00::/40 48</span>
!
interface Serial2/0
 description Yet another customer
 ipv6 address 2001:DB8::1/64
 no ipv6 nd suppress-ra
 <span class="docEmphMark">ipv6 dhcp server pd-pool</span></pre><BR>

</TD></TR></table></P>
<p class="docText"><a name="iddle1147"></a><a name="iddle1261"></a><a name="iddle1832"></a>The configured DHCP pool is called pd-pool. Prefixes should be delegated from a local prefix pool named pfx-pool, and you should include the DNS attribute with the DNS server at 2001:DB8:100::1.</p>
<p class="docText">A /40 prefix is reserved for the pfx-pool pool, and /48-sized chunks are delegated, as shown in the <a class="docLink" href="#ch03ex07">Example 3-7</a>.</p>
<a name="ch03ex07"></a><h5 class="docExampleTitle">Example 3-7. Prefix Assignment Form for the pfx-pool of a DHCP-PD DR</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>PE#<span class="docEmphStrong">show ipv6 local pool pfx-pool</span>
Prefix is 2001:DB8:FF00::/40 assign /48 prefix
1 entries in use, 255 available, 0 rejected
0 entries cached, 1000 maximum
User    Prefix      Interface
00030001AABBCC028A0 2001:DB8:FF01::/48   Se2/0
PE#<span class="docEmphStrong">show ipv6 route</span>
C 2001:DB8::/64 [0/0]
  via ::, Serial2/0
L 2001:DB8::1/128 [0/0]
  via ::, Serial2/0
S 2001:DB8:FF01::/48 [1/0]
  via FE80::A8BB:CCFF:FE02:8A00, Serial2/0</pre><br>

</td></tr></table></p>
<p class="docText">In the DR's Routing Information Base (RIB), the delegated prefix is inserted as a static route with a next hop being the RR's link-local address out Serial2/0 (as shown in the preceding example).</p>
<p class="docText">The delegating server keeps state for each RR. This state is kept in a binding database that is shown in <a class="docLink" href="#ch03ex08">Example 3-8</a>.</P>
<a name="ch03ex08"></a><h5 class="docExampleTitle">Example 3-8. Binding Database of a DHCP-PD Server Router</h5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><td>


<pre>PE#<span class="docEmphStrong">show ipv6 dhcp binding</span>
Client: FE80::A8BB:CCFF:FE02:8A00 (Serial2/0)
 DUID: 00030001AABBCC028A00
 IA PD: IA ID 0x00040001, T1 302400, T2 483840
 Prefix: 2001:DB8:FF01::/48
   preferred lifetime 604800, valid lifetime 2592000
   expires at Nov 26 2004 12:03 AM (2589457 seconds)</pre><br>

</td></tr></table></P>

<a name="ch03lev3sec6"></a>
<h5 class="docSection3Title">What DHCP-PD Does Not Do</h5>
<p class="docText"><a name="iddle1268"></a><a name="iddle1282"></a><a name="iddle1293"></a><a name="iddle1772"></a><a name="iddle1947"></a>DHCP-PD is designed to solve the simple case of delegating a prefix across the administrative boundary between a provider and a customer. It does not solve the problem of how the prefix information should be propagated within the site. Router autoconfiguration has been worked on in the IETF, but no solution has been agreed upon yet.</p>


<a name="ch03lev2sec3"></a>
<h4 class="docSection2Title">Other Configuration Information</H4>
<p class="docText">The IETF spent a significant amount of time trying to reach a consensus on a mechanism for hosts to discover DNS servers without relying on &quot;third-party&quot; servers. The idea was that as long as the on-link router worked, and the DNS server worked, no further &quot;configuration servers&quot; should be needed. Because DHCP is one such third-party server, it was initially ruled out as a part of the solution.</P>
<p class="docText">Many proposals where evaluated, among them was using the Service Location Protocol or DNS options in RAs or well-known site-local DNS addresses. As a reminder, this function is handled by DHCP for IPv4.</P>
<a name="ch03note05"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">Note that in an environment running both IPv4 and IPv6, also called a <span class="docEmphasis">dual-stack environment,</span> the configuration information acquired from IPv4 can also be used by IPv6. That is, the IPv6 stack can use recursive name servers with an IPv4 address to resolve names to IPv6 addresses.</p>
</div><br>
<a name="ch03lev3sec7"></a>
<h5 class="docSection3Title">Stateless DHCP</h5>
<p class="docText">Stateless DHCP, specified in RFC 3315, is the term used to describe a simplified DHCP message exchange where no state is required to be kept in the DHCP server. The DHCP server simply passes other configuration information on to the host.</p>
<a name="ch03note06"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">Network managers can configure routers to leverage the ICMPv6/Neighbor Discovery options, called <span class="docEmphasis">M bit</span> and <span class="docEmphasis">O bit</span> in RAs, to signal to a host that it should use a stateful (really meaning DHCP) service to configure addresses and acquire other configuration information.</p>
</div><br>
<p class="docText">Nodes that use DHCP for address assignment will also obtain the other configuration information through the normal DHCP message exchange. Stateless DHCP is for nodes that do not use DHCP for address assignment (for example, stateless autoconfiguration or manual configuration). It is important to note that the options and messages used in stateless DHCP are the same as in &quot;stateful&quot; DHCP. There is no need for any special support for the stateless mode in the DHCP server or client.</p>
<p class="docText"><a name="iddle1783"></a><a name="iddle1784"></a>The simplified message exchange between the DHCP client and server goes as follows. The client sends an Information-REQUEST message to request configuration parameters, and the server replies with a REPLY message containing the configuration information.</p>
<p class="docText">The interface configuration command <span class="docEmphStrong">ipv6 nd other-config-flag</span> enables the router to indicate, through RAs, to attached hosts that they should use stateful DHCP to acquire provisioning information other than the IPv6 prefix. A router configured this way sets the OtherFlag field to 1 in its RAs, as shown in the output of <span class="docEmphStrong">show ipv6 routers</span> on a neighboring router (<a class="docLink" href="#ch03ex09">Example 3-9</a>).</p>
<a name="ch03ex09"></a><h5 class="docExampleTitle">Example 3-9. Output of show ipv6 routers on a Neighbor to a Router Advertising an OtherFlag Value of 1</h5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><TD>


<pre>Router#<span class="docEmphStrong">show ipv6 routers</span>
Router FE80::20D:29FF:FEE1:4DC0 on TenGigabitEthernet9/1, last update 0 min
 Hops 64, Lifetime 1800 sec, AddrFlag=0, OtherFlag=0, MTU=1500
 HomeAgentFlag=0, Preference=Medium
 Reachable time 0 msec, Retransmit time 0 msec
 Prefix 2001:A:A:A::/64 onlink autoconfig
 Valid lifetime 2592000, preferred lifetime 604800
Router FE80::200:FF:FE01:F on GE-WAN1/4, last update 1 min
 <span class="docEmphMark">Hops 64, Lifetime 1800 sec, AddrFlag=0, OtherFlag=1, MTU=1500</span>
 HomeAgentFlag=0, Preference=Medium
 Reachable time 0 msec, Retransmit time 0 msec
 Prefix 2001:B:B:B::/64 onlink autoconfig
Valid lifetime 2592000, preferred lifetime 604800</pre><BR>

</TD></tr></table></p>

<a name="ch03lev3sec8"></a>
<h5 class="docSection3Title">DNS Services</h5>
<p class="docText">The Domain Name System (DNS) represents a resource and a mechanism that facilitate scalable deployments of IP services. It is a distributed database that stores name-to-IP address mapping information. This information helps users to identify the IP address of other hosts or network resources based solely on the name of their destination or vice versa.</p>
<p class="docText">Name servers store the DNS data records, called <span class="docEmphasis">Resource Records (RRs).</span> There are of several types RRs):</p>
<ul><li><p class="docText"><span class="docEmphStrong">Start of Authority (SOA)</span> Marks the beginning of a DNS zone, typically the first record for that domain in that Name Server.</p></li><li><p class="docText"><span class="docEmphStrong">Name Server (NS)</span> Provides the domain name of a server in a DNS zone.</p></LI><li><p class="docText"><span class="docEmphStrong">Canonical Names (CNAMEs)</span> These are aliases for fully qualified DNS names.</p></LI><LI><p class="docText"><span class="docEmphStrong">Address (A)</span> Matches domain names to IP addresses.</p></li><li><p class="docText"><span class="docEmphStrong">Pointer (PTR)</span> Is an alias for another location in the domain name space. The most common use of the PTR RR is to construct the in-addr.arpa.com domain that provides the name corresponding to a given IPv4 address.</p></LI></ul>
<p class="docText">The IP address-to-name mapping is resolved by hosts, also called <span class="docEmphasis">resolvers,</span> through queries sent to the NSs for the necessary RRs (see RFC 1035). To expand the DNS functionality to IPv6, three aspects of the process had to be considered):</p>
<ul><li><p class="docList">Define a new record that would store the 128-bit IPv6 address.</P></LI><LI><p class="docList"><a name="iddle1023"></a><a name="iddle1277"></a><a name="iddle1280"></a><a name="iddle1283"></a><a name="iddle1284"></a><a name="iddle1446"></a>Define the IPv6 equivalent for the in-addr.arpa.com domain for the IPv4 PTR.</p></li><li><p class="docList">Define the changes to the query messages and the method of transporting them between the Resolvers and the NS.</p></li></ul>
<a name="ch03lev4sec3"></a>
<h5 class="docSection4Title">AAAA Records</h5>
<p class="docText">Two solutions were proposed for the first aspect of the DNS process: the AAAA record specified in RFC 3596; and the A6 record specified in RFC 2874, which is a super set of AAAA. The A6 could store records where the prefix portion of the address can be modified with no action from the administrators of the DNS zone. This could prove helpful when performing a network renumbering. On the other hand, the AAAA records are similar to the A records used in IPv4, and that makes them more palatable to network and service operators. The AAAA records are also optimal to be read by the Resolver, and they store the complete address (see RFC 3364). The IETF DNSEXT working group decided that the AAAA records are preferable for production deployments, whereas the A6 ones were moved to an experimental status. For more information on the AAAA versus A6 discussion, refer to RFC 3363 and RFC 3364.</p>

<a name="ch03lev4sec4"></a>
<h5 class="docSection4Title">IP6.ARPA Domain</h5>
<p class="docText">Similar to IPv4, a special domain is defined to find the host names that match an IPv6 address. In the case of IPv6, the root of this domain is IP6.ARPA; it was formerly IP6.INT. The record representing an IPv6 address is built by listing it as a set of dot-separated nibbles listed in reverse order terminated by .IP6.ARPA. Such a record is exemplified in <a class="docLink" href="#ch03table02">Table 3-2</a> alongside an AAAA record.</p>
<a name="ch03table02"></a><p><table cellspacing="0" class="allBorders" border="1" RULES="all" cellpadding="4"><caption><h5 class="docTableTitle">Table 3-2. IPv6 vs. IPv4 DNS Resource Records</H5></caption><colgroup><col width="100"><col width="225"><col width="225"></colgroup><thead><TR><th class="thead" scope="col" align="left" valign="top">&nbsp;</th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">IPv4</P></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">IPv6</P></th></TR></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Name to IP Address</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">A Resource Record:</p>
<p class="docText"><a class="docLink" target="_blank" href="http://www.example.com">www.example.com</a> A 172.18.140.154</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">AAAA Resource Record:</p>
<p class="docText"><a class="docLink" target="_blank" href="http://www.example.com">www.example.com</a> AAAA 2001:1:F:1:F:1:F:1</p></td></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText">IP Address to Name</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">PTR Resource Record:</p>
<p class="docText">154.140.18.172.in-addr.arpa PTR <a class="docLink" target="_blank" href="http://www.example.com">www.example.com</a></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">PTR Resource Record:</p>
<p class="docText">1.0.0.0.F.0.0.0.1.0.0.0.F.0.0.0.1.0.0.0.F.0.0.0.1.0.0. 0.1.0.0.2.ip6.arpa PTR <a class="docLink" target="_blank" href="http://www.example.com">www.example.com</a></p></td></tr></table></P><BR>

<a name="ch03lev4sec5"></a>
<H5 class="docSection4Title">Query Messages Changes</h5>
<p class="docText">To work in a dual-stack environment, the NS, Location of Services, and Mail Exchange query types have been modified. A DNS server replies to queries with both IPv4 and IPv6 information it holds (RFC 3596). In other words, when a dual-stack host queries an NS for the IP address corresponding to a given name, the reply contains an IPv4 and IPv6 address if both are in the RR. The node then selects the one it is interested in.</p>
<p class="docText"><a name="iddle1051"></a>All query messages can be transported in UDP or TCP on top of either IPv4 or IPv6, regardless of the IP version used in the request. IPv6-specific records can be transported over IPv4 and vice versa.</p>
<a name="ch03note07"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">The choices available in transporting the DNS queries can lead to problems under certain circumstances. If the local DNS server is IPv6 only and the root NS for the domain is IPv4, the name resolution is not possible because the host cannot reach the NS.</p>
<p class="docText">Another example is that of a recursive search for the NS with a name's longest-match RR. The local DNS server resides in an IPv4-only network and climbs up the tree starting with the root NS. The queries are exchanged over IPv4. If the targeted NS is IPv6 only, the name resolution cannot take place.</p>
<p class="docText">Deployment consistency and dual-stack DNS servers would avoid the problems described in this note.</p>
</div><br>
<p class="docText">With the exception of the changes mentioned and described previously, the DNS functionality for IPv6 is similar to that of IPv4. The similarity resides in both implementation and in operation. For this reason, the functionality can be managed based on the experience gained with running IPv4 networks.</p>




<a href="22971536.html"><img src="images/pixel.jpg" alt="" width="1" height="1" border="0"></a></TD></TR></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch03lev1sec1.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch03lev1sec3.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
</body></html>