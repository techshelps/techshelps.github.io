<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>IPv6 Interior Gateway Protocols</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch04lev1sec3.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch04lev1sec5.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><TR><TD valign="top"><a name="ch04lev1sec4"></a>
<H3 class="docSection1Title">IPv6 Interior Gateway Protocols</h3>
<p class="docText">Every modern IPv4 IGP has either an IPv6 version counterpart or an extension that enables it to support IPv6. The following subsections review the four IGPs available on Cisco routers: RIPng, EIGRP for IPv6, OSPFv3, and IS-IS for IPv6.</p>
<a name="ch04lev2sec1"></a>
<h4 class="docSection2Title">Routing Information Protocol next-generation</h4>
<p class="docText">RIP is a simple protocol in the distance vector family. That means it is simple to understand and configure, but it also means it does have some limitations. The main ones are convergence times and scaling. RIPng is basically RIP version 2 (RFC 2453) extended to handle IPv6 prefixes and next hops.</p>
<a name="ch04lev3sec1"></a>
<h5 class="docSection3Title">Support for IPv6</h5>
<p class="docText">The IPv6 version of RIP is described in RFC 2080. It is called RIPng (RIP next generation); this reflects the code name used for the next-generation IP protocol.</p>
<p class="docText">It has been argued that RIP should be left to &quot;Rest In Peace.&quot; Because it is an easy protocol to implement, it was the first protocol to be supported by vendors, and therefore it saw some deployment in the early days of IPv6. Now that OSPF and IS-IS are supported, RIP is used in small deployments (for example, in a multihomed host or to pass on a default route from an ISP to a customer's CPE).</p>
<p class="docText">There is not much new and exciting about RIPng. It supports split horizon and poison reverse as its IPv4 counterpart. It has the same limitations, such as a maximum hop count of 15, and does counting to infinity for certain routing loops.</p>
<p class="docText">The differences between RIP (used for IPv4) and RIPng are as follows:</p>
<ul><LI><p class="docList">In IPv4, RIP runs per subnet. Two neighboring routers need to be a part of the same IPv4 subnet to exchange routes. Because IPv6 neighbors always are on the same link-local subnet (FE80::/10), this restriction is removed. The consequence of this, however, is that a router will have to advertise its own prefix on a link, out that interface.</p></li><LI><p class="docList">Because IPv6 does not use broadcast, RIP messages are sent to the &quot;all RIP routers&quot; link-local multicast address (FF02::9).</P></li><li><p class="docList"><a name="iddle1424"></a><a name="iddle1792"></a><a name="iddle1794"></a><a name="iddle1831"></a>In IPv4, RIP relies on some specific RIP authentication mechanism to secure routing exchanges. RIPng relies on the IP Authentication Header and the IP Encapsulating Security Payload to ensure integrity and authentication/confidentiality of routing exchanges.</p></li></UL>
<p class="docText">RIP does not directly support multiple instances of the protocol on a link. There is no instance identifier or anything like that in the message format, so if you require this functionality you will have to run RIP on a different UDP port, or use a different RIP multicast address (default FF02::9). The Cisco IOS implementation supports a maximum of four RIPng instances.</p>

<a name="ch04lev3sec2"></a>
<h5 class="docSection3Title">Configuration Example</h5>
<p class="docText">Configuring RIP on Cisco routers is straightforward. It requires that RIP be enabled on each interface, as illustrated here:</p>
<div class="docText"><pre>interface Ethernet0/0
 ipv6 address 2001:200::2/64
 ipv6 rip foo enable
end</pre></div><BR>
<p class="docText">You can change the metric and summary information on a per-interface basis. The IPv6 router RIP mode allows for configuration of redistribution, distribute lists, and knobs for tuning RIP behavior. For example, poison reverse and split horizon can be turned on or off, and the default RIP timers can be changed for better convergence times.</P>
<p class="docText">To verify that RIP works correctly, you can use the <span class="docEmphStrong">show</span> command shown in <a class="docLink" href="#ch04ex01">Example 4-1</a>.</P>
<a name="ch04ex01"></a><h5 class="docExampleTitle">Example 4-1. Checking RIP Status</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>Router#<span class="docEmphStrong">show ipv6 rip</span>
RIP process "foo", port 521, multicast-group FF02::9, pid 26
     Administrative distance is 120. Maximum paths is 16
     Updates every 30 seconds, expire after 180
     Holddown lasts 0 seconds, garbage collect after 120
     Split horizon is on; poison reverse is off
     Default routes are not generated
     Periodic updates 14, trigger updates 2
  Interfaces:
    Ethernet0/0
  Redistribution:
    Redistributing protocol static</pre><br>

</td></tr></table></p>
<p class="docText">The <span class="docEmphStrong">show ipv6 rip</span> command shows the status of the RIP process(es). The output includes most of the details you need to know; timers, redistribution status, and on which interfaces RIP is enabled.</p>
<p class="docText">Routing information is stored in a local database called a <span class="docEmphasis">routing table</span>, also referred to as <span class="docEmphasis">Routing Information Base</span> (RIB). The RIB essentially contains all routes available for selection. Essentially, it is the sum of all routes learned via dynamic RPs (including RIP, <a name="iddle1273"></a><a name="iddle1289"></a><a name="iddle1315"></a><a name="iddle1417"></a>for instance), all directly attached networks (networks that a given router has interfaces connected to), and any additional configured routes such as static routes. There is one RIB for IPv4, and a separate one for IPv6. There may be more than one if the VPN feature is enabled (see <a class="docLink" href="ch07.html#ch07">Chapter 7</a>, &quot;VPN IPv6 Architecture and Services&quot;).</p>
<a name="ch04ex02"></a><h5 class="docExampleTitle">Example 4-2. Rip Database Display</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><TD>


<pre>Router#<span class="docEmphStrong">show ipv6 rip database</span>
RIP process "foo", local RIB
 2001:200::/64, metric 2
     Ethernet0/0/FE80::A8BB:CCFF:FE02:8B00, expires in 159 secs
 DEAD:BEEF:CAFE::/64, metric 2, installed
     Ethernet0/0/FE80::A8BB:CCFF:FE02:8B00, expires in 159 secs</pre><BR>

</TD></TR></table></p>
<p class="docText">In addition, each RP, such as RIPng, has its own database, which you can view.</p>
<p class="docText">The <span class="docEmphStrong">show ipv6 rip database</span> command lists the routing database for RIP. You might see entries in this database that are not in the IPv6 RIB. For example, the RIB might already have a route with a better administrative distance. The keyword <span class="docEmphStrong">installed</span> after a prefix indicates that it is installed in the RIB.</p>


<a name="ch04lev2sec2"></a>
<h4 class="docSection2Title">EIGRP for IPv6</h4>
<p class="docText">The Cisco proprietary Enhanced Interior Gateway Protocol (EIGRP) was developed to bridge the gap between the traditional distance vector protocols (IGRP, RIP) and the advanced link-state protocols (OSPF, IS-IS). It integrates some of the proven capabilities of the latter to improve the operation and the scalability of the former. Nevertheless, the intent was to avoid some of the topological constraints that are sometimes associated with link-state protocols. The result is a simple yet fast converging, resilient, and scalable routing protocol that is largely adopted in many enterprise networks as well as the edge of some ISP networks.</p>
<p class="docText">The protocol is extensively discussed in the book <span class="docEmphasis">EIGRP Network Design Solutions</span>, by Ivan Pepelnjak; but in summary, EIGRP is a distance vector routing protocol based on IGRP that offers the following improvements:</p>
<ul><li><p class="docList">Diffusing update algorithm (DUAL) used to determine whether a path advertised by a neighbor is loop-free and to identify alternate paths without waiting on updates from other routers.</p></li><li><p class="docList">It stores all routes learned, not only the best one learned from neighbors.</P></li><li><p class="docList">EIGRP actively queries neighbors when destinations become unreachable, and that leads to competitive convergence times.</P></LI><li><p class="docList">Use of Hello packets to maintain neighbor state leads to faster convergence.</p></li><li><p class="docList">Use of reliable transport protocol for the exchange of updates eliminates the need for periodic, full updates.</P></li><li><p class="docList">EIGRP uses complex metrics that provide flexibility in route selection.</p></li></UL>
<p class="docText"><a name="iddle1314"></a><a name="iddle1416"></a><a name="iddle1463"></a>To meet the routing needs of enterprise networks, EIGRP has a modular design with protocol-independent core functionality and protocol-dependent modules that enable it to be used for IPv4, IPX, and AppleTalk.</P>
<a name="ch04lev3sec3"></a>
<H5 class="docSection3Title">Support for IPv6</h5>
<p class="docText">The large deployed base for EIGRP drove the demand for extending its capabilities to support IPv6. The modular implementation of EIGRP simplifies the implementation. It requires the introduction of another protocol-dependent module for IPv6 (protocol identifier 88 was chosen, the same as IPv4) and three new TLVs (IPv6_REQUEST_TYPE [0X0401], IPv6_METRIC_TYPE [0X0402] and IPv6_EXTERIOR_TYPE [0X0403]).</p>
<p class="docText">EIGRP for IPv4 and EIGRP for IPv6 have strong similarities. Both implement the &quot;diffusing update algorithm,&quot; developed by J. J. Garcia-Luna-Aceves based on work by E. W. Dijkstra and C. S. Scholten in 1980. A few differences exist due to some specific aspects of IPv6:</p>
<ul><li><p class="docList">The router ID for the EIGRP process remains 32 bits long. It is derived from an IPv4 address found on one of the configured interfaces or is manually configured.</p><a name="ch04note01"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">On an IPv6-only router, the EIGRP process does not start until the ID is manually configured.</p>
</div><br></li><li><p class="docList">The source address (SA) of the EIGRP Hello is the link-local address of the transmitting interface; the destination address (DA) is FF02::A (the all EIGRP routers, link-scope multicast address).</p><a name="ch04note02"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">This format of the Hello packet implies that two neighbor routers do not have to share the same prefix on the link to see each other's Hellos. Packets sent to specific peers are unicasted, in which case, sharing the same prefix on the link becomes relevant.</p>
</div><BR></LI><LI><p class="docList">EIGRP for IPv4 uses MD5 for authentication, and similar support is provided by EIGRP for IPv6. Although not yet available by the time of this writing, support for IPsec authentication will also be provided on Cisco routers.</P></LI><li><p class="docList">Automatic summarization enabled by default in EIGRP for IPv4 is disabled in EIGRP for IPv6 because IPv6 is classless.</p></li><li><p class="docList">Unlike EIGRP for IPv4, there is no split horizon in EIGRP for IPv6 because in IPv6 multiple prefixes could be present on the same interface of a router.</p></li></ul>
<p class="docText"><a name="iddle1313"></a><a name="iddle1320"></a><a name="iddle1415"></a>EIGRP for IPv6 will be enabled to operate within virtual private networks (VPNs) in a similar way as EIGRP for IPv4. Scalability characteristics of EIGRP for IPv6 differ from EIGRP for IPv4 mainly due to the need for extra memory resources.</p>

<a name="ch04lev3sec4"></a>
<h5 class="docSection3Title">Configuration Example</h5>
<p class="docText">Similar to all other IPv6 RPs, EIGRP for IPv6 is enabled on a per-interface basis. If a router is able to acquire its ID from an IPv4 address existent on it, the EIGRP for IPv6 protocol configuration is simple, as illustrated here:</p>
<div class="docText"><pre>interface Ethernet0
 ipv6 enable
 <span class="docEmphMark">ipv6 eigrp 100</span></pre></div><br>
<a name="ch04note03"></a><div class="docNote"><p class="docNoteTitle">Note</P>

<p class="docText">The EIGRP process does not start on an interface unless the <span class="docEmphStrong">ipv6 enable</span> command is present under that interface.</p>
</div><br>
<p class="docText">If the router is IPv6 only, a router ID has to be explicitly configured under the EIGRP process, as illustrated here:</P>
<div class="docText"><pre>ipv6 router eigrp 100
 <span class="docEmphMark">Router-id 10.10.10.1</span></pre></div><BR>
<a name="ch04note04"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">When configured, the EIGRP process is by default shut down and an explicit <span class="docEmphasis">no shutdown</span> is necessary to get it started.</p>
</div><br>
<p class="docText">Once configured, you can use the following <span class="docEmphStrong">show</span> command to display EIGRP-relevant operational parameters.</p>
<a name="ch04ex03"></a><H5 class="docExampleTitle">Example 4-3. Displaying EIGRP Parameters</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>Router1#<span class="docEmphStrong">show ipv6 protocol</span>
<span class="docEmphMark">IPv6 Routing Protocol is "eigrp 100"</span>
  <span class="docEmphMark">EIGRP metric weight K1=1, K2=0, K3=1, K4=0, K5=0</span>
  <span class="docEmphMark">EIGRP maximum hopcount 100</span>
  EIGRP maximum metric variance 1
  Interfaces:
    <span class="docEmphMark">FastEthernet0/1.1</span>
  Redistribution:
    None
  <span class="docEmphMark">Maximum path: 16</span>
  Distance: internal 90 external 170</pre><BR>

</TD></TR></table></p>
<p class="docText"><a name="iddle1423"></a><a name="iddle1671"></a>When established, adjacencies are pointing to the link-local address of the neighbor, as shown in <a class="docLink" href="#ch04ex04">Example 4-4</a>.</p>
<a name="ch04ex04"></a><h5 class="docExampleTitle">Example 4-4. EIGRP Neighbor Status</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>Router1#<span class="docEmphStrong">show ipv6 eigrp neighbor</span>
IPv6-EIGRP neighbors for process 100
H   Address                 Interface     Hold Uptime    SRTT   RTO  Q  Seq
                                          (sec)          (ms)       Cnt Num
<span class="docEmphMark">0   FE80::2B0:4AFF:FE5C:ACA Fa0/1.1         14 00:01:43     1  4500  0  1</span></pre><br>

</td></tr></table></p>
<p class="docText">The EIGRP for IPv6 topology is independent of IPv4, and when queried, the <span class="docEmphStrong">all-links</span> option should be used to view all equal-cost paths when present, as shown in the following <span class="docEmphStrong">show</span> command.</p>
<a name="ch04ex05"></a><h5 class="docExampleTitle">Example 4-5. EIGRP Topology</h5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><TD>


<pre>Router1#<span class="docEmphStrong">show ipv6 eigrp topology all-links</span>
<span class="docEmphMark">IPv6-EIGRP Topology Table for AS(100)/ID(10.10.10.1)</span>
Codes: P - Passive, A - Active, U - Update, Q - Query, R - Reply,
       r - reply Status, s - sia Status
<span class="docEmphMark">P 2001:FFFF:FFFF::/64, 1 successors, FD is 28160, serno 1</span>
        via Connected, FastEthernet0/1.1
        <span class="docEmphMark">via FE80::2B0:4AFF:FE5C:ACA9 (30720/28160), FastEthernet0/1.1</span></pre><BR>

</TD></tr></table></p>
<p class="docText">With minor syntax modifications, the commands available for tweaking or troubleshooting EIGRP for IPv4 are available for IPv6, too. For example, the command that enables MD5 authentication for a given interface would in this case be <span class="docEmphStrong">ipv6 authentication mode eigrp 100 md5</span>. Considering their similar mode of operation, you should use the same configuration and troubleshooting guidelines for IPv6 as for IPv4, such as those discussed in the book <span class="docEmphasis">EIGRP Network Design Solutions</span>, by <span class="docEmphStrong">I</span>van Pepelnjak.</p>


<a name="ch04lev2sec3"></a>
<h4 class="docSection2Title">OSPFv3</h4>
<p class="docText">OSPF is an IGP used to distribute routing information between routers of a single autonomous system. OSPF is based on link-state technology, described briefly in the &quot;<a class="docLink" href="ch03lev1sec1.html#ch03lev1sec1">Overview</a>&quot; section. The IPv4 version is specified in RFC 2328.</p>
<p class="docText">Routers running OSPF advertise link state, link prefix/mask, link weight, and other local connectivity parameters in link-state advertisements (LSAs). These LSAs are flooded reliably to other routers in the network to ensure that every OSPF router has a complete and consistent view of the topology.</p>
<p class="docText">On broadcast and Non-Broadcast Multiple Access (NBMA) networks, a designated router (DR), elected during neighboring relationship establishment (Hello protocol) can help reduce the amount of control traffic necessary for this operation, by acting as a relay between OSPF routers for LSAs. A backup designated router (BDR) is also elected. The BDR picks up the functions of a failed DR with no need of a new election process.</p>
<p class="docText"><a name="iddle1422"></a><a name="iddle1465"></a><a name="iddle1670"></a>OSPF allows sets of networks to be grouped together into regions called <span class="docEmphasis">areas.</span> A router maintains a topology database for each area it participates in, and the topology of an area is hidden from the rest of the autonomous system. Areas constitute a useful concept that enables a two-level routing hierarchy, a concept that helps improve scalability. Routers do not need to maintain a topology database for areas they do not belong to, which leads to significant reduction in routing traffic. Route summarization can occur on the area borders, another way to reduce the routing traffic.</p>
<p class="docText">For securing routing distribution and installation, OSPFv2 defines fields AuType and Authentication in its protocol header (RFC 2328).</p>
<p class="docText">Finally, OSPF has built-in support for classless interdomain routing (CIDR). (Each route distributed by OSPF has a destination and mask.)</p>
<p class="docText">For in-depth information on OSPF, refer to the book <span class="docEmphasis">OSPF: Anatomy of an Internet Routing Protocol</span>, by John T. Moy.</p>
<a name="ch04lev3sec5"></a>
<H5 class="docSection3Title">Support for IPv6</h5>
<p class="docText">OSPFv3 extends OSPF to provide support for IPv6, as specified in RFC 2740. The basic mechanisms already used by OSPFv2, such as flooding, DR election, area support, SPF calculations, and so on, remain applicable to OSPFv3. Neighboring routers are still identified by the 32-bit router ID in OSPFv3. However, changes in protocol semantics between IPv4 and IPv6, as well as changes in the address format, have led to significant changes in OSPFv3 compared to OSPFv2.</p>
<p class="docText">The two versions of the OSPF protocol operate independently of each other, on disjoint databases. There is no backward compatibility from OSPFv3 to OSPFv2.</P>
<p class="docText">Extensions have been proposed to adapt OSPFv3 as an &quot;integrated model,&quot; where OSPFv3 would be extended to calculate IPv4 routes. This is still a work in progress at the IETF. Two proposals are being discussed: &quot;Multi-topology routing in OSPFv3&quot; (Internet Draft; Sina Mirtorabi, Abhay Roy) and &quot;Support of address families in OSPFv3&quot; (Internet Draft; Mirtorabi, S., <span class="docEmphasis">et al</span>.). A Cisco implementation is already available that provides a unified command-line interface (CLI), as shown in <a class="docLink" href="#ch04ex06">Example 4-6</a>.</P>
<a name="ch04ex06"></a><h5 class="docExampleTitle">Example 4-6. Unified OSPF Configuration Example</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><TD>


<pre>interface serial0
    ipv6 ospf 1 area 0
    ipv6 ospf cost 12
    ospfv3 2 area 0 instance 64 address-family ipv4
    ospfv3 instance 64 cost 22</pre><br>

</td></tr></table></p>
<p class="docText">A main goal of OSPFv3 was to create a routing protocol independent of any specific network layer. To achieve this, OSPFv3's inter-router messages have been redesigned, and addressing semantics have been removed from OSPF packets and from the basic LSAs. In <a name="iddle1421"></a><a name="iddle1669"></a>OSPFv3, LSAs such as router LSAs and network LSAs only carry topology information. The following LSAs have been created to carry IPv6 addresses and prefixes:</P>
<UL><LI><p class="docList">Link LSAs announce the router's IPv6 link-local address to neighbors on the link, inform these neighbors of a list of IPv6 addresses to associate with the link, and announce the set of options.</p></li><li><p class="docList">Intra-area prefix LSAs carry all IPv6 prefix information to all OSPFv3 routers within an area. (This information in IPv4 is carried by the router and network LSAs.)</p></li></ul>
<p class="docText">The following LSAs have been modified:</p>
<ul><li><p class="docList">Router link state advertisements and network LSAs no longer carry prefix information. In OSPFv3, these LSAs only carry topology information, making them network-protocol independent.</p></li><li><p class="docList">Inter-area prefix replaces the network summary or type 3 LSA. An inter-area prefix LSA advertises internal networks to routers in other areas. With IPv6, those LSAs are expressed as &lt;prefix, prefix length&gt; rather than &lt;prefix, mask&gt;.</p></li><LI><p class="docList">Inter-area router replaces the Autonomous System Boundary Router (ASBR) summary LSA (type 4). It advertises the location of an ASBR.</P></LI></UL>
<p class="docText">OSPFv3 runs on a per-link basis rather than on a perIP subnet basis as in OSPFv2. When OSPF peering occurs over a physical link, OSPF packets are sent using the interface link-local unicast address as source. The flooding scope for LSAs has been generalized. Authentication has been removed from the OSPF protocol itself, instead relying on IPv6's Authentication Header (AH) and Encapsulating Security Payload (ESP). Most packets in OSPF for IPv6 are almost as compact as those in OSPF for IPv4, even with the larger IPv6 addresses.</P>
<p class="docText">OSPFv3 supports the ability to run multiple OSPF protocol instances on a single link. The OSPFv3 packet header includes an 8-bit instance ID used to demultiplex the protocol packets. Each OSPFv3 process sets its configured instance value in the OSPFv3 packets that it sends, and ignores received packets with instance values from other OSPFv3 processes.</p>
<p class="docText">Instance IDs can control communication between routers sharing a physical network and OSPF area, without relying on complex authentication schemes or access lists, as needed in the past. It enables the providers to run separate OSPF routing domains even though they have one or more physical network segments in common.</p>

<a name="ch04lev3sec6"></a>
<h5 class="docSection3Title">Configuration Example</h5>
<p class="docText">Configuring OSPFv3 on Cisco routers on a broadcast network is straightforward. It requires just enabling OSPF on each interface participating in the OSPF area, as illustrated in <a class="docLink" href="#ch04ex07">Example 4-7</a>.</p>
<a name="ch04ex07"></a><h5 class="docExampleTitle">Example 4-7. OSPF Configuration Example</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>interface Ethernet1/0
 ipv6 address 2001:200::2/64
 ipv6 ospf 100 area 1
end</pre><br>

</td></TR></table></p>
<p class="docText">On NBMA interfaces, the neighbor is explicitly configured.</p>
<a name="ch04ex08"></a><H5 class="docExampleTitle">Example 4-8. OSPF Configuration on Interface</H5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>Interface Serial1/0
  ipv6 enable
  ipv6 ospf 100 area 0
  encapsulation frame-relay
  frame-relay map ipv6 FE80::A8BB:CCFF:FE00:C01 120
  ipv6 ospf neighbor FE80::A8BB:CCFF:FE00:C01</pre><br>

</TD></tr></table></p>
<p class="docText">In addition, if the OSPF router does not have an IPv4 address configured, a router ID must be configured. This is done under IPv6 router mode.</p>
<p class="docText">Other useful options can be configured under IPv6 router mode, such as enabling routes summarization at an area boundary or enabling authentication for an OSPF area, as illustrated in <a class="docLink" href="#ch04ex09">Example 4-9</a>.</p>
<a name="ch04ex09"></a><H5 class="docExampleTitle">Example 4-9. OSPF Options</H5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>ipv6 router ospf 100
 router-id 200.11.11.1
 area range 1 2001::/48
 area 1 authentication ipsec spi 678 md5 1234567890ABCDEF1234567890ABCDEF</pre><br>

</td></tr></table></p>
<p class="docText">Finally, to verify proper OSPF configuration, you can use the following <span class="docEmphStrong">show</span> command.</p>
<a name="ch04ex10"></a><h5 class="docExampleTitle">Example 4-10. OSPF Status</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>Router#<span class="docEmphStrong">show ipv6 ospf</span>
 Routing Process "ospfv3 100" with ID 200.11.11.1
 SPF schedule delay 5 secs, Hold time between two SPFs 10 secs
 Minimum LSA interval 5 secs. Minimum LSA arrival 1 secs
 LSA group pacing timer 240 secs
 Interface flood pacing timer 33 msecs
 Retransmission pacing timer 66 msecs
 Number of external LSA 0. Checksum Sum 0x000000
 Number of areas in this router is 1. 1 normal 0 stub 0 nssa
    Area 1
        Number of interfaces in this area is 2
        SPF algorithm executed 4 times
        Area ranges are
          2001::/48 Passive Advertise
        Number of LSA 12. Checksum Sum 0x04F3D1
        Number of DCbitless LSA 0
        Number of indication LSA 0
        Number of DoNotAge LSA 0
        Flood list length 0</pre><br>

</td></TR></table></P>
<p class="docText"><a name="iddle1420"></a><a name="iddle1475"></a>The <span class="docEmphStrong">show</span> commands display the process ID and OSPF router ID, the configured LSA timer values, the number of areas, and details about each.</P>


<a name="ch04lev2sec4"></a>
<H4 class="docSection2Title">IS-IS for IPv6</H4>
<p class="docText">The Intermediate System-to-Intermediate System (IS-IS) protocol is described in ISO Standard 10589. This link-state, OSI routing protocol was not originally developed for IP but rather to provide the routing functionality between the routers of Connectionless Network Protocol (CLNP)-based networks. With the addition of IPv4 support (RFC 1195), the protocol, sometimes referred to as <span class="docEmphasis">Integrated IS-IS</span> (I/IS-IS), was widely adopted as the IGP of choice for many ISP and large enterprise networks. (For more information, refer to the book <span class="docEmphasis">IS-IS: Deployment in IP Networks</span>, by Russ White and Alvaro Retana.</p>
<p class="docText">In many respects, IS-IS is similar to OSPF, but some terminology and implementation differences do exist. For example, packet encoding in IS-IS is Type Length Value (TLV) based and makes the protocol easily extensible. Nested TLVs also offer granularity in the protocol extensions.</p>
<p class="docText">The link state, link prefix/mask, link weight, and other local connectivity parameters are advertised in link state packets (LSPs). Unlike the OSPF LSAs that are exchanged at the IP level, the IS-IS LSPs are exchanged at layer 2. This makes IS-IS less vulnerable to spoofing or other attacks.</p>
<a name="ch04note05"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">Before deploying IS-IS in an IPv6 network using tunnels, it is important to make sure that the tunneling mechanisms used can forward the IS-IS LSPs.</p>
</div><br>
<p class="docText">Similar to OSPF, IS-IS also elects a DR, called a <span class="docEmphasis">designated intermediate system</span> (DIS). The DIS, however, does not select a BDR. Should the DIS fail, a new DIS election process is started. Notably, IS-IS does not have direct support for NBMA networks.</p>
<p class="docText">IS-IS implements a two-level routing hierarchy as well, an important feature for scalability. Despite that, most IS-IS deployments are rather flat. Unlike OSPF, where interfaces are bound to areas (thus enabling routers to belong to multiple areas), in IS-IS the routers belong to a single area. A router (called <span class="docEmphasis">intermediate system</span>, or IS) performing intra-area functions is a level 1 router. A router performing inter-area functions is a level 2 router.</p>
<p class="docText">IS-IS, like OSPF, supports authentication, it supports CIDR, and it transports MPLS traffic engineering link information. Both protocols are deployed in enterprise as well as ISP networks (with OSPF more common in enterprise networks, and IS-IS more common in large ISP networks).</p>
<a name="ch04lev3sec7"></a>
<h5 class="docSection3Title">Support for IPv6</h5>
<p class="docText"><a name="iddle1419"></a><a name="iddle1464"></a><a name="iddle1474"></a>The third network protocol supported by I/IS-IS is IPv6 (draft-ietf-isis-ipv6-02.txt). The implementation required a new protocol ID (0X8E) that was set to be used by the IPv6 routers to signal their capability to support ISISv6 and two new TLVs: IPv6_Reachability (0XEC) and IPv6_Interface_Address (0XE8). Extending IS-IS to support IPv6 is an exercise similar to extending it to support IPv4, unlike OSPF where a new protocol had to be developed. For this reason, IS-ISv6 is operationally similar to IS-ISv4. Few IPv6-specific differences exist. Neighbors are listed in the adjacency table with their link-local address. Because the link-local is used in the Hello packets, adjacencies can be built between neighbors even if they do not share the same prefix. From a user perspective, a new address family was added for IPv6. Most configuration commands available for IS-ISv4 are also available for IS-ISv6 with minimal format changes.</p>
<p class="docText">IS-IS uses a single topology and runs the same SPF calculation for all protocols supported. This mode of operation leads to certain deployment constraints.</P>
<a name="ch04lev4sec1"></a>
<h5 class="docSection4Title">Single Topology</h5>
<p class="docText">By default, IS-IS runs with a single topology for all protocols supported and a single instance of the SPF calculation per level (1 = area, 2 = domain). This could be a benefit in that fewer resources are being used by the routers to operate it. On the other hand, the single topology mode comes with some restrictions:</P>
<UL><li><p class="docList">All routers within an area (level 1 or level 2) must support the same set of address families on all interfaces. This ensures topology consistency. It also means that the single topology mode is not suitable in IPv4 networks where only some islands of IPv6 will be deployed.</p></li><li><p class="docList">The interface configured metric applies to both IPv4 and IPv6.</P></li></ul>
<p class="docText">This need for capabilities consistency raises this question: What will happen when an IS-ISv4 network is migrated to the IS-ISv4+IS-ISv6 network? Because routers are configured with the additional IPv6 address family, the adjacencies will be dropped until the consistency is reestablished. To avoid impacting the operating IPv4 service, you can disable the adjacency checking.</p>
<a name="ch04note06"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">To avoid inconsistencies in the operational network, only disable adjacency checking during the migration process.</P>
</div><BR>

<a name="ch04lev4sec2"></a>
<H5 class="docSection4Title">Multitopology</h5>
<p class="docText">IS-IS was later enhanced to support independent topologies and SPF calculations for each protocol (draft-ietf-isis-wg-multi-topology.txt). In this case, various routers can <a name="iddle1418"></a><a name="iddle1434"></a><a name="iddle1473"></a>support different sets of address families. To add multitopology support for IPv6, a new Multi_Topology_Reachable_IPv6_Prefixes TLV is defined. The multitopology operation can be enabled under the IPv6 address family. In this mode of operation, you can set the IPv6 metric independently of the IPv4 one.</p>
<p class="docText">To facilitate the migration from single topology to multitopology, you can enable a transition mode. In this case, both types of TLVs are advertised in LSPs. Larger LSPs are thus traded off for a smooth transition.</p>


<a name="ch04lev3sec8"></a>
<h5 class="docSection3Title">Configuration Example</h5>
<p class="docText">The simplest way to configure a router to run IS-IS for IPv6 is to enable the protocol on an interface with an IPv6 address. No changes are needed to the configuration of the IS-IS process for IPv4, as illustrated in <a class="docLink" href="#ch04ex11">Example 4-11</a>.</p>
<a name="ch04ex11"></a><h5 class="docExampleTitle">Example 4-11. IS-IS Configuration Example</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre><span class="docEmphMark">router isis example-area</span>
 <span class="docEmphMark">net 49.0001.0000.0000.0001.00</span>
!
interface FastEthernet0/1
 ip address 10.7.1.33 255.255.255.252
 <span class="docEmphMark">ip router isis example-area</span>
 ipv6 address 2001:FFFF:FFFF::2/64
 ipv6 enable
 <span class="docEmphMark">ipv6 router isis example-area</span></pre><br>

</td></tr></table></P>
<a name="ch04note07"></a><div class="docNote"><p class="docNoteTitle">Note</P>

<p class="docText">You must configure IPv6 on the interface for the IS-ISv6 process to start.</P>
</div><BR>
<p class="docText">In this example, IS-IS is operating in single-topology mode. The <span class="docEmphStrong">show ipv6 protocol</span> command indicates that IS-IS is running on the interface (highlighted below). The adjacencies built with other routers show both IP protocol addresses, as highlighted in <a class="docLink" href="#ch04ex12">Example 4-12</a>.</P>
<a name="ch04ex12"></a><h5 class="docExampleTitle">Example 4-12. ISIS Neighbor Status</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>Router1#<span class="docEmphStrong">show clns is-neighbors detail</span>
System Id      Interface   State  Type Priority  Circuit Id         Format
<span class="docEmphMark">Router2        Fa0/1       Up     L1L2 64/64     Router2.01     Phase V</span>
  Area Address(es): 49.0001
  <span class="docEmphMark">IP Address(es):  10.7.1.34*</span>
  <span class="docEmphMark">IPv6 Address(es): FE80::2B0:4AFF:FE5C:ACA9</span>
  Uptime: 00:01:25
  NSF capable</pre><br>

</td></tr></table></p>
<p class="docText">The IPv6 adjacency is identified through the link-local address, so the global prefix configured on the interface is not relevant for it. A look at the database reveals the capabilities of the neighbors. The following output obtained from the <span class="docEmphStrong">show isis</span> command illustrates the level 1 circuit of the Router2 neighbor.</p>
<a name="ch04ex13"></a><h5 class="docExampleTitle">Example 4-13. IS-IS Database</h5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>Router1#<span class="docEmphStrong">show isis database verbose level-1</span>
...
IS-IS Level-1 Link State Database:
LSPID                 LSP Seq Num  LSP Checksum  LSP Holdtime      ATT/P/OL
Router2.00-00         0x0000000B   0xAB35        1020              0/0/0
  Area Address: 49.0001
  <span class="docEmphMark">NLPID:        0xCC 0x8E</span>
  Hostname: Router2
  IP Address:   10.7.1.34
  Metric: 10         IP 10.7.1.32 255.255.255.252
  <span class="docEmphMark">IPv6 Address: 2001:FFFF:FFFF::1</span>
  Metric: 10         IPv6 2001:FFFF:FFFF::/64
  Metric: 10         IS Router2.01</pre><BR>

</TD></tr></table></p>
<p class="docText">The protocol ID number 8E indicates the support for IPv6. Because in this case IS-IS runs a single topology, no distinction is made in the output between IPv4 and IPv6. By the same token, there is no output for <span class="docEmphStrong">show isis ipv6 topology</span>.</p>
<p class="docText">Further protocol customization can be done similar to IPv4, from enabling authentication and summarization to adjusting metrics. The important thing to remember is that in the single-topology mode, you cannot configure the changes on a per-protocol basis.</p>
<p class="docText">If the network design requires the two IP protocols to operate independently at the cost of more router resources used by the two instances of the protocol, you can migrate IS-IS to a multitopology mode. In this case, you specifically configure the IPv6 address family under the IS-IS process, as shown in the configuration excerpt in <a class="docLink" href="#ch04ex14">Example 4-14</a>.</P>
<a name="ch04ex14"></a><h5 class="docExampleTitle">Example 4-14. Migrating IS-IS to Multitopology Mode</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><TD>


<pre>router isis example-area
 net 49.0001.0000.0000.0001.00
 <span class="docEmphMark">metric-style wide <span class="docEmphStrong">transition</span></span>
 !
 <span class="docEmphMark">address-family ipv6</span>
 <span class="docEmphMark">multi-topology <span class="docEmphStrong">transition</span></span></pre><BR>

</TD></tr></table></p>
<p class="docText">The <span class="docEmphStrong">transition</span> option is elected to allow routers in different modes to coexist during the migration. You should remote this option when the migration is completed.</p>
<p class="docText">With the change to the new operation mode, the outputs of the <span class="docEmphStrong">show</span> commands reflect the existence of two distinct topologies for the two IP protocols.</p>
<a name="ch04ex15"></a><h5 class="docExampleTitle">Example 4-15. Multitopology IS-IS Neighbor Details</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>Router1#<span class="docEmphStrong">show clns is-neighbors detail</span>
System Id      Interface   State  Type Priority   Circuit Id         Format
Router2        Fa0/1       Up     L1L2 64/64      Router2.01     Phase V
  Area Address(es): 49.0001
  IP Address(es):  10.7.1.34*
  IPv6 Address(es): FE80::2B0:4AFF:FE5C:ACA9
  Uptime: 00:00:14
  NSF capable
  <span class="docEmphMark">Topology: IPv4, IPv6</span></pre><br>

</td></tr></table></p>
<p class="docText"><a name="iddle1129"></a>You can now view the IPv6-specific topology.</p>
<a name="ch04ex16"></a><H5 class="docExampleTitle">Example 4-16. Multitopology IS-IS Topology</H5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><TD>


<pre>Router1#<span class="docEmphStrong">show isis ipv6 topology level-1</span>
IS-IS IPv6 paths to level-1 routers
System Id            Metric     Next-Hop      Interface    SNPA
<span class="docEmphMark">Router2              10         Router2       Fa0/1        00b0.4a5c.aca9</span></pre><br>

</td></tr></table></p>
<p class="docText">The database information also reflects the multitopology mode of operation.</p>
<a name="ch04ex17"></a><h5 class="docExampleTitle">Example 4-17. Mutiltopology IS-IS Database</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>Router1#<span class="docEmphStrong">show isis database verbose level-1</span>
IS-IS Level-1 Link State Database:
LSPID                 LSP Seq Num     LSP Checksum    LSP Holdtime    ATT/P/OL
Router2.00-00     0x00000014   0x8B3E           1086              0/0/0
  Area Address: 49.0001
  <span class="docEmphMark">Topology:     IPv4 (0x0) IPv6 (0x2)</span>
  NLPID:        0xCC 0x8E
  Hostname: Router2
  IP Address:   10.7.1.34
  Metric: 10         IP 10.7.1.32/30
  IPv6 Address: 2001:FFFF:FFFF::1
  <span class="docEmphMark">Metric: 10         IPv6 (MT-IPv6) 2001:FFFF:FFFF::/64</span>
  <span class="docEmphMark">Metric: 10         IS (MT-IPv6) Router2.01</span></pre><br>

</td></TR></table></p>
<p class="docText">Again, the configuration can be detailed further as it is done in IPv4. In this mode, however, you can tweak the IS-IS operation independently for each protocol with commands such as <span class="docEmphStrong">isis ipv6 metric</span> that adjust the metric on an interface only for IPv6.</p>



<a href="22971536.html"><img src="images/pixel.jpg" alt="" width="1" height="1" border="0"></a></TD></TR></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch04lev1sec3.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch04lev1sec5.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
</body></html>