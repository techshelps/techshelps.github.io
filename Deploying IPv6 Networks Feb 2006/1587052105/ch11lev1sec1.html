<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>Aspects of Router IPv6 Performance</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch11.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch11lev1sec2.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><TD valign="top"><a name="ch11lev1sec1"></a>
<h3 class="docSection1Title">Aspects of Router IPv6 Performance</H3>
<p class="docText">It is commonly understood that routers and layer 3 switches are performing functions at different levels of the OSI model. With the increased complexity of supported features, these devices started to operate at levels beyond the original first three. It is therefore expected that routers operate in one form or another on parameters that could relate to most of the seven layers of the OSI model.</P>
<p class="docText">However, the main focus of a router's operation remains the network layer. Its functions can be separated into three categories:</p>
<UL><li><p class="docText"><span class="docEmphStrong">Control plane</span> Handles the router's interaction with the other network elements, providing the information needed to take decisions and control the overall router operation. This plane runs processes such as routing protocols and network management. These functions are generally complex.</p></LI><LI><p class="docText"><span class="docEmphStrong">Data plane</span> Handles packet forwarding from one physical or logical interface to another. It involves different switching mechanisms such as process switching and Cisco Express Forwarding (CEF) on Cisco IOS software routers.</P></li><li><p class="docText"><span class="docEmphStrong">Enhanced services</span> Cover router's leverage of advanced features that are applied when forwarding data (for example, packet filtering, quality of service [QoS], encryption, translation, accounting).</p></LI></ul>
<p class="docText"><a class="docLink" href="#ch11fig01">Figure 11-1</a> provides a conceptual representation of these functions. The specifics of their implementation and operation depend on the router architecture.</p>
<a name="ch11fig01"></a><P><center>
<H5 class="docFigureTitle">Figure 11-1. Conceptual Representation of a Router: Data and Forwarding Planes</h5>
<p class="docText"><div class="v1"><a target="_self" href="images/11fig01_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="371" SRC="images/11fig01.jpg"></p>
</center></p><br>
<p class="docText"><a name="iddle1001"></a><a name="iddle1204"></a><a name="iddle1370"></a><a name="iddle1699"></a><a name="iddle1817"></a>Each of these router functions has its own performance characteristics. It is therefore important to qualify a router's performance in the context of its control-plane, data-plane, or enhanced-services operation. IPv6 presents each of these functions with specific new challenges.</P>
<a name="ch11lev2sec1"></a>
<h4 class="docSection2Title">IPv6 Control Plane</h4>
<p class="docText">When IPv6 is enabled on a router, its control plane starts to operate processes specifically for it. Protocol characteristics shape the performance of these processes and the amount of resources necessary to operate them:</P>
<ul><LI><p class="docText"><span class="docEmphStrong">Size of IPv6 addresses</span> Address size impacts the information-processing functions of a router. Systems using a 64-bit CPU, bus, or memory structure can pass both the IPv4 source and destination address in a single processing cycle. For IPv6, the source and destination addresses require two cycles each, or a total of four cycles to process the (source address, destination address) information. For this reason, routers that rely exclusively on software processing could see lower performance compared to IPv4.</p></li><li><p class="docText"><span class="docEmphStrong">Nodes use multiple IPv6 addresses</span> Each IPv6 node can use several IPv6 unicast addresses such as link-local and global unicast with different interface ID values. The increased number of addresses used impacts the memory consumption of the Neighbor Discovery cache.</p></li><li><p class="docText"><span class="docEmphStrong">IPv6 routing protocols</span> The IPv6 routing protocols are similar to their IPv4 counterparts. However, an IPv6 prefix is four times larger than an IPv4 one, which means that routing updates have to carry more information in the case of IPv6. This remains true despite various optimizations made to address this difference.</p></li></ul>
<p class="docText">Size is one of the natural concerns about the IPv6 networks and the IPv6 Internet. Larger networks are expected with the larger IPv6 address space. In principle, this implies larger routing tables and higher memory requirements to support them. At first, as deployments are incipient, this is not an issue. As the number and size of IPv6 networks increases, aggregation and strict prefix allocation through the provider-enforced hierarchy represent the means to control and reduce the size of the Internet routing table.</p>
<p class="docText">Currently, there are two main address types in the IPv6 Border Gateway Protocol (BGP) routing tables:</p>
<ul><li><p class="docText"><span class="docEmphStrong">6Bone routing tables</span> 3FFE::/16 prefix space allocated for development and experimentation</p></li><LI><p class="docText"><span class="docEmphStrong">IPv6 production tables</span> 2xyz::/16 prefix space allocated by the Regional Registries for production aggregation</p></li></ul>
<p class="docText">The 6Bone network will be retired by June 2006. Allocation rate in the 2xyz::/16 range is growing steadily. More than 1000 prefixes are now (February 2005) allocated and present in the IPv6 Internet table. To monitor the growth and prefix distribution of the IPv6 Internet, several websites provide tools and statistics on IPv6 routing tables:</P>
<blockquote><p><p class="docList"><a class="docLink" target="_blank" href="http://www.sixxs.net/tools/grh/dfp/">http://www.sixxs.net/tools/grh/dfp/</a></P></P><p><p class="docList"><a class="docLink" target="_blank" href="http://www.switch.ch/network/ipv6/bgp/">http://www.switch.ch/network/ipv6/bgp/</a></P></p><p><p class="docList"><a class="docLink" target="_blank" href="http://net-stats.ipv6.tilab.com/bgp/index.html">http://net-stats.ipv6.tilab.com/bgp/index.html</a></P></P></blockquote>
<p class="docText">For a historical perspective, <a class="docLink" href="#ch11fig02">Figure 11-2</a> shows the prefix-allocation growth seen in the BGP routing tables since 1998 (source TILAB).</P>
<a name="ch11fig02"></a><p><center>
<h5 class="docFigureTitle">Figure 11-2. Growth of IPv6 Internet Tracked by the Size of the BGP Routing Table</h5>

<p class="docText">
<img border="0" alt="" width="500" height="360" SRC="images/11fig02.jpg"></P>

</center></p><br>
<p class="docText">At the time of this writing, the number of IPv6 prefixes in the BGP routing tables is 2573. According to the TILAB statistics, the main contributions to the total number of prefixes present in the routing tables were, at the date of the snapshot (January 2005), in this order:</P>
<div style="font-weight:bold"><ol class="docList" type="1"><LI><div style="font-weight:normal"><p class="docText"><span class="docEmphStrong">IANA assigned prefixes.</span> These are the IPv6 prefixes officially assigned by IANA and the Internet registries to the requesting organizations for production use of IPv6, the sTLA prefixes.</p></div></li><li><div style="font-weight:normal"><p class="docText"><span class="docEmphStrong">Unaggregated prefixes.</span> These are the IPv6 prefixes belonging to the 6Bone addressing space that are longer than the correspondent pTLA delegation.</p></div></LI><li><div style="font-weight:normal"><p class="docList"><span class="docEmphStrong">6Bone pTLA prefixes</span> assigned to the backbone sites.</p></div></LI><li><div style="font-weight:normal"><p class="docText"><span class="docEmphStrong">Invalid prefixes.</span> These are IPv6 prefixes that do not belong to the address space assigned by IANA.</P></div></li></ol></div>
<p class="docText">The growth rate depicted in <a class="docLink" href="#ch11fig02">Figure 11-2</a> is expected to accelerate in the coming years. Similar to IPv4, tracking the size of the BGP IPv6 routing tables remains very <a name="iddle1227"></a><a name="iddle1371"></a><a name="iddle1700"></a><a name="iddle1818"></a>important for service providers (SPs) to better plan network resources such as router memory.</p>
<p class="docText">Independent of the routing table size, users want to know whether IPv6 routing protocols perform well in terms of convergence. Because of their similarity to the IPv4 counterparts, the convergence performance of the IPv6 routing protocols is generally similar to the IPv4 ones.</p>
<p class="docText">In general, it should be expected that IPv6 and IPv4 will be competing for the control-plane resources. For this reason, bringing IPv6 into an operational network has to be done in a controlled way and with full information about its potential impact. If justified by the available router resources or the network conditions, limitations can be placed on IPv6 processes or the router's interaction with other network elements. The intent is to protect and reserve the CPU or memory resources for the existent revenue-generating IPv4 services.</p>

<a name="ch11lev2sec2"></a>
<h4 class="docSection2Title">IPv6 and the Data Plane</h4>
<p class="docText">The data plane is responsible for forwarding the IP packets based on the decisions made by the control plane. The forwarding engine has to parse the relevant IP packet information. It then has to do a lookup to match the parsed information against the forwarding policies defined by the control plane. The performance of both &quot;parsing&quot; and &quot;lookup&quot; functions is impacted by IPv6 protocol specificities:</p>
<ul><li><p class="docText"><span class="docEmphStrong">Parsing IPv6 extension headers</span> Applications such as mobile IPv6 or source routing often include IPv6 address information in the extension headers, which significantly increases their size. These additional fields need to be accounted for in the hardware registers to properly read the extension headers and, deeper into the packet load, the layer 4 headers. An example is the case where the router has access control lists (ACLs) that filter on layer 4 information. The router has to be able to apply them to packets with extension headers, too. If the length of the extension headers exceeds the fixed length of the hardware registers, hardware switching does not occur. In this case, the packet is punted to software switching, and that has a severe impact on the forwarding performance.</p><a name="ch11note01"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">Not all routers on the market choose to punt into the software path the packets that they cannot handle in hardware. In those cases, the packets are simply dropped.</p>
</div><br></li><li><p class="docText"><span class="docEmphStrong">IPv6 address lookup</span> The IPv6 lookup occurs when a valid packet enters the router and needs to find an output interface. When the forwarding decision is made based on the destination address, this process entails parsing a maximum of 128 bits rather than 32 bits for IPv4. To improve the lookup performance, the lookup algorithm has been <a name="iddle1368"></a><a name="iddle1704"></a><a name="iddle1822"></a>modified. A 128-bit lookup is rare because it applies only to host routes, including anycast addresses, which should have a limited presence. An anarchic allocation of anycast addresses can be problematic because a lot of host routes would be injected in the IPv6 routing table. In a typical autonomous system, however, following the address allocation recommendations documented in RFC 3177, it is expected that for a service provider, the majority of lookups are centered on a few fixed values: /32 in the core of the network, /48 in the distribution layer, and /64 at the edge.</P></li></ul>
<p class="docText">Depending on the router type, lookups are performed by a multipurpose CPU or by an application-specific integrated circuit (ASIC) with a fixed configuration or with a microcode. This impacts the performance and the versatility of the router functions. Software processing of the IPv6 lookup takes more time than for IPv4 because more bits must be processed. The multipurpose CPU is slower but can perform functions based on a limitless program. The ASIC with microcode allows for a certain degree of flexibility in the performed features, although the fixed ASIC performs only the functions for which it was initially designed. Because the IPv6 lookup is more demanding (theoretically four times more demanding), there is a natural tendency to leverage hardware-based lookup engines as much as possible. Hardware-based lookup designs generally lead to IPv6 line-rate forwarding at all interface speeds for most packet sizes.</p>
<a name="ch11note02"></a><div class="docNote"><p class="docNoteTitle">Note</P>

<p class="docText">Not all hardware forwarding platforms in the market achieve line-rate forwarding of IPv6. It is therefore important to evaluate a router's capability, regardless of its architecture.</p>
</div><BR>
<a name="ch11note03"></a><div class="docNote"><p class="docNoteTitle">Note</P>

<p class="docText">The hardware forwarding option can come to the detriment of feature richness. If new features need to be added, the ASICs need to be redesigned, which is a much longer and more costly process than that of implementing it in software.</p>
</div><BR>
<p class="docText">The performance of the various processes and functions discussed in this section depends on the architecture of each router. An overview of these architectures is presented later in this chapter along with performance-data examples.</p>


<a href="22971536.html"><img src="images/pixel.jpg" alt="" width="1" height="1" border="0"></a></TD></TR></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch11.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch11lev1sec2.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
</body></html>