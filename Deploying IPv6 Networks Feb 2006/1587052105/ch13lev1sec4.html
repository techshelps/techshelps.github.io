<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>Basic Services Design and Implementation</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch13lev1sec3.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch13lev1sec5.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><TD valign="top"><a name="ch13lev1sec4"></a>
<h3 class="docSection1Title">Basic Services Design and Implementation</H3>
<p class="docText">The primary services delivered by EuropCom are IPv6 global IA, and IPv6 VPN access. Global IA can also be offered to VPN customers. Carrier's Carrier is another IPv6 service that EuropCom is offering to other ISPs.</P>
<a name="ch13lev2sec9"></a>
<h4 class="docSection2Title">Global IPv6 Internet Access Design and Implementation</H4>
<p class="docText">The EuropCom infrastructure must be first enabled to provide IPv6 over MPLS connectivity from PEs to IPv6 Internet gateways. The IPv6 Internet gateways are typically located at each EuropCom IX (L1 POP).</p>
<p class="docText">PEs located in the L1 POP interface the Internet gateway over native IPv6 (routing and forwarding). IS-ISv6 is used to exchange routes between the PE to the IGW.</p>
<p class="docText">PEs located in L2 and L3 POPs interface with the IGW of their closest L1 POP. The peering in that case is performed over 6PE (IPv6 over MPLS), and routes are exchanged using iBGP peering via RRs. The IGW is also a 6PE with regard to providing IA to those remote 6PEs/CE.</P>
<p class="docText">From the BGP configuration standpoint, the IGW (for instance Milan-IGW) is just another PE, peering with the RRs, as described in the section &quot;<a class="docLink" href="ch13lev1sec3.html#ch13lev2sec6">Route Reflector Design</a>.&quot;</P>
<p class="docText"><a class="docLink" href="#ch13table05">Table 13.5</a> reviews the tasks taking place to provide IPv6 IA to a new EuropCom customer. I</P>
<a name="ch13table05"></a><p><table cellspacing="0" class="allBorders" border="1" RULES="groups" cellpadding="5"><caption><h5 class="docTableTitle">Table 13-5. A Deployment Task List</h5></caption><colgroup><col width="250"><col width="250"></colgroup><thead><TR><th class="rightBorder bottomBorder thead" scope="col" align="left" valign="bottom"><p class="docText"><a name="iddle1590"></a><a name="iddle1918"></a>EuropCom Task</p></th><th class="bottomBorder thead" scope="col" align="left" valign="bottom"><p class="docText">Customer Task</p></th></TR></thead><TR><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText">In L1 POP, enable PE&lt;-&gt;IGW IS-ISv6 peering. Note that this is done prior to service deployment.</p></td><td class="bottomBorder" align="left" valign="top">&nbsp;</TD></tr><tr><TD class="rightBorder bottomBorder" align="left" valign="top"><p class="docText">In L1 POPs, enable RR&lt;-&gt;IGW iBGP peering. Note that this is done prior to service deployment, for the benefit of L2/L3 POP's PEs.</p></TD><td class="bottomBorder" align="left" valign="top">&nbsp;</td></tr><tr><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText">Enable L2/L3 POP's PE&lt;-&gt;RR iBGP peering. Note that this is done once, at first attached IPv6 customer.</p></td><td class="bottomBorder" align="left" valign="top">&nbsp;</td></tr><tr><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText">Allocate an IPv6 prefix P to the customer.</p></td><td class="bottomBorder" align="left" valign="top"><p class="docText">Enable the network for IPv6. This is done using one of the numerous available mechanisms (native, tunnels, and so on).</P></td></tr><tr><TD class="rightBorder bottomBorder" align="left" valign="top"><p class="docText">1) Enable the PE-CE interface by configuring link-local in the following form:</p>
<p class="docText"><span class="docEmphStrong">ipv6 address FE80::ASN:ID link-local</span></P>
<p class="docText">2) Configure a global address on the loopback interface in the following form:</P>
<p class="docText"><span class="docEmphStrong">ipv6 address 2001:6FC::node#/128</span></p>
<p class="docText">3) Protect the global address against denial-of-service (DoS) attacks using access control lists (ACLs).</P></td><td class="bottomBorder" align="left" valign="top"><p class="docText">1) Enable the CE-PE interface by configuring link-local in the following form:</P>
<p class="docText"><span class="docEmphStrong">ipv6 address FE80::ASN:ID link-local</span></P>
<p class="docText">2) Configure a global address on the loopback interface in the following form:</P>
<p class="docText"><span class="docEmphStrong">ipv6 address 2001:6FC:P::node#/128</span></p>
<p class="docText">3) Protect the global address against DoS attacks using ACLs.</p></td></TR><tr><td class="bottomBorder" align="left" valign="top" colspan="2"><p class="docText">Agree on a routing protocol on the PE-CE interface (preferred is eBGP).</P></TD></tr><tr><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText">Configure the routing protocol on the PE-CE interface.</p></TD><td class="bottomBorder" align="left" valign="top"><p class="docText">Configure the routing protocol on the CE-PE interface.</p></TD></tr></table></P><br>

<a name="ch13lev2sec10"></a>
<h4 class="docSection2Title">Layer 3 MPLS VPN Service Design and Implementation</h4>
<p class="docText">Before enabling IPv6 VPN service for its VPNv4 customers, EuropCom has set up its infrastructure to establish IPv6 MPLS VPN connectivity between 6VPEs (via RRs). This step is described in the section &quot;<a class="docLink" href="ch13lev1sec3.html#ch13lev1sec3">Network Design</a>.&quot; For L1 POP, this task has taken place before any customer service request was received. 6VPE peering for remaining locations is configured only when needed (at the first customer request). All RRs are deployed before offering VPN access to the first EuropCom VPNv6 customer.</p>
<p class="docText"><a class="docLink" href="#ch13table06">Table 13-6</a> reviews the tasks taking place to provide VPNv6 access to a new EuropCom customer.</p>
<a name="ch13table06"></a><p><table cellspacing="0" class="allBorders" border="1" RULES="groups" cellpadding="5"><caption><h5 class="docTableTitle">Table 13-6. Layer 3 VPN Deployment Task List</h5></caption><colgroup><col width="250"><col width="250"></colgroup><thead><tr><th class="rightBorder bottomBorder thead" scope="col" align="left" valign="bottom"><p class="docText"><a name="iddle1589"></a><a name="iddle1917"></a>EuropCom Task</p></th><th class="bottomBorder thead" scope="col" align="left" valign="bottom"><p class="docText">Customer Task</p></th></tr></thead><tr><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText">In L1 POPs, enable 6VPE-IGW IS-ISv6 peering. Note that this is done prior to service deployment.</p></TD><td class="bottomBorder" align="left" valign="top">&nbsp;</td></tr><TR><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText">In L1 POPs, enable RR&lt;-&gt;IGW iBGP peering. Note that this is done prior to service deployment, for the benefit of L2/L3 POP's PEs.</P></TD><td class="bottomBorder" align="left" valign="top">&nbsp;</TD></tr><tr><TD class="rightBorder bottomBorder" align="left" valign="top"><p class="docText">Enable L2/L3 POP's PE&lt;-&gt;RR iBGP peering. Note that this is done once, at first attached VPNv6 customer.</P></TD><td class="bottomBorder" align="left" valign="top">&nbsp;</td></tr><TR><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText">Allocate an IPv6 prefix P to the customer.</p></TD><TD class="bottomBorder" align="left" valign="top"><p class="docText">Defines an IPv6 addressing plan for subdividing P among IPv6 VPN sites, typically P:site#::/n.</p>
<p class="docText">Enable each site for IPv6. This is done using one of the numerous available mechanisms (native, tunnels, and so on).</p></td></tr><TR><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText">Migrate the IPv4 VRF to MP-VRF using <span class="docEmphStrong">vrf upgrade-cli</span> command.</p></TD><td class="bottomBorder" align="left" valign="top">&nbsp;</TD></tr><tr><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText">1) Enable the PE-CE interface by configuring link-local in the following form:</p>
<p class="docText"><span class="docEmphStrong">ipv6 address FE80::ASN:ID link-local</span></p>
<p class="docText">2) Configure a global address on the loopback interface in the following form:</p>
<p class="docText"><span class="docEmphStrong">ipv6 address 2001:6FC::node#/128</span></p>
<p class="docText">2) Configure a global address on the loopback interface in the following form:</p>
<p class="docText"><span class="docEmphStrong">ipv6 address 2001:6FC::node#:/128</span></p>
<p class="docText">3) Protect the global address against DoS attacks using ACLs.</p></td><td class="bottomBorder" align="left" valign="top"><p class="docText">1) Enable the CE-PE interface by configuring link-local in the following form:</p>
<p class="docText"><span class="docEmphStrong">ipv6 address FE80::ASN:ID link-local</span></p>
<p class="docText">2) Configure a global address on the each PE-CE interface in the following form:</p>
<p class="docText"><span class="docEmphStrong">ipv6 address 2001:6FC:P:site#::node#/128</span></P>
<p class="docText">3) Protect the global address against DoS attacks using ACLs.</p></td></tr><TR><td class="bottomBorder" align="left" valign="top" colspan="2"><p class="docText">Agree on a routing protocol on the PE-CE interface (preferred is eBGP).</P></TD></tr><TR><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText">Configure the routing protocol on the PE-CE interface.</p></TD><TD class="bottomBorder" align="left" valign="top"><p class="docText">Configure the routing protocol on the CE-PE interface.</P></td></tr></table></p><BR>

<a name="ch13lev2sec11"></a>
<h4 class="docSection2Title">VPN Internet Access Service Design and Implementation</h4>
<p class="docText">Most EuropCom VPN customers are also accessing the IPv4 Internet, and those getting VPNv6 access will need to access the IPv6 Internet. The design of this service is similar to global IA service. 6VPE routers located in a L1 POP access the Internet gateway natively, whereas 6VPE routers located in L2 and L3 POPs access the IGW (in their closest L1 POP) over 6PE.</P>
<p class="docText">In the latter case, core design (essentially setup of 6VPE/RR/IGW iBGP peering) took place before any customer request for a few locations, but is a preliminary task for enabling other locations, based on customer request. Edge design (PE-CE peering) is always driven by customer request.</P>
<p class="docText">Configuring VPN IA in such 6VPE router involves configuring BGP peering with the IGW, via the IPv6 RR, as illustrated in the configuration in <a class="docLink" href="#ch13ex18">Example 13-18</a>.</p>
<a name="ch13ex18"></a><h5 class="docExampleTitle">Example 13-18. VPN IA Configuration</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><td>


<pre>hostname Nice-PE-VPN !PE#27
..
router bgp 33751
bgp log-neighbor-changes
..
!For VPNv6 to Milan-RR6
address-family vpnv6
 neighbor 100.46.46.1 activate
 neighbor 100.46.46.1 send-community extended
 neighbor 100.47.47.1 activate
 neighbor 100.47.47.1 send-community extended
 bgp dampening 15 750 3000 60
 exit-address-family
<span class="docEmphMark">!Peering to Route-Reflector Milan-RR6 for providing Internet access</span>
<span class="docEmphMark">address-family ipv6</span>
 <span class="docEmphMark">neighbor 100.46.46.1 activate</span>
 <span class="docEmphMark">neighbor 100.46.46.1 send-label</span>
 <span class="docEmphMark">neighbor 100.47.47.1 activate</span>
 <span class="docEmphMark">neighbor 100.47.47.1 send-label</span>
 <span class="docEmphMark">network 2001:6FC:1123:1::/52</span>
 <span class="docEmphMark">network 2001:6FC:1124:1::/52</span>
 <span class="docEmphMark">network 2001:6FC::27/128</span>
 <span class="docEmphMark">bgp dampening 15 750 3000 60</span>
 <span class="docEmphMark">exit-address-family</span></pre><br>

</TD></tr></table></P>
<p class="docText">The corresponding configuration at Milan-RR6 is discussed in the &quot;<a class="docLink" href="ch13lev1sec3.html#ch13lev2sec6">Route Reflector Design</a>&quot; section.</p>
<p class="docText">Note that EuropCom is leaking IPv6 customer site addresses (2001:6FC:1123:1::/56 and 2001:6FC:1124:1::/56) toward the IGW. This is to allow the IGW to send back traffic to these customer sites.</p>
<p class="docText">In addition to the core iBGP configuration, some static routes are configured to allow VPN traffic to leave the VRF to access global resources, and to allow responses from global resources to enter the VRF. This requires a default route in the VRF, pointing to the IGW, and a route in the default table pointing to the VRF (for prefixes owned by this VRF's customer). <a class="docLink" href="#ch13ex19">Example 13-19</a> at Nice-PE-VPN illustrates the static routing configuration setup for EuropCom customers Cisco and IBM.</p>
<a name="ch13ex19"></a><h5 class="docExampleTitle">Example 13-19. Static Routing Configuration for IA on VPN PE</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>hostname Nice-PE-VPN !PE#27
..
<span class="docEmphMark">!Routes for outbound traffic from each VRF to Milan-IGW</span>
ipv6 route vrf Cisco-Nice ::/0 2001:6FC::1:0:0:1 nexthop-vrf default
ipv6 route vrf IBM-Nice ::/0 2001:6FC::1:0:0:1 nexthop-vrf default
<span class="docEmphMark">!Routes for inbound traffic from Milan-IGW to VRF</span>
ipv6 route 2001:6FC:1123:1::/52 Serial0/0 nexthop-vrf  Cisco-Nice
ipv6 route 2001:6FC:1124:1::/52 Serial1/0 nexthop-vrf IBM-Nice</pre><br>

</td></tr></table></p>
<p class="docText">In summary, to enable IA within a VPN, EuropCom has to perform the steps listed in <a class="docLink" href="#ch13table07">Table 13-7</a>.</p>
<a name="ch13table07"></a><p><table cellspacing="0" class="allBorders" border="1" RULES="all" cellpadding="4"><caption><h5 class="docTableTitle">Table 13-7. Layer 3 VPN IA Deployment Task List</H5></caption><colgroup><col width="275"><col width="275"></colgroup><thead><tr><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">EuropCom Task (at PE)</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Customer Task (at CE)</p></th></TR></thead><tr><TD class="docTableCell" align="left" valign="top"><p class="docText">Core design (PE&lt;-&gt;PE) if not done already for this customer PE of attachment:</P>
<p class="docText">iBGP 6PE peering to RR</p>
<p class="docText">iBGP RR peering to 6PE</P></td><td class="docTableCell" align="left" valign="top">&nbsp;</TD></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText">Leak customer prefix into iBGP:</p>
<p class="docText"><span class="docEmphStrong">address-family ipv6</span></p>
<p class="docText"><span class="docEmphMark"><span class="docEmphStrong">network 2001:6FC:P:site#::/n</span></span></P></td><td class="docTableCell" align="left" valign="top">&nbsp;</TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Configure a static route from VRF to IGW:</p>
<p class="docText"><span class="docEmphStrong">ipv6 route vrf &lt;vrf name&gt; ::/0</span></p>
<p class="docText"><span class="docEmphStrong">2001:6FC::1:0:0:1 nexthop-vrf default</span></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Configure a default route to 6VPE:</P>
<p class="docText"><span class="docEmphStrong">ipv6 route ::0/0 &lt;interface to 6VPE&gt;</span></p></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Configure a static route from default to VRF:</p>
<p class="docText"><span class="docEmphStrong">ipv6 route 2001:6FC:P:site#::/n &lt;VRF</span></p>
<p class="docText"><span class="docEmphStrong">interface&gt; nexthop-vrf &lt;vrf name&gt;</span></p></td><td class="docTableCell" align="left" valign="top">&nbsp;</td></tr></table></p><br>
<p class="docText">Note that no configuration is necessary at the IGW, other than peering with RRs over 6PE iBGP (done once at core design phase) and leaking a single loopback IPv6 address. This is shown in <a class="docLink" href="#ch13ex20">Example 13-20</a>.</p>
<a name="ch13ex20"></a><h5 class="docExampleTitle">Example 13-20. IGW Configuration Example</h5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>hostname Milan-IGW !#1
..
router bgp 33751
 bgp log-neighbor-changes
..
 address-family ipv6
 neighbor 100.46.46.1 activate
 neighbor 100.46.46.1 send-label
 network 2001:6FC:0:0:1::1/128
!
 neighbor 100.47.47.1 activate
 neighbor 100.47.47.1 send-label
 network 2001:6FC:0:0:1::1/128</pre><br>

</TD></tr></table></P>

<a name="ch13lev2sec12"></a>
<H4 class="docSection2Title">Carrier's Carrier Service Design</h4>
<p class="docText"><a name="iddle1578"></a><a name="iddle1585"></a><a name="iddle1763"></a><a name="iddle1906"></a><a name="iddle1913"></a>This service provides VPN access to a customer service provider, so this service needs to exchange routes and send traffic over the EuropCom MPLS backbone. The only difference from a regular PE is that it provides MPLS-to-MPLS forwarding on the CsC-CE to CsC-PE interface, rather than IP-to-MPLS forwarding.</P>
<p class="docText">The EuropCom design of this service mandates that the CsC-CEs are &quot;IPv6 enabled.&quot; The peering between CsC-CE and CsC-PE is performed over link-locals, using the previously defined address format. <a class="docLink" href="#ch13ex21">Example 13-21</a> illustrates the CsC-6VPE to CsC-CE peering, between EuropCom and yyCom, using IPv6 CsC.</p>
<a name="ch13ex21"></a><h5 class="docExampleTitle">Example 13-21. CsC 6VPE Configuration Example</H5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><td>


<pre>hostname Paris-CSC-PE !PE#77
..
router bgp 33751
..
 address-family ipv6 vrf yyCom
 neighbor FE80::866C:99%Serial0/0 remote-as 34412
 neighbor FE80::866C:99%Serial0/0 activate
 <span class="docEmphMark">neighbor FE80::866C:99%Serial0/0 send-label</span>
 neighbor FE80::866C:99%Serial0/0 maximum-prefix 500</pre><br>

</td></TR></table></p>
<p class="docText">For CsC-6PE, the main difference is the lack of VRFs configured, and the fact that MP-BGP peering is using address family IPv6 with label, as illustrated in <a class="docLink" href="#ch13ex22">Example 13-22</a>.</p>
<a name="ch13ex22"></a><H5 class="docExampleTitle">Example 13-22. CsC 6PE Configuration Example</H5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>router bgp 33751
..
neighbor FE80::916C:100%Serial1/0 remote-as 37228
address-family ipv6
 neighbor FE80::916C:100%Serial1/0 activate
 <span class="docEmphMark">neighbor FE80::916C:100%Serial1/0 send-label</span>
 neighbor FE80::916C:100%Serial1/0 maximum-prefix 500</pre><br>

</TD></tr></table></p>


<a href="22971536.html"><img src="images/pixel.jpg" alt="" width="1" height="1" border="0"></a></TD></TR></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch13lev1sec3.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch13lev1sec5.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
</body></html>