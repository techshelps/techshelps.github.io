<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>BGP-MPLS IPv6 VPNs: A PE-Based VPN Solution</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch07lev1sec2.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch07lev1sec4.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><TR><TD valign="top"><a name="ch07lev1sec3"></a>
<H3 class="docSection1Title" id="507906-898">BGP-MPLS IPv6 VPNs: A PE-Based VPN Solution</h3>
<p class="docText">BGP-MPLS VPNs are specified in the Internet Draft draft-ietf-l3vpn-rfc2547bis, by E. Rosen and Y. Rekhter. This solution represents an implementation of the PE-based VPN model. Because this type of VPN technology has become by far the most popular technology for deploying VPN in a peer-to-peer model, the remainder of the chapter focuses on its application to IPv6.</p>
<p class="docText">The following terminology is used for the remainder of this chapter:</p>
<ul><li><p class="docText"><span class="docEmphStrong">6VPE router</span> PE router providing BGP-MPLS IPv6 VPN service over an IPv4-based MPLS core. It is basically a VPNv6 PE, dual stack (IPv4+IPv6) that implements 6PE concepts on the core-facing interfaces.</p></li><li><p class="docText"><span class="docEmphStrong">VPNv6 addresses</span> A VPNv6 address is a 24-byte identifier, beginning with an 8-byte route distinguisher (RD) and ending with a 16-byte IPv6 address. Sometimes it is called an VPN IPv6 address.</p></li><li><p class="docText"><span class="docEmphStrong">VPNv6 address family</span> The Address Family Identifier (AFI) identifies a particular network layer protocol and the Subsequent AFI (SAFI) provides additional information. The AFI IPv6, SAFI VPN (AFI=2, SAFI=128) is referred to as a VPNv6 address family; similarly, AFI IPv4, SAFI VPN is the VPNv4 address family. Sometimes it is called a VPN IPv6 address family.</p></LI><li><p class="docText"><span class="docEmphStrong">VRF (virtual routing and forwarding)</span> A VPN routing and forwarding instance in a PE.</p></LI><LI><p class="docText"><span class="docEmphStrong">VRF table</span> A routing and a forwarding table associated to a VRF. This is a customer-specific table, enabling the PE router to maintain independent routing states for each customer.</p></li></ul>
<p class="docText">In principle, no difference exists between IPv4 VPNs, as described in &quot;BGP-MPLS IP VPNs,&quot; and IPv6 VPNs, as specified in &quot;BGP-MPLS IP VPN Extension for IPv6 VPN&quot; (Internet Draft, draft-ietf-l3vpn-bgp-ipv6). Similar to IPv4, MP-BGP is the centerpiece of the MPLS VPNv6 architecture. It is used to distribute IPv6 routes over the SP backbone, with the same set of mechanisms to deal with overlapping addresses, redistribution policies, and scalability issues. Even though we do not expect overlapping address space in IPv6, addresses are still prepended with an RD. A new Network Layer Reachability Information (NLRI) 3-tuple format &lt;length, IPv6-prefix, label&gt; is defined to distribute these routes using MP-BGP. The extended community attribute (Route-Target) is used to control redistribution of routing information, by tagging exported routes and filtering imported ones. For scalability, you can use route reflectors to concentrate routing paths, and avoid a full PE mesh. Similar to IPv4, BGP features such as route refresh, automatic route filtering, and outbound route filtering help reduce the number of routes held in each PE.</p>
<p class="docText">The Internet Draft &quot;BGP-MPLS IP VPN Extension for IPv6 VPN&quot; focuses solely on the following differences between IPv4 and IPv6:</P>
<ul><li><p class="docList">Creation of a new MP-BGP VPNv6 address family, and specification of VPNv6 address format</p></li><LI><p class="docList">Specification of a new VPN IPv6 NLRI</P></LI><li><p class="docList">Specification of the BGP next-hop encoding in the case of an IPv4-based MPLS core</p></li></ul>
<p class="docText"><a name="iddle1143"></a><a name="iddle1688"></a>A VPNv6 address is a 16-byte IPv6 address, prepended with an 8-byte RD, to form a 24-byte address. As in VPN IPv4, the VPNv6 prefix (network portion of the address) is only meaningful within MP-BGP, and only the IPv6 part of this prefix is kept when redistributed into IPv6 routing protocols.</p>
<p class="docText"><a class="docLink" href="#ch07ex01">Example 7-1</a> shows the VPNv6 prefix 2001:100::/64.</p>
<a name="ch07ex01"></a><h5 class="docExampleTitle">Example 7-1. Showing BGP VPNv6 Address</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>sa14-72b# <span class="docEmphStrong">show bgp vpnv6 unicast all  2001:100::/64</span>
<span class="docEmphMark">BGP routing table entry for [100:1]2001:100::/64, version 15</span>
Paths: (1 available, best #1, table red)
  Advertised to update-groups:
    2001:100::72a (FE80::A8BB:CCFF:FE01:F500) from 2001:100::72a (200.14.14.1)
      Origin incomplete, metric 0, localpref 100, valid, external, best
      Extended Community: RT:100:1</pre><br>

</td></tr></table></P>
<a name="ch07note01"></a><div class="docNote"><p class="docNoteTitle">Note</P>

<p class="docText">The notation RD:IPv4-prefix, used for VPNv4 prefixes, cannot be used for VPNv6 prefixes because it conflicts with the IPv6 prefix notation. For instance, 100:1:2001::/64 could be interpreted as an IPv6 prefix or a VPNv6 prefix with an RD of 100:1. For that reason, VPNv6 prefixes use the notation [RD]IPv6-prefix.</P>
</div><BR>
<p class="docText">In the latter part of &quot;BGP-MPLS IP VPN Extension for IPv6 VPN&quot; (draft-ietf-l3vpn-bgp-ipv6), transitioning and coexistence aspects are covered, with emphasis on the 6PE approach applied to VPNv6. The main aspects of this approach have been discussed at length in <a class="docLink" href="ch03.html#ch03">Chapter 3</a> (in the &quot;<a class="docLink" href="ch03lev1sec4.html#ch03lev3sec21">IPv6 over 6PE</a>&quot; section), and the implications and mechanisms are the same here.</P>
<p class="docText">Other aspects of coexistence, in particular interprovider and Carrier Supporting Carrier (CSC) topologies, are specific to BGP-MPLS IPv6 VPN. For instance, the link between Autonomous System Boundary Routers (ASBRs) might support IPv4 only, IPv6 only, or both, independently of the address family being transported. This creates a new set of variations in the list of cases listed in &quot;BGP/MPLS IP VPNs&quot; (draft-ietf-l3vpn-rfc2547bis) section 10 (Multi-AS backbone).</p>
<p class="docText">The &quot;<a class="docLink" href="ch07lev1sec4.html#ch07lev1sec4">Topology Examples</a>&quot; section of this chapter provides examples of both interprovider topology and Internet access topology.</p>
<a name="ch07lev2sec10"></a>
<h4 class="docSection2Title">Routing Table Segregation</h4>
<p class="docText">The SP network provides connectivity between &quot;same-customer&quot; sites, while isolating customers from each other. The keystone of the PE-based VPN model is the isolation between routing tables, achieved at two levels:</p>
<ul><li><p class="docText"><span class="docEmphStrong">Isolation between customers</span> Customer-specific routing tables (VRF tables) are used on the edge routers. At any particular edge router, one VRF routing table is associated with each site connected to that router, and entries from one VRF table do not leak to another, unless explicitly configured to do so.</p></li><li><p class="docText"><span class="docEmphStrong">Isolation between core and edge routing</span> Provider's routes, used by PE routers to reach each other over the provider backbone are kept separated from customer's routes. As a matter of fact, most provider core routers (P-routers) only store these routes and never see customer routes.</p></li></UL>
<p class="docText">To achieve routing segregation, a routing tunnel must be established between PE routers to exchange customer routes. This routing tunnel is transparent to the core routers. This is achieved using MP-BGP between the PE routers. In addition, a forwarding tunnel must be available throughout the provider core network, so that datagrams can be forwarded by P-routers, without requiring the P-routers to keep routing tables for each VPN. In theory, the tunneling mechanism chosen for traffic forwarding could be any of the following kinds: GRE, IPsec, L2TP, MPLS, and so forth. In practice, MPLS has been used for the most part in deployment so far. L2TP has been specified for P-networks that do not use MPLS, and it is deployed in few environments. <a class="docLink" href="#ch07fig01">Figure 7-1</a> illustrates how routing segregation is achieved.</p>
<a name="ch07fig01"></a><p><center>
<H5 class="docFigureTitle">Figure 7-1. Routing Tables in BGP-MPLS IPv6 VPN Model</H5>
<p class="docText"><div class="v1"><a target="_self" href="images/07fig01_alt.jpg">[View full size image]</a></div><img border="0" alt="" id="158039035251" width="500" height="259" SRC="images/07fig01.jpg"></p>
</center></p><br>
<p class="docText">In <a class="docLink" href="#ch07fig01">Figure 7-1</a>, the following routing tables are being used at PE1:</p>
<UL><li><p class="docList">A set of customer-specific IPv6 routing tables (red and blue) contains customer routes (customer#1 and customer#2, respectively). Each of these routing tables contains routes received from the CE routers as well as routes from remote sites in the same VPN. For example, the content of table red in node PE1 is shown in <a class="docLink" href="#ch07ex02">Example 7-2</a>.</p><a name="ch07ex02"></a><h5 class="docExampleTitle">Example 7-2. IPv6 VRF Table red</h5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><TD>


<pre>PE1#<span class="docEmphStrong">show ipv6 route vrf red</span>
IPv6 Routing Table - red - 10 entries
C   2001:100:1:1000::/64
     via Serial0/0, directly connected
B   2001:100:1:1000::/56
     via 200.14.14.1
B   2001:100:1:2000::/56
     via 200.10.10.1%Default-IP-Routing-Table, indirectly connected</pre><br>

</td></tr></table></p><p class="docList">Note that these customer-specific tables are also referred to as VRF tables.</p></li><li><p class="docList">A default routing table that is exclusively used to reach routers inside the provider network. It is an IPv4 table if the MPLS core is IPv4 based, and IPv6 otherwise. For example, the content of the default table (IPv4) in node PE1 is shown in <a class="docLink" href="#ch07ex03">Example 7-3</a>.</p><a name="ch07ex03"></a><h5 class="docExampleTitle">Example 7-3. IPv4 Default Table</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>PE1#<span class="docEmphStrong">show ip route</span>
     200.10.10.0/32 is subnetted, 1 subnets
i L1    200.10.10.1 [115/30] via 40.1.1.3, Serial1/0
     31.0.0.0/24 is subnetted, 1 subnets
i L1    31.1.1.0 [115/30] via 40.1.1.3, Serial1/0
     200.11.11.0/32 is subnetted, 1 subnets
C       200.11.11.1 is directly connected, Loopback0</pre><br>

</TD></TR></table></P></LI><LI><p class="docList">A BGP table, which contains entries from all the customer-specific IPv6 routing tables. An example of the BGP table in node PE1 is shown in <a class="docLink" href="#ch07ex04">Example 7-4</a>.</p><a name="ch07ex04"></a><h5 class="docExampleTitle">Example 7-4. VPNv6 BGP Table</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>PE1#<span class="docEmphStrong">show bgp vpnv6 unicast all</span>
   Network          Next Hop            Metric LocPrf Weight Path
Route Distinguisher: 100:1 (default for vrf red)
*  2001:100:1:1000::/562001:100:1:1000::72a0          0 200 ?
*&gt;                 ::0          32768 ?
*&gt;i2001:100:1:2000::/56::FFFF:200.10.10.1
Route Distinguisher: 200:1 (default for vrf blue)
*&gt; 2001:100:2:1000::/56::0         32768 ?
*&gt; 2001:100:2:2000::/56::FFFF:200.10.10.10         32768 ?</pre><br>

</td></tr></table></p></li></ul>
<p class="docText">A BGP session is established between edge routers, and entries from the BGP table are carried over that session. The following steps, illustrated in <a class="docLink" href="#ch07fig01">Figure 7-1</a>, allow route distribution between sites:</P>
<a name="ch07pro01"></a>





<table border="0" class="docText"><tr><td width="25" valign="top"><div class="docText"><B>1. </b></div></TD><td><div class="docText">The CE router (CE1) announces a customer prefix to the provider router (PE1). Although this entry belongs to the default routing table at the CE, it is installed in a VRF IPv6 table (red) at the PE. The interface on which these entries are received determines into which table they should get installed.<br><br>
</div></td></TR><tr><td width="25" valign="top"><div class="docText"><b>2. </b></div></td><TD><div class="docText">PE1 redistributes this entry into its MP-iBGP table, after prefixing it with the RD referencing the VRF table the entry is coming from (RD 100:1 for entries from table red above).<BR><BR>
</div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>3. </b></div></td><td><div class="docText"><a name="iddle1018"></a><a name="iddle1142"></a><a name="iddle1687"></a><a name="iddle1736"></a><a name="iddle1833"></a><a name="iddle1834"></a>Once in the BGP table, the entry is announced to the BGP peer at PE2.<br><br>
</div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>4. </b></div></TD><TD><div class="docText">Once installed in the PE2 BGP table, the entry is redistributed into one or more VRF tables, after stripping off the RD. Note that the RD is used solely to distinguish entries in BGP, not as a policy mechanism to determine which entry from which VRF table is to be redistributed in which VRF table on the remote PE. Instead, BGP communities (route targets) are used for that purpose.<BR><BR>
</div></TD></tr><tr><td width="25" valign="top"><div class="docText"><b>5. </b></div></td><td><div class="docText">From the VRF table, the entry is finally redistributed into the customer site (customer#1, site#2).<br><br>
</div></td></tr></table>

<a name="ch07lev2sec11"></a>
<h4 class="docSection2Title">Routing Protocols for BGP-MPLS IPv6 VPN</h4>
<p class="docText">For those unfamiliar with MPLS-VPN, a good book to start with is <span class="docEmphasis">MPLS and VPN Architectures</span> by Ivan Pepelnjak and Jim Guichard. That book provides enough background to appreciate fully the following two sections.</P>
<p class="docText">The transition to IPv6 is expected to lead to a long period of coexistence between IPv4 and IPv6. An attractive method for deploying MPLS-VPN IPv6 takes advantage of this coexistence by leveraging an existent MPLS IPv4 core network. This approach, referred to as <span class="docEmphasis">6VPE</span>, is similar to the one described in <a class="docLink" href="ch03.html#ch03">Chapter 3</a> in the section &quot;<a class="docLink" href="ch03lev1sec4.html#ch03lev3sec21">IPv6 over 6PE</a>.&quot;</p>
<p class="docText"><a class="docLink" href="#ch07fig02">Figure 7-2</a> lists the most important aspects of the 6VPE architecture.</p>
<a name="ch07fig02"></a><P><center>
<H5 class="docFigureTitle">Figure 7-2. Simple 6VPE Architecture</h5>
<p class="docText"><div class="v1"><a target="_self" href="images/07fig02_alt.jpg">[View full size image]</a></div><img border="0" alt="" id="158039035251" width="500" height="331" SRC="images/07fig02.jpg"></p>
</center></p><br>
<p class="docText"><a name="iddle1016"></a><a name="iddle1139"></a><a name="iddle1661"></a><a name="iddle1663"></a><a name="iddle1684"></a>The CE routers are connected to the provider's backbone via PE routers. The PE routers are connected via P-routers. P-routers are unaware of VPN routes, and in the 6VPE case may support only IPv4. Only PE routers perform VPN-specific tasks. For 6VPE, the PE routers are dual-stack (IPv4 and IPv6) routers.</P>
<p class="docText">The routing component of the VPN operation is divided into core routing and edge routing. The core routing, which involves PE routers and P-routers is typically performed by an IPv4 IGP such as OSPFv2 or IS-IS. In the simple topology illustrated in <a class="docLink" href="#ch07fig02">Figure 7-2</a>, the IGP distributes only routes internal to the provider's AS. The core routing enables connectivity among P- and PE routers.</p>
<p class="docText">Edge routing takes place in two directions: routing between PE pairs and routing between a PE and a CE. The former is achieved via Multiprotocol Internal Border Gateway Protocol (MP-iBGP) using a specific address family (VPNv6). It distributes routes learned from CEs via the PE-CE routing, using appropriate route export policies at the ingress PE router and appropriate route import policies at the egress PE router.</p>
<p class="docText">Routing between the CE and its PE is achieved using a routing protocol that is VRF aware. On Cisco routers, at the time of this writing, only static routes, and eBGP, are VRF aware. In the example shown in <a class="docLink" href="#ch07fig02">Figure 7-2</a>, eBGP is used between the CE (CE1) and the PE (PE1). At the same time, the CE runs an IPv6 IGPfor instance, OSPFv3 or IS-IS for IPv6within the VPN site (site1). The CE redistributes IGP routes into MP-eBGP address family IPv6. At the PE, these routes are installed in the VRF red, and forwarded to remote PEs (PE2), according to export policies defined for this VRF.</p>

<a name="ch07lev2sec12"></a>
<h4 class="docSection2Title">BGP Next Hop</H4>
<p class="docText">When announcing a prefix (using the MP_REACH_NLRI attribute), MP-BGP running on one PE inserts a BGP next hop in the update message sent to a remote PE. This next hop is either propagated from the received update (for instance, if the PE is a route reflector), or it is the address of the PE sending the update message (egress PE). For the VPNv6 address family, it has to be a VPNv6 address, regardless of the nature of the network between the PE speakers. Because the RD has no significance (the address is not part of any VPN), it is just set to zero. If the provider network is a native IPv6 network, the remaining part of the next hop is the IPv6 address of the egress PE. Otherwise, it is an IPv4 address, masqueraded into an IPv6-mapped address (::FFFF:IPv4-address).</P>
<p class="docText"><a class="docLink" href="#ch07ex05">Example 7-5</a> illustrates the case of a 6VPE next hop.</P>
<a name="ch07ex05"></a><h5 class="docExampleTitle">Example 7-5. VPNv6 Configuration Example Using IPv4 Next Hop</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>interface Loopback0
 ip address 200.11.11.1 255.255.255.255
!
router bgp 100
 neighbor 200.10.10.1 remote-as 100
 neighbor 200.10.10.1 update-source Loopback0
!
 address-family vpnv6
 neighbor 200.10.10.1 activate
 neighbor 200.10.10.1 send-community extended
 exit-address-family</pre><br>

</td></tr></table></p>
<p class="docText"><a name="iddle1012"></a><a name="iddle1137"></a><a name="iddle1478"></a><a name="iddle1682"></a>By default, the next hop advertised will be the VPNv6 address:</p>
<div class="docText"><pre>[0:0]::FFFF:200.11.11.1</pre></div><br>
<p class="docText">Note that it is a 192-bit address in the following form:</p>
<div class="docText"><pre>[RD]::FFFF:IPv4-address.</pre></div><br>
<p class="docText">In this particular case, only 32 bits are significant out of 192 bits sent on the wire.</p>
<p class="docText"><a class="docLink" href="#ch07ex06">Example 7-6</a> shows that BGP configuration can be used when peering takes place over a native IPv6 network.</P>
<a name="ch07ex06"></a><H5 class="docExampleTitle">Example 7-6. VPNv6 Configuration Example Using an IPv6 Next Hop</H5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><td>


<pre>router bgp 100
 neighbor 2001:100:1:1000::72d remote-as 100
!
 address-family vpnv6
 neighbor 2001:100:1:1000::72d activate
 neighbor 2001:100:1:1000::72d send-community extended</pre><br>

</td></tr></table></p>
<p class="docText">By default, the next hop advertised is the VPNv6 address:</p>
<div class="docText"><pre>[0:0]2001:100:1:1000:0:0:0:72b</pre></div><br>
<p class="docText">Note that it is a 192-bit address in the following form:</p>
<div class="docText"><pre>[RD]IPv6-address.</pre></div><br>
<p class="docText">Even though current Cisco routers do not provide support for LDPv6, the preceding example can still be deployed, in the interprovider VPN case, when the two providers exchange VPNv6 routes over an IPv6 link using MP-eBGP. See the section &quot;<a class="docLink" href="ch07lev1sec4.html#ch07lev2sec24">Interprovider VPNs</a>&quot; later in the chapter for details.</p>
<p class="docText">When the BGP VPNv6 peers share a common subnet, the MP_REACH_NLRI attribute contains a link-local address next hop, in addition to the global-address next hop. This will typically happen in inter-AS topology, scenario B (see the section &quot;<a class="docLink" href="ch07lev1sec4.html#ch07lev2sec24">Interprovider VPNs</a>&quot; in the topology examples later in this chapter), when AS boundary routers are facing each other. In that case, the link-local next hop is used locally, and the global next hop is eventually re-advertised by BGP.</p>

<a name="ch07lev2sec13"></a>
<h4 class="docSection2Title">Building the Label Stack</H4>
<p class="docText"><a class="docLink" href="#ch07fig03">Figure 7-3</a> shows how the label stack is computed by combining information obtained from routing and label distribution protocols.</p>
<a name="ch07fig03"></a><p><center>
<H5 class="docFigureTitle">Figure 7-3. Building the Label Stack for 6VPE</H5>
<p class="docText"><div class="v1"><a target="_self" href="images/07fig03_alt.jpg">[View full size image]</a></div><img border="0" alt="" id="158039035251" width="500" height="413" SRC="images/07fig03.jpg"></p>
</center></p><br>
<p class="docText">The idea is that ingress PE router (PE2) obtains two separate labels, and combines them into a label stack, which it can impose when forwarding traffic to a given VPN IPv6 destination. Each of these labels is learned via a specific mechanism, and has a specific role in the LSP. The outer label (Lc in <a class="docLink" href="#ch07fig03">Figure 7-3</a>) is used to label switch packets from the ingress PE (PE2) to the egress PE (PE1). This label is obtained through a label distribution protocol, such as Label Distribution Protocol (LDP) or ReSerVation Protocol (RSVP). The inner label (L1 in <a class="docLink" href="#ch07fig03">Figure 7-3</a>) is used to reach the appropriate CE router (CE1) from the egress PE (PE1). MP-iBGP distributes this label.</p>
<p class="docText">The BGP &quot;next hop&quot; (described in the previous section) is the keystone for building the label stack, because it is used to tie the inner and the outer label together at the ingress PE. A recursion is performed to combine the two labels: the prefix (net1) is reachable via PE1, using label L1, and PE1 itself is reachable via P2, using label Lc. This recursion takes place as soon as labels are available, and the resulting label stack (Lc+L1) is stored in the Forwarding Information Base (FIB).</P>
<p class="docText">In the case of 6VPE (IPv6 MPLS VPN over an IPv4 core), a cross-table resolution (IPv6, then IPv4) is performed to build the label stack, just like for 6PE.</p>
<p class="docText"><a name="iddle1011"></a><a name="iddle1013"></a><a name="iddle1133"></a><a name="iddle1365"></a><a name="iddle1678"></a>The outer label and inner label are sometimes referred to as &quot;BGP next hop&quot; label and VPN label, respectively.</p>
<a name="ch07note02"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">There is no mechanism to force MP-iBGP to follow the same labeled switching path as IPv6 traffic. In fact, for scalability reasons, the MP-iBGP control traffic is moved away from the Label Switching Path and directed to concentrators such as route reflectors (see the &quot;<a class="docLink" href="#ch07lev2sec16">Scaling IPv6 VPN</a>&quot; section later in the chapter). MP-iBGP control traffic can take advantage of the labeled paths but does not need to. On the other hand, IPv6 traffic between VPN sites requires labeled paths to traverse P-routers (because these are unaware of IPv6 addresses).</p>
<p class="docText">This is a fundamental difference from other tunneling techniques, in which the routing updates are sent inside the forwarding tunnel. Should the tunnel break, these updates stop, and edge routers remove corresponding entries from their routing table.</P>
<p class="docText">With VPNv6 (and VPNv4), the labeled path may be broken, while the path between PEs is still usable. The MP-iBGP session will keep exchanging IPv6 routes even though packets for corresponding destinations will not be able to traverse the core network. The result is that the traffic is black holed.</P>
</div><BR>

<a name="ch07lev2sec14"></a>
<h4 class="docSection2Title">Forwarding in BGP-MPLS IPv6 VPN</h4>
<p class="docText">Upon receiving IPv6 traffic from one customer site, the ingress PE router (PE2) will MPLS tunnel IPv6 VPN packets over the backbone toward the egress PE router (PE1) identified as the BGP next hop. <a class="docLink" href="#ch07fig04">Figure 7-4</a> shows the forwarding tables (IPv6 and MPLS) built as the result of the label distribution across P- and PE routers.</p>
<a name="ch07fig04"></a><p><center>
<h5 class="docFigureTitle">Figure 7-4. MPLS Forwarding Tables</h5>
<p class="docText"><div class="v1"><a target="_self" href="images/07fig04_alt.jpg">[View full size image]</a></div><img border="0" alt="" id="158039035251" width="500" height="218" SRC="images/07fig04.jpg"></p>
</center></p><br>
<p class="docText">In <a class="docLink" href="#ch07fig04">Figure 7-4</a>, the network net1 (2001:100:1:1000::/56) is announced by iBGP from PE1 to PE2, with label L1=24. At the same time, LDP is announcing PE1 reachability to PE2 with label Lc=18. The complete label stack (18, 24) for reaching net1 is shown in <a class="docLink" href="#ch07ex07">Example 7-7</a>, via the <span class="docEmphStrong">show ipv6 cef vrf red</span> command. The label forwarding table at routers P2, P1, and PE1 is shown in <a class="docLink" href="#ch07ex07">Example 7-7</a> via the <span class="docEmphStrong">show mpls forwarding</span> command.</p>
<a name="ch07ex07"></a><h5 class="docExampleTitle">Example 7-7. Showing MPLS Labels Along the LSP</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><TD>


<pre>PE2#<span class="docEmphStrong">show ipv6 cef vrf red</span>
2001:100:1:1000::/56
  nexthop 31.1.1.1 Ethernet0/0 label 18 24
P2#<span class="docEmphStrong">show mpls forwarding</span>
Local  Outgoing  Prefix         Outgoing   Next Hop
Label  Label                    interface
18     16        200.11.11.1/3  Et0/0      30.1.1.3
P1#<span class="docEmphStrong">show mpls forwarding</span>
Local  Outgoing  Prefix         Outgoing   Next Hop
Label  Label                    interface
16     Pop Label 200.11.11.1/32 Et0/0      40.1.1.2
PE1#<span class="docEmphStrong">show mpls forwarding</span>
Local  Outgoing   Prefix                    Outgoing   Next Hop
Label  Label                                interface
24     No Label   2001:100:1:1000::/56[V]   Et0/0      FE80::A8BB:CCFF:FE01:F500</pre><BR>

</TD></TR></table></P>
<p class="docText"><a class="docLink" href="#ch07fig05">Figure 7-5</a> shows the MPLS encapsulation taking place at the ingress PE, and the label swapping occurring at P-routers.</p>
<a name="ch07fig05"></a><p><center>
<h5 class="docFigureTitle">Figure 7-5. MPLS VPNv6 Forwarding Operation</h5>
<p class="docText"><div class="v1"><a target="_self" href="images/07fig05_alt.jpg">[View full size image]</a></div><img border="0" alt="" id="158039035251" width="500" height="263" SRC="images/07fig05.jpg"></p>
</center></p><br>
<p class="docText">In <a class="docLink" href="#ch07fig05">Figure 7-5</a>, an IPv6 packet for 2001:100:1:1000::1 is being encapsulated at PE2 and sent to PE1, via P2 and P1. MPLS packet traces are enabled (using the <span class="docEmphStrong">debug mpls packet</span> command) at P2, P1, and PE1, and you can see the label stack being received and transmitted at each router.</p>
<p class="docText"><a name="iddle1696"></a><a name="iddle1709"></a>Under normal operation, a P-router along the forwarding path does not look inside the frame beyond the first label. It either swaps the incoming label with an outgoing one, or removes it (for instance, P1 in <a class="docLink" href="#ch07fig05">Figure 7-5</a>) if the next router is a PE. The latter action is called <span class="docEmphasis">penultimate hop popping</span>. The remaining label (L1 in the example) has a side function (other than identifying the egress PE interface toward the customer site). It also hides the protocol version (IPv6) from the P-router, which would need to otherwise forward an IPv6 packet. The following output, shown in <a class="docLink" href="#ch07ex08">Example 7-8</a>, via <span class="docEmphStrong">debug mpls packet enabled all</span> along the LSP, illustrates the label swapping happening at each router.</p>
<a name="ch07ex08"></a><h5 class="docExampleTitle">Example 7-8. Tracing MPLS IPv6 Packets Along the LSP</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><td>


<pre>P2#<span class="docEmphStrong">debug mpls packet</span>
<span class="docEmphasis">00:07:25: MPLS les: Et1/0: rx: Len 122 Stack {18 0 63} {24 0 63} - ipv6 data</span>
<span class="docEmphasis">00:07:25: MPLS les: Et0/0: tx: Len 122 Stack {16 0 62} {24 0 63} - ipv6 data</span>
P1#<span class="docEmphStrong">debug mpls packet</span>
<span class="docEmphasis">00:07:25: MPLS les: Et1/0: rx: Len 122 Stack {16 0 62} {24 0 63} - ipv6 data</span>
<span class="docEmphasis">00:07:25: MPLS les: Et0/0: tx: Len 118 Stack {24 0 61} - ipv6 data</span>
PE1#<span class="docEmphStrong">debug mpls packet</span>
00:07:25: MPLS les: Et1/0: rx: Len 118 Stack {24 0 61} - ipv6 data</pre><br>

</TD></TR></table></p>
<a name="ch07note03"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">You may have noticed that a P-router is ignorant about IPv6 VPN routes. In fact, with 6VPE, it is an IPv6 ignoramus. The IPv6 header remains hidden under one or more MPLS labels. An interesting issue arises when the P-router receives an MPLS-encapsulated IPv6 packet that cannot be delivered. This scenario can occur if the Time To Live (TTL) in the label expires or if the maximum transmission unit (MTU) is exceeded. The P-router then has to expose the IPv6 header, build an ICMPv6 message, and send it to the source of the original packet. At a minimum, this process requires the P-router to be capable of building an ICMPv6 message; otherwise, it would have to drop silently the undeliverable MPLS-encapsulated IPv6 packet. However, two more issues must be solved:</p>
<ul><LI><p class="docList">The IPv6 source address found in the packet belongs to a VPN unknown to the P-router and cannot be IPv6 routed from there.</p></li><li><p class="docList">The P-router must select an IPv6 source address to use in its ICMPv6 message.</p></LI></UL>
<p class="docText">RFC 3032 describes in section 2.3.2 (&quot;Tunneling Private Addresses through a Public Backbone&quot;) a mechanism applicable to IPv6 similar to IPv4. The original undeliverable packet carried a label stack that can be imposed to the ICMPv6 message, to enable it to reach the egress PE. The egress PE knows how to reach the private IPv6 network so it can route the packet to the destination. Amazingly, in most cases, the ICMPv6 datagram turns back and traverses the MPLS backbone again before reaching its destination.</P>
<p class="docText">For selecting an IPv6 source address, source address selection can be used. However, the P-router may not have any IPv6 address, and even when it has one, it does not belong to the private space of the destination of the packet. In that case, it sets the source address to the v4-mapped address built from the v4 address configured on the incoming interface. See an example of such ICMPv6 packet in the section &quot;<a class="docLink" href="ch07lev1sec4.html#ch07lev2sec22">Hub and Spoke</a>.&quot;</p>
</div><br>

<a name="ch07lev2sec15"></a>
<h4 class="docSection2Title">VRF Concepts and IPv6 Implementation</h4>
<p class="docText"><a name="iddle1021"></a><a name="iddle1145"></a><a name="iddle1690"></a><a name="iddle2061"></a>VRF concepts are discussed at length in <span class="docEmphasis">MPLS and VPN Architectures</span> by Ivan Pepelnjak and Jim Guichard. However, with the introduction of IPv6 VPNs, some of these concepts deserve clarification. A VRF is defined as a virtual routing and forwarding entity, which ties up to a private &quot;customer-specific&quot; routing and forwarding table (RIB and FIB, respectively).</p>
<p class="docText">One could conclude that, since IPv6 is carrying its own routing and forwarding tables, there should be distinct IPv4 and IPv6 VRFs. However, although IPv4 and IPv6 routing tables are indeed distinct, it is convenient, from a deployment standpoint to share the same VRF between the two protocols for a given customer.</p>
<p class="docText">VPNv6 customers are likely to be existing VPNv4 customers, either deploying dual-stack hosts and routers, or shadowing some of their IPv4 infrastructure with IPv6 nodes. Several deployment models are possible. Some customers use separate logical interfaces for IPv4 and IPv6, and define separate VRFs on each. Although this approach provides flexibility to configure separate policies for IPv4 and IPv6, it also prevents sharing the same policy. Another more attractive model is to keep one single VRF on the PE-CE interface, and enable it for IPv4, IPv6, or both. It is then possible to define common or separate policies for each IP version. With this model, a VRF is better defined as the set of tables, interfaces, and policies found at the PE, privately used by sites of a particular VPN connected to this PE.</p>
<p class="docText"><a class="docLink" href="#ch07fig06">Figure 7-6</a> shows the latter model, where VRF red is enabled for both IPv4 and IPv6, and is associated with two interfaces (IF1, IF2), two sets of tables (IPv4 Routing and Forwarding tables and IPv6 Routing and Forwarding tables), and a set of common or distinct policies. Such a VRF that is defined for both IPv4 and IPv6 will be referred to as multiprotocol VRF. Examples of such multiprotocol VRFs are provided in the &quot;<a class="docLink" href="ch07lev1sec4.html#ch07lev2sec20">Dual-Stack VPNs</a>&quot; section.</p>
<a name="ch07fig06"></a><p><center>
<h5 class="docFigureTitle">Figure 7-6. Multiprotocol VRF</h5>
<p class="docText"><div class="v1"><a target="_self" href="images/07fig06_alt.jpg">[View full size image]</a></div><img border="0" alt="" id="158039035251" width="500" height="230" SRC="images/07fig06.jpg"></p>
</center></p><br>
<a name="ch07lev3sec1"></a>
<H5 class="docSection3Title">Configuring a VRF</H5>
<p class="docText"><a name="iddle2059"></a>Configuring a VRF for IPv6 is no different from configuring a VRF for IPv4. In fact, it could have been exactly the same, if IPv4 and IPv6 VRFs had been kept separate. For the reasons mentioned previously, a VRF is an address-family-independent object that can be enabled and configured for each of the supported address families. Configuring a VRF includes three steps:</P>
<a name="ch07pro02"></a>



<table border="0" class="docText"><TR><TD width="25" valign="top"><div class="docText"><b>1. </b></div></td><td><div class="docText">Configuring the AF-independent part of the VRF<br><br>
</div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>2. </b></div></td><td><div class="docText">Enabling and configuring IPv4 for the VRF<BR><br>
</div></td></TR><TR><td width="25" valign="top"><div class="docText"><b>3. </b></div></td><td><div class="docText">Enabling and configuring IPv6 for the VRF<BR><br>
</div></td></tr></table>
<p class="docText">In Step 1, a VRF is first given a name and an RD. This is achieved using the command <span class="docEmphStrong">vrf definition &lt;<span class="docEmphasis">name</span>&gt;</span>, and then <span class="docEmphStrong">rd &lt;<span class="docEmphasis">ASN:nn</span>&gt;</span>.</p>
<a name="ch07note04"></a><div class="docNote"><p class="docNoteTitle">Note</P>

<p class="docText">Interestingly, the RD is configured outside the context of the address family. A careful reader might wonder why this is the case, when the RD is used to distinguish overlapping addresses within the context of a particular BGP address family. Having separate RDs for IPv4 VPN addresses and IPv6 VPN addresses should not matter. Indeed it does not. And the same or different RDs for two different address families do not make any difference. On Cisco routers, it was decided to keep the RDs the same to simplify configuration and VPN management.</P>
</div><BR>
<p class="docText">Still, in Step 1 of the configurationthat is, outside any address family contextyou can configure policies in common between IPv4 and IPv6. This is basically shared route targets (import and export). This feature proves especially useful in a migration scenario, where IPv4 policies already are configured, and IPv6 policies should be the same as the IPv4 ones.</p>
<p class="docText">In Step 2 and Step 3, you can configure and enable each address family separately. The address family configuration includes the usual import and export policies, maximum number of routes in the VRF, and so on. Note that the policies (route map and route target) entered at this level override global policies specified in the address-family-independent part.</p>
<p class="docText"><a class="docLink" href="#ch07ex09">Example 7-9</a> is a simple example of enabling and configuring each address family separately.</p>
<a name="ch07ex09"></a><h5 class="docExampleTitle">Example 7-9. Multiprotocol VRF Configuration Example</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>vrf definition site1
rd 1000:1
address-family ipv4
 route-target export 100:1
 route-target import 100:1
address-family ipv6
 route-target export 200:1
 route-target import 200:1</pre><br>

</td></tr></table></p>

<a name="ch07lev3sec2"></a>
<h5 class="docSection3Title">Associating a VRF to an Interface</h5>
<p class="docText"><a name="iddle1827"></a><a name="iddle2038"></a><a name="iddle2058"></a><a name="iddle2062"></a>To specify which interface belongs to which VRF, you must use the interface command <span class="docEmphStrong">vrf forwarding &lt;<span class="docEmphasis">name</span>&gt;</span>. The meaning and effect of this command on an interface is the same as the <span class="docEmphStrong">ip vrf forwarding</span> command used for VPNv4, with the difference that it is multiprotocol. An interface cannot belong to more than one VRF. When the interface is bound to a VRF, previously configured addresses (IPv4 and IPv6) are removed and they must be reconfigured. <a class="docLink" href="#ch07ex10">Example 7-10</a> is an example of the interface configuration.</P>
<a name="ch07ex10"></a><H5 class="docExampleTitle">Example 7-10. Multiprotocol VRF Configuration on the Interface</H5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><td>


<pre>hostname PE-1
!
vrf definition site1
rd 100:1
route-target export 100:1
address-family ipv4
address-family ipv6
!
interface Serial0/0
 <span class="docEmphMark">vrf forwarding site1 </span>
 ipv6 address 2001:100:1:1000::72b/64
 ip address 200.11.11.1 255.255.255.0</pre><br>

</td></tr></table></p>

<a name="ch07lev3sec3"></a>
<h5 class="docSection3Title">VRF-Aware Router Commands</h5>
<p class="docText">Many of the commands to display or troubleshoot Cisco routers are VRF aware for IPv6, similar to IPv4. Here are a few key examples:</p>
<ul><li><p class="docList">To show the routing table:</p><div class="docText"><pre><span class="docEmphStrong">show ipv6 route vrf red</span></pre></div></li><LI><p class="docList">To show the forwarding table:</p><div class="docText"><pre><span class="docEmphStrong">show ipv6 cef vrf red</span></pre></div></li></UL>
<p class="docText">A number of applications available at the router (PE) have to be VRF aware to enable the operator to use them within the scope of a particular VRF. Two notations can be used, either <span class="docEmphStrong">vrf &lt;<span class="docEmphasis">name</span>&gt;</span> or <span class="docEmphStrong">%&lt;<span class="docEmphasis">name</span>&gt;</span> after the address, referencing VRF tables in the context of an IPv6 address.</P>
<p class="docText">Here is the list of such applications:</p>
<ul><li><p class="docList">Ping</p><div class="docText"><pre><span class="docEmphStrong">ping vrf red 2001:100:1:1000::72e</span>
<span class="docEmphStrong">ping 2001:100:1:1000::72e%red</span></pre></div></LI><li><p class="docList">Traceroute</p><div class="docText"><pre><span class="docEmphStrong">traceroute vrf red 2001:100:1:1000::72e</span>
<span class="docEmphStrong">traceroute 2001:100:1:1000::72e%red</span></pre></div></li><li><p class="docList"><a name="iddle1020"></a><a name="iddle1144"></a><a name="iddle1668"></a><a name="iddle1672"></a><a name="iddle1689"></a><a name="iddle1806"></a><a name="iddle1808"></a><a name="iddle1854"></a>Telnet</P><div class="docText"><pre><span class="docEmphStrong">telnet /vrf red 2001:100:1:1000::72e</span>
<span class="docEmphStrong">telnet 2001:100:1:1000::72e%red</span></pre></div></LI></UL>


<a name="ch07lev2sec16"></a>
<h4 class="docSection2Title">Scaling IPv6 VPNs</h4>
<p class="docText">PE-based VPNs such as BGP-MPLS IPv6 VPNs scale better than CE-based VPNs. A network designer still has to consider scaling when designing the network. Scaling a BGP-MPLS IPv6 VPN is similar to scaling a BGP-MPLS IPv4 VPN. The following points need to be considered:</p>
<ul><li><p class="docList">Routing table size, including the size of VRF tables, and the size of BGP tables</p></li><li><p class="docList">Number of BGP sessions, growing as the square of the number of PEs</p></li></ul>
<p class="docText">The first issue arises at PEs handling many customer sites. Not only do these PEs have to deal with one routing and one forwarding table per connected customer, but their BGP tables, which sum up all entries from individual VRFs, are growing accordingly. Another scalability issue arises when the number of PEs in the provider network grows beyond a certain level. Assuming that a significant number of sites belonging to the same VPN are spread over many PEs, the number of MP-BGP sessions may rapidly become prohibitive: (<span class="docEmphasis">N </span>1) * <span class="docEmphasis">N</span>/2, where <span class="docEmphasis">N</span> is the number of PEs.</p>
<p class="docText">Identical issues faced by both IPv6 and IPv4 tend to drive similar solutions. The most common ones are the following:</p>
<ul><LI><p class="docText"><span class="docEmphStrong">Route refresh and automatic route filtering</span> Limit the size of routing tables because only routes imported into a VRF are kept locally. When the import policy changes, a route refresh can be sent to query a retransmission of routing updates.</P></LI><LI><p class="docText"><span class="docEmphStrong">Outbound route filtering (ORF)</span> Allows the ingress PE to advertise filters to the egress PE so that updates are not unnecessarily sent over the network.</P></li><li><p class="docText"><span class="docEmphStrong">Route reflectors</span> These are iBGP peers that propagate iBGP routes learned from other iBGP peers. Route reflectors are used to concentrate the iBGP sessions.</p></li></ul>
<p class="docText">The following example illustrates the route refresh received at PE2, in a situation where PE1 exports routes with route target 500:1 and PE2 imports it. The initial BGP table at PE2 is shown in <a class="docLink" href="#ch07ex11">Example 7-11</a>.</p>
<a name="ch07ex11"></a><h5 class="docExampleTitle">Example 7-11. BGP Table Before the Route Refresh</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>PE2#<span class="docEmphStrong">show bgp vpnv6 unicast all</span>
   Network          Next Hop
Route Distinguisher: 100:1 (default for vrf red)
*&gt;i2001:100:1:1000::/56    ::FFFF:200.11.11.1
*&gt; 2001:100:1:1000::/64    ::
Route Distinguisher: 200:1 (default for vrf blue)
*&gt;i2001:100:1:2000::/56    ::FFFF:200.11.11.1
*&gt; 2001:100:1:2000::/64    ::</pre><br>

</TD></tr></table></p>
<p class="docText">In one VRF, entries with a route target 500:1 are set up for import as shown here:</P>
<div class="docText"><pre>PE2(config)#<span class="docEmphStrong">vrf definition red</span>
PE2(config-vrf)#<span class="docEmphStrong">route-target import 500:1</span></pre></div><BR>
<p class="docText">The following trace (obtained using the <span class="docEmphStrong">debug bgp</span> command) shows the route refresh being sent, and the BGP update being received and installed:</p>
<div class="docText"><pre>01:09:28: BGP: 200.11.11.1 sending REFRESH_REQ(5) for afi/safi: 2/128
01:09:28: BGP: 200.11.11.1 send message type 5, length (incl. header) 23
01:09:36: BGP IPv6: Updating route (not batched) 2001:100:1:5000::/56 m/d 0/200,
  flags 0</pre></div><br>
<p class="docText"><a class="docLink" href="#ch07ex12">Example 7-12</a> shows the BGP table.</p>
<a name="ch07ex12"></a><h5 class="docExampleTitle">Example 7-12. BGP Table After the Route Refresh</H5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>PE2#<span class="docEmphStrong">show bgp vpnv6 unicast all</span>
   Network          Next Hop
Route Distinguisher: 100:1 (default for vrf red)
*&gt;i2001:100:1:1000::/56    ::FFFF:200.11.11.1
*&gt; 2001:100:1:1000::/64    ::
*&gt;i2001:100:1:5000::/56    ::FFFF:200.11.11.1
Route Distinguisher: 200:1 (default for vrf blue)
*&gt;i2001:100:1:2000::/56    ::FFFF:200.11.11.1
*&gt; 2001:100:1:2000::/64    ::
Route Distinguisher: 500:1
*&gt;i2001:100:1:5000::/56    ::FFFF:200.11.11.1</pre><br>

</TD></TR></table></P>
<p class="docText">The route-refresh feature is negotiated during the initial BGP peer negotiation. <a class="docLink" href="#ch07ex13">Example 7-13</a> shows how to display it.</p>
<a name="ch07ex13"></a><h5 class="docExampleTitle">Example 7-13. Route-Refresh Capability Display</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<pre>PE2#<span class="docEmphStrong">show bgp vpnv6 unicast all neighbors</span>
BGP neighbor is 200.11.11.1,  remote AS 100, internal link
  BGP version 4, remote router ID 200.11.11.1
  BGP state = Established, up for 2d17h
  Last read 00:00:55, hold time is 180, keepalive interval is 60 seconds
  Neighbor capabilities:
    Route refresh: advertised and received(new)
    Address family IPv4 Unicast: advertised and received
    Address family VPNv6 Unicast: advertised and received</pre><br>

</td></tr></table></p>
<a name="ch07note05"></a><div class="docNote"><p class="docNoteTitle">Note</p>

<p class="docText">Although route reflectors solve the problem of the explosion of BGP sessions, they tend to make the issue of BGP table size worse. Because the route reflectors do not have any VRFs themselves, they cannot filter routes based on import policies. Because they can store BGP routes for many clients PEs, they tend to accumulate routes from many sites. Finally, they can easily become a single point of failure for the sessions that they reflect. To alleviate these issues, the design of the network using route reflectors must be carefully studied. Several route reflectors are generally used in parallel, sometimes in a hierarchy. And of course, the provider backbone topology may be partitioned in such a way that a given route reflector serves only a limited numbers of PEs.</p>
</div><br>

<a name="ch07lev2sec17"></a>
<h4 class="docSection2Title">MP-BGP for VPNv6 at a Glance</H4>
<p class="docText"><a name="iddle1014"></a><a name="iddle1138"></a><a name="iddle1566"></a><a name="iddle1683"></a>As mentioned earlier in the chapter, MP-BGP is a centerpiece of the MPLS-VPNv6 architecture. <a class="docLink" href="#ch07table03">Table 7-3</a> summarizes the list of BGP features applicable to VPNv6 in various deployment scenarios.</P>
<a name="ch07table03"></a><P><table cellspacing="0" class="allBorders" border="1" RULES="all" cellpadding="4"><caption><H5 class="docTableTitle">Table 7-3. BGP VPNv6 Features</H5></caption><colgroup><col width="250"><col width="300"></colgroup><thead><tr><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">MP-BGP Feature</p></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Description</p></th></tr></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Base IPv6 MPLS VPN functionality</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Support of VRF for IPv6.</p>
<p class="docText">Handling of labeled IPv6 VPN address family in MP-BGP.</p>
<p class="docText">Appropriate route handling (import/export) taking into account RT.</p>
<p class="docText">Automatic inbound route filtering.</P>
</td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText">EBGP as PE-CE routing protocol</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">eBGP can run on a VRF basis.</p></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Source of origin (SOO)</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">SOO is used to prevent routing loops in case of dual-homed CE.</P></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">ASN override</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">If a global ASN is specified, BGP automatically replaces the ASN with a unique number to ensure the site is uniquely identified.</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Allow-AS-in</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">The hub-and-spoke topology widely deployed with VPNv4 is equally useful with VPNv6. This feature enables BGP speakers to accept updates that contain their own ASN in the AS_PATH attribute.</P></TD></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText">BGP prefix list filtering</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Filter MP-BGP IPv6 advertisement based on configured IPv6 prefix.</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">BGP AS path filtering</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Filter MP-BGP IPv6 advertisement based on configured AS path.</P></td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText">BGP max prefix</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Upper limit on the number of BGP routes learned from a given CE.</p></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">BGP route refresh</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Using this technique, a MP-BGP speaker (PE/CE) can request another BGP speaker to resend its MP-BGP updates.</P></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">Route target rewrite at AS boundary</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Allows rewrite of RT values at AS boundary for inter-AS operations.</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">BGP multipath</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Support eBGP multipath, iBGP multipath, eiBGP multipath and DMZ-link-bandwidth-based load balancing.</P></TD></TR></table></P><br>


</TD></TR></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch07lev1sec2.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch07lev1sec4.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
</body></html>