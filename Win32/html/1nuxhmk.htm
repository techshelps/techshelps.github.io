<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>TransactNamedPipe</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="1nuxhmk"></A><B>TransactNamedPipe  <A HREF="1ugwt4b.htm"><IMG SRC="../images/bm1.gif" ALT="" BORDER=0></A>  <A HREF="qxj_so.htm"><IMG SRC="../images/bm3.gif" ALT="" BORDER=0></A>  <A HREF="1p87g2.htm"><IMG SRC="../images/bm2.gif" ALT="" BORDER=0></A></B></P>

<P>The <B>TransactNamedPipe</B> function combines into a single network operation the functions that write a message to and read a message from the specified named pipe. </P>

<P><B>BOOL TransactNamedPipe(</B></P>

<TABLE cols=2 width=545>

<TR VALIGN="top">
<TD width=44%><B>HANDLE</B> <I>hNamedPipe</I><B>,</B></TD>
<TD width=56%>// handle of named pipe </TD>
</TR>

<TR VALIGN="top">
<TD width=44%><B>    LPVOID</B> <I>lpInBuffer</I><B>,</B></TD>
<TD width=56%>// address of write buffer </TD>
</TR>

<TR VALIGN="top">
<TD width=44%><B>    DWORD</B> <I>nInBufferSize</I><B>,</B></TD>
<TD width=56%>// size of the write buffer, in bytes </TD>
</TR>

<TR VALIGN="top">
<TD width=44%><B>    LPVOID</B> <I>lpOutBuffer</I><B>,</B></TD>
<TD width=56%>// address of read buffer </TD>
</TR>

<TR VALIGN="top">
<TD width=44%><B>    DWORD</B> <I>nOutBufferSize</I><B>,</B></TD>
<TD width=56%>// size of read buffer, in bytes </TD>
</TR>

<TR VALIGN="top">
<TD width=44%><B>    LPDWORD</B> <I>lpBytesRead</I><B>,</B></TD>
<TD width=56%>// address of variable for bytes actually read  </TD>
</TR>

<TR VALIGN="top">
<TD width=44%><B>    LPOVERLAPPED</B> <I>lpOverlapped</I> </TD>
<TD width=56%>// address of overlapped structure </TD>
</TR>

<TR VALIGN="top">
<TD width=44%><B>   );</B></TD>
<TD width=56%>&nbsp;</TD>
</TR>
</TABLE><BR>

<P></P>

<P><B>Parameters</B></P>

<P><I>hNamedPipe</I></P>

<P>Identifies the named pipe returned by the <A HREF="21dzyt.htm"><B>CreateNamedPipe</B></A> or <A HREF="xn35yd.htm"><B>CreateFile</B></A> function. </P>

<P><I>lpInBuffer</I></P>

<P>Points to the buffer containing the data written to the pipe. </P>

<P><I>nInBufferSize</I></P>

<P>Specifies the size, in bytes, of the write buffer. </P>

<P><I>lpOutBuffer</I></P>

<P>Points to the buffer that receives the data read from the pipe. </P>

<P><I>nOutBufferSize</I></P>

<P>Specifies the size, in bytes, of the read buffer. </P>

<P><I>lpBytesRead</I></P>

<P>Points to the variable that receives the number of bytes read from the pipe. </P>

<P>If <I>lpOverlapped</I> is NULL, <I>lpBytesRead</I> cannot be NULL.</P>

<P>If <I>lpOverlapped</I> is not NULL, <I>lpBytesRead</I> can be NULL. If this is an overlapped read operation, you can get the number of bytes read by calling <A HREF="kcz7oz.htm"><B>GetOverlappedResult</B></A>. If <I>hNamedPipe</I> is associated with an I/O completion port, you can get the number of bytes read by calling <A HREF="h734vj.htm"><B>GetQueuedCompletionStatus</B></A>.</P>

<P><I>lpOverlapped</I></P>

<P>Points to an <A HREF="1n286m5.htm"><B>OVERLAPPED</B></A> structure. This structure is required if <I>hNamedPipe</I> was opened with FILE_FLAG_OVERLAPPED.</P>

<P>If <I>hNamedPipe</I> was opened with FILE_FLAG_OVERLAPPED, the <I>lpOverlapped</I> parameter must not be NULL. It must point to a valid <B>OVERLAPPED</B> structure. If <I>hNamedPipe</I> was created with FILE_FLAG_OVERLAPPED and <I>lpOverlapped</I> is NULL, the function can incorrectly report that the opeation is complete.</P>

<P>If <I>hNamePipe</I> was opened with FILE_FLAG_OVERLAPPED and <I>lpOverlapped</I> is not NULL, <B>TransactNamedPipe</B> is executed as an overlapped operation. The <B>OVERLAPPED</B> structure should contain a manual-reset event object (which can be created by using the <A HREF="j_zbjv.htm"><B>CreateEvent</B></A> function). If the operation cannot be completed immediately, <B>TransactNamedPipe</B> returns FALSE and <B>GetLastError</B> returns ERROR_IO_PENDING. In this situation, the event object is set to the nonsignaled state before <B>TransactNamedPipe</B> returns, and it is set to the signaled state when the transaction has finished. For more information about overlapped operations, see <A HREF="qxj_so.htm">Pipes</A>. </P>

<P>If <I>hNamedPipe</I> was not opened with FILE_FLAG_OVERLAPPED, <B>TransactNamedPipe</B> does not return until the operation is complete.</P>

<P></P>

<P><B>Return Values</B></P>

<P>If the function succeeds, the return value is nonzero.</P>

<P>If the function fails, the return value is zero. To get extended error information, call <A HREF="11c2vs7.htm"><B>GetLastError</B></A>. </P>

<P><B>Remarks</B></P>

<P><B>TransactNamedPipe</B> fails if the server did not create the pipe as a message-type pipe or if the pipe handle is not in message-read mode. For example, if a client is running on the same machine as the server and uses the <B>\\.\pipe\</B><I>pipename</I> format to open the pipe, the pipe is opened in byte mode by the named pipe file system (NPFS). If the client uses the form <B>\\</B><I>server</I><B>\pipe\</B><I>pipename</I>, the redirector opens the pipe in message mode. A byte mode pipe handle can be changed to message-read mode with the <A HREF="ap5lb1.htm"><B>SetNamedPipeHandleState</B></A> function. </P>

<P>The function cannot be completed successfully until data is written into the buffer specified by the <I>lpOutBuffer</I> parameter. The <I>lpOverlapped</I> parameter is available to enable the calling thread to perform other tasks while the operation is executing in the background. </P>

<P>If the message to be read is longer than the buffer specified by the <I>nOutBufferSize </I>parameter, <B>TransactNamedPipe</B> returns FALSE and the <B>GetLastError</B> function returns ERROR_MORE_DATA. The remainder of the message can be read by a subsequent call to <B>ReadFile</B>, <B>ReadFileEx</B>, or <B>PeekNamedPipe</B>. </P>

<P><B>See Also</B></P>

<P><A HREF="j_zbjv.htm"><B>CreateEvent</B></A>, <A HREF="xn35yd.htm"><B>CreateFile</B></A>, <A HREF="21dzyt.htm"><B>CreateNamedPipe</B></A>, <A HREF="kcz7oz.htm"><B>GetOverlappedResult</B></A>, <A HREF="h734vj.htm"><B>GetQueuedCompletionStatus</B></A>, <A HREF="3ie31.htm"><B>PeekNamedPipe</B></A>, <A HREF="cjnd8p.htm"><B>ReadFile</B></A>, <A HREF="fm7wz7.htm"><B>ReadFileEx</B></A>, <A HREF="ap5lb1.htm"><B>SetNamedPipeHandleState</B></A>, <A HREF="1n286m5.htm"><B>OVERLAPPED</B></A></P>

</BODY>
</HTML>
