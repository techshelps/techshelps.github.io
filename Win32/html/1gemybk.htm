<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Drawing with the Mouse</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="1gemybk"></A><B>Drawing with the Mouse</B></P>

<P>You can permit the user to draw lines with the mouse by having your window procedure draw while processing the <A HREF="1mq_iq2.htm">WM_MOUSEMOVE</A> message. Windows sends the WM_MOUSEMOVE message to the window procedure whenever the user moves the cursor within the window. To draw lines, the window procedure can retrieve a display DC and draw a line in the window between the current and previous cursor positions. </P>

<P>In the following example, the window procedure prepares for drawing when the user presses and holds the left mouse button (sending the <A HREF="065j6u.htm">WM_LBUTTONDOWN</A> message). As the user moves the cursor within the window, the window procedure receives a series of WM_MOUSEMOVE messages. For each message, the window procedure draws a line connecting the previous position and the current position. To draw the line, the procedure uses <A HREF="4f0b0z.htm"><B>GetDC</B></A> to retrieve a display DC; then, as soon as drawing is complete and before returning from the message, the procedure uses the <A HREF="p4bes3.htm"><B>ReleaseDC</B></A> function to release the display DC. As soon as the user releases the mouse button, the window procedure clears the flag, and the drawing stops (which sends the <A HREF="yl9yek.htm">WM_LBUTTONUP</A> message). </P>

<P></P>

<P>BOOL fDraw = FALSE; </P>

<P>POINT ptPrevious; </P>

<P></P>

<P>. </P>

<P>. </P>

<P>. </P>

<P></P>

<P>case WM_LBUTTONDOWN: </P>

<P>fDraw = TRUE; </P>

<P>ptPrevious.x = LOWORD(lParam); </P>

<P>ptPrevious.y = HIWORD(lParam); </P>

<P>return 0L; </P>

<P></P>

<P>case WM_LBUTTONUP: </P>

<P>if (fDraw) { </P>

<P>hdc = GetDC(hwnd); </P>

<P>MoveToEx(hdc, ptPrevious.x, ptPrevious.y, NULL); </P>

<P>LineTo(hdc, LOWORD(lParam), HIWORD(lParam)); </P>

<P>ReleaseDC(hwnd, hdc); </P>

<P>} </P>

<P>fDraw = FALSE; </P>

<P>return 0L; </P>

<P></P>

<P>case WM_MOUSEMOVE: </P>

<P>if (fDraw) { </P>

<P>hdc = GetDC(hwnd); </P>

<P>MoveToEx(hdc, ptPrevious.x, ptPrevious.y, NULL); </P>

<P>LineTo(hdc, ptPrevious.x = LOWORD(lParam), </P>

<P>ptPrevious.y = HIWORD(lParam)); </P>

<P>ReleaseDC(hwnd, hdc); </P>

<P>} </P>

<P>return 0L; </P>

<P></P>

<P></P>

<P>An application that enables drawing, as in this example, typically records either the points or lines so that the lines can be redrawn whenever the window is updated. Drawing applications often use a memory DC and an associated bitmap to store lines that were drawn by using a mouse. </P>

</BODY>
</HTML>
