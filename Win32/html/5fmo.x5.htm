<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Creating a Modeless Dialog Box</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="5fmo.x5"></A><B>Creating a Modeless Dialog Box</B></P>

<P>You create a modeless dialog box by using the <A HREF="ddoz5a.htm"><B>CreateDialog</B></A> function, specifying the identifier or name of a dialog box template resource and the address of the dialog box procedure. <B>CreateDialog</B> loads the template, creates the dialog box, and optionally displays it. Your application is responsible for retrieving and dispatching user input messages to the dialog box procedure. </P>

<P>In the following example, the application displays a modeless dialog box ¾ if it is not already displayed ¾ when the user chooses a Go To command from an application menu. The dialog box contains an edit control, a check box, and OK and Cancel buttons. The dialog box template is a resource in the application's executable file and has the resource identifier DLG_GOTO. The user enters a line number in the edit control and checks the check box to specify that the line number is relative to the current line. The control identifiers are ID_LINE, ID_ABSREL, IDOK, and IDCANCEL. </P>

<P>The statements in the first part of the example create the modeless dialog box. These statements, in the window procedure for the application's main window, create the dialog box when the window procedure receives a <A HREF="71v.3j.htm">WM_COMMAND</A> message having the IDM_GOTO command identifier, but only if the global variable <I>hwndGoto</I> does not already contain a valid handle. The second part of the example is the application's main message loop. The loop includes the <A HREF="3mdxb3e.htm"><B>IsDialogMessage</B></A> function to ensure that the user can use the dialog box keyboard interface in this modeless dialog box. The third part of the example is the dialog box procedure. The procedure retrieves the contents of the edit control and check box when the user chooses the OK button. The procedure destroys the dialog box when the user chooses the Cancel button. </P>

<P>HWND hwndGoto = NULL;  // window handle of dialog box  </P>

<P></P>

<P>. </P>

<P>. </P>

<P>. </P>

<P></P>

<P>case WM_COMMAND: </P>

<P>switch (LOWORD(wParam)) { </P>

<P>case IDM_GOTO: </P>

<P>if (!IsWindow(hwndGoto)) { </P>

<P>hwndGoto = CreateDialog(hinst, </P>

<P>MAKEINTRESOURCE(DLG_GOTO), </P>

<P>hwnd, (DLGPROC) GoToProc); </P>

<P>ShowWindow(hwndGoto, SW_SHOW); </P>

<P>} </P>

<P>break; </P>

<P>} </P>

<P>return 0L; </P>

<P></P>

<P>In the preceding statements, <A HREF="ddoz5a.htm"><B>CreateDialog</B></A> is called only if <I>hwndGoto</I> does <I>not</I> contain a valid window handle. This ensures that the application does not display two dialog boxes at the same time. To support this method of checking, the dialog procedure must set <I>hwndGoto</I> to NULL when it destroys the dialog box. </P>

<P>The message loop for an application consists of the following statements: </P>

<P>while (GetMessage(&amp;msg, NULL, NULL, NULL)) {  </P>

<P>if (!IsWindow(hwndGoto) || !IsDialogMessage(hwndGoto, &amp;msg)) { </P>

<P>TranslateMessage(&amp;msg); </P>

<P>DispatchMessage(&amp;msg); </P>

<P>} </P>

<P>} </P>

<P></P>

<P>The loop checks the validity of the window handle for the dialog box and only calls the <A HREF="3mdxb3e.htm"><B>IsDialogMessage</B></A> function if the handle is valid. <B>IsDialogMessage</B> only processes the message if it belongs to the dialog box. Otherwise, it returns FALSE and the loop dispatches the message to the appropriate window. </P>

<P>The following statements define the dialog box procedure: </P>

<P>int iLine;             // receives line number  </P>

<P>BOOL fRelative;        // receives check box status </P>

<P></P>

<P>. </P>

<P>. </P>

<P>. </P>

<P></P>

<P>BOOL CALLBACK GoToProc(hwndDlg, message, wParam, lParam) </P>

<P>HWND hwndDlg; </P>

<P>UINT message; </P>

<P>WPARAM wParam; </P>

<P>LPARAM lParam; </P>

<P>{ </P>

<P>BOOL fError; </P>

<P></P>

<P>switch (message) { </P>

<P>case WM_INITDIALOG: </P>

<P>CheckDlgButton(hwndDlg, ID_ABSREL, fRelative); </P>

<P>return TRUE; </P>

<P></P>

<P>case WM_COMMAND: </P>

<P>switch (LOWORD(wParam)) { </P>

<P>case IDOK: </P>

<P>fRelative = IsDlgButtonChecked(hwndDlg, </P>

<P>ID_ABSREL); </P>

<P>iLine = GetDlgItemInt(hwndDlg, ID_LINE, </P>

<P>&amp;fError, fRelative); </P>

<P>if (fError) { </P>

<P>MessageBox(hwndDlg, SZINVALIDNUMBER, </P>

<P>SZGOTOERR, MB_OK); </P>

<P>SendDlgItemMessage(hwndDlg, ID_LINE, </P>

<P>EM_SETSEL, 0, -1L); </P>

<P>} else </P>

<P></P>

<P>. </P>

<P>. // Notify the owner window to carry </P>

<P>. // out the command. </P>

<P>. </P>

<P></P>

<P>return TRUE; </P>

<P></P>

<P>case IDCANCEL: </P>

<P>DestroyWindow(hwndDlg); </P>

<P>hwndGoto = NULL; </P>

<P>return TRUE; </P>

<P>} </P>

<P>} </P>

<P>return FALSE; </P>

<P>} </P>

<P></P>

<P>In the preceding statements, the procedure processes the <A HREF="ii1w.b.htm">WM_INITDIALOG</A> and <A HREF="71v.3j.htm">WM_COMMAND</A> messages. During WM_INITDIALOG processing, the procedure initializes the check box by passing the current value of the global variable <I>fRelative</I> to <A HREF="0ec349.htm"><B>CheckDlgButton</B></A>. The procedure then returns TRUE to direct Windows to set the default input focus. </P>

<P>During WM_COMMAND processing, the procedure closes the dialog box only if the user chooses the Cancel button ¾ that is, the button having the IDCANCEL identifier. The procedure must call <A HREF="1vrgccm.htm"><B>DestroyWindow</B></A> to close a modeless dialog box. Notice that the procedure also sets the <I>hwndGoto</I> variable to NULL to ensure that other statements that depend on this variable operate correctly. </P>

<P>If the user chooses the OK button, the procedure retrieves the current state of the check box and assigns it to the <I>fRelative</I> variable. It then uses the variable to retrieve the line number from the edit control. <A HREF="2e3k067.htm"><B>GetDlgItemInt</B></A> translates the text in the edit control into an integer. The value of <I>fRelative</I> determines whether the function interprets the number as a signed or unsigned value. If the edit control text is not a valid number, <B>GetDlgItemInt</B> sets the value of the <I>fError</I> variable to nonzero. The procedure checks this value to determine whether to display an error message or carry out the command. In the event of an error, the dialog box procedure sends a message to the edit control, directing it to select the text in the control so that the user can easily replace it. If <B>GetDlgItemInt</B> does not return an error, the procedure can either carry out the requested command itself or send a message to the owner window, directing it to carry out the command. </P>

</BODY>
</HTML>
