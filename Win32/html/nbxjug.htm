<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>OpenSCManager</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="nbxjug"></A><B>OpenSCManager  <A HREF="138u7wk.htm"><IMG SRC="../images/bm1.gif" ALT="" BORDER=0></A>  <A HREF="12c8zrk.htm"><IMG SRC="../images/bm3.gif" ALT="" BORDER=0></A>  <A HREF="we4jtq.htm"><IMG SRC="../images/bm2.gif" ALT="" BORDER=0></A></B></P>

<P>The <B>OpenSCManager</B> function establishes a connection to the service control manager on the specified computer and opens the specified database. </P>

<P><B>SC_HANDLE OpenSCManager(</B></P>

<TABLE cols=2 width=453>

<TR VALIGN="top">
<TD width=48%><B>LPCTSTR</B> <I>lpMachineName</I><B>,</B></TD>
<TD width=52%>// pointer to machine name string </TD>
</TR>

<TR VALIGN="top">
<TD width=48%><B>    LPCTSTR</B> <I>lpDatabaseName</I><B>,</B></TD>
<TD width=52%>// pointer to database name string </TD>
</TR>

<TR VALIGN="top">
<TD width=48%><B>    DWORD</B> <I>dwDesiredAccess</I> </TD>
<TD width=52%>// type of access </TD>
</TR>

<TR VALIGN="top">
<TD width=48%><B>   );</B></TD>
<TD width=52%>&nbsp;</TD>
</TR>
</TABLE><BR>

<P></P>

<P><B>Parameters</B></P>

<P><I>lpMachineName</I></P>

<P>Points to a null-terminated string that names the target computer. If the pointer is NULL or if it points to an empty string, the function connects to the service control manager on the local computer. </P>

<P><I>lpDatabaseName</I></P>

<P>Points to a null-terminated string that names the service control manager database to open. This string should specify ServicesActive. If the pointer is NULL, the ServicesActive database is opened by default. </P>

<P><I>dwDesiredAccess</I></P>

<P>Specifies the access to the service control manager. Before granting the requested access, the system checks the access token of the calling process against the discretionary access-control list of the security descriptor associated with the service control manager object. The SC_MANAGER_CONNECT access type is implicitly specified by calling this function. In addition, any or all of the following service control manager object access types can be specified: </P>

<TABLE cols=6>

<TR VALIGN="top">
<TD colspan=2 width=13%><B>Type</B></TD>
<TD colspan=3 width=74%><B>Description</B></TD>
</TR>

<TR VALIGN="top">
<TD colspan=3 width=15%>SC_MANAGER_ALL_ACCESS</TD>
<TD colspan=3 width=85%>&nbsp;</TD>
</TR>

<TR VALIGN="top">
<TD width=11%>&nbsp;</TD>
<TD colspan=3 width=64%>Includes STANDARD_RIGHTS_REQUIRED, in addition to all of the access types listed in this table.</TD>
</TR>

<TR VALIGN="top">
<TD colspan=3 width=15%>SC_MANAGER_CONNECT</TD>
<TD colspan=3 width=85%>&nbsp;</TD>
</TR>

<TR VALIGN="top">
<TD width=11%>&nbsp;</TD>
<TD colspan=3 width=64%>Enables connecting to the service control manager.</TD>
</TR>

<TR VALIGN="top">
<TD colspan=3 width=15%>SC_MANAGER_CREATE_SERVICE</TD>
<TD colspan=3 width=85%>&nbsp;</TD>
</TR>

<TR VALIGN="top">
<TD width=11%>&nbsp;</TD>
<TD colspan=3 width=64%>Enables calling of the <A HREF="2wng26.htm"><B>CreateService</B></A> function to create a service object and add it to the database.</TD>
</TR>

<TR VALIGN="top">
<TD colspan=3 width=15%>SC_MANAGER_ENUMERATE_SERVICE</TD>
<TD colspan=3 width=85%>&nbsp;</TD>
</TR>

<TR VALIGN="top">
<TD width=11%>&nbsp;</TD>
<TD colspan=3 width=64%>Enables calling of the <A HREF="y21_8w.htm"><B>EnumServicesStatus</B></A> function to list the services that are in the database.</TD>
</TR>

<TR VALIGN="top">
<TD colspan=3 width=15%>SC_MANAGER_LOCK</TD>
<TD colspan=3 width=85%>&nbsp;</TD>
</TR>

<TR VALIGN="top">
<TD width=11%>&nbsp;</TD>
<TD colspan=3 width=64%>Enables calling of the <A HREF="23k5hc.htm"><B>LockServiceDatabase</B></A> function to acquire a lock on the database.</TD>
</TR>

<TR VALIGN="top">
<TD colspan=3 width=15%>SC_MANAGER_QUERY_LOCK_STATUS</TD>
<TD colspan=3 width=85%>&nbsp;</TD>
</TR>

<TR VALIGN="top">
<TD width=11%>&nbsp;</TD>
<TD colspan=3 width=64%>Enables calling of the <A HREF="dkgkou.htm"><B>QueryServiceLockStatus</B></A> function to retrieve the lock status information for the database.</TD>
</TR>
</TABLE><BR>

<P></P>

<P>The <I>dwDesiredAccess</I> parameter can specify any or all of the following generic access types: </P>

<TABLE cols=2>

<TR VALIGN="top">
<TD width=34%><B>Generic access</B></TD>
<TD width=66%><B>Service manager access</B></TD>
</TR>

<TR VALIGN="top">
<TD width=34%>GENERIC_READ</TD>
<TD width=66%>Combines the following access: STANDARD_RIGHTS_READ, SC_MANAGER_ENUMERATE_SERVICE, and SC_MANAGER_QUERY_LOCK_STATUS.</TD>
</TR>

<TR VALIGN="top">
<TD width=34%>GENERIC_WRITE</TD>
<TD width=66%>Combines the following access: STANDARD_RIGHTS_WRITE, SC_MANAGER_CREATE_SERVICE, and SC_MANAGER_MODIFY_BOOT_CONFIG.</TD>
</TR>

<TR VALIGN="top">
<TD width=34%>GENERIC_EXECUTE</TD>
<TD width=66%>Combines the following access: STANDARD_RIGHTS_EXECUTE, SC_MANAGER_CONNECT, and SC_MANAGER_LOCK.</TD>
</TR>
</TABLE><BR>

<P></P>

<P><B>Return Values</B></P>

<P>If the function succeeds, the return value is a handle to the specified service control manager database.</P>

<P>If the function fails, the return value is NULL. To get extended error information, call <A HREF="11c2vs7.htm"><B>GetLastError</B></A>. </P>

<P><B>Errors</B></P>

<P>The following error codes may be set by the service control manager. Other error codes may be set by the registry functions that are called by the service control manager. </P>

<TABLE cols=2>

<TR VALIGN="top">
<TD width=56%><B>Error code</B></TD>
<TD width=44%><B>Meaning</B></TD>
</TR>

<TR VALIGN="top">
<TD width=56%>ERROR_ACCESS_DENIED</TD>
<TD width=44%>The requested access was denied.</TD>
</TR>

<TR VALIGN="top">
<TD width=56%>ERROR_DATABASE_DOES_NOT_EXIST</TD>
<TD width=44%>The specified database does not exist.</TD>
</TR>

<TR VALIGN="top">
<TD width=56%>ERROR_INVALID_PARAMETER</TD>
<TD width=44%>A parameter that was specified is invalid.</TD>
</TR>
</TABLE><BR>

<P></P>

<P><B>Remarks</B></P>

<P>When a process uses the <B>OpenSCManager</B> function to open a handle to a service control manager database, the system performs a security check before granting the requested access. All processes are permitted SC_MANAGER_CONNECT, SC_MANAGER_ENUMERATE_SERVICE, and SC_MANAGER_QUERY_LOCK_STATUS access to all service control manager databases. This enables any process to open a service control manager database handle that it can use in the <A HREF="20gsky6.htm"><B>OpenService</B></A>, <A HREF="y21_8w.htm"><B>EnumServicesStatus</B></A>, and <A HREF="dkgkou.htm"><B>QueryServiceLockStatus</B></A> functions. Only processes with Administrator privileges are able to open a database handle used by the <A HREF="2wng26.htm"><B>CreateService</B></A> and <A HREF="23k5hc.htm"><B>LockServiceDatabase</B></A> functions. </P>

<P>The calling process can use the returned handle to identify the database in the following functions, if the appropriate access rights are enabled: </P>

<P><B>CreateService</B><BR>
<B>EnumServicesStatus</B><BR>
<B>LockServiceDatabase</B><BR>
<B>OpenService</B><BR>
<B>QueryServiceLockStatus</B></P>

<P>The returned handle is only valid for the process that called the <B>OpenSCManager </B>function. It can be closed by calling the <B>CloseServiceHandle</B> function. </P>

<P><B>See Also</B></P>

<P><A HREF="jahsjl.htm"><B>CloseServiceHandle</B></A>, <A HREF="2wng26.htm"><B>CreateService</B></A>, <A HREF="y21_8w.htm"><B>EnumServicesStatus</B></A>, <A HREF="23k5hc.htm"><B>LockServiceDatabase</B></A>, <A HREF="20gsky6.htm"><B>OpenService</B></A>, <A HREF="dkgkou.htm"><B>QueryServiceLockStatus</B></A> </P>

</BODY>
</HTML>
