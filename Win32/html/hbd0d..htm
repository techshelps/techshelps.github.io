<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>RegisterServiceCtrlHandler</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="hbd0d."></A><B>RegisterServiceCtrlHandler  <A HREF="1z_.0io.htm"><IMG SRC="../images/bm1.gif" ALT="" BORDER=0></A>  <A HREF="12c8zrk.htm"><IMG SRC="../images/bm3.gif" ALT="" BORDER=0></A>  <A HREF="we4jtq.htm"><IMG SRC="../images/bm2.gif" ALT="" BORDER=0></A></B></P>

<P>The <B>RegisterServiceCtrlHandler</B> function registers a function to handle service control requests for a service. </P>

<P><B>SERVICE_STATUS_HANDLE RegisterServiceCtrlHandler(</B></P>

<TABLE cols=2 width=507>

<TR VALIGN="top">
<TD width=58%><B>LPCTSTR</B> <I>lpServiceName</I><B>,</B></TD>
<TD width=42%>// address of name of service </TD>
</TR>

<TR VALIGN="top">
<TD width=58%><B>    LPHANDLER_FUNCTION</B> <I>lpHandlerProc</I> </TD>
<TD width=42%>// address of handler function </TD>
</TR>

<TR VALIGN="top">
<TD width=58%><B>   );</B></TD>
<TD width=42%>&nbsp;</TD>
</TR>
</TABLE><BR>

<P></P>

<P><B>Parameters</B></P>

<P><I>lpServiceName</I></P>

<P>Points to a null-terminated string that names the service run by the calling thread. This is the service name that was specified in the <B>CreateService</B> function when the service was created. </P>

<P><I>lpHandlerProc</I></P>

<P>Points to the <B>Handler</B> function to be registered. </P>

<P></P>

<P><B>Return Values</B></P>

<P>If the function succeeds, the return value is a service status handle.</P>

<P>If the function fails, the return value is zero. To get extended error information, call <A HREF="11c2vs7.htm"><B>GetLastError</B></A>. </P>

<P><B>Errors</B></P>

<P>The following error codes may be set by the service control manager. Other error codes may be set by the registry functions that are called by the service control manager. </P>

<TABLE cols=2>

<TR VALIGN="top">
<TD width=53%><B>Value</B></TD>
<TD width=47%><B>Meaning</B></TD>
</TR>

<TR VALIGN="top">
<TD width=53%>ERROR_INVALID_NAME</TD>
<TD width=47%>The specified service name is invalid.</TD>
</TR>

<TR VALIGN="top">
<TD width=53%>ERROR_SERVICE_DOES_NOT_EXIST</TD>
<TD width=47%>The specified service does not exist.</TD>
</TR>
</TABLE><BR>

<P></P>

<P><B>Remarks</B></P>

<P>The <A HREF="y7r.4o.htm"><B>ServiceMain</B></A> function of a new service should immediately call the <B>RegisterServiceCtrlHandler</B> function to register a control handling function with the control dispatcher. This enables the control dispatcher to invoke the specified function when it receives control requests for this service. The threads of the calling process can use the service status handle returned by this function to identify the service in subsequent calls to the <A HREF="u71xdk.htm"><B>SetServiceStatus</B></A> function. </P>

<P>This function must be called before the first <B>SetServiceStatus</B> call because it returns a service status handle for the caller to use so that no other service can inadvertently set this service's status, which is maintained by the service control manager. It also needs to be called before the first <B>SetServiceStatus</B> so that a control handler is in place to field control requests by the time the service specifies the controls it accepts through the <B>SetServiceStatus</B> function. </P>

<P>When the control handler function is invoked with a control request, it must call <B>SetServiceStatus</B> to notify the service control manager of its latest status, regardless of whether the status of the service has changed. </P>

<P>The service status handle does not have to be closed. </P>

<P><B>See Also</B></P>

<P><A HREF="2wng26.htm"><B>CreateService</B></A>, <A HREF="1eqr9ip.htm"><B>Handler</B></A>, <A HREF="y7r.4o.htm"><B>ServiceMain</B></A>, <A HREF="u71xdk.htm"><B>SetServiceStatus</B></A> </P>

<P></P>

<P></P>

</BODY>
</HTML>
