<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>ToUnicodeEx</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="1dmkfm2"></A><B>ToUnicodeEx</B></P>

<P>The <B>ToUnicodeEx</B> function translates the specified virtual-key code and keyboard state to the corresponding Unicode character or characters. </P>

<P><B>int ToUnicodeEx(</B></P>

<TABLE cols=2 width=403>

<TR VALIGN="top">
<TD width=41%><B>UINT</B> <I>wVirtKey</I><B>,</B></TD>
<TD width=59%>// virtual-key code</TD>
</TR>

<TR VALIGN="top">
<TD width=41%><B>    UINT</B> <I>wScanCode</I><B>,</B></TD>
<TD width=59%>// scan code</TD>
</TR>

<TR VALIGN="top">
<TD width=41%><B>    PBYTE</B> <I>lpKeyState</I><B>,</B></TD>
<TD width=59%>// address of key-state array</TD>
</TR>

<TR VALIGN="top">
<TD width=41%><B>    LPWSTR</B> <I>pwszBuff</I><B>,</B></TD>
<TD width=59%>// buffer for translated key</TD>
</TR>

<TR VALIGN="top">
<TD width=41%><B>    int</B> <I>cchBuff</I><B>,</B></TD>
<TD width=59%>// size of translated key buffer</TD>
</TR>

<TR VALIGN="top">
<TD width=41%><B>    UINT</B> <I>wFlags</I>,</TD>
<TD width=59%>// set of function-conditioning flags</TD>
</TR>

<TR VALIGN="top">
<TD width=41%><B>    HKL </B><I>dwhkl</I></TD>
<TD width=59%>// keyboard layout handle</TD>
</TR>

<TR VALIGN="top">
<TD width=41%><B>   );</B></TD>
<TD width=59%>&nbsp;</TD>
</TR>
</TABLE><BR>

<P></P>

<P><B>Parameters</B></P>

<P><I>wVirtKey</I></P>

<P>Specifies the virtual-key code to be translated. </P>

<P><I>wScanCode</I></P>

<P>Specifies the hardware scan code of the key to be translated. The high-order bit of this value is set if the key is up. </P>

<P><I>lpKeyState</I></P>

<P>Points to a 256-byte array that contains the current keyboard state. Each element (byte) in the array contains the state of one key. If the high-order bit of a byte is set, the key is down. </P>

<P><I>pwszBuff</I></P>

<P>Points to the buffer that receives the translated Unicode character or characters. </P>

<P><I>cchBuff</I></P>

<P>Specifies the size in characters of the buffer pointed to by the <I>pwszBuff </I>parameter. </P>

<P><I>wFlags</I></P>

<P>A set of bit flags that condition the behavior of the function. Set bit 0 if a menu is active. Bits 1 through 31 are reserved. </P>

<P><I>dwhkl</I></P>

<P>Identifies the keyboard layout to use to translate the given code. This parameter can be any keyboard layout handle previously returned by the <A HREF="kivx9c.htm"><B>LoadKeyboardLayout</B></A> function.</P>

<P></P>

<P><B>Return Values</B></P>

<P>The function returns one of the following values: </P>

<TABLE cols=2>

<TR VALIGN="top">
<TD width=17%><B>Value</B></TD>
<TD width=83%><B>Meaning</B></TD>
</TR>

<TR VALIGN="top">
<TD width=17%>  - 1</TD>
<TD width=83%>The specified virtual key is a dead-key character (accent or diacritic). This value is returned regardless of the keyboard layout, even if several characters have been typed and are stored in the keyboard state. If possible, even with Unicode keyboard layouts, the function has written a spacing version of the dead-key character to the buffer specified by <I>pwszBuffer</I>. For example, the function writes the character SPACING ACUTE (0x00B4), rather than the character NON_SPACING ACUTE (0x0301).</TD>
</TR>

<TR VALIGN="top">
<TD width=17%>0</TD>
<TD width=83%>The specified virtual key has no translation for the current state of the keyboard. Nothing was written to the buffer specified by <I>pwszBuffer</I>.</TD>
</TR>

<TR VALIGN="top">
<TD width=17%>1</TD>
<TD width=83%>One character was written to the buffer specified by <I>pwszBuffer</I>.</TD>
</TR>

<TR VALIGN="top">
<TD width=17%>2 or more</TD>
<TD width=83%>Two or more characters were written to the buffer specified by <I>pwszBuff</I>. The most common cause for this is that a dead-key character (accent or diacritic) stored in the keyboard layout could not be combined with the specified virtual key to form a single character.</TD>
</TR>
</TABLE><BR>

<P></P>

<P><B>Remarks</B></P>

<P>The parameters supplied to the <B>ToUnicodeEx</B> function might not be sufficient to translate the virtual-key code because a previous dead key is stored in the keyboard layout. </P>

<P>Typically, <B>ToUnicodeEx</B> performs the translation based on the virtual-key code. In some cases, however, bit 15 of the <I>wScanCode</I> parameter can be used to distinguish between a key press and a key release. </P>

<P><B>See Also</B></P>

<P><A HREF="07h9s4.htm"><B>ToAscii</B></A>, <A HREF="4xkz_dm.htm"><B>ToUnicode</B></A>, <A HREF="2jmizz8.htm"><B>VkKeyScan</B></A> </P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-1');</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
