<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><TITLE>QueryServiceLockStatus</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="dkgkou"></A><B>QueryServiceLockStatus  <A HREF="d_uoc5.htm"><IMG SRC="../images/bm1.gif" ALT="" BORDER=0></A>  <A HREF="12c8zrk.htm"><IMG SRC="../images/bm3.gif" ALT="" BORDER=0></A>  <A HREF="we4jtq.htm"><IMG SRC="../images/bm2.gif" ALT="" BORDER=0></A></B></P>

<P>The <B>QueryServiceLockStatus</B> function retrieves the lock status of the specified service control manager database. </P>

<P><B>BOOL QueryServiceLockStatus(</B></P>

<TABLE cols=2 width=629>

<TR VALIGN="top">
<TD width=58%><B>SC_HANDLE</B> <I>hSCManager</I><B>,</B></TD>
<TD width=42%>// handle of svc. ctrl. mgr. database </TD>
</TR>

<TR VALIGN="top">
<TD width=58%><B>    LPQUERY_SERVICE_LOCK_STATUS</B> <I>lpLockStatus</I><B>,</B></TD>
<TD width=42%>// address of lock status structure </TD>
</TR>

<TR VALIGN="top">
<TD width=58%><B>    DWORD</B> <I>cbBufSize</I><B>,</B></TD>
<TD width=42%>// size of service configuration buffer </TD>
</TR>

<TR VALIGN="top">
<TD width=58%><B>    LPDWORD</B> <I>pcbBytesNeeded</I> </TD>
<TD width=42%>// address of variable for bytes needed </TD>
</TR>

<TR VALIGN="top">
<TD width=58%><B>   );</B></TD>
<TD width=42%>&nbsp;</TD>
</TR>
</TABLE><BR>

<P></P>

<P><B>Parameters</B></P>

<P><I>hSCManager</I></P>

<P>Identifies the service control manager database. The <A HREF="nbxjug.htm"><B>OpenSCManager</B></A> function returns this handle, which must have SC_MANAGER_QUERY_LOCK_STATUS access.</P>

<P><I>lpLockStatus</I></P>

<P>Points to a <A HREF="11r1mpj.htm"><B>QUERY_SERVICE_LOCK_STATUS</B></A> structure in which the lock status of the specified database is returned. </P>

<P><I>cbBufSize</I></P>

<P>Specifies the size, in bytes, of the buffer pointed to by the <I>lpLockStatus</I> parameter. </P>

<P><I>pcbBytesNeeded</I></P>

<P>Points to a variable that receives the number of bytes needed to return all the lock status information. </P>

<P></P>

<P><B>Return Values</B></P>

<P>If the function succeeds, the return value is nonzero.</P>

<P>If the function fails, the return value is zero. To get extended error information, call <A HREF="11c2vs7.htm"><B>GetLastError</B></A>. </P>

<P><B>Errors</B></P>

<P>The following error codes may be set by the service control manager. Other error codes may be set by the registry functions that are called by the service control manager. </P>

<TABLE cols=6>

<TR VALIGN="top">
<TD colspan=2 width=11%><B>Value</B></TD>
<TD colspan=3 width=76%><B>Meaning</B></TD>
</TR>

<TR VALIGN="top">
<TD colspan=3 width=12%>ERROR_ACCESS_DENIED</TD>
<TD colspan=3 width=88%>&nbsp;</TD>
</TR>

<TR VALIGN="top">
<TD width=10%>&nbsp;</TD>
<TD colspan=3 width=66%>The specified handle was not opened with SC_MANAGER_QUERY_LOCK_STATUS access.</TD>
</TR>

<TR VALIGN="top">
<TD colspan=3 width=12%>ERROR_INSUFFICIENT_BUFFER</TD>
<TD colspan=3 width=88%>&nbsp;</TD>
</TR>

<TR VALIGN="top">
<TD width=10%>&nbsp;</TD>
<TD colspan=3 width=66%>There is more lock status information than would fit into the <I>lpLockStatus</I> buffer. The number of bytes required to get all the information is returned in the <I>pcbBytesNeeded</I> parameter. Nothing is written to the <I>lpLockStatus</I> buffer.</TD>
</TR>

<TR VALIGN="top">
<TD colspan=3 width=12%>ERROR_INVALID_HANDLE</TD>
<TD colspan=3 width=88%>&nbsp;</TD>
</TR>

<TR VALIGN="top">
<TD width=10%>&nbsp;</TD>
<TD colspan=3 width=66%>The specified handle is invalid.</TD>
</TR>
</TABLE><BR>

<P></P>

<P><B>Remarks</B></P>

<P>The <B>QueryServiceLockStatus</B> function returns a <B>QUERY_SERVICE_LOCK_STATUS</B> structure that indicates whether the specified database is locked. If the database is locked, the structure provides the account name of the user that holds the lock and the length of time that the lock has been held. </P>

<P>A process calls the <A HREF="23k5hc.htm"><B>LockServiceDatabase</B></A> function to lock a service control manager database and the <A HREF="a6b4as.htm"><B>UnlockServiceDatabase</B></A> function to release the lock. </P>

<P>The <I>lpLockStatus</I> buffer must be large enough to hold the string pointed to by the <B>lpLockOwner</B> member of the <B>QUERY_SERVICE_LOCK_STATUS</B> structure. </P>

<P><B>See Also</B></P>

<P><A HREF="23k5hc.htm"><B>LockServiceDatabase</B></A>, <A HREF="nbxjug.htm"><B>OpenSCManager</B></A>, <A HREF="11r1mpj.htm"><B>QUERY_SERVICE_LOCK_STATUS</B></A>, <A HREF="a6b4as.htm"><B>UnlockServiceDatabase</B></A> </P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-1');</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
