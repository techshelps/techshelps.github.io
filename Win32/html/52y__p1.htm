<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Initiating a Data Link with the Paste Link Command</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="52y__p1"></A><B>Initiating a Data Link with the Paste Link Command</B></P>

<P>Applications that support hot or warm data links typically support a registered clipboard format named Link. When associated with the application's Copy and Paste Link commands, this clipboard format enables the user to establish DDE conversations between applications simply by copying a data item in the server application and pasting it into the client application. </P>

<P>A server application supports the Link clipboard format by placing in the clipboard a string containing the application, topic, and item names when the user chooses the Copy command from the Edit menu. Following is the standard Link format: </P>

<P><I>application</I><B>\0</B><I>topic</I><B>\0</B><I>item</I><B>\0\0</B></P>

<P>A single null character separates the names, and two null characters terminate the entire string. </P>

<P>Both the client and server applications must register the Link clipboard format, as shown: </P>

<P>cfLink = RegisterClipboardFormat("Link");  </P>

<P></P>

<P>A client application supports the Link clipboard format by means of a Paste Link command on its Edit menu. When the user chooses this command, the client application parses the application, topic, and item names from the Link-format clipboard data. Using these names, the client application initiates a conversation for the application and topic, if such a conversation does not already exist. The client application then sends a <A HREF="1fmiugc.htm">WM_DDE_ADVISE</A> message to the server application, specifying the item name contained in the Link-format clipboard data. </P>

<P>Following is an example of a client application's response when the user chooses the Paste Link command. </P>

<P>void DoPasteLink(hwndClientDDE)  </P>

<P>HWND hwndClientDDE; </P>

<P>{ </P>

<P>HANDLE hData; </P>

<P>LPSTR lpData; </P>

<P>HWND hwndServerDDE; </P>

<P>CHAR szApplication[APP_MAX_SIZE + 1]; </P>

<P>CHAR szTopic[TOPIC_MAX_SIZE + 1]; </P>

<P>CHAR szItem[ITEM_MAX_SIZE + 1]; </P>

<P>int nBufLen; </P>

<P></P>

<P>if (OpenClipboard(hwndClientDDE)) { </P>

<P>if (!(hData = GetClipboardData(cfLink)) || </P>

<P>!(lpData = GlobalLock(hData))) { </P>

<P>CloseClipboard(); </P>

<P>return; </P>

<P>} </P>

<P></P>

<P>/* Parse the clipboard data. */ </P>

<P></P>

<P>if ((nBufLen = lstrlen(lpData)) &gt;= APP_MAX_SIZE) { </P>

<P>CloseClipboard(); </P>

<P>GlobalUnlock(hData); </P>

<P>return; </P>

<P>} </P>

<P>lstrcpy(szApplication, lpData); </P>

<P>lpData += (nBufLen + 1); /* skips over null */ </P>

<P>if ((nBufLen = lstrlen(lpData)) &gt;= TOPIC_MAX_SIZE) { </P>

<P>CloseClipboard(); </P>

<P>GlobalUnlock(hData); </P>

<P>return; </P>

<P>} </P>

<P>lstrcpy(szTopic, lpData); </P>

<P>lpData += (nBufLen + 1); /* skips over null */ </P>

<P>if ((nBufLen = lstrlen(lpData)) &gt;= ITEM_MAX_SIZE) { </P>

<P>CloseClipboard(); </P>

<P>GlobalUnlock(hData); </P>

<P>return; </P>

<P>} </P>

<P>lstrcpy(szItem, lpData); </P>

<P>GlobalUnlock(hData); </P>

<P>CloseClipboard(); </P>

<P></P>

<P>if (hwndServerDDE = </P>

<P>FindServerGivenAppTopic(szApplication, szTopic)) { </P>

<P></P>

<P>/* App/topic conversation is already started. */ </P>

<P></P>

<P>if (DoesAdviseAlreadyExist(hwndServerDDE, szItem)) </P>

<P>MessageBox(hwndMain, </P>

<P>"Advisory already established", </P>

<P>"Client", MB_ICONEXCLAMATION | MB_OK); </P>

<P>else </P>

<P>SendAdvise(hwndClientDDE, hwndServerDDE, szItem); </P>

<P>} </P>

<P>else { </P>

<P></P>

<P>/* Client must initiate a new conversation first. */ </P>

<P></P>

<P>SendInitiate(szApplication, szTopic); </P>

<P>if (hwndServerDDE = </P>

<P>FindServerGivenAppTopic(szApplication, </P>

<P>szTopic)) </P>

<P>SendAdvise(hwndClientDDE, hwndServerDDE, szItem); </P>

<P>} </P>

<P>} </P>

<P>return; </P>

<P>} </P>

<P></P>

<P>In this example, the client application opens the clipboard and determines whether it contains data in the Link format (that is, cfLink) it had previously registered. If not, or if it cannot lock the data in the clipboard, the client returns. </P>

<P>After the client application retrieves a pointer to the clipboard data, it parses the data to extract the application, topic, and item names. </P>

<P>The client application determines whether a conversation on the topic already exists between it and the server application. If a conversation does exist, the client checks whether a link already exists for the data item. If such a link exists, the client displays a message box to the user; otherwise, it calls its own SendAdvise function to send a <A HREF="1fmiugc.htm">WM_DDE_ADVISE</A> message to the server for the item. </P>

<P>If a conversation on the topic does not already exist between the client and the server, the client first calls its own SendInitiate function to broadcast the <A HREF="1x_rzry.htm">WM_DDE_INITIATE</A> message to request a conversation and, second, calls its own FindServerGivenAppTopic function to establish the conversation with the window that responds on behalf of the server application. After the conversation has begun, the client application calls SendAdvise to request the link. </P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-1');</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
