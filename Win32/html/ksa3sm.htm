<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>ConnectNamedPipe</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="ksa3sm"></A><B>ConnectNamedPipe  <A HREF="_v.ug1.htm"><IMG SRC="../images/bm1.gif" ALT="" BORDER=0></A>  <A HREF="qxj_so.htm"><IMG SRC="../images/bm3.gif" ALT="" BORDER=0></A>  <A HREF="1p87g2.htm"><IMG SRC="../images/bm2.gif" ALT="" BORDER=0></A></B></P>

<P>The <B>ConnectNamedPipe</B> function enables a named pipe server process to wait for a client process to connect to an instance of a named pipe. A client process connects by calling either the <A HREF="xn35yd.htm"><B>CreateFile</B></A> or <A HREF="6xlg_2.htm"><B>CallNamedPipe</B></A><B> </B>function. </P>

<P><B>BOOL ConnectNamedPipe(</B></P>

<TABLE cols=2 width=486>

<TR VALIGN="top">
<TD width=50%><B>HANDLE</B> <I>hNamedPipe</I><B>,</B></TD>
<TD width=50%>// handle to named pipe to connect  </TD>
</TR>

<TR VALIGN="top">
<TD width=50%><B>    LPOVERLAPPED</B> <I>lpOverlapped</I> </TD>
<TD width=50%>// pointer to overlapped structure </TD>
</TR>

<TR VALIGN="top">
<TD width=50%><B>   );</B></TD>
<TD width=50%>&nbsp;</TD>
</TR>
</TABLE><BR>

<P></P>

<P><B>Parameters</B></P>

<P><I>hNamedPipe</I></P>

<P>Identifies the server end of a named pipe instance. This handle is returned by the <A HREF="21dzyt.htm"><B>CreateNamedPipe</B></A> function. </P>

<P><I>lpOverlapped</I></P>

<P>Points to an <A HREF="1n286m5.htm"><B>OVERLAPPED</B></A> structure.</P>

<P></P>

<P><B>Return Values</B></P>

<P>If the function succeeds, the return value is nonzero.</P>

<P>If the function fails, the return value is zero. To get extended error information, call <A HREF="11c2vs7.htm"><B>GetLastError</B></A>. </P>

<P><B>Remarks</B></P>

<P>A named pipe server process can use <B>ConnectNamedPipe</B> with a newly created pipe instance. It can also be used with an instance that was previously connected to another client process; in this case, the server process must first call the <A HREF="2ay12gp.htm"><B>DisconnectNamedPipe</B></A> function to disconnect the handle from the previous client before the handle can be reconnected to a new client. Otherwise, <B>ConnectNamedPipe</B> returns FALSE, and <B>GetLastError</B> returns ERROR_NO_DATA if the previous client has closed its handle or ERROR_PIPE_CONNECTED if it has not closed its handle. </P>

<P>The behavior of <B>ConnectNamedPipe</B> depends on two conditions: whether the pipe handle's wait mode is set to blocking or nonblocking and whether the function is set to execute synchronously or in overlapped mode. A server initially specifies a pipe handle's wait mode in the <A HREF="21dzyt.htm"><B>CreateNamedPipe</B></A> function, and it can be changed by using the <A HREF="ap5lb1.htm"><B>SetNamedPipeHandleState</B></A> function. </P>

<P>If <I>hNamedPipe</I> was opened with FILE_FLAG_OVERLAPPED, the <I>lpOverlapped</I> parameter must not be NULL. It must point to a valid <B>OVERLAPPED</B> structure. If <I>hNamedPipe</I> was opened with FILE_FLAG_OVERLAPPED and <I>lpOverlapped</I> is NULL, the function can incorrectly report that the connect operation is complete.</P>

<P>If <I>hNamedPipe</I> was created with FILE_FLAG_OVERLAPPED and <I>lpOverlapped</I> is not NULL, the <A HREF="1n286m5.htm"><B>OVERLAPPED</B></A> structure pointed to by <I>lpOverlapped</I> must contain a handle to a manual-reset event object (which the server can create by using the <A HREF="j_zbjv.htm"><B>CreateEvent</B></A> function). </P>

<P>If <I>hNamedPipe</I> was not opened with FILE_FLAG_OVERLAPPED and <I>lpOverlapped</I> is NULL, the function does not return until a client is connected or an error occurs. Successful synchronous operations result in the function returning TRUE if a client connects after the function is called. If a client connects before the function is called, the function returns FALSE and <B>GetLastError</B> returns ERROR_PIPE_CONNECTED. This can happen if a client connects in the interval between the call to <B>CreateNamedPipe</B> and the call to <B>ConnectNamedPipe</B>. In this situation, there is a good connection between client and server, even though the function returns FALSE.</P>

<P>If <I>hNamedPipe</I> was not opened with FILE_FLAG_OVERLAPPED and <I>lpOverlapped</I> is not NULL, the operation executes asynchronously. The function returns immediately with a return value of FALSE. If a client process connects before the function is called, <B>GetLastError</B> returns ERROR_PIPE_CONNECTED. Otherwise, <B>GetLastError</B> returns ERROR_IO_PENDING, which indicates that the operation is executing in the background. When this happens, the event object in the <A HREF="1n286m5.htm"><B>OVERLAPPED</B></A> structure is set to the nonsignaled state before <B>ConnectNamedPipe</B> returns, and it is set to the signaled state when a client connects to this instance of the pipe. </P>

<P>The server process can use any of the <A HREF="y2tc_3.htm">wait functions</A>  or <A HREF="fmres8.htm"><B>SleepEx</B></A> ¾ to determine when the state of the event object is signaled, and it can then use the <A HREF="kcz7oz.htm"><B>GetOverlappedResult</B></A> function to determine the results of the <B>ConnectNamedPipe</B> operation. </P>

<P>If the specified pipe handle is in nonblocking mode, <B>ConnectNamedPipe</B> always returns immediately. In nonblocking mode, <B>ConnectNamedPipe</B> returns TRUE the first time it is called for a pipe instance that is disconnected from a previous client. This indicates that the pipe is now available to be connected to a new client process. In all other situations when the pipe handle is in nonblocking mode, <B>ConnectNamedPipe</B> returns FALSE. In these situations, <B>GetLastError</B> returns ERROR_PIPE_LISTENING if no client is connected, ERROR_PIPE_CONNECTED if a client is connected, and ERROR_NO_DATA if a previous client has closed its pipe handle but the server has not disconnected. Note that a good connection between client and server exists only after the ERROR_PIPE_CONNECTED error is received. </P>

<P>Note that nonblocking mode is supported for compatibility with Microsoft LAN Manager version 2.0, and it should not be used to achieve asynchronous input and output (I/O) with named pipes. </P>

<P><B>See Also</B></P>

<P><A HREF="6xlg_2.htm"><B>CallNamedPipe</B></A>, <A HREF="j_zbjv.htm"><B>CreateEvent</B></A>, <A HREF="xn35yd.htm"><B>CreateFile</B></A>, <A HREF="21dzyt.htm"><B>CreateNamedPipe</B></A>, <A HREF="2ay12gp.htm"><B>DisconnectNamedPipe</B></A>, <A HREF="kcz7oz.htm"><B>GetOverlappedResult</B></A>, <A HREF="ap5lb1.htm"><B>SetNamedPipeHandleState</B></A>, <A HREF="fmres8.htm"><B>SleepEx</B></A>, <A HREF="1n286m5.htm"><B>OVERLAPPED</B></A> </P>

</BODY>
</HTML>
