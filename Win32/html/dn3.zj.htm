<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Creating a Message Loop</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="dn3.zj"></A><B>Creating a Message Loop</B></P>

<P>Windows automatically creates a message queue for each thread. If the thread creates one or more windows, a message loop must be provided; this message loop retrieves messages from the thread's message queue and dispatches them to the appropriate window procedures. </P>

<P>Because Windows directs messages to individual windows in an application, a thread must create at least one window before starting its message loop. Most Windows-based applications contain a single thread that creates windows. A typical application registers the window class for its main window, creates and shows the main window, and then starts its message loop ¾ all in the <A HREF="12si984.htm"><B>WinMain</B></A> function. </P>

<P>You create a message loop by using the <A HREF="ixkdtp.htm"><B>GetMessage</B></A> and <A HREF="20gx08e.htm"><B>DispatchMessage</B></A> functions. If your application must obtain character input from the user, include the <A HREF="fhwolf.htm"><B>TranslateMessage</B></A> function in the loop. <B>TranslateMessage</B> translates virtual-key messages into character messages. The following example shows the message loop in the <B>WinMain</B> function of a simple Win32-based application. </P>

<P>HINSTANCE hinst;  </P>

<P>HWND hwndMain; </P>

<P></P>

<P>int PASCAL WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, </P>

<P>LPSTR lpszCmdLine, int nCmdShow) </P>

<P>{ </P>

<P>MSG msg; </P>

<P>WNDCLASS wc; </P>

<P>UNREFERENCED_PARAMETER(lpszCmdLine); </P>

<P></P>

<P>// Register the window class for the main window. </P>

<P></P>

<P>if (!hPrevInstance) </P>

<P>{ </P>

<P>wc.style = 0; </P>

<P>wc.lpfnWndProc = (WNDPROC) WndProc; </P>

<P>wc.cbClsExtra = 0; </P>

<P>wc.cbWndExtra = 0; </P>

<P>wc.hInstance = hInstance; </P>

<P>wc.hIcon = LoadIcon((HINSTANCE) NULL, </P>

<P>IDI_APPLICATION); </P>

<P>wc.hCursor = LoadCursor((HINSTANCE) NULL, </P>

<P>IDC_ARROW); </P>

<P>wc.hbrBackground = GetStockObject(WHITE_BRUSH); </P>

<P>wc.lpszMenuName =  "MainMenu"; </P>

<P>wc.lpszClassName = "MainWndClass"; </P>

<P></P>

<P>if (!RegisterClass(&amp;wc)) </P>

<P>return FALSE; </P>

<P>} </P>

<P></P>

<P>hinst = hInstance;  // save instance handle </P>

<P></P>

<P>// Create the main window. </P>

<P></P>

<P>hwndMain = CreateWindow("MainWndClass", "Sample", </P>

<P>WS_OVERLAPPEDWINDOW, CW_USEDEFAULT, CW_USEDEFAULT, </P>

<P>CW_USEDEFAULT, CW_USEDEFAULT, (HWND) NULL, </P>

<P>(HMENU) NULL, hinst, (LPVOID) NULL); </P>

<P></P>

<P>// If the main window cannot be created, terminate </P>

<P>// the application. </P>

<P></P>

<P>if (!hwndMain) </P>

<P>return FALSE; </P>

<P></P>

<P>// Show the window and paint its contents. </P>

<P></P>

<P>ShowWindow(hwndMain, nCmdShow); </P>

<P>UpdateWindow(hwndMain); </P>

<P></P>

<P>// Start the message loop. </P>

<P></P>

<P>while (GetMessage(&amp;msg, (HWND) NULL, 0, 0)) </P>

<P>{ </P>

<P>TranslateMessage(&amp;msg); </P>

<P>DispatchMessage(&amp;msg); </P>

<P>} </P>

<P></P>

<P>// Return the exit code to Windows. </P>

<P></P>

<P>return msg.wParam; </P>

<P>} </P>

<P></P>

<P>The following example shows a message loop for a thread that uses accelerators and displays a modeless dialog box. When <B>TranslateAccelerator</B> or <B>IsDialogMessage</B> returns TRUE (indicating that the message has been processed), <B>TranslateMessage</B> and <B>DispatchMessage</B> are not called. The reason for this is that <B>TranslateAccelerator</B> and <B>IsDialogMessage</B> perform all necessary translating and dispatching of messages. </P>

<P>HWND hwndMain;  </P>

<P>HWND hwndDlgModeless = NULL; </P>

<P>MSG msg; </P>

<P>HACCEL haccel; </P>

<P>// </P>

<P>// Perform initialization and create a main window. </P>

<P>// </P>

<P></P>

<P>while (GetMessage(&amp;msg, (HWND) NULL, 0, 0)) </P>

<P>{ </P>

<P>if (hwndDlgModeless == (HWND) NULL || </P>

<P>!IsDialogMessage(hwndDlgModeless, &amp;msg) &amp;&amp; </P>

<P>!TranslateAccelerator(hwndMain, haccel, </P>

<P>&amp;msg)) </P>

<P>{ </P>

<P>TranslateMessage(&amp;msg); </P>

<P>DispatchMessage(&amp;msg); </P>

<P>} </P>

<P>} </P>

<P></P>

</BODY>
</HTML>
