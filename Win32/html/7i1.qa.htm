<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Reading the Event Log</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="7i1.qa"></A><B>Reading the Event Log</B></P>

<P>The following code sample reads all the records in the <B>Application</B> logfile and displays the <A HREF="lf4goi.htm">event identifier</A>, event type, and source name for each event log entry. </P>

<P>EVENTLOGRECORD *pevlr;  </P>

<P>BYTE bBuffer[BUFFER_SIZE]; </P>

<P>DWORD dwRead, dwNeeded, cRecords, dwThisRecord = 0; </P>

<P></P>

<P>/* Open the Application event log. */ </P>

<P></P>

<P>h = OpenEventLog(NULL,  /* uses local computer      */ </P>

<P>"Application");     /* source name              */ </P>

<P>if (h == NULL) </P>

<P>ErrorExit("could not open Application event log"); </P>

<P></P>

<P>pevlr = (EVENTLOGRECORD *) &amp;bBuffer; </P>

<P></P>

<P>/* </P>

<P>* Opening the event log positions the file pointer </P>

<P>* for this handle at the beginning of the log. </P>

<P>* </P>

<P>* Read records sequentially until there </P>

<P>* are no more. </P>

<P>*/ </P>

<P></P>

<P>while (ReadEventLog(h,                /* event log handle */ </P>

<P>EVENTLOG_FORWARDS_READ |  /* reads forward    */ </P>

<P>EVENTLOG_SEQUENTIAL_READ, /* sequential read  */ </P>

<P>0,            /* ignored for sequential reads */ </P>

<P>pevlr,        /* address of buffer            */ </P>

<P>BUFFER_SIZE,  /* size of buffer               */ </P>

<P>&amp;dwRead,      /* count of bytes read          */ </P>

<P>&amp;dwNeeded)) { /* bytes in next record         */ </P>

<P></P>

<P>while (dwRead &gt; 0) { </P>

<P></P>

<P>/* </P>

<P>* Print the event ID, type, and source name. </P>

<P>* The source name is just past the end of the </P>

<P>* formal structure. </P>

<P>*/ </P>

<P></P>

<P>printf("%02d  Event ID: 0x%08X ", </P>

<P>dwThisRecord++, pevlr-&gt;EventID); </P>

<P>printf("EventType: %d Source: %s\n", </P>

<P>pevlr-&gt;EventType, (LPSTR) ((LPBYTE) pevlr + </P>

<P>sizeof(EVENTLOGRECORD))); </P>

<P></P>

<P>dwRead -= pevlr-&gt;Length; </P>

<P>pevlr = (EVENTLOGRECORD *) </P>

<P>((LPBYTE) pevlr + pevlr-&gt;Length); </P>

<P>} </P>

<P></P>

<P>pevlr = (EVENTLOGRECORD *) &amp;bBuffer; </P>

<P>} </P>

<P></P>

<P>CloseEventLog(h); </P>

<P></P>

</BODY>
</HTML>
