<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Queued Messages</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="xpatj"></A><B>Queued Messages</B></P>

<P>Windows can display any number of windows at a time. To route mouse and keyboard input to the appropriate window, Windows uses message queues. </P>

<P>Windows maintains a single system message queue and any number of thread message queues, one for each GUI thread. To avoid the overhead of creating a message queue for non-GUI threads, all threads are created initially without a message queue. The system creates a thread's message queue only when the thread makes its first call to one of the Win32 API User or GDI functions.</P>

<P>Whenever the user moves the mouse, clicks the mouse buttons, or types on the keyboard, the device driver for the mouse or keyboard converts the input into messages and places them in the system message queue. Windows removes the messages, one at a time, from the system message queue, examines them to determine the destination window, and then posts them to the message queue of the thread that created the destination window. A thread's message queue receives all mouse and keyboard messages for the windows created by the thread. The thread removes messages from its queue and directs Windows to send them to the appropriate window procedure for processing. </P>

<P>With the exception of the <A HREF="f55xz2.htm">WM_PAINT</A> message, Windows always posts messages at the end of a message queue. This ensures that a window receives its input messages in the proper first-in, first-out (FIFO) sequence. The WM_PAINT message, however, is kept in the queue and is forwarded to the window procedure only when the queue contains no other messages. Multiple WM_PAINT messages for the same window are combined into a single WM_PAINT message, consolidating all invalid parts of the client area into a single area. Combining WM_PAINT messages reduces the number of times a window must redraw the contents of its client area. </P>

<P>The system posts a message to a thread's message queue by filling an <A HREF="5ctef1.htm"><B>MSG</B></A> structure and then copying it to the message queue. Information in <B>MSG</B> includes: the handle of the window for which the message is intended, the message identifier, the two message parameters, the time the message was posted, and the mouse cursor position. A thread can post a message to its own message queue or to the queue of another thread by using the <A HREF="fixdt_.htm"><B>PostMessage</B></A> or <A HREF="4oachi.htm"><B>PostThreadMessage</B></A> function. </P>

<P>An application can remove a message from its queue by using the <A HREF="ixkdtp.htm"><B>GetMessage</B></A> function. To examine a message without removing it from its queue, an application can use the <A HREF="0x9xxx.htm"><B>PeekMessage</B></A> function. This function fills <B>MSG</B> with information about the message. </P>

<P>After removing a message from its queue, an application can use the <A HREF="20gx08e.htm"><B>DispatchMessage</B></A> function to direct Windows to send the message to a window procedure for processing. <B>DispatchMessage</B> takes a pointer to <B>MSG</B> that was filled by a previous call to the <B>GetMessage</B> or <B>PeekMessage</B> function. <B>DispatchMessage</B> passes the window handle, the message identifier, and the two message parameters to the window procedure, but it does not pass the time the message was posted or mouse cursor position. An application can retrieve this information by calling the <A HREF="01ho0q.htm"><B>GetMessageTime</B></A> and <A HREF="1fcp0th.htm"><B>GetMessagePos</B></A> functions while processing a message. </P>

<P>A thread can use the <A HREF="l7ad9v.htm"><B>WaitMessage</B></A> function to yield control to other threads when it has no messages in its message queue. The function suspends the thread and does not return until a new message is placed in the thread's message queue. </P>

<P>You can call the <A HREF="2.r.hjp.htm"><B>SetMessageExtraInfo</B></A> function to associate a 32-bit value with the current thread's message queue. Then call the <A HREF="3p040hc.htm"><B>GetMessageExtraInfo</B></A> function to get the value associated with the last message retrieved by the <A HREF="ixkdtp.htm"><B>GetMessage</B></A> or <A HREF="0x9xxx.htm"><B>PeekMessage</B></A> function. </P>

</BODY>
</HTML>
