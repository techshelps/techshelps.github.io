<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>GetCharacterPlacement [Now Supported on Windows NT]</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="_hoyjx"></A><B>GetCharacterPlacement  <A HREF="13dh94t.htm"><IMG SRC="../images/bm1.gif" ALT="" BORDER=0></A>  <A HREF="4jd_z5i.htm"><IMG SRC="../images/bm3.gif" ALT="" BORDER=0></A>  <A HREF="1xkvu5n.htm"><IMG SRC="../images/bm2.gif" ALT="" BORDER=0></A></B></P>

<P>[Now Supported on Windows NT]</P>

<P>The <B>GetCharacterPlacement</B> function retrieves information about a character string, such as character widths, caret positioning, ordering within the string, and glyph rendering. The type of information returned depends on the <I>dwFlags</I> parameter and is based on the currently selected font in the given display context. The function copies the information to the specified <A HREF="_fmavo.htm"><B>GCP_RESULTS</B></A> structure or to one or more arrays specified by the structure.</P>

<P><B>DWORD</B> <B>GetCharacterPlacement(</B></P>

<TABLE cols=2 width=490>

<TR VALIGN="top">
<TD width=47%><B>HDC</B> <I>hdc</I><B>,</B></TD>
<TD width=53%>// handle to device context</TD>
</TR>

<TR VALIGN="top">
<TD width=47%><B>    LPCTSTR</B> <I>lpString</I><B>,</B></TD>
<TD width=53%>// pointer to string</TD>
</TR>

<TR VALIGN="top">
<TD width=47%><B>    int </B><I>nCount</I><B>,</B></TD>
<TD width=53%>// number of characters in string</TD>
</TR>

<TR VALIGN="top">
<TD width=47%><B>    int </B><I>nMaxExtent</I><B>,</B></TD>
<TD width=53%>// maximum extent for displayed string</TD>
</TR>

<TR VALIGN="top">
<TD width=47%><B>    LPGCP_RESULTS </B><I>*lpResults</I><B>,</B></TD>
<TD width=53%>// pointer to buffer for placement result</TD>
</TR>

<TR VALIGN="top">
<TD width=47%><B>    DWORD </B><I>dwFlags</I></TD>
<TD width=53%>// placement flags</TD>
</TR>

<TR VALIGN="top">
<TD width=47%><B>   );</B></TD>
<TD width=53%>&nbsp;</TD>
</TR>
</TABLE><BR>

<P></P>

<P><B>Parameters</B></P>

<P><I>hdc</I></P>

<P>Identifies the device context.</P>

<P><I>lpString</I></P>

<P>Points to the character string to process.</P>

<P><I>nCount</I></P>

<P>Specifies the number of characters in the string.</P>

<P><I>nMaxExtent</I></P>

<P>Specifies the maximum extent (in logical units) to which the string is processed. Characters that, if processed, would exceed this extent are ignored. Computations for any required ordering or glyph arrays apply only to the included characters. This parameter is used only if the GCP_MAXEXTENT value is given in the <I>dwFlags</I> parameter. As the function processes the input string, each character and its extent is added to the output, extent, and other arrays only if the total extent has not yet exceeded the maximum. Once the limit is reached, processing will stop.</P>

<P><I>lpResults</I></P>

<P>Points to a <A HREF="_fmavo.htm"><B>GCP_RESULTS</B></A> structure that receives the results of the function.</P>

<P><I>dwFlags</I></P>

<P>Specifies how to process the string into the required arrays. This parameter can be one or more of the following values:</P>

<TABLE cols=2>

<TR VALIGN="top">
<TD width=41%><B>Value</B></TD>
<TD width=59%><B>Meaning</B></TD>
</TR>

<TR VALIGN="top">
<TD width=41%>GCP_CLASSIN</TD>
<TD width=59%>Specifies that the <B>lpClass</B> array contains preset classifications for characters. The classifications may be the same as on output. If the particular classification for a character is not known, the corresponding location in the array must be set to zero. for more information about the classifications, see GCP_RESULTS. This is useful only if <A HREF="1_h0udu.htm"><B>GetFontLanguageInfo</B></A> returned the GCP_REORDER flag.</TD>
</TR>

<TR VALIGN="top">
<TD width=41%>GCP_DIACRITIC</TD>
<TD width=59%>Determines how diacritics in the string are handled. If this value is not set, diacritics are treated as zero-width characters. For example, a Hebrew string may contain diacritics, but you may not want to display them. 
<P>Use <B>GetFontLanguageInfo</B> to determine whether a font supports diacritics. If it does, you can use or not use the GCP_DIACRITIC flag in the call to <B>GetCharacterPlacement</B>, depending on the needs of your application. </P>
</TD>
</TR>

<TR VALIGN="top">
<TD width=41%>GCP_DISPLAYZWG</TD>
<TD width=59%>For languages that need reordering or different glyph shapes depending on the positions of the characters within a word, nondisplayable characters often appear in the codepage. For example, in the Hebrew codepage, there are Left-To-Right and Right-To-Left markers, to help determine the final positioning of characters within the output strings. Normally these are not displayed and are removed from the <B>lpGlyphs</B> and <B>lpDx</B> arrays. You can use the GCP_DISPLAYZWG flag to display these characters.</TD>
</TR>

<TR VALIGN="top">
<TD width=41%>GCP_GLYPHSHAPE</TD>
<TD width=59%>Specifies that some or all characters in the string are to be displayed using shapes other than the standard shapes defined in the currently selected font for the current code page. Some languages, such as Arabic, cannot support glyph creation unless this value is given. As a general rule, if <A HREF="1_h0udu.htm"><B>GetFontLanguageInfo</B></A> returns this value for a string, this value <I>must</I> be used with <B>GetCharacterPlacement</B>.</TD>
</TR>

<TR VALIGN="top">
<TD width=41%>GCP_JUSTIFY</TD>
<TD width=59%>Adjusts the extents in the <B>lpDx</B><I> </I>array so that the string length is the same as <I>nMaxExtent</I>. GCP_JUSTIFY may only be used in conjunction with GCP_MAXEXTENT.</TD>
</TR>

<TR VALIGN="top">
<TD width=41%>GCP_JUSTIFYIN</TD>
<TD width=59%>Specifies that the <B>lpDx</B> array contains justification weights on input. Normally, a justification weight can be either 0 or 1, where 1 indicates that the width of the given character can be adjusted for justification. For languages in which <A HREF="1_h0udu.htm"><B>GetFontLanguageInfo</B></A> returns the GCP_KASHIDA flag, the justification weight can be one of the GCP_ARAJUST_* values.</TD>
</TR>

<TR VALIGN="top">
<TD width=41%>GCP_KASHIDA</TD>
<TD width=59%>Use Kashidas as well as, or instead of, adjusted extents to modify the length of the string so that it is equal to the value given by <I>nMaxExtent</I>. In the <B>lpDx</B> array, a Kashida is indicated by a negative justification index. GCP_KASHIDA may be used only in conjunction with GCP_JUSTIFY and only if the font (and language) support Kashidas. Use <B>GetFontLanguageInfo</B> to determine whether the current font supports Kashidas.
<P>Using Kashidas to justifiy the string can result in the number of glyphs required being greater than the number of characters in the input string. Because of this, when Kashidas are used, the application cannot assume that setting the arrays to be the size of the input string will be sufficient. (The <I>maximum </I>possible will be approximately dxPageWidth/dxAveCharWidth, where dxPageWidth is the width of the document and dxAveCharWidth is the average character width as returned from a <A HREF="zd2pdo.htm"><B>GetTextMetrics</B></A> call).</P>

<P>Note that just because <A HREF="1_h0udu.htm"><B>GetFontLanguageInfo</B></A> returns the GCP_KASHIDA flag does not mean that it <I>has</I> to be used in the call to <B>GetCharacterPlacement</B>, just that the option is available.</P>
</TD>
</TR>

<TR VALIGN="top">
<TD width=41%>GCP_LIGATE</TD>
<TD width=59%>Use ligations wherever characters ligate. A ligation occurs where one glyph is used for two or more characters. For example, the letters "a" and "e" can ligate to "æ". For this to be used, however , both the language support and the font must support the required glyphs (the example given will NOT be processed by default in English). 
<P>Use <A HREF="1_h0udu.htm"><B>GetFontLanguageInfo</B></A> to determine whether the current font supports ligation. If it does and a specific maximum is required for the number of characters that will ligate, set the number in the first element of the <B>lpGlyphs</B> array. If normal ligation is required, set this value to zero. If GCP_LIGATE is not given, no ligation will take place. See GCP_RESULTS for more information.</P>

<P>If the GCP_REORDER value is usually required for the character set but is not given, the output will be meaningless unless the string being passed in is already in visual ordering (that is, the result that gets put into <I>lpGcpResults</I>-&gt;<I>lpOutString</I> in one call to <B>GetCharacterPlacement</B> is the input string of a second call). </P>

<P>Note that just because <A HREF="1_h0udu.htm"><B>GetFontLanguageInfo</B></A> returns the GCP_LIGATE flag does not mean that it <I>has</I> to be used in the call to <B>GetCharacterPlacement</B>, just that the option is available. </P>
</TD>
</TR>

<TR VALIGN="top">
<TD width=41%>GCP_MAXEXTENT</TD>
<TD width=59%>Compute extents of the string only as long as the resulting extent, in logical units, does not exceed the values given by the <I>nMaxExtent</I> parameter.</TD>
</TR>

<TR VALIGN="top">
<TD width=41%>GCP_NEUTRALOVERRIDE</TD>
<TD width=59%>Certain languages only. Override the normal handling of neutrals and treat them as strong characters that match the strings reading order. Useful only with the GCP_REORDER flag.</TD>
</TR>

<TR VALIGN="top">
<TD width=41%>GCP_NUMERICOVERRIDE</TD>
<TD width=59%>Certain languages only. Override the normal handling of numerics and treat them as strong characters that match the strings reading order. Useful only with the GCP_REORDER flag.</TD>
</TR>

<TR VALIGN="top">
<TD width=41%>GCP_NUMERICSLATIN</TD>
<TD width=59%>Arabic/Thai only. Use standard Latin glyphs for numbers and override the system default. To determine if this option is available in the language of the font, use <A HREF="z7lv.f.htm"><B>GetStringTypeEx</B></A> to see if the language supports more than one number format.</TD>
</TR>

<TR VALIGN="top">
<TD width=41%>GCP_NUMERICSLOCAL</TD>
<TD width=59%>Arabic/Thai only. Use local glyphs for numeric characters and override the system default. To determine if this option is available in the language of the font, use <B>GetStringTypeEx</B> to see if the language supports more than one number format.</TD>
</TR>

<TR VALIGN="top">
<TD width=41%>GCP_REORDER</TD>
<TD width=59%>Reorder the string. Use for languages that are not SBCS and left-to-right reading order. If this value is not given, the string is assumed to be in display order already. 
<P>If this flag is set for Semitic languages and the <B>lpClass</B> array is used, the first two elements of the array are used to specify the reading order beyond the bounds of the string. GCP_CLASS_PREBOUNDRTL and GCP_CLASS_PREBOUNDLTR can be used to set the order. If no preset order is required, set the values to zero. These values can be combined with other values if theGCPCLASSIN flag is set.</P>

<P>If the GCP_REORDER value is <I>not</I> given, the <I>lpString</I> parameter is taken to be visual ordered for languages where this is used, and the <I>lpOutString</I> and <I>lpOrder</I> fields are ignored.</P>

<P>Use <A HREF="1_h0udu.htm"><B>GetFontLanguageInfo</B></A> to determine whether the current font supports reordering.</P>
</TD>
</TR>

<TR VALIGN="top">
<TD width=41%>GCP_SYMSWAPOFF</TD>
<TD width=59%>Semitic languages only. Specifies that swappable characters are <I>not</I> reset. For example, in a right-to-left string, the '(' and ')' are not reversed.</TD>
</TR>

<TR VALIGN="top">
<TD width=41%>GCP_USEKERNING</TD>
<TD width=59%>Use kerning pairs in the font (if any) when creating the widths arrays. Use <A HREF="1_h0udu.htm"><B>GetFontLanguageInfo</B></A> to determine whether the current font supports kerning pairs.
<P>Note that just because <B>GetFontLanguageInfo</B> returns the GCP_USEKERNING flag does not mean that it <I>has</I> to be used in the call to <B>GetCharacterPlacement</B>, just that the option is available. Most TrueType fonts have a kerning table, but you do not have to use it.</P>
</TD>
</TR>
</TABLE><BR>

<P></P>

<P>It is recommended that an application use the <A HREF="1_h0udu.htm"><B>GetFontLanguageInfo</B></A> function to determine whether the GCP_DIACRITIC, GCP_DBCS, GCP_USEKERNING, GCP_LIGATE, GCP_REORDER, GCP_GLYPHSHAPE, and GCP_KASHIDA values are valid for the currently selected font. If not valid, <B>GetCharacterPlacement</B> ignores the value.</P>

<P>The GCP_NODIACRITICS value is no longer defined and should not be used.</P>

<P><B>Return Values</B></P>

<P>If the function succeeds, the return value is the same as the return value from <A HREF="101r0q.htm"><B>GetTextExtentPoint32</B></A>, the width and height of the string. </P>

<P>If the function fails, the return value is zero.</P>

<P><B>Remarks</B></P>

<P><B>GetCharacterPlacement</B> ensures that an application can correctly process text regardless of the international setting and type of fonts available. Applications use this function before using the <A HREF="9dxaad.htm"><B>ExtTextOut</B></A> function and in place of the <A HREF="101r0q.htm"><B>GetTextExtentPoint32</B></A> function (and occasionally in place of the <A HREF="9nsqcl.htm"><B>GetCharWidth32</B></A> and <A HREF="ydun.6.htm"><B>GetCharABCWidths</B></A> functions). </P>

<P>Using <B>GetCharacterPlacement</B> to retrieve intercharacter spacing and index arrays is not always necessary unless justification or kerning is required. For non-Latin fonts, applications can improve the speed at which the <B>ExtTextOut</B> function renders text by using <B>GetCharacterPlacement</B> to retrieve the intercharacter spacing and index arrays before calling <B>ExtTextOut</B>. This is especially useful when rendering the same text repeatedly or when using intercharacter spacing to position the caret. If the <B>lpGlyphs</B> output array is used in the call to <B>ExtTextOut</B>, the ETO_GLYPH_INDEX flag must be set.</P>

<P><B>GetCharacterPlacement</B> checks the <B>lpOrder</B>, <B>lpDx</B>, <B>lpCaretPos</B>, <B>lpOutString</B>, and <B>lpGlyphs</B> members of the <A HREF="_fmavo.htm"><B>GCP_RESULTS</B></A> structure and fills the corresponding arrays if these members are <I>not</I> set to NULL. If <B>GetCharacterPlacement</B> cannot fill an array, it sets the corresponding member to NULL. To ensure retrieval of valid information, the application is responsible for setting the member to a valid address before calling the function and for checking the value of the member after the call. If the GCP_JUSTIFY or GCP_USEKERNING values are given, the <B>lpDx</B> and/or <B>lpCaretPos</B> members must have valid addresses. Also, the <B>lpDx</B> member must have a valid address if GCP_JUSTIFYIN is given.</P>

<P>When computing justification, if the trailing characters in the string are spaces, the function reduces the length of the string and removes the spaces prior to computing the justification. If the array consists of only spaces, the function returns an error.</P>

<P><B>See Also</B></P>

<P><A HREF="9dxaad.htm"><B>ExtTextOut</B></A>, <A HREF="_fmavo.htm"><B>GCP_RESULTS</B></A>, <A HREF="ydun.6.htm"><B>GetCharABCWidths</B></A>, <A HREF="9nsqcl.htm"><B>GetCharWidth32</B></A>, <A HREF="1_h0udu.htm"><B>GetFontLanguageInfo</B></A>, <A HREF="z7lv.f.htm"><B>GetStringTypeEx</B></A>, <A HREF="101r0q.htm"><B>GetTextExtentPoint32</B></A>, <A HREF="zd2pdo.htm"><B>GetTextMetrics</B></A> </P>

</BODY>
</HTML>
