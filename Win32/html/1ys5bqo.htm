<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Calling DeviceIoControl on Windows NT</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="1ys5bqo"></A><B>Calling DeviceIoControl on Windows NT</B></P>

<P>On Windows NT, an application can use the <A HREF="64ie_y8.htm"><B>DeviceIoControl</B></A> function to perform direct input and output operations on, or retrieve information about, a floppy disk drive, hard disk drive, tape drive, or CD-ROM drive. The following example demonstrates how to retrieve information about the first physical drive in the system. It uses the <A HREF="xn35yd.htm"><B>CreateFile</B></A> function to obtain the device handle of the first physical drive, and then uses the <B>DeviceIoControl</B> function with the <A HREF="9febv1.htm"><B>IOCTL_DISK_GET_DRIVE_GEOMETRY</B></A> control code to fill a <A HREF="wwg4lv.htm"><B>DISK_GEOMETRY</B></A> structure with information about the drive.</P>

<P>BOOL GetDriveGeometry(DISK_GEOMETRY *pdg)  </P>

<P>{  </P>

<P>HANDLE hDevice; </P>

<P>BOOL fResult; </P>

<P>DWORD cb; </P>

<P></P>

<P>hDevice = CreateFile("\\\\.\\PhysicalDrive0", </P>

<P>0, FILE_SHARE_READ | FILE_SHARE_WRITE, </P>

<P>NULL, OPEN_EXISTING, 0, NULL); </P>

<P></P>

<P>if (hDevice == NULL) </P>

<P>return FALSE; </P>

<P></P>

<P>fResult = DeviceIoControl(hDevice, </P>

<P>IOCTL_DISK_GET_DRIVE_GEOMETRY, NULL, 0, </P>

<P>pdg, sizeof(*pdg), &amp;cb, (LPOVERLAPPED) NULL); </P>

<P></P>

<P>if (!fResult) </P>

<P>return FALSE; </P>

<P></P>

<P></P>

<P>CloseHandle(hDevice); </P>

<P>} </P>

<P></P>

<P>This example succeeds only when it runs on Windows NT, for two reasons:</P>

<P>·The standard device input/output control codes are available only on Windows NT, and</P>

<P>·On Windows 95, an application must specify a virtual device driver in the <B>CreateFile</B> function ¾ not a specific device.</P>

<P></P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-1');</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
