<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Supporting the Configuration Dialog Box</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="17iznpm"></A><B>Supporting the Configuration Dialog Box</B></P>

<P>Most screen savers provide a configuration dialog box to let the user specify customization data such as unique colors, drawing speeds, line thicknesses, fonts, and so on. To support the configuration dialog box, the application must provide a dialog box template and must also support the <A HREF="8_q9d7.htm"><B>ScreenSaverConfigureDialog</B></A> function. Following is the dialog box template for the sample application. </P>

<P>DLG_SCRNSAVECONFIGURE DIALOG 6, 18, 160, 63<BR>
LANGUAGE LANG_NEUTRAL, SUBLANG_NEUTRAL<BR>
STYLE DS_MODALFRAME | WS_POPUP | WS_VISIBLE | WS_CAPTION |<BR>
    WS_SYSMENU<BR>
CAPTION "Sample Screen-Saver Setup"<BR>
FONT 8, "MS Shell Dlg"<BR>
BEGIN<BR>
    GROUPBOX      "Redraw Speed", 101, 0, 6, 98, 40<BR>
    SCROLLBAR     ID_SPEED, 5, 31, 89, 10<BR>
    LTEXT         "Fast", 103, 6, 21, 20, 8<BR>
    LTEXT         "Slow", 104, 75, 21, 20, 8<BR>
    PUSHBUTTON    "OK", ID_OK, 117, 10, 40, 14<BR>
    PUSHBUTTON    "Cancel", ID_CANCEL, 117, 32, 40, 14<BR>
END  </P>

<P></P>

<P>You must define the constant used to identify the dialog box template by using the decimal value 2003, as in the following example. </P>

<P>#define  DLG_SCRNSAVECONFIGURE 2003  </P>

<P></P>

<P>The following example shows the <A HREF="8_q9d7.htm"><B>ScreenSaverConfigureDialog</B></A> function found in the sample application. </P>

<P>#define MINVEL  1               /* minimum redraw-speed value    */  </P>

<P>#define MAXVEL  10              /* maximum redraw-speed value    */ </P>

<P>#define DEFVEL  5               /* default redraw-speed value    */ </P>

<P></P>

<P>LONG    lSpeed = DEFVEL;        /* redraw-speed variable         */ </P>

<P></P>

<P>extern HINSTANCE hMainInstance; /* screen saver instance handle  */ </P>

<P></P>

<P>CHAR   szAppName[80];           /* .INI section name             */ </P>

<P>CHAR   szTemp[20];              /* temporary array of characters */ </P>

<P>CHAR   szRedrawSpeed[] = "Redraw Speed";   /* .INI speed entry   */ </P>

<P></P>

<P>BOOL WINAPI ScreenSaverConfigureDialog(hDlg, message, wParam, lParam) </P>

<P>HWND  hDlg; </P>

<P>UINT  message; </P>

<P>DWORD wParam; </P>

<P>LONG  lParam; </P>

<P>{ </P>

<P>static HWND hSpeed; /* handle of speed scroll bar */ </P>

<P>static HWND hOK;    /* handle of OK push button */ </P>

<P></P>

<P>switch(message) </P>

<P>{ </P>

<P>case WM_INITDIALOG: </P>

<P></P>

<P>/* Retrieve the application name from the .RC file. */ </P>

<P></P>

<P>LoadString(hMainInstance, idsAppName, szAppName, 40); </P>

<P></P>

<P>/* Retrieve the .INI (or registry) filename. */ </P>

<P></P>

<P>LoadString(hMainInstance, idsIniFile, szIniFile, </P>

<P>MAXFILELEN); </P>

<P></P>

<P>/* Retrieve any redraw-speed data from the registry. */ </P>

<P></P>

<P>lSpeed = GetPrivateProfileInt(szAppName, szRedrawSpeed, </P>

<P>DEFVEL, szIniFile); </P>

<P></P>

<P>/* </P>

<P>* If the initialization file does not contain an entry </P>

<P>* for this screen saver, use the default value. </P>

<P>*/ </P>

<P></P>

<P>if(lSpeed &gt; MAXVEL || lSpeed &lt; MINVEL) </P>

<P>lSpeed = DEFVEL; </P>

<P></P>

<P>/* Initialize the redraw-speed scroll bar control. */ </P>

<P></P>

<P>hSpeed = GetDlgItem(hDlg, ID_SPEED); </P>

<P>SetScrollRange(hSpeed, SB_CTL, MINVEL, MAXVEL, FALSE); </P>

<P>SetScrollPos(hSpeed, SB_CTL, lSpeed, TRUE); </P>

<P></P>

<P>/* Retrieve a handle of the OK push button control. */ </P>

<P></P>

<P>hOK = GetDlgItem(hDlg, ID_OK); </P>

<P></P>

<P>return TRUE; </P>

<P></P>

<P>case WM_HSCROLL: </P>

<P></P>

<P>/* </P>

<P>* Process scroll bar input, adjusting the lSpeed </P>

<P>* value as appropriate. </P>

<P>*/ </P>

<P></P>

<P>switch (LOWORD(wParam)) </P>

<P>{ </P>

<P>case SB_PAGEUP: </P>

<P>--lSpeed; </P>

<P>break; </P>

<P></P>

<P>case SB_LINEUP: </P>

<P>--lSpeed; </P>

<P>break; </P>

<P></P>

<P>case SB_PAGEDOWN: </P>

<P>++lSpeed; </P>

<P>break; </P>

<P></P>

<P>case SB_LINEDOWN: </P>

<P>++lSpeed; </P>

<P>break; </P>

<P></P>

<P>case SB_THUMBPOSITION: </P>

<P>lSpeed = HIWORD(wParam); </P>

<P>break; </P>

<P></P>

<P>case SB_BOTTOM: </P>

<P>lSpeed = MINVEL; </P>

<P>break; </P>

<P></P>

<P>case SB_TOP: </P>

<P>lSpeed = MAXVEL; </P>

<P>break; </P>

<P></P>

<P>case SB_THUMBTRACK: </P>

<P>case SB_ENDSCROLL: </P>

<P>return TRUE; </P>

<P>break; </P>

<P>} </P>

<P>if ((int) lSpeed &lt;= MINVEL) </P>

<P>lSpeed = MINVEL; </P>

<P>if ((int) lSpeed &gt;= MAXVEL) </P>

<P>lSpeed = MAXVEL; </P>

<P></P>

<P>SetScrollPos((HWND) lParam, SB_CTL, lSpeed, TRUE); </P>

<P>break; </P>

<P></P>

<P>case WM_COMMAND: </P>

<P>switch(LOWORD(wParam)) </P>

<P>{ </P>

<P>case ID_OK: </P>

<P></P>

<P>/* </P>

<P>* Write the current redraw-speed variable to </P>

<P>* the .INI file. </P>

<P>*/ </P>

<P></P>

<P>wsprintf(szTemp, "%ld", lSpeed); </P>

<P>WritePrivateProfileString(szAppName, szRedrawSpeed, </P>

<P>szTemp, szIniFile); </P>

<P></P>

<P>case ID_CANCEL: </P>

<P>EndDialog(hDlg, LOWORD(wParam) == ID_OK); </P>

<P>return TRUE; </P>

<P>} </P>

<P>} </P>

<P>return FALSE; </P>

<P>} </P>

<P></P>

<P>In addition to providing the dialog box template and supporting the <A HREF="8_q9d7.htm"><B>ScreenSaverConfigureDialog</B></A> function, an application must also support the <A HREF="4ziy_wl.htm"><B>RegisterDialogClasses</B></A> function. This function registers any nonstandard window classes required by the screen saver. Because the sample application used only standard window classes in its dialog box procedure, this function simply returns TRUE, as in the following example. </P>

<P>BOOL WINAPI RegisterDialogClasses(hInst)  </P>

<P>HANDLE  hInst; </P>

<P>{ </P>

<P>return TRUE; </P>

<P>} </P>

<P></P>

</BODY>
</HTML>
