<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><TITLE>Sending an Encrypted Session Key</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="51y4_f1"></A><B>Sending an Encrypted Session Key</B></P>

<P>The easiest way to send encrypted messages to another user is to send the message (encrypted with a random session key) along with the session key (encrypted with the receiver's exchange public key). These are the steps for sending an encrypted session key:</P>

<P>1.Create a random session key using the <A HREF="dnbayj.htm"><B>CryptGenKey</B></A> function.</P>

<P>2.Encrypt the message using the session key. (This procedure is discussed in the section <A HREF="ovgpq4.htm">Encrypting and Decrypting Data</A>.)</P>

<P>3.Export the session key into a key blob with the <A HREF="2n8dsnc.htm"><B>CryptExportKey</B></A> function, specifying that the key be encrypted with the destination user's key exchange public key.</P>

<P>4.Send both the encrypted message and the encrypted key blob to the destination user.</P>

<P>5.The destination user should then import the key blob into his or her CSP using the <A HREF="8mc1bn.htm"><B>CryptImportKey</B></A> function. This will automatically decrypt the session key, provided the destination user's key exchange public key was specified in step 3.</P>

<P>6.The destination user can then decrypt the message using the session key, following the procedure discussed in the section <A HREF="ovgpq4.htm">Encrypting and Decrypting Data</A>.</P>

<P></P>

<P>The following illustration shows how to send an encrypted message using this procedure:</P>

<P><IMG SRC="../images/bm121.gif" ALT="" BORDER=0></P>

<P>This approach is vulnerable to at least one common form of attack. An eavesdropper can acquire copies of one of more encrypted messages and the encrypted keys. Then, at some later time, the eavesdropper can send one of these messages to the receiver and the receiver will have no way of knowing the message did not come directly from the original sender. This risk can be reduced by timestamping all messages or by using serial numbers. Using a three-phase key exchange protocol will eliminate this problem entirely. See the <A HREF="ggmg.w.htm">Sample Three-Phase Exchange Protocol</A> section.</P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-1');</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
