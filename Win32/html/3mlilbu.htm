<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Monitoring Changes in a Directory or Directory Tree</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="3mlilbu"></A><B>Monitoring Changes in a Directory or Directory Tree</B></P>

<P>The following example monitors the directory tree starting at C:\ for directory name changes. It also monitors the C:\WINDOWS directory for filename changes. </P>

<P>The example uses the <A HREF="pu4_hm.htm"><B>FindFirstChangeNotification</B></A> function to create two notification handles and the <A HREF="ux0.eo.htm"><B>WaitForMultipleObjects</B></A> function to wait on the handles. Whenever a directory is created or deleted in the tree starting at C:\ , the example updates the entire directory tree. Whenever a file is created or deleted in the C:\WINDOWS directory, the example refreshes the WINDOWS directory. The <A HREF="u9dl42.htm"><B>FindNextChangeNotification</B></A> function restarts the change notification each time the example processes a change. </P>

<P>DWORD dwWaitStatus;  </P>

<P>HANDLE dwChangeHandles[2]; </P>

<P></P>

<P>// Watch the C:\WINDOWS directory for file creation and </P>

<P>// deletion. </P>

<P></P>

<P>dwChangeHandles[0] = FindFirstChangeNotification( </P>

<P>"C:\\WINDOWS",                 // directory to watch </P>

<P>FALSE,                         // do not watch the subtree </P>

<P>FILE_NOTIFY_CHANGE_FILE_NAME); // watch filename changes </P>

<P></P>

<P>if (dwChangeHandles[0] == INVALID_HANDLE_VALUE) </P>

<P>ExitProcess(GetLastError()); </P>

<P></P>

<P>// Watch the C:\ subtree for directory creation and </P>

<P>// deletion. </P>

<P></P>

<P>dwChangeHandles[1] = FindFirstChangeNotification( </P>

<P>"C:\\",                        // directory to watch </P>

<P>TRUE,                          // watch the subtree </P>

<P>FILE_NOTIFY_CHANGE_DIR_NAME);  // watch dir. name changes </P>

<P></P>

<P>if (dwChangeHandles[1] == INVALID_HANDLE_VALUE) </P>

<P>ExitProcess(GetLastError()); </P>

<P></P>

<P>// Change notification is set. Now wait on both notification </P>

<P>// handles and refresh accordingly. </P>

<P></P>

<P>while (TRUE) </P>

<P>{ </P>

<P></P>

<P>// Wait for notification.</P>

<P></P>

<P>dwWaitStatus = WaitForMultipleObjects(2, dwChangeHandles, </P>

<P>FALSE, INFINITE); </P>

<P></P>

<P>switch (dwWaitStatus) { </P>

<P></P>

<P>case WAIT_OBJECT_0: </P>

<P></P>

<P>// A file was created or deleted in C:\WINDOWS. </P>

<P>// Refresh this directory and restart the </P>

<P>// change notification. RefreshDirectory is an </P>

<P>// application-defined function. </P>

<P></P>

<P>RefreshDirectory("C:\\WINDOWS") </P>

<P>if ( FindNextChangeNotification( </P>

<P>dwChangeHandles[0]) == FALSE ) </P>

<P>ExitProcess(GetLastError()); </P>

<P>break; </P>

<P></P>

<P>case WAIT_OBJECT_0 + 1: </P>

<P></P>

<P>// A directory was created or deleted in C:\. </P>

<P>// Refresh the directory tree and restart the </P>

<P>// change notification. RefreshTree is an </P>

<P>// application-defined function. </P>

<P></P>

<P>RefreshTree("C:\\"); </P>

<P>if (FindNextChangeNotification( </P>

<P>dwChangeHandles[1]) == FALSE) </P>

<P>ExitProcess(GetLastError()); </P>

<P>break; </P>

<P></P>

<P>default: </P>

<P>ExitProcess(GetLastError()); </P>

<P>} </P>

<P>} </P>

<P></P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-1');</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
