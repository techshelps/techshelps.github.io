<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Decrypting Messages Using CryptoAPI</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="1as7.w7"></A><B>Decrypting Messages Using CryptoAPI</B></P>

<P>If a message was encrypted for a particular user, then the <A HREF="dnbayj.htm"><B>CryptGenKey</B></A> function was used to create a random session key, before the encryption was performed. This means that before the message can be decrypted, the key blob containing the session key needs to be imported into the CSP with the <A HREF="8mc1bn.htm"><B>CryptImportKey</B></A> function. This function will use your key exchange private key to decrypt the key blob. This means that the key blob must have been originally created using the matching key exchange public key.</P>

<P>If the message was encrypted so that any password holder can access the data, the <B>CryptImportKey</B> function is not used. Instead, you create the decryption session key with the <A HREF="ioh0._.htm"><B>CryptDeriveKey</B></A> function. You will also need to supply the function with the password (or other access token).</P>

<P>The session key's parameters need to be configured in the same way as when the encryption was performed. These parameters can be specified using the <B>CryptSetKeyParam</B> function. For example, if the salt value was changed one or more times during the encryption process, then it must also be changed during the decryption process in exactly the same manner.</P>

<P>The message is decrypted using the <B>CryptDecrypt </B>function. If the message is too large to fit comfortably in memory, it can be decrypted in sections, through multiple calls to <B>CryptDecrypt</B>.</P>

<P>When the decryption is complete, be sure to destroy the session key, using the <B>CryptDestroyKey</B> function. In addition to destroying the key, this will free up CSP resources.</P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-1');</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
