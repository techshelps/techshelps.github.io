<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Shutting Down</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="e3u.4y"></A><B>Shutting Down</B></P>

<P>You can use the <A HREF="ma6lrq.htm"><B>ExitWindowsEx</B></A> function to shut down the system. Shutting down flushes file buffers to disk and brings the system to a condition in which it is safe to turn off the computer. </P>

<P><B>Windows NT:</B> The following example enables the SE_SHUTDOWN_NAME privilege and then shuts down the system. </P>

<P>HANDLE hToken;  </P>

<P>TOKEN_PRIVILEGES tkp;  </P>

<P></P>

<P>// Get a token for this process. </P>

<P></P>

<P>if (!OpenProcessToken(GetCurrentProcess(), </P>

<P>TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY, &amp;hToken)) </P>

<P>error("OpenProcessToken"); </P>

<P></P>

<P>// Get the LUID for the shutdown privilege. </P>

<P></P>

<P>LookupPrivilegeValue(NULL, SE_SHUTDOWN_NAME, </P>

<P>&amp;tkp.Privileges[0].Luid); </P>

<P></P>

<P>tkp.PrivilegeCount = 1;  // one privilege to set    </P>

<P>tkp.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED; </P>

<P></P>

<P>// Get the shutdown privilege for this process. </P>

<P></P>

<P>AdjustTokenPrivileges(hToken, FALSE, &amp;tkp, 0, </P>

<P>(PTOKEN_PRIVILEGES)NULL, 0); </P>

<P></P>

<P>// Cannot test the return value of AdjustTokenPrivileges. </P>

<P></P>

<P>if (GetLastError() != ERROR_SUCCESS) </P>

<P>error("AdjustTokenPrivileges"); </P>

<P></P>

<P>// Shut down the system and force all applications to close. </P>

<P></P>

<P>if (!ExitWindowsEx(EWX_SHUTDOWN | EWX_FORCE, 0)) </P>

<P>error("ExitWindowsEx"); </P>

<P></P>

<P>For more information about setting security privileges, see <A HREF="1966ja.htm">Security</A>. </P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-1');</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
