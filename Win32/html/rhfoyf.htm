<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Creating Threads</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="rhfoyf"></A><B>Creating Threads</B></P>

<P>The <A HREF="70ts0y.htm"><B>CreateThread</B></A> function creates a new thread for a process. The creating thread must specify the starting address of the code that the new thread is to execute. Typically, the starting address is the name of a function defined in the program code. This function takes a single parameter and returns a DWORD value. A process can have multiple threads simultaneously executing the same function. </P>

<P>The following example demonstrates how to create a new thread that executes the locally defined function, ThreadFunc. </P>

<P>DWORD WINAPI ThreadFunc( LPVOID lpParam )  </P>

<P>{ </P>

<P>char szMsg[80];</P>

<P>wsprintf( szMsg, "ThreadFunc: Parameter = %d\n", *lpParam ); </P>

<P>MessageBox( NULL, szMsg, "Thread created.", MB_OK );</P>

<P>return 0; </P>

<P>} </P>

<P></P>

<P>VOID main( VOID ) </P>

<P>{ </P>

<P>DWORD dwThreadId, dwThrdParam = 1; </P>

<P>HANDLE hThread; </P>

<P>hThread = CreateThread( </P>

<P>NULL,                        // no security attributes </P>

<P>0,                           // use default stack size  </P>

<P>ThreadFunc,                  // thread function </P>

<P>&amp;dwThrdParam,                // argument to thread function </P>

<P>0,                           // use default creation flags </P>

<P>&amp;dwThreadId);                // returns the thread identifier </P>

<P></P>

<P>// Check the return value for success. </P>

<P></P>

<P>if (hThread == NULL) </P>

<P>ErrorExit( "CreateThread failed." ); </P>

<P>CloseHandle( hThread );</P>

<P>} </P>

<P></P>

<P>For simplicity, this example passes a pointer to a DWORD value as an argument to the thread function. This could be a pointer to any type of data or structure, or it could be omitted altogether by passing a NULL pointer and deleting the references to the parameter in ThreadFunc. </P>

<P>It is risky to pass the address of a local variable if the creating thread exits before the new thread, because the pointer becomes invalid. Instead, either pass a pointer to dynamically allocated memory or make the creating thread wait for the new thread to terminate. Data can also be passed from the creating thread to the new thread using global variables. With global variables, it is usually necessary to synchronize access by multiple threads. For more information about synchronization, see <A HREF="2n3h_7u.htm">Synchronizing Execution of Multiple Threads</A>. </P>

<P>In processes where a thread might create multiple threads to execute the same code, it is inconvenient to use global variables. For example, a process that enables the user to open several files at the same time can create a new thread for each file, with each of the threads executing the same thread function. The creating thread can pass the unique information (such as the filename) required by each instance of the thread function as an argument. You cannot use a single global variable for this purpose, but you could use a dynamically allocated string buffer. </P>

<P>The creating thread can use the arguments to <A HREF="70ts0y.htm"><B>CreateThread</B></A> to specify the following: </P>

<P>·The security attributes for the handle of the new thread. These security attributes include an inheritance flag that determines whether the handle can be inherited by child processes. The security attributes also include a security descriptor, which the system uses to perform access checks on all subsequent uses of the thread's handle before access is granted. </P>

<P>·The initial stack size of the new thread. The thread's stack is allocated automatically in the memory space of the process; the system increases the stack as needed and frees it when the thread terminates. </P>

<P>·A creation flag that enables you to create the thread in a suspended state. When suspended, the thread does not run until the <A HREF="5kez_mi.htm"><B>ResumeThread</B></A> function is called. </P>

<P></P>

<P><B>Windows NT:</B> You can also create a thread by calling the <A HREF="19iu6kt.htm"><B>CreateRemoteThread</B></A> function. This function is used by debugger processes to create a thread that runs in the address space of the process being debugged. </P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
