<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Creating a Template in Memory</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="bjijrd"></A><B>Creating a Template in Memory</B></P>

<P>Applications sometimes adapt or modify the content of dialog boxes depending on the current state of the data being processed. In such cases, it is not practical to provide all possible dialog box templates as resources in the application's executable file. But creating templates in memory gives the application more flexibility to adapt to any circumstances. </P>

<P>In the following example, the application creates a template in memory for a modal dialog box that contains a message and OK and Help buttons. </P>

<P>In a dialog template, all character strings, such as the dialog box and button titles, must be Unicode strings. This example uses the <A HREF="2dr2_sz.htm"><B>MultiByteToWideChar</B></A> function to generate these Unicode strings, because both Windows NT and Windows 95 support <B>MultiByteToWideChar</B> </P>

<P>The <A HREF="27yvkw7.htm"><B>DLGITEMTEMPLATE</B></A> structures in a dialog template must be aligned on <B>DWORD</B> boundaries. To align these structures, this example uses a helper routine that takes an input pointer and returns the closest pointer that is aligned on a DWORD (4 byte) boundary.</P>

<P>#define ID_HELP   150</P>

<P>#define ID_TEXT   200</P>

<P></P>

<P>LPWORD lpwAlign ( LPWORD lpIn)</P>

<P>{</P>

<P>ULONG ul;</P>

<P>ul = (ULONG) lpIn;</P>

<P>ul +=3;</P>

<P>ul &gt;&gt;=2;</P>

<P>ul &lt;&lt;=2;</P>

<P>return (LPWORD) ul;</P>

<P>}</P>

<P>LRESULT DisplayMyMessage(HINSTANCE hinst, HWND hwndOwner, </P>

<P>LPSTR lpszMessage)</P>

<P>{</P>

<P>HGLOBAL hgbl;</P>

<P>LPDLGTEMPLATE lpdt;</P>

<P>LPDLGITEMTEMPLATE lpdit;</P>

<P>LPWORD lpw;</P>

<P>LPWSTR lpwsz;</P>

<P>LRESULT ret;</P>

<P>int nchar;</P>

<P>hgbl = GlobalAlloc(GMEM_ZEROINIT, 1024);</P>

<P>if (!hgbl)</P>

<P>return -1;</P>

<P></P>

<P>lpdt = (LPDLGTEMPLATE)GlobalLock(hgbl);</P>

<P></P>

<P>// Define a dialog box.</P>

<P></P>

<P>lpdt-&gt;style = WS_POPUP | WS_BORDER | WS_SYSMENU</P>

<P>| DS_MODALFRAME | WS_CAPTION;</P>

<P>lpdt-&gt;cdit = 3;  // number of controls</P>

<P>lpdt-&gt;x  = 10;  lpdt-&gt;y  = 10;</P>

<P>lpdt-&gt;cx = 100; lpdt-&gt;cy = 100;</P>

<P>lpw = (LPWORD) (lpdt + 1);</P>

<P>*lpw++ = 0;   // no menu</P>

<P>*lpw++ = 0;   // predefined dialog box class (by default)</P>

<P>lpwsz = (LPWSTR) lpw;</P>

<P>nchar = 1+ MultiByteToWideChar (CP_ACP, 0, "My Dialog", </P>

<P>-1, lpwsz, 50);</P>

<P>lpw   += nchar;</P>

<P>//-----------------------</P>

<P>// Define an OK button.</P>

<P>//-----------------------</P>

<P>lpw = lpwAlign (lpw); // align DLGITEMTEMPLATE on DWORD boundary</P>

<P>lpdit = (LPDLGITEMTEMPLATE) lpw;</P>

<P>lpdit-&gt;x  = 10; lpdit-&gt;y  = 70;</P>

<P>lpdit-&gt;cx = 80; lpdit-&gt;cy = 20;</P>

<P>lpdit-&gt;id = IDOK;  // OK button identifier</P>

<P>lpdit-&gt;style = WS_CHILD | WS_VISIBLE | BS_DEFPUSHBUTTON;</P>

<P>lpw = (LPWORD) (lpdit + 1);</P>

<P>*lpw++ = 0xFFFF;</P>

<P>*lpw++ = 0x0080;    // button class</P>

<P>lpwsz = (LPWSTR) lpw;</P>

<P>nchar = 1+MultiByteToWideChar (CP_ACP, 0, "OK", -1, lpwsz, 50);</P>

<P>lpw   += nchar;</P>

<P>lpw = lpwAlign (lpw); // align creation data on DWORD boundary</P>

<P>*lpw++ = 0;           // no creation data</P>

<P>//-----------------------</P>

<P>// Define a Help button.</P>

<P>//-----------------------</P>

<P>lpw = lpwAlign (lpw); // align DLGITEMTEMPLATE on DWORD boundary</P>

<P>lpdit = (LPDLGITEMTEMPLATE) lpw;</P>

<P>lpdit-&gt;x  = 55; lpdit-&gt;y  = 10;</P>

<P>lpdit-&gt;cx = 40; lpdit-&gt;cy = 20;</P>

<P>lpdit-&gt;id = ID_HELP;    // Help button identifier</P>

<P>lpdit-&gt;style = WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON;</P>

<P>lpw = (LPWORD) (lpdit + 1);</P>

<P>*lpw++ = 0xFFFF;</P>

<P>*lpw++ = 0x0080;                 // button class atom</P>

<P>lpwsz = (LPWSTR) lpw;</P>

<P>nchar = 1+MultiByteToWideChar (CP_ACP, 0, "Help", -1, lpwsz, 50);</P>

<P>lpw   += nchar;</P>

<P>lpw = lpwAlign (lpw); // align creation data on DWORD boundary</P>

<P>*lpw++ = 0;           // no creation data</P>

<P>//-----------------------</P>

<P>// Define a static text control.</P>

<P>//-----------------------</P>

<P>lpw = lpwAlign (lpw); // align DLGITEMTEMPLATE on DWORD boundary</P>

<P>lpdit = (LPDLGITEMTEMPLATE) lpw;</P>

<P>lpdit-&gt;x  = 10; lpdit-&gt;y  = 10;</P>

<P>lpdit-&gt;cx = 40; lpdit-&gt;cy = 20;</P>

<P>lpdit-&gt;id = ID_TEXT;  // text identifier</P>

<P>lpdit-&gt;style = WS_CHILD | WS_VISIBLE | SS_LEFT;</P>

<P>lpw = (LPWORD) (lpdit + 1);</P>

<P>*lpw++ = 0xFFFF;</P>

<P>*lpw++ = 0x0082;                         // static class</P>

<P>for (lpwsz = (LPWSTR)lpw;</P>

<P>*lpwsz++ = (WCHAR) *lpszMessage++;</P>

<P>);</P>

<P>lpw = (LPWORD)lpwsz;</P>

<P>lpw = lpwAlign (lpw); // align creation data on DWORD boundary</P>

<P>*lpw++ = 0;           // no creation data</P>

<P>GlobalUnlock(hgbl); </P>

<P>ret = DialogBoxIndirect(hinst, (LPDLGTEMPLATE) hgbl, </P>

<P>hwndOwner, (DLGPROC) DialogProc); </P>

<P>GlobalFree(hgbl); </P>

<P>return ret; </P>

<P>}</P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-1');</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
