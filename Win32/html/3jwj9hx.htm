<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>SnmpExtensionTrap</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="3jwj9hx"></A><B>SnmpExtensionTrap  <A HREF="1tcsc7.htm"><IMG SRC="../images/bm1.gif" ALT="" BORDER=0></A>  <A HREF="3ol8_pd.htm"><IMG SRC="../images/bm3.gif" ALT="" BORDER=0></A>  <A HREF="qj0.0j.htm"><IMG SRC="../images/bm2.gif" ALT="" BORDER=0></A></B></P>

<P>The extensible agent calls the <B>SnmpExtensionTrap</B> function in the extension agent DLL to retrieve traps generated by the extension agent.</P>

<P><B>BOOL SnmpExtensionTrap(</B></P>

<TABLE cols=2 width=501>

<TR VALIGN="top">
<TD width=63%><B>AsnObjectIdentifier </B><I>*enterprise</I><B>,</B></TD>
<TD width=37%>// Generating enterprise</TD>
</TR>

<TR VALIGN="top">
<TD width=63%><B>    AsnInteger </B><I>*genericTrap</I><B>,</B></TD>
<TD width=37%>// Generating trap type</TD>
</TR>

<TR VALIGN="top">
<TD width=63%><B>    AsnInteger </B><I>*specificTrap</I><B>,</B></TD>
<TD width=37%>// Enterprise specific type</TD>
</TR>

<TR VALIGN="top">
<TD width=63%><B>    AsnTimeticks </B><I>*timeStamp</I><B>,</B></TD>
<TD width=37%>// Time stamp</TD>
</TR>

<TR VALIGN="top">
<TD width=63%><B>    RFC1157VarBindList </B><I>*variableBindings</I></TD>
<TD width=37%>// Variable bindings</TD>
</TR>

<TR VALIGN="top">
<TD width=63%><B>   );</B></TD>
<TD width=37%>&nbsp;</TD>
</TR>
</TABLE><BR>

<P></P>

<P><B>Parameters</B></P>

<P><I>enterprise</I></P>

<P>[out] Points to an object identifier that indicates the originating object generating the trap. The extensible agent does not free the memory for this variable.</P>

<P><I>genericTrap</I></P>

<P>[out] Points to an indication of the generic trap. This parameter can be one of the following values:</P>

<TABLE cols=2>

<TR VALIGN="top">
<TD width=62%><B>Value</B></TD>
<TD width=38%><B>Meaning</B></TD>
</TR>

<TR VALIGN="top">
<TD width=62%>SNMP_GENERICTRAP_COLDSTART</TD>
<TD width=38%>The agent is initializing protocol entities on the managed mode. It may alter objects in its view.</TD>
</TR>

<TR VALIGN="top">
<TD width=62%>SNMP_GENERICTRAP_WARMSTART</TD>
<TD width=38%>The agent is re-initializing itself but will not alter objects within its view.</TD>
</TR>

<TR VALIGN="top">
<TD width=62%>SNMP_GENERICTRAP_LINKDOWN</TD>
<TD width=38%>An attached interface has changed from the <B>up</B> state to the <B>down</B> state. The first variable identifies the interface.</TD>
</TR>

<TR VALIGN="top">
<TD width=62%>SNMP_GENERICTRAP_LINKUP</TD>
<TD width=38%>An attached interface has changed from the <B>down</B> state to the <B>up</B> state. The first variable identifies the interface.</TD>
</TR>

<TR VALIGN="top">
<TD width=62%>SNMP_GENERICTRAP_AUTHFAILURE</TD>
<TD width=38%>An SNMP entity has sent an SNMP message, but has falsely claimed to belong to a known community.</TD>
</TR>

<TR VALIGN="top">
<TD width=62%>SNMP_GENERICTRAP_EGPNEIGHLOSS</TD>
<TD width=38%>An EGP peer has changed to the <B>down</B> state. The first variable identifies the IP address of the EGP peer.</TD>
</TR>

<TR VALIGN="top">
<TD width=62%>SNMP_GENERICTRAP_ENTERSPECIFIC</TD>
<TD width=38%>Signals an extraordinary event that is identified in the <I>specific-trap</I> parameter. </TD>
</TR>
</TABLE><BR>

<P></P>

<P><I>specificTrap</I></P>

<P>[out] Points to an indication of the specific trap generated.</P>

<P><I>timeStamp</I></P>

<P>[out] Points to a variable to receive the time stamp.</P>

<P><I>variableBindings</I></P>

<P>[out] Points to the variable bindings list. The memory for the list will be allocated by the extension agent. The extensible agent will free the memory with a call to the <A HREF="ecyth2.htm"><B>SnmpUtilVarBindListFree</B></A> function.</P>

<P></P>

<P><B>Return Values</B></P>

<P>If the <B>SnmpExtensionTrap</B> function returns a trap in its parameters, the return value is TRUE. Otherwise, the extensible agent repeatedly calls the function until it returns a value of FALSE.</P>

<P><B>Remarks</B></P>

<P>The extensible agent repeatedly calls the <B>SnmpExtensionTrap</B> function once the <I>hPollForTrapEvent</I> event handle of the <A HREF="9sy827.htm"><B>SnmpExtensionInit</B></A> function has been set to the signaled state. Each successful call returns data from a single trap. It returns FALSE to indicate that its parameters do not represent valid trap data and to stop the extensible agent's repeated calls.</P>

<P>The extension agent must not free the memory for the <I>variableBindings</I> parameter. The extensible agent automatically performs this action. Use the <A HREF="1pppkv9.htm"><B>SnmpUtilMemAlloc</B></A> function to allocate memory for each <A HREF="2_6kc47.htm"><B>RFC1157VarBind</B></A> structure.</P>

<P>It is important to note that earlier documentation stated that the extension agent should dynamically allocate memory for the enterprise object identifier because the extensible agent would attempt to release the memory after sending a trap. The extensible agent will not release the memory associated with the enterprise object identifier. The recommendation is that you return a pointer to a static <A HREF="vsxcuf.htm"><B>AsnObjectIdentifier</B></A> structure instead.</P>

<P><B>See Also </B></P>

<P><A HREF="at02d..htm"><B>SetEvent</B></A>, <A HREF="1pppkv9.htm"><B>SnmpUtilMemAlloc</B></A>, <A HREF="ecyth2.htm"><B>SnmpUtilVarBindListFree</B></A>, <A HREF="1wxgrc0.htm"><B>RFC1157VarBindList</B></A>, <A HREF="9sy827.htm"><B>SnmpExtensionInit</B></A></P>

</BODY>
</HTML>
