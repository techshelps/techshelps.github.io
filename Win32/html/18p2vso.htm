<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Resolving A Shortcut</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="18p2vso"></A><B>Resolving A Shortcut</B></P>

<P>An application may need to access and manipulate a shortcut that was created previously. This operation is referred to as "resolving" the shortcut. </P>

<P>The application-defined ResolveIt function in the following example resolves a shortcut. Its parameters include a window handle, a pointer to the path of the shortcut, and the address of a buffer that receives the new path to the object. The window handle identifies the parent window for any message boxes that the shell may need to display. For example, the shell can display a message box if the link is on unshared media, if network problems occur, if the user needs to insert a floppy disk, and so on. </P>

<P>The ResolveIt function calls the <B>CoCreateInstance</B> function and assumes that the <B>CoInitialize</B> function has already been called. Note that ResolveIt needs to use the <B>IPersistFile</B> interface to store the link information. <B>IPersistFile</B> is implemented by the <A HREF="222z_k0.htm"><B>IShellLink</B></A> object. The link information must be loaded before the path information is retrieved, which happens later in the example. Failing to load the link information causes the calls to the <A HREF="hgvgtb.htm"><B>IShellLink::GetPath</B></A> and <A HREF="17gv8jz.htm"><B>IShellLink::GetDescription</B></A> member functions to fail.</P>

<P>HRESULT ResolveIt(HWND hwnd, LPCSTR lpszLinkFile, LPSTR lpszPath)  </P>

<P>{ </P>

<P>HRESULT hres; </P>

<P>IShellLink* psl; </P>

<P>char szGotPath[MAX_PATH]; </P>

<P>char szDescription[MAX_PATH]; </P>

<P>WIN32_FIND_DATA wfd; </P>

<P></P>

<P>*lpszPath = 0; // assume failure </P>

<P></P>

<P>// Get a pointer to the IShellLink interface. </P>

<P>hres = CoCreateInstance(&amp;CLSID_ShellLink, NULL, </P>

<P>CLSCTX_INPROC_SERVER, &amp;IID_IShellLink, &amp;psl); </P>

<P>if (SUCCEEDED(hres)) { </P>

<P>IPersistFile* ppf; </P>

<P></P>

<P>// Get a pointer to the IPersistFile interface. </P>

<P>hres = psl-&gt;lpVtbl-&gt;QueryInterface(psl, &amp;IID_IPersistFile, </P>

<P>&amp;ppf); </P>

<P>if (SUCCEEDED(hres)) { </P>

<P>WORD wsz[MAX_PATH]; </P>

<P></P>

<P>// Ensure that the string is Unicode. </P>

<P>MultiByteToWideChar(CP_ACP, 0, lpszLinkFile, -1, wsz, </P>

<P>MAX_PATH); </P>

<P></P>

<P>// Load the shortcut. </P>

<P>hres = ppf-&gt;lpVtbl-&gt;Load(ppf, wsz, STGM_READ); </P>

<P>if (SUCCEEDED(hres)) { </P>

<P></P>

<P>// Resolve the link. </P>

<P>hres = psl-&gt;lpVtbl-&gt;Resolve(psl, hwnd, SLR_ANY_MATCH); </P>

<P>if (SUCCEEDED(hres)) { </P>

<P></P>

<P>// Get the path to the link target. </P>

<P>hres = psl-&gt;lpVtbl-&gt;GetPath(psl, szGotPath, </P>

<P>MAX_PATH, (WIN32_FIND_DATA *)&amp;wfd, </P>

<P>SLGP_SHORTPATH ); </P>

<P>if (!SUCCEEDED(hres) </P>

<P>HandleErr(hres); // application-defined function </P>

<P></P>

<P>// Get the description of the target. </P>

<P>hres = psl-&gt;lpVtbl-&gt;GetDescription(psl, </P>

<P>szDescription, MAX_PATH); </P>

<P>if (!SUCCEEDED(hres)) </P>

<P>HandleErr(hres); </P>

<P>lstrcpy(lpszPath, szGotPath); </P>

<P>} </P>

<P>} </P>

<P>// Release the pointer to the IPersistFile interface. </P>

<P>ppf-&gt;lpVtbl-&gt;Release(ppf); </P>

<P>} </P>

<P>// Release the pointer to the IShellLink interface. </P>

<P>psl-&gt;lpVtbl-&gt;Release(psl); </P>

<P>} </P>

<P>return hres; </P>

<P>} </P>

<P></P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-1');</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
