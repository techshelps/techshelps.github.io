<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="12.2 Use XMLReader to Read an XML Document"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">12.2 Use XMLReader to Read an XML Document</H3>
<P>In How-To 12.1, I learned how to write out data to an XML document by using the XMLWriter. How do I read data using the XMLReader?</P>
<H4 class="docSection2Title"> Technique</H4>
<P>Whereas the XMLWriter has one implementation (class), the XMLReader has three, depending on the task you need to perform. Those classes are listed in Table 12.4.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 12.4. XMLWriter Implementations</h5></CAPTION><COLGROUP span="2">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Class Name</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Purpose/Descriptions</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>XMLTextReader</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Reads character streams. This is a forward-only reader that has methods returning data on content and node types. No validation occurs.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>XMLNodeReader</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Provides a parser over an XML Document Object Model (DOM) API, similar to the XMLNode tree.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>XMLValidatingReader</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Takes an <TT>XMLTextReader</TT> adding validation. In doing so, it provides a fully compliant validating or non-validating XML parser with DTD, XSD schema, or XML-Data Reduced (XDR) schema support.</P>
</TD>
</TR>
</COLGROUP>
</TABLE></P>
<P>For this How-To, you will be using the <TT>XMLTextReader</TT> to read the file and display the results. To do this, you will use the following methods:</P>
<UL START=""><LI><p>
<span class="docEmphRoman">Read.</span> 
Reads a line of the character stream out of the <TT>XMLReadReader</TT>.</p>
</LI>
<LI><p>
<span class="docEmphRoman">AttributeCount.</span> 
Gives the count of attributes. This depends on the type of data that is being read. In this case, AttributeCount is used to display the individual attributes, which will be columns.</p>
</LI>
<LI><p>
<span class="docEmphRoman">NodeType.</span> 
Allows you to specify node types in the XML document. In the case of this How-To, the System.Xml.XmlNodeType.XmlDeclaration is checked for so that no information is printed for that type of node. You can see the other node types by looking at intellisense for the NodeType property.</p>
</LI>
<LI><p>
<span class="docEmphRoman">Value.</span> 
Represents the actual value of the line in the stream.</p>
</LI>
<LI><p>
<span class="docEmphRoman">Close.</span> 
Closes the stream.</p>
</LI>
</UL>
<H4 class="docSection2Title"> Steps</H4>
<P>Open and run the Visual Basic .NET-Chapter 12 solution. From the main Web page, click on the hyperlink with the caption How-To 12.2: Use XMLReader to Read an XML Document. When the page loads, click the button labeled Read XML File. The example then reads the XML file that is specified in the text box labeled File to Read and displays the information in the text area located at the bottom of the form (see Figure 12.2).</P>


<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><p>
<span class="docEmphRoman">Create a Web Form.</span> 
Then place the Label, TextBox, and Button objects as seen in Figure 12.2 on the form with the following properties set as in Table 12.5.</p>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 12.5. Label, TextBox, and Button Control Property Settings</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>File to Read</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtFileToRead</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnReadFile</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Read XML File</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextArea</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>taOutput</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>HyperLink</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>hplReturnToMain</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>NavigateURL</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>wfrmMain.aspx</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P>
<div class="docNote"><p class="docNoteTitle">Note</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/note_icon.gif" ALT="graphics/note_icon.gif"></td>
<td valign="top"><P>You will find the TextArea control in the HTML Components section of the toolbox. After you have dragged this control onto the Web Form, right-click and choose Run as Server Control from the pop-up menu. This will then run this control as a server side control, and you will be able to work with its properties and methods in code behind.</P>
</td>
</tr></table></p>
</div></span></LI><LI><span style="font-weight:normal" value="2"><P>Add the code in Listing 12.5 to the <TT>Click</TT> event of btnReadFile. To start off, the <TT>XXLTextReader</TT> is initialized with the XML document specified in <TT>txtFileToRead</TT>. Then each node of the document is read using the <TT>Read</TT> method. The node type is compared to make sure the current node is not the XMLDeclaration. If it's not, then each of the attributes is displayed; in this case, the columns of each name are entered. After each of the nodes (rows) have been read and added to strOut, then that string is assigned to the <TT>InnerText</TT> property of the <TT>TextArea</TT> object called taOutput. Last, the <TT>XMLTextReader</TT> object is closed.</P>
<H5 class="docExampleTitle">Listing 12.5 <TT>wfrmHowTo12_2.aspx.vb</TT>: Reading an XML Document Using <TT>XMLTextReader</TT></H5>
<PRE>
Private Sub btnReadFile_Click(ByVal sender As System.Object,
            ByVal e As System.EventArgs) Handles btnReadFile.Click

    Dim xtrNames As System.Xml.XmlTextReader
    Dim strOut As String
    Dim intAtts As Integer
    Dim intCurrAtt As Integer

    Try

        strOut = "Reading file " &amp; _
                Me.txtFileToRead.Text &amp; "..." &amp; vbCrLf

        xtrNames = New System.Xml.XmlTextReader(Me.txtFileToRead.Text)

        While xtrNames.Read()

            intAtts = xtrNames.AttributeCount
            If xtrNames.NodeType &lt;&gt; System.Xml.XmlNodeType.XmlDeclaration Then
                If intAtts &gt; 0 Then
                    For intCurrAtt = 0 To intAtts - 1
                        strOut &amp;= xtrNames(intCurrAtt) &amp; " "
                    Next
                Else
                    strOut &amp;= xtrNames.Value
                End If
            End If
        End While

    Catch excp As Exception

        strOut &amp;= "Following Error Occurred: " &amp; excp.Message

    Finally

        strOut &amp;= vbCrLf &amp; "Done Processing " &amp; Me.txtFileToRead.Text &amp; ""
        taOutput.InnerText = strOut

        If Not xtrNames Is Nothing Then
            xtrNames.Close()
        End If

    End Try

End Sub
</PRE></span></LI></OL></span>
<CENTER><H5 class="docFigureTitle">Figure 12.2. The information displayed here was read from an XML document using XMLReader.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="464" src="FILES/12fig02.jpg" ALT="graphics/12fig02.jpg"></p>
</CENTER>
<H4 class="docSection2Title"> Comments</H4>
<P>Again, as with <TT>XMLTextReader</TT>, this falls into the middle of complexity when it comes to reading XML documents. If you want to actually validate the data, then you should use the <TT>XMLValidatingReader</TT> implementation of the <TT>XMLReader</TT>, rather than the <TT>XMLTextReader</TT>.</P>
<ul></ul>
</body></html>
