<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="13.3 Consume XML Web Services"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">13.3 Consume XML Web Services</H3>
<P>I have created this Web Service that takes the username and password and returns <TT>True</TT> or <TT>False</TT> based on whether the username and password check out. I have even tested the Web Service to make sure it works correctly. How do I use, or consume, this Web Service in another application?</P>
<H4 class="docSection2Title"> Technique</H4>
<P>To use a Web Service, you need to create a reference to it.</P>
<H5 class="docSection3Title"> Setting Up the Web Reference to the Web Service</H5>
<P>To set up a Web reference, you choose Add Web Reference from the Project menu. You are then presented with the Add Web Reference dialog box, which allows you to browse for Web Services using the Universal Description Discovery Integration (UDDI) directories, as described in the beginning of the chapter. However, you will be able to browse to the Web Service you created and supply the name of the full URL using localhost to the name of the .asmx file you created, in this case:</P>
<P><TT>http://localhost/securitywebservice/SecurityServices.asmx</TT></P>
<P>After you have specified this, you will see the methods appear for your Web Service (see Figure 13.11.)</P>
<CENTER><H5 class="docFigureTitle">Figure 13.11. You can test the Web Service right in this dialog box.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="366" src="FILES/13fig11.jpg" ALT="graphics/13fig11.jpg"></p>
</CENTER>
<div class="docNote"><p class="docNoteTitle">Note</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/note_icon.gif" ALT="graphics/note_icon.gif"></td>
<td valign="top"><P>You can see two methods for this Web Service: TestUserPassword and GetUserInfo. The second method is discussed in How-To 13.4.</P>
</td>
</tr></table></p>
</div><br>
<P>After you have clicked Add Reference to accept the new reference, you can use the methods in your application. You can double-check that the reference is there by looking for it under the Web Reference node that appears in the Solution Explorer (see Figure 13.12.)</P>
<CENTER><H5 class="docFigureTitle">Figure 13.12. You can see the reference created in the Solution Explorer.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="375" src="FILES/13fig12.jpg" ALT="graphics/13fig12.jpg"></p>
</CENTER>
<H5 class="docSection3Title"> Calling Web Service Methods</H5>
<P>After you have created the reference to the Web Service, you will create a reference within your application, much like you would to other object models. Following is a snippet of code that performs this very task:</P>
<pre>
Dim wsSec As localhost.SecurityServices

wsSec = New localhost.SecurityServices()

If wsSec.TestUserPassword(Me.txtUser.Text, Me.txtPassword.Text) Then
</pre>
<P>As you can see, the method <TT>TestUserPassword</TT> is called just as another other method or function is called.</P>
<H4 class="docSection2Title"> Steps</H4>
<P>To preview this How-To, open the solution called Visual Basic .NET-Chapter 13, located in the chapter folder.</P>
<div class="docNote"><p class="docNoteTitle">Note</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/note_icon.gif" ALT="graphics/note_icon.gif"></td>
<td valign="top"><P>You will probably have to re-establish the Web reference for the Web Service that is used for this example. Locate where you have installed SecurityWebServices and set the reference.</P>
</td>
</tr></table></p>
</div><br>
<P>When you run the project, the first form that comes up is the main switchboard with each of the How-Tos listed for this chapter. Click on How-To 13.3. The form for How-To 13.3 opens.</P>
<P>If you type <TT>FSBarker</TT> for the User and <TT>Test</TT> for the Password, you get a message box telling you that you can continue into the application (see Figure 13.13).</P>



<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Create a new Visual Studio .NET project using the Windows Application project template. Create a Windows Form, and place the controls shown in Table 13.1 in the order displayed in Figure 13.13.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 13.1. Label, TextBox, and Command Button Control Property Settings</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>User</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtUser</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Password</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtPassword</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnLogin</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P></span></LI><LI><span style="font-weight:normal" value="2"><P>As described in the "Technique" section, set a reference to the Web Service you created in the previous How-To. Remember to point to the *.asmx file created in the Web Service. Choose Add Web Reference from the Project menu.</P></span></LI><LI><span style="font-weight:normal" value="3"><P>Add the code listed in Listing 13.3 to the Click event of btnLogin by double-clicking on the button. This routine instantiates an instance of the Web Service. Then, using the wsSec object, the routine calls the <TT>TestUserPassword</TT> method. This method is passed the username and password that were entered.</P>
<H5 class="docExampleTitle">Listing 13.3 <TT>frmHowTo13_3.vb</TT>: Web Method to Validate Username and Password</H5>
<PRE>
Private Sub btnLogin_Click(ByVal sender As System.Object,
            ByVal e As System.EventArgs) Handles btnLogin.Click

        Dim wsSec As localhost.SecurityServices

        wsSec = New localhost.SecurityServices()

        If wsSec.TestUserPassword(Me.txtUser.Text, Me.txtPassword.Text) Then
            MessageBox.Show("You may go into the applcation.")
        Else
            MessageBox.Show("You may not go into the application.")
        End If

End Sub
</PRE></span></LI></OL></span>
<CENTER><H5 class="docFigureTitle">Figure 13.13. This login form takes advantage of a Web Service for authentication.</H5><p><IMG BORDER="0" WIDTH="180" HEIGHT="100" src="FILES/13fig13.jpg" ALT="graphics/13fig13.jpg"></p>
</CENTER>
<H4 class="docSection2Title"> Comment</H4>
<P>Note that passing parameters and using the return value is just like using methods from other objects or even functions from your own applications.</P>
<ul></ul>
</body></html>
