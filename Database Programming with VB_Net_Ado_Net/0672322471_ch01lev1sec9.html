<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="1.9 Drill Down to Data in the DataGrid Control"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">1.9 Drill Down to Data in the DataGrid Control</H3>
<P>The DataGrid control in Visual Basic .NET is an effective way to display multiple records related to a base table, such as Customer and Orders tables. You can then drill down into individual orders to see the details. This How-To explains how to open an additional form with another DataGrid control and drill down to the order details.</P>
<P>Although it is nice to see what orders a customer has, you would like to display more information about the orders. How do you drill down into the details of the orders displayed in the DataGrid control?</P>
<H4 class="docSection2Title"> Technique</H4>
<P>Using the form you started in How-To 1.8, you are going to allow the user to highlight a specific order. You are going to drill down to it by opening a new form and having that form's text boxes display order header information. Then you will use another DataGrid control to display order details. You can see this example in Figure 1.15.</P>
<CENTER><H5 class="docFigureTitle">Figure 1.15. Drilling down to an order's detail.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="402" src="FILES/01fig15.jpg" ALT="graphics/01fig15.jpg"></p>
</CENTER>
<P>Besides adding a new form, you will also create a new module to be used to declare a public variable for tracking the calling form. In the previous examples, the sample form was opened by declaring a variable in the <TT>Click</TT> event of the individual Button controls on <TT>frmMain</TT>. For this How-To, the declaration of the variable pointing to that specific form has been moved to a public module. You can see the code for the <TT>Click</TT> event for <TT>btnHowTo1</TT>_<TT>8</TT> and <TT>btnHowTo_9</TT> in Listing 1.26.</P>
<H5 class="docExampleTitle">Listing 1.26 <TT>frmMain.vb</TT>: Opening a New Form to Display Order Information</H5>
<PRE>
Private Sub btnHowTo1_8_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) _
Handles btnHowTo1_8.Click

        Dim frm1_8 As frmHowTo1_8

        frm1_8 = New frmHowTo1_8()

        frm1_8.Show()

    End Sub

    Private Sub btnHowTo1_9_Click(ByVal sender As _
           System.Object, ByVal e As System.EventArgs) _
           Handles btnHowTo1_9.Click

        frm1_9a = New frmHowTo1_9a()

        frm1_9a.Show()

    End Sub
</PRE>
<P>Listing 1.27 presents the code for the module created, called <TT>modPublicVariables</TT>.</P>
<H5 class="docExampleTitle">Listing 1.27 <TT>modPublicVariables.vb</TT>: Declaring a Public Variable for a Form</H5>
<PRE>
Module modPublicVariables

    Public frm1_9a As frmHowTo1_9a

End Module
</PRE>
<H4 class="docSection2Title"> Steps</H4>
<P>You will want to create a module as described in the "Technique" section of this How-To to open the form that you created in How-To 1.8. After you have created that module and added the Public variable declaration as shown in Listing 1.27, open the form from How-To 1.8 in Design.</P>






<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Add a button control to the bottom-right side of the form, under the <TT>DataGrid</TT> control. Set the Name property to <TT>btnOrderDetail</TT> and the Text property to <TT>&amp;Order Detail</TT>.</P></span></LI><LI><span style="font-weight:normal" value="2"><P>In the <TT>Click</TT> event of the <TT>btnOrderDetail</TT>, add the code shown in Listing 1.28.</P>
<H5 class="docExampleTitle">Listing 1.28 <TT>frmHowTo1_9.vb</TT>: Opening a New Form to Display Order Information</H5>
<PRE>
Private Sub btnOrderDetail_Click(ByVal sender As System.Object,
            ByVal e As System.EventArgs) Handles btnOrderDetail.Click

        Dim frm As New frmHowTo1_9b()
        frm.Show()

    End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="3"><P>Create a new form and name it <TT>frmHowTo1_9b</TT> (or whatever you called it when following Listing 1.28).</P></span></LI><LI><span style="font-weight:normal" value="4"><P>Add some <TT>OleDataAdapters</TT> and <TT>DataSets</TT> to the form, as laid out in Table 1.9.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 1.9. <TT>OleDataAdapter</TT> and DataSet Controls for the frmHowTo1_9b Form</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>OleDataAdapter</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>odaIndividualOrder</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>SelectCommand</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>OleDbSelectCommand1</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>CommandText</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>SELECT OrderID</TT>, <TT>CustomerID</TT>, <TT>EmployeeID</TT>, <TT>OrderDate</TT>, <TT>RequiredDate</TT>, <TT>ShippedDate</TT>, <TT>ShipVia</TT>, <TT>Freight</TT>, <TT>ShipName</TT>, <TT>ShipAddress</TT>, <TT>ShipCity</TT>, <TT>ShipRegion</TT>, <TT>ShipPostalCode</TT>, <TT>ShipCountry FROM Orders WHERE (OrderID = ?)</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataSet</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsIndividualOrder</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>DataSetName</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsIndividualOrder</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>OleDataAdapter</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>odaEmployees</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>SelectCommand</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>OleDbSelectCommand2</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>CommandText</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>SELECT EmployeeID</TT>, <TT>RTRIM(LastName) + '</TT>, <TT>' + RTRIM(FirstName) AS FullName FROM Employees</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataSet</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsEmployees</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>DataSetName</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsEmployees</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>OleDataAdapter</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>odaOrderDetails</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>SelectCommand</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>OleDbSelectCommand3</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>CommandText</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>SELECT OrderID</TT>, <TT>ProductID</TT>, <TT>UnitPrice</TT>, <TT>Quantity</TT>, <TT>Discount FROM [Order Details] WHERE (OrderID = ?)</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataSet</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsOrderDetails</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>DataSetName</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsOrderDetails</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P></span></LI><LI><span style="font-weight:normal" value="5"><P>Add the controls that will use these data controls for data sources, found in Table 1.10.</P><P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 1.10. Controls to Display Order Information, Including Order Details</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Label1</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>"Order ID"</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Label2</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>"Order Date</TT>"</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Label3</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>"Employee"</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtOrderID</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>BorderStyle</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>FixedSingle</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsIndividualOrder - Orders</TT>.OrderID</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DateTimePicker</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>DateTimePicker1</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>DataBindings - Value</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsIndividualOrder</TT> - <TT>Orders</TT>.<TT>OrderDate</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Format</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Short</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>ComboBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>cboEmployees</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>DataSource</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsEmployees</TT>.<TT>Employees</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>DisplayMember</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>FullName</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>ValueMember</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>EmployeeID</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>SelectedValue</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsIndividualOrder - Orders</TT>.<TT>EmployeeID</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataGrid</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dgOrderDetails</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>DataSource</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>DsOrderDetails</TT>.<TT>Order</TT>_<TT>Details</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P></span></LI><LI><span style="font-weight:normal" value="6"><P>Add the code in Listing 1.29 to the Load event of the new form you have created. The first thing that this code does is fill the DataSet control use by <TT>cboEmployees</TT>. Next, using the <TT>CurrentCell.RowNumber</TT> property of the DataGrid control used on the <TT>frmHowTo1_9a form</TT>, the OrderID column is read in the specified row of the <TT>DataSet</TT> control called <TT>dsOrdersForCustomer</TT>.</P>
<P>The OrderID, which is stored in <TT>lngOrderID</TT>, is supplied to <TT>odaIndividualOrder</TT> and <TT>odaOrderDetails</TT>. Then the <TT>OleDbDataAdapters</TT> are used to fill the datasets.</P>
<H5 class="docExampleTitle">Listing 1.29 <TT>frmHowTo1_9b.vb</TT>: Loading the Appropriate Datasets</H5>
<PRE>
Private Sub frmHowTo1_9b_Load(ByVal sender As Object, _
                        ByVal e As System.EventArgs) Handles MyBase.Load

        Dim lngOrderID As Long

        '- Fill the dataset used for the Employee combo box.
        Me.odaEmployees.Fill(Me.dsEmployees)

        '- Get the OrderID from the currently select order
        '- in the DataGrid control on the calling form.

        lngOrderID = frm1_9a.dsOrdersForCustomer. _
                Orders.Rows(frm1_9a.dgOrders.CurrentCell. _
                RowNumber).Item("OrderID")

        '- Update the caption of the form with the order ID and customer
        Me.Text = "Order #" &amp; CStr(lngOrderID) &amp; _
                            " For " &amp; frm1_9a.cboCustomers.Text

        '- Load the parameter for the order header with the InvoiceID
        Me.odaIndividualOrder.SelectCommand.Parameters(0).Value = lngOrderID

        '- Fill the order header dataset
        Me.odaIndividualOrder.Fill(Me.dsIndividualOrder)

        '- Load the parameter for the order detail with the InvoiceID
        Me.odaOrderDetails.SelectCommand.Parameters(0).Value = lngOrderID

        '- Fill the order detail dataset
        Me.odaOrderDetails.Fill(Me.DsOrderDetails)

    End Sub
</PRE></span></LI></OL></span>
<H4 class="docSection2Title"> How It Works</H4>
<P>The user highlights one of the Orders in the <TT>dgOrders</TT> on the first form and then clicks the <TT>btnOrderDetail</TT> button to open the second form. The second form is used to display the details of the order. When the second form is opened, the <TT>cboEmployee</TT> ComboBox control is loaded, and the OrderID is retrieved from <TT>dsOrdersForCustomer</TT> via <TT>dgOrders</TT>, located on the first form. The DataSets controls <TT>dsIndividualOrder</TT> and <TT>dsOrderDetails</TT> are then filled.</P>
<H4 class="docSection2Title"> Comments</H4>
<P>This is just a start of what can be done using the <TT>DataGrid</TT> control. You will see this control used in quite a few chapters, including Chapter 3 and 4. As you can see from the way the OrderID was retrieved from the first form, it can be a little confusing when you need to get to the data programmatically.</P>
<ul></ul>
</body></html>
