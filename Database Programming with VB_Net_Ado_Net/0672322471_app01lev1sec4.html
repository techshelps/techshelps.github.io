<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="Using the 'Connection' Object"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title"> Using the <TT>Connection</TT> Object</H3>
<P>As with ADO.NET, you will be using the <TT>Connection</TT> object to set up a connection to the database of your choice.</P>
<P>As you get started looking at the different examples, take a look at the main form that will be used to launch each of them, shown in Figure A.3.</P>
<CENTER><H5 class="docFigureTitle">Figure A.3. This form, called <TT>frmMain</TT>, is the Main form that is used for the examples in this Appendix.</H5><p><IMG BORDER="0" WIDTH="480" HEIGHT="384" src="FILES/afig03.jpg" ALT="graphics/afig03.jpg"></p>
</CENTER>
<P>The button that is used for this example is called btnOpenConn, and the following is the code used for the <TT>Click</TT> event, shown here in Listing A.1.</P>
<H5 class="docExampleTitle">Listing A.1 <TT>frmMain.vb</TT>: Code for Calling the Routine to Open and Display the ADO Connection</H5>
<PRE>
Private Sub btnOpenConn_Click(ByVal sender As System.Object, _
                        ByVal e As System.EventArgs) Handles btnOpenConn.Click

        OpenAndDisplayADOConnection(Me.txtCurrentResults)

End Sub
</PRE>
<P>Each of the buttons calls examples, passing the text box called <TT>txtCurrentResults</TT>. This text box is located at the bottom of the form. For clarity, the examples have been grouped in modules by section. In this case, the first example routine, called O<TT>penAndDisplayADOConnection</TT>, can be found in <TT>basConnectionExamples.vb</TT>. The code for this routine is shown in Listing A.2.</P>
<H5 class="docExampleTitle">Listing A.2 <TT>basConnectionExamples.vb</TT>: Code for Opening and Displaying the ADO Connection</H5>
<PRE>
Sub OpenAndDisplayADOConnection(ByVal txtResults As TextBox)

        Dim cnnNet As New ADODB.Connection()
        Dim strConnect As String = _
          "Provider=SQLOLEDB.1;Integrated Security=SSPI;" &amp;
               "Persist Security Info=False;Initial Catalog=Northwind;Data Source=(local)"

        cnnNet.Open(strConnect)

        txtResults.Text = "New connection string : " &amp; _
           vbCrLf &amp; vbCrLf &amp; cnnNet.ConnectionString

        cnnNet.Close()

End Sub
</PRE>
<P>As you can see from this example, using the ADO <TT>Connection</TT> object is virtually the same as ADO.NET. You can see this example being executed in Figure A.4.</P>
<CENTER><H5 class="docFigureTitle">Figure A.4. The text displayed here is the connection string that was set.</H5><p><IMG BORDER="0" WIDTH="480" HEIGHT="384" src="FILES/afig04.jpg" ALT="graphics/afig04.jpg"></p>
</CENTER>
<P>Listing A.3 provides two other examples of using the connection object, also found in basConnectionExamples.vb. The first is code to open a connection to a Jet database by using a workgroup file, username, and password. The second is to open a Jet version of the Northwind database.</P>
<H5 class="docExampleTitle">Listing A.3 <TT>basConnectionExamples.vb</TT>: Two Examples of Opening Jet Databases</H5>
<PRE>
Sub DisplayProviderAndSecuredAccessDB(ByVal txtResults As TextBox)

     Dim cnnNet As New ADODB.Connection()

     cnnNet.Provider = "Microsoft.Jet.OLEDB.4.0"

     cnnNet.Properties("Jet OLEDB:System database").Value = _
         "c:\Books\VBNETHowTo\Examples\AppA\MySystem.mdw"

     cnnNet.Open("Data Source=c:\Books\VBNETHowTo\Examples\AppA\MyMDB.mdb;" &amp;
         "User Id=Admin;Password=MyPW")

     txtResults.Text = cnnNet.ConnectionString

 End Sub

 Sub OpenNorthwindADOConnection(ByRef cnnCurr As ADODB.Connection)

     Dim strConnect As String = "Provider=SQLOLEDB.1;Integrated Security=SSPI;"
         &amp; "Persist Security Info=False;Initial Catalog=Northwind;Data
         Source=(local)"

     Try
         cnnCurr.Open(strConnect)

     Catch expADO As Exception
         MessageBox.Show("The following error occurred: " &amp; expADO.Message)

     End Try

 End Sub
</PRE>
<P>In the last routine, you can also see how to use the <TT>Try&#8230;Catch&#8230;End Try</TT> block to trap any exceptions that might occur. Next you will see how to use the Connection object with the Recordset object in VB .NET.</P>
<img src="FILES/pixel.gif" width="1" height="1" border="0"><ul></ul>
</body></html>
