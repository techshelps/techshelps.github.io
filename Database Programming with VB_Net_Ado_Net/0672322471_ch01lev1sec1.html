<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="1.1 Create a Bound List Box"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">1.1 Create a Bound List Box</H3>
<P>It used to be that when you wanted to create a data entry form, you just assigned a recordset to the data control and allowed the users to scroll through the data, making changes as needed. When you're dealing with Client Server or Web applications, this just doesn't cut it.</P>
<P>One of the first things you need to do is provide a method to limit the amount of data so that users can pick which record they want to edit/view, without pulling all the fields of a table over the Net-either LAN or Internet. List boxes and combo boxes help with that. In this How-To, you will learn how to set up two data controls: <TT>OleDbDataAdapter</TT> and <TT>DataSet</TT>. These controls enable you to populate a list box with one line of code.</P>
<P>You want to see a list of customers on your Windows form in a <TT>ListBox</TT> control. You don't want to write code at this point. You only want to prototype a form, so you just want to use bound data controls. How do you create a list box and bind it using the data controls?</P>
<H4 class="docSection2Title"> Technique</H4>
<P>To get started with learning about any of the objects used for data in .NET, it's important to talk about what .NET Namespaces are and how to use them.</P>
<H5 class="docSection3Title"> Using .NET Namespaces</H5>
<P>The .NET Framework contains a big class library. This class library consists of a number of Namespaces. These Namespaces are made up of various classes that allow us to create our objects. All of the objects and classes that make up the .NET objects, such as forms, controls, and the various data objects, can be found in Namespaces.</P>
<P>Namespaces also can be made up of other Namespaces. For example, there is a Namespace called <TT>System.Data</TT>. Although this Namespace has classes in it, such as <TT>DataSet</TT> and <TT>DataTable</TT>, it also has Namespaces within it called <TT>System.Data.OleDb</TT> and <TT>System.Data.SQLClient</TT>, as well as others. To check out the .NET Namespaces, choose Object Browser from the View menu. You can then expand the <TT>System.Data</TT> Namespace to see the other Namespaces contained within.</P>
<P>If you are positive that the database you are going to be working with is SQL Server, then you would be far better served performance-wise to use the classes found in the <TT>System.Data.SQLClient</TT> Namespace. However, if you are not sure what database you will be working against, you should use the classes found in System.Data.OleDb.</P>
<P>For this book, I am using objects created from the classes in the <TT>System.Data.OleDb</TT> Namespace. That way, you can use the routines against other databases with less modifications.</P>
<div class="docNote"><p class="docNoteTitle">Tip</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/tip_icon.gif" ALT="graphics/tip_icon.gif"></td>
<td valign="top"><P>If you know that the back end that you will be accessing is SQL Server, then use the SQL Server type data controls because they are optimized for it.</P>
</td>
</tr></table></p>
</div><br>
<P>Eight data controls are available for Windows forms. Table 1.1 lists these controls and their uses. You can find these controls by clicking on the Data group in the toolbox.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 1.1. Data Controls Used in Windows Forms</h5></CAPTION><COLGROUP span="2">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Control Name</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Purpose</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataSet</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>This control is used in conjunction with the other data controls, storing the results that are returned by commands and the <TT>DataAdapter</TT>s. Unlike the recordset from ADO and DAO, the <TT>DataSet</TT> actually brings back a hierarchical view of the data. Using properties and collections in the <TT>DataSet</TT> object, you can get all the way down to individual tables, rows, and columns.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>OleDbDataAdapter</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>This control stores and manages the commands you want to use against an OleDb provider such as Jet, Oracle, or SQL Server. The commands for selecting, updating, inserting, and deleting records can be used. The Connection against which to use the commands is also tracked.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>OleDbConnection</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>This control maintains connection information for an OleDb provider. This control is used with the <TT>OleDbDataAdapter</TT>.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>OleDbCommand</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Similar to the ADO command object, this control allows you to execute SQL statements or stored procedures to either run bulk operations or return data.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>SqlDataAdapter</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>This control is the same as the <TT>OleDbDataAdapter</TT> except that it is for use only against SQL Server stores.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>SqlConnection</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>This control is the same as the <TT>OleDbConnection</TT> except that it is for use only against SQL Server stores.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>SqlCommand</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>This control is the same as the <TT>OleDbCommand</TT> except that it is for use only against SQL Server stores.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataView</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>This control creates multiple views of the same table. This includes looking at data in various states such as deleted, changed, or sorted differently.</P>
</TD>
</TR>
</COLGROUP>
</TABLE></P>
<P>Creating two types of the data controls just mentioned, <TT>OleDbDataAdapter</TT> and <TT>DataSet</TT>, bind them to a list box to display a list of customers. Note that an <TT>OleDbConnection</TT> control is also created, but Visual Studio .NET creates it. You then add a line of code to fill the dataset.</P>
<H4 class="docSection2Title"> Steps</H4>
<P>To preview this How-To, open the solution called VB.Net-Chapter1 found in the chapter folder. When you run the project, the first form that comes up is the main switchboard with each of the How-Tos listed for this chapter. Click on How-To 1.1 to open the form for How-To 1.1 (see Figure 1.1).</P>
<CENTER><H5 class="docFigureTitle">Figure 1.1. Main form and How-To form 1.1 from the first chapter's solution.</H5><p><IMG BORDER="0" WIDTH="328" HEIGHT="272" src="FILES/01fig01.jpg" ALT="graphics/01fig01.jpg"></p>
</CENTER>
<div class="docNote"><p class="docNoteTitle">Note</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/note_icon.gif" ALT="graphics/note_icon.gif"></td>
<td valign="top"><P>You can find the source code for all the chapters in the book at www.samspublishing.com. After you are there, just type the book ISBN (0672322471).</P>
</td>
</tr></table></p>
</div><br>








<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Create a new Visual Studio .NET project using the Windows Application project template. This creates the initial form called Form1 that you will use.</P></span></LI><LI><span style="font-weight:normal" value="2"><P>Drag the <TT>OleDbDataAdapter</TT> control from the Data Controls group located in the toolbox and drop it onto the form. The Data Adapter Configuration Wizard appears. Read the introductory screen, and then click Next to choose your data connection. At this point, if you don't see a data connection to Northwind database in the drop-down list of data connections to use, click the New Connection button. You then see the Data Link Properties dialog box with which you are familiar if you have used other Microsoft products such as Visual Studio 6.0. Type (local) for the server name, select Use Windows NT Integrated Security, and select Northwind for the database (see Figure 1.2.) Click OK.</P>
<CENTER><H5 class="docFigureTitle">Figure 1.2. From now on, this data connection will show up in Visual Studio .NET's Server Explorer on this machine.</H5><p><IMG BORDER="0" WIDTH="367" HEIGHT="460" src="FILES/01fig02.jpg" ALT="graphics/01fig02.jpg"></p>
</CENTER></span></LI><LI><span style="font-weight:normal" value="3"><P>Now you will be back on the Choose Your Data Connection page of the Data Adapter Configuration Wizard, with the Northwind database in the Data Connection drop-down list. Click Next. This brings you to the page to select the query type on which the data adapter will be based. Leave the default of Use SQL Statements, and click Next. In the text box that asks What Data Should the Data Adapter Load into the Dataset?, type the following:</P>
<pre>
Select CustomerID, CompanyName From Customers
</pre>
<div class="docNote"><p class="docNoteTitle">Note</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/note_icon.gif" ALT="graphics/note_icon.gif"></td>
<td valign="top"><P>By default, the Data Adapter Configuration Wizard creates select statements not only for selecting (viewing) data, but also for inserting, updating, and deleting. If you don't need these other options, click the Advanced Options button at the bottom-left corner of the dialog box. Deselect the check box that reads Generate Insert, Update, and Delete statements. You don't need this because we are just using the data to fill a <TT>ListBox</TT> control. Click OK to close the Advanced Options dialog box.</P>
</td>
</tr></table></p>
</div></span></LI><LI><span style="font-weight:normal" value="4"><P>Click Next to see results of your select statement, as shown in Figure 1.3. If you see something different from Figure 1.3, you either have entered your select statement incorrectly, or you have forgotten to deselect the advanced options.</P>
<CENTER><H5 class="docFigureTitle">Figure 1.3. Success in creating the data adapter.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="446" src="FILES/01fig03.jpg" ALT="graphics/01fig03.jpg"></p>
</CENTER></span></LI><LI><span style="font-weight:normal" value="5"><P>Click Finished to create a data adapter and connection object. You then see a new data adapter control called <TT>OleDbDataAdapter1</TT> and a Connection control called <TT>OleDbConnection1</TT>. Both controls are in the Components tray below the Form designer.</P></span></LI><LI><span style="font-weight:normal" value="6"><P>After you have created the first two controls, it is time to create the Dataset object. Right-click on the Data Adapter and choose Generate Dataset from the pop-up menu. This opens the Generate Dataset dialog box. You can keep all the defaults and simply click OK to create a dataset control called <TT>DataSet</TT><span class="docEmphasis"><TT>&lt;number&gt;</TT></span>. (The sequential number might vary if you have generated other dataset controls.)</P></span></LI><LI><span style="font-weight:normal" value="7"><P>Now you are ready to create the <TT>ListBox</TT> control. Drag the <TT>ListBox</TT> control from the Windows Forms group in the toolbox and drop it on your form. Stretch the control to the size of your form, and then set the following properties in Table 1.2 on the <TT>ListBox</TT> control.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 1.2. <TT>ListBox</TT> Control Property Settings Needed to Bind a <TT>DataSet</TT> Control</h5></CAPTION><COLGROUP span="2">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataSource</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>DataSet</TT><span class="docEmphasis"><TT>&lt;Number&gt;</TT></span></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DisplayMember</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Customers.CompanyName</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>ValueMember</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Customers.CustomerID</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P>
<P>Although you have bound the dataset to the correct properties in the <TT>ListBox</TT> control, if you run the form at this point, you will still see a blank <TT>ListBox</TT> control on the form.</P></span></LI><LI><span style="font-weight:normal" value="8"><P>Now it is time for the one line of code in this sample, in the Load event of the form. Click on the View Code button in the Solution Explorer, or choose Code from the View menu. In the Code Editor, select (Base Class Objects) from the Class Name drop-down list, and then select Load from the Methods drop-down list. Next, type the line of code as displayed here, which tells the data adapter to fill the dataset with data:</P>
<pre>
OleDbDataAdapter1.Fill(DataSet1)
</pre>
<P>Be sure to use the names of the controls you created. Listing 1.1 presents the Load event code for the form called <TT>frmHowTo1_1</TT> in the samples.</P>
<H5 class="docExampleTitle">Listing 1.1 <TT>frmHowTo1_1.vb</TT>: Filling the Data Set on Which <TT>ListBox1</TT> Is Based</H5>
<PRE>
Private Sub frmHowTo1_1_Load(ByVal sender As Object, _
ByVal e As System.EventArgs) Handles MyBase.Load

      Me.OleDbDataAdapter1.Fill(Me.DataSet1)

   End Sub
</PRE></span></LI></OL></span>
<H4 class="docSection2Title"> How It Works</H4>
<P>When the form called <TT>frmHowTo1_1</TT> loads, the <TT>Fill</TT> method of the <TT>OleDbDataAdapter1</TT> is called, with the <TT>DataSet1</TT> being passed. Because the DataSource property of <TT>ListBox1</TT> was specified as being <TT>DataSet1</TT> and the <TT>ValueMember</TT> and <TT>DisplayMember</TT> properties are both set appropriately, <TT>ListBox1</TT> is populated with the CustomerID and CompanyName from the Customers table in Northwind. Figure 1.4 shows what the final form looks like in Design view, and Figure 1.5 shows what it looks like when running.</P>
<CENTER><H5 class="docFigureTitle">Figure 1.4. The final design view for your first database how-to.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="375" src="FILES/01fig04.jpg" ALT="graphics/01fig04.jpg"></p>
</CENTER>
<CENTER><H5 class="docFigureTitle">Figure 1.5. This list is based on the Customers table in the Northwind SQL Server database.</H5><p><IMG BORDER="0" WIDTH="328" HEIGHT="272" src="FILES/01fig05.jpg" ALT="graphics/01fig05.jpg"></p>
</CENTER>
<H4 class="docSection2Title"> Comments</H4>
<P>In the .NET version of Visual Basic, Microsoft went to considerable effort to make the data controls more robust than ever. One cool thing is that most of the tasks that are done for you in Visual Basic .NET are discoverable. Even though you are using the data controls on your form, Visual Studio creates the code under the covers. You can see this code by clicking on the #Region statement that reads like this:</P>
<pre>
#Region " Windows Form Designer generated code "
</pre>
<p><span class="docEmphRoman">Beware:</span> 
There is much code here, and you don't want to change it. You can learn a lot from reading it though.</p>
<P>As you continue to use the Data Controls shown here, you will become comfortable with changing various properties and getting more power and use out of them.</P>
<img src="FILES/pixel.gif" width="1" height="1" border="0"><ul></ul>
</body></html>
