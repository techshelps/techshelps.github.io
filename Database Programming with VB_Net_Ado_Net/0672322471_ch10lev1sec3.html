<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="10.3 Add Calculated Fields to the Crystal Reports Report"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">10.3 Add Calculated Fields to the Crystal Reports Report</H3>
<P>Although creating reports based on given fields in tables is fine, it just does not give the flexibility I need. To have that, I need to know how to add calculated fields to my reports.</P>
<H4 class="docSection2Title"> Technique</H4>
<P>In Crystal Reports, calculated fields are known as <span class="docEmphasis">formulas</span>. To create and edit formulas, you will use the Formula Editor (see Figure 10.16).</P>
<CENTER><H5 class="docFigureTitle">Figure 10.16. You can display this Formula Editor from either the Report Expert or the Report design.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="380" src="FILES/10fig16.jpg" ALT="graphics/10fig16.jpg"></p>
</CENTER>
<P>When you're in the Report Expert, you can add a new formula by clicking on the Formula button, located on the Fields tab.</P>
<P>In Report design, you can add a field by opening the Field Explorer, located to the left of the IDE with the toolbox, and expanding the Formula Fields tree. You can also right-click on the Formula Fields base node and choose New to add a new formula.</P>
<P>Formulas are similar to T-SQL expressions in that you can combine fields or values with operators to create a Formula field. For example, a formula called @TotalPricePerUnit is being created for this How-To. You saw it displayed in Figure 10.16. The expression used is this:</P>
<pre>
{Invoices.UnitPrice}*{Invoices.Quantity}
</pre>
<P>You can use Formula fields in summary sections and grand totals. The best way to verify a formula is to create it when you use the Report Expert to create a report.</P>
<H4 class="docSection2Title"> Steps</H4>
<P>Open the Visual Basic .NET-Chapter 10 solution. In the Solution Explorer, you will see the report rptHowTo10_3.rpt. Scroll over to the left so that the last column is visible. This is the Formula field.</P>









<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Right-click on your project in the Solution Explorer and choose Add New Item from the Add menu item. Type the name of the report in the Name field and click Open. The Crystal Report Gallery dialog box opens.</P></span></LI><LI><span style="font-weight:normal" value="2"><P>Leaving the defaults as they are, which is to use the Report Export and create a Standard report, click the OK button. You are taken to the Report Expert, with the Data tab displayed.</P></span></LI><LI><span style="font-weight:normal" value="3"><P>Double-click on the OLE DB (ADO) node in the Available Data Sources tree. If you haven't chosen a data source before, the OLE DB (ADO) dialog box opens asking you to choose an OLE DB provider. Choose Microsoft OLE DB Data Provider for SQL Server and click Next.</P>
<P>You are requested to enter connection information. For this page, type <TT>(local)</TT> for the server, check Integrated Security, and type <TT>Northwind</TT> for the database. Click Finish. Your Available Data Sources will now indicate (Local) under the OLE DB (ADO) node and Northwind under the local connection.</P></span></LI><LI><span style="font-weight:normal" value="4"><P>Expand the tree under Northwind to get to the first DBO, and then expand Views. You will see the views listed, including the Invoices view. Highlight the Invoices view and click Insert Table. The view is displayed in the Tables in Report list (see Figure 10.17). Click Next.</P>
<CENTER><H5 class="docFigureTitle">Figure 10.17. The Report Expert considers both tables and views as tables.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="379" src="FILES/10fig17.jpg" ALT="graphics/10fig17.jpg"></p>
</CENTER></span></LI><LI><span style="font-weight:normal" value="5"><P>From the Fields tab, add the following fields: Invoices.CustomerName, Invoices.OrderID, Invoices.UnitPrice, and Invoices.Quantity.</P></span></LI><LI><span style="font-weight:normal" value="6"><P>Click on the Formula button. Type <TT>TotalPricePerUnit</TT>. Crystal Reports puts the @ before the formula name from now on. You are then brought into the Formula Editor, shown back on Figure 10.16.</P></span></LI><LI><span style="font-weight:normal" value="7"><P>Type the formula {<TT>Invoices.UnitPrice}*{Invoices.Quantity}</TT>; then press Ctrl+S to save and close the dialog box. An alternative is to double-click on the fields you want to include.</P></span></LI><LI><span style="font-weight:normal" value="8"><P>Now select the formula you just created, and add it to the fields to include.</P></span></LI><LI><span style="font-weight:normal" value="9"><P>You can now go on to select how you want the columns totaled and what you want the style of the report to be. Click Finish when you are done.</P></span></LI></OL></span>
<H4 class="docSection2Title"> Comments</H4>
<P>The Formula Editor works similarly to other builders, and it's pretty straightforward to use. Formulas are another step to making sure you can give your clients the full-featured reports they want.</P>
<ul></ul>
</body></html>
