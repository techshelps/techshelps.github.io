<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="5.1 Use Bound Controls with Web Forms"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">5.1 Use Bound Controls with Web Forms</H3>
<P>I want to create a Web Form that allows my users to view data much like my Windows Forms and be able to use data bound controls on it. How do I use data bound controls on a Web Form?</P>
<H4 class="docSection2Title"> Technique</H4>
<P>The data objects that you used in Chapter 1, "Developing Windows Forms Using Bound Controls," including OleDbDataAdapter, datasets, and so on, will be used with Web Forms as they would with Windows Forms. The main difference between Windows Forms and Web Forms in this case is the extra steps needed to handle round trips to the server from the client machines. For discussion on OleDBDataAdapters and datasets, see Chapter 1.</P>
<H5 class="docSection3Title"> The <TT>IsPostBack</TT> Property</H5>
<P>One property that you will be using when you're developing Web forms is the <TT>IsPostBack</TT> property, which is used in the Load event of the Web Form. That's right-Web Forms now have an event model much like Windows Forms. You can now work with the Web Form properties and Web server control properties from the Web page's class module.</P>
<P>The <TT>IsPostBack</TT> property is set to <TT>True</TT> if the load event is fired on a round trip from the server. Therefore, the first time a Web Form is loaded, <TT>IsPostBack</TT> is <TT>False</TT>.</P>
<H5 class="docSection3Title"> Web Server Controls Versus HTML Controls</H5>
<P>Within ASP.NET Web Forms, you now have the ability to use either your classic HTML controls, which are available for compatibility purposes, or the new Web server controls, which, because they run on the server, have the following advantages:</P>
<UL>
<LI><P>You can access Web server control properties and methods from the Web Forms class module, but not with HTML controls.</P></LI>
<LI><P>Because Web server controls are rendered from the server side, on the client side they come through as pure HTML, and they are compatible with more browsers and earlier versions.</P></LI>
<LI><P>Web server controls generally have more features than their HTML counterparts, and in some cases, they can be bound to data.</P></LI>
</UL>
<div class="docNote"><p class="docNoteTitle">Note</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/note_icon.gif" ALT="graphics/note_icon.gif"></td>
<td valign="top"><P>You can change some of the HTML controls to Web server controls by placing the control on the Web Form, right-clicking on the control, and choosing Run as Web Server Control from the pop-up menu.</P>
<P>After choosing this menu option, you can see the object in your code behind your page.</P>
</td>
</tr></table></p>
</div><br>
<div class="docNote"><p class="docNoteTitle">Note</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/note_icon.gif" ALT="graphics/note_icon.gif"></td>
<td valign="top"><P>Although you will be dealing with a ListBox Web server control, it has different properties and methods than the Windows Form ListBox control. These are discussed in the following steps.</P>
</td>
</tr></table></p>
</div><br>
<H5 class="docSection3Title"> The <TT>AutoPostBack</TT> Property</H5>
<P>Web server controls have a property called <TT>AutoPostBack</TT>. This property tells .NET to post back to the server, which is something you need to do if you want to have an event fire off, such as the <TT>SelectedIndexChanged</TT> event of the lstCustomers list box. This is also true for Button controls that are used.</P>
<H5 class="docSection3Title"> The <TT>DataBind</TT> Method</H5>
<P>When you're binding Web server controls-in this case, a <TT>ListBox</TT> control-to data such as <TT>DataSet</TT> or <TT>DataTable</TT> objects, you need to invoke the <TT>DataBind</TT> method of the control that is being bound. You need to do this when data changes, as you will see in the following steps.</P>
<H4 class="docSection2Title"> Steps</H4>
<P>Open and run the Visual Basic .NET-Chapter 5 solution. From the main page, click on the hyperlink with the caption How-To 5.1: Using Data Bound Controls with Web Forms. When the Web Form loads, you will see a list box filled with customers, and the details for the first customer will be displayed in the list (see Figure 5.1).</P>
<CENTER><H5 class="docFigureTitle">Figure 5.1. Arrange the controls on the form you created to look like this form.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="375" src="FILES/05fig01.jpg" ALT="graphics/05fig01.jpg"></p>
</CENTER>
<P>To start off, you will be creating a Web Form that is similar to a Windows Form that was created in Chapter 1. You will actually be creating the form exactly the way you did in the first chapter with the Windows Form, with the exception of a few commands in the code.</P>




<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Create a Web Form. Then place the controls listed in Table 5.1 with the following properties set. You will be using Northwind for the database to connect to.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 5.1. Label, TextBox, ListBox, and Command Button Control Property Settings</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>OleDbDataAdapter</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>odaCustomerList</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>SelectCommand</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Select CustomerID</TT>, <TT>CompanyName From Customers</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataSet</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsCustomerList</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>OleDbDataAdapter</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>odaCustomerIndividual</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>SelectCommand</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Select * From Customers Where Customer ID = ?</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataSet</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsCustomerIndividual</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>ListBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>lstCustomers</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>DataSource</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsCustomerList</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>DataTextField</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>CompanyName</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>DataValueField</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>CustomerID</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>AutoPostBack</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>True</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Customer ID</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Company Name</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Contact</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Contact Title</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Address</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>City</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Region</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Country</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Phone</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Fax</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtCustomerID</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsCustomerIndividual - Customers.CustomerID</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtCompanyName</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsCustomerIndividual - Customers.CompanyName</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtContactName</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsCustomerIndividual - Customers.Contact</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtContactTitle</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsCustomerIndividual - Customers.ContactTitle</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtAddress</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsCustomerIndividual - Customers.Address</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtCity</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsCustomerIndividual - Customers.City</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtRegion</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsCustomerIndividual - Customers.Region</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtPostalCode</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsCustomerIndividual - Customers.PostalCode</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtCountry</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsCustomerIndividual - Customers.Country</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtPhone</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsCustomerIndividual - Customers.Phone</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtFax</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsCustomerIndividual - Customers.Fax</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>HyperLink</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>hplReturnToMain</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>NavigateURL</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>wfrmMain.aspx</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P></span></LI><LI><span style="font-weight:normal" value="2"><P>Add the code in Listing 5.1 to the Load event of the page. (Double-click on the page to bring up the code.) The first command you see is the if statement, which tests to see whether the page is being loaded for the first time. If it is, then the <TT>dsCustomerList</TT> dataset is filled using the odaCustomerList <TT>OleDbDataAdapter</TT>. Next, the <TT>DataBind</TT> method is called. Last, the first item in lstCustomers is selected, and the <TT>RefreshIndividual</TT> routine is called, which is described in the next step.</P>
<H5 class="docExampleTitle">Listing 5.1 <TT>wfrmHowTo5_1.aspx.vb</TT>: Loading the Page</H5>
<PRE>
Private Sub Page_Load(ByVal sender As System.Object, _
            ByVal e As System.EventArgs) Handles MyBase.Load

        '-- Perform only the first time the page is loaded
        If Not Page.IsPostBack Then

            '-- Fill the customer list box dataset
            Me.odaCustomerList.Fill(Me.dsCustomerList)

            '-- Bind the list box to the dataset
            Me.lstCustomers.DataBind()

            '-- Pick the first customer in the list and
            '   display the individual's data
            Me.lstCustomers.SelectedIndex = 0
            RefreshIndividual()

        End If

End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="3"><P>Add the code in Listing 5.2 to the class module of the page, creating the <TT>RefreshIndividual</TT> routine. The routine starts off by clearing the dataset and then tests to make sure a customer is selected. Next, the data adapter parameter is supplied with the item that is selected in lstCustomers, which will be the CustomerID. <TT>dsCustomerIndividual</TT> is filled, and the <TT>DataBind</TT> method of each of the text boxes is called.</P>
<H5 class="docExampleTitle">Listing 5.2 <TT>wfrmHowTo5_1.aspx.vb</TT>: Listing Detail Information About the Customers</H5>
<PRE>
Private Sub RefreshIndividual()

        '-- Clear individual customer dataset
        Me.dsCustomerIndividual.Clear()

        If lstCustomers.SelectedIndex &lt;&gt; -1 Then

            Me.odaCustomerIndividual.SelectCommand.Parameters(0).Value = _
                            lstCustomers.SelectedItem.Value

            '-- Fill the dataset
            Me.odaCustomerIndividual.Fill(Me.dsCustomerIndividual, "Customers")

            '-- Call the DataBind method for each of the text boxes
            Me.txtCustomerID.DataBind()
            Me.txtCompanyName.DataBind()
            Me.txtContactName.DataBind()
            Me.txtContactTitle.DataBind()
            Me.txtAddress.DataBind()
            Me.txtCity.DataBind()
            Me.txtRegion.DataBind()
            Me.txtCountry.DataBind()
            Me.txtPostalCode.DataBind()
            Me.txtPhone.DataBind()
            Me.txtFax.DataBind()

        End If
End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="4"><P>Add the code in Listing 5.3 to the <TT>SelectedIndexChanged</TT> event of lstCustomers.</P>
<H5 class="docExampleTitle">Listing 5.3 <TT>wfrmHowTo5_1.aspx.vb</TT>: Calling the <TT>RefreshIndividual</TT> Routine for Each New Customer Who Is Selected</H5>
<PRE>
Private Sub lstCustomers_SelectedIndexChanged(ByVal sender As System.Object, _
                    ByVal e As System.EventArgs) Handles lstCustomers.SelectedIndexChanged
        RefreshIndividual()
End Sub
</PRE></span></LI></OL></span>
<H4 class="docSection2Title"> Comments</H4>
<P>Using bound controls on Web Forms-or unbound controls, for that matter, such as list boxes-does not take much more work than it does in Windows Forms. Except for maintaining the data, binding can take more work with the round trips to the server to deal with, as you will see in How-To 5.7.</P>
<ul></ul>
</body></html>
