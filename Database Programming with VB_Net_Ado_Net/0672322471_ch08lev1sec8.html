<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="8.8 Make a Generic Search Form in an ASP.NET Web Application"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">8.8 Make a Generic Search Form in an ASP.NET Web Application</H3>
<P>This tutorial will show you how to add a unique search Web Form to your Web application that can be set up using session variables and used for various tables.</P>
<P>Creating search forms for Web applications is pretty common. You would like to be able to use the same Web Form for different tables in the same application.</P>
<P>This How-To will demonstrate using the same Web Form for searching various tables, taking advantage of the <TT>Session</TT> object.</P>
<H4 class="docSection2Title"> Technique</H4>
<P>This How-To will use the <TT>Session</TT> object with a Web Form, something that has been done throughout the book. You will see a good example of using the Session object to pass values-in this case, the record source, the key search field, and the display search field-to the search form. Finally, the return value will be passed back to the calling Web Form using the Session object.</P>
<P>One new control that is used in this How-To is the Panel control. It will be used to group the controls on the search Web Form. The Panel control will be used simply by throwing controls into it and letting it control the layout.</P>
<P>You will see the paging used with the DataGrid control as well.</P>
<H4 class="docSection2Title"> Steps</H4>
<P>Open and run the VB.NET -Chapter 8 solution. From the main Web Form, click on the hyperlink with the caption How-To 8.8: Make a Generic Search Form Using a Web Form. This page is a simple one that contains text boxes for the Customer table in Northwind (see Figure 8.15).</P>
<CENTER><H5 class="docFigureTitle">Figure 8.15. This Customers page is a common one used to demonstrate calling the search form.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="375" src="FILES/08fig15.gif" ALT="graphics/08fig15.gif"></p>
</CENTER>
<P>Click on the Search button to open the search page, and then click on the button labeled B. You will see the <TT>DataGrid</TT> object displayed in the bottom of the form filled with the CompanyID and CompanyName fields of the Customer table, which begin with B (see Figure 8.16).</P>
<CENTER><H5 class="docFigureTitle">Figure 8.16. This form can be used for searching within any of the tables in your databases.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="375" src="FILES/08fig16.gif" ALT="graphics/08fig16.gif"></p>
</CENTER>
<P>Click the Select button for one of the customers who is displayed in the grid, and then click Accept. The customer page will be displayed, and the fields will be filled in with the data from the chosen record.</P>












<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Create a Web Form. Then place the controls shown in Figure 8.16 of the form calling the search form, with the properties set forth in Table 8.10.</P><P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 8.10. Label, TextBox, and Command Button Controls Property Settings for the Calling Form</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DOCUMENT</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>bgColor</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>buttonface</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Customer ID</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Company Name</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Contact</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Contact Title</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Address</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>City</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Region</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Country</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Phone</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Fax</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT> </P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtCustomerID</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtCompanyName</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtContactName</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtContactTitle</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtAddress</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtCity</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtRegion</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtPostalCode</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtCountry</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtPhone</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtFax</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnSearch</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>&amp;Search</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P></span></LI><LI><span style="font-weight:normal" value="2"><P>On btnSearch, add the code in Listing 8.45 to the Click event. This sets up the search Web Form as far as telling it what it needs to know, including how to get back to this page, which is the calling page. The search page, in this case "wfrmHowTo8_8b.aspx," is then opened.</P>
<H5 class="docExampleTitle">Listing 8.45 <TT>frmHowTo8_8a.vb</TT>: Storing Values to the Session Object for Use on Another Page</H5>
<PRE>
Private Sub btnSearch_Click(ByVal sender As System.Object,
                ByVal e As System.EventArgs) Handles btnSearch.Click

        Session.Item("SearchRecordSource") = "Customers"
        Session.Item("SearchField") = "CompanyName"
        Session.Item("KeyField") = "CustomerID"
        Session.Item("CallingPage") = "wfrmHowTo8_8a.aspx"

        Server.Transfer("wfrmHowTo8_8b.aspx")

End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="3"><P>Add the code in Listing 8.46 to the <TT>Load</TT> event of the Web Form. If the <TT>Session</TT> object has an entry for <TT>ResultValue</TT>, then the <TT>LoadIndividual</TT> routine is executed and the <TT>ResultValue</TT> is passed. The <TT>LoadIndividual</TT> routine is described in the next step. This routine is coded so that when the page is reloaded after the search form has been used, the <TT>Session</TT> object entry will exist. When you first come into the page, the entry doesn't exist.</P>
<H5 class="docExampleTitle">Listing 8.46 <TT>frmHowTo8_8a.vb</TT>: Loading an Individual Record into Text Boxes on the Form</H5>
<PRE>
  Private Sub Page_Load(ByVal sender As System.Object,
           ByVal e As System.EventArgs) Handles MyBase.Load

       If Not (Session("ResultValue") Is Nothing) Then
           LoadIndividual(Session("ResultValue"))
       End If

End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="4"><P>Create the <TT>LoadIndividual</TT> routine by entering the code shown in Listing 8.47 in the form. Taking the <TT>strCustID</TT> passed from the results of the search, a data adapter is created, and a data table is filled. Last, each of the TextBox controls is loaded with the value from the column with the corresponding name.</P>
<H5 class="docExampleTitle">Listing 8.47 <TT>frmHowTo8_8a.vb</TT>: Loading an Individual Record into Text Boxes on the Form</H5>
<PRE>
Private Sub LoadIndividual(ByVal strCustID As String)

     Dim odaCustIndiv As New _
        OleDb.OleDbDataAdapter("Select * From Customers Where CustomerID = '" &amp;
        strCustID &amp; "'", BuildCnnStr("(local)", "Northwind"))

     Dim dtCustIndiv As New DataTable()

     odaCustIndiv.Fill(dtCustIndiv)

     With dtCustIndiv.Rows(0)
        Me.txtCustomerID.Text = .Item("CustomerID").ToString
        Me.txtCompanyName.Text = .Item("CompanyName").ToString
        Me.txtContactName.Text = .Item("ContactName").ToString
        Me.txtContactTitle.Text = .Item("ContactTitle").ToString
        Me.txtAddress.Text = .Item("Address").ToString
        Me.txtCity.Text = .Item("City").ToString
        Me.txtRegion.Text = .Item("Region").ToString
        Me.txtCountry.Text = .Item("Country").ToString
        Me.txtPostalCode.Text = .Item("PostalCode").ToString
        Me.txtPhone.Text = .Item("Phone").ToString
        Me.txtFax.Text = .Item("Fax").ToString
     End With

End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="5"><P>Create the next Web Form, and call it whatever name you referred to in the search Web Form in step 2. Then place the controls shown in Figure 8.16 of the search page, with the properties set forth in Table 8.11.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 8.11. Label, TextBox, DataGrid, and Command Button Controls Property Settings for the Calling Form</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DOCUMENT</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>bgColor</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>buttonface</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Label1</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Click on a Letter</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Panel</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Panel1</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnA</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>A</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnB</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>B</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnC</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>C</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>...</TT></P>
</TD>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">&nbsp;</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnZ</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Z</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnAll</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>All</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataGrid</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dgSearch</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>AllowPaging</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>True</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnAccept</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>&amp;Accept</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnCancel</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>&amp;Cancel</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P></span></LI><LI><span style="font-weight:normal" value="6"><P>In the class module for the Web Form, add the following Private declaration just below the line of code that reads <TT>Web Form Designer Generated Code</TT>:</P>
<pre>
Private mdtSearch As New DataTable()
</pre></span></LI><LI><span style="font-weight:normal" value="7"><P>On the Web Form, add the code in Listing 8.48 to the Load event. This routine loads the data table stored in the <TT>Session</TT> object if it exists.</P>
<H5 class="docExampleTitle">Listing 8.48 <TT>frmHowTo8_8b.vb</TT>: Executing a SQL Server-Supplied Stored Procedure That Lists the Tables in the Database</H5>
<PRE>
Private Sub Page_Load(ByVal sender As System.Object, _
            ByVal e As System.EventArgs) Handles MyBase.Load

    If Not (Session("SearchDataTable") Is Nothing) Then
        mdtSearch = CType(Session("SearchDataTable"), DataTable)
    End If

End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="8"><P>For each of the command buttons that has a single letter, add the first subroutine displayed in Listing 8.49 to each of the Click events. For the btnAll Button control, add the second subroutine to the <TT>Click</TT> event. <TT>Each Button</TT> control will pass the letter it represents to the subroutine called SetData, discussed in the next step. The btnAll code simply passes the empty string.</P>
<H5 class="docExampleTitle">Listing 8.49 <TT>frmHowTo8_8b.vb</TT>: Click Events for Each of the Letter Button Controls</H5>
<PRE>
Private Sub btnA_Click(ByVal sender As System.Object, _
                ByVal e As System.EventArgs) Handles btnA.Click

        SetData("A")

End Sub

Private Sub btnAll_Click(ByVal sender As System.Object, _
                    ByVal e As System.EventArgs) Handles btnAll.Click

        SetData("")

End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="9"><P>Add the subroutine in Listing 8.50 to the class module of the form. This routine takes the letter value passed in <TT>strFilterLetter</TT> as a parameter. A SQL Select string is created that takes the literal values Select, From, and Where and uses the Session object entries KeyField, SearchField, and SearchRecordSource. The SearchField property is used with the Like clause, also using the strFilterLetter and the <TT>%</TT> (wildcard). Note that if <TT>"</TT> is passed to strFilterLetter, all the records will be listed. Finally, mdtSearch is filled in the routine BindTheGrid set as the data source for dgSearch, which is the <TT>DataGrid</TT> control. The routine called <TT>BindTheGrid</TT> is located at the end of the listing.</P>
<H5 class="docExampleTitle">Listing 8.50 <TT>frmHowTo8_8a.vb</TT>: Filling the Results Set Based on the Letter Button Pressed</H5>
<PRE>
    Sub SetData(ByVal strFilterLetter As String)

        Dim odaSearch As OleDb.OleDbDataAdapter

        odaSearch = New _
                 OleDb.OleDbDataAdapter("Select " &amp; Session.Item("KeyField") &amp;
                 ", " &amp; Session.Item("SearchField") &amp; " From " &amp; _
                Session.Item("SearchRecordSource") &amp; " Where " &amp; _
                Session.Item("SearchField") &amp; " Like '" &amp; _
                strFilterLetter &amp; "%'", (BuildCnnStr("(local)", "Northwind")))

        mdtSearch.Clear()
        odaSearch.Fill(mdtSearch)
        Session("SearchDataTable") = mdtSearch

        BindTheGrid()

   End Sub

Private Sub BindTheGrid()

     dgSearch.DataSource = mdtSearch
     dgSearch.DataBind()

End Sub
</PRE>
<div class="docNote"><p class="docNoteTitle">Note</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/note_icon.gif" ALT="graphics/note_icon.gif"></td>
<td valign="top"><P>This routine, more than any in this How-To, shows the flexibility of this technique. You can use any table values for these properties. This is a major benefit when you think of how many places you can use this form without changing a line of code in the form.</P>
</td>
</tr></table></p>
</div></span></LI><LI><span style="font-weight:normal" value="10"><P>Right-click on the data grid and choose Property Builder. Go to the Columns tab and add a Select button. Set the Button Type to be PushButton (see Figure 8.17) and click OK.</P>
<CENTER><H5 class="docFigureTitle">Figure 8.17. There is no code required for this button.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="430" src="FILES/08fig17.jpg" ALT="graphics/08fig17.jpg"></p>
</CENTER></span></LI><LI><span style="font-weight:normal" value="11"><P>On the buttons called btnAccept and btnCancel, add the code in Listing 8.51 to the appropriate Click event of each. The <TT>btnAccept_Click</TT> routine derives the data row that is currently selected from mdtSearch using the data grid's SelectedIndex property and adding the paging that has to occur using <TT>GetPageRows()</TT>, which returns the actual rows given the current page that the user is on in the DataGrid object. You can see the <TT>GetPageRows()</TT> routine at the bottom of the listing. The <TT>KeyField Session</TT> object entry is then used to store the individual column value of drCurr in the <TT>ResultValue Session</TT> object entry. The calling page is reloaded.</P>
<P>The <TT>ResultValue</TT> is not set in the btnCancel_Click routine. The calling page is simply reloaded.</P>
<H5 class="docExampleTitle">Listing 8.51 <TT>frmHowTo8_8b.vb</TT>: Storing the Resulting Key Value to the <TT>ResultValue Session</TT> Object Entry and Returning to the Calling Page</H5>
<PRE>
Private Sub btnAccept_Click(ByVal sender As System.Object,
                ByVal e As System.EventArgs) Handles btnAccept.Click

    Dim drCurr As DataRow

    Try
        drCurr = mdtSearch.Rows(dgSearch.SelectedIndex + GetPageRows())

        Session("ResultValue") = drCurr.Item(Session("KeyField")).ToString

    Catch exc As Exception

    End Try


Server.Transfer(Session("CallingPage"))


End Sub

Private Sub btnCancel_Click(ByVal sender As System.Object,
                ByVal e As System.EventArgs) Handles btnCancel.Click

Server.Transfer(Session("CallingPage"))

End Sub

Function GetPageRows() As Integer

    '-- This helps synchronize the data table rows
    '   with the data grid page and row.
    GetPageRows = dgSearch.PageSize * dgSearch.CurrentPageIndex

End Function
</PRE></span></LI><LI><span style="font-weight:normal" value="12"><P>The last step is to add the code in Listing 8.52 for synching up pages in the data grid when the user switches pages.</P></span></LI></OL></span>
<H5 class="docExampleTitle">Listing 8.52 <TT>frmHowTo8_8b.vb</TT>: Updating the Data Grid with the New Page Number</H5>
<PRE>
Private Sub dgSearch_PageIndexChanged(ByVal source As Object,
            ByVal e As System.Web.UI.WebControls.DataGridPageChangedEventArgs)
            Handles dgSearch.PageIndexChanged

    '-- Set the current page in the data grid.
    Me.dgSearch.CurrentPageIndex = e.NewPageIndex

    BindTheGrid()

End Sub
</PRE>
<H4 class="docSection2Title"> How It Works</H4>
<P>When the user clicks on the Search button, the calling page stores values in the Session object for use in the search page, telling it what record source to use, as well as other information used for searching for the specific record and table desired:</P>
<UL>
<LI><P>"Customers" for the Session object entry <TT>SearchRecordSource</TT></P></LI>
<LI><P>"CustomerID" for the Session object entry <TT>KeyField</TT></P></LI>
<LI><P>"CompanyName" for the Session object entry <TT>SearchField</TT></P></LI>
<LI><P>"wfrmHowTo8_8a" for the Session object entry <TT>CallingPage</TT></P></LI>
</UL>
<P>After the search page is loaded, the user clicks one of the letters to narrow down the records to look for. A data adapter is passed a SQL String made up of the <TT>Session</TT> object entries just mentioned, a data table is filled, and the data grid's <TT>DataSource</TT> property sets the data table.</P>
<P>When the user clicks Accept, the <TT>DataTable</TT> is retrieved from the data grid, which then produces the data row that contains the key field. The key field is then stored in the ResultValue Session object entry of the search form, and the calling page is reloaded.</P>
<P>Back on the calling form, the <TT>LoadIndividual</TT> routine is called. Then the routine is passed the <TT>ResultValue</TT> Session object entry from the search form. The text boxes are loaded with the data row results.</P>
<H4 class="docSection2Title"> Comments</H4>
<P>This technique shows a number of ways that the various ADO.NET objects can be used. Using the Session object and other State management methods is handy for creating pages that you want to use for more than one table. You will find use for this technique throughout your applications after you become accustomed to it.</P>
<P>Again, you can enhance this tool in several ways. One way is to allow the user to enter a string value to type in, and narrow down the choices even more. Another way is to add a property that could be used to specify multiple columns to be displayed.</P>
<ul></ul>
</body></html>
