<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="12.1 Use XMLWriter to Create an XML Document"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">12.1 Use XMLWriter to Create an XML Document</H3>
<P>Sometimes I need to take data that is in my database and write it out to an XML document. I heard that XMLWriter is a good way to do this. What does XMLWriter do, and how do I create an XML document with it?</P>
<H4 class="docSection2Title"> Technique</H4>
<P>The XMLWriter provides a quick way to generate streams or files that contain XML data. The stream is not cached; it is forward-only. The XML data that the XMLWriter generates conforms to W3C XML 1.0 and the namespaces in XML recommendations.</P>
<P>With XMLWriter, you can accomplish the following:</P>
<UL START=""><LI><P>Create well-formed XML.</P>
</LI>
<LI><P>Manage the output-including methods to determine the progress of the output-with the WriteState property.</P>
</LI>
<LI><P>Flush or close the output.</P>
</LI>
<LI><P>Write multiple documents to one output stream.</P>
</LI>
<LI><P>Encode binary bytes as base64 and as binhex, and write out the resulting text.</P>
</LI>
<LI><P>Report the current namespace prefix, xml:lang, or xml:space scope.</P>
</LI>
<LI><P>Write valid names, qualified names, and name tokens.</P>
</LI>
</UL>
<P>XMLWriter has one implementation: the XMLTextWriter.</P>
<P>To show you how to use the XMLTextWriter, the sample code will create a data table, allowing the user to add names to it. Then the XMLTextWriter will be used to write the data from the data table into an XML document.</P>
<H5 class="docSection3Title"> Creating the Data Table</H5>
<P>Rather than using a <TT>DataAdapter</TT> object to create and populate the data table from live data, the code will create the data table from scratch, and the user will add data to it. To perform this task, add the properties and methods shown in Table 12.1. The first object that will be created and utilized is the <TT>DataColumn</TT> object.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 12.1. Objects, Properties, and Methods for Creating a <TT>DataTable</TT> Object</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property/Method</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Description</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataColumn</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>ColumnName</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Specifies the Column name for the current data column that is being created.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataColumn</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Stores the Caption used to be displayed.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataTable.Columns</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Add</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Adds the current <TT>DataColumn</TT> object to the collection of columns in the data table.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataTable</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>NewRow</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Creates a <TT>DataRow</TT> object.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataRow</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Item(ColumnName)</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Replaces data in the specified column, in the current <TT>DataRow</TT> object.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataTable.Rows</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Add</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Adds the data row to the collection of rows in the data table.</P>
</TD>
</TR>
</COLGROUP>
</TABLE></P>
<H5 class="docSection3Title"> Using the XMLTextWriter Implementation</H5>
<P>The last task that the example performs is creating the XML document by using the properties and methods of the XMLTextWriter class, shown in Table 12.2.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 12.2. XMLTextWriter Properties and Methods Used for This How-To</h5></CAPTION><COLGROUP span="2">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Property/Method</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Description</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>WriteStartDocument</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Writes the XML declaration with the version 1.0.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Formatting</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Specifies how you want the XML file formatted. In this case, System.Xml.Formatting.Indented is used.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>WriteDocType</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Writes the DOCTYPE declaration with the specified name and optional attributes. This allows you to specify the type of objects that this document represents.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>WriteComment</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Allows you to write comments into your XML document.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>WriteStartElement</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Used for both the rows and the columns, this lets you specify the starting element for a row that is represented from a table.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>WriteAttributeString</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Writes columns and properties for data that is represented in the XML document.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>WriteEndElement</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Ends the row or column.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Flush</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Flushes the stream from memory.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Close</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Closes the string.</P>
</TD>
</TR>
</COLGROUP>
</TABLE></P>
<H4 class="docSection2Title"> Steps</H4>
<P>Open and run the Visual Basic .NET-Chapter 12 solution. From the main Web page, click on the hyperlink with the caption How-To 12.1: Use XMLWriter to Create an XML Document. When the page loads, you can enter a few names by entering the last and first names and then clicking the button labeled Add to DataTable. When you have added a few names, click the button labeled Create XML File. Using Explorer, open the file created in C:\ called test.xml (see Figure 12.1).</P>






<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><p>
<span class="docEmphRoman">Create a Web Form.</span> 
Then place the Labels, TextBoxes, Buttons, and DataGrid objects as seen in Figure 12.1 on the form with the properties set as in Table 12.3.</p>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 12.3. Label, TextBox, and Button Control Property Settings</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Last Name</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtLastName</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>First Name</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtFirstName</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnAdd</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Add to DataTable</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnCreateXMLFile</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Create XML File</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataGrid</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dgDataToWrite</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>HyperLink</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>hplReturnToMain</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>NavigateURL</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>wfrmMain.aspx</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P></span></LI><LI><span style="font-weight:normal" value="2"><P>Add the following line to the code module of the form. Place it under the line that reads <TT>Web Form Designer Generated Code</TT>.</P>
<pre>
Dim mdtData As New DataTable()
</pre></span></LI><LI><span style="font-weight:normal" value="3"><P>Add the code in Listing 12.1 to the Load event of the page. If the data table has not been saved to the <TT>Session</TT> object, then you need to create it from scratch by first creating the data columns and then adding them to the data table. The <TT>DataTable</TT> object is then saved to the <TT>Session</TT> object with the name MyDataTable. If the <TT>Session</TT> object entry already exists, it is assigned back to the module variable mdtData. Last, the data table is bound to the <TT>DataGrid</TT> object by calling the BindTheGrid routine, which is described in the next step.</P>
<H5 class="docExampleTitle">Listing 12.1 <TT>wfrmHowTo12_1.aspx.vb</TT>: Creating a <TT>DataTable</TT> Object from Scratch</H5>
<PRE>
Private Sub Page_Load(ByVal sender As System.Object, _
            ByVal e As System.EventArgs) Handles MyBase.Load

        'Put user code to initialize the page here
        If (Session("MyDataTable") Is Nothing) Then

            Dim dcFirstName As New DataColumn()

            dcFirstName.ColumnName = "FirstName"
            dcFirstName.Caption = "First Name"

            mdtData.Columns.Add(dcFirstName)

            Dim dcLastName As New DataColumn()

            dcLastName.ColumnName = "LastName"
            dcLastName.Caption = "Last Name"

            mdtData.Columns.Add(dcLastName)

            Session("MyDataTable") = mdtData

        Else
            mdtData = CType(Session("MyDataTable"), DataTable)
        End If

        BindTheGrid()

    End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="4"><P>Create the routine BindTheGrid, shown in Listing 12.2, in the code module for the page.</P>
<H5 class="docExampleTitle">Listing 12.2 <TT>wfrmHowTo12_1.aspx.vb</TT>: Binding the Data Table to the Data Grid</H5>
<PRE>
Sub BindTheGrid()

        dgDataToWrite.DataSource = mdtData
        dgDataToWrite.DataBind()

    End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="5"><P>Add the code in Listing 12.3 to the <TT>Click</TT> event of the btnAdd button. This routine starts off by calling the NewRow method off the mdtData data table, thus creating a new <TT>DataRow</TT> object. The two columns in drNew are replaced with the values in txtLastName and txtFirstName. The new row is added to the data table, and the text boxes are cleared. Last, mdtData is rebound to the data grid by calling BindTheGrid.</P>
<H5 class="docExampleTitle">Listing 12.3 <TT>wfrmHowTo12_1.aspx.vb</TT>: Adding Data to the Data Table and Then Rebinding the Data Grid</H5>
<PRE>
Private Sub btnAdd_Click(ByVal sender As System.Object, _
                           ByVal e As System.EventArgs) Handles btnAdd.Click

    Dim drNew As DataRow

    drNew = mdtData.NewRow()

    drNew.Item("LastName") = Me.txtLastName.Text
    drNew.Item("FirstName") = Me.txtFirstName.Text

    mdtData.Rows.Add(drNew)

    Me.txtLastName.Text = ""
    Me.txtFirstName.Text = ""

    BindTheGrid()

End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="6"><P>Add the code in Listing 12.4 to the <TT>Click</TT> event of the btnCreateXMLFile button. The first task is to declare an instance of the XMLTextWriter. Then the XMLTextWriter creates and opens the file c:\Text.xml. Next, the XML document is created using the <TT>Write</TT> methods, including the writing of the individual rows of the <TT>DataTable</TT> object. Last, the data is flushed, and the XMLTextWriter is closed.</P>
<H5 class="docExampleTitle">Listing 12.4 <TT>wfrmHowTo12_1.aspx.vb</TT>: Creating the XML Document</H5>
<PRE>
Private Sub btnCreateXMLFile_Click(ByVal sender As System.Object, _
                        ByVal e As System.EventArgs) Handles btnCreateXMLFile.Click

        Dim xtwMyData As System.Xml.XmlTextWriter = Nothing
        Dim intCurrRow As Integer
        Dim intNumRows As Integer

        xtwMyData = New System.Xml.XmlTextWriter("c:\Test.XML", Nothing)
        intNumRows = mdtData.Rows.Count - 1

        With xtwMyData
            .WriteStartDocument(False)
            .Formatting = System.Xml.Formatting.Indented
            .WriteDocType("Names", Nothing, Nothing, Nothing)
            .WriteComment("This file represents names list")
            .WriteStartElement("names")

            For intCurrRow = 0 To intNumRows
                '-- Start the current row
                .WriteStartElement("name", Nothing)

                '-- Write the fields
                .WriteAttributeString("FirstName", _
                            mdtData.Rows(intCurrRow).Item("FirstName"))
                .WriteAttributeString("LastName", _
                            mdtData.Rows(intCurrRow).Item("LastName"))

                '-- Ending the row
                .WriteEndElement()

            Next

            '-- Write the XML to file and close the writer
            .Flush()
            .Close()
        End With

    End Sub
</PRE></span></LI></OL></span>
<CENTER><H5 class="docFigureTitle">Figure 12.1. This XML document was created using XMLTextWriter.</H5><p><IMG BORDER="0" WIDTH="482" HEIGHT="335" src="FILES/12fig01.jpg" ALT="graphics/12fig01.jpg"></p>
</CENTER>
<H4 class="docSection2Title"> Comments</H4>
<P>This is one of three ways described in this chapter of how to write data out to an XML document. This is probably the second easiest method. The other two methods are using the XML DOM (described in How-To 12.3), which is the hardest method, and using the WriteXML method off the DataSet object (described in How-To 12.5), which is the easiest method of all three. The amount of control you have over the document matches the degree of difficulty in use.</P>
<img src="FILES/pixel.gif" width="1" height="1" border="0"><ul></ul>
</body></html>
