<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="3.4 Filter and Sort Records Using the DataView Object"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">3.4 Filter and Sort Records Using the DataView Object</H3>
<P>After your data is loaded into the data table, you will probably want to be able to view your data using different filters and sort orders. To do this, you can use the DataView object. This How-To goes into detail and shows you how to take advantage of the <TT>DataView</TT> control to manipulate your data.</P>
<P>Although you can put data into the <TT>DataGrid</TT> control and let the users sort data using the columns, you want to display a <TT>ComboBox</TT> control and let users pick a field from the drop-drown list. How can you filter and sort records using the <TT>DataView</TT> object to present your data in different ways?</P>
<H4 class="docSection2Title"> Technique</H4>
<P>This How-To displays a set of command buttons that display a letter and an extra command button that displays <span class="docEmphasis">all</span> records. A data adapter, data table, and data view are declared at the form level. The data adapter is created and the DataTable is filled when the form is loaded with all customers. Using a <TT>DataColumn</TT> object, a combo box is filled by getting the names of each column that is in the data table. You can see this form in action in Figure 3.5.</P>
<CENTER><H5 class="docFigureTitle">Figure 3.5. Selecting a letter here limits the data displayed in the <TT>DataGrid</TT> control.</H5><p><IMG BORDER="0" WIDTH="496" HEIGHT="478" src="FILES/03fig05.jpg" ALT="graphics/03fig05.jpg"></p>
</CENTER>
<P>Using the command buttons, a routine is called that creates a <TT>DataView</TT> object, sets the <TT>RowFilter</TT> property, and then assigns the data view to the <TT>DataSource</TT> property of a <TT>DataGrid</TT> control.</P>
<div class="docNote"><p class="docNoteTitle">Tip</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/tip_icon.gif" ALT="graphics/tip_icon.gif"></td>
<td valign="top"><P>Although the <TT>RowFilter</TT> allows you to filter data based on a criteria such as CompanyName Like 'A%', you can set another property to display data based on the state of the row in which data occurs. The property is called <TT>RowStateFilter</TT>.</P>
<P>You can set the <TT>RowStateFilter</TT> to one of the following <TT>DataViewRowState</TT> values in Table 3.5.</P>
</td>
</tr></table></p>
</div><br>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 3.5. Label, TextBox, and ComboBox Control Property Settings</h5></CAPTION><COLGROUP span="2">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Description</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Added</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>New rows</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>CurrentRows</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Current rows including unchanged, new, and modified rows</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Deleted</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Deleted rows</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>ModifiedCurrent</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>A current version, which is a modified version of original data (see <TT>ModifiedOriginal</TT>)</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>ModifiedOriginal</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>The original version (although it has since been modified and is available as <TT>ModifiedCurrent</TT>)</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>None</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>None</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>OriginalRows</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Original rows including unchanged and deleted rows</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Unchanged</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Unchanged row</P>
</TD>
</TR>
</COLGROUP>
</TABLE></P>
<P>The <TT>Sort</TT> property of the <TT>DataView</TT> object is used when a column name is chosen from the <TT>ComboBox</TT>. The current setting of the <TT>Sort</TT> property is compared to the column name that is chosen. If the Name matches, then the expression <span class="docEmphasis">DESC</span> is added to the value that is assigned to the <TT>Sort</TT> property.</P>
<H4 class="docSection2Title"> Steps</H4>
<P>Open and run the VB.NET-Chapter 3 solution. From the main form, click on the command button with the caption How-To 3.4. When the form loads, click on different letters that are displayed. You will see the data grid display different customers based on their first letter.</P>
<P>If you choose a column name from the Column to Sort On ComboBox control, the data grid will then be sorted based on the column chosen.</P>









<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Create a new Windows Form.</P></span></LI><LI><span style="font-weight:normal" value="2"><P>Add a GroupBox control with the text property set to Click on a Letter.</P></span></LI><LI><span style="font-weight:normal" value="3"><P>Now you will be creating buttons that you will place within the GroupBox control you just created. The buttons will have their property set as listed in Table 3.6.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 3.6. Buttons Property Settings</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnA</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>A</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnB</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>B</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnC</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>C</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>...</TT></P>
</TD>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">&nbsp;</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnZ</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Z</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnAll</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>All</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P></span></LI><LI><span style="font-weight:normal" value="4"><P>Add the <TT>DataGrid</TT>, the <TT>Label</TT>, and the <TT>ComboBox</TT> controls shown in Listing 3.6.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 3.7. <TT>DataGrid</TT>, <TT>Label</TT>, and <TT>ComboBox</TT> Controls Property Settings</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataGrid</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dgCustomers</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Label1</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Column to Sort On</TT>:</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>ComboBox</TT> </P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT> </P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>cboSortColumns</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P></span></LI><LI><span style="font-weight:normal" value="5"><P>In the class module for the form, add the following three Private declarations just below the line of code that reads <TT>Windows Form Designer generated code</TT>. These three objects will be used throughout the form.</P>
<pre>
Private modaCust As OleDb.OleDbDataAdapter
Private mdtCust As DataTable = New DataTable()
Private mdvCust As DataView = New DataView()
</pre></span></LI><LI><span style="font-weight:normal" value="6"><P>Add the following code to the <TT>Load</TT> event of the form as shown in Listing 3.6. This code starts out by setting up the modaCust data adapter to grab all the customers to fill the data table called mdtCust. Note that at this point, the data grid has not been filled.</P>
<P>The next task is to load cboSortColumns with the column headings by iterating through each of the data columns in <TT>mdtCust</TT> and adding them to the <TT>Items</TT> collection in <TT>cboSortColumns</TT>. Last, the <TT>SetDataViewFilter</TT> routine is called. This routine is discussed in step 8.</P>
<H5 class="docExampleTitle">Listing 3.6 <TT>frmHowTo3_4.vb</TT>: Loading the Data Table to Be Used in the Form, and Adding Column Names to a ComboBox Control</H5>
<PRE>
Private Sub frmHowTo3_4_Load(ByVal sender As Object, _
                    ByVal e As System.EventArgs) Handles MyBase.Load

        Dim strSQL As String
        Dim dcCurr As DataColumn

        '-- Set up the exception catch
        Try

            '-- Create the data adapter and fill the data table
            modaCust = New _
                  OleDb.OleDbDataAdapter("Select * From Customers", _
                  (BuildCnnStr("(local)", "Northwind")))
            modaCust.Fill(mdtCust)

            '-- Load the column names into the sort ComboBox control
            For Each dcCurr In mdtCust.Columns
                Me.cboSortColumns.Items.Add(dcCurr.ColumnName)
            Next

        SetDataViewFilter("B")

        Catch oexpData As OleDb.OleDbException
            MsgBox(oexpData.Message)
        End Try

    End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="7"><P>For each of the command buttons that has a single letter, add the first subroutine displayed here in Listing 3.7 to each of its <TT>Click</TT> events. For the btnAll Button control, add the second subroutine to the <TT>Click</TT> event. Each <TT>Button</TT> control will pass the letter that it represents to the subroutine called <TT>SetDataViewFilter</TT>, discussed in the next step. The btnAll code simply passes the empty string.</P>
<H5 class="docExampleTitle">Listing 3.7 <TT>frmHowTo3_4.vb</TT>: Click Events for Each of the Button Controls</H5>
<PRE>
Private Sub btnA_Click(ByVal sender As System.Object, _
                ByVal e As System.EventArgs) Handles btnA.Click
        SetDataViewFilter("A")
End Sub
Private Sub btnAll_Click(ByVal sender As System.Object, _
 ByVal e As System.EventArgs) Handles btnAll.Click
        SetDataViewFilter("")
End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="8"><P>Add the subroutine that is found in Listing 3.8 to the class module of the form. This routine takes the letter value that is passed in <TT>strFilterLetter</TT> as a parameter. The first task to perform is assigning the DefaultView of the <TT>mdtCust DataTable</TT> object to the <TT>mdvCust</TT> data view. Next, the <TT>RowFilter</TT> property of <TT>mdvCust</TT> is set to compare the <TT>CompanyName</TT> column with the <TT>Like</TT> expression using the <TT>strFilterLetter</TT> and the <TT>%</TT> (wildcard). Note that if <TT>""</TT> is passed to <TT>strFilterLetter</TT>, all the records will be listed. Finally, <TT>mdvCust</TT> is set as the <TT>DataSource</TT> for <TT>dgCustomers</TT>, which is the <TT>DataGrid</TT> control.</P>
<H5 class="docExampleTitle">Listing 3.8 <TT>frmHowTo3_4.vb</TT>: Setting the RowFilter Property for a DataView Object</H5>
<PRE>
Sub SetDataViewFilter(ByVal strFilterLetter As String)

        mdvCust = mdtCust.DefaultView
        mdvCust.RowFilter = "CompanyName Like '" &amp; strFilterLetter &amp; "%'"
        dgCustomers.DataSource = mdvCust

    End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="9"><P>Add the piece of code that is shown in Listing 3.9 to the <TT>SelectdIndexChanged</TT> event of the <TT>cboSortColumns ComboBox</TT> control. This routine compares the current setting of <TT>mdvCust's</TT> Sort property to the current column name chosen in <TT>cboSortColumns</TT>. If the two are the same, then the column name is assigned to the <TT>Sort</TT> property with the <span class="docEmphasis">DESC</span> keyword added on. If not, then the name of the column is assigned to the <TT>Sort</TT> property.</P>
<H5 class="docExampleTitle">Listing 3.9 <TT>frmHowTo3_4.vb</TT>: Specifying a Column on Which to Sort</H5>
<PRE>
Private Sub cboSortColumns_SelectedIndexChanged(ByVal sender As System.Object,
                ByVal e As System.EventArgs) _
                  Handles cboSortColumns.SelectedIndexChanged

        '-- Check to see if the column is currently the sorted field.
        '   If it is, sort on the column in descending order.
        '   Otherwise, set the sort to the name of column.

        If mdvCust.Sort = Me.cboSortColumns.Text Then
            mdvCust.Sort = Me.cboSortColumns.Text &amp; " DESC"
        Else
            mdvCust.Sort = Me.cboSortColumns.Text
        End If

    End Sub
</PRE></span></LI></OL></span>
<H4 class="docSection2Title"> How It Works</H4>
<P>When the user clicks on a letter, the data view is created, and the data grid reflects the new data. When a field is selected from the <TT>ComboBox</TT> control, the Sort property of the data view is set and the data grid automatically reflects the new sort order, also showing an arrow in the column heading. If the user chooses the field again, the column will sort in descending order.</P>
<H4 class="docSection2Title"> Comments</H4>
<P>Using the <TT>DataView</TT> object, you can keep track of multiple views of your data and display them for the users' use. You can also access all of the default views of the data tables in your data set using the <TT>DefaultViewManager</TT>.</P>
<div class="docNote"><p class="docNoteTitle">Note</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/note_icon.gif" ALT="graphics/note_icon.gif"></td>
<td valign="top"><P>Some people might think that the sorting combo box that was added to this example is unnecessary. It was added for two reasons. First, it shows how to use the Sort property of a <TT>DataView</TT> object. Second, it's convenient for the user. The user might not want to have to scroll over to a column that is not displayed in the data grid. By using the combo box, he can sort on fields that are not currently displayed.</P>
</td>
</tr></table></p>
</div><br>
<img src="FILES/pixel.gif" width="1" height="1" border="0"><ul></ul>
</body></html>
