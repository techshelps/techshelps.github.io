<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="6.4 Find Records in a Table Without Corresponding Entries in a Related Table"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">6.4 Find Records in a Table Without Corresponding Entries in a Related Table</H3>
<P>I have a situation in which I need to find which clients don't have invoices. How do I do this?</P>
<H4 class="docSection2Title"> Technique</H4>
<P>To find out which records (customers) don't have corresponding records (invoices) in a related table, you have to have a better understanding of the types of joins that can be used between tables during queries.</P>
<P>Before looking at the joins, following is the T-SQL statement that will be used in this How-To:</P>
<pre>
SELECT Customers.CustomerID, Customers.CompanyName
FROM Customers LEFT OUTER JOIN Orders
ON Customers.CustomerID = Orders.CustomerID WHERE Orders.CustomerID IS NULL
</pre>
<H5 class="docSection3Title"> Types of Joins</H5>
<P>You can use three types of joins to bring back different information. These join types include inner joins, left outer joins, and right outer joins.</P>
<H5 class="docSection4Title"> Inner Join</H5>
<P>This join displays records in which at least one record exists in each table for the joined field. This means that customers are displayed only if they have at least one invoice. If you want to see the CompanyName and OrderDate, the <TT>SELECT</TT> statement would be as follows:</P>
<pre>
SELECT Customers.CompanyName, Orders.OrderDate
FROM Customers INNER JOIN Orders ON Customers.CustomerID = Orders.CustomerID
</pre>
<H5 class="docSection4Title"> Left Outer Join</H5>
<P>You use this join when you want to see all of the records in the first table, but only those records in the second table that have matching records in the first table. An example of this would be if some customers didn't have invoices; all the customers would appear, but only those invoices that had customers assigned to them would be displayed.</P>
<div class="docNote"><p class="docNoteTitle">Note</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/note_icon.gif" ALT="graphics/note_icon.gif"></td>
<td valign="top"><P>Normally, if your database is set up with referential integrity correctly, as Northwind is, you won't have any invoices without customers assigned to them.</P>
</td>
</tr></table></p>
</div><br>
<pre>
The example SELECT statement for this will be used in the How-To.

ON Customers.CustomerID = Orders.CustomerID WHERE Orders.CustomerID IS NULL
</pre>
<P>Remember, because you want only those customers without invoices, you need to check to see where <TT>Orders.CustomerID</TT> is <TT>NULL</TT>.</P>
<div class="docNote"><p class="docNoteTitle">Note</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/note_icon.gif" ALT="graphics/note_icon.gif"></td>
<td valign="top"><P>Although it is not strictly necessary to check whether the Orders.CustomersID is <TT>NULL</TT>, make sure to check for a column that would not be <TT>NULL</TT> if a record were there. OrderID would be another good column to check.</P>
</td>
</tr></table></p>
</div><br>
<H5 class="docSection4Title"> Right Outer Join</H5>
<P>As you might have guessed by now, the right outer join is the opposite of the left outer join. Instead of listing all the customers and only those invoices that have customers, the right outer join shows you all records in the second table (invoices) and only those records from the first table (customers) in which there is a matching record on the joined column (CustomerID).</P>
<P>One of the ways that the right outer join is used is to find bad data, such as non-relational data that could result from importing data from other systems. Use a SELECT statement similar to the one used for the left outer join type:</P>
<pre>
SELECT Customers.CustomerID, Customers.CompanyName
FROM Customers RIGHT OUTER JOIN Orders
ON Customers.CustomerID = Orders.CustomerID WHERE Customers.CustomerID IS NULL
</pre>
<P>You will notice that instead of testing for Orders.CustomerID being NULL, you are checking to see if Customers.CustomerID is NULL.</P>
<H4 class="docSection2Title"> Steps</H4>
<P>Open and run the Visual Basic .NET-Chapter 6 solution. From the main form, click on the button with the caption How-To 6.4. When the form loads, you will see the SQL String displayed with the data grid displaying customers who don't have orders (see Figure 6.5).</P>


<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Create a Windows Form. Then place the controls listed in Table 6.4 with the following properties set, as displayed in Figure 6.5.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 6.4. Control Property Settings for This How-To</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>SQL Statement</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>lblSQLString</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Results</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataGrid</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dgResults</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P></span></LI><LI><span style="font-weight:normal" value="2"><P>Add the following code in Listing 6.9 to the Load event of the form. (Double-click on the form to bring up the code.) The only difference in this routine from the previous How-To is the <TT>SELECT</TT> statement, which is described in the "Technique" section.</P>
<H5 class="docExampleTitle">Listing 6.9 <TT>frmHowTo6_4.vb</TT>: Using the Left Outer Join</H5>
<PRE>
Private Sub frmHowTo6_4_Load(ByVal sender As System.Object,
                ByVal e As System.EventArgs) Handles MyBase.Load

    '-- Build the SQL String
    Dim strSQL As String

    strSQL &amp;= "SELECT Customers.CustomerID, Customers.CompanyName "
    strSQL &amp;= "FROM Customers LEFT OUTER JOIN Orders "
    strSQL &amp;= "ON Customers.CustomerID = Orders.CustomerID" &amp; vbCrLf
    strSQL &amp;= "WHERE Orders.CustomerID IS NULL"

    '-- Store the SQL String
    Me.lblSQLString.Text = strSQL

    '-- Use the SQL String to build the data adapter and fill the data table.
    Dim odaResults As New OleDb.OleDbDataAdapter(Me.lblSQLString.Text, _
                              BuildCnnStr("(local)", "Northwind"))
    Dim dtResults As New DataTable()

    Try
        odaResults.Fill(dtResults)
    Catch excp As Exception
        MessageBox.Show(excp.Message)
        Exit Sub
    End Try

    '-- Assign the data table to the data grid's DataSource property
    Me.dgResults.DataSource = dtResults

End Sub
</PRE></span></LI></OL></span>
<CENTER><H5 class="docFigureTitle">Figure 6.5. Using an outer join to retrieve records without corresponding records.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="296" src="FILES/06fig05.jpg" ALT="graphics/06fig05.jpg"></p>
</CENTER>
<H4 class="docSection2Title"> Comments</H4>
<P>The majority of the time, you will be using the inner join rather than the outer joins. However, sometimes outer joins will be necessary, so you should experiment with them and get comfortable with them.</P>
<ul></ul>
</body></html>
