<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="1.4 Edit and Update Data Using Bound Controls"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">1.4 Edit and Update Data Using Bound Controls</H3>
<P>Although viewing data is fine in some situations, the real power comes in being able to edit the data in the text box and update the data in the server. In this How-To, you learn just that, using some new methods and properties from the various data controls, including autogenerated commands that create update, insert, and delete SQL statements for you. This How-To also introduces you to the <TT>BinderContext</TT> class, which is used to perform updates with bound controls.</P>
<P>The form as created in How-To 1.4 is great if you just want to view data for various records. But what if you want to let users edit and update the data?</P>
<H4 class="docSection2Title"> Technique</H4>
<P>Continuing with the form you used in the previous How-Tos, you are going to add a few command buttons with code that will perform the following:</P>
<UL>
<LI><p>
<span class="docEmphRoman">Edit.</span> 
Toggle the look of the text boxes to let the user know that he can edit the data in the controls by giving the controls a sunken look.</p>
</LI>
<LI><p>
<span class="docEmphRoman">Save.</span> 
Save the changes made to the data back to the server. Then toggle the look of the text boxes back to flat so that the user knows he can't edit them.</p>
</LI>
<LI><p>
<span class="docEmphRoman">Cancel.</span> 
Toggle the text boxes back to flat so that the user knows he can't edit them anymore, but don't save the data.</p>
</LI>
</UL>
<P>It is important to let users know when they can edit and when they can't. By toggling the style of the text boxes between flat and sunken and the color between gray and white, users have a definite clue that they can edit the data at certain times (see Figure 1.8).</P>
<P>Another useful item to note about this How-To is the introduction of the <TT>BindingContext</TT> class. This class helps you work with data bound controls. Each control on a Windows form has a <TT>BindingContext</TT> object as well as <TT>BindingContext</TT> objects for any controls that are contained within that control. Each form also has a <TT>BindingContext</TT> object. <TT>BindingContext</TT> objects manage <TT>BindingManagerBase</TT> class object(s) for each control. Through the <TT>BindingContext</TT> object, you can manage editing and updating data back to the server. <TT>BindingManagerBase</TT> objects help with synchronization of datasets with controls. You are going to use the <TT>BindingContext</TT> class throughout the rest of this chapter, but only a couple of methods.</P>
<H4 class="docSection2Title"> Steps</H4>
<P>Open the solution for the chapter called "VB .NET How-To Chapter 1," and run the application. From the main form, click the command button with the caption "How-To 1.4." Click the Load List button. Along with the list being filled with customers whose names start with <span class="docEmphasis">A</span>, you will see the detail How-To fill in on the right side of the form with the first customer in the list. Click Edit. You will now be able to change the data in the text boxes. After you have changed a couple of fields, click Save. If you select another customer from the list box, select the one you changed. You will see that your changes have in fact been saved. If you click Cancel instead of Save, your changes will not be saved. Note that if you change the name of the customer, you must load the list again to see the changes in the list box.</P>




<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Add the three command buttons to your form as described in Table 1.6 and as displayed in Figure 1.8.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 1.6. Command Buttons to Edit, Save, and Cancel Changes to Data</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Command Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnEdit</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>&amp;Edit</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Command Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnSave</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>&amp;Save</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Command Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnCancel</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>&amp;Cancel</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P></span></LI><LI><span style="font-weight:normal" value="2"><P>Add the code shown in Listing 1.6 to the <TT>btnEdit</TT> Click event.</P>
<H5 class="docExampleTitle">Listing 1.6 <TT>frmHowTo1_4.vb</TT>: Calling the ActiveEditing Subroutine from the btnEdit Command Button</H5>
<PRE>
Private Sub btnEdit_Click(ByVal sender As System.Object, _
                     ByVal e As System.EventArgs) Handles btnEdit.Click

      '- Enable the editing of the form
      ActivateEditing(True)

   End Sub
</PRE>
<P>This calls the routine called <TT>ActivateEditing</TT>, listed here. This code iterates through all the controls on the form and uses the <TT>TypeOf</TT> condition to check whether the current control is a text box. It also ensures that the control is not the <TT>txtCustLimit</TT> text box. If the control is a text box and the parameter called <TT>bEnable</TT> has been passed in as <TT>True</TT>, then the sunken look is given to the text box using the <TT>BorderStyle</TT> and the <TT>BackColor</TT> property is set to white. Otherwise, the <TT>BorderStyle</TT> is set to <TT>FixedSingle</TT>, which is flat, and the <TT>BackColor</TT> is set to the backcolor of the form. The <TT>Enabled</TT> property of the text box is set to whatever bEnabled is: <TT>True</TT> or <TT>False</TT>.</P>
<H5 class="docExampleTitle">Listing 1.7 <TT>frmHowTo1_4.vb</TT>: Toggling the <TT>Enabled</TT> Property and Look of Text Boxes</H5>
<PRE>
Private Sub ActivateEditing(ByVal bEnable As Boolean)

      Dim oCurr As Object

      '- Loop through each of the controls on the form
      For Each oCurr In Me.Controls()

         '- Check to see if the control is a text box
         If TypeOf oCurr Is TextBox And oCurr.Name &lt;&gt; "txtCustLimit" Then

            '- If so, toggle the properties
            If bEnable Then

               oCurr.BorderStyle() = _
                       System.Windows.Forms.BorderStyle.Fixed3D

               oCurr.BackColor() = System.Drawing.Color.White

            Else

               oCurr.BorderStyle() = _
                       System.Windows.Forms.BorderStyle.FixedSingle

               oCurr.BackColor() = Me.BackColor


            End If

            oCurr.Enabled = bEnable

         End If
      Next

   End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="3"><P>Add the code to the <TT>Click</TT> event of the <TT>btnSave</TT> command button. This code calls a new routine called SaveRecord, which performs the actual save. The <TT>ActivateEditing</TT> is then called, passing <TT>False</TT> to disable the controls because you are finished editing.</P>
<H5 class="docExampleTitle">Listing 1.8 <TT>frmHowTo1_4.vb</TT>: Calling the <TT>SaveRecord</TT> Routine and Disabling the Text Boxes by Calling <TT>ActivateEditing</TT></H5>
<PRE>
Private Sub btnSave_Click(ByVal sender As System.Object, _
                     ByVal e As System.EventArgs) Handles btnSave.Click

      '- Save the information
      SaveRecord()

      '- Disable the text boxes
      ActivateEditing(False)

   End Sub
</PRE>
<P>Following is the code for the subroutine called <TT>SaveRecord</TT>. This routine calls the <TT>EndCurrentEdit</TT> method of the <TT>BindingContext</TT> class, passing in the dataset called <TT>dsCustomerIndividual</TT>, and specifying the Customers table. Then the <TT>Update</TT> method is called off the data adapter called <TT>odaCustomerIndividual</TT>, passing the same parameters. This updates the changes back to the dataset. Finally, the dataset changes are sent backto the server.</P>
<H5 class="docExampleTitle">Listing 1.9 <TT>frmHowTo1_4.vb</TT>: Saving the Data Back to the Server</H5>
<PRE>
Private Sub SaveRecord()

      '- Use the BindingContext class to end current editing
       '  so that we can update the server.
      Me.BindingContext(Me.dsCustomerIndividual, "Customers").EndCurrentEdit()

      '- Perform the requested task at the dataset
      '   level using the data adapter
      Me.odaCustomerIndividual.Update(Me.dsCustomerIndividual, "Customers")

      '- By accepting the changes, the data gets sent back to the server
      Me.dsCustomerIndividual.AcceptChanges()

   End Sub
</PRE>
<div class="docNote"><p class="docNoteTitle">Note</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/note_icon.gif" ALT="graphics/note_icon.gif"></td>
<td valign="top"><P>If you haven't read about ADO.NET yet, then you might be confused about doing an update to the dataset, accepting changes, and sending the changes back to the server. ADO.NET works using disconnected data. When you create a dataset by using a data adapter, the data is actually created using XML. To see proof of this, take a look at dsCustomerIndividual.xsd, found in the Solutions Explorer.</P>
<pre>
&lt;xsd:schemaid="dsCustomerIndividual"targetNamespace="http://www.tempuri.org /
<IMG BORDER="0" ALIGN="left" WIDTH="18" HEIGHT="11" src="FILES/ccc.gif" ALT="graphics/ccc.gif">dsCustomerIndividual.xsd"xmlns="http://www.tempuri.org/ dsCustomerIndividual.xsd"xmlns:
<IMG BORDER="0" ALIGN="left" WIDTH="18" HEIGHT="11" src="FILES/ccc.gif" ALT="graphics/ccc.gif">xsd="http://www.w3.org/2001/XMLSchema" xmlns:msdata="urn:schemas-microsoft-com:
<IMG BORDER="0" ALIGN="left" WIDTH="18" HEIGHT="11" src="FILES/ccc.gif" ALT="graphics/ccc.gif">xml-msdata"attributeFormDefault="qualified" elementFormDefault="qualified"&gt;
&lt;xsd:element name="dsCustomerIndividual" msdata:IsDataSet="true"&gt;
  &lt;xsd:complexType&gt;
    &lt;xsd:choice maxOccurs="unbounded"&gt;
      &lt;xsd:element name="Customers"&gt;
        &lt;xsd:complexType&gt;
          &lt;xsd:sequence&gt;
            &lt;xsd:element name="CustomerID" type="xsd:string" /&gt;
            &lt;xsd:element name="CompanyName" type="xsd:string" /&gt;
            &lt;xsd:element name="ContactName" type="xsd:string" minOccurs="0" /&gt;
            &lt;xsd:element name="ContactTitle" type="xsd:string" minOccurs="0" /&gt;
            &lt;xsd:element name="Address" type="xsd:string" minOccurs="0" /&gt;
            &lt;xsd:element name="City" type="xsd:string" minOccurs="0" /&gt;
            &lt;xsd:element name="Region" type="xsd:string" minOccurs="0" /&gt;
            &lt;xsd:element name="PostalCode" type="xsd:string" minOccurs="0" /&gt;
            &lt;xsd:element name="Country" type="xsd:string" minOccurs="0" /&gt;
            &lt;xsd:element name="Phone" type="xsd:string" minOccurs="0" /&gt;
            &lt;xsd:element name="Fax" type="xsd:string" minOccurs="0" /&gt;
              &lt;/xsd:sequence&gt;
            &lt;/xsd:complexType&gt;
          &lt;/xsd:element&gt;
        &lt;/xsd:choice&gt;
      &lt;/xsd:complexType&gt;
      &lt;xsd:unique name="Constraint1" msdata:PrimaryKey="true"&gt;
        &lt;xsd:selector xpath=".//Customers" /&gt;
        &lt;xsd:field xpath="CustomerID" /&gt;
      &lt;/xsd:unique&gt;
    &lt;/xsd:element&gt;
  &lt;/xsd:schema&gt;
</pre><P>This is all performed under the covers, so the good news is that you don't have to know XML to work with datasets and ADO. More information on this can be found in Chapter 3.</P>
</td>
</tr></table></p>
</div></span></LI><LI><span style="font-weight:normal" value="4"><P>The last task is to give you the capibility to cancel the edits. You do this by placing the following code in the <TT>Click</TT> event on <TT>btnCancel</TT>. Calling the <TT>CancelCurrentEdit</TT> method of the <TT>BindingContext</TT> object for the form, the current edits are cancelled. Next, the text boxes are disabled using the routine ActivateEditing.</P>
<H5 class="docExampleTitle">Listing 1.10 <TT>frmHowTo1_4.vb</TT>: Canceling Changes to Data and Disabling the Text Boxes Again</H5>
<PRE>
Private Sub btnCancel_Click(ByVal sender As System.Object, _
                  ByVal e As System.EventArgs) Handles btnCancel.Click

      '- Use the BindingContext class to cancel the current editing.
      Me.BindingContext(Me.dsCustomerIndividual, _
                   "Customers").CancelCurrentEdit()
      ActivateEditing(False)

   End Sub
</PRE></span></LI></OL></span>
<H4 class="docSection2Title"> How It Works</H4>
<P>When the user clicks the <TT>btnEdit</TT> button, the <TT>ActiveEditing</TT> routine alerts the user that he can edit the data in the text boxes. The text boxes are enabled.</P>
<P>If the user then clicks the btnSave button, the data is updated to the dataset and then back to the server. If the user clicks the <TT>btnCancel</TT> button, the edits are canceled. In both cases, the <TT>ActivateEditing</TT> routine is called to disable the text boxes and let the user know that the text boxes cannot be edited.</P>
<H4 class="docSection2Title"> Comments</H4>
<P>This How-To showed the bare bones for editing and updating data. It presented a basic technique to get started. As you continue, you will learn methods to add and delete records, as well as handle errors.</P>
<P>Using ADO.NET, which you use for bound controls, takes some getting used to if you have worked with other data accessing methods such as ADO and DAO. The <TT>BindingContext</TT> and <TT>BindingManagerBase</TT> objects make working with bound objects in code much more manageable.</P>
<img src="FILES/pixel.gif" width="1" height="1" border="0"><ul></ul>
</body></html>
