<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="8.4 Make a Generic Search Form in a Visual Basic .NET Desktop Application"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">8.4 Make a Generic Search Form in a Visual Basic .NET Desktop Application</H3>
<P>Another useful utility that takes advantage of being data driven is a standard search form that you can use for any number of tables, such as customers, employees, or products. This How-To shows you how to create such a Windows Form so that all you need to use it with different tables is to set four custom properties of the form in code.</P>
<P>You like to be able to provide a usable search form for my users, without having the hassle of creating a custom form for every topic that the users are maintaining. In this How-To, you will see how to create a form that provides a quick lookup for records and can be used with various topics, such as Customers and Employees, by setting up only a few custom properties on the search form.</P>
<H4 class="docSection2Title"> Technique</H4>
<P>The forms package of Visual Basic has a class module behind it where you can add your own properties and methods. The .NET version of it is no exception.</P>
<P>In this How-To, you will see a simple use for custom properties that are being added to a form. Properties can be specified on a form by adding the following syntax to your form:</P>
<pre>
Public Property <span class="docEmphasis">PropertyName</span>() As <span class="docEmphasis">DataType</span>
        Get
            <span class="docEmphasis">PropertyName</span> = <span class="docEmphasis">ModuleLevelMemoryVariable</span>
        End Get
        Set(ByVal Value As <span class="docEmphasis">DataType</span>)
            <span class="docEmphasis">ModuleLevelMemoryVariable</span> = Value
        End Set
End Property
</pre>
<P>With the <span class="docEmphasis"><TT>ModuleLevelMemoryVariable</TT></span> being declared in the module declaration area of the form's class module, you can see the properties created for the search form, called <TT>frmHowTo8_b.vb</TT>, in Listing 8.16.</P>
<H5 class="docExampleTitle">Listing 8.16 <TT>frmHowTo8_4b.vb</TT>: Creating Custom Properties for the Search Form</H5>
<PRE>
Private mstrDisplayName As String
Private mstrRecordSource As String
Private mstrSearchField As String
Private moResultValue As Object
Private mstrKeyField As String

Public Property DisplayName() As String
    Get
        DisplayName = mstrDisplayName
    End Get
    Set(ByVal Value As String)
        mstrDisplayName = Value
    End Set
End Property

Public Property SearchRecordSource() As String
    Get
        SearchRecordSource = mstrRecordSource
    End Get
    Set(ByVal Value As String)
        mstrRecordSource = Value
    End Set
End Property

Public Property SearchField() As String
    Get
        SearchField = mstrSearchField
    End Get
    Set(ByVal Value As String)
        mstrSearchField = Value
    End Set
End Property

Public Property KeyField() As String
    Get
        KeyField = mstrKeyField
    End Get
    Set(ByVal Value As String)
        mstrKeyField = Value
    End Set
End Property

Public Property ResultValue() As Object
    Get
        ResultValue = moResultValue
    End Get
    Set(ByVal Value As Object)
        moResultValue = Value
    End Set
End Property
</PRE>
<P>By assigning values to these properties after initiating an instance of the form, you can utilize the properties and the data stored in those properties from within the forms properties and methods, as well as the procedures assigned to the events within the form.</P>
<P>For more information on creating custom classes, properties, and methods for use with your database application, see Chapter 9, "Using Classes with Databases to Make Life Easier.<span class="docEmphStrong">"</span></P>
<H4 class="docSection2Title"> Steps</H4>
<P>Open and run the VB.NET -Chapter 8 solution. From the main Windows Form, click on the command button with the caption How-To 8.4a. This form is a simple one that contains text boxes for the Customer table in Northwind. Click on the Search button to open the search form. Click on the button labeled B. You will see the data grid displayed in the bottom of the form filled with the CompanyName column of the Customer table, beginning with the letter B (see Figure 8.7).</P>
<CENTER><H5 class="docFigureTitle">Figure 8.7. This form can be used for searching within any of the tables in your databases.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="389" src="FILES/08fig07.gif" ALT="graphics/08fig07.gif"></p>
</CENTER>
<P>Place the cursor in one of the customers displayed in the grid, and then click Accept. The search form will be hidden, and the fields in the first form will be filled in with the data from the chosen record.</P>









<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Create a Windows Form. Then place the controls on the form shown in Figure 8.7, with the properties set forth in Table 8.5.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 8.5. Label, TextBox, and Command Button Controls Property Settings for the Calling Form</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Customer ID</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Company Name</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Contact</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Contact Title</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Address</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>City</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Region</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Country</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Phone</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Fax</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtCustomerID</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtCompanyName</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtContact</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtContactTitle</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtAddress</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtCity</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtRegion</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtPostalCode</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtCountry</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtPhone</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtFax</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnSearch</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>&amp;Search</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P></span></LI><LI><span style="font-weight:normal" value="2"><P>On btnSearch, add the code in Listing 8.17 to the <TT>Click</TT> event. This routine shows the power of creating custom properties. After instantiating an instance of the Search form-in this case, frmHowTo8_4b.vb-the four custom properties shown in Listing 8.17 are set <TT>before the form is</TT> displayed. This is powerful in letting you get the form set up exactly the way you want to before the user even sees it. After setting up the custom properties, the ShowDialog method is called off of <TT>frmSearch</TT>. By calling this method, code execution is halted until the form is closed or hidden. This same line of code compares the DialogResult property of the form to the value; if it matches, the code calls the <TT>LoadIndividual</TT> routine, passing the <TT>ResultValue</TT> custom property of frmSearch. Both the <TT>DialogResult</TT> and <TT>ResultValue</TT> properties are set in <TT>frmSearch</TT> and will be shown later in these steps.</P>
<H5 class="docExampleTitle">Listing 8.17 <TT>frmHowTo8_4a.vb</TT>: Executing a SQL Server-Supplied Stored Procedure That Lists the Tables in the Database</H5>
<PRE>
Private Sub btnSearch_Click(ByVal sender As System.Object, _
                ByVal e As System.EventArgs) Handles btnSearch.Click

        '-- Instantiate the search forms.
        Dim frmSearch As frmHowTo8_4b
        frmSearch = New frmHowTo8_4b()

        '-- Set the custom data properties on the search form.
        '   This is what makes it so data driven.

        frmSearch.DisplayName = "Customers"
        frmSearch.SearchRecordSource = "Customers"
        frmSearch.SearchField = "CompanyName"
        frmSearch.KeyField = "CustomerID"

        '-- Open the search form as dialog.
        '   Based on the DialogResult property, use the
        '   custom property ResultValue property and load
        '   the requested record.

        If frmSearch.ShowDialog() = DialogResult.OK Then

            LoadIndividual(frmSearch.ResultValue)

        End If

End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="3"><P>Create the <TT>LoadIndividual</TT> routine by entering the code shown in Listing 8.18 into the form. Taking the <TT>strKeyValue</TT> passed from the results of the search, a data adapter is created and a <TT>DataSet</TT> is filled. Next, the individual data row is created. Last, each of the TextBox controls is loaded with the value from the column with the corresponding name. Notice the use of the <TT>Try&#8230;Catch&#8230;End</TT> Try to ignore controls that don't have a like column in the data row.</P>
<H5 class="docExampleTitle">Listing 8.18 <TT>frmHowTo8_4a.vb</TT>: Loading an Individual Record into Text Boxes on the Form</H5>
<PRE>
Private Sub LoadIndividual(ByVal strKeyValue As String)

        Dim strSQL As String
        Dim strName As String
        Dim oCtl As Object

        Dim dsCustIndiv As New DataSet()
        Dim odaCustIndiv As OleDb.OleDbDataAdapter
        Dim drCustIndiv As DataRow

        Try
            '-- Load the individual record into the dataset
            strSQL = "Select * from Customers Where CustomerID = '" &amp;
                             strKeyValue &amp; "'"
            odaCustIndiv = New OleDb.OleDbDataAdapter(strSQL, _
                             BuildCnnStr("(local)", "Northwind"))

            '-- Fill the dataset
            odaCustIndiv.Fill(dsCustIndiv, "Customers")

            '-- Grab the individual data row
            drCustIndiv = dsCustIndiv.Tables("Customers").Rows(0)

        Catch oexpData As OleDb.OleDbException

            MessageBox.Show("Error loading individual data: " &amp; _
           oexpData.Message)
            Exit Sub

        End Try

        '-- Run through the text boxes on the form.
        '-- If they match up with a field from the record, load them.

        For Each oCtl In Me.Controls

            If TypeOf oCtl Is TextBox Then

                strName = Mid(oCtl.Name, 4)

                '-- By trapping the exception this way, errors are ignored.
                Try
                    oCtl.text = drCustIndiv(strName).ToString
                Catch oexp As Exception
                End Try

            End If

        Next

End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="4"><P>Create the next Windows Form and call it whatever name you referred to in the search form in step 2. Then place the controls shown in Figure 8.7 of the search form, with the properties set as in Table 8.6.</P><P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 8.6. Label, TextBox, DataGrid, and Command Button Controls Property Settings for the Calling Form</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>GroupBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>GroupBox1</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Click on a Letter</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnA</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>A</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnB</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>B</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnC</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>C</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>...</TT></P>
</TD>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">&nbsp;</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnZ</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Z</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnAll</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>All</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataGrid</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dgSearch</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnAccept</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>&amp;Accept</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnCancel</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>&amp;Cancel</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P></span></LI><LI><span style="font-weight:normal" value="5"><P>Create the custom properties discussed in the "Technique" section of this How-To and found in Listing 8.19. Each of the properties is self-explanatory.</P>
<H5 class="docExampleTitle">Listing 8.19 <TT>frmHowTo8_4b.vb</TT>: Creating Custom Properties for the Search Form</H5>
<PRE>
Private mstrDisplayName As String
Private mstrRecordSource As String
Private mstrSearchField As String
Private moResultValue As Object
Private mstrKeyField As String

Public Property DisplayName() As String
    Get
        DisplayName = mstrDisplayName
    End Get
    Set(ByVal Value As String)
        mstrDisplayName = Value
    End Set
End Property

Public Property SearchRecordSource() As String
    Get
        SearchRecordSource = mstrRecordSource
    End Get
    Set(ByVal Value As String)
        mstrRecordSource = Value
    End Set
End Property

Public Property SearchField() As String
    Get
        SearchField = mstrSearchField
    End Get
    Set(ByVal Value As String)
        mstrSearchField = Value
    End Set
End Property

Public Property KeyField() As String
    Get
        KeyField = mstrKeyField
    End Get
    Set(ByVal Value As String)
        mstrKeyField = Value
    End Set
End Property

Public Property ResultValue() As Object
    Get
        ResultValue = moResultValue
    End Get
    Set(ByVal Value As Object)
        moResultValue = Value
    End Set
End Property
</PRE></span></LI><LI><span style="font-weight:normal" value="6"><P>On the form, add the code in Listing 8.20 to the <TT>Load</TT> event. This routine ensures that the calling form set the <TT>DisplayName custom</TT> property; thus, this routine can assume that the others were set as well. If not, a message box is displayed. If so, the <TT>Text</TT> property of the form, which is displayed in the Title bar, is set to <TT>DisplayName</TT>.</P>
<H5 class="docExampleTitle">Listing 8.20 <TT>frmHowTo8_4b.vb</TT>: Executing a SQL Server-Supplied Stored Procedure That Lists the Tables in the Database</H5>
<PRE>
Private Sub frmHowTo8_4b_Load(ByVal sender As Object, _
                    ByVal e As System.EventArgs) Handles MyBase.Load

        If Len(Me.DisplayName) = 0 Then

            MessageBox.Show("Form specific properties not set.")
            Me.Close()

        Else

            Me.Text = Me.Text &amp; " " &amp; Me.DisplayName

        End If

End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="7"><P>For each of the command buttons that has a single letter, add the first subroutine displayed in Listing 8.21 to each of the <TT>Click</TT> events. For the <TT>btnAll Button</TT> control, add the second subroutine to the <TT>Click</TT> event. Each <TT>Button</TT> control will pass the letter it represents to the subroutine called <TT>SetData</TT>, discussed in the next step. The btnAll code simply passes the empty string.</P>
<H5 class="docExampleTitle">Listing 8.21 <TT>frmHowTo8_4b.vb</TT>: Click Events for Each of the Letter Button Controls</H5>
<PRE>
Private Sub btnA_Click(ByVal sender As System.Object,
                ByVal e As System.EventArgs) Handles btnA.Click
        SetData("A")
End Sub
Private Sub btnAll_Click(ByVal sender As System.Object,
 ByVal e As System.EventArgs) Handles btnAll.Click
        SetData("")
End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="8"><P>Add the subroutine in Listing 8.22 to the class module of the form. This routine takes the letter value passed in strFilterLetter as a parameter. A SQL Select string is created that takes the literal values Select, From, and Where and uses the custom properties <TT>KeyField</TT>, <TT>SearchField</TT>, and <TT>SearchRecordSource</TT>. The <TT>SearchField</TT> property is used with the <TT>Like</TT> clause, also using the <TT>strFilterLetter</TT> and the <TT>%</TT> (wildcard). Note that if <TT>""</TT> is passed to <TT>strFilterLetter</TT>, all the records will be listed. Finally, odtSearch is filled and set as the data source for dgSearch, which is the <TT>DataGrid</TT> control.</P>
<H5 class="docExampleTitle">Listing 8.22 <TT>frmHowTo8_4a.vb</TT>: Filling the Results Set Based on the Letter Button That Was Pressed</H5>
<PRE>
Sub SetData(ByVal strFilterLetter As String)

        Dim odaSearch As OleDb.OleDbDataAdapter
        Dim dtSearch As DataTable = New DataTable()

        odaSearch = New _
            OleDb.OleDbDataAdapter("Select " &amp; Me.KeyField &amp; ", " &amp;
            Me.SearchField &amp; " From " &amp; Me.SearchRecordSource &amp; " Where " &amp;
            Me.SearchField &amp; " Like '" &amp; strFilterLetter &amp; "%'",
                      (BuildCnnStr("(local)", "Northwind")))

        odaSearch.Fill(dtSearch)
        dgSearch.DataSource = dtSearch

    End Sub
</PRE>
<div class="docNote"><p class="docNoteTitle">Note</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/note_icon.gif" ALT="graphics/note_icon.gif"></td>
<td valign="top"><P>This routine more than any in this How-To shows the flexibility of this technique. You can use any table values for these properties. Just think of how many places you can use this form without changing a line of code in the form.</P>
</td>
</tr></table></p>
</div></span></LI><LI><span style="font-weight:normal" value="9"><P>On the buttons called <TT>btnAccept</TT> and <TT>btnCancel</TT>, add the code in Listing 8.23 to the appropriate <TT>Click</TT> event of each. The <TT>btnAccept_Click</TT> routine creates a <TT>DataTable</TT> object from the data grid's <TT>DataSource</TT> property. Then it derives the data row that is currently selected from that data table. The <TT>KeyField</TT> property is used to store the individual column value of <TT>drCurr</TT> into the <TT>ResultValue</TT> custom property. The <TT>DialogResult</TT> property is set to OK, and the form is hidden with the <TT>Hide</TT> method. By hiding the form, you can still read the properties of the form without the user seeing it.</P>
<P>In the <TT>btnCancel_Click</TT> routine, the <TT>DialogResult</TT> is set to <TT>No</TT>, and the form is closed. This action tells the calling form that the search was canceled.</P>
<H5 class="docExampleTitle">Listing 8.23 <TT>frmHowTo8_4b.vb</TT>: Storing the Resulting Key Value to the ResultValue Custom Property and Setting the DialogResult</H5>
<PRE>
Private Sub btnAccept_Click(ByVal sender As System.Object, _
                        ByVal e As System.EventArgs) Handles btnAccept.Click

        Dim dtFromGrid As DataTable
        Dim drCurr As DataRow

        Try

            '-- Using the DataRow and DataTable objects of the DataGrid control,
            '   get the selected result and assign it to the custom property
            '   ResultValue. Then set the DialogResult
           '     property to DialogResult.OK,
            '   and hide the form so that the calling form can still access it.

            dtFromGrid = CType(dgSearch.DataSource, DataTable)

            drCurr = dtFromGrid.Rows(Me.dgSearch.CurrentRowIndex())
            Me.ResultValue = drCurr(Me.KeyField).ToString
            Me.DialogResult = DialogResult.OK
            Me.Hide()

        Catch exp As Exception
            Me.DialogResult = DialogResult.No
            Me.Close()

        End Try

    End Sub

    Private Sub btnCancel_Click(ByVal sender As System.Object, _
                        ByVal e As System.EventArgs) Handles btnCancel.Click

        Me.DialogResult = DialogResult.Cancel
        Me.Close()

End Sub
</PRE></span></LI></OL></span>
<H4 class="docSection2Title"> How It Works</H4>
<P>When the user clicks on the search button, the calling form sets the custom properties of the search form, telling it what record source to use, as well as other information used for searching for the specific record and domain desired-in this case:</P>
<UL>
<LI><P>Customers for the property <TT>DisplayName</TT></P></LI>
<LI><P>Customers for the property <TT>SearchRecordSource</TT></P></LI>
<LI><P>CustomerID for the property <TT>KeyField</TT></P></LI>
<LI><P>CompanyName for the property <TT>SearchField</TT></P></LI>
</UL>
<P>After the search form is loaded, the user presses one of the letters to narrow down the records to look for, a data adapter is passed a SQL String made up of the properties just mentioned, a data table is filled, and the data grid's <TT>DataSource</TT> property sets the data table.</P>
<P>When the user clicks Accept, the data table is retrieved from the data grid, which then produces the data row that contains the key field. This is stored into the <TT>ResultValue</TT> property of the search form, the <TT>DialogResult</TT> property is set to <TT>DialogResult.OK</TT>, and the form is hidden.</P>
<P>Back on the calling form, the <TT>LoadIndividual</TT> routine is called and passed the <TT>ResultValue</TT> property from the search form. The text boxes are then loaded with the data row results.</P>
<H4 class="docSection2Title"> Comments</H4>
<P>This technique shows a number of ways that the various ADO.NET objects can be used. Take a close look at the use of the dialog style form, forcing code execution to halt until you hide or close the form. This is a technique that you will use throughout your applications after you get used to it.</P>
<P>Again, you can enhance this tool in a number of ways. One way is to allow the user to enter a string value to type in, narrowing down the choices even more, and another is to add a property that could be used to specify multiple columns to be displayed.</P>
<ul></ul>
</body></html>
