<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="10.6 Print Labels and Control the Order in Which Records Will Be Printed"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">10.6 Print Labels and Control the Order in Which Records Will Be Printed</H3>
<P>I need to be able to have my application print labels for my user's customer list. Sometimes my user needs to print labels based on the postal code, and other times he needs to print labels alphabetically by company name. How do I do this at runtime?</P>
<H4 class="docSection2Title"> Technique</H4>
<P>To accomplish this task, you will use the Report Expert to create mailing labels. You then will use code to update the sort order at run-time.</P>
<H5 class="docSection3Title"> Creating the Mailing Labels</H5>
<P>To create the mailing labels, you create a new report and choose Mailing Labels for the type of Expert to use. You then fill in the Data tab, which uses Customers for the table, and grab the following fields: CompanyName, ContactName, ContactTitle, Address, Formula (@CityRegionPostal= { Customers.City} &amp; ", " &amp; { Customers.Region} &amp; " "&amp; { Customers.PostalCode} ), and Country. You can see how this will look in Figure 10.22.</P>
<CENTER><H5 class="docFigureTitle">Figure 10.22. Fields that will be used in the mailing labels.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="378" src="FILES/10fig22.jpg" ALT="graphics/10fig22.jpg"></p>
</CENTER>
<P>After clicking Next, you are taken to the tab that allows you to choose which type of label you want to use. For this How-To, the Address (Avery 5160) is used. Everything else on the page is chosen for you (see Figure 10.23).</P>
<CENTER><H5 class="docFigureTitle">Figure 10.23. You have control over how your labels look.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="379" src="FILES/10fig23.jpg" ALT="graphics/10fig23.jpg"></p>
</CENTER>
<P>Now you can just click Finish, and the final mailing label report is created (see Figure 10.24).</P>
<CENTER><H5 class="docFigureTitle">Figure 10.24. These appear in nice mailing label format when they're viewed on a form.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="375" src="FILES/10fig24.jpg" ALT="graphics/10fig24.jpg"></p>
</CENTER>
<H5 class="docSection3Title"> Controlling the Sort Order at Runtime</H5>
<P>To control the sort order at runtime, you use properties, methods, and objects of the ReportDocument. Specifically, you traverse down the <TT>ReportDocument</TT> object model, looking at the <TT>Database</TT> object and moving down to the Fields level. You do this first when you're loading up a combo box with fields that are being used in the report. The following lines of code accomplish this:</P>
<pre>
For Each dfCurr In Me.rdHowTo10_6.Database.Tables.Item(0).Fields
            Me.cboSortFields.Items.Add(dfCurr.Name)
Next
</pre>
<P><TT>dfCurr</TT> is a <TT>FieldDefinition</TT> object, which means it is a field definition for a given field in the report.</P>
<P>The other object that will be used from the Report definition is the <TT>DataDefinition</TT> object, and the <TT>SortFields</TT> collection off of that. You can see this with the following lines of code, which set the sorting for the report based on which field they chose in the combo box:</P>
<pre>
With Me.rdHowTo10_6
    dfSort = .Database.Tables.Item(0).Fields.Item(Me.cboSortFields.Text)
    .DataDefinition.SortFields.Item(0).Field = dfSort
End With
Me.cvwCustomerLabels.RefreshReport()
</pre>
<P>You can see once again that the <TT>RefreshReport</TT> method is called after updating the <TT>SortFields</TT> item.</P>
<H4 class="docSection2Title"> Steps</H4>
<P>Open and run the Visual Basic .NET-Chapter 10 solution. Click on the button labeled How-To 10.6. You can select fields from the ComboBox control on the top of the form, and the report reflects the sorting selection (see Figure 10.25).</P>









<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Create a new Crystal Report. Choose Mail Labels for the Report Expert to use.</P></span></LI><LI><span style="font-weight:normal" value="2"><P>Fill in the Data tab, choosing Northwind for the database, and Customers for the table to use.</P></span></LI><LI><span style="font-weight:normal" value="3"><P>Choose the fields as specified by the "Technique" section: CompanyName, ContactName, ContactTitle, Address, Formula (@CityRegionPostal= { Customers.City} &amp; ", " &amp; { Customers.Region} &amp; " " &amp; { Customers.PostalCode} ), and Country.</P></span></LI><LI><span style="font-weight:normal" value="4"><P>On the Label tab, choose Address (Avery 5160) for the mailing label type. Click Finish.</P></span></LI><LI><span style="font-weight:normal" value="5"><P>Create a Windows Form.</P></span></LI><LI><span style="font-weight:normal" value="6"><P>Drag on a <TT>ReportDocument</TT> object, and set it to point to the report you created in the past few steps. Then name your report document <TT>rdHowTo10_6</TT>.</P></span></LI><LI><span style="font-weight:normal" value="7"><P>Place the controls shown in Figure 10.22 onto the form with the properties set forth in Table 10.5.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 10.5. Label, Combo, and CrystalReportViewer Controls and Their Property Settings</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Pick a Field to Sort</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>ComboBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>cboSortFields</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>CrystalReportViewer</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>cvwCustomerLabels</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Anchor</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Top, Bottom, Right, Left</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>ReportSource</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>rdHowTo10_6</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P></span></LI><LI><span style="font-weight:normal" value="8"><P>Add the code in Listing 10.5 to the Load event of the form. As described in the "Technique" section, this code iterates through each of the fields in the table that the report is based on and loads them into the <TT>Items</TT> collection of <TT>cboSortFields</TT>.</P>
<H5 class="docExampleTitle">Listing 10.5 <TT>frmHowTo10_5.vb</TT>: Populating the Selection Combo Box</H5>
<PRE>
Private Sub frmHowTo10_6_Load(ByVal sender As System.Object, _
ByVal e As System.EventArgs) Handles MyBase.Load

        Dim dfCurr As CrystalDecisions.CrystalReports.Engine.FieldDefinition

        '- Iterate through the table that the report is based on
        '   and load the fields into a combo box.

        For Each dfCurr In Me.rdHowTo10_6.Database.Tables.Item(0).Fields
            Me.cboSortFields.Items.Add(dfCurr.Name)
        Next

End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="9"><P>Add the code in Listing 10.6 to the <TT>SelectedIndexChanged</TT> event of <TT>cboSortFields</TT>. This code takes the selected item from <TT>cboSortFields</TT> and locates it in the table that the report is based on. The <TT>DataDefinition</TT> object is retrieved and then assigned to the first items in the <TT>SortFields</TT> collection. Last, the report is redisplayed using the <TT>RefreshReport</TT> method.</P>
<H5 class="docExampleTitle">Listing 10.6 <TT>frmHowTo10_5.vb</TT>: Populating the Selection Combo Box</H5>
<PRE>
Private Sub cboSortFields_SelectedIndexChanged(ByVal sender As System.Object, _
ByVal e As System.EventArgs) Handles cboSortFields.SelectedIndexChanged

    Dim dfSort As CrystalDecisions.CrystalReports.Engine.FieldDefinition

        '- Use the field that is picked in the combo box in
        '   the SortFields collection.

    With Me.rdHowTo10_6
        dfSort = .Database.Tables.Item(0).Fields.Item(Me.cboSortFields.Text)
        .DataDefinition.SortFields.Item(0).Field = dfSort
    End With
    Me.cvwCustomerLabels.RefreshReport()

End Sub
</PRE></span></LI></OL></span>
<CENTER><H5 class="docFigureTitle">Figure 10.25. Let your user sort the mailing labels as needed.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="389" src="FILES/10fig25.jpg" ALT="graphics/10fig25.jpg"></p>
</CENTER>
<H4 class="docSection2Title"> Comments</H4>
<P>If you have more than one field you want to sort on, then you could use the same technique, just adding code such as this:</P>
<pre>
dfSort = .Database.Tables.Item(0).Fields.Item(Me.cboSortFields2.Text)
.DataDefinition.SortFields.Item(1).Field = dfSort
</pre>
<P>The 0 is replaced by 1, and you have another combo box from which you must pick the second sort field.</P>
<ul></ul>
</body></html>
