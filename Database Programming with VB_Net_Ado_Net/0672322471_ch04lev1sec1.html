<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="4.1 Edit Data and Update Changes That Are Made to an ADO.NET DataSet Object"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">4.1 Edit Data and Update Changes That Are Made to an ADO.NET DataSet Object</H3>
<P>Listing and viewing data is easy. What you really need to do is to be able to edit and update data. You know you can use the <TT>DataSet</TT> object and some of its objects and methods to perform this task. How do you edit and update data using the <TT>DataSet</TT> object?</P>
<H4 class="docSection2Title"> Technique</H4>
<P>In this How-To, you will use the <TT>DataAdapter</TT>, <TT>DataSet</TT>, <TT>DataTable</TT>, and <TT>DataRow</TT> objects. You have experienced some of the properties and methods of each of these objects before. In this chapter, you are going to be using the following properties and methods that are shown in Table 4.1.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 4.1. <TT>DataAdapter</TT>, <TT>DataSet</TT>, <TT>DataTable</TT>, and <TT>DataRow</TT> Properties and Methods</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object /Method</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Description</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataAdapter</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Fill</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Fills <TT>DataSet</TT> and <TT>DataTable</TT> objects.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>CommandBuilder</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>GetUpdateCommand</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Creates an <TT>Update</TT> command and places it into the data adapter's <TT>UpdateCommand</TT> property.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataAdapter</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>UpdateCommand</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Holds the SQL statement for the update.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataAdapter</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Close</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Closes the connection off the <TT>UpdateCommand</TT>. The syntax is <span class="docEmphasis"><TT>dataadapter</TT></span><TT>.UpdateCommand.Connect.Close()</TT>.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataAdapter</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Update</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Performs the update command against the dataset.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataSet</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Tables</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Represents a collection of tables found within a dataset.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataSet</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Rows</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Contains a collection of rows within a specified table in a dataset.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataSet</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>AcceptChanges</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Sends the changes back to the server.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataRow</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>ToString</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Retrieves the data from the column that is specified in the <TT>DataRow</TT> and returns it as a string value.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataRow</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>BeginEdit</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Begins the editing of a <TT>DataRow</TT>, allowing you to replace values in the columns.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataRow</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>EndEdit</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Completes the editing of a <TT>DataRow</TT>.</P>
</TD>
</TR>
</COLGROUP>
</TABLE></P>
<P>You will see these objects with their properties and methods used in the following steps.</P>
<H4 class="docSection2Title"> Steps</H4>
<P>Open and run the VB.NET-Chapter 4 solution. From the main form, click on the command button with the caption How-To 4.1. When the form loads, click on the Load List button to display the customers that begin with the letter <span class="docEmphasis">A</span>. Click the Edit button. You will notice that the fields have now taken on a sunken look. Place the cursor into the City field and change the value to <TT>Dunkirk</TT>. Now click Save. If you move off the record and move back on, you will notice that the value has been saved.</P>
<P>This form looks similar to the form created in Chapter 1. The difference is that this time you will not be using controls that are bound at design time. You can see the form in Figure 4.1.</P>












<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Create a new Windows Form.</P></span></LI><LI><span style="font-weight:normal" value="2"><P>Add the following controls, setting the properties as listed in Table 4.2.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 4.2. Controls Property Settings</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Label1</TT></P>
<P><TT>Customer</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtCustLimit</TT></P>
<P><TT>A</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnLoadList</TT></P>
<P><TT>Load List</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>ListBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>lstCustomers</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Customer ID</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Company Name</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Contact</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Contact</TT> Title</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Address</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>City</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Region</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Country</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Phone</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Fax</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtCustomerID</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtCompanyName</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtContact</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtContactTitle</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtAddress</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtCity</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtRegion</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtPostalCode</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtCountry</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtPhone</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtFax</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnEdit</TT></P>
<P><TT>&amp;Edit</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnSave</TT></P>
<P><TT>&amp;Save</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnCancel</TT></P>
<P>&amp;<TT>Cancel</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P>
<div class="docNote"><p class="docNoteTitle">Note</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/note_icon.gif" ALT="graphics/note_icon.gif"></td>
<td valign="top"><P>Notice that the <TT>Text</TT> property of the text boxes is not being set at design time. In Chapter 1, "Developing Windows Forms Using Bound Controls," they were set to columns of a dataset that was included on the form. In this How-To, they will be set at run-time.</P>
</td>
</tr></table></p>
</div></span></LI><LI><span style="font-weight:normal" value="3"><P>In the class module for the form, add the following three Private declarations just below the line of code that reads <TT>Windows Form Designer generated code</TT>. These three objects will be used throughout the form.</P>
<pre>
Dim mdsCustIndiv As New DataSet()
Dim modaCustIndiv As OleDb.OleDbDataAdapter
Dim mdrCustIndiv As DataRow
</pre></span></LI><LI><span style="font-weight:normal" value="4"><P>Enter the following code as the Click event for btnLoadList:</P>
<pre>
Private Sub btnLoadList_Click(ByVal sender As System.Object, _
              ByVal e As System.EventArgs) Handles btnLoadList.Click

        '-- Move the loading of the list to a subroutine for
        '   additional(calls)
        LoadList()

    End Sub
</pre></span></LI><LI><span style="font-weight:normal" value="5"><P>Create the LoadList routine by entering the following code into the form you created for this How-To. This code creates and fills a data table using a data adapter. The string that the data adapter uses creates a <TT>Select</TT> statement by using the txtCustLimit text box. The <TT>DataSource</TT>, <TT>DisplayMember</TT>, and <TT>ValueMember</TT> properties of the list box are then bound. Last, the <TT>LoadIndividual</TT> routine is called, which is described in the next step.</P>
<pre>
Private Sub LoadList()

        Dim odaCustList As OleDb.OleDbDataAdapter
        Dim dtCustList As DataTable = New DataTable()

        Dim strSQL As String

        '-- Create the SQL String
        strSQL = "Select CustomerID, CompanyName " &amp; _
                    From Customers Where CustomerID Like '" &amp; _
                    Me.txtCustLimit.Text &amp; "%'"


        '-- Set up the exception catch
        Try

            '-- Create an instance of the data adapter; then fill the data              
<IMG BORDER="0" ALIGN="left" WIDTH="18" HEIGHT="11" src="FILES/ccc.gif" ALT="graphics/ccc.gif">table
            odaCustList = New OleDb.OleDbDataAdapter(strSQL, _
                    BuildCnnStr("(local)", "Northwind"))
            odaCustList.Fill(dtCustList)

            '-- Bind the data to the list box
            lstCustomers.DataSource = dtCustList
            lstCustomers.DisplayMember = "CompanyName"
            lstCustomers.ValueMember = "CustomerID"

        LoadIndividual()
        Catch oexpData As OleDb.OleDbException
            MsgBox(oexpData.Message)
        End Try

    End Sub
</pre></span></LI><LI><span style="font-weight:normal" value="6"><P>Create the <TT>LoadIndividual</TT> routine by entering the following code in the form you created for this How-To. Taking the <TT>SelectedItem</TT> from the list box, a data adapter is created, and a dataset is filled. Next, the individual <TT>DataRow</TT> is created. Last, each of the <TT>TextBox</TT> controls is loaded with the value from the column with the corresponding name. Notice the use of the <TT>Try-Catch-End-Try</TT> to ignore controls that don't have a like column in the <TT>DataRow</TT>.</P>
<pre>
Private Sub LoadIndividual()

        Dim strSQL As String
        Dim strName As String
        Dim oCtl As Object

        mdsCustIndiv.Clear()

        If Me.lstCustomers.SelectedIndex &lt;&gt; -1 Then

            Try
                '-- Load the individual record into the dataset
                strSQL = "Select * from Customers Where CustomerID = '" &amp;
                                  Me.lstCustomers.SelectedItem(0) &amp; "'"
                modaCustIndiv = New OleDb.OleDbDataAdapter(strSQL, _
                                  BuildCnnStr("(local)", "Northwind"))

                '-- Fill the dataset
                modaCustIndiv.Fill(mdsCustIndiv, "Customers")

                '-- Grab the individual data row
                mdrCustIndiv = mdsCustIndiv.Tables("Customers").Rows(0)

            Catch oexpData As OleDb.OleDbException

                MessageBox.Show("Error loading individual data: " _
                                   &amp; oexpData.Message)
                Exit Sub

            End Try

            '-- Run through the text boxes on the form, and
            '-- if they match up with a field from the record,
             '  load them.

            For Each oCtl In Me.Controls

                If TypeOf oCtl Is TextBox Then

                    strName = Mid(oCtl.Name, 4)

                    '-- By trapping the exception this way, errors are ignored.
                    Try
                        oCtl.text = mdrCustIndiv(strName).ToString
                    Catch oexp As Exception
                    End Try

                End If

            Next

        End If
    End Sub
</pre></span></LI><LI><span style="font-weight:normal" value="7"><P>Enter the following code to the <TT>Click</TT> event for lstCustomers:</P>
<pre>
Private Sub lstCustomers_Click(ByVal sender As Object,
                ByVal e As System.EventArgs) Handles lstCustomers.Click

        '-- Fill the current list item's individual dataset
        LoadIndividual()

End Sub
</pre></span></LI><LI><span style="font-weight:normal" value="8"><P>Enter the following code to the Click event for btnEdit:</P>
<pre>
Private Sub btnEdit_Click(ByVal sender As System.Object,
                      ByVal e As System.EventArgs) Handles btnEdit.Click

        '-- Enable the editing of the form
        ActivateEditing(True)

End Sub
</pre></span></LI><LI><span style="font-weight:normal" value="9"><P>Create the <TT>ActivateEditing</TT> routine by entering the following code in the form you created for this How-To. Introduced in Chapter 1, this code goes through each of controls on the form, looking for text boxes, then setting the <TT>BorderStyle</TT> and <TT>BackColor</TT> properties based on whether the controls are to be enabled or disabled. The Enabled property of each control is then set as well.</P>
<pre>
Private Sub ActivateEditing(ByVal bEnable As Boolean)


        Dim oCurr As Object

        '-- Loop through each of the controls on the form
        For Each oCurr In Me.Controls()

            '-- Check to see if the control is a text box
            If TypeOf oCurr Is TextBox And oCurr.Name &lt;&gt; "txtCustLimit" Then

                '-- If so, toggle the properties
                If bEnable Then

                    oCurr.BorderStyle() = _
                            System.Windows.Forms.BorderStyle.Fixed3D

                    oCurr.BackColor() = System.Drawing.Color.White

                Else

                    oCurr.BorderStyle() = _
                            System.Windows.Forms.BorderStyle.FixedSingle

                    oCurr.BackColor() = Me.BackColor


                End If

                oCurr.Enabled = bEnable

            End If
        Next

End Sub
</pre></span></LI><LI><span style="font-weight:normal" value="10"><P>Enter the following code to the Click event btnSave:</P>
<pre>
Private Sub btnSave_Click(ByVal sender As System.Object, _
                      ByVal e As System.EventArgs) Handles btnSave.Click

        '-- Save the information
        SaveRecord()

        '-- Disable the text boxes
        ActivateEditing(False)

    End Sub
</pre></span></LI><LI><span style="font-weight:normal" value="11"><P>Create the <TT>SaveRecord</TT> routine by entering the following code in the form that you created for this How-To. Using a <TT>DataRow</TT> object, the <TT>BeginEdit</TT> method is called, and then each of the controls is stored back into the columns of the same names, if they exist. The <TT>EndEdit</TT> method is then called to complete the editing of the <TT>DataRow</TT>. A <TT>CommandBuilder</TT> object is created to create the Update command for the <TT>DataAdapter</TT> object. The <TT>DataAdapter</TT> Update method is called to update the dataset with the data changed and then the <TT>AcceptChanges</TT> of the <TT>DataSet</TT> object. This accepts all the changes for all the objects and posts the data back to the server. Finally, the connection is closed for the <TT>UpdateCommand</TT> of the <TT>DataAdapter</TT> object.</P>
<pre>
Private Sub SaveRecord()

        Dim oCtl As Object
        Dim strName As String

        '-- Start the editing in the datarow.
        mdrCustIndiv.BeginEdit()

        '-- Run through the text boxes on the form, and
        '-- if they match up with a field from the record,
        '-- place the value back in the record.
        For Each oCtl In Me.Controls

            If TypeOf oCtl Is TextBox Then

                strName = Mid(oCtl.Name, 4)

                '-- By trapping the exception this way, errors are ignored.
                Try
                    mdrCustIndiv(strName) = oCtl.text
                Catch oexp As Exception
                End Try

            End If

        Next

        '-- Finish the editing of the data row
        mdrCustIndiv.EndEdit()

        Try

            '-- Create an instance of the command builder
            Dim ocbCustIndiv As OleDb.OleDbCommandBuilder
            ocbCustIndiv = New OleDb.OleDbCommandBuilder(modaCustIndiv)

            '-- Have the command builder create an update SQL command
            modaCustIndiv.UpdateCommand = ocbCustIndiv.GetUpdateCommand

            '-- Perform the update SQL command; then close the connection
            modaCustIndiv.Update(mdsCustIndiv, "Customers")
            mdsCustIndiv.Tables("Customers").AcceptChanges()
            modaCustIndiv.UpdateCommand.Connection.Close()


        Catch excData As Exception

        End Try

    End Sub
</pre></span></LI><LI><span style="font-weight:normal" value="12"><P>Enter the following code to the <TT>Click</TT> event btnCancel:</P>
<pre>
Private Sub btnCancel_Click(ByVal sender As System.Object, _
                   ByVal e As System.EventArgs) Handles btnCancel.Click

        '-- Use the BindingContext class to cancel the current editing.
    LoadIndividual()
     ActivateEditing(False)

End Sub
</pre></span></LI></OL></span>
<CENTER><H5 class="docFigureTitle">Figure 4.1. Although this looks like the form created in Chapter 1, you have more control over this version with unbound controls.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="281" src="FILES/04fig01.jpg" ALT="graphics/04fig01.jpg"></p>
</CENTER>
<H4 class="docSection2Title"> How It Works</H4>
<P>When the user clicks on the btnLoadList Button, the <TT>lstCustomers</TT> list box is loaded via the <TT>odaCustList</TT> data adapter and <TT>dtCustList</TT> data table. The first customer's information is then loaded in the text boxes on the right side of the form. When the <TT>btnEdit</TT> button is clicked, the look of the text boxes is changed to sunken, and they are enabled for editing of the text. After changing the data, when the user clicks on the <TT>btnSave</TT> button, the data is then stored back into the server, and the text boxes are changed to disabled. If the btnCancel is clicked, the text boxes are changed to disabled.</P>
<H4 class="docSection2Title"> Comments</H4>
<P>Although it takes a bit more code to handle the editing and updating of data with unbound controls versus bound controls, you might like it better because you can control the code. With bound controls, the code is written for you. The code that is displayed here can be modified to be more generic so that you don't have to write individual routines for each form.</P>
<ul></ul>
</body></html>
