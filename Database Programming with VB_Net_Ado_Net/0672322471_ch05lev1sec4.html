<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="5.3 Populate DropDown and ListBox Controls"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">5.3 Populate DropDown and ListBox Controls</H3>
<P>I saw in this chapter's first How-To how to bind a ListBox control to a dataset that was created in the design. How do I populate DropDown and ListBox controls on a Web Form using code at runtime?</P>
<H4 class="docSection2Title"> Technique</H4>
<P>ListBoxes and DropDowns, which are equivalent to ComboBoxes on Windows Forms, have different properties that are used for data binding than their Windows counterparts. Besides these properties, displayed in Table 5.4, you also need to use the Databind method and session object to track the data table that is created for products.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 5.4. Properties Used to Bind Columns to Controls</h5></CAPTION><COLGROUP span="2">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Description</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataTextField</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Column in data source to use for displaying in the <TT>DropDown</TT> or <TT>ListBox</TT> control.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataValueField</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Column in data source that is the lookup value.</P>
</TD>
</TR>
</COLGROUP>
</TABLE></P>
<div class="docNote"><p class="docNoteTitle">Note</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/note_icon.gif" ALT="graphics/note_icon.gif"></td>
<td valign="top"><P>You can use a property called <TT>DataFormatString</TT> to format the <TT>DataTextField</TT> data for display in the ListBox or DropDown controls.</P>
</td>
</tr></table></p>
</div><br>
<H4 class="docSection2Title"> Steps</H4>
<P>Open and run the Visual Basic .NET-Chapter 5 solution. From the main page, click on the hyperlink with the caption How-To 5.3: Populate DropDown and ListBox controls. When the Web Form loads, you will see a Categories dropdown with the Beverages category selected and the products for that category in the list box with the label Products. If you click on a product, the three text boxes are loaded on the right of the page (see Figure 5.3).</P>







<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Create a Web Form. Then place the controls listed in Table 5.5 and seen in Figure 5.3 with the following properties set.</P><P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 5.5. Control Property Settings for Validation Controls Web Form</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Categories:</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DropDown</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>ddCategories</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>AutoPostBack</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>True</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Products</TT>:</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>ListBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>lstProducts</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>AutoPostBack</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>True</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Product ID</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Product Name</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Unit Price</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtProductID</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>BackColor</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Transparent</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtProductName</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>BackColor</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Transparent</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtUnitPrice</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>BackColor</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Transparent</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>HyperLink</TT> </P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>hplReturnToMain</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>NavigateURL</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>wfrmMain.aspx</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P></span></LI><LI><span style="font-weight:normal" value="2"><P>As with some of the other chapters' projects, a support routine needs to be built to create the <TT>Connection</TT> string. Called <TT>BuildCnnStr</TT>, the function can been seen in Listing 5.5. This function takes a server and database name passed to it and creates a connection string.</P>
<H5 class="docExampleTitle">Listing 5.5 <TT>modGeneralRoutines.vb:</TT> Creating a Connection String</H5>
<PRE>
Function BuildCnnStr(ByVal strServer As String, ByVal strDatabase As String) As String

        Dim strTemp As String
        strTemp = "Provider=SQLOleDB; Data Source=" &amp; strServer &amp; ";"
        strTemp &amp;= "Initial Catalog=" &amp; strDatabase &amp; ";"
        strTemp &amp;= "Integrated Security=SSPI"

        Return strTemp
    End Function
</PRE>
<P>Although you could create a routine that would pass back a <TT>Connection</TT> object, a more versatile method would be to pass back a string. The reason for this is that for some objects, you are asked for a Connection object, but for others, you are asked for just a string.</P></span></LI><LI><span style="font-weight:normal" value="3"><P>In the class module for the Web Form, add the following Private declaration just below the line of code that reads Web Form Designer Generated Code.</P>
<pre>
Private mdtProducts As New DataTable()
</pre>
<P>This line of code declares a <TT>DataTable</TT> object that you will use throughout the Web Form. However, in addition to using this variable, you will use the Session object to retain the data between round trips to the server.</P></span></LI><LI><span style="font-weight:normal" value="4"><P>Add the code in Listing 5.6 to the Load event of the page. This code creates a <TT>DataAdapter</TT> object and then fills the <TT>dtCategories DataTable</TT> object. The <TT>ddCategories DropDown</TT> control is bound to <TT>dtCategories</TT>. The <TT>LoadProducts</TT> routine is called to load the products into the <TT>lstProducts ListBox</TT> control, which is described in the next step. Finally, the Session object is checked to see if the item <TT>MyProductsTable</TT> has been saved to it, and if so, it is loaded back into the <TT>mdtProducts</TT> variable.</P>
<H5 class="docExampleTitle">Listing 5.6 wfrmHowTo5_3.aspx.vb: Initializing the Page</H5>
<PRE>
    Private Sub Page_Load(ByVal sender As System.Object,
                ByVal e As System.EventArgs) Handles MyBase.Load

        'Put user code to initialize the page here
        If Not Me.IsPostBack Then

            Dim dtCategories As New DataTable()
            Dim odaCategories As _
                        New OleDb.OleDbDataAdapter( _
                       "Select CategoryID, CategoryName From Categories",
                        BuildCnnStr("(local)", "Northwind"))

            '-- Fill the data table
            odaCategories.Fill(dtCategories)

            '-- Assign the properties and bind the dropdown.
            ddCategories.DataValueField = "CategoryID"
            ddCategories.DataTextField = "CategoryName"
            ddCategories.DataSource = dtCategories
            ddCategories.DataBind()

            LoadProducts()

        End If

        '-- Load the products data table back from the session variable
        If Not (Session("MyProductsTable") Is Nothing) Then
            mdtProducts = CType(Session("MyProductsTable"), DataTable)
        End If

End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="5"><P>In the class module for the page, create the <TT>LoadProducts</TT> routine that is displayed in Listing 5.7. This code looks similar to other routines that generate a <TT>DataTable</TT> object and then assign the properties to bind mdtProducts to the lstProducts ListBox control. <TT>mdtProducts</TT> is then added to the <TT>Session</TT> object for round trips to the server.</P>
<H5 class="docExampleTitle">Listing 5.7 <TT>wfrmHowTo5_3.aspx.vb:</TT> Creating the <TT>LoadProducts</TT> Routine</H5>
<PRE>
Private Sub LoadProducts()

        Dim odaProducts As New OleDb.OleDbDataAdapter( _
                        "Select * From Products Where CategoryID = "
                        &amp; ddCategories.SelectedItem.Value, _
                        BuildCnnStr("(local)", "Northwind"))

        mdtProducts.Clear()
        odaProducts.Fill(mdtProducts)

        '-- Assign the properties and bind the list box.
        lstProducts.DataValueField = "ProductID"
        lstProducts.DataTextField = "ProductName"
        lstProducts.DataSource = mdtProducts
        lstProducts.DataBind()

        '-- Save the data table out to a session variable for round trips
        Session.Item("MyProductsTable") = mdtProducts

End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="6"><P>Add the code in Listing 5.8 to the SelectedIndexChanged event off the ddCategories DropDown control.</P>
<H5 class="docExampleTitle">Listing 5.8 <TT>wfrmHowTo5_3.aspx.vb:</TT> Calling the <TT>LoadProducts</TT> Routine When a New Category Is Chosen</H5>
<PRE>
Private Sub ddCategories_SelectedIndexChanged(ByVal sender As Object,
                        ByVal e As System.EventArgs) _
                  Handles ddCategories.SelectedIndexChanged

        LoadProducts()

End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="7"><P>Add the code in Listing 5.7 to the SelectedIndexChanged event off of lstProducts. This code takes the <TT>SelectedIndex</TT> property of the lstProducts ListBox control and helps retrieve the row in the <TT>DataTable</TT> object. The individual columns are then loaded into the corresponding text boxes on the page.</P>
<H5 class="docExampleTitle">Listing 5.9 <TT>wfrmHowTo5_3.aspx.vb:</TT> Locating the Row in the <TT>mdtProducts</TT> DataTable Object</H5>
<PRE>
Private Sub lstProducts_SelectedIndexChanged(ByVal sender As Object,
                        ByVal e As System.EventArgs) _
                  Handles lstProducts.SelectedIndexChanged

        With mdtProducts.Rows(lstProducts.SelectedIndex)
            txtProductID.Text = .Item("ProductID")
            txtProductName.Text = .Item("ProductName")
            txtUnitPrice.Text = .Item("UnitPrice")
        End With

End Sub
</PRE></span></LI></OL></span>
<CENTER><H5 class="docFigureTitle">Figure 5.3. DropDown and ListBox controls used to display data on this Web Form.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="375" src="FILES/05fig03.jpg" ALT="graphics/05fig03.jpg"></p>
</CENTER>
<H4 class="docSection2Title"> Comments</H4>
<P>One of the main items to note, besides the use of the Session variables, is the use of the <TT>ddCategorie.SelectedItem.Value</TT> and lstProducts.SelectedIndex. These are two ways to use items that are selected in the <TT>DropDown</TT> and <TT>ListBox</TT> objects, respectively.</P>
<P>After you have used the Session object to keep variables during round trips to the server, it becomes more intuitive as you use it.</P>
<ul></ul>
</body></html>
