<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="5.5 Display Data Using the Repeater Control"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">5.5 Display Data Using the Repeater Control</H3>
<P>I have heard that the Repeater control is a great control for displaying a read-only list of values, including hyperlinks. How do I populate a Repeater control and take advantage of templates to display the data the way I want it to look?</P>
<H4 class="docSection2Title"> Technique</H4>
<P>The Repeater control allows you to list data in various formats, such as bulleted or numbered. It relies on the use of templates to display information in a list format.</P>
<P>This How-To shows you how to use the Repeater control not only to display a list, but also to use a couple of different controls-a Button and HyperLink-to display another list using the Repeater control. The second list will be displayed using the button on the same page as the first list. The hyperlink will take you to another page to display the second list.</P>
<P>A main tool in the creation of the Repeater control is the use of templates.</P>
<H5 class="docSection3Title"> Use of Templates</H5>
<P>Templates are used within HTML and allow you to include controls in your ASP.NET Web server controls. Within a template, you can specify various details about the area for which you are creating a template. Following is a list of the templates:</P>
<UL>
<LI><P>HeaderTemplate</P></LI>
<LI><P>ItemTemplate</P></LI>
<LI><P>FooterTemplate</P></LI>
<LI><P>AlternatingItemTemplate</P></LI>
<LI><P>SeparatorTemplate</P></LI>
</UL>
<P>You can get an idea of what each of the templates is used for by its name. Here is an example of the <TT>HeaderTemplate</TT>, used in this How-To:</P>
<pre>
&lt;HeaderTemplate&gt;
    &lt;font face="Arial Black" size="2"&gt;List of Regions &lt;/font&gt;
    &lt;br&gt;
&lt;/HeaderTemplate&gt;
</pre>
<P>These lines are literally used as a template for how you want the section to be laid out, as well as what data to display. For the <TT>ItemTemplate</TT> in this How-To, two controls are displayed: a button and a hyperlink, shown by this snippet of the HTML:</P>
<pre>
&lt;asp:Button runat="server"
        Text= '&lt;%# DataBinder.Eval(Container.DataItem, "RegionID") %&gt; ' /&gt;
&lt;asp:HyperLink Runat="server"
    Text='&lt;%# DataBinder.Eval(Container, "DataItem.RegionDescription") %&gt;'
    NavigateURL='&lt;%# DataBinder.Eval(Container, "DataItem.RegionURL") %&gt;'
   ID="HyperLink1"/&gt;
</pre>
<P>As the name implies, the <TT>DataBinder</TT> supplies data from the data source that is specified for the Repeater object. You will see how to bind the Repeater object in step 3.</P>
<H4 class="docSection2Title"> Creating URLs On-the-Fly</H4>
<P>In the NavigateURL of the hyperlink that was created, you can see the column <TT>DataItem.RegionURL</TT> being used. This is not a column that is found in the Regions table in Northwind. This column is created within the SQL statement that is supplied to a data adapter, by the following line of code:</P>
<pre>
odaRegions = New OleDb.OleDbDataAdapter("Select RegionID, _
           'wfrmHowto5_5b.aspx?RegID=' +
        Cast(RegionID as Char(2)) As RegionURL, RegionDescription From Region",
            BuildCnnStr("(local)", "Northwind"))
</pre>
<P>The RegionURL consists of a Web Form name and the statement <TT>?RegID=Cast(RegionID as Char(2))</TT>, which ASP.NET loads into the new page and passes to the <TT>RegionID</TT> of the page, letting the code within the page read the <TT>RegionID</TT> using the <TT>Request</TT> object, as displayed here:</P>
<pre>
odaTer = New _
          OleDb.OleDbDataAdapter(_
         "Select TerritoryDescription From Territories Where RegionID = " &amp;
          Request.Item("RegID"), _
     BuildCnnStr("(local)", "Northwind"))
</pre>
<P>You will see both the creation and utilization of the URL in the steps that follow.</P>
<H4 class="docSection2Title"> Programming Repeater Events by Using <TT>ItemCommand</TT></H4>
<P>When you're using buttons, you can program the response for when the buttons are pressed by using the <TT>ItemCommand</TT> event. This event is raised for all the controls that are used in the Repeater. You will see an example of this in step 5.</P>
<H4 class="docSection2Title"> Steps</H4>
<P>Open and run the Visual Basic .NET-Chapter 5 solution. From the main page, click on the hyperlink with the caption How-To 5.4: Display Data Using the Repeater Control. You will then see a page open displaying a list of the regions (see Figure 5.5).</P>
<CENTER><H5 class="docFigureTitle">Figure 5.5. This list includes both a button, displaying the RegionID, and a hyperlink, displaying the region description.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="375" src="FILES/05fig05.jpg" ALT="graphics/05fig05.jpg"></p>
</CENTER>
<P>If you click one of the buttons displaying the Region ID, then another list is displayed using the Repeater control. This list is displayed below the regions and contains the territories for the region clicked (see Figure 5.6).</P>
<CENTER><H5 class="docFigureTitle">Figure 5.6. Another Repeater control is utilized for this list of territories.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="375" src="FILES/05fig06.jpg" ALT="graphics/05fig06.jpg"></p>
</CENTER>
<P>When you click on the hyperlinks in the list, another page displays, with yet another Repeater control used to display the territories for the region chosen (see Figure 5.7).</P>








<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Create a Web Form. Then place the controls listed in Table 5.8 with the following properties set.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 5.8. Property Settings Repeater and HyperLink Controls</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Repeater</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>repRegions</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Repeater</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>repTeritories</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>HyperLink</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>hplReturnToMain</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>NavigateURL</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>wfrmMain.aspx</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P></span></LI><LI><span style="font-weight:normal" value="2"><P>Switch to the HTML tab in the designer. By adding the repeaters and naming the repeaters in step 1, you will see a line of code that looks like this:</P>
<pre>
&lt;asp:Repeater id="repRegions"runat="server"&gt;&lt;/asp:Repeater&gt;
</pre>
<P>Replace this line of code with the code displayed in Listing 5.13. This code lays out the templates that were described in the "Technique" section, as well as the button and hyperlink described. Note that the <TT>FooterTemplate</TT>, listed here, is not really used for anything. It was included so that you could see how to use it. It can be excluded.</P>
<H5 class="docExampleTitle">Listing 5.13 <TT>wfrmHowTo5_5a.aspx:</TT> HTML for the repRegions Repeater</H5>
<PRE>
&lt;asp:Repeater id="repRegions" runat="server"&gt;
 &lt;HeaderTemplate&gt;
     &lt;font face="Arial Black" size="2"&gt;List of Regions &lt;/font&gt;
          &lt;br&gt;
      &lt;/HeaderTemplate&gt;
      &lt;ItemTemplate&gt;
          &lt;asp:Button runat="server"
             Text= '&lt;%# DataBinder.Eval(Container.DataItem, "RegionID") %&gt; ' /&gt;
          &lt;asp:HyperLink Runat="server"
             Text='&lt;%# DataBinder.Eval(Container, "DataItem.RegionDescription") %&gt;'
             NavigateURL='&lt;%# DataBinder.Eval(Container, "DataItem.RegionURL") %&gt;'
             ID="HyperLink1"/&gt;
          &lt;br&gt;
      &lt;/ItemTemplate&gt;
      &lt;FooterTemplate&gt;
      &lt;/FooterTemplate&gt;
&lt;/asp:Repeater&gt;
</PRE></span></LI><LI><span style="font-weight:normal" value="3"><P>Next, replace the HTML code inserted for the repTerritories repeater with the code in Listing 5.14. After the <TT>HeaderTemplate</TT> is specified, a Label control displays the <TT>TerritoryDescription</TT> column.</P>
<H5 class="docExampleTitle">Listing 5.14 <TT>wfrmHowTo5_5a.aspx:</TT> HTML for the repTerritories Repeater</H5>
<PRE>
   &lt;asp:Repeater id="repTerritories" runat="server"&gt;
       &lt;HeaderTemplate&gt;
           &lt;br&gt;
           &lt;font face="Arial Black" size="2"&gt;List of Territories &lt;/font&gt;
           &lt;br&gt;
       &lt;/HeaderTemplate&gt;
       &lt;ItemTemplate&gt;
           &lt;asp:Label runat="server"
           Text= '&lt;%# DataBinder.Eval(Container.DataItem, _
                             "TerritoryDescription") %&gt; ' /&gt;
           &lt;br&gt;
       &lt;/ItemTemplate&gt;

&lt;/asp:Repeater&gt;
</PRE></span></LI><LI><span style="font-weight:normal" value="4"><P>Add the code in Listing 5.15 to the Load event of the page. If the page is first being loaded, then the odaRegions <TT>DataAdapter</TT> fills the data table called <TT>dtRegions</TT>. <TT>dtRegions</TT> is set as the data source for <TT>repRegions</TT>, and <TT>DataBind</TT> method is called, binding the Repeater to the data table.</P>
<H5 class="docExampleTitle">Listing 5.15 <TT>wfrmHowTo5_5a.aspx.vb:</TT> Loading the repRegions Repeater Control</H5>
<PRE>
Private Sub Page_Load(ByVal sender As System.Object,
                    ByVal e As System.EventArgs) Handles MyBase.Load
        'Put user code to initialize the page here

        If Not Me.IsPostBack Then
            Dim odaRegions As OleDb.OleDbDataAdapter
            Dim dtRegions As DataTable

            odaRegions = New OleDb.OleDbDataAdapter("Select RegionID, _
           'wfrmHowto5_5b.aspx?RegID=' +
                Cast(RegionID as Char(2)) As RegionURL, _
           RegionDescription From Region",
                           BuildCnnStr("(local)", "Northwind"))

            dtRegions = New DataTable()
            odaRegions.Fill(dtRegions)
            repRegions.DataSource = dtRegions
            repRegions.DataBind()

        End If
End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="5"><P>Add the code in Listing 5.16 to the <TT>ItemCommand</TT> event of <TT>repRegions</TT>. This code takes the Text property of the button, which is the <TT>RegionID</TT>, and uses it in the SQL string to supply the odaTer data adapter. Next, <TT>odaTer</TT> fills <TT>dtTer</TT>, which is then used as the data source for <TT>repTerritories</TT>.</P>
<H5 class="docExampleTitle">Listing 5.16 <TT>wfrmHowTo5_5a.aspx.vb:</TT> Loading the Categories DropDown and Product Table Control</H5>
<PRE>
Private Sub repRegions_ItemCommand(ByVal source As Object, _
                ByVal e As System.Web.UI.WebControls.RepeaterCommandEventArgs)
                Handles repRegions.ItemCommand

     Dim odaTer As OleDb.OleDbDataAdapter
     Dim dtTer As DataTable

     odaTer = New _
        OleDb.OleDbDataAdapter(_
        "Select TerritoryDescription From Territories Where RegionID = " &amp;
        CType(e.CommandSource, Button).Text(), _
        BuildCnnStr("(local)", "Northwind"))

     dtTer = New DataTable()
     odaTer.Fill(dtTer)
     repTerritories.DataSource = dtTer
     repTerritories.DataBind()

End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="6"><P>Create another Web Form. Then place a Repeater control on it and set the ID of the Repeater to be repTerritories.</P>
<div class="docNote"><p class="docNoteTitle">Note</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/note_icon.gif" ALT="graphics/note_icon.gif"></td>
<td valign="top"><P>When you are saving and naming the Web Form created in this step, make sure you name it the same as that used in the code in step 4. Remember that it was the Web Form used in the RegionURL.</P>
</td>
</tr></table></p>
</div></span></LI><LI><span style="font-weight:normal" value="7"><P>Switch to the HTML tab in the designer. Replace the line of code that has been created for the repTerritories Repeater control with the code shown in Listing 5.17.</P>
<H5 class="docExampleTitle">Listing 5.17 <TT>wfrmHowTo5_5b.aspx</TT>: HTML for the repTerritories Repeater on the Second Web Form</H5>
<PRE>
&lt;asp:Repeater id="repTerritories" runat="server"&gt;
     &lt;HeaderTemplate&gt;
        &lt;br&gt;
        &lt;font face="Arial Black" size="2"&gt;List of Terriories &lt;/font&gt;
        &lt;br&gt;
    &lt;/HeaderTemplate&gt;
    &lt;ItemTemplate&gt;
        &lt;asp:Label runat="server"
               Text= '&lt;%# DataBinder.Eval(Container.DataItem, _
                          "TerritoryDescription") %&gt; '
               ID="Label1" NAME="Label1"/&gt;
        &lt;br&gt;
    &lt;/ItemTemplate&gt;
&lt;/asp:Repeater&gt;
</PRE></span></LI><LI><span style="font-weight:normal" value="8"><P>Add the code in Listing 5.18 to the Load event of the page. This code reads the <TT>RegionID</TT> first from the first Web Form using the Request object. Next, it is used to fill the dtTer data table, which is then assigned as the data source for repTerritories.</P>
<H5 class="docExampleTitle">Listing 5.18 <TT>wfrmHowTo5_5b.aspx.vb:</TT> Loading the repTerritories Repeater Control on the Second Web Form</H5>
<PRE>
Private Sub Page_Load(ByVal sender As System.Object,
                ByVal e As System.EventArgs) Handles MyBase.Load

     Dim odaTer As OleDb.OleDbDataAdapter
     Dim dtTer As DataTable

     odaTer = New
          OleDb.OleDbDataAdapter(_
          "Select TerritoryDescription From Territories Where RegionID = " &amp;
          Request.Item("RegID"), _
          BuildCnnStr("(local)", "Northwind"))

        dtTer = New DataTable()
        odaTer.Fill(dtTer)
        repTerritories.DataSource = dtTer
        repTerritories.DataBind()

End Sub
</PRE></span></LI></OL></span>
<CENTER><H5 class="docFigureTitle">Figure 5.7. A third Repeater control is utilized for this list of territories on a new page.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="375" src="FILES/05fig07.jpg" ALT="graphics/05fig07.jpg"></p>
</CENTER>
<img src="FILES/pixel.gif" width="1" height="1" border="0"><ul></ul>
</body></html>
