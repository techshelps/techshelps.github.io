<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="10.4 Select Whether the Report Will Be Displayed, Printed, or Exported Using Visual Basic .NET Code"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">10.4 Select Whether the Report Will Be Displayed, Printed, or Exported Using Visual Basic .NET Code</H3>
<P>I know I can use the Crystal Report Viewer to print and export my reports, but I want to be able to have control over that, and maybe not even include the Viewer in some cases.</P>
<H4 class="docSection2Title"> Technique</H4>
<P>For this How-To, you will use a Tab control to display the three options for the user: Print, Export, and View (see Figure 10.18).</P>
<CENTER><H5 class="docFigureTitle">Figure 10.18. You have flexibility when it comes to letting your users work with reports.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="352" src="FILES/10fig18.jpg" ALT="graphics/10fig18.jpg"></p>
</CENTER>
<P>The first tab, Print, allows you to specify the number of copies to print, along with the starting and ending pages.</P>
<H5 class="docSection3Title"> Printing Using the Report Document</H5>
<P>This page will use the <TT>PrintToPrinter</TT> method shown here:</P>
<pre>
Me.rdHowTo10_4.PrintToPrinter(Me.txtNumOfCopies.Text, False,
                                    Me.txtStartPage.Text, Me.txtEndPage.Text)
</pre>
<P>The <TT>PrintOptions</TT> object, found on the <TT>ReportDocument</TT>, is very useful. The <TT>PrintOptions</TT> object has the following properties: <TT>PaperOrientation</TT>, <TT>PaperSize</TT>, <TT>PaperSource</TT>, <TT>PrinterDuplex</TT>, and PrinterName. You can set these properties either at design time using the property sheet, or at runtime using code.</P>
<H5 class="docSection3Title"> Exporting Using the Report Document</H5>
<P>When you're exporting using the Report document, you will be using the <TT>ExportOptions</TT> object. The <TT>ExportOptions</TT> object is made up of four other properties/objects:</P>
<UL>
<LI><p>
<TT>DestinationOptions</TT>. 
This is made up of one of three possible objects: <TT>DiskFileDestinationOptions</TT>, <TT>ExchangeFolderDestinationOptions</TT>, or <TT>MicrosoftMailDestinationOptions</TT>.</p>
</LI>
<LI><p>
<TT>ExportDestinationType</TT>. 
This gets or sets the export destination type. This will be <TT>DiskFile</TT>, <TT>ExchangeFolder</TT>, <TT>MicrosoftMail</TT>, or <TT>NoDestinationType</TT>.</p>
</LI>
<LI><p>
<TT>ExportFormatType</TT>. 
This gets or sets the export format type. It can be one of the following: <TT>Excel</TT>, <TT>HTML32</TT>, <TT>HTML40</TT>, <TT>NoFormat</TT>, <TT>PortableDocFormat</TT>, <TT>RichText</TT>, or <TT>WordForWindows</TT>.</p>
</LI>
<LI><p>
<TT>FormatOptions</TT>. 
This gets or sets the <TT>FormatOptions</TT>. It can be <TT>ExcelFormatOptions</TT>, <TT>HTMLFormatOptions</TT>, or <TT>PdfRtfWordFormatOptions</TT>.</p>
</LI>
</UL>
<P>To execute the export, you use the <TT>Export</TT> method of the <TT>DocumentReport</TT> object. You can see the page for exporting in Figure 10.19.</P>
<CENTER><H5 class="docFigureTitle">Figure 10.19. You can control which types of files you want the user to export.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="352" src="FILES/10fig19.jpg" ALT="graphics/10fig19.jpg"></p>
</CENTER>
<P>The View tab uses a <TT>CrystalReportViewer</TT> object on the tab page.</P>
<H4 class="docSection2Title"> Steps</H4>
<P>Open and run the Visual Basic .NET-Chapter 10 solution. Click on the button labeled How-To 10.4. Clicking on the tabs, you can see the three options you have to work with. Clicking on the Print button prints your report to the default printer. When you go to the Export tab and click the Export button, a message appears stating that the data has been exported. The last tab, View, displays the report in a Viewer.</P>







<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Create a Windows Form. Then place a Tab control on your form.</P></span></LI><LI><span style="font-weight:normal" value="2"><P>Add pages for Print, Export, and View, using the <TT>TabPages</TT> property of the Tab control.</P></span></LI><LI><span style="font-weight:normal" value="3"><P>Drag on a <TT>ReportDocument</TT> object, and set it to point to the report you created in How-To 10.1. Then name your report document rdHowTo10_4.</P></span></LI><LI><span style="font-weight:normal" value="4"><P>Place the controls shown in Figure 10.18 and 10.19 onto the tab page with the properties set forth in Table 10.3.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 10.3. Controls for the Tab Pages</h5></CAPTION><COLGROUP span="4">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Tab Page </P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Print</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT># of Copies</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Start Page</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>End Page</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtNumOfCopies</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>1</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtStartPage</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>0</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtEndPage</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>0</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnPrint</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Export</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Export Type</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>File Path</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtExportFilePath</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>File Name</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtExportFileName</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>ListBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>lstExportType</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnExport</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>View</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>CrystalReportViewer</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Anchor</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Top, Bottom, Left, Right</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>ReportSource</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>rdHowTo10_4</TT></P>
</TD>
<TD class="docTableCell" valign="top">&nbsp;</TD>
</TR>
</COLGROUP>
</TABLE></P></span></LI><LI><span style="font-weight:normal" value="5"><P>Type <TT>Excel</TT> and <TT>Word Document</TT> into the Items collection of lstExportType.</P></span></LI><LI><span style="font-weight:normal" value="6"><P>Add the code in Listing 10.1 to the Click event of btnPrint.</P>
<H5 class="docExampleTitle">Listing 10.1 <TT>frmHowTo10_4.vb</TT>: Printing the Report</H5>
<PRE>
Private Sub btnPrint_Click(ByVal sender As System.Object, _
        ByVal e As System.EventArgs) Handles btnPrint.Click

    Dim po As PrintDialog

    Me.rdHowTo10_4.PrintToPrinter(Me.txtNumOfCopies.Text, False, _
                                Me.txtStartPage.Text, Me.txtEndPage.Text)

End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="7"><P>Add the code in Listing 10.2 to the <TT>Click</TT> event of btnExport. This code tests the value of lstExportType and assigns the appropriate ExportFormatType and file extension (strExt). The DiskFileDestinationOptions information is supplied, and the Export method is called to complete the export.</P>
<H5 class="docExampleTitle">Listing 10.2 <TT>frmHowTo10_4.vb</TT>: Exporting the Report</H5>
<PRE>
Private Sub btnExport_Click(ByVal sender As System.Object, _
            ByVal e As System.EventArgs) Handles btnExport.Click

    Dim strExt As String

    Try
        With Me.rdHowTo10_4.ExportOptions

            Select Case lstExportType.SelectedItem

                Case "Excel"
                    .ExportFormatType = _
                       CrystalDecisions.[Shared].ExportFormatType.Excel
                    strExt = ".xls"

                Case "Word Document"
                    .ExportFormatType = __
                        CrystalDecisions.[Shared].ExportFormatType.WordForWindows
                    strExt = ".Doc"

            End Select

            .ExportDestinationType = _
                CrystalDecisions.[Shared].ExportDestinationType.DiskFile

            Dim ddo As New CrystalDecisions.Shared.DiskFileDestinationOptions()

            ddo.DiskFileName = Me.txtExportFilePath.Text &amp; _
                                  Me.txtExportFileName.Text &amp; strExt

            .DestinationOptions = ddo

        End With

        Me.rdHowTo10_4.Export()

        MessageBox.Show("Report Exported!")

    Catch excp As Exception

        MessageBox.Show(excp.Message)

    End Try

End Sub
</PRE></span></LI></OL></span>
<H4 class="docSection2Title"> Comments</H4>
<P>As you can see, very little code is needed to provide a great deal of functionality.</P>
<P>Sometimes when you're using tools such as the Viewer in a tabbed form, the tab pages can become cluttered. If you want to limit the power of the Viewer or make it more streamlined, you can turn off the toolbar and group display by setting DisplayToolbar and DisplayGroupTree to <TT>False</TT> on the CrystalReportViewer.</P>
<ul></ul>
</body></html>
