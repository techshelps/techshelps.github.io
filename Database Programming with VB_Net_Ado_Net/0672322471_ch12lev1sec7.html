<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="12.5 Work with Datasets and XML"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">12.5 Work with Datasets and XML</H3>
<P>Sometimes, I have to pull XML documents into datasets and vice versa. How do I accomplish this using .NET?</P>
<H4 class="docSection2Title"> Technique</H4>
<P>.NET has developed a number of ways to utilize datasets and XML together. The simplest use is pushing data between the two. To do this, you have the two methods belonging to the DataSet object: ReadXML and WriteXML. For both of these methods, you need to provide a filename to read or write the XML document to.</P>
<P>To demonstrate how to take advantage of these methods, I created a form that looks similar to the other How-Tos showing how to write XML documents. However, for this example, I also added another button and data grid that will show the data after reading from the XML document.</P>
<H4 class="docSection2Title"> Steps</H4>
<P>Open and run the Visual Basic .NET-Chapter 12 solution. From the main Web page, click on the hyperlink with the caption How-To 12.5: Working with Datasets and XML. As with How-To 12.1, when the page loads, you can enter a few names. Enter the last and first names, and then click the button labeled Add to DataTable. When you have added a few names, click the button labeled Create XML File. Using Explorer, open the file created in C:\ called test.xml. If you click Read XML File, you will see the same data because it was  read from text.xml (see Figure 12.5).</P>







<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Create a Web Form. Then place the Labels, TextBoxes, Buttons, and DataGrid objects as seen in Figure 12.5 on the form with the properties set as in Table 12.9.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 12.9. Label, TextBox, and Button Control Property Settings</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Last Name</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtLastName</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>First Name</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtFirstName</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnAdd</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Add to DataTable</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnCreateXMLFile</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Create XML File</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataGrid</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dgDataToWrite</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnReadFile</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataGrid</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dgResultsFromXML</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>HyperLink</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>hplReturnToMain</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>NavigateURL</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>wfrmMain.aspx</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P></span></LI><LI><span style="font-weight:normal" value="2"><P>Add the following line to the code module of the form. Then place it under the line that reads Web Form Designer Generated Code.</P>
<pre>
Dim mdtData As New DataTable()
Dim mdsData As New DataSet()
</pre></span></LI><LI><span style="font-weight:normal" value="3"><P>Add the code in Listing 12.11 to the Load event of the page. If the data table has not been saved to the <TT>Session</TT> object, then it is created from scratch by first creating the data columns and then adding them to the data table. The <TT>DataTable</TT> object is then saved to the <TT>Session</TT> object with the name MyDataTable. A <TT>DataSet</TT> object is also created because some of the XML methods must be used from the <TT>DataSet</TT> object, rather than at the DataTable level. If the <TT>Session</TT> objects entry already exists, it is assigned back to the module variable mdtData and mdsData. Last, the data table is bound to the <TT>DataGrid</TT> object by calling the BindTheGrid routine, which is described in the next step.</P>
<H5 class="docExampleTitle">Listing 12.11 <TT>wfrmHowTo12_5.aspx.vb</TT>: Creating a DataTable Object from Scratch</H5>
<PRE>
Private Sub Page_Load(ByVal sender As System.Object, _
            ByVal e As System.EventArgs) Handles MyBase.Load

        'Put user code to initialize the page here
        If (Session("MyDataTable") Is Nothing) Then

            Dim dcFirstName As New DataColumn()

            dcFirstName.ColumnName = "FirstName"
            dcFirstName.Caption = "First Name"

            mdtData.Columns.Add(dcFirstName)

            Dim dcLastName As New DataColumn()

            dcLastName.ColumnName = "LastName"
            dcLastName.Caption = "Last Name"

            mdtData.Columns.Add(dcLastName)
            mdsData.Tables.Add(mdtData)

            Session("MyDataTable") = mdtData
            Session("MyDataSet") = mdsData

        Else
            mdtData = CType(Session("MyDataTable"), DataTable)
        End If

        BindTheGrid()

    End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="4"><P>Create the routine BindTheGrid, shown in Listing 12.12, in the code module for the page.</P>
<H5 class="docExampleTitle">Listing 12.12 <TT>wfrmHowTo12_5.aspx.vb</TT>: Binding the Data Table to the Data Grid</H5>
<PRE>
Sub BindTheGrid()

        dgDataToWrite.DataSource = mdtData
        dgDataToWrite.DataBind()

End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="5"><P>Add the code in Listing 12.13 to the Click event of the btnAdd button. This routine starts off by calling the NewRow method off the mdtData data table, thus creating a new <TT>DataRow</TT> object. The two columns in drNew are replaced with the values in txtLastName and txtFirstName. The new row is added to the data table, and the text boxes are cleared. Last, mdtData is rebound to the data grid by calling BindTheGrid.</P>
<H5 class="docExampleTitle">Listing 12.13 <TT>wfrmHowTo12_5.aspx.vb</TT>: Adding Data to the Data Table and Then Rebinding the Data Grid</H5>
<PRE>
Private Sub btnAdd_Click(ByVal sender As System.Object, _
ByVal e As System.EventArgs) Handles btnAdd.Click

        Dim drNew As DataRow

        drNew = mdtData.NewRow()

        drNew.Item("LastName") = Me.txtLastName.Text
        drNew.Item("FirstName") = Me.txtFirstName.Text

        mdtData.Rows.Add(drNew)

        Me.txtLastName.Text = ""
        Me.txtFirstName.Text = ""

        BindTheGrid()

    End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="6"><P>Add the code in Listing 12.14 to the  event of the btnCreateXMLFile button. After loading the dataset from the <TT>Session</TT> object, the WriteXML method is invoked to save the data into an XML document.</P>
<H5 class="docExampleTitle">Listing 12.14 <TT>wfrmHowTo12_5.aspx.vb</TT>: Creating the XML Document from the Dataset</H5>
<PRE>
Private Sub btnCreateXMLFile_Click(ByVal sender As System.Object, _
                  ByVal e As System.EventArgs) Handles btnCreateXMLFile.Click

        mdsData = CType(Session("MyDataset"), DataSet)
        mdsData.WriteXml("c:\Test.xml")

End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="7"><P>Add the code in Listing 12.14 to the <TT>Click</TT> event of the btnReadFile button. Here,  the code reads the XML document by using the ReadXML method off the <TT>dsXMLData DataSet</TT> object and then binds it to a <TT>DataGrid</TT> object.</P>
<H5 class="docExampleTitle">Listing 12.15 <TT>wfrmHowTo12_5.aspx.vb</TT>: Reading the XML Document Back into the Dataset</H5>
<PRE>
Private Sub btnReadFile_Click(ByVal sender As System.Object, _
                        ByVal e As System.EventArgs) Handles btnReadFile.Click
        Dim dsXMLData As DataSet = New DataSet()

        dsXMLData.ReadXml("c:\Test.xml")

        Me.dgResultsFromXML.DataSource = dsXMLData
        Me.dgResultsFromXML.DataBind()

End Sub
</PRE></span></LI></OL></span>
<CENTER><H5 class="docFigureTitle">Figure 12.5. This XML document  was created using XMLTextWriter.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="303" src="FILES/12fig05.jpg" ALT="graphics/12fig05.jpg"></p>
</CENTER>
<H4 class="docSection2Title"> Comments</H4>
<P>As you can see, for both reading and writing XML document from and to datasets, Microsoft has given us some easy commands to accomplish the task. However, remember that you do have the control over the format of the XML document that you have using the other methods, such as using the DOM.</P>
<img src="FILES/pixel.gif" width="1" height="1" border="0"><ul></ul>
</body></html>
