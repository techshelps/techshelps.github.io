<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="1.7 Put the Finishing Touches on a Data Bound Form"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">1.7 Put the Finishing Touches on a Data Bound Form</H3>
<P>Besides handling the basics, you need to add some finishing touches to a data entry form, such as enabling/disabling controls based on whether you're on a record. This How-To shows you how to use the Enabled properties on controls to give the user more direction when using a Windows form (see Figure 1.12).</P>
<CENTER><H5 class="docFigureTitle">Figure 1.12. You will create this complete form by How-To 1.7, with all the bells and whistles that users expect from a good data entry form.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="282" src="FILES/01fig12.jpg" ALT="graphics/01fig12.jpg"></p>
</CENTER>
<P>Although the majority of the major issues are taken care of for the form you created so far in the chapter, your users become confused about when to push some of the buttons. How do you get the buttons to reflect when the users can click them, and what other finishing touches might help the form?</P>
<H4 class="docSection2Title"> Technique</H4>
<P>An important part of user interfaces is letting the user know when he has access to certain features on the form. In this case, you will see how to do the following:</P>
<UL START=""><LI><P>Toggle the enabled property of the <TT>btnSave</TT>, <TT>btnCancel</TT>, <TT>btnNew</TT>, and <TT>btnDelete</TT> at the appropriate moments, such as when a record is highlighted in the list box.</P>
</LI>
<LI><P>Add a command button to close the form.</P>
</LI>
<LI><P>Add code to the <TT>Closing</TT> event of the form that tests whether you have made changes to the current record, and if so, whether you want to save the changes.</P>
</LI>
</UL>
<P>You can see an example of particular command buttons being enabled based on the current action being performed in the form in Figure 1.13.</P>
<CENTER><H5 class="docFigureTitle">Figure 1.13. This form allows users to access command buttons only when the functionality is available.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="282" src="FILES/01fig13.jpg" ALT="graphics/01fig13.jpg"></p>
</CENTER>
<H4 class="docSection2Title"> Steps</H4>
<P>Continuing on with the form that you have been using, you are going to make the changes just mentioned in the previous bulleted list.</P>



<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Start by modifying two routines already created: <TT>RefreshIndividual</TT> and <TT>ActivateEditing</TT> subroutines. Then check whether a customer has been selected in <TT>lstCustomers</TT>. If not, then the two buttons, btnEdit and btnDelete, are disabled. If a customer hasn't been selected, the two buttons are enabled, and the <TT>dsCustomerIndividual</TT> dataset control is refreshed.</P>
<H5 class="docExampleTitle">Listing 1.19 <TT>frmHowTo1_7.vb</TT>: Toggling the Enabled Property of the btnEdit and btnDelete Buttons</H5>
<PRE>
Private Sub RefreshIndividual()

      '- Clear individual customer dataset
      Me.dsCustomerIndividual.Clear()

      If lstCustomers.SelectedIndex = -1 Then
         btnEdit.Enabled = False
         btnDelete.Enabled = False
      Else
         btnEdit.Enabled = True
         btnDelete.Enabled = True

         Me.odaCustomerIndividual.SelectCommand.Parameters(0).Value =
lstCustomers.SelectedItem(0)

         '- Fill the dataset
         Me.odaCustomerIndividual.Fill(Me.dsCustomerIndividual, "Customers")

      End If
   End Sub
</PRE>
<P>Similarly, you will add code to the <TT>ActivateEditing</TT> subroutine to toggle the <TT>Enable</TT> property of the various command buttons, depending on their purpose. Listing 1.20 shows the entire routine.</P>
<H5 class="docExampleTitle">Listing 1.20 <TT>frmHowTo1_7.vb</TT>: Toggling the <TT>Enabled</TT> Property of <TT>btnEdit</TT> and <TT>btnDelete</TT> Buttons</H5>
<PRE>
Private Sub ActivateEditing(ByVal bEnable As Boolean)

      Dim oCurr As Object

      '- Loop through each of the controls on the form
      For Each oCurr In Me.Controls()

         '- Check to see if the control is a text box
         If TypeOf oCurr Is TextBox And oCurr.Name &lt;&gt; "txtCustLimit" Then

            '- If so, toggle the properties
            If bEnable Then

               oCurr.BorderStyle() = _
                       System.Windows.Forms.BorderStyle.Fixed3D

               oCurr.BackColor() = System.Drawing.Color.White

            Else

               oCurr.BorderStyle() = _
                       System.Windows.Forms.BorderStyle.FixedSingle

               oCurr.BackColor() = Me.BackColor


            End If

            oCurr.Enabled = bEnable

         End If
      Next

      '- Enable/Disable the appropriate buttons
      btnEdit.Enabled = Not bEnable
      btnNew.Enabled = Not bEnable
      btnDelete.Enabled = Not bEnable

      btnCancel.Enabled = bEnable
      btnSave.Enabled = bEnable

      '- Set the focus to the CustomerID text box
      If bEnable Then
         Me.txtCustomerID.Focus()
      End If
   End Sub
</PRE>
<P>The specific lines of code added are shown here:</P>
<pre>
'- Enable/Disable the appropriate buttons
      btnEdit.Enabled = Not bEnable
      btnNew.Enabled = Not bEnable
      btnDelete.Enabled = Not bEnable

      btnCancel.Enabled = bEnable
      btnSave.Enabled = bEnable
</pre>
<P>These buttons are handled as the other buttons are-by taking the opposite value to which <TT>bEnable</TT> is currently set, and using it to toggle the <TT>Enabled</TT> property.</P>
<P>Finally, if the <TT>bEnable</TT> flag is <TT>True</TT>, then focus is moved to the <TT>txtCustomerID</TT> text box using the following lines of code:</P>
<pre>
'- Set the focus to the CustomerID text box
      If bEnable Then
         Me.txtCustomerID.Focus()
      End If
   End Sub
</pre></span></LI><LI><span style="font-weight:normal" value="2"><P>Add a new command button, with the properties <TT>Name</TT> and <TT>Text</TT> set to <TT>btnClose</TT> and <TT>&amp;Close</TT>, respectively. Place the code in Listing 1.21 for the <TT>Click</TT> event.</P>
<H5 class="docExampleTitle">Listing 1.21 <TT>frmHowTo1_7.vb</TT>: Close the Form</H5>
<PRE>
Private Sub btnClose_Click(ByVal sender As System.Object, _
                        ByVal e As System.EventArgs) Handles btnClose.Click

      Me.Close()

   End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="3"><P>Add some code to the <TT>Closing</TT> event of the form. Listing 1.22 tests whether the <TT>btnSave</TT> button is enabled. If it is, the <TT>MessageBox</TT> method is evoked, asking the user if he wants to save changes that were made. If so, then the SaveRecord is called within a <TT>Try...Catch...End Try</TT> block.</P>
<H5 class="docExampleTitle">Listing 1.22 <TT>frmHowTo1_7.vb</TT>: Checking Whether the User Wants to Save a Record Before Closing</H5>
<PRE>
Private Sub frmHowTo1_7_Closing(ByVal sender As Object, _
        ByVal e As System.ComponentModel.CancelEventArgs) Handles MyBase.Closing

        '- If an edit or add has been requested, enabling the Save button,
        '   then prompt to save the record

        If btnSave.Enabled Then

            If MessageBox.Show("Would you like to save the current record?", _
                                 "Save Record?", MessageBoxButtons.YesNo) = _
                                                       DialogResult.Yes Then
                Try

                    '- Save the information
                    SaveRecord()

                Catch saveException As Exception

                    If MessageBox.Show("The following error has occurred: " &amp;
                      saveException.Message &amp; vbCrLf &amp; vbCrLf &amp; _
                      "Continue with closing the form?", "Error Saving Record",
                                    MessageBoxButtons.YesNo) = DialogResult.No Then
                        e.Cancel = True
                    End If


                End Try
            End If
        End If

    End Sub
</PRE></span></LI></OL></span>
<H4 class="docSection2Title"> How It Works</H4>
<P>In the modifications made to the form in this How-To, many things happen depending on what is occurring. When the user clicks the <TT>btnEdi</TT>t button, <TT>btnEdit</TT>, <TT>btnNew</TT>, and <TT>btnDelete</TT> are disabled, and <TT>btnCancel</TT> and <TT>btnSave</TT> are enabled. The opposite is true when <TT>btnCancel</TT> and <TT>btnSave</TT> are pressed. If <TT>bEnable</TT> is <TT>True</TT>, then the focus is moved to the <TT>txtCustomerID</TT> text box.</P>
<P>When the <TT>txtClosed</TT> button is clicked, the application then checks whether the <TT>btnSave</TT> command button has been enabled, meaning data is being edited. If so, then the user is asked whether he wants to save the current record. If the user does, the system then saves the current information back to the server.</P>
<H4 class="docSection2Title"> Comments</H4>
<P>The tasks displayed in this How-To are just a few of the tasks you can do to make your forms look and feel more professional. They are also what users come to expect from database applications.</P>
<P>Play with the form a bit more. You're sure to come up with a few more ideas.</P>
<img src="FILES/pixel.gif" width="1" height="1" border="0"><ul></ul>
</body></html>
