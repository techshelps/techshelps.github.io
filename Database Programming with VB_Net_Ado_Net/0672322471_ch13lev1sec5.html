<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="13.4 Pass a Dataset Back from an XML Web Service"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">13.4 Pass a Dataset Back from an XML Web Service</H3>
<P>I want to be able to get more data than just a single value. How do I retrieve a whole dataset from a Web Service?</P>
<H4 class="docSection2Title"> Technique</H4>
<P>When you need to pass back a record or multiple records from a Web Service, you have to pass it back as a <TT>DataSet</TT> object, rather than a <TT>DataTable</TT> object.</P>
<P>For this How-To, you will pass back the record of the user who is requested. Before returning the record, however, the code removes the Password column. You don't particularly want that information going out over the Net(see Listing 13.4).</P>
<H5 class="docExampleTitle">Listing 13.4 <TT>SecurityServices.asmx.vb</TT>: Passing Back a DataSet Object</H5>
<PRE>
&lt;WebMethod()&gt; Public Function GetUserInfo(ByVal strUserID As String) As DataSet

        Dim ocnn As New OleDb.OleDbConnection("Provider=Microsoft.Jet.OLEDB.4.0;" &amp;
_
          "Data
  Source=E:\InetPub\wwwroot\SecurityWebService\WebServiceSecurity.MDB")
       Dim odaUsers As New _
  OleDb.OleDbDataAdapter("Select * from tblUsers Where UserID = '" &amp;
                   strUserID &amp; "'", ocnn)

       Dim dsUsers As New DataSet()

       odaUsers.Fill(dsUsers)

       '-- remove the password column
       dsUsers.Tables(0).Columns.Remove("Password")

       Return dsUsers

End Function
</PRE>
<div class="docNote"><p class="docNoteTitle">Note</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/note_icon.gif" ALT="graphics/note_icon.gif"></td>
<td valign="top"><P>Although you could limit the SELECT string to only return the necessary columns, and not have to delete the Password column, there are two reasons for coding it the way it was done. 1. It shows how to delete columns from a data table. 2. If the goal is to include all the columns in the table and accept the Password column, then when other columns are added, you will not have to touch the code because the * is being used.</P>
</td>
</tr></table></p>
</div><br>
<div class="docNote"><p class="docNoteTitle">Tip</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/tip_icon.gif" ALT="graphics/tip_icon.gif"></td>
<td valign="top"><P>When referring to tables on the receiving end, as displayed in step 2 of this How-To, you have to refer to tables in the dataset by their ordinal values. Therefore, some information in the description of the Web Service method about the dataset might be warranted.</P>
</td>
</tr></table></p>
</div><br>
<H4 class="docSection2Title"> Steps</H4>
<P>To preview this How-To, open the solution called Visual Basic .NET-Chapter 13, found in this chapter's folder. On the main form, click on the button labeled How-To 13.4. The form for How-To 13.4 then opens. If you type <TT>FSBarker</TT> for the User and <TT>Test</TT> for the Password, you can see the user's information listed in the <TT>DataGrid</TT> object (see Figure 13.14). Otherwise, a message box appears saying that you cannot see the data.</P>



<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Open the SecurityWebServices Web Service project you created in How-To 13.2. Add the code from Listing 13.4 in the "Technique" section to create the <TT>GetUserInfo</TT> method. Test the new <TT>Web</TT> method. When you do so, you will see some XML, as shown here in Listing 13.5.</P>
<H5 class="docExampleTitle">Listing 13.5 Dataset Sent Back as XML</H5>
<PRE>
&lt;?xml version="1.0" encoding="utf-8" ?&gt;
- &lt;DataSet xmlns="http://appsplus.com/webservices/"&gt;
- &lt;xs:schema id="NewDataSet" xmlns=""
xmlns:xs="http://www.w3.org/2001/XMLSchema"
xmlns:msdata="urn:schemas-microsoft-com:xml-msdata"&gt;
- &lt;xs:element name="NewDataSet" msdata:IsDataSet="true"&gt;
- &lt;xs:complexType&gt;
- &lt;xs:choice maxOccurs="unbounded"&gt;
- &lt;xs:element name="Table"&gt;
- &lt;xs:complexType&gt;
- &lt;xs:sequence&gt;
  &lt;xs:element name="UserID" type="xs:string" minOccurs="0" /&gt;
  &lt;xs:element name="UserName" type="xs:string" minOccurs="0" /&gt;
  &lt;xs:element name="SecurityTier" type="xs:string" minOccurs="0" /&gt;
  &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;
  &lt;/xs:choice&gt;
  &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;
  &lt;/xs:schema&gt;
- &lt;diffgr:diffgram
xmlns:msdata="urn:schemas-microsoft-com:xml-msdata"
xmlns:diffgr="urn:schemas-microsoft-com:xml-diffgram-v1"&gt;
- &lt;NewDataSet xmlns=""&gt;
- &lt;Table diffgr:id="Table1" msdata:rowOrder="0"&gt;
  &lt;UserID&gt;FSBarker&lt;/UserID&gt;
  &lt;UserName&gt;F. Scott Barker&lt;/UserName&gt;
  &lt;SecurityTier&gt;3&lt;/SecurityTier&gt;
  &lt;/Table&gt;
  &lt;/NewDataSet&gt;
  &lt;/diffgr:diffgram&gt;
  &lt;/DataSet&gt;
</PRE></span></LI><LI><span style="font-weight:normal" value="2"><P>Open the Windows Project where you created the Login windows Form. Create a new Windows Form and place the controls shown in Table 13.2 in the order displayed in Figure 13.14.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 13.2. Label, TextBox, DataGrid, and Command Button Control Property Settings</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>User</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtUser</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Password</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox </TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtPassword</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataGrid</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dgUserInfo</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnLogin</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P></span></LI><LI><span style="font-weight:normal" value="3"><P>Add the code in Listing 13.6 to the Click event of btnLogin. This code once again checks the username and password by calling the TestUserMethod of the Web Service. If the username and password check out, then the <TT>GetUserInfo</TT> method is called, passing the username once again. The first table from the returned dataset is assigned to the <TT>DataSource</TT> property of dgUsers.</P>
<H5 class="docExampleTitle">Listing 13.6 <TT>frmHowTo13_4.vb</TT>: Retrieving a Dataset from a Web Service</H5>
<PRE>
Private Sub btnLogin_Click(ByVal sender As System.Object,
            ByVal e As System.EventArgs) Handles btnLogin.Click
        Dim wsSec As localhost.SecurityServices

        wsSec = New localhost.SecurityServices()

        If wsSec.TestUserPassword(Me.txtUser.Text, Me.txtPassword.Text) Then
            dgUserInfo.DataSource = wsSec.GetUserInfo(Me.txtUser.Text).Tables(0)
        Else
            MessageBox.Show("No information may be presented.")
        End If

End Sub
</PRE></span></LI></OL></span>
<CENTER><H5 class="docFigureTitle">Figure 13.14. The information in the data grid was retrieved from a Web Service.</H5><p><IMG BORDER="0" WIDTH="416" HEIGHT="248" src="FILES/13fig14.jpg" ALT="graphics/13fig14.jpg"></p>
</CENTER>
<H4 class="docSection2Title"> Comments</H4>
<P>You can use Web Services in literally thousands of ways. This chapter just covers a couple, but it should be enough to start you down the path of using them productively.</P>
<img src="FILES/pixel.gif" width="1" height="1" border="0"><ul></ul>
</body></html>
