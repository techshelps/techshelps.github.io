<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="1.2 Limit the Data Displayed in a Bound List Box"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">1.2 Limit the Data Displayed in a Bound List Box</H3>
<P>Even populating a list box with a couple of columns from a table full of data can be a big performance hit. This How-To shows you how to create a parameterized SQL statement to limit the items that are displayed in the list box, thus giving you better performance on your forms.</P>
<P>You have hundreds of thousands of customers in your database, and you don't want the list box loaded up with the whole customer table. How can you limit the data that is displayed in your list box?</P>
<H4 class="docSection2Title"> Technique</H4>
<P>You are going to make a copy of the form that you created in How-To 1.1. You will then add a Label and <TT>TextBox</TT> control that the <TT>Select</TT> statement contained within the <TT>OleDbDataAdapter</TT> control will query against to limit the data displayed in the list box. A command button will be added to allow you to call the Fill method of the <TT>OleDbDataAdapter</TT> control whenever you update the text box, and then you can click the command button (see Figure 1.6).</P>
<CENTER><H5 class="docFigureTitle">Figure 1.6. You can now limit the amount of data loaded into the list box.</H5><p><IMG BORDER="0" WIDTH="352" HEIGHT="272" src="FILES/01fig06.jpg" ALT="graphics/01fig06.jpg"></p>
</CENTER>
<H4 class="docSection2Title"> Steps</H4>
<P>To get started with this How-To, right-click the form you created in How-To 1.1, which should be listed in the Solutions Explorer. Choose Copy from the pop-up menu. Next, right-click the project in the Solution Explorer, and choose Paste from the pop-up menu. You will now have a new Class object in the Solutions Explorer called Copy Of <span class="docEmphasis">whatever the previous name of the form was</span>. Rename the new form that you have created to the name you desire. Then, with that form highlighted, click on the Code button above the Solutions Explorer. Change the first line of code to say this:</P>
<pre>
Public Class &lt;Name of the new form&gt;
</pre>
<P>You see, VS does not change the line of code automatically for you. It thinks you have a duplicate Class definition.</P>
<P>Now you can see that the icon of the form is correct. You can continue with the steps of the How-To.</P>




<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Select the Data Adapter that you created. In the Properties pane, you will see the <TT>CommandText</TT> property when you click on the <TT>SelectCommand</TT> property plus sign. Replace the <TT>CommandText</TT> property with the following command:</P>
<pre>
SELECT CustomerID, CompanyName FROM Customers WHERE (CompanyName LIKE ? + '%')
</pre>
<P>You will learn more about the Select statement in Chapter 3. However, the <TT>WHERE</TT> clause used here compares CompanyName to a parameter that will be supplied, as indicated by the ?. This will be performed using code in the final step of this How-To. The % is a wildcard that tells the server to make it a fuzzy search.</P></span></LI><LI><span style="font-weight:normal" value="2"><P>Resize the <TT>ListBox</TT> control, and leave room at the top of the form for the Label, TextBox, and Command button. Create these three controls, setting the properties described in Table 1.3.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 1.3. Label, TextBox, and Command Button Control Property Settings</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Customer</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtCustLimit</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>A</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Command Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnLoadList</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Load List</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P></span></LI><LI><span style="font-weight:normal" value="3"><P>Double-click the new command button you just created called <TT>btnLoadList</TT>. Enter the code in Listing 1.2 in the Click event of the <TT>btnLoadList</TT> button. This code loads the data entered from <TT>txtCustLimit</TT> into the parameter of the <TT>OleDBDataAdapter1</TT>, which was created by using the <TT>?</TT> in the <TT>Select</TT> statement of the data adapter. Then <TT>Dataset1</TT> is cleared of its data with the <TT>Clear</TT> method. Finally, DataSet1 is refilled with data based off the value in <TT>txtCustLimit</TT>, using the data adapter.</P>
<H5 class="docExampleTitle">Listing 1.2 <TT>frmHowTo1_2.vb</TT>: Submitting a Parameter to a <TT>DataAdapter</TT> and Filling the <TT>Dataset</TT></H5>
<PRE>
Private Sub btnLoadList_Click(ByVal sender As System.Object, _
               ByVal e As System.EventArgs) Handles btnLoadList.Click

      Me.OleDbDataAdapter1.SelectCommand.Parameters(0).Value = _
                                              Me.txtCustLimit.Text
      Me.DataSet1.Clear()

      Me.OleDbDataAdapter1.Fill(Me.DataSet1)

   End Sub
</PRE>
<div class="docNote"><p class="docNoteTitle">Note</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/note_icon.gif" ALT="graphics/note_icon.gif"></td>
<td valign="top"><P>There is one big difference here between an <TT>OleDbDataAdapter</TT> and a <TT>SqlDataAdapter</TT>. Whereas the <TT>OleDbDataAdapter</TT> takes a <TT>?</TT> to specify a parameter within the <TT>Select</TT> statement, the <TT>SqlDataAdapter</TT> requires a named parameter such as <TT>@parCustLimit</TT>. Therefore, instead of the select statement in step 1 being this:</P>
<pre>
SELECT CustomerID, CompanyName FROM Customers WHERE (CompanyName LIKE ? + '%')

It would be this:

SELECT CustomerID, CompanyName FROM Customers WHERE (CompanyName LIKE @parCustLimit + '%')
</pre><P>The naming of the actual parameter is up to you.</P>
</td>
</tr></table></p>
</div></span></LI><LI><span style="font-weight:normal" value="4"><P>Highlight and delete the Load event for the form because you don't want to just fill the event when the form loads. You want the user to click <TT>btnLoadList</TT>.</P></span></LI></OL></span>
<H4 class="docSection2Title"> How It Works</H4>
<P>When the form you created for this How-To loads, or when you're using the form called <TT>frmHowTo1_2</TT>, you will see a blank ListBox control with a text box on top with the letter <span class="docEmphasis">A</span> in it. If you click the command button called <TT>btnLoadList</TT>, the list box becomes filled with values based on the letter (or letters) in <TT>txtCustLimit</TT> and on the code described in step 3.</P>
<H4 class="docSection2Title"> Comments</H4>
<P>Try entering a few other letters, and then try entering no letters. What happens? You limit the list more by the number of letters you enter, and you get all entries when you don't enter any letters.</P>
<P>The method displayed here, although simple, is powerful, and it can be used in a variety of ways.</P>
<P>You can continue building on this form for the next few How-Tos. If you want to copy your form and start a new one as described at the beginning of the steps for this one, you have the instructions there. Otherwise, by the time you reach How-To 1.8, you will have a data entry form that you can use. Each step, however, is available in the sample solution for this chapter.</P>
<img src="FILES/pixel.gif" width="1" height="1" border="0"><ul></ul>
</body></html>
