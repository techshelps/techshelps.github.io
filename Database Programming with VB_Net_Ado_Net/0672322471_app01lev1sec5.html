<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="Working with the ADO 'Recordset' Object"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title"> Working with the ADO <TT>Recordset</TT> Object</H3>
<P>The central object in the ADODB object model is the <TT>Recordset</TT> object. You will be using this object when you want to manipulate records one at a time or bring back a set of records with which to work. With ADO, when you declare the type of variable you are going to use, you can instantiate it at the same time with the New keyword.</P>
<H4 class="docSection2Title"> Displaying Records by Using <TT>GetString</TT></H4>
<P>For debugging purposes, you can also dump the whole recordset into a string variable for display. Listing A.4 shows you how to do this.</P>
<H5 class="docExampleTitle">Listing A.4 <TT>basRecordsetExamples.vb</TT>: Opening and Retrieving a Recordset for Display</H5>
<PRE>
Sub OpenRecordsetWithGetStringDisplayExample(ByVal txtResults As TextBox)

        Dim cnn As New ADODB.Connection()
        Dim rstCurr As New ADODB.Recordset()

        OpenNorthwindADOConnection(cnn)

        rstCurr.Open("Select * from Orders where OrderDate = '06/12/97'", cnn,
                                ADODB.CursorTypeEnum.adOpenForwardOnly)

        txtResults.Text = rstCurr.GetString

        rstCurr.Close()

    End Sub
</PRE>
<P>Using the <TT>OpenNorthwindADOConnection</TT> subroutine listing in Listing A.3, a connection object is referenced, and that is passed to the <TT>Open</TT> method of a <TT>Recordset</TT> object.</P>
<div class="docNote"><p class="docNoteTitle">Tip</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/tip_icon.gif" ALT="graphics/tip_icon.gif"></td>
<td valign="top"><P>Notice that the cursor type returned will be <TT>ADODB.CursorTypeEnum.adOpenForwardOnly</TT>. Because all that is happening is the data being dumped to a string, using this cursor type makes sense. This will give you the best performance. Some other choices include <TT>adOpenDynamic</TT>, <TT>adOpenKeyset</TT>, <TT>adOpenStatic</TT>, and <TT>adOpenUnspecified</TT>.</P>
</td>
</tr></table></p>
</div><br>
<P>You can run this example by clicking on the button labeled Open a Recordset with <TT>GetString</TT> Display on the main form. Figure A.5 shows what you will see.</P>
<CENTER><H5 class="docFigureTitle">Figure A.5. The <TT>GetString</TT> method is handy for checking out data.</H5><p><IMG BORDER="0" WIDTH="480" HEIGHT="384" src="FILES/afig05.jpg" ALT="graphics/afig05.jpg"></p>
</CENTER>
<H4 class="docSection2Title"> Editing and Updating Records</H4>
<P>You can use several methods to perform editing and updating of records in code.</P>
<P>Unlike the last section in which you could open the recordset as a Forward Only type cursor, you will want to open it as a Dynamic type cursor. You can see this in Listing A.5.</P>
<H5 class="docExampleTitle">Listing A.5 <TT>basRecordsetExamples.vb</TT>: Opening and Retrieving a Recordset for Display</H5>
<PRE>
Sub OpenRecordsetWithEditingExample(ByVal txtResults As TextBox)

    Dim cnn As New ADODB.Connection()
    Dim rstCurr As New ADODB.Recordset()
    Dim fldCurr As ADODB.Field
    Dim strTemp As String

    OpenNorthwindADOConnection(cnn)


    rstCurr.Open("Select * from Orders where OrderDate = '06/12/97'", cnn,
                            ADODB.CursorTypeEnum.adOpenDynamic, _
                            ADODB.LockTypeEnum.adLockOptimistic)

    With rstCurr

        Do Until .EOF

            strTemp = strTemp &amp; " Old Field Value: " &amp; _
                       .Fields("ShippedDate").Value

            '-- Updating the release date
            .Fields("ShippedDate").Value = DateAdd(DateInterval.Day, 5, _
                       .Fields("ShippedDate").Value)

            .Update()

            strTemp = strTemp &amp; " New Field Value: " &amp; _
                       .Fields("ShippedDate").Value &amp; vbCrLf

            .MoveNext()

        Loop

    End With

    txtResults.Text = strTemp

    rstCurr.Close()

End Sub
</PRE>
<P>You can see that the <TT>Update</TT> method is used after assigning the value that you want to the field you specify. You could have specified other fields to be updated as well.</P>
<div class="docNote"><p class="docNoteTitle">Note</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/note_icon.gif" ALT="graphics/note_icon.gif"></td>
<td valign="top"><P>Notice that when updating individual fields in the recordset, the <TT>Value</TT> property is specified to be updated. You didn't have to do this in VB 6.0 or VBA, but .NET doesn't allow for default properties, which the <TT>Value</TT> property is.</P>
</td>
</tr></table></p>
</div><br>
<P>You don't have to explicitly use an <TT>Edit</TT> method; in fact, you won't find one like you could in previous editions. To add a new record, you must use the <TT>AddNew</TT> method before updating field values. To delete a record, you use the <TT>Delete</TT> method.</P>
<P>One last thing to discuss about recordsets is how to <span class="docEmphasis">persist</span>, or save a recordset to disk.</P>
<H4 class="docSection2Title"> Persisting a Recordset</H4>
<P>This example will open up two recordsets: one from the Orders table, and one from a file created from the Orders table called OrdersForDate.rst.</P>
<P>The code, shown in Listing A.6, opens the Orders table for a specific date and uses the <TT>GetString</TT> method to stash the contents to the results text box. The routine then saves that recordset using the Save method, and passes the <TT>adPersistADTG</TT> format enumerator. You could save the recordset as XML by using <TT>adPersistXML</TT>. The code opens the file into a recordset and prints it by saving it to the results TextBox control.</P>
<H5 class="docExampleTitle">Listing A.6 <TT>basRecordsetExamples.vb</TT>: Persisting a Recordset to Disk</H5>
<PRE>
Sub PersistingARecordset(ByVal txtResults As TextBox)

       Dim cnn As New ADODB.Connection()
       Dim rstOrig As New ADODB.Recordset()
       Dim rstPersist As New ADODB.Recordset()
       Const adCmdFile As Long = 256

       OpenNorthwindADOConnection(cnn)

       '--  Open forward only and readonly since we are just saving it to disk.
       rstOrig.Open("Select * from Orders where OrderDate = '06/12/97'", cnn,
                               ADODB.CursorTypeEnum.adOpenStatic)

       txtResults.Text = "Original Records : " &amp; vbCrLf &amp; rstOrig.GetString

       '-- Delete any existing old copies.
       '  If you don't, you will get an error.
       On Error Resume Next
       Kill("OrdersForDate.rst")

       '-- Create the persistent recordset in the applications directory
       On Error GoTo 0
       rstOrig.Save("OrdersForDate.rst", ADODB.PersistFormatEnum.adPersistADTG)

       cnn = Nothing
       rstOrig = Nothing

      ' Open the persisted recordset
      rstPersist.Open("OrdersForDate.rst", Options:=adCmdFile)

       txtResults.Text = txtResults.Text &amp; vbCrLf &amp; vbCrLf &amp; _
           "Persisted File : " &amp; vbCrLf &amp; rstPersist.GetString

        rstPersist.Close()

    End Sub
</PRE>
<P>That's all there is to it. You will find that you can do most other things with recordsets using VB .NET that you have been able to do in other languages. Now take a look at another common task that you must do if you are using ADO with Visual Basic .NET: calling stored procedures.</P>
<img src="FILES/pixel.gif" width="1" height="1" border="0"><ul></ul>
</body></html>
