<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="13.2 Create a Simple XML Web Service Using Parameters"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">13.2 Create a Simple XML Web Service Using Parameters</H3>
<P>I have seen how to create a Web Service using the sample that Microsoft provides. This was instructive but not very useful. How do I create a Web Service that uses parameters?</P>
<H4 class="docSection2Title"> Technique</H4>
<P>For this How-To, you are going to create the start of a security Web Service. This security Web Service is going to take in two parameters: Login Name and Password. It will then check against a table that you will create of names, passwords, and security levels.</P>
<P>The method you will create first will then pass back <TT>True</TT> or <TT>False</TT> if the name and password are found.</P>
<H5 class="docSection3Title"> Looking at the Security Table</H5>
<P>The security table is included in the Web Service's Web folder. It is called <TT>WebServiceSecurity.MDB</TT> and is, in fact, a jet database. You can see the table created, <TT>tblUsers</TT>, in Figure 13.8.</P>
<CENTER><H5 class="docFigureTitle">Figure 13.8. Using the tblUsers, you can look up usernames and passwords</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="375" src="FILES/13fig08.jpg" ALT="graphics/13fig08.jpg"></p>
</CENTER>
<P>The method created for this first real example will take in the username and password and then look up the username. If the username is found, the method will then compare the password. If the password matches, then <TT>True</TT> will be returned from the method. Otherwise, <TT>False</TT> will be returned.</P>
<H5 class="docSection3Title"> Passing Parameters</H5>
<P>You will pass parameters to Web Service methods just as you would to any other methods or functions, as shown in the function header for the Web Service method created in this How-To:</P>
<pre>
Public Function TestUser(ByVal strUserID As String, ByVal strPassword As String) As 
<IMG BORDER="0" ALIGN="left" WIDTH="18" HEIGHT="11" src="FILES/ccc.gif" ALT="graphics/ccc.gif">Boolean
</pre>
<P>The return value is also assigned to the name of the function.</P>
<H5 class="docSection3Title"> Specifying Descriptions for the Web Service and Methods</H5>
<P>You can help developers who use your Web Service by adding descriptions to the Web Service and each of the methods you create. This cuts down on the number of support requests you get, and is a good habit to get into. For the Web Service, you will place it in the WebService header, where you will want to specify your own namespace as well:</P>
<pre>
&lt;WebService(Namespace:="http://appsplus.com/webservices/", _
            Description:="Testing of security routines.")&gt; _
            Public Class SecurityServices_
</pre>
<P>This causes the description specified to be displayed as the first line on the main test page.</P>
<P>For the method, you will include the description in the Web Method header:</P>
<pre>
&lt;WebMethod(Description:="This method takes a user ID and Password " &amp; _
       "and returns True or False based on if the User and Password exist.")&gt;
       Public Function TestUserPassword(ByVal strUserID As String, _
                            ByVal strPassWord As String) As Boolean
</pre>
<P>You can see what the lines of code look like in the designer in Figure 13.9.</P>
<CENTER><H5 class="docFigureTitle">Figure 13.9. Adding descriptions to the Web Service.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="375" src="FILES/13fig09.jpg" ALT="graphics/13fig09.jpg"></p>
</CENTER>
<P>Now it's time to put it all together.</P>
<H4 class="docSection2Title"> Steps</H4>
<P>Open and run the SecurityWebService solution. From the main test page, click on the link for the method TestUserPassword. You are presented with a page to input the user ID and password (see Figure 13.10.) If you type <TT>FSBarker</TT> for the strUserID and <TT>test</TT> for the strPassword, the value <TT>True</TT> is returned; otherwise, <TT>False</TT> is returned.</P>





<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Create an ASP.NET Web service project, calling it SecurityWebService.</P></span></LI><LI><span style="font-weight:normal" value="2"><P>Highlight the default .asmx file created in the Solution Explorer, renaming it to SecurityServices.asmx.</P></span></LI><LI><span style="font-weight:normal" value="3"><P>Click on the View Code button in the Solution Explorer. Change the WebService at the top of the code to read as follows:</P>
<pre>
&lt;WebService(Namespace:="http://appsplus.com/webservices/", _
            Description:="Testing of security routines.")&gt; _
            Public Class SecurityServices
</pre></span></LI><LI><span style="font-weight:normal" value="4"><P>Add the code in Listing 13.2 to the code of the Web Service. (Double-click on the Web Service to bring up the code.) You could replace the commented out lines that display for the Hello World Web method. This code starts off by specifying the description for the Web Method and then declaring the function header for the method called TestUserPassword. The parameters strUserID and strPassword are passed, and a Boolean type value is returned. The rest of this routine should look somewhat familiar because a DataAdapter object is created, and a DataTable object is filled, based on the username that was passed in.</P>
<P>If a record is not found for the user, then <TT>False</TT> is passed back.</P>
<P>If a record is found and the password matches, then <TT>True</TT> is passed back. If the password for the user does not match, then <TT>False</TT> is passed back.</P>
<H5 class="docExampleTitle">Listing 13.2 <TT>SecurityServices.asmx.vb</TT>: Web Method to Validate Username and Password</H5>
<PRE>
&lt;WebMethod(Description:="This method takes a user ID and Password " &amp; _
       "and returns True or False based on if the User and Password exist.")&gt;
Public Function TestUserPassword(ByVal strUserID As String, _
                            ByVal strPassword As String) As Boolean

        Dim ocnn As New _
                OleDb.OleDbConnection("Provider=Microsoft.Jet.OLEDB.4.0;" &amp; _
                "Data Source=E:\InetPub\wwwroot\SecurityWebService\" &amp; _
          "WebServiceSecurity.MDB")
        Dim odaUsers As New _
                OleDb.OleDbDataAdapter("Select * from tblUsers " &amp; _
"Where UserID = '" &amp;strUserID &amp; "'", ocnn)

        Dim dtUsers As New DataTable()

        odaUsers.Fill(dtUsers)

        If dtUsers.Rows.Count = 0 Then
            TestUserPassword = False
        ElseIf dtUsers.Rows(0).Item("Password") = strPassword Then
            TestUserPassword = True
        Else
            TestUserPassword = False
        End If

End Function
</PRE>
<div class="docNote"><p class="docNoteTitle">Note</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/note_icon.gif" ALT="graphics/note_icon.gif"></td>
<td valign="top"><P>If you have a problem with sharing rights on the database, you might want to include "Mode=Share Deny None;" in your connection string.</P>
</td>
</tr></table></p>
</div></span></LI><LI><span style="font-weight:normal" value="5"><P>Press the Start button on the toolbar to test the service.</P></span></LI></OL></span>
<CENTER><H5 class="docFigureTitle">Figure 13.10. Testing a simple security Web Service.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="375" src="FILES/13fig10.jpg" ALT="graphics/13fig10.jpg"></p>
</CENTER>
<H4 class="docSection2Title"> Comments</H4>
<P>When you are working in code for your Web Service, you can perform the majority of tasks, including ADO.NET, that you can in ASP.NET, except for those depending on a user interface (UI).</P>
<P>You have now seen how to specify parameters. Now check out the next How-To to see how to consume, or use, your Web Service in an application.</P>
<ul></ul>
</body></html>
