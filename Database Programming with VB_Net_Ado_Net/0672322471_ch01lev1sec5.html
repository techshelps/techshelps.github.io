<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="1.5 Add and Delete Records Using Bound Controls"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">1.5 Add and Delete Records Using Bound Controls</H3>
<P>Besides editing data, adding new records and deleting records in a table are obviously important features. This How-To shows you just that, taking advantage of the <TT>BinderContext</TT> class.</P>
<P>Besides being able to edit current records that already exist, users need to be able to add and delete records as well. How do you add and delete records using bound controls?</P>
<H4 class="docSection2Title"> Technique</H4>
<P>To create the Add New Record feature, you will add a button called <TT>btnAddNew</TT> that has code behind it. You will use the <TT>BindingContext</TT> object again to add a new record by using the <TT>AddNew</TT> method. A module variable will be added to the form to keep track of whether a record is being added or edited. If a new record is being added, then when the update is performed, the application needs to reload the data in the list box in case the new record's <TT>CompanyName</TT> data falls into the chosen list limit that is specified in the <TT>txtCustLimit</TT> text box.</P>
<P>To create the Delete Record feature, you will add a button called <TT>btnDelete</TT>. This button will have code behind it that will use the RemoveAt method of the <TT>ContextBinding</TT> object to remove the record from the dataset. The data will then be posted back to the server.</P>
<H4 class="docSection2Title"> Steps</H4>
<P>Open the solution for the chapter called "VB .NET How-To Chapter 1," and run the application. From the main form, click on the command button labeled How-To 1.5. Click the Load List button. Click the button labeled New. Enter the text <TT>ALF</TT> for Customer ID and <TT>Alfred's Fried Foods</TT> in the Company Name. Then click the button labeled Save, and see the record you just entered added to the list. After the record has been entered, you can test the delete feature by clicking on the button named Delete. The record goes away, and the list is rebuilt.</P>






<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Add a new command button under <TT>btnEdit</TT>, and then set the Name property to <TT>btnNew</TT> and the Caption property to <TT>&amp;Save</TT>.</P></span></LI><LI><span style="font-weight:normal" value="2"><P>Add a new module-level variable called <TT>mbAddNew</TT>, which is a Boolean variable to keep track of whether you are adding a new record. This variable will be placed outside of your routines, just under the forms code. You can see this in Figure 1.9.</P>
<CENTER><H5 class="docFigureTitle">Figure 1.9. By placing this variable just underneath Windows Form Designer Generated Code and declaring it Private, routines inside the Class can see it, but those outside cannot.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="375" src="FILES/01fig09.jpg" ALT="graphics/01fig09.jpg"></p>
</CENTER>
<div class="docNote"><p class="docNoteTitle">Tip</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/tip_icon.gif" ALT="graphics/tip_icon.gif"></td>
<td valign="top"><P>You can collapse and expand routines that you are working on within modules. This makes it handy when you are working on new routines (which can be expanded) and don't want to mess with old routines (which can be collapsed).</P>
</td>
</tr></table></p>
</div></span></LI><LI><span style="font-weight:normal" value="3"><P>Add the following code to the Click event of the new command button <TT>btnNew</TT>. This code first sets the Boolean variable called <TT>mbAddNew</TT> to <TT>True</TT>. It then uses the AddNew method of the form's BindingContext object to add a new record to the <TT>dsCustomerIndividual</TT> dataset. Finally, the code calls the <TT>ActiveEditing</TT> routine to enable the text boxes.</P>
<H5 class="docExampleTitle">Listing 1.11 <TT>frmHowTo1_5.vb</TT>: Adding a New Record to the <TT>dsCustomerIndividual</TT> Dataset and Toggling Text Boxes</H5>
<PRE>
Private Sub btnNew_Click(ByVal sender As System.Object, _
                   ByVal e As System.EventArgs) Handles btnNew.Click

      mbAddNew = True

      '- Using the BindingContext class add a new record
      Me.BindingContext(Me.dsCustomerIndividual, "Customers").AddNew()

      ActivateEditing(True)

   End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="4"><P>Modify the <TT>Click</TT> event of the btnSave to test whether the <TT>mbAddNew</TT> flag has been set to <TT>True</TT>, meaning that a new record is being added. If <TT>True</TT>, then after saving the record by calling the <TT>SaveRecord</TT> and <TT>ActivateEditing</TT> routines, the <TT>LoadList</TT> and <TT>RefreshIndividual</TT> are called to load the new record's data. Note that the SaveRecord, <TT>ActiveEditing</TT>, and <TT>RefreshIndividual</TT> routines have not changed from How-To 1.4. The <TT>mbAddNew</TT> variable is then set to <TT>False</TT>.</P>
<H5 class="docExampleTitle">Listing 1.12 <TT>frmHowTo1_5.vb</TT>: Saving the Changed Data, Toggling Text Boxes, and Reloading the List Box and First Record in the List</H5>
<PRE>
   Private Sub btnSave_Click(ByVal sender As System.Object,
ByVal e As System.EventArgs) Handles btnSave.Click

      '- Save the information
      SaveRecord()

      '- Disable the text boxes
      ActivateEditing(False)

      If mbAddNew Then
         LoadList()
         RefreshIndividual()
         mbAddNew = False
      End If

   End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="5"><P>Modify the <TT>Click</TT> event for the btnCancel button to reset the <TT>mbAddNew</TT> variable to <TT>False</TT>, as seen in Listing 1.13.</P>
<H5 class="docExampleTitle">Listing 1.13 <TT>frmHowTo1_5.vb</TT>: Canceling the Edit and Resetting the <TT>mbAddNew</TT> Variable</H5>
<PRE>
Private Sub btnCancel_Click(ByVal sender As System.Object, _
ByVal e As System.EventArgs) Handles btnCancel.Click

    '- Use the BindingContext class to cancel the current editing.
    Me.BindingContext(Me.dsCustomerIndividual, "Customers").CancelCurrentEdit()

    ActivateEditing(False)
    mbAddNew = False

  End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="6"><P>Now it is time to add the delete functionality. To do this, add the following code to the <TT>Click</TT> event of the new button called <TT>btnDelete</TT>. The first line of the code you added begins by introducing a new method called <TT>RemoveAt</TT> and a new property called Position, both used with the <TT>BindingContext</TT> object. You will work from the inside out. The <TT>Position</TT> property tracks the current position in the dataset, in this case dsCustomerIndividual. The <TT>RemoveAt</TT> method marks the record that is at the position passed to it for deletion.</P>
<P>Next, the <TT>Update</TT> method of the <TT>odaCustomerIndividual</TT> adapter is used to call the <TT>DELETE</TT> SQL statement command against the dataset, deleting the actual rows in the data set. The <TT>AcceptChanges</TT> method is called to send the changes to the dataset, a delete in this case, back to the server. Finally, the <TT>LoadList</TT>, <TT>RefreshIndividual</TT>, and <TT>ActivateEditing</TT> subroutines are called to refresh the list, refresh the first record in the list for the text boxes, and toggle the text boxes so that the user knows he can't edit them.</P>
<H5 class="docExampleTitle">Listing 1.14 <TT>frmHowTo1_5.vb</TT>: Deleting the Selected Record and Reloading the List Box</H5>
<PRE>
Private Sub btnDelete_Click(ByVal sender As System.Object, _
                  ByVal e As System.EventArgs) Handles btnDelete.Click

      '- Mark the row for deletion using the RemoveAt method of the BindingContext
      Me.BindingContext(Me.dsCustomerIndividual, _
        "Customers").RemoveAt(Me.BindingContext(Me.dsCustomerIndividual,
        "Customers").Position)

      '- Perform the requested task at the dataset
      '   level using the data adapter
      odaCustomerIndividual.Update(dsCustomerIndividual, "Customers")

      '- By accepting the changes, the data gets sent back to the server
      dsCustomerIndividual.AcceptChanges()

      '- Reload the list
      LoadList()

      '- Display the first record
      RefreshIndividual()

      '- Disable the text boxes
      ActivateEditing(False)

   End Sub
</PRE></span></LI></OL></span>
<H4 class="docSection2Title"> How It Works</H4>
<P>When the user clicks the btnNew button, a flag (<TT>mbAddNew</TT>) is set to <TT>True</TT>, the dataset is set for adding a record with the <TT>AddNew</TT> method of the <TT>BindingContext</TT>, and the text boxes are enabled for editing.</P>
<P>If the user then clicks the <TT>btnSave</TT> button, the data is updated to the dataset and then back to the server. If the user clicks the <TT>btnCancel</TT> button, the edits are canceled. In both cases, the mbAddNew variable is set to <TT>False</TT> and the <TT>ActivateEditing</TT> routine is called to disable the text boxes and let the user know that the text boxes are not available for editing. Finally, if the btnSave button was clicked and the <TT>mbAddNew</TT> was set to <TT>True</TT>, the <TT>LoadList</TT> and <TT>RefreshIndividual</TT> routines are called.</P>
<P>When the user clicks the <TT>btnDelete</TT> button, the record is deleted from the recordset and then from the server. The list box is reloaded and the first record in the list is displayed in the text boxes. The text boxes are then disabled.</P>
<H4 class="docSection2Title"> Comments</H4>
<P>Here you have the basic commands needed to create a full-fledged data entry form. You can add, edit, and delete information from the form. This actually takes less code than if you use Visual Basic 6.0.</P>
<P>The <TT>BindingContext</TT> object really goes a long way to helping you work with bound data.</P>
<ul></ul>
</body></html>
