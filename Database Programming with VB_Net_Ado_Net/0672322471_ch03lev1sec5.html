<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="3.3 Locate Records with the DataTable Object"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">3.3 Locate Records with the DataTable Object</H3>
<P>Using the <TT>DataTable</TT> object, you can use another object called the <TT>DataRow</TT> object that allows you to locate a specific row in the data table. This is useful when you want to present your users with a search mechanism for your form. This How-To shows you how to locate a specific row within your data table and how to use the same data table for two different purposes.</P>
<P>After you have your <TT>DataTable</TT> object loaded in memory, you want to be able to locate specific records within the <TT>DataTable</TT> object. How do you locate records in the <TT>DataTable</TT> object?</P>
<H4 class="docSection2Title"> Technique</H4>
<P>For this How-To, you are going to use a <TT>ComboBox</TT> control instead of a ListBox control. You will use the same technique for loading the combo box as you would the list box. The change comes when you select an item from the combo box.</P>
<P>When an item is selected in the combo box, the <TT>SelectedIndexChanged</TT> event is fired off. Within this event, you will take the combo box's <TT>SelectedItem</TT>, which gives the <TT>ValueMember</TT> that is located in the selected row, and use that with the Find method off the <TT>DataTables Rows</TT> collection.</P>
<P>With the data row located, the corresponding columns are loaded into text boxes on the form, as shown in Figure 3.4.</P>
<CENTER><H5 class="docFigureTitle">Figure 3.4. This combo box will point the user to a specific customer.</H5><p><IMG BORDER="0" WIDTH="400" HEIGHT="366" src="FILES/03fig04.jpg" ALT="graphics/03fig04.jpg"></p>
</CENTER>
<H4 class="docSection2Title"> Steps</H4>
<P>Open and run the VB.NET-Chapter 3 solution. From the main form, click on the command button with the caption How-To 3.3. When the form loads, pick a new customer from the list that is presented in the customer <TT>ComboBox</TT> control. You will see the text boxes below the <TT>ComboBox</TT> control display new data that corresponds to the chosen customer.</P>





<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Create a new Windows Form.</P></span></LI><LI><span style="font-weight:normal" value="2"><P>Add some labels, combo boxes, and text boxes, as listed in Table 3.4.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 3.4. Label, TextBox, and ComboBox Control Property Settings</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Label1</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Customer</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>ComboBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>cboCustomers</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT> </P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Label2</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Customer</TT> ID</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT> </P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Label3</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Company Name</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT> </P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Label4</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Address</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT> </P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Label5</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Caption</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>City</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT> </P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtCustomerID</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT> </P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtCompanyName</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT> </P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtAddress</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT> </P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtCity</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P>
<P>You will also want to make sure that the <TT>Text</TT> properties in the <TT>TextBox</TT> controls are blank.</P></span></LI><LI><span style="font-weight:normal" value="3"><P>In the class module for the form, add the following two Private declarations just below the line of code that reads <TT>Windows Form Designer generated code</TT>.</P>
<pre>
Private modaCust As OleDb.OleDbDataAdapter
Private mdtCust As DataTable = New DataTable()
</pre>
<P>These lines of code declare a data adapter and a data table that will be used throughout the form.</P>
<div class="docNote"><p class="docNoteTitle">Note</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/note_icon.gif" ALT="graphics/note_icon.gif"></td>
<td valign="top"><P>Adding the <span class="docEmphasis">m</span> on the front tells you that it is a module- or member-level variable.</P>
<P>Also, remember that although you are declaring this at the form level, the connection that is used for the data adapter is not going to be left open the whole time the form is. When the data table is filled, the connection is opened. Then the data is accessed locally using XML under the covers. It is disconnected from the server.</P>
</td>
</tr></table></p>
</div></span></LI><LI><span style="font-weight:normal" value="4"><P>Add the code shown in Listing 3.4 to the Load event of the form. Almost identical to the code in the last How-To to load a <TT>ListBox</TT> control, this code sets <TT>modaCust</TT> to a SQL String and the connection string to be used. mdtCust is then filled using the <TT>Fill</TT> method of <TT>modaCust</TT>. Next, the first element in the <TT>DataColumn</TT> array called <TT>dc</TT> is set to the CustomerID column. <TT>mdtCustPrimaryKey</TT> is then set to the <TT>DataColumn</TT> array. Last, the <TT>DataSource</TT>, <TT>DisplayMember</TT>, and <TT>ValueMember</TT> properties are set.</P>
<H5 class="docExampleTitle">Listing 3.4 <TT>frmHowTo3_3.vb</TT>: Loading a ComboBox by Using the DataTable Object</H5>
<PRE>
Private Sub frmHowTo3_3_Load(ByVal sender As Object, _
                ByVal e As System.EventArgs) Handles MyBase.Load

        Dim strSQL As String
        Dim dc(1) As DataColumn

        '-- Set up the exception catch
        Try

            '-- Create the data adapter and fill the data table
            modaCust = New _
                  OleDb.OleDbDataAdapter("Select * From Customers", _
(BuildCnnStr("(local)", "Northwind")))
            modaCust.Fill(mdtCust)

            '-- Set up the primary key for the data table
            dc(0) = mdtCust.Columns("CustomerID")
            mdtCust.PrimaryKey = dc

            '-- Bind the data to the combo box
            cboCustomers.DataSource = mdtCust
            cboCustomers.DisplayMember = "CompanyName"
            cboCustomers.ValueMember = "CustomerID"


        Catch oexpData As OleDb.OleDbException
            MsgBox(oexpData.Message)
        End Try

    End Sub
</PRE>
<P>The <TT>PrimaryKey</TT> property that was set will be used in the code for the next step by the Find method of <TT>mdtCust's Rows</TT> collection.</P></span></LI><LI><span style="font-weight:normal" value="5"><P>This last bit of code needs to be added to the <TT>SelectedIndexChanged</TT> event of the <TT>cboCustomers ComboBox</TT> control. As with the last step, when a data column was set up for the PrimaryKey property, in this step an array is specified to pass the <TT>SelectedItem</TT> value to find the <TT>Find</TT> method. The text boxes' Text properties are then set to the column values by using the <TT>ToString</TT> method.</P>
<H5 class="docExampleTitle">Listing 3.5 <TT>frmHowTo3_3.vb</TT>: Locating a Record in the Data Table, and Then Assigning Values to Text Boxes</H5>
<PRE>
Private Sub cboCustomers_SelectedIndexChanged(ByVal sender As System.Object, _
                   ByVal e As System.EventArgs) _
                   Handles cboCustomers.SelectedIndexChanged

        Dim drCurr As DataRow
        Dim aFindValue(0) As Object

        '-- Load the item to look up, and use the find method
        aFindValue(0) = cboCustomers.SelectedItem(0)
        drCurr = mdtCust.Rows.Find(aFindValue)

        '-- Load up the fields on the form
        txtCustomerID.Text = drCurr("CustomerID").ToString
        txtCompanyName.Text = drCurr("CompanyName").ToString
        txtAddress.Text = drCurr("Address").ToString
        txtCity.Text = drCurr("City").ToString

    End Sub
</PRE></span></LI></OL></span>
<H4 class="docSection2Title"> How It Works</H4>
<P>When a user picks a customer from the <TT>cboCustomer ComboBox</TT> control, the code then locates the desired value within the <TT>mdtCust data Table</TT> using the <TT>Find</TT> method off the rows collection. Text boxes are then loaded from the row that is retrieved.</P>
<H4 class="docSection2Title"> Comments</H4>
<P>Locating records within a data table and data row is pretty easy when you're using the methods that are supplied. ADO.NET provides the control you need, not only at the overall hierarchical level, but also at the row and column levels.</P>
<img src="FILES/pixel.gif" width="1" height="1" border="0"><ul></ul>
</body></html>
