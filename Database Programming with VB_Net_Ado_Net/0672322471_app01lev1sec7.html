<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="Executing Batch Updates with ADO and SQL Server"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title"> Executing Batch Updates with ADO and SQL Server</H3>
<P>The biggest difference between this section and the previous one is the fact that in the last section, a recordset being populated using a <TT>Command</TT> object. With the <TT>Command</TT> object, no data was affected. That is one type of use for a <TT>Command</TT> object. What if you want to perform bulk tasks against a recordset? This is the major use for using the <TT>Command</TT> object because you don't necessarily need it for populating a recordset. The <TT>Parameter</TT> object is also not used. It was not necessary for the example, although you would want to use it if criteria were being implemented.</P>
<P>To learn how to perform a bulk operation using ADO in Visual Basic .NET, see this simple Update SQL statement, shown here:</P>
<pre>
Update Orders Set ShippedDate = DeliveryDate+1
</pre>
<P>This statement adds a day to the date in the ShippedDate column for all the records in the Orders table.</P>
<P>This statement is being assigned to the <TT>CommandText</TT> property of the <TT>Command</TT> object instead of to the name of a stored procedure. Another important task is setting the <TT>CommandType</TT> property to be <TT>ADODB.CommandTypeEnum.adCmdText</TT>. This tells ADO that you are performing a bulk operation. Last, the <TT>Execute</TT> method is called from the <TT>Command</TT> object. This routine, called <TT>ExecuteABatchCommand</TT>, can be seen in Listing A.9.</P>
<H5 class="docExampleTitle">Listing A.9 <TT>basCommandExamples.vb</TT>: Creating and Executing a Bulk Query</H5>
<PRE>
Sub ExecuteABatchCommand(ByVal txtResults As TextBox)

        Dim cnn As New ADODB.Connection()
        Dim cmd As New ADODB.Command()
        Dim prm As ADODB.Parameter
        Dim rstOld As New ADODB.Recordset()
        Dim rstNew As New ADODB.Recordset()

        '-- In .NET, we can assign values as we declare variables
        Dim strSQL As String = "Update Orders Set ShippedDate = ShippedDate+1"
        Dim strDispSQL As String = _
                "Select OrderID, ShippedDate From Orders Where OrderID &lt; 10251"

        '-- Open the connection
        OpenNorthwindADOConnection(cnn)

        '-- Open the Orders table and display the ShippedDate as they were.
        rstOld.Open(strDispSQL, cnn)
        txtResults.Text = "Old Values: " &amp; vbCrLf &amp; vbCrLf &amp; rstOld.GetString

        '-- Set up the Command object to use the SQL string.
        cmd.ActiveConnection = cnn
        cmd.CommandText = strSQL
        cmd.CommandType = ADODB.CommandTypeEnum.adCmdText

        '-- Execute the command
        cmd.Execute()

        '-- Reopen the Orders table and redisplay the ShippedDate Field
        rstNew.Open(strDispSQL, cnn)
        txtResults.Text = txtResults.Text &amp; vbCrLf &amp; vbCrLf &amp; "New Values: " &amp;
                                        vbCrLf &amp; vbCrLf &amp; rstNew.GetString

 End Sub
</PRE>
<P>For this example recordset, objects were used merely to display the before and after data, as seen in Figure A.6.</P>
<CENTER><H5 class="docFigureTitle">Figure A.6. Although they're not pretty, you can see the values of the OrderID and DeliveryDate before and after the routine has been executed.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="375" src="FILES/afig06.jpg" ALT="graphics/afig06.jpg"></p>
</CENTER>
<P>You can also use the <TT>Insert</TT> and <TT>Delete</TT> statements to perform other bulk operations with the <TT>Command</TT> object. One of the last tasks that is useful to perform using ADO with SQL Server is to create objects such as tables on-the-fly.</P>
<ul></ul>
</body></html>
