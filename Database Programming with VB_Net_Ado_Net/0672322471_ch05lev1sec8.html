<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="5.6 Display, Sort, and Page Data in the DataGrid Control"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">5.6 Display, Sort, and Page Data in the DataGrid Control</H3>
<P>The Table controls and DataRepeater are fine when I have small sets of data, but the display just keeps repeating and I have to write a bunch of code to change the sort order of the data. How do I create a table-like display that will show a set number of rows at a time and let me sort the data?</P>
<H4 class="docSection2Title"> Technique</H4>
<P>The DataGrid control is by far the most flexible and powerful of the controls used in ASP.NET for displaying data on your Web page. It gives you the ability not only to list data, but also to page through it and sort it nicely with headers, and even to edit data. This last feature will be saved for the next How-To.</P>
<P>To perform the other tasks, you will use a combination of setting properties at design time and programming some events. In particular for the <TT>DataGrid</TT> control, you will add code to events raised by sorting and paging.</P>
<P>This How-To will use the DataGrid bound at design time. You will also see a simple example of using the DataView object for sorting your data.</P>
<H4 class="docSection2Title"> Steps</H4>
<P>Open and run the Visual Basic .NET -Chapter 5 solution. From the main page, click on the hyperlink with the caption How-To 5.6: Display, Sort, and Page Data in the DataGrid Control. You will then see all the territories loaded into a data grid. You can click the column headings, displayed in blue, to sort the columns, and you can click the arrows at the bottom to page through the data. You can see the Web Form in Design mode in Figure 5.8.</P>








<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Create a Web Form. Then place the controls in Table 5.9 and Figure 5.8 with the following properties set.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 5.9. Property Settings for the Controls Used in This How-To</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>OleDbDataAdapter</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>odaTerritory</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>SelectCommand</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>SELECT Territories.TerritoryID, Territories.TerritoryDescription, Region.RegionDescription, Region.RegionID FROM Territories INNER JOIN Region ON Territories.RegionID = Region.RegionID</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataSet</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsTerritory</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataView</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dvTerritory</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Table</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dsTerritory.Territories</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataGrid</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dgTerritory</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>HyperLink</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>hplReturnToMain</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>NavigateURL</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>wfrmMain.aspx</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P></span></LI><LI><span style="font-weight:normal" value="2"><P>Right-click on the DataGrid control and choose Property Builder. You will then see the General tab of the DataGrid Property Builder. Set the properties as displayed in Figure 5.9.</P>
<CENTER><H5 class="docFigureTitle">Figure 5.9. Setting the General properties of the DataGrid control.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="430" src="FILES/05fig09.jpg" ALT="graphics/05fig09.jpg"></p>
</CENTER></span></LI><LI><span style="font-weight:normal" value="3"><P>Click on the Columns tab. You can now add the columns TerritoryID, TerritoryDescription, and RegionDescription by clicking on the field in the available columns and then clicking the Add button for each one. You can then set the Header text for each to be TerritoryID, Territory, and Region respectively, by clicking on the column in the Selected Column list and changing the Header text property. When you are finished and you have the Region highlighted, it should look like Figure 5.10.</P>
<CENTER><H5 class="docFigureTitle">Figure 5.10. Setting the columns for the DataGrid control is easy at design time.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="430" src="FILES/05fig10.jpg" ALT="graphics/05fig10.jpg"></p>
</CENTER>
<div class="docNote"><p class="docNoteTitle">Note</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/note_icon.gif" ALT="graphics/note_icon.gif"></td>
<td valign="top"><P>Be sure to uncheck the Create Columns Automatically at Run Time check box; otherwise, the columns will end up showing up twice-once from you specifying them here at design time, and once when the code generates them.</P>
</td>
</tr></table></p>
</div></span></LI><LI><span style="font-weight:normal" value="4"><P>Click on the Paging tab. Click on the Allow Paging check box, and type <TT>10</TT> for the Page Size (see Figure 5.11.) You can then close the Property Builder dialog box by clicking OK.</P>
<CENTER><H5 class="docFigureTitle">Figure 5.11. Setting the Paging properties at design time for the DataGrid control.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="430" src="FILES/05fig11.jpg" ALT="graphics/05fig11.jpg"></p>
</CENTER></span></LI><LI><span style="font-weight:normal" value="5"><P>Create the <TT>BindTheGrid</TT> routine in Listing 5.19. Note that you are now binding to the <TT>DataView</TT>, rather than to a dataset.</P>
<H5 class="docExampleTitle">Listing 5.19 <TT>wfrmHowTo5_6.aspx.vb</TT>: Binding the Data Grid to the DataView Control</H5>
<PRE>
Sub BindTheGrid()

        odaTerritory.Fill(dsTerritory)
        dgTerritory.DataSource = dvTerritory
        dgTerritory.DataBind()

End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="6"><P>Add the code in Listing 5.20 to the Load event of the page.</P>
<H5 class="docExampleTitle">Listing 5.20 <TT>wfrmHowTo5_6.aspx.vb</TT>: Loading the Page</H5>
<PRE>
Private Sub Page_Load(ByVal sender As System.Object, _
                        ByVal e As System.EventArgs) Handles MyBase.Load

        'Put user code to initialize the page here
        If Not Me.IsPostBack Then

            BindTheGrid()

        End If

End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="7"><P>Add the code in Listing 5.21 to the <TT>PageIndexChanged</TT> event of dgTerritory. This routine takes the <TT>NewPageIndex</TT> and assigns it to the data grid's <TT>CurrentPageIndex</TT>. Next, if MySort exists in the <TT>ViewState</TT> object, it is assigned to the <TT>DataView</TT> control. MySort is stored in the next step.</P>
<H5 class="docExampleTitle">Listing 5.21 <TT>wfrmHowTo5_6.aspx.vb:</TT> Paging the Data Grid</H5>
<PRE>
Private Sub dgTerritory_PageIndexChanged(ByVal source As Object,
        ByVal e As System.Web.UI.WebControls.DataGridPageChangedEventArgs)
        Handles dgTerritory.PageIndexChanged

        '-- Set the current page in the data grid
        Me.dgTerritory.CurrentPageIndex = e.NewPageIndex

        If Not (ViewState("MySort") = Nothing) Then
            dvTerritory.Sort = ViewState("MySort")
        End If

        BindTheGrid()

End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="8"><P>Add the code in Listing 5.22 to the <TT>SortCommand</TT> event of dgTerritory. When a column heading is clicked and sorting is turned on, this event is raised. This routine assigns the <TT>SortExpression</TT> to the Sort property of the dgTerritory. The <TT>SortExpression</TT> property is then stored in the ViewState object for round trips to the server, and then it is used in the code listed in step 6.</P>
<H5 class="docExampleTitle">Listing 5.22 <TT>wfrmHowTo5_6.aspx.vb:</TT> Sorting the Data Grid</H5>
<PRE>
Private Sub dgTerritory_SortCommand(ByVal source As Object,
        ByVal e As System.Web.UI.WebControls.DataGridSortCommandEventArgs)
        Handles dgTerritory.SortCommand

        dvTerritory.Sort = e.SortExpression.ToString

        ViewState("MySort") = e.SortExpression.ToString

        BindTheGrid()

End Sub
</PRE></span></LI></OL></span>
<CENTER><H5 class="docFigureTitle">Figure 5.8. The DataGrid control is a great way to manipulate data.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="375" src="FILES/05fig08.jpg" ALT="graphics/05fig08.jpg"></p>
</CENTER>
<H4 class="docSection2Title"> Comments</H4>
<P>The DataView is a great control for seeing different views of your data by using a single dataset.</P>
<P>As with the DataRepeater, working with some of the basic features in the data grid is pretty easy. It's when you have to start really manipulating data that it gets more difficult, as you will see in the next How-To.</P>
<ul></ul>
</body></html>
