<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="6.6 Create, Modify, and Delete Tables"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">6.6 Create, Modify, and Delete Tables</H3>
<P>It is common in database applications to programmatically create, modify, and delete tables. How do I do this using T-SQL?</P>
<H4 class="docSection2Title"> Technique</H4>
<P>To perform these tasks, you will use the <TT>CREATE TABLE</TT>, <TT>ALTER TABLE</TT>, and <TT>DROP TABLE</TT> T-SQL statements. With these statements, you can handle any requirements that your application might have. Look at these statements one at a time.</P>
<H5 class="docSection3Title"> Creating a Table Using <TT>CREATE TABLE</TT></H5>
<P>With the <TT>CREATE TABLE</TT> statement, not only can you specify columns and their data types, but you also can specify indexes, check constraints, and other table level properties. For this How-To, you will be use the following T-SQL statement:</P>
<pre>
CREATE TABLE ListsExample
(
    ListID smallint IDENTITY(1, 1) PRIMARY KEY CLUSTERED,
    LastName varchar(50) NOT NULL,
    FirstName varchar(50) NOT NULL,
    Age smallint ,
    DateEntered datetime NOT NULL DEFAULT GetDate()
         CHECK (DateEntered &lt;= GetDate())
)
</pre>
<P>This statement shows how to perform a number of different tasks:</P>




<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Specify the name of the table:</P>
<pre>
CREATE TABLE ListsExample
</pre></span></LI><LI><span style="font-weight:normal" value="2"><P>Create an Identity column, which is the primary key:</P>
<pre>
ListID smallint IDENTITY(1, 1) PRIMARY KEY CLUSTERED,
</pre></span></LI><LI><span style="font-weight:normal" value="3"><P>Create fields that can't be NULL, and using different data types:</P>
<pre>
LastName varchar(50) NOT NULL,
FirstName varchar(50) NOT NULL,
Age smallint ,
</pre></span></LI><LI><span style="font-weight:normal" value="4"><P>Create a field with the Default Value set, and with a Check Constraint specified.</P>
<pre>
DateEntered datetime NOT NULL DEFAULT GetDate()
     CHECK (DateEntered &lt;= GetDate())
</pre></span></LI></OL></span>
<H5 class="docSection3Title"> Modifying a Table Using <TT>ALTER TABLE</TT></H5>
<P>The example T-SQL statement used for modifying the table in this How-To is pretty simple in that it adds a column and removes (drops) a column:</P>
<pre>
ALTER TABLE ListsExample ADD MyNewColumn varchar(30)
ALTER TABLE ListsExample DROP COLUMN Age
</pre>
<P>You can perform quite a few other tasks with this statement. You can even see by the syntax displayed here that you can handle many tasks, including dropping constraints.</P>
<pre>
ALTER TABLE <span class="docEmphasis">table</span>
{ [ ALTER COLUMN <span class="docEmphasis">column_name</span>
    { <span class="docEmphasis">new_data_type</span> [ ( <span class="docEmphasis">precision</span> [ , <span class="docEmphasis">scale</span> ] ) ]
        [ COLLATE &lt; collation_name &gt; ]
        [ NULL | NOT NULL ]
        | {ADD | DROP } ROWGUIDCOL }
    ]
    | ADD
        { [ &lt; column_definition &gt; ]
        |  <span class="docEmphasis">column_name</span> AS <span class="docEmphasis">computed_column_expression</span>
        } [ ,...<span class="docEmphasis">n</span> ]
    | [ WITH CHECK | WITH NOCHECK ] ADD
        { &lt; table_constraint &gt; } [ ,...<span class="docEmphasis">n</span> ]
    | DROP
        { [ CONSTRAINT ] <span class="docEmphasis">constraint_name</span>
            | COLUMN <span class="docEmphasis">column</span> } [ ,...<span class="docEmphasis">n</span> ]
    | { CHECK | NOCHECK } CONSTRAINT
        { ALL | <span class="docEmphasis">constraint_name</span> [ ,...<span class="docEmphasis">n</span> ] }
    | { ENABLE | DISABLE } TRIGGER
        { ALL | <span class="docEmphasis">trigger_name</span> [ ,...<span class="docEmphasis">n</span> ] }
}
</pre>
<P>You can do even more. Look at the Books Online for SQL Server to see complete coverage of this statement.</P>
<H5 class="docSection3Title"> Deleting a Table Using the <TT>DROP TABLE</TT> Statement</H5>
<P>This statement is the easiest, and it's a one liner:</P>
<pre>
DROP TABLE ListsExample
</pre>
<P>However, you need to keep some things in mind when you are trying to drop a table:</P>
<UL>
<LI><P>You can't use the <TT>DROP TABLE</TT> statement when the table is used in a relationship and is referenced in the <TT>FOREIGN KEY</TT> constraint. You will need to drop the other table or the constraint.</P></LI>
<LI><P>You will need to be the administrator or owner of the table to be able to use the <TT>DROP TABLE</TT> statement.</P></LI>
<LI><P>You can't use the <TT>DROP TABLE</TT> statement on system tables.</P></LI>
</UL>
<H4 class="docSection2Title"> Steps</H4>
<P>Open and run the Visual Basic .NET-Chapter 6 solution. From the main form, click on the button with the caption How-To 6.6 (see Figure 6.7).</P>





<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Create a Windows Form. Then place the controls listed in Table 6.6 with the following properties set, as displayed in Figures 6.7.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 6.6. Control Property Settings for This How-To</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>SQL Statement to Create a Table</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>lblCreateTable</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnCreateTable</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Create Table</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>SQL Statement to Modify a Table</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>lblModifyTable</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnModifyTable</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Modify Table</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>SQL Statement to Delete a Table</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>lblDeleteTable</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnDeleteTable</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Delete</TT> Table</P>
</TD>
</TR>
</COLGROUP>
</TABLE></P></span></LI><LI><span style="font-weight:normal" value="2"><P>Add the code in Listing 6.11 to the Load event of the form. (Double-click on the form to bring up the code.) This routine creates the SQL statements for all three tasks and assigns them to the appropriate label for display.</P>
<H5 class="docExampleTitle">Listing 6.11 <TT>frmHowTo6_6.vb</TT>: Loading the SQL Statements into the Appropriate Labels</H5>
<PRE>
Private Sub frmHowTo6_6_Load(ByVal sender As System.Object,
                    ByVal e As System.EventArgs) Handles MyBase.Load

        '-- Build the SQL String for Creating a Table
        Dim strSQL As String

        strSQL = "CREATE TABLE ListsExample" &amp; vbCrLf
        strSQL &amp;= "(" &amp; vbCrLf
        strSQL &amp;= "    ListID smallint IDENTITY(1, 1) " &amp; _
          "PRIMARY KEY CLUSTERED," &amp; vbCrLf
        strSQL &amp;= "    LastName varchar(50) NOT NULL, " &amp; vbCrLf
        strSQL &amp;= "    FirstName varchar(50) NOT NULL, " &amp; vbCrLf
        strSQL &amp;= "    Age smallint , " &amp; vbCrLf
        strSQL &amp;= "    DateEntered datetime NOT NULL DEFAULT GetDate() " &amp; vbCrLf
        strSQL &amp;= "         CHECK (DateEntered &lt;= GetDate())" &amp; vbCrLf
        strSQL &amp;= ")"

        Me.lblCreateTable.Text = strSQL

        strSQL = "ALTER TABLE ListsExample ADD MyNewColumn varchar(30) " &amp; vbCrLf
        strSQL &amp;= "ALTER TABLE ListsExample DROP COLUMN Age"

        Me.lblModifyTable.Text = strSQL

        strSQL = "DROP TABLE ListsExample"

        Me.lblDeleteTable.Text = strSQL

End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="3"><P>Add the code in Listing 6.12 to the Click event of the btnCreateTable button. This routine calls the function PerformTask(), passing the text in the lblCreateTable label. PerformTask() is described in the next step. If you perform the task successfully, then a message box is displayed letting you know that all went as it should have.</P>
<H5 class="docExampleTitle">Listing 6.12 <TT>frmHowTo6_6.vb</TT>: Calling <TT>PerformTask()</TT> from the <TT>btnCreateTable</TT> Click Event</H5>
<PRE>
Private Sub btnCreateTable_Click(ByVal sender As System.Object, _
                    ByVal e As System.EventArgs) Handles btnCreateTable.Click

        If PerformTask(Me.lblCreateTable.Text) Then

            MessageBox.Show("Table Created Successfully, " &amp; _
                  _Look for ListsExample " &amp;
                  "Table in Northwind Database in Server Explorer", _
                  "Action Performed")

        End If

End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="4"><P>In the class module of the form created for this How-To, create the code displayed in Listing 6.13 for the <TT>PerformTask()</TT> function. This code creates a <TT>Connection</TT> object. Next, create a <TT>Command</TT> object that is based on the string passed in <TT>strSQL</TT>. Open the connection and execute the command. Notice that the execution of the command has been wrapped in the <TT>Try..Catch..End Try</TT> code block to make sure the command is executed correctly; if it's not, a message is displayed.</P>
<H5 class="docExampleTitle">Listing 6.13 <TT>frmHowTo6_6.vb</TT>: Executing the SQL Statement Passed in Using strSQL</H5>
<PRE>
Function PerformTask(ByVal strSQL As String) As Boolean

        Dim cnn As New OleDb.OleDbConnection(BuildCnnStr("(local)", "Northwind"))
        Dim cmdAction As New OleDb.OleDbCommand(strSQL)

        cmdAction.Connection = cnn

        cnn.Open()

        PerformTask = True

        Try

            cmdAction.ExecuteNonQuery()

        Catch excp As Exception

            MessageBox.Show(excp.Message, "Error with Action")
            PerformTask = False

        End Try

        cnn.Close()

End Function
</PRE></span></LI><LI><span style="font-weight:normal" value="5"><P>Add the code snippets in Listing 6.14 to the appropriate <TT>Click</TT> events for <TT>btnModifyTable</TT> and <TT>btnDeleteTable</TT> to the <TT>Load</TT> event of the form.</P>
<H5 class="docExampleTitle">Listing 6.14 <TT>frmHowTo6_6.vb:</TT> Calling PerformTask from <TT>btnModifyTable</TT> and <TT>btnDeleteTable</TT> Click Events</H5>
<PRE>
Private Sub btnModifyTable_Click(ByVal sender As System.Object,
            ByVal e As System.EventArgs) Handles btnModifyTable.Click

        If PerformTask(Me.lblModifyTable.Text) Then

            MessageBox.Show("Table Modified Successfully, " &amp; _
                  Look for ListsExample " &amp;
                          "Table in Northwind Database in Server Explorer", _
                  "Action Performed")

        End If

End Sub
Private Sub btnDeleteTable_Click(ByVal sender As System.Object, _
            ByVal e As System.EventArgs) Handles btnDeleteTable.Click

        If PerformTask(Me.lblDeleteTable.Text) Then

            MessageBox.Show("Table Deleted Successfully, " &amp; _
                  "Look for ListsExample " &amp;
                          "Table in Northwind Database in Server Explorer", _
                  "Action Performed")

        End If

    End Sub
</PRE></span></LI></OL></span>
<CENTER><H5 class="docFigureTitle">Figure 6.7. A common problem with inner joins is retrieving multiple records when you just want to see one per occurrence.</H5><p><IMG BORDER="0" WIDTH="450" HEIGHT="392" src="FILES/06fig07.jpg" ALT="graphics/06fig07.jpg"></p>
</CENTER>
<H4 class="docSection2Title"> Comments</H4>
<P>You don't have to add, modify, and delete tables manually. Just make sure that you back up your data before performing these tasks.</P>
<ul></ul>
</body></html>
