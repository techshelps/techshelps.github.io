<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="8.2 Use a Single Windows Form to Update Multiple Lookup Tables"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">8.2 Use a Single Windows Form to Update Multiple Lookup Tables</H3>
<P>Just about every database application uses lookup tables of some sort or another, such as categories, regions, and territories in the Northwind database. Normally, each of these lookup tables would get its own form for viewing or updating the information in the tables. This example will provide the means for you to create a single form to maintain any of your simple lookup tables, again using a Windows Form.</P>
<P>You have a number of simple lookup tables in your application, and it is a pain to have to create a form for each table. How do you create a Windows Form that can be used to update most if not all of your lookup tables that are contained in your database?</P>
<H4 class="docSection2Title"> Technique</H4>
<P>Using two main controls, the ListBox control and DataGrid control, you can create a form that will take care of most of your simple lookup tables. When you get into those tables that contain lookups or graphics, you will have to come up with a more complete method to modify the data.</P>
<P>For this example, you will be using some familiar friends: <TT>DataAdapter</TT>, <TT>CommandBuilder</TT>, and <TT>DataTable</TT> objects.</P>
<H4 class="docSection2Title"> Steps</H4>
<P>Open and run the VB.NET -Chapter 8 solution. From the main Windows Form, click on the command button with the caption How-To 8.2. You will then see the form displayed in Figure 8.3.</P>
<CENTER><H5 class="docFigureTitle">Figure 8.3. The DataGrid control is filled with different data every time a new item is chosen in the ListBox control.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="224" src="FILES/08fig03.gif" ALT="graphics/08fig03.gif"></p>
</CENTER>
<P>When you choose a new item from the list of tables on the left, the data grid on the right becomes filled with the data from the chosen table. You can then modify the data in the data grid and click on the Update button to update the data back to the server. This includes modifying existing records, as well as adding and deleting records in the <TT>DataGrid</TT> control.</P>






<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Create a Windows Form. Then place the controls shown in Figure 8.3 with the properties set forth in Table 8.3.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 8.3. Label, ListBox, DataGrid, and Command Button Controls Property Settings</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Label1</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Lookup Table to Edit</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Label2</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Lookup Table Data</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>ListBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>lstLookupTables</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataGrid</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dgTableData</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Name</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnUpdate</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P></span></LI><LI><span style="font-weight:normal" value="2"><P>Add data to the Items collection of lstLookupTables. To do this, click on the builder button beside the Items property in the property sheet for lstLookupTables. You will then see the String Collection Editor as shown in Figure 8.4. The Items you will add include Categories, Region, and Territories.</P>
<CENTER><H5 class="docFigureTitle">Figure 8.4. Adding hard-coded items at design is pretty straightforward using this dialog box.</H5><p><IMG BORDER="0" WIDTH="437" HEIGHT="382" src="FILES/08fig04.gif" ALT="graphics/08fig04.gif"></p>
</CENTER>
<div class="docNote"><p class="docNoteTitle">Note</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/note_icon.gif" ALT="graphics/note_icon.gif"></td>
<td valign="top"><P>To make this example truly "data driven," you would want to either keep these table names in a table by themselves and set the data source of lstLookupTables to that table, or generate the list at runtime by naming your lookup tables a specific way.</P>
<P>These values are hard coded for the sake of expediency and so that no more tables are added to Northwind.</P>
</td>
</tr></table></p>
</div></span></LI><LI><span style="font-weight:normal" value="3"><P>In the class module for the form, add the following Private declarations just below the line of code that reads <TT>Windows Form Designer generated code</TT>.</P>
<pre>
Dim mcnn As New OleDb.OleDbConnection()
Dim modaLookupData As OleDb.OleDbDataAdapter
</pre>
<P>These lines of code declare <TT>Connection</TT> and <TT>DataAdapter</TT> objects that will be used throughout the form.</P></span></LI><LI><span style="font-weight:normal" value="4"><P>On the form, add the code in Listing 8.9 to the Load event.</P>
<H5 class="docExampleTitle">Listing 8.9 <TT>frmHowTo8_2.vb</TT>: Establishing the Connection String and Pointing to the First Item in lstLookupTables</H5>
<PRE>
Private Sub frmHowTo8_2_Load(ByVal sender As Object, _
                        ByVal e As System.EventArgs) Handles MyBase.Load

        '-- Initialize the connection string.
        mcnn.ConnectionString = BuildCnnStr("(local)", "Northwind")

        '-- Point to the first lookup table; this fires
        '   the SelectedIndexChanged event off the list box.

        Me.lstLookupTables.SelectedIndex = 0

    End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="5"><P>On the lstLookupTables list box, add the code in Listing 8.10 to the <TT>SelectedIndexChanged</TT> event. This routine assigns the new table chosen in lstLookupTables as the <TT>Select</TT> command for the <TT>modaLookupData</TT> data adapter. The data table called dtData is then filled and set as the data source for dgTableData.</P>
<H5 class="docExampleTitle">Listing 8.10 <TT>frmHowTo8_2.vb</TT>: Populating the DataGrid Control</H5>
<PRE>
Private Sub lstLookupTables_SelectedIndexChanged(ByVal sender As System.Object,
          ByVal e As System.EventArgs) Handles lstLookupTables.SelectedIndexChanged

        Dim dtData As New DataTable()

        Try

            '-- Update the data adapter and data table to reflect the new data,
            '   and reassign the data source of the data grid.

            modaLookupData = New OleDb.OleDbDataAdapter("Select * From " &amp;
                                            Me.lstLookupTables.Text, mcnn)

            modaLookupData.Fill(dtData)
            Me.dgTableData.DataSource = dtData

        Catch excData As Exception

            MessageBox.Show(excData.Message)

        End Try

    End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="6"><P>On the btnUpdate button, add the code in Listing 8.11 to the <TT>Click</TT> event. This routine performs a task you have seen in one form or another throughout this book. A <TT>CommandBuilder</TT> object is created off the <TT>modaLookupData</TT> data adapter, and it is used to update the data table. The Update method of modaLookupData is executed, followed by the <TT>AcceptChanges</TT> method of the dtFromGrid data table.</P>
</span></LI></OL></span>
<H5 class="docExampleTitle">Listing 8.11 <TT>frmHowTo8_2.vb</TT>: Populating the DataGrid Control</H5>
<PRE>
Private Sub btnUpdate_Click(ByVal sender As System.Object, _
                            ByVal e As System.EventArgs) Handles btnUpdate.Click

        Dim dtFromGrid As DataTable

        '-- Create the command builder to update (post) the data in the data grid
        '   back to the server.

        Dim custCB As OleDb.OleDbCommandBuilder = _
                        New OleDb.OleDbCommandBuilder(modaLookupData)

        Try

            '-- Have to open the connection.
            mcnn.Open()

            '-- Grabbing the data table from the DataSource
      '   property of the data grid
            '   saves a bunch of hassles trying to track the data table directly.

            dtFromGrid = CType(dgTableData.DataSource, DataTable)

            '-- Commands necessary to actually post back to server.
            modaLookupData.Update(dtFromGrid)
            dtFromGrid.AcceptChanges()

            '-- Don't forget to close the connection.
            mcnn.Close()

        Catch excp As Exception

            MessageBox.Show("Couldn't update server")

        End Try

    End Sub
</PRE>
<div class="docNote"><p class="docNoteTitle">Tip</p>
<p><table border="0" align="center" cellpadding="6" cellspacing="0"><tr>
<td width="60" valign="top"><IMG BORDER="0" ALIGN="LEFT" WIDTH="100" HEIGHT="100" src="FILES/tip_icon.gif" ALT="graphics/tip_icon.gif"></td>
<td valign="top"><P>One interesting thing of note is the way that the <TT>DataTable</TT> object is derived in this routine. Instead of creating it from a <TT>DataSet</TT> or <TT>DataAdapter</TT> object, we get it from the <TT>DataGrid</TT> object, with the line of code that reads like this:</P>
<pre>
dtFromGrid = CType(dgTableData.DataSource, DataTable)
</pre></td>
</tr></table></p>
</div><br>

<H4 class="docSection2Title"> How It Works</H4>
<P>When the form opens, the initial table's data in the list box is loaded into the <TT>DataGrid</TT> control by setting the SelectedIndex of the lstLookupTables to 0. When this occurs and when a user selects a new item in the list, a Select statement is generated and loaded into a data adapter, which fills a data table. This, in turn, is used for the data source of the data grid, and the data is displayed.</P>
<P>When the user clicks the button with the caption Update, a <TT>CommandBuilder</TT> object is generated off the <TT>DataAdapter</TT> object. The <TT>Update</TT> command for the data adapter is then invoked, with the <TT>Update</TT> method called. The data table is then referenced from the data source of the <TT>DataGrid</TT> control, and the <TT>AcceptChanges</TT> method is called.</P>
<H4 class="docSection2Title"> Comments</H4>
<P>Creating this kind of utility will save hundreds of hours in some cases, especially if you use it across applications. When starting with something this simple, you can add features to it every time you use it for a new and expanded purpose.</P>
<img src="FILES/pixel.gif" width="1" height="1" border="0"><ul></ul>
</body></html>
