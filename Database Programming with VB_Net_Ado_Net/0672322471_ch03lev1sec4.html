<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="3.2 Retrieve Results from SQL Server by Using the DataTable Object"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">3.2 Retrieve Results from SQL Server by Using the DataTable Object</H3>
<P>The data reader is great when you just want to load data into a <TT>ListBox</TT> or <TT>ComboBox</TT> control manually, but you can save some coding by binding the ListBox control to a data table at runtime, as well as providing the ability to get not only the displayed value, but the key column as well. This How-To demonstrates how to bind a limited ListBox control to a data table.</P>
<P>Although getting the quick information is great, you need to be able to refer back to the table of information, and you don't want to have to open another connection to get there. You know that the <TT>DataTable</TT> object should allow you to perform this task. How do you get results from SQL Server by using the <TT>DataTable</TT> object?</P>
<H4 class="docSection2Title"> Technique</H4>
<P>Using the Windows Forms controls that were introduced in How-To 3.1, you will use a familiar object from Chapter 1 called the DataAdapter object. This time, instead of using the <TT>OleDbDataAdapter</TT> data control, you will use the <TT>OleDbDataAdapter</TT> class from the <TT>System.Data.OleDb Namespace</TT>.</P>
<P>Using a similar technique that was used when filling a DataSet, you will instantiate the data adapter by assigning the SQL string and connection object. Then, instead of filling a DataSet object, you will fill a <TT>DataTable</TT> object. Because you will only be dealing with a table's worth of data, you just need to use a data table. That way, you will be able to perform lookups more conveniently, as shown in the next How-To.</P>
<P>For now, the next step will be to assign the following properties of the list box:</P>
<UL>
<LI><p>
<TT>DataSource</TT>. 
This will be set to the <TT>DataTable</TT> object-in this case, <TT>dtCust</TT>.</p>
</LI>
<LI><p>
<TT>DisplayMember</TT>. 
This specifies which column from the data table to use for display in the list box.</p>
</LI>
<LI><p>
<TT>ValueMember</TT>. 
Here, you will specify which column you want to use for the value that is retrieved when an item is selected from the list box.</p>
</LI>
</UL>
<P>By programming the ListBox control using this technique, you can access the ValueMember column in the SelectItem property of the list box.</P>
<H4 class="docSection2Title"> Steps</H4>
<P>Open and run the VB.NET-Chapter 3 solution. From the main form, click on the command button with the caption How-To 3.2. When the form loads, click on the Load List command button. You will see the list below fill with all the company names that start with <span class="docEmphasis">A</span>.</P>


<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>To save time, you can make a copy of the form that was created in the first How-To in this chapter.</P></span></LI><LI><span style="font-weight:normal" value="2"><P>Replace the btnLoadList Click event with the following code listed here in Listing 3.3. That's it. After creating the SQL string that will be used and storing it in strSQL, the data adapter called odaCust is created. The odtCust data table is then filled using odaCust. Last, the DataSource, DisplayMember, and ValueMember properties are set for the lstCustomers list box. This was all accomplished with a <TT>Try-Catch-End-Try</TT> block of code.</P>
<H5 class="docExampleTitle">Listing 3.3 <TT>frmHowTo3_2.vb</TT>: Loading a List Box By Using the DataTable Object</H5>
<PRE>
Private Sub btnLoadList_Click(ByVal sender As System.Object,
                    ByVal e As System.EventArgs) Handles btnLoadList.Click

        Dim odaCust As OleDb.OleDbDataAdapter
        Dim dtCust As DataTable = New DataTable()

        Dim strSQL As String

        '-- Create the SQL String
        strSQL = "Select CustomerID, CompanyName From Customers " &amp; _
                  "Where CustomerID Like '" &amp;
                    Me.txtCustLimit.Text &amp; "%'"


        '-- Set up the exception catch
        Try

            '-- Create an instance of the data adapter,
            '  and then fill the data table
            odaCust = New OleDb.OleDbDataAdapter(strSQL, _
BuildCnnStr("(local)", "Northwind"))
            odaCust.Fill(dtCust)

            '-- Bind the data to the list box
            lstCustomers.DataSource = dtCust
            lstCustomers.DisplayMember = "CompanyName"
            lstCustomers.ValueMember = "CustomerID"

        Catch oexpData As OleDb.OleDbException
            MsgBox(oexpData.Message)
        End Try

    End Sub
</PRE></span></LI></OL></span>
<H4 class="docSection2Title"> How It Works</H4>
<P>When the user clicks on the btnLoadList button, the data adapter called <TT>odaCust</TT> is instantiated. The data adapter is passed <TT>strSQL</TT> and the connection string that is created by the function called <TT>BuildCnnStr</TT>, which was introduced in the first How-To in this chapter. The data table is then filled, and then the <TT>DataSource</TT>, <TT>DisplayMember</TT>, and <TT>ValueMember</TT> properties of the <TT>ListBox</TT> control are assigned.</P>
<H4 class="docSection2Title"> Comments</H4>
<P>Using the data table sets up the scene for using the list box in retrieving data in the next How-To. Remember: By using the DataTable object, you can assign both the display value and the data item to be tracked.</P>
<ul></ul>
</body></html>
