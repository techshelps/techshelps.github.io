<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="12.3 Work with the XML Document Object Model"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body><H3 class="docSection1Title">12.3 Work with the XML Document Object Model</H3>
<P>I want to have more control over the XML document as I create it. I heard that I can do this with XML DOM. How do I work with the XML Document Object Model?</P>
<H4 class="docSection2Title"> Technique</H4>
<P>In How-Tos 12.1 and 12.2, you saw two ways to independently read and write XML documents. However, what if you want to do both at the same time? To have this kind of flexibility, you need to use the XML Document Object Model, also known as DOM.</P>
<P>The <TT>DOM</TT> class is an XML document that is represented in memory. It allows you not only to programmatically read and write out XML documents, but also to modify those documents in memory.</P>
<P>Within the DOM, the <TT>XMLNode</TT> object is the base object in the DOM Tree, <TT>XMLDocument</TT> class that extends it. XMLDocument has methods that allow you to perform operations on the document as a whole. It also lets the developer work with the nodes in the entire XML document.</P>
<P>Both XMLNode and XMLDocument have performance and usability enhancements over prior versions.</P>
<P>The properties and methods of XMLNode and XMLDocument that will be used for this How-To are listed in Table 12.6.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 12.6. DOM Properties and Methods Used in This How-To</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Class Name</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property/Method</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Purpose/Description</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>XMLDocument</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>LoadXML</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Loads an XML document into the <TT>XMLDocument</TT> object. In this case, it is a means to create the stub for the XML document that will be created from the dataset.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>XMLDocument</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>DocumentElement</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Serves as the root element for the document. It is, in fact, of the type <TT>XMLElement.</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>XMLDocument</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>CreateNode</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Creates an <TT>XMLNode</TT> object.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>XMLElement</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>AppendChild</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Appends the node created to the element specified as a child.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>XMLDocument</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>CreateComment</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Adds a comment to the XML document.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>XMLNode</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>AppendChild</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Appends a node to another node as a child.</P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>XMLDocument</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Save</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P>Saves the current XML document.</P>
</TD>
</TR>
</COLGROUP>
</TABLE></P>
<H4 class="docSection2Title"> Steps</H4>
<P>Open and run the Visual Basic .NET-Chapter 12 solution. From the main Web page, click on the hyperlink with the caption How-To 12.3: Working with the XML Document Object Model. As with How-To 12.1, when the page loads, you can enter a few names. Enter the last and first names, and then click the button labeled Add to DataTable. When you have added a few names, click the button labeled Create XML File. Using Explorer, open the file created in C:\ called test.xml(see Figure 12.3).</P>






<span style="font-weight:bold"><OL class="docList" START="1">
<LI><span style="font-weight:normal" value="1"><P>Create a Web Form. Then place the <TT>Labels</TT>, <TT>TextBoxes</TT>, <TT>Buttons</TT>, and <TT>DataGrid</TT> objects as seen in Figure 12.3 on the form with the properties set as in Table 12.7.</P>
<P><TABLE BORDER="1" align="center" CELLPADDING="6" CELLSPACING="0">
<CAPTION><h5 class="docTableTitle">Table 12.7. Label, TextBox, and Button Control Property Settings</h5></CAPTION><COLGROUP span="3">
<TR>
<TH class="docTableHeader" align="left" valign="top">
<P>Object</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Property</P>
</TH>
<TH class="docTableHeader" align="left" valign="top">
<P>Setting</P>
</TH>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Last Name</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtLastName</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Label</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>First Name</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>TextBox</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>txtFirstName</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnAdd</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Add to DataTable</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>Button</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>btnCreateXMLFile</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>Text</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>Create XML File</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>DataGrid</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>dgDataToWrite</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">
<P><TT>HyperLink</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><PRE><TT>ID</TT></PRE></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>hplReturnToMain</TT></P>
</TD>
</TR>
<TR>
<TD class="docTableCell" valign="top">&nbsp;</TD>
<TD class="docTableCell" valign="top">
<P><TT>NavigateURL</TT></P>
</TD>
<TD class="docTableCell" valign="top">
<P><TT>wfrmMain.aspx</TT></P>
</TD>
</TR>
</COLGROUP>
</TABLE></P></span></LI><LI><span style="font-weight:normal" value="2"><P>Add the following line to the code module of the form. I place it under the line that reads Web Form Designer Generated Code.</P>
<pre>
Dim mdtData As New DataTable()
</pre></span></LI><LI><span style="font-weight:normal" value="3"><P>Add the code in Listing 12.6 to the Load event of the page. If the data table has not been saved to the <TT>Session</TT> object, then it is created from scratch by first creating the data columns and then adding them to the data table. The <TT>DataTable</TT> object is then saved to the <TT>Session</TT> object with the name MyDataTable. If the <TT>Session</TT> object entry already exists, it is reassigned to the module variable mdtData. Last, the data table is bound to the <TT>DataGrid</TT> object by calling the BindTheGrid routine, which is described in the next step.</P>
<H5 class="docExampleTitle">Listing 12.6 <TT>wfrmHowTo12_3.aspx.vb</TT>: Creating a <TT>DataTable</TT> Object from Scratch</H5>
<PRE>
Private Sub Page_Load(ByVal sender As System.Object, _
            ByVal e As System.EventArgs) Handles MyBase.Load

        'Put user code to initialize the page here
        If (Session("MyDataTable") Is Nothing) Then

            Dim dcFirstName As New DataColumn()

            dcFirstName.ColumnName = "FirstName"
            dcFirstName.Caption = "First Name"

            mdtData.Columns.Add(dcFirstName)

            Dim dcLastName As New DataColumn()

            dcLastName.ColumnName = "LastName"
            dcLastName.Caption = "Last Name"

            mdtData.Columns.Add(dcLastName)

            Session("MyDataTable") = mdtData

        Else
            mdtData = CType(Session("MyDataTable"), DataTable)
        End If

        BindTheGrid()

    End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="4"><P>Create the routine BindTheGrid, shown in Listing 12.7, in the code module for the page.</P>
<H5 class="docExampleTitle">Listing 12.7 <TT>wfrmHowTo12_3.aspx.vb</TT>: Binding the Data Table to the Data Grid</H5>
<PRE>
Sub BindTheGrid()

        dgDataToWrite.DataSource = mdtData
        dgDataToWrite.DataBind()

End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="5"><P>Add the code in Listing 12.8 to the <TT>Click</TT> event of the btnAdd button. This routine starts off by calling the <TT>NewRow</TT> method off the mdtData data table, thus creating a new <TT>DataRow</TT> object. The two columns in drNew are replaced with the values in txtLastName and txtFirstName. The new row is added to the data table, and the text boxes are cleared. Last, mdtData is rebound to the data grid by calling BindTheGrid.</P>
<H5 class="docExampleTitle">Listing 12.8 <TT>wfrmHowTo12_3.aspx.vb</TT>: Adding Data to the Data Table and Then Rebinding the Data Grid</H5>
<PRE>
Private Sub btnAdd_Click(ByVal sender As System.Object, _
                  ByVal e As System.EventArgs) Handles btnAdd.Click

        Dim drNew As DataRow

        drNew = mdtData.NewRow()

        drNew.Item("LastName") = Me.txtLastName.Text
        drNew.Item("FirstName") = Me.txtFirstName.Text

        mdtData.Rows.Add(drNew)

        Me.txtLastName.Text = ""
        Me.txtFirstName.Text = ""

        BindTheGrid()

    End Sub
</PRE></span></LI><LI><span style="font-weight:normal" value="6"><P>Add the code in Listing 12.9 to the Click event of the btnCreateXMLFile button. After getting the number of rows in mdtData, an XML document is started using the LoadXML method. Next, the root element is retrieved so that nodes can then be "hung" from it, using the <TT>CreateNode</TT> and <TT>AppendChild</TT> methods. A comment is then added using the <TT>CreateComment</TT> method of xdMyData. Then, for each of the rows in the mdtData, nodName is created using <TT>CreateNode</TT> and <TT>AppendChild</TT> methods, and node on nodName is added for the LastName and FirstName. Again, these nodes are added using the <TT>CreateNode</TT> and <TT>AppendChild</TT> methods. Last, the <TT>Save</TT> method is used to save the XML document.</P>
<H5 class="docExampleTitle">Listing 12.9 <TT>wfrmHowTo12_3.aspx.vb</TT>: Creating the XML Document</H5>
<PRE>
Private Sub btnCreateXMLFile_Click(ByVal sender As System.Object, _
                        ByVal e As System.EventArgs) Handles btnCreateXMLFile.Click

        Dim xdMyData As New System.Xml.XmlDocument()
        Dim xeRoot As System.Xml.XmlElement

        Dim intCurrRow As Integer
        Dim intNumRows As Integer

        intNumRows = mdtData.Rows.Count - 1

        With xdMyData

            '-- Start the XML document
            .LoadXml("&lt;?xml version='1.0' ?&gt;&lt;Book&gt;&lt;/Book&gt;")

            xeRoot = .DocumentElement

            Dim nodRoot As System.Xml.XmlNode = _
                           .CreateNode(System.Xml.XmlNodeType.Element, "Names", "")
            xeRoot.AppendChild(nodRoot)

            '-- Add the comment
            .CreateComment("This file represents names list created using the XML DOM")

            For intCurrRow = 0 To intNumRows
                '-- Start the current row
                Dim nodName As System.Xml.XmlNode = _
                        .CreateNode(System.Xml.XmlNodeType.Element, "name", "")

                nodName = nodRoot.AppendChild(nodName)

                '-- Add the attributes (columns)
                Dim nodFirstName As System.Xml.XmlNode = _
                        .CreateNode(System.Xml.XmlNodeType.Element, "FirstName", "")
                nodFirstName.InnerText = mdtData.Rows(intCurrRow).Item("FirstName")

                nodName.AppendChild(nodFirstName)

                Dim nodLastName As System.Xml.XmlNode = _
                        .CreateNode(System.Xml.XmlNodeType.Element, "LastName", "")
                nodLastName.InnerText = mdtData.Rows(intCurrRow).Item("LastName")

                nodName.AppendChild(nodLastName)

            Next

            '-- Write the XML to file and close the writer
            .Save("c:\Test.xml")

        End With

End Sub
</PRE></span></LI></OL></span>
<CENTER><H5 class="docFigureTitle">Figure 12.3. This XML document was created using XMLTextWriter.</H5><p><IMG BORDER="0" WIDTH="500" HEIGHT="375" src="FILES/12fig03.jpg" ALT="graphics/12fig03.jpg"></p>
</CENTER>
<H4 class="docSection2Title"> Comments</H4>
<P>As you can see, working with the DOM takes a bit more time and work. However, when you really need to massage the data, this is the way to go!</P>
<ul></ul>
</body></html>
