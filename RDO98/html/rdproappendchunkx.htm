<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><TITLE>AppendChunk, GetChunk Method Example</title>
<style>@import url(msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="msdn_ie3.css"></HEAD>
<BODY>

<h1><a name="rdproappendchunkx"></a>AppendChunk, GetChunk Method Example</h1>
<p>
This example illustrates use of the <b>AppendChunk</b> and <b>GetChunk</b> methods to write page-based binary large object (BLOB) data to a remote data source. The code expects a table with a char, text, and image field named <i>Chunks</i>. To create this table, submit the following as an action query against your test database:</p>
<pre><code>CREATE TABLE Chunks (ID integer identity NOT NULL, PName char(10) NULL,
Description TEXT NULL, 
Photo IMAGE NULL)
CREATE UNIQUE INDEX ChunkIDIndex on Chunks(ID)
</code></pre>
<p>
Once the table is created, you will need to locate one or more .BMP or other suitable graphics images that can be loaded by the <b>PictureBox</b> control.</p>
<pre><code>'
Option Explicit
Dim en As rdoEnvironment
Dim Qd As rdoQuery
Dim Cn As rdoConnection
Dim Rs As rdoResultset
Dim SQL As String
Dim DataFile As Integer, Fl As Long, Chunks As Integer
Dim Fragment As Integer, Chunk() As Byte, I As Integer
Const ChunkSize As Integer = 16384

Private Sub Form_Load()
Set en = rdoEnvironments(0)
Set Cn = en.OpenConnection(dsname:="", _
 &nbsp; Connect:="UID=;PWD=;DATABASE=WorkDB;" _
 &nbsp; &amp; "Driver={SQL Server};SERVER=Betav486", _
 &nbsp; prompt:=rdDriverNoPrompt)
Set Qd = Cn.<span class=cfe><b>CreateQuery</b></span>("TestChunk", "Select * from&nbsp;&nbsp;&nbsp;&nbsp; 
 &nbsp; Chunks Where PName = ?")
End Sub

Private Sub LoadFromFile_Click()
'
'&nbsp; Locates a file and sets the Filename to this file.
'
With CommonDialog1
   .Filter = "Pictures(*.bmp;*.ico)|*.bmp;*.ico"
   .ShowOpen
   FileName = .FileName
End With
End Sub

Private Sub ReadFromDB_Click()
If Len(NameWanted) = 0 Then _
 &nbsp; NameWanted = InputBox("Enter name wanted", "Animal")
 &nbsp; Qd(0) = NameWanted
 &nbsp; Set Rs = Qd.OpenResultset(rdOpenKeyset, _
 &nbsp; rdConcurRowver)
If Rs Is Nothing Or Rs.Updatable = False Then
 &nbsp; MsgBox "Can’t open or write to result set"
 &nbsp; Exit Sub
End If
If Rs.EOF Then
 &nbsp; MsgBox "Can’t find picture by that name"
 &nbsp; Exit Sub
End If
Description = Rs!Description
DataFile = 1
Open "pictemp" For Binary Access Write As DataFile
Fl = Rs!Photo.<span class=cfe><b>ColumnSize</b></span>
Chunks = Fl \ ChunkSize
Fragment = Fl Mod ChunkSize
ReDim Chunk(Fragment)
Chunk() = Rs!Photo.<span class=cfe><b>GetChunk</b></span>(Fragment)
Put DataFile, , Chunk()
For I = 1 To Chunks
 &nbsp; ReDim Buffer(ChunkSize)
 &nbsp; Chunk() = Rs!Photo.<span class=cfe><b>GetChunk</b></span>(ChunkSize)
 &nbsp; Put DataFile, , Chunk()
Next I
Close DataFile
FileName = "pictemp"
End Sub

Private Sub SaveToDB_Click()
If Len(NameWanted) = 0 Then _
 &nbsp; NameWanted = InputBox("Enter name for this" _
 &nbsp; &amp; " picture", "Animal")
 &nbsp; Qd(0) = NameWanted
 &nbsp; Set Rs = Qd.OpenResultset(rdOpenKeyset, _
 &nbsp; rdConcurRowver)
If Rs Is Nothing Or Rs.Updatable = False Then
 &nbsp; MsgBox "Can’t open or write to result set"
 &nbsp; Exit Sub
End If
If Rs.EOF Then
 &nbsp; Rs.AddNew
 &nbsp; Rs!PName = NameWanted
If Description = "" Then&nbsp; _
 &nbsp; Description = InputBox("Describe the picture", _ 
 &nbsp; "Don’t care")
 &nbsp; 'Rs!Description = Description
Else
 &nbsp; Rs.Edit
End If
DataFile = 1
Open FileName For Binary Access Read As DataFile
Fl = LOF(DataFile)&nbsp;&nbsp;&nbsp; ' Length of data in file
If Fl = 0 Then Close DataFile: Exit Sub
Chunks = Fl \ ChunkSize
Fragment = Fl Mod ChunkSize
Rs!Photo.<span class=cfe><b>AppendChunk</b></span> Null
ReDim Chunk(Fragment)
Get DataFile, , Chunk()
Rs!Photo.<span class=cfe><b>AppendChunk</b></span> Chunk()
ReDim Chunk(ChunkSize)
For I = 1 To Chunks
 &nbsp; Get DataFile, , Chunk()
 &nbsp; Rs!Photo.<span class=cfe><b>AppendChunk</b></span> Chunk()
Next I
Close DataFile
Rs.Update
End Sub

Private Sub FileName_Change()
Picture1.Picture = LoadPicture(FileName)
End Sub
</code></pre>
</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-1');</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
