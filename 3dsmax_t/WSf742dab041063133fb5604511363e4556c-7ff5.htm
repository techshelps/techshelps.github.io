<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=iso8859-1">
   <script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><TITLE>Applying Logic to Crowd Behavior</title><link rel="stylesheet" type="text/css" href="./style/cpm.css"><link rel="stylesheet" type="text/css" href="./style/isd.css"><link rel="stylesheet" type="text/css" href="./style/commons.css"><link rel="stylesheet" type="text/css" href="./style/contents.css"><link rel="stylesheet" type="text/css" href="./style/header.css"><link rel="stylesheet" type="text/css" href="./style/indexes.css"><link rel="stylesheet" type="text/css" href="./style/search.css"><link rel="stylesheet" type="text/css" href="./style/med.css"><script type="text/javascript" src="./scripts/ac.strings.js"></script><script type="text/javascript" src="./ac_common.js"></script><script type="text/javascript" src="./scripts/acmap.js"></script><script type="text/javascript" src="./scripts/ac.acad_ak.js"></script><script type="text/javascript" src="./scripts/index-processing.js"></script><script type="text/javascript" src="./scripts/search-processing.js"></script><script type="text/javascript" src="./scripts/toc-processing.js"></script><script type="text/javascript" src="./scripts/highlight.js"></script><script type="text/javascript" src="./scripts/favorites.js"></script><script type="text/javascript" src="./scripts/commons-processing.js"></script><script language="javascript">
            function hideInfo() {
                info = document.getElementById('infoline');
                info.innerHTML = ' ';
                info.style.visibility = 'hidden';
            }
            function showInfo(title) {
                info = document.getElementById('infoline');
                info.innerHTML = title;
                info.style.visibility='visible';
            }
        </script><meta name="description" content="Applying Logic to Crowd Behavior"><meta name="keywords" content="applying:logic to crowd behavior, logic and crowd behavior,"><meta name="topic-type" content="concept"></head><body><!--
							Name = Topic;
							Class =  CPM-Topic ISD-Topic ;
							Url = WSf742dab041063133fb5604511363e4556c-7ff5.htm--><div class="head"><div class="head-block"><div class="nav-group"><!--browse buttons--><div class="browse"><nobr><!--No Additional browse buttons are defined--><div id="prevTitle" style="display:none">Applying Avoidance</div><a href="WSf742dab041063133fb5604511363e4556c-7ff6.htm" class="headNavLink" onmouseover="showInfo(document.getElementById('prevTitle').innerHTML);" onmouseout="hideInfo();"><img src="./images/nav-prev-xp.gif" border="0"></a><div id="parentTitle" style="display:none">Animating Crowds</div><a href="WS1a9193826455f5ff13cfd6e1136132a36f-7eaf.htm" class="headNavLink" onmouseover="showInfo(document.getElementById('parentTitle').innerHTML);" onmouseout="hideInfo();"><img src="./images/nav-up-xp.gif" border="0"></a><div id="nextTitle" style="display:none">Using Crowd with Animated Non-Biped Objects</div><a href="WSf742dab041063133fb5604511363e4556c-7ff4.htm" class="headNavLink" onmouseover="showInfo(document.getElementById('nextTitle').innerHTML);" onmouseout="hideInfo();"><img src="./images/nav-next-xp.gif" border="0"></a></nobr></div><!--end browse buttons--></div><div class="button-info"><span id="infoline">&nbsp;</span></div><div class="ancestry"><a href="welcome.htm">Autodesk 3ds Max Tutorials</a>&nbsp;&gt;&nbsp;<a href="WSf742dab04106313363d7aea112a19e2fe5-8000.htm">Animation Tutorials</a>&nbsp;&gt;&nbsp;<a href="WS1a9193826455f5ff13cfd6e1136132a36f-7eaf.htm">Animating Crowds</a>&nbsp;&gt;&nbsp;</div><div class="head-text"><span>Applying Logic to Crowd Behavior</span></div></div></div><div class="head-margin">&nbsp;</div><div style="line-height: 0pt">&nbsp;</div><div class="head-margin">&nbsp;</div><span style="display:none"><a name="WSf742dab041063133fb5604511363e4556c-7ff5"></a></span>

<!--Body-->
<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e28"></a></span>

In the
previous lesson, you learned how to switch a team from one behavior to
another by animating the Active status. You did this by setting
up and solving the first part of the simulation, and then using
that feedback to set up the second part. This isn't a very flexible
method, though. If you change the target position, or the delegates'
speed, the frame where the behaviors should switch would change,
and you'd have to move at least two keys. With more complex simulations,
such as those with multiple or moving targets, or delegates that
travel different distances, modifications can be difficult.</p>
<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e25"></a></span>For complex situations, you can assign <em class="mild">cognitive
controllers</em> to delegates and teams instead of behaviors.
The cognitive controller has several <em class="mild">states</em>. Each state
can contain one or more behaviors, each with a different weight.
You set the states up as a diagram and link them with transitions.
The transitions use MAXScript scripts to determine when one state
relinquishes control to another. </p>
<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e24"></a></span>In this lesson, you'll use a cognitive controller
to change a team's behavior from Seek to Repel when the team members
reach the box.</p>
<!--UList--><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e23"></a></span>
<p class="list-intro"><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e22"></a></span>Set
up the lesson:</p>
<ul><li>Open
the file you saved in the middle of the Using Multiple Delegates
and Behaviors lesson (<em class="mild">crowd_basics03a.max</em>). Or, if you
like, open <em class="mild">crowd_basics03.max</em> from the <em class="mild">tutorials\character_animation\crowd_basics</em> directory
in your 3ds Max path.<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e21"></a></span>This scene contains 10 delegates scattered in
a spherical pattern about a small, centrally located box.</p>
</li></ul>

<!--OList--><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e20"></a></span>
<p class="list-intro"><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e1f"></a></span>Set
up the behaviors:</p>
<ol type="1" start="1"><li>Select
the Crowd object, and open the Modify panel.</li><li>
<img src="./images/MED/3dsMaxTut/English/but/b_edit_mult_delegates.png"> Use
the Edit Multiple Delegates dialog to turn off Constrain To XY Plane
for all the delegates.<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e1e"></a></span>The method for doing this is covered in the
previous lesson, <span class="hypertext">
<span class="char_link"><a href="WSf742dab041063133fb5604511363e4556c-7ff6.htm"><!--Reference = WSf742dab041063133fb5604511363e4556c-7ff6; Target topic = WSf742dab041063133fb5604511363e4556c-7ff6.htm-->Applying Avoidance</a></span>

</span>.</p>
</li><li>Add
a Seek behavior and a Repel behavior, and set the box as the target
for both behaviors.</li><li>For
the Repel behavior, turn off Use Radii.</li></ol>




<!--OList--><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e1d"></a></span>
<p class="list-intro"><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e1c"></a></span>Use
the cognitive controller:</p>
<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e1b"></a></span>Instead of assigning these behaviors to the
delegates, you'll use them to build a cognitive controller and assign
the controller to the delegates.</p>
<ol type="1" start="1"><li>
<img src="./images/MED/3dsMaxTut/English/but/b_cog_ctrl.png"> On the
Setup rollout, click Cognitive Controllers.</li><li>In
the Cognitive Controller Editor window, click the New button on
the right side of the toolbar.<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e1a"></a></span>This creates a new cognitive controller with
the name <em class="mild">Cognitive Controller</em> and activates
the Create State tool (the button at the left end of the toolbar).</p>
</li><li>Click
twice in the editor window, in two different locations.<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e19"></a></span>This adds two state boxes to the controller.
Each state can contain any number of behaviors.</p>
<span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e18"></a></span><div class="figure-anchor">
<p><img src="./images/MED/3dsMaxTut/English/cs/cog_ctrl_editor01.png"></p>
<p></p><p class="figure-title">The
cognitive controller editor with two states added</p>
</div>
<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e17"></a></span>The first state you added is dark red, which
means it's the Start state. It is executed first when the cognitive
controller begins working. You can set any state to be the Start
state. </p>
<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e16"></a></span>To make the delegates seek the box first, you'll
assign the Seek behavior to the first state. You'll also make the
states' names more descriptive, and assign a behavior to the second
state.</p>
</li><li>Right-click
in the window to exit Create State mode, and then right-click the
red state box.<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e15"></a></span>The State dialog opens. The name of this dialog
reflects the name of the state at the time you open it. You can
change the name, and the new name is displayed the next time the
screen refreshes.</p>
</li><li>In
the State dialog, double-click the name (&#8220;State&#8221;) and change it
to <em class="strong">Seek</em>.</li><li>Click
the Add button. In the Select Behaviors dialog, click Seek Behavior and
click OK.<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e14"></a></span>The Seek behavior is highlighted in the list.
You can change the weight, so that if a state contains several behaviors,
some can predominate over others.</p>
<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e13"></a></span>When you opened the Select Behaviors dialog,
the screen refreshed and the State dialog name changed to Seek.</p>
</li><li>Close
the Seek dialog by clicking the Close box (X) in its upper-right
corner.</li><li>Change
the second state's name to <em class="strong">Repel</em> and assign
it the Repel behavior.</li></ol>








<!--OList--><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e12"></a></span>
<p class="list-intro"><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e11"></a></span>Create
a transition:</p>
<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e10"></a></span>You'll add a transition between the two states,
and create a short script to tell the cognitive controller when
to switch between them.</p>
<ol type="1" start="1"><li>
<img src="./images/MED/3dsMaxTut/English/but/b_create_transition.png"> On the
editor toolbar of the Cognitive Controller Editor window, click
Create Transition.</li><li>Drag
a line from the Seek state to the Repel state.<span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e0f"></a></span><div class="figure-anchor">
<p><img src="./images/MED/3dsMaxTut/English/cs/cog_ctrl_editor02.png"></p>
</div>
<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e0e"></a></span>An arrow points from the first state to the
second. This is the transition.</p>
</li><li>Right-click
the transition arrow.</li><li>In
the Transition (Seek -&gt; Repel) dialog, change the Duration setting
to <em class="strong">10</em>.<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e0d"></a></span>This makes the transition take place over 10
frames instead of 25. A shorter transition causes faster reactions.</p>
<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e0c"></a></span>Note the other settings. If you change the priority,
and a state has two or more outbound transition conditions, all
of which are true, the one with the highest priority takes precedence.
You can also change the rates at which a transition eases out of
one state and into the next.</p>
</li><li>Click
the Edit MAXScript button.</li><li>In
the MAXScript window, enter the following:<div class="codeBlock">
<pre class="codeLine">fn TestDist del t = ( </pre>
<pre class="codeLine">get_dist=distance $box01.pos del.simpos </pre>
<pre class="codeLine">if get_dist &lt; 120 </pre>
<pre class="codeLine">then 1 </pre>
<pre class="codeLine">else 0 )</pre>
</div>
<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e0b"></a></span>Alternatively, you can load the MAXScript file <em class="mild">test_dist.ms</em> from
the <em class="mild">tutorials\character_animation\crowd_basics</em> directory
in your 3ds Max path.</p>
<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e0a"></a></span>This script tests, at each frame, the distance
between each delegate and the box. If it is less than 120 units,
the delegate moves into the next state, which uses the Repel behavior.</p>
<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e09"></a></span>The name of the function, which is the second
word of the script (after "fn"), must appear in the Transition dialog
as well.</p>
<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e08"></a></span>The script, which starts with "get_dist," calculates
the distance between the position ([name].pos) of a specific object
($box01) and the position of a generic delegate (del.simpos). "Simpos"
is a special position property used to determine a delegate position
during a simulation solution. </p>
<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e07"></a></span>The software executes the transition script
once per frame for each delegate that uses this cognitive controller.
Each time the script is executed, the cognitive controller substitutes
a subsequent delegate for "del". </p>
<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e06"></a></span>The first time the script is executed at a given
frame, it calculates the position the distance between the objects <em class="mild">box01</em> and <em class="mild">delegate01</em>.
The second time, it calculates the position the distance between
the objects <em class="mild">box01</em> and <em class="mild">delegate02</em>,
and so on. To see each delegate's name as its position is tested, insert
this line in the script anywhere between the first line and the
last line:</p>
<div class="codeBlock">
<pre class="codeLine">print del.name</pre>
</div>
<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e05"></a></span>Be sure to have a Listener window open (press <em class="strong">F11</em>)
before you run the solution.</p>
<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e04"></a></span>To learn more about how scripts work in transitions,
read the reference topics Cognitive Controller Editor and State
Transition dialog, where you'll find more sample scripts with descriptions
of their components and functions.</p>
</li><li>Double-click
the name of the function ("TestDist") to highlight it, and then
press <em class="strong">CTRL+C</em> to copy it to the Windows
clipboard.</li><li>Close
the MAXScript dialog.</li><li>In
the Transition dialog, highlight or delete the contents of the Transition Condition
text box, and then press <em class="strong">CTRL+V</em> to paste the name of the
function into the box.</li><li>Click
OK to close the Transition dialog, and then close the Cognitive
Controller Editor.<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e03"></a></span>Two more short steps remain before you can test
the transition.</p>
</li><li>Open
the Behavior Assignments dialog, and create a team from all the
delegates.</li><li>Assign
the cognitive controller (Cognitive Controller) to the team, and close
the dialog.</li><li>Solve
the simulation.<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e02"></a></span>The delegates move toward the box until they're
fairly close, at which point they turn and move directly away.</p>
</li><li>Try
these variations:<!--UList--><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e01"></a></span>
<ul><li>Add
a second transition from the Repel state to the Seek state that
turns the delegates back around after they get a certain distance
away. Hint: You need to change only three items in the first script.</li></ul>

<!--UList--><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7e00"></a></span>
<ul><li>Animate
the position of the box so the delegates have to chase it before they
can get close enough for the transition to begin. Tip: You might
have to increase the End Solve setting.</li></ul>

<!--UList--><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7dff"></a></span>
<ul><li>Use
Edit Multiple Delegates to set random speeds for the delegates,
so they don't all reach the box and turn around at the same time.</li></ul>

</li></ol>














<div class="section"><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7dfe"></a></span>
<p class="section_title_h1"><a name="TOC_ENTRY__d0e33768"></a>Next</p>
<p><span style="display:none"><a name="WS1a9193826455f5ff13cfd6e1136132a36f-7dfd"></a></span>
<span class="hypertext">
<span class="char_link"><a href="WSf742dab041063133fb5604511363e4556c-7ff4.htm"><!--Reference = WSf742dab041063133fb5604511363e4556c-7ff4; Target topic = WSf742dab041063133fb5604511363e4556c-7ff4.htm-->Using
Crowd with Animated Non-Biped Objects</a></span>

</span>
</p>
</div>

<!----><div class="footer-block"><a href="javascript:doComments('./html/ac.cmtdialog.htm');"><span class="comments-link">Please send us your comment about this page</span></a></div><br></body><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
