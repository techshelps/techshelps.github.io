<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><TITLE>CreateFileMapping</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="3lck_3"></A><B>CreateFileMapping  <A HREF="1zj4asp.htm"><IMG SRC="../images/bm1.gif" ALT="" BORDER=0></A>  <A HREF="_0t27t.htm"><IMG SRC="../images/bm3.gif" ALT="" BORDER=0></A>  <A HREF="1wmtmb.htm"><IMG SRC="../images/bm2.gif" ALT="" BORDER=0></A></B></P>

<P>The <B>CreateFileMapping</B> function creates a named or unnamed file-mapping object for the specified file. </P>

<P><B>HANDLE CreateFileMapping(</B></P>

<TABLE cols=2 width=606>

<TR VALIGN="top">
<TD width=60%><B>HANDLE</B> <I>hFile</I><B>,</B></TD>
<TD width=40%>// handle to file to map </TD>
</TR>

<TR VALIGN="top">
<TD width=60%><B>    LPSECURITY_ATTRIBUTES</B> <I>lpFileMappingAttributes</I><B>,</B></TD>
<TD width=40%>// optional security attributes </TD>
</TR>

<TR VALIGN="top">
<TD width=60%><B>    DWORD</B> <I>flProtect</I><B>,</B></TD>
<TD width=40%>// protection for mapping object </TD>
</TR>

<TR VALIGN="top">
<TD width=60%><B>    DWORD</B> <I>dwMaximumSizeHigh</I><B>,</B></TD>
<TD width=40%>// high-order 32 bits of object size  </TD>
</TR>

<TR VALIGN="top">
<TD width=60%><B>    DWORD</B> <I>dwMaximumSizeLow</I><B>,</B></TD>
<TD width=40%>// low-order 32 bits of object size  </TD>
</TR>

<TR VALIGN="top">
<TD width=60%><B>    LPCTSTR</B> <I>lpName</I> </TD>
<TD width=40%>// name of file-mapping object </TD>
</TR>

<TR VALIGN="top">
<TD width=60%><B>   );</B></TD>
<TD width=40%>&nbsp;</TD>
</TR>
</TABLE><BR>

<P></P>

<P><B>Parameters</B></P>

<P><I>hFile</I></P>

<P>Identifies the file from which to create a mapping object. The file must be opened with an access mode compatible with the protection flags specified by the <I>flProtect</I> parameter. It is recommended, though not required, that files you intend to map be opened for exclusive access. </P>

<P>If <I>hFile</I> is (HANDLE)0xFFFFFFFF, the calling process must also specify a mapping object size in the <I>dwMaximumSizeHigh</I> and <I>dwMaximumSizeLow</I> parameters. The function creates a file-mapping object of the specified size backed by the operating-system paging file rather than by a named file in the file system. The file-mapping object can be shared through duplication, through inheritance, or by name. </P>

<P><I>lpFileMappingAttributes</I></P>

<P>Pointer to a <A HREF="be53kg.htm"><B>SECURITY_ATTRIBUTES</B></A> structure that determines whether the returned handle can be inherited by child processes. If <I>lpFileMappingAttributes</I> is NULL, the handle cannot be inherited. </P>

<P><B>Windows NT:</B> The <B>lpSecurityDescriptor</B> member of the structure specifies a security descriptor for the new file-mapping object. If <I>lpFileMappingAttributes</I> is NULL, the file-mapping object gets a default security descriptor. </P>

<P><B>Windows 95:</B> The <B>lpSecurityDescriptor</B> member of the structure is ignored.</P>

<P><I>flProtect</I></P>

<P>Specifies the protection desired for the file view, when the file is mapped. This parameter can be one of the following values: </P>

<TABLE cols=2>

<TR VALIGN="top">
<TD width=34%><B>Value</B></TD>
<TD width=66%><B>Description</B></TD>
</TR>

<TR VALIGN="top">
<TD width=34%>PAGE_READONLY</TD>
<TD width=66%>Gives read-only access to the committed region of pages. An attempt to write to or execute the committed region results in an access violation. The file specified by the <I>hFile</I> parameter must have been created with GENERIC_READ access.</TD>
</TR>

<TR VALIGN="top">
<TD width=34%>PAGE_READWRITE</TD>
<TD width=66%>Gives read-write access to the committed region of pages. The file specified by <I>hFile</I> must have been created with GENERIC_READ and GENERIC_WRITE access.</TD>
</TR>

<TR VALIGN="top">
<TD width=34%>PAGE_WRITECOPY</TD>
<TD width=66%>Gives copy on write access to the committed region of pages. The files specified by the <I>hFile</I> parameter must have been created with GENERIC_READ and GENERIC_WRITE access.</TD>
</TR>
</TABLE><BR>

<P></P>

<P>In addition, an application can specify certain section attributes by combining (using the bitwise OR operator) one or more of the following section attribute values with one of the preceding page protection values: </P>

<TABLE cols=2>

<TR VALIGN="top">
<TD width=29%><B>Value</B></TD>
<TD width=71%><B>Description</B></TD>
</TR>

<TR VALIGN="top">
<TD width=29%>SEC_COMMIT</TD>
<TD width=71%>Allocates physical storage in memory or in the paging file on disk for all pages of a section. This is the default setting.</TD>
</TR>

<TR VALIGN="top">
<TD width=29%>SEC_IMAGE</TD>
<TD width=71%>The file specified for a section's file mapping is an executable image file. Because the mapping information and file protection are taken from the image file, no other attributes are valid with SEC_IMAGE.</TD>
</TR>

<TR VALIGN="top">
<TD width=29%>SEC_NOCACHE</TD>
<TD width=71%>All pages of a section are to be set as non-cacheable. This attribute is intended for architectures requiring various locking structures to be in memory that is never fetched into the processor's. On 80x86 and MIPS machines, using the cache for these structures only slows down the performance as the hardware keeps the caches coherent. Some device drivers require noncached data so that programs can write through to the physical memory. SEC_NOCACHE requires either the SEC_RESERVE or SEC_COMMIT to also be set.</TD>
</TR>

<TR VALIGN="top">
<TD width=29%>SEC_RESERVE</TD>
<TD width=71%>Reserves all pages of a section without allocating physical storage. The reserved range of pages cannot be used by any other allocation operations until it is released. Reserved pages can be committed in subsequent calls to the <A HREF="1m7v8go.htm"><B>VirtualAlloc</B></A> function. This attribute is valid only if the <I>hFile</I> parameter is (HANDLE)0xFFFFFFFF; that is, a file mapping object backed by the operating sytem paging file.</TD>
</TR>
</TABLE><BR>

<P></P>

<P><I>dwMaximumSizeHigh</I></P>

<P>Specifies the high-order 32 bits of the maximum size of the file-mapping object. </P>

<P><I>dwMaximumSizeLow</I></P>

<P>Specifies the low-order 32 bits of the maximum size of the file-mapping object. If this parameter and <I>dwMaximumSizeHig </I>are zero, the maximum size of the file-mapping object is equal to the current size of the file identified by <I>hFile</I>. </P>

<P><I>lpName</I></P>

<P>Points to a null-terminated string specifying the name of the mapping object. The name can contain any character except the backslash character (\). </P>

<P>If this parameter matches the name of an existing named mapping object, the function requests access to the mapping object with the protection specified by <I>flProtect</I>. </P>

<P>If this parameter is NULL, the mapping object is created without a name. </P>

<P></P>

<P><B>Return Values</B></P>

<P>If the function succeeds, the return value is a handle to the file-mapping object. If the object existed before the function call, the <A HREF="11c2vs7.htm"><B>GetLastError</B></A> function returns ERROR_ALREADY_EXISTS, and the return value is a valid handle to the existing file-mapping object (with its current size, not the new specified size. If the mapping object did not exist, <B>GetLastError</B> returns zero. </P>

<P>If the function fails, the return value is NULL. To get extended error information, call <B>GetLastError</B>. </P>

<P><B>Remarks</B></P>

<P>After a file-mapping object has been created, the size of the file must not exceed the size of the file-mapping object; if it does, not all of the file's contents will be available for sharing. </P>

<P>If an application specifies a size for the file-mapping object that is larger than the size of the actual named file on disk, the file on disk is grown to match the specified size of the file-mapping object. </P>

<P>The handle that <B>CreateFileMapping</B> returns has full access to the new file-mapping object. It can be used with any function that requires a handle to a file-mapping object. File-mapping objects can be shared either through process creation, through handle duplication, or by name. For information on duplicating handles, see <A HREF="1ojqkwy.htm"><B>DuplicateHandle</B></A>. For information on opening a file-mapping object by name, see <A HREF="68g5u2.htm"><B>OpenFileMapping</B></A>. </P>

<P><B>Windows 95:</B> File handles that have been used to create file-mapping objects must <I>not</I> be used in subsequent calls to file I/O functions, such as <B>ReadFile</B> and <B>WriteFile</B>. In general, if a file handle has been used in a successful call to the <B>CreateFileMapping</B> function, do not use that handle unless you first close the corresponding file-mapping object.</P>

<P>Creating a file-mapping object creates the potential for mapping a view of the file but does not map the view. The <A HREF="2a9rvat.htm"><B>MapViewOfFile</B></A> and <A HREF="26u8i2.htm"><B>MapViewOfFileEx</B></A> functions map a view of a file into a process's address space. </P>

<P>With one important exception, file views derived from a single file-mapping object are coherent, or identical, at a given time. If multiple processes have handles of the same file-mapping object, they see a coherent view of the data when they map a view of the file. </P>

<P>The exception has to do with remote files. Although <B>CreateFileMapping</B> works with remote files, it does not keep them coherent. For example, if two computers both map a file as writable, and both change the same page, each computer will only see its own writes to the page. When the data gets updated on the disk, it is not merged. </P>

<P>A mapped file and a file accessed by means of the input and output (I/O) functions (<A HREF="cjnd8p.htm"><B>ReadFile</B></A> and <A HREF="g0sox_.htm"><B>WriteFile</B></A>) are not necessarily coherent. </P>

<P>To fully close a file mapping object, an application must unmap all mapped views of the file mapping object by calling <A HREF="18o.gtq.htm"><B>UnmapViewOfFile</B></A>, and close the file mapping object handle by calling <A HREF="ngwwie.htm"><B>CloseHandle</B></A>. The order in which these functions are called does not matter. The call to <B>UnmapViewOfFile</B> is necessary because mapped views of a file mapping object maintain internal open handles to the object, and a file mapping object will not close until all open handles to it are closed. </P>

<P><B>Example</B></P>

<P>To implement a mapping-object creation function that fails if the object already exists, an application can use the following code. </P>

<P>hMap = CreateFileMapping(...);  </P>

<P>if (hMap != NULL &amp;&amp; GetLastError() == ERROR_ALREADY_EXISTS) { </P>

<P>CloseHandle(hMap); </P>

<P>hMap = NULL; </P>

<P>} </P>

<P>return hMap; </P>

<P></P>

<P><B>See Also</B></P>

<P><A HREF="ngwwie.htm"><B>CloseHandle</B></A>, <A HREF="1ojqkwy.htm"><B>DuplicateHandle</B></A>, <A HREF="2a9rvat.htm"><B>MapViewOfFile</B></A>, <A HREF="26u8i2.htm"><B>MapViewOfFileEx</B></A>, <A HREF="68g5u2.htm"><B>OpenFileMapping</B></A>, <A HREF="cjnd8p.htm"><B>ReadFile</B></A>, <A HREF="be53kg.htm"><B>SECURITY_ATTRIBUTES</B></A>, <A HREF="18o.gtq.htm"><B>UnmapViewOfFile</B></A>, <A HREF="1m7v8go.htm"><B>VirtualAlloc</B></A>, <A HREF="g0sox_.htm"><B>WriteFile</B></A></P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
