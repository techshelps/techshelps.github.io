<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Creating the Entry-Point Function</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="0r8gtf"></A><B>Creating the Entry-Point Function</B></P>

<P>File Manager communicates with an extension DLL through the <B>FMExtensionProc</B> callback function. Make sure to export this function by listing it in the <B>EXPORTS</B> statement of your extension's module-definition (.DEF) file. The <B>FMExtensionProc</B> function handles the messages listed in the preceding section by performing the tasks listed in the following table. </P>

<TABLE cols=2>

<TR VALIGN="top">
<TD width=53%><B>Task</B></TD>
<TD width=47%><B>Action</B></TD>
</TR>

<TR VALIGN="top">
<TD width=53%>Initializing the extension (FMEVENT_LOAD)</TD>
<TD width=47%>Provides File Manager with the name and handle of the menu and saves the menu-item delta value.</TD>
</TR>

<TR VALIGN="top">
<TD width=53%>Initializing the menu (FMEVENT_INITMENU)</TD>
<TD width=47%>Initializes all top-level menu items and the items in any submenus.</TD>
</TR>

<TR VALIGN="top">
<TD width=53%>Initializing the toolbar (FMEVENT_TOOLBARLOAD)</TD>
<TD width=47%>Provides File Manager with information about the buttons to add to the toolbar, including the command identifier, Help string identifier, styles, and bitmap identifier.</TD>
</TR>

<TR VALIGN="top">
<TD width=53%>Processing menu selections</TD>
<TD width=47%>Carries out commands that the user chooses from the extension's menu.</TD>
</TR>

<TR VALIGN="top">
<TD width=53%>Processing file selections (FMEVENT_SELCHANGE)</TD>
<TD width=47%>Queries File Manager for information about the file that the user has selected from the directory window or Search Results window.</TD>
</TR>

<TR VALIGN="top">
<TD width=53%>Updating items in the menu (FMEVENT_USER_REFRESH)</TD>
<TD width=47%>Modifies the menu as appropriate when the user chooses File Manager's Refresh command from the Window menu.</TD>
</TR>

<TR VALIGN="top">
<TD width=53%>Providing menu item help strings (FMEVENT_HELPSTRING)</TD>
<TD width=47%>Provides File Manager with a help string for a specified command in a specified menu. File Manager displays this string in the area at the bottom left of the window.</TD>
</TR>

<TR VALIGN="top">
<TD width=53%>Passing menu item help requests on to WinHelp (FMEVENT_HELPMENUITEM)</TD>
<TD width=47%>Provides WinHelp with the window passed by File Manager and menu item information,</TD>
</TR>

<TR VALIGN="top">
<TD width=53%>Quitting the extension DLL (FMEVENT_UNLOAD)</TD>
<TD width=47%>Frees any memory allocated and prepares to exit.</TD>
</TR>
</TABLE><BR>

<P></P>

<P>The <B>FMExtensionProc</B> function is defined as follows. </P>

<P>LONG WINAPI FMExtensionProc(hwnd, wMsg, lParam)  </P>

<P>HWND hwnd; </P>

<P>WORD wMsg; </P>

<P>LONG lParam; </P>

<P></P>

<P>The <I>hwnd</I> parameter identifies the File Manager window. An extension should use this window handle to specify the parent window for any dialog box or message box it must display. It should also use this handle to send query messages to File Manager. The <I>uMsg</I> parameter contains one of the File Manager messages listed previously. The <I>lParam</I> parameter contains a message-specific value. The return value from the <A HREF="1bvwzve.htm"><B>FMExtensionProc</B></A> function depends on the value of the <I>uMsg</I> parameter. </P>

<P>The menu added to File Manager may be a hierarchical (cascaded) menu and may contain grayed, disabled, or checked menu items in addition to command items. Menu items should be text only; owner-drawn menus and bitmap menus are not supported. Changing the bitmap for check marks is not supported. </P>

<P>Whenever File Manager calls the <B>FMExtensionProc</B> function, it waits to refresh its directory windows (for changes in the file system) until after the function returns. This allows the extension to perform large numbers of file operations without excessive repainting on the part of File Manager. It is not necessary for the extension to send the <A HREF="14cgdcd.htm">FM_REFRESH_WINDOWS</A> message to notify File Manager to repaint its directory windows.  </P>

</BODY>
</HTML>
