<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Exception Dispatching</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="r5ghih"></A><B>Exception Dispatching</B></P>

<P>When a hardware or software exception occurs, the processor stops execution at the point at which the exception occurred and transfers control to the system. First, the system saves both the machine state of the current thread and information that describes the exception. The system then attempts to find an exception handler to handle the exception. </P>

<P>The machine state of the thread in which the exception occurred is saved in a <A HREF="2_idl4n.htm"><B>CONTEXT</B></A> structure. This information (called the <I>context record</I>) enables the system to continue execution at the point of the exception if the exception is successfully handled. The description of the exception (called the <I>exception record</I>) is saved in an <A HREF="cvkihi.htm"><B>EXCEPTION_RECORD</B></A> structure. Because it stores the machine-dependent information of the context record separately from the machine-independent information of the exception record, the exception-handling mechanism is portable to different platforms. The information in both the context and exception records is available by means of the <A HREF="5w0o5v.htm"><B>GetExceptionInformation</B></A> function, and can be made available to any exception handlers that are executed as a result of the exception. The exception record includes the following information. </P>

<P>·An exception code that identifies the type of exception. </P>

<P>·Flags indicating whether the exception is continuable. Any attempt to continue execution after a noncontinuable exception generates another exception. </P>

<P>·A pointer to another exception record. This facilitates creation of a linked list of exceptions if nested exceptions occur. </P>

<P>·The address at which the exception occurred. </P>

<P>·An array of 32-bit arguments that provide additional information about the exception. </P>

<P></P>

<P>When an exception occurs in user-mode code, the system goes through the following search for an exception handler: </P>

<P>1.The system first attempts to notify the process's debugger, if any. </P>

<P>2.If the process is not being debugged, or if the associated debugger does not handle the exception, the system attempts to locate a frame-based exception handler by searching the stack frames of the thread in which the exception occurred. The system searches the current stack frame first, then proceeds backward through preceding stack frames. </P>

<P>3.If no frame-based handler can be found, or no frame-based handler handles the exception, the system makes a second attempt to notify the process's debugger. </P>

<P>4.If the process is not being debugged, or if the associated debugger does not handle the exception, the system provides default handling based on the exception type. For most exceptions, the default action is to call the <A HREF="i5ihdk.htm"><B>ExitProcess</B></A> function. </P>

<P></P>

<P>When an exception occurs in kernel-mode code, the system searches the stack frames of the kernel stack in an attempt to locate an exception handler. If a handler cannot be located or no handler handles the exception, the system is shut down as if the <A HREF="hxsw5w.htm"><B>ExitWindows</B></A> function had been called. </P>

</BODY>
</HTML>
