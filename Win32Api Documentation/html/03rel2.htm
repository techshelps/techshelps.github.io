<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Sending Control Requests to a Service</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="03rel2"></A><B>Sending Control Requests to a Service</B></P>

<P>The following example uses the <A HREF="2nu_3f.htm"><B>ControlService</B></A> function to send a control value to a running service. Different control values require different levels of access to the service object. For example, a service object handle must have SERVICE_STOP access to send the SERVICE_CONTROL_STOP code. When <B>ControlService</B> returns, a <A HREF="25uoeu.htm"><B>SERVICE_STATUS</B></A> structure contains the latest status information for the service. </P>

<P>VOID ControlSampleService(DWORD fdwControl)  </P>

<P>{ </P>

<P>SERVICE_STATUS ssStatus; </P>

<P>DWORD fdwAccess; </P>

<P></P>

<P>// The required service object access depends on the control. </P>

<P></P>

<P>switch (fdwControl) </P>

<P>{ </P>

<P>case SERVICE_CONTROL_STOP: </P>

<P>fdwAccess = SERVICE_STOP; </P>

<P>break; </P>

<P></P>

<P>case SERVICE_CONTROL_PAUSE: </P>

<P>case SERVICE_CONTROL_CONTINUE: </P>

<P>fdwAccess = SERVICE_PAUSE_CONTINUE; </P>

<P>break; </P>

<P></P>

<P>case SERVICE_CONTROL_INTERROGATE: </P>

<P>fdwAccess = SERVICE_INTERROGATE; </P>

<P>break; </P>

<P></P>

<P>default: </P>

<P>fdwAccess = SERVICE_INTERROGATE; </P>

<P>} </P>

<P></P>

<P>// Open a handle to the service. </P>

<P></P>

<P>schService = OpenService( </P>

<P>schSCManager,        // SCManager database </P>

<P>TEXT("Sample_Srv"),  // name of service </P>

<P>fdwAccess);          // specify access </P>

<P>if (schService == NULL) </P>

<P>MyErrorExit("OpenService"); </P>

<P></P>

<P>// Send a control value to the service. </P>

<P></P>

<P>if (! ControlService( </P>

<P>schService,   // handle of service </P>

<P>fdwControl,   // control value to send </P>

<P>&amp;ssStatus) )  // address of status info </P>

<P>{</P>

<P>MyErrorExit("ControlService"); </P>

<P>}</P>

<P></P>

<P>// Print the service status. </P>

<P></P>

<P>printf("\nStatus of Sample_Srv: \n"); </P>

<P>printf("  Service Type: 0x%x\n", ssStatus.dwServiceType); </P>

<P>printf("  Current State: 0x%x\n", ssStatus.dwCurrentState); </P>

<P>printf("  Controls Accepted: 0x%x\n", </P>

<P>ssStatus.dwControlsAccepted); </P>

<P>printf("  Exit Code: %d\n", ssStatus.dwWin32ExitCode); </P>

<P>printf("  Service Specific Exit Code: %d\n", </P>

<P>ssStatus.dwServiceSpecificExitCode); </P>

<P>printf("  Check Point: %d\n", ssStatus.dwCheckPoint); </P>

<P>printf("  Wait Hint: %d\n", ssStatus.dwWaitHint); </P>

<P></P>

<P>return; </P>

<P>} </P>

<P></P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
