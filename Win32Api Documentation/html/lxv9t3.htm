<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><TITLE>Adding a Source to the Registry</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="lxv9t3"></A><B>Adding a Source to the Registry</B></P>

<P>You can use the default <B>Application</B> event log without adding your source name to the registry. However, Event Viewer will not be able to map your <A HREF="lf4goi.htm">event identifier</A> codes to message strings unless you register your source and provide a message-file name. </P>

<P>You can add a new source name to the registry by opening a new registry subkey under the <B>Application</B> key and adding registry values to the new subkey. The following code sample opens a new source name called SamplApp and adds to the new subkey a message-file name and a bitmask of supported types. </P>

<P>HKEY hk;  </P>

<P>DWORD dwData; </P>

<P>UCHAR szBuf[80]; </P>

<P></P>

<P>/* </P>

<P>* Add your source name as a subkey under the Application </P>

<P>* key in the EventLog service portion of the registry. </P>

<P>*/ </P>

<P></P>

<P>if (RegCreateKey(HKEY_LOCAL_MACHINE, </P>

<P>"SYSTEM\\CurrentControlSet\\Services\ </P>

<P>\\EventLog\\Application\\SamplApp", </P>

<P>&amp;hk)) </P>

<P>ErrorExit("could not create registry key"); </P>

<P></P>

<P>/* Set the Event ID message-file name. */ </P>

<P></P>

<P>strcpy(szBuf, "%SystemRoot%\\System\\SamplApp.dll"); </P>

<P></P>

<P>/* Add the Event ID message-file name to the subkey. */ </P>

<P></P>

<P>if (RegSetValueEx(hk,             /* subkey handle         */ </P>

<P>"EventMessageFile",       /* value name            */ </P>

<P>0,                        /* must be zero          */ </P>

<P>REG_EXPAND_SZ,            /* value type            */ </P>

<P>(LPBYTE) szBuf,           /* address of value data */ </P>

<P>strlen(szBuf) + 1))       /* length of value data  */ </P>

<P>ErrorExit("could not set event message file"); </P>

<P></P>

<P>/* Set the supported types flags. */ </P>

<P></P>

<P>dwData = EVENTLOG_ERROR_TYPE | EVENTLOG_WARNING_TYPE | </P>

<P>EVENTLOG_INFORMATION_TYPE; </P>

<P></P>

<P>if (RegSetValueEx(hk,      /* subkey handle                */ </P>

<P>"TypesSupported",  /* value name                   */ </P>

<P>0,                 /* must be zero                 */ </P>

<P>REG_DWORD,         /* value type                   */ </P>

<P>(LPBYTE) &amp;dwData,  /* address of value data        */ </P>

<P>sizeof(DWORD)))    /* length of value data         */ </P>

<P>ErrorExit("could not set supported types"); </P>

<P></P>

<P>RegCloseKey(hk); </P>

<P></P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
