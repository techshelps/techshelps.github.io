<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><TITLE>Capturing an Image</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="11dyxe6"></A><B>Capturing an Image</B></P>

<P>You can use a bitmap to capture an image, and you can store the captured image in memory, display it at a different location in your application's window, or display it in another window. </P>

<P>In some cases, you may want your application to capture images and store them only temporarily. For example, when you scale or "zoom" a picture created in a drawing application, the application must temporarily save the normal view of the image and display the zoomed view. Later, when the user selects the normal view, the application must replace the zoomed image with a copy of the normal view that it temporarily saved. </P>

<P>To store an image temporarily, your application must call <A HREF="5zsb35.htm"><B>CreateCompatibleDC</B></A> to create a DC that is compatible with the current window DC. After you create a compatible DC, you create a bitmap with the appropriate dimensions by calling the <A HREF="21o2qyp.htm"><B>CreateCompatibleBitmap</B></A> function and then select it into this device context by calling the <A HREF="4n4gw4.htm"><B>SelectObject</B></A> function. </P>

<P>After the compatible device context is created and the appropriate bitmap has been selected into it, you can capture the image. The Win32 API provides the <A HREF="31vu054.htm"><B>BitBlt</B></A> function to capture images. This function performs a bit block transfer ¾ that is, it copies data from a source bitmap into a destination bitmap. Because it copies data from bitmaps, you'd expect that two arguments to this function would be bitmap handles; however, this is not the case. Instead, <B>BitBlt</B> receives handles that identify two device contexts and copies the bitmap data from a bitmap selected into the source DC into a bitmap selected into the target DC. In this case, the target DC is the compatible DC, so when <B>BitBlt</B> completes the transfer, the image has been stored in memory. To redisplay the image, call <B>BitBlt</B> a second time, specifying the compatible DC as the source DC and a window (or printer) DC as the target DC. </P>

<P>The following example code, from an application that captures an image of the entire desktop, creates a compatible device context and a bitmap with the appropriate dimensions, selects the bitmap into the compatible DC, and then copies the image using the <A HREF="31vu054.htm"><B>BitBlt</B></A> function. </P>

<P>/*  </P>

<P>* Create a normal DC and a memory DC for the entire screen. The </P>

<P>* normal DC provides a "snapshot" of the screen contents. The </P>

<P>* memory DC keeps a copy of this "snapshot" in the associated </P>

<P>* bitmap. </P>

<P>*/ </P>

<P></P>

<P>hdcScreen = CreateDC("DISPLAY", NULL, NULL, NULL); </P>

<P>hdcCompatible = CreateCompatibleDC(hdcScreen); </P>

<P></P>

<P>/* Create a compatible bitmap for hdcScreen. */ </P>

<P></P>

<P>hbmScreen = CreateCompatibleBitmap(hdcScreen, </P>

<P>GetDeviceCaps(hdcScreen, HORZRES), </P>

<P>GetDeviceCaps(hdcScreen, VERTRES)); </P>

<P></P>

<P>if (hbmScreen == 0) </P>

<P>errhandler("hbmScreen", hwnd); </P>

<P></P>

<P>/* Select the bitmaps into the compatible DC. */ </P>

<P></P>

<P>if (!SelectObject(hdcCompatible, hbmScreen)) </P>

<P>errhandler("Compatible Bitmap Selection", hwnd); </P>

<P></P>

<P>/* Hide the application window. */ </P>

<P></P>

<P>ShowWindow(hwnd, SW_HIDE); </P>

<P></P>

<P>/* </P>

<P>* Copy color data for the entire display into a </P>

<P>* bitmap that is selected into a compatible DC. </P>

<P>*/ </P>

<P></P>

<P>if (!BitBlt(hdcCompatible, </P>

<P>0,0, </P>

<P>bmp.bmWidth, bmp.bmHeight, </P>

<P>hdcScreen, </P>

<P>0,0, </P>

<P>SRCCOPY)) </P>

<P></P>

<P>errhandler("Screen to Compat Blt Failed", hwnd); </P>

<P></P>

<P>/* Redraw the application window. */ </P>

<P></P>

<P>ShowWindow(hwnd, SW_SHOW); </P>

<P></P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
