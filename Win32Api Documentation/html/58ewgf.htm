<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><TITLE>Using NDdeShareAdd to Create a DDE Share</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="58ewgf"></A><B>Using NDdeShareAdd to Create a DDE Share</B></P>

<P>The <A HREF="2dm59g.htm"><B>NDdeShareAdd</B></A> function is used by a DDE server application to create a DDE share.</P>

<P>Before creating a DDE share, it is a good idea to verify that the proposed share name and topic name are valid by using the <A HREF="1fvl4l5.htm"><B>NDdeIsValidShareName</B></A> and <A HREF="8ji_dj.htm"><B>NDdeIsValidAppTopicList</B></A> functions. These functions are also called by <B>NDdeShareAdd</B>.</P>

<P>The following example demonstrates how to create a DDE share. It uses a NULL discretionary access control list (DACL) to grant write access to all users. Note that this is not the same as specifying NULL in the <I>pSD</I> parameter of <B>NDdeShareAdd</B>.</P>

<P>BOOL MyCreateDdeShare( LPTSTR lpszShareName, LPTSTR lpszTopicList )</P>

<P>{</P>

<P>NDDESHAREINFO ndsi;</P>

<P>PSECURITY_DESCRIPTOR pSD = NULL;</P>

<P></P>

<P>// Where lpszShareName is the share name.</P>

<P>if( NDdeIsValidShareName( lpszShareName ) == FALSE )</P>

<P>return FALSE;</P>

<P>// Where lpszTopicList is a list of null-terminated strings terminated </P>

<P>// by another null character.</P>

<P>if( NDdeIsValidAppTopicList( lpszTopicList ) == FALSE )</P>

<P>return FALSE;</P>

<P>// Fill in the NDDESHAREINFO structure.</P>

<P>ndsi.lRevision = 1;</P>

<P>ndsi.lpszShareName = lpszShareName;</P>

<P>ndsi.lShareType = SHARE_TYPE_STATIC;</P>

<P>ndsi.lpszAppTopicList = lpszTopicList;</P>

<P>ndsi.fSharedFlag = TRUE;</P>

<P>ndsi.fService = FALSE;</P>

<P>ndsi.fStartAppFlag = TRUE;</P>

<P>ndsi.nCmdShow = SW_SHOWNORMAL;</P>

<P>ndsi.cNumItems = 0;</P>

<P>ndsi.lpszItemList = "";</P>

<P>// Create a security descriptor to allow write access.</P>

<P>pSD = (PSECURITY_DESCRIPTOR) LocalAlloc( </P>

<P>LPTR, </P>

<P>SECURITY_DESCRIPTOR_MIN_LENGTH );</P>

<P>InitializeSecurityDescriptor( pSD, SECURITY_DESCRIPTOR_REVISION );</P>

<P>SetSecurityDescriptorDacl( pSD, TRUE, (PACL)NULL, FALSE );</P>

<P>// Delete possible old DDE share.</P>

<P>NDdeShareDel(</P>

<P>NULL,</P>

<P>lpszShareName,</P>

<P>0</P>

<P>);</P>

<P>// Create the DDE share.</P>

<P>NDdeShareAdd( </P>

<P>NULL,</P>

<P>2,</P>

<P>pSD,</P>

<P>(LPBYTE)&amp;ndsi,</P>

<P>sizeof(NDDESHAREINFO)</P>

<P>);</P>

<P>LocalFree( pSD );</P>

<P>return TRUE;</P>

<P>}</P>

<P></P>

<P>The following example shows how you could call the MyCreateDdeShare function to create the share MyDdeShare$:</P>

<P>char *TopicList = "\0\0MyApp|MyTopic\0\0";</P>

<P></P>

<P>MyCreateDdeShare( "MyDdeShare$", TopicList );</P>

<P></P>

<P>This share name ends with a dollar sign ($), indicating that it is a static DDE share. Topic strings are provided only for the static-type DDE share.</P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
