<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Initiating a Data Link</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="dcixzi"></A><B>Initiating a Data Link</B></P>

<P>The client initiates a data link by posting a <A HREF="1fmiugc.htm">WM_DDE_ADVISE</A> message, as shown in the following example. </P>

<P>if (!(hOptions = GlobalAlloc(GMEM_MOVEABLE | GMEM_DDESHARE,  </P>

<P>sizeof(DDEADVISE)))) </P>

<P>return; </P>

<P>if (!(lpOptions = (DDEADVISE FAR*) GlobalLock(hOptions))) { </P>

<P>GlobalFree(hOptions); </P>

<P>return; </P>

<P>} </P>

<P></P>

<P>lpOptions-&gt;cfFormat = CF_TEXT; </P>

<P>lpOptions-&gt;fAckReq = TRUE; </P>

<P>lpOptions-&gt;fDeferUpd = FALSE; </P>

<P>GlobalUnlock(hOptions); </P>

<P>if ((atomItem = GlobalAddAtom(szItemName)) != 0) { </P>

<P>if (!(PostMessage(hwndServerDDE, </P>

<P>WM_DDE_ADVISE, </P>

<P>(WPARAM) hwndClientDDE, </P>

<P>PackDDElParam(WM_DDE_ADVISE, (UINT) hOptions, </P>

<P>atomItem)))) { </P>

<P>GlobalDeleteAtom(atomItem); </P>

<P>GlobalFree(hOptions); </P>

<P>FreeDDElParam(WM_DDE_ADVISE, lParam); </P>

<P>} </P>

<P>} </P>

<P></P>

<P>if (atomItem == 0) { </P>

<P></P>

<P>. </P>

<P>. /* error handling */ </P>

<P>. </P>

<P></P>

<P>} </P>

<P></P>

<P>In this example, the client application sets the <B>fDeferUpd</B> flag of the <A HREF="1fmiugc.htm">WM_DDE_ADVISE</A> message to FALSE. This directs the server application to send the data to the client whenever the data changes. </P>

<P>If the server is unable to service the WM_DDE_ADVISE request, it sends the client a negative <A HREF="9k0..a.htm">WM_DDE_ACK</A> message. But if the server has access to the item and can render it in the requested format, the server notes the new link (recalling the flags specified in the <I>hOptions</I> parameter) and sends the client a positive WM_DDE_ACK message. From then on, until the client issues a matching <A HREF="227e00g.htm">WM_DDE_UNADVISE</A> message, the server sends the new data to the client every time the value of the item changes in the server. </P>

<P>The WM_DDE_ADVISE message establishes the format of the data to be exchanged during the link. If the client attempts to establish another link with the same item but is using a different data format, the server can choose to reject the second data format or attempt to support it. If a warm link has been established for any data item, the server can support only one data format at a time. This is because the <A HREF="4uoa_rr.htm">WM_DDE_DATA</A> message for a warm link has a NULL data handle, which otherwise contains the format information. Thus, a server must reject all warm links for an item already linked, and must reject all links for an item that has warm links. Another interpretation may be that the server changes the format and the hot or warm state of a link when a second link is requested for the same data item. </P>

<P>In general, client applications should not attempt to establish more than one link at a time for a data item. </P>

</BODY>
</HTML>
