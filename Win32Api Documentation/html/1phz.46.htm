<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Opening an Enhanced Metafile and Displaying Its Contents</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="1phz.46"></A><B>Opening an Enhanced Metafile and Displaying Its Contents</B></P>

<P>This section contains an example demonstrating how an application opens an enhanced metafile stored on disk and displays the associated picture in the client area. </P>

<P>The example uses the Open common dialog box to enable the user to select an enhanced metafile from a list of existing files. It then passes the name of the selected file to the <A HREF="102w0xe.htm"><B>GetEnhMetaFile</B></A> function, which returns a handle identifying the file. This handle is passed to the <A HREF="1p5tba.htm"><B>PlayEnhMetaFile</B></A> function in order to display the picture. </P>

<P>LoadString(hInst, IDS_FILTERSTRING,  </P>

<P>(LPSTR)szFilter, sizeof(szFilter)); </P>

<P></P>

<P>/* </P>

<P>* Replace occurrences of '%' string separator </P>

<P>* with '\0'. </P>

<P>*/ </P>

<P></P>

<P>for (i=0; szFilter[i]!='\0'; i++) </P>

<P>if (szFilter[i] == '%') </P>

<P>szFilter[i] = '\0'; </P>

<P></P>

<P>LoadString(hInst, IDS_DEFEXTSTRING, </P>

<P>(LPSTR)szDefExt, sizeof(szFilter)); </P>

<P></P>

<P></P>

<P>/* </P>

<P>* Use the OpenFilename common dialog box </P>

<P>* to obtain the desired filename. </P>

<P>*/ </P>

<P></P>

<P>szFile[0] = '\0'; </P>

<P>Ofn.lStructSize = sizeof(OPENFILENAME); </P>

<P>Ofn.hwndOwner = hWnd; </P>

<P>Ofn.lpstrFilter = szFilter; </P>

<P>Ofn.lpstrCustomFilter = (LPSTR)NULL; </P>

<P>Ofn.nMaxCustFilter = 0L; </P>

<P>Ofn.nFilterIndex = 1L; </P>

<P>Ofn.lpstrFile = szFile; </P>

<P>Ofn.nMaxFile = sizeof(szFile); </P>

<P>Ofn.lpstrFileTitle = szFileTitle; </P>

<P>Ofn.nMaxFileTitle = sizeof(szFileTitle); </P>

<P>Ofn.lpstrInitialDir = (LPSTR) NULL; </P>

<P>Ofn.lpstrTitle = (LPSTR)NULL; </P>

<P>Ofn.Flags = OFN_SHOWHELP | OFN_PATHMUSTEXIST | OFN_FILEMUSTEXIST; </P>

<P>Ofn.nFileOffset = 0; </P>

<P>Ofn.nFileExtension = 0; </P>

<P>Ofn.lpstrDefExt = szDefExt; </P>

<P></P>

<P>GetOpenFileName(&amp;Ofn); </P>

<P></P>

<P>/* Open the metafile. */ </P>

<P></P>

<P>hemf = GetEnhMetaFile(Ofn.lpstrFile); </P>

<P></P>

<P>/* Retrieve a handle to a window DC. */ </P>

<P></P>

<P>hDC = GetDC(hWnd); </P>

<P></P>

<P>/* Retrieve the client rectangle dimensions. */ </P>

<P></P>

<P>GetClientRect(hWnd, &amp;rct); </P>

<P></P>

<P>/* Draw the picture. */ </P>

<P></P>

<P>PlayEnhMetaFile(hDC, hemf, &amp;rct); </P>

<P></P>

<P>/* Release the metafile handle. */ </P>

<P></P>

<P>DeleteEnhMetaFile(hemf); </P>

<P></P>

<P>/* Release the window DC. */ </P>

<P></P>

<P>ReleaseDC(hWnd, hDC); </P>

<P></P>

</BODY>
</HTML>
