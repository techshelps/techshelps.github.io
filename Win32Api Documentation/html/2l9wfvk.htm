<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><TITLE>Starting a Service</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="2l9wfvk"></A><B>Starting a Service</B></P>

<P>To start a service, the following example opens a handle to an installed database and then specifies the handle in a call to the <A HREF="1osmk1p.htm"><B>StartService</B></A> function. It can be used to start either a service or a driver service, but this example assumes that a service is being started. After starting the service, the program uses the members of the <A HREF="25uoeu.htm"><B>SERVICE_STATUS</B></A> structure returned by the <A HREF="jps..c.htm"><B>QueryServiceStatus</B></A> function to track the progress of the service. </P>

<P>VOID StartSampleService()  </P>

<P>{ </P>

<P>SERVICE_STATUS ssStatus; </P>

<P>DWORD dwOldCheckPoint; </P>

<P></P>

<P>schService = OpenService( </P>

<P>schSCManager,          // SCM database </P>

<P>TEXT("Sample_Srv"),    // service name</P>

<P>SERVICE_ALL_ACCESS); </P>

<P></P>

<P>if (schService == NULL) </P>

<P>MyErrorExit("OpenService"); </P>

<P></P>

<P>if (!StartService(</P>

<P>schService,  // handle to service </P>

<P>0,           // number of arguments </P>

<P>NULL) )      // no arguments </P>

<P>{</P>

<P>MyErrorExit("StartService"); </P>

<P>}</P>

<P>else </P>

<P>printf("Service start pending\n"); </P>

<P></P>

<P>// Check the status until the service is running. </P>

<P></P>

<P>if (!QueryServiceStatus( </P>

<P>schService,   // handle to service </P>

<P>&amp;ssStatus) )  // address of status information</P>

<P>MyErrorExit("QueryServiceStatus"); </P>

<P></P>

<P>while (ssStatus.dwCurrentState != SERVICE_RUNNING) </P>

<P>{ </P>

<P>// Save the current checkpoint. </P>

<P></P>

<P>dwOldCheckPoint = ssStatus.dwCheckPoint; </P>

<P></P>

<P>// Wait for the specified interval. </P>

<P></P>

<P>Sleep(ssStatus.dwWaitHint); </P>

<P></P>

<P>// Check the status again. </P>

<P></P>

<P>if (!QueryServiceStatus( </P>

<P>schService,   // handle to service </P>

<P>&amp;ssStatus) )  // address of status information</P>

<P>break; </P>

<P></P>

<P>// Break if the checkpoint has not been incremented. </P>

<P></P>

<P>if (dwOldCheckPoint &gt;= ssStatus.dwCheckPoint) </P>

<P>break; </P>

<P>} </P>

<P></P>

<P>if (ssStatus.dwCurrentState == SERVICE_RUNNING) </P>

<P>printf("StartService SUCCESS\n"); </P>

<P>else </P>

<P>{ </P>

<P>printf("\nService not started: \n"); </P>

<P>printf("  Current State: %d\n", </P>

<P>ssStatus.dwCurrentState); </P>

<P>printf("  Exit Code: %d\n", ssStatus.dwWin32ExitCode); </P>

<P>printf("  Service Specific Exit Code: %d\n", </P>

<P>ssStatus.dwServiceSpecificExitCode); </P>

<P>printf("  Check Point: %d\n", ssStatus.dwCheckPoint); </P>

<P>printf("  Wait Hint: %d\n", ssStatus.dwWaitHint); </P>

<P>} </P>

<P></P>

<P>CloseServiceHandle(schService); </P>

<P>} </P>

<P></P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
