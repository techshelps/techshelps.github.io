<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>AccessCheckAndAuditAlarm</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="42cfuj6"></A><B>AccessCheckAndAuditAlarm  <A HREF="2o1elan.htm"><IMG SRC="../images/bm1.gif" ALT="" BORDER=0></A>  <A HREF="1966ja.htm"><IMG SRC="../images/bm3.gif" ALT="" BORDER=0></A>  <A HREF="afqqmm.htm"><IMG SRC="../images/bm2.gif" ALT="" BORDER=0></A></B></P>

<P>The <B>AccessCheckAndAuditAlarm</B> function performs an access validation and generates corresponding audit messages. An application can also use this function to determine whether necessary privileges are held by a client process. This function is generally used by a server application impersonating a client process. Alarms are not supported in the current version of Windows NT. </P>

<P><B>BOOL AccessCheckAndAuditAlarm(</B></P>

<TABLE cols=2 width=602>

<TR VALIGN="top">
<TD width=55%><B>LPCTSTR</B> <I>SubsystemName</I><B>,</B></TD>
<TD width=45%>// address of string for subsystem name</TD>
</TR>

<TR VALIGN="top">
<TD width=55%><B>    LPVOID</B> <I>HandleId</I><B>,</B></TD>
<TD width=45%>// address of handle identifier</TD>
</TR>

<TR VALIGN="top">
<TD width=55%><B>    LPTSTR</B> <I>ObjectTypeName</I><B>,</B></TD>
<TD width=45%>// address of string for object type</TD>
</TR>

<TR VALIGN="top">
<TD width=55%><B>    LPTSTR</B> <I>ObjectName</I><B>,</B></TD>
<TD width=45%>// address of string for object name</TD>
</TR>

<TR VALIGN="top">
<TD width=55%><B>    PSECURITY_DESCRIPTOR</B> <I>SecurityDescriptor</I><B>,</B></TD>
<TD width=45%>// address of security descriptor</TD>
</TR>

<TR VALIGN="top">
<TD width=55%><B>    DWORD</B> <I>DesiredAccess</I><B>,</B></TD>
<TD width=45%>// mask for requested access rights</TD>
</TR>

<TR VALIGN="top">
<TD width=55%><B>    PGENERIC_MAPPING</B> <I>GenericMapping</I><B>,</B></TD>
<TD width=45%>// address of GENERIC_MAPPING</TD>
</TR>

<TR VALIGN="top">
<TD width=55%><B>    BOOL</B> <I>ObjectCreation</I><B>,</B></TD>
<TD width=45%>// object-creation flag</TD>
</TR>

<TR VALIGN="top">
<TD width=55%><B>    LPDWORD</B> <I>GrantedAccess</I><B>,</B></TD>
<TD width=45%>// address of mask for granted rights</TD>
</TR>

<TR VALIGN="top">
<TD width=55%><B>    LPBOOL</B> <I>AccessStatus</I><B>,</B></TD>
<TD width=45%>// address of flag for results</TD>
</TR>

<TR VALIGN="top">
<TD width=55%><B>    LPBOOL</B> <I>pfGenerateOnClose</I> </TD>
<TD width=45%>// pointer to flag for audit generation</TD>
</TR>

<TR VALIGN="top">
<TD width=55%><B>   );</B></TD>
<TD width=45%>&nbsp;</TD>
</TR>
</TABLE><BR>

<P></P>

<P><B>Parameters</B></P>

<P><I>SubsystemName</I></P>

<P>Pointer to a null-terminated string specifying the name of the subsystem calling the function ¾ for example, "DEBUG" or "WIN32." </P>

<P><I>HandleId</I></P>

<P>Points to a unique 32-bit value representing the client's handle to the object. If the access is denied, this value is ignored and may be reused. </P>

<P><I>ObjectTypeName</I></P>

<P>Points to a null-terminated string specifying the type of object being created or accessed. This string appears in the audit log for the object. </P>

<P><I>ObjectName</I></P>

<P>Points to a null-terminated string specifying the name of the object being created or accessed. This string appears in the audit log for the object. </P>

<P><I>SecurityDescriptor</I></P>

<P>Points to the <A HREF="188mr8k.htm"><B>SECURITY_DESCRIPTOR</B></A> structure against which access is checked. </P>

<P><I>DesiredAccess</I></P>

<P>Specifies an access mask giving the requested access rights. This mask must have been mapped to contain no generic access rights by the <A HREF="16rli2z.htm"><B>MapGenericMask</B></A> function. </P>

<P><I>GenericMapping</I></P>

<P>Points to the <A HREF="il_uxb.htm"><B>GENERIC_MAPPING</B></A> structure associated with the type of object being examined. </P>

<P><I>ObjectCreation</I></P>

<P>Specifies a flag that determines whether the calling application will create a new object when access is granted. If this flag is TRUE, the application creates a new object; if it is FALSE, the application opens an existing object. </P>

<P><I>GrantedAccess</I></P>

<P>Points to a buffer that receives an access mask indicating which access rights were granted, if the function succeeds. </P>

<P><I>AccessStatus</I></P>

<P>Points to a flag that the function sets to indicate the success or failure of the access check. If access is granted, this flag is TRUE; otherwise, it is FALSE. </P>

<P><I>pfGenerateOnClose</I></P>

<P>Pointer to a flag set by the audit-generation routine when the function returns. This flag must be passed to the <A HREF="2rh2_le.htm"><B>ObjectCloseAuditAlarm</B></A> function when the object handle is closed. </P>

<P></P>

<P><B>Return Values</B></P>

<P>If the function succeeds, the return value is nonzero.</P>

<P>If the function fails, the return value is zero. To get extended error information, call <A HREF="11c2vs7.htm"><B>GetLastError</B></A>. </P>

<P><B>Remarks</B></P>

<P>The <B>AccessCheckAndAuditAlarm</B> function compares the specified security descriptor with the impersonation access token of the calling process and indicates whether access is granted or denied. If access is granted, the requested access mask becomes the granted access mask for the object. This function also generates any necessary audit messages as a result of the access attempt. </P>

<P>This function requires the calling process to have the SE_AUDIT_NAME privilege. The test for this privilege is performed against the primary token of the calling process, not the impersonation token of the thread. </P>

<P><B>See Also</B></P>

<P><A HREF="6bujdl.htm"><B>AccessCheck</B></A>, <A HREF="12w7mz7.htm"><B>AreAllAccessesGranted</B></A>, <A HREF="3ebe6c.htm"><B>AreAnyAccessesGranted</B></A>, <A HREF="il_uxb.htm"><B>GENERIC_MAPPING</B></A>, <A HREF="16rli2z.htm"><B>MapGenericMask</B></A>, <A HREF="2rh2_le.htm"><B>ObjectCloseAuditAlarm</B></A>, <A HREF="3bm2_wx.htm"><B>ObjectOpenAuditAlarm</B></A>, <A HREF="jzr57u.htm"><B>ObjectPrivilegeAuditAlarm</B></A>, <A HREF="i9o5nf.htm"><B>PrivilegeCheck</B></A>, <A HREF="lk0uwj.htm"><B>PrivilegedServiceAuditAlarm</B></A>, <A HREF="188mr8k.htm"><B>SECURITY_DESCRIPTOR</B></A> </P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
