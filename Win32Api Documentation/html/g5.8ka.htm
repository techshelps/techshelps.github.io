<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Querying a Service's Configuration</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="g5.8ka"></A><B>Querying a Service's Configuration</B></P>

<P>In the following example, a service configuration program uses the <A HREF="20gsky6.htm"><B>OpenService</B></A> function to get a handle with SERVICE_QUERY_CONFIG access to an installed service object. Then the program uses the service object handle in the <A HREF="1j3lx3w.htm"><B>QueryServiceConfig</B></A> function to retrieve the current configuration of the service. </P>

<P>VOID GetSampleServiceConfig()  </P>

<P>{ </P>

<P>LPQUERY_SERVICE_CONFIG lpqscBuf; </P>

<P>DWORD dwBytesNeeded; </P>

<P></P>

<P>// Open a handle to the service. </P>

<P></P>

<P>schService = OpenService( </P>

<P>schSCManager,           // SCManager database </P>

<P>TEXT("Sample_Srv"),     // name of service </P>

<P>SERVICE_QUERY_CONFIG);  // need QUERY access </P>

<P>if (schService == NULL) </P>

<P>MyErrorExit("OpenService"); </P>

<P></P>

<P>// Allocate a buffer for the information configuration. </P>

<P></P>

<P>lpqscBuf = (LPQUERY_SERVICE_CONFIG) LocalAlloc( </P>

<P>LPTR, 4096); </P>

<P>if (lpqscBuf == NULL) </P>

<P>MyErrorExit("LocalAlloc"); </P>

<P></P>

<P>// Get and print the information configuration. </P>

<P></P>

<P>if (! QueryServiceConfig( </P>

<P>schService, </P>

<P>lpqscBuf, </P>

<P>4096, </P>

<P>&amp;dwBytesNeeded) ) </P>

<P>{</P>

<P>MyErrorExit("QueryServiceConfig"); </P>

<P>}</P>

<P></P>

<P>printf("\nSample_Srv configuration: \n"); </P>

<P>printf("  Type: 0x%x\n", lpqscBuf-&gt;dwServiceType); </P>

<P>printf("  Start Type: 0x%x\n", lpqscBuf-&gt;dwStartType); </P>

<P>printf("  Err Control: 0x%x\n", lpqscBuf-&gt;dwErrorControl); </P>

<P>printf("  Binary path: %s\n", lpqscBuf-&gt;lpBinaryPathName); </P>

<P>if (lpqscBuf-&gt;lpLoadOrderGroup != NULL) </P>

<P>printf("  Load order group: %s\n", </P>

<P>lpqscBuf-&gt;lpLoadOrderGroup); </P>

<P>if (lpqscBuf-&gt;dwTagId != 0) </P>

<P>printf("  Tag ID: %d\n", lpqscBuf-&gt;dwTagId); </P>

<P>if (lpqscBuf-&gt;lpDependencies != NULL) </P>

<P>printf("  Dependencies: %s\n", lpqscBuf-&gt;lpDependencies); </P>

<P>if (lpqscBuf-&gt;lpServiceStartName != NULL) </P>

<P>printf("  Start Name: %s\n", </P>

<P>lpqscBuf-&gt;lpServiceStartName); </P>

<P></P>

<P>LocalFree(lpqscBuf); </P>

<P>} </P>

<P></P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
