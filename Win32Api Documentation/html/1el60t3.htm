<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Extracting Icons from Executable Files</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="1el60t3"></A><B>Extracting Icons from Executable Files</B></P>

<P>An application can use the <A HREF="191zn5o.htm"><B>ExtractIcon</B></A> function to retrieve the handle of an icon from a specified executable file, dynamic-link library, or icon file. The following example uses the <A HREF="16oo3wl.htm"><B>DragQueryPoint</B></A> function to retrieve the coordinates of the point where a file was dropped, the <A HREF="12_fnd1.htm"><B>DragQueryFile</B></A> function to retrieve the filename of a dropped file, and the <B>ExtractIcon</B> function to retrieve the handle of the first icon in the file, if any. </P>

<P>POINT pt;  </P>

<P>WORD cFiles;  </P>

<P>HDC hdc; </P>

<P>char lpszFile[80]; </P>

<P>HANDLE hCurrentInst, hicon; </P>

<P></P>

<P>DragQueryPoint((HANDLE) wParam, &amp;pt); </P>

<P></P>

<P>cFiles = DragQueryFile((HANDLE) wParam, 0xFFFF, NULL, NULL); </P>

<P></P>

<P>if(cFiles &gt; 1) { </P>

<P>TextOut(hdc, pt.x, pt.y, </P>

<P>"Please drop only one icon file.", 31); </P>

<P>return FALSE; </P>

<P>} </P>

<P>else { </P>

<P>DragQueryFile((HANDLE) wParam, 0, lpszFile, sizeof(lpszFile)); </P>

<P>hCurrentInst = (HINSTANCE) GetWindowLong(hwnd, GWL_HINSTANCE); </P>

<P>hicon = ExtractIcon(hCurrentInst, lpszFile, 0); </P>

<P>if (hicon == NULL) </P>

<P>TextOut(hdc, pt.x, pt.y, "No icons found.", 15); </P>

<P>else if (hicon == (HICON) 1) </P>

<P>TextOut(hdc, pt.x, pt.y, </P>

<P>"File must be .EXE, .ICO, or .DLL.", 33); </P>

<P>else </P>

<P>DrawIcon(hdc, pt.x, pt.y, hicon); </P>

<P>} </P>

<P></P>

<P>DragFinish((HANDLE) wParam); </P>

<P></P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
