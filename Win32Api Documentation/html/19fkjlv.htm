<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Initiating a Conversation</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="19fkjlv"></A><B>Initiating a Conversation</B></P>

<P>To initiate a DDE conversation, the client sends a <A HREF="1x_rzry.htm">WM_DDE_INITIATE</A> message. Usually, the client broadcasts this message by calling <A HREF="1724msn.htm"><B>SendMessage</B></A>, with -1 as the first parameter. If the application already has the window handle of the server application, it can send the message directly to that window. The client prepares atoms for the application name and topic name by calling <A HREF="1qh2cm4.htm"><B>GlobalAddAtom</B></A>. The client can request conversations with any potential server application and for any potential topic by supplying NULL (wildcard) atoms for the application and topic. </P>

<P>The following example illustrates how the client initiates a conversation, where both the application and topic are specified. </P>

<P>/* Global variable */  </P>

<P></P>

<P>static BOOL fInInitiate = FALSE; </P>

<P>char *szApplication; </P>

<P>char *szTopic; </P>

<P>atomApplication = *szApplication == 0 ? </P>

<P>NULL : GlobalAddAtom((LPSTR) szApplication); </P>

<P>atomTopic = *szTopic == 0 ? </P>

<P>NULL : GlobalAddAtom((LPSTR) szTopic); </P>

<P></P>

<P>fInInitiate = TRUE; </P>

<P>SendMessage((HWND) -1,        /* broadcasts message          */ </P>

<P>WM_DDE_INITIATE,          /* initiates conversation      */ </P>

<P>(WPARAM) hwndClientDDE,   /* handle of client DDE window */ </P>

<P>MAKELONG(atomApplication, /* application-name atom       */ </P>

<P>atomTopic));          /* topic-name atom             */ </P>

<P>fInInitiate = FALSE; </P>

<P>if (atomApplication != NULL) </P>

<P>GlobalDeleteAtom(atomApplication); </P>

<P>if (atomTopic != NULL) </P>

<P>GlobalDeleteAtom(atomTopic); </P>

<P></P>

<P>Note that if your application uses NULL atoms, you need not use the <A HREF="1qh2cm4.htm"><B>GlobalAddAtom</B></A> and <A HREF="r61d9p.htm"><B>GlobalDeleteAtom</B></A> functions. In this example, the client application creates two global atoms containing the name of the server and the name of the topic, respectively. </P>

<P>The client application sends a <A HREF="1x_rzry.htm">WM_DDE_INITIATE</A> message with these two atoms in the <I>lParam</I> parameter of the message. In the call to the <A HREF="1724msn.htm"><B>SendMessage</B></A> function, the special window handle -1 directs Windows to send this message to all other active applications. <B>SendMessage</B> does not return to the client application until all applications that receive the message have, in turn, returned control to Windows. This means that all <A HREF="9k0..a.htm">WM_DDE_ACK</A> messages sent in reply by the server applications are guaranteed to have been processed by the client by the time the <B>SendMessage</B> call has returned. </P>

<P>After <B>SendMessage</B> returns, the client application deletes the global atoms. </P>

<P>Server applications respond according to the logic illustrated in the following diagram. </P>

<P><IMG SRC="../images/bm103.gif" ALT="" BORDER=0></P>

<P>To acknowledge one or more topics, the server must create atoms for each conversation (requiring duplicate application-name atoms if there are multiple topics) and send a <A HREF="9k0..a.htm">WM_DDE_ACK</A> message for each conversation, as illustrated in the following example. </P>

<P>if ((atomApplication = GlobalAddAtom("Server")) != 0) {  </P>

<P>if ((atomTopic = GlobalAddAtom(szTopic)) != 0) { </P>

<P>SendMessage(hwndClientDDE, </P>

<P>WM_DDE_ACK, </P>

<P>(WPARAM) hwndServerDDE, </P>

<P>MAKELONG(atomApplication, atomTopic)); </P>

<P>GlobalDeleteAtom(atomApplication); </P>

<P>} </P>

<P></P>

<P>GlobalDeleteAtom(atomTopic); </P>

<P>} </P>

<P></P>

<P>if ((atomApplication == 0) || (atomTopic == 0)) { </P>

<P></P>

<P>. </P>

<P>. /* error handling */ </P>

<P>. </P>

<P></P>

<P>} </P>

<P></P>

<P>When a server responds with a <A HREF="9k0..a.htm">WM_DDE_ACK</A> message, the client application should save the handle of the server window. The client receiving the handle as the <I>wParam</I> parameter of the WM_DDE_ACK message then sends all subsequent DDE messages to the server window this handle identifies. </P>

<P>If your client application uses a NULL atom for the application name or topic name, expect the application to receive acknowledgments from more than one server application. Multiple acknowledgements can also come from multiple instances of a DDE server, even if your client application does not use NULL atoms. A server should always use a unique window for each conversation. The window procedure in the client application can use the handle of the server window (provided as the <I>lParam</I> parameter of <A HREF="1x_rzry.htm">WM_DDE_INITIATE</A>) to track multiple conversations. This allows a single client window to process several conversations without needing to terminate and reconnect with a new client window for each conversation. </P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
