<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Example of Menu-Item Bitmaps</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="45bk1s"></A><B>Example of Menu-item Bitmaps</B></P>

<P>The example in this topic creates two menus, each containing several bitmap menu items. For each menu, the application adds a corresponding menu name to the main window's menu bar.</P>

<P>The first menu contains menu items showing each of three chart types: pie, line, and bar. The bitmaps for these menu items are defined as resources and are loaded by using the <A HREF="a1xq1h.htm"><B>LoadBitmap</B></A> function. Associated with this menu is a "Chart" menu name on the menu bar.</P>

<P>The second menu contains menu items showing each of the five line styles used with the <A HREF="10xg29a.htm"><B>CreatePen</B></A> function: PS_SOLID, PS_DASH, PS_DOT, PS_DASHDOT, and PS_DASHDOTDOT. The application creates the bitmaps for these menu items at run time using GDI drawing functions. Associated with this menu is a "Lines" menu name on the menu bar.</P>

<P>Defined in the application's window procedure are two static arrays of bitmap handles. One array contains the handles of the three bitmaps used for the Chart menu. The other contains the handles of the five bitmaps used for the Lines menu. When processing the <A HREF="2re1yt3.htm">WM_CREATE</A> message, the window procedure loads the chart bitmaps, creates the line bitmaps, and then adds the corresponding menu items. When processing the <A HREF="0yqmho.htm">WM_DESTROY</A> message, the window procedure deletes all of the bitmaps. </P>

<P>Following are the relevant portions of the application's header file.</P>

<P>// Menu-item identifiers  </P>

<P></P>

<P>#define IDM_PIE         1 </P>

<P>#define IDM_LINE        2 </P>

<P>#define IDM_BAR         3 </P>

<P></P>

<P>#define IDM_SOLID       4 </P>

<P>#define IDM_DASH        5 </P>

<P>#define IDM_DASHDOT     6 </P>

<P>#define IDM_DASHDOTDOT  7 </P>

<P></P>

<P>// Number of items on the Chart and Lines menus </P>

<P></P>

<P>#define C_LINES         5 </P>

<P>#define C_CHARTS        3 </P>

<P></P>

<P>// Bitmap resource identifiers </P>

<P></P>

<P>#define IDB_PIE         1 </P>

<P>#define IDB_LINE        2 </P>

<P>#define IDB_BAR         3 </P>

<P></P>

<P>// Dimensions of the line bitmaps </P>

<P></P>

<P>#define CX_LINEBMP      40 </P>

<P>#define CY_LINEBMP      10 </P>

<P></P>

<P>Following are the relevant portions of the window procedure. The window procedure performs most of its initialization by calling the application-defined LoadChartBitmaps, CreateLineBitmaps, and AddBitmapMenu functions, described later in this topic.</P>

<P>LRESULT CALLBACK MainWindowProc(  </P>

<P>HWND hwnd, </P>

<P>UINT uMsg, </P>

<P>WPARAM wParam, </P>

<P>LPARAM lParam </P>

<P>) </P>

<P>{ </P>

<P>static HBITMAP aHbmLines[C_LINES]; </P>

<P>static HBITMAP aHbmChart[C_CHARTS]; </P>

<P>int i; </P>

<P></P>

<P>switch (uMsg) { </P>

<P></P>

<P>case WM_CREATE: </P>

<P></P>

<P>// Call application-defined functions to load the </P>

<P>// bitmaps for the Chart menu and create those for </P>

<P>// the Lines menu. </P>

<P></P>

<P>LoadChartBitmaps(aHbmChart); </P>

<P>CreateLineBitmaps(aHbmLines); </P>

<P></P>

<P>// Call an application-defined function to create </P>

<P>// menus containing the bitmap menu items. The function </P>

<P>// also adds a menu name to the window's menu bar. </P>

<P></P>

<P>AddBitmapMenu( </P>

<P>hwnd,      // menu bar's owner window </P>

<P>"&amp;Chart",  // text of menu name on menu bar </P>

<P>IDM_PIE,   // ID of first item on menu </P>

<P>aHbmChart, // array of bitmap handles </P>

<P>C_CHARTS   // number of items on menu </P>

<P>); </P>

<P>AddBitmapMenu(hwnd, "&amp;Lines", IDM_SOLID, </P>

<P>aHbmLines, C_LINES); </P>

<P>break; </P>

<P></P>

<P>case WM_DESTROY: </P>

<P>for (i = 0; i &lt; C_LINES; i++) </P>

<P>DeleteObject(aHbmLines[i]); </P>

<P>for (i = 0; i &lt; C_CHARTS; i++) </P>

<P>DeleteObject(aHbmChart[i]); </P>

<P>PostQuitMessage(0); </P>

<P>break; </P>

<P></P>

<P>. </P>

<P>.  // Process additional messages here. </P>

<P>. </P>

<P></P>

<P>default: </P>

<P>return (DefWindowProc(hwnd, uMsg, wParam, lParam)); </P>

<P>} </P>

<P>return 0; </P>

<P>} </P>

<P></P>

<P>The application-defined LoadChartBitmaps function loads the bitmap resources for the chart menu by calling the <A HREF="a1xq1h.htm"><B>LoadBitmap</B></A> function, as follows.</P>

<P>VOID WINAPI LoadChartBitmaps(HBITMAP *paHbm)  </P>

<P>{ </P>

<P>paHbm[0] = LoadBitmap(g_hinst, MAKEINTRESOURCE(IDB_PIE)); </P>

<P>paHbm[1] = LoadBitmap(g_hinst, MAKEINTRESOURCE(IDB_LINE)); </P>

<P>paHbm[2] = LoadBitmap(g_hinst, MAKEINTRESOURCE(IDB_BAR)); </P>

<P>} </P>

<P></P>

<P>The application-defined CreateLineBitmaps function creates the bitmaps for the Lines menu by using GDI drawing functions. The function creates a memory device context (DC) with the same properties as the desktop window's DC. For each line style, the function creates a bitmap, selects it into the memory DC, and draws in it.</P>

<P>VOID WINAPI CreateLineBitmaps(HBITMAP *paHbm)  </P>

<P>{ </P>

<P>HWND hwndDesktop = GetDesktopWindow(); </P>

<P>HDC hdcDesktop = GetDC(hwndDesktop); </P>

<P>HDC hdcMem = CreateCompatibleDC(hdcDesktop); </P>

<P>COLORREF clrMenu = GetSysColor(COLOR_MENU); </P>

<P>HBRUSH hbrOld; </P>

<P>HPEN hpenOld; </P>

<P>HBITMAP hbmOld; </P>

<P>int fnDrawMode; </P>

<P>int i; </P>

<P></P>

<P>// Create a brush using the menu background color, </P>

<P>// and select it into the memory DC. </P>

<P></P>

<P>hbrOld = SelectObject(hdcMem, CreateSolidBrush(clrMenu)); </P>

<P></P>

<P>// Create the bitmaps. Select each one into the memory </P>

<P>// DC that was created and draw in it. </P>

<P></P>

<P>for (i = 0; i &lt; C_LINES; i++) { </P>

<P></P>

<P>// Create the bitmap and select it into the DC. </P>

<P></P>

<P>paHbm[i] = CreateCompatibleBitmap(hdcDesktop, </P>

<P>CX_LINEBMP, CY_LINEBMP); </P>

<P>hbmOld = SelectObject(hdcMem, paHbm[i]); </P>

<P></P>

<P>// Fill the background using the brush. </P>

<P></P>

<P>PatBlt(hdcMem, 0, 0, CX_LINEBMP, CY_LINEBMP, PATCOPY); </P>

<P></P>

<P>// Create the pen and select it into the DC. </P>

<P></P>

<P>hpenOld = SelectObject(hdcMem, </P>

<P>CreatePen(PS_SOLID + i, 1, RGB(0, 0, 0))); </P>

<P></P>

<P>// Draw the line. To preserve the background color where </P>

<P>// the pen is white, use the R2_MASKPEN drawing mode. </P>

<P></P>

<P>fnDrawMode = SetROP2(hdcMem, R2_MASKPEN); </P>

<P>MoveToEx(hdcMem, 0, CY_LINEBMP / 2, NULL); </P>

<P>LineTo(hdcMem, CX_LINEBMP, CY_LINEBMP / 2); </P>

<P>SetROP2(hdcMem, fnDrawMode); </P>

<P></P>

<P>// Delete the pen, and select the old pen and bitmap. </P>

<P></P>

<P>DeleteObject(SelectObject(hdcMem, hpenOld)); </P>

<P>SelectObject(hdcMem, hbmOld); </P>

<P>} </P>

<P></P>

<P>// Delete the brush and select the original brush. </P>

<P></P>

<P>DeleteObject(SelectObject(hdcMem, hbrOld)); </P>

<P></P>

<P>// Delete the memory DC and release the desktop DC. </P>

<P></P>

<P>DeleteDC(hdcMem); </P>

<P>ReleaseDC(hwndDesktop, hdcDesktop); </P>

<P>} </P>

<P></P>

<P>The application-defined AddBitmapMenu function creates a menu and adds the specified number of bitmap menu items to it. Then it adds a corresponding menu name to the specified window's menu bar.</P>

<P>VOID WINAPI AddBitmapMenu(  </P>

<P>HWND hwnd,          // window that owned the menu bar </P>

<P>LPSTR lpszText,     // text of menu name on menu bar </P>

<P>UINT uID,           // ID of first bitmap menu item </P>

<P>HBITMAP *paHbm,     // bitmaps for the menu items </P>

<P>int cItems)         // number bitmap menu items </P>

<P>{ </P>

<P>HMENU hmenuBar = GetMenu(hwnd); </P>

<P>HMENU hmenuPopup = CreatePopupMenu(); </P>

<P>MENUITEMINFO mii; </P>

<P>int i; </P>

<P></P>

<P>// Add the bitmap menu items to the menu. </P>

<P></P>

<P>for (i = 0; i &lt; cItems; i++) { </P>

<P>mii.fMask = MIIM_ID | MIIM_TYPE | MIIM_DATA; </P>

<P>mii.fType = MFT_BITMAP; </P>

<P>mii.wID = uID + i; </P>

<P>mii.dwTypeData = (LPSTR) (paHbm[i]); </P>

<P>InsertMenuItem(hmenuPopup, i, TRUE, &amp;mii); </P>

<P>} </P>

<P></P>

<P>// Add a menu name to the menu bar. </P>

<P></P>

<P>mii.fMask = MIIM_TYPE | MIIM_DATA | MIIM_SUBMENU; </P>

<P>mii.fType = MFT_STRING; </P>

<P>mii.hSubMenu = hmenuPopup; </P>

<P>mii.dwTypeData = lpszText; </P>

<P>InsertMenuItem(hmenuBar, </P>

<P>GetMenuItemCount(hmenuBar), TRUE, &amp;mii); </P>

<P>} </P>

<P></P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
