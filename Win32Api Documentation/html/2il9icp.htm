<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Processing Appbar Notification Messages</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="2il9icp"></A><B>Processing Appbar Notification Messages</B></P>

<P>An appbar receives a notification message when the state of the task bar changes, when a full screen application starts (or the last one closes), or when an event occurs that can affect the appbar's size and position. The following example shows how to process the various notification messages.</P>

<P>// AppBarCallback - processes notification messages sent by the system.  </P>

<P>// hwndAccessBar - handle of the appbar  </P>

<P>// uNotifyMsg - identifier of the notification message </P>

<P>// lParam - message parameter </P>

<P>void AppBarCallback(HWND hwndAccessBar, UINT uNotifyMsg, </P>

<P>LPARAM lParam) </P>

<P>{ </P>

<P>APPBARDATA abd; </P>

<P>UINT uState; </P>

<P></P>

<P>abd.cbSize = sizeof(abd); </P>

<P>abd.hWnd = hwndAccessBar; </P>

<P></P>

<P>switch (uNotifyMsg) { </P>

<P>case ABN_STATECHANGE: </P>

<P></P>

<P>// Check to see if the taskbar's always-on-top state has </P>

<P>// changed and, if it has, change the appbar's state </P>

<P>// accordingly. </P>

<P>uState = SHAppBarMessage(ABM_GETSTATE, &amp;abd); </P>

<P>SetWindowPos(hwndAccessBar, </P>

<P>(ABS_ALWAYSONTOP &amp; uState) ? HWND_TOPMOST : HWND_BOTTOM,  </P>

<P>0, 0, 0, 0, SWP_NOMOVE | SWP_NOSIZE | SWP_NOACTIVATE);  </P>

<P>break; </P>

<P></P>

<P>case ABN_FULLSCREENAPP: </P>

<P></P>

<P>// A full screen application has started, or the last full </P>

<P>// screen application has closed. Set the appbar's </P>

<P>// Z order appropriately. </P>

<P>if (lParam) { </P>

<P>SetWindowPos(hwndAccessBar, </P>

<P>(ABS_ALWAYSONTOP &amp; uState) ? </P>

<P>HWND_TOPMOST : HWND_BOTTOM,  </P>

<P>0, 0, 0, 0,  </P>

<P>SWP_NOMOVE | SWP_NOSIZE | SWP_NOACTIVATE); </P>

<P>} else { </P>

<P>uState = SHAppBarMessage(ABM_GETSTATE, &amp;abd); </P>

<P>if (uState &amp; ABS_ALWAYSONTOP) </P>

<P>SetWindowPos(hwndAccessBar, HWND_TOPMOST, </P>

<P>0, 0, 0, 0, </P>

<P>SWP_NOMOVE | SWP_NOSIZE | SWP_NOACTIVATE); </P>

<P>} </P>

<P></P>

<P>case ABN_POSCHANGED: </P>

<P></P>

<P>// The taskbar or another appbar has changed its </P>

<P>// size or position. </P>

<P>AppBarPosChanged(&amp;abd); </P>

<P>break; </P>

<P>} </P>

<P>} </P>

<P></P>

<P>The following function adjusts an appbar's bounding rectangle and then calls the application-defined AppBarQuerySetPos function (included in the previous section) to set the bar's size and position accordingly. </P>

<P>// AppBarPosChanged - adjusts the appbar's size and position.  </P>

<P>// pabd - address of an APPBARDATA structure that contains information  </P>

<P>//     used to adjust the size and position </P>

<P>void PASCAL AppBarPosChanged(PAPPBARDATA pabd) </P>

<P>{ </P>

<P>RECT rc; </P>

<P>RECT rcWindow; </P>

<P>int iHeight; </P>

<P>int iWidth; </P>

<P></P>

<P>rc.top = 0; </P>

<P>rc.left = 0; </P>

<P>rc.right = GetSystemMetrics(SM_CXSCREEN); </P>

<P>rc.bottom = GetSystemMetrics(SM_CYSCREEN); </P>

<P></P>

<P>GetWindowRect(pabd-&gt;hWnd, &amp;rcWindow); </P>

<P>iHeight = rcWindow.bottom - rcWindow.top; </P>

<P>iWidth = rcWindow.right - rcWindow.left; </P>

<P></P>

<P>switch (g_uSide) { </P>

<P>case ABE_TOP: </P>

<P>rc.bottom = rc.top + iHeight; </P>

<P>break; </P>

<P></P>

<P>case ABE_BOTTOM: </P>

<P>rc.top = rc.bottom - iHeight; </P>

<P>break; </P>

<P></P>

<P>case ABE_LEFT: </P>

<P>rc.right = rc.left + iWidth; </P>

<P>break; </P>

<P></P>

<P>case ABE_RIGHT: </P>

<P>rc.left = rc.right - iWidth; </P>

<P>break; </P>

<P>} </P>

<P>AppBarQuerySetPos(g_uSide, &amp;rc, pabd); </P>

<P>} </P>

<P></P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
