<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>QueryServiceObjectSecurity</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="1f_vgrd"></A><B>QueryServiceObjectSecurity  <A HREF="u.bfwc.htm"><IMG SRC="../images/bm1.gif" ALT="" BORDER=0></A>  <A HREF="12c8zrk.htm"><IMG SRC="../images/bm3.gif" ALT="" BORDER=0></A>  <A HREF="we4jtq.htm"><IMG SRC="../images/bm2.gif" ALT="" BORDER=0></A></B></P>

<P>The <B>QueryServiceObjectSecurity</B> function retrieves a copy of the security descriptor protecting a service object. </P>

<P><B>BOOL QueryServiceObjectSecurity(</B></P>

<TABLE cols=2 width=629>

<TR VALIGN="top">
<TD width=56%><B>SC_HANDLE</B> <I>hService</I><B>,</B></TD>
<TD width=44%>// handle of service </TD>
</TR>

<TR VALIGN="top">
<TD width=56%><B>    SECURITY_INFORMATION</B> <I>dwSecurityInformation</I><B>,</B></TD>
<TD width=44%>// type of security information requested  </TD>
</TR>

<TR VALIGN="top">
<TD width=56%><B>    PSECURITY_DESCRIPTOR</B> <I>lpSecurityDescriptor</I><B>,</B></TD>
<TD width=44%>// address of security descriptor </TD>
</TR>

<TR VALIGN="top">
<TD width=56%><B>    DWORD</B> <I>cbBufSize</I><B>,</B></TD>
<TD width=44%>// size of security descriptor buffer </TD>
</TR>

<TR VALIGN="top">
<TD width=56%><B>    LPDWORD</B> <I>pcbBytesNeeded</I> </TD>
<TD width=44%>// address of variable for bytes needed </TD>
</TR>

<TR VALIGN="top">
<TD width=56%><B>   );</B></TD>
<TD width=44%>&nbsp;</TD>
</TR>
</TABLE><BR>

<P></P>

<P><B>Parameters</B></P>

<P><I>hService</I></P>

<P>Identifies the service. This handle is returned by the <A HREF="20gsky6.htm"><B>OpenService</B></A> or <A HREF="2wng26.htm"><B>CreateService</B></A> function, and it must have READ_CONTROL access. </P>

<P><I>dwSecurityInformation</I></P>

<P>Specifies the security information being requested. Any or all of the following flags can be specified: </P>

<TABLE cols=2>

<TR VALIGN="top">
<TD width=58%><B>Value</B></TD>
<TD width=42%><B>Meaning</B></TD>
</TR>

<TR VALIGN="top">
<TD width=58%>OWNER_SECURITY_INFORMATION</TD>
<TD width=42%>Requests the object's owner security identifier (SID).</TD>
</TR>

<TR VALIGN="top">
<TD width=58%>GROUP_SECURITY_INFORMATION</TD>
<TD width=42%>Requests the object's primary group SID.</TD>
</TR>

<TR VALIGN="top">
<TD width=58%>DACL_SECURITY_INFORMATION</TD>
<TD width=42%>Requests the object's discretionary access control list (ACL).</TD>
</TR>

<TR VALIGN="top">
<TD width=58%>SACL_SECURITY_INFORMATION</TD>
<TD width=42%>Requests the object's system ACL. The calling process must have the SE_SECURITY_NAME privilege. For more information about privileges, see <A HREF="134kpv4.htm">Privileges</A>. </TD>
</TR>
</TABLE><BR>

<P></P>

<P><I>lpSecurityDescriptor</I></P>

<P>Points to a buffer that receives a copy of the security descriptor of the specified service object. The calling process must have the appropriate access to view the specified aspects of the object's security descriptor. The <A HREF="188mr8k.htm"><B>SECURITY_DESCRIPTOR</B></A> structure is returned in self-relative format.  </P>

<P><I>cbBufSize</I></P>

<P>Specifies the size, in bytes, of the buffer pointed to by the <I>lpSecurityDescriptor</I> parameter. </P>

<P><I>pcbBytesNeeded</I></P>

<P>Points to a variable that receives the number of bytes needed to return all the requested security descriptor information. </P>

<P></P>

<P><B>Return Values</B></P>

<P>If the function succeeds, the return value is nonzero.</P>

<P>If the function fails, the return value is zero. To get extended error information, call <A HREF="11c2vs7.htm"><B>GetLastError</B></A>. </P>

<P><B>Errors</B></P>

<P>The following error codes may be set by the service control manager. Other error codes may be set by the registry functions that are called by the service control manager. </P>

<TABLE cols=2>

<TR VALIGN="top">
<TD width=49%><B>Value</B></TD>
<TD width=51%><B>Meaning</B></TD>
</TR>

<TR VALIGN="top">
<TD width=49%>ERROR_ACCESS_DENIED</TD>
<TD width=51%>The specified handle was not opened with READ_CONTROL access, or the calling process is not the owner of the object.</TD>
</TR>

<TR VALIGN="top">
<TD width=49%>ERROR_INVALID_HANDLE</TD>
<TD width=51%>The specified handle is invalid.</TD>
</TR>

<TR VALIGN="top">
<TD width=49%>ERROR_INSUFFICIENT_BUFFER</TD>
<TD width=51%>There is more security descriptor information than would fit into the <I>lpSecurityDescriptor</I> buffer. The number of bytes required to get all the information is returned in the <I>pcbBytesNeeded</I> parameter. Nothing is written to the <I>lpSecurityDescriptor</I> buffer.</TD>
</TR>

<TR VALIGN="top">
<TD width=49%>ERROR_INVALID_PARAMETER</TD>
<TD width=51%>The specified security information is invalid.</TD>
</TR>
</TABLE><BR>

<P></P>

<P><B>Remarks</B></P>

<P>The initial security descriptor of a service object is created by the service control manager, based on the security descriptor of the process that called the <B>CreateService</B> function to create the service. The security descriptor can be changed by calling the <B>SetServiceObjectSecurity</B> function. </P>

<P><B>See Also</B></P>

<P><A HREF="2wng26.htm"><B>CreateService</B></A>, <A HREF="20gsky6.htm"><B>OpenService</B></A>, <A HREF="188mr8k.htm"><B>SECURITY_DESCRIPTOR</B></A>, <A HREF="e9.1kc.htm"><B>SetServiceObjectSecurity</B></A> </P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
