<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Processing the WM_INITMENUPOPUP Message</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="14okpc5"></A><B>Processing the WM_INITMENUPOPUP Message</B></P>

<P>Not all clipboard commands are available to the user at any given time. An application should process the <A HREF="jwh_0q.htm">WM_INITMENUPOPUP</A> message to enable the menu items for available commands and disable unavailable commands. </P>

<P>Following is the WM_INITMENUPOPUP case for an application named Label. </P>

<P>case WM_INITMENUPOPUP:</P>

<P>InitMenu((HMENU) wParam);</P>

<P>break;</P>

<P></P>

<P>The InitMenu function is defined as follows. </P>

<P>void WINAPI InitMenu(HMENU hmenu)  </P>

<P>{ </P>

<P>int  cMenuItems = GetMenuItemCount(hmenu); </P>

<P>int  nPos; </P>

<P>UINT id; </P>

<P>UINT fuFlags; </P>

<P>PLABELBOX pbox = (hwndSelected == NULL) ? NULL : </P>

<P>(PLABELBOX) GetWindowLong(hwndSelected, 0); </P>

<P></P>

<P>for (nPos = 0; nPos &lt; cMenuItems; nPos++) </P>

<P>{ </P>

<P>id = GetMenuItemID(hmenu, nPos); </P>

<P></P>

<P>switch (id) </P>

<P>{ </P>

<P>case IDM_CUT: </P>

<P>case IDM_COPY: </P>

<P>case IDM_DELETE: </P>

<P>if (pbox == NULL || !pbox-&gt;fSelected) </P>

<P>fuFlags = MF_BYCOMMAND | MF_GRAYED; </P>

<P>else if (pbox-&gt;fEdit) </P>

<P>fuFlags = (id != IDM_DELETE &amp;&amp; pbox-&gt;ichSel </P>

<P>== pbox-&gt;ichCaret) ? </P>

<P>MF_BYCOMMAND | MF_GRAYED : </P>

<P>MF_BYCOMMAND | MF_ENABLED; </P>

<P>else </P>

<P>fuFlags = MF_BYCOMMAND | MF_ENABLED; </P>

<P></P>

<P>EnableMenuItem(hmenu, id, fuFlags); </P>

<P>break; </P>

<P></P>

<P>case IDM_PASTE: </P>

<P>if (pbox != NULL &amp;&amp; pbox-&gt;fEdit) </P>

<P>EnableMenuItem(hmenu, id, </P>

<P>IsClipboardFormatAvailable(CF_TEXT) ? </P>

<P>MF_BYCOMMAND | MF_ENABLED : </P>

<P>MF_BYCOMMAND | MF_GRAYED </P>

<P>); </P>

<P>else </P>

<P>EnableMenuItem(hmenu, id, </P>

<P>IsClipboardFormatAvailable( </P>

<P>uLabelFormat) ? </P>

<P>MF_BYCOMMAND | MF_ENABLED : </P>

<P>MF_BYCOMMAND | MF_GRAYED </P>

<P>); </P>

<P></P>

<P>} </P>

<P>} </P>

<P>} </P>

<P></P>

</BODY>
</HTML>
