<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Creating a Directory Listing in a Single-Selection List Box</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="12acggc"></A><B>Creating a Directory Listing in a Single-Selection List Box</B></P>

<P>The following example demonstrates how to display the content of the current directory in a list box and enable the user to delete one file at a time.</P>

<P>In addition to the standard list box styles, this list box has the LBS_MULTICOLUMN and LBS_HSCROLL styles. The code initializes the list box by using the <A HREF="eyoakl.htm"><B>DlgDirList</B></A> function to fill the list box with the names of all the files in the current directory. When the user chooses the Delete button, the <A HREF="4wg_v_.htm"><B>DlgDirSelectEx</B></A> function retrieves the name of the selected file. The code deletes the file by using the <A HREF=".h9hcz.htm"><B>DeleteFile</B></A> function and updates the directory list box by sending the <A HREF="jxlehq.htm">LB_DELETESTRING</A> message. </P>

<P>#define BUFFER MAX_PATH  </P>

<P></P>

<P>/* </P>

<P>* FUNCTION: DlgDelFileProc(HWND, unsigned, UINT, LONG) </P>

<P>* </P>

<P>* PURPOSE:  "Delete File" dialog box </P>

<P>*/ </P>

<P></P>

<P>BOOL APIENTRY DlgDelFileProc( </P>

<P>HWND hDlg,            /* window handle of dialog box     */ </P>

<P>UINT message,         /* type of message                 */ </P>

<P>UINT wParam,          /* message-specific information    */ </P>

<P>LONG lParam) </P>

<P>{ </P>

<P></P>

<P>DWORD cchCurDir; </P>

<P>LPTSTR lpszCurDir; </P>

<P>LPTSTR lpszFileToDelete; </P>

<P>int nItem; </P>

<P>int nTotal; </P>

<P>TCHAR tchBuffer[BUFFER]; </P>

<P>BOOL fResult; </P>

<P></P>

<P>switch (message) { </P>

<P></P>

<P>case WM_INITDIALOG: </P>

<P></P>

<P>/* </P>

<P>* Initialize the list box by filling it with files from </P>

<P>* the current directory. </P>

<P>*/ </P>

<P></P>

<P>lpszCurDir = tchBuffer; </P>

<P>GetCurrentDirectory(cchCurDir, lpszCurDir); </P>

<P>DlgDirList(hDlg, lpszCurDir, IDL_FILES, IDS_PATHTOFILL, 0); </P>

<P>SetFocus(GetDlgItem(hDlg, IDL_FILES)); </P>

<P>return FALSE; </P>

<P></P>

<P>case WM_COMMAND: </P>

<P></P>

<P>switch (LOWORD(wParam)) { </P>

<P></P>

<P>case IDOK: </P>

<P></P>

<P>/* </P>

<P>* When the user presses the DEL (IDOK) button, </P>

<P>* delete the selected file. </P>

<P>*/ </P>

<P></P>

<P>lpszFileToDelete = tchBuffer; </P>

<P></P>

<P>DlgDirSelectEx(hDlg, lpszFileToDelete, MAX_PATH, </P>

<P>IDL_FILES); </P>

<P>fResult = DeleteFile(lpszFileToDelete); </P>

<P>if (!fResult) { </P>

<P>MessageBox(hDlg, "Could not delete file.", </P>

<P>NULL, MB_OK); </P>

<P>} </P>

<P>else { </P>

<P>nItem = SendMessage(GetDlgItem(hDlg, IDL_FILES), </P>

<P>LB_GETCURSEL, 0, 0); </P>

<P></P>

<P>nTotal = SendMessage(GetDlgItem(hDlg, </P>

<P>IDL_FILES), LB_DELETESTRING, nItem, 0); </P>

<P></P>

<P>/* Update the list box. */ </P>

<P></P>

<P>if (nTotal &gt; nItem) { </P>

<P>SendMessage(GetDlgItem(hDlg, IDL_FILES), </P>

<P>LB_SETCURSEL, nItem, 0); </P>

<P>} </P>

<P>else { </P>

<P>SendMessage(GetDlgItem(hDlg, IDL_FILES), </P>

<P>LB_SETCURSEL, nTotal, 0); </P>

<P>} </P>

<P>} </P>

<P>return TRUE; </P>

<P></P>

<P>case IDCANCEL: </P>

<P></P>

<P>/* Destroy the dialog box. */ </P>

<P></P>

<P>EndDialog(hDlg, TRUE); </P>

<P>return TRUE; </P>

<P></P>

<P>default: </P>

<P>return FALSE; </P>

<P>} </P>

<P></P>

<P>default: </P>

<P>return FALSE; </P>

<P>} </P>

<P>} </P>

<P></P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
