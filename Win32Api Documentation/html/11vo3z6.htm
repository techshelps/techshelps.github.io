<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script><TITLE>Browsing for Folders</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="11vo3z6"></A><B>Browsing for Folders</B></P>

<P>The following example uses the <A HREF="18jbn.n.htm"><B>SHBrowseForFolder</B></A> function to prompt the user for a program group. The Programs directory is specified as the root.</P>

<P>// Main_OnBrowse - browses for a program folder.  </P>

<P>// hwnd - handle of the application's main window  </P>

<P>// </P>

<P>// Uses the global variable g_pMalloc, which is assumed to point </P>

<P>//     to the shell's IMalloc interface. </P>

<P>void Main_OnBrowse(HWND hwnd) </P>

<P>{ </P>

<P>BROWSEINFO bi; </P>

<P>LPSTR lpBuffer; </P>

<P>LPITEMIDLIST pidlPrograms;  // PIDL for Programs folder </P>

<P>LPITEMIDLIST pidlBrowse;    // PIDL selected by user </P>

<P></P>

<P>// Allocate a buffer to receive browse information. </P>

<P>if ((lpBuffer = (LPSTR) g_pMalloc-&gt;lpVtbl-&gt;Alloc( </P>

<P>g_pMalloc, MAX_PATH)) == NULL) </P>

<P>return; </P>

<P></P>

<P>// Get the PIDL for the Programs folder. </P>

<P>if (!SUCCEEDED(SHGetSpecialFolderLocation( </P>

<P>hwnd, CSIDL_PROGRAMS, &amp;pidlPrograms))) { </P>

<P>g_pMalloc-&gt;lpVtbl-&gt;Free(g_pMalloc, lpBuffer); </P>

<P>return; </P>

<P>} </P>

<P></P>

<P>// Fill in the BROWSEINFO structure. </P>

<P>bi.hwndOwner = hwnd; </P>

<P>bi.pidlRoot = pidlPrograms; </P>

<P>bi.pszDisplayName = lpBuffer; </P>

<P>bi.lpszTitle = "Choose a Program Group"; </P>

<P>bi.ulFlags = 0; </P>

<P>bi.lpfn = NULL; </P>

<P>bi.lParam = 0; </P>

<P></P>

<P>// Browse for a folder and return its PIDL. </P>

<P>pidlBrowse = SHBrowseForFolder(&amp;bi); </P>

<P>if (pidlBrowse != NULL) { </P>

<P></P>

<P>// Show the display name, title, and file system path. </P>

<P>MessageBox(hwnd, lpBuffer, "Display name", MB_OK); </P>

<P>if (SHGetPathFromIDList(pidlBrowse, lpBuffer)) </P>

<P>SetWindowText(hwnd, lpBuffer); </P>

<P></P>

<P>// Free the PIDL returned by SHBrowseForFolder. </P>

<P>g_pMalloc-&gt;lpVtbl-&gt;Free(g_pMalloc, pidlBrowse); </P>

<P>} </P>

<P></P>

<P>// Clean up. </P>

<P>g_pMalloc-&gt;lpVtbl-&gt;Free(g_pMalloc, pidlPrograms); </P>

<P>g_pMalloc-&gt;lpVtbl-&gt;Free(g_pMalloc, lpBuffer); </P>

<P>} </P>

<P></P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
