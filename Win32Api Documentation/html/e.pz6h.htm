<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>HeapCreate</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFC8" TEXT="#341717">



<P><A NAME="e.pz6h"></A><B>HeapCreate  <A HREF="1.8ju_t.htm"><IMG SRC="../images/bm1.gif" ALT="" BORDER=0></A>  <A HREF="7gqv3r.htm"><IMG SRC="../images/bm3.gif" ALT="" BORDER=0></A>  <A HREF="9cqndc.htm"><IMG SRC="../images/bm2.gif" ALT="" BORDER=0></A></B></P>

<P>The <B>HeapCreate</B> function creates a heap object that can be used by the calling process. The function reserves a contiguous block in the virtual address space of the process and allocates physical storage for a specified initial portion of this block. </P>

<P><B>HANDLE HeapCreate(</B></P>

<TABLE cols=2 width=375>

<TR VALIGN="top">
<TD width=56%><B>DWORD</B> <I>flOptions</I><B>,</B></TD>
<TD width=44%>// heap allocation flag </TD>
</TR>

<TR VALIGN="top">
<TD width=56%><B>    DWORD</B> <I>dwInitialSize</I><B>,</B></TD>
<TD width=44%>// initial heap size </TD>
</TR>

<TR VALIGN="top">
<TD width=56%><B>    DWORD</B> <I>dwMaximumSize</I> </TD>
<TD width=44%>// maximum heap size </TD>
</TR>

<TR VALIGN="top">
<TD width=56%><B>   );</B></TD>
<TD width=44%>&nbsp;</TD>
</TR>
</TABLE><BR>

<P></P>

<P><B>Parameters</B></P>

<P><I>flOptions</I></P>

<P>Specifies optional attributes for the new heap. These flags will affect subsequent access to the new heap through calls to the heap functions (<A HREF="12yjji7.htm"><B>HeapAlloc</B></A>, <A HREF="ge8y4..htm"><B>HeapFree</B></A>, <A HREF="lcofg4.htm"><B>HeapReAlloc</B></A>, and <A HREF="geepi..htm"><B>HeapSize</B></A>). You can specify one or more of the following flags: </P>

<TABLE cols=2>

<TR VALIGN="top">
<TD width=50%><B>Flag</B></TD>
<TD width=50%><B>Meaning</B></TD>
</TR>

<TR VALIGN="top">
<TD width=50%>HEAP_GENERATE_EXCEPTIONS</TD>
<TD width=50%>Specifies that the system will raise an exception to indicate a function failure, such as an out-of-memory condition, instead of returning NULL.</TD>
</TR>

<TR VALIGN="top">
<TD width=50%>HEAP_NO_SERIALIZE</TD>
<TD width=50%>Specifies that mutual exclusion will not be used when the heap functions allocate and free memory from this heap. The default, occurring when the HEAP_NO_SERIALIZE flag is not specified, is to serialize access to the heap. Serialization of heap access allows two or more threads to simultaneously allocate and free memory from the same heap.</TD>
</TR>
</TABLE><BR>

<P></P>

<P><I>dwInitialSize</I></P>

<P>Specifies the initial size, in bytes, of the heap. This value determines the initial amount of physical storage that is allocated for the heap. The value is rounded up to the next page boundary. To determine the size of a page on the host computer, use the <A HREF="nh29xo.htm"><B>GetSystemInfo</B></A> function. </P>

<P><I>dwMaximumSize</I></P>

<P>If <I>dwMaximumSize</I> is a nonzero value, it specifies the maximum size, in bytes, of the heap. The <B>HeapCreate </B>function rounds <I>dwMaximumSize</I> up to the next page boundary, and then reserves a block of that size in the process's virtual address space for the heap. If allocation requests made by the <A HREF="12yjji7.htm"><B>HeapAlloc</B></A> or <A HREF="lcofg4.htm"><B>HeapReAlloc</B></A><B> </B>functions exceed the initial amount of physical storage specified by <I>dwInitialSize</I>, the system allocates additional pages of physical storage for the heap, up to the heap's maximum size. </P>

<P>In addition, if <I>dwMaximumSize</I> is nonzero, the heap cannot grow, and an absolute limitation arises: the maximum size of a memory block in the heap is a bit less than 0x7FFF8 bytes. Requests to allocate larger blocks will fail, even if the maximum size of the heap is large enough to contain the block.</P>

<P>If <I>dwMaximumSize</I> is zero, it specifies that the heap is growable. The heap's size is limited only by available memory. Requests to allocate blocks larger than 0x7FFF8 bytes do not automatically fail; the system calls <A HREF="1m7v8go.htm"><B>VirtualAlloc</B></A> to obtain the memory needed for such large blocks. Applications that need to allocate large memory blocks should set <I>dwMaximumSize</I> to zero.</P>

<P></P>

<P><B>Return Values</B></P>

<P>If the function succeeds, the return value is a handle of the newly created heap.</P>

<P>If the function fails, the return value is is NULL. To get extended error information, call <A HREF="11c2vs7.htm"><B>GetLastError</B></A>.</P>

<P><B>Remarks</B></P>

<P>The <B>HeapCreate</B> function creates a private heap object from which the calling process can allocate memory blocks by using the <A HREF="12yjji7.htm"><B>HeapAlloc</B></A> function. The initial size determines the number of committed pages that are initially allocated for the heap. The maximum size determines the total number of reserved pages. These pages create a contiguous block in the process's virtual address space into which the heap can grow. If requests by <B>HeapAlloc</B> exceed the current size of committed pages, additional pages are automatically committed from this reserved space, assuming that the physical storage is available. </P>

<P>The memory of a private heap object is accessible only to the process that created it. If a dynamic-link library (DLL) creates a private heap, the heap is created in the address space of the process that called the DLL, and it is accessible only to that process. </P>

<P>The system uses memory from the private heap to store heap support structures, so not all of the specified heap size is available to the process. For example, if the <A HREF="12yjji7.htm"><B>HeapAlloc</B></A> function requests 64 kilobytes (K) from a heap with a maximum size of 64K, the request may fail because of system overhead. </P>

<P>If the HEAP_NO_SERIALIZE flag is not specified (the simple default), the heap will serialize access within the calling process. Serialization ensures mutual exclusion when two or more threads attempt to simultaneously allocate or free blocks from the same heap. There is a small performance cost to serialization, but it must be used whenever multiple threads allocate and free memory from the same heap. </P>

<P>Setting the HEAP_NO_SERIALIZE flag eliminates mutual exclusion on the heap. Without serialization, two or more threads that use the same heap handle might attempt to allocate or free memory simultaneously, likely causing corruption in the heap. The HEAP_NO_SERIALIZE flag can, therefore, be safely used only in the following situations: </P>

<P>·The process has only one thread. </P>

<P>·The process has multiple threads, but only one thread calls the heap functions for a specific heap. </P>

<P>·The process has multiple threads, and the application provides its own mechanism for mutual exclusion to a specific heap. </P>

<P></P>

<P><B>See Also</B></P>

<P><A HREF="26hfdb.htm"><B>GetProcessHeap</B></A>, <A HREF="4wmern.htm"><B>GetProcessHeaps</B></A>, <A HREF="nh29xo.htm"><B>GetSystemInfo</B></A>, <A HREF="12yjji7.htm"><B>HeapAlloc</B></A>, <A HREF="xaqbyb.htm"><B>HeapDestroy</B></A>, <A HREF="ge8y4..htm"><B>HeapFree</B></A>, <A HREF="lcofg4.htm"><B>HeapReAlloc</B></A>, <A HREF="geepi..htm"><B>HeapSize</B></A>, <A HREF="336u0ic.htm"><B>HeapValidate</B></A>, <A HREF="1m7v8go.htm"><B>VirtualAlloc</B></A> </P>

</BODY>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-83731338-2"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-83731338-2');</script></html>
